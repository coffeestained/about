/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import t from"../Map.js";import i from"../TimeExtent.js";import r from"../core/Accessor.js";import o from"../core/Collection.js";import{C as s}from"../chunks/CollectionFlattener.js";import a from"../core/Error.js";import n from"../core/Evented.js";import{HandleOwner as l,W as p,HandleOwnerMixin as h}from"../core/HandleOwner.js";import{m as c}from"../chunks/handleUtils.js";import u from"../core/Loadable.js";import{L as d}from"../chunks/Logger.js";import{a as y,i as m,r as f,f as g,u as _,d as v,p as w}from"../chunks/maybe.js";import{EsriPromiseMixin as b}from"../core/Promise.js";import{createDeferred as k,isAbortError as j,onAbort as M,throwIfAborted as T,createTask as R,isAborted as V,after as S}from"../core/promiseUtils.js";import{on as E,watch as I,syncAndInitial as C,whenOnce as x,when as L,sync as P}from"../core/reactiveUtils.js";import{aliasOf as F}from"../core/accessorSupport/decorators/aliasOf.js";import"../core/lang.js";import{s as O}from"../chunks/ensureType.js";import{property as A}from"../core/accessorSupport/decorators/property.js";import{subclass as D}from"../core/accessorSupport/decorators/subclass.js";import{O as U,G as q,o as B}from"../chunks/GraphicsCollection.js";import K from"../geometry/Extent.js";import W from"../geometry/HeightModelInfo.js";import G,{e as z}from"../geometry/SpatialReference.js";import{BasemapView as N}from"./BasemapView.js";import{schedule as H}from"../core/scheduling.js";import $ from"./Magnifier.js";import{T as Q,I as J}from"../chunks/Scheduler.js";import{V as X}from"../chunks/InputManager.js";import{e as Y,V as Z}from"../chunks/ViewEvents.js";import{E as ee}from"../chunks/interfaces.js";import{c as te}from"../chunks/mathUtils.js";import{f as ie}from"../chunks/screenUtils.js";import{c as re}from"../chunks/screenUtils2.js";import oe from"./input/Input.js";import se from"./navigation/Navigation.js";import{s as ae,d as ne}from"../chunks/heightModelInfoUtils.js";import{V as le}from"../chunks/ViewingMode.js";import{isLoaded as pe,canProjectWithoutEngine as he,project as ce,load as ue}from"../geometry/projection.js";import"../Basemap.js";import"../chunks/collectionUtils.js";import"../core/JSONSupport.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/metadata.js";import"../chunks/ArrayPool.js";import"../chunks/tracking.js";import"../chunks/watch.js";import"../chunks/nextTick.js";import"../chunks/object.js";import"../config.js";import"../chunks/string.js";import"../chunks/loadAll.js";import"../chunks/asyncUtils.js";import"../core/urlUtils.js";import"../chunks/writer.js";import"../portal/Portal.js";import"../kernel.js";import"../request.js";import"../chunks/reader.js";import"../chunks/locale.js";import"../portal/PortalQueryParams.js";import"../chunks/jsonMap.js";import"../geometry/support/webMercatorUtils.js";import"../chunks/Ellipsoid.js";import"../geometry/Geometry.js";import"../geometry/Point.js";import"../core/accessorSupport/decorators/cast.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../portal/PortalItem.js";import"../chunks/assets.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../chunks/messages.js";import"../chunks/writeUtils.js";import"../chunks/layerUtils.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../Ground.js";import"../Color.js";import"../chunks/colorUtils.js";import"../chunks/common.js";import"../chunks/compilerUtils.js";import"../chunks/enumeration.js";import"../chunks/opacityUtils.js";import"../chunks/basemapUtils.js";import"../chunks/collectionUtils2.js";import"../support/LayersMixin.js";import"../layers/Layer.js";import"../geometry.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../chunks/Identifiable.js";import"../support/TablesMixin.js";import"../core/Handles.js";import"../chunks/timeUtils.js";import"../Graphic.js";import"../PopupTemplate.js";import"../layers/support/fieldUtils.js";import"../chunks/arcadeOnDemand.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../popup/support/FieldInfoFormat.js";import"../chunks/date.js";import"../chunks/number2.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../support/actions/ActionBase.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils2.js";import"../symbols/edges/Edges3D.js";import"../chunks/materialUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils3.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../chunks/aaBoundingRect.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../core/Clonable.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../chunks/Thumbnail.js";import"../chunks/Symbol3DVerticalOffset.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../chunks/unitUtils.js";import"../chunks/projectionEllipsoid.js";import"../chunks/debugFlags.js";import"../chunks/Queue.js";import"../chunks/IViewEvents.js";import"./input/gamepad/GamepadSettings.js";import"./input/gamepad/GamepadInputDevice.js";import"./navigation/gamepad/GamepadSettings.js";import"../chunks/arcgisLayerUrl.js";import"../chunks/mat4.js";import"../chunks/pe.js";import"../chunks/geodesicConstants.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"../chunks/zscale.js";const de=d.getLogger("esri.support.AnalysesCollection");let ye=class extends U{constructor(e){super(e),this.handles.add(this.on("before-add",(e=>{y(e.item)||e.item.parent===this.owner&&(de.warn("Analysis inside the collection must be unique. Not adding this element again."),e.preventDefault())})))}_own(e){e.parent=this.owner}_release(e){e.parent=null}};ye=e([D("esri.support.AnalysesCollection")],ye);const me=d.getLogger("esri.views.LayerViewManager");class fe{constructor(e,t,i){this.layer=e,this.view=t,this.layerViewImporter=i,this._controller=new AbortController,this._deferred=k(),this._started=!1,this.done=!1,M(this._controller.signal,(()=>{const t=new a("cancelled:layerview-create","layerview creation cancelled",{layer:e});this._deferred.reject(t)}))}get promise(){return this._deferred.promise}destroy(){this._controller.abort();const{layerView:e}=this;if(!e)return;const{layer:t,view:i}=this;t.emit("layerview-destroy",{view:i,layerView:e}),i.emit("layerview-destroy",{layer:t,layerView:e}),this.done=!0,this.layer=null,this.layerView=null,this.view=null,this.layerViewImporter=null}async start(){if(this._started)return;this._started=!0;const{_controller:{signal:e},layer:t,view:i}=this;this._map=i.map;try{let r,o;if(await t.load({signal:e}),"prefetchResources"in t&&await t.prefetchResources({signal:e}),t.createLayerView)r=await t.createLayerView(i,{signal:e});else{if(!this.layerViewImporter.hasLayerViewModule(t))throw new a("layer:view-not-supported","No layerview implementation was found");const o=await this.layerViewImporter.importLayerView(t);T(e),r="default"in o?new o.default({layer:t,view:i}):new o({layer:t,view:i})}const s=()=>{o=f(o),r.destroyed||r.destroy(),r.layer=null,r.parent=null,r.view=null,this.done=!0};o=M(e,s),T(e);try{await r.when()}catch(e){throw s(),e}const n=this._map?.allLayers?.includes(t);if(!n)return s(),void this._deferred.reject(new a("view:no-layerview-for-layer","The layer has been removed from the map",{layer:t}));this.layerView=r,t.emit("layerview-create",{view:i,layerView:r}),i.emit("layerview-create",{layer:t,layerView:r}),this.done=!0,this._deferred.resolve(r)}catch(e){t.emit("layerview-create-error",{view:i,error:e}),i.emit("layerview-create-error",{layer:t,error:e}),this.done=!0,this._deferred.reject(new a("layerview:create-error","layerview creation failed",{layer:t,error:e}))}}}let ge=class extends l{constructor(e){super(e),this._layerLayerViewInfoMap=new Map,this._watchUpdatingTracking=new p,this.supportsGround=!0,this._preloadLayerViewModules=()=>{const e=this.view.map?.allLayers;if(e)for(const t of e)this.layerViewImporter.hasLayerViewModule(t)&&this.layerViewImporter.importLayerView(t)},this._reschedule=()=>(y(this._workPromise)&&(this._workPromise=k()),this.handles.remove("reschedule"),this.handles.add(H(this._doWork),"reschedule"),this._workPromise.promise),this._doWork=()=>{const e=this.view.map;if(this._map!==e&&(this.clear(),this._map=e),y(this._workPromise))return void this.notifyChange("updating");this.handles.remove("reschedule"),this.handles.remove("collection-change");const t=new s({getCollections:()=>this._rootCollectionNames.map((e=>this.get(e))),getChildrenFunction:e=>e&&"layers"in e?e.layers:null});if(!t)return this._workPromise.resolve(),void(this._workPromise=null);for(const e of t)this._createLayerView(e);this._refreshCollections();for(const[e,i]of this._layerLayerViewInfoMap)t.includes(e)||(this._layerLayerViewInfoMap.delete(i.layer),i.destroy());const i=t.filter((e=>"group"===e.type)).map((e=>e.layers)),r=[e?.ground?.layers,e?.basemap?.baseLayers,e?.basemap?.referenceLayers,e?.layers,...i].filter((e=>!!e));this.handles.add(r.map((e=>this._watchUpdatingTracking.addOnCollectionChange((()=>e),this._reschedule))),"collection-change"),this._workPromise.resolve(),this._workPromise=null}}initialize(){this.handles.add([E((()=>this.view?.map?.allLayers),"change",this._preloadLayerViewModules,{onListenerAdd:this._preloadLayerViewModules}),I((()=>{const e=this.view,t=e?.map;return[t?.basemap,t?.ground,t?.layers,e?.ready]}),(()=>this._reschedule()),C)]),this._preloadLayerViewModules(),this._reschedule()}destroy(){this.clear(),this._watchUpdatingTracking.destroy(),this._map=null}get _layersToLayerViews(){const e=[["view.map.basemap.baseLayers","view.basemapView.baseLayerViews"],["view.map.layers","view.layerViews"],["view.map.basemap.referenceLayers","view.basemapView.referenceLayerViews"]];return this.supportsGround&&e.push(["view.map.ground.layers","view.groundView.layerViews"]),new Map(e)}get _rootCollectionNames(){return Array.from(this._layersToLayerViews.keys())}get updating(){return m(this._workPromise)||this._watchUpdatingTracking.updating||O(this._layerLayerViewInfoMap,(e=>!e.done))}get updatingRemaining(){let e=0;for(const t of this._layerLayerViewInfoMap.values())t.done||++e;return e}clear(){if(!this.destroyed){for(const e of this._layerLayerViewInfoMap.values())e.destroy();this._layerLayerViewInfoMap.clear(),this._refreshCollections()}}async whenLayerView(e){if(await this._reschedule(),!this._layerLayerViewInfoMap.has(e))throw new a("view:no-layerview-for-layer","No layerview has been found for the layer",{layer:e});return this._layerLayerViewInfoMap.get(e).promise}_refreshCollections(){for(const[e,t]of this._layersToLayerViews)this._populateLayerViewsOwners(this.get(e),this.get(t),this.view);this.notifyChange("updating"),this.notifyChange("updatingRemaining")}_populateLayerViewsOwners(e,t,i){if(!e||!t)return void(t&&t.removeAll());let r=0;for(const o of e){const e=this._layerLayerViewInfoMap.get(o);if(!e||!e.layerView)continue;const s=e.layerView;s.layer=o,s.parent=i,t.getItemAt(r)!==s&&t.splice(r,0,s),o.layers&&this._populateLayerViewsOwners(o.layers,s.layerViews,s),r+=1}r<t.length&&t.splice(r,t.length)}_createLayerView(e){if(this._layerLayerViewInfoMap.has(e))return this.view.ready&&this._layerLayerViewInfoMap.get(e).start(),this.notifyChange("updating"),void this.notifyChange("updatingRemaining");e.load().catch((()=>{})),this.layerViewImporter.hasLayerViewModule(e)&&this.layerViewImporter.importLayerView(e);const t=new fe(e,this.view,this.layerViewImporter);t.promise.then((()=>this._refreshCollections()),(t=>{t&&(j(t)||"cancelled:layerview-create"===t.name)||me.error(`Failed to create layerview for layer title:'${e.title??"no title"}', id:'${e.id??"no id"}' of type '${e.type}'.`,{layer:e,error:t}),this._refreshCollections()})),this._layerLayerViewInfoMap.set(e,t),this.view.ready&&t.start(),this.notifyChange("updating"),this.notifyChange("updatingRemaining")}};e([A()],ge.prototype,"_workPromise",void 0),e([A({readOnly:!0})],ge.prototype,"_watchUpdatingTracking",void 0),e([A({readOnly:!0})],ge.prototype,"_layersToLayerViews",null),e([A({readOnly:!0})],ge.prototype,"_rootCollectionNames",null),e([A()],ge.prototype,"layerViewImporter",void 0),e([A()],ge.prototype,"supportsGround",void 0),e([A({readOnly:!0})],ge.prototype,"updating",null),e([A({readOnly:!0})],ge.prototype,"updatingRemaining",null),e([A({constructOnly:!0})],ge.prototype,"view",void 0),ge=e([D("esri.views.LayerViewManager")],ge);const _e=ge;let ve=class extends r{constructor(e,t){super({}),this._stage=e,this._textureRequests=new Map,this._frameTask=t?.registerTask(Q.TEXTURE_UNLOAD)??J}normalizeCtorArgs(){return{}}destroy(){super.destroy(),this._frameTask.remove(),this._textureRequests.forEach((e=>this._releaseTextureRequest(e))),this._textureRequests.clear()}get updating(){return this._frameTask.updating}fromData(e,t,i){const r=this.makeUid(e);let o=this._textureRequests.get(r);return o||(o={referenceCount:0,texture:t(),textureAsync:null,abortController:null,onRemove:i},this._stage&&(this._stage.add(o.texture),this._stage.loadImmediate(o.texture)),this._textureRequests.set(r,o)),o.referenceCount++,{uid:r,texture:o.texture,release:()=>this._release(r)}}_release(e){const t=this._textureRequests.get(e);t?(t.referenceCount<1&&console.warn("TextureCollection: reference count is < 1 for "+e),t.referenceCount--,t.referenceCount<1&&this._frameTask.schedule((()=>this._releaseNow(e)))):console.warn(`TextureCollection: texture doesn't exist: '${e}'`)}get test(){return{textureRequests:this._textureRequests}}_releaseNow(e){if(!this._textureRequests)return;const t=this._textureRequests.get(e);!t||t.referenceCount>0||(this._releaseTextureRequest(t),this._textureRequests.delete(e))}_releaseTextureRequest(e){e.onRemove&&e.onRemove(),e.texture?this._stage?.remove(e.texture):e.abortController&&(e.abortController.abort(),e.abortController=null)}makeUid(e,t=null){return m(t)?`${e}.${t}px`:e}};e([A()],ve.prototype,"_frameTask",void 0),e([A()],ve.prototype,"updating",null),ve=e([D("esri.views.3d.support.TextureCollection")],ve);const we=d.getLogger("esri.views.interactive.interactiveToolUtils");function be(e){return e.visible&&e.getEditableFlag(ee.USER)&&e.getEditableFlag(ee.MANAGER)}class ke{constructor(){this._pointerLocations=new Map,this._hoveredManipulators=new Map,this._grabbedManipulators=new Map,this._draggedManipulators=new Map,this._stopDrag=!1,this._currentlyActiveTool=null,this._revertToActiveTool=!1,this._cursor=null}get cursor(){return this._cursor}handleInputEvent(e,t){const i=()=>e.stopPropagation();switch(e.type){case"pointer-move":je(e.pointerType)&&this._pointerLocations.set(e.pointerId,{x:e.x,y:e.y,pointerType:e.pointerType});break;case"drag":this._grabbedManipulators.size>0&&(this._stopDrag=!0),this._stopDrag&&(i(),"end"===e.action&&(this._stopDrag=!1));break;case"pointer-down":{if(!Me(e))break;const r=re(e),o=this._intersect(r,e.pointerType,t.forEachTool);if(y(o))break;const s=this._findToolAndManipulatorByKey(o,t.forEachTool,Te),a=g(s,(e=>e.manipulator)),n=g(s,(e=>e.tool));!(m(a)&&m(n)&&a.interactive)||a.grabbable&&a.grabbableForEvent(e)||!a.grabbing||a.dragging||this._ungrabManipulatorBeforeDragging(a,n,e),m(a)&&a.interactive&&a.grabbable&&a.grabbableForEvent(e)&&!a.grabbing&&(this._grabbedManipulators.set(e.pointerId,{key:o,start:r,pointerType:e.pointerType}),1===this._grabbedManipulators.size&&t.activeTool!==o.tool&&(this._currentlyActiveTool=t.activeTool,this._revertToActiveTool=!0,t.setActiveTool(o.tool)),a.grabbing=!0,a.events.emit("grab-changed",{action:"start",pointerType:e.pointerType,screenPoint:r}),i());break}case"pointer-up":this._handlePointerEnd(e,t);break;case"pointer-drag":{if(!Me(e))break;const r=this._grabbedManipulators.get(e.pointerId),o=this._draggedManipulators.get(e.pointerId),s=g(r||o,(({key:e})=>e)),a=this._findManipulatorByKey(s,t.forEachTool);if(y(a))break;const n=re(e);n.x=te(n.x,0,t.view.width),n.y=te(n.y,0,t.view.height);const l=_(r||o).start;switch(e.action){case"start":case"update":"update"!==e.action&&1!==this._grabbedManipulators.size||(a.dragging=!0,o?a.events.emit("drag",{action:"update",start:l,screenPoint:n}):a.events.emit("drag",{action:"start",start:l,screenPoint:n,pointerType:e.pointerType}),this._draggedManipulators.set(e.pointerId,{key:_(s),start:l}));break;case"end":a.dragging=!1,o&&a.events.emit("drag",{action:"end",start:l,screenPoint:n}),this._draggedManipulators.delete(e.pointerId),this._handlePointerEnd(e,t)}i();break}case"immediate-click":{const r=re(e),o=this._intersect(r,e.pointerType,t.forEachTool),s=this._findToolAndManipulatorByKey(o,t.forEachTool,Te);if(e.native.shiftKey||t.forEachTool((e=>{if((!m(s)||s.tool!==e||e.automaticManipulatorSelection)&&e.manipulators){let t=!1;e.manipulators.forEach((({manipulator:e})=>{e.selected&&(e.selected=!1,t=!0)})),t&&e.manipulatorSelectionChanged&&e.manipulatorSelectionChanged()}})),y(s))break;const{manipulator:a,tool:n}=s;if(!a.interactive)break;a.selectable&&n.automaticManipulatorSelection&&(a.selected=!a.selected,n.manipulatorSelectionChanged&&n.manipulatorSelectionChanged());const l=e.native.shiftKey;a.events.emit("immediate-click",{screenPoint:r,button:e.button,pointerType:e.pointerType,shiftKey:l,stopPropagation:i});break}case"click":{const r=re(e),o=this._intersect(r,e.pointerType,t.forEachTool),s=this._findManipulatorByKey(o,t.forEachTool);if(y(s)||!s.interactive)break;const a=e.native.shiftKey;s.events.emit(e.type,{screenPoint:r,button:e.button,pointerType:e.pointerType,shiftKey:a}),i();break}case"double-click":{const r=re(e),o=this._intersect(r,e.pointerType,t.forEachTool),s=this._findManipulatorByKey(o,t.forEachTool);if(y(s)||!s.interactive)break;const a=e.native.shiftKey;s.events.emit("double-click",{screenPoint:r,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i});break}case"immediate-double-click":{const r=re(e),o=this._intersect(r,e.pointerType,t.forEachTool),s=this._findManipulatorByKey(o,t.forEachTool);if(y(s)||!s.interactive)break;const a=e.native.shiftKey;s.events.emit("immediate-double-click",{screenPoint:r,button:e.button,pointerType:e.pointerType,shiftKey:a,stopPropagation:i});break}}this._onFocusChange(t.forEachTool)}_ungrabManipulatorBeforeDragging(e,t,i){e.grabbing=!1,e.events.emit("grab-changed",{action:"end",pointerType:i.pointerType,screenPoint:re(i)}),this._grabbedManipulators.forEach((({key:i},r)=>{i.tool===t&&t.manipulators.findById(i.manipulatorId)===e&&this._grabbedManipulators.delete(r)}))}_handlePointerEnd(e,t){const i=g(this._grabbedManipulators.get(e.pointerId),(({key:e})=>e)),r=this._findManipulatorByKey(i,t.forEachTool);m(r)&&!r.dragging&&(1===this._grabbedManipulators.size&&0===this._draggedManipulators.size&&this._revertToActiveTool&&(t.setActiveTool(this._currentlyActiveTool),this._revertToActiveTool=!1,this._currentlyActiveTool=null),r.grabbing&&(r.grabbing=!1,r.events.emit("grab-changed",{action:"end",pointerType:e.pointerType,screenPoint:re(e)})),this._grabbedManipulators.delete(e.pointerId))}_cursorFromMap(e,t){let i=null;return O(e,(({key:e})=>{const r=this._findManipulatorByKey(e,t);return!!(m(r)&&r.interactive&&"cursor"in r&&r.cursor)&&(i=r.cursor,!0)})),i}_onFocusChange(e){this._updateCursor(e),this._updateFocusedManipulatorTools(e)}_updateCursor(e){this._grabbedManipulators.size>0?this._cursor=this._cursorFromMap(this._grabbedManipulators,e)||"grabbing":this._hoveredManipulators.size>0?this._cursor=this._cursorFromMap(this._hoveredManipulators,e)||"pointer":this._cursor=null}_updateFocusedManipulatorTools(e){const t=new Set;this._grabbedManipulators.forEach((({key:{tool:e}})=>{t.add(e)})),this._hoveredManipulators.forEach((({key:{tool:e}})=>{t.add(e)})),e((e=>{e.hasFocusedManipulators=t.has(e)}))}clearPointers(e,t,i=!0,r){const o=t=>t.tool===e&&(y(r)||t.manipulatorId===r);this._grabbedManipulators.forEach((({key:e,pointerType:i},r)=>{if(o(e)){this._grabbedManipulators.delete(r);const o=this._findManipulatorByKey(e,t);m(o)&&(o.grabbing=!1,o.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:i}))}})),this._draggedManipulators.forEach((({key:e},i)=>{if(o(e)){this._draggedManipulators.delete(i);const r=this._findManipulatorByKey(e,t);m(r)&&(r.dragging=!1,r.events.emit("drag",{action:"cancel"}))}})),i&&this._hoveredManipulators.forEach((({key:e},i)=>{if(o(e)){this._hoveredManipulators.delete(i);const r=this._findManipulatorByKey(e,t);m(r)&&(r.hovering=!1)}})),this._onFocusChange(t)}_intersect(e,t,i){let r=null;return i((i=>{if(null==i.manipulators||!be(i))return!1;const o=i.manipulators.intersect(e,t);return!y(o)&&(r={manipulatorId:o.id,tool:i},!0)})),r}updateHoveredStateFromKnownPointers(e){this._pointerLocations.forEach(((t,i)=>{this._updateHoveredStateForPointerAtScreenPosition(ie(t.x,t.y),i,t.pointerType,e)}))}handleHoverEvent(e,t){"pointer-up"!==e.type&&"immediate-click"!==e.type&&"pointer-move"!==e.type||!je(e.pointerType)||this._updateHoveredStateForPointerAtScreenPosition(re(e),e.pointerId,e.pointerType,t)}_updateHoveredStateForPointerAtScreenPosition(e,t,i,r){const o=this._intersect(e,i,r);let s=this._findManipulatorByKey(o,r);const a=g(this._hoveredManipulators.get(t),(({key:e})=>e)),n=this._findManipulatorByKey(a,r);m(s)&&!s.interactive&&(s=null),n!==s&&(m(n)&&(n.hovering=!1),m(s)?(s.hovering=!0,this._hoveredManipulators.set(t,{key:_(o)})):this._hoveredManipulators.delete(t),this._onFocusChange(r))}_findManipulatorByKey(e,t){return this._findToolAndManipulatorByKey(e,t,Te)?Te.manipulator:null}_findToolAndManipulatorByKey(e,t,i){return y(e)?null:(i.tool=null,i.manipulator=null,t((t=>{if(t!==e.tool||null==t.manipulators||!be(t))return!1;const r=t.manipulators.findById(e.manipulatorId);return!!m(r)&&(i.manipulator=r,i.tool=t,!0)})),i.manipulator?i:null)}}function je(e){return"mouse"===e}function Me(e){return"mouse"!==e.pointerType||0===e.button}const Te={manipulator:null,tool:null},Re=d.getLogger("esri.views.ToolViewManager");let Ve=class extends l{constructor(e){super(e),this._manipulatorState=new ke,this.tools=new o,this.cursor=null,this._forEachTool=e=>{for(const t of this.tools.items)if(e(t))return}}initialize(){var e;this.handles.add([this.view.on(Y,(e=>{this._handleInputEvent(e)}),X.TOOL),...(e=this.tools,[e.on("before-add",(t=>{const i=t.item;if(null==i||e.includes(i))return we.warn("Tool is either already in the list of tools or tool is `null`. Not adding tool."),void t.preventDefault();i.onAdd()})),e.on("after-remove",(e=>{const t=e.item;t.visible=!1,t.active&&(t.view.activeTool=null),t.destroy()}))]),this.tools.on("before-remove",(({item:e})=>{this._manipulatorState.clearPointers(e,this._forEachTool)})),this.tools.on("change",(()=>{this._refreshToolWatchers()}))])}destroy(){this.detach(),this.handles.removeAll()}set activeTool(e){if(m(e)&&!this.view.ready)return void Re.error("Cannot set active tool while view is not ready.");if(e===this.activeTool)return;const t=this.activeTool;this._set("activeTool",e),m(t)&&t.deactivate(),m(e)&&e.activate(),this._removeIncompleteTools(e);const i=y(this.activeTool);for(const e of this.tools){e.setEditableFlag(ee.MANAGER,i||e===this.activeTool);const t=be(e);!i&&t||this._manipulatorState.clearPointers(e,this._forEachTool,!t)}this._updateCursor()}get updating(){return this.updatingHandles.updating||this.tools.some((e=>e.updating))||(this.textures?.updating??!1)}attach(){"3d"===this.view.type?(this._set("textures",new ve(this.view._stage,this.view.resourceController.scheduler)),this.handles.add([I((()=>{const{state:e}=this.view;return"camera"in e&&e.camera}),(()=>{this._forEachManipulator((e=>{null!=e.onViewChange&&e.onViewChange()}))})),this.view.elevationProvider.on("elevation-change",(e=>{this._forEachManipulator((t=>{null!=t.onElevationChange&&t.onElevationChange(e)}))})),c((()=>this._set("textures",v(this.textures))))],"attached")):this.handles.add(I((()=>this.view.extent),(()=>{this._forEachManipulator((e=>{null!=e.onViewChange&&e.onViewChange()}))})))}detach(){m(this.activeTool)&&(this.activeTool=null),this.tools.removeAll(),this.handles.remove("attached")}_forEachManipulator(e){this._forEachTool((t=>{t.manipulators&&t.manipulators.forEach((({manipulator:i})=>e(i,t)))}))}_handleInputEvent(e){let t=!1;const i={...e,stopPropagation:()=>{t=!0,e.stopPropagation()}};m(this.activeTool)?this.activeTool.handleInputEvent&&this.activeTool.handleInputEvent(i):this._forEachTool((e=>{!t&&e.visible&&e.handleInputEvent(i)})),!t&&"key-down"===e.type&&"Escape"===e.key&&this.activeTool&&(e.stopPropagation(),this.activeTool=null),this._manipulatorState.handleInputEvent(i,{forEachTool:this._forEachTool,activeTool:this.activeTool,setActiveTool:e=>{this.activeTool=e},view:this.view}),!t&&m(this.activeTool)&&this.activeTool.handleInputEventAfter(i),this._manipulatorState.handleHoverEvent(i,this._forEachTool),this._updateCursor()}_refreshToolWatchers(){this.handles.remove("tools"),this._forEachTool((e=>{if(e instanceof r){const t=I((()=>[e.cursor,e.visible,e.editable]),(()=>{be(e)||this._manipulatorState.clearPointers(e,this._forEachTool),this._updateCursor()}));this.handles.add(t,"tools")}e.manipulators&&this.handles.add(e.manipulators.on("change",(t=>{t.removed.forEach((({id:t})=>{this._manipulatorState.clearPointers(e,this._forEachTool,!0,t)})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()})),"tools")})),this._manipulatorState.updateHoveredStateFromKnownPointers(this._forEachTool),this._updateCursor()}_updateCursor(){const e=this._manipulatorState.cursor;let t=e;this._forEachTool((i=>!(!m(i.cursor)||!i.visible||!y(e)&&i.preferManipulatorCursor||(t=i.cursor,0)))),this._get("cursor")!==t&&this._set("cursor",t)}_removeIncompleteTools(e){this.tools.filter((t=>(y(e)||t!==e)&&!t.created&&t.removeIncompleteOnCancel)).forEach((e=>{this.tools.remove(e)}))}};e([A({constructOnly:!0,nonNullable:!0})],Ve.prototype,"view",void 0),e([A({readOnly:!0,nonNullable:!0})],Ve.prototype,"textures",void 0),e([A({value:null})],Ve.prototype,"activeTool",null),e([A({readOnly:!0,type:o})],Ve.prototype,"tools",void 0),e([A({readOnly:!0})],Ve.prototype,"cursor",void 0),e([A({readOnly:!0})],Ve.prototype,"updating",null),Ve=e([D("esri.views.ToolViewManager")],Ve);const Se=Ve;let Ee,Ie=null;async function Ce(e){Ie||(Ie=import("../chunks/geometryServiceUtils.js").then((e=>Ee=e))),await Ie,T(e)}async function xe(e,t,i,r){if(!e)return null;const o=e.spatialReference;return pe()||he(o,t)?ce(e,t):Ee?Ee.projectGeometry(e,t,i,r):(await Promise.race([Ce(r),ue(r)]),xe(e,t,i,r))}let Le=class extends r{constructor(e){super(e),this.required={tileInfo:!1,heightModelInfo:!1,extent:!1},this.defaultSpatialReference=null,this.userSpatialReference=null,this.sourcePreloadCount=10,this.priorityCollection=null,this.requiresExtentInSpatialReference=!0,this.suspended=!1,this._projectExtentTask={task:null,input:null,output:null,spatialReference:null}}destroy(){this._projectExtentTask.task&&(this._projectExtentTask.task=w(this._projectExtentTask.task)),this._set("map",null)}get ready(){return!this._spatialReferenceTask.updating&&!this._tileInfoTask.updating&&!this._extentTask.updating}get heightModelInfoReady(){return!this._heightModelInfoTask.updating}get spatialReference(){return m(this.userSpatialReference)?this.userSpatialReference:_(this._spatialReferenceTask.spatialReference)}get extent(){return _(this._extentTask.extent)}get heightModelInfo(){return _(this._heightModelInfoTask.heightModelInfo)}get vcsWkid(){return _(this._heightModelInfoTask.vcsWkid)}get latestVcsWkid(){return _(this._heightModelInfoTask.latestVcsWkid)}get viewingMode(){return y(this.userSpatialReference)||this.userSpatialReference.equals(_(this._spatialReferenceTask.spatialReference))?_(this._spatialReferenceTask.viewingMode):null}get tileInfo(){return _(this._tileInfoTask.tileInfo)}get mapCollections(){const e=this.map?.(),t=[];return m(this.priorityCollection)&&t.push(this.priorityCollection),t.push({parent:e?.basemap,layers:e?.basemap?.baseLayers},{layers:e?.layers},{parent:e?.ground,layers:e?.ground?.layers},{parent:e?.basemap,layers:e?.basemap?.referenceLayers}),t}get _allLayers(){return this._collectLayers(this.mapCollections)}get _spatialReferenceTask(){if(this.suspended)return this._get("_spatialReferenceTask")??{updating:!1};const{layers:e,updating:t}=this._allLayers;let i=null;for(const t of e){const e=this._getSupportedSpatialReferences(t);if(e.length>0){const t=this._narrowDownSpatialReferenceCandidates(i,e);m(t)&&(i=t)}if(m(i)&&1===i.length)break}if(t&&(y(i)||1!==i.length))return{updating:!0};const r=this._pickSpatialReferenceCandidate(i);return{spatialReference:m(r)?r.spatialReference:null,viewingMode:m(r)?r.viewingMode:null,updating:!1}}get _tileInfoTask(){if(!this.required.tileInfo)return this._get("_tileInfoTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const{layers:e,updating:t}=this._collectLayers([{parent:this.map?.()?.basemap,layers:this.map?.()?.basemap?.baseLayers},{layers:this.map?.()?.layers}]);if(e&&e.length>0&&"tileInfo"in e[0]){const t=e[0].tileInfo;return{tileInfo:t&&t.spatialReference.equals(this.spatialReference)?t:null,updating:!1}}return{updating:t}}get _heightModelInfoTask(){if(!this.required.heightModelInfo||this.suspended&&this._get("_heightModelInfoTask")?.heightModelInfo)return this._get("_heightModelInfoTask")??{updating:!1};const{layers:e,updating:t}=this._allLayers;for(const t of e)if(ae(t)){const e=ne(t);if(e)return{heightModelInfo:e,vcsWkid:t.spatialReference?.vcsWkid,latestVcsWkid:t.spatialReference?.latestVcsWkid,updating:!1}}return{updating:t}}get _extentCandidatesTask(){if(this.suspended||!this.required.extent)return this._get("_extentCandidatesTask")??{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const e=this._allLayers,t=e.updating,i=[];for(const t of e.layers){const e="fullExtents"in t&&t.fullExtents||(m(t.fullExtent)?[t.fullExtent]:[]),r=this.requiresExtentInSpatialReference?null:e[0],o=e.find((e=>e.spatialReference.equals(this.spatialReference)))??r;if(o)return{candidates:[{extent:o,layer:t}],updating:!1};if(this._getSupportedSpatialReferences(t).length>0)for(const r of e)i.push({extent:r,layer:t})}return{candidates:i,updating:t}}get _extentTask(){const{candidates:e,updating:t}=this._extentCandidatesTask;if(t)return{updating:t};if(y(e)||0===e.length)return{updating:!1};if(!this.spatialReference)return{updating:this._spatialReferenceTask.updating};const i=this._pickExtentCandidate(e),r=this.spatialReference;return i.extent.equals(this._projectExtentTask.input)&&r.equals(this._projectExtentTask.spatialReference)?{extent:this._projectExtentTask.output,updating:m(this._projectExtentTask.task)&&!this._projectExtentTask.task.finished}:(m(this._projectExtentTask.task)&&(this._projectExtentTask.task=w(this._projectExtentTask.task)),this._projectExtentTask={input:i.extent.clone(),output:null,spatialReference:r.clone(),task:R((async e=>{try{const t=await xe(i.extent,r,i.layer.portalItem,e);this._projectExtentTask={...this._projectExtentTask,task:null,output:t}}catch(t){if(V(e))return;this._projectExtentTask={...this._projectExtentTask,task:null}}}))},{updating:!0})}_narrowDownSpatialReferenceCandidates(e,t){if(y(e))return t;const i=[],r=(e,t)=>m(e)?m(t)?e===t&&e:e:t;for(const o of e)for(const e of t){if(!o.spatialReference.equals(e.spatialReference))continue;const t=r(o.viewingMode,e.viewingMode);if(!1!==t){i.push({spatialReference:o.spatialReference,viewingMode:t});break}}return i.length>0?i:null}_pickSpatialReferenceCandidate(e){const t=this.defaultSpatialReference;return y(e)||e.length<1?m(t)?{spatialReference:t,viewingMode:null}:null:(m(t)&&e.length>1&&e.some((({spatialReference:e})=>e.equals(t)))&&(e=e.filter((({spatialReference:e})=>e.equals(t)))),e.length>1&&e.some((({viewingMode:e})=>e!==le.Local))&&(e=e.filter((({viewingMode:e})=>e!==le.Local))),e[0])}_getSupportedSpatialReferences(e){const t="supportedSpatialReferences"in e&&e.supportedSpatialReferences||(e.spatialReference?[e.spatialReference]:[]);if(0===t.length)return[];const i=[];for(const r of t){const t=this.getSpatialReferenceSupport({spatialReference:r,layer:e});if(m(t)){const e=m(t.constraints)?t.constraints:[{spatialReference:r,viewingMode:null}];for(const{spatialReference:t,viewingMode:r}of e)(!this.requiresExtentInSpatialReference||y(this.userSpatialReference)||t.equals(this.userSpatialReference))&&i.push({spatialReference:t,viewingMode:r})}}return i}_pickExtentCandidate(e){const t=this.spatialReference;return e.find((({extent:e})=>t.equals(e.spatialReference)))||e[0]}_collectLayers(e){if("loaded"!==this._loadMaybe(this.map?.()))return{layers:[],updating:!0};const t={layers:[],preloading:-1,updating:!1};for(const i of e)if(this._collectCollection(i,t),t.preloading===this.sourcePreloadCount)break;return{layers:t.layers,updating:t.updating}}_collectCollection(e,t){if(e.layers){switch(this._loadMaybe(e.parent)){case"loading":return t.updating=!0,void++t.preloading;case"failed":return}for(const i of e.layers){switch(this._loadMaybe(i)){case"failed":continue;case"loading":t.updating=!0,++t.preloading;break;case"loaded":t.updating||t.layers.push(i),"layers"in i&&this._collectCollection({layers:i.layers},t)}if(t.preloading===this.sourcePreloadCount)break}}}_loadMaybe(e){return e&&"loadStatus"in e?"not-loaded"===e.loadStatus?(e.load(),"loading"):e.loadStatus:"loaded"}};var Pe;e([A()],Le.prototype,"required",void 0),e([A({constructOnly:!0})],Le.prototype,"map",void 0),e([A({constructOnly:!0})],Le.prototype,"getSpatialReferenceSupport",void 0),e([A()],Le.prototype,"defaultSpatialReference",void 0),e([A()],Le.prototype,"userSpatialReference",void 0),e([A()],Le.prototype,"sourcePreloadCount",void 0),e([A()],Le.prototype,"priorityCollection",void 0),e([A()],Le.prototype,"requiresExtentInSpatialReference",void 0),e([A()],Le.prototype,"suspended",void 0),e([A({readOnly:!0})],Le.prototype,"ready",null),e([A({readOnly:!0})],Le.prototype,"heightModelInfoReady",null),e([A({readOnly:!0})],Le.prototype,"spatialReference",null),e([A({readOnly:!0})],Le.prototype,"extent",null),e([A({readOnly:!0})],Le.prototype,"heightModelInfo",null),e([A({readOnly:!0})],Le.prototype,"vcsWkid",null),e([A({readOnly:!0})],Le.prototype,"latestVcsWkid",null),e([A({readOnly:!0})],Le.prototype,"viewingMode",null),e([A({readOnly:!0})],Le.prototype,"tileInfo",null),e([A({readOnly:!0})],Le.prototype,"mapCollections",null),e([A({readOnly:!0})],Le.prototype,"_allLayers",null),e([A({readOnly:!0})],Le.prototype,"_spatialReferenceTask",null),e([A({readOnly:!0})],Le.prototype,"_tileInfoTask",null),e([A({readOnly:!0})],Le.prototype,"_heightModelInfoTask",null),e([A({readOnly:!0})],Le.prototype,"_extentCandidatesTask",null),e([A()],Le.prototype,"_extentTask",null),e([A()],Le.prototype,"_projectExtentTask",void 0),Le=e([D("esri.views.support.DefaultsFromMap")],Le);const Fe=d.getLogger("esri.views.View");let Oe=Pe=class extends(h(n.EventedMixin(b(r)))){constructor(e){super(e),this._userSpatialReference=null,this._cursor=null,this.allLayerViews=new s({getCollections:()=>[this.basemapView?.baseLayerViews,this.groundView?.layerViews,this.layerViews,this.basemapView?.referenceLayerViews],getChildrenFunction:e=>e.layerViews}),this.groundView=null,this.animation=null,this.basemapView=null,this.fatalError=null,this.extent=null,this.graphics=new q,this.analyses=new ye,this.navigating=!1,this.typeSpecificPreconditionsReady=!0,this.layerViews=new o,this.magnifier=new $,this.padding={left:0,top:0,right:0,bottom:0},this.ready=!1,this.spatialReferenceWarningDelay=1e3,this.supportsGround=!0,this.timeExtent=null,this.type=null,this.scale=null,this.updating=!1,this.initialExtentRequired=!0,this.input=new oe,this.navigation=new se,this.layerViewManager=null,this.analysisViewManager=null,this.isHeightModelInfoRequired=!1,this.width=null,this.height=null,this.resizing=!1,this.suspended=!1,this.viewEvents=new Z(this),this.persistableViewModels=new o,this._isValid=!1,this._readyCycleForced=!1,this.handles.add(I((()=>this.preconditionsReady),(e=>{e?(this._currentSpatialReference=this.spatialReference,Pe.views.add(this)):(this._currentSpatialReference=null,Pe.views.remove(this)),this.notifyChange("spatialReference"),!e&&this.ready?(this.layerViewManager?.clear(),this.toolViewManager?.detach(),m(this.analysisViewManager)&&this.analysisViewManager.detach(),this._teardown()):e&&!this.ready&&(this._startup(),m(this.analysisViewManager)&&this.analysisViewManager.attach(),this.toolViewManager.attach())}),P))}initialize(){this.addResolvingPromise(this.validate().then((()=>(this._isValid=!0,x((()=>this.ready)))))),this.basemapView=new N({view:this}),this.layerViewManager=new _e({view:this,layerViewImporter:{importLayerView:e=>this.importLayerView(e),hasLayerViewModule:e=>this.hasLayerViewModule(e)},supportsGround:this.supportsGround}),this.toolViewManager=new Se({view:this}),this._setupSpatialReferenceLogger(),this.handles.add([I((()=>this.initialExtentRequired),(e=>this.defaultsFromMap.required={...this.defaultsFromMap.required,extent:e}),{sync:!0,initial:!0}),I((()=>this.ready),(e=>{this.defaultsFromMap&&(this.defaultsFromMap.suspended=e,this.defaultsFromMap.userSpatialReference=e?this.spatialReference:this._userSpatialReference)}),{sync:!0}),I((()=>this._userSpatialReference),(e=>{this.defaultsFromMap&&(this.defaultsFromMap.userSpatialReference=e)}),{sync:!0,initial:!0})])}_setupSpatialReferenceLogger(){let e=null;this.handles.add([I((()=>this.defaultsFromMap?.ready),(t=>{const i=this.map?.allLayers.length>0;if(t&&!this.spatialReference&&i){if(m(e))return;const t=c((()=>e=w(e)));e=R((async t=>{try{await S(this.spatialReferenceWarningDelay,null,t)}catch{return}finally{e=null}Fe.warn("#spatialReference","no spatial reference could be derived from the currently added map layers")})),this.handles.add(t,"spatial-reference-logger-task")}else this.handles.remove("spatial-reference-logger-task")}),{sync:!0})])}destroy(){if(this.destroyed)return;this.viewEvents.destroy(),this.allLayerViews.destroy(),this.navigation&&(this.navigation.destroy(),this._set("navigation",null)),this.graphics=v(this.graphics),this.analyses=v(this.analyses),this.handles.remove("defaultsFromMap"),this.defaultsFromMap.destroy(),this._set("defaultsFromMap",null),v(this.analysisViewManager),this.toolViewManager=v(this.toolViewManager),this.layerViewManager=v(this.layerViewManager),this.basemapView=v(this.basemapView),this.invalidate(),this._emitter.clear(),this.handles.removeAll();const e=this.map;this.map=null,e?.destroy()}_startup(){this._set("ready",!0)}_teardown(){this._set("ready",!1)}whenReady(){return Promise.resolve(this)}toMap(){return Fe.error("#toMap()","Not implemented on this instance of View"),null}get _defaultsFromMapSettings(){return{}}get defaultsFromMap(){return new Le({required:{tileInfo:!1,heightModelInfo:!1,extent:!1},map:()=>this.map,getSpatialReferenceSupport:e=>this.getSpatialReferenceSupport(e),...this._defaultsFromMapSettings})}get heightModelInfo(){return this.getDefaultHeightModelInfo()}get interacting(){return this.navigating}get preconditionsReady(){return!(this.fatalError||!this._isValid||this._readyCycleForced||!this.map||u.isLoadable(this.map)&&!this.map.loaded||0===this.width||0===this.height||!this.spatialReference||!this._validateSpatialReference(this.spatialReference)||!this._currentSpatialReference&&!this.defaultsFromMap?.ready||!this.typeSpecificPreconditionsReady)}set map(e){e!==this._get("map")&&(e?.destroyed&&(Fe.warn("#map","The provided map is already destroyed",{map:e}),e=null),u.isLoadable(e)&&e.load().catch((()=>{})),this.initialized&&(this.forceReadyCycle(),this._currentSpatialReference=null),this._set("map",e))}get spatialReference(){let e=this._userSpatialReference||this._currentSpatialReference||this.getDefaultSpatialReference()||null;return e&&this.defaultsFromMap?.required?.heightModelInfo&&(e=e.clone(),e.vcsWkid=this.defaultsFromMap.vcsWkid,e.latestVcsWkid=this.defaultsFromMap.latestVcsWkid),e}set spatialReference(e){const t=!z(e,this._get("spatialReference"));this._set("_userSpatialReference",e),t&&(this._set("spatialReference",e),this._spatialReferenceChanged(e))}_spatialReferenceChanged(e){}get stationary(){return!this.animation&&!this.navigating&&!this.resizing}get initialExtent(){return this.defaultsFromMap?.extent}get cursor(){const e=this.toolViewManager?this.toolViewManager.cursor:null;return m(e)?e:this._cursor||"default"}set cursor(e){this._cursor=e,this.notifyChange("cursor")}get size(){return[this.width,this.height]}whenLayerView(e){return this.layerViewManager.whenLayerView(e)}getDefaultSpatialReference(){return this.defaultsFromMap?.spatialReference}getDefaultHeightModelInfo(){return(this.map&&"heightModelInfo"in this.map?this.map.heightModelInfo:void 0)??this.defaultsFromMap?.heightModelInfo??null}importLayerView(e){throw new a("importLayerView() not implemented")}hasLayerViewModule(e){return!1}async validate(){}invalidate(){this._isValid=!1}getSpatialReferenceSupport(){return{constraints:null}}_validateSpatialReference(e){return m(this.getSpatialReferenceSupport({spatialReference:e}))}when(e,t){return this.isResolved()&&!this.ready&&Fe.warn("#when()","Calling view.when() while the view is no longer ready but was already resolved once will resolve immediately. Use reactiveUtils.whenOnce(() => view.ready).then(...) instead."),super.when(e,t)}forceReadyCycle(){this.ready&&(L((()=>!1===this.preconditionsReady),(()=>this._readyCycleForced=!1),{once:!0}),this._readyCycleForced=!0)}addAndActivateTool(e){this.toolViewManager.tools.add(e),this.activeTool=e}tryFatalErrorRecovery(){this.fatalError=null}};Oe.views=new o,e([A()],Oe.prototype,"_userSpatialReference",void 0),e([F("toolViewManager.activeTool")],Oe.prototype,"activeTool",void 0),e([A({readOnly:!0})],Oe.prototype,"allLayerViews",void 0),e([A()],Oe.prototype,"groundView",void 0),e([A()],Oe.prototype,"animation",void 0),e([A()],Oe.prototype,"basemapView",void 0),e([A({readOnly:!0})],Oe.prototype,"_defaultsFromMapSettings",null),e([A()],Oe.prototype,"defaultsFromMap",null),e([A()],Oe.prototype,"fatalError",void 0),e([A({type:K})],Oe.prototype,"extent",void 0),e([A(B(q,"graphics"))],Oe.prototype,"graphics",void 0),e([A(B(ye,"analyses"))],Oe.prototype,"analyses",void 0),e([A({readOnly:!0,type:W})],Oe.prototype,"heightModelInfo",null),e([A({readOnly:!0})],Oe.prototype,"interacting",null),e([A({readOnly:!0})],Oe.prototype,"navigating",void 0),e([A({readOnly:!0,dependsOn:["fatalError","_isValid","_readyCycleForced","map","map.loaded?","width","height","spatialReference","_currentSpatialReference","defaultsFromMap.ready","typeSpecificPreconditionsReady"]})],Oe.prototype,"preconditionsReady",null),e([A({readOnly:!0})],Oe.prototype,"typeSpecificPreconditionsReady",void 0),e([A({type:o,readOnly:!0})],Oe.prototype,"layerViews",void 0),e([A({type:$})],Oe.prototype,"magnifier",void 0),e([A({value:null,type:t})],Oe.prototype,"map",null),e([A()],Oe.prototype,"padding",void 0),e([A({readOnly:!0})],Oe.prototype,"ready",void 0),e([A({type:G})],Oe.prototype,"spatialReference",null),e([A()],Oe.prototype,"spatialReferenceWarningDelay",void 0),e([A()],Oe.prototype,"stationary",null),e([A({readOnly:!0})],Oe.prototype,"supportsGround",void 0),e([A({type:i})],Oe.prototype,"timeExtent",void 0),e([F("toolViewManager.tools")],Oe.prototype,"tools",void 0),e([A()],Oe.prototype,"toolViewManager",void 0),e([A({readOnly:!0})],Oe.prototype,"type",void 0),e([A({type:Number})],Oe.prototype,"scale",void 0),e([A({readOnly:!0})],Oe.prototype,"updating",void 0),e([A({readOnly:!0})],Oe.prototype,"initialExtentRequired",void 0),e([A({readOnly:!0})],Oe.prototype,"initialExtent",null),e([A()],Oe.prototype,"cursor",null),e([A({readOnly:!0})],Oe.prototype,"input",void 0),e([A({type:se,nonNullable:!0})],Oe.prototype,"navigation",void 0),e([A()],Oe.prototype,"layerViewManager",void 0),e([A()],Oe.prototype,"analysisViewManager",void 0),e([A()],Oe.prototype,"width",void 0),e([A()],Oe.prototype,"height",void 0),e([A({readOnly:!0})],Oe.prototype,"resizing",void 0),e([A({value:null,readOnly:!0})],Oe.prototype,"size",null),e([A({readOnly:!0})],Oe.prototype,"suspended",void 0),e([A({readOnly:!0})],Oe.prototype,"viewEvents",void 0),e([A({readOnly:!0})],Oe.prototype,"persistableViewModels",void 0),e([A()],Oe.prototype,"_isValid",void 0),e([A()],Oe.prototype,"_readyCycleForced",void 0),e([A()],Oe.prototype,"_currentSpatialReference",void 0),Oe=Pe=e([D("esri.views.View")],Oe);const Ae=Oe;export{ye as A,ve as T,Ae as default};
