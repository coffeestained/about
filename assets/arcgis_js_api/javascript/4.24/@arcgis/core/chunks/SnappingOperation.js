/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{_ as t}from"./tslib.es6.js";import s from"../core/Accessor.js";import{i as r,p as o,r as e,a}from"./maybe.js";import{debounce as i}from"../core/promiseUtils.js";import{property as n}from"../core/accessorSupport/decorators/property.js";import"../core/lang.js";import"./ensureType.js";import{subclass as p}from"../core/accessorSupport/decorators/subclass.js";import{T as l,I as c}from"./Scheduler.js";let h=class extends s{constructor(t){super(t),this.stagedPoint=null,this._abortController=null,this._snap=i((async(t,s,r,o)=>{const e=await this._frameTask.schedule((()=>s.snap(t,r,o)),o);e.valid&&await this._frameTask.schedule((()=>{this.stagedPoint=e.apply(),t!==this._snapMapPoint&&(this.stagedPoint=s.update(this._snapMapPoint,r))}),o)}))}initialize(){const t="3d"===this.view.type?this.view?.resourceController?.scheduler:null;this._frameTask=r(t)?t.registerTask(l.SNAPPING):c}destroy(){this._abortController=o(this._abortController),this._frameTask=e(this._frameTask)}async snap(t,s,r){return this.stagedPoint=s.update(t,r),this._snapMapPoint=t,a(this._abortController)&&(this._abortController=new AbortController),this._snap(t,s,r,this._abortController.signal)}abort(){this._abortController=o(this._abortController)}};t([n({constructOnly:!0})],h.prototype,"view",void 0),t([n()],h.prototype,"stagedPoint",void 0),h=t([p("esri.views.interactive.snapping.SnappingOperation")],h);export{h as S};
