/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{i as e,a as t,b as i,t as s,I as n,c as u,d as r,e as a,f as o,g as c,h as l,j as h,k as D,l as m}from"./languageUtils.js";import d from"../geometry/Geometry.js";import p from"../geometry/Point.js";import{fromJSON as C}from"../geometry/support/jsonUtils.js";import{c as E}from"./featureConversionUtils.js";import{i as A,u as x}from"./maybe.js";function f(s,n=!1){if(null==s)return null;if(t(s))return o(s);if(e(s))return c(s);if(i(s))return l(s);if(h(s))return D(s);if(m(s)){const e=[];for(const t of s)e.push(f(t,n));return e}const u=new F;u.immutable=!1;for(const e of Object.keys(s)){const t=s[e];void 0!==t&&u.setField(e,f(t,n))}return u.immutable=n,u}class F{constructor(e){this.declaredClass="esri.arcade.Dictionary",this.attributes=null,this.plain=!1,this.immutable=!0,this.attributes=e instanceof F?e.attributes:null==e?{}:e}field(e){const t=e.toLowerCase(),i=this.attributes[e];if(void 0!==i)return i;for(const e in this.attributes)if(e.toLowerCase()===t)return this.attributes[e];throw new Error("Field not Found : "+e)}setField(e,t){if(this.immutable)throw new Error("Dictionary is Immutable");const i=e.toLowerCase();if(void 0===this.attributes[e]){for(const e in this.attributes)if(e.toLowerCase()===i)return void(this.attributes[e]=t);this.attributes[e]=t}else this.attributes[e]=t}hasField(e){const t=e.toLowerCase();if(void 0!==this.attributes[e])return!0;for(const e in this.attributes)if(e.toLowerCase()===t)return!0;return!1}keys(){let e=[];for(const t in this.attributes)e.push(t);return e=e.sort(),e}castToText(){let u="";for(const r in this.attributes){""!==u&&(u+=",");const a=this.attributes[r];null==a?u+=JSON.stringify(r)+":null":e(a)||t(a)||i(a)?u+=JSON.stringify(r)+":"+JSON.stringify(a):a instanceof d||a instanceof n||a instanceof Array?u+=JSON.stringify(r)+":"+s(a):a instanceof Date?u+=JSON.stringify(r)+":"+JSON.stringify(a):null!==a&&"object"==typeof a&&void 0!==a.castToText&&(u+=JSON.stringify(r)+":"+a.castToText())}return"{"+u+"}"}static convertObjectToArcadeDictionary(e,t=!0){const i=new F;i.immutable=!1;for(const t in e){const s=e[t];void 0!==s&&i.setField(t.toString(),f(s))}return i.immutable=t,i}static convertJsonToArcade(e,t=!1){return f(e,t)}castAsJson(e=null){const t={};for(let i in this.attributes){const s=this.attributes[i];void 0!==s&&(e?.keyTranslate&&(i=e.keyTranslate(i)),t[i]=u(s,e))}return t}async castDictionaryValueAsJsonAsync(e,t,i,s=null,n){const u=await r(i,s,n);return e[t]=u,u}async castAsJsonAsync(e=null,t=null){const i={},s=[];for(let n in this.attributes){const r=this.attributes[n];t?.keyTranslate&&(n=t.keyTranslate(n)),void 0!==r&&(a(r)||r instanceof d||r instanceof Date?i[n]=u(r,t):s.push(this.castDictionaryValueAsJsonAsync(i,n,r,e,t)))}return s.length>0&&await Promise.all(s),i}}class y{constructor(){this.arcadeDeclaredClass="esri.arcade.Feature",this._optimizedGeomDefinition=null,this._geometry=null,this.attributes=null,this._layer=null,this._datesfixed=!0,this.immutable=!0,this._datefields=null,this.immutable=!0}static createFromGraphic(e){const t=new y;return t._geometry=A(e.geometry)?e.geometry:null,void 0===e.attributes||null===e.attributes?t.attributes={}:t.attributes=e.attributes,e._sourceLayer?(t._layer=e._sourceLayer,t._datesfixed=!1):e._layer?(t._layer=e._layer,t._datesfixed=!1):e.layer&&"fields"in e.layer?(t._layer=e.layer,t._datesfixed=!1):e.sourceLayer&&"fields"in e.sourceLayer&&(t._layer=e.sourceLayer,t._datesfixed=!1),t}static createFromArcadeFeature(e){const t=new y;return t._datesfixed=e._datesfixed,t.attributes=e.attributes,t._geometry=e._geometry,t._optimizedGeomDefinition=e._optimizedGeomDefinition,e._layer&&(t._layer=e._layer),t}static createFromOptimisedFeature(e,t,i){const s=new y;return s._geometry=e.geometry?{geometry:e.geometry}:null,s._optimizedGeomDefinition=i,s.attributes=e.attributes||{},s._layer=t,s._datesfixed=!1,s}static createFromArcadeDictionary(e){const t=new y;return t.attributes=e.field("attributes"),null!==t.attributes&&t.attributes instanceof F?(t.attributes=t.attributes.attributes,null===t.attributes&&(t.attributes={})):t.attributes={},t._geometry=e.field("geometry"),null!==t._geometry&&(t._geometry instanceof F?t._geometry=y.parseGeometryFromDictionary(t._geometry):t._geometry instanceof d||(t._geometry=null)),t}static createFromGraphicLikeObject(e,t,i=null){const s=new y;return null===t&&(t={}),s.attributes=t,s._geometry=A(e)?e:null,s._layer=i,s._layer&&(s._datesfixed=!1),s}repurposeFromGraphicLikeObject(e,t,i=null){null===t&&(t={}),this.attributes=t,this._geometry=e||null,this._layer=i,this._layer?this._datesfixed=!1:this._datesfixed=!0}castToText(){let u="";!1===this._datesfixed&&this._fixDates();for(const r in this.attributes){""!==u&&(u+=",");const a=this.attributes[r];null==a?u+=JSON.stringify(r)+":null":e(a)||t(a)||i(a)?u+=JSON.stringify(r)+":"+JSON.stringify(a):a instanceof d||a instanceof n||a instanceof Array?u+=JSON.stringify(r)+":"+s(a):a instanceof Date?u+=JSON.stringify(r)+":"+JSON.stringify(a):null!==a&&"object"==typeof a&&void 0!==a.castToText&&(u+=JSON.stringify(r)+":"+a.castToText())}return'{"geometry":'+(null===this.geometry()?"null":s(this.geometry()))+',"attributes":{'+u+"}}"}_fixDates(){if(null!==this._datefields)return this._datefields.length>0&&this._fixDateFields(this._datefields),void(this._datesfixed=!0);const e=[];for(let t=0;t<this._layer.fields.length;t++){const i=this._layer.fields[t];"date"!==i.type&&"esriFieldTypeDate"!==i.type||e.push(i.name)}this._datefields=e,e.length>0&&this._fixDateFields(e),this._datesfixed=!0}_fixDateFields(e){this.attributes={...this.attributes};for(let t=0;t<e.length;t++){let i=this.attributes[e[t]];if(null===i);else if(void 0===i){for(const s in this.attributes)if(s.toLowerCase()===e[t].toLowerCase()){i=this.attributes[s],null!==i&&(i instanceof Date||(this.attributes[s]=new Date(i)));break}}else i instanceof Date||(this.attributes[e[t]]=new Date(i))}}geometry(){return null===this._geometry||this._geometry instanceof d||(this._optimizedGeomDefinition?(this._geometry=x(C(E(this._geometry,this._optimizedGeomDefinition.geometryType,this._optimizedGeomDefinition.hasZ,this._optimizedGeomDefinition.hasM))),this._geometry.spatialReference=this._optimizedGeomDefinition.spatialReference):this._geometry=x(C(this._geometry))),this._geometry}field(e){!1===this._datesfixed&&this._fixDates();const t=this.attributes[e];if(void 0!==t)return t;const i=e.toLowerCase();for(const e in this.attributes)if(e.toLowerCase()===i)return this.attributes[e];if(this._hasFieldDefinition(i))return null;throw new Error("Field not Found : "+e)}_hasFieldDefinition(e){if(null===this._layer)return!1;for(let t=0;t<this._layer.fields.length;t++)if(this._layer.fields[t].name.toLowerCase()===e)return!0;return!1}setField(e,t){if(this.immutable)throw new Error("Feature is Immutable");if(!1===a(t))throw new Error("Illegal Value Assignment to Feature");const i=e.toLowerCase();if(void 0===this.attributes[e]){for(const e in this.attributes)if(e.toLowerCase()===i)return void(this.attributes[e]=t);this.attributes[e]=t}else this.attributes[e]=t}hasField(e){const t=e.toLowerCase();if(void 0!==this.attributes[e])return!0;for(const e in this.attributes)if(e.toLowerCase()===t)return!0;return!!this._hasFieldDefinition(t)}keys(){let e=[];const t={};for(const i in this.attributes)e.push(i),t[i.toLowerCase()]=1;if(null!==this._layer)for(let i=0;i<this._layer.fields.length;i++){const s=this._layer.fields[i];1!==t[s.name.toLowerCase()]&&e.push(s.name)}return e=e.sort(),e}static parseGeometryFromDictionary(e){const t=y._convertDictionaryToJson(e,!0);return void 0!==t.hasm&&(t.hasM=t.hasm,delete t.hasm),void 0!==t.hasz&&(t.hasZ=t.hasz,delete t.hasz),void 0!==t.spatialreference&&(t.spatialReference=t.spatialreference,delete t.spatialreference),void 0!==t.rings&&(t.rings=this._fixPathArrays(t.rings,!0===t.hasZ,!0===t.hasZ)),void 0!==t.paths&&(t.paths=this._fixPathArrays(t.paths,!0===t.hasZ,!0===t.hasM)),void 0!==t.points&&(t.points=this._fixPointArrays(t.points,!0===t.hasZ,!0===t.hasM)),C(t)}static _fixPathArrays(e,t,i){const s=[];if(e instanceof Array)for(let n=0;n<e.length;n++)s.push(this._fixPointArrays(e[n],t,i));else if(e instanceof n)for(let n=0;n<e.length();n++)s.push(this._fixPointArrays(e.get(n),t,i));return s}static _fixPointArrays(e,t,i){const s=[];if(e instanceof Array)for(let u=0;u<e.length;u++){const r=e[u];r instanceof p?t&&i?s.push([r.x,r.y,r.z,r.m]):t?s.push([r.x,r.y,r.z]):i?s.push([r.x,r.y,r.m]):s.push([r.x,r.y]):r instanceof n?s.push(r.toArray()):s.push(r)}else if(e instanceof n)for(let u=0;u<e.length();u++){const r=e.get(u);r instanceof p?t&&i?s.push([r.x,r.y,r.z,r.m]):t?s.push([r.x,r.y,r.z]):i?s.push([r.x,r.y,r.m]):s.push([r.x,r.y]):r instanceof n?s.push(r.toArray()):s.push(r)}return s}static _convertDictionaryToJson(e,t=!1){const i={};for(const s in e.attributes){let n=e.attributes[s];n instanceof F&&(n=y._convertDictionaryToJson(n)),t?i[s.toLowerCase()]=n:i[s]=n}return i}static parseAttributesFromDictionary(e){const t={};for(const i in e.attributes){const s=e.attributes[i];if(!a(s))throw new Error("Illegal Argument");t[i]=s}return t}static fromJson(s){let n=null;null!==s.geometry&&void 0!==s.geometry&&(n=C(s.geometry));const u={};if(null!==s.attributes&&void 0!==s.attributes)for(const n in s.attributes){const r=s.attributes[n];if(null===r)u[n]=r;else{if(!(i(r)||t(r)||e(r)||h(r)))throw new Error("Illegal Argument");u[n]=r}}return y.createFromGraphicLikeObject(n,u,null)}fullSchema(){return this._layer}gdbVersion(){if(null===this._layer)return"";const e=this._layer.gdbVersion;return void 0===e?"":""===e&&this._layer.capabilities&&this._layer.capabilities.isVersioned?"SDE.DEFAULT":e}castAsJson(e){const t={attributes:{},geometry:!0===e?.keepGeometryType?this.geometry():this.geometry().toJSON()};for(const i in this.attributes){const s=this.attributes[i];void 0!==s&&(t.attributes[i]=u(s,e))}return t}async castAsJsonAsync(e=null,t){return this.castAsJson(t)}}const g={all:{min:"2",max:"2"},none:{min:"2",max:"2"},any:{min:"2",max:"2"},reduce:{min:"2",max:"3"},map:{min:"2",max:"2"},filter:{min:"2",max:"2"},fromcodepoint:{min:"1",max:"*"},fromcharcode:{min:"1",max:"*"},tocodepoint:{min:"1",max:"2"},tocharcode:{min:"1",max:"2"},concatenate:{min:"0",max:"*"},expects:{min:"1",max:"*"},getfeatureset:{min:"1",max:"2"},week:{min:"1",max:"2"},fromjson:{min:"1",max:"1"},length3d:{min:"1",max:"2"},tohex:{min:"1",max:"1"},hash:{min:"1",max:"1"},isoweek:{min:"1",max:"1"},isoweekday:{min:"1",max:"1"},isomonth:{min:"1",max:"1"},isoyear:{min:"1",max:"1"},resize:{min:"2",max:"3"},slice:{min:"0",max:"*"},splice:{min:"0",max:"*"},push:{min:"2",max:"2"},pop:{min:"1",max:"1"},includes:{min:"2",max:"2"},array:{min:"1",max:"2"},front:{min:"1",max:"1"},back:{min:"1",max:"1"},insert:{min:"3",max:"3"},erase:{min:"2",max:"2"},split:{min:"2",max:"4"},guid:{min:"0",max:"1"},today:{min:"0",max:"0"},angle:{min:"2",max:"3"},bearing:{min:"2",max:"3"},urlencode:{min:"1",max:"1"},now:{min:"0",max:"0"},timestamp:{min:"0",max:"0"},day:{min:"1",max:"1"},month:{min:"1",max:"1"},year:{min:"1",max:"1"},hour:{min:"1",max:"1"},second:{min:"1",max:"1"},millisecond:{min:"1",max:"1"},minute:{min:"1",max:"1"},weekday:{min:"1",max:"1"},toutc:{min:"1",max:"1"},tolocal:{min:"1",max:"1"},date:{min:"0",max:"7"},datediff:{min:"2",max:"3"},dateadd:{min:"2",max:"3"},trim:{min:"1",max:"1"},text:{min:"1",max:"2"},left:{min:"2",max:"2"},right:{min:"2",max:"2"},mid:{min:"2",max:"3"},upper:{min:"1",max:"1"},proper:{min:"1",max:"2"},lower:{min:"1",max:"1"},find:{min:"2",max:"3"},iif:{min:"3",max:"3"},decode:{min:"2",max:"*"},when:{min:"2",max:"*"},defaultvalue:{min:"2",max:"2"},isempty:{min:"1",max:"1"},domaincode:{min:"2",max:"4"},domainname:{min:"2",max:"4"},polygon:{min:"1",max:"1"},point:{min:"1",max:"1"},polyline:{min:"1",max:"1"},extent:{min:"1",max:"1"},multipoint:{min:"1",max:"1"},ringisclockwise:{min:"1",max:"1"},geometry:{min:"1",max:"1"},count:{min:"0",max:"*"},number:{min:"1",max:"2"},acos:{min:"1",max:"1"},asin:{min:"1",max:"1"},atan:{min:"1",max:"1"},atan2:{min:"2",max:"2"},ceil:{min:"1",max:"2"},floor:{min:"1",max:"2"},round:{min:"1",max:"2"},cos:{min:"1",max:"1"},exp:{min:"1",max:"1"},log:{min:"1",max:"1"},min:{min:"0",max:"*"},constrain:{min:"3",max:"3"},console:{min:"0",max:"*"},max:{min:"0",max:"*"},pow:{min:"2",max:"2"},random:{min:"0",max:"0"},sqrt:{min:"1",max:"1"},sin:{min:"1",max:"1"},tan:{min:"1",max:"1"},abs:{min:"1",max:"1"},isnan:{min:"1",max:"1"},stdev:{min:"0",max:"*"},average:{min:"0",max:"*"},mean:{min:"0",max:"*"},sum:{min:"0",max:"*"},variance:{min:"0",max:"*"},distinct:{min:"0",max:"*"},first:{min:"1",max:"1"},top:{min:"2",max:"2"},boolean:{min:"1",max:"1"},dictionary:{min:"0",max:"*"},typeof:{min:"1",max:"1"},reverse:{min:"1",max:"1"},replace:{min:"3",max:"4"},sort:{min:"1",max:"2"},feature:{min:"1",max:"*"},haskey:{min:"2",max:"2"},indexof:{min:"2",max:"2"},disjoint:{min:"2",max:"2"},intersects:{min:"2",max:"2"},touches:{min:"2",max:"2"},crosses:{min:"2",max:"2"},within:{min:"2",max:"2"},contains:{min:"2",max:"2"},overlaps:{min:"2",max:"2"},equals:{min:"2",max:"2"},relate:{min:"3",max:"3"},intersection:{min:"2",max:"2"},union:{min:"1",max:"2"},difference:{min:"2",max:"2"},symmetricdifference:{min:"2",max:"2"},clip:{min:"2",max:"2"},cut:{min:"2",max:"2"},area:{min:"1",max:"2"},areageodetic:{min:"1",max:"2"},length:{min:"1",max:"2"},lengthgeodetic:{min:"1",max:"2"},distancegeodetic:{min:"2",max:"3"},distance:{min:"2",max:"3"},densify:{min:"2",max:"3"},densifygeodetic:{min:"2",max:"3"},generalize:{min:"2",max:"4"},buffer:{min:"2",max:"3"},buffergeodetic:{min:"2",max:"3"},offset:{min:"2",max:"6"},rotate:{min:"2",max:"3"},issimple:{min:"1",max:"1"},simplify:{min:"1",max:"1"},centroid:{min:"1",max:"1"},isselfintersecting:{min:"1",max:"1"},multiparttosinglepart:{min:"1",max:"1"},setgeometry:{min:"2",max:"2"},portal:{min:"1",max:"1"},getuser:{min:"1",max:"2"},subtypes:{min:"1",max:"1"},subtypecode:{min:"1",max:"1"},subtypename:{min:"1",max:"1"},domain:{min:"2",max:"3"},convertdirection:{min:"3",max:"3"},schema:{min:"1",max:"1"}};for(const e in g)g[e].fmin=g[e].min,g[e].fmax=g[e].max;const B=["featureset","getuser","featuresetbyid","featuresetbyname","featuresetbyassociation","featuresetbyrelationshipname","featuresetbyurl","getfeatureset","attachments","featuresetbyportalitem"],b=["disjoint","intersects","touches","crosses","within","contains","overlaps","equals","relate","intersection","union","difference","symmetricdifference","clip","cut","area","areageodetic","length","length3d","lengthgeodetic","distance","distancegeodetic","densify","densifygeodetic","generalize","buffer","buffergeodetic","offset","rotate","issimple","simplify","multiparttosinglepart"];function N(e){return"string"==typeof e||e instanceof String}function k(e,t){const i=g[e.name.toLowerCase()];void 0===i?g[e.name.toLowerCase()]="sync"===t?{min:e.min,max:e.max}:{fmin:e.min,fmax:e.max}:"sync"===t?(i.min=e.min,i.max=e.max):(i.fmin=e.min,i.fmax=e.max)}function S(e,t){return"0"!==e.min&&t.length<Number(e.min)||"*"!==e.max&&t.length>Number(e.max)?-2:1}function T(e,t,i){if(null!==i.localScope&&void 0!==i.localScope[e.toLowerCase()]){const s=i.localScope[e.toLowerCase()];if("FormulaFunction"===s.type)return void 0===s.signature&&(s.signature={min:"0",max:"*"}),S(s.signature,t);if("any"===s.type)return void 0===s.signature&&(s.signature={min:"0",max:"*"}),S(s.signature,t)}if(void 0!==i.globalScope[e.toLowerCase()]){const s=i.globalScope[e.toLowerCase()];if("FormulaFunction"===s.type)return void 0===s.signature&&(s.signature={min:"0",max:"*"}),S(s.signature,t);if("any"===s.type)return void 0===s.signature&&(s.signature={min:"0",max:"*"}),S(s.signature,t)}return-1}function w(e,t){if(e)for(const i of e)I(i,t)}function I(e,t){if(e&&!1!==t(e))switch(e.type){case"ArrayExpression":w(e.elements,t);break;case"AssignmentExpression":case"BinaryExpression":case"LogicalExpression":I(e.left,t),I(e.right,t);break;case"BlockStatement":case"Program":w(e.body,t);break;case"BreakStatement":case"ContinueStatement":case"EmptyStatement":case"Identifier":case"Literal":break;case"CallExpression":I(e.callee,t),w(e.arguments,t);break;case"ExpressionStatement":I(e.expression,t);break;case"ForInStatement":I(e.left,t),I(e.right,t),I(e.body,t);break;case"ForStatement":I(e.init,t),I(e.test,t),I(e.update,t),I(e.body,t);break;case"FunctionDeclaration":I(e.id,t),w(e.params,t),I(e.body,t);break;case"IfStatement":I(e.test,t),I(e.consequent,t),I(e.alternate,t);break;case"MemberExpression":I(e.object,t),I(e.property,t);break;case"ObjectExpression":w(e.properties,t);break;case"Property":I(e.key,t),I(e.value,t);break;case"ReturnStatement":case"UnaryExpression":case"UpdateExpression":I(e.argument,t);break;case"VariableDeclaration":w(e.declarations,t);break;case"VariableDeclarator":I(e.id,t),I(e.init,t);break;case"TemplateLiteral":w(e.expressions,t),w(e.quasis,t)}}function L(e,t=!0){let i=M(e,"SYNTAX","UNREOGNISED");try{switch(e.type){case"VariableDeclarator":return"Identifier"!==e.id.type?M(e,"SYNTAX","VARIABLEMUSTHAVEIDENTIFIER"):null!==e.init?L(e.init,!1):"";case"VariableDeclaration":for(let s=0;s<e.declarations.length;s++)if(i=L(e.declarations[s],t),""!==i)return i;return"";case"ForInStatement":if(i=L(e.left,t),""!==i)return i;if("VariableDeclaration"===e.left.type){if(e.left.declarations.length>1)return M(e,"SYNTAX","ONLY1VAR");if(null!==e.left.declarations[0].init)return M(e,"SYNTAX","CANNOTDECLAREVAL")}else if("Identifier"!==e.left.type)return M(e,"SYNTAX","LEFTNOTVAR");return i=L(e.right,t),""!==i?i:(i=L(e.body,t),""!==i?i:"");case"ForStatement":return null!==e.test&&(i=L(e.test,t),""!==i)||null!==e.init&&(i=L(e.init,t),""!==i)||null!==e.update&&(i=L(e.update,t),""!==i)||null!==e.body&&(i=L(e.body,t),""!==i)?i:"";case"ContinueStatement":case"EmptyStatement":case"BreakStatement":case"Literal":case"TemplateElement":return"";case"IfStatement":return i=L(e.test,t),""!==i||null!==e.consequent&&(i=L(e.consequent,!1),""!==i)||null!==e.alternate&&(i=L(e.alternate,!1),""!==i)?i:"";case"BlockStatement":{const s=[];for(let t=0;t<e.body.length;t++)"EmptyStatement"!==e.body[t].type&&s.push(e.body[t]);e.body=s;for(let s=0;s<e.body.length;s++)if(i=L(e.body[s],t),""!==i)return i;return""}case"FunctionDeclaration":return!1===t?M(e,"SYNTAX","GLOBALFUNCTIONSONLY"):"Identifier"!==e.id.type?M(e,"SYNTAX","FUNCTIONMUSTHAVEIDENTIFIER"):L(e.body,!1);case"ReturnStatement":return null!==e.argument?L(e.argument,t):"";case"UpdateExpression":return"Identifier"!==e.argument.type&&"MemberExpression"!==e.argument.type?M(e,"SYNTAX","ASSIGNMENTTOVARSONLY"):L(e.argument,t);case"AssignmentExpression":if("Identifier"!==e.left.type&&"MemberExpression"!==e.left.type)return M(e,"SYNTAX","ASSIGNMENTTOVARSONLY");if(i=L(e.left,t),""!==i)return i;switch(e.operator){case"=":case"/=":case"*=":case"%=":case"+=":case"-=":break;default:return M(e,"SYNTAX","OPERATORNOTRECOGNISED")}return L(e.right,!1);case"ExpressionStatement":return"AssignmentExpression"===e.expression.type||e.expression.type,L(e.expression,!1);case"Identifier":i="";break;case"MemberExpression":return i=L(e.object,t),""!==i?i:!0===e.computed?L(e.property,t):"";case"CallExpression":if("Identifier"!==e.callee.type)return M(e,"SYNTAX","ONLYNODESSUPPORTED");i="";for(let s=0;s<e.arguments.length;s++)if(i=L(e.arguments[s],t),""!==i)return i;return"";case"UnaryExpression":i=L(e.argument,t);break;case"BinaryExpression":if(i=L(e.left,t),""!==i)return i;if(i=L(e.right,t),""!==i)return i;switch(e.operator){case"|":case"&":case">>":case"<<":case">>>":case"^":case"==":case"!=":case"<":case"<=":case">":case">=":case"+":case"-":case"*":case"/":case"%":break;default:return M(e,"SYNTAX","OPERATORNOTRECOGNISED")}return"";case"LogicalExpression":if(i=L(e.left,t),""!==i)return i;if(i=L(e.right),""!==i)return i;switch(e.operator){case"&&":case"||":break;default:return M(e,"SYNTAX","OPERATORNOTRECOGNISED")}return"";case"ArrayExpression":i="";for(let s=0;s<e.elements.length;s++)if(i=L(e.elements[s],t),""!==i)return i;return i;case"TemplateLiteral":i="";for(let s=0;s<e.quasis.length;s++)if(i=L(e.quasis[s],t),""!==i)return i;for(let s=0;s<e.expressions.length;s++)if(i=L(e.expressions[s],t),""!==i)return i;return i;case"ObjectExpression":i="";for(let s=0;s<e.properties.length;s++){if(i="",null!==e.properties[s].key&&("Literal"!==e.properties[s].key.type&&"Identifier"!==e.properties[s].key.type&&(i=M(e,"SYNTAX","OBJECTPROPERTYMUSTBESTRING")),"Literal"===e.properties[s].key.type)){const t=e.properties[s].key,n="value"in t?t.value:null;"string"==typeof n||n instanceof String||(i=M(e,"SYNTAX","OBJECTPROPERTYMUSTBESTRING"))}if(""===i&&(i=L(e.properties[s],t)),""!==i)return i}return i;case"Property":return"Literal"!==e.key.type&&"Identifier"!==e.key.type?M(e,"SYNTAX","ONLYLITERAL"):("Identifier"!==e.key.type&&(i=L(e.key,t),""!==i)||(i=L(e.value,t)),i);default:return i}return i}catch(e){throw e}}function O(e,t){let i=M(e,"SYNTAX","UNREOGNISED"),s=null,n="";try{switch(e.type){case"VariableDeclarator":{const i=null===e.init?"":O(e.init,t);return""!==i?i:("Identifier"===e.id.type&&(null===t.localScope?t.globalScope[e.id.name.toLowerCase()]={type:"any"}:t.localScope[e.id.name.toLowerCase()]={type:"any"}),"")}case"FunctionDeclaration":return s=R(e.id.name.toLowerCase(),e),n=function(e,t){const i={globalScope:t.globalScope,localScope:{}};for(let t=0;t<e.params.length;t++){const s=e.params[t].name;i.localScope[s.toLowerCase()]={type:"any"}}return O(e.body,i)}(e,t),""!==n?n:null!==t.localScope?M(e,"SYNTAX","GLOBALFUNCTIONSONLY"):(s.isnative=!1,t.globalScope[e.id.name.toLowerCase()]={type:"FormulaFunction",signature:[s]},"");case"VariableDeclaration":i="";for(let s=0;s<e.declarations.length;s++)if(i=O(e.declarations[s],t),""!==i)return i;return i;case"IfStatement":return i=O(e.test,t),""!==i?i:"AssignmentExpression"===e.test.type||"UpdateExpression"===e.test.type?M(e.test,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION"):null!==e.consequent&&(i=O(e.consequent,t),""!==i)||null!==e.alternate&&(i=O(e.alternate,t),""!==i)?i:"";case"EmptyStatement":case"BreakStatement":case"ContinueStatement":case"Literal":case"TemplateElement":return"";case"BlockStatement":for(let s=0;s<e.body.length;s++)if(i=O(e.body[s],t),""!==i)return i;return"";case"ReturnStatement":return null!==e.argument?O(e.argument,t):"";case"ForInStatement":if("VariableDeclaration"===e.left.type){if(e.left.declarations.length>1)return M(e,"SYNTAX","ONLY1VAR");if(null!==e.left.declarations[0].init)return M(e,"SYNTAX","CANNOTDECLAREVAL")}else if("Identifier"!==e.left.type)return M(e,"SYNTAX","LEFTNOTVAR");return i=O(e.left,t),""!==i?i:(i=O(e.right,t),""!==i?i:(i=O(e.body,t),""!==i?i:""));case"ForStatement":return null!==e.init&&(i=O(e.init,t),""!==i)||null!==e.test&&(i=O(e.test,t),""!==i)||null!==e.body&&(i=O(e.body,t),""!==i)||null!==e.update&&(i=O(e.update,t),""!==i)?i:"";case"UpdateExpression":{if("Identifier"!==e.argument.type&&"MemberExpression"!==e.argument.type)return M(e,"SYNTAX","ASSIGNMENTTOVARSONLY");let i=!1;return"MemberExpression"===e.argument.type?O(e.argument,t):(null!==t.localScope&&void 0!==t.localScope[e.argument.name.toLowerCase()]&&(i=!0),void 0!==t.globalScope[e.argument.name.toLowerCase()]&&(i=!0),!1===i?"Identifier "+e.argument.name+" has not been declared.":"")}case"AssignmentExpression":{if("Identifier"!==e.left.type&&"MemberExpression"!==e.left.type)return M(e,"SYNTAX","ASSIGNMENTTOVARSONLY");let i=O(e.right,t);if(""!==i)return i;let s=!1;return"MemberExpression"===e.left.type?(i=O(e.left,t),""!==i?i:""):(null!==t.localScope&&void 0!==t.localScope[e.left.name.toLowerCase()]&&(s=!0),void 0!==t.globalScope[e.left.name.toLowerCase()]&&(s=!0),!1===s?"Identifier "+e.left.name+" has not been declared.":"")}case"ExpressionStatement":return"AssignmentExpression"===e.expression.type||e.expression.type,O(e.expression,t);case"Identifier":{const s=e.name.toLowerCase();if(null!==t.localScope&&void 0!==t.localScope[s])return"";i=void 0!==t.globalScope[s]?"":M(e,"SYNTAX","VARIABLENOTFOUND");break}case"MemberExpression":return i=O(e.object,t),""!==i?i:!0===e.computed?O(e.property,t):"";case"CallExpression":{if("Identifier"!==e.callee.type)return M(e,"SYNTAX","ONLYNODESSUPPORTED");i="";for(let s=0;s<e.arguments.length;s++)if(i=O(e.arguments[s],t),""!==i)return i;const s=T(e.callee.name,e.arguments,t);-1===s&&(i=M(e,"SYNTAX","NOTFOUND")),-2===s&&(i=M(e,"SYNTAX","WRONGSIGNATURE"));break}case"UnaryExpression":i=O(e.argument,t);break;case"BinaryExpression":return i=O(e.left,t),""!==i?i:(i=O(e.right,t),""!==i?i:"");case"LogicalExpression":return i=O(e.left,t),""!==i?i:"AssignmentExpression"===e.left.type||"UpdateExpression"===e.left.type?M(e.left,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION"):(i=O(e.right,t),""!==i?i:"AssignmentExpression"===e.right.type||"UpdateExpression"===e.right.type?M(e.right,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION"):"");case"ArrayExpression":i="";for(let s=0;s<e.elements.length;s++)if(i=O(e.elements[s],t),""!==i)return i;return i;case"TemplateLiteral":i="";for(let s=0;s<e.quasis.length;s++)if(i=O(e.quasis[s],t),""!==i)return i;for(let s=0;s<e.expressions.length;s++)if(i=O(e.expressions[s],t),""!==i)return i;return i;case"ObjectExpression":i="";for(let s=0;s<e.properties.length;s++){if(i="",null!==e.properties[s].key&&("Literal"!==e.properties[s].key.type&&"Identifier"!==e.properties[s].key.type&&(i=M(e,"SYNTAX","OBJECTPROPERTYMUSTBESTRING")),"Literal"===e.properties[s].key.type)){const t=e.properties[s].key,n="value"in t?t.value:null;"string"==typeof n||n instanceof String||(i=M(e,"SYNTAX","OBJECTPROPERTYMUSTBESTRING"))}if(""===i&&(i=O(e.properties[s],t)),""!==i)return i}return i;case"Property":return"Literal"!==e.key.type&&"Identifier"!==e.key.type?M(e,"SYNTAX","ONLYLITERAL"):("Identifier"!==e.key.type&&(i=O(e.key,t),""!==i)||(i=O(e.value,t)),i);default:return i}return i}catch(e){throw e}}function v(e,t){let i=!1;const s=t.toLowerCase();return I(e,(e=>!i&&("Identifier"===e.type&&e.name&&e.name.toLowerCase()===s&&(i=!0),!0))),i}function _(e,t){let i=!1;const s=t.toLowerCase();return I(e,(e=>!(i||"CallExpression"===e.type&&"Identifier"===e.callee.type&&e.callee.name&&e.callee.name.toLowerCase()===s&&(i=!0,1)))),i}function U(e){const t=[];return I(e,(e=>"MemberExpression"!==e.type||"Identifier"!==e.object.type||(!1===e.computed&&e.object&&e.object.name&&e.property&&"Identifier"===e.property.type&&e.property.name?t.push(e.object.name.toLowerCase()+"."+e.property.name.toLowerCase()):e.object&&e.object.name&&e.property&&"Literal"===e.property.type&&"string"==typeof e.property.value&&t.push(e.object.name.toLowerCase()+"."+e.property.value.toString().toLowerCase()),!1))),t}function R(e,t){const i=[];if(void 0!==t.params&&null!==t.params)for(let e=0;e<t.params.length;e++)i.push("any");return{name:e,return:"any",params:i}}function P(e,t,i,s){const n={};null==e&&(e={}),null==i&&(i={}),n.infinity={type:"any"},n.textformatting={type:"any"},n.pi={type:"any"};for(const e in t)"sync"===s&&void 0!==t[e].min?n[e]={type:"FormulaFunction",signature:{min:t[e].min,max:t[e].max}}:"sync"!==s&&void 0!==t[e].fmin&&(n[e]={type:"FormulaFunction",signature:{min:t[e].fmin,max:t[e].fmax}});for(let e=0;e<i.length;e++){const t=i[e];n[t.name]={type:"FormulaFunction",signature:t}}for(const t in e)n[t]=e[t],n[t].type="any";return n}function G(e,t,i="async",s=g){const n={globalScope:P(t.vars,s,t.customFunctions,i),localScope:null};return O(e.body[0].body,n)}function Y(e){return"BlockStatement"!==e.body[0].body.type?"Invalid formula content.":L(e.body[0].body)}function M(e,t,i){let s="";switch(t){case"SYNTAX":default:s="Syntax Error: ";break;case"RUNTIME":s="Runtime Error: "}try{switch(e.type){case"IfStatement":switch(i){case"CANNOT_USE_ASSIGNMENT_IN_CONDITION":s+=" Assignments not be made in logical tests";break;case"CANNOT_USE_NONBOOLEAN_IN_CONDITION":s+=" Non Boolean used as Condition"}break;case"UpdateExpression":case"AssignmentExpression":switch(i){case"CANNOT_USE_ASSIGNMENT_IN_CONDITION":s+=" Assignments not be made in logical tests";break;case"ASSIGNMENTTOVARSONLY":s+=" Assignments can only be made to identifiers"}break;case"ExpressionStatement":s+=" Assignments can only be made to identifiers";break;case"FunctionDeclaration":switch(i){case"GLOBALFUNCTIONSONLY":s+=" Functions cannot be declared as variables";break;case"FUNCTIONMUSTHAVEIDENTIFIER":s+=" Function Definition must have an identifier"}break;case"VariableDeclaration":s+=" Only 1 variable can be declared at a time";break;case"VariableDeclarator":switch(i){case"FUNCTIONVARIABLEDECLARATOR":s+=" Functions cannot be declared as variables";break;case"VARIABLEMUSTHAVEIDENTIFIER":s+=" Variable Definition must have an identifier"}break;case"Identifier":s+=" Identifier Not Found. ",s+=e.name;break;case"ObjectExpression":"OBJECTPROPERTYMUSTBESTRING"===i&&(s+=" Property name must be a string");break;case"ForStatement":"CANNOT_USE_NONBOOLEAN_IN_CONDITION"===i&&(s+=" Non Boolean used as Condition");break;case"ForInStatement":switch(i){case"ONLY1VAR":s+=" Can only declare 1 var for use with IN";break;case"CANNOTDECLAREVAL":s+=" Can only declare value for use with IN";break;case"LEFTNOVAR":s+="Must provide a variable to iterate with.";break;case"VARIABLENOTDECLARED":s+="Variable must be declared before it is used..";break;case"CANNOTITERATETHISTYPE":s+="This type cannot be used in an IN loop"}break;case"MemberExpression":switch(i){case"PROPERTYNOTFOUND":s+="Cannot find member property. ",s+=!1===e.computed&&"Identifier"===e.property.type?e.property.name:"";break;case"OUTOFBOUNDS":s+="Out of Bounds. ",s+=!1===e.computed&&"Identifier"===e.property.type?e.property.name:"";break;case"NOTFOUND":s+="Cannot call member method on null. ",s+=!1===e.computed&&"Identifier"===e.property.type?e.property.name:"";break;case"INVALIDTYPE":s+="Cannot call member property on object of this type. ",s+=!1===e.computed&&"Identifier"===e.property.type?e.property.name:""}break;case"Property":"ONLYLITERAL"===i&&(s+="Property names must be literals or identifiers");break;case"Literal":break;case"CallExpression":switch(i){case"WRONGSIGNATURE":s+="Function signature does not match: ",s+="Identifier"===e.callee.type?e.callee.name:"";break;case"ONLYNODESUPPORTED":s+="Functions must be declared.",s+="Identifier"===e.callee.type?e.callee.name:"";break;case"NOTAFUNCTION":s+="Not a Function: ",s+="Identifier"===e.callee.type?e.callee.name:"";break;case"NOTFOUND":s+="Function Not Found: "+("Identifier"===e.callee.type?e.callee.name:"")}break;case"UnaryExpression":switch(i){case"NOTSUPPORTEDUNARYOPERATOR":s+="Operator "+e.operator+" not allowed in this context. Only ! can be used with boolean, and - with a number";break;case"NOTSUPPORTEDTYPE":s+="Unary operator "+e.operator+" cannot be used with this argument."}case"BinaryExpression":"OPERATORNOTRECOGNISED"===i&&(s+="Binary Operator not recognised "+e.operator);break;case"LogicalExpression":switch(i){case"ONLYBOOLEAN":s+="Operator "+e.operator+" cannot be used. Only || or && are allowed values";break;case"ONLYORORAND":s+="Logical Expression "+e.operator+" being applied to parameters that are not boolean."}break;case"ArrayExpression":"FUNCTIONCONTEXTILLEGAL"===i&&(s+=" Cannot Put Function inside Array.");break;default:s+="Expression contains unrecognised code structures."}}catch(e){throw e}return s}function z(e,t,i){return{line:e.loc.start.line,character:e.loc.start.column,reason:M(e,t,i)}}function V(e,t,i,s,n=!0){if(null===e)throw new Error("Unnexpexted Expression Syntax");let u=null;try{switch(e.type){case"VariableDeclarator":return"Identifier"!==e.id.type?s.push(z(e,"SYNTAX","VARIABLEMUSTHAVEIDENTIFIER")):(null!==t.localScope?t.localScope[e.id.name.toLowerCase()]:t.globalScope[e.id.name.toLowerCase()],null===t.localScope?t.globalScope[e.id.name.toLowerCase()]={type:"any"}:t.localScope[e.id.name.toLowerCase()]={type:"any"}),void(null!==e.init&&V(e.init,t,i,s,n));case"FunctionDeclaration":return!1===n&&s.push(z(e,"SYNTAX","GLOBALFUNCTIONSONLY")),"Identifier"!==e.id.type&&s.push(z(e,"SYNTAX","FUNCTIONMUSTHAVEIDENTIFIER")),u=R("",e),function(e,t,i,s){const n={globalScope:t.globalScope,localScope:{}};for(let t=0;t<e.params.length;t++){const i=e.params[t].name;n.localScope[i.toLowerCase()]={type:"any"}}V(e.body,n,i,s,!1)}(e,t,i,s),null!==t.localScope&&s.push(z(e,"SYNTAX","GLOBALFUNCTIONSONLY")),u.isnative=!1,void("Identifier"===e.id.type&&(t.globalScope[e.id.name.toLowerCase()]={type:"FormulaFunction",signature:[u]}));case"VariableDeclaration":for(let u=0;u<e.declarations.length;u++)V(e.declarations[u],t,i,s,n);return;case"IfStatement":return null!==e.test&&(V(e.test,t,i,s,n),"AssignmentExpression"!==e.test.type&&"UpdateExpression"!==e.test.type||s.push(z(e.test,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION"))),null!==e.consequent&&V(e.consequent,t,i,s,n),void(null!==e.alternate&&V(e.alternate,t,i,s,n));case"EmptyStatement":case"BreakStatement":case"ContinueStatement":case"Literal":case"TemplateElement":return;case"BlockStatement":if(null!==e.body)for(let u=0;u<e.body.length;u++)V(e.body[u],t,i,s,n);return;case"ReturnStatement":return void(null!==e.argument&&V(e.argument,t,i,s,n));case"ForInStatement":return"VariableDeclaration"===e.left.type?(e.left.declarations.length>1&&s.push(z(e,"SYNTAX","ONLY1VAR")),null!==e.left.declarations[0].init&&s.push(z(e,"SYNTAX","CANNOTDECLAREVAL"))):"Identifier"!==e.left.type&&s.push(z(e,"SYNTAX","LEFTNOTVAR")),V(e.left,t,i,s,n),V(e.right,t,i,s,n),void V(e.body,t,i,s,n);case"ForStatement":return null!==e.init&&V(e.init,t,i,s,n),null!==e.test&&V(e.test,t,i,s,n),null!==e.body&&V(e.body,t,i,s,n),void(null!==e.update&&V(e.update,t,i,s,n));case"UpdateExpression":if("Identifier"!==e.argument.type&&"MemberExpression"!==e.argument.type)s.push(z(e,"SYNTAX","ASSIGNMENTTOVARSONLY"));else{if("Identifier"===e.argument.type){let n=!1;!1===i&&(null!==t.localScope&&void 0!==t.localScope[e.argument.name.toLowerCase()]&&(n=!0),void 0!==t.globalScope[e.argument.name.toLowerCase()]&&(n=!0),!1===n&&s.push({line:null===e?0:e.loc.start.line,character:null===e?0:e.loc.start.column,reason:"Identifier "+e.argument.name+" has not been declared."}))}"MemberExpression"===e.argument.type&&V(e.argument,t,i,s,n)}return;case"AssignmentExpression":{switch("Identifier"!==e.left.type&&"MemberExpression"!==e.left.type&&s.push(z(e,"SYNTAX","ASSIGNMENTTOVARSONLY")),e.operator){case"=":case"/=":case"*=":case"%=":case"+=":case"-=":break;default:s.push(z(e,"SYNTAX","OPERATORNOTRECOGNISED"))}V(e.right,t,i,s,n);let u=!1;return"Identifier"===e.left.type&&(null!==t.localScope&&void 0!==t.localScope[e.left.name.toLowerCase()]&&(u=!0),void 0!==t.globalScope[e.left.name.toLowerCase()]&&(u=!0),!1===i&&!1===u&&s.push({line:null===e?0:e.loc.start.line,character:null===e?0:e.loc.start.column,reason:"Identifier "+e.left.name+" has not been declared."})),void("MemberExpression"===e.left.type&&V(e.left,t,i,s,n))}case"ExpressionStatement":return"AssignmentExpression"===e.expression.type||e.expression.type,void V(e.expression,t,i,s,n);case"Identifier":{const n=e.name.toLowerCase();if(null!==t.localScope&&void 0!==t.localScope[n])return;if(void 0!==t.globalScope[n])return;!1===i&&s.push(z(e,"SYNTAX","VARIABLENOTFOUND"));break}case"MemberExpression":return V(e.object,t,i,s,n),void(!0===e.computed&&V(e.property,t,i,s,n));case"CallExpression":"Identifier"!==e.callee.type&&s.push(z(e,"SYNTAX","ONLYNODESSUPPORTED"));for(let u=0;u<e.arguments.length;u++)V(e.arguments[u],t,i,s,n);if("Identifier"===e.callee.type){const n=T(e.callee.name,e.arguments,t);!1===i&&-1===n&&s.push(z(e,"SYNTAX","NOTFOUND")),-2===n&&s.push(z(e,"SYNTAX","WRONGSIGNATURE"))}return;case"UnaryExpression":return void V(e.argument,t,i,s,n);case"BinaryExpression":switch(V(e.left,t,i,s,n),V(e.right,t,i,s,n),e.operator){case"==":case"!=":case"<":case"<=":case">":case">=":case"+":case"-":case"*":case"/":case"%":case"&":case"|":case"^":case"<<":case">>":case">>>":break;default:s.push(z(e,"SYNTAX","OPERATORNOTRECOGNISED"))}return;case"LogicalExpression":switch(e.operator){case"&&":case"||":break;default:s.push(z(e,"SYNTAX","OPERATORNOTRECOGNISED"))}return V(e.left,t,i,s,n),"AssignmentExpression"!==e.left.type&&"UpdateExpression"!==e.left.type||s.push(z(e,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION")),V(e.right,t,i,s,n),void("AssignmentExpression"!==e.right.type&&"UpdateExpression"!==e.right.type||s.push(z(e,"SYNTAX","CANNOT_USE_ASSIGNMENT_IN_CONDITION")));case"ArrayExpression":for(let u=0;u<e.elements.length;u++)V(e.elements[u],t,i,s,n);return;case"TemplateLiteral":for(let u=0;u<e.quasis.length;u++)V(e.quasis[u],t,i,s,n);for(let u=0;u<e.expressions.length;u++)V(e.expressions[u],t,i,s,n);return;case"ObjectExpression":for(let u=0;u<e.properties.length;u++)V(e.properties[u],t,i,s,n);return;case"Property":return"Literal"!==e.key.type&&"Identifier"!==e.key.type&&s.push(z(e,"SYNTAX","ONLYLITERAL")),"Literal"===e.key.type&&V(e.key,t,i,s,n),void V(e.value,t,i,s,n);default:s.push(z(e,"SYNTAX","UNRECOGNISED"))}return}catch(t){s.push({line:null===e?0:e.loc.start.line,character:null===e?0:e.loc.start.column,reason:"Unnexpected Syntax"})}}function j(e){const t=[];return I(e,(e=>("CallExpression"===e.type&&"Identifier"===e.callee.type&&t.push(e.callee.name.toLowerCase()),!0))),t}function X(e,t=[]){let i=null;if(void 0===e.usesFeatureSet){null===i&&(i=j(e)),e.usesFeatureSet=!1;for(let t=0;t<i.length;t++)B.includes(i[t])&&(e.usesFeatureSet=!0,e.isAsync=!0);if(!1===e.usesFeatureSet&&t&&t.length>0)for(const i of t)if(v(e,i)){e.usesFeatureSet=!0,e.isAsync=!0;break}}if(void 0===e.usesGeometry){e.usesGeometry=!1,null===i&&(i=j(e));for(let t=0;t<i.length;t++)b.includes(i[t])&&(e.usesGeometry=!0)}}class H{constructor(){this.attach=!1,this.comments=[],this.stack=[],this.leading=[],this.trailing=[]}insertInnerComments(e,t){if("BlockStatement"===e.type&&0===e.body.length){const i=[];for(let e=this.leading.length-1;e>=0;--e){const s=this.leading[e];t.end.offset>=s.start&&(i.unshift(s.comment),this.leading.splice(e,1),this.trailing.splice(e,1))}i.length&&(e.innerComments=i)}}findTrailingComments(e){let t=[];if(this.trailing.length>0){for(let i=this.trailing.length-1;i>=0;--i){const s=this.trailing[i];s.start>=e.end.offset&&t.unshift(s.comment)}return this.trailing.length=0,t}const i=this.stack[this.stack.length-1];if(i&&i.node.trailingComments){const s=i.node.trailingComments[0];s&&s.range[0]>=e.end.offset&&(t=i.node.trailingComments,delete i.node.trailingComments)}return t}findLeadingComments(e){const t=[];let i;for(;this.stack.length>0;){const t=this.stack[this.stack.length-1];if(!(t&&t.start>=e.start.offset))break;i=t.node,this.stack.pop()}if(i){for(let s=(i.leadingComments?i.leadingComments.length:0)-1;s>=0;--s){const n=i.leadingComments[s];n.range[1]<=e.start.offset&&(t.unshift(n),i.leadingComments.splice(s,1))}return i.leadingComments&&0===i.leadingComments.length&&delete i.leadingComments,t}for(let i=this.leading.length-1;i>=0;--i){const s=this.leading[i];s.start<=e.start.offset&&(t.unshift(s.comment),this.leading.splice(i,1))}return t}visitNode(e,t){if("Program"===e.type&&e.body.length>0)return;this.insertInnerComments(e,t);const i=this.findTrailingComments(t),s=this.findLeadingComments(t);s.length>0&&(e.leadingComments=s),i.length>0&&(e.trailingComments=i),this.stack.push({node:e,start:t.start.offset})}visitComment(e,t){if(this.comments.push(e),this.attach){const i={comment:{type:e.type,value:e.value,range:[t.start.offset,t.end.offset]},start:t.start.offset};e.loc&&(i.comment.loc=e.loc),this.leading.push(i),this.trailing.push(i)}}visit(e,t){"Line"===e.type||"Block"===e.type?this.visitComment(e,t):this.attach&&this.visitNode(e,t)}}function J(e,t){if(!e)throw new Error("ASSERT: "+t)}class K{constructor(){this.errors=[],this.tolerant=!1}recordError(e){this.errors.push(e)}tolerate(e){if(!this.tolerant)throw e;this.recordError(e)}constructError(e,t){let i=new Error(e);try{throw i}catch(e){Object.create&&Object.defineProperty&&(i=Object.create(e),Object.defineProperty(i,"column",{value:t}))}return i}createError(e,t,i,s){const n="Line "+t+": "+s,u=this.constructError(n,i);return u.index=e,u.lineNumber=t,u.description=s,u}throwError(e,t,i,s){throw this.createError(e,t,i,s)}tolerateError(e,t,i,s){const n=this.createError(e,t,i,s);if(!this.tolerant)throw n;this.recordError(n)}}class q{}class Z extends q{constructor(e,t){super(),this.type=e,this.value=t}}class W extends q{constructor(e){super(),this.elements=e,this.type="ArrayExpression"}}const $=["=","/=","*=","%=","+=","-="];class Q extends q{constructor(e,t,i){super(),this.operator=e,this.left=t,this.right=i,this.type="AssignmentExpression"}}const ee=["||","&&"];class te extends q{constructor(e,t,i){super(),this.operator=e,this.left=t,this.right=i,this.type=ee.includes(e)?"LogicalExpression":"BinaryExpression"}}class ie extends q{constructor(e){super(),this.body=e,this.type="BlockStatement"}}class se extends q{constructor(){super(...arguments),this.type="BreakStatement"}}class ne extends q{constructor(e,t){super(),this.callee=e,this.args=t,this.type="CallExpression",this.arguments=t}}class ue extends q{constructor(e,t){super(),this.object=e,this.property=t,this.type="MemberExpression",this.computed=!0}}class re extends q{constructor(e,t){super(),this.object=e,this.property=t,this.type="MemberExpression",this.computed=!1}}class ae extends q{constructor(){super(...arguments),this.type="ContinueStatement"}}class oe extends q{constructor(){super(...arguments),this.type="EmptyStatement"}}class ce extends q{constructor(e){super(),this.expression=e,this.type="ExpressionStatement"}}class le extends q{constructor(e,t,i){super(),this.left=e,this.right=t,this.body=i,this.type="ForInStatement",this.each=!1}}class he extends q{constructor(e,t,i,s){super(),this.init=e,this.test=t,this.update=i,this.body=s,this.type="ForStatement"}}class De extends q{constructor(e,t,i){super(),this.id=e,this.params=t,this.body=i,this.type="FunctionDeclaration",this.generator=!1,this.expression=!1,this.async=!1}}class me extends q{constructor(e){super(),this.name=e,this.type="Identifier"}}class de extends q{constructor(e,t,i){super(),this.test=e,this.consequent=t,this.alternate=i,this.type="IfStatement"}}class pe extends q{constructor(e,t){super(),this.value=e,this.raw=t,this.type="Literal"}}class Ce extends q{constructor(e){super(),this.properties=e,this.type="ObjectExpression"}}class Ee extends q{constructor(e,t,i,s,n,u){super(),this.kind=e,this.key=t,this.computed=i,this.value=s,this.method=n,this.shorthand=u,this.type="Property"}}class Ae extends q{constructor(e){super(),this.argument=e,this.type="ReturnStatement"}}class xe extends q{constructor(e){super(),this.body=e,this.type="Program"}}class fe extends q{constructor(e,t){super(),this.value=e,this.tail=t,this.type="TemplateElement"}}class Fe extends q{constructor(e,t){super(),this.quasis=e,this.expressions=t,this.type="TemplateLiteral"}}class ye extends q{constructor(e,t){super(),this.operator=e,this.argument=t,this.type="UnaryExpression",this.prefix=!0}}class ge extends q{constructor(e,t,i){super(),this.operator=e,this.argument=t,this.prefix=i,this.type="UpdateExpression"}}class Be extends q{constructor(e,t){super(),this.declarations=e,this.kind=t,this.type="VariableDeclaration"}}class be extends q{constructor(e,t){super(),this.id=e,this.init=t,this.type="VariableDeclarator"}}const Ne={NonAsciiIdentifierStart:/[\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEF\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7C6\uA7F7-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB67\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDE80-\uDE9C\uDEA0-\uDED0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF75\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00\uDE10-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE4\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD23\uDF00-\uDF1C\uDF27\uDF30-\uDF45\uDFE0-\uDFF6]|\uD804[\uDC03-\uDC37\uDC83-\uDCAF\uDCD0-\uDCE8\uDD03-\uDD26\uDD44\uDD50-\uDD72\uDD76\uDD83-\uDDB2\uDDC1-\uDDC4\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE2B\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEDE\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3D\uDF50\uDF5D-\uDF61]|\uD805[\uDC00-\uDC34\uDC47-\uDC4A\uDC5F\uDC80-\uDCAF\uDCC4\uDCC5\uDCC7\uDD80-\uDDAE\uDDD8-\uDDDB\uDE00-\uDE2F\uDE44\uDE80-\uDEAA\uDEB8\uDF00-\uDF1A]|\uD806[\uDC00-\uDC2B\uDCA0-\uDCDF\uDCFF\uDDA0-\uDDA7\uDDAA-\uDDD0\uDDE1\uDDE3\uDE00\uDE0B-\uDE32\uDE3A\uDE50\uDE5C-\uDE89\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC2E\uDC40\uDC72-\uDC8F\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD30\uDD46\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD89\uDD98\uDEE0-\uDEF2]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDED0-\uDEED\uDF00-\uDF2F\uDF40-\uDF43\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF50\uDF93-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB]|\uD838[\uDD00-\uDD2C\uDD37-\uDD3D\uDD4E\uDEC0-\uDEEB]|\uD83A[\uDC00-\uDCC4\uDD00-\uDD43\uDD4B]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]/,NonAsciiIdentifierPart:/[\xAA\xB5\xB7\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0300-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u0483-\u0487\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u05D0-\u05EA\u05EF-\u05F2\u0610-\u061A\u0620-\u0669\u066E-\u06D3\u06D5-\u06DC\u06DF-\u06E8\u06EA-\u06FC\u06FF\u0710-\u074A\u074D-\u07B1\u07C0-\u07F5\u07FA\u07FD\u0800-\u082D\u0840-\u085B\u0860-\u086A\u08A0-\u08B4\u08B6-\u08BD\u08D3-\u08E1\u08E3-\u0963\u0966-\u096F\u0971-\u0983\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BC-\u09C4\u09C7\u09C8\u09CB-\u09CE\u09D7\u09DC\u09DD\u09DF-\u09E3\u09E6-\u09F1\u09FC\u09FE\u0A01-\u0A03\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A59-\u0A5C\u0A5E\u0A66-\u0A75\u0A81-\u0A83\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABC-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AD0\u0AE0-\u0AE3\u0AE6-\u0AEF\u0AF9-\u0AFF\u0B01-\u0B03\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3C-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B5C\u0B5D\u0B5F-\u0B63\u0B66-\u0B6F\u0B71\u0B82\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD0\u0BD7\u0BE6-\u0BEF\u0C00-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C58-\u0C5A\u0C60-\u0C63\u0C66-\u0C6F\u0C80-\u0C83\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBC-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CDE\u0CE0-\u0CE3\u0CE6-\u0CEF\u0CF1\u0CF2\u0D00-\u0D03\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D44\u0D46-\u0D48\u0D4A-\u0D4E\u0D54-\u0D57\u0D5F-\u0D63\u0D66-\u0D6F\u0D7A-\u0D7F\u0D82\u0D83\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E01-\u0E3A\u0E40-\u0E4E\u0E50-\u0E59\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EBD\u0EC0-\u0EC4\u0EC6\u0EC8-\u0ECD\u0ED0-\u0ED9\u0EDC-\u0EDF\u0F00\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E-\u0F47\u0F49-\u0F6C\u0F71-\u0F84\u0F86-\u0F97\u0F99-\u0FBC\u0FC6\u1000-\u1049\u1050-\u109D\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u135D-\u135F\u1369-\u1371\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176C\u176E-\u1770\u1772\u1773\u1780-\u17D3\u17D7\u17DC\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u1820-\u1878\u1880-\u18AA\u18B0-\u18F5\u1900-\u191E\u1920-\u192B\u1930-\u193B\u1946-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u19D0-\u19DA\u1A00-\u1A1B\u1A20-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AA7\u1AB0-\u1ABD\u1B00-\u1B4B\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1BF3\u1C00-\u1C37\u1C40-\u1C49\u1C4D-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CD0-\u1CD2\u1CD4-\u1CFA\u1D00-\u1DF9\u1DFB-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u200C\u200D\u203F\u2040\u2054\u2071\u207F\u2090-\u209C\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D7F-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u2DE0-\u2DFF\u3005-\u3007\u3021-\u302F\u3031-\u3035\u3038-\u303C\u3041-\u3096\u3099-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FEF\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA62B\uA640-\uA66F\uA674-\uA67D\uA67F-\uA6F1\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7C6\uA7F7-\uA827\uA840-\uA873\uA880-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F7\uA8FB\uA8FD-\uA92D\uA930-\uA953\uA960-\uA97C\uA980-\uA9C0\uA9CF-\uA9D9\uA9E0-\uA9FE\uAA00-\uAA36\uAA40-\uAA4D\uAA50-\uAA59\uAA60-\uAA76\uAA7A-\uAAC2\uAADB-\uAADD\uAAE0-\uAAEF\uAAF2-\uAAF6\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB67\uAB70-\uABEA\uABEC\uABED\uABF0-\uABF9\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFE70-\uFE74\uFE76-\uFEFC\uFF10-\uFF19\uFF21-\uFF3A\uFF3F\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]|\uD800[\uDC00-\uDC0B\uDC0D-\uDC26\uDC28-\uDC3A\uDC3C\uDC3D\uDC3F-\uDC4D\uDC50-\uDC5D\uDC80-\uDCFA\uDD40-\uDD74\uDDFD\uDE80-\uDE9C\uDEA0-\uDED0\uDEE0\uDF00-\uDF1F\uDF2D-\uDF4A\uDF50-\uDF7A\uDF80-\uDF9D\uDFA0-\uDFC3\uDFC8-\uDFCF\uDFD1-\uDFD5]|\uD801[\uDC00-\uDC9D\uDCA0-\uDCA9\uDCB0-\uDCD3\uDCD8-\uDCFB\uDD00-\uDD27\uDD30-\uDD63\uDE00-\uDF36\uDF40-\uDF55\uDF60-\uDF67]|\uD802[\uDC00-\uDC05\uDC08\uDC0A-\uDC35\uDC37\uDC38\uDC3C\uDC3F-\uDC55\uDC60-\uDC76\uDC80-\uDC9E\uDCE0-\uDCF2\uDCF4\uDCF5\uDD00-\uDD15\uDD20-\uDD39\uDD80-\uDDB7\uDDBE\uDDBF\uDE00-\uDE03\uDE05\uDE06\uDE0C-\uDE13\uDE15-\uDE17\uDE19-\uDE35\uDE38-\uDE3A\uDE3F\uDE60-\uDE7C\uDE80-\uDE9C\uDEC0-\uDEC7\uDEC9-\uDEE6\uDF00-\uDF35\uDF40-\uDF55\uDF60-\uDF72\uDF80-\uDF91]|\uD803[\uDC00-\uDC48\uDC80-\uDCB2\uDCC0-\uDCF2\uDD00-\uDD27\uDD30-\uDD39\uDF00-\uDF1C\uDF27\uDF30-\uDF50\uDFE0-\uDFF6]|\uD804[\uDC00-\uDC46\uDC66-\uDC6F\uDC7F-\uDCBA\uDCD0-\uDCE8\uDCF0-\uDCF9\uDD00-\uDD34\uDD36-\uDD3F\uDD44-\uDD46\uDD50-\uDD73\uDD76\uDD80-\uDDC4\uDDC9-\uDDCC\uDDD0-\uDDDA\uDDDC\uDE00-\uDE11\uDE13-\uDE37\uDE3E\uDE80-\uDE86\uDE88\uDE8A-\uDE8D\uDE8F-\uDE9D\uDE9F-\uDEA8\uDEB0-\uDEEA\uDEF0-\uDEF9\uDF00-\uDF03\uDF05-\uDF0C\uDF0F\uDF10\uDF13-\uDF28\uDF2A-\uDF30\uDF32\uDF33\uDF35-\uDF39\uDF3B-\uDF44\uDF47\uDF48\uDF4B-\uDF4D\uDF50\uDF57\uDF5D-\uDF63\uDF66-\uDF6C\uDF70-\uDF74]|\uD805[\uDC00-\uDC4A\uDC50-\uDC59\uDC5E\uDC5F\uDC80-\uDCC5\uDCC7\uDCD0-\uDCD9\uDD80-\uDDB5\uDDB8-\uDDC0\uDDD8-\uDDDD\uDE00-\uDE40\uDE44\uDE50-\uDE59\uDE80-\uDEB8\uDEC0-\uDEC9\uDF00-\uDF1A\uDF1D-\uDF2B\uDF30-\uDF39]|\uD806[\uDC00-\uDC3A\uDCA0-\uDCE9\uDCFF\uDDA0-\uDDA7\uDDAA-\uDDD7\uDDDA-\uDDE1\uDDE3\uDDE4\uDE00-\uDE3E\uDE47\uDE50-\uDE99\uDE9D\uDEC0-\uDEF8]|\uD807[\uDC00-\uDC08\uDC0A-\uDC36\uDC38-\uDC40\uDC50-\uDC59\uDC72-\uDC8F\uDC92-\uDCA7\uDCA9-\uDCB6\uDD00-\uDD06\uDD08\uDD09\uDD0B-\uDD36\uDD3A\uDD3C\uDD3D\uDD3F-\uDD47\uDD50-\uDD59\uDD60-\uDD65\uDD67\uDD68\uDD6A-\uDD8E\uDD90\uDD91\uDD93-\uDD98\uDDA0-\uDDA9\uDEE0-\uDEF6]|\uD808[\uDC00-\uDF99]|\uD809[\uDC00-\uDC6E\uDC80-\uDD43]|[\uD80C\uD81C-\uD820\uD840-\uD868\uD86A-\uD86C\uD86F-\uD872\uD874-\uD879][\uDC00-\uDFFF]|\uD80D[\uDC00-\uDC2E]|\uD811[\uDC00-\uDE46]|\uD81A[\uDC00-\uDE38\uDE40-\uDE5E\uDE60-\uDE69\uDED0-\uDEED\uDEF0-\uDEF4\uDF00-\uDF36\uDF40-\uDF43\uDF50-\uDF59\uDF63-\uDF77\uDF7D-\uDF8F]|\uD81B[\uDE40-\uDE7F\uDF00-\uDF4A\uDF4F-\uDF87\uDF8F-\uDF9F\uDFE0\uDFE1\uDFE3]|\uD821[\uDC00-\uDFF7]|\uD822[\uDC00-\uDEF2]|\uD82C[\uDC00-\uDD1E\uDD50-\uDD52\uDD64-\uDD67\uDD70-\uDEFB]|\uD82F[\uDC00-\uDC6A\uDC70-\uDC7C\uDC80-\uDC88\uDC90-\uDC99\uDC9D\uDC9E]|\uD834[\uDD65-\uDD69\uDD6D-\uDD72\uDD7B-\uDD82\uDD85-\uDD8B\uDDAA-\uDDAD\uDE42-\uDE44]|\uD835[\uDC00-\uDC54\uDC56-\uDC9C\uDC9E\uDC9F\uDCA2\uDCA5\uDCA6\uDCA9-\uDCAC\uDCAE-\uDCB9\uDCBB\uDCBD-\uDCC3\uDCC5-\uDD05\uDD07-\uDD0A\uDD0D-\uDD14\uDD16-\uDD1C\uDD1E-\uDD39\uDD3B-\uDD3E\uDD40-\uDD44\uDD46\uDD4A-\uDD50\uDD52-\uDEA5\uDEA8-\uDEC0\uDEC2-\uDEDA\uDEDC-\uDEFA\uDEFC-\uDF14\uDF16-\uDF34\uDF36-\uDF4E\uDF50-\uDF6E\uDF70-\uDF88\uDF8A-\uDFA8\uDFAA-\uDFC2\uDFC4-\uDFCB\uDFCE-\uDFFF]|\uD836[\uDE00-\uDE36\uDE3B-\uDE6C\uDE75\uDE84\uDE9B-\uDE9F\uDEA1-\uDEAF]|\uD838[\uDC00-\uDC06\uDC08-\uDC18\uDC1B-\uDC21\uDC23\uDC24\uDC26-\uDC2A\uDD00-\uDD2C\uDD30-\uDD3D\uDD40-\uDD49\uDD4E\uDEC0-\uDEF9]|\uD83A[\uDC00-\uDCC4\uDCD0-\uDCD6\uDD00-\uDD4B\uDD50-\uDD59]|\uD83B[\uDE00-\uDE03\uDE05-\uDE1F\uDE21\uDE22\uDE24\uDE27\uDE29-\uDE32\uDE34-\uDE37\uDE39\uDE3B\uDE42\uDE47\uDE49\uDE4B\uDE4D-\uDE4F\uDE51\uDE52\uDE54\uDE57\uDE59\uDE5B\uDE5D\uDE5F\uDE61\uDE62\uDE64\uDE67-\uDE6A\uDE6C-\uDE72\uDE74-\uDE77\uDE79-\uDE7C\uDE7E\uDE80-\uDE89\uDE8B-\uDE9B\uDEA1-\uDEA3\uDEA5-\uDEA9\uDEAB-\uDEBB]|\uD869[\uDC00-\uDED6\uDF00-\uDFFF]|\uD86D[\uDC00-\uDF34\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1D\uDC20-\uDFFF]|\uD873[\uDC00-\uDEA1\uDEB0-\uDFFF]|\uD87A[\uDC00-\uDFE0]|\uD87E[\uDC00-\uDE1D]|\uDB40[\uDD00-\uDDEF]/},ke={fromCodePoint:e=>e<65536?String.fromCharCode(e):String.fromCharCode(55296+(e-65536>>10))+String.fromCharCode(56320+(e-65536&1023)),isWhiteSpace:e=>32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].includes(e),isLineTerminator:e=>10===e||13===e||8232===e||8233===e,isIdentifierStart:e=>36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&Ne.NonAsciiIdentifierStart.test(ke.fromCodePoint(e)),isIdentifierPart:e=>36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&Ne.NonAsciiIdentifierPart.test(ke.fromCodePoint(e)),isDecimalDigit:e=>e>=48&&e<=57,isHexDigit:e=>e>=48&&e<=57||e>=65&&e<=70||e>=97&&e<=102,isOctalDigit:e=>e>=48&&e<=55};var Se;!function(e){e[e.BooleanLiteral=1]="BooleanLiteral",e[e.EOF=2]="EOF",e[e.Identifier=3]="Identifier",e[e.Keyword=4]="Keyword",e[e.NullLiteral=5]="NullLiteral",e[e.NumericLiteral=6]="NumericLiteral",e[e.Punctuator=7]="Punctuator",e[e.StringLiteral=8]="StringLiteral",e[e.RegularExpression=9]="RegularExpression",e[e.Template=10]="Template"}(Se||(Se={}));const Te={};function we(e){return"0123456789abcdef".indexOf(e.toLowerCase())}function Ie(e){return"01234567".indexOf(e)}Te[Se.BooleanLiteral]="Boolean",Te[Se.EOF]="<end>",Te[Se.Identifier]="Identifier",Te[Se.Keyword]="Keyword",Te[Se.NullLiteral]="Null",Te[Se.NumericLiteral]="Numeric",Te[Se.Punctuator]="Punctuator",Te[Se.StringLiteral]="String",Te[Se.RegularExpression]="RegularExpression",Te[Se.Template]="Template";class Le{constructor(e,t){this.source=e,this.errorHandler=t,this.trackComment=!1,this.isModule=!1,this.length=e.length,this.index=0,this.lineNumber=e.length>0?1:0,this.lineStart=0,this.curlyStack=[]}saveState(){return{index:this.index,lineNumber:this.lineNumber,lineStart:this.lineStart,curlyStack:this.curlyStack.slice()}}restoreState(e){this.index=e.index,this.lineNumber=e.lineNumber,this.lineStart=e.lineStart,this.curlyStack=e.curlyStack}eof(){return this.index>=this.length}throwUnexpectedToken(e="Unexpected token ILLEGAL"){return this.errorHandler.throwError(this.index,this.lineNumber,this.index-this.lineStart+1,e)}_tolerateUnexpectedToken(e="Unexpected token ILLEGAL"){this.errorHandler.tolerateError(this.index,this.lineNumber,this.index-this.lineStart+1,e)}_skipSingleLineComment(e){let t=[],i=0,s=null;for(this.trackComment&&(t=[],i=this.index-e,s={start:{line:this.lineNumber,column:this.index-this.lineStart-e},end:{line:0,column:0}});!this.eof();){const n=this.source.charCodeAt(this.index);if(++this.index,ke.isLineTerminator(n)){if(s){s.end={line:this.lineNumber,column:this.index-this.lineStart-1};const n={multiLine:!1,slice:[i+e,this.index-1],range:[i,this.index-1],loc:s};t.push(n)}return 13===n&&10===this.source.charCodeAt(this.index)&&++this.index,++this.lineNumber,this.lineStart=this.index,t}}if(s){s.end={line:this.lineNumber,column:this.index-this.lineStart};const n={multiLine:!1,slice:[i+e,this.index],range:[i,this.index],loc:s};t.push(n)}return t}_skipMultiLineComment(){const e=[];let t=0,i=null;for(this.trackComment&&(t=this.index-2,i={start:{line:this.lineNumber,column:this.index-this.lineStart-2},end:{line:0,column:0}});!this.eof();){const s=this.source.charCodeAt(this.index);if(ke.isLineTerminator(s))13===s&&10===this.source.charCodeAt(this.index+1)&&++this.index,++this.lineNumber,++this.index,this.lineStart=this.index;else if(42===s){if(47===this.source.charCodeAt(this.index+1)){if(this.index+=2,i){i.end={line:this.lineNumber,column:this.index-this.lineStart};const s={multiLine:!0,slice:[t+2,this.index-2],range:[t,this.index],loc:i};e.push(s)}return e}++this.index}else++this.index}if(i){i.end={line:this.lineNumber,column:this.index-this.lineStart};const s={multiLine:!0,slice:[t+2,this.index],range:[t,this.index],loc:i};e.push(s)}return this._tolerateUnexpectedToken(),e}scanComments(){let e=null;this.trackComment&&(e=[]);let t=0===this.index;for(;!this.eof();){let i=this.source.charCodeAt(this.index);if(ke.isWhiteSpace(i))++this.index;else if(ke.isLineTerminator(i))++this.index,13===i&&10===this.source.charCodeAt(this.index)&&++this.index,++this.lineNumber,this.lineStart=this.index,t=!0;else if(47===i)if(i=this.source.charCodeAt(this.index+1),47===i){this.index+=2;const i=this._skipSingleLineComment(2);e&&(e=e.concat(i)),t=!0}else{if(42!==i)break;{this.index+=2;const t=this._skipMultiLineComment();e&&(e=e.concat(t))}}else if(t&&45===i){if(45!==this.source.charCodeAt(this.index+1)||62!==this.source.charCodeAt(this.index+2))break;{this.index+=3;const t=this._skipSingleLineComment(3);e&&(e=e.concat(t))}}else{if(60!==i||this.isModule)break;if("!--"!==this.source.slice(this.index+1,this.index+4))break;{this.index+=4;const t=this._skipSingleLineComment(4);e&&(e=e.concat(t))}}}return e}_isKeyword(e){switch((e=e.toLowerCase()).length){case 2:return"if"===e||"in"===e;case 3:return"var"===e||"for"===e;case 4:return"else"===e;case 5:return"break"===e;case 6:return"return"===e;case 8:return"function"===e||"continue"===e;default:return!1}}_codePointAt(e){let t=this.source.charCodeAt(e);if(t>=55296&&t<=56319){const i=this.source.charCodeAt(e+1);i>=56320&&i<=57343&&(t=1024*(t-55296)+i-56320+65536)}return t}_scanHexEscape(e){const t="u"===e?4:2;let i=0;for(let e=0;e<t;++e){if(this.eof()||!ke.isHexDigit(this.source.charCodeAt(this.index)))return null;i=16*i+we(this.source[this.index++])}return String.fromCharCode(i)}_scanUnicodeCodePointEscape(){let e=this.source[this.index],t=0;for("}"===e&&this.throwUnexpectedToken();!this.eof()&&(e=this.source[this.index++],ke.isHexDigit(e.charCodeAt(0)));)t=16*t+we(e);return(t>1114111||"}"!==e)&&this.throwUnexpectedToken(),ke.fromCodePoint(t)}_getIdentifier(){const e=this.index++;for(;!this.eof();){const t=this.source.charCodeAt(this.index);if(92===t)return this.index=e,this._getComplexIdentifier();if(t>=55296&&t<57343)return this.index=e,this._getComplexIdentifier();if(!ke.isIdentifierPart(t))break;++this.index}return this.source.slice(e,this.index)}_getComplexIdentifier(){let e,t=this._codePointAt(this.index),i=ke.fromCodePoint(t);for(this.index+=i.length,92===t&&(117!==this.source.charCodeAt(this.index)&&this.throwUnexpectedToken(),++this.index,"{"===this.source[this.index]?(++this.index,e=this._scanUnicodeCodePointEscape()):(e=this._scanHexEscape("u"),null!==e&&"\\"!==e&&ke.isIdentifierStart(e.charCodeAt(0))||this.throwUnexpectedToken()),i=e);!this.eof()&&(t=this._codePointAt(this.index),ke.isIdentifierPart(t));)e=ke.fromCodePoint(t),i+=e,this.index+=e.length,92===t&&(i=i.substr(0,i.length-1),117!==this.source.charCodeAt(this.index)&&this.throwUnexpectedToken(),++this.index,"{"===this.source[this.index]?(++this.index,e=this._scanUnicodeCodePointEscape()):(e=this._scanHexEscape("u"),null!==e&&"\\"!==e&&ke.isIdentifierPart(e.charCodeAt(0))||this.throwUnexpectedToken()),i+=e);return i}_octalToDecimal(e){let t="0"!==e,i=Ie(e);return!this.eof()&&ke.isOctalDigit(this.source.charCodeAt(this.index))&&(t=!0,i=8*i+Ie(this.source[this.index++]),"0123".includes(e)&&!this.eof()&&ke.isOctalDigit(this.source.charCodeAt(this.index))&&(i=8*i+Ie(this.source[this.index++]))),{code:i,octal:t}}_scanIdentifier(){let e;const t=this.index,i=92===this.source.charCodeAt(t)?this._getComplexIdentifier():this._getIdentifier();if(e=1===i.length?Se.Identifier:this._isKeyword(i)?Se.Keyword:"null"===i.toLowerCase()?Se.NullLiteral:"true"===i.toLowerCase()||"false"===i.toLowerCase()?Se.BooleanLiteral:Se.Identifier,e!==Se.Identifier&&t+i.length!==this.index){const e=this.index;this.index=t,this._tolerateUnexpectedToken("Keyword must not contain escaped characters"),this.index=e}return{type:e,value:i,lineNumber:this.lineNumber,lineStart:this.lineStart,start:t,end:this.index}}_scanPunctuator(){const e=this.index;let t=this.source[this.index];switch(t){case"(":case"{":"{"===t&&this.curlyStack.push("{"),++this.index;break;case".":case")":case";":case",":case"[":case"]":case":":case"?":case"~":++this.index;break;case"}":++this.index,this.curlyStack.pop();break;default:t=this.source.substr(this.index,4),">>>="===t?this.index+=4:(t=t.substr(0,3),"==="===t||"!=="===t||">>>"===t||"<<="===t||">>="===t||"**="===t?this.index+=3:(t=t.substr(0,2),"&&"===t||"||"===t||"=="===t||"!="===t||"+="===t||"-="===t||"*="===t||"/="===t||"++"===t||"--"===t||"<<"===t||">>"===t||"&="===t||"|="===t||"^="===t||"%="===t||"<="===t||">="===t||"=>"===t||"**"===t?this.index+=2:(t=this.source[this.index],"<>=!+-*%&|^/".includes(t)&&++this.index)))}return this.index===e&&this.throwUnexpectedToken(),{type:Se.Punctuator,value:t,lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}}_scanHexLiteral(e){let t="";for(;!this.eof()&&ke.isHexDigit(this.source.charCodeAt(this.index));)t+=this.source[this.index++];return 0===t.length&&this.throwUnexpectedToken(),ke.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:Se.NumericLiteral,value:parseInt("0x"+t,16),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}}_scanBinaryLiteral(e){let t="";for(;!this.eof();){const e=this.source[this.index];if("0"!==e&&"1"!==e)break;t+=this.source[this.index++]}if(0===t.length&&this.throwUnexpectedToken(),!this.eof()){const e=this.source.charCodeAt(this.index);(ke.isIdentifierStart(e)||ke.isDecimalDigit(e))&&this.throwUnexpectedToken()}return{type:Se.NumericLiteral,value:parseInt(t,2),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}}_scanOctalLiteral(e,t){let i="",s=!1;for(ke.isOctalDigit(e.charCodeAt(0))?(s=!0,i="0"+this.source[this.index++]):++this.index;!this.eof()&&ke.isOctalDigit(this.source.charCodeAt(this.index));)i+=this.source[this.index++];return s||0!==i.length||this.throwUnexpectedToken(),(ke.isIdentifierStart(this.source.charCodeAt(this.index))||ke.isDecimalDigit(this.source.charCodeAt(this.index)))&&this.throwUnexpectedToken(),{type:Se.NumericLiteral,value:parseInt(i,8),octal:s,lineNumber:this.lineNumber,lineStart:this.lineStart,start:t,end:this.index}}_scanNumericLiteral(){const e=this.index;let t=this.source[e];J(ke.isDecimalDigit(t.charCodeAt(0))||"."===t,"Numeric literal must start with a decimal digit or a decimal point");let i="";if("."!==t){if(i=this.source[this.index++],t=this.source[this.index],"0"===i){if("x"===t||"X"===t)return++this.index,this._scanHexLiteral(e);if("b"===t||"B"===t)return++this.index,this._scanBinaryLiteral(e);if("o"===t||"O"===t)return this._scanOctalLiteral(t,e)}for(;ke.isDecimalDigit(this.source.charCodeAt(this.index));)i+=this.source[this.index++];t=this.source[this.index]}if("."===t){for(i+=this.source[this.index++];ke.isDecimalDigit(this.source.charCodeAt(this.index));)i+=this.source[this.index++];t=this.source[this.index]}if("e"===t||"E"===t)if(i+=this.source[this.index++],t=this.source[this.index],"+"!==t&&"-"!==t||(i+=this.source[this.index++]),ke.isDecimalDigit(this.source.charCodeAt(this.index)))for(;ke.isDecimalDigit(this.source.charCodeAt(this.index));)i+=this.source[this.index++];else this.throwUnexpectedToken();return ke.isIdentifierStart(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken(),{type:Se.NumericLiteral,value:parseFloat(i),lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}}_scanStringLiteral(){const e=this.index;let t=this.source[e];J("'"===t||'"'===t,"String literal must starts with a quote"),++this.index;let i=!1,s="";for(;!this.eof();){let e=this.source[this.index++];if(e===t){t="";break}if("\\"===e)if(e=this.source[this.index++],e&&ke.isLineTerminator(e.charCodeAt(0)))++this.lineNumber,"\r"===e&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index;else switch(e){case"u":if("{"===this.source[this.index])++this.index,s+=this._scanUnicodeCodePointEscape();else{const t=this._scanHexEscape(e);null===t&&this.throwUnexpectedToken(),s+=t}break;case"x":{const t=this._scanHexEscape(e);null===t&&this.throwUnexpectedToken("Invalid hexadecimal escape sequence"),s+=t;break}case"n":s+="\n";break;case"r":s+="\r";break;case"t":s+="\t";break;case"b":s+="\b";break;case"f":s+="\f";break;case"v":s+="\v";break;case"8":case"9":s+=e,this._tolerateUnexpectedToken();break;default:if(e&&ke.isOctalDigit(e.charCodeAt(0))){const t=this._octalToDecimal(e);i=t.octal||i,s+=String.fromCharCode(t.code)}else s+=e}else{if(ke.isLineTerminator(e.charCodeAt(0)))break;s+=e}}return""!==t&&(this.index=e,this.throwUnexpectedToken()),{type:Se.StringLiteral,value:s,octal:i,lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}}_scanTemplate(){let e="",t=!1;const i=this.index,s="`"===this.source[i];let n=!1,u=2;for(++this.index;!this.eof();){let i=this.source[this.index++];if("`"===i){u=1,n=!0,t=!0;break}if("$"===i){if("{"===this.source[this.index]){this.curlyStack.push("${"),++this.index,t=!0;break}e+=i}else if("\\"===i)if(i=this.source[this.index++],ke.isLineTerminator(i.charCodeAt(0)))++this.lineNumber,"\r"===i&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index;else switch(i){case"n":e+="\n";break;case"r":e+="\r";break;case"t":e+="\t";break;case"u":if("{"===this.source[this.index])++this.index,e+=this._scanUnicodeCodePointEscape();else{const t=this.index,s=this._scanHexEscape(i);null!==s?e+=s:(this.index=t,e+=i)}break;case"x":{const t=this._scanHexEscape(i);null===t&&this.throwUnexpectedToken("Invalid hexadecimal escape sequence"),e+=t;break}case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:"0"===i?(ke.isDecimalDigit(this.source.charCodeAt(this.index))&&this.throwUnexpectedToken("Octal literals are not allowed in template strings."),e+="\0"):ke.isOctalDigit(i.charCodeAt(0))?this.throwUnexpectedToken("Octal literals are not allowed in template strings."):e+=i}else ke.isLineTerminator(i.charCodeAt(0))?(++this.lineNumber,"\r"===i&&"\n"===this.source[this.index]&&++this.index,this.lineStart=this.index,e+="\n"):e+=i}return t||this.throwUnexpectedToken(),s||this.curlyStack.pop(),{type:Se.Template,value:this.source.slice(i+1,this.index-u),cooked:e,head:s,tail:n,lineNumber:this.lineNumber,lineStart:this.lineStart,start:i,end:this.index}}_testRegExp(e,t){let i=e;t.includes("u")&&(i=i.replace(/\\u\{([0-9a-fA-F]+)\}|\\u([a-fA-F0-9]{4})/g,((e,t,i)=>{const s=parseInt(t||i,16);return s>1114111&&this.throwUnexpectedToken("Invalid regular expression"),s<=65535?String.fromCharCode(s):""})).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,""));try{RegExp(i)}catch(e){this.throwUnexpectedToken("Invalid regular expression")}try{return new RegExp(e,t)}catch(e){return null}}_scanRegExpBody(){let e=this.source[this.index];J("/"===e,"Regular expression literal must start with a slash");let t=this.source[this.index++],i=!1,s=!1;for(;!this.eof();)if(e=this.source[this.index++],t+=e,"\\"===e)e=this.source[this.index++],ke.isLineTerminator(e.charCodeAt(0))&&this.throwUnexpectedToken("Invalid regular expression: missing /"),t+=e;else if(ke.isLineTerminator(e.charCodeAt(0)))this.throwUnexpectedToken("Invalid regular expression: missing /");else if(i)"]"===e&&(i=!1);else{if("/"===e){s=!0;break}"["===e&&(i=!0)}return s||this.throwUnexpectedToken("Invalid regular expression: missing /"),t.substr(1,t.length-2)}_scanRegExpFlags(){let e="",t="";for(;!this.eof();){let i=this.source[this.index];if(!ke.isIdentifierPart(i.charCodeAt(0)))break;if(++this.index,"\\"!==i||this.eof())t+=i,e+=i;else if(i=this.source[this.index],"u"===i){++this.index;let i=this.index;const s=this._scanHexEscape("u");if(null!==s)for(t+=s,e+="\\u";i<this.index;++i)e+=this.source[i];else this.index=i,t+="u",e+="\\u";this._tolerateUnexpectedToken()}else e+="\\",this._tolerateUnexpectedToken()}return t}scanRegExp(){const e=this.index,t=this._scanRegExpBody(),i=this._scanRegExpFlags(),s=this._testRegExp(t,i);return{type:Se.RegularExpression,value:"",pattern:t,flags:i,regex:s,lineNumber:this.lineNumber,lineStart:this.lineStart,start:e,end:this.index}}lex(){if(this.eof())return{type:Se.EOF,value:"",lineNumber:this.lineNumber,lineStart:this.lineStart,start:this.index,end:this.index};const e=this.source.charCodeAt(this.index);return ke.isIdentifierStart(e)?this._scanIdentifier():40===e||41===e||59===e?this._scanPunctuator():39===e||34===e?this._scanStringLiteral():46===e?ke.isDecimalDigit(this.source.charCodeAt(this.index+1))?this._scanNumericLiteral():this._scanPunctuator():ke.isDecimalDigit(e)?this._scanNumericLiteral():96===e||125===e&&"${"===this.curlyStack[this.curlyStack.length-1]?this._scanTemplate():e>=55296&&e<57343&&ke.isIdentifierStart(this._codePointAt(this.index))?this._scanIdentifier():this._scanPunctuator()}}class Oe{constructor(e,t={},i){this.config={range:"boolean"==typeof t.range&&t.range,loc:"boolean"==typeof t.loc&&t.loc,source:null,tokens:"boolean"==typeof t.tokens&&t.tokens,comment:"boolean"==typeof t.comment&&t.comment,tolerant:"boolean"==typeof t.tolerant&&t.tolerant,globalReturn:!!t.globalReturn},this.config.loc&&t.source&&null!==t.source&&(this.config.source=String(t.source)),this.delegate=i,this.errorHandler=new K,this.errorHandler.tolerant=this.config.tolerant,this.scanner=new Le(e,this.errorHandler),this.scanner.trackComment=this.config.comment,this.operatorPrecedence={")":0,";":0,",":0,"=":0,"]":0,"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":11,"/":11,"%":11},this.lookahead={type:Se.EOF,value:"",lineNumber:this.scanner.lineNumber,lineStart:0,start:0,end:0},this.hasLineTerminator=!1,this.context={allowIn:!0,firstCoverInitializedNameError:null,isAssignmentTarget:!1,isBindingElement:!1,inFunctionBody:!1,inIteration:!1,curlyParsing:"asObject"},this.tokens=[],this.startMarker={index:0,line:this.scanner.lineNumber,column:0},this.lastMarker={index:0,line:this.scanner.lineNumber,column:0},this.nextToken(),this.lastMarker={index:this.scanner.index,line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}tolerateError(e,...t){const i=t.slice(),s=e.replace(/%(\d)/g,((e,t)=>(J(t<i.length,"Message reference must be in range"),i[t]))),n=this.lastMarker.index,u=this.scanner.lineNumber,r=this.lastMarker.column+1;this.errorHandler.tolerateError(n,u,r,s)}unexpectedTokenError(e,t){let i,s=t||"Unexpected token %0";if(e?(t||(s=e.type===Se.EOF?"Unexpected end of input":e.type===Se.Identifier?"Unexpected identifier":e.type===Se.NumericLiteral?"Unexpected number":e.type===Se.StringLiteral?"Unexpected string":e.type===Se.Template?"Unexpected quasi %0":"Unexpected token %0"),i=e.value.toString()):i="ILLEGAL",s=s.replace("%0",i),e&&"number"==typeof e.lineNumber){const t=e.start,i=e.lineNumber,n=this.lastMarker.index-this.lastMarker.column,u=e.start-n+1;return this.errorHandler.createError(t,i,u,s)}const n=this.lastMarker.index,u=this.lastMarker.line,r=this.lastMarker.column+1;return this.errorHandler.createError(n,u,r,s)}throwUnexpectedToken(e,t){throw this.unexpectedTokenError(e,t)}tolerateUnexpectedToken(e,t){this.errorHandler.tolerate(this.unexpectedTokenError(e,t))}collectComments(){if(this.config.comment){const e=this.scanner.scanComments();if(e&&e.length>0&&this.delegate)for(let t=0;t<e.length;++t){const i=e[t],s=new Z(i.multiLine?"Block":"Line",this.scanner.source.slice(i.slice[0],i.slice[1]));this.config.range&&(s.range=i.range),this.config.loc&&(s.loc=i.loc);const n={start:{line:i.loc.start.line,column:i.loc.start.column,offset:i.range[0]},end:{line:i.loc.end.line,column:i.loc.end.column,offset:i.range[1]}};this.delegate(s,n)}}else this.scanner.scanComments()}peekAhead(e){const t=this.scanner.saveState();e.call(this,(()=>(this.scanner.scanComments(),this.scanner.lex()))),this.scanner.restoreState(t)}getTokenRaw(e){return this.scanner.source.slice(e.start,e.end)}convertToken(e){const t={type:Te[e.type],value:this.getTokenRaw(e)};if(this.config.range&&(t.range=[e.start,e.end]),this.config.loc&&(t.loc={start:{line:this.startMarker.line,column:this.startMarker.column},end:{line:this.scanner.lineNumber,column:this.scanner.index-this.scanner.lineStart}}),e.type===Se.RegularExpression){const i=e.pattern,s=e.flags;t.regex={pattern:i,flags:s}}return t}nextToken(){const e=this.lookahead;this.lastMarker.index=this.scanner.index,this.lastMarker.line=this.scanner.lineNumber,this.lastMarker.column=this.scanner.index-this.scanner.lineStart,this.collectComments(),this.scanner.index!==this.startMarker.index&&(this.startMarker.index=this.scanner.index,this.startMarker.line=this.scanner.lineNumber,this.startMarker.column=this.scanner.index-this.scanner.lineStart);const t=this.scanner.lex();return this.hasLineTerminator=e.lineNumber!==t.lineNumber,this.lookahead=t,this.config.tokens&&t.type!==Se.EOF&&this.tokens.push(this.convertToken(t)),e}createNode(){return{index:this.startMarker.index,line:this.startMarker.line,column:this.startMarker.column}}startNode(e,t=0){let i=e.start-e.lineStart,s=e.lineNumber;return i<0&&(i+=t,s--),{index:e.start,line:s,column:i}}finalize(e,t){if(this.config.range&&(t.range=[e.index,this.lastMarker.index]),this.config.loc&&(t.loc={start:{line:e.line,column:e.column},end:{line:this.lastMarker.line,column:this.lastMarker.column}},this.config.source&&(t.loc.source=this.config.source)),this.delegate){const i={start:{line:e.line,column:e.column,offset:e.index},end:{line:this.lastMarker.line,column:this.lastMarker.column,offset:this.lastMarker.index}};this.delegate(t,i)}return t}expect(e){const t=this.nextToken();t.type===Se.Punctuator&&t.value===e||this.throwUnexpectedToken(t)}expectCommaSeparator(){if(this.config.tolerant){const e=this.lookahead;e.type===Se.Punctuator&&","===e.value?this.nextToken():e.type===Se.Punctuator&&";"===e.value?(this.nextToken(),this.tolerateUnexpectedToken(e)):this.tolerateUnexpectedToken(e,"Unexpected token %0")}else this.expect(",")}expectKeyword(e){const t=this.nextToken();t.type===Se.Keyword&&t.value.toString().toLowerCase()===e.toLowerCase()||this.throwUnexpectedToken(t)}match(e){return this.lookahead.type===Se.Punctuator&&this.lookahead.value===e}matchKeyword(e){return this.lookahead.type===Se.Keyword&&this.lookahead.value.toLowerCase()===e.toLowerCase()}matchContextualKeyword(e){return this.lookahead.type===Se.Identifier&&this.lookahead.value===e}matchAssign(){if(this.lookahead.type!==Se.Punctuator)return!1;const e=this.lookahead.value;return $.includes(e)}isolateCoverGrammar(e){const t=this.context.isBindingElement,i=this.context.isAssignmentTarget,s=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;const n=e.call(this);return null!==this.context.firstCoverInitializedNameError&&this.throwUnexpectedToken(this.context.firstCoverInitializedNameError),this.context.isBindingElement=t,this.context.isAssignmentTarget=i,this.context.firstCoverInitializedNameError=s,n}inheritCoverGrammar(e){const t=this.context.isBindingElement,i=this.context.isAssignmentTarget,s=this.context.firstCoverInitializedNameError;this.context.isBindingElement=!0,this.context.isAssignmentTarget=!0,this.context.firstCoverInitializedNameError=null;const n=e.call(this);return this.context.isBindingElement=this.context.isBindingElement&&t,this.context.isAssignmentTarget=this.context.isAssignmentTarget&&i,this.context.firstCoverInitializedNameError=s||this.context.firstCoverInitializedNameError,n}consumeSemicolon(){this.match(";")?this.nextToken():this.hasLineTerminator||(this.lookahead.type===Se.EOF||this.match("}")||this.throwUnexpectedToken(this.lookahead),this.lastMarker.index=this.startMarker.index,this.lastMarker.line=this.startMarker.line,this.lastMarker.column=this.startMarker.column)}parsePrimaryExpression(){const e=this.createNode();let t,i,s;switch(this.lookahead.type){case Se.Identifier:t=this.finalize(e,new me(this.nextToken().value));break;case Se.NumericLiteral:case Se.StringLiteral:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,i=this.nextToken(),s=this.getTokenRaw(i),t=this.finalize(e,new pe(i.value,s));break;case Se.BooleanLiteral:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,i=this.nextToken(),s=this.getTokenRaw(i),t=this.finalize(e,new pe("true"===i.value.toString().toLowerCase(),s));break;case Se.NullLiteral:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,i=this.nextToken(),s=this.getTokenRaw(i),t=this.finalize(e,new pe(null,s));break;case Se.Template:t=this.parseTemplateLiteral();break;case Se.Punctuator:switch(this.lookahead.value){case"(":this.context.isBindingElement=!1,t=this.inheritCoverGrammar(this.parseGroupExpression);break;case"[":t=this.inheritCoverGrammar(this.parseArrayInitializer);break;case"{":t=this.inheritCoverGrammar(this.parseObjectInitializer);break;default:t=this.throwUnexpectedToken(this.nextToken())}break;case Se.Keyword:this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1,t=this.throwUnexpectedToken(this.nextToken());break;default:t=this.throwUnexpectedToken(this.nextToken())}return t}parseArrayInitializer(){const e=this.createNode(),t=[];for(this.expect("[");!this.match("]");)this.match(",")?(this.nextToken(),t.push(null)):(t.push(this.inheritCoverGrammar(this.parseAssignmentExpression)),this.match("]")||this.expect(","));return this.expect("]"),this.finalize(e,new W(t))}parseObjectPropertyKey(){const e=this.createNode(),t=this.nextToken();let i;switch(t.type){case Se.StringLiteral:case Se.NumericLiteral:i=this.finalize(e,new pe(t.value,this.getTokenRaw(t)));break;case Se.Identifier:case Se.BooleanLiteral:case Se.NullLiteral:case Se.Keyword:i=this.finalize(e,new me(t.value));break;default:i=this.throwUnexpectedToken(t)}return i}parseObjectProperty(){const e=this.createNode(),t=this.lookahead;let i=!1,s=!1,n=null;if(t.type===Se.Identifier){const s=t.value;this.nextToken(),i=this.match("["),n=this.finalize(e,new me(s))}else this.match("*")?this.nextToken():(i=this.match("["),n=this.parseObjectPropertyKey());n||this.throwUnexpectedToken(this.lookahead);let u=null;return this.match(":")?(this.nextToken(),u=this.inheritCoverGrammar(this.parseAssignmentExpression)):t.type===Se.Identifier?(s=!0,u=this.finalize(e,new me(t.value))):this.throwUnexpectedToken(this.nextToken()),this.finalize(e,new Ee("init",n,i,u,!1,s))}parseObjectInitializer(){const e=this.createNode();this.expect("{");const t=[];for(;!this.match("}");)t.push(this.parseObjectProperty()),this.match("}")||this.expectCommaSeparator();return this.expect("}"),this.finalize(e,new Ce(t))}parseTemplateHead(){J(this.lookahead.head,"Template literal must start with a template head");const e=this.createNode(),t=this.nextToken(),i=t.value,s=t.cooked;return this.finalize(e,new fe({raw:i,cooked:s},t.tail))}parseTemplateElement(){this.lookahead.type!==Se.Template&&this.throwUnexpectedToken();const e=this.createNode(),t=this.nextToken(),i=t.value,s=t.cooked;return this.finalize(e,new fe({raw:i,cooked:s},t.tail))}parseTemplateLiteral(){const e=this.createNode(),t=[],i=[];let s=this.parseTemplateHead();for(i.push(s);!s.tail;)t.push(this.parseExpression()),s=this.parseTemplateElement(),i.push(s);return this.finalize(e,new Fe(i,t))}parseGroupExpression(){this.expect("("),this.context.isBindingElement=!0;const e=this.inheritCoverGrammar(this.parseAssignmentExpression);return this.expect(")"),this.context.isBindingElement=!1,e}parseArguments(){this.expect("(");const e=[];if(!this.match(")"))for(;;){const t=this.isolateCoverGrammar(this.parseAssignmentExpression);if(e.push(t),this.match(")"))break;if(this.expectCommaSeparator(),this.match(")"))break}return this.expect(")"),e}isIdentifierName(e){return e.type===Se.Identifier||e.type===Se.Keyword||e.type===Se.BooleanLiteral||e.type===Se.NullLiteral}parseIdentifierName(){const e=this.createNode(),t=this.nextToken();return this.isIdentifierName(t)||this.throwUnexpectedToken(t),this.finalize(e,new me(t.value))}parseLeftHandSideExpressionAllowCall(){const e=this.lookahead,t=this.context.allowIn;this.context.allowIn=!0;let i=this.inheritCoverGrammar(this.parsePrimaryExpression);for(;;)if(this.match("(")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!1;const t=this.parseArguments();i=this.finalize(this.startNode(e),new ne(i,t))}else if(this.match("[")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("[");const t=this.isolateCoverGrammar(this.parseExpression);this.expect("]"),i=this.finalize(this.startNode(e),new ue(i,t))}else{if(!this.match("."))break;{this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect(".");const t=this.parseIdentifierName();i=this.finalize(this.startNode(e),new re(i,t))}}return this.context.allowIn=t,i}parseLeftHandSideExpression(){J(this.context.allowIn,"callee of new expression always allow in keyword.");const e=this.startNode(this.lookahead);let t=this.inheritCoverGrammar(this.parsePrimaryExpression);for(;;)if(this.match("[")){this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect("[");const i=this.isolateCoverGrammar(this.parseExpression);this.expect("]"),t=this.finalize(e,new ue(t,i))}else{if(!this.match("."))break;{this.context.isBindingElement=!1,this.context.isAssignmentTarget=!0,this.expect(".");const i=this.parseIdentifierName();t=this.finalize(e,new re(t,i))}}return t}parseUpdateExpression(){let e;const t=this.lookahead;if(this.match("++")||this.match("--")){const i=this.startNode(t),s=this.nextToken();e=this.inheritCoverGrammar(this.parseUnaryExpression),this.context.isAssignmentTarget||this.tolerateError("Invalid left-hand side in assignment");const n=!0;e=this.finalize(i,new ge(s.value,e,n)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else if(e=this.inheritCoverGrammar(this.parseLeftHandSideExpressionAllowCall),!this.hasLineTerminator&&this.lookahead.type===Se.Punctuator&&(this.match("++")||this.match("--"))){this.context.isAssignmentTarget||this.tolerateError("Invalid left-hand side in assignment"),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;const i=this.nextToken().value,s=!1;e=this.finalize(this.startNode(t),new ge(i,e,s))}return e}parseUnaryExpression(){let e;if(this.match("+")||this.match("-")||this.match("~")||this.match("!")){const t=this.startNode(this.lookahead),i=this.nextToken();e=this.inheritCoverGrammar(this.parseUnaryExpression),e=this.finalize(t,new ye(i.value,e)),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1}else e=this.parseUpdateExpression();return e}binaryPrecedence(e){const t=e.value;let i;return i=e.type===Se.Punctuator?this.operatorPrecedence[t]||0:e.type===Se.Keyword&&this.context.allowIn&&"in"===t?12:0,i}parseBinaryExpression(){const e=this.lookahead;let t=this.inheritCoverGrammar(this.parseUnaryExpression);const i=this.lookahead;let s=this.binaryPrecedence(i);if(s>0){this.nextToken(),this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1;const n=[e,this.lookahead];let u=t,r=this.inheritCoverGrammar(this.parseUnaryExpression);const a=[u,i.value,r],o=[s];for(;s=this.binaryPrecedence(this.lookahead),!(s<=0);){for(;a.length>2&&s<=o[o.length-1];){r=a.pop();const e=a.pop();o.pop(),u=a.pop(),n.pop();const t=n[n.length-1],i=this.startNode(t,t.lineStart);a.push(this.finalize(i,new te(e,u,r)))}a.push(this.nextToken().value),o.push(s),n.push(this.lookahead),a.push(this.inheritCoverGrammar(this.parseUnaryExpression))}let c=a.length-1;t=a[c];let l=n.pop();for(;c>1;){const e=n.pop();if(!e)break;const i=l&&l.lineStart,s=this.startNode(e,i),u=a[c-1];t=this.finalize(s,new te(u,a[c-2],t)),c-=2,l=e}}return t}parseAssignmentExpression(){const e=this.lookahead;let t=e,i=this.inheritCoverGrammar(this.parseBinaryExpression);if(this.matchAssign()){this.context.isAssignmentTarget||this.tolerateError("Invalid left-hand side in assignment"),this.match("=")||(this.context.isAssignmentTarget=!1,this.context.isBindingElement=!1),t=this.nextToken();const s=t.value,n=this.isolateCoverGrammar(this.parseAssignmentExpression);i=this.finalize(this.startNode(e),new Q(s,i,n)),this.context.firstCoverInitializedNameError=null}return i}parseExpression(){return this.isolateCoverGrammar(this.parseAssignmentExpression)}parseStatementListItem(){let e;return this.context.isAssignmentTarget=!0,this.context.isBindingElement=!0,e=this.lookahead.type===Se.Keyword&&"function"===this.lookahead.value?this.parseFunctionDeclaration():this.parseStatement(),e}parseBlock(){const e=this.createNode();this.expect("{");const t=[];for(;!this.match("}");)t.push(this.parseStatementListItem());return this.expect("}"),this.finalize(e,new ie(t))}parseObjectStatement(){const e=this.createNode(),t=this.parseObjectInitializer();return this.finalize(e,new ce(t))}parseBlockOrObjectStatement(){let e="asObject"===this.context.curlyParsing;return"asObjectOrBlock"===this.context.curlyParsing&&this.peekAhead((t=>{let i=t();i.type!==Se.Identifier&&i.type!==Se.StringLiteral||(i=t(),i.type===Se.Punctuator&&":"===i.value&&(e=!0))})),e?this.parseObjectStatement():this.parseBlock()}parseVariableIdentifier(){const e=this.createNode(),t=this.nextToken();return t.type!==Se.Identifier&&this.throwUnexpectedToken(t,"Identifier expected"),this.finalize(e,new me(t.value))}parseVariableDeclaration(e){const t=this.createNode(),i=this.parseVariableIdentifier();let s=null;return this.match("=")?(this.nextToken(),s=this.isolateCoverGrammar(this.parseAssignmentExpression)):"Identifier"===i.type||e.inFor||this.expect("="),this.finalize(t,new be(i,s))}parseVariableDeclarationList(e){const t=[this.parseVariableDeclaration(e)];for(;this.match(",");)this.nextToken(),t.push(this.parseVariableDeclaration(e));return t}parseVariableStatement(){const e=this.createNode();this.expectKeyword("var");const t=this.parseVariableDeclarationList({inFor:!1});return this.consumeSemicolon(),this.finalize(e,new Be(t,"var"))}parseEmptyStatement(){const e=this.createNode();return this.expect(";"),this.finalize(e,new oe)}parseExpressionStatement(){const e=this.createNode(),t=this.parseExpression();return this.consumeSemicolon(),this.finalize(e,new ce(t))}parseIfClause(){const e=this.context.curlyParsing;this.context.curlyParsing="asObjectOrBlock";const t=this.parseStatement();return this.context.curlyParsing=e,t}parseIfStatement(){const e=this.createNode();let t,i=null;this.expectKeyword("if"),this.expect("(");const s=this.parseExpression();return!this.match(")")&&this.config.tolerant?(this.tolerateUnexpectedToken(this.nextToken()),t=this.finalize(this.createNode(),new oe)):(this.expect(")"),t=this.parseIfClause(),this.matchKeyword("else")&&(this.nextToken(),i=this.parseIfClause())),this.finalize(e,new de(s,t,i))}parseForStatement(){let e=null,t=null,i=null,s=null,n=null;const u=this.createNode();if(this.expectKeyword("for"),this.expect("("),this.match(";"))this.nextToken();else if(this.matchKeyword("var")){const t=this.createNode();this.nextToken();const i=this.context.allowIn;this.context.allowIn=!1;const u=this.parseVariableDeclarationList({inFor:!0});this.context.allowIn=i,1===u.length&&this.matchKeyword("in")?(u[0].init&&this.tolerateError("%0 loop variable declaration may not have an initializer","for-in"),s=this.finalize(t,new Be(u,"var")),this.nextToken(),n=this.parseExpression()):(e=this.finalize(t,new Be(u,"var")),this.expect(";"))}else{const t=this.context.isBindingElement,i=this.context.isAssignmentTarget,u=this.context.firstCoverInitializedNameError,r=this.context.allowIn;this.context.allowIn=!1,e=this.inheritCoverGrammar(this.parseAssignmentExpression),this.context.allowIn=r,this.matchKeyword("in")?(this.context.isAssignmentTarget&&"AssignmentExpression"!==e.type||this.tolerateError("Invalid left-hand side in for-in"),this.nextToken(),s=e,n=this.parseExpression(),e=null):(this.context.isBindingElement=t,this.context.isAssignmentTarget=i,this.context.firstCoverInitializedNameError=u,this.expect(";"))}let r;if(s||(this.match(";")||(t=this.isolateCoverGrammar(this.parseExpression)),this.expect(";"),this.match(")")||(i=this.isolateCoverGrammar(this.parseExpression))),!this.match(")")&&this.config.tolerant)this.tolerateUnexpectedToken(this.nextToken()),r=this.finalize(this.createNode(),new oe);else{this.expect(")");const e=this.context.inIteration,t=this.context.curlyParsing;this.context.inIteration=!0,this.context.curlyParsing="asObjectOrBlock",r=this.isolateCoverGrammar(this.parseStatement),this.context.curlyParsing=t,this.context.inIteration=e}return s&&n?this.finalize(u,new le(s,n,r)):this.finalize(u,new he(e,t,i,r))}parseContinueStatement(){const e=this.createNode();return this.expectKeyword("continue"),this.consumeSemicolon(),this.finalize(e,new ae)}parseBreakStatement(){const e=this.createNode();return this.expectKeyword("break"),this.consumeSemicolon(),this.finalize(e,new se)}parseReturnStatement(){this.config.globalReturn||this.context.inFunctionBody||this.tolerateError("Illegal return statement");const e=this.createNode();this.expectKeyword("return");const t=(this.match(";")||this.match("}")||this.hasLineTerminator||this.lookahead.type===Se.EOF)&&this.lookahead.type!==Se.StringLiteral&&this.lookahead.type!==Se.Template?null:this.parseExpression();return this.consumeSemicolon(),this.finalize(e,new Ae(t))}parseStatement(){let e;switch(this.lookahead.type){case Se.BooleanLiteral:case Se.NullLiteral:case Se.NumericLiteral:case Se.StringLiteral:case Se.Template:case Se.Identifier:e=this.parseExpressionStatement();break;case Se.Punctuator:{const t=this.lookahead.value;e="{"===t?this.parseBlockOrObjectStatement():"("===t?this.parseExpressionStatement():";"===t?this.parseEmptyStatement():this.parseExpressionStatement();break}case Se.Keyword:switch(this.lookahead.value.toLowerCase()){case"break":e=this.parseBreakStatement();break;case"continue":e=this.parseContinueStatement();break;case"for":e=this.parseForStatement();break;case"function":e=this.parseFunctionDeclaration();break;case"if":e=this.parseIfStatement();break;case"return":e=this.parseReturnStatement();break;case"var":e=this.parseVariableStatement();break;default:e=this.parseExpressionStatement()}break;default:e=this.throwUnexpectedToken(this.lookahead)}return e}parseFunctionSourceElements(){const e=this.createNode();this.expect("{");const t=this.context.inIteration,i=this.context.inFunctionBody;this.context.inIteration=!1,this.context.inFunctionBody=!0;const s=[];for(;this.lookahead.type!==Se.EOF&&!this.match("}");)s.push(this.parseStatementListItem());return this.expect("}"),this.context.inIteration=t,this.context.inFunctionBody=i,this.finalize(e,new ie(s))}parseFormalParameters(){const e=[];if(this.expect("("),!this.match(")"))for(;this.lookahead.type!==Se.EOF&&(e.push(this.parseVariableIdentifier()),!this.match(")"))&&(this.expect(","),!this.match(")")););return this.expect(")"),e}parseFunctionDeclaration(){const e=this.createNode();this.expectKeyword("function");const t=this.parseVariableIdentifier(),i=this.parseFormalParameters(),s=this.parseFunctionSourceElements();return this.finalize(e,new De(t,i,s))}parseScript(){const e=this.createNode(),t=[];for(;this.lookahead.type!==Se.EOF;)t.push(this.parseStatementListItem());return this.finalize(e,new xe(t))}}function ve(e,t,i){let s=null;const n=(e,t)=>{i&&i(e,t),s&&s.visit(e,t)};let u="function"==typeof i?n:void 0,r=!1;if(t){r="boolean"==typeof t.comment&&t.comment;const e="boolean"==typeof t.attachComment&&t.attachComment;(r||e)&&(s=new H,s.attach=e,t.comment=!0,u=n)}const a=new Oe(e,t,u),o=a.parseScript();return r&&s&&(o.comments=s.comments),a.config.tokens&&(o.tokens=a.tokens),a.config.tolerant&&(o.errors=a.errorHandler.errors),o}function _e(e,t=[]){const i=ve("function _() { "+e+"\n}");if(null===i.body||void 0===i.body)throw new Error("No formula provided.");if(0===i.body.length)throw new Error("No formula provided.");if(0===i.body.length)throw new Error("No formula provided.");if("BlockStatement"!==i.body[0].body.type)throw new Error("Invalid formula content.");const s=Y(i);if(""!==s)throw new Error(s);return X(i,t),i}function Ue(e,t,i,s,n){const u=[],r="function _() { \n".length-1,a="function _() { \n"+e+"\n}";try{const e=ve(a,{tolerant:!0,loc:!0,range:!0}),o=e.errors;if(o.length>0)for(let e=0;e<o.length;e++)u.push({line:o[e].lineNumber-2,character:o[e].column,reason:o[e].description});const c=function(e,t,i,s="async",n=g){const u=[];if("BlockStatement"!==e.body[0].body.type)return[{line:0,character:0,reason:"Invalid Body"}];null==t&&(t={vars:{},customFunctions:[]});const r={globalScope:P(t.vars,n,t.customFunctions,s),localScope:null};try{V(e.body[0].body,r,i,u)}catch(e){}return u}(e,t,i,s,n);for(let e=0;e<c.length;e++)c[e].line=c[e].line-2,c[e].range&&(c[e].range=[c[e][0]-r,c[e][1]-r]),c[e].loc&&(c[e].loc.start.line=c[e].loc.start.line-2,c[e].loc.end.line=c[e].loc.end.line-2),u.push(c[e])}catch(e){try{if("Unexpected token }"===e.description){const t=a.split("\n").length;e.lineNumber===t?(e.index=a.length-1,u.push({line:e.lineNumber-4,character:e.column,reason:"Unexpected end of script"})):(e.index=a.length-1,u.push({line:e.lineNumber-2,character:e.column,reason:"Unexpected end of script"}))}else u.push({line:e.lineNumber-2,character:e.column,reason:e.description})}catch(e){}}return u}function Re(e,t){return U(e)}function Pe(e,t,i){return G(e,t,i)}function Ge(e){return function(e){const t=[];return I(e,(e=>{if("CallExpression"===e.type){if("Identifier"===e.callee.type&&"expects"===e.callee.name.toLowerCase()){let i="";for(let s=0;s<(e.arguments||[]).length;s++)0===s?"Identifier"===e.arguments[s].type&&(i=e.arguments[s].name.toLowerCase()):i&&"Literal"===e.arguments[s].type&&N(e.arguments[s].value)&&t.push(i+"."+e.arguments[s].value.toLowerCase());return!1}if("Identifier"===e.callee.type&&["domainname","domaincode","domain","haskey"].includes(e.callee.name.toLowerCase())&&e.arguments.length>=2){let i="";return"Identifier"===e.arguments[0].type&&(i=e.arguments[0].name.toLowerCase()),i&&"Literal"===e.arguments[1].type&&N(e.arguments[1].value)&&t.push(i+"."+e.arguments[1].value.toLowerCase()),!1}}return"MemberExpression"!==e.type||"Identifier"!==e.object.type||(!1===e.computed&&e.object&&e.object.name&&e.property&&"Identifier"===e.property.type&&e.property.name?t.push(e.object.name.toLowerCase()+"."+e.property.name.toLowerCase()):e.object&&e.object.name&&e.property&&"Literal"===e.property.type&&"string"==typeof e.property.value&&t.push(e.object.name.toLowerCase()+"."+e.property.value.toString().toLowerCase()),!1)})),t}(e)}export{F as D,y as F,k as a,_ as b,Ge as c,j as d,Re as e,X as f,U as g,G as h,M as n,_e as p,v as r,Ue as s,Pe as v};
