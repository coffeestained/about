/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{version as n}from"../kernel.js";import{g as t,h as r,i as e,j as o,k as i,l as s,s as l}from"./arcadeUtils.js";import{z as u,p as a,j as c,h as f,l as m,o as p,x as g,R as d,n as w,C as h,B as y,D as A,f as j,g as E}from"./languageUtils.js";import I from"../geometry/Extent.js";import F from"../geometry/Geometry.js";import{disjoint as R,intersects as b,touches as x,crosses as N,within as S,contains as U,overlaps as k,equals as z,relate as O,intersect as M,union as P,difference as C,symmetricDifference as Z,clip as D,cut as T,planarArea as v,geodesicArea as L,planarLength as J,geodesicLength as V,distance as q,densify as G,geodesicDensify as W,generalize as B,buffer as Q,geodesicBuffer as H,offset as K,rotate as X,simplify as Y,isSimple as $}from"../geometry/geometryEngineAsync.js";import _ from"../geometry/Multipoint.js";import nn from"../geometry/Point.js";import tn from"../geometry/Polygon.js";import rn from"../geometry/Polyline.js";import{fromJSON as en}from"../geometry/support/jsonUtils.js";import{f as on}from"./unitUtils.js";import"../core/lang.js";import"./maybe.js";import"../core/urlUtils.js";import"../config.js";import"./object.js";import"../core/Error.js";import"./Logger.js";import"./string.js";import"../geometry.js";import"./ensureType.js";import"../geometry/SpatialReference.js";import"./tslib.es6.js";import"../core/JSONSupport.js";import"../core/Accessor.js";import"./get.js";import"./utils.js";import"./handleUtils.js";import"../core/accessorSupport/decorators/subclass.js";import"./metadata.js";import"./tracking.js";import"./ArrayPool.js";import"../core/accessorSupport/decorators/property.js";import"./watch.js";import"../core/scheduling.js";import"./nextTick.js";import"../core/promiseUtils.js";import"./writer.js";import"./typeUtils.js";import"./jsonMap.js";import"../geometry/support/webMercatorUtils.js";import"./Ellipsoid.js";import"./reader.js";import"./zmUtils.js";import"../core/accessorSupport/decorators/cast.js";import"./extentUtils.js";import"./parser.js";import"./featureConversionUtils.js";import"./OptimizedGeometry.js";import"./OptimizedFeatureSet.js";import"./locale.js";import"./datetime.js";import"./number.js";import"./sizeVariableUtils.js";import"../layers/support/Field.js";import"./enumeration.js";import"./domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"./fieldType.js";import"../core/workers/workers.js";import"../core/workers/Connection.js";import"./Queue.js";import"../core/workers/RemoteClient.js";import"./assets.js";import"../request.js";import"../intl.js";import"./number2.js";import"./messages.js";import"./projectionEllipsoid.js";function sn(t){return 0===n.indexOf("4.")?tn.fromExtent(t):new tn({spatialReference:t.spatialReference,rings:[[[t.xmin,t.ymin],[t.xmin,t.ymax],[t.xmax,t.ymax],[t.xmax,t.ymin],[t.xmin,t.ymin]]]})}function ln(n){if(a(n,2,2),n[0]instanceof F&&n[1]instanceof F);else if(n[0]instanceof F&&null===n[1]);else if(n[1]instanceof F&&null===n[0]);else if(null!==n[0]||null!==n[1])throw new Error("Illegal Argument")}async function un(n,t){if("polygon"!==n.type&&"polyline"!==n.type&&"extent"!==n.type)return 0;let r=1;(n.spatialReference.vcsWkid||n.spatialReference.latestVcsWkid)&&(r=s(n.spatialReference)/on(n.spatialReference));let e=0;if("polyline"===n.type)for(const t of n.paths)for(let n=1;n<t.length;n++)e+=l(t[n],t[n-1],r);else if("polygon"===n.type)for(const t of n.rings){for(let n=1;n<t.length;n++)e+=l(t[n],t[n-1],r);(t[0][0]!==t[t.length-1][0]||t[0][1]!==t[t.length-1][1]||void 0!==t[0][2]&&t[0][2]!==t[t.length-1][2])&&(e+=l(t[0],t[t.length-1],r))}else"extent"===n.type&&(e+=2*l([n.xmin,n.ymin,0],[n.xmax,n.ymin,0],r),e+=2*l([n.xmin,n.ymin,0],[n.xmin,n.ymax,0],r),e*=2,e+=4*Math.abs(w(n.zmax,0)*r-w(n.zmin,0)*r));const o=new rn({hasZ:!1,hasM:!1,spatialReference:n.spatialReference,paths:[[0,0],[0,e]]});return J(o,t)}function an(n){"async"===n.mode&&(n.functions.disjoint=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){return ln(r=u(r)),null===r[0]||null===r[1]||R(r[0],r[1])}))},n.functions.intersects=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){return ln(r=u(r)),null!==r[0]&&null!==r[1]&&b(r[0],r[1])}))},n.functions.touches=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){return ln(r=u(r)),null!==r[0]&&null!==r[1]&&x(r[0],r[1])}))},n.functions.crosses=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){return ln(r=u(r)),null!==r[0]&&null!==r[1]&&N(r[0],r[1])}))},n.functions.within=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){return ln(r=u(r)),null!==r[0]&&null!==r[1]&&S(r[0],r[1])}))},n.functions.contains=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){return ln(r=u(r)),null!==r[0]&&null!==r[1]&&U(r[0],r[1])}))},n.functions.overlaps=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){return ln(r=u(r)),null!==r[0]&&null!==r[1]&&k(r[0],r[1])}))},n.functions.equals=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){return a(r,2,2),r[0]===r[1]||(r[0]instanceof F&&r[1]instanceof F?z(r[0],r[1]):!(!c(r[0])||!c(r[1]))&&r[0].getTime()===r[1].getTime())}))},n.functions.relate=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){if(r=u(r),a(r,3,3),r[0]instanceof F&&r[1]instanceof F)return O(r[0],r[1],f(r[2]));if(r[0]instanceof F&&null===r[1])return!1;if(r[1]instanceof F&&null===r[0])return!1;if(null===r[0]&&null===r[1])return!1;throw new Error("Illegal Argument")}))},n.functions.intersection=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){return ln(r=u(r)),null===r[0]||null===r[1]?null:M(r[0],r[1])}))},n.functions.union=function(r,e){return n.standardFunctionAsync(r,e,(function(n,e,o){const i=[];if(0===(o=u(o)).length)throw new Error("Function called with wrong number of Parameters");if(1===o.length)if(m(o[0])){const n=u(o[0]);for(let t=0;t<n.length;t++)if(null!==n[t]){if(!(n[t]instanceof F))throw new Error("Illegal Argument");i.push(n[t])}}else{if(!p(o[0])){if(o[0]instanceof F)return g(t(o[0]),r.spatialReference);if(null===o[0])return null;throw new Error("Illegal Argument")}{const n=u(o[0].toArray());for(let t=0;t<n.length;t++)if(null!==n[t]){if(!(n[t]instanceof F))throw new Error("Illegal Argument");i.push(n[t])}}}else for(let n=0;n<o.length;n++)if(null!==o[n]){if(!(o[n]instanceof F))throw new Error("Illegal Argument");i.push(o[n])}return 0===i.length?null:P(i)}))},n.functions.difference=function(r,e){return n.standardFunctionAsync(r,e,(function(n,r,e){return ln(e=u(e)),null!==e[0]&&null===e[1]?t(e[0]):null===e[0]?null:C(e[0],e[1])}))},n.functions.symmetricdifference=function(r,e){return n.standardFunctionAsync(r,e,(function(n,r,e){return ln(e=u(e)),null===e[0]&&null===e[1]?null:null===e[0]?t(e[1]):null===e[1]?t(e[0]):Z(e[0],e[1])}))},n.functions.clip=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){if(r=u(r),a(r,2,2),!(r[1]instanceof I)&&null!==r[1])throw new Error("Illegal Argument");if(null===r[0])return null;if(!(r[0]instanceof F))throw new Error("Illegal Argument");return null===r[1]?null:D(r[0],r[1])}))},n.functions.cut=function(r,e){return n.standardFunctionAsync(r,e,(function(n,r,e){if(e=u(e),a(e,2,2),!(e[1]instanceof rn)&&null!==e[1])throw new Error("Illegal Argument");if(null===e[0])return[];if(!(e[0]instanceof F))throw new Error("Illegal Argument");return null===e[1]?[t(e[0])]:T(e[0],e[1])}))},n.functions.area=function(t,e){return n.standardFunctionAsync(t,e,(async function(n,e,o){if(a(o,1,2),null===(o=u(o))[0])return 0;if(d(o[0])){const n=await o[0].sumArea(r(w(o[1],-1)),!1,t.abortSignal);if(t.abortSignal.aborted)throw new Error("Operation has been cancelled.");return n}if(m(o[0])||p(o[0])){const n=h(o[0],t.spatialReference);return null===n?0:v(n,r(w(o[1],-1)))}if(!(o[0]instanceof F))throw new Error("Illegal Argument");return v(o[0],r(w(o[1],-1)))}))},n.functions.areageodetic=function(t,e){return n.standardFunctionAsync(t,e,(async function(n,e,o){if(a(o,1,2),null===(o=u(o))[0])return 0;if(d(o[0])){const n=await o[0].sumArea(r(w(o[1],-1)),!0,t.abortSignal);if(t.abortSignal.aborted)throw new Error("Operation has been cancelled.");return n}if(m(o[0])||p(o[0])){const n=h(o[0],t.spatialReference);return null===n?0:L(n,r(w(o[1],-1)))}if(!(o[0]instanceof F))throw new Error("Illegal Argument");return L(o[0],r(w(o[1],-1)))}))},n.functions.length=function(t,r){return n.standardFunctionAsync(t,r,(async function(n,r,o){if(a(o,1,2),null===(o=u(o))[0])return 0;if(d(o[0])){const n=await o[0].sumLength(e(w(o[1],-1)),!1,t.abortSignal);if(t.abortSignal.aborted)throw new Error("Operation has been cancelled.");return n}if(m(o[0])||p(o[0])){const n=y(o[0],t.spatialReference);return null===n?0:J(n,e(w(o[1],-1)))}if(!(o[0]instanceof F))throw new Error("Illegal Argument");return J(o[0],e(w(o[1],-1)))}))},n.functions.length3d=function(t,r){return n.standardFunctionAsync(t,r,(function(n,r,o){if(a(o,1,2),null===(o=u(o))[0])return 0;if(m(o[0])||p(o[0])){const n=y(o[0],t.spatialReference);return null===n?0:!0===n.hasZ?un(n,e(w(o[1],-1))):J(n,e(w(o[1],-1)))}if(!(o[0]instanceof F))throw new Error("Illegal Argument");return!0===o[0].hasZ?un(o[0],e(w(o[1],-1))):J(o[0],e(w(o[1],-1)))}))},n.functions.lengthgeodetic=function(t,r){return n.standardFunctionAsync(t,r,(async function(n,r,o){if(a(o,1,2),null===(o=u(o))[0])return 0;if(d(o[0])){const n=await o[0].sumLength(e(w(o[1],-1)),!0,t.abortSignal);if(t.abortSignal.aborted)throw new Error("Operation has been cancelled.");return n}if(m(o[0])||p(o[0])){const n=y(o[0],t.spatialReference);return null===n?0:V(n,e(w(o[1],-1)))}if(!(o[0]instanceof F))throw new Error("Illegal Argument");return V(o[0],e(w(o[1],-1)))}))},n.functions.distance=function(t,r){return n.standardFunctionAsync(t,r,(function(n,r,o){o=u(o),a(o,2,3);let i=o[0];(m(o[0])||p(o[0]))&&(i=A(o[0],t.spatialReference));let s=o[1];if((m(o[1])||p(o[1]))&&(s=A(o[1],t.spatialReference)),!(i instanceof F))throw new Error("Illegal Argument");if(!(s instanceof F))throw new Error("Illegal Argument");return q(i,s,e(w(o[2],-1)))}))},n.functions.distancegeodetic=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){r=u(r),a(r,2,3);const o=r[0],i=r[1];if(!(o instanceof nn))throw new Error("Illegal Argument");if(!(i instanceof nn))throw new Error("Illegal Argument");const s=new rn({paths:[],spatialReference:o.spatialReference});return s.addPath([o,i]),V(s,e(w(r[2],-1)))}))},n.functions.densify=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){if(r=u(r),a(r,2,3),null===r[0])return null;if(!(r[0]instanceof F))throw new Error("Illegal Argument");const o=j(r[1]);if(isNaN(o))throw new Error("Illegal Argument");if(o<=0)throw new Error("Illegal Argument");return r[0]instanceof tn||r[0]instanceof rn?G(r[0],o,e(w(r[2],-1))):r[0]instanceof I?G(sn(r[0]),o,e(w(r[2],-1))):r[0]}))},n.functions.densifygeodetic=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){if(r=u(r),a(r,2,3),null===r[0])return null;if(!(r[0]instanceof F))throw new Error("Illegal Argument");const o=j(r[1]);if(isNaN(o))throw new Error("Illegal Argument");if(o<=0)throw new Error("Illegal Argument");return r[0]instanceof tn||r[0]instanceof rn?W(r[0],o,e(w(r[2],-1))):r[0]instanceof I?W(sn(r[0]),o,e(w(r[2],-1))):r[0]}))},n.functions.generalize=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){if(r=u(r),a(r,2,4),null===r[0])return null;if(!(r[0]instanceof F))throw new Error("Illegal Argument");const o=j(r[1]);if(isNaN(o))throw new Error("Illegal Argument");return B(r[0],o,E(w(r[2],!0)),e(w(r[3],-1)))}))},n.functions.buffer=function(r,o){return n.standardFunctionAsync(r,o,(function(n,r,o){if(o=u(o),a(o,2,3),null===o[0])return null;if(!(o[0]instanceof F))throw new Error("Illegal Argument");const i=j(o[1]);if(isNaN(i))throw new Error("Illegal Argument");return 0===i?t(o[0]):Q(o[0],i,e(w(o[2],-1)))}))},n.functions.buffergeodetic=function(r,o){return n.standardFunctionAsync(r,o,(function(n,r,o){if(o=u(o),a(o,2,3),null===o[0])return null;if(!(o[0]instanceof F))throw new Error("Illegal Argument");const i=j(o[1]);if(isNaN(i))throw new Error("Illegal Argument");return 0===i?t(o[0]):H(o[0],i,e(w(o[2],-1)))}))},n.functions.offset=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){if(r=u(r),a(r,2,6),null===r[0])return null;if(!(r[0]instanceof tn||r[0]instanceof rn))throw new Error("Illegal Argument");const o=j(r[1]);if(isNaN(o))throw new Error("Illegal Argument");const i=j(w(r[4],10));if(isNaN(i))throw new Error("Illegal Argument");const s=j(w(r[5],0));if(isNaN(s))throw new Error("Illegal Argument");return K(r[0],o,e(w(r[2],-1)),f(w(r[3],"round")).toLowerCase(),i,s)}))},n.functions.rotate=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){r=u(r),a(r,2,3);let e=r[0];if(null===e)return null;if(!(e instanceof F))throw new Error("Illegal Argument");e instanceof I&&(e=tn.fromExtent(e));const o=j(r[1]);if(isNaN(o))throw new Error("Illegal Argument");const i=w(r[2],null);if(null===i)return X(e,o);if(i instanceof nn)return X(e,o,i);throw new Error("Illegal Argument")}))},n.functions.centroid=function(r,e){return n.standardFunctionAsync(r,e,(function(n,e,s){if(s=u(s),a(s,1,1),null===s[0])return null;let l=s[0];if((m(s[0])||p(s[0]))&&(l=A(s[0],r.spatialReference)),null===l)return null;if(!(l instanceof F))throw new Error("Illegal Argument");return l instanceof nn?g(t(s[0]),r.spatialReference):l instanceof tn?l.centroid:l instanceof rn?o(l):l instanceof _?i(l):l instanceof I?l.center:null}))},n.functions.multiparttosinglepart=function(r,e){return n.standardFunctionAsync(r,e,(async function(n,e,o){o=u(o),a(o,1,1);const i=[];if(null===o[0])return null;if(!(o[0]instanceof F))throw new Error("Illegal Argument");if(o[0]instanceof nn)return[g(t(o[0]),r.spatialReference)];if(o[0]instanceof I)return[g(t(o[0]),r.spatialReference)];const s=await Y(o[0]);if(s instanceof tn){const n=[],t=[];for(let r=0;r<s.rings.length;r++)if(s.isClockwise(s.rings[r])){const t=en({rings:[s.rings[r]],hasZ:!0===s.hasZ,hazM:!0===s.hasM,spatialReference:s.spatialReference.toJSON()});n.push(t)}else t.push({ring:s.rings[r],pt:s.getPoint(r,0)});for(let r=0;r<t.length;r++)for(let e=0;e<n.length;e++)if(n[e].contains(t[r].pt)){n[e].addRing(t[r].ring);break}return n}if(s instanceof rn){const n=[];for(let t=0;t<s.paths.length;t++){const r=en({paths:[s.paths[t]],hasZ:!0===s.hasZ,hazM:!0===s.hasM,spatialReference:s.spatialReference.toJSON()});n.push(r)}return n}if(o[0]instanceof _){const n=g(t(o[0]),r.spatialReference);for(let t=0;t<n.points.length;t++)i.push(n.getPoint(t));return i}return null}))},n.functions.issimple=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){if(r=u(r),a(r,1,1),null===r[0])return!0;if(!(r[0]instanceof F))throw new Error("Illegal Argument");return $(r[0])}))},n.functions.simplify=function(t,r){return n.standardFunctionAsync(t,r,(function(n,t,r){if(r=u(r),a(r,1,1),null===r[0])return null;if(!(r[0]instanceof F))throw new Error("Illegal Argument");return Y(r[0])}))})}export{an as registerFunctions};
