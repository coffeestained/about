/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{i as t}from"./maybe.js";import{f as e}from"./unitUtils.js";import{c as s,s as o}from"./mat4.js";import{s as i,h as r,j as n,a,n as c,k as l}from"./mathUtils.js";import{projectPointToVector as u,projectVectorToVector as m,projectVectorToDehydratedPoint as f,projectVectorToPoint as p}from"../geometry/projection.js";import d from"../geometry/SpatialReference.js";import{A as h,f as v,s as y}from"./sphere.js";import{c as S,g as j}from"./projectionEllipsoid.js";import{f as A,b as R}from"./boundedPlane.js";import{i as g}from"./plane.js";import{s as w}from"./vectorStacks.js";import{i as M}from"./ElevationProvider.js";import{V as P}from"./ViewingMode.js";import{i as b}from"./spatialReferenceSupport.js";function x(t,e,s=function(t){return{operations:t,value:t.create()}}(t)){return s.operations=t,t.copy(e,s.value),s}function _(t,e,s,o){return t.operations.setAltitudeAt(t.value,e,s,o)}function C(t,e,s){return t.operations.elevate(t.value,e,s.value)}const G=r();function B(t,e,s,o,i){return i[0]=n(t,e),i[1]=n(t,s),i[2]=n(t,o),i}function U(t,e,s,o,i){a(s,t),a(k,e),c(k,k),l(o,k,s),l(i,o,s)}function E(t,e){return t?S(e):e.isGeographic?d.PlateCarree:e}const k=r();class I{constructor(t,e,s,o){this.viewingMode=t,this.spatialReference=e,this.unitInMeters=s,this.coordinateSystem=o,this._coordinateSystem=function(t){const{value:e,operations:s}=t;return{operations:s,value:s.create(e)}}(o)}set extent(t){t&&function(t,e,s){t.operations.setExtent(t.value,e,s.value)}(this.coordinateSystem,t,this.coordinateSystem)}getAltitude(t){return s=t,(e=this.coordinateSystem).operations.altitudeAt(e.value,s);var e,s}setAltitude(t,e,s=t){return _(this.coordinateSystem,s,e,t)}setAltitudeOfTransformation(t,e){!function(t,e,o,r){e!==r&&s(r,e),i(G,r[12],r[13],r[14]),_(t,G,o,G),r[12]=G[0],r[13]=G[1],r[14]=G[2]}(this.coordinateSystem,e,t,e)}worldUpAtPosition(t,e){return o=t,i=e,(s=this.coordinateSystem).operations.axisAt(s.value,o,h.Z,i);var s,o,i}worldBasisAtPosition(t,e,s){return i=t,r=e,n=s,(o=this.coordinateSystem).operations.axisAt(o.value,i,r,n);var o,i,r,n}basisMatrixAtPosition(t,e){const s=this.worldBasisAtPosition(t,h.X,w.get()),i=this.worldBasisAtPosition(t,h.Y,w.get()),r=this.worldBasisAtPosition(t,h.Z,w.get());return o(e,s[0],s[1],s[2],0,i[0],i[1],i[2],0,r[0],r[1],r[2],0,0,0,0,1),e}intersectManifoldClosestSilhouette(t,e,s){var o,i,r;return C(this.coordinateSystem,e,this._coordinateSystem),i=t,r=s,(o=this._coordinateSystem).operations.intersectRayClosestSilhouette(o.value,i,r),s}intersectManifold(t,e,s){C(this.coordinateSystem,e,this._coordinateSystem);const o=w.get();return r=t,n=o,(i=this._coordinateSystem).operations.intersectRay(i.value,r,n)?a(s,o):null;var i,r,n}intersectInfiniteManifold(t,e,s){if(this.viewingMode===P.Global)return this.intersectManifold(t,e,s);C(this.coordinateSystem,e,this._coordinateSystem);const o=this._coordinateSystem.value,i=w.get();return g(o.plane,t,i)?a(s,i):null}toRenderCoords(t,e,s){return M(t)?u(t,e,this.spatialReference):m(t,e,s,this.spatialReference)}fromRenderCoords(e,s,o=null){return M(s)?(t(o)&&(s.spatialReference=o),f(e,this.spatialReference,s)):s instanceof d?p(e,this.spatialReference,s):m(e,this.spatialReference,s,o)?s:null}static create(t,s){switch(t){case P.Local:return new I(P.Local,s,e(s),x(R,A([0,0,0],[0x4000000000000,0,0],[0,0x4000000000000,0])));case P.Global:return new I(P.Global,s,1,function(t){return x(y,v(0,0,0,j(t).radius))}(s))}}static renderUnitScaleFactor(t,e){return L(t)/L(e)}}function L(t){if(b(t,P.Global))return 1;const s=E(!1,t);return e(s)}export{I as R,U as c,E as r,B as v};
