/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{i as e,a as n,e as r}from"./maybe.js";import{s as t,h as s,b as o}from"./screenUtils.js";import{h as a,a as l,e as c,d as i,j as u,o as d,b as p,k as m}from"./mathUtils.js";import{projectPoint as f}from"../geometry/projection.js";import{i as E,f as S,c as j}from"./plane.js";import{c as y}from"./ray.js";import{j as g}from"./sphere.js";import{d as x}from"./vectorStacks.js";import{b as R,d as I}from"./elevationInfoUtils.js";import{a as b}from"./ray2.js";import{a as v,S as H,I as U}from"./Intersector.js";import{T as h}from"./verticalOffsetUtils.js";import{E as O}from"./dragEventPipeline.js";function T(e,n){return C(e,(()=>n))}function w(e){return C(e,(e=>e.plane))}function C(r,o){const l=a(),c=a();let i=!1;return a=>{const u=o(a);if("start"===a.action){const n=t(a.screenStart,s(x.get())),o=b(r.state.camera,n,B);e(o)&&(i=E(u,o,l))}if(!i)return null;const d=t(a.screenEnd,s(x.get())),p=b(r.state.camera,d,B);return n(p)?null:E(u,p,c)?{...a,renderStart:l,renderEnd:c,plane:u,ray:p}:null}}function D(r,t,s,a=null,l=null){return function(r,t,s,a=null,l=null){let c=null;return i=>{if("start"===i.action&&(c=r.sceneIntersectionHelper.intersectElevationFromScreen(o(i.screenStart.x,i.screenStart.y),t,s,l),e(c)&&e(a)&&!f(c,c,a)))return null;if(n(c))return null;const u=r.sceneIntersectionHelper.intersectElevationFromScreen(o(i.screenEnd.x,i.screenEnd.y),t,s,l);return e(u)?e(a)&&!f(u,u,a)?null:{...i,mapStart:c,mapEnd:u}:null}}(r,s,I(t,r,s),a,l)}function M(e,n,r,t=null,s=null){return D(e,r,R(n),t,s)}function N(n,r,t,s){const o=r.toMap(n.screenStart,{include:[t]});return e(o)?M(r,t,o,s):null}function G(e,n,r){let t=null;const s=new O;return s.next(T(e,function(e,n){const r=q,t=z,s=j();e.renderCoordsHelper.worldUpAtPosition(n,r);const o=m(s,r,i(t,n,e.state.camera.eye));return m(o,o,r),S(n,o,s)}(e,n))).next(function(e,n){const r=a(),t=c(n);e.renderCoordsHelper.worldUpAtPosition(n,r);const s=a(),o=a(),m=s=>(i(s,s,n),g(r,s,s),"global"===e.viewingMode&&c(s)*Math.sign(u(r,s))<.001-t&&i(s,d(s,r,.001),n),p(s,s,n),s);return e=>(e.renderStart=m(l(s,e.renderStart)),e.renderEnd=m(l(o,e.renderEnd)),e)}(e,n)).next(P(e,r)).next((e=>{e.mapEnd.x=e.mapStart.x,e.mapEnd.y=e.mapStart.y,t=e})),e=>(t=null,s.execute(e),t)}function P(n,r){const t=n.renderCoordsHelper;return n=>{const s=t.fromRenderCoords(n.renderStart,r),o=t.fromRenderCoords(n.renderEnd,r);return e(s)&&e(o)?{...n,mapStart:s,mapEnd:o}:null}}var k;function A(n){let r=null;return t=>{switch(t.action){case"start":r=n.disableDisplay();break;case"end":case"cancel":e(r)&&(r.remove(),r=null)}return t}}function F(s,l=null){const c=v(s.state.viewingMode);c.options.selectionMode=!0,c.options.store=H.MIN,c.options.hud=!1;const i=o(),u={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},d=a(),p=r(l,s.spatialReference),m=e=>{s.map.ground&&s.map.ground.opacity<1?u.exclude.add(h):u.exclude.delete(h),s.sceneIntersectionHelper.intersectIntersectorScreen(t(e,i),c,u);const n=c.results.min;let r;if(n.getIntersectionPoint(d))r=n.intersector===U.TERRAIN?k.GROUND:k.OTHER;else{if(!c.results.ground.getIntersectionPoint(d))return null;r=k.GROUND}return{location:s.renderCoordsHelper.fromRenderCoords(d,p),surfaceType:r}};let f;return r=>{if("start"===r.action){const n=m(r.screenStart);f=e(n)?n.location:null}if(n(f))return null;const t=m(r.screenEnd);return e(t)&&e(t.location)?{...r,mapStart:f,mapEnd:t.location,surfaceType:t.surfaceType}:null}}!function(e){e[e.GROUND=0]="GROUND",e[e.OTHER=1]="OTHER"}(k||(k={}));const q=a(),z=a(),B=y();export{k as S,F as a,D as b,G as c,N as d,w as e,P as f,M as g,A as h,T as s};
