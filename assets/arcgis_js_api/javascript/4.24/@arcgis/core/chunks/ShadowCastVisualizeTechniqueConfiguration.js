/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{s as t,f as n,G as e,H as i,c as o,n as a,o as r,w as c,b as s,q as l,h as u}from"./mathUtils.js";import{h as d,i as m,r as f,n as h,d as g}from"./mat4.js";import{c as b}from"./mat4f64.js";import{V as p}from"./ViewingMode.js";import{d as y}from"./mathUtils2.js";import{_ as v}from"./tslib.es6.js";import{p as A,S as M}from"./ShaderTechniqueConfiguration.js";var N,T,x={exports:{}};N=x,T=function(){var t=Math.PI,n=Math.sin,e=Math.cos,i=Math.tan,o=Math.asin,a=Math.atan2,r=Math.acos,c=t/180,s=864e5,l=2440588,u=2451545,d={dec:0,ra:0};function m(t){return new Date((t+.5-l)*s)}function f(t){return function(t){return t.valueOf()/s-.5+l}(t)-u}var h=23.4397*c;function g(t,o){return a(n(t)*e(h)-i(o)*n(h),e(t))}function b(t,i){return o(n(i)*e(h)+e(i)*n(h)*n(t))}function p(t,o,r){return a(n(t),e(t)*n(o)-i(r)*e(o))}function y(t,i,a){return o(n(i)*n(a)+e(i)*e(a)*e(t))}function v(t,n){return c*(280.16+360.9856235*t)-n}function A(t){return c*(357.5291+.98560028*t)}function M(t){return c*(1.9148*n(t)+.02*n(2*t)+3e-4*n(3*t))}function N(n,e){return n+e+102.9372*c+t}function T(t,n){var e=A(t),i=N(e,M(e));return n||(n={dec:0,ra:0}),n.dec=b(i,0),n.ra=g(i,0),n}var x={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(t,n,e,i){var o=c*-e,a=c*n,r=f(t),s=T(r,d),l=v(r,o)-s.ra;return i||(i={azimuth:0,altitude:0}),i.azimuth=p(l,a,s.dec),i.altitude=y(l,a,s.dec),i}},P=[[-.83,"sunrise","sunset"]];x.addTime=function(t,n,e){P.push([t,n,e])};var w=9e-4;function O(n,e,i){return w+(n+e)/(2*t)+i}function E(t,e,i){return u+t+.0053*n(e)-.0069*n(2*i)}function G(t){var i=c*(134.963+13.064993*t),o=c*(93.272+13.22935*t),a=c*(218.316+13.176396*t)+6.289*c*n(i),r=5.128*c*n(o),s=385001-20905*e(i);return{ra:g(a,r),dec:b(a,r),dist:s}}return x.getTimes=function(i,o,a){var s=c*-a,l=c*o,u=function(n,e){return Math.round(n-w-e/(2*t))}(f(i),s),d=O(0,s,u),h=A(d),g=M(h),p=N(h,g),y=b(p,0),v=E(d,h,p);function T(t){return E(O(function(t,i,o){return r((n(t)-n(i)*n(o))/(e(i)*e(o)))}(t,l,y),s,u),h,p)}var G,I,z,S,D,H,L,R={solarNoon:m(v),nadir:m(v-.5),polarException:x.PolarException.NORMAL};for(G=0,I=P.length;G<I;G+=1)D=v-((S=T((z=P[G])[0]*c))-v),R[z[1]]=m(D),R[z[2]]=m(S);return R.polarException=(H=P[0][0]*c,(L=(n(H)-n(l)*n(y))/(e(l)*e(y)))<-1?x.PolarException.MIDNIGHT_SUN:L>1?x.PolarException.POLAR_NIGHT:x.PolarException.NORMAL),R},x.getMoonPosition=function(t,n,e){var o=c*-e,a=c*n,r=f(t),s=G(r),l=v(r,o)-s.ra,u=y(l,a,s.dec);return u+=.017*c/i(u+10.26*c/(u+5.1*c)),{azimuth:p(l,a,s.dec),altitude:u,distance:s.dist}},x.getMoonFraction=function(t){var i=f(t),o=T(i),c=G(i),s=149598e3,l=r(n(o.dec)*n(c.dec)+e(o.dec)*e(c.dec)*e(o.ra-c.ra)),u=a(s*n(l),c.dist-s*e(l));return(1+e(u))/2},x}(),void 0!==T&&(N.exports=T);const P=x.exports,w={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8e5,ambient:.015,direct:.75},planarDirection:{localAltitude:1e4,globalAltitude:1e6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};function O(l,u,m,f,h,g,b){t(b.ambient.color,1,1,1),b.ambient.intensity=w.global.ambient,t(b.direct.color,1,1,1),b.direct.intensity=w.global.direct;const v=u[2],A=o((Math.abs(v)-w.local.altitude)/(w.global.altitude-w.local.altitude),0,1);let M;if(b.globalFactor=A,"sun"===g&&(M=P.getTimes(l,u[1],u[0])),A<1){let t;if("sun"===g)t=function(t,e,i){const o=t.valueOf();let a,r;e.polarException===P.PolarException.MIDNIGHT_SUN?(a=o-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,r=a+432e6):e.polarException===P.PolarException.POLAR_NIGHT?(a=o-2,r=o-1):(a=e.sunrise.valueOf(),r=e.sunset.valueOf());const c=r-a,s=a+c/2,l=c/4,u=s-l,d=s+l,m=.06*c,f=a-m/2,h=a+m/2,g=r-m/2,b=r+m/2,p=w.local,y=[.01,p.ambientAtNight],v=[.8,.8,1],A=[.01,.01,.01],M=[p.directAtTwilight,p.ambientAtTwilight],N=[1,.6,.5],T=[.8,.8,1],x=[.9*p.directAtNoon,p.ambientAtNoon],O=[1,.98,.98],E=[.98,.98,1],G=[p.directAtNoon,p.ambientAtNoon],I=[1,1,1],z=[1,1,1],S=x,D=O,H=E,_=M,j=N,F=T;let C,q,V=[0,0],k=[0,0,0],B=[0,0,0];o<f||o>b?(V=y,k=A,B=v,q="night"):o<h?(C=h-f,V=U(o-f,C,y,M),k=U(o-f,C,A,N),B=U(o-f,C,v,T),q="sun rising"):o<u?(C=u-h,V=U(o-h,C,M,x),k=U(o-h,C,N,O),B=U(o-h,C,T,E),q="early morning"):o<s?(C=s-u,V=U(o-u,C,x,G),k=U(o-u,C,O,I),B=U(o-u,C,E,z),q="late morning"):o<d?(C=d-s,V=U(o-s,C,G,S),k=U(o-s,C,I,D),B=U(o-s,C,z,H),q="early afternoon"):o<g?(C=g-d,V=U(o-d,C,S,_),k=U(o-d,C,D,j),B=U(o-d,C,H,F),q="late afternoon"):o<b&&(C=b-g,V=U(o-g,C,_,y),k=U(o-g,C,j,A),B=U(o-g,C,F,v),q="sun setting");let J=0;switch(i){case"rainy":case"foggy":J=.9;case"snowy":J=.5}J>0&&(k=R(k,J),B=R(B,J));const K=n(k[0],k[1],k[2]),Q=n(B[0],B[1],B[2]),W=L(i);return{direct:{intensity:V[0]*W.direct,color:K},ambient:{intensity:V[1]*W.ambient,color:Q},timeOfDay:q}}(l,M,f);else{const e=L(f);t={direct:{intensity:w.local.directAtNoon*e.direct,color:n(1,1,1)},ambient:{intensity:w.local.ambientAtNoon*e.ambient,color:n(1,1,1)},timeOfDay:"early afternoon"}}e(b.ambient.color,t.ambient.color,b.ambient.color,A),b.ambient.intensity=i(t.ambient.intensity,b.ambient.intensity,A),e(b.direct.color,t.direct.color,b.direct.color,A),b.direct.intensity=i(t.direct.intensity,b.direct.intensity,A),b.specularStrength="rainy"===f||"snowy"===f||"foggy"===f?0:1,b.environmentStrength="rainy"===f?.7:"snowy"===f||"foggy"===f?.75:1}b.noonFactor="sun"===g?function(t,n){const e=t.valueOf();let i,a;n.polarException===P.PolarException.MIDNIGHT_SUN?(i=e-60*(t.getHours()+48)*60*1e3-60*t.getMinutes()*1e3,a=i+432e6):n.polarException===P.PolarException.POLAR_NIGHT?(i=e-2,a=e-1):(i=n.sunrise.valueOf(),a=n.sunset.valueOf());const r=i+(a-i)/2;return 1-o(Math.abs(e-r)/432e5,0,1)}(l,M):1,"sun"===g?E(l,u,m,b.direct.directionToLightSource):function(n,e,i){e===p.Global?a(F,n.eye):t(F,0,0,1),r(C,n.viewForward,-1);const o=y(C,F),l=Math.max(o-2*V,0),u=.85*l/(l+1),m=Math.max(V,o-V-u);d(j,-m,n.viewRight),c(i,C,j),s(i,i,r(q,n.viewRight,k)),a(i,i)}(h,m,b.direct.directionToLightSource)}function E(n,e,i,a){const r=H,s=m(D);if(i===p.Global)P.getPosition(n,0,0,r),t(a,0,0,-1),f(s,s,-r.azimuth),h(s,s,-r.altitude),c(a,a,s);else{const i=w.planarDirection,l=i.globalAngles,u=e[2];let d=(Math.abs(u)-i.localAltitude)/(i.globalAltitude-i.localAltitude);d=o(d,0,1),d<1?(P.getPosition(n,e[1],e[0],r),r.azimuth=(1-d)*r.azimuth+d*l.azimuth,r.altitude=(1-d)*r.altitude+d*l.altitude):(r.azimuth=l.azimuth,r.altitude=l.altitude),t(a,0,-1,0),g(s,s,-r.azimuth),f(s,s,-r.altitude),c(a,a,s)}}function G(t,n){if(n===p.Global)return!0;const e=w.planarDirection;return Math.abs(t)<e.localAltitude}function I(t,n,e,i,o){const a=t.getTime(),r=n.getTime()-a,c=Math.floor(r/e)+1,s=new Array(c);for(let t=0;t<c;++t)_.setTime(a+e*t),s[t]=u(),E(_,i,o,s[t]);return s}const z=n(.5773502691896258,-.5773502691896258,.5773502691896258);class S{constructor(){this.ambient={color:n(1,1,1),intensity:.55},this.direct={color:n(1,1,1),intensity:.55,directionToLightSource:l(z)},this.noonFactor=.5,this.globalFactor=0,this.specularStrength=1,this.environmentStrength=1}}const D=b(),H={azimuth:0,altitude:0};function L(t){switch(t){case"disabled":case"sunny":case"cloudy":return{direct:1,ambient:1};case"rainy":return{direct:.4,ambient:1.2};case"snowy":return{direct:.5,ambient:1.3};case"foggy":return{direct:.2,ambient:1.6}}}function R(t,n){const e=(t[0]+t[1]+t[2])/3;for(let i=0;i<3;i++)t[i]=t[i]+(e-t[i])*n;return t}function U(t,n,e,i){const o=[];for(let a=0;a<e.length;a++)o[a]=(i[a]-e[a])*t/n+e[a];return o}const _=new Date(0),j=b(),F=u(),C=u(),q=u(),V=.25,k=.2;var B;!function(t){t[t.Gradient=0]="Gradient",t[t.Threshold=1]="Threshold",t[t.COUNT=2]="COUNT"}(B||(B={}));class J extends M{constructor(){super(...arguments),this.visualization=B.Gradient,this.bandsEnabled=!1}}v([A({count:B.COUNT})],J.prototype,"visualization",void 0),v([A()],J.prototype,"bandsEnabled",void 0);export{S as C,B as S,G as a,J as b,O as c,P as d,I as e};
