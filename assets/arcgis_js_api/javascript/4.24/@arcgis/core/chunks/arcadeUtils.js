/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import"../geometry.js";import{D as e,F as n,a as t,n as r,r as o,b as a,p as i,v as s,s as l,e as c,c as u,f,d as h}from"./parser.js";import{p,f as d,m,n as g,o as w,l as y,v as E,q as S,i as I,F as N,N as v,S as b,I as A,k as x,h as M,s as _,b as R,r as T,u as F,w as O,x as U,y as C,z as D,j as P,a as k,A as L,e as j,B as z,C as G,D as q,g as V,E as H,G as B,H as Y,t as Z,J,K as W,L as $,M as Q,O as X,P as K,Q as ee,R as ne,T as te,U as re,V as oe,W as ae,X as ie,Y as se,Z as le,_ as ce,$ as ue}from"./languageUtils.js";import{isPromiseLike as fe}from"../core/promiseUtils.js";import{g as he}from"./locale.js";import{D as pe}from"./datetime.js";import de,{s as me}from"../geometry/Extent.js";import ge from"../geometry/Geometry.js";import we from"../geometry/Multipoint.js";import ye from"../geometry/Point.js";import Ee,{i as Se}from"../geometry/Polygon.js";import Ie from"../geometry/Polyline.js";import{fromJSON as Ne}from"../geometry/support/jsonUtils.js";import{version as ve}from"../kernel.js";import{f as be}from"./unitUtils.js";import{p as Ae}from"./number.js";import xe from"../geometry/SpatialReference.js";import{h as Me,clone as _e}from"../core/lang.js";import{i as Re}from"./sizeVariableUtils.js";class Te extends e{constructor(e){super(),this.immutable=!1,this.setField("url",e),this.immutable=!0}}class Fe extends e{constructor(e,n,t,r,o,a){super(),this.attachmentUrl=o,this.immutable=!1,this.setField("id",e),this.setField("name",n),this.setField("contenttype",t),this.setField("size",r),this.setField("exifinfo",a),this.immutable=!0}}const Oe=Object.freeze(Object.defineProperty({__proto__:null,registerFunctions:function(e){function n(n,t){if(t instanceof N)return e.arcadeCustomFunctionHandler(t);if(t instanceof v)return(...e)=>t.fn(n,{preparsed:!0,arguments:e});if(t instanceof b)return(...e)=>{if(e.length!==t.paramCount)throw new Error("Invalid parameters");return t.fn(...e)};throw new Error("Invalid Parameter")}function t(e){if(e instanceof A)return e.toArray();if(y(e))return e;throw new Error("Invalid Parameter")}e.functions.array=function(n,t){return e.standardFunction(n,t,(function(e,n,t){p(t,1,2);const r=d(t[0]);if(isNaN(r)||!1===m(r))throw new Error("Invalid Parameter");const o=g(t[1],null),a=new Array(r);return a.fill(o),a}))},e.functions.front=function(n,t){return e.standardFunction(n,t,(function(e,n,t){if(p(t,1,1),w(t[0])){if(t[0].length()<=0)throw new Error("Array is empty");return t[0].get(0)}if(y(t[0])){if(t[0].length<=0)throw new Error("Array is empty");return t[0][0]}throw new Error("Invalid Parameter")}))},e.functions.back=function(n,t){return e.standardFunction(n,t,(function(e,n,t){if(p(t,1,1),w(t[0])){if(t[0].length()<=0)throw new Error("Array is empty");return t[0].get(t[0].length()-1)}if(y(t[0])){if(t[0].length<=0)throw new Error("Array is empty");return t[0][t[0].length-1]}throw new Error("Invalid Parameter")}))},e.functions.push=function(n,t){return e.standardFunction(n,t,(function(e,n,t){if(p(t,1,2),y(t[0]))return t[0][t[0].length]=t[1],t[0].length;throw new Error("Invalid Parameter")}))},e.functions.pop=function(n,t){return e.standardFunction(n,t,(function(e,n,t){if(p(t,1,1),y(t[0])){if(t[0].length<=0)throw new Error("Array is empty");const e=t[0][t[0].length-1];return t[0].length=t[0].length-1,e}throw new Error("Invalid Parameter")}))},e.functions.erase=function(n,t){return e.standardFunction(n,t,(function(e,n,t){if(p(t,2,2),y(t[0])){let e=d(t[1]);if(isNaN(e)||!1===m(e))throw new Error("Invalid Parameter");const n=t[0];if(n.length<=0)throw new Error("Array is empty");if(e<0&&(e=n.length+e),e<0)throw new Error("Element not found");if(e>=n.length)throw new Error("Index is greater than array");return n.splice(e,1),E}throw new Error("Invalid Parameter")}))},e.functions.insert=function(n,t){return e.standardFunction(n,t,(function(e,n,t){if(p(t,3,3),y(t[0])){const e=d(t[1]);if(isNaN(e)||!1===m(e))throw new Error("Invalid Parameter");const n=t[2],r=t[0];if(e>r.length)throw new Error("Index is greater than array");if(e<0&&e<-1*r.length)throw new Error("Index is greater than array");return e===r.length?(r[e]=n,E):(r.splice(e,0,n),E)}throw new Error("Invalid Parameter")}))},e.functions.resize=function(n,t){return e.standardFunction(n,t,(function(e,n,t){if(p(t,2,3),y(t[0])){const e=d(t[1]);if(isNaN(e)||!1===m(e))throw new Error("Invalid Parameter");if(e<0)throw new Error("Size cannot be negative");const n=g(t[2],null),r=t[0];if(r.length>=e)return r.length=e,E;const o=r.length;r.length=e;for(let e=o;e<r.length;e++)r[e]=n;return E}throw new Error("Invalid Parameter")}))},e.functions.includes=function(n,t){return e.standardFunction(n,t,(function(e,n,t){if(p(t,2,2),y(t[0])){const e=t[1];return t[0].findIndex((n=>S(n,e)))>-1}if(w(t[0])){const e=t[1];return t[0].toArray().findIndex((n=>S(n,e)))>-1}throw new Error("Invalid Parameter")}))},e.functions.slice=function(n,t){return e.standardFunction(n,t,(function(e,n,t){if(p(t,1,3),y(t[0])){const e=d(g(t[1],0)),n=d(g(t[2],t[0].length));if(isNaN(e)||!1===m(e))throw new Error("Invalid Parameter");if(isNaN(n)||!1===m(n))throw new Error("Invalid Parameter");return t[0].slice(e,n)}if(w(t[0])){const e=t[0],n=d(g(t[1],0)),r=d(g(t[2],e.length()));if(isNaN(n)||!1===m(n))throw new Error("Invalid Parameter");if(isNaN(r)||!1===m(r))throw new Error("Invalid Parameter");return e.toArray().slice(n,r)}throw new Error("Invalid Parameter")}))},e.functions.splice=function(n,t){return e.standardFunction(n,t,(function(e,n,t){const r=[];for(let e=0;e<t.length;e++)y(t[e])?r.push(...t[e]):w(t[e])?r.push(...t[e].toArray()):r.push(t[e]);return r}))},"sync"===e.mode&&(e.functions.any=function(r,o){return e.standardFunction(r,o,(function(e,o,a){p(a,2,2);const i=n(r,a[1]),s=t(a[0]);for(const e of s){const n=i(e);if(I(n)&&!0===n)return!0}return!1}))},e.functions.all=function(r,o){return e.standardFunction(r,o,(function(e,o,a){p(a,2,2);const i=n(r,a[1]),s=t(a[0]);for(const e of s)if(!0!==i(e))return!1;return!0}))},e.functions.none=function(r,o){return e.standardFunction(r,o,(function(e,o,a){p(a,2,2);const i=n(r,a[1]),s=t(a[0]);for(const e of s)if(!0===i(e))return!1;return!0}))},e.functions.reduce=function(r,o){return e.standardFunction(r,o,(function(e,o,a){p(a,2,3);const i=n(r,a[1]),s=t(a[0]);return 2===a.length?0===s.length?null:s.reduce(((e,n)=>{const t=i(e,n);return void 0!==t&&t!==E?t:null})):s.reduce(((e,n)=>{const t=i(e,n);return void 0!==t&&t!==E?t:null}),a[2])}))},e.functions.map=function(r,o){return e.standardFunction(r,o,(function(e,o,a){p(a,2,2);const i=n(r,a[1]),s=t(a[0]),l=[];for(const e of s){const n=i(e);void 0!==n&&n!==E?l.push(n):l.push(null)}return l}))},e.functions.filter=function(r,o){return e.standardFunction(r,o,(function(e,o,a){p(a,2,2);const i=n(r,a[1]),s=t(a[0]),l=[];for(const e of s)!0===i(e)&&l.push(e);return l}))}),"async"===e.mode&&(e.functions.any=function(r,o){return e.standardFunctionAsync(r,o,(async function(e,o,a){p(a,2,2);const i=n(r,a[1]),s=t(a[0]);for(const e of s){const n=await i(e);let t=null;if(t=fe(t)?await n:n,I(t)&&!0===t)return!0}return!1}))},e.functions.all=function(r,o){return e.standardFunctionAsync(r,o,(async function(e,o,a){p(a,2,2);const i=n(r,a[1]),s=t(a[0]);for(const e of s){const n=await i(e);let t=null;if(t=fe(t)?await n:n,!0!==t)return!1}return!0}))},e.functions.none=function(r,o){return e.standardFunctionAsync(r,o,(async function(e,o,a){p(a,2,2);const i=n(r,a[1]),s=t(a[0]);for(const e of s){const n=await i(e);let t=null;if(t=fe(t)?await n:n,!0===t)return!1}return!0}))},e.functions.filter=function(r,o){return e.standardFunctionAsync(r,o,(async function(e,o,a){p(a,2,2);const i=n(r,a[1]),s=t(a[0]),l=[];for(const e of s){const n=await i(e);let t=null;t=fe(t)?await n:n,!0===t&&l.push(e)}return l}))},e.functions.reduce=function(r,o){return e.standardFunctionAsync(r,o,(function(e,o,a){p(a,2,3);const i=n(r,a[1]),s=t(a[0]);let l=null;if(a.length>2){const e=g(a[2],null);l=s.reduce((async(e,n)=>{let t=await e;return void 0!==t&&t!==E||(t=null),i(t,n)}),Promise.resolve(e))}else{if(0===s.length)return null;l=s.reduce((async(e,n,t)=>{if(t<=1)return i(e,n);let r=await e;return void 0!==r&&r!==E||(r=null),i(r,n)}))}return l.then((e=>void 0!==e&&e!==E?e:null))}))},e.functions.map=function(r,o){return e.standardFunctionAsync(r,o,(async function(e,o,a){p(a,2,2);const i=n(r,a[1]),s=t(a[0]),l=[];for(const e of s){const n=await i(e);let t=null;t=fe(t)?await n:n,void 0!==t&&t!==E?l.push(t):l.push(null)}return l}))})}},Symbol.toStringTag,{value:"Module"}));function Ue(e){const n=new Date(e.getTime()),t=n.getFullYear(),r=new Date(0);r.setFullYear(t+1,0,4),r.setHours(0,0,0,0);const o=Ce(r),a=new Date(0);a.setFullYear(t,0,4),a.setHours(0,0,0,0);const i=Ce(a);return n.getTime()>=o.getTime()?t+1:n.getTime()>=i.getTime()?t:t-1}function Ce(e){const n=new Date(e.getTime()),t=n.getDay(),r=(t<1?7:0)+t-1;return n.setDate(n.getDate()-r),n.setHours(0,0,0,0),n}const De=[0,31,59,90,120,151,181,212,243,273,304,334],Pe=[0,31,60,91,121,152,182,213,244,274,305,335];function ke(e){return null===e?e:isNaN(e.getTime())?null:e}function Le(e,n){e.today=function(e,t){return n(e,t,(function(e,n,t){p(t,0,0);const r=new Date;return r.setHours(0,0,0,0),r}))},e.now=function(e,t){return n(e,t,(function(e,n,t){return p(t,0,0),new Date}))},e.timestamp=function(e,t){return n(e,t,(function(e,n,t){p(t,0,0);let r=new Date;return r=new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds(),r.getUTCMilliseconds()),r}))},e.toutc=function(e,t){return n(e,t,(function(e,n,t){p(t,1,1);const r=x(t[0]);return null===r?null:new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds(),r.getUTCMilliseconds())}))},e.tolocal=function(e,t){return n(e,t,(function(e,n,t){p(t,1,1);const r=x(t[0]);return null===r?null:pe.utc(r.getFullYear(),r.getMonth()+1,r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()).toJSDate()}))},e.day=function(e,t){return n(e,t,(function(e,n,t){p(t,1,1);const r=x(t[0]);return null===r?NaN:r.getDate()}))},e.month=function(e,t){return n(e,t,(function(e,n,t){p(t,1,1);const r=x(t[0]);return null===r?NaN:r.getMonth()}))},e.year=function(e,t){return n(e,t,(function(e,n,t){p(t,1,1);const r=x(t[0]);return null===r?NaN:r.getFullYear()}))},e.hour=function(e,t){return n(e,t,(function(e,n,t){p(t,1,1);const r=x(t[0]);return null===r?NaN:r.getHours()}))},e.second=function(e,t){return n(e,t,(function(e,n,t){p(t,1,1);const r=x(t[0]);return null===r?NaN:r.getSeconds()}))},e.millisecond=function(e,t){return n(e,t,(function(e,n,t){p(t,1,1);const r=x(t[0]);return null===r?NaN:r.getMilliseconds()}))},e.minute=function(e,t){return n(e,t,(function(e,n,t){p(t,1,1);const r=x(t[0]);return null===r?NaN:r.getMinutes()}))},e.week=function(e,t){return n(e,t,(function(e,n,t){p(t,1,2);const r=x(t[0]);if(null===r)return NaN;const o=d(g(t[1],0));if(o<0||o>6)throw new Error("Invalid Parameter");const a=r.getDate(),i=r.getMonth(),s=r.getFullYear(),l=r.getDay(),c=function(e,n,t){const r=function(e){return e%4==0&&(e%100!=0||e%400==0)}(t)?Pe:De;return e+r[n]}(a,i,s)-1,u=Math.floor(c/7);return l-o+(l-o<0?7:0)<c-7*u?u+1:u}))},e.weekday=function(e,t){return n(e,t,(function(e,n,t){p(t,1,1);const r=x(t[0]);return null===r?NaN:r.getDay()}))},e.isoweekday=function(e,t){return n(e,t,(function(e,n,t){p(t,1,1);const r=x(t[0]);if(null===r)return NaN;let o=r.getDay();return 0===o&&(o=7),o}))},e.isomonth=function(e,t){return n(e,t,(function(e,n,t){p(t,1,1);const r=x(t[0]);return null===r?NaN:r.getMonth()+1}))},e.isoweek=function(e,t){return n(e,t,(function(e,n,t){p(t,1,1);const r=x(t[0]);if(null===r)return NaN;const o=Ce(r).getTime()-function(e){const n=Ue(e),t=new Date(0);return t.setFullYear(n,0,4),t.setHours(0,0,0,0),Ce(t)}(r).getTime();return Math.round(o/6048e5)+1}))},e.isoyear=function(e,t){return n(e,t,(function(e,n,t){p(t,1,1);const r=x(t[0]);return null===r?NaN:Ue(r)}))},e.date=function(e,t){return n(e,t,(function(e,n,t){if(p(t,0,7),3===t.length)return ke(new Date(d(t[0]),d(t[1]),d(t[2]),0,0,0,0));if(4===t.length)return ke(new Date(d(t[0]),d(t[1]),d(t[2]),d(t[3]),0,0,0));if(5===t.length)return ke(new Date(d(t[0]),d(t[1]),d(t[2]),d(t[3]),d(t[4]),0,0));if(6===t.length)return ke(new Date(d(t[0]),d(t[1]),d(t[2]),d(t[3]),d(t[4]),d(t[5]),0));if(7===t.length)return ke(new Date(d(t[0]),d(t[1]),d(t[2]),d(t[3]),d(t[4]),d(t[5]),d(t[6])));if(2===t.length){let e,n=M(t[1]);return""===n?null:(n=_(n),e="X"===n?pe.fromSeconds(d(t[0])):"x"===n?pe.fromMillis(d(t[0])):pe.fromFormat(M(t[0]),n,{locale:he(),numberingSystem:"latn"}),e.isValid?e.toJSDate():null)}if(1===t.length){if(R(t[0])){if(""===t[0].replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""))return null;if(!0===/^[0-9][0-9][0-9][0-9]$/.test(t[0]))return x(t[0]+"-01-01")}const e=d(t[0]);return!1===isNaN(e)?ke(new Date(e)):x(t[0])}return 0===t.length?new Date:void 0}))},e.datediff=function(e,t){return n(e,t,(function(e,n,t){p(t,2,3);const r=T(t[0]),o=T(t[1]);if(null===r||null===o)return NaN;switch(M(t[2]).toLowerCase()){case"days":case"day":case"d":return r.diff(o,"days").days;case"months":case"month":return r.diff(o,"months").months;case"minutes":case"minute":case"m":return"M"===t[2]?r.diff(o,"months").months:r.diff(o,"minutes").minutes;case"seconds":case"second":case"s":return r.diff(o,"seconds").seconds;case"milliseconds":case"millisecond":case"ms":default:return r.diff(o).milliseconds;case"hours":case"hour":case"h":return r.diff(o,"hours").hours;case"years":case"year":case"y":return r.diff(o,"years").years}}))},e.dateadd=function(e,t){return n(e,t,(function(e,n,t){p(t,2,3);const r=T(t[0]);if(null===r)return null;let o=d(t[1]);if(isNaN(o))return r.toJSDate();let a="milliseconds";switch(M(t[2]).toLowerCase()){case"days":case"day":case"d":a="days",o=F(o);break;case"months":case"month":a="months",o=F(o);break;case"minutes":case"minute":case"m":a="M"===t[2]?"months":"minutes";break;case"seconds":case"second":case"s":a="seconds";break;case"milliseconds":case"millisecond":case"ms":a="milliseconds";break;case"hours":case"hour":case"h":a="hours";break;case"years":case"year":case"y":a="years"}return r.plus({[a]:o}).toJSDate()}))}}function je(e,n,t){return Math.sqrt((e[0]-n[0])**2+(e[1]-n[1])**2+(void 0!==e[2]&&void 0!==n[2]?(e[2]*t-n[2]*t)**2:0))}const ze=[];for(const e of[[9002,56146130,6131,6132,8050,8051,8228],[9003,5702,6358,6359,6360,8052,8053],[9095,5754]]){const n=e[0];for(let t=1;t<e.length;t++)ze[e[t]]=n}const Ge=[];function qe(e){return e.vcsWkid&&void 0!==ze[e.vcsWkid]?Ge[ze[e.vcsWkid]]:e.latestVcsWkid&&void 0!==ze[e.latestVcsWkid]?Ge[ze[e.latestVcsWkid]]:1}function Ve(e,n,t){const r={x:0,y:0};n&&(r.z=0),t&&(r.m=0);let o=0,a=e[0];for(let i=0;i<e.length;i++){const s=e[i];if(!1===Ze(s,a)){const e=Ye(a,s,n),i=He(a,s,n,t);i.x*=e,i.y*=e,r.x+=i.x,r.y+=i.y,n&&(i.z*=e,r.z+=i.z),t&&(i.m*=e,r.m+=i.m),o+=e,a=s}}return o>0?(r.x/=o,r.y/=o,n&&(r.z/=o),t&&(r.m/=o)):(r.x=e[0][0],r.y=e[0][1],n&&(r.z=e[0][2]),t&&n?r.m=e[0][3]:t&&(r.m=e[0][2])),r}function He(e,n,t,r){const o={x:(e[0]+n[0])/2,y:(e[1]+n[1])/2};return t&&(o.z=(e[2]+n[2])/2),t&&r?o.m=(e[3]+n[3])/2:r&&(o.m=(e[2]+n[2])/2),o}function Be(e,n){if(e.length<=1)return 0;let t=0;for(let r=1;r<e.length;r++)t+=Ye(e[r-1],e[r],n);return t}function Ye(e,n,t){const r=n[0]-e[0],o=n[1]-e[1];if(t){const e=n[2]-n[2];return Math.sqrt(r*r+o*o+e*e)}return Math.sqrt(r*r+o*o)}function Ze(e,n){if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t]!==n[t])return!1;return!0}function Je(e){const n={x:0,y:0,spatialReference:e.spatialReference.toJSON()},t={x:0,y:0,spatialReference:e.spatialReference.toJSON()};let r=0,o=0;for(let a=0;a<e.paths.length;a++){if(0===e.paths[a].length)continue;const i=Be(e.paths[a],!0===e.hasZ);if(0===i){const t=Ve(e.paths[a],!0===e.hasZ,!0===e.hasM);n.x+=t.x,n.y+=t.y,!0===e.hasZ&&(n.z+=t.z),!0===e.hasM&&(n.m+=t.m),++r}else{const n=Ve(e.paths[a],!0===e.hasZ,!0===e.hasM);t.x+=n.x*i,t.y+=n.y*i,!0===e.hasZ&&(t.z+=n.z*i),!0===e.hasM&&(t.m+=n.m*i),o+=i}}return o>0?(t.x/=o,t.y/=o,!0===e.hasZ&&(t.z/=o),!0===e.hasM&&(t.m/=o),new ye(t)):r>0?(n.x/=r,n.y/=r,!0===e.hasZ&&(t.z/=r),!0===e.hasM&&(n.m/=r),new ye(n)):null}function We(e){if(0===e.points.length)return null;let n=0,t=0,r=0,o=0;for(let a=0;a<e.points.length;a++){const i=e.getPoint(a);!0===i.hasZ&&(r+=i.z),!0===i.hasM&&(o+=i.m),n+=i.x,t+=i.y,o+=i.m}const a={x:n/e.points.length,y:t/e.points.length,spatialReference:null};return a.spatialReference=e.spatialReference.toJSON(),!0===e.hasZ&&(a.z=r/e.points.length),!0===e.hasM&&(a.m=o/e.points.length),new ye(a)}function $e(e,n,t=0){for(;e<t;)e+=n;const r=t+n;for(;e>=r;)e-=n;return e}function Qe(e,n){return Math.atan2(n.y-e.y,n.x-e.x)}function Xe(e,n,t){const r={x:e.x-n.x,y:e.y-n.y},o={x:t.x-n.x,y:t.y-n.y};return Math.atan2((a=r).x*(i=o).y-i.x*a.y,function(e,n){return e.x*n.x+e.y*n.y}(r,o));var a,i}Ge[9002]=.3048,Ge[9003]=.3048006096012192,Ge[9095]=.3048007491;const Ke=[0,0];function en(e){for(let n=0;n<e.length;n++){const t=e[n];for(let r=0;r<t.length-1;r++){const o=t[r],a=t[r+1];for(let t=n+1;t<e.length;t++)for(let n=0;n<e[t].length-1;n++){const r=e[t][n],i=e[t][n+1];if(me(o,a,r,i,Ke)&&!(Ke[0]===o[0]&&Ke[1]===o[1]||Ke[0]===r[0]&&Ke[1]===r[1]||Ke[0]===a[0]&&Ke[1]===a[1]||Ke[0]===i[0]&&Ke[1]===i[1]))return!0}}const r=t.length;if(!(r<3))for(let e=0;e<=r-2;e++){const n=t[e],o=t[e+1];for(let a=e+2;a<=r-2;a++){const e=t[a],r=t[a+1];if(me(n,o,e,r,Ke)&&!(Ke[0]===n[0]&&Ke[1]===n[1]||Ke[0]===e[0]&&Ke[1]===e[1]||Ke[0]===o[0]&&Ke[1]===o[1]||Ke[0]===r[0]&&Ke[1]===r[1]))return!0}}}return!1}function nn(e){return e&&"esri.arcade.Feature"===e.arcadeDeclaredClass}function tn(t,r){t.ringisclockwise=function(e,n){return r(e,n,(function(e,n,t){p(t,1,1);let r=[],o=!1,a=!1;if(null===t[0])return!1;if(y(t[0])){for(const e of t[0]){if(!(e instanceof ye))throw new Error("Invalid Argument");r.push(e.hasZ?e.hasM?[e.x,e.y,e.z,e.m]:[e.x,e.y,e.z]:[e.x,e.y])}r.length>0&&(o=t[0][0].hasZ,a=t[0][0].hasM)}else if(t[0]instanceof O)r=t[0]._elements,r.length>0&&(o=t[0]._hasZ,a=t[0]._hasM);else{if(!w(t[0]))throw new Error("Invalid Argument");for(const e of t[0].toArray()){if(!(e instanceof ye))throw new Error("Invalid Argument");r.push(e.hasZ?e.hasM?[e.x,e.y,e.z,e.m]:[e.x,e.y,e.z]:[e.x,e.y])}r.length>0&&(o=t[0].get(0).hasZ,a=t[0].get(0).hasM)}return!(r.length<3)&&Se(r,a,o)}))},t.polygon=function(t,o){return r(t,o,(function(r,o,a){p(a,1,1);let i=null;if(a[0]instanceof e){if(i=U(n.parseGeometryFromDictionary(a[0]),t.spatialReference),i instanceof Ee==0)throw new Error("Illegal Parameter")}else i=a[0]instanceof Ee?Ne(a[0].toJSON()):U(new Ee(JSON.parse(a[0])),t.spatialReference);if(null!==i&&!1===i.spatialReference.equals(t.spatialReference))throw new Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return C(i)}))},t.polyline=function(t,o){return r(t,o,(function(r,o,a){p(a,1,1);let i=null;if(a[0]instanceof e){if(i=U(n.parseGeometryFromDictionary(a[0]),t.spatialReference),i instanceof Ie==0)throw new Error("Illegal Parameter")}else i=a[0]instanceof Ie?Ne(a[0].toJSON()):U(new Ie(JSON.parse(a[0])),t.spatialReference);if(null!==i&&!1===i.spatialReference.equals(t.spatialReference))throw new Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return C(i)}))},t.point=function(t,o){return r(t,o,(function(r,o,a){p(a,1,1);let i=null;if(a[0]instanceof e){if(i=U(n.parseGeometryFromDictionary(a[0]),t.spatialReference),i instanceof ye==0)throw new Error("Illegal Parameter")}else i=a[0]instanceof ye?Ne(a[0].toJSON()):U(new ye(JSON.parse(a[0])),t.spatialReference);if(null!==i&&!1===i.spatialReference.equals(t.spatialReference))throw new Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return C(i)}))},t.multipoint=function(t,o){return r(t,o,(function(r,o,a){p(a,1,1);let i=null;if(a[0]instanceof e){if(i=U(n.parseGeometryFromDictionary(a[0]),t.spatialReference),i instanceof we==0)throw new Error("Illegal Parameter")}else i=a[0]instanceof we?Ne(a[0].toJSON()):U(new we(JSON.parse(a[0])),t.spatialReference);if(null!==i&&!1===i.spatialReference.equals(t.spatialReference))throw new Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return C(i)}))},t.extent=function(t,o){return r(t,o,(function(r,o,a){a=D(a),p(a,1,1);let i=null;if(a[0]instanceof e)i=U(n.parseGeometryFromDictionary(a[0]),t.spatialReference);else if(a[0]instanceof ye){const e={xmin:a[0].x,ymin:a[0].y,xmax:a[0].x,ymax:a[0].y,spatialReference:a[0].spatialReference.toJSON()},n=a[0];n.hasZ?(e.zmin=n.z,e.zmax=n.z):n.hasM&&(e.mmin=n.m,e.mmax=n.m),i=Ne(e)}else i=a[0]instanceof Ee||a[0]instanceof Ie||a[0]instanceof we?Ne(a[0].extent.toJSON()):a[0]instanceof de?Ne(a[0].toJSON()):U(new de(JSON.parse(a[0])),t.spatialReference);if(null!==i&&!1===i.spatialReference.equals(t.spatialReference))throw new Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return C(i)}))},t.geometry=function(t,o){return r(t,o,(function(r,o,a){p(a,1,1);let i=null;if(null===a[0])return null;if(i=nn(a[0])?U(a[0].geometry(),t.spatialReference):a[0]instanceof e?U(n.parseGeometryFromDictionary(a[0]),t.spatialReference):U(Ne(JSON.parse(a[0])),t.spatialReference),null!==i&&!1===i.spatialReference.equals(t.spatialReference))throw new Error("Cannot create Geometry in this SpatialReference. Engine is using a different spatial reference.");return C(i)}))},t.setgeometry=function(e,n){return r(e,n,(function(e,n,t){if(p(t,2,2),!nn(t[0]))throw new Error("Illegal Argument");if(!0===t[0].immutable)throw new Error("Feature is Immutable");if(!(t[1]instanceof ge||null===t[1]))throw new Error("Illegal Argument");return t[0]._geometry=t[1],E}))},t.feature=function(t,o){return r(t,o,(function(r,o,a){if(0===a.length)throw new Error("Missing Parameters");let i=null;if(1===a.length)if(R(a[0]))i=n.fromJson(JSON.parse(a[0]));else if(nn(a[0]))i=n.createFromArcadeFeature(a[0]);else if(a[0]instanceof ge)i=n.createFromGraphicLikeObject(a[0],null,null);else{if(!(a[0]instanceof e))throw new Error("Illegal Argument");{let t=a[0].hasField("geometry")?a[0].field("geometry"):null,r=a[0].hasField("attributes")?a[0].field("attributes"):null;null!==t&&t instanceof e&&(t=n.parseGeometryFromDictionary(t)),null!==r&&(r=n.parseAttributesFromDictionary(r)),i=n.createFromGraphicLikeObject(t,r,null)}}else if(2===a.length){let t=null,r=null;if(null!==a[0])if(a[0]instanceof ge)t=a[0];else{if(!(t instanceof e))throw new Error("Illegal Argument");t=n.parseGeometryFromDictionary(a[0])}if(null!==a[1]){if(!(a[1]instanceof e))throw new Error("Illegal Argument");r=n.parseAttributesFromDictionary(a[1])}i=n.createFromGraphicLikeObject(t,r,null)}else{let t=null;const r={};if(null!==a[0])if(a[0]instanceof ge)t=a[0];else{if(!(t instanceof e))throw new Error("Illegal Argument");t=n.parseGeometryFromDictionary(a[0])}for(let e=1;e<a.length;e+=2){const n=M(a[e]),t=a[e+1];if(!(null==t||R(t)||isNaN(t)||P(t)||k(t)||I(t)))throw new Error("Illegal Argument");if(L(t)||!1===j(t))throw new Error("Illegal Argument");r[n]=t===E?null:t}i=n.createFromGraphicLikeObject(t,r,null)}return i._geometry=U(i.geometry(),t.spatialReference),i.immutable=!1,i}))},t.dictionary=function(n,t){return r(n,t,(function(n,t,r){if(0===r.length){const n=new e;return n.immutable=!1,n}if(1===r.length&&R(r[0]))try{const n=JSON.parse(r[0]),t=e.convertObjectToArcadeDictionary(n,!1);return t.immutable=!1,t}catch(e){throw new Error("Missing Parameters or Illegal Json")}if(r.length%2!=0)throw new Error("Missing Parameters");const o={};for(let e=0;e<r.length;e+=2){const n=M(r[e]),t=r[e+1];if(!(null==t||R(t)||isNaN(t)||P(t)||k(t)||I(t)||y(t)||w(t)))throw new Error("Illegal Argument");if(L(t))throw new Error("Illegal Argument");o[n]=t===E?null:t}const a=new e(o);return a.immutable=!1,a}))},t.haskey=function(n,t){return r(n,t,(function(n,t,r){p(r,2,2);const o=M(r[1]);if(nn(r[0]))return r[0].hasField(o);if(r[0]instanceof e)return r[0].hasField(o);throw new Error("Illegal Argument")}))},t.indexof=function(e,n){return r(e,n,(function(e,n,t){p(t,2,2);const r=t[1];if(y(t[0])){for(let e=0;e<t[0].length;e++)if(S(r,t[0][e]))return e;return-1}if(w(t[0])){const e=t[0].length();for(let n=0;n<e;n++)if(S(r,t[0].get(n)))return n;return-1}throw new Error("Illegal Argument")}))},t.angle=function(e,n){return r(e,n,(function(e,n,t){if(t=D(t),p(t,2,3),!(t[0]instanceof ye))throw new Error("Illegal Argument");if(!(t[1]instanceof ye))throw new Error("Illegal Argument");if(t.length>2&&!(t[2]instanceof ye))throw new Error("Illegal Argument");return 2===t.length?$e(Qe(t[0],t[1]),2*Math.PI)*(180/Math.PI):(r=t[0],o=t[1],a=t[2],$e(Xe(r,o,a),2*Math.PI)*(180/Math.PI));var r,o,a}))},t.bearing=function(e,n){return r(e,n,(function(e,n,t){if(t=D(t),p(t,2,3),!(t[0]instanceof ye))throw new Error("Illegal Argument");if(!(t[1]instanceof ye))throw new Error("Illegal Argument");if(t.length>2&&!(t[2]instanceof ye))throw new Error("Illegal Argument");return 2===t.length?(r=t[0],o=t[1],$e(Math.PI/2-Qe(r,o),2*Math.PI)*(180/Math.PI)):function(e,n,t){return $e(-1*Xe(e,n,t),2*Math.PI)*(180/Math.PI)}(t[0],t[1],t[2]);var r,o}))},t.isselfintersecting=function(e,n){return r(e,n,(function(n,t,r){r=D(r),p(r,1,1);let o=r[0];if(o instanceof Ee)return o.isSelfIntersecting;if(o instanceof Ie)return o=o.paths,en(o);if(o instanceof we){const e=o.points;for(let n=0;n<e.length;n++)for(let t=0;t<e.length;t++)if(t!==n){let r=!0;for(let o=0;o<e[n].length;o++)if(e[n][o]!==e[t][o]){r=!1;break}if(!0===r)return!0}}return!(!y(o)&&!w(o))&&(o=z(o,e.spatialReference),null!==o&&(o=o.paths),en(o))}))}}function rn(e){if(void 0===e)return null;if("number"==typeof e)return e;let n=e.toLowerCase();switch(n=n.replace(/\s/g,""),n=n.replace(/-/g,""),n){case"meters":case"meter":case"m":case"squaremeters":case"squaremeter":return 109404;case"miles":case"mile":case"squaremile":case"squaremiles":return 109413;case"kilometers":case"kilometer":case"squarekilometers":case"squarekilometer":case"km":return 109414;case"acres":case"acre":case"ac":return 109402;case"hectares":case"hectare":case"ha":return 109401;case"yard":case"yd":case"yards":case"squareyards":case"squareyard":return 109442;case"feet":case"ft":case"foot":case"squarefeet":case"squarefoot":return 109405;case"nm":case"nmi":case"nauticalmile":case"nauticalmiles":case"squarenauticalmile":case"squarenauticalmiles":return 109409}return null}function on(e){if(null===e)return null;switch(e.type){case"polygon":case"multipoint":case"polyline":return e.extent;case"point":return new de({xmin:e.x,ymin:e.y,xmax:e.x,ymax:e.y,spatialReference:e.spatialReference});case"extent":return e}return null}function an(e){if(void 0===e)return null;if("number"==typeof e)return e;let n=e.toLowerCase();switch(n=n.replace(/\s/g,""),n=n.replace(/-/g,""),n){case"meters":case"meter":case"m":case"squaremeters":case"squaremeter":return 9001;case"miles":case"mile":case"squaremile":case"squaremiles":return 9035;case"kilometers":case"kilometer":case"squarekilometers":case"squarekilometer":case"km":return 9036;case"yard":case"yd":case"yards":case"squareyards":case"squareyard":return 9096;case"feet":case"ft":case"foot":case"squarefeet":case"squarefoot":return 9002;case"nm":case"nmi":case"nauticalmile":case"nauticalmiles":case"squarenauticalmile":case"squarenauticalmiles":return 9030}return null}function sn(e){if(null===e)return null;const n=e.clone();return void 0!==e.cache._geVersion&&(n.cache._geVersion=e.cache._geVersion),n}let ln=null;function cn(e){return 0===ve.indexOf("4.")?Ee.fromExtent(e):new Ee({spatialReference:e.spatialReference,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]})}function un(e,n){if("polygon"!==e.type&&"polyline"!==e.type&&"extent"!==e.type)return 0;let t=1;(e.spatialReference.vcsWkid||e.spatialReference.latestVcsWkid)&&(t=qe(e.spatialReference)/be(e.spatialReference));let r=0;if("polyline"===e.type)for(const n of e.paths)for(let e=1;e<n.length;e++)r+=je(n[e],n[e-1],t);else if("polygon"===e.type)for(const n of e.rings){for(let e=1;e<n.length;e++)r+=je(n[e],n[e-1],t);(n[0][0]!==n[n.length-1][0]||n[0][1]!==n[n.length-1][1]||void 0!==n[0][2]&&n[0][2]!==n[n.length-1][2])&&(r+=je(n[0],n[n.length-1],t))}else"extent"===e.type&&(r+=2*je([e.xmin,e.ymin,0],[e.xmax,e.ymin,0],t),r+=2*je([e.xmin,e.ymin,0],[e.xmin,e.ymax,0],t),r*=2,r+=4*Math.abs(g(e.zmax,0)*t-g(e.zmin,0)*t));const o=new Ie({hasZ:!1,hasM:!1,spatialReference:e.spatialReference,paths:[[0,0],[0,r]]});return ln.planarLength(o,n)}function fn(e,n){function t(e){if(p(e,2,2),e[0]instanceof ge&&e[1]instanceof ge);else if(e[0]instanceof ge&&null===e[1]);else if(e[1]instanceof ge&&null===e[0]);else if(null!==e[0]||null!==e[1])throw new Error("Illegal Argument")}e.disjoint=function(e,r){return n(e,r,(function(e,n,r){return t(r=D(r)),null===r[0]||null===r[1]||ln.disjoint(r[0],r[1])}))},e.intersects=function(e,r){return n(e,r,(function(e,n,r){return t(r=D(r)),null!==r[0]&&null!==r[1]&&ln.intersects(r[0],r[1])}))},e.touches=function(e,r){return n(e,r,(function(e,n,r){return t(r=D(r)),null!==r[0]&&null!==r[1]&&ln.touches(r[0],r[1])}))},e.crosses=function(e,r){return n(e,r,(function(e,n,r){return t(r=D(r)),null!==r[0]&&null!==r[1]&&ln.crosses(r[0],r[1])}))},e.within=function(e,r){return n(e,r,(function(e,n,r){return t(r=D(r)),null!==r[0]&&null!==r[1]&&ln.within(r[0],r[1])}))},e.contains=function(e,r){return n(e,r,(function(e,n,r){return t(r=D(r)),null!==r[0]&&null!==r[1]&&ln.contains(r[0],r[1])}))},e.overlaps=function(e,r){return n(e,r,(function(e,n,r){return t(r=D(r)),null!==r[0]&&null!==r[1]&&ln.overlaps(r[0],r[1])}))},e.equals=function(e,t){return n(e,t,(function(e,n,t){return p(t,2,2),t[0]===t[1]||(t[0]instanceof ge&&t[1]instanceof ge?ln.equals(t[0],t[1]):!(!P(t[0])||!P(t[1]))&&t[0].getTime()===t[1].getTime())}))},e.relate=function(e,t){return n(e,t,(function(e,n,t){if(t=D(t),p(t,3,3),t[0]instanceof ge&&t[1]instanceof ge)return ln.relate(t[0],t[1],M(t[2]));if(t[0]instanceof ge&&null===t[1])return!1;if(t[1]instanceof ge&&null===t[0])return!1;if(null===t[0]&&null===t[1])return!1;throw new Error("Illegal Argument")}))},e.intersection=function(e,r){return n(e,r,(function(e,n,r){return t(r=D(r)),null===r[0]||null===r[1]?null:ln.intersect(r[0],r[1])}))},e.union=function(e,t){return n(e,t,(function(n,t,r){const o=[];if(0===(r=D(r)).length)throw new Error("Function called with wrong number of Parameters");if(1===r.length)if(y(r[0])){const e=D(r[0]);for(let n=0;n<e.length;n++)if(null!==e[n]){if(!(e[n]instanceof ge))throw new Error("Illegal Argument");o.push(e[n])}}else{if(!w(r[0])){if(r[0]instanceof ge)return U(sn(r[0]),e.spatialReference);if(null===r[0])return null;throw new Error("Illegal Argument")}{const e=D(r[0].toArray());for(let n=0;n<e.length;n++)if(null!==e[n]){if(!(e[n]instanceof ge))throw new Error("Illegal Argument");o.push(e[n])}}}else for(let e=0;e<r.length;e++)if(null!==r[e]){if(!(r[e]instanceof ge))throw new Error("Illegal Argument");o.push(r[e])}return 0===o.length?null:ln.union(o)}))},e.difference=function(e,r){return n(e,r,(function(e,n,r){return t(r=D(r)),null!==r[0]&&null===r[1]?sn(r[0]):null===r[0]?null:ln.difference(r[0],r[1])}))},e.symmetricdifference=function(e,r){return n(e,r,(function(e,n,r){return t(r=D(r)),null===r[0]&&null===r[1]?null:null===r[0]?sn(r[1]):null===r[1]?sn(r[0]):ln.symmetricDifference(r[0],r[1])}))},e.clip=function(e,t){return n(e,t,(function(e,n,t){if(t=D(t),p(t,2,2),!(t[1]instanceof de)&&null!==t[1])throw new Error("Illegal Argument");if(null===t[0])return null;if(!(t[0]instanceof ge))throw new Error("Illegal Argument");return null===t[1]?null:ln.clip(t[0],t[1])}))},e.cut=function(e,t){return n(e,t,(function(e,n,t){if(t=D(t),p(t,2,2),!(t[1]instanceof Ie)&&null!==t[1])throw new Error("Illegal Argument");if(null===t[0])return[];if(!(t[0]instanceof ge))throw new Error("Illegal Argument");return null===t[1]?[sn(t[0])]:ln.cut(t[0],t[1])}))},e.area=function(e,t){return n(e,t,(function(n,t,r){if(p(r,1,2),null===(r=D(r))[0])return 0;if(y(r[0])||w(r[0])){const n=G(r[0],e.spatialReference);return null===n?0:ln.planarArea(n,rn(g(r[1],-1)))}if(!(r[0]instanceof ge))throw new Error("Illegal Argument");return ln.planarArea(r[0],rn(g(r[1],-1)))}))},e.areageodetic=function(e,t){return n(e,t,(function(n,t,r){if(p(r,1,2),null===(r=D(r))[0])return 0;if(y(r[0])||w(r[0])){const n=G(r[0],e.spatialReference);return null===n?0:ln.geodesicArea(n,rn(g(r[1],-1)))}if(!(r[0]instanceof ge))throw new Error("Illegal Argument");return ln.geodesicArea(r[0],rn(g(r[1],-1)))}))},e.length=function(e,t){return n(e,t,(function(n,t,r){if(p(r,1,2),null===(r=D(r))[0])return 0;if(y(r[0])||w(r[0])){const n=z(r[0],e.spatialReference);return null===n?0:ln.planarLength(n,an(g(r[1],-1)))}if(!(r[0]instanceof ge))throw new Error("Illegal Argument");return ln.planarLength(r[0],an(g(r[1],-1)))}))},e.length3d=function(e,t){return n(e,t,(function(n,t,r){if(p(r,1,2),null===(r=D(r))[0])return 0;if(y(r[0])||w(r[0])){const n=z(r[0],e.spatialReference);return null===n?0:!0===n.hasZ?un(n,an(g(r[1],-1))):ln.planarLength(n,an(g(r[1],-1)))}if(!(r[0]instanceof ge))throw new Error("Illegal Argument");return!0===r[0].hasZ?un(r[0],an(g(r[1],-1))):ln.planarLength(r[0],an(g(r[1],-1)))}))},e.lengthgeodetic=function(e,t){return n(e,t,(function(n,t,r){if(p(r,1,2),null===(r=D(r))[0])return 0;if(y(r[0])||w(r[0])){const n=z(r[0],e.spatialReference);return null===n?0:ln.geodesicLength(n,an(g(r[1],-1)))}if(!(r[0]instanceof ge))throw new Error("Illegal Argument");return ln.geodesicLength(r[0],an(g(r[1],-1)))}))},e.distance=function(e,t){return n(e,t,(function(n,t,r){r=D(r),p(r,2,3);let o=r[0];(y(r[0])||w(r[0]))&&(o=q(r[0],e.spatialReference));let a=r[1];if((y(r[1])||w(r[1]))&&(a=q(r[1],e.spatialReference)),!(o instanceof ge))throw new Error("Illegal Argument");if(!(a instanceof ge))throw new Error("Illegal Argument");return ln.distance(o,a,an(g(r[2],-1)))}))},e.distancegeodetic=function(e,t){return n(e,t,(function(e,n,t){t=D(t),p(t,2,3);const r=t[0],o=t[1];if(!(r instanceof ye))throw new Error("Illegal Argument");if(!(o instanceof ye))throw new Error("Illegal Argument");const a=new Ie({paths:[],spatialReference:r.spatialReference});return a.addPath([r,o]),ln.geodesicLength(a,an(g(t[2],-1)))}))},e.densify=function(e,t){return n(e,t,(function(e,n,t){if(t=D(t),p(t,2,3),null===t[0])return null;if(!(t[0]instanceof ge))throw new Error("Illegal Argument");const r=d(t[1]);if(isNaN(r))throw new Error("Illegal Argument");if(r<=0)throw new Error("Illegal Argument");return t[0]instanceof Ee||t[0]instanceof Ie?ln.densify(t[0],r,an(g(t[2],-1))):t[0]instanceof de?ln.densify(cn(t[0]),r,an(g(t[2],-1))):t[0]}))},e.densifygeodetic=function(e,t){return n(e,t,(function(e,n,t){if(t=D(t),p(t,2,3),null===t[0])return null;if(!(t[0]instanceof ge))throw new Error("Illegal Argument");const r=d(t[1]);if(isNaN(r))throw new Error("Illegal Argument");if(r<=0)throw new Error("Illegal Argument");return t[0]instanceof Ee||t[0]instanceof Ie?ln.geodesicDensify(t[0],r,an(g(t[2],-1))):t[0]instanceof de?ln.geodesicDensify(cn(t[0]),r,an(g(t[2],-1))):t[0]}))},e.generalize=function(e,t){return n(e,t,(function(e,n,t){if(t=D(t),p(t,2,4),null===t[0])return null;if(!(t[0]instanceof ge))throw new Error("Illegal Argument");const r=d(t[1]);if(isNaN(r))throw new Error("Illegal Argument");return ln.generalize(t[0],r,V(g(t[2],!0)),an(g(t[3],-1)))}))},e.buffer=function(e,t){return n(e,t,(function(e,n,t){if(t=D(t),p(t,2,3),null===t[0])return null;if(!(t[0]instanceof ge))throw new Error("Illegal Argument");const r=d(t[1]);if(isNaN(r))throw new Error("Illegal Argument");return 0===r?sn(t[0]):ln.buffer(t[0],r,an(g(t[2],-1)))}))},e.buffergeodetic=function(e,t){return n(e,t,(function(e,n,t){if(t=D(t),p(t,2,3),null===t[0])return null;if(!(t[0]instanceof ge))throw new Error("Illegal Argument");const r=d(t[1]);if(isNaN(r))throw new Error("Illegal Argument");return 0===r?sn(t[0]):ln.geodesicBuffer(t[0],r,an(g(t[2],-1)))}))},e.offset=function(e,t){return n(e,t,(function(e,n,t){if(t=D(t),p(t,2,6),null===t[0])return null;if(!(t[0]instanceof Ee||t[0]instanceof Ie))throw new Error("Illegal Argument");const r=d(t[1]);if(isNaN(r))throw new Error("Illegal Argument");const o=d(g(t[4],10));if(isNaN(o))throw new Error("Illegal Argument");const a=d(g(t[5],0));if(isNaN(a))throw new Error("Illegal Argument");return ln.offset(t[0],r,an(g(t[2],-1)),M(g(t[3],"round")).toLowerCase(),o,a)}))},e.rotate=function(e,t){return n(e,t,(function(e,n,t){t=D(t),p(t,2,3);let r=t[0];if(null===r)return null;if(!(r instanceof ge))throw new Error("Illegal Argument");r instanceof de&&(r=Ee.fromExtent(r));const o=d(t[1]);if(isNaN(o))throw new Error("Illegal Argument");const a=g(t[2],null);if(null===a)return ln.rotate(r,o);if(a instanceof ye)return ln.rotate(r,o,a);throw new Error("Illegal Argument")}))},e.centroid=function(e,t){return n(e,t,(function(n,t,r){if(r=D(r),p(r,1,1),null===r[0])return null;let o=r[0];if((y(r[0])||w(r[0]))&&(o=q(r[0],e.spatialReference)),null===o)return null;if(!(o instanceof ge))throw new Error("Illegal Argument");return o instanceof ye?U(sn(r[0]),e.spatialReference):o instanceof Ee?o.centroid:o instanceof Ie?Je(o):o instanceof we?We(o):o instanceof de?o.center:null}))},e.multiparttosinglepart=function(e,t){return n(e,t,(function(n,t,r){r=D(r),p(r,1,1);const o=[];if(null===r[0])return null;if(!(r[0]instanceof ge))throw new Error("Illegal Argument");if(r[0]instanceof ye)return[U(sn(r[0]),e.spatialReference)];if(r[0]instanceof de)return[U(sn(r[0]),e.spatialReference)];const a=ln.simplify(r[0]);if(a instanceof Ee){const e=[],n=[];for(let t=0;t<a.rings.length;t++)if(a.isClockwise(a.rings[t])){const n=Ne({rings:[a.rings[t]],hasZ:!0===a.hasZ,hasM:!0===a.hasM,spatialReference:a.spatialReference.toJSON()});e.push(n)}else n.push({ring:a.rings[t],pt:a.getPoint(t,0)});for(let t=0;t<n.length;t++)for(let r=0;r<e.length;r++)if(e[r].contains(n[t].pt)){e[r].addRing(n[t].ring);break}return e}if(a instanceof Ie){const e=[];for(let n=0;n<a.paths.length;n++){const t=Ne({paths:[a.paths[n]],hasZ:!0===a.hasZ,hasM:!0===a.hasM,spatialReference:a.spatialReference.toJSON()});e.push(t)}return e}if(r[0]instanceof we){const n=U(sn(r[0]),e.spatialReference);for(let e=0;e<n.points.length;e++)o.push(n.getPoint(e));return o}return null}))},e.issimple=function(e,t){return n(e,t,(function(e,n,t){if(t=D(t),p(t,1,1),null===t[0])return!0;if(!(t[0]instanceof ge))throw new Error("Illegal Argument");return ln.isSimple(t[0])}))},e.simplify=function(e,t){return n(e,t,(function(e,n,t){if(t=D(t),p(t,1,1),null===t[0])return null;if(!(t[0]instanceof ge))throw new Error("Illegal Argument");return ln.simplify(t[0])}))}}const hn=Object.freeze(Object.defineProperty({__proto__:null,setGeometryEngine:function(e){ln=e},registerFunctions:fn},Symbol.toStringTag,{value:"Module"}));function pn(e,n,t){return void 0===t||0==+t?Math[e](n):(n=+n,t=+t,isNaN(n)||"number"!=typeof t||t%1!=0?NaN:(n=n.toString().split("e"),+((n=(n=Math[e](+(n[0]+"e"+(n[1]?+n[1]-t:-t)))).toString().split("e"))[0]+"e"+(n[1]?+n[1]+t:t))))}function dn(e,n){function t(e,n,t){const r=d(e);return isNaN(r)?r:isNaN(n)||isNaN(t)||n>t?NaN:r<n?n:r>t?t:r}e.number=function(e,t){return n(e,t,(function(e,n,t){p(t,1,2);const r=t[0];if(k(r))return r;if(null===r)return 0;if(P(r))return Number(r);if(I(r))return Number(r);if(y(r))return NaN;if(""===r)return Number(r);if(void 0===r)return Number(r);if(R(r)){if(void 0!==t[1]){let e=H(t[1],"‰","");return e=H(e,"¤",""),Ae(r,{pattern:e})}return Number(r.trim())}return Number(r)}))},e.abs=function(e,t){return n(e,t,(function(e,n,t){return p(t,1,1),Math.abs(d(t[0]))}))},e.acos=function(e,t){return n(e,t,(function(e,n,t){return p(t,1,1),Math.acos(d(t[0]))}))},e.asin=function(e,t){return n(e,t,(function(e,n,t){return p(t,1,1),Math.asin(d(t[0]))}))},e.atan=function(e,t){return n(e,t,(function(e,n,t){return p(t,1,1),Math.atan(d(t[0]))}))},e.atan2=function(e,t){return n(e,t,(function(e,n,t){return p(t,2,2),Math.atan2(d(t[0]),d(t[1]))}))},e.ceil=function(e,t){return n(e,t,(function(e,n,t){if(p(t,1,2),2===t.length){let e=d(t[1]);return isNaN(e)&&(e=0),pn("ceil",d(t[0]),-1*e)}return Math.ceil(d(t[0]))}))},e.round=function(e,t){return n(e,t,(function(e,n,t){if(p(t,1,2),2===t.length){let e=d(t[1]);return isNaN(e)&&(e=0),pn("round",d(t[0]),-1*e)}return Math.round(d(t[0]))}))},e.floor=function(e,t){return n(e,t,(function(e,n,t){if(p(t,1,2),2===t.length){let e=d(t[1]);return isNaN(e)&&(e=0),pn("floor",d(t[0]),-1*e)}return Math.floor(d(t[0]))}))},e.cos=function(e,t){return n(e,t,(function(e,n,t){return p(t,1,1),Math.cos(d(t[0]))}))},e.isnan=function(e,t){return n(e,t,(function(e,n,t){return p(t,1,1),"number"==typeof t[0]&&isNaN(t[0])}))},e.exp=function(e,t){return n(e,t,(function(e,n,t){return p(t,1,1),Math.exp(d(t[0]))}))},e.log=function(e,t){return n(e,t,(function(e,n,t){return p(t,1,1),Math.log(d(t[0]))}))},e.pow=function(e,t){return n(e,t,(function(e,n,t){return p(t,2,2),d(t[0])**d(t[1])}))},e.random=function(e,t){return n(e,t,(function(e,n,t){return p(t,0,0),Math.random()}))},e.sin=function(e,t){return n(e,t,(function(e,n,t){return p(t,1,1),Math.sin(d(t[0]))}))},e.sqrt=function(e,t){return n(e,t,(function(e,n,t){return p(t,1,1),Math.sqrt(d(t[0]))}))},e.tan=function(e,t){return n(e,t,(function(e,n,t){return p(t,1,1),Math.tan(d(t[0]))}))},e.defaultvalue=function(e,t){return n(e,t,(function(e,n,t){return p(t,2,2),null===t[0]||""===t[0]||void 0===t[0]?t[1]:t[0]}))},e.isempty=function(e,t){return n(e,t,(function(e,n,t){return p(t,1,1),null===t[0]||""===t[0]||void 0===t[0]}))},e.boolean=function(e,t){return n(e,t,(function(e,n,t){p(t,1,1);const r=t[0];return V(r)}))},e.constrain=function(e,r){return n(e,r,(function(e,n,r){p(r,3,3);const o=d(r[1]),a=d(r[2]);if(y(r[0])){const e=[];for(const n of r[0])e.push(t(n,o,a));return e}if(w(r[0])){const e=[];for(let n=0;n<r[0].length();n++)e.push(t(r[0].get(n),o,a));return e}return t(r[0],o,a)}))}}function mn(e){let n=0;for(let t=0;t<e.length;t++)n+=e[t];return n/e.length}function gn(e){const n=mn(e);let t=0;for(let r=0;r<e.length;r++)t+=(n-e[r])**2;return t/e.length}function wn(e,n,t=1e3){switch(e.toLowerCase()){case"distinct":return function(e,n){const t=[],r={},o=[];for(let a=0;a<e.length;a++){if(void 0!==e[a]&&null!==e[a]&&e[a]!==E){const n=e[a];if(k(n)||R(n))void 0===r[n]&&(t.push(n),r[n]=1);else{let e=!1;for(let t=0;t<o.length;t++)!0===S(o[t],n)&&(e=!0);!1===e&&(o.push(n),t.push(n))}}if(t.length>=n&&-1!==n)return t}return t}(n,t);case"avg":case"mean":return mn(B(n));case"min":return Math.min.apply(Math,B(n));case"sum":return function(e){let n=0;for(let t=0;t<e.length;t++)n+=e[t];return n}(B(n));case"max":return Math.max.apply(Math,B(n));case"stdev":case"stddev":return Math.sqrt(gn(B(n)));case"var":case"variance":return gn(B(n));case"count":return n.length}return 0}function yn(e,n,t,r){if(1===r.length){if(y(r[0]))return wn(e,r[0],-1);if(w(r[0]))return wn(e,r[0].toArray(),-1)}return wn(e,r,-1)}function En(e,n){e.stdev=function(e,t){return n(e,t,(function(e,n,t){return yn("stdev",0,0,t)}))},e.variance=function(e,t){return n(e,t,(function(e,n,t){return yn("variance",0,0,t)}))},e.average=function(e,t){return n(e,t,(function(e,n,t){return yn("mean",0,0,t)}))},e.mean=function(e,t){return n(e,t,(function(e,n,t){return yn("mean",0,0,t)}))},e.sum=function(e,t){return n(e,t,(function(e,n,t){return yn("sum",0,0,t)}))},e.min=function(e,t){return n(e,t,(function(e,n,t){return yn("min",0,0,t)}))},e.max=function(e,t){return n(e,t,(function(e,n,t){return yn("max",0,0,t)}))},e.distinct=function(e,t){return n(e,t,(function(e,n,t){return yn("distinct",0,0,t)}))},e.count=function(e,t){return n(e,t,(function(e,n,t){if(p(t,1,1),y(t[0])||R(t[0]))return t[0].length;if(w(t[0]))return t[0].length();throw new Error("Invalid Parameters for Count")}))}}const Sn=e=>(n,t,r)=>(r=r||14,+e(n,t).toFixed(r)),In=(e,n)=>e+n,Nn=(e,n)=>e*n,vn=(e,n)=>e/n,bn=(e,n,t)=>Sn(In)(e,n,t),An=(e,n,t)=>Sn(Nn)(e,n,t),xn=(e,n,t)=>Sn(vn)(e,n,t),Mn=2*Math.PI,_n=648e3/Math.PI,Rn=String.fromCharCode(7501);function Tn(e){if(!1===R(e))throw new Error("Invalid Parameter");return e}function Fn(e,n){const t=10**n;return Math.round(e*t)/t}function On(e){const n=parseFloat(e.toString().replace(Math.trunc(e).toString(),"0"))*Math.sign(e);return e<0?{fraction:n,integer:Math.ceil(e)}:{fraction:n,integer:Math.floor(e)}}var Un,Cn,Dn,Pn;function kn(e,n){switch(e){case Un.north:return"SHORT"===n?"N":"North";case Un.east:return"SHORT"===n?"E":"East";case Un.south:return"SHORT"===n?"S":"South";case Un.west:return"SHORT"===n?"W":"West"}}function Ln(e,n,t){for(;e.length<t;)e=n+e;return e}function jn(e,n){return e-Math.floor(e/n)*n}function zn(e){switch(e){case Cn.truncated_degrees:case Cn.decimal_degrees:return 360;case Cn.radians:return Mn;case Cn.gradians:return 400;case Cn.seconds:return 1296e3;case Cn.fractional_degree_minutes:case Cn.fractional_minute_seconds:return 60;default:throw new Error("Unnexpected evaluations")}}function Gn(e){switch(e.toUpperCase().trim()){case"NORTH":case"NORTHAZIMUTH":case"NORTH AZIMUTH":return Dn.north_azimuth;case"POLAR":return Dn.polar;case"QUADRANT":return Dn.quadrant;case"SOUTH":case"SOUTHAZIMUTH":case"SOUTH AZIMUTH":return Dn.south_azimuth}throw new Error("Unsupported direction type")}function qn(e){switch(e.toUpperCase().trim()){case"D":case"DD":case"DECIMALDEGREE":case"DECIMAL DEGREE":case"DEGREE":case"DECIMALDEGREES":case"DECIMAL DEGREES":case"DEGREES":return Cn.decimal_degrees;case"DMS":case"DEGREESMINUTESSECONDS":case"DEGREES MINUTES SECONDS":return Cn.degrees_minutes_seconds;case"R":case"RAD":case"RADS":case"RADIAN":case"RADIANS":return Cn.radians;case"G":case"GON":case"GONS":case"GRAD":case"GRADS":case"GRADIAN":case"GRADIANS":return Cn.gradians}throw new Error("Unsupported units")}!function(e){e[e.north=0]="north",e[e.east=1]="east",e[e.south=2]="south",e[e.west=3]="west"}(Un||(Un={})),function(e){e[e.decimal_degrees=1]="decimal_degrees",e[e.seconds=2]="seconds",e[e.degrees_minutes_seconds=3]="degrees_minutes_seconds",e[e.radians=4]="radians",e[e.gradians=5]="gradians",e[e.truncated_degrees=6]="truncated_degrees",e[e.fractional_degree_minutes=7]="fractional_degree_minutes",e[e.fractional_minute_seconds=8]="fractional_minute_seconds"}(Cn||(Cn={})),function(e){e[e.north_azimuth=1]="north_azimuth",e[e.polar=2]="polar",e[e.quadrant=3]="quadrant",e[e.south_azimuth=4]="south_azimuth"}(Dn||(Dn={})),function(e){e[e.meridian=0]="meridian",e[e.direction=1]="direction"}(Pn||(Pn={}));class Vn{constructor(e,n,t){this.m_degrees=e,this.m_minutes=n,this.m_seconds=t}getField(e){switch(e){case Cn.decimal_degrees:case Cn.truncated_degrees:return this.m_degrees;case Cn.fractional_degree_minutes:return this.m_minutes;case Cn.seconds:case Cn.fractional_minute_seconds:return this.m_seconds;default:throw new Error("Unnexpected evaluation")}}static secondsToDMS(e){const n=On(e).fraction;let t=On(e).integer;const r=Math.floor(t/3600);t-=3600*r;const o=Math.floor(t/60);return t-=60*o,new Vn(r,o,t+n)}static numberToDms(e){const n=On(e).fraction,t=On(e).integer,r=An(On(100*n).fraction,100),o=On(100*n).integer;return new Vn(t,o,r)}format(e,n){let t=Fn(this.m_seconds,n),r=this.m_minutes,o=this.m_degrees;if(e===Cn.seconds||e===Cn.fractional_minute_seconds)60<=t&&(t-=60,++r),60<=r&&(r=0,++o),360<=o&&(o=0);else if(e===Cn.fractional_degree_minutes)t=0,r=30<=this.m_seconds?this.m_minutes+1:this.m_minutes,o=this.m_degrees,60<=r&&(r=0,++o),360<=o&&(o=0);else if(e===Cn.decimal_degrees||e===Cn.truncated_degrees){const e=xn(this.m_seconds,3600),n=xn(this.m_minutes,60);o=Math.round(this.m_degrees+n+e),r=0,t=0}return new Vn(o,r,t)}static dmsToSeconds(e,n,t){return 3600*e+60*n+t}}class Hn{constructor(e,n,t){this.meridian=e,this.angle=n,this.direction=t}fetchAzimuth(e){return e===Pn.meridian?this.meridian:this.direction}}class Bn{constructor(e){this.m_angle=e}static createFromAngleAndDirection(e,n){return new Bn(new Zn(Bn._convertDirectionFormat(e.extractAngularUnits(Cn.seconds),n,Dn.north_azimuth)))}getAngle(e){const n=this.m_angle.extractAngularUnits(Cn.seconds);switch(e){case Dn.north_azimuth:case Dn.south_azimuth:case Dn.polar:return new Zn(Bn._convertDirectionFormat(n,Dn.north_azimuth,e));case Dn.quadrant:{const e=Bn.secondsNorthAzimuthToQuadrant(n);return new Zn(e.angle)}}}getMeridian(e){const n=this.m_angle.extractAngularUnits(Cn.seconds);switch(e){case Dn.north_azimuth:return Un.north;case Dn.south_azimuth:return Un.south;case Dn.polar:return Un.east;case Dn.quadrant:return Bn.secondsNorthAzimuthToQuadrant(n).meridian}}getDirection(e){const n=this.m_angle.extractAngularUnits(Cn.seconds);switch(e){case Dn.north_azimuth:return Un.east;case Dn.south_azimuth:return Un.west;case Dn.polar:return Un.north;case Dn.quadrant:return Bn.secondsNorthAzimuthToQuadrant(n).direction}}static secondsNorthAzimuthToQuadrant(e){const n=e<=324e3||e>=972e3?Un.north:Un.south,t=n===Un.north?Math.min(1296e3-e,e):Math.abs(e-648e3),r=e>648e3?Un.west:Un.east;return new Hn(n,t,r)}static createFromAngleMeridianAndDirection(e,n,t){return new Bn(new Zn(Bn.secondsQuadrantToNorthAzimuth(e.extractAngularUnits(Cn.seconds),n,t)))}static secondsQuadrantToNorthAzimuth(e,n,t){return n===Un.north?t===Un.east?e:1296e3-e:t===Un.east?648e3-e:648e3+e}static _convertDirectionFormat(e,n,t){let r=0;switch(n){case Dn.north_azimuth:r=e;break;case Dn.polar:r=324e3-e;break;case Dn.quadrant:throw new Error("Unnexpected evaluation");case Dn.south_azimuth:r=e+648e3}let o=0;switch(t){case Dn.north_azimuth:o=r;break;case Dn.polar:o=324e3-r;break;case Dn.quadrant:throw new Error("Unnexpected evaluation");case Dn.south_azimuth:o=r-648e3}return o%=1296e3,o<0?1296e3+o:o}}function Yn(e,n,t){let r=null;switch(n){case Cn.decimal_degrees:r=An(e,3600);break;case Cn.seconds:r=e;break;case Cn.gradians:r=An(e,3240);break;case Cn.radians:r=An(e,_n);break;default:throw new Error("Unnexpected evaluation")}switch(t){case Cn.decimal_degrees:return xn(r,3600);case Cn.seconds:return r;case Cn.gradians:return xn(r,3240);case Cn.radians:return r/_n;default:throw new Error("Unnexpected evaluation")}}class Zn{constructor(e){this.m_seconds=e}static createFromAngleAndUnits(e,n){return new Zn(Yn(e,n,Cn.seconds))}extractAngularUnits(e){return Yn(this.m_seconds,Cn.seconds,Jn(e))}static createFromDegreesMinutesSeconds(e,n,t){return new Zn(bn(bn(An(e,3600),An(n,60)),t))}}function Jn(e){switch(e){case Cn.decimal_degrees:case Cn.truncated_degrees:case Cn.degrees_minutes_seconds:return Cn.decimal_degrees;case Cn.gradians:return Cn.gradians;case Cn.fractional_degree_minutes:return Cn.fractional_degree_minutes;case Cn.radians:return Cn.radians;case Cn.seconds:case Cn.fractional_minute_seconds:return Cn.seconds}}class Wn{constructor(e,n,t,r){this.m_view=e,this.m_angle=n,this.m_merdian=t,this.m_direction=r,this.m_dms=null,this.m_formatted_dms=null}static createFromStringAndBearing(e,n,t){return new Wn(e,n.getAngle(t),n.getMeridian(t),n.getDirection(t))}fetchAngle(){return this.m_angle}fetchMeridian(){return this.m_merdian}fetchDirection(){return this.m_direction}fetchView(){return this.m_view}fetchDms(){return null===this.m_dms&&this._calculateDms(),this.m_dms}fetchFormattedDms(){return null===this.m_formatted_dms&&this._calculateDms(),this.m_formatted_dms}_calculateDms(){let e=null,n=Cn.truncated_degrees,t=0;for(let r=0;r<this.m_view.length;r++){const o=this.m_view[r];switch(o){case"m":e=et(this.m_view,r,o),n=n===Cn.truncated_degrees?Cn.fractional_degree_minutes:n,r=e.newpos;continue;case"s":e=et(this.m_view,r,o),n=Cn.fractional_minute_seconds,t=t<e.rounding?e.rounding:t,r=e.newpos;continue;default:continue}}this.m_dms=Vn.secondsToDMS(this.m_angle.extractAngularUnits(Cn.seconds)),this.m_formatted_dms=Vn.secondsToDMS(this.m_angle.extractAngularUnits(Cn.seconds)).format(n,t)}}function $n(e,n,t,r,o){let a=null;switch(n){case Cn.decimal_degrees:case Cn.radians:case Cn.gradians:return a=jn(Fn(e.extractAngularUnits(n),r),zn(n)),Ln(a.toFixed(r),"0",t+r+(r>0?1:0));case Cn.truncated_degrees:case Cn.fractional_degree_minutes:return a=jn(o.fetchFormattedDms().getField(n),zn(n)),Ln(a.toFixed(r),"0",t+r+(r>0?1:0));case Cn.fractional_minute_seconds:return a=jn(Fn(o.fetchDms().getField(n),r),zn(n)),Ln(a.toFixed(r),"0",t+r+(r>0?1:0));default:throw new Error("Unnexepected evaluation")}}function Qn(e){switch(e.toUpperCase().trim()){case"N":case"NORTH":return Un.north;case"E":case"EAST":return Un.east;case"S":case"SOUTH":return Un.south;case"W":case"WEST":return Un.west}return null}function Xn(e){const n=parseFloat(e);if(k(n)){if(isNaN(n))throw new Error("Invalid conversion");return n}throw new Error("Invalid conversion")}function Kn(e,n,t){const r=t===Dn.quadrant;let o=null,a=null,i=0,s=0,l=0;if(r){if(e.length<2)throw new Error("Conversion Error");l=1;const n=function(e){switch(d(e)){case 1:return{first:Un.north,second:Un.east};case 2:return{first:Un.south,second:Un.east};case 3:return{first:Un.south,second:Un.west};case 4:return{first:Un.north,second:Un.west}}return null}(M(e[e.length-1]));if(n?(o=n.first,a=n.second):(i=1,o=Qn(M(e[0])),a=Qn(M(e[e.length-1]))),null===o||null===a)throw new Error("Invalid Conversion")}switch(n){case Cn.decimal_degrees:case Cn.radians:case Cn.gradians:if(0===e.length)throw new Error("Invalid Conversion");return r?Bn.createFromAngleMeridianAndDirection(Zn.createFromAngleAndUnits(Xn(e[i]),Jn(n)),o,a):Bn.createFromAngleAndDirection(Zn.createFromAngleAndUnits(Xn(e[i]),Jn(n)),t);case Cn.degrees_minutes_seconds:if(s=e.length-l-i,3===s){const n=Zn.createFromDegreesMinutesSeconds(Xn(e[i]),Xn(e[i+1]),Xn(e[i+2]));return r?Bn.createFromAngleMeridianAndDirection(n,o,a):Bn.createFromAngleAndDirection(n,t)}if(1===s){const n=Xn(e[i]),s=Vn.numberToDms(n),l=Zn.createFromDegreesMinutesSeconds(s.m_degrees,s.m_minutes,s.m_seconds);return r?Bn.createFromAngleMeridianAndDirection(l,o,a):Bn.createFromAngleAndDirection(l,t)}}throw new Error("Conversion Error")}function et(e,n,t){const r={padding:0,rounding:0,newpos:n};let o=!1;for(;n<e.length;){const a=e[n];if(a===t)o?r.rounding++:r.padding++,n++;else{if("."!==a)break;o=!0,n++}}return r.newpos=n-1,r}function nt(e,n,t){const r={escaped:"",newpos:n};for(n++;n<e.length;){const t=e[n];if(n++,"]"===t)break;r.escaped+=t}return r.newpos=n-1,r}function tt(e){const n=[];for(let t=0,r=e.length;t<r;t++){let r=e.charCodeAt(t);r<128?n.push(r):r<2048?n.push(192|r>>6,128|63&r):r<55296||r>=57344?n.push(224|r>>12,128|r>>6&63,128|63&r):(t++,r=65536+((1023&r)<<10|1023&e.charCodeAt(t)),n.push(240|r>>18,128|r>>12&63,128|r>>6&63,128|63&r))}return new Uint8Array(n)}class rt{constructor(e){this.seed=e,this.totallen=0,this.bufs=[],this.init()}init(){return this.bufs=[],this.totallen=0,this}updateFloatArray(e){const n=[];for(const t of e)isNaN(t)?n.push("NaN"):t===1/0?n.push("Infinity"):t===-1/0?n.push("-Infinity"):0===t?n.push("0"):n.push(t.toString(16));this.update(tt(n.join("")))}updateIntArray(e){const n=Int32Array.from(e);this.update(new Uint8Array(n.buffer))}updateUint8Array(e){this.update(Uint8Array.from(e))}updateWithString(e){return this.update(tt(e))}update(e){return this.bufs.push(e),this.totallen+=e.length,this}digest(){const e=new Uint8Array(this.totallen);let n=0;for(const t of this.bufs)e.set(t,n),n+=t.length;return this.init(),this._xxHash32(e,this.seed)}_xxHash32(e,n=0){const t=e;let r=n+374761393&4294967295,o=0;if(t.length>=16){const t=[n+2654435761+2246822519&4294967295,n+2246822519&4294967295,n+0&4294967295,n-2654435761&4294967295],a=e,i=a.length-16;let s=0;for(o=0;(4294967280&o)<=i;o+=4){const e=o,n=2246822519*(a[e+0]+(a[e+1]<<8))+(2246822519*(a[e+2]+(a[e+3]<<8))<<16);let r=t[s]+n&4294967295;r=r<<13|r>>>19;const i=65535&r,l=r>>>16;t[s]=2654435761*i+(2654435761*l<<16)&4294967295,s=s+1&3}r=(t[0]<<1|t[0]>>>31)+(t[1]<<7|t[1]>>>25)+(t[2]<<12|t[2]>>>20)+(t[3]<<18|t[3]>>>14)&4294967295}r=r+e.length&4294967295;const a=e.length-4;for(;o<=a;o+=4){const e=o;r=r+(3266489917*(t[e+0]+(t[e+1]<<8))+(3266489917*(t[e+2]+(t[e+3]<<8))<<16))&4294967295,r=r<<17|r>>>15,r=668265263*(65535&r)+(668265263*(r>>>16)<<16)&4294967295}for(;o<t.length;++o)r+=374761393*t[o],r=r<<11|r>>>21,r=2654435761*(65535&r)+(2654435761*(r>>>16)<<16)&4294967295;return r^=r>>>15,r=(2246822519*(65535&r)&4294967295)+(2246822519*(r>>>16)<<16),r^=r>>>13,r=(3266489917*(65535&r)&4294967295)+(3266489917*(r>>>16)<<16),r^=r>>>16,r<0?r+4294967296:r}}function ot(e,n){if(e.x===n.x&&e.y===n.y){if(e.hasZ){if(e.z!==n.z)return!1}else if(n.hasZ)return!1;if(e.hasM){if(e.m!==n.m)return!1}else if(n.hasM)return!1;return!0}return!1}function at(n,t,r){if(null!==n)if(y(n)){if(t.updateUint8Array([61]),r.map.has(n)){const e=r.map.get(n);t.updateIntArray([61237541^e])}else{r.map.set(n,r.currentLength++);for(const e of n)at(e,t,r);r.map.delete(n),r.currentLength--}t.updateUint8Array([199])}else if(w(n)){if(t.updateUint8Array([61]),r.map.has(n)){const e=r.map.get(n);t.updateIntArray([61237541^e])}else{r.map.set(n,r.currentLength++);for(const e of n.toArray())at(e,t,r);r.map.delete(n),r.currentLength--}t.updateUint8Array([199])}else{if(P(n))return t.updateIntArray([n.getTime()]),void t.updateUint8Array([241]);if(R(n))return t.updateIntArray([n.length]),t.updateWithString(n),void t.updateUint8Array([41]);if(I(n))t.updateUint8Array([!0===n?1:0,113]);else{if(k(n))return t.updateFloatArray([n]),void t.updateUint8Array([173]);if(n instanceof Fe)throw new Error("Type not supported in Hash");if(n instanceof Te)throw new Error("Type not supported in Hash");if(!(n instanceof e)){if(J(n))throw new Error("Type not supported in Hash");if(n instanceof ye)return t.updateIntArray([3833836621]),t.updateIntArray([0]),t.updateFloatArray([n.x]),t.updateIntArray([1]),t.updateFloatArray([n.y]),n.hasZ&&(t.updateIntArray([2]),t.updateFloatArray([n.z])),n.hasM&&(t.updateIntArray([3]),t.updateFloatArray([n.m])),t.updateIntArray([3765347959]),void at(n.spatialReference.wkid,t,r);if(n instanceof Ee){t.updateIntArray([1266616829]);for(let e=0;e<n.rings.length;e++){const o=n.rings[e],a=[];let i=null,s=null;for(let t=0;t<o.length;t++){const r=n.getPoint(e,t);if(0===t)i=r;else if(ot(s,r))continue;s=r,t===o.length-1&&ot(i,r)||a.push(r)}t.updateIntArray([1397116793,a.length]);for(let e=0;e<a.length;e++){const n=a[e];t.updateIntArray([3962308117,e]),at(n,t,r),t.updateIntArray([2716288009])}t.updateIntArray([2278822459])}return t.updateIntArray([3878477243]),void at(n.spatialReference.wkid,t,r)}if(n instanceof Ie){t.updateIntArray([4106883559]);for(let e=0;e<n.paths.length;e++){const o=n.paths[e];t.updateIntArray([1397116793,o.length]);for(let a=0;a<o.length;a++)t.updateIntArray([3962308117,a]),at(n.getPoint(e,a),t,r),t.updateIntArray([2716288009]);t.updateIntArray([2278822459])}return t.updateIntArray([2568784753]),void at(n.spatialReference.wkid,t,r)}if(n instanceof we){t.updateIntArray([588535921,n.points.length]);for(let e=0;e<n.points.length;e++){const o=n.getPoint(e);t.updateIntArray([e]),at(o,t,r)}return t.updateIntArray([1700171621]),void at(n.spatialReference.wkid,t,r)}if(n instanceof de)return t.updateIntArray([3483648373]),t.updateIntArray([0]),t.updateFloatArray([n.xmax]),t.updateIntArray([1]),t.updateFloatArray([n.xmin]),t.updateIntArray([2]),t.updateFloatArray([n.ymax]),t.updateIntArray([3]),t.updateFloatArray([n.ymin]),n.hasZ&&(t.updateIntArray([4]),t.updateFloatArray([n.zmax]),t.updateIntArray([5]),t.updateFloatArray([n.zmin])),n.hasM&&(t.updateIntArray([6]),t.updateFloatArray([n.mmax]),t.updateIntArray([7]),t.updateFloatArray([n.mmin])),t.updateIntArray([3622027469]),void at(n.spatialReference.wkid,t,r);if(n instanceof xe)return t.updateIntArray([14]),void 0!==n.wkid&&null!==n.wkid&&t.updateIntArray([n.wkid]),void(n.wkt&&t.updateWithString(n.wkt));if(L(n))throw new Error("Type not supported in Hash");if(ne(n))throw new Error("Type not supported in Hash");if(te(n))throw new Error("Type not supported in Hash");if(n===E)throw new Error("Type not supported in Hash");throw new Error("Type not supported in Hash")}if(t.updateUint8Array([223]),r.map.has(n)){const e=r.map.get(n);t.updateIntArray([61237541^e])}else{r.map.set(n,r.currentLength++);for(const e of n.keys())t.updateIntArray([e.length]),t.updateWithString(e),t.updateUint8Array([251]),at(n.field(e),t,r),t.updateUint8Array([239]);r.map.delete(n),r.currentLength--}t.updateUint8Array([73])}}else t.updateUint8Array([0,139])}function it(n,t){n.portal=function(e,n){return t(e,n,(function(e,n,t){return p(t,1,1),new Te(M(t[0]))}))},n.trim=function(e,n){return t(e,n,(function(e,n,t){return p(t,1,1),M(t[0]).trim()}))},n.tohex=function(e,n){return t(e,n,(function(e,n,t){p(t,1,1);const r=d(t[0]);return isNaN(r)?r:r.toString(16)}))},n.upper=function(e,n){return t(e,n,(function(e,n,t){return p(t,1,1),M(t[0]).toUpperCase()}))},n.proper=function(e,n){return t(e,n,(function(e,n,t){p(t,1,2);let r=1;2===t.length&&"firstword"===M(t[1]).toLowerCase()&&(r=2);const o=/\s/,a=M(t[0]);let i="",s=!0;for(let e=0;e<a.length;e++){let n=a[e];o.test(n)?1===r&&(s=!0):n.toUpperCase()!==n.toLowerCase()&&(s?(n=n.toUpperCase(),s=!1):n=n.toLowerCase()),i+=n}return i}))},n.lower=function(e,n){return t(e,n,(function(e,n,t){return p(t,1,1),M(t[0]).toLowerCase()}))},n.guid=function(e,n){return t(e,n,(function(e,n,t){if(p(t,0,1),t.length>0)switch(M(t[0]).toLowerCase()){case"digits":return Y().replace("-","").replace("-","").replace("-","").replace("-","");case"digits-hyphen":return Y();case"digits-hyphen-braces":return"{"+Y()+"}";case"digits-hyphen-parentheses":return"("+Y()+")"}return"{"+Y()+"}"}))},n.console=function(e,n){return t(e,n,(function(n,t,r){return 0===r.length||(1===r.length?e.console(M(r[0])):e.console(M(r))),E}))},n.mid=function(e,n){return t(e,n,(function(e,n,t){p(t,2,3);let r=d(t[1]);if(isNaN(r))return"";if(r<0&&(r=0),2===t.length)return M(t[0]).substr(r);let o=d(t[2]);return isNaN(o)?"":(o<0&&(o=0),M(t[0]).substr(r,o))}))},n.find=function(e,n){return t(e,n,(function(e,n,t){p(t,2,3);let r=0;if(t.length>2){if(r=d(g(t[2],0)),isNaN(r))return-1;r<0&&(r=0)}return M(t[1]).indexOf(M(t[0]),r)}))},n.left=function(e,n){return t(e,n,(function(e,n,t){p(t,2,2);let r=d(t[1]);return isNaN(r)?"":(r<0&&(r=0),M(t[0]).substr(0,r))}))},n.right=function(e,n){return t(e,n,(function(e,n,t){p(t,2,2);let r=d(t[1]);return isNaN(r)?"":(r<0&&(r=0),M(t[0]).substr(-1*r,r))}))},n.split=function(e,n){return t(e,n,(function(e,n,t){let r;p(t,2,4);let o=d(g(t[2],-1));const a=V(g(t[3],!1));if(-1===o||null===o||!0===a?r=M(t[0]).split(M(t[1])):(isNaN(o)&&(o=-1),o<-1&&(o=-1),r=M(t[0]).split(M(t[1]),o)),!1===a)return r;const i=[];for(let e=0;e<r.length&&!(-1!==o&&i.length>=o);e++)""!==r[e]&&void 0!==r[e]&&i.push(r[e]);return i}))},n.text=function(e,n){return t(e,n,(function(e,n,t){return p(t,1,2),Z(t[0],t[1])}))},n.concatenate=function(e,n){return t(e,n,(function(e,n,t){const r=[];if(t.length<1)return"";if(y(t[0])){const e=g(t[2],"");for(let n=0;n<t[0].length;n++)r[n]=Z(t[0][n],e);return t.length>1?r.join(t[1]):r.join("")}if(w(t[0])){const e=g(t[2],"");for(let n=0;n<t[0].length();n++)r[n]=Z(t[0].get(n),e);return t.length>1?r.join(t[1]):r.join("")}for(let e=0;e<t.length;e++)r[e]=Z(t[e]);return r.join("")}))},n.reverse=function(e,n){return t(e,n,(function(e,n,t){if(p(t,1,1),y(t[0])){const e=t[0].slice(0);return e.reverse(),e}if(w(t[0])){const e=t[0].toArray().slice(0);return e.reverse(),e}throw new Error("Invalid Parameter")}))},n.replace=function(e,n){return t(e,n,(function(e,n,t){p(t,3,4);const r=M(t[0]),o=M(t[1]),a=M(t[2]);return 4!==t.length||V(t[3])?H(r,o,a):r.replace(o,a)}))},n.schema=function(n,r){return t(n,r,(function(n,t,r){if(J(r[0])){const n=W(r[0]);return n?e.convertObjectToArcadeDictionary(n):null}throw new Error("Invalid Parameter")}))},n.subtypes=function(n,r){return t(n,r,(function(n,t,r){if(p(r,1,1),J(r[0])){const n=$(r[0]);return n?e.convertObjectToArcadeDictionary(n):null}throw new Error("Invalid Parameter")}))},n.subtypecode=function(e,n){return t(e,n,(function(e,n,t){if(p(t,1,1),J(t[0])){const e=$(t[0]);if(!e)return null;if(e.subtypeField&&t[0].hasField(e.subtypeField)){const n=t[0].field(e.subtypeField);for(const t of e.subtypes)if(t.code===n)return t.code;return null}return null}throw new Error("Invalid Parameter")}))},n.subtypename=function(e,n){return t(e,n,(function(e,n,t){if(p(t,1,1),J(t[0])){const e=$(t[0]);if(!e)return"";if(e.subtypeField&&t[0].hasField(e.subtypeField)){const n=t[0].field(e.subtypeField);for(const t of e.subtypes)if(t.code===n)return t.name;return""}return""}throw new Error("Invalid Parameter")}))},n.gdbversion=function(e,n){return t(e,n,(function(e,n,t){if(p(t,1,1),J(t[0]))return t[0].gdbVersion();throw new Error("Invalid Parameter")}))},n.domain=function(n,r){return t(n,r,(function(n,t,r){if(p(r,2,3),J(r[0])){const n=Q(r[0],M(r[1]),void 0===r[2]?void 0:d(r[2]));return n&&n.domain?"coded-value"===n.domain.type||"codedValue"===n.domain.type?e.convertObjectToArcadeDictionary({type:"codedValue",name:n.domain.name,dataType:X[n.field.type],codedValues:n.domain.codedValues.map((e=>({name:e.name,code:e.code})))}):e.convertObjectToArcadeDictionary({type:"range",name:n.domain.name,dataType:X[n.field.type],min:n.domain.min,max:n.domain.max}):null}throw new Error("Invalid Parameter")}))},n.domainname=function(e,n){return t(e,n,(function(e,n,t){if(p(t,2,4),J(t[0]))return K(t[0],M(t[1]),t[2],void 0===t[3]?void 0:d(t[3]));throw new Error("Invalid Parameter")}))},n.domaincode=function(e,n){return t(e,n,(function(e,n,t){if(p(t,2,4),J(t[0]))return ee(t[0],M(t[1]),t[2],void 0===t[3]?void 0:d(t[3]));throw new Error("Invalid Parameter")}))},n.urlencode=function(n,r){return t(n,r,(function(n,t,r){if(p(r,1,1),null===r[0])return"";if(r[0]instanceof e){let e="";for(const n of r[0].keys()){const t=r[0].field(n);""!==e&&(e+="&"),e+=null===t?encodeURIComponent(n)+"=":encodeURIComponent(n)+"="+encodeURIComponent(t)}return e}return encodeURIComponent(M(r[0]))}))},n.hash=function(e,n){return t(e,n,(function(e,n,t){p(t,1,1);const r=new rt(0);return at(t[0],r,{map:new Map,currentLength:0}),r.digest()}))},n.convertdirection=function(n,r){return t(n,r,(function(n,t,r){return p(r,3,3),function(n,t,r){if(!(t instanceof e))throw new Error("Invalid Parameter");if(!1===t.hasField("directionType"))throw new Error("Invalid Parameter - Missing directionType");if(!1===t.hasField("angleType"))throw new Error("Invalid Parameter - Missing directionType");const o=Gn(Tn(t.field("directiontype"))),a=function(e,n,t){if(k(e))return function(e,n,t){if(t===Dn.quadrant)throw new Error("Conversion error");if(n===Cn.degrees_minutes_seconds){const n=Vn.numberToDms(e);return Bn.createFromAngleAndDirection(Zn.createFromDegreesMinutesSeconds(n.m_degrees,n.m_minutes,n.m_seconds),t)}return Bn.createFromAngleAndDirection(Zn.createFromAngleAndUnits(e,Jn(n)),t)}(d(e),n,t);if(R(e))return Kn(function(e){const n=[" ","-","/","'",'"',"\\","^","°",Rn,"\t","\r","\n","*"];let t="";for(let r=0;r<e.length;r++){const o=e.charAt(r);n.includes(o)?t+="RRSPLITRRSPLITRR":t+=o}return t.split("RRSPLITRRSPLITRR").filter((e=>""!==e))}(e),n,t);if(y(e))return Kn(e,n,t);if(w(e))return Kn(e.toArray(),n,t);throw new Error("Conversion Error")}(n,qn(Tn(t.field("angletype"))),o);if(!(r instanceof e))throw new Error("Invalid Parameter");if(!1===r.hasField("directionType"))throw new Error("Invalid Parameter - Missing directionType");if(!1===r.hasField("outputType"))throw new Error("Invalid Parameter - Missing directionType");const i=Gn(Tn(r.field("directiontype"))),s=r.hasField("angleType")?qn(Tn(r.field("angletype"))):null,l=Tn(r.field("outputType")).toUpperCase().trim();if(!i||!l)throw new Error("Conversion error");if(!(s||"TEXT"===l&&r.hasField("format")))throw new Error("Invalid unit");switch(l){case"VALUE":return i===Dn.quadrant||s===Cn.degrees_minutes_seconds?function(e,n,t){const r=e.getAngle(n);if(n===Dn.quadrant&&t===Cn.degrees_minutes_seconds){const t=Vn.secondsToDMS(r.extractAngularUnits(Cn.seconds));return[kn(e.getMeridian(n),"SHORT"),t.m_degrees,t.m_minutes,t.m_seconds,kn(e.getDirection(n),"SHORT")]}if(t===Cn.degrees_minutes_seconds){const e=Vn.secondsToDMS(r.extractAngularUnits(Cn.seconds));return[e.m_degrees,e.m_minutes,e.m_seconds]}return n===Dn.quadrant?[kn(e.getMeridian(n),"SHORT"),r.extractAngularUnits(t),kn(e.getDirection(n),"SHORT")]:[r.extractAngularUnits(t)]}(a,i,s):function(e,n,t){const r=Jn(t);if(r&&t!==Cn.degrees_minutes_seconds)return e.getAngle(n).extractAngularUnits(r);throw new Error("Conversion Error")}(a,i,s);case"TEXT":{let e="";return r.hasField("format")&&(e=M(r.field("format"))),null!==e&&""!==e||(e=function(e,n){let t="";switch(e){case Cn.decimal_degrees:t=n===Dn.quadrant?"DD.DD°":"DDD.DD°";break;case Cn.degrees_minutes_seconds:t=n===Dn.quadrant?"dd° mm' ss\"":"ddd° mm' ss.ss\"";break;case Cn.radians:t="R.RR";break;case Cn.gradians:t="GGG.GG"+Rn;break;default:throw new Error("Conversion error")}return n===Dn.quadrant&&(t="p "+t+" b"),t}(s,i)),function(e,n,t){let r="",o=null,a=null;const i=Wn.createFromStringAndBearing(n,e,t),s={D:Cn.decimal_degrees,d:Cn.truncated_degrees,m:Cn.fractional_degree_minutes,s:Cn.fractional_minute_seconds,R:Cn.radians,G:Cn.gradians};for(let l=0;l<n.length;l++){const c=n[l];switch(c){case"[":o=nt(n,l),r+=o.escaped,l=o.newpos;continue;case"D":case"d":case"m":case"s":case"R":case"G":o=et(n,l,c),a=e.getAngle(t),r+=$n(a,s[c],o.padding,o.rounding,i),l=o.newpos;continue;case"P":case"p":r+=kn(i.fetchMeridian(),"p"===c?"SHORT":"LONG");continue;case"B":case"b":r+=kn(i.fetchDirection(),"b"===c?"SHORT":"LONG");continue;default:r+=c}}return r}(a,e,i)}default:throw new Error("Invalid Parameter")}}(r[0],r[1],r[2])}))},n.fromjson=function(n,r){return t(n,r,(function(n,t,r){if(p(r,1,1),!1===R(r[0]))throw new Error("Invalid Parameter");return e.convertJsonToArcade(JSON.parse(M(r[0])))}))},n.expects=function(e,n){return t(e,n,(function(e,n,t){if(t.length<1)throw new Error("Function called with wrong number of Parameters");return E}))},n.tocharcode=function(e,n){return t(e,n,(function(e,n,t){p(t,1,2);const r=d(g(t[1],0)),o=M(t[0]);if(0===o.length&&1===t.length)return null;if(o.length<=r||r<0)throw new Error("Illegal argument");return o.charCodeAt(r)}))},n.tocodepoint=function(e,n){return t(e,n,(function(e,n,t){p(t,1,2);const r=d(g(t[1],0)),o=M(t[0]);if(0===o.length&&1===t.length)return null;if(o.length<=r||r<0)throw new Error("Illegal argument");return o.codePointAt(r)}))},n.fromcharcode=function(e,n){return t(e,n,(function(e,n,t){if(t.length<1)throw new Error("Function called with wrong number of Parameters");const r=t.map((e=>Math.trunc(d(e)))).filter((e=>e>=0&&e<=65535));return 0===r.length?null:String.fromCharCode.apply(null,r)}))},n.fromcodepoint=function(e,n){return t(e,n,(function(e,n,t){if(t.length<1)throw new Error("Function called with wrong number of Parameters");let r;try{r=t.map((e=>Math.trunc(d(e)))).filter((e=>e<=1114111&&e>>>0===e))}catch(e){return null}return 0===r.length?null:String.fromCodePoint.apply(null,r)}))}}function st(e,n,t){try{return t(e,null,n.arguments)}catch(e){throw e}}function lt(e,n){try{switch(n.type){case"EmptyStatement":return"lc.voidOperation";case"VariableDeclarator":return function(e,n){let t=null===n.init?null:lt(e,n.init);t===E&&(t=null);const r=n.id.name.toLowerCase();if(null!==e.localScope){if(void 0!==e.localScope[r])return"lscope['"+r+"']="+t+"; ";if(void 0!==e.localScope._SymbolsMap[r])return"lscope['"+e.localScope._SymbolsMap[r]+"']="+t+"; ";{const n=Et(e);return e.localScope._SymbolsMap[r]=n,e.mangleMap[r]=n,"lscope['"+n+"']="+t+"; "}}if(void 0!==e.globalScope[r])return"gscope['"+r+"']="+t+"; ";if(void 0!==e.globalScope._SymbolsMap[r])return"gscope['"+e.globalScope._SymbolsMap[r]+"']="+t+"; ";{const n=Et(e);return e.globalScope._SymbolsMap[r]=n,e.mangleMap[r]=n,"gscope['"+n+"']="+t+"; "}}(e,n);case"VariableDeclaration":return function(e,n){const t=[];for(let r=0;r<n.declarations.length;r++)t.push(lt(e,n.declarations[r]));return t.join("\n")+" \n lastStatement=  lc.voidOperation; \n"}(e,n);case"BlockStatement":return ut(e,n);case"FunctionDeclaration":return function(e,n){const t=n.id.name.toLowerCase(),r={isAsync:e.isAsync,spatialReference:e.spatialReference,console:e.console,lrucache:e.lrucache,interceptor:e.interceptor,services:e.services,symbols:e.symbols,mangleMap:e.mangleMap,localScope:{_SymbolsMap:{}},depthCounter:e.depthCounter+1,globalScope:e.globalScope};if(r.depthCounter>64)throw new Error("Exceeded maximum function depth");let o="new lc.SizzleFunction( lang.functionDepthchecker(function() { var lastStatement = lc.voidOperation; \n   var lscope = runtimeCtx.localStack[runtimeCtx.localStack.length-1];\n";for(let t=0;t<n.params.length;t++){const a=n.params[t].name.toLowerCase(),i=Et(e);r.localScope._SymbolsMap[a]=i,r.mangleMap[a]=i,o+="lscope['"+i+"']=arguments["+t.toString()+"];\n"}if(!0===e.isAsync?(o+="return lang.__awaiter(this, void 0, void 0, function* () {\n",o+=ut(r,n.body)+"\n return lastStatement; ",o+="});  }",o+=", runtimeCtx),"+n.params.length+")",o+="\n lastStatement = lc.voidOperation; \n"):(o+=ut(r,n.body)+"\n return lastStatement; }, runtimeCtx),"+n.params.length+")",o+="\n lastStatement = lc.voidOperation; \n"),void 0!==e.globalScope[t])return"gscope['"+t+"']="+o;if(void 0!==e.globalScope._SymbolsMap[t])return"gscope['"+e.globalScope._SymbolsMap[t]+"']="+o;{const n=Et(e);return e.globalScope._SymbolsMap[t]=n,e.mangleMap[t]=n,"gscope['"+n+"']="+o}}(e,n);case"ReturnStatement":return function(e,n){return null===n.argument?"return lc.voidOperation":"return "+lt(e,n.argument)}(e,n);case"IfStatement":return function(e,n){if("AssignmentExpression"===n.test.type||"UpdateExpression"===n.test.type)throw new Error(r(n.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));const t=lt(e,n.test),o=St(e);let a="var "+o+" = "+t+";\n if ("+o+" === true) {\n"+ct(e,n.consequent)+"\n }\n";return null!==n.alternate?a+="else if ("+o+"===false)   { \n"+ct(e,n.alternate)+"}\n":a+="else if ("+o+"===false) { \n lastStatement = lc.voidOperation;\n }\n",a+="else { lang.error({type: '"+n.type+"'},'RUNTIME','CANNOT_USE_NONBOOLEAN_IN_CONDITION'); \n}\n",a}(e,n);case"ExpressionStatement":return function(e,n){return"AssignmentExpression"===n.expression.type?"lastStatement = lc.voidOperation; "+lt(e,n.expression)+"; \n ":(n.expression.type,"lastStatement = "+lt(e,n.expression)+"; ")}(e,n);case"AssignmentExpression":return function(e,n){const t=lt(e,n.right);let r=null,o="";if("MemberExpression"===n.left.type)return r=lt(e,n.left.object),o=!0===n.left.computed?lt(e,n.left.property):"'"+n.left.property.name+"'","lang.assignmember("+r+","+o+",'"+n.operator+"',"+t+")";if(r=n.left.name.toLowerCase(),null!==e.localScope){if(void 0!==e.localScope[r])return"lscope['"+r+"']=lang.assign("+t+",'"+n.operator+"', lscope['"+r+"'])";if(void 0!==e.localScope._SymbolsMap[r])return"lscope['"+e.localScope._SymbolsMap[r]+"']=lang.assign("+t+",'"+n.operator+"', lscope['"+e.localScope._SymbolsMap[r]+"'])"}if(void 0!==e.globalScope[r])return"gscope['"+r+"']=lang.assign("+t+",'"+n.operator+"', gscope['"+r+"'])";if(void 0!==e.globalScope._SymbolsMap[r])return"gscope['"+e.globalScope._SymbolsMap[r]+"']=lang.assign("+t+",'"+n.operator+"', gscope['"+e.globalScope._SymbolsMap[r]+"'])";throw new Error("Variable not recognised")}(e,n);case"UpdateExpression":return function(e,n){let t=null,r="";if("MemberExpression"===n.argument.type)return t=lt(e,n.argument.object),r=!0===n.argument.computed?lt(e,n.argument.property):"'"+n.argument.property.name+"'","lang.memberupdate("+t+","+r+",'"+n.operator+"',"+n.prefix+")";if(t=n.argument.name.toLowerCase(),null!==e.localScope){if(void 0!==e.localScope[t])return"lang.update(lscope, '"+t+"','"+n.operator+"',"+n.prefix+")";if(void 0!==e.localScope._SymbolsMap[t])return"lang.update(lscope, '"+e.localScope._SymbolsMap[t]+"','"+n.operator+"',"+n.prefix+")"}if(void 0!==e.globalScope[t])return"lang.update(gscope, '"+t+"','"+n.operator+"',"+n.prefix+")";if(void 0!==e.globalScope._SymbolsMap[t])return"lang.update(gscope, '"+e.globalScope._SymbolsMap[t]+"','"+n.operator+"',"+n.prefix+")";throw new Error("Variable not recognised")}(e,n);case"BreakStatement":return"break";case"ContinueStatement":return"continue";case"TemplateLiteral":return function(e,n){try{const t=[];let r=0;for(const o of n.quasis)t.push(o.value?JSON.stringify(o.value.cooked):JSON.stringify("")),!1===o.tail&&(t.push(n.expressions[r]?"lang.castString(lang.aCheck("+lt(e,n.expressions[r])+", 'TemplateLiteral'))":""),r++);return"(["+t.join(",")+"]).join('')"}catch(e){throw e}}(e,n);case"TemplateElement":return JSON.stringify(n.value?n.value.cooked:"");case"ForStatement":return function(e,n){let t="lastStatement = lc.voidOperation; \n";null!==n.init&&(t+=lt(e,n.init)+"; ");const r=St(e),o=St(e);return t+="var "+r+" = true; ",t+="\n do { ",null!==n.update&&(t+=" if ("+r+"===false) {\n "+lt(e,n.update)+"  \n}\n "+r+"=false; \n"),null!==n.test&&(t+="var "+o+" = "+lt(e,n.test)+"; ",t+="if ("+o+"===false) { break; } else if ("+o+"!==true) { lang.error({type: '"+n.type+"'},'RUNTIME','CANNOT_USE_NONBOOLEAN_IN_CONDITION');   }\n"),t+=lt(e,n.body),null!==n.update&&(t+="\n "+lt(e,n.update)),t+="\n"+r+" = true; \n} while(true);  lastStatement = lc.voidOperation; ",t}(e,n);case"ForInStatement":return function(e,n){const t=St(e),r=St(e),o=St(e);let a="var "+t+" = "+lt(e,n.right)+";\n";"VariableDeclaration"===n.left.type&&(a+=lt(e,n.left));let i="VariableDeclaration"===n.left.type?n.left.declarations[0].id.name:n.left.name;i=i.toLowerCase();let s="";return null!==e.localScope&&(void 0!==e.localScope[i]?s="lscope['"+i+"']":void 0!==e.localScope._SymbolsMap[i]&&(s="lscope['"+e.localScope._SymbolsMap[i]+"']")),""===s&&(void 0!==e.globalScope[i]?s="gscope['"+i+"']":void 0!==e.globalScope._SymbolsMap[i]&&(s="gscope['"+e.globalScope._SymbolsMap[i]+"']")),a+="if ("+t+"===null) {  lastStatement = lc.voidOperation; }\n ",a+="else if (lc.isArray("+t+") || lc.isString("+t+")) {",a+="var "+r+"="+t+".length; \n",a+="for(var "+o+"=0; "+o+"<"+r+"; "+o+"++) {\n",a+=s+"="+o+";\n",a+=lt(e,n.body),a+="\n}\n",a+=" lastStatement = lc.voidOperation; \n",a+=" \n}\n",a+="else if (lc.isImmutableArray("+t+")) {",a+="var "+r+"="+t+".length(); \n",a+="for(var "+o+"=0; "+o+"<"+r+"; "+o+"++) {\n",a+=s+"="+o+";\n",a+=lt(e,n.body),a+="\n}\n",a+=" lastStatement = lc.voidOperation; \n",a+=" \n}\n",a+="else if (( "+t+" instanceof lang.Dictionary) || ( "+t+" instanceof lang.Feature)) {",a+="var "+r+"="+t+".keys(); \n",a+="for(var "+o+"=0; "+o+"<"+r+".length; "+o+"++) {\n",a+=s+"="+r+"["+o+"];\n",a+=lt(e,n.body),a+="\n}\n",a+=" lastStatement = lc.voidOperation; \n",a+=" \n}\n",e.isAsync&&(a+="else if (lc.isFeatureSet("+t+")) {",a+="var "+r+"="+t+".iterator(runtimeCtx.abortSignal); \n",a+="for(var "+o+"=lang. graphicToFeature( yield "+r+".next(),"+t+"); "+o+"!=null; "+o+"=lang. graphicToFeature( yield "+r+".next(),"+t+")) {\n",a+=s+"="+o+";\n",a+=lt(e,n.body),a+="\n}\n",a+=" lastStatement = lc.voidOperation; \n",a+=" \n}\n"),a+="else { lastStatement = lc.voidOperation; } \n",a}(e,n);case"Identifier":return function(e,n){try{const t=n.name.toLowerCase();if(null!==e.localScope){if(void 0!==e.localScope[t])return"lscope['"+t+"']";if(void 0!==e.localScope._SymbolsMap[t])return"lscope['"+e.localScope._SymbolsMap[t]+"']"}if(void 0!==e.globalScope[t])return"gscope['"+t+"']";if(void 0!==e.globalScope._SymbolsMap[t])return"gscope['"+e.globalScope._SymbolsMap[t]+"']";throw new Error(r(n,"RUNTIME","VARIABLENOTFOUND"))}catch(e){throw e}}(e,n);case"MemberExpression":return function(e,n){try{let t;return t=!0===n.computed?lt(e,n.property):"'"+n.property.name+"'","lang.member("+lt(e,n.object)+","+t+")"}catch(e){throw e}}(e,n);case"Literal":return null===n.value||void 0===n.value?"null":JSON.stringify(n.value);case"ThisExpression":case"ConditionalExpression":case"Array":throw new Error(r(n,"RUNTIME","NOTSUPPORTED"));case"CallExpression":return function(e,n){try{if("Identifier"!==n.callee.type)throw new Error(r(n,"RUNTIME","ONLYNODESSUPPORTED"));const t=n.callee.name.toLowerCase();let o="";if(null!==e.localScope&&(void 0!==e.localScope[t]?o="lscope['"+t+"']":void 0!==e.localScope._SymbolsMap[t]&&(o="lscope['"+e.localScope._SymbolsMap[t]+"']")),""===o&&(void 0!==e.globalScope[t]?o="gscope['"+t+"']":void 0!==e.globalScope._SymbolsMap[t]&&(o="gscope['"+e.globalScope._SymbolsMap[t]+"']")),""!==o){let t="[";for(let r=0;r<n.arguments.length;r++)r>0&&(t+=", "),t+=lt(e,n.arguments[r]);return t+="]",e.isAsync?"(yield lang.callfunc("+o+","+t+",runtimeCtx) )":"lang.callfunc("+o+","+t+",runtimeCtx)"}throw new Error(r(n,"RUNTIME","NOTFOUND"))}catch(e){throw e}}(e,n);case"UnaryExpression":return function(e,n){try{return"lang.unary("+lt(e,n.argument)+",'"+n.operator+"')"}catch(e){throw e}}(e,n);case"BinaryExpression":return function(e,n){try{return"lang.binary("+lt(e,n.left)+","+lt(e,n.right)+",'"+n.operator+"')"}catch(e){throw e}}(e,n);case"LogicalExpression":return function(e,n){try{if("AssignmentExpression"===n.left.type||"UpdateExpression"===n.left.type)throw new Error(r(n.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if("AssignmentExpression"===n.right.type||"UpdateExpression"===n.right.type)throw new Error(r(n.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if("&&"===n.operator||"||"===n.operator)return"(lang.logicalCheck("+lt(e,n.left)+") "+n.operator+" lang.logicalCheck("+lt(e,n.right)+"))";throw new Error(r(n,"RUNTIME","ONLYORORAND"))}catch(e){throw e}}(e,n);case"ArrayExpression":return function(e,n){try{const t=[];for(let r=0;r<n.elements.length;r++)"Literal"===n.elements[r].type?t.push(lt(e,n.elements[r])):t.push("lang.aCheck("+lt(e,n.elements[r])+",'ArrayExpression')");return"["+t.join(",")+"]"}catch(e){throw e}}(e,n);case"ObjectExpression":return function(e,n){let t="lang.dictionary([";for(let r=0;r<n.properties.length;r++){const o=n.properties[r];r>0&&(t+=","),t+="lang.strCheck("+("Identifier"===o.key.type?"'"+o.key.name+"'":lt(e,o.key))+",'ObjectExpression'),lang.aCheck("+lt(e,o.value)+", 'ObjectExpression')"}return t+="])",t}(e,n);case"Property":return function(e,n){throw new Error("Should not get here")}();default:throw new Error(r(n,"RUNTIME","UNREOGNISED"))}}catch(e){throw e}}function ct(e,n){return"BlockStatement"===n.type?lt(e,n):"ReturnStatement"===n.type||"BreakStatement"===n.type||"ContinueStatement"===n.type?lt(e,n)+"; ":"UpdateExpression"===n.type?"lastStatement = "+lt(e,n)+"; ":"ExpressionStatement"===n.type?lt(e,n):"ObjectExpression"===n.type?"lastStatement = "+lt(e,n)+"; ":lt(e,n)+"; "}function ut(e,n){let t="";for(let r=0;r<n.body.length;r++)"ReturnStatement"===n.body[r].type||"BreakStatement"===n.body[r].type||"ContinueStatement"===n.body[r].type?t+=lt(e,n.body[r])+"; \n":"UpdateExpression"===n.body[r].type||"ObjectExpression"===n.body[r].type?t+="lastStatement = "+lt(e,n.body[r])+"; \n":t+=lt(e,n.body[r])+" \n";return t}let ft=0;const ht={};function pt(n){return null===n?"":y(n)||w(n)?"Array":P(n)?"Date":R(n)?"String":I(n)?"Boolean":k(n)?"Number":n instanceof Fe?"Attachment":n instanceof Te?"Portal":n instanceof e?"Dictionary":J(n)?"Feature":n instanceof ye?"Point":n instanceof Ee?"Polygon":n instanceof Ie?"Polyline":n instanceof we?"Multipoint":n instanceof de?"Extent":L(n)?"Function":ne(n)?"FeatureSet":te(n)?"FeatureSetCollection":n===E?"":"number"==typeof n&&isNaN(n)?"Number":"Unrecognised Type"}function dt(e,n,t,r){try{const o=n[t];if(S(o,r))return n[t+1];{const o=n.length-t;return 1===o?n[t]:2===o?null:3===o?n[t+2]:dt(e,n,t+2,r)}}catch(e){throw e}}function mt(e,n,t,r){try{if(!0===r)return n[t+1];if(3==n.length-t)return n[t+2];{const r=n[t+2];if(!1===I(r))throw new Error("WHEN needs boolean test conditions");return mt(e,n,t+2,r)}}catch(e){throw e}}function gt(e,n){const t=e.length,r=Math.floor(t/2);return 0===t?[]:1===t?[e[0]]:function(e,n,t){const r=[];for(;e.length>0||n.length>0;)if(e.length>0&&n.length>0){let o=t(e[0],n[0]);isNaN(o)&&(o=0),o<=0?(r.push(e[0]),e=e.slice(1)):(r.push(n[0]),n=n.slice(1))}else e.length>0?(r.push(e[0]),e=e.slice(1)):n.length>0&&(r.push(n[0]),n=n.slice(1));return r}(gt(e.slice(0,r),n),gt(e.slice(r,t),n),n)}async function wt(e,n){const t=e.length,r=Math.floor(t/2);if(0===t)return[];if(1===t)return[e[0]];const o=[wt(e.slice(0,r),n),wt(e.slice(r,t),n)],a=await Promise.all(o);return yt(a[0],a[1],n,[])}async function yt(e,n,t,r){const o=r;if(!(e.length>0||n.length>0))return r;if(e.length>0&&n.length>0){let a=await t(e[0],n[0]);return isNaN(a)&&(a=1),a<=0?(o.push(e[0]),e=e.slice(1)):(o.push(n[0]),n=n.slice(1)),yt(e,n,t,r)}return e.length>0?(o.push(e[0]),yt(e=e.slice(1),n,t,r)):n.length>0?(o.push(n[0]),yt(e,n=n.slice(1),t,r)):void 0}function Et(e){return e.symbols.symbolCounter++,"_T"+e.symbols.symbolCounter.toString()}function St(e){return e.symbols.symbolCounter++,"_Tvar"+e.symbols.symbolCounter.toString()}Le(ht,st),it(ht,st),dn(ht,st),tn(ht,st),En(ht,st),ht.typeof=function(e,n){return st(e,n,(function(e,n,t){p(t,1,1);const r=pt(t[0]);if("Unrecognised Type"===r)throw new Error("Unrecognised Type");return r}))},ht.iif=function(e,n){try{return st(e,n,(function(e,n,t){if(p(t,3,3),!1===I(t[0]))throw new Error("IF Function must have a boolean test condition");return t[0]?t[1]:t[2]}))}catch(e){throw e}},ht.decode=function(e,n){try{return st(e,n,(function(n,t,r){if(r.length<2)throw new Error("Missing Parameters");if(2===r.length)return r[1];{if((r.length-1)%2==0)throw new Error("Must have a default value result.");const n=r[0];return dt(e,r,1,n)}}))}catch(e){throw e}},ht.when=function(e,n){try{return st(e,n,(function(n,t,r){if(r.length<3)throw new Error("Missing Parameters");if(r.length%2==0)throw new Error("Must have a default value result.");const o=r[0];if(!1===I(o))throw new Error("WHEN needs boolean test conditions");return mt(e,r,0,o)}))}catch(e){throw e}},ht.top=function(e,n){return st(e,n,(function(e,n,t){if(p(t,2,2),y(t[0]))return d(t[1])>=t[0].length?t[0].slice(0):t[0].slice(0,d(t[1]));if(w(t[0]))return d(t[1])>=t[0].length()?t[0].slice(0):t[0].slice(0,d(t[1]));throw new Error("Top cannot accept this parameter type")}))},ht.first=function(e,n){return st(e,n,(function(e,n,t){return p(t,1,1),y(t[0])?0===t[0].length?null:t[0][0]:w(t[0])?0===t[0].length()?null:t[0].get(0):null}))},ht.sort=function(e,n){return st(e,n,(function(n,t,r){p(r,1,2);let o=r[0];if(w(o)&&(o=o.toArray()),!1===y(o))throw new Error("Illegal Argument");if(r.length>1){if(!1===L(r[1]))throw new Error("Illegal Argument");let t=o;const a=function(e,t){return _t.callfunc(r[1],[e,t],n)};return e.isAsync?wt(t,a):(t=gt(t,(function(e,n){return a(e,n)})),t)}{let e=o;if(0===e.length)return[];const n={};for(let t=0;t<e.length;t++){const r=pt(e[t]);""!==r&&(n[r]=!0)}if(!0===n.Array||!0===n.Dictionary||!0===n.Feature||!0===n.Point||!0===n.Polygon||!0===n.Polyline||!0===n.Multipoint||!0===n.Extent||!0===n.Function)return e.slice(0);let t=0,r="";for(const e in n)t++,r=e;return e=t>1||"String"===r?gt(e,(function(e,n){if(null==e||e===E)return null==n||n===E?0:1;if(null==n||n===E)return-1;const t=M(e),r=M(n);return t<r?-1:t===r?0:1})):"Number"===r?gt(e,(function(e,n){return e-n})):"Boolean"===r?gt(e,(function(e,n){return e===n?0:n?-1:1})):"Date"===r?gt(e,(function(e,n){return n-e})):e.slice(0),e}}))};const It={};for(const e in ht)It[e]=new v(ht[e]);fn(ht,st);for(const e in ht)ht[e]=new v(ht[e]);const Nt=function(){};Nt.prototype=ht;const vt=function(){};function bt(e,n,t){const r={};e||(e={}),t||(t={}),r._SymbolsMap={},r.textformatting=1,r.infinity=1,r.pi=1;for(const e in n)r[e]=1;for(const e in t)r[e]=1;for(const n in e)r[n]=1;return r}function At(e,n){const r={mode:n,compiled:!0,functions:{},signatures:[],standardFunction:st,standardFunctionAsync:st,evaluateIdentifier:xt};for(let n=0;n<e.length;n++)e[n].registerFunctions(r);if("sync"===n){for(const e in r.functions)ht[e]=new v(r.functions[e]),Nt.prototype[e]=ht[e];for(let e=0;e<r.signatures.length;e++)t(r.signatures[e],"sync")}else{for(const e in r.functions)It[e]=new v(r.functions[e]),vt.prototype[e]=It[e];for(let e=0;e<r.signatures.length;e++)t(r.signatures[e],"async")}}function xt(e,n){const t=n.name;if("_SymbolsMap"===t)throw new Error("Illegal");if(e.localStack.length>0){if("_t"!==t.substr(0,2).toLowerCase()&&void 0!==e.localStack[e.localStack.length-1][t])return e.localStack[e.localStack.length-1][t];const n=e.mangleMap[t];if(void 0!==n&&void 0!==e.localStack[e.localStack.length-1][n])return e.localStack[e.localStack.length-1][n]}if("_t"!==t.substr(0,2).toLowerCase()&&void 0!==e.globalScope[t])return e.globalScope[t];if(1===e.globalScope._SymbolsMap[t])return e.globalScope[t];const r=e.mangleMap[t];return void 0!==r?e.globalScope[r]:void 0}vt.prototype=It,At([Oe],"sync"),At([Oe],"async");let Mt=0;const _t={error(e,n,t){throw new Error(r(e,n,t))},__awaiter:(e,n,t,r)=>new Promise(((t,o)=>{function a(e){try{s(r.next(e))}catch(e){o(e)}}function i(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){e.done?t(e.value):e.value&&e.value.then?e.value.then(a,i):(Mt++,Mt%100==0?setTimeout((()=>{Mt=0,a(e.value)}),0):a(e.value))}s((r=r.apply(e,n||[])).next())})),functionDepthchecker:(e,n)=>function(){if(n.depthCounter++,n.localStack.push([]),n.depthCounter>64)throw new Error("Exceeded maximum function depth");const t=e.apply(this,arguments);return fe(t)?t.then((e=>(n.depthCounter--,n.localStack.length=n.localStack.length-1,e))):(n.depthCounter--,n.localStack.length=n.localStack.length-1,t)},castString:e=>M(e),aCheck(e,n){if(L(e))throw new Error(r({type:n},"RUNTIME","FUNCTIONCONTEXTILLEGAL"));return e===E?null:e},Dictionary:e,Feature:n,dictionary(n){const t={};for(let e=0;e<n.length;e+=2){if(L(n[e+1]))throw new Error("Illegal Argument");if(!1===R(n[e]))throw new Error("Illegal Argument");n[e+1]===E?t[n[e].toString()]=null:t[n[e].toString()]=n[e+1]}const r=new e(t);return r.immutable=!1,r},strCheck(e){if(!1===R(e))throw new Error("Illegal Argument");return e},unary(e,n){if(I(e)){if("!"===n)return!e;if("-"===n)return-1*d(e);if("+"===n)return 1*d(e);if("~"===n)return~d(e);throw new Error(r({type:"UnaryExpression",operator:n,prefix:null,argument:null},"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"))}if("-"===n)return-1*d(e);if("+"===n)return 1*d(e);if("~"===n)return~d(e);throw new Error(r({type:"UnaryExpression",operator:n,prefix:null,argument:null},"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"))},logicalCheck(e){if(!1===I(e))throw new Error(r({type:"LogicalExpression",operator:null,left:null,right:null},"RUNTIME","ONLYORORAND"));return e},logical(e,n,t){if(I(e)&&I(n))switch(t){case"||":return e||n;case"&&":return e&&n;default:throw new Error(r({type:"LogicalExpression",operator:null,left:null,right:null},"RUNTIME","ONLYORORAND"))}throw new Error(r({type:"LogicalExpression",operator:null,left:null,right:null},"RUNTIME","ONLYORORAND"))},binary(e,n,t){switch(t){case"|":case"<<":case">>":case">>>":case"^":case"&":return oe(d(e),d(n),t);case"==":case"=":return S(e,n);case"!=":return!S(e,n);case"<":case">":case"<=":case">=":return re(e,n,t);case"+":return R(e)||R(n)?M(e)+M(n):d(e)+d(n);case"-":return d(e)-d(n);case"*":return d(e)*d(n);case"/":return d(e)/d(n);case"%":return d(e)%d(n);default:throw new Error(r({type:"BinaryExpression",operator:t,left:e,right:n},"RUNTIME","OPERATORNOTRECOGNISED"))}},assign(e,n,t){switch(n){case"=":return e===E?null:e;case"/=":return d(t)/d(e);case"*=":return d(t)*d(e);case"-=":return d(t)-d(e);case"+=":return R(t)||R(e)?M(t)+M(e):d(t)+d(e);case"%=":return d(t)%d(e);default:throw new Error(r({type:"AssignmentExpression",operator:n,left:null,right:null},"RUNTIME","OPERATORNOTRECOGNISED"))}},update(e,n,t,r){const o=d(e[n]);return e[n]="++"===t?o+1:o-1,!1===r?o:"++"===t?o+1:o-1},graphicToFeature:(e,t)=>null===e?null:n.createFromGraphicLikeObject(e.geometry,e.attributes,t),memberupdate(n,t,r,o){let a;if(y(n)){if(!k(t))throw new Error("Invalid Parameter");if(t<0&&(t=n.length+t),t<0||t>=n.length)throw new Error("Assignment outside of array bounds");a=d(n[t]),n[t]="++"===r?a+1:a-1}else if(n instanceof e){if(!1===R(t))throw new Error("Dictionary accessor must be a string");if(!0!==n.hasField(t))throw new Error("Invalid Parameter");a=d(n.field(t)),n.setField(t,"++"===r?a+1:a-1)}else{if(!J(n))throw w(n)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===R(t))throw new Error("Feature accessor must be a string");if(!0!==n.hasField(t))throw new Error("Invalid Parameter");a=d(n.field(t)),n.setField(t,"++"===r?a+1:a-1)}return!1===o?a:"++"===r?a+1:a-1},assignmember(n,t,r,o){if(y(n)){if(!k(t))throw new Error("Invalid Parameter");if(t<0&&(t=n.length+t),t<0||t>n.length)throw new Error("Assignment outside of array bounds");if(t===n.length){if("="!==r)throw new Error("Invalid Parameter");n[t]=this.assign(o,r,n[t])}else n[t]=this.assign(o,r,n[t])}else if(n instanceof e){if(!1===R(t))throw new Error("Dictionary accessor must be a string");if(!0===n.hasField(t))n.setField(t,this.assign(o,r,n.field(t)));else{if("="!==r)throw new Error("Invalid Parameter");n.setField(t,this.assign(o,r,null))}}else{if(!J(n))throw w(n)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===R(t))throw new Error("Feature accessor must be a string");if(!0===n.hasField(t))n.setField(t,this.assign(o,r,n.field(t)));else{if("="!==r)throw new Error("Invalid Parameter");n.setField(t,this.assign(o,r,null))}}},member(n,t){if(null===n)throw new Error(r({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","NOTFOUND"));if(n instanceof e||J(n)){if(R(t))return n.field(t);throw new Error(r({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","INVALIDTYPE"))}if(n instanceof ge){if(R(t))return function(n,t,o){let a;switch(t=t.toLowerCase()){case"hasz":{const e=n.hasZ;return void 0!==e&&e}case"hasm":{const e=n.hasM;return void 0!==e&&e}case"spatialreference":{let t=n.spatialReference._arcadeCacheId;if(void 0===t){let e=!0;Object.freeze&&Object.isFrozen(n.spatialReference)&&(e=!1),e&&(ft++,n.spatialReference._arcadeCacheId=ft,t=ft)}const r=new e({wkt:n.spatialReference.wkt,wkid:n.spatialReference.wkid});return void 0!==t&&(r._arcadeCacheId="SPREF"+t.toString()),r}}switch(n.type){case"extent":switch(t){case"xmin":case"xmax":case"ymin":case"ymax":case"zmin":case"zmax":case"mmin":case"mmax":{const e=n[t];return void 0!==e?e:null}case"type":return"Extent"}break;case"polygon":switch(t){case"rings":return a=n.cache._arcadeCacheId,void 0===a&&(ft++,a=ft,n.cache._arcadeCacheId=a),new ue(n.rings,n.spatialReference,!0===n.hasZ,!0===n.hasM,a);case"type":return"Polygon"}break;case"point":switch(t){case"x":case"y":case"z":case"m":return void 0!==n[t]?n[t]:null;case"type":return"Point"}break;case"polyline":switch(t){case"paths":return a=n.cache._arcadeCacheId,void 0===a&&(ft++,a=ft,n.cache._arcadeCacheId=a),new ue(n.paths,n.spatialReference,!0===n.hasZ,!0===n.hasM,a);case"type":return"Polyline"}break;case"multipoint":switch(t){case"points":return a=n.cache._arcadeCacheId,void 0===a&&(ft++,a=ft,n.cache._arcadeCacheId=a),new O(n.points,n.spatialReference,!0===n.hasZ,!0===n.hasM,a,1);case"type":return"Multipoint"}}throw new Error(r("MemberExpression","RUNTIME","PROPERTYNOTFOUND"))}(n,t);throw new Error(r({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","INVALIDTYPE"))}if(y(n)){if(k(t)&&isFinite(t)&&Math.floor(t)===t){if(t<0&&(t=n.length+t),t>=n.length||t<0)throw new Error(r({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","OUTOFBOUNDS"));return n[t]}throw new Error(r({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","INVALIDTYPE"))}if(R(n)){if(k(t)&&isFinite(t)&&Math.floor(t)===t){if(t<0&&(t=n.length+t),t>=n.length||t<0)throw new Error(r({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","OUTOFBOUNDS"));return n[t]}throw new Error(r({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","INVALIDTYPE"))}if(w(n)){if(k(t)&&isFinite(t)&&Math.floor(t)===t){if(t<0&&(t=n.length()+t),t>=n.length()||t<0)throw new Error(r({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","OUTOFBOUNDS"));return n.get(t)}throw new Error(r({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","INVALIDTYPE"))}throw new Error(r({type:"MemberExpression",object:null,property:null,computed:null},"RUNTIME","INVALIDTYPE"))},callfunc(e,n,t){return e instanceof v?e.fn(t,{arguments:n,preparsed:!0}):e instanceof b?e.fn.apply(this,n):e.apply(this,n)}};function Rt(e){console.log(e)}function Tt(t,r=null,o=!1){null===r&&(r={vars:{},customfunctions:{}});const a={isAsync:o,globalScope:bt(r.vars,o?It:ht,r.customfunctions),localScope:null,mangleMap:{},console:Rt,lrucache:r.lrucache,interceptor:r.interceptor,services:r.services,symbols:{symbolCounter:0}};let i=lt(a,t.body[0].body);""===i&&(i="lc.voidOperation; ");let s="";s=o?"var runtimeCtx=this.prepare(context, true);\n var lc = this.lc;  var lang = this.lang; var gscope=runtimeCtx.globalScope; \nreturn lang.__awaiter(this, void 0, void 0, function* () {\n\n function mainBody() {\n var lastStatement=lc.voidOperation;\n return lang.__awaiter(this, void 0, void 0, function* () {\n"+i+"\n return lastStatement; }); } \n return this.postProcess(yield mainBody()); }); ":"var runtimeCtx=this.prepare(context, false);\n var lc = this.lc;  var lang = this.lang; var gscope=runtimeCtx.globalScope; \n function mainBody() {\n var lastStatement=lc.voidOperation;\n "+i+"\n return lastStatement; } \n return this.postProcess(mainBody()); ";const l={lc:ae,lang:_t,mangles:a.mangleMap,postProcess(e){if(e instanceof ie&&(e=e.value),e instanceof se&&(e=e.value),e===E&&(e=null),e===le)throw new Error("Cannot return BREAK");if(e===ce)throw new Error("Cannot return CONTINUE");if(L(e))throw new Error("Cannot return FUNCTION");return e},prepare(t,r){let o=t.spatialReference;null==o&&(o=new xe({wkid:102100}));const a=function(t,r,o){const a=o?new vt:new Nt;t||(t={}),r||(r={});const i=new e({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});i.immutable=!1,a._SymbolsMap={textformatting:1,infinity:1,pi:1},a.textformatting=i,a.infinity=Number.POSITIVE_INFINITY,a.pi=Math.PI;for(const e in r)a[e]=r[e],a._SymbolsMap[e]=1;for(const e in t)a._SymbolsMap[e]=1,t[e]&&"esri.Graphic"===t[e].declaredClass?a[e]=n.createFromGraphic(t[e]):a[e]=t[e];return a}(t.vars,t.customfunctions,r);return{localStack:[],isAsync:r,mangleMap:this.mangles,spatialReference:o,globalScope:a,abortSignal:void 0===t.abortSignal||null===t.abortSignal?{aborted:!1}:t.abortSignal,localScope:null,services:t.services,console:t.console?t.console:Rt,lrucache:t.lrucache,interceptor:t.interceptor,symbols:{symbolCounter:0},depthCounter:1}}};return new Function("context","spatialReference",s).bind(l)}function Ft(e,n,t){try{return!0===n.preparsed?t(e,null,n.arguments):t(e,n,function(e,n){const t=[];for(let r=0;r<n.arguments.length;r++)t.push(Ot(e,n.arguments[r]));return t}(e,n))}catch(e){throw e}}function Ot(n,t){try{switch(t.type){case"EmptyStatement":return E;case"VariableDeclarator":return function(e,n){let t=null===n.init?null:Ot(e,n.init);if(t===E&&(t=null),"Identifier"!==n.id.type)throw new Error("Can only assign a regular variable");const r=n.id.name.toLowerCase();return null!==e.localScope?e.localScope[r]={value:t,valueset:!0,node:n.init}:e.globalScope[r]={value:t,valueset:!0,node:n.init},E}(n,t);case"VariableDeclaration":return function(e,n){for(let t=0;t<n.declarations.length;t++)Ot(e,n.declarations[t]);return E}(n,t);case"BlockStatement":return function(e,n){let t=E;for(let r=0;r<n.body.length;r++)if(t=Ot(e,n.body[r]),t instanceof ie||t===le||t===ce)return t;return t}(n,t);case"FunctionDeclaration":return function(e,n){const t=n.id.name.toLowerCase();return e.globalScope[t]={valueset:!0,node:null,value:new N(n,e)},E}(n,t);case"ReturnStatement":return function(e,n){if(null===n.argument)return new ie(E);const t=Ot(e,n.argument);return new ie(t)}(n,t);case"IfStatement":return function(e,n){if("AssignmentExpression"===n.test.type||"UpdateExpression"===n.test.type)throw new Error(r(n.test,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));const t=Ot(e,n.test);if(!0===t)return Ot(e,n.consequent);if(!1===t)return null!==n.alternate?Ot(e,n.alternate):E;throw new Error(r(n,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"))}(n,t);case"ExpressionStatement":return function(e,n){if("AssignmentExpression"===n.expression.type||"UpdateExpression"===n.expression.type)return Ot(e,n.expression);if("CallExpression"===n.expression.type){const t=Ot(e,n.expression);return t===E?E:new se(t)}{const t=Ot(e,n.expression);return t===E?E:new se(t)}}(n,t);case"AssignmentExpression":return function(n,t){const r=Ot(n,t.right);let o=null,a="";if("MemberExpression"===t.left.type){if(o=Ot(n,t.left.object),!0===t.left.computed?a=Ot(n,t.left.property):"Identifier"===t.left.property.type&&(a=t.left.property.name),y(o)){if(!k(a))throw new Error("Invalid Parameter");if(a<0&&(a=o.length+a),a<0||a>o.length)throw new Error("Assignment outside of array bounds");if(a===o.length){if("="!==t.operator)throw new Error("Invalid Parameter");o[a]=Ct(r,t.operator,o[a],t)}else o[a]=Ct(r,t.operator,o[a],t)}else if(o instanceof e){if(!1===R(a))throw new Error("Dictionary accessor must be a string");if(!0===o.hasField(a))o.setField(a,Ct(r,t.operator,o.field(a),t));else{if("="!==t.operator)throw new Error("Invalid Parameter");o.setField(a,Ct(r,t.operator,null,t))}}else{if(!J(o))throw w(o)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===R(a))throw new Error("Feature accessor must be a string");if(!0===o.hasField(a))o.setField(a,Ct(r,t.operator,o.field(a),t));else{if("="!==t.operator)throw new Error("Invalid Parameter");o.setField(a,Ct(r,t.operator,null,t))}}return E}if(o=t.left.name.toLowerCase(),null!==n.localScope&&void 0!==n.localScope[o])return n.localScope[o]={value:Ct(r,t.operator,n.localScope[o].value,t),valueset:!0,node:t.right},E;if(void 0!==n.globalScope[o])return n.globalScope[o]={value:Ct(r,t.operator,n.globalScope[o].value,t),valueset:!0,node:t.right},E;throw new Error("Variable not recognised")}(n,t);case"UpdateExpression":return function(n,t){let r,o=null,a="";if("MemberExpression"===t.argument.type){if(o=Ot(n,t.argument.object),!0===t.argument.computed?a=Ot(n,t.argument.property):"Identifier"===t.argument.property.type&&(a=t.argument.property.name),y(o)){if(!k(a))throw new Error("Invalid Parameter");if(a<0&&(a=o.length+a),a<0||a>=o.length)throw new Error("Assignment outside of array bounds");r=d(o[a]),o[a]="++"===t.operator?r+1:r-1}else if(o instanceof e){if(!1===R(a))throw new Error("Dictionary accessor must be a string");if(!0!==o.hasField(a))throw new Error("Invalid Parameter");r=d(o.field(a)),o.setField(a,"++"===t.operator?r+1:r-1)}else{if(!J(o))throw w(o)?new Error("Array is Immutable"):new Error("Invalid Parameter");if(!1===R(a))throw new Error("Feature accessor must be a string");if(!0!==o.hasField(a))throw new Error("Invalid Parameter");r=d(o.field(a)),o.setField(a,"++"===t.operator?r+1:r-1)}return!1===t.prefix?r:"++"===t.operator?r+1:r-1}if(o="Identifier"===t.argument.type?t.argument.name.toLowerCase():"",!o)throw new Error("Invalid identifier");if(null!==n.localScope&&void 0!==n.localScope[o])return r=d(n.localScope[o].value),n.localScope[o]={value:"++"===t.operator?r+1:r-1,valueset:!0,node:t},!1===t.prefix?r:"++"===t.operator?r+1:r-1;if(void 0!==n.globalScope[o])return r=d(n.globalScope[o].value),n.globalScope[o]={value:"++"===t.operator?r+1:r-1,valueset:!0,node:t},!1===t.prefix?r:"++"===t.operator?r+1:r-1;throw new Error("Variable not recognised")}(n,t);case"BreakStatement":return le;case"ContinueStatement":return ce;case"TemplateElement":return function(e,n){return n.value?n.value.cooked:""}(0,t);case"TemplateLiteral":return function(e,n){let t="",r=0;for(const o of n.quasis)t+=o.value?o.value.cooked:"",!1===o.tail&&(t+=n.expressions[r]?M(Ot(e,n.expressions[r])):"",r++);return t}(n,t);case"ForStatement":return function(e,n){null!==n.init&&Ot(e,n.init);const t={testResult:!0,lastAction:E};do{Ut(e,n,t)}while(!0===t.testResult);return t.lastAction instanceof ie?t.lastAction:E}(n,t);case"ForInStatement":return function(n,t){const o=Ot(n,t.right);"VariableDeclaration"===t.left.type&&Ot(n,t.left);let a=null,i="";if("VariableDeclaration"===t.left.type){const e=t.left.declarations[0].id;"Identifier"===e.type&&(i=e.name)}else"Identifier"===t.left.type&&(i=t.left.name);if(!i)throw new Error(r(t,"RUNTIME","INVALIDVARIABLE"));if(i=i.toLowerCase(),null!==n.localScope&&void 0!==n.localScope[i]&&(a=n.localScope[i]),null===a&&void 0!==n.globalScope[i]&&(a=n.globalScope[i]),null===a)throw new Error(r(t,"RUNTIME","VARIABLENOTDECLARED"));if(y(o)||R(o)){const e=o.length;for(let r=0;r<e;r++){a.value=r;const e=Ot(n,t.body);if(e===le)break;if(e instanceof ie)return e}return E}if(w(o)){for(let e=0;e<o.length();e++){a.value=e;const r=Ot(n,t.body);if(r===le)break;if(r instanceof ie)return r}return E}if(!(o instanceof e||J(o)))return E;{const e=o.keys();for(let r=0;r<e.length;r++){a.value=e[r];const o=Ot(n,t.body);if(o===le)break;if(o instanceof ie)return o}}}(n,t);case"Identifier":return kt(n,t);case"MemberExpression":return function(n,t){try{const o=Ot(n,t.object);if(null===o)throw new Error(r(t,"RUNTIME","NOTFOUND"));if(!1===t.computed){if("Identifier"===t.property.type){if(o instanceof e||J(o))return o.field(t.property.name);if(o instanceof ge)return Pt(o,t.property.name,t)}throw new Error(r(t,"RUNTIME","INVALIDTYPE"))}{let a=Ot(n,t.property);if(o instanceof e||J(o)){if(R(a))return o.field(a);throw new Error(r(t,"RUNTIME","INVALIDTYPE"))}if(o instanceof ge){if(R(a))return Pt(o,a,t);throw new Error(r(t,"RUNTIME","INVALIDTYPE"))}if(y(o)){if(k(a)&&isFinite(a)&&Math.floor(a)===a){if(a<0&&(a=o.length+a),a>=o.length||a<0)throw new Error(r(t,"RUNTIME","OUTOFBOUNDS"));return o[a]}throw new Error(r(t,"RUNTIME","INVALIDTYPE"))}if(R(o)){if(k(a)&&isFinite(a)&&Math.floor(a)===a){if(a<0&&(a=o.length+a),a>=o.length||a<0)throw new Error(r(t,"RUNTIME","OUTOFBOUNDS"));return o[a]}throw new Error(r(t,"RUNTIME","INVALIDTYPE"))}if(w(o)){if(k(a)&&isFinite(a)&&Math.floor(a)===a){if(a<0&&(a=o.length()+a),a>=o.length()||a<0)throw new Error(r(t,"RUNTIME","OUTOFBOUNDS"));return o.get(a)}throw new Error(r(t,"RUNTIME","INVALIDTYPE"))}throw new Error(r(t,"RUNTIME","INVALIDTYPE"))}}catch(e){throw e}}(n,t);case"Literal":return t.value;case"CallExpression":return function(e,n){try{if("Identifier"!==n.callee.type)throw new Error(r(n,"RUNTIME","ONLYNODESSUPPORTED"));if(null!==e.localScope&&void 0!==e.localScope[n.callee.name.toLowerCase()]){const t=e.localScope[n.callee.name.toLowerCase()];if(t.value instanceof v)return t.value.fn(e,n);if(t.value instanceof N)return Ht(e,n,t.value.definition);throw new Error(r(n,"RUNTIME","NOTAFUNCTION"))}if(void 0!==e.globalScope[n.callee.name.toLowerCase()]){const t=e.globalScope[n.callee.name.toLowerCase()];if(t.value instanceof v)return t.value.fn(e,n);if(t.value instanceof N)return Ht(e,n,t.value.definition);throw new Error(r(n,"RUNTIME","NOTAFUNCTION"))}throw new Error(r(n,"RUNTIME","NOTFOUND"))}catch(e){throw e}}(n,t);case"UnaryExpression":return function(e,n){try{const t=Ot(e,n.argument);if(I(t)){if("!"===n.operator)return!t;if("-"===n.operator)return-1*d(t);if("+"===n.operator)return 1*d(t);if("~"===n.operator)return~d(t);throw new Error(r(n,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"))}if("~"===n.operator)return~d(t);if("-"===n.operator)return-1*d(t);if("+"===n.operator)return 1*d(t);throw new Error(r(n,"RUNTIME","NOTSUPPORTEDUNARYOPERATOR"))}catch(e){throw e}}(n,t);case"BinaryExpression":return function(e,n){try{const t=[Ot(e,n.left),Ot(e,n.right)],o=t[0],a=t[1];switch(n.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":return oe(d(o),d(a),n.operator);case"==":return S(o,a);case"!=":return!S(o,a);case"<":case">":case"<=":case">=":return re(o,a,n.operator);case"+":return R(o)||R(a)?M(o)+M(a):d(o)+d(a);case"-":return d(o)-d(a);case"*":return d(o)*d(a);case"/":return d(o)/d(a);case"%":return d(o)%d(a);default:throw new Error(r(n,"RUNTIME","OPERATORNOTRECOGNISED"))}}catch(e){throw e}}(n,t);case"LogicalExpression":return function(e,n){try{if("AssignmentExpression"===n.left.type||"UpdateExpression"===n.left.type)throw new Error(r(n.left,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));if("AssignmentExpression"===n.right.type||"UpdateExpression"===n.right.type)throw new Error(r(n.right,"RUNTIME","CANNOT_USE_ASSIGNMENT_IN_CONDITION"));const t=Ot(e,n.left);if(I(t))switch(n.operator){case"||":if(!0===t)return t;{const t=Ot(e,n.right);if(I(t))return t;throw new Error(r(n,"RUNTIME","ONLYORORAND"))}case"&&":if(!1===t)return t;{const t=Ot(e,n.right);if(I(t))return t;throw new Error(r(n,"RUNTIME","ONLYORORAND"))}default:throw new Error(r(n,"RUNTIME","ONLYORORAND"))}throw new Error(r(n,"RUNTIME","ONLYBOOLEAN"))}catch(e){throw e}}(n,t);case"ArrayExpression":return function(e,n){try{const t=[];for(let o=0;o<n.elements.length;o++){const a=Ot(e,n.elements[o]);if(L(a))throw new Error(r(n,"RUNTIME","FUNCTIONCONTEXTILLEGAL"));a===E?t.push(null):t.push(a)}return t}catch(e){throw e}}(n,t);case"ObjectExpression":return function(n,t){const r={};for(let e=0;e<t.properties.length;e++){const o=Ot(n,t.properties[e]);if(L(o.value))throw new Error("Illegal Argument");if(!1===R(o.key))throw new Error("Illegal Argument");o.value===E?r[o.key.toString()]=null:r[o.key.toString()]=o.value}const o=new e(r);return o.immutable=!1,o}(n,t);case"Property":return function(e,n){return{key:"Identifier"===n.key.type?n.key.name:Ot(e,n.key),value:Ot(e,n.value)}}(n,t);default:throw new Error(r(t,"RUNTIME","UNREOGNISED"))}}catch(e){throw e}}function Ut(e,n,t){if(null!==n.test){if(t.testResult=Ot(e,n.test),!1===t.testResult)return;if(!0!==t.testResult)throw new Error(r(n,"RUNTIME","CANNOT_USE_NONBOOLEAN_IN_CONDITION"))}t.lastAction=Ot(e,n.body),t.lastAction!==le?t.lastAction instanceof ie?t.testResult=!1:null!==n.update&&Ot(e,n.update):t.testResult=!1}function Ct(e,n,t,o){switch(n){case"=":return e===E?null:e;case"/=":return d(t)/d(e);case"*=":return d(t)*d(e);case"-=":return d(t)-d(e);case"+=":return R(t)||R(e)?M(t)+M(e):d(t)+d(e);case"%=":return d(t)%d(e);default:throw new Error(r(o,"RUNTIME","OPERATORNOTRECOGNISED"))}}let Dt=0;function Pt(n,t,o){let a;switch(t=t.toLowerCase()){case"hasz":{const e=n.hasZ;return void 0!==e&&e}case"hasm":{const e=n.hasM;return void 0!==e&&e}case"spatialreference":{let t=n.spatialReference._arcadeCacheId;if(void 0===t){let e=!0;Object.freeze&&Object.isFrozen(n.spatialReference)&&(e=!1),e&&(Dt++,n.spatialReference._arcadeCacheId=Dt,t=Dt)}const r=new e({wkt:n.spatialReference.wkt,wkid:n.spatialReference.wkid});return void 0!==t&&(r._arcadeCacheId="SPREF"+t.toString()),r}}switch(n.type){case"extent":switch(t){case"xmin":case"xmax":case"ymin":case"ymax":case"zmin":case"zmax":case"mmin":case"mmax":{const e=n[t];return void 0!==e?e:null}case"type":return"Extent"}break;case"polygon":switch(t){case"rings":return a=n.cache._arcadeCacheId,void 0===a&&(Dt++,a=Dt,n.cache._arcadeCacheId=a),new ue(n.rings,n.spatialReference,!0===n.hasZ,!0===n.hasM,a);case"type":return"Polygon"}break;case"point":switch(t){case"x":case"y":case"z":case"m":return void 0!==n[t]?n[t]:null;case"type":return"Point"}break;case"polyline":switch(t){case"paths":return a=n.cache._arcadeCacheId,void 0===a&&(Dt++,a=Dt,n.cache._arcadeCacheId=a),new ue(n.paths,n.spatialReference,!0===n.hasZ,!0===n.hasM,a);case"type":return"Polyline"}break;case"multipoint":switch(t){case"points":return a=n.cache._arcadeCacheId,void 0===a&&(Dt++,a=Dt,n.cache._arcadeCacheId=a),new O(n.points,n.spatialReference,!0===n.hasZ,!0===n.hasM,a,1);case"type":return"Multipoint"}}throw new Error(r(o,"RUNTIME","PROPERTYNOTFOUND"))}function kt(e,n){let t;try{const o=n.name.toLowerCase();if(null!==e.localScope&&void 0!==e.localScope[o])return t=e.localScope[o],!0===t.valueset||(t.value=Ot(e,t.node),t.valueset=!0),t.value;if(void 0!==e.globalScope[o])return t=e.globalScope[o],!0===t.valueset||(t.value=Ot(e,t.node),t.valueset=!0),t.value;throw new Error(r(n,"RUNTIME","VARIABLENOTFOUND"))}catch(e){throw e}}const Lt={};function jt(n){return null==n?"":y(n)||w(n)?"Array":P(n)?"Date":R(n)?"String":I(n)?"Boolean":k(n)?"Number":n instanceof Fe?"Attachment":n instanceof Te?"Portal":n instanceof e?"Dictionary":J(n)?"Feature":n instanceof ye?"Point":n instanceof Ee?"Polygon":n instanceof Ie?"Polyline":n instanceof we?"Multipoint":n instanceof de?"Extent":L(n)?"Function":ne(n)?"FeatureSet":te(n)?"FeatureSetCollection":n===E?"":"number"==typeof n&&isNaN(n)?"Number":"Unrecognised Type"}function zt(e,n,t,r){try{const o=Ot(e,n.arguments[t]);if(S(o,r))return Ot(e,n.arguments[t+1]);{const o=n.arguments.length-t;return 1===o?Ot(e,n.arguments[t]):2===o?null:3===o?Ot(e,n.arguments[t+2]):zt(e,n,t+2,r)}}catch(e){throw e}}function Gt(e,n,t,r){try{if(!0===r)return Ot(e,n.arguments[t+1]);if(3==n.arguments.length-t)return Ot(e,n.arguments[t+2]);{const r=Ot(e,n.arguments[t+2]);if(!1===I(r))throw new Error("WHEN needs boolean test conditions");return Gt(e,n,t+2,r)}}catch(e){throw e}}function qt(e,n){const t=e.length,r=Math.floor(t/2);return 0===t?[]:1===t?[e[0]]:function(e,n,t){const r=[];for(;e.length>0||n.length>0;)if(e.length>0&&n.length>0){let o=t(e[0],n[0]);isNaN(o)&&(o=0),o<=0?(r.push(e[0]),e=e.slice(1)):(r.push(n[0]),n=n.slice(1))}else e.length>0?(r.push(e[0]),e=e.slice(1)):n.length>0&&(r.push(n[0]),n=n.slice(1));return r}(qt(e.slice(0,r),n),qt(e.slice(r,t),n),n)}function Vt(e,n,t){try{const r=e.body;if(t.length!==e.params.length)throw new Error("Invalid Parameter calls to function.");for(let r=0;r<t.length;r++)n.localScope[e.params[r].name.toLowerCase()]={value:t[r],valueset:!0,node:null};const o=Ot(n,r);if(o instanceof ie)return o.value;if(o===le)throw new Error("Cannot Break from a Function");if(o===ce)throw new Error("Cannot Continue from a Function");return o instanceof se?o.value:o}catch(e){throw e}}function Ht(e,n,t){return Ft(e,n,(function(n,r,o){const a={spatialReference:e.spatialReference,globalScope:e.globalScope,depthCounter:e.depthCounter+1,console:e.console,lrucache:e.lrucache,interceptor:e.interceptor,localScope:{}};if(a.depthCounter>64)throw new Error("Exceeded maximum function depth");return Vt(t,a,o)}))}function Bt(e){return function(){const n={spatialReference:e.context.spatialReference,console:e.context.console,lrucache:e.context.lrucache,interceptor:e.context.interceptor,localScope:{},depthCounter:e.context.depthCounter+1,globalScope:e.context.globalScope};if(n.depthCounter>64)throw new Error("Exceeded maximum function depth");return Vt(e.definition,n,arguments)}}Le(Lt,Ft),it(Lt,Ft),dn(Lt,Ft),tn(Lt,Ft),En(Lt,Ft),fn(Lt,Ft),Lt.typeof=function(e,n){return Ft(e,n,(function(e,n,t){p(t,1,1);const r=jt(t[0]);if("Unrecognised Type"===r)throw new Error("Unrecognised Type");return r}))},Lt.iif=function(e,n){try{p(null===n.arguments?[]:n.arguments,3,3);const t=Ot(e,n.arguments[0]);if(!1===I(t))throw new Error("IF Function must have a boolean test condition");const r=Ot(e,n.arguments[1]),o=Ot(e,n.arguments[2]);return!0===t?r:o}catch(e){throw e}},Lt.decode=function(e,n){try{if(n.arguments.length<2)throw new Error("Missing Parameters");if(2===n.arguments.length)return Ot(e,n.arguments[1]);if((n.arguments.length-1)%2==0)throw new Error("Must have a default value result.");return zt(e,n,1,Ot(e,n.arguments[0]))}catch(e){throw e}},Lt.when=function(e,n){try{if(n.arguments.length<3)throw new Error("Missing Parameters");if(n.arguments.length%2==0)throw new Error("Must have a default value result.");const t=Ot(e,n.arguments[0]);if(!1===I(t))throw new Error("WHEN needs boolean test conditions");return Gt(e,n,0,t)}catch(e){throw e}},Lt.top=function(e,n){return Ft(e,n,(function(e,n,t){if(p(t,2,2),y(t[0]))return d(t[1])>=t[0].length?t[0].slice(0):t[0].slice(0,d(t[1]));if(w(t[0]))return d(t[1])>=t[0].length()?t[0].slice(0):t[0].slice(0,d(t[1]));throw new Error("Top cannot accept this parameter type")}))},Lt.first=function(e,n){return Ft(e,n,(function(e,n,t){return p(t,1,1),y(t[0])?0===t[0].length?null:t[0][0]:w(t[0])?0===t[0].length()?null:t[0].get(0):null}))},Lt.sort=function(e,n){return Ft(e,n,(function(e,n,t){p(t,1,2);let r=t[0];if(w(r)&&(r=r.toArray()),!1===y(r))throw new Error("Illegal Argument");if(t.length>1){if(!1===L(t[1]))throw new Error("Illegal Argument");let e=r;const n=Bt(t[1]);return e=qt(e,(function(e,t){return n(e,t)})),e}{let e=r;if(0===e.length)return[];const n={};for(let t=0;t<e.length;t++){const r=jt(e[t]);""!==r&&(n[r]=!0)}if(!0===n.Array||!0===n.Dictionary||!0===n.Feature||!0===n.Point||!0===n.Polygon||!0===n.Polyline||!0===n.Multipoint||!0===n.Extent||!0===n.Function)return e.slice(0);let t=0,o="";for(const e in n)t++,o=e;return e=t>1||"String"===o?qt(e,(function(e,n){if(null==e||e===E)return null==n||n===E?0:1;if(null==n||n===E)return-1;const t=M(e),r=M(n);return t<r?-1:t===r?0:1})):"Number"===o?qt(e,(function(e,n){return e-n})):"Boolean"===o?qt(e,(function(e,n){return e===n?0:n?-1:1})):"Date"===o?qt(e,(function(e,n){return n-e})):e.slice(0),e}}))};for(const e in Lt)Lt[e]={value:new v(Lt[e]),valueset:!0,node:null};const Yt=function(){};function Zt(e){console.log(e)}function Jt(e){const n={mode:"sync",compiled:!1,functions:{},signatures:[],standardFunction:Ft,evaluateIdentifier:kt,arcadeCustomFunctionHandler:Bt};for(let t=0;t<e.length;t++)e[t].registerFunctions(n);for(const e in n.functions)Lt[e]={value:new v(n.functions[e]),valueset:!0,node:null},Yt.prototype[e]=Lt[e];for(let e=0;e<n.signatures.length;e++)t(n.signatures[e],"async")}function Wt(t,r){let o=r.spatialReference;null==o&&(o=new xe({wkid:102100}));let a=Ot({spatialReference:o,globalScope:function(t,r){const o=new Yt;t||(t={}),r||(r={});const a=new e({newline:"\n",tab:"\t",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});a.immutable=!1,o.textformatting={value:a,valueset:!0,node:null};for(const e in r)o[e]={value:new v(r[e]),native:!0,valueset:!0,node:null};for(const e in t)t[e]&&"esri.Graphic"===t[e].declaredClass?o[e]={value:n.createFromGraphic(t[e]),valueset:!0,node:null}:o[e]={value:t[e],valueset:!0,node:null};return o}(r.vars,r.customfunctions),localScope:null,console:r.console?r.console:Zt,lrucache:r.lrucache,interceptor:r.interceptor,depthCounter:1},t.body[0].body);if(a instanceof ie&&(a=a.value),a instanceof se&&(a=a.value),a===E&&(a=null),a===le)throw new Error("Cannot return BREAK");if(a===ce)throw new Error("Cannot return CONTINUE");if(a instanceof N)throw new Error("Cannot return FUNCTION");if(a instanceof v)throw new Error("Cannot return FUNCTION");return a}(Yt.prototype=Lt).infinity={value:Number.POSITIVE_INFINITY,valueset:!0,node:null},Yt.prototype.pi={value:Math.PI,valueset:!0,node:null},Jt([Oe]);const $t=["feature","angle","bearing","centroid","envelopeintersects","extent","geometry","isselfintersecting","ringisclockwise"];let Qt=!1,Xt=!1,Kt=null,er=[];function nr(e,n){return!0===n.useAsync||!0===e.isAsync?function(e,n){if(null===Kt)throw new Error("Async Arcade must be enabled for this script");return Me("esri-csp-restrictions")?function(n){return Kt.executeScript(e,n)}:Tt(e,n,!0)}(e,n):Me("esri-csp-restrictions")?function(n){return Wt(e,n)}:Tt(e,n)}function tr(e,n=[]){return i(e,n)}function rr(e,n){if(!0===n.useAsync||!0===e.isAsync){if(null===Kt)throw new Error("Async Arcade must be enabled for this script");return Kt.executeScript(e,n)}return Wt(e,n)}function or(e,n){return function(e,n){return o(e,n)}(e,n)}function ar(e){return u(e)}function ir(e,n=[]){return void 0===e.usesGeometry&&f(e,n),!0===e.usesGeometry}let sr=null;function lr(){return sr||(sr=cr(),sr)}async function cr(){const[e,n]=await Promise.all([import("../geometry/geometryEngine.js"),Promise.resolve().then((()=>hn))]);return Xt=!0,n.setGeometryEngine(e),!0}let ur=null;function fr(){return null!==ur||(ur=hr()),ur}async function hr(){await async function(){return At([await import("./geomasync.js")],"async"),!0}(),Kt=await import("./arcadeAsyncRuntime.js");for(const e of er)Kt.extend(e),At(e,"async");return er=null,!0}function pr(){return Qt}function dr(){return!!Kt}function mr(){return Xt}let gr=null;function wr(){return gr||(gr=yr(),gr)}async function yr(){await fr();const[e,n,t,r,o]=await Promise.all([import("./featureSetUtils.js").then((e=>e.o)),import("./featuresetbase.js"),import("./featuresetgeom.js"),import("./featuresetstats.js"),import("./featuresetstring.js")]);return Nr=e,Kt.extend([n,t,r,o]),At([n,t,r,o],"async"),Qt=!0,!0}function Er(e,n=[]){return void 0===e.usesFeatureSet&&f(e,n),!0===e.usesFeatureSet}async function Sr(e,n,t=[],r=!1){const o="string"==typeof e?tr(e):e,a=[];return o&&(!1===mr()&&(ir(o)||r)&&a.push(lr()),!1===dr()&&(!0===o.isAsync||n)&&a.push(fr()),!1===pr()&&(Er(o)||function(e,n){if(n){for(const t of n)if(or(e,t))return!0;return!1}return!1}(o,t))&&a.push(wr())),!a.length||(await Promise.all(a),!0)}function Ir(e){if(ir(e))return!0;const n=h(e);let t=!1;for(let e=0;e<n.length;e++)if($t.includes(n[e])){t=!0;break}return t}let Nr=null;function vr(){return Nr}const br=Object.freeze(Object.defineProperty({__proto__:null,compileScript:nr,extend:function(e){Jt(e),At(e,"sync"),null===Kt?er.push(e):(At(e,"async"),Kt.extend(e))},parseScript:tr,validateScript:function(e,n,t=""){return s(e,n,t)},scriptCheck:function(e,n,t,r=""){return l(e,n,t,r)},parseAndExecuteScript:function(e,n,t=[]){return rr(i(e,t),n)},executeScript:rr,referencesMember:or,referencesFunction:function(e,n){return function(e,n){return a(e,n)}(e,n)},extractFieldLiterals:function(e,n=!1){return c(e)},extractExpectedFieldLiterals:ar,scriptUsesGeometryEngine:ir,enableGeometrySupport:lr,enableGeometrySupportImpl:cr,enableAsyncSupport:fr,enableAsyncSupportImpl:hr,isFeatureSetSupportEnabled:pr,isAsyncEnabled:dr,isGeometryEnabled:mr,enableFeatureSetSupport:wr,enableFeatureSetSupportImpl:yr,scriptUsesFeatureSet:Er,scriptIsAsync:function(e,n=[]){return void 0===e.isAsync&&f(e,n),!0===e.isAsync},loadScriptDependencies:Sr,scriptTouchesGeometry:Ir,featureSetUtils:vr},Symbol.toStringTag,{value:"Module"})),Ar=/^\$(feature|aggregatedFeatures)\./i,xr={vars:{$feature:"any",$view:"any"},spatialReference:null};function Mr(e){return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&")}function _r(e){if(!e)return null;try{return tr(e)}catch(e){}return null}function Rr(e,n){if(!e)return!1;if("string"==typeof e)return n(e);const t=e;if("simple"===(r=t).type||"class-breaks"===r.type||"unique-value"===r.type||"dot-density"===r.type||"dictionary"===r.type||"pie-chart"===r.type){if("dot-density"===t.type){const e=t.attributes.some((e=>n(e.valueExpression)));if(e)return e}const e=t.visualVariables,r=!!e&&e.some((e=>{let t=n(e.valueExpression);return"size"===e.type&&(Re(e.minSize)&&(t=t||n(e.minSize.valueExpression)),Re(e.maxSize)&&(t=t||n(e.maxSize.valueExpression))),t}));return!(!("valueExpression"in t)||!n(t.valueExpression))||r}var r;if("esri.layers.support.LabelClass"===t.declaredClass){const e=t.labelExpressionInfo&&t.labelExpressionInfo.expression;return!(!e||!n(e))||!1}return"esri.PopupTemplate"===t.declaredClass&&(!!t.expressionInfos&&t.expressionInfos.some((e=>n(e.expression)))||Array.isArray(t.content)&&t.content.some((e=>"expression"===e.type&&n(e.expressionInfo?.expression))))}function Tr(e){const n=_r(e);return!!n&&Ir(n)}function Fr(e){const n=_r(e);return!!n&&ir(n)}const Or=Object.freeze(Object.defineProperty({__proto__:null,getArcadeType:function(n){return null==n?null:y(n)||w(n)?"array":P(n)?"date":R(n)?"text":I(n)?"boolean":k(n)?"number":n instanceof e?"dictionary":J(n)?"feature":n instanceof ye?"point":n instanceof Ee?"polygon":n instanceof Ie?"polyline":n instanceof we?"multipoint":n instanceof de?"extent":ne(n)?"featureSet":te(n)?"featureSetCollection":null},createSyntaxTree:_r,createFunction:function(e,n){const t="string"==typeof e?_r(e):e;if(!t)return null;try{return nr(t,n=n||_e(xr))}catch(e){}return null},createExecContext:function(e,t){return{vars:{$feature:null==e?new n:n.createFromGraphic(e),$view:t&&t.view},spatialReference:t&&t.sr}},createFeature:function(e,t,r){return n.createFromGraphicLikeObject(t,e,r)},updateExecContext:function(e,n){e.vars.$feature=n},evalSyntaxTree:function(e,n){let t;try{t=rr(e,n)}catch(e){t=null}return t},executeFunction:function(e,n){let t;try{t=e?e(n):null}catch(e){t=null}return t},executeAsyncFunction:function(e,n){try{return e?e(n):Promise.resolve(null)}catch(e){return Promise.resolve(null)}},extractFieldNames:function(e,n){if(!e)return[];const t="string"==typeof e?_r(e):e;if(!t)return[];const r=ar(t);let o=new Array;r.forEach((e=>{Ar.test(e)&&(e=e.replace(Ar,""),o.push(e))}));const a=o.filter((e=>e.includes("*")));return o=o.filter((e=>!a.includes(e))),n&&a.forEach((e=>{const t=new RegExp(`^${e.split(/\*+/).map(Mr).join(".*")}$`,"i");n.forEach((e=>t.test(e)?o.push(e):null))})),[...new Set(o.sort())]},dependsOnView:function(e){return or(e,"$view")},hasVariable:function(e,n){return!!e&&or(e,n)},getViewInfo:function(n){if(n&&(null!=n.spatialReference||null!=n.scale&&null!=n.viewingMode))return{view:n.viewingMode&&null!=n.scale?new e({viewingMode:n.viewingMode,scale:n.scale}):null,sr:n.spatialReference}},convertServiceUrlToWorkspace:function({url:e,spatialReference:n,lrucache:t,interceptor:r}){const o=vr();return o?o.createFeatureSetCollectionFromService(e,n,t,r):null},convertFeatureLayerToFeatureSet:function({layer:e,spatialReference:n,outFields:t,returnGeometry:r,lrucache:o,interceptor:a}){if(null===e)return null;const i=vr();return i?i.constructFeatureSet(e,n,t,r??!0,o,a):null},convertMapToFeatureSetCollection:function(e){if(null===e?.map)return null;const n=vr();return n?n.createFeatureSetCollectionFromMap(e.map,e.spatialReference,e.lrucache,e.interceptor):null},loadScriptDependencies:function(e,n,t=[]){return Sr(e,n,t)},enableGeometryOperations:function(){return lr()},enableFeatureSetOperations:function(){return wr()},hasGeometryFunctions:function(e){return Rr(e,Tr)},hasGeometryOperations:function(e){return Rr(e,Fr)},arcade:br,arcadeFeature:n,Dictionary:e},Symbol.toStringTag,{value:"Module"}));export{Oe as A,it as a,dn as b,tn as c,En as d,Fe as e,Te as f,sn as g,rn as h,an as i,Je as j,We as k,qe as l,wn as m,on as n,Or as o,Le as r,je as s};
