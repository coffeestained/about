/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{C as n,c as e}from"./generateRendererUtils.js";const t=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,a=new Set(["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),l=["min","max","avg","stddev","count","sum","variance","nullcount","median"];function i(n){const e=null!=n.normalizationField||null!=n.normalizationType,t=null!=n.minValue||null!=n.maxValue,a=!!n.sqlExpression&&n.supportsSQLExpression;return!e&&!t&&!a}function r(n){const e=n.returnDistinct?[...new Set(n.values)]:n.values,t=e.filter((n=>null!=n)).length,a={count:t};return n.supportsNullCount&&(a.nullcount=e.length-t),n.percentileParams&&(a.median=s(e,n.percentileParams)),a}function o(n){const{values:e,useSampleStdDev:t,supportsNullCount:a}=n;let l=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,r=null,o=null,u=null,c=null,m=0;const d=null==n.minValue?-1/0:n.minValue,f=null==n.maxValue?1/0:n.maxValue;for(const n of e)Number.isFinite(n)?n>=d&&n<=f&&(r+=n,l=Math.min(l,n),i=Math.max(i,n),m++):"string"==typeof n&&m++;if(m&&null!=r){o=r/m;let n=0;for(const t of e)Number.isFinite(t)&&t>=d&&t<=f&&(n+=(t-o)**2);c=t?m>1?n/(m-1):0:m>0?n/m:0,u=Math.sqrt(c)}else l=null,i=null;const p={avg:o,count:m,max:i,min:l,stddev:u,sum:r,variance:c};return a&&(p.nullcount=e.length-m),n.percentileParams&&(p.median=s(e,n.percentileParams)),p}function s(n,e){const{fieldType:t,value:a,orderBy:l,isDiscrete:i}=e,r=u(t,"desc"===l);if(0===(n=[...n].filter((n=>null!=n)).sort(((n,e)=>r(n,e)))).length)return null;if(a<=0)return n[0];if(a>=1)return n[n.length-1];const o=(n.length-1)*a,s=Math.floor(o),c=s+1,m=o%1,d=n[s],f=n[c];return c>=n.length||i||"string"==typeof d||"string"==typeof f?d:d*(1-m)+f*m}function u(n,e){const t=e?1:-1,l=function(n){return n?(n,e)=>e-n:(n,e)=>n-e}(e),i=c(e);if(!n||!["esriFieldTypeDate","esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...a].includes(n))return(n,e)=>"number"==typeof n&&"number"==typeof e?l(n,e):"string"==typeof n&&"string"==typeof e?i(n,e):t;if("esriFieldTypeDate"===n)return(n,e)=>{const a=new Date(n).getTime(),i=new Date(e).getTime();return isNaN(a)||isNaN(i)?t:l(a,i)};if(a.has(n))return(n,e)=>l(n,e);if("esriFieldTypeString"===n)return(n,e)=>i(n,e);if("esriFieldTypeGUID"===n||"esriFieldTypeGlobalID"===n){const n=c(e);return(e,t)=>n(m(e),m(t))}return e?(n,e)=>1:(n,e)=>-1}function c(n){return n?(n,e)=>(n=n?.toUpperCase(),e=e?.toUpperCase(),n>e?-1:n<e?1:0):(n,e)=>(n=n?.toUpperCase(),e=e?.toUpperCase(),n<e?-1:n>e?1:0)}function m(n){return n.substr(24,12)+n.substr(19,4)+n.substr(16,2)+n.substr(14,2)+n.substr(11,2)+n.substr(9,2)+n.substr(6,2)+n.substr(4,2)+n.substr(2,2)+n.substr(0,2)}function d(n,e){let t;for(t in n)l.includes(t)&&(Number.isFinite(n[t])||(n[t]=null));return e?(["avg","stddev","variance"].forEach((e=>{null!=n[e]&&(n[e]=Math.ceil(n[e]))})),n):n}function f(n){const e={};for(let t of n)(null==t||"string"==typeof t&&""===t.trim())&&(t=null),null==e[t]?e[t]={count:1,data:t}:e[t].count++;return{count:e}}function p(n,e,t){const a=n.count,l=[];t&&e&&"coded-value"===e.type&&e.codedValues.forEach((n=>{const e=n.code;a.hasOwnProperty(e)||(a[e]={data:e,count:0})}));for(const n in a){const e=a[n];l.push({value:e.data,count:e.count,label:e.label})}return{uniqueValueInfos:l}}function v(n,e,t,a){let l=null;switch(e){case"log":0!==n&&(l=Math.log(n)*Math.LOG10E);break;case"percent-of-total":Number.isFinite(a)&&0!==a&&(l=n/a*100);break;case"field":Number.isFinite(t)&&0!==t&&(l=n/t);break;case"natural-log":n>0&&(l=Math.log(n));break;case"square-root":n>0&&(l=n**.5)}return l}function b(n,t){const a=g({field:t.field,normalizationType:t.normalizationType,normalizationField:t.normalizationField,classificationMethod:t.classificationMethod,standardDeviationInterval:t.standardDeviationInterval,breakCount:t.numClasses||5});return n=function(n,e,t){return e=null==e?-1/0:e,t=null==t?1/0:t,n.filter((n=>Number.isFinite(n)&&n>=e&&n<=t))}(n,t.minValue,t.maxValue),e({definition:a,values:n,normalizationTotal:t.normalizationTotal})}function g(e){const t=e.field,a=e.classificationMethod||"equal-interval",l=e.normalizationType,i=e.normalizationField,r=new n;return r.classificationField=t,r.breakCount=e.breakCount,r.classificationMethod=a,r.standardDeviationInterval="standard-deviation"===a?e.standardDeviationInterval||1:void 0,r.normalizationType=l,r.normalizationField="field"===l?i:void 0,r}function h(n,e){let a=n.classBreaks;const l=a.length,i=a[0].minValue,r=a[l-1].maxValue,o="standard-deviation"===e,s=t;return a=a.map((n=>{const e=n.label,t={minValue:n.minValue,maxValue:n.maxValue,label:e};if(o&&e){const n=e.match(s).map((n=>+n.trim()));2===n.length?(t.minStdDev=n[0],t.maxStdDev=n[1],n[0]<0&&n[1]>0&&(t.hasAvg=!0)):1===n.length&&(e.includes("<")?(t.minStdDev=null,t.maxStdDev=n[0]):e.includes(">")&&(t.minStdDev=n[0],t.maxStdDev=null))}return t})),{minValue:i,maxValue:r,classBreakInfos:a,normalizationTotal:n.normalizationTotal}}function V(n,e){const{min:t,max:a,intervals:l}=function(n,e){const{field:t,classificationMethod:a,standardDeviationInterval:l,normalizationType:r,normalizationField:s,normalizationTotal:u,minValue:c,maxValue:m}=e,d=e.numBins||10;let f=null,p=null,v=null;if(a&&"equal-interval"!==a||r){const{classBreaks:e}=b(n,{field:t,normalizationType:r,normalizationField:s,normalizationTotal:u,classificationMethod:a,standardDeviationInterval:l,minValue:c,maxValue:m,numClasses:d});f=e[0].minValue,p=e[e.length-1].maxValue,v=e.map((n=>[n.minValue,n.maxValue]))}else{if(null!=c&&null!=m)f=c,p=m;else{const e=o({values:n,minValue:c,maxValue:m,useSampleStdDev:!r,supportsNullCount:i({normalizationType:r,normalizationField:s,minValue:c,maxValue:m})});f=e.min,p=e.max}v=y(f,p,d)}return{min:f,max:p,intervals:v}}(n,e),r=l.map(((n,e)=>({minValue:l[e][0],maxValue:l[e][1],count:0})));for(const e of n)if(null!=e&&e>=t&&e<=a){const n=T(l,e);n>-1&&r[n].count++}return{bins:r,minValue:t,maxValue:a,normalizationTotal:e.normalizationTotal}}function T(n,e){let t=-1;for(let a=n.length-1;a>=0;a--)if(e>=n[a][0]){t=a;break}return t}function y(n,e,t){const a=(e-n)/t,l=[];let i,r=n;for(let n=1;n<=t;n++)i=r+a,i=Number(i.toFixed(16)),l.push([r,n===t?e:i]),r=i;return l}export{g as a,v as b,p as c,r as d,o as e,f,y as g,b as h,i,V as j,u as k,s as l,d as p,h as r,l as s};
