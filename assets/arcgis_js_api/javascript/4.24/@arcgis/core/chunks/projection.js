/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{L as r}from"./Logger.js";import{a as e}from"./maybe.js";import{f as t,t as o,a,i as n}from"./mat3.js";import{b as f}from"./quatf64.js";import{c as s}from"./mat4f64.js";import{F as m,n as y,h as i}from"./mathUtils.js";import{projectBuffer as p,computeTranslationToOriginAndRotation as c}from"../geometry/projection.js";import{c as u}from"./projectionEllipsoid.js";import{m as P,f as T,h as l}from"../geometry/SpatialReference.js";import{y2lat as A}from"../geometry/support/webMercatorUtils.js";import{B as F,e as d}from"./BufferView.js";import{t as E,a as g,n as C}from"./vec3.js";const _=r.getLogger("esri.geometry.support.meshUtils.normalProjection");function j(r,e,t,o,a){return b(o)?(S(Y.TO_PCPF,F.fromTypedArray(r),d.fromTypedArray(e),d.fromTypedArray(t),o,F.fromTypedArray(a)),a):(_.error("Cannot convert spatial reference to PCPF"),a)}function M(r,e,t,o,a){return b(o)?(S(Y.FROM_PCPF,F.fromTypedArray(r),d.fromTypedArray(e),d.fromTypedArray(t),o,F.fromTypedArray(a)),a):(_.error("Cannot convert to spatial reference from PCPF"),a)}function O(r,e,t){return p(r,e,0,t,u(e),0,r.length/3),t}function R(r,e,t){return p(r,u(t),0,e,t,0,r.length/3),e}function h(r,t,o){if(e(r))return t;const a=d.fromTypedArray(r),n=d.fromTypedArray(t);return E(n,a,o),t}function L(r,t,o){if(e(r))return t;a(q,o);const f=F.fromTypedArray(r),s=F.fromTypedArray(t);return g(s,f,q),n(q)||C(s,s),t}function V(r,t,o){if(e(r))return t;a(q,o);const f=F.fromTypedArray(r,4*Float32Array.BYTES_PER_ELEMENT),s=F.fromTypedArray(t,4*Float32Array.BYTES_PER_ELEMENT);if(g(s,f,q),n(q)||C(s,s),r!==t)for(let e=3;e<r.length;e+=4)t[e]=r[e];return t}function v(r,e,t,o,a){if(!b(o))return _.error("Cannot convert spatial reference to PCPF"),a;S(Y.TO_PCPF,F.fromTypedArray(r,4*Float32Array.BYTES_PER_ELEMENT),d.fromTypedArray(e),d.fromTypedArray(t),o,F.fromTypedArray(a,4*Float32Array.BYTES_PER_ELEMENT));for(let e=3;e<r.length;e+=4)a[e]=r[e];return a}function B(r,e,t,o,a){if(!b(o))return _.error("Cannot convert to spatial reference from PCPF"),a;S(Y.FROM_PCPF,F.fromTypedArray(r,16),d.fromTypedArray(e),d.fromTypedArray(t),o,F.fromTypedArray(a,16));for(let e=3;e<r.length;e+=4)a[e]=r[e];return a}function S(r,e,a,n,f,s){if(!e)return;const i=a.count,p=u(f);if(N(f))for(let a=0;a<i;a++)n.getVec(a,U),e.getVec(a,w),c(p,U,W,p),t(q,W),r===Y.FROM_PCPF&&o(q,q),m(w,w,q),s.setVec(a,w);else for(let f=0;f<i;f++){n.getVec(f,U),e.getVec(f,w),c(p,U,W,p),t(q,W);const i=A(a.get(f,1));let u=Math.cos(i);r===Y.TO_PCPF&&(u=1/u),q[0]*=u,q[1]*=u,q[2]*=u,q[3]*=u,q[4]*=u,q[5]*=u,r===Y.FROM_PCPF&&o(q,q),m(w,w,q),y(w,w),s.setVec(f,w)}return s}function b(r){return N(r)||function(r){return r.isWebMercator}(r)}function N(r){return r.isWGS84||P(r)||T(r)||l(r)}var Y;!function(r){r[r.TO_PCPF=0]="TO_PCPF",r[r.FROM_PCPF=1]="FROM_PCPF"}(Y||(Y={}));const U=i(),w=i(),W=s(),q=f();export{j as a,v as b,R as c,M as d,B as e,L as f,V as g,O as p,h as t};
