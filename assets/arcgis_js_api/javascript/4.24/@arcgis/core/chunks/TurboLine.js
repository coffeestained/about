/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{C as t,J as e}from"./enums2.js";import{T as i}from"./definitions.js";function x(t,e){return t.x===e.x&&t.y===e.y}function r(t,e){return t.x=e.y,t.y=-e.x,t}function s(t,e){return t.x=-e.y,t.y=e.x,t}function n(t,e){return t.x=e.x,t.y=e.y,t}function y(t,e){return t.x=-e.x,t.y=-e.y,t}function o(t){return Math.sqrt(t.x*t.x+t.y*t.y)}function h(t,e){return t.x*e.x+t.y*e.y}function l(t,e,i,x){return t.x=e.x*i+e.y*x,t.y=e.x*x-e.y*i,t}class a{constructor(t,e,i){this.writeVertex=t,this.writeTriangle=e,this.canUseThinTessellation=i,this.prevNormal={x:void 0,y:void 0},this.nextNormal={x:void 0,y:void 0},this.textureNormalLeft={x:0,y:1},this.textureNormalRight={x:0,y:-1},this.textureNormal={x:void 0,y:void 0},this.joinNormal={x:void 0,y:void 0},this.inner={x:void 0,y:void 0},this.outer={x:void 0,y:void 0},this.roundStart={x:void 0,y:void 0},this.roundEnd={x:void 0,y:void 0},this.startBreak={x:void 0,y:void 0},this.endBreak={x:void 0,y:void 0},this.innerPrev={x:void 0,y:void 0},this.innerNext={x:void 0,y:void 0},this.bevelStart={x:void 0,y:void 0},this.bevelEnd={x:void 0,y:void 0},this.bevelMiddle={x:void 0,y:void 0}}tessellate(t,e){!function(t){if(!t)return;const e=t.length;if(e<=1)return;let i=0;for(let r=1;r<e;r++)x(t[r],t[i])||++i===r||(t[i]=t[r]);t.length=i+1}(t),this.canUseThinTessellation&&e.halfWidth<i&&!e.offset?this._tessellateThin(t,e):this._tessellate(t,e)}_tessellateThin(t,e){if(t.length<2)return;const i=e.wrapDistance||65535;let x=e.initialDistance||0,r=!1,s=t[0].x,n=t[0].y;const y=t.length;for(let e=1;e<y;++e){r&&(r=!1,x=0);let y=t[e].x,o=t[e].y,h=y-s,l=o-n,a=Math.sqrt(h*h+l*l);if(h/=a,l/=a,x+a>i){r=!0;const t=(i-x)/a;a=i-x,y=(1-t)*s+t*y,o=(1-t)*n+t*o,--e}const c=this.writeVertex(s,n,0,0,h,l,l,-h,0,-1,x),d=this.writeVertex(s,n,0,0,h,l,-l,h,0,1,x);x+=a;const u=this.writeVertex(y,o,0,0,h,l,l,-h,0,-1,x),v=this.writeVertex(y,o,0,0,h,l,-l,h,0,1,x);this.writeTriangle(c,d,u),this.writeTriangle(d,u,v),s=y,n=o}}_tessellate(i,a){const c=i[0],d=i[i.length-1],u=x(c,d),v=u?3:2;if(i.length<v)return;const f=a.pixelCoordRatio,w=null!=a.capType?a.capType:t.BUTT,T=null!=a.joinType?a.joinType:e.MITER,g=null!=a.miterLimit?Math.min(a.miterLimit,4):2,m=null!=a.roundLimit?Math.min(a.roundLimit,1.05):1.05,V=null!=a.halfWidth?a.halfWidth:2,N=!!a.textured;let E,b,R=null,U=null;const k=this.prevNormal,p=this.nextNormal;let M=-1,B=-1;const L=this.joinNormal;let D,S;const j=this.textureNormalLeft,A=this.textureNormalRight,O=this.textureNormal;let _=-1,I=-1;const P=a.wrapDistance||65535;let W=a.initialDistance||0;const q=this.writeVertex,C=this.writeTriangle,Q=(t,e,i,x,r,s)=>{const n=q(E,b,D,S,i,x,t,e,r,s,W);return _>=0&&I>=0&&n>=0&&C(_,I,n),_=I,I=n,n};u&&(R=i[i.length-2],p.x=d.x-R.x,p.y=d.y-R.y,B=o(p),p.x/=B,p.y/=B);let X=!1;for(let x=0;x<i.length;++x){if(X&&(X=!1,W=0),R&&(k.x=-p.x,k.y=-p.y,M=B,W+M>P&&(X=!0)),X){const t=(P-W)/M;M=P-W,R={x:(1-t)*R.x+t*i[x].x,y:(1-t)*R.y+t*i[x].y},--x}else R=i[x];E=R.x,b=R.y;const a=x<=0&&!X,c=x===i.length-1;if(a||(W+=M),U=c?u?i[1]:null:i[x+1],U?(p.x=U.x-E,p.y=U.y-b,B=o(p),p.x/=B,p.y/=B):(p.x=void 0,p.y=void 0),!u){if(a){s(L,p),D=L.x,S=L.y,w===t.SQUARE&&(Q(-p.y-p.x,p.x-p.y,p.x,p.y,0,-1),Q(p.y-p.x,-p.x-p.y,p.x,p.y,0,1)),w===t.ROUND&&(Q(-p.y-p.x,p.x-p.y,p.x,p.y,-1,-1),Q(p.y-p.x,-p.x-p.y,p.x,p.y,-1,1)),w!==t.ROUND&&w!==t.BUTT||(Q(-p.y,p.x,p.x,p.y,0,-1),Q(p.y,-p.x,p.x,p.y,0,1));continue}if(c){r(L,k),D=L.x,S=L.y,w!==t.ROUND&&w!==t.BUTT||(Q(k.y,-k.x,-k.x,-k.y,0,-1),Q(-k.y,k.x,-k.x,-k.y,0,1)),w===t.SQUARE&&(Q(k.y-k.x,-k.x-k.y,-k.x,-k.y,0,-1),Q(-k.y-k.x,k.x-k.y,-k.x,-k.y,0,1)),w===t.ROUND&&(Q(k.y-k.x,-k.x-k.y,-k.x,-k.y,1,-1),Q(-k.y-k.x,k.x-k.y,-k.x,-k.y,1,1));continue}}let d,v,q=(z=p,-((J=k).x*z.y-J.y*z.x));if(Math.abs(q)<.01)h(k,p)>0?(L.x=k.x,L.y=k.y,q=1,d=Number.MAX_VALUE,v=!0):(s(L,p),q=1,d=1,v=!1);else{L.x=(k.x+p.x)/q,L.y=(k.y+p.y)/q,d=o(L);const t=(d-1)*V*f;v=d>4||t>M&&t>B}D=L.x,S=L.y;let C=T;switch(T){case e.BEVEL:d<1.05&&(C=e.MITER);break;case e.ROUND:d<m&&(C=e.MITER);break;case e.MITER:d>g&&(C=e.BEVEL)}switch(C){case e.MITER:if(Q(L.x,L.y,-k.x,-k.y,0,-1),Q(-L.x,-L.y,-k.x,-k.y,0,1),c)break;if(N){const t=X?0:W;_=this.writeVertex(E,b,D,S,p.x,p.y,L.x,L.y,0,-1,t),I=this.writeVertex(E,b,D,S,p.x,p.y,-L.x,-L.y,0,1,t)}break;case e.BEVEL:{const t=q<0;let e,i,x,o;if(t){const t=_;_=I,I=t,e=j,i=A}else e=A,i=j;if(v)x=t?s(this.innerPrev,k):r(this.innerPrev,k),o=t?r(this.innerNext,p):s(this.innerNext,p);else{const e=t?y(this.inner,L):n(this.inner,L);x=e,o=e}const h=t?r(this.bevelStart,k):s(this.bevelStart,k);Q(x.x,x.y,-k.x,-k.y,e.x,e.y);const a=Q(h.x,h.y,-k.x,-k.y,i.x,i.y);if(c)break;const d=t?s(this.bevelEnd,p):r(this.bevelEnd,p);if(v){const t=this.writeVertex(E,b,D,S,-k.x,-k.y,0,0,0,0,W);_=this.writeVertex(E,b,D,S,p.x,p.y,o.x,o.y,e.x,e.y,W),I=this.writeVertex(E,b,D,S,p.x,p.y,d.x,d.y,i.x,i.y,W),this.writeTriangle(a,t,I)}else{if(N){const t=this.bevelMiddle;t.x=(h.x+d.x)/2,t.y=(h.y+d.y)/2,l(O,t,-k.x,-k.y),Q(t.x,t.y,-k.x,-k.y,O.x,O.y),l(O,t,p.x,p.y),_=this.writeVertex(E,b,D,S,p.x,p.y,t.x,t.y,O.x,O.y,W),I=this.writeVertex(E,b,D,S,p.x,p.y,o.x,o.y,e.x,e.y,W)}else{const t=_;_=I,I=t}Q(d.x,d.y,p.x,p.y,i.x,i.y)}if(t){const t=_;_=I,I=t}break}case e.ROUND:{const t=q<0;let e,i;if(t){const t=_;_=I,I=t,e=j,i=A}else e=A,i=j;const x=t?y(this.inner,L):n(this.inner,L);let o,a;v?(o=t?s(this.innerPrev,k):r(this.innerPrev,k),a=t?r(this.innerNext,p):s(this.innerNext,p)):(o=x,a=x);const u=t?r(this.roundStart,k):s(this.roundStart,k),f=t?s(this.roundEnd,p):r(this.roundEnd,p),w=Q(o.x,o.y,-k.x,-k.y,e.x,e.y),T=Q(u.x,u.y,-k.x,-k.y,i.x,i.y);if(c)break;const g=this.writeVertex(E,b,D,S,-k.x,-k.y,0,0,0,0,W);v||this.writeTriangle(_,I,g);const m=y(this.outer,x),V=this.writeVertex(E,b,D,S,p.x,p.y,f.x,f.y,i.x,i.y,W);let R,U;const M=d>2;if(M){let e;d!==Number.MAX_VALUE?(m.x/=d,m.y/=d,e=h(k,m),e=(d*(e*e-1)+1)/e):e=-1,R=t?r(this.startBreak,k):s(this.startBreak,k),R.x+=k.x*e,R.y+=k.y*e,U=t?s(this.endBreak,p):r(this.endBreak,p),U.x+=p.x*e,U.y+=p.y*e}l(O,m,-k.x,-k.y);const B=this.writeVertex(E,b,D,S,-k.x,-k.y,m.x,m.y,O.x,O.y,W);l(O,m,p.x,p.y);const P=N?this.writeVertex(E,b,D,S,p.x,p.y,m.x,m.y,O.x,O.y,W):B,C=g,X=N?this.writeVertex(E,b,D,S,p.x,p.y,0,0,0,0,W):g;let J=-1,z=-1;if(M&&(l(O,R,-k.x,-k.y),J=this.writeVertex(E,b,D,S,-k.x,-k.y,R.x,R.y,O.x,O.y,W),l(O,U,p.x,p.y),z=this.writeVertex(E,b,D,S,p.x,p.y,U.x,U.y,O.x,O.y,W)),N?M?(this.writeTriangle(C,T,J),this.writeTriangle(C,J,B),this.writeTriangle(X,P,z),this.writeTriangle(X,z,V)):(this.writeTriangle(C,T,B),this.writeTriangle(X,P,V)):M?(this.writeTriangle(g,T,J),this.writeTriangle(g,J,z),this.writeTriangle(g,z,V)):(this.writeTriangle(g,T,B),this.writeTriangle(g,P,V)),v?(_=this.writeVertex(E,b,D,S,p.x,p.y,a.x,a.y,e.x,e.y,W),I=V):(_=N?this.writeVertex(E,b,D,S,p.x,p.y,a.x,a.y,e.x,e.y,W):w,this.writeTriangle(_,X,V),I=V),t){const t=_;_=I,I=t}break}}}var J,z}}export{a as L};
