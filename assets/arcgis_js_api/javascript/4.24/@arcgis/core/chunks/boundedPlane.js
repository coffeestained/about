/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import"../core/lang.js";import{L as s}from"./Logger.js";import{f as n,q as i,h as t,a,j as o,e,z as r,o as c,b as u,s as g,v as b,A as l,u as f,d as p,w as m,n as d,p as h}from"./mathUtils.js";import{O as I,s as j}from"./vectorStacks.js";import{j as P,t as N,h as w}from"./mat4.js";import{c as v}from"./mat4f64.js";import{p as M,A as S}from"./sphere.js";import{c as T,p as y,d as A}from"./lineSegment.js";import{c as _,a as O,n as V,b as x,w as E,d as Y,e as q,i as B,g as F,h as L,p as U,s as k}from"./plane.js";import{d as C}from"./ray.js";const R=s.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");class z{constructor(){this.plane=_(),this.origin=t(),this.basis1=t(),this.basis2=t()}}function G(s=fs){return{plane:_(s.plane),origin:i(s.origin),basis1:i(s.basis1),basis2:i(s.basis2)}}function W(s,n=G()){return X(s.origin,s.basis1,s.basis2,n)}function X(s,n,i,t=G()){return a(t.origin,s),a(t.basis1,n),a(t.basis2,i),Z(t),r=t,c="fromValues()",Math.abs(o(r.basis1,r.basis2)/(e(r.basis1)*e(r.basis2)))>1e-6&&R.warn(c,"Provided basis vectors are not perpendicular"),Math.abs(o(r.basis1,cs(r)))>1e-6&&R.warn(c,"Basis vectors and plane normal are not perpendicular"),Math.abs(-o(cs(r),r.origin)-r.plane[3])>1e-6&&R.warn(c,"Plane offset is not consistent with plane origin"),t;var r,c}function Z(s){O(s.basis2,s.basis1,s.origin,s.plane)}function D(s,n,i){s!==i&&W(s,i);const t=c(j.get(),cs(s),n);return u(i.origin,i.origin,t),i.plane[3]-=n,i}function H(s,n=G()){const i=(s[2]-s[0])/2,t=(s[3]-s[1])/2;return g(n.origin,s[0]+i,s[1]+t,0),g(n.basis1,i,0,0),g(n.basis2,0,t,0),q(0,0,1,0,n.plane),n}function J(s,n,i){return!!B(s.plane,n,i)&&us(s,i)}function K(s,n,i){const t=ps.get();ls(s,n,t,ps.get());let e=Number.POSITIVE_INFINITY;for(const r of Is){const c=bs(s,r,ms.get()),u=j.get();if(F(t,c,u)){const s=l(j.get(),n.origin,u),t=Math.abs(f(o(n.direction,s)));t<e&&(e=t,a(i,u))}}return e===Number.POSITIVE_INFINITY?Q(s,n,i):i}function Q(s,n,i){if(J(s,n,i))return i;const t=ps.get(),o=ps.get();ls(s,n,t,o);let e=Number.POSITIVE_INFINITY;for(const r of Is){const c=bs(s,r,ms.get()),u=j.get();if(L(t,c,u)){const s=C(n,u);if(!x(o,u))continue;s<e&&(e=s,a(i,u))}}return ns(s,n.origin)<e&&$(s,n.origin,i),i}function $(s,n,i){const t=U(s.plane,n,j.get()),a=y(gs(s,s.basis1),t,-1,1,j.get()),o=y(gs(s,s.basis2),t,-1,1,j.get());return p(i,u(j.get(),a,o),s.origin),i}function ss(s,n,i){const{origin:t,basis1:a,basis2:o}=s,e=p(j.get(),n,t),r=M(a,e),c=M(o,e),u=M(cs(s),e);return g(i,r,c,u)}function ns(s,n){const i=ss(s,n,j.get()),{basis1:t,basis2:a}=s,o=e(t),r=e(a),c=Math.max(Math.abs(i[0])-o,0),u=Math.max(Math.abs(i[1])-r,0),g=i[2];return c*c+u*u+g*g}function is(s,n){return Math.sqrt(ns(s,n))}function ts(s,n){return x(s.plane,n)&&us(s,n)}function as(s,n){const i=-s.plane[3];return M(cs(s),n)-i}function os(s,n){return r(s.basis1,n.basis1)&&r(s.basis2,n.basis2)&&r(s.origin,n.origin)}function es(s,n,i){return s!==i&&W(s,i),P(js,n),N(js,js),m(i.basis1,s.basis1,js),m(i.basis2,s.basis2,js),m(V(i.plane),V(s.plane),js),m(i.origin,s.origin,n),k(i.plane,i.plane,i.origin),i}function rs(s,n,i,t){return s!==t&&W(s,t),w(Ps,n,i),m(t.basis1,s.basis1,Ps),m(t.basis2,s.basis2,Ps),Z(t),t}function cs(s){return V(s.plane)}function us(s,n){const i=p(j.get(),n,s.origin),t=h(s.basis1),a=h(s.basis2),e=o(s.basis1,i),r=o(s.basis2,i);return-e-t<0&&e-t<0&&-r-a<0&&r-a<0}function gs(s,n){const i=ms.get();return a(i.origin,s.origin),a(i.vector,n),i}function bs(s,n,i){const{basis1:t,basis2:a,origin:o}=s,e=c(j.get(),t,n.origin[0]),r=c(j.get(),a,n.origin[1]);u(i.origin,e,r),u(i.origin,i.origin,o);const g=c(j.get(),t,n.direction[0]),b=c(j.get(),a,n.direction[1]);return c(i.vector,u(g,g,b),2),i}function ls(s,n,i,t){const a=cs(s);O(a,n.direction,n.origin,i),O(V(i),a,n.origin,t)}const fs={plane:_(),origin:n(0,0,0),basis1:n(1,0,0),basis2:n(0,1,0)},ps=new I(_),ms=new I(T),ds=t(),hs=new I((()=>({origin:null,basis1:null,basis2:null,plane:null}))),Is=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],js=v(),Ps=v(),Ns=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:z,create:G,wrap:function(s,n,i){const t=hs.get();return t.origin=s,t.basis1=n,t.basis2=i,t.plane=E(0,0,0,0),Z(t),t},copy:W,copyWithoutVerify:function(s,n){a(n.origin,s.origin),a(n.basis1,s.basis1),a(n.basis2,s.basis2),Y(n.plane,s.plane)},fromValues:X,updateUnboundedPlane:Z,elevate:D,setExtent:function(s,n,i){return H(n,i),D(i,as(s,s.origin),i),i},fromAABoundingRect:H,intersectRay:J,intersectRayClosestSilhouette:function(s,n,i){if(J(s,n,i))return i;const t=K(s,n,j.get());return u(i,n.origin,c(j.get(),n.direction,b(n.origin,t)/e(n.direction))),i},closestPointOnSilhouette:K,closestPoint:Q,projectPoint:$,projectPointLocal:ss,distance2:ns,distance:is,distanceToSilhouette:function(s,n){let i=Number.NEGATIVE_INFINITY;for(const t of Is){const a=bs(s,t,ms.get()),o=A(a,n);o>i&&(i=o)}return Math.sqrt(i)},extrusionContainsPoint:ts,axisAt:function(s,n,i,t){return function(s,n,i){switch(n){case S.X:a(i,s.basis1),d(i,i);break;case S.Y:a(i,s.basis2),d(i,i);break;case S.Z:a(i,cs(s))}return i}(s,i,t)},altitudeAt:as,setAltitudeAt:function(s,n,i,t){const a=as(s,n),o=c(ds,cs(s),i-a);return u(t,n,o),t},equals:os,transform:es,rotate:rs,normal:cs,UP:fs},Symbol.toStringTag,{value:"Module"}));export{z as B,W as a,Ns as b,G as c,os as d,ts as e,X as f,is as g,H as h,J as i,cs as n,rs as r,es as t,Z as u};
