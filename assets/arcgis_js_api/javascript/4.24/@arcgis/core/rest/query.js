/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import o from"../core/Error.js";import{h as t}from"../core/lang.js";import{i as s,a as r}from"../chunks/maybe.js";import{whenOrAbort as p}from"../core/promiseUtils.js";import{D as m}from"../chunks/DataLayerSource.js";import{a as n}from"../chunks/executeQueryJSON.js";export{e as executeQueryJSON,a as executeRawQueryJSON}from"../chunks/executeQueryJSON.js";import{e as u}from"../chunks/executeForTopCount.js";export{a as executeAttachmentQuery,b as executeForExtent,j as executeForTopCount,i as executeForTopExtents,h as executeForTopIds,c as executeQueryPBF,e as executeRawQueryPBF,d as executeRelationshipQuery,f as executeRelationshipQueryForCount,g as executeTopFeaturesQuery}from"../chunks/executeForTopCount.js";import l from"./support/FeatureSet.js";import y from"./support/Query.js";export{a as executeForCount,e as executeForIds}from"../chunks/executeForIds.js";import"../chunks/Logger.js";import"../config.js";import"../chunks/object.js";import"../chunks/string.js";import"../chunks/tslib.es6.js";import"../chunks/jsonMap.js";import"../core/JSONSupport.js";import"../core/Accessor.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/handleUtils.js";import"../core/accessorSupport/decorators/subclass.js";import"../chunks/metadata.js";import"../chunks/tracking.js";import"../chunks/ensureType.js";import"../chunks/ArrayPool.js";import"../core/accessorSupport/decorators/property.js";import"../chunks/watch.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/enumeration.js";import"../chunks/reader.js";import"../layers/support/Field.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/fieldType.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../geometry/SpatialReference.js";import"../chunks/writer.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../chunks/Ellipsoid.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../chunks/utils5.js";import"../core/urlUtils.js";import"../chunks/query.js";import"../request.js";import"../kernel.js";import"../geometry/support/normalizeUtils.js";import"../chunks/normalizeUtilsCommon.js";import"../chunks/pbfQueryUtils.js";import"../chunks/pbf.js";import"../chunks/OptimizedGeometry.js";import"../chunks/unitUtils.js";import"../chunks/projectionEllipsoid.js";import"../chunks/OptimizedFeatureSet.js";import"../chunks/queryZScale.js";import"../chunks/zscale.js";import"../chunks/compilerUtils.js";import"../chunks/featureConversionUtils.js";import"./query/support/AttachmentInfo.js";import"./support/AttachmentQuery.js";import"./support/RelationshipQuery.js";import"./support/TopFeaturesQuery.js";import"../TimeExtent.js";import"../chunks/timeUtils.js";import"./support/TopFilter.js";import"../Graphic.js";import"../PopupTemplate.js";import"../core/Collection.js";import"../core/Evented.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../layers/support/fieldUtils.js";import"../chunks/arcadeOnDemand.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../popup/support/FieldInfoFormat.js";import"../chunks/date.js";import"../chunks/number2.js";import"../chunks/locale.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../support/actions/ActionBase.js";import"../chunks/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../Color.js";import"../chunks/colorUtils.js";import"../chunks/mathUtils.js";import"../chunks/common.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils2.js";import"../symbols/edges/Edges3D.js";import"../chunks/screenUtils.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils3.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../chunks/aaBoundingRect.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../portal/Portal.js";import"../core/Loadable.js";import"../core/Promise.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../core/Clonable.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../chunks/Thumbnail.js";import"../chunks/Symbol3DVerticalOffset.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"./support/StatisticDefinition.js";async function k(o,t,s,e){return S(o,t,s,e).then((o=>async function(o,t,s,e){if(!F(o,s?.infoFor3D)||r(s.infoFor3D)||!t.features||!t.features.length)return l.fromJSON(t);const{meshFeatureSetFromJSON:i}=await p(import("../chunks/meshFeatureSet.js"),e);return i(o,s.infoFor3D,t)}(t,o,s,e)))}async function S(e,i,p,a){const l={...a},c=function(t,e){let i=y.from(t);if(i.sourceSpatialReference=i.sourceSpatialReference||e?.sourceSpatialReference,(e.gdbVersion||e.dynamicDataSource)&&(i=i===t?i.clone():i,i.gdbVersion=t.gdbVersion||e.gdbVersion,i.dynamicDataSource=t.dynamicDataSource?m.from(t.dynamicDataSource):e.dynamicDataSource),s(e.infoFor3D)&&F(t,e?.infoFor3D)){i=i===t?i.clone():i,i.formatOf3DObjects=null;for(const o of e.infoFor3D.queryFormats){if("3D_glb"===o.id){i.formatOf3DObjects=o.id;break}"3D_gltf"!==o.id||i.formatOf3DObjects||(i.formatOf3DObjects=o.id)}if(!i.formatOf3DObjects)throw new o("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(r(i.outFields)||!i.outFields.includes("*")){i=i===t?i.clone():i,r(i.outFields)&&(i.outFields=[]);const{originX:o,originY:s,originZ:p,translationX:m,translationY:n,translationZ:a,scaleX:u,scaleY:l,scaleZ:c,rotationX:j,rotationY:y,rotationZ:h,rotationDeg:b}=e.infoFor3D.transformFieldRoles;i.outFields.push(o,s,p,m,n,a,u,l,c,j,y,h,b)}}return i}(i,p),j=null!=i.outStatistics?.[0],h=t("featurelayer-pbf-statistics"),b=!j||h;let f;if("pbf"===p.format&&b)try{f=await u(e,c,l)}catch(o){if("query:parsing-pbf"!==o.name)throw o;p.format="json"}return"json"!==p.format&&b||(f=await n(e,c,l)),D(p.fieldsIndex,f.fields),f}function D(o,t){if(s(o)&&s(t))for(const s of t){const t=o.get(s.name);t&&Object.assign(s,t.toJSON())}}function F(o,t){return s(t)&&o.returnGeometry&&"xyFootprint"!==o.multipatchOption&&!o.outStatistics}export{k as executeQuery,S as executeRawQuery,D as normalizeFields};
