/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{_ as i}from"../../chunks/tslib.es6.js";import e from"../../core/Accessor.js";import{HandleOwnerMixin as s}from"../../core/HandleOwner.js";import{i as t,a as r,u as o}from"../../chunks/maybe.js";import{watch as n,syncAndInitial as p}from"../../core/reactiveUtils.js";import{aliasOf as l}from"../../core/accessorSupport/decorators/aliasOf.js";import"../../core/lang.js";import"../../chunks/ensureType.js";import{property as a}from"../../core/accessorSupport/decorators/property.js";import{subclass as c}from"../../core/accessorSupport/decorators/subclass.js";import"../../chunks/get.js";import"../../chunks/utils.js";import"../../chunks/handleUtils.js";import"../../chunks/metadata.js";import"../../chunks/Logger.js";import"../../config.js";import"../../chunks/object.js";import"../../chunks/string.js";import"../../chunks/ArrayPool.js";import"../../chunks/tracking.js";import"../../chunks/watch.js";import"../../core/scheduling.js";import"../../chunks/nextTick.js";import"../../core/promiseUtils.js";import"../../core/Error.js";import"../../core/Handles.js";import"../../core/Collection.js";import"../../core/Evented.js";import"../../chunks/shared.js";import"../../chunks/SimpleObservable.js";const u=["visibility"];let d=class extends(s(e)){constructor(i){super(i),this._expressionTrackingHandles=new Map,this.arcade=null,this.visibilityExpression=null,this.description=null,this.expressionTrackingProvider=null,this.feature=null,this.groupElement=null,this.label=null,this.spatialReference=null}initialize(){this.own([...u.map((i=>n((()=>this.get(`${i}Function`)),(e=>{t(e)?this._registerExpressionWithTrackingProvider(i):this._unregisterExpressionWithTrackingProvider(i)}),p))),n((()=>[this.visible,this.inputFields]),(([i])=>{const{inputFields:e}=this,s=!!i&&void 0;for(const i of e)i.required=s}),{initial:!0,equals:(i,e)=>e[0]===i[0]&&e[1]===i[1]})])}destroy(){for(const i of this._expressionTrackingHandles.values())i.remove()}set visibilityFunction(i){this._set("visibilityFunction",i),t(i)?this._registerExpressionWithTrackingProvider("visibility"):this._unregisterExpressionWithTrackingProvider("visibility")}get evaluatedVisibilityExpression(){const{visibilityFunction:i,spatialReference:e}=this;if(r(i))return;const{arcade:s}=this,t=s.arcadeUtils.getViewInfo({spatialReference:o(e)});return s.arcadeUtils.executeFunction(i,s.arcadeUtils.createExecContext(this.feature,t))}get inputFields(){return this._get("inputFields")}set inputFields(i){this.handles.removeAll(),i&&this.handles.add(i.map((i=>n((()=>i.visible),(()=>this._dirtyEvaluatedVisibilityExpression()))))),this._set("inputFields",i)}get state(){return t(this.groupElement)&&this.groupElement.initialState||"expanded"}set state(i){r(i)?this._clearOverride("state"):this._override("state",i)}get visible(){return!1!==this.evaluatedVisibilityExpression&&this.inputFields&&this.inputFields.some((i=>i.visible))}_registerExpressionWithTrackingProvider(i){const{_expressionTrackingHandles:e,expressionTrackingProvider:s}=this;if(r(s)||e.has(i))return;const t=`evaluated${h(i)}Expression`,o=s.registerExpression((()=>this.notifyChange(t)));e.set(i,o)}_unregisterExpressionWithTrackingProvider(i){const{_expressionTrackingHandles:e}=this,s=e.get(i);s&&(s.remove(),e.delete(i))}_dirtyEvaluatedVisibilityExpression(){const{groupElement:i}=this;t(i)&&i.visibilityExpression&&this.notifyChange("evaluatedVisibilityExpression")}};i([a()],d.prototype,"arcade",void 0),i([l("groupElement.visibilityExpression")],d.prototype,"visibilityExpression",void 0),i([a()],d.prototype,"visibilityFunction",null),i([a()],d.prototype,"evaluatedVisibilityExpression",null),i([l("groupElement.description")],d.prototype,"description",void 0),i([a()],d.prototype,"expressionTrackingProvider",void 0),i([a()],d.prototype,"feature",void 0),i([a()],d.prototype,"groupElement",void 0),i([a()],d.prototype,"inputFields",null),i([l("groupElement.label")],d.prototype,"label",void 0),i([a()],d.prototype,"spatialReference",void 0),i([a()],d.prototype,"state",null),i([a()],d.prototype,"visible",null),d=i([c("esri.widgets.FeatureForm.InputFieldGroup")],d);const h=i=>i.charAt(0).toUpperCase()+i.slice(1),m=d;export{m as default};
