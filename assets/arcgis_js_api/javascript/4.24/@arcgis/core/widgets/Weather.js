/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{i as o}from"../chunks/maybe.js";import{m as s}from"../chunks/memoize.js";import{aliasOf as t}from"../core/accessorSupport/decorators/aliasOf.js";import"../core/lang.js";import"../chunks/ensureType.js";import{property as r}from"../core/accessorSupport/decorators/property.js";import{subclass as i}from"../core/accessorSupport/decorators/subclass.js";import{b as n}from"../chunks/weather.js";import a from"./Widget.js";import{H as l}from"../chunks/Heading.js";import{c}from"../chunks/widgetUtils.js";import{m as d}from"../chunks/messageBundle.js";import{t as h,a as p}from"../chunks/jsxFactory.js";import u,{W as m,a as g}from"./Weather/WeatherViewModel.js";import{watch as v}from"../core/reactiveUtils.js";import b from"../core/Accessor.js";import"../chunks/Logger.js";import"../config.js";import"../chunks/object.js";import"../chunks/string.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/handleUtils.js";import"../chunks/metadata.js";import"../core/Error.js";import"../chunks/tracking.js";import"../views/3d/environment/CloudyWeather.js";import"../core/JSONSupport.js";import"../chunks/ArrayPool.js";import"../chunks/watch.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../core/promiseUtils.js";import"../chunks/enumeration.js";import"../chunks/jsonMap.js";import"../views/3d/environment/FoggyWeather.js";import"../views/3d/environment/RainyWeather.js";import"../views/3d/environment/SnowyWeather.js";import"../views/3d/environment/SunnyWeather.js";import"../intl.js";import"../chunks/number2.js";import"../chunks/locale.js";import"../chunks/messages.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/assets.js";import"../chunks/domUtils.js";import"../core/Evented.js";import"../core/Handles.js";import"../core/Collection.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../core/Promise.js";import"../chunks/uuid.js";import"../core/accessorSupport/decorators/cast.js";import"../chunks/projector.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/mathUtils.js";import"../chunks/common.js";const y="esri-weather",w={base:y,esriWidget:"esri-widget",esriWidgetDisabled:"esri-widget--disabled",widgetIcon:"esri-icon-partly-cloudy",content:`${y}__content`,hasError:`${y}__content--has-error`,selector:`${y}__selector`,options:`${y}__options`,error:`${y}__error`,warning:`${y}__warning`},C={base:`${y}__labeled-slider`};let j=class extends a{constructor(e){super(e),this.debounceDelay=200,this._onChangeTimeout=null,this._onChangeDebounced=e=>{const o=e.target.value;this._cancelChange(),this._onChangeTimeout=setTimeout((()=>this.onChange(o)),this.debounceDelay)},this._cancelChange=()=>{o(this._onChangeTimeout)&&(clearTimeout(this._onChangeTimeout),this._onChangeTimeout=null)}}initialize(){this.own([v((()=>this.onChange),(()=>{this._cancelChange()}))])}render(){const{label:e,disabled:o}=this;return h("div",{class:C.base},h("calcite-label",{scale:"s",disabled:o},e,h("calcite-slider",{"aria-label":e,disabled:this.disabled,max:1,min:0,step:.01,value:this.value,onCalciteSliderInput:this._onChangeDebounced,onCalciteSliderChange:this._onChangeDebounced})))}destroy(){this._cancelChange()}async loadDependencies(){await import("../chunks/calcite-slider.js")}};e([r()],j.prototype,"value",void 0),e([r()],j.prototype,"onChange",void 0),e([r()],j.prototype,"disabled",void 0),e([r()],j.prototype,"debounceDelay",void 0),j=e([i("esri.widgets.Weather.LabeledSlider")],j);let k=class extends b{constructor(){super(...arguments),this.header=!0}};e([r({type:Boolean,nonNullable:!0})],k.prototype,"header",void 0),k=e([i("esri.widgets.Weather.VisibleElements")],k);const _=k,f={sunny:"brightness",cloudy:"partly-cloudy",rainy:"rain",snowy:"snow",foggy:"fog"};let S=class extends a{constructor(e){super(e),this.viewModel=new u,this.headingLevel=4,this.visibleElements=new _,this.iconClass=w.widgetIcon,this.label=void 0,this._renderWeatherTypeButton=e=>{const o=this.viewModel,s=this.messages[e].label,t=o.state===m.Disabled,r=!t&&o.current.type===e;return h("calcite-button",{appearance:r?"solid":"outline","aria-checked":r?"true":"false",color:r?"blue":"neutral",disabled:t,"icon-start":f[e],key:`${e}-type-button`,label:s,role:"radio",scale:"l",title:s,onclick:()=>{r||o.setWeatherByType(e)}})},this._memoizedCallbacks=s((e=>({onCloudCoverChange:o=>{"cloudCover"in e&&(e.cloudCover=o)},onPrecipitationChange:o=>{"precipitation"in e&&(e.precipitation=o)},onFogStrengthChange:o=>{"fogStrength"in e&&(e.fogStrength=o)},onSnowCoverChange:e=>{this.viewModel.setSnowCoverEnabled(e.target.checked)}})))}render(){const e=this.viewModel.state===m.Disabled;return h("div",{class:this.classes(w.base,w.esriWidget,e&&w.esriWidgetDisabled),role:"region","aria-label":this.messages.widgetLabelAccessible},this._renderContent())}async loadDependencies(){await Promise.all([import("../chunks/calcite-button.js"),import("../chunks/calcite-checkbox.js"),import("../chunks/calcite-icon.js"),import("../chunks/calcite-label.js"),import("../chunks/calcite-slider.js")])}get view(){return this.viewModel?.view}set view(e){this.viewModel&&(this.viewModel.view=e)}get _errorMessage(){const e=this.messages.error;switch(this.viewModel.error){case g.LocalScene:return e.localScene;case g.NoAtmosphere:return e.noAtmosphere;case g.UnsupportedView:return e.unsupported;default:return null}}get _warningMessage(){return this.viewModel.error===g.NotVisible&&o(this.view)&&"3d"===this.view?.type&&this.view.environment.atmosphereEnabled?this.messages.error.notVisible:null}_renderContent(){const e=this.messages,s=this._warningMessage,t=this.viewModel.state===m.Error;return h(p,null,this.visibleElements.header&&h(l,{level:this.headingLevel},e.widgetLabel),t&&h("div",{key:"error",class:w.error},this._errorMessage),h("div",{key:"content",class:c({[w.content]:!0,[w.hasError]:t})},h("div",{class:w.selector,role:"radiogroup","aria-label":e.weatherType},n.map(this._renderWeatherTypeButton)),h("div",{class:w.options},this._renderOptions()),o(s)&&this._renderWarning(s)))}_renderOptions(){const{viewModel:e,messages:o}=this,s=e.state===m.Disabled,t=e.current,r=this._memoizedCallbacks(t);switch(t.type){case"sunny":return h(j,{key:"sunny-cover",disabled:s,label:o.sunny.cloudCover,value:t.cloudCover,onChange:r.onCloudCoverChange});case"cloudy":return h(j,{key:"cloudy-cover",disabled:s,label:o.cloudy.cloudCover,value:t.cloudCover,onChange:r.onCloudCoverChange});case"rainy":return h(p,null,h(j,{key:"rainy-cover",disabled:s,label:o.rainy.cloudCover,value:t.cloudCover,onChange:r.onCloudCoverChange}),h(j,{key:"rainy-precipitation",disabled:s,debounceDelay:0,label:o.rainy.precipitation,value:t.precipitation,onChange:r.onPrecipitationChange}));case"snowy":return h(p,null,h(j,{key:"snowy-cloud-cover",disabled:s,label:o.snowy.cloudCover,value:t.cloudCover,onChange:r.onCloudCoverChange}),h(j,{key:"snowy-precipitation",disabled:s,debounceDelay:0,label:o.snowy.precipitation,value:t.precipitation,onChange:r.onPrecipitationChange}),h("calcite-label",{key:"snow-cover",scale:"s",disabled:s,layout:"inline",title:o.snowy.snowCoverTooltip},h("calcite-checkbox",{checked:"enabled"===t.snowCover,onCalciteCheckboxChange:r.onSnowCoverChange}),o.snowy.snowCover));case"foggy":return h(j,{key:"foggy-cover",disabled:s,debounceDelay:0,label:o.foggy.fogStrength,value:t.fogStrength,onChange:r.onFogStrengthChange})}}_renderWarning(e){return h("div",{key:"warning",class:w.warning},h("calcite-icon",{icon:"exclamation-mark-triangle",scale:"s"}),e)}};e([r()],S.prototype,"viewModel",void 0),e([r()],S.prototype,"view",null),e([r()],S.prototype,"headingLevel",void 0),e([r({type:_,nonNullable:!0})],S.prototype,"visibleElements",void 0),e([r()],S.prototype,"iconClass",void 0),e([t("messages.widgetLabel",{overridable:!0})],S.prototype,"label",void 0),e([r(),d("esri/widgets/Weather/t9n/Weather")],S.prototype,"messages",void 0),e([r()],S.prototype,"_errorMessage",null),e([r()],S.prototype,"_warningMessage",null),S=e([i("esri.widgets.Weather")],S);const W=S;export{W as default};
