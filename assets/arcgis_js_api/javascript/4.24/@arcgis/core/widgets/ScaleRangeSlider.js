/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{substitute as s}from"../intl.js";import{c as t}from"../chunks/domUtils.js";import{o as i,e as l}from"../core/promiseUtils.js";import{HandleOwnerMixin as a}from"../core/HandleOwner.js";import{watch as n,when as r,initial as o}from"../core/reactiveUtils.js";import{property as c}from"../core/accessorSupport/decorators/property.js";import"../core/lang.js";import{cast as u}from"../core/accessorSupport/decorators/cast.js";import{subclass as d}from"../core/accessorSupport/decorators/subclass.js";import m from"./Slider.js";import h from"./Widget.js";import{g as p}from"../chunks/assets.js";import{g as v}from"../chunks/locale.js";import S from"./ScaleRangeSlider/ScaleRanges.js";import _ from"./ScaleRangeSlider/ScaleRangeSliderViewModel.js";import{P as g}from"../chunks/Popover.js";import{a as M}from"../chunks/accessibleHandler.js";import{m as f}from"../chunks/messageBundle.js";import{t as b}from"../chunks/jsxFactory.js";import{i as w,s as y}from"../chunks/widgetUtils.js";import{a as k}from"../chunks/number2.js";import"../chunks/Logger.js";import"../config.js";import"../chunks/object.js";import"../chunks/maybe.js";import"../chunks/string.js";import"../chunks/messages.js";import"../core/Error.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/jsonMap.js";import"../core/Accessor.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/handleUtils.js";import"../chunks/metadata.js";import"../chunks/ArrayPool.js";import"../chunks/tracking.js";import"../chunks/watch.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/ensureType.js";import"../core/Handles.js";import"../core/Collection.js";import"../core/Evented.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../core/accessorSupport/decorators/aliasOf.js";import"./Slider/SliderViewModel.js";import"../core/Promise.js";import"../chunks/uuid.js";import"../chunks/projector.js";import"../chunks/jsxWidgetSupport.js";const x=v().substr(0,2);var j;!function(e){e.ar="ar",e.bg="bg",e.cs="cs",e.da="da",e.de="de",e.el="el",e.en="en",e.es="es",e.et="et",e.fi="fi",e.fr="fr",e.is="is",e.it="it",e.ja="ja",e.ko="ko",e.lt="lt",e.lv="lv",e.nl="nl",e.nn="nn",e.pl="pl",e.pt="pt",e.ro="ro",e.ru="ru",e.sk="sk",e.sv="sv",e.th="th",e.zh="zh"}(j||(j={}));const T={ae:j.en,ar:j.es,at:j.de,au:j.en,be:j.nl,bg:j.bg,bo:j.es,br:j.pt,ca:j.en,ch:j.de,ci:j.fr,cl:j.es,cn:j.zh,co:j.es,cr:j.es,cz:j.cs,de:j.de,dk:j.da,ee:j.et,eg:j.en,es:j.es,fi:j.fi,fr:j.fr,gb:j.en,gl:j.da,gr:j.el,gt:j.es,hk:j.en,id:j.en,ie:j.en,il:j.en,in:j.en,iq:j.ar,is:j.is,it:j.it,jp:j.ja,ke:j.en,kr:j.ko,kw:j.ar,li:j.de,lt:j.lt,lu:j.en,lv:j.lv,ma:j.fr,mg:j.fr,ml:j.fr,mo:j.en,mx:j.es,my:j.en,ni:j.es,nl:j.nl,no:j.nn,nz:j.en,pe:j.es,pl:j.pl,pr:j.es,pt:j.pt,ro:j.ro,ru:j.ru,rw:j.en,se:j.sv,sg:j.en,sk:j.sk,sr:j.nl,sv:j.es,th:j.th,tn:j.fr,tw:j.zh,us:j.en,ve:j.es,vi:j.en,wo:j.en,za:j.en},C=["ar-iq","ar-kw","bg-bg","cs-cz","da-dk","da-gl","de-at","de-ch","de-de","de-li","el-gr","en-ae","en-au","en-ca","en-eg","en-gb","en-hk","en-id","en-ie","en-il","en-in","en-iq","en-ke","en-lu","en-mo","en-my","en-nz","en-rw","en-sg","en-us","en-vi","en-wo","en-za","es-ar","es-bo","es-cl","es-co","es-cr","es-es","es-gt","es-mx","es-ni","es-pe","es-pr","es-sv","es-ve","et-ee","fi-fi","fr-ci","fr-fr","fr-ma","fr-mg","fr-ml","fr-tn","is-is","it-it","ja-jp","ko-kr","lt-lt","lv-lv","nl-be","nl-nl","nl-sr","nn-no","pl-pl","pt-br","pt-pt","ro-ro","ru-ru","sk-sk","sv-se","th-th","zh-cn","zh-tw"];function I(e){e=function(e){return e.toLowerCase()}(e);const s=`${x}-${e}`,t=`${T[e]}-${e}`;return i=C.includes(s)?s:C.includes(t)?t:"en-wo",`url(${p(`esri/widgets/ScaleRangeSlider/images/scalePreview/${i}.jpg`)})`;var i}function R(e){return e<0||e>=25?null:`-${e%5*128}px -${128*Math.floor(e/5)}px`}const E={preview:!0,scaleMenus:{maxScaleMenu:!0,minScaleMenu:!0}},P={maximumFractionDigits:0},N=e=>`1:${k(e,P)}`;let L=class extends(a(h)){constructor(e,s){super(e,s),this._activeMenu=null,this._activeMenuNode=null,this._activeMenuToggleNode=null,this._activeThumb=null,this._customMaxScale=-1,this._customMinScale=-1,this._focusedMenuItemIndex=-1,this._maxScaleMenuPopover=new g({owner:this,placement:"bottom-end",anchorElement:()=>this._activeMenuToggleNode,renderContentFunction:()=>this._maxScaleMenuEnabled?this.renderMaxScaleMenu():null}),this._minScaleMenuPopover=new g({owner:this,placement:"bottom-start",anchorElement:()=>this._activeMenuToggleNode,renderContentFunction:()=>this._minScaleMenuEnabled?this.renderMinScaleMenu():null}),this._previewAutoCloseTimeoutId=null,this._previewPopover=new g({owner:this,placement:"top",anchorElement:()=>0===this._activeThumb?this._minThumbNode:this._maxThumbNode,offset:[0,16],renderContentFunction:this.renderScalePreview}),this._scaleMenuNode=null,this._slider=new m({thumbCreatedFunction:(e,s,t)=>{0===e&&(this._minThumbNode=t),1===e&&(this._maxThumbNode=t),this.own([i(t,"mouseenter",(()=>{const{visibleElements:{preview:s}}=this;this._activeThumb=e,this._previewPopover.open=s,this.scheduleRender()})),i(t,"mouseleave",(()=>{this._previewAutoCloseTimeoutId||(this._activeThumb=null,this._previewPopover.open=!1,this.scheduleRender())}))])}}),this.disabled=!1,this.effectiveMaxScale=null,this.effectiveMinScale=null,this.label=void 0,this.layer=null,this.maxScale=null,this.maxScaleLimit=null,this.messages=null,this.minScale=null,this.minScaleLimit=null,this.region="US",this.view=null,this.viewModel=new _,this.visibleElements=E,this._handleScaleMenuToggleClick=e=>{const s=e.currentTarget,l=s.getAttribute("data-type"),a="menu-closing-click-handle";if(this.handles.remove(a),l===this._activeMenu)return this._setActiveMenu(null),void(this._activeMenuToggleNode=null);this._setActiveMenu(l),this._activeMenuToggleNode=s,this.handles.add(i(document,"mousedown",(e=>{const s=e.target,i=t(s,".esri-scale-range-slider__scale-menu-toggle"),l=i&&i.getAttribute("data-type");i&&l===this._activeMenu||!l&&this._scaleMenuNode&&!this._scaleMenuNode.contains(s)&&(this._setActiveMenu(null),this.handles.remove(a),this.scheduleRender())})),a)},this._afterMenuListCreate=e=>{this._activeMenuNode=e,e.children[0].focus({preventScroll:!0})},this._handleCustomScaleEntry=e=>{this._setScaleFromMenuSelection(e),this._customMaxScale=-1,this._customMinScale=-1},this._handleCustomScaleInputBlur=()=>{"max"===this._activeMenu?this._customMaxScale=-1:this._customMinScale=-1},this._handleCustomScaleInputKeyDown=e=>{const s=e.currentTarget,{handleCustomScaleSelect:t}=s["data-render-props"],{key:i,ctrlKey:l,metaKey:a}=e,{viewModel:{scaleRanges:n}}=this;if("Enter"===i){const i=(e=>{const s=e.replace(/.*\(/,"").replace(/\).*$/,"").replace(/.*:/,"").replace(/[^\d.\s]/g,"");return parseFloat(s)})(s.value);return t(isNaN(i)?-1:n.clampScale(i)),e.preventDefault(),void e.stopPropagation()}i.length>1||l||a||/[:,.\d]/.test(i)||(e.preventDefault(),e.stopPropagation())},this._handleScaleMenuKeyDown=e=>{const s=l(e);if("Escape"===s||"Tab"===s)return this._setActiveMenu(null),void this._activeMenuToggleNode.focus();if("ArrowUp"!==s&&"ArrowDown"!==s)return;const t=this._activeMenuNode.children,i=this._focusedMenuItemIndex,a="ArrowUp"===s?(0===i?t.length:i)-1:(i+1)%t.length;e.preventDefault(),e.stopPropagation(),t[a].focus(),this._focusedMenuItemIndex=a}}initialize(){this.own([n((()=>this.viewModel),(e=>this._slider.viewModel=e?e.sliderViewModel:null),o),n((()=>this._interactive),(e=>{this._slider.disabled=!e,e||this._setActiveMenu(null)}),o),this._slider.on("thumb-drag",(({index:e})=>{const{visibleElements:{preview:s}}=this;this._activeThumb=e,this._previewPopover.open=s,clearTimeout(this._previewAutoCloseTimeoutId),this._previewAutoCloseTimeoutId=setTimeout((()=>{this._previewAutoCloseTimeoutId=null,this._activeThumb=null,this._previewPopover.open=!1,this.scheduleRender()}),250)})),r((()=>!0===this.view?.stationary),(()=>this.scheduleRender()))])}destroy(){this._previewPopover.destroy(),this._previewPopover=null,this._maxScaleMenuPopover.destroy(),this._maxScaleMenuPopover=null,this._minScaleMenuPopover.destroy(),this._minScaleMenuPopover=null,this._slider.destroy(),this._slider=null}get _maxScaleMenuEnabled(){const{scaleMenus:e}=this.visibleElements;return!0===e||"boolean"!=typeof e&&e.maxScaleMenu}get _minScaleMenuEnabled(){const{scaleMenus:e}=this.visibleElements;return!0===e||"boolean"!=typeof e&&e.minScaleMenu}get _interactive(){return"disabled"!==this.get("viewModel.state")&&!this.disabled}castVisibleElements(e){return{...E,...e,scaleMenus:"boolean"==typeof e?.scaleMenus?e.scaleMenus:{...E.scaleMenus,...e?.scaleMenus}}}render(){const{_interactive:e,_slider:s,label:t,messages:i,view:l,viewModel:{scaleRanges:a,state:n}}=this,r=i.scaleRangeLabels[a.findScaleRangeByIndex(s.values[0]).id],o=i.scaleRangeLabels[a.findScaleRangeByIndex(s.values[1]).id];return s.layout=w(this.container)?"horizontal-reversed":"horizontal",b("div",{"aria-label":t,class:this.classes("esri-scale-range-slider","esri-widget",e?null:"esri-disabled")},"ready"===n&&l?this.renderCurrentScaleIndicator():null,s.render(),b("div",{class:"esri-scale-range-slider__scale-menu-container",key:"scale-menu-toggles"},this._minScaleMenuEnabled?this.renderScaleMenuToggle("min",r):null,this._maxScaleMenuEnabled?this.renderScaleMenuToggle("max",o):null))}renderMinScaleMenu(){const{effectiveMaxScale:e,minScaleLimit:s,view:t,viewModel:{scaleRanges:i}}=this,l=t?t.scale:void 0;return this.renderScaleMenu({type:"min",min:s,max:i.findScaleRange(e).minScale,map:l})}renderMaxScaleMenu(){const{effectiveMinScale:e,maxScaleLimit:s,view:t,viewModel:{scaleRanges:i}}=this,l=t?t.scale:void 0;return this.renderScaleMenu({type:"max",min:i.findScaleRange(e).maxScale,max:s,map:l})}renderScalePreview(){const{_activeThumb:e,_slider:s,region:t,viewModel:{scaleRanges:i}}=this,l=0===e?s.values[0]:s.values[1],a=Object.keys(S.RecommendedScales).indexOf(i.findScaleRangeByIndex(l).id),n={backgroundImage:I(t),backgroundPosition:R(a)};return b("div",{class:"esri-scale-range-slider__scale-preview"},b("div",{class:"esri-scale-range-slider__scale-preview-thumbnail",styles:n}))}renderScaleMenu({map:e,min:s,max:t,type:i}){const l=S.fromScaleRange({minScale:s,maxScale:t}),a=this.messages.featuredScaleLabels,n=S.RecommendedScales,r=Object.keys(n).filter((e=>l.contains(n[e]))).map((e=>this.renderScaleMenuItem({scaleLabel:a[e],scaleValue:n[e],valueVisible:"world"!==e,handleNamedScaleSelect:this._handleRecommendedScaleClick}))),{_customMaxScale:o,_customMinScale:c,messages:u}=this,d="max"===i?o:c;return b("div",{bind:this,class:"esri-scale-range-slider__scale-menu","data-type":i,id:`${this.id}__scale-menu--${i}`,key:`${i}-scale-menu`,afterCreate:y,"data-node-ref":"_scaleMenuNode",onkeydown:this._handleScaleMenuKeyDown},b("div",{class:"esri-scale-range-slider__scale-menu-scroller"},b("ul",{class:"esri-scale-range-slider__scale-menu-list",afterCreate:this._afterMenuListCreate},this.renderScaleMenuItem({scaleValue:d,scaleLabel:u.featuredScaleLabels.custom,valueVisible:!1,handleNamedScaleSelect:this._handleScaleSelection,handleCustomScaleSelect:this._handleCustomScaleEntry}),null!=e?this.renderScaleMenuItem({scaleValue:e,scaleLabel:u.featuredScaleLabels.current,valueVisible:!0,handleNamedScaleSelect:this._handleRecommendedScaleClick}):null,r)))}_handleScaleSelection(){"max"===this._activeMenu?this._customMaxScale=this.effectiveMaxScale:this._customMinScale=this.effectiveMinScale}renderScaleMenuToggle(e,s){const{_activeMenu:t,_interactive:i}=this,l=t===e;return b("button",{"aria-controls":l?`${this.id}__scale-menu--${e}`:"","aria-pressed":l?"true":"false",class:this.classes("esri-scale-range-slider__scale-menu-toggle",l?"esri-scale-range-slider__scale-menu-toggle--active":null),"data-type":e,key:`${e}-scale-menu-toggle`,onclick:this._handleScaleMenuToggleClick,disabled:!i,type:"button"},b("div",{class:"esri-scale-range-slider__scale-menu-toggle-text","aria-label":s,title:s},s),b("span",{class:this.classes("esri-scale-range-slider__scale-menu-toggle-icon","esri-icon-down"),"aria-hidden":"true"}))}renderScaleMenuItem(e){const{scaleValue:s,scaleLabel:t,valueVisible:i,handleNamedScaleSelect:l,handleCustomScaleSelect:a=null}=e,{id:n}=this,r=`${n}__custom-scale-input`;return b("li",{bind:this,class:"esri-scale-range-slider__scale-menu-item","data-scale":s,key:t,onclick:l,onkeydown:l,tabIndex:-1},b("label",{class:"esri-scale-range-slider__scale-item-label",for:r},t),s>-1?a?b("input",{afterCreate:this._focusAndSelectInputOnCreate,class:this.classes("esri-scale-range-slider__scale-item-value","esri-scale-range-slider__scale-item-value--editable"),"data-render-props":e,id:r,key:"value",value:N(s),onkeydown:this._handleCustomScaleInputKeyDown,onblur:this._handleCustomScaleInputBlur}):i?b("div",{class:"esri-scale-range-slider__scale-item-value",key:"value"},N(s)):null:null)}_focusAndSelectInputOnCreate(e){e.focus(),e.select()}renderCurrentScaleIndicator(){const{_slider:e,messages:t,view:i,viewModel:{scaleRanges:l}}=this,a=l.clampScale(i.scale),n=this.viewModel.mapScaleToSlider(a),r=n/e.max,o=t.scaleRangeLabels[l.findScaleRangeByIndex(n).id],c=s(t.currentScaleTooltip,{scaleLabel:o});return b("div",{class:"esri-scale-range-slider__scale-indicator-container",key:"scale-indicator"},b("div",{"aria-label":c,class:"esri-scale-range-slider__scale-indicator",styles:{left:(w(this.container)?-1:1)*r*100+"%"},title:c},this.renderCurrentScaleIndicatorIcon()))}renderCurrentScaleIndicatorIcon(){return b("svg",{class:"esri-scale-range-slider__scale-indicator-icon",height:"8",width:"8",viewBox:"0 0 8 8",version:"1.1",xmlns:"http://www.w3.org/2000/svg"},b("polygon",{points:"4 0 8 8 0 8"}))}_handleRecommendedScaleClick(e){const s=e.currentTarget,t=Number(s["data-scale"]);this._setScaleFromMenuSelection(t)}_setScaleFromMenuSelection(e){"max"===this._activeMenu?this.maxScale=Math.min(e,this.effectiveMinScale-1):this.minScale=Math.max(e,this.effectiveMaxScale+1),this._setActiveMenu(null),this._activeMenuToggleNode.focus()}_setActiveMenu(e){this._activeMenu=e,this._maxScaleMenuPopover.open="max"===e,this._minScaleMenuPopover.open="min"===e,this._focusedMenuItemIndex=e?0:-1}};e([c()],L.prototype,"_maxScaleMenuEnabled",null),e([c()],L.prototype,"_minScaleMenuEnabled",null),e([c()],L.prototype,"_slider",void 0),e([c({readOnly:!0})],L.prototype,"_interactive",null),e([c()],L.prototype,"disabled",void 0),e([c({aliasOf:"viewModel.effectiveMaxScale"})],L.prototype,"effectiveMaxScale",void 0),e([c({aliasOf:"viewModel.effectiveMinScale"})],L.prototype,"effectiveMinScale",void 0),e([c({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],L.prototype,"label",void 0),e([c({aliasOf:"viewModel.layer"})],L.prototype,"layer",void 0),e([c({aliasOf:"viewModel.maxScale"})],L.prototype,"maxScale",void 0),e([c({aliasOf:"viewModel.maxScaleLimit"})],L.prototype,"maxScaleLimit",void 0),e([c(),f("esri/widgets/ScaleRangeSlider/t9n/ScaleRangeSlider")],L.prototype,"messages",void 0),e([c({aliasOf:"viewModel.minScale"})],L.prototype,"minScale",void 0),e([c({aliasOf:"viewModel.minScaleLimit"})],L.prototype,"minScaleLimit",void 0),e([c()],L.prototype,"region",void 0),e([c({aliasOf:"viewModel.view"})],L.prototype,"view",void 0),e([c()],L.prototype,"viewModel",void 0),e([c()],L.prototype,"visibleElements",void 0),e([u("visibleElements")],L.prototype,"castVisibleElements",null),e([M()],L.prototype,"_handleScaleSelection",null),e([M()],L.prototype,"_handleRecommendedScaleClick",null),L=e([d("esri.widgets.ScaleRangeSlider")],L);const A=L;export{A as default};
