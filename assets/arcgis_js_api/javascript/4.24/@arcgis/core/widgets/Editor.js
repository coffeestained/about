/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.24/esri/copyright.txt for details.
*/
import{_ as e}from"../chunks/tslib.es6.js";import{substitute as t}from"../intl.js";import{HandleOwnerMixin as s}from"../core/HandleOwner.js";import{L as r}from"../chunks/Logger.js";import{i}from"../chunks/maybe.js";import{watch as o,on as a,when as n,initial as l}from"../core/reactiveUtils.js";import{aliasOf as p}from"../core/accessorSupport/decorators/aliasOf.js";import"../core/lang.js";import{cast as m}from"../core/accessorSupport/decorators/cast.js";import{property as c}from"../core/accessorSupport/decorators/property.js";import{subclass as d}from"../core/accessorSupport/decorators/subclass.js";import{getDisplayFieldName as u}from"../layers/support/fieldUtils.js";import h from"../views/interactive/sketch/SketchLabelOptions.js";import j from"../views/interactive/sketch/SketchTooltipOptions.js";import k from"../views/interactive/snapping/SnappingOptions.js";import g from"./Attachments.js";import y from"./FeatureForm.js";import f,{I as v}from"./FeatureTemplates.js";import{S as w}from"./Popup.js";import b from"./Widget.js";import _,{w as C}from"./Editor/EditorViewModel.js";import{H as F,i as M}from"../chunks/Heading.js";import S from"./support/SnappingControls.js";import{a as A}from"../chunks/accessibleHandler.js";import{m as U}from"../chunks/messageBundle.js";import{v as L}from"../chunks/vmEvent.js";import{t as T}from"../chunks/jsxFactory.js";import{c as E}from"../chunks/widgetUtils.js";import"../chunks/number2.js";import"../chunks/jsonMap.js";import"../chunks/object.js";import"../chunks/locale.js";import"../chunks/string.js";import"../chunks/messages.js";import"../core/Error.js";import"../config.js";import"../core/promiseUtils.js";import"../request.js";import"../kernel.js";import"../core/urlUtils.js";import"../chunks/assets.js";import"../core/Accessor.js";import"../chunks/get.js";import"../chunks/utils.js";import"../chunks/handleUtils.js";import"../chunks/metadata.js";import"../chunks/ArrayPool.js";import"../chunks/tracking.js";import"../chunks/watch.js";import"../core/scheduling.js";import"../chunks/nextTick.js";import"../chunks/ensureType.js";import"../core/Handles.js";import"../core/Collection.js";import"../core/Evented.js";import"../chunks/shared.js";import"../chunks/SimpleObservable.js";import"../chunks/arcadeOnDemand.js";import"../geometry.js";import"../geometry/Extent.js";import"../geometry/Geometry.js";import"../core/JSONSupport.js";import"../chunks/reader.js";import"../geometry/SpatialReference.js";import"../chunks/writer.js";import"../geometry/Point.js";import"../geometry/support/webMercatorUtils.js";import"../chunks/Ellipsoid.js";import"../geometry/Multipoint.js";import"../chunks/zmUtils.js";import"../geometry/Polygon.js";import"../chunks/extentUtils.js";import"../geometry/Polyline.js";import"../chunks/typeUtils.js";import"../geometry/support/jsonUtils.js";import"../views/interactive/snapping/FeatureSnappingLayerSource.js";import"../chunks/Settings2.js";import"../Color.js";import"../chunks/colorUtils.js";import"../chunks/mathUtils.js";import"../chunks/common.js";import"../chunks/unitFormatUtils.js";import"../chunks/byteSizeEstimations.js";import"../chunks/Cyclical.js";import"../chunks/unitUtils.js";import"../chunks/projectionEllipsoid.js";import"./Attachments/AttachmentsViewModel.js";import"../Graphic.js";import"../PopupTemplate.js";import"../popup/content.js";import"../popup/content/AttachmentsContent.js";import"../popup/content/Content.js";import"../popup/content/CustomContent.js";import"../popup/content/ExpressionContent.js";import"../popup/ElementExpressionInfo.js";import"../popup/content/FieldsContent.js";import"../popup/FieldInfo.js";import"../chunks/enumeration.js";import"../popup/support/FieldInfoFormat.js";import"../chunks/date.js";import"../popup/content/MediaContent.js";import"../popup/content/BarChartMediaInfo.js";import"../popup/content/mixins/ChartMediaInfo.js";import"../popup/content/mixins/MediaInfo.js";import"../popup/content/support/ChartMediaInfoValue.js";import"../popup/content/support/ChartMediaInfoValueSeries.js";import"../chunks/chartMediaInfoUtils.js";import"../popup/content/ColumnChartMediaInfo.js";import"../popup/content/ImageMediaInfo.js";import"../popup/content/support/ImageMediaInfoValue.js";import"../popup/content/LineChartMediaInfo.js";import"../popup/content/PieChartMediaInfo.js";import"../popup/content/TextContent.js";import"../popup/ExpressionInfo.js";import"../popup/LayerOptions.js";import"../popup/RelatedRecordsInfo.js";import"../popup/support/RelatedRecordsInfoFieldOrder.js";import"../support/actions/ActionBase.js";import"../chunks/Identifiable.js";import"../support/actions/ActionButton.js";import"../support/actions/ActionToggle.js";import"../symbols.js";import"../symbols/CIMSymbol.js";import"../symbols/Symbol.js";import"../symbols/ExtrudeSymbol3DLayer.js";import"../symbols/Symbol3DLayer.js";import"../chunks/utils2.js";import"../symbols/edges/Edges3D.js";import"../chunks/screenUtils.js";import"../chunks/materialUtils.js";import"../chunks/opacityUtils.js";import"../symbols/edges/SketchEdges3D.js";import"../symbols/edges/SolidEdges3D.js";import"../chunks/Symbol3DMaterial.js";import"../symbols/FillSymbol.js";import"../symbols/SimpleLineSymbol.js";import"../symbols/LineSymbol.js";import"../symbols/LineSymbolMarker.js";import"../chunks/lineMarkers.js";import"../symbols/FillSymbol3DLayer.js";import"../symbols/patterns/LineStylePattern3D.js";import"../symbols/patterns/StylePattern3D.js";import"../chunks/utils3.js";import"../chunks/colors.js";import"../chunks/symbolLayerUtils3D.js";import"../chunks/aaBoundingBox.js";import"../chunks/aaBoundingRect.js";import"../symbols/Font.js";import"../symbols/IconSymbol3DLayer.js";import"../chunks/persistableUrlUtils.js";import"../symbols/LabelSymbol3D.js";import"../symbols/Symbol3D.js";import"../chunks/collectionUtils.js";import"../portal/Portal.js";import"../core/Loadable.js";import"../core/Promise.js";import"../portal/PortalQueryParams.js";import"../portal/PortalQueryResult.js";import"../portal/PortalUser.js";import"../portal/PortalFolder.js";import"../portal/PortalGroup.js";import"../symbols/LineSymbol3DLayer.js";import"../symbols/LineStyleMarker3D.js";import"../core/Clonable.js";import"../symbols/ObjectSymbol3DLayer.js";import"../symbols/PathSymbol3DLayer.js";import"../symbols/TextSymbol3DLayer.js";import"../symbols/WaterSymbol3DLayer.js";import"../chunks/Thumbnail.js";import"../chunks/Symbol3DVerticalOffset.js";import"../symbols/callouts/Callout3D.js";import"../symbols/callouts/LineCallout3D.js";import"../symbols/LineSymbol3D.js";import"../symbols/MarkerSymbol.js";import"../symbols/MeshSymbol3D.js";import"../symbols/PictureFillSymbol.js";import"../chunks/urlUtils.js";import"../symbols/PictureMarkerSymbol.js";import"../symbols/PointSymbol3D.js";import"../symbols/PolygonSymbol3D.js";import"../symbols/SimpleFillSymbol.js";import"../symbols/SimpleMarkerSymbol.js";import"../symbols/TextSymbol.js";import"../symbols/WebStyleSymbol.js";import"../rest/query/support/AttachmentInfo.js";import"../rest/support/AttachmentQuery.js";import"../chunks/domUtils.js";import"../chunks/uuid.js";import"../chunks/projector.js";import"../chunks/jsxWidgetSupport.js";import"../chunks/compilerUtils.js";import"./FeatureForm/FeatureFormViewModel.js";import"../form/FormTemplate.js";import"../form/ExpressionInfo.js";import"../form/elements/GroupElement.js";import"../form/elements/Element.js";import"../form/support/elements.js";import"../form/elements/FieldElement.js";import"../form/elements/support/inputs.js";import"../form/elements/inputs/BarcodeScannerInput.js";import"../form/elements/inputs/TextInput.js";import"../form/elements/inputs/Input.js";import"../form/elements/inputs/ComboBoxInput.js";import"../form/elements/inputs/DateTimePickerInput.js";import"../form/elements/inputs/RadioButtonsInput.js";import"../form/elements/inputs/SwitchInput.js";import"../form/elements/inputs/TextAreaInput.js";import"../form/elements/inputs/TextBoxInput.js";import"../chunks/domains.js";import"../layers/support/CodedValueDomain.js";import"../layers/support/Domain.js";import"../layers/support/InheritedDomain.js";import"../layers/support/RangeDomain.js";import"../chunks/arcgisLayerUrl.js";import"./FeatureForm/InputField.js";import"./FeatureForm/InputFieldGroup.js";import"../chunks/datetime.js";import"./FeatureTemplates/FeatureTemplatesViewModel.js";import"./FeatureTemplates/TemplateItem.js";import"../symbols/support/symbolUtils.js";import"../chunks/utils6.js";import"../chunks/asyncUtils.js";import"../chunks/jsonUtils.js";import"../chunks/parser2.js";import"../chunks/mat4f32.js";import"../chunks/mat4.js";import"../chunks/_commonjsHelpers.js";import"../chunks/ItemCache.js";import"../chunks/MemCache.js";import"../symbols/support/cimSymbolUtils.js";import"../chunks/utils7.js";import"../chunks/colorUtils2.js";import"../chunks/mat2df32.js";import"./FeatureTemplates/TemplateItemGroup.js";import"../chunks/throttle.js";import"./Feature.js";import"./Feature/FeatureViewModel.js";import"../chunks/languageUtils.js";import"../chunks/number.js";import"../layers/support/Field.js";import"../chunks/fieldType.js";import"../chunks/DataLayerSource.js";import"../chunks/executeQueryJSON.js";import"../chunks/utils5.js";import"../chunks/query.js";import"../geometry/support/normalizeUtils.js";import"../chunks/normalizeUtilsCommon.js";import"../chunks/pbfQueryUtils.js";import"../chunks/pbf.js";import"../chunks/OptimizedGeometry.js";import"../chunks/OptimizedFeatureSet.js";import"../chunks/queryZScale.js";import"../chunks/zscale.js";import"../rest/support/FeatureSet.js";import"../rest/support/Query.js";import"../TimeExtent.js";import"../chunks/timeUtils.js";import"../rest/support/StatisticDefinition.js";import"../chunks/featureConversionUtils.js";import"../rest/support/RelationshipQuery.js";import"../rest/support/TopFeaturesQuery.js";import"../rest/support/TopFilter.js";import"../layers/FeatureLayer.js";import"../renderers/ClassBreaksRenderer.js";import"../renderers/Renderer.js";import"../renderers/support/AuthoringInfo.js";import"../renderers/support/AuthoringInfoVisualVariable.js";import"../chunks/colorRamps.js";import"../rest/support/AlgorithmicColorRamp.js";import"../rest/support/ColorRamp.js";import"../rest/support/MultipartColorRamp.js";import"../renderers/mixins/VisualVariablesMixin.js";import"../renderers/visualVariables/ColorVariable.js";import"../renderers/visualVariables/VisualVariable.js";import"../chunks/LegendOptions.js";import"../renderers/visualVariables/support/ColorStop.js";import"../renderers/visualVariables/OpacityVariable.js";import"../renderers/visualVariables/support/OpacityStop.js";import"../renderers/visualVariables/RotationVariable.js";import"../renderers/visualVariables/SizeVariable.js";import"../renderers/visualVariables/support/SizeStop.js";import"../chunks/sizeVariableUtils.js";import"../chunks/visualVariableUtils.js";import"../chunks/lengthUtils.js";import"../renderers/support/ClassBreakInfo.js";import"../chunks/commonProperties2.js";import"../symbols/support/jsonUtils.js";import"../chunks/symbolConversion.js";import"../renderers/DictionaryRenderer.js";import"../chunks/DictionaryLoader.js";import"../chunks/LRUCache.js";import"../renderers/DotDensityRenderer.js";import"../renderers/support/AttributeColorInfo.js";import"../renderers/HeatmapRenderer.js";import"../renderers/support/HeatmapColorStop.js";import"../chunks/heatmapUtils.js";import"../chunks/vec4f64.js";import"../renderers/PieChartRenderer.js";import"../renderers/SimpleRenderer.js";import"../renderers/UniqueValueRenderer.js";import"../chunks/diffUtils.js";import"../renderers/support/UniqueValueInfo.js";import"../chunks/styleUtils2.js";import"../renderers/support/jsonUtils.js";import"../chunks/MultiOriginJSONSupport.js";import"../core/sql.js";import"../geometry/HeightModelInfo.js";import"../layers/Layer.js";import"../chunks/FeatureIndex.js";import"../core/workers/workers.js";import"../core/workers/Connection.js";import"../chunks/Queue.js";import"../core/workers/RemoteClient.js";import"../layers/mixins/APIKeyMixin.js";import"../chunks/ArcGISService.js";import"../layers/mixins/BlendLayer.js";import"../layers/mixins/CustomParametersMixin.js";import"../layers/mixins/FeatureEffectLayer.js";import"../layers/support/FeatureEffect.js";import"../layers/support/FeatureFilter.js";import"../chunks/OperationalLayer.js";import"../chunks/commonProperties.js";import"../support/timeUtils.js";import"../chunks/ElevationInfo.js";import"../chunks/unitConversionUtils.js";import"../layers/mixins/OrderedLayer.js";import"../layers/mixins/PortalLayer.js";import"../portal/PortalItem.js";import"../portal/PortalItemResource.js";import"../portal/PortalRating.js";import"../layers/mixins/RefreshableLayer.js";import"../layers/mixins/ScaleRangeLayer.js";import"../layers/mixins/TemporalLayer.js";import"../TimeInterval.js";import"../layers/support/TimeInfo.js";import"../layers/support/TimeReference.js";import"../chunks/featureReductionUtils.js";import"../chunks/FeatureReduction.js";import"../layers/support/FeatureReductionBinning.js";import"../layers/support/AggregateField.js";import"../layers/support/OutStatistic.js";import"../layers/support/LabelClass.js";import"../chunks/labelUtils.js";import"../chunks/defaultsJSON.js";import"../layers/support/FeatureReductionCluster.js";import"../layers/support/FeatureReductionSelection.js";import"../layers/support/FeatureTemplate.js";import"../layers/support/FeatureType.js";import"../chunks/fieldProperties.js";import"../layers/support/FieldsIndex.js";import"../layers/support/GeometryFieldsInfo.js";import"../chunks/labelingInfo.js";import"../layers/support/LayerFloorInfo.js";import"../layers/support/Relationship.js";import"../chunks/versionUtils.js";import"../chunks/styleUtils.js";import"../support/popupUtils.js";import"./support/widget.js";import"../chunks/themeUtils.js";import"../chunks/utils13.js";import"../chunks/numberUtils.js";import"./Spinner/SpinnerViewModel.js";import"../chunks/AnchorElementViewModel.js";import"./Popup/PopupViewModel.js";import"../chunks/InputManager.js";import"../chunks/layerViewUtils.js";import"../chunks/actions.js";import"./support/GoTo.js";import"../layers/GraphicsLayer.js";import"../chunks/GraphicsCollection.js";import"./Editor/CreateFeaturesWorkflow.js";import"./Editor/CreateFeaturesWorkflowData.js";import"./Editor/Workflow.js";import"../chunks/workflowUtils.js";import"../chunks/drapedUtils.js";import"../chunks/GraphicState.js";import"../chunks/hitTestSelectUtils.js";import"./Editor/CreateWorkflow.js";import"./Editor/CreateWorkflowData.js";import"./Editor/Edits.js";import"./Editor/UpdateWorkflow.js";import"./Editor/UpdateWorkflowData.js";import"./Sketch/SketchViewModel.js";import"../geometry/projection.js";import"../chunks/pe.js";import"../chunks/geodesicConstants.js";import"../geometry/support/GeographicTransformation.js";import"../geometry/support/GeographicTransformationStep.js";import"../views/DOMContainer.js";import"../chunks/elevationInfoUtils.js";import"../geometry/Circle.js";import"../geometry/support/geodesicUtils.js";import"../chunks/keybindings.js";import"../chunks/SnappingManager.js";import"../chunks/vec2.js";import"../chunks/QueryEngineResult.js";import"../chunks/quantizationUtils.js";import"../core/sql/WhereClause.js";import"../chunks/utils11.js";import"../chunks/generateRendererUtils.js";import"../chunks/projectionSupport.js";import"../chunks/json.js";import"../chunks/utils18.js";import"../chunks/vec2f64.js";import"../chunks/RightAngleSnappingHint.js";import"../chunks/geometry2dUtils.js";import"../chunks/viewUtils.js";import"../chunks/screenUtils2.js";import"./support/SnappingControls/SnappingControlsViewModel.js";import"../chunks/layerListUtils.js";import"./LayerList/LayerListViewModel.js";import"./LayerList/ListItem.js";import"../chunks/ActionSlider.js";import"./LayerList/ListItemPanel.js";const W="esri-editor esri-widget esri-widget--panel",P=E("esri-editor__scroller","esri-editor__panel-content"),I={undoRedoButtons:!1};function V(e){e.focus()}const x=r.getLogger("esri.widgets.Editor");let D=class extends(s(b)){constructor(e,t){super(e,t),this._candidateCommitted=!1,this._featureForm=new y,this._stateStack=[],this._attachments=new g({visibleElements:{addSubmitButton:!1,cancelAddButton:!1,cancelUpdateButton:!1,deleteButton:!1,errorMessage:!1,progressBar:!1,updateButton:!1}}),this._featureTemplates=new f({enableListScroll:!1}),this._filterText="",this._prompt=null,this._spinner=new w,this._snappingPopover=null,this.activeWorkflow=null,this.allowedWorkflows=null,this.useDeprecatedCreateWorkflow=!1,this.headingLevel=4,this.iconClass="esri-icon-edit",this.label=void 0,this.labelOptions=new h,this.layerInfos=null,this.messages=null,this.messagesCommon=null,this.messagesTemplates=null,this.snappingOptions=new k,this.tooltipOptions=new j,this.supportingWidgetDefaults=null,this.view=null,this.viewModel=new _,this.visibleElements={...I},this._setCandidateFeature=(e,t=!1)=>{if(this._candidateCommitted)return;const s=this._assertActiveUpdateWorkflow();s.data.edits.feature=e,t&&(s.next(),this._candidateCommitted=!0)},this._handleSave=this._handleSave.bind(this),this._handleBack=this._handleBack.bind(this),this._handleDone=this._handleDone.bind(this),this._handleDelete=this._handleDelete.bind(this),this._handleAdd=this._handleAdd.bind(this),this._handleEdit=this._handleEdit.bind(this),this._handleAttachmentAdd=this._handleAttachmentAdd.bind(this),this._handleAttachmentUpdate=this._handleAttachmentUpdate.bind(this),this._handleAttachmentDelete=this._handleAttachmentDelete.bind(this),this.EditorPanel=this.EditorPanel.bind(this)}initialize(){const{view:e,snappingOptions:s}=this;this._snappingControls=new S({snappingOptions:s,view:e,visibleElements:{header:!1}}),this.own([o((()=>this.headingLevel),(e=>{this._featureForm.headingLevel=M(e),this._featureTemplates.headingLevel=M(e)}),l),this.viewModel.featureTemplatesViewModel.on("select",(({item:e})=>this.useDeprecatedCreateWorkflow?this.startCreateWorkflowAtFeatureCreation(e):this.startCreateFeaturesWorkflowAtFeatureCreation(e))),o((()=>this.viewModel.state),((e,t)=>{const s=this._stateStack.indexOf(e);-1===s?this._stateStack.push(t):this._stateStack.splice(s)})),o((()=>this.viewModel),(e=>{this._featureForm.viewModel=e?e.featureFormViewModel:null,this._attachments.viewModel=e?e.attachmentsViewModel:null,this._featureTemplates.viewModel=e?e.featureTemplatesViewModel:null,this._spinner.viewModel=e?e.spinnerViewModel:null}),l),o((()=>this.view),((e,t)=>{const s=`editor-${this.id}-spinner`;t&&t.ui.remove(this._spinner,s),e&&e.ui.add(this._spinner,{key:s,position:"manual"})}),l),a((()=>this.viewModel?.sketchViewModel),"create",(()=>{this.scheduleRender()})),a((()=>this.viewModel?.activeWorkflow),"cancel-request",(({controller:e})=>{const{messages:t,messagesCommon:s}=this;this._prompt={title:t.cancelRequestTitle,message:t.cancelRequestWarningMessage,context:"danger",actions:{primary:{label:s.form.yes,action:()=>{e.allow(),this._prompt=null}},secondary:{label:s.form.no,action:()=>(e.deny(),this._prompt=null)}}},this.scheduleRender()})),o((()=>this.supportingWidgetDefaults),(e=>{e&&(this._featureForm.set(e.featureForm),this._attachments.set(e.attachments),this._featureTemplates.set(e.featureTemplates),this.viewModel.sketchViewModel.set(e.sketch))}),l),o((()=>this._attachments?.error),(e=>{if(!e)return;const{messages:t,messagesCommon:s}=this;this._prompt={title:t.errorWarningTitle,message:e.message,context:"warning",actions:{primary:{label:s.form.ok,action:()=>{this._prompt=null}}}}})),o((()=>this.viewModel?.failures),(e=>{if(!e)return;const{messages:s}=this,[{error:r,retry:i,cancel:o}]=e;this._prompt={title:s.errorWarningTitle,message:t(s.errorWarningMessageTemplate,{errorMessage:r.message}),context:"warning",actions:{primary:{label:s.retry,action:()=>{i(),this._prompt=null}},secondary:{label:s.ignore,action:()=>(o(),this._prompt=null)}}}})),o((()=>this.viewModel?.state),(e=>{"awaiting-feature-to-update"===e&&(this._filterText=""),"awaiting-update-feature-candidate"===e&&(this._candidateCommitted=!1)})),o((()=>[this._attachments?.selectedFile,this._attachments?.submitting]),(()=>this.scheduleRender())),n((()=>!this.viewModel?.activeWorkflow),(()=>this._featureTemplates.filterText="")),a((()=>this.view),"key-down",(e=>{"Escape"===e.key&&this.viewModel?.activeWorkflow&&this._handleBack()}))])}destroy(){this._attachments.destroy(),this._featureForm.destroy(),this._featureTemplates.destroy(),this._snappingControls.destroy()}loadDependencies(){return Promise.all([import("../chunks/calcite-action.js"),import("../chunks/calcite-action-menu.js"),import("../chunks/calcite-button.js"),import("../chunks/calcite-flow.js"),import("../chunks/calcite-icon.js"),import("../chunks/calcite-loader.js"),import("../chunks/calcite-panel.js"),import("../chunks/calcite-popover.js"),import("../chunks/calcite-scrim.js")])}castVisibleElements(e){return{...I,...e}}startCreateWorkflowAtFeatureTypeSelection(){return C(x,"startCreateWorkflowAtFeatureTypeSelection","startCreateFeaturesWorkflowAtFeatureTypeSelection"),this.viewModel.startCreateWorkflowAtFeatureTypeSelection()}startCreateFeaturesWorkflowAtFeatureTypeSelection(){return this.viewModel.startCreateFeaturesWorkflowAtFeatureTypeSelection()}startCreateWorkflowAtFeatureCreation(e){return C(x,"startCreateWorkflowAtFeatureCreation","startCreateFeaturesWorkflowAtFeatureCreation"),this.viewModel.startCreateWorkflowAtFeatureCreation(e)}startCreateFeaturesWorkflowAtFeatureCreation(e){return this.viewModel.startCreateFeaturesWorkflowAtFeatureCreation(e)}startCreateWorkflowAtFeatureEdit(e){return C(x,"startCreateWorkflowAtFeatureEdit"),this.viewModel.startCreateWorkflowAtFeatureEdit(e)}startUpdateWorkflowAtFeatureSelection(){return this.viewModel.startUpdateWorkflowAtFeatureSelection()}startUpdateWorkflowAtMultipleFeatureSelection(e){return this.viewModel.startUpdateWorkflowAtMultipleFeatureSelection(e)}startUpdateWorkflowAtFeatureEdit(e){return this.viewModel.startUpdateWorkflowAtFeatureEdit(e)}deleteFeatureFromWorkflow(){return this.viewModel.deleteFeatureFromWorkflow()}cancelWorkflow(e){return this.viewModel.cancelWorkflow(e)}render(){const{_attachments:e,_prompt:t,viewModel:s}=this;if(!s)return T("div",{class:W});const{state:r}=s,o=i(t)?T("calcite-scrim",null,this.renderPrompt(t)):null;return T("div",{class:W},s.syncing||e.submitting?this.renderProgressBar():null,T("calcite-flow",null,this._stateStack.map((e=>this.renderState(e))),this.renderState(r)),o)}renderState(e){switch(e){case"disabled":break;case"ready":return this.renderLanding(e);case"awaiting-feature-creation-info":return this.renderTemplates(e);case"creating-features":case"editing-new-feature":case"editing-existing-feature":return this.renderAttributeEditing(e);case"awaiting-feature-to-update":return this.renderFeatureUpdating(e);case"awaiting-update-feature-candidate":return this.renderFeatureList(e);case"awaiting-feature-to-create":return this.renderFeatureCreation(e);case"adding-attachment":return this.renderAttachmentAdding(e);case"editing-attachment":return this.renderAttachmentEditing(e)}return T("div",null)}isPanelActive(e){return this.viewModel.state===e}renderTemplates(e){const{EditorPanel:t,headingLevel:s,messages:r,messagesCommon:i,_handleBack:o,_snappingControls:a,viewModel:{sketchViewModel:n}}=this;return T(t,{active:this.isPanelActive(e),key:"templates-panel",handleBack:o,heading:r.selectTemplate,headingLevel:s,messages:r,messagesCommon:i,sketchViewModel:n,snappingControls:a},T("div",{class:P},this._featureTemplates.render()))}renderAttributeEditing(e){const{activeWorkflow:s,EditorPanel:r,messages:i,messagesCommon:o,headingLevel:a,_handleBack:n,_snappingControls:l,viewModel:p}=this,{sketchViewModel:m}=p,c=p.featureFormViewModel;if("create-features"===s.type&&s.pendingFeatures.length<1)return this.renderFeatureCreation(e);const d="update"===s.type&&!s.data.edits.modified||p.syncing,u="update"===s.type?i.editFeature:i.createFeatures,h="update"===s.type?o.update:o.create,j="create-features"===s.type&&"create-new"===s.createFeatureState,k="update"===s.type&&s.data.editableItem.supports.includes("delete"),g="update"===s.type&&s.data.editableItem.hasAttachments,y=[{label:"create-features"===s.type&&s.numPendingFeatures>1?t(i.createFeaturesTemplate,{numFeatures:s.numPendingFeatures}):h,type:"primary",disabled:d,clickHandler:this._handleSave,width:k?"half":"full"}];k&&y.push({label:o.delete,type:"tertiary",clickHandler:this._handleDelete,appearance:"outline",width:"half"});const f=c.inputFields.every((e=>!e.visible))?this.renderMessage(t(i.clickToFinishTemplate,{button:h})):T("div",{class:"esri-editor__panel-content__section"},T("div",{class:"esri-editor__panel-content__section__group"},this._featureForm.render(),g?T("div",{key:"attachments"},T("div",null,i.attachments),this._attachments.render()):null));return T(r,{active:this.isPanelActive(e),key:"attribute-editing-panel",heading:u,headingLevel:a,handleBack:n,messages:i,messagesCommon:o,sketchViewModel:m,snappingControls:l},T("div",{class:P},f,j?T("calcite-scrim",null):null),this.renderFooterActions(y))}renderAttachmentAdding(e){const{_attachments:t,EditorPanel:s,_handleBack:r,headingLevel:i,messages:o,messagesCommon:a,_snappingControls:n,viewModel:{sketchViewModel:l}}=this,p=[{label:t.submitting?a.cancel:a.add,disabled:t.submitting||!t.selectedFile,type:"primary",clickHandler:this._handleAttachmentAdd,width:"full"}];return T(s,{active:this.isPanelActive(e),key:"attachment-adding-panel",heading:o.addAttachment,headingLevel:i,handleBack:r,messages:o,messagesCommon:a,sketchViewModel:l,snappingControls:n},T("div",{class:P},t.render()),this.renderFooterActions(p))}renderAttachmentEditing(e){const{_attachments:t,EditorPanel:s,_handleBack:r,headingLevel:i,messages:o,messagesCommon:a,_snappingControls:n,viewModel:{sketchViewModel:l}}=this,p=[{label:a.update,disabled:t.submitting||!t.selectedFile,type:"primary",clickHandler:this._handleAttachmentUpdate,width:"half"},{label:a.delete,disabled:t.submitting,type:"tertiary",clickHandler:this._handleAttachmentDelete,width:"half",appearance:"outline"}];return T(s,{active:this.isPanelActive(e),key:"attachment-editing-panel",heading:o.editAttachment,headingLevel:i,handleBack:r,messages:o,messagesCommon:a,sketchViewModel:l,snappingControls:n},T("div",{class:P},t.render()),this.renderFooterActions(p))}renderFeatureUpdating(e){const{EditorPanel:t,_handleBack:s,headingLevel:r,messages:i,messagesCommon:o,_snappingControls:a,viewModel:{sketchViewModel:n}}=this;return T(t,{active:this.isPanelActive(e),key:"feature-updating-panel",heading:i.selectFeature,headingLevel:r,handleBack:s,messages:i,messagesCommon:o,sketchViewModel:n,snappingControls:a},T("div",{class:P},this.renderMessage(i.selectFeatureToEdit)))}renderMessage(e){return T("div",{class:"esri-editor__panel-content__message"},e)}renderFeatureCreation(e){const{EditorPanel:t,_handleBack:s,headingLevel:r,messages:i,messagesCommon:o,_snappingControls:a,viewModel:n}=this,{sketchViewModel:l}=n,p=n.sketchViewModel,m=this._assertActiveCreateWorkflow().data.creationInfo.layer,c=p.canUndo()&&p.createGraphic?p.createGraphic:null,d=this._getSketchingTip(m.geometryType,c);return T(t,{active:this.isPanelActive(e),key:"feature-creation-panel",heading:i.placeFeature,headingLevel:r,handleBack:s,messages:i,messagesCommon:o,sketchViewModel:l,snappingControls:a},T("div",{class:P},this.renderMessage(d)))}renderFooterActions(e){return e.map((({type:e,disabled:t,class:s,...r},i)=>this.renderButton({class:this.classes("esri-editor__control-button","secondary"===e?"esri-button--secondary":"tertiary"===e?"esri-button--tertiary":null,t?"esri-button--disabled":null,s),disabled:t??!1,key:i,slot:"footer-actions",...r})))}renderPrompt({title:e,message:t,context:s,actions:r}){const i=!!r.secondary,o=T("calcite-button",{appearance:"solid",color:"danger"===s?"red":"blue",width:i?"half":"full",onclick:r.primary.action,key:"prompt-primary-button",afterCreate:V},r.primary.label),a=i?T("calcite-button",{appearance:"clear",color:"danger"===s?"red":"blue",width:"half",onclick:r.secondary.action,key:"prompt-secondary-button"},r.secondary.label):null;return T("div",{class:`esri-editor__prompt--${s}`},T("div",{class:"esri-editor__prompt__header"},T("calcite-icon",{icon:"exclamation-mark-triangle"}),T(F,{class:"esri-editor__prompt__header__heading",level:this.headingLevel},e)),T("div",{class:"esri-editor__prompt__message"},t),T("div",{class:"esri-editor__prompt__divider"}),T("div",{class:"esri-editor__prompt__actions"},a,o))}renderProgressBar(){return T("div",{class:this.classes("esri-editor__progress-bar"),key:"progress-bar"})}renderButton(e){const{disabled:t,class:s,key:r,clickHandler:i,label:o,...a}=e;return T("calcite-button",{class:s,disabled:t,key:r,onclick:i,type:"button",...a},o)}renderLanding(e){const{EditorPanel:t,headingLevel:s,messages:r,messagesCommon:i,_snappingControls:o,viewModel:{sketchViewModel:a}}=this;return T(t,{active:this.isPanelActive(e),key:"landing-panel",heading:r.widgetLabel,headingLevel:s,showBackButton:!1,messages:r,messagesCommon:i,sketchViewModel:a,snappingControls:o},T("div",{class:P},T("div",{key:"edit-actions",class:"esri-editor__panel-content__section"},this.renderUpdateActions()),T("div",{key:"create-actions",class:"esri-editor__panel-content__section"},this.renderCreateActions())))}renderUpdateActions(){const{messages:e,messagesCommon:t}=this;return T("div",null,T(F,{level:M(this.headingLevel)},e.editFeatures),T("div",{class:"esri-editor__update-features-action-buttons"},T("calcite-action",{text:t.select,textEnabled:!0,icon:"cursor",alignment:"start",class:"esri-editor__update-features-action-buttons--button",onclick:this._handleEdit})))}renderCreateActions(){const{_featureTemplates:e,headingLevel:t,messages:s}=this;if(0!==e.viewModel.numberOfFeatureTemplates)return T("div",null,T(F,{level:M(t)},s.createFeatures),T("div",{key:"templates",class:"esri-editor__feature-templates-container"},e.render()))}renderFeatureList(e){const{EditorPanel:s,_handleBack:r,headingLevel:i,messages:o,messagesCommon:a,messagesTemplates:n,_snappingControls:l,viewModel:{editableItems:p,sketchViewModel:m}}=this,c=this._assertActiveUpdateWorkflow().data.candidates,d=t(o.multipleFeaturesTemplate,{total:c.length}),u=new Map;let h=0;c.map((e=>({label:this._getLabel(e),id:e.attributes[e.layer.objectIdField],data:e}))).filter((e=>{const{label:t,data:s}=e,r=this._filterText.toLowerCase(),{title:i}=s.layer,o=this.viewModel.editableItems.find((e=>e.layer===s.layer));return o.supports.includes("update")&&(!r||t.toLowerCase().includes(r)||i.toLowerCase().includes(r))})).forEach((e=>{h++;const t=e.data.layer;u.has(t)?u.get(t).items.push(e):u.set(t,{id:`${t.id}`,label:t.title,items:[e]})}));const j=p.filter((({layer:e})=>u.has(e))).map((({layer:e})=>u.get(e))).toArray(),k=h>10||this._filterText.length>0;return T(s,{active:this.isPanelActive(e),key:"feature-list",heading:d,headingLevel:i,handleBack:r,messages:o,messagesCommon:a,sketchViewModel:m,snappingControls:l},T("div",{class:P},v({id:this.id,enableListScroll:!1,filterEnabled:k,filterText:this._filterText,items:j,messages:{filterPlaceholder:n.filterPlaceholder,noItems:n.noItems,noMatches:n.noMatches},onItemMouseEnter:({data:e})=>this._setCandidateFeature(e),onItemMouseLeave:()=>this._setCandidateFeature(null),onItemSelect:({data:e})=>this._setCandidateFeature(e,!0),onFilterChange:e=>this._filterText=e})))}EditorPanel(e,...t){const{active:s,handleBack:r,heading:i,headingLevel:o,key:a,messages:n,messagesCommon:l,showBackButton:p,sketchViewModel:m,snappingControls:c}=e;return T("calcite-panel",{bind:this,key:a,heading:i,headingLevel:o,showBackButton:p??!0,beforeBack:r??null,onCalcitePanelScroll:this._onSnappingPopoverPanelScroll},T("div",{class:"esri-editor__panel-toolbar"},T("calcite-popover",{autoClose:s,afterCreate:this._afterSnappingPopoverCreated,afterUpdate:this._afterSnappingPopoverUpdated,bind:this,label:n.snappingSettings,heading:n.snappingSettings,"reference-element":`${a}__snappingButton`,"overlay-positioning":"fixed",placement:"bottom"},T("div",{class:"esri-editor__snapping-controls-popover"},c.render())),T("calcite-button",{id:`${a}__snappingButton`,text:n.snapping,appearance:"transparent",color:"neutral",alignment:"icon-end-space-between","icon-start":"vertex-gps","icon-end":"caret-down",width:"full",class:"esri-editor__panel-toolbar__snapping-button"},n.snapping),this.visibleElements.undoRedoButtons?[T("calcite-button",{key:"undo-button",text:l.undo,appearance:"transparent",color:"neutral",alignment:"center","icon-start":"undo",scale:"l",disabled:!m.canUndo(),onclick:m.undo.bind(m)}),T("calcite-button",{key:"redo-button",text:l.redo,appearance:"transparent",color:"neutral",alignment:"center","icon-start":"redo",scale:"l",disabled:!m.canRedo(),onclick:m.redo.bind(m)})]:null),t)}_onSnappingPopoverPanelScroll(){this._snappingPopover?.open&&this._snappingPopover.toggle()}_afterSnappingPopoverCreated(e){this._snappingPopover=e}_afterSnappingPopoverUpdated(e){this._snappingPopover=e}_getSketchingTip(e,t){const{messages:s}=this;if("point"===e)return s.tips.clickToAddPoint;if("polygon"===e||"polyline"===e){if(!t)return s.tips.clickToStart;const r=t.geometry,i="polygon"===e?"rings":"paths",[o]=r[i];return"polygon"===e&&o<4?s.tips.clickToContinue:s.tips.clickToContinueThenDoubleClickToEnd}return s.tips.clickToAddFeature}_getLabel(e){const s=e.layer;if(!s)return null;const{objectIdField:r}=s,{attributes:i}=e,o=u(s);return o&&i[o]&&`${i[o]}`||t(this.messages.untitledFeatureTemplate,{id:i[r]})}_handleDelete(){const{messages:e,messagesCommon:t}=this;this._prompt={title:e.deleteWarningTitle,message:e.deleteWarningMessage,context:"danger",actions:{primary:{label:t.delete,action:()=>{this.viewModel.deleteFeatureFromWorkflow(),this._prompt=null}},secondary:{label:e.keepFeature,action:()=>this._prompt=null}}}}_handleSave(){const{featureFormViewModel:e}=this.viewModel;e.submit(),!e.submittable||e.validateContingencyConstraints(e.getValues(),{includeIncompleteViolations:!0}).length>0||this.viewModel.activeWorkflow.commit()}_handleAttachmentAdd(){const{_attachments:e}=this,{activeWorkflow:t}=this.viewModel;e.addAttachment().then((()=>t.previous()))}_handleAttachmentUpdate(){const{_attachments:e}=this,{activeWorkflow:t}=this.viewModel;e.updateAttachment().then((()=>t.previous()))}_handleAttachmentDelete(){const{messages:e,messagesCommon:t}=this;this._prompt={title:e.deleteAttachmentWarningTitle,message:e.deleteAttachmentWarningMessage,context:"danger",actions:{primary:{label:t.delete,action:()=>{const{_attachments:e}=this,{activeWorkflow:t}=this.viewModel;e.deleteAttachment(e.viewModel.activeAttachmentInfo).then((()=>{t.previous(),this._prompt=null}))}},secondary:{label:e.keepAttachment,action:()=>this._prompt=null}}}}_handleAdd(){this.viewModel.canCreate}_handleEdit(){this.viewModel.canUpdate&&this.viewModel.startUpdateWorkflowAtFeatureSelection()}_handleDone(){this.viewModel.cancelWorkflow({force:!0})}async _handleBack(){const{messages:e}=this,t=this.activeWorkflow,s=()=>{t.hasPreviousStep?t.previous({cancelCurrentStep:!0}):this.viewModel.cancelWorkflow({force:!0})};if("create"===t.type||"create-features"===t.type&&t.numPendingFeatures>0||"editing-existing-feature"===t.stepId&&t.data.edits.modified){const{type:r}=t,i="create"===r?e.cancelAddWarningMessage:e.cancelEditWarningMessage,o="create"===r?e.cancelAddTitle:e.cancelEditTitle,a="create"===r?e.continueAdding:e.continueEditing,n="create"===r?e.discardFeature:e.discardEdits;throw this._prompt={title:o,message:i,context:"danger",actions:{primary:{label:n,action:()=>{s(),this._prompt=null}},secondary:{label:a,action:()=>this._prompt=null}}},this.scheduleRender(),new Error}s()}_assertActiveCreateWorkflow(){const{type:e}=this.viewModel.activeWorkflow;if("create"===e||"create-features"===e)return this.viewModel.activeWorkflow;throw Error("Expected activeWorkflow to be instance of CreateWorkflow or CreateFeaturesWorkflow")}_assertActiveUpdateWorkflow(){if("update"===this.viewModel.activeWorkflow.type)return this.viewModel.activeWorkflow;throw Error("Expected activeWorkflow to be an UpdateWorkflow")}};e([c()],D.prototype,"_attachments",void 0),e([p("viewModel.activeWorkflow")],D.prototype,"activeWorkflow",void 0),e([p("viewModel.allowedWorkflows")],D.prototype,"allowedWorkflows",void 0),e([c()],D.prototype,"useDeprecatedCreateWorkflow",void 0),e([c()],D.prototype,"headingLevel",void 0),e([c()],D.prototype,"iconClass",void 0),e([c({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],D.prototype,"label",void 0),e([p("viewModel.labelOptions")],D.prototype,"labelOptions",void 0),e([p("viewModel.layerInfos")],D.prototype,"layerInfos",void 0),e([c(),U("esri/widgets/Editor/t9n/Editor")],D.prototype,"messages",void 0),e([c(),U("esri/t9n/common")],D.prototype,"messagesCommon",void 0),e([c(),U("esri/widgets/FeatureTemplates/t9n/FeatureTemplates")],D.prototype,"messagesTemplates",void 0),e([p("viewModel.snappingOptions")],D.prototype,"snappingOptions",void 0),e([p("viewModel.tooltipOptions")],D.prototype,"tooltipOptions",void 0),e([c()],D.prototype,"supportingWidgetDefaults",void 0),e([p("viewModel.view")],D.prototype,"view",void 0),e([c(),L(["workflow-cancel","workflow-commit"])],D.prototype,"viewModel",void 0),e([c()],D.prototype,"visibleElements",void 0),e([m("visibleElements")],D.prototype,"castVisibleElements",null),e([A()],D.prototype,"_handleDelete",null),e([A()],D.prototype,"_handleAttachmentAdd",null),e([A()],D.prototype,"_handleAttachmentUpdate",null),e([A()],D.prototype,"_handleAttachmentDelete",null),e([A()],D.prototype,"_handleAdd",null),e([A()],D.prototype,"_handleEdit",null),e([A()],D.prototype,"_handleDone",null),D=e([d("esri.widgets.Editor")],D);const B=D;export{B as default};
