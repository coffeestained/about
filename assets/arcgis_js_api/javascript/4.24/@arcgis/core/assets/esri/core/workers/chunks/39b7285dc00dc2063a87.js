"use strict";(self.webpackChunkRemoteClient=self.webpackChunkRemoteClient||[]).push([[332],{60332:(e,n,t)=>{t.r(n),t.d(n,{registerFunctions:()=>g});var r=t(1886),a=t(65949),i=t(97944),l=t(61146),s=t(72256),o=t(50406),f=t(72274),u=t(9506),c=t(97546);async function d(e,n,t){const r=e.getVariables();if(r.length>0){const a=[];for(let e=0;e<r.length;e++){const i={name:r[e]};a.push(await n.evaluateIdentifier(t,i))}const i={};for(let e=0;e<r.length;e++)i[r[e]]=a[e];return e.parameters=i,e}return e}function m(e,n,t=null){for(const t in e)if(t.toLowerCase()===n.toLowerCase())return e[t];return t}function p(e){if(null===e)return null;const n={type:m(e,"type",""),name:m(e,"name","")};if("range"===n.type)n.range=m(e,"range",[]);else{n.codedValues=[];for(const t of m(e,"codedValues",[]))n.codedValues.push({name:m(t,"name",""),code:m(t,"code",null)})}return n}function y(e){if(null===e)return null;const n={},t=m(e,"wkt",null);null!==t&&(n.wkt=t);const r=m(e,"wkid",null);return null!==r&&(n.wkid=r),n}function h(e){if(null===e)return null;const n={hasZ:m(e,"hasz",!1),hasM:m(e,"hasm",!1)},t=m(e,"spatialreference",null);t&&(n.spatialReference=y(t));const r=m(e,"x",null);if(null!==r)return n.x=r,n.y=m(e,"y",null),n;const a=m(e,"rings",null);if(null!==a)return n.rings=a,n;const i=m(e,"paths",null);if(null!==i)return n.paths=i,n;const l=m(e,"points",null);if(null!==l)return n.points=l,n;for(const t of["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"]){const r=m(e,t,null);null!==r&&(n[t]=r)}return n}function g(e){"async"===e.mode&&(e.functions.getuser=function(n,t){return e.standardFunctionAsync(n,t,(async(e,t,s)=>{(0,l.p)(s,1,2);let o=(0,l.n)(s[1],""),f=!0===o;if(o=!0===o||!1===o?"":(0,l.h)(o),s[0]instanceof r.f){let e=null;n.services&&n.services.portal&&(e=n.services.portal),e=(0,i.g)(s[0],e);const t=await(0,i.l)(e,o,f);if(t){const e=JSON.parse(JSON.stringify(t));for(const n of["lastLogin","created","modified"])void 0!==e[n]&&null!==e[n]&&(e[n]=new Date(e[n]));return a.D.convertObjectToArcadeDictionary(e)}return null}let u=null;if((0,l.R)(s[0])&&(u=s[0]),u){if(f=!1,o)return null;await u.load();const e=await u.getOwningSystemUrl();if(!e){if(!o){const e=await u.getIdentityUser();return e?a.D.convertObjectToArcadeDictionary({username:e}):null}return null}let t=null;n.services&&n.services.portal&&(t=n.services.portal),t=(0,i.g)(new r.f(e),t);const l=await(0,i.l)(t,o,f);if(l){const e=JSON.parse(JSON.stringify(l));for(const n of["lastLogin","created","modified"])void 0!==e[n]&&null!==e[n]&&(e[n]=new Date(e[n]));return a.D.convertObjectToArcadeDictionary(e)}return null}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"getuser",min:"1",max:"2"}),e.functions.featuresetbyid=function(n,t){return e.standardFunctionAsync(n,t,((e,n,t)=>{if((0,l.p)(t,2,4),t[0]instanceof i.F){const e=(0,l.h)(t[1]);let n=(0,l.n)(t[2],null);const r=(0,l.g)((0,l.n)(t[3],!0));if(null===n&&(n=["*"]),!1===(0,l.l)(n))throw new Error("Invalid Parameter");return t[0].featureSetById(e,r,n)}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"featuresetbyid",min:"2",max:"4"}),e.functions.getfeatureset=function(n,t){return e.standardFunctionAsync(n,t,((e,t,r)=>{if((0,l.p)(r,1,2),(0,l.J)(r[0])){let e=(0,l.n)(r[1],"datasource");return null===e&&(e="datasource"),e=(0,l.h)(e).toLowerCase(),(0,i.c)(r[0].fullSchema(),e,n.lrucache,n.interceptor,n.spatialReference)}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"getfeatureset",min:"1",max:"2"}),e.functions.featuresetbyportalitem=function(n,t){return e.standardFunctionAsync(n,t,((e,t,a)=>{if((0,l.p)(a,2,5),null===a[0])throw new Error("Portal is required");if(a[0]instanceof r.f){const e=(0,l.h)(a[1]),t=(0,l.h)(a[2]);let r=(0,l.n)(a[3],null);const s=(0,l.g)((0,l.n)(a[4],!0));if(null===r&&(r=["*"]),!1===(0,l.l)(r))throw new Error("Invalid Parameter");let o=null;return n.services&&n.services.portal&&(o=n.services.portal),o=(0,i.g)(a[0],o),(0,i.a)(e,t,n.spatialReference,r,s,o,n.lrucache,n.interceptor)}if(!1===(0,l.b)(a[0]))throw new Error("Portal is required");const s=(0,l.h)(a[0]),o=(0,l.h)(a[1]);let f=(0,l.n)(a[2],null);const u=(0,l.g)((0,l.n)(a[3],!0));if(null===f&&(f=["*"]),!1===(0,l.l)(f))throw new Error("Invalid Parameter");if(n.services&&n.services.portal)return(0,i.a)(s,o,n.spatialReference,f,u,n.services.portal,n.lrucache,n.interceptor);throw new Error("Portal is required")}))},e.signatures.push({name:"featuresetbyportalitem",min:"2",max:"5"}),e.functions.featuresetbyname=function(n,t){return e.standardFunctionAsync(n,t,((e,n,t)=>{if((0,l.p)(t,2,4),t[0]instanceof i.F){const e=(0,l.h)(t[1]);let n=(0,l.n)(t[2],null);const r=(0,l.g)((0,l.n)(t[3],!0));if(null===n&&(n=["*"]),!1===(0,l.l)(n))throw new Error("Invalid Parameter");return t[0].featureSetByName(e,r,n)}throw new Error("Invalid Parameter")}))},e.signatures.push({name:"featuresetbyname",min:"2",max:"4"}),e.functions.featureset=function(n,t){return e.standardFunction(n,t,((e,t,r)=>{(0,l.p)(r,1,1);let s=r[0];const o={layerDefinition:{geometryType:"",objectIdField:"",globalIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if((0,l.b)(s))s=JSON.parse(s),void 0!==s.layerDefinition?(o.layerDefinition=s.layerDefinition,o.featureSet=s.featureSet,s.layerDefinition.spatialReference&&(o.layerDefinition.spatialReference=s.layerDefinition.spatialReference)):(o.featureSet.features=s.features,o.featureSet.geometryType=s.geometryType,o.layerDefinition.geometryType=o.featureSet.geometryType,o.layerDefinition.objectIdField=s.objectIdFieldName,o.layerDefinition.typeIdField=s.typeIdFieldName,o.layerDefinition.globalIdField=s.globalIdFieldName,o.layerDefinition.fields=s.fields,s.spatialReference&&(o.layerDefinition.spatialReference=s.spatialReference));else{if(!(r[0]instanceof a.D))throw new Error("Invalid Parameter");{s=JSON.parse(r[0].castToText());const e=m(s,"layerdefinition");if(null!==e){o.layerDefinition.geometryType=m(e,"geometrytype",""),o.featureSet.geometryType=o.layerDefinition.geometryType,o.layerDefinition.globalIdField=m(e,"globalidfield",""),o.layerDefinition.objectIdField=m(e,"objectidfield",""),o.layerDefinition.typeIdField=m(e,"typeidfield","");const n=m(e,"spatialreference",null);n&&(o.layerDefinition.spatialReference=y(n));for(const n of m(e,"fields",[])){const e={name:m(n,"name",""),alias:m(n,"alias",""),type:m(n,"type",""),nullable:m(n,"nullable",!0),editable:m(n,"editable",!0),length:m(n,"length",null),domain:p(m(n,"domain"))};o.layerDefinition.fields.push(e)}const t=m(s,"featureset",null);if(t){const e={};for(const n of o.layerDefinition.fields)e[n.name.toLowerCase()]=n.name;for(const n of m(t,"features",[])){const t={},r=m(n,"attributes",{});for(const n in r)t[e[n.toLowerCase()]]=r[n];o.featureSet.features.push({attributes:t,geometry:h(m(n,"geometry",null))})}}}else{o.layerDefinition.geometryType=m(s,"geometrytype",""),o.featureSet.geometryType=o.layerDefinition.geometryType,o.layerDefinition.objectIdField=m(s,"objectidfieldname",""),o.layerDefinition.typeIdField=m(s,"typeidfieldname","");const e=m(s,"spatialreference",null);e&&(o.layerDefinition.spatialReference=y(e));for(const e of m(s,"fields",[])){const n={name:m(e,"name",""),alias:m(e,"alias",""),type:m(e,"type",""),nullable:m(e,"nullable",!0),editable:m(e,"editable",!0),length:m(e,"length",null),domain:p(m(e,"domain"))};o.layerDefinition.fields.push(n)}const n={};for(const e of o.layerDefinition.fields)n[e.name.toLowerCase()]=e.name;for(const e of m(s,"features",[])){const t={},r=m(e,"attributes",{});for(const e in r)t[n[e.toLowerCase()]]=r[e];o.featureSet.features.push({attributes:t,geometry:h(m(e,"geometry",null))})}}}}if(0==(!!(f=o).layerDefinition&&!!f.featureSet&&!1!==function(e,n){for(const n of["","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])if(n===e)return!0;return!1}(f.layerDefinition.geometryType)&&null!==f.layerDefinition.objectIdField&&""!==f.layerDefinition.objectIdField&&!1!==(0,l.l)(f.layerDefinition.fields)&&!1!==(0,l.l)(f.featureSet.features)))throw new Error("Invalid Parameter");var f;return i.b.create(o,n.spatialReference)}))},e.signatures.push({name:"featureset",min:"1",max:"1"}),e.functions.filter=function(n,t){return e.standardFunctionAsync(n,t,(async(t,r,a)=>{if((0,l.p)(a,2,2),(0,l.l)(a[0])||(0,l.o)(a[0])){const t=[];let r=a[0];r instanceof l.I&&(r=r.toArray());let i=null;if(a[1]instanceof l.F)i=e.arcadeCustomFunctionHandler(a[1]);else if(a[1]instanceof l.N)i=(...e)=>a[1].fn(n,{preparsed:!0,arguments:e});else{if(!(a[1]instanceof l.S))throw new Error("Invalid Parameter");i=(...e)=>{if(e.length!==a[1].paramCount)throw new Error("Invalid parameters");return a[1].fn(...e)}}for(const e of r){const n=i(e);(0,o.y8)(n)?!0===await n&&t.push(e):!0===n&&t.push(e)}return t}if((0,l.R)(a[0])){const t=await a[0].load(),r=f.WhereClause.create(a[1],t.getFieldsIndex()),l=r.getVariables();if(l.length>0){const t=[];for(let r=0;r<l.length;r++){const a={name:l[r]};t.push(await e.evaluateIdentifier(n,a))}const s={};for(let e=0;e<l.length;e++)s[l[e]]=t[e];return r.parameters=s,new i.d({parentfeatureset:a[0],whereclause:r})}return new i.d({parentfeatureset:a[0],whereclause:r})}throw new Error("Filter cannot accept this parameter type")}))},e.signatures.push({name:"filter",min:"2",max:"2"}),e.functions.orderby=function(n,t){return e.standardFunctionAsync(n,t,(async(e,n,t)=>{if((0,l.p)(t,2,2),(0,l.R)(t[0])){const e=new i.O(t[1]);return new i.e({parentfeatureset:t[0],orderbyclause:e})}throw new Error("Order cannot accept this parameter type")}))},e.signatures.push({name:"orderby",min:"2",max:"2"}),e.functions.top=function(n,t){return e.standardFunctionAsync(n,t,(async(e,n,t)=>{if((0,l.p)(t,2,2),(0,l.R)(t[0]))return new i.T({parentfeatureset:t[0],topnum:t[1]});if((0,l.l)(t[0]))return(0,l.f)(t[1])>=t[0].length?t[0].slice(0):t[0].slice(0,(0,l.f)(t[1]));if((0,l.o)(t[0]))return(0,l.f)(t[1])>=t[0].length()?t[0].slice(0):t[0].slice(0,(0,l.f)(t[1]));throw new Error("Top cannot accept this parameter type")}))},e.signatures.push({name:"top",min:"2",max:"2"}),e.functions.first=function(n,t){return e.standardFunctionAsync(n,t,(async(e,n,t)=>{if((0,l.p)(t,1,1),(0,l.R)(t[0])){const n=await t[0].first(e.abortSignal);if(null!==n){const e=a.F.createFromGraphicLikeObject(n.geometry,n.attributes,t[0]);return e._underlyingGraphic=n,e}return n}return(0,l.l)(t[0])?0===t[0].length?null:t[0][0]:(0,l.o)(t[0])?0===t[0].length()?null:t[0].get(0):null}))},e.signatures.push({name:"first",min:"1",max:"1"}),e.functions.attachments=function(n,t){return e.standardFunctionAsync(n,t,(async(e,t,r)=>{(0,l.p)(r,1,2);const s={minsize:-1,maxsize:-1,types:null,returnMetadata:!1};if(r.length>1)if(r[1]instanceof a.D){if(r[1].hasField("minsize")&&(s.minsize=(0,l.f)(r[1].field("minsize"))),r[1].hasField("metadata")&&(s.returnMetadata=(0,l.g)(r[1].field("metadata"))),r[1].hasField("maxsize")&&(s.maxsize=(0,l.f)(r[1].field("maxsize"))),r[1].hasField("types")){const e=(0,l.ag)(r[1].field("types"),!1);e.length>0&&(s.types=e)}}else if(null!==r[1])throw new Error("Invalid Parameter");if((0,l.J)(r[0])){let e=r[0]._layer;return e instanceof u.default&&(e=(0,i.f)(e,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),null===e||!1===(0,l.R)(e)?[]:(await e.load(),e.queryAttachments(r[0].field(e.objectIdField),s.minsize,s.maxsize,s.types,s.returnMetadata))}if(null===r[0])return[];throw new Error("Invalid Parameter")}))},e.signatures.push({name:"attachments",min:"1",max:"2"}),e.functions.featuresetbyrelationshipname=function(n,t){return e.standardFunctionAsync(n,t,(async(e,t,r)=>{(0,l.p)(r,2,4);const a=r[0],o=(0,l.h)(r[1]);let c=(0,l.n)(r[2],null);const d=(0,l.g)((0,l.n)(r[3],!0));if(null===c&&(c=["*"]),!1===(0,l.l)(c))throw new Error("Invalid Parameter");if(null===r[0])return null;if(!(0,l.J)(r[0]))throw new Error("Invalid Parameter");let m=a._layer;if(m instanceof u.default&&(m=(0,i.f)(m,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),null===m)return null;if(!1===(0,l.R)(m))return null;m=await m.load();const p=m.relationshipMetaData().filter((e=>e.name===o));if(0===p.length)return null;if(void 0!==p[0].relationshipTableId&&null!==p[0].relationshipTableId&&p[0].relationshipTableId>-1)return(0,i.h)(m,p[0],a.field(m.objectIdField),m.spatialReference,c,d,n.lrucache,n.interceptor);let y=m.serviceUrl();if(!y)return null;y="/"===y.charAt(y.length-1)?y+p[0].relatedTableId.toString():y+"/"+p[0].relatedTableId.toString();const h=await(0,i.i)(y,m.spatialReference,c,d,n.lrucache,n.interceptor);await h.load();let g=h.relationshipMetaData();if(g=g.filter((e=>e.id===p[0].id)),!1===a.hasField(p[0].keyField)||null===a.field(p[0].keyField)){const e=await m.getFeatureByObjectId(a.field(m.objectIdField),[p[0].keyField]);if(e){const n=f.WhereClause.create(g[0].keyField+"= @id",h.getFieldsIndex());return n.parameters={id:e.attributes[p[0].keyField]},h.filter(n)}return new s.E({parentfeatureset:h})}const w=f.WhereClause.create(g[0].keyField+"= @id",h.getFieldsIndex());return w.parameters={id:a.field(p[0].keyField)},h.filter(w)}))},e.signatures.push({name:"featuresetbyrelationshipname",min:"2",max:"4"}),e.functions.featuresetbyassociation=function(n,t){return e.standardFunctionAsync(n,t,(async(e,t,r)=>{(0,l.p)(r,2,3);const a=r[0],s=(0,l.h)((0,l.n)(r[1],"")).toLowerCase(),o=(0,l.b)(r[2])?(0,l.h)(r[2]):null;if(null===r[0])return null;if(!(0,l.J)(r[0]))throw new Error("Invalid Parameter");let d=a._layer;if(d instanceof u.default&&(d=(0,i.f)(d,n.spatialReference,["*"],!0,n.lrucache,n.interceptor)),null===d)return null;if(!1===(0,l.R)(d))return null;await d.load();const m=d.serviceUrl(),p=await(0,i.j)(m,n.spatialReference);let y=null,h=null,g=!1;if(null!==o&&""!==o&&void 0!==o){for(const e of p.terminals)e.terminalName===o&&(h=e.terminalId);null===h&&(g=!0)}const w=p.associations.getFieldsIndex(),E=w.get("TOGLOBALID").name,F=w.get("FROMGLOBALID").name,I=w.get("TOTERMINALID").name,D=w.get("FROMTERMINALID").name,b=w.get("FROMNETWORKSOURCEID").name,A=w.get("TONETWORKSOURCEID").name,N=w.get("ASSOCIATIONTYPE").name,S=w.get("ISCONTENTVISIBLE").name,x=w.get("OBJECTID").name;for(const e of d.fields)if("global-id"===e.type){y=a.field(e.name);break}let C=null,$=new i.S(new c.Z({name:"percentalong",alias:"percentalong",type:"double"}),f.WhereClause.create("0",p.associations.getFieldsIndex())),T=new i.S(new c.Z({name:"side",alias:"side",type:"string"}),f.WhereClause.create("''",p.associations.getFieldsIndex()));const L="globalid",v="globalId",R={};for(const e in p.lkp)R[e]=p.lkp[e].sourceId;const O=new i.k(new c.Z({name:"classname",alias:"classname",type:"string"}),null,R);let W="";switch(s){case"midspan":{W=`((${E}='${y}') OR ( ${F}='${y}')) AND (${N} IN (5))`,O.codefield=f.WhereClause.create(`CASE WHEN (${E}='${y}') THEN ${b} ELSE ${A} END`,p.associations.getFieldsIndex());const e=(0,l.a2)(i.A.findField(p.associations.fields,F));e.name=L,e.alias=L,C=new i.S(e,f.WhereClause.create(`CASE WHEN (${F}='${y}') THEN ${E} ELSE ${F} END`,p.associations.getFieldsIndex())),$=p.unVersion>=4?new i.n(i.A.findField(p.associations.fields,w.get("PERCENTALONG").name)):new i.S(new c.Z({name:"percentalong",alias:"percentalong",type:"double"}),f.WhereClause.create("0",p.associations.getFieldsIndex()));break}case"junctionedge":{W=`((${E}='${y}') OR ( ${F}='${y}')) AND (${N} IN (4,6))`,O.codefield=f.WhereClause.create(`CASE WHEN (${E}='${y}') THEN ${b} ELSE ${A} END`,p.associations.getFieldsIndex());const e=(0,l.a2)(i.A.findField(p.associations.fields,F));e.name=L,e.alias=L,C=new i.S(e,f.WhereClause.create(`CASE WHEN (${F}='${y}') THEN ${E} ELSE ${F} END`,p.associations.getFieldsIndex())),T=new i.S(new c.Z({name:"side",alias:"side",type:"string"}),f.WhereClause.create(`CASE WHEN (${N}=4) THEN 'from' ELSE 'to' END`,p.associations.getFieldsIndex()));break}case"connected":{let e=`${E}='@T'`,n=`${F}='@T'`;null!==h&&(e+=` AND ${I}=@A`,n+=` AND ${D}=@A`),W="(("+e+") OR ("+n+"))",W=(0,l.E)(W,"@T",y),e=(0,l.E)(e,"@T",y),null!==h&&(e=(0,l.E)(e,"@A",h.toString()),W=(0,l.E)(W,"@A",h.toString())),O.codefield=f.WhereClause.create("CASE WHEN "+e+` THEN ${b} ELSE ${A} END`,p.associations.getFieldsIndex());const t=(0,l.a2)(i.A.findField(p.associations.fields,F));t.name=L,t.alias=L,C=new i.S(t,f.WhereClause.create("CASE WHEN "+e+` THEN ${F} ELSE ${E} END`,p.associations.getFieldsIndex()));break}case"container":W=`${E}='${y}' AND ${N} = 2`,null!==h&&(W+=` AND ${I} = `+h.toString()),O.codefield=b,W="( "+W+" )",C=new i.m(i.A.findField(p.associations.fields,F),L,L);case"content":W=`(${F}='${y}' AND ${N} = 2)`,null!==h&&(W+=` AND ${D} = `+h.toString()),O.codefield=A,W="( "+W+" )",C=new i.m(i.A.findField(p.associations.fields,E),L,L);break;case"structure":W=`(${E}='${y}' AND ${N} = 3)`,null!==h&&(W+=` AND ${I} = `+h.toString()),O.codefield=b,W="( "+W+" )",C=new i.m(i.A.findField(p.associations.fields,F),L,v);break;case"attached":W=`(${F}='${y}' AND ${N} = 3)`,null!==h&&(W+=` AND ${D} = `+h.toString()),O.codefield=A,W="( "+W+" )",C=new i.m(i.A.findField(p.associations.fields,E),L,v);break;default:throw new Error("Invalid Parameter")}return g&&(W="1 <> 1"),new i.A({parentfeatureset:p.associations,adaptedFields:[new i.n(i.A.findField(p.associations.fields,x)),new i.n(i.A.findField(p.associations.fields,S)),C,T,O,$],extraFilter:W?f.WhereClause.create(W,p.associations.getFieldsIndex()):null})}))},e.signatures.push({name:"featuresetbyassociation",min:"2",max:"6"}),e.functions.groupby=function(n,t){return e.standardFunctionAsync(n,t,(async(t,r,i)=>{if((0,l.p)(i,3,3),!(0,l.R)(i[0]))throw new Error("Illegal Value: GroupBy");const o=await i[0].load(),u=[],c=[];let m=!1,p=[];if((0,l.b)(i[1]))p.push(i[1]);else if(i[1]instanceof a.D)p.push(i[1]);else if((0,l.l)(i[1]))p=i[1];else{if(!(0,l.o)(i[1]))throw new Error("Illegal Value: GroupBy");p=i[1].toArray()}for(const e of p)if((0,l.b)(e)){const n=f.WhereClause.create((0,l.h)(e),o.getFieldsIndex()),t=!0===(0,s.i)(n)?(0,l.h)(e):"%%%%FIELDNAME";u.push({name:t,expression:n}),"%%%%FIELDNAME"===t&&(m=!0)}else{if(!(e instanceof a.D))throw new Error("Illegal Value: GroupBy");{const n=e.hasField("name")?e.field("name"):"%%%%FIELDNAME",t=e.hasField("expression")?e.field("expression"):"";if("%%%%FIELDNAME"===n&&(m=!0),!n)throw new Error("Illegal Value: GroupBy");u.push({name:n,expression:f.WhereClause.create(t||n,o.getFieldsIndex())})}}if(p=[],(0,l.b)(i[2]))p.push(i[2]);else if((0,l.l)(i[2]))p=i[2];else if((0,l.o)(i[2]))p=i[2].toArray();else{if(!(i[2]instanceof a.D))throw new Error("Illegal Value: GroupBy");p.push(i[2])}for(const e of p){if(!(e instanceof a.D))throw new Error("Illegal Value: GroupBy");{const n=e.hasField("name")?e.field("name"):"",t=e.hasField("statistic")?e.field("statistic"):"",r=e.hasField("expression")?e.field("expression"):"";if(!n||!t||!r)throw new Error("Illegal Value: GroupBy");c.push({name:n,statistic:t.toLowerCase(),expression:f.WhereClause.create(r,o.getFieldsIndex())})}}if(m){const e={};for(const n of o.fields)e[n.name.toLowerCase()]=1;for(const n of u)"%%%%FIELDNAME"!==n.name&&(e[n.name.toLowerCase()]=1);for(const n of c)"%%%%FIELDNAME"!==n.name&&(e[n.name.toLowerCase()]=1);let n=0;for(const t of u)if("%%%%FIELDNAME"===t.name){for(;1===e["field_"+n.toString()];)n++;e["field_"+n.toString()]=1,t.name="FIELD_"+n.toString()}}for(const t of u)await d(t.expression,e,n);for(const t of c)await d(t.expression,e,n);return i[0].groupby(u,c)}))},e.signatures.push({name:"groupby",min:"3",max:"3"}),e.functions.distinct=function(n,t){return e.standardFunctionAsync(n,t,(async(t,i,o)=>{if((0,l.R)(o[0])){(0,l.p)(o,2,2);const t=await o[0].load(),r=[];let i=[];if((0,l.b)(o[1]))i.push(o[1]);else if(o[1]instanceof a.D)i.push(o[1]);else if((0,l.l)(o[1]))i=o[1];else{if(!(0,l.o)(o[1]))throw new Error("Illegal Value: GroupBy");i=o[1].toArray()}let u=!1;for(const e of i)if((0,l.b)(e)){const n=f.WhereClause.create((0,l.h)(e),t.getFieldsIndex()),a=!0===(0,s.i)(n)?(0,l.h)(e):"%%%%FIELDNAME";r.push({name:a,expression:n}),"%%%%FIELDNAME"===a&&(u=!0)}else{if(!(e instanceof a.D))throw new Error("Illegal Value: GroupBy");{const n=e.hasField("name")?e.field("name"):"%%%%FIELDNAME",a=e.hasField("expression")?e.field("expression"):"";if("%%%%FIELDNAME"===n&&(u=!0),!n)throw new Error("Illegal Value: GroupBy");r.push({name:n,expression:f.WhereClause.create(a||n,t.getFieldsIndex())})}}if(u){const e={};for(const n of t.fields)e[n.name.toLowerCase()]=1;for(const n of r)"%%%%FIELDNAME"!==n.name&&(e[n.name.toLowerCase()]=1);let n=0;for(const t of r)if("%%%%FIELDNAME"===t.name){for(;1===e["field_"+n.toString()];)n++;e["field_"+n.toString()]=1,t.name="FIELD_"+n.toString()}}for(const t of r)await d(t.expression,e,n);return o[0].groupby(r,[])}return function(e,n,t,a){if(1===a.length){if((0,l.l)(a[0]))return(0,r.m)(e,a[0],-1);if((0,l.o)(a[0]))return(0,r.m)(e,a[0].toArray(),-1)}return(0,r.m)(e,a,-1)}("distinct",0,0,o)}))})}t(74569),t(91306),t(76506),t(92143),t(31450),t(71552),t(40642),t(21801),t(34250),t(60474),t(66396),t(86656),t(60991),t(17533),t(6540),t(73796),t(12047),t(21972),t(91055),t(19657),t(6906),t(97714),t(60947),t(2906),t(91597),t(86787),t(35132),t(89623),t(84069),t(44567),t(98380),t(92896),t(22781),t(57251),t(32422),t(3482),t(36097),t(88762),t(32101),t(53785),t(95587),t(33921),t(52228),t(40267),t(82058),t(23761),t(86748),t(15324),t(75067),t(89914),t(14249),t(60217),t(29107),t(30574),t(2157),t(25977),t(58076),t(98242),t(7471),t(54414),t(59465),t(1648),t(8925),t(33957),t(45154),t(16769),t(93603),t(15438),t(593),t(85699),t(55531),t(96055),t(47776),t(18033),t(6331),t(62048),t(4292),t(75626),t(72652),t(29641),t(30493),t(70821),t(82673),t(34229),t(37029),t(96467),t(63571),t(30776),t(48027),t(54174),t(82426),t(29794),t(63130),t(25696),t(98402),t(42775),t(95834),t(34394),t(57150),t(76726),t(20444),t(76393),t(78548),t(2497),t(49906),t(46527),t(11799),t(48649),t(59877),t(9960),t(30823),t(53326),t(92482),t(5853),t(39141),t(38742),t(48243),t(34635),t(10401),t(49900),t(81184),t(33101),t(67477),t(78533),t(74653),t(91091),t(58943),t(70737),t(36834),t(66122),t(8487),t(17817),t(90814),t(15459),t(61847),t(16796),t(16955),t(22401),t(77894),t(55187),t(8586),t(44509),t(69814),t(11305),t(62259),t(44790),t(5909),t(60669),t(48208),t(51589),t(81317),t(1709),t(69218),t(2845),t(81731),t(49214),t(95533),t(94751),t(76733),t(11385),t(55823),t(92847),t(87258),t(9801),t(53523),t(42911),t(46826),t(45433),t(54732),t(31292),t(93314),t(35197),t(27207),t(53426),t(34446),t(55402),t(46646),t(39210),t(90549),t(78303),t(46495),t(56420),t(73173),t(74742),t(28239),t(42870),t(65514),t(46987),t(37453),t(66284),t(87239),t(5777),t(55306),t(65684),t(12158),t(74864),t(63683),t(94479),t(45702),t(51127),t(26822),t(51723),t(23243),t(51669),t(6090),t(3977),t(36741),t(11253),t(90319),t(38822),t(74057),t(48190),t(85557),t(94070),t(43022),t(16218),t(9075),t(71206),t(9352),t(89241),t(91700),t(51979),t(63136),t(32037),t(60698),t(90811),t(60045),t(68681),t(53321),t(86758),t(95310),t(93939),t(238),t(68714),t(20208),t(82933),t(54179),t(10691),t(38949),t(71777),t(19755),t(62554),t(27371),t(78648),t(87558),t(13063),t(17153),t(35962),t(9252),t(67350),t(11471),t(83748),t(28376),t(29027),t(41617),t(47628),t(95873),t(58085),t(96994),t(75025),t(21132),t(80462),t(92200),t(51653),t(22465),t(65775),t(21471),t(9641),t(6210),t(36231),t(89440),t(67541),t(1557),t(47842),t(17298),t(86861),t(39241),t(41864),t(68219),t(6416),t(82377),t(59765),t(77361),t(61261),t(83290),t(29395),t(94303),t(70846),t(21770),t(77807),t(50203),t(6941),t(14460),t(13322),t(47346),t(17055),t(68653),t(2180),t(14327),t(40944),t(71831),t(78893)}}]);