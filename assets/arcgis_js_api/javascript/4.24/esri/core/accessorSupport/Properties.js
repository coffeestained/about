// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../has ../lang ../Logger ../ObjectPool ./interfaces ./Property ./PropertyOrigin ./Store ./tracking ./utils ./tracking/Flags".split(" "),function(x,u,y,q,z,l,v,m,A,r,B,g){q.getLogger("esri.core.accessorSupport.Properties");u=function(){function k(a){this.host=a;this.properties=new Map;this.ctorArgs=null;this.destroyed=!1;this.lifecycle=l.Lifecycle.INITIALIZING;this.store=new A.Store;this._origin=m.OriginId.USER;a=this.host.constructor.__accessorMetadata__;
const b=a.properties;for(const c in b){const e=new v.Property(this,c,b[c]);this.properties.set(c,e)}this.metadatas=b;this._autoDestroy=a.autoDestroy}var d=k.prototype;d.initialize=function(){this.lifecycle=l.Lifecycle.CONSTRUCTING};d.constructed=function(){this.lifecycle=l.Lifecycle.CONSTRUCTED};d.destroy=function(){this.destroyed=!0;if(this._autoDestroy)for(const [b,c]of this.properties){var a=this.internalGet(b);a&&a&&"function"===typeof a.destroy&&(a.destroy(),~c.flags&g.Flags.NonNullable&&this._internalSet(c,
null));c.destroy()}else for([,a]of this.properties)a.destroy()};d.get=function(a){const b=this.properties.get(a);if(b.metadata.get)return b.getComputed();r.trackAccess(b);const c=this.store;return c.has(a)?c.get(a):b.metadata.value};d.originOf=function(a){const b=this.store.originOf(a);return void 0===b&&(a=this.properties.get(a),void 0!==a&&a.flags&g.Flags.HasDefaultValue)?"defaults":m.idToName(b)};d.has=function(a){return this.properties.has(a)?this.store.has(a):!1};d.keys=function(){return[...this.properties.keys()]};
d.internalGet=function(a){const b=this.properties.get(a);if(void 0!==b)return this.store.has(a)?this.store.get(a):b.metadata.value};d.internalSet=function(a,b){a=this.properties.get(a);void 0!==a&&this._internalSet(a,b)};d.getDependsInfo=function(a,b,c){const e=this.properties.get(b);if(void 0===e)return"";const f=new Set;var n=r.runTracked({onObservableAccessed:h=>f.add(h),onTrackingEnd:()=>{}},()=>{var h;return null==(h=e.metadata.get)?void 0:h.call(a)}),p=a.declaredClass.split(".").pop();b=`${c}${p}.${b}: ${n}\n`;
if(0===f.size)return b;c+="  ";for(const h of f){if(!(h instanceof v.Property))continue;n=h.properties.host;p=h.propertyName;const w=B.getProperties(n);b=w?b+w.getDependsInfo(n,p,c):b+`${c}${p}: undefined\n`}return b};d.setAtOrigin=function(a,b,c){a=this.properties.get(a);if(void 0!==a)return this._setAtOrigin(a,b,c)};d.isOverridden=function(a){a=this.properties.get(a);return void 0!==a&&!!(a.flags&g.Flags.Overriden)};d.clearOverride=function(a){a=this.properties.get(a);void 0!==a&&a.flags&g.Flags.Overriden&&
(a.flags&=~g.Flags.Overriden,a.notifyChange())};d.override=function(a,b){a=this.properties.get(a);if(!(void 0===a||null==b&&a.flags&g.Flags.NonNullable)){var c=a.metadata.cast;if(c){b=this._cast(c,b);const {valid:e,value:f}=b;t.release(b);if(!e)return;b=f}a.flags|=g.Flags.Overriden;this._internalSet(a,b)}};d.set=function(a,b){a=this.properties.get(a);if(!(void 0===a||null==b&&a.flags&g.Flags.NonNullable)){var c=a.metadata.cast;if(c){b=this._cast(c,b);const {valid:e,value:f}=b;t.release(b);if(!e)return;
b=f}(c=a.metadata.set)?c.call(this.host,b):this._internalSet(a,b)}};d.setDefaultOrigin=function(a){this._origin=m.nameToId(a)};d.getDefaultOrigin=function(){return m.idToName(this._origin)};d.notifyChange=function(a){a=this.properties.get(a);void 0!==a&&a.notifyChange()};d.invalidate=function(a){a=this.properties.get(a);void 0!==a&&a.invalidate()};d.commit=function(a){a=this.properties.get(a);void 0!==a&&a.commit()};d._internalSet=function(a,b){this._setAtOrigin(a,b,this.lifecycle!==l.Lifecycle.INITIALIZING?
this._origin:m.OriginId.DEFAULTS)};d._setAtOrigin=function(a,b,c){const e=this.store,f=a.propertyName;e.has(f,c)&&y.equals(b,e.get(f))&&~a.flags&g.Flags.Overriden&&c===e.originOf(f)||(a.invalidate(),e.set(f,b,c),a.commit(),r.initializeDependencyTracking(this.host,a))};d._cast=function(a,b){const c=t.acquire();c.valid=!0;c.value=b;a&&(c.value=a.call(this.host,b,c));return c};x._createClass(k,[{key:"initialized",get:function(){return this.lifecycle!==l.Lifecycle.INITIALIZING}}]);return k}();q=function(){function k(){this.value=
null;this.valid=!0}var d=k.prototype;d.acquire=function(){this.valid=!0};d.release=function(){this.value=null};return k}();const t=new z(q);return u});