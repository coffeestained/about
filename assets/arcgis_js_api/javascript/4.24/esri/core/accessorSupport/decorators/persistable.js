// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../maybe ../../multiOriginJSONSupportUtils ../../urlUtils ../../uuid ../metadata ../PropertyOrigin ./property ../../../portal/support/resourceExtension ../../../chunks/persistableUrlUtils".split(" "),function(z,v,A,l,B,q,C,D,E,F,r,p){function G(c,k,d){const h=D.getOwnPropertyMetadata(k,d);return{type:String,read:(b,e,g)=>{b=p.read(b,e,g);if(h.type===String)return b;if("function"===typeof h.type)return new h.type({url:b})},write:{writer(b,
e,g,a){if(a&&a.resources){var f=l.isNone(b)?null:"string"===typeof b?b:b.url;f=f?p.toJSON(f,{...a,verifyItemRelativeUrls:a&&a.verifyItemRelativeUrls?{writtenUrls:a.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null},p.MarkKeep.NO):null;var m=h.type!==String&&(!B.isMultiOriginJSONMixin(this)||a&&a.origin&&this.originIdOf(d)>E.nameToId(a.origin));if(a&&a.portalItem&&l.isSome(f)&&!q.isAbsolute(f))if(m){{m=a.portalItem.resourceFromPath(f);const n=w(b,f,a),t=r.getResourceContentExtension(n),H=q.getPathExtension(m.path);
t!==H?x(this,d,b,f,e,g,a,c):(y(this,d,m,n,a.resources.toUpdate),e[g]=f)}}else a.resources.toKeep.push({resource:a.portalItem.resourceFromPath(f)}),e[g]=f;else a&&a.portalItem&&(l.isNone(f)||l.isSome(p.itemIdFromResourceUrl(f))||q.isBlobProtocol(f)||m)?x(this,d,b,f,e,g,a,c):e[g]=f}else e[g]="string"===typeof b?p.toJSON(b,a):b.write({},a)}}}}function x(c,k,d,h,b,e,g,a){const f=C.generateUUID();d=w(d,h,g);const m=q.join(l.get(a,"prefix"),f);a=`${m}.${r.getResourceContentExtension(d)}`;const n=g.portalItem.resourceFromPath(a);
q.isBlobProtocol(h)&&g.resources.pendingOperations.push(I(h).then(t=>{n.path=`${m}.${r.getResourceContentExtension(t)}`;b[e]=n.itemRelativeUrl}).catch(()=>{}));y(c,k,n,d,g.resources.toAdd);b[e]=n.itemRelativeUrl}function y(c,k,d,h,b){b.push({resource:d,content:h,finish:e=>{"string"===typeof c[k]?c[k]=e.url:c[k].url=e.url}})}function w(c,k,d){return"string"===typeof c?{url:k}:new Blob([JSON.stringify(c.toJSON(d))],{type:"application/json"})}function I(c){return u.apply(this,arguments)}function u(){u=
A._asyncToGenerator(function*(c){const k=(yield new Promise((d,h)=>z(["../../../request"],b=>d(Object.freeze(Object.defineProperty({__proto__:null,default:b},Symbol.toStringTag,{value:"Module"}))),h))).default;({data:c}=yield k(c,{responseType:"blob"}));return c});return u.apply(this,arguments)}v.persistable=function(c){const k=l.isSome(c)&&c.origins?c.origins:[void 0];return(d,h)=>{a:if(l.isSome(c)&&"resource"===c.type)var b=G(c,d,h);else{switch(l.isSome(c)&&c.type?c.type:"other"){case "other":b=
{read:!0,write:!0};break a;case "url":{const {read:e,write:g}=p.persistableUrlUtils;b={read:e,write:g};break a}}b=void 0}for(const e of k){const g=F.propertyJSONMeta(d,e,h);for(const a in b)g[a]=b[a]}}};Object.defineProperties(v,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});