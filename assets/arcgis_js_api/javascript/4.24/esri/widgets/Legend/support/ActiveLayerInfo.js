// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../kernel ../../../request ../../../symbols ../../../core/Accessor ../../../core/Collection ../../../core/Handles ../../../core/jsonMap ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/screenUtils ../../../core/urlUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/PropertyOrigin ../../../layers/effects/EffectView ../../../layers/effects/jsonUtils ../../../layers/support/ExportImageParameters ../../../layers/support/fieldUtils ../../../renderers/support/jsonUtils ../../../renderers/support/rendererConversion ../../../renderers/visualVariables/support/SizeVariableLegendOptions ../../../symbols/support/cimSymbolUtils ../../../symbols/support/previewUtils ../../../symbols/support/renderUtils ../../../symbols/support/symbolUtils ../../../symbols/support/utils ./clusterUtils ./colorRampUtils ./heatmapRampUtils ./relationshipRampUtils ./sizeRampUtils ./utils ../../smartMapping/support/utils ../../../symbols/SimpleMarkerSymbol ../../../symbols/SimpleFillSymbol".split(" "),
function(ka,v,z,X,la,Y,y,ma,na,oa,pa,qa,H,E,C,ra,sa,A,Sa,Ta,Ua,ta,M,ua,va,wa,xa,ya,za,Aa,Ba,Ca,Da,D,Ea,Fa,N,Ga,Z,S,I,Ha,O,aa){function J(q){return"esri.renderers.SimpleRenderer"===q.declaredClass}function K(q){return"esri.renderers.ClassBreaksRenderer"===q.declaredClass}function T(q){return"esri.renderers.UniqueValueRenderer"===q.declaredClass}function ba(q){return"esri.renderers.HeatmapRenderer"===q.declaredClass}function U(q){return"esri.renderers.PointCloudClassBreaksRenderer"===q.declaredClass}
function V(q){return"esri.renderers.PointCloudStretchRenderer"===q.declaredClass}function W(q){return"esri.renderers.PointCloudUniqueValueRenderer"===q.declaredClass}function ca(q){return"esri.renderers.DotDensityRenderer"===q.declaredClass}function da(q){return"esri.renderers.PieChartRenderer"===q.declaredClass}function ea(q){return"esri.layers.BuildingSceneLayer"===q.declaredClass}function Ia(q){q="authoringInfo"in q&&(null==q?void 0:q.authoringInfo);return"univariate-color-size"===(null==q?void 0:
q.type)}function Ja(q){q="authoringInfo"in q&&(null==q?void 0:q.authoringInfo);return"univariate-color-size"===(null==q?void 0:q.type)&&"above-and-below"===(null==q?void 0:q.univariateTheme)}const F=qa.getLogger("esri.widgets.Legend.support.ActiveLayerInfo"),P=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,Ka=new pa.JSONMap({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch"}),fa={u1:[0,1],u2:[0,
3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-3.4*1E39,3.4*1E39],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]},Q=new O({size:6,outline:{color:[128,128,128,.5],width:.5}}),La=new aa({style:"solid"}),Ma=new O({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",size:15,outline:{width:1,color:[85,85,85,1]}});let L={};y=function(q){function R(b){b=q.call(this,b)||this;b._handles=new oa;b._hasColorRamp=!1;b._hasOpacityRamp=!1;b._hasSizeRamp=
!1;b._webStyleSymbolCache=new Map;b._dotDensityUrlCache=new Map;b._scaleDrivenSizeVariable=null;b._hasClusterSizeVariable=!1;b.children=new na;b.layerView=null;b.layer=null;b.legendElements=[];b.parent=null;b.hideLayersNotInCurrentView=!1;b.keepCacheOnDestroy=!1;b.respectLayerVisibility=!0;b.sublayerIds=[];b.title=null;b.view=null;return b}v._inheritsLoose(R,q);var l=R.prototype;l.initialize=function(){const b=()=>this.notifyChange("ready");this._handles.add([C.on(()=>this.children,"change",a=>{const {added:c,
removed:d}=a,e=this._handles;c.forEach(f=>{const g=`activeLayerInfo-ready-watcher-${f.layer.uid}`;e.add(C.watch(()=>f.ready,b,C.initial),g)});d.forEach(f=>e.remove(f.layer.uid));b()})]);this.keepCacheOnDestroy||(L={})};l.destroy=function(){this._handles.destroy();this._scaleDrivenSizeVariable=this._dotDensityUrlCache=this._webStyleSymbolCache=this._handles=null;this.keepCacheOnDestroy||(L=null)};l.buildLegendElementsForFeatureCollections=function(){var b=v._asyncToGenerator(function*(a){if(this.hideLayersNotInCurrentView&&
!(yield this._isLayerInCurrentView()))this.legendElements=[],this.notifyChange("ready");else{a=Array.from(a,c=>{if("esri.layers.FeatureLayer"===c.declaredClass)return this._getRendererLegendElements(c.renderer,{title:c.title});if(c.featureSet&&c.featureSet.features.length){var d=c.layerDefinition,e=d&&d.drawingInfo;e=e&&ya.fromJSON(e.renderer);d=Ka.read(d.geometryType);return e?this._getRendererLegendElements(e,{title:c.name,geometryType:d}):(F.warn("drawingInfo not available!"),null)}return null});
try{const c=[];yield E.eachAlways(a).then(d=>{d.forEach(({value:e})=>e&&c.push(...e))});this.legendElements=c;this.notifyChange("ready")}catch(c){F.warn("error while building legend for layer!",c)}}});return function(a){return b.apply(this,arguments)}}();l.buildLegendElementsForRenderer=function(){var b=v._asyncToGenerator(function*(a){try{this.legendElements=(this.hideLayersNotInCurrentView?yield this._isLayerInCurrentView():1)?yield this._getRendererLegendElements(a):[],this.notifyChange("ready")}catch(c){F.warn("error while building legend for layer!",
c)}});return function(a){return b.apply(this,arguments)}}();l.buildLegendElementsForTools=function(){var b=v._asyncToGenerator(function*(){var a=this;const c=this.layer;if("esri.layers.VoxelLayer"===c.declaredClass)this._constructLegendElementsForVoxellayer();else if("esri.layers.WMTSLayer"===c.declaredClass)this._constructLegendElementsForWMTSlayer();else if("esri.layers.WMSLayer"===c.declaredClass)yield this._constructLegendElementsForWMSSublayers();else if(ea(c))yield this._constructLegendElementsForBuildingSceneLayer();
else if("esri.layers.MapImageLayer"===c.declaredClass||"esri.layers.TileLayer"===c.declaredClass||ea(c))yield this._constructLegendElementsForSublayers();else{this._handles.remove("imageryLayers-watcher");var d="default";if("esri.layers.ImageryLayer"===c.declaredClass){var e,f;d=(null==c?void 0:null==(e=c.renderingRule)?void 0:e.functionName)||"default";e=null!=(f=c.bandIds)&&f.length?c.bandIds.join(""):"###";d=d+"_"+e}yield this._getLegendLayers(`${c.uid}-${d}`).then(function(){var g=v._asyncToGenerator(function*(h){a.legendElements=
[];a.notifyChange("ready");h=h.map(function(){var m=v._asyncToGenerator(function*(r){if("esri.layers.ImageryLayer"===c.declaredClass||"esri.layers.ImageryTileLayer"===c.declaredClass){const t=C.watch(()=>["renderingRule"in c&&c.renderingRule,c.bandIds],()=>E.debounce(v._asyncToGenerator(function*(){L["default"]=null;c.renderer?yield a.buildLegendElementsForRenderer(c.renderer):yield a.buildLegendElementsForTools()}))());a._handles.add(t,"imageryLayers-watcher")}(r=a._generateSymbolTableElementForLegendLayer(r))&&
r.infos.length&&("esri.layers.ImageryLayer"===c.declaredClass&&(r.title=c.title),a.legendElements.push(r));a.notifyChange("ready")});return function(r){return m.apply(this,arguments)}}());yield E.eachAlways(h)});return function(h){return g.apply(this,arguments)}}()).catch(g=>{F.warn("Request to server for legend has failed!",g)})}});return function(){return b.apply(this,arguments)}}();l._isLayerInCurrentView=function(){var b=v._asyncToGenerator(function*(){const a=this.layer,c=this.layerView,d=c&&
"createQuery"in c&&"queryFeatureCount"in c;if(!(d||c&&"createQuery"in a&&"queryFeatureCount"in a))return!0;yield C.whenOnce(()=>!c.updating);const e=d?"createQuery"in c&&c.createQuery():"createQuery"in a&&a.createQuery();e.geometry=this.view.extent;return 0!==(d?"queryFeatureCount"in c&&(yield c.queryFeatureCount(e)):"queryFeatureCount"in a&&(yield a.queryFeatureCount(e)))});return function(){return b.apply(this,arguments)}}();l._getParentLayerOpacity=function(b){let a=1;const c=b.parent;c&&"uid"in
c&&(a=this._getParentLayerOpacity(c));return b.opacity*a};l._isGroupActive=function(){const b=this.children;return b.length?b.some(a=>a.ready):!1};l._isRendererScaleDriven=function(b){return"dot-density"===b.type||P.test("valueExpression"in b&&b.valueExpression)?!0:(b="visualVariables"in b&&b.visualVariables)?b.some(a=>this._isScaleDrivenSizeVariable(a)):!1};l._isScaleDrivenSizeVariable=function(b){if(b&&"size"!==b.type)return!1;const a=b.minSize,c=b.maxSize;return"object"===typeof a&&a?this._isScaleDrivenSizeVariable(a):
"object"===typeof c&&c?this._isScaleDrivenSizeVariable(c):!!b.expression||P.test(b.valueExpression)};l._isLayerScaleDriven=function(b){if("minScale"in b&&0<b.minScale||"maxScale"in b&&0<b.maxScale)return!0;if("sublayers"in b&&b.sublayers)return b.sublayers.some(c=>this._isLayerScaleDriven(c));const a=b.parent;if(!1===b.loaded&&a&&"esri.layers.MapImageLayer"===a.declaredClass&&"source"in b&&b.source&&"map-layer"===b.source.type)for(const c of a.sourceJSON.layers)if(c.id===b.source.mapLayerId&&(0<c.minScale||
0<c.maxScale))return!0;return!1};l._constructLegendElementsForVoxellayer=function(){var b=v._asyncToGenerator(function*(){this.legendElements=[];this._handles.remove("voxel-style-watcher");const a=this.layer;this._handles.add(C.watch(()=>a.currentVariableId,()=>this._constructLegendElementsForVoxellayer()),"voxel-style-watcher");var c=H.unwrap(a.getVariableStyle(null));const d=[];if(c){var e;if(null!=(e=c.uniqueValues)&&e.length){const g=[];c.uniqueValues.forEach(h=>{h.enabled&&g.push({label:h.label||
`${h.value}`,value:h.value,symbol:new aa({color:h.color,outline:null})})});g.length&&d.push({type:"symbol-table",title:c.label,infos:g})}else if(c.transferFunction){const {colorStops:g,stretchRange:h}=c.transferFunction;e=g.toArray().reverse();const m=h.map((t,k)=>`${0===k?I.SPECIAL_CHARS_LESS_THAN:I.SPECIAL_CHARS_GREATER_THAN} ${Ha.formatNumberLabel(t)}`).reverse(),r=e.map(t=>({color:t.color,value:null,label:null}));r[0].label=m[0];r[r.length-1].label=m[1];d.push({type:"color-ramp",title:c.label,
infos:r,preview:D.renderColorRampPreviewHTML(e.map(t=>t.color))})}}const f=a.opacity;c=d.reduce((g,h)=>g.concat(this._getAllInfos(h)),[]).filter(g=>!(null==g||!g.symbol)).map(g=>this._getSymbolPreview(g,f));yield E.eachAlways(c);this.legendElements=d;this.notifyChange("ready")});return function(){return b.apply(this,arguments)}}();l._constructLegendElementsForWMTSlayer=function(){this.legendElements=[];this._handles.remove("wmts-activeLayer-watcher");const b=this.layer.activeLayer;this._handles.add(C.watch(()=>
{const {layer:a}=this;return a&&"activeLayer"in a&&a.activeLayer},()=>this._constructLegendElementsForWMTSlayer()),"wmts-activeLayer-watcher");if(b.styleId&&b.styles){let a=null;b.styles.some(c=>b.styleId===c.id?(a=c.legendUrl,!0):!1);a&&(this.legendElements=[{type:"symbol-table",title:b.title,infos:[{src:a,opacity:this.opacity}]}])}this.notifyChange("ready")};l._constructLegendElementsForWMSSublayers=function(){var b=v._asyncToGenerator(function*(){this.legendElements=[];this._handles.remove("wms-sublayers-watcher");
const a=this.layer;let c=null;if(a.customParameters||a.customLayerParameters)c={...a.customParameters,...a.customLayerParameters};this._handles.add(C.watch(()=>{const {layer:d}=this;return d&&"sublayers"in d&&d.sublayers},()=>this._constructLegendElementsForWMSSublayers()),"wms-sublayers-watcher");this.legendElements=yield this._generateLegendElementsForWMSSublayers(a.sublayers,c);this.notifyChange("ready")});return function(){return b.apply(this,arguments)}}();l._generateLegendElementsForWMSSublayers=
function(){var b=v._asyncToGenerator(function*(a,c){const d=[];this._handles.add(a.on("change",()=>this._constructLegendElementsForWMSSublayers()),"wms-sublayers-watcher");a=a.toArray();for(const e of a)a=C.watch(()=>[e.title,e.visible,e.legendEnabled],()=>this._constructLegendElementsForWMSSublayers()),this._handles.add(a,"wms-sublayers-watcher"),(!this.respectLayerVisibility||e.visible&&e.legendEnabled)&&(a=yield this._generateSymbolTableElementForWMSSublayer(e,c))&&a.infos.length&&d.unshift(a);
return d});return function(a,c){return b.apply(this,arguments)}}();l._generateSymbolTableElementForWMSSublayer=function(){var b=v._asyncToGenerator(function*(a,c){return!a.legendUrl&&a.sublayers?(c=(yield this._generateLegendElementsForWMSSublayers(a.sublayers,c)).filter(d=>d),{type:"symbol-table",title:a.title,infos:c}):this._generateSymbolTableElementForLegendUrl(a,c)});return function(a,c){return b.apply(this,arguments)}}();l._generateSymbolTableElementForLegendUrl=function(){var b=v._asyncToGenerator(function*(a,
c){var d;let e=a.legendUrl;if(e){var f={type:"symbol-table",title:a.title||a.name||a.id&&a.id+"",infos:[]};c&&(e=sa.addQueryParameters(e,c));c=null;a=null==(d=a.layer)?void 0:d.opacity;try{if(c=(yield Y(e,{responseType:"image"})).data)c.style.opacity=a}catch{}f.infos.push({src:e,preview:c,opacity:a});return f}});return function(a,c){return b.apply(this,arguments)}}();l._getLegendLayers=function(b,a){const c=L&&L[b];return c?Promise.resolve(c):this._legendRequest(a).then(d=>{d=d.layers;return L[b]=
d})};l._legendRequest=function(b){var a=this.layer;b={f:"json",dynamicLayers:b};if("esri.layers.ImageryLayer"===a.declaredClass){var c=a.exportImageServiceParameters.renderingRule;c&&(b.renderingRule=JSON.stringify(c.rasterFunctionDefinition||c.toJSON()));a.bandIds&&(b.bandIds=a.bandIds.join());if(a.raster||a.viewId||a.customParameters){const {raster:d,viewId:e,customParameters:f}=a;b={raster:d,viewId:e,...b,...f}}}c=a.url.replace(/(\/)+$/,"");"version"in a&&10.01<=a.version?(a=c.indexOf("?"),c=-1<
a?c.substring(0,a)+"/legend"+c.substring(a):c+"/legend"):(a=c.toLowerCase().indexOf("/rest/"),a=c.substring(0,a)+c.substring(a+5,c.length),c="https://utility.arcgis.com/sharing/tools/legend?soapUrl\x3d"+encodeURI(a)+"\x26returnbytes\x3dtrue");return Y(c,{query:b}).then(d=>d.data)};l._constructLegendElementsForBuildingSceneLayer=function(){var b=v._asyncToGenerator(function*(){this.legendElements=[];this._handles.remove("sublayers-watcher");const a=this.layer;this._handles.add(C.watch(()=>a.sublayers,
()=>this._constructLegendElementsForBuildingSceneLayer()),"sublayers-watcher");try{this.legendElements=yield this._generateLegendElementsForBuildingSublayers(a.sublayers,this.opacity),this.notifyChange("ready")}catch(c){F.warn("Request to server for legend has failed!",c)}});return function(){return b.apply(this,arguments)}}();l._generateLegendElementsForBuildingSublayers=function(){var b=v._asyncToGenerator(function*(a,c){let d=[];this._handles.add(a.on("change",()=>this._constructLegendElementsForBuildingSceneLayer()),
"sublayers-watcher");a=a.toArray();for(const f of a)if(a=C.watch(()=>["renderer"in f&&f.renderer,f.opacity,f.title,f.visible],()=>this._constructLegendElementsForBuildingSceneLayer()),this._handles.add(a,"sublayers-watcher"),!this.respectLayerVisibility||f.visible){a=f&&null!=f.opacity?f.opacity:null;var e=null!=a?a*c:c;"building-group"===f.type?(a={type:"symbol-table",title:f.title,infos:[]},e=yield this._generateLegendElementsForBuildingSublayers(f.sublayers,e),a.infos.push(...e),d=[a,...d]):f.renderer&&
(d=[...yield this._getRendererLegendElements(f.renderer,{title:f.title,opacity:e,sublayer:f}),...d])}return d.filter(f=>!!f&&("infos"in f?0<f.infos.length:!0))});return function(a,c){return b.apply(this,arguments)}}();l._constructLegendElementsForSublayers=function(){var b=v._asyncToGenerator(function*(){this.legendElements=[];this._handles.remove("sublayers-watcher");const a=this.layer;this._handles.add(C.watch(()=>a.sublayers,()=>this._constructLegendElementsForSublayers),"sublayers-watcher");try{this.legendElements=
yield this._generateLegendElementsForSublayers(a.sublayers,this.opacity),this.notifyChange("ready")}catch(c){F.warn("Request to server for legend has failed!",c)}});return function(){return b.apply(this,arguments)}}();l._generateLegendElementsForSublayers=function(){var b=v._asyncToGenerator(function*(a,c,d){const e=this.layer;let f=[];this._handles.add(a.on("change",()=>this._constructLegendElementsForSublayers()),"sublayers-watcher");a=a.toArray();!d&&this.sublayerIds&&this.sublayerIds.length&&
(a=this.sublayerIds.map(g=>e.findSublayerById(g)).filter(Boolean));for(const g of a)if(a=C.watch(()=>[g.renderer,g.opacity,g.title,g.visible,g.legendEnabled],()=>this._constructLegendElementsForSublayers()),this._handles.add(a,"sublayers-watcher"),!this.respectLayerVisibility||g.visible&&g.legendEnabled&&this._isSublayerInScale(g))a=g&&null!=g.opacity?g.opacity:null,a=null!=a?a*c:c,g.renderer&&!g.sublayers&&g.originIdOf("renderer")>M.OriginId.SERVICE?(yield g.load(),f=[...yield this._getRendererLegendElements(g.renderer,
{title:g.title,opacity:a,sublayer:g}),...f]):(a=yield this._generateSymbolTableElementForSublayer(g,a,d))&&f.unshift(a);return f.filter(g=>!!g&&("infos"in g?0<g.infos.length:!0))});return function(a,c,d){return b.apply(this,arguments)}}();l._generateSymbolTableElementForSublayer=function(){var b=v._asyncToGenerator(function*(a,c,d){if(!d){d=new Map;var e=this.layer,f=a.source;let g=null;if(f&&("map-layer"!==f.type||f.mapLayerId!==a.id||f.gdbVersion&&f.gdbVersion!==("gdbVersion"in e&&e.gdbVersion))||
a.originIdOf("renderer")>M.OriginId.SERVICE||a.originIdOf("labelingInfo")>M.OriginId.SERVICE||a.originIdOf("labelsVisible")>M.OriginId.SERVICE)f=new wa.ExportImageParameters({layer:this.layer}),g=f.hasDynamicLayers?f.dynamicLayers:null,f.destroy();(yield this._getLegendLayers(g||`${e.uid}-default`,g)).forEach(h=>d.set(h.layerId,h))}e=d.get(a.id);return(!e||null!=e&&e.subLayerIds&&e.defaultVisibility)&&a.sublayers?(c=yield this._generateLegendElementsForSublayers(a.sublayers,c,d),{type:"symbol-table",
title:a.title,infos:c}):this._generateSymbolTableElementForLegendLayer(e,a,c)});return function(a,c,d){return b.apply(this,arguments)}}();l._generateSymbolTableElementForLegendLayer=function(b,a,c){var d;if(!b||!b.legend||this.respectLayerVisibility&&!this._isLegendLayerInScale(b,a))return null;var e=null==a?void 0:a.renderer;let f=(null==a?void 0:a.title)||b.layerName;e&&(!a||(null==a?void 0:a.originIdOf("renderer"))>M.OriginId.SERVICE)&&(e=(null==a?void 0:a.title)||this._getRendererTitle(e,a))&&
(f&&"string"!==typeof e&&"title"in e&&(e.title=f),f=e);const g={type:"symbol-table",title:f,legendType:b.legendType?b.legendType:null,infos:[]},h=a?this._sanitizeLegendForSublayer(b.legend.slice(),a):b.legend;0<(null==(d=b.legendGroups)?void 0:d.length)?b.legendGroups.forEach(m=>{var r;const t={type:"symbol-table",title:m.heading,legendType:b.legendType?b.legendType:null,infos:this._generateSymbolTableElementInfosForLegendLayer(h.filter(k=>k.groupId===m.id),b.layerId,c)};0<(null==(r=t.infos)?void 0:
r.length)&&g.infos.push(t)}):g.infos=this._generateSymbolTableElementInfosForLegendLayer(h,b.layerId,c);return 0<g.infos.length?g:null};l._generateSymbolTableElementInfosForLegendLayer=function(b,a,c){return b.map(d=>{let e=d.url;if(d.imageData&&0<d.imageData.length)e=`data:image/png;base64,${d.imageData}`;else if(0!==e.indexOf("http"))e=la.addTokenParameter(`${this.layer.url}/${a}/images/${e}`);else return null;return{label:d.label,src:e,opacity:null==c?this.opacity:c,width:d.width,height:d.height}}).filter(d=>
!!d)};l._isSublayerInScale=function(b){const a=b.minScale||0;b=b.maxScale||0;return 0<a&&a<this.scale||b>this.scale?!1:!0};l._isLegendLayerInScale=function(b,a){a=a||this.layer;let c=null,d=null,e=!0;!a.minScale&&0!==a.minScale||!a.maxScale&&0!==a.maxScale?(0===b.minScale&&a.tileInfo&&(c=a.tileInfo.lods[0].scale),0===b.maxScale&&a.tileInfo&&(d=a.tileInfo.lods[a.tileInfo.lods.length-1].scale)):(c=Math.min(a.minScale,b.minScale)||a.minScale||b.minScale,d=Math.max(a.maxScale,b.maxScale));if(0<c&&c<this.scale||
d>this.scale)e=!1;return e};l._sanitizeLegendForSublayer=function(b,a){if("version"in this.layer&&10.1>this.layer.version||0===b.length)return b;a=a.renderer;let c=null,d=null;b.some(e=>e.values)&&b.some((e,f)=>{e.values||(c=f,d=e,d.label||(d.label="others"));return null!=d});a?"unique-value"===a.type?d&&(b.splice(c,1),b.push(d)):"class-breaks"===a.type&&(d&&b.splice(c,1),b.reverse(),d&&b.push(d)):d&&(b.splice(c,1),b.push(d));return b};l._getRendererLegendElements=function(){var b=v._asyncToGenerator(function*(a,
c={}){var d=this.view;d=J(a)||K(a)||T(a)||ba(a)||ca(a)||da(a)?"2d"===d.type||za.isSupportedRenderer3D(a):"raster-stretch"===a.type||"raster-colormap"===a.type||"raster-shaded-relief"===a.type||U(a)||V(a)||W(a)||"vector-field"===a.type||"flow"===a.type;return d?U(a)||V(a)||W(a)||"esri.renderers.PointCloudRGBRenderer"===a.declaredClass?this._constructPointCloudRendererLegendElements(a,c):ca(a)?this._constructDotDensityRendererLegendElements(a):da(a)?this._constructPieChartRendererLegendElements(a):
this._constructRendererLegendElements(a,c):(F.warn(`Renderer of type '${a.type}' not supported!`),[])});return function(a){return b.apply(this,arguments)}}();l._getPointCloudRendererTitle=function(b){return b.legendOptions&&b.legendOptions.title||b.field};l._constructPointCloudRendererLegendElements=function(b,a={}){a=a.title;const c=[];let d=null;var e=null;if(U(b))d={type:"symbol-table",title:a||this._getPointCloudRendererTitle(b),infos:[]},b.colorClassBreakInfos.forEach(f=>{d.infos.unshift({label:f.label||
f.minValue+" - "+f.maxValue,value:[f.minValue,f.maxValue],symbol:this._getAppliedCloneSymbol(Q,f.color)})});else if(V(b)){e=b.stops;let f=null;if(e.length&&(1===e.length&&(f=e[0].color),!f)){const g=e[0].value,h=e[e.length-1].value;null!=g&&null!=h&&(f=N.getColorFromPointCloudStops(g+(h-g)/2,e))}d={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(Q,f||Q.color)}]};e=N.getRampStopsForPointCloud(b.stops);e={type:"color-ramp",title:a||this._getPointCloudRendererTitle(b),
infos:e,preview:D.renderColorRampPreviewHTML(e.map(g=>g.color))}}else W(b)&&(d={type:"symbol-table",title:a||this._getPointCloudRendererTitle(b),infos:[]},b.colorUniqueValueInfos.forEach(f=>{d.infos.push({label:f.label||f.values.join(", "),value:f.values.join(", "),symbol:this._getAppliedCloneSymbol(Q,f.color)})}));d&&d.infos.length&&c.push(d);e&&e.infos.length&&c.push(e);a=c.reduce((f,g)=>f.concat(g.infos),[]).filter(f=>!!f.symbol).map(f=>this._getSymbolPreview(f,this.opacity,{symbolConfig:{applyColorModulation:!!b.colorModulation}}));
return E.eachAlways(a).then(()=>c)};l._getElementInfoForDotDensity=function(b,a){const {backgroundColor:c,outline:d,dotSize:e}=b;var f=this.effectList;f=null==f?void 0:f.effects.map(h=>h.toJSON());f=va.effectFunctionsFromJSON(f);f=e+"-"+a+"-"+c+"-"+(d&&JSON.stringify(d.toJSON()))+"-"+f;const g=this._dotDensityUrlCache;b=g.has(f)?g.get(f):D.renderDotDensityPreviewHTML(b,a);g.set(f,b);a=Da.renderSymbol([[{shape:{type:"image",x:0,y:0,width:b.width,height:b.height,src:b.src},fill:null,stroke:null,offset:[0,
0]}]],[b.width,b.height],{effectView:this.effectList});return{opacity:1,src:b.src,preview:a,width:b.width,height:b.height}};l._constructDotDensityRendererLegendElements=function(b){const a=b.calculateDotValue(this.view.scale),c={type:"symbol-table",title:{value:a&&Math.round(a),unit:b.legendOptions&&b.legendOptions.unit||""},infos:[]};b.attributes.forEach(d=>{const e=this._getElementInfoForDotDensity(b,d.color);e.label=d.label||d.valueExpressionTitle||d.field;c.infos.push(e)});return Promise.resolve([c])};
l._constructPieChartRendererLegendElements=function(){var b=v._asyncToGenerator(function*(a){var c,d,e;const f=this.layer.opacity,g=[],h=a.outline;a.attributes.forEach(t=>{const k=new O({color:t.color,outline:h});g.push({label:t.label||t.valueExpressionTitle||t.field,symbol:k})});var m=g.length?[...g]:[];null!=(c=a.othersCategory)&&c.color&&0!==(null==(d=a.othersCategory)?void 0:d.threshold)&&(c=new O({color:a.othersCategory.color,outline:h}),g.push({label:a.othersCategory.label||"Others",symbol:c}));
null!=(e=a.defaultColor)&&e.a&&(e=new O({color:a.defaultColor,outline:h}),g.push({label:a.defaultLabel,symbol:e}));e=(yield this._getVisualVariableLegendElements(a,this.layer))||[];if(g.length){var r;e.unshift({type:"symbol-table",title:null,infos:g});m=m.filter(t=>"Others"!==t.label).map(t=>t.symbol.color).filter(Boolean);m=D.renderPieChartPreviewHTML(m,{holePercentage:a.holePercentage,backgroundColor:null==(r=a.backgroundFillSymbol)?void 0:r.color,effectList:this.effectList,outline:h});e.unshift({type:"pie-chart-ramp",
title:this._getRendererTitle(a,this.layer),infos:g,preview:m})}a=e.reduce((t,k)=>t.concat(this._getAllInfos(k)),[]).filter(t=>!(null==t||!t.symbol)&&!(null!=t&&t.preview)).map(t=>this._getSymbolPreview(t,f,{effectList:this.effectList}));yield E.eachAlways(a);return e});return function(a){return b.apply(this,arguments)}}();l._constructRendererLegendElements=function(){var b=v._asyncToGenerator(function*(a,c={}){const {title:d,sublayer:e}=c,f=e||this.layer;a=yield this._loadRenderer(a);this._hasSizeRamp=
this._hasOpacityRamp=this._hasColorRamp=!1;this._scaleDrivenSizeVariable=null;const g=(yield this._getVisualVariableLegendElements(a,f))||[],h={type:"symbol-table",title:d||this._getRendererTitle(a,f),infos:[]};let m=null,r=!1;const t=new Set;if("flow"!==a.type||this._hasSizeRamp)if(Ia(a)){var k=d,n=Ja(a)?"univariate-above-and-below-ramp":"univariate-color-size-ramp",w=g.findIndex(p=>"color-ramp"===p.type);w=-1!==w?g.splice(w,1)[0]:null;var u=g.findIndex(p=>"size-ramp"===p.type);u=-1!==u?g.splice(u,
1)[0]:null;var x=[];w&&(k=w.title,x.push(w));u&&(k=u.title,x.push(u));0<x.length&&g.push({type:n,title:k,infos:x})}else if(ba(a))k=Ga.getHeatmapRampStops(a),g.push({type:"heatmap-ramp",title:d||(null==(u=a.legendOptions)?void 0:u.title),infos:k,preview:D.renderColorRampPreviewHTML(k.map(p=>p.color),{effectList:this.effectList})});else if(T(a)){if((n=a&&a.authoringInfo)&&"relationship"===n.type){const {focus:p,numClasses:B,field1:ha,field2:ia}=n;if(B&&ha&&ia){w=[ha,ia];n=Z.getRotationAngleForFocus(p)||
0;for(k of w){const {field:Na,normalizationField:ja,label:Oa}=k;w=Oa||{field:this._getFieldAlias(Na,f),normField:ja&&this._getFieldAlias(ja,f)};u=Ma.clone();u.angle=n;h.infos.push({label:w,symbol:u});t.add(u);n+=90}k=Z.getRelationshipRampElement({focus:p,numClasses:B,infos:a.uniqueValueInfos});g.unshift(k)}}else{const p=a.field;a.uniqueValueInfos.forEach(B=>{B.symbol&&h.infos.push({label:B.label||this._getDomainName(p,B.value,f)||B.value,value:B.value,symbol:B.symbol})})}a.defaultSymbol&&(h.infos.push({label:a.defaultLabel||
"others",symbol:a.defaultSymbol}),r=!0)}else if(K(a))m=this._isUnclassedRenderer(a),m&&this._hasSizeRamp||(a.classBreakInfos.forEach(p=>{p.symbol&&h.infos.unshift({label:p.label||(m?null:p.minValue+" - "+p.maxValue),value:[p.minValue,p.maxValue],symbol:p.symbol})}),m&&(h.title=null),this._updateInfosforClassedSizeRenderer(a,h.infos)),a.defaultSymbol&&!m&&(h.infos.push({label:a.defaultLabel||"others",symbol:a.defaultSymbol}),r=!0);else if("raster-stretch"===a.type)if("esri.layers.ImageryTileLayer"===
this.layer.declaredClass||"esri.layers.WCSLayer"===this.layer.declaredClass)k=this._constructTileImageryStretchRendererElements(a),"stretch-ramp"===k.type?g.push(k):h.infos=k;else{k=this.layer;a.statistics&&a.statistics.length&&(n=null!=a.statistics[0].min?a.statistics[0].min:a.statistics[0][0],w=null!=a.statistics[0].max?a.statistics[0].max:a.statistics[0][1]);u=[];u=H.unwrap(k.renderingRule?yield k.generateRasterInfo(k.renderingRule):k.serviceRasterInfo);const p=u.keyProperties.BandProperties;x=
fa[k.rasterInfo.pixelType.toLowerCase()];1===u.bandCount?(n=null!=n?n:u.statistics?u.statistics[k.bandIds[0]].min:x[0],w=null!=w?w:u.statistics?u.statistics[k.bandIds[0]].max:x[1],n||w?g.push(this._getStretchLegendElements(a,{min:n,max:w})):this._getServerSideLegend()):k.bandIds&&1===k.bandIds.length?(n=null!=n?n:u.statistics?u.statistics[k.bandIds[0]].min:x[0],w=null!=w?w:u.statistics?u.statistics[k.bandIds[0]].max:x[1],n||w?g.push(this._getStretchLegendElements(a,{min:n,max:w})):this._getServerSideLegend()):
3<=u.bandCount?p&&p.length>=u.bandCount?k.bandIds&&3===k.bandIds.length?(u=k.bandIds.map(B=>p[B].BandName),h.infos=this._createSymbolTableElementMultiBand(u)):"lerc"===k.format?(u=[0,1,2].map(B=>p[B].BandName),h.infos=this._createSymbolTableElementMultiBand(u)):this._getServerSideLegend():"lerc"===k.format?(u=["band1","band2","band3"],h.infos=this._createSymbolTableElementMultiBand(u)):this._getServerSideLegend():this._getServerSideLegend()}else if("raster-colormap"===a.type)a.colormapInfos.forEach(p=>
{h.infos.push({label:p.label,value:p.value,symbol:this._getAppliedCloneSymbol(La,p.color)})});else if(J(a)){k=a.symbol;switch(c.geometryType){case "point":k="pointSymbol"in f&&f.pointSymbol;break;case "polyline":k="lineSymbol"in f&&f.lineSymbol;break;case "polygon":k="polygonSymbol"in f&&f.polygonSymbol}a.symbol&&!this._hasSizeRamp&&h.infos.push({label:a.label,symbol:k})}else"vector-field"===a.type?(a.outputUnit&&(this.title="("+a.toJSON().outputUnit+")"),h.title=a.attributeField,k=a.getClassBreakInfos(),
null!=k&&k.length?k.forEach(p=>{h.infos.push({label:p.minValue+" - "+p.maxValue,symbol:p.symbol})}):h.infos.push({label:a.attributeField,symbol:a.getDefaultSymbol()})):"raster-shaded-relief"===a.type&&g.push(this._getStretchLegendElements(a,{min:0,max:255}));else k=yield I.getSymbolForFlowRenderer(a),h.infos.push({label:null,symbol:k});const G=a.defaultSymbol;!G||r||J(a)||m&&!this._hasColorRamp&&!this._hasSizeRamp&&!this._hasOpacityRamp||g.push({type:"symbol-table",infos:[{label:a.defaultLabel||"others",
symbol:G}]});h.infos.length&&g.unshift(h);const Pa=null==c.opacity?this.opacity:c.opacity,Qa=this._isTallSymbol("visualVariables"in a&&a.visualVariables),Ra="esri.layers.ImageryLayer"===this.layer.declaredClass||"esri.layers.ImageryTileLayer"===this.layer.declaredClass;c=g.reduce((p,B)=>p.concat(this._getAllInfos(B)),[]).filter(p=>!(null==p||!p.symbol)).map(p=>this._getSymbolPreview(p,Pa,{isDefault:p.symbol===G,applyScaleDrivenSize:!t.has(p.symbol),symbolConfig:{isTall:Qa,isSquareFill:Ra},effectList:t.has(p.symbol)?
null:this.effectList}));a=null;yield E.eachAlways(c);return g});return function(a){return b.apply(this,arguments)}}();l._getServerSideLegend=function(){setTimeout(()=>this.buildLegendElementsForTools(),0)};l._getAllInfos=function(b){const a=null==b?void 0:b.infos;return a?a.reduce((c,d)=>c.concat(this._getAllInfos(d)),[]):[b]};l._constructTileImageryStretchRendererElements=function(b){function a(r){var t;const k=(null!=e&&null!=(t=e.bandIds)&&t.length?e.bandIds:Array.from(Array(Math.min(f.bandCount,
3)).keys())).map(n=>r&&r[n]&&r[n].BandName||"band"+(n+1));3>k.length?k.push(k[1]):3<k.length&&k.splice(3);return k}var c,d;const e=this.layer,f=e.rasterInfo,g=f.bandCount||b.statistics.length;var h,m=[];m=f.keyProperties&&f.keyProperties.BandProperties;(h=null!=b&&null!=(c=b.statistics)&&c.length?b.statistics:null==f?void 0:f.statistics)?(c=void 0!==h[0].min?h[0].min:h[0][0],h=h[0].max||h[0][1]):(h=fa[e.rasterInfo.pixelType.toLowerCase()],c=h[0],h=h[1]);e.hasStandardTime()&&(c=e.getStandardTimeValue(c),
h=e.getStandardTimeValue(h));if(1===f.bandCount||1===(null==(d=e.bandIds)?void 0:d.length))return this._getStretchLegendElements(b,{min:c,max:h});m=m&&m.length>=g?a(m):a();return this._createSymbolTableElementMultiBand(m)};l._getStretchLegendElements=function(b,a){b=N.getStrectchRampStops(b.colorRamp,a);return{type:"stretch-ramp",title:"",infos:b,preview:D.renderColorRampPreviewHTML(b.map(c=>c.color))}};l._getSizeLegendElement=function(){var b=v._asyncToGenerator(function*(a,c,d,e){return{type:"size-ramp",
title:this._hasClusterSizeVariable?this._getClusterTitle(c):a,infos:yield S.getRampStops(d,c,yield I.getMedianColor(d),this.scale,this.view.type,e)}});return function(a,c,d,e){return b.apply(this,arguments)}}();l._createSymbolTableElementMultiBand=function(b){const a=[],c=["red","green","blue"];b.forEach((d,e)=>{var f;a.push({label:{colorName:c[e],bandName:d},src:I.RGB_IMG_SOURCE[e],opacity:null!=(f=this.opacity)?f:1})});return a};l._updateInfosforClassedSizeRenderer=function(b,a){const c=b.authoringInfo&&
"class-breaks-size"===b.authoringInfo.type,d=b.classBreakInfos.some(e=>Ea.isVolumetricSymbol(e.symbol));if(c&&d){const e=S.REAL_WORLD_MAX_SIZE;b=b.classBreakInfos.length;const f=(e-S.REAL_WORLD_MIN_SIZE)/(1<b?b-1:b);a.forEach((g,h)=>{g.size=e-f*h})}};l._isTallSymbol=function(b){let a=!1,c=!1;if(b)for(let d=0;d<b.length&&(!a||!c);d++){const e=b[d];"size"===e.type&&("height"===e.axis&&(a=!0),"width-and-depth"===e.axis&&(c=!0))}return a&&c};l._getSymbolPreview=function(){var b=v._asyncToGenerator(function*(a,
c,d){var e=null!=d&&d.isDefault||null!=a.size||!this._hasSizeRamp?a.size:ra.px2pt(Ca.SymbolSizeDefaults.size);this._scaleDrivenSizeVariable&&null!=d&&d.applyScaleDrivenSize&&({getSize:e}=yield new Promise((f,g)=>ka(["../../../renderers/visualVariables/support/visualVariableUtils"],f,g)),e=e(this._scaleDrivenSizeVariable,null,{view:this.view.type,scale:this.scale,shape:"simple-marker"===a.symbol.type?a.symbol.style:null}));return D.renderPreviewHTML(a.symbol,{size:e,opacity:c,scale:!1,symbolConfig:null==
d?void 0:d.symbolConfig,effectView:null==d?void 0:d.effectList}).then(f=>{a.preview=f;return a}).catch(()=>{a.preview=null;return a})});return function(a,c,d){return b.apply(this,arguments)}}();l._loadRenderer=function(){var b=v._asyncToGenerator(function*(a){var c,d;const e=[];var f=this.layer;a=a.clone();this._hasClusterSizeVariable=!1;const g="visualVariables"in a&&(null==(c=a.visualVariables)?void 0:c.some(m=>"size"===m.type&&"outline"!==m.target&&!P.test(m.valueExpression)));if(a&&"visualVariables"in
a&&!g&&"featureReduction"in f&&"cluster"===(null==(d=f.featureReduction)?void 0:d.type)&&(c=H.unwrap(Fa.getClusterSizeVariable(this.layerView._effectiveRenderer,this.view)))){f=f.featureReduction;if("clusterMinSize"in f&&"clusterMaxSize"in f){const {clusterMinSize:m,clusterMaxSize:r}=f;c.legendOptions=new Aa({showLegend:m!==r})}a.visualVariables=(a.visualVariables||[]).concat([c]);this._hasClusterSizeVariable=!0}const h=yield I.getMedianColor(a);if(K(a)||T(a))f=(a.classBreakInfos||a.uniqueValueInfos).map(m=>
this._fetchSymbol(m.symbol,h).then(r=>{m.symbol=r}).catch(()=>{m.symbol=null})),Array.prototype.push.apply(e,f);e.push(this._fetchSymbol(a.symbol||a.defaultSymbol,a.defaultSymbol?null:h).then(m=>{this._applySymbolToRenderer(a,m,J(a))}).catch(()=>{this._applySymbolToRenderer(a,null,J(a))}));return E.eachAlways(e).then(()=>a)});return function(a){return b.apply(this,arguments)}}();l._applySymbolToRenderer=function(b,a,c){c?b.symbol=a:b.defaultSymbol=a};l._fetchSymbol=function(){var b=v._asyncToGenerator(function*(a,
c){if(!a)throw Error();if("web-style"===a.type){const d=this._webStyleSymbolCache;try{const e=yield"2d"===this.view.type?a.fetchCIMSymbol({cache:d}):a.fetchSymbol({cache:d});return this._getAppliedCloneSymbol(e,c)}catch{throw F.warn("Fetching web-style failed!"),Error();}}return this._getAppliedCloneSymbol(a,c)});return function(a,c){return b.apply(this,arguments)}}();l._getAppliedCloneSymbol=function(b,a){if(!b||!a)return b;b=b.clone();const c=a&&a.toRgba();b.type.includes("3d")?this._applyColorTo3dSymbol(b,
c):"cim"===b.type?Ba.applyCIMSymbolColor(b,a):b.color&&(b.color=new X(c||b.color));return b};l._applyColorTo3dSymbol=function(b,a){a&&b.symbolLayers.forEach(c=>{c&&(c.material||(c.material={}),c.material.color=new X(a))})};l._getVisualVariableLegendElements=function(){var b=v._asyncToGenerator(function*(a,c){var d=this;if(!("visualVariables"in a&&a.visualVariables)||"vector-field"===a.type)return null;var e=a.visualVariables,f=[];const g=[],h=[];for(const k of e)"color"===k.type?f.push(k):"size"===
k.type?g.push(k):"opacity"===k.type&&h.push(k);e=[...f,...g,...h];let m;if(0===f.length&&K(a)&&a.classBreakInfos&&1===a.classBreakInfos.length)var r=(r=a.classBreakInfos[0])&&r.symbol;0===f.length&&J(a)&&(r=a.symbol);r&&(r.type.includes("3d")?(f=r.symbolLayers.getItemAt(0),"water"===f.type?H.isSome(f.color)&&(m=f.color):H.isSome(f.material)&&H.isSome(f.material.color)&&(m=f.material.color)):r.url||(m=r.color));const t=this.effectList;return(yield Promise.all(e.map(function(){var k=v._asyncToGenerator(function*(n){if(!n.legendOptions||
!1!==n.legendOptions.showLegend){const u="flow"===a.type?n.field:d._getRampTitle(n,c);let x=null;var w="getField"in c&&c.getField&&c.getField(n.field);w=w&&xa.isDateField(w);"color"===n.type?(n=yield N.getRampStops(n,null,w),x={type:"color-ramp",title:u,infos:n,preview:D.renderColorRampPreviewHTML(n.map(G=>G.color),{effectList:t})},d._hasColorRamp||(d._hasColorRamp=!(null==x.infos||!x.infos.length))):"size"===n.type&&"outline"!==n.target?P.test(n.valueExpression)?d._hasClusterSizeVariable||(d._scaleDrivenSizeVariable=
n):(x=yield d._getSizeLegendElement(u,n,a,w),d._hasSizeRamp||(d._hasSizeRamp=!(null==x.infos||!x.infos.length))):"opacity"===n.type&&(n=yield N.getRampStops(n,m,w),x={type:"opacity-ramp",title:u,infos:n,preview:D.renderColorRampPreviewHTML(n.map(G=>G.color),{effectList:t})},d._hasOpacityRamp||(d._hasOpacityRamp=!(null==x.infos||!x.infos.length)));return x&&x.infos?x:null}});return function(n){return k.apply(this,arguments)}}()))).filter(k=>!!k)});return function(a,c){return b.apply(this,arguments)}}();
l._getDomainName=function(b,a,c){return b&&"function"!==typeof b?(c=(b="getField"in c&&c.getField&&c.getField(b))&&"getFieldDomain"in c&&c.getFieldDomain?c.getFieldDomain(b.name):null)&&"coded-value"===c.type?c.getName(a):null:null};l._getClusterTitle=function(b){var a=this.layer;b=b.field;if("featureReduction"in a&&a.featureReduction&&"cluster"===a.featureReduction.type&&(a=a.featureReduction,a=(a="popupTemplate"in a&&a.popupTemplate)&&a.fieldInfos))for(const c of a)if(c.fieldName===b)return"cluster_count"===
b?c.label||{showCount:!0}:c.label;return{showCount:!0}};l._getRampTitle=function(b,a){let c=b.field,d=b.normalizationField,e=!1,f=!1,g=!1;var h=null;c="function"===typeof c?null:c;d="function"===typeof d?null:d;h=b.legendOptions&&b.legendOptions.title;if(null==h)if(b.valueExpressionTitle)h=b.valueExpressionTitle;else{if("renderer"in a&&a.renderer&&"authoringInfo"in a.renderer&&a.renderer.authoringInfo&&a.renderer.authoringInfo.visualVariables)for(b=a.renderer.authoringInfo.visualVariables,h=0;h<b.length;h++){const m=
b[h];if("color"===m.type){if("ratio"===m.style){e=!0;break}if("percent"===m.style){f=!0;break}if("percent-of-total"===m.style){g=!0;break}}}h={field:c&&this._getFieldAlias(c,a),normField:d&&this._getFieldAlias(d,a),ratio:e,ratioPercent:f,ratioPercentTotal:g}}return h};l._getRendererTitle=function(b,a){if(b.legendOptions&&b.legendOptions.title)return b.legendOptions.title;if(b.valueExpressionTitle)return b.valueExpressionTitle;let c=b.field,d=null,e=null;K(b)&&(d=b.normalizationField,e="percent-of-total"===
b.normalizationType);c="function"===typeof c?null:c;d="function"===typeof d?null:d;b=null;if(c||d)b={field:c&&this._getFieldAlias(c,a),normField:d&&this._getFieldAlias(d,a),normByPct:e};return b};l._getFieldAlias=function(b,a){var c="popupTemplate"in a&&a.popupTemplate;c=c&&c.fieldInfos;let d=null;c&&c.some(f=>b===f.fieldName?(d=f,!0):!1);c=null;"getField"in a&&a.getField?c=a.getField(b):"fieldsIndex"in a&&a.fieldsIndex&&(c=a.fieldsIndex.get(b));a=d||c;let e=null;a&&(e=d&&d.label||c&&c.alias||"name"in
a&&a.name||"fieldName"in a&&a.fieldName);return e};l._isUnclassedRenderer=function(b){const a=b.visualVariables;let c=!1;K(b)&&b.classBreakInfos&&1===b.classBreakInfos.length&&a&&(c=b.field?a.some(d=>!(!d||b.field!==d.field||(b.normalizationField||d.normalizationField)&&b.normalizationField!==d.normalizationField)):!!a.length);return c};v._createClass(R,[{key:"effectList",get:function(){const b=this.layer;let a=null;"effect"in b&&b.effect&&(a=new ua.EffectView,a.effect=b.effect,a.end(),a.scale=this.scale);
return a}},{key:"opacity",get:function(){var b;const a=this.layer.opacity,c=null==(b=this.parent)?void 0:b.opacity;b=(b=this.layer.parent)&&"uid"in b?this._getParentLayerOpacity(b):null;return null!=c?c*a:null!=b?b*a:a}},{key:"ready",get:function(){return null===this.layer?!0:0<this.children.length?this._isGroupActive():0<this.legendElements.length}},{key:"scale",get:function(){return this.view&&this.view.scale}},{key:"isScaleDriven",get:function(){const b=this.layer;if(null===b)return!1;if("effect"in
b&&b.effect&&Array.isArray(b.effect))return!0;if("featureReduction"in b&&b.featureReduction){if("cluster"===b.featureReduction.type)return!0;if("binning"===b.featureReduction.type&&"renderer"in b.featureReduction&&b.featureReduction.renderer)return this._isRendererScaleDriven(b.featureReduction.renderer)}return"renderer"in b&&b.renderer?this._isRendererScaleDriven(b.renderer):this._isLayerScaleDriven(this.layer)}},{key:"version",get:function(){return this._get("version")+1}}]);return R}(ma);z.__decorate([A.property()],
y.prototype,"children",void 0);z.__decorate([A.property({readOnly:!0})],y.prototype,"effectList",null);z.__decorate([A.property()],y.prototype,"layerView",void 0);z.__decorate([A.property()],y.prototype,"layer",void 0);z.__decorate([A.property()],y.prototype,"legendElements",void 0);z.__decorate([A.property({readOnly:!0})],y.prototype,"opacity",null);z.__decorate([A.property()],y.prototype,"parent",void 0);z.__decorate([A.property({readOnly:!0,dependsOn:[]})],y.prototype,"ready",null);z.__decorate([A.property()],
y.prototype,"hideLayersNotInCurrentView",void 0);z.__decorate([A.property()],y.prototype,"keepCacheOnDestroy",void 0);z.__decorate([A.property()],y.prototype,"respectLayerVisibility",void 0);z.__decorate([A.property({readOnly:!0})],y.prototype,"scale",null);z.__decorate([A.property()],y.prototype,"sublayerIds",void 0);z.__decorate([A.property({readOnly:!0})],y.prototype,"isScaleDriven",null);z.__decorate([A.property()],y.prototype,"title",void 0);z.__decorate([A.property({readOnly:!0,dependsOn:["ready"],
value:0})],y.prototype,"version",null);z.__decorate([A.property()],y.prototype,"view",void 0);return y=z.__decorate([ta.subclass("esri.widgets.Legend.support.ActiveLayerInfo")],y)});