// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../intl ../../core/Accessor ../../core/HandleOwner ../../core/maybe ../../core/reactiveUtils ../../core/uid ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../layers/support/CodedValueDomain ../../layers/support/Domain ../../layers/support/InheritedDomain ../../layers/support/RangeDomain ../../layers/support/domainUtils ../../layers/support/fieldUtils ../../intl/substitute".split(" "),
function(x,e,d,G,H,h,y,I,f,O,P,Q,J,K,R,S,T,u,n,z){function A(l){return 1E7<=l||-1E7>=l}function B(l){return!!l&&"maxLength"in l}var q;(function(l){l.Text="text";l.Number="number";l.Date="date";l.Unsupported="unsupported"})(q||(q={}));var v;(v||(v={})).TOO_SHORT="length-validation-error::too-short";const C={type:"number"},D={type:"number",intlOptions:{notation:"scientific"}},E={type:"date",intlOptions:{day:"2-digit",month:"2-digit",year:"numeric",hour:"numeric",minute:"numeric",second:"numeric"}},
L=["editable","required","value","visibility"];d=function(l){function w(a){a=l.call(this,a)||this;a._storedValue=null;a._expressionTrackingHandles=new Map;a.arcade=null;a.editableFunction=null;a.id=I.generateUID().toString();a.requiredFunction=null;a.expressionTrackingProvider=null;a.valueFunction=null;a.visibilityFunction=null;a.feature=null;a.field=null;a.fieldElement=null;a.layer=null;a.description=null;a.inputType=null;a.error=null;a.group=null;a.hint=null;a.messages=null;a.name=null;return a}
x._inheritsLoose(w,l);var p=w.prototype;p.initialize=function(){const a=L.filter(b=>"value"!==b);this.own(a.map(b=>y.watch(()=>this.get(`${b}Function`),c=>{h.isSome(c)?this._registerExpressionWithTrackingProvider(b):this._unregisterExpressionWithTrackingProvider(b)},y.syncAndInitial)))};p.destroy=function(){for(const a of this._expressionTrackingHandles.values())a.remove()};p._isDomainCompatible=function(a){const {field:b}=this;if("coded-value"===(null==a?void 0:a.type)){const c=typeof a.codedValues[0].code;
if("string"===c&&n.isStringField(b)||"number"===c&&n.isNumericField(b))return!0}return"range"===(null==a?void 0:a.type)&&n.isNumericField(b)||n.isDateField(b)?!0:!1};p._validate=function(){const {domain:a,field:b,initialFeature:c,minLength:g,required:m,type:r,valid:t,value:k}=this,F=m&&null===k,M=void 0!==t;return!F&&c.getAttribute(b.name)===k&&M?null:F?n.TypeValidationError.INVALID_TYPE:"text"===r&&-1<g&&"string"===typeof k&&k.length<g?v.TOO_SHORT:a?null!==k||m?u.validateDomainValue(a,k):null:n.validateFieldValue(b,
k)};p._isVisibleByDefault=function(){var a;const b=null==(a=this.field)?void 0:a.type;return"oid"!==b&&"global-id"!==b&&!this._isGeometryField()};p._isEditorField=function(){return n.getFeatureEditFields(this.layer).includes(this.name)};p._isGeometryField=function(){return n.getFeatureGeometryFields(this.layer).includes(this.name)};p._shouldUseValueExpression=function(){const a=this._layerFieldAllowsEdits&&!this._configAllowsEdits&&h.isSome(this.valueFunction);a?this._registerExpressionWithTrackingProvider("value"):
this._unregisterExpressionWithTrackingProvider("value");return a};p._toErrorMessage=function(){const {domain:a,field:b,messages:c,minLength:g,value:m,required:r,type:t}=this;var k=this.error;return r&&null===m?c.validationErrors.cannotBeNull:k===u.DomainValidationError.VALUE_OUT_OF_RANGE||k===n.NumericRangeValidationError.OUT_OF_RANGE?(k=u.getDomainRange(a)||n.getFieldRange(b),z.substitute(c.validationErrors.outsideRange,k,{format:{max:"date"===t?E:A(k.max)?D:C,min:"date"===t?E:A(k.min)?D:C}})):k===
u.DomainValidationError.INVALID_CODED_VALUE?c.validationErrors.invalidCodedValue:k===n.TypeValidationError.INVALID_TYPE?c.validationErrors.invalidType:k===v.TOO_SHORT?z.substitute(c.validationErrors.tooShort,{min:g}):null};p._registerExpressionWithTrackingProvider=function(a){const {_expressionTrackingHandles:b,expressionTrackingProvider:c}=this;if(!h.isNone(c)&&!b.has(a)){var g=`evaluated${N(a)}Expression`,m=c.registerExpression(()=>this.notifyChange(g));b.set(a,m)}};p._unregisterExpressionWithTrackingProvider=
function(a){const {_expressionTrackingHandles:b}=this,c=b.get(a);c&&(c.remove(),b.delete(a))};x._createClass(w,[{key:"_configAllowsEdits",get:function(){var a,b,c;const {fieldElement:g,layer:m,name:r}=this;if(h.isSome(g))return g.editableExpression?this.evaluatedEditableExpression:!1!==g.editable;const t="subtype-group"!==(null==m?void 0:m.type)?null==m?void 0:null==(a=m.popupTemplate)?void 0:null==(b=a.fieldInfos)?void 0:b.find(({fieldName:k})=>k===r):null;return null!=(c=null==t?void 0:t.isEditable)?
c:!0}},{key:"_layerFieldAllowsEdits",get:function(){const {field:a,layer:b}=this;return(null==b?void 0:b.capabilities.operations.supportsEditing)&&(null==a?void 0:a.editable)}},{key:"isUsingValueExpression",get:function(){return this._shouldUseValueExpression()}},{key:"evaluatedEditableExpression",get:function(){const {editableFunction:a,spatialReference:b}=this;if(h.isNone(a))return null;const {arcade:c}=this,g=c.arcadeUtils.getViewInfo({spatialReference:b});return c.arcadeUtils.executeFunction(a,
c.arcadeUtils.createExecContext(this.feature,g))}},{key:"evaluatedRequiredExpression",get:function(){const {requiredFunction:a,spatialReference:b}=this;if(h.isNone(a))return null;const {arcade:c}=this,g=c.arcadeUtils.getViewInfo({spatialReference:b});return c.arcadeUtils.executeFunction(a,c.arcadeUtils.createExecContext(this.feature,g))}},{key:"evaluatedVisibilityExpression",get:function(){const {visibilityFunction:a,spatialReference:b}=this;if(h.isNone(a))return null;const {arcade:c}=this,g=c.arcadeUtils.getViewInfo({spatialReference:b});
return c.arcadeUtils.executeFunction(a,c.arcadeUtils.createExecContext(this.feature,g))}},{key:"evaluatedValueExpression",get:function(){const {valueFunction:a,spatialReference:b}=this;if(h.isNone(a))return null;const {arcade:c}=this,g=c.arcadeUtils.getViewInfo({spatialReference:b});return c.arcadeUtils.executeFunction(a,c.arcadeUtils.createExecContext(this.feature,g))}},{key:"initialFeature",set:function(a){this._set("initialFeature",a);this.notifyChange("valid")}},{key:"domain",get:function(){var a,
{typeIdField:b}=this.layer;const c=b===this.name;var g=null==(a=this.field)?void 0:a.domain;if(c&&!g)return{layer:b}=this,b="subtype-group"===b.type?b.sublayers.map(({subtypeCode:m,title:r})=>({id:m,name:r})):b.types.map(({id:m,name:r})=>({code:m,name:r})),new K({name:"__internal-type-based-coded-value-domain__",codedValues:b});({feature:a}=this);b=b&&this.layer.getFieldDomain(this.name,{feature:a})||g;g=h.get(this.fieldElement,"domain");return h.isSome(g)&&this._isDomainCompatible(g)?g:b}},{key:"editable",
get:function(){var a;return this._layerFieldAllowsEdits?null!=(a=this.evaluatedEditableExpression)?a:this._configAllowsEdits:!1}},{key:"errorMessage",get:function(){return this._toErrorMessage()}},{key:"includeTime",get:function(){var a,{fieldElement:b}=this;b=h.isSome(b)&&"datetime-picker"===(null==(a=b.input)?void 0:a.type)?b.input.includeTime:void 0;return void 0===b?!0:b}},{key:"label",get:function(){return h.isSome(this.fieldElement)&&this.fieldElement.label||this.field.alias||this.field.name}},
{key:"maxLength",get:function(){if(this.type===q.Date)return-1;const {field:a,fieldElement:b}=this,c=null==a?void 0:a.length,g=h.isSome(b)&&B(b.input)?b.input.maxLength:NaN;return!isNaN(g)&&-1<=g&&(-1===c||g<=c)?g:c}},{key:"minLength",get:function(){if(this.type===q.Date)return-1;const {field:a,fieldElement:b}=this,c=null==a?void 0:a.length,g=h.isSome(b)&&B(b.input)?b.input.minLength:NaN;return!isNaN(g)&&-1<=g&&(-1===c||g<=c)?g:-1}},{key:"required",get:function(){const {editable:a,evaluatedRequiredExpression:b,
field:c,visible:g}=this;return a?!1===(null==c?void 0:c.nullable)?!0:g&&h.isSome(b)?b:!1:!1},set:function(a){h.isNone(a)?this._clearOverride("required"):this._override("required",a)}},{key:"spatialReference",get:function(){var a;return(null==(a=this.layer)?void 0:a.spatialReference)||null},set:function(a){void 0===a?this._clearOverride("spatialReference"):this._override("spatialReference",a)}},{key:"submittable",get:function(){const {field:a,required:b,valid:c,value:g}=this;return b&&h.isNone(g)?
!1:c?!0:this.initialFeature.getAttribute(a.name)===g}},{key:"type",get:function(){const {field:a}=this;return n.isNumericField(a)?q.Number:n.isStringField(a)?q.Text:n.isDateField(a)?q.Date:q.Unsupported}},{key:"valid",get:function(){const a=this.editable?this._validate():null;this._set("error",a);return null===a}},{key:"value",get:function(){if(this._shouldUseValueExpression()){const a=this.evaluatedValueExpression;return this.type===q.Date&&a instanceof Date?a.getTime():h.isSome(a)&&"object"===typeof a?
a.toString():a}return this.get("_storedValue")},set:function(a){this.notifyChange("evaluatedVisibilityExpression");this.set("_storedValue",a)}},{key:"visible",get:function(){if(this._isEditorField())return!1;if(h.isSome(this.fieldElement)){var a;return null!=(a=this.evaluatedVisibilityExpression)?a:!0}return this._isVisibleByDefault()}}]);return w}(H.HandleOwnerMixin(G));e.__decorate([f.property()],d.prototype,"_storedValue",void 0);e.__decorate([f.property()],d.prototype,"_configAllowsEdits",null);
e.__decorate([f.property()],d.prototype,"_layerFieldAllowsEdits",null);e.__decorate([f.property()],d.prototype,"arcade",void 0);e.__decorate([f.property()],d.prototype,"editableFunction",void 0);e.__decorate([f.property()],d.prototype,"requiredFunction",void 0);e.__decorate([f.property()],d.prototype,"expressionTrackingProvider",void 0);e.__decorate([f.property()],d.prototype,"valueFunction",void 0);e.__decorate([f.property()],d.prototype,"isUsingValueExpression",null);e.__decorate([f.property()],
d.prototype,"visibilityFunction",void 0);e.__decorate([f.property()],d.prototype,"evaluatedEditableExpression",null);e.__decorate([f.property()],d.prototype,"evaluatedRequiredExpression",null);e.__decorate([f.property()],d.prototype,"evaluatedVisibilityExpression",null);e.__decorate([f.property()],d.prototype,"evaluatedValueExpression",null);e.__decorate([f.property()],d.prototype,"feature",void 0);e.__decorate([f.property()],d.prototype,"field",void 0);e.__decorate([f.property()],d.prototype,"fieldElement",
void 0);e.__decorate([f.property()],d.prototype,"initialFeature",null);e.__decorate([f.property()],d.prototype,"layer",void 0);e.__decorate([f.property({aliasOf:"fieldElement.description"})],d.prototype,"description",void 0);e.__decorate([f.property()],d.prototype,"domain",null);e.__decorate([f.property()],d.prototype,"editable",null);e.__decorate([f.property({aliasOf:"fieldElement.input.type"})],d.prototype,"inputType",void 0);e.__decorate([f.property({readOnly:!0})],d.prototype,"error",void 0);
e.__decorate([f.property({dependsOn:["error","messages","value"]})],d.prototype,"errorMessage",null);e.__decorate([f.property()],d.prototype,"group",void 0);e.__decorate([f.property({aliasOf:"fieldElement.hint"})],d.prototype,"hint",void 0);e.__decorate([f.property()],d.prototype,"includeTime",null);e.__decorate([f.property()],d.prototype,"label",null);e.__decorate([f.property()],d.prototype,"maxLength",null);e.__decorate([f.property()],d.prototype,"minLength",null);e.__decorate([f.property()],d.prototype,
"messages",void 0);e.__decorate([f.property({aliasOf:"field.name"})],d.prototype,"name",void 0);e.__decorate([f.property()],d.prototype,"required",null);e.__decorate([f.property()],d.prototype,"spatialReference",null);e.__decorate([f.property()],d.prototype,"submittable",null);e.__decorate([f.property()],d.prototype,"type",null);e.__decorate([f.property()],d.prototype,"valid",null);e.__decorate([f.property({value:null})],d.prototype,"value",null);e.__decorate([f.property()],d.prototype,"visible",
null);d=e.__decorate([J.subclass("esri.widgets.FeatureForm.InputField")],d);const N=l=>l.charAt(0).toUpperCase()+l.slice(1);return d});