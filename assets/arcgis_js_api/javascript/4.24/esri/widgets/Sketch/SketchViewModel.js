// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../symbols ../../core/Collection ../../core/has ../../core/Error ../../core/Evented ../../core/Handles ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/projection ../../geometry/projectionEllipsoid ../../geometry/support/coordsUtils ../../geometry/support/spatialReferenceUtils ../../layers/GraphicsLayer ../../views/DOMContainer ../../views/3d/interactive/editingTools/isSupportedGraphicUtils ../../views/3d/interactive/editingTools/moveGraphic/isSupportedGraphic ../../views/3d/interactive/editingTools/reshapeGraphic/isSupportedGraphic ../../views/3d/interactive/editingTools/transformGraphic/isSupportedGraphic ../../views/draw/support/layerUtils ../../views/input/InputManager ../../views/interactive/keybindings ../../views/interactive/sketch/SketchLabelOptions ../../views/interactive/sketch/SketchTooltipOptions ../../views/interactive/snapping/SnappingManager ../../views/interactive/snapping/SnappingOptions ../../views/support/hitTestSelectUtils ../../views/support/screenUtils ./support/OperationHandle ../../symbols/SimpleMarkerSymbol ../../symbols/SimpleFillSymbol ../../symbols/SimpleLineSymbol".split(" "),
function(E,u,x,J,ea,w,fa,ha,T,ia,p,R,F,y,ua,va,ja,L,ka,U,la,ma,na,H,oa,M,pa,V,z,v,W,X,qa,Y,ra,Z,K,S,aa,ba){function sa(B){return"polygon"===B||"rectangle"===B||"circle"===B?!0:!1}function N(B,G){ca("undo",B.history.undo,B.history.redo,G)}function O(B,G){ca("redo",B.history.redo,B.history.undo,G)}function ca(B,G,n,a){const b=G.pop().updates,c=[];a.forEach((d,g)=>{g=b[g];null!=g&&("geometry"in g&&p.isSome(g.geometry)&&(c.push({geometry:d.geometry}),d.geometry=g.geometry),"symbol"in g&&p.isSome(g.symbol)&&
(c.push({symbol:d.symbol}),d.symbol=g.symbol),"undo"in g&&(c.push(g),g[B](d)))});n.push({updates:c})}function I(B){return{updates:B.map(G=>({geometry:G.geometry}))}}function C(B){return"requireError"in B&&"aborted"===B.requireError}const P=B=>Object.freeze(Object.defineProperty({__proto__:null,default:B},Symbol.toStringTag,{value:"Module"})),ta=ia.getLogger("esri.widgets.Sketch.SketchViewModel"),da={defaultZ:0},Q={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},
enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,tool:"transform"};w=function(B){function G(a){a=B.call(this,a)||this;a._numUpdating=0;a._handles=new T;a._internalGraphicsLayer=new ma({listMode:"hide",internal:!0,title:"SVM Internal"});a._operationHandle=null;a._viewHandles=new T;a.activeFillSymbol=null;a.activeLineSymbol=null;a.activeVertexSymbol=null;a.allowDeleteKey=!0;a.labelOptions=new W;a.layer=null;
a.pointSymbol=new S({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}});a.polygonSymbol=new aa({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}});a.polylineSymbol=new ba({color:[130,130,130,1],width:2});a._snappingManager=null;a.tooltipOptions=new X;a.updateGraphics=new ea;a.updateOnGraphicClick=!0;a.updatePointSymbol=new S({size:10,color:[0,200,255,.5],outline:{color:"black",width:1}});a.updatePolygonSymbol=new aa({color:[12,207,255,.2],outline:{join:"round",
color:[12,207,255],width:2}});a.updatePolylineSymbol=new ba({color:[12,207,255],width:2});a.vertexSymbol=new S({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}});a._moduleLoaderAbortController=null;a._viewReadyAbortController=null;a._originalAutoOpenEnabled=null;a.defaultCreateOptions=da;a.defaultUpdateOptions=Q;a.snappingOptions=new Y;return a}u._inheritsLoose(G,B);var n=G.prototype;n.initialize=function(){this._handles.add([F.on(()=>{var a,b;return null==(a=this.view)?
void 0:null==(b=a.map)?void 0:b.layers},"change",a=>{a.removed.includes(this.layer)&&this.cancel()}),F.on(()=>{var a;return null==(a=this.layer)?void 0:a.graphics},"change",a=>{if(p.isSome(this._operationHandle))for(const b of a.removed)this.updateGraphics.includes(b)&&(1<this.updateGraphics.length?this._operationHandle.removeFromSelection(b):this._operationHandle.cancel())}),F.watch(()=>{var a,b;return null!=(a=null==(b=this.layer)?void 0:b.elevationInfo)?a:null},a=>{a!==this._internalGraphicsLayer.elevationInfo&&
(this.cancel(),this._internalGraphicsLayer.elevationInfo=a)},F.syncAndInitial),F.watch(()=>this.view,a=>{p.destroyMaybe(this._snappingManager);a&&(this._snappingManager=new qa.SnappingManager({view:a,options:this.snappingOptions}),"2d"===a.type?new Promise((b,c)=>E(["../../views/2d/interactive/editingTools"],b,c)):"3d"===a.type&&(new Promise((b,c)=>E(["../../views/3d/interactive/editingTools"],b,c)),new Promise((b,c)=>E(["../../views/3d/layers/GraphicsLayerView3D"],d=>b(P(d)),c))))},F.syncAndInitial),
F.watch(()=>{var a;return null==(a=this.view)?void 0:a.spatialReference},(a,b)=>{a&&b&&!a.equals(b)&&this.cancel()})])};n.destroy=function(){this.cancel();this._handles=p.destroyMaybe(this._handles);this._viewHandles=p.destroyMaybe(this._viewHandles);this._removeDefaultLayer();this._snappingManager=p.destroyMaybe(this._snappingManager);this._set("view",null);this.emit("destroy")};n.cancel=function(){this._moduleLoaderAbortController=p.abortMaybe(this._moduleLoaderAbortController);this._viewReadyAbortController=
p.abortMaybe(this._viewReadyAbortController);this._operationHandle&&this._operationHandle.cancel()};n.complete=function(){this._operationHandle&&this._operationHandle.complete()};n.delete=function(){const {state:a,updateGraphics:b}=this;if("active"===a&&b.length){const {activeTool:c,layer:d}=this,g=b.toArray();d.removeMany(g);this.cancel();this._emitDeleteEvent({graphics:g,tool:c})}};n.create=function(){var a=u._asyncToGenerator(function*(b,c){this.cancel();yield this._waitViewReady();if("disabled"===
this.state)throw this.layer||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),this.view||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),R.createAbortError();p.isSome(this.view.activeTool)&&(this.view.activeTool=null);if(b){V.addUniqueLayer(this.view,this._internalGraphicsLayer);var d=yield this._setupCreateOperation(b,c);p.isNone(d)||this.destroyed?this.view.map.remove(this._internalGraphicsLayer):(d.on("complete",
()=>{if(d===this._operationHandle){const g=this.createGraphic,f=this._operationHandle.cancelled;this._operationHandle.destroy();this._operationHandle=null;this._set("createGraphic",null);this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer);d.cancelled||null==g||this.layer.add(g);this.emit("create",{graphic:g,state:f?"cancel":"complete",tool:b,toolEventInfo:null,type:"create"})}}),this._operationHandle=d,this.view.ready&&na.isDOMContainer(this.view)&&this.view.focus())}else this._logError("sketch:missing-parameter",
"Missing parameter 'tool'.")});return function(b,c){return a.apply(this,arguments)}}();n.update=function(){var a=u._asyncToGenerator(function*(b,c){this.cancel();yield this._waitViewReady();const {layer:d,view:g,state:f}=this;if("disabled"===f)throw g||this._logError("sketch:missing-property","Property 'view' is missing on SketchViewModel."),d||this._logError("sketch:missing-property","Property 'layer' is missing on SketchViewModel."),R.createAbortError();p.isSome(this.view.activeTool)&&(this.view.activeTool=
null);const e=Array.isArray(b)?b:[b];null!=b&&e&&e.length?e.some(l=>l.layer!==d?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):p.isNone(l.geometry)?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0):!1)||(b=yield this._setupUpdateOperation(e,c),this.destroyed||p.isNone(b)||C(b)||(V.addUniqueLayer(this.view,this._internalGraphicsLayer),
this._setUpdateOperationHandle(b,c),this.emit("update",{graphics:e,state:"start",aborted:!1,tool:b.tool,toolEventInfo:null,type:"update"}))):this._logError("sketch:missing-parameter","Missing parameter 'graphics'.")});return function(b,c){return a.apply(this,arguments)}}();n._updateSpatialReference=function(){var a=u._asyncToGenerator(function*(b){this._beginAsyncOperation();b=Array.isArray(b)?b:[b];for(const c of b)p.isSome(c.geometry)&&"mesh"!==c.geometry.type&&!la.equals(c.geometry.spatialReference,
this.view.spatialReference)&&(L.canProjectWithoutEngine(c.geometry.spatialReference,this.view.spatialReference)||L.isLoaded()||(yield L.load()),c.geometry=L.project(c.geometry,this.view.spatialReference));this._endAsyncOperation()});return function(b){return a.apply(this,arguments)}}();n.undo=function(){this.canUndo()&&this._operationHandle.undo()};n.redo=function(){this.canRedo()&&this._operationHandle.redo()};n.canUndo=function(){return!(!this._operationHandle||!this._operationHandle.canUndo())};
n.canRedo=function(){return!(!this._operationHandle||!this._operationHandle.canRedo())};n.toggleUpdateTool=function(){this._operationHandle&&this._operationHandle.toggleTool&&this._operationHandle.toggleTool()};n._getFirstHit=function(){var a=u._asyncToGenerator(function*(b){var c=this.view;if("2d"===c.type){const g=[];this.view.map.allLayers.forEach(f=>{"vector-tile"!==f.type&&"imagery"!==f.type||g.push(f)});c=yield this.view.hitTest(b,{exclude:g});return ra.findFirstGraphicHit(c.results)}const d=
[this.view.map.ground];c.map.allLayers.forEach(g=>{"integrated-mesh"===g.type&&d.push(g)});b=yield c.hitTest(b,{exclude:d});if(0<b.results.length){const g=b.results[0];if(p.isSome(g)&&"graphic"===g.type&&g.graphic&&(!b.ground.mapPoint||1>c.map.ground.opacity||b.ground.distance-p.unwrapOr(g.distance,0)>-Math.min(3*b.ground.distance,"global"===c.viewingMode?ka.getReferenceEllipsoid(c.renderCoordsHelper.spatialReference).radius/c.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return g}return null});
return function(b){return a.apply(this,arguments)}}();n._generateViewHandles=function(a){var b=this;return[a.on("immediate-click",function(){var c=u._asyncToGenerator(function*(d){var g="active"===b.state&&"create"===b._operationHandle.type;if("disabled"!==b.state&&!g&&b.updateOnGraphicClick){b._beginAsyncOperation();var f=yield d.async(()=>b._getFirstHit(Z.createScreenPointFromEvent(d)));g=null;p.isSome(f)?(f=f.graphic,b.updateGraphics.includes(f)||f.layer===b.layer?(d.stopPropagation(),g=f):"2d"!==
a.type||b._isComponentGraphic(f)||"active"!==b.state||b.cancel()):"active"===b.state&&b.cancel();p.isSome(g)&&!b.updateGraphics.includes(g)&&(yield b.update([g],{...b.defaultUpdateOptions,reshapeOptions:{...b.defaultUpdateOptions.reshapeOptions}}));b._endAsyncOperation()}});return function(d){return c.apply(this,arguments)}}(),z.ViewEventPriorities.WIDGET)]};n._setupCreateOperation=function(){var a=u._asyncToGenerator(function*(b,c){b=yield this._setupDrawGraphicTool(b,this.view,{hasZ:"3d"===this.view.type,
...this.defaultCreateOptions,...c});if(p.isNone(b))return null;this.view.tools.add(b);this.view.activeTool=b;return this._setupCreateOperationHandle(b)});return function(b,c){return a.apply(this,arguments)}}();n._setupDrawGraphicTool=function(){var a=u._asyncToGenerator(function*(b,c,d){if("multipoint"===b&&"3d"===c.type)return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;const g="rectangle"!==b,f="rectangle"!==b;this.snappingOptions.enabledToggled=
!1;b={view:c,mode:"rectangle"===b||"circle"===b?"hybrid":"click",...d,snapToScene:!1,geometryType:b,graphicSymbol:this._getGraphicSymbolFromTool(b),snappingManager:this._snappingManager,forceUniformSize:f,centered:g};return"2d"===this.view.type?this._makeDrawGraphicTool2D(b):this._makeDrawGraphicTool3D(b)});return function(b,c,d){return a.apply(this,arguments)}}();n._makeDrawGraphicTool2D=function(){var a=u._asyncToGenerator(function*(b){const c=yield this._requireModule(new Promise((d,g)=>E(["../../views/2d/interactive/editingTools"],
d,g)));return C(c)||this.destroyed?null:new c.module.DrawGraphicTool2D({...b,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:sa(b.geometryType)?this.activeFillSymbol:null})});return function(b){return a.apply(this,arguments)}}();n._makeDrawGraphicTool3D=function(){var a=u._asyncToGenerator(function*(b){const c=yield this._requireModule(new Promise((g,f)=>E(["../../views/3d/interactive/editingTools"],g,f)));
if(C(c)||this.destroyed)return null;const {elevationInfo:d}=this.layer;return new c.module.DrawGraphicTool3D({...b,elevationInfo:d,snapToScene:p.isSome(d)?"absolute-height"===d.mode:!0,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions})});return function(b){return a.apply(this,arguments)}}();n._setupCreateOperationHandle=function(a){let b=null;const c=a.forceUniformSize,d=a.centered,g=[this.view.on("key-down",e=>{if(e.key===v.SKETCH_KEYS.pan)e.stopPropagation(),e.repeat||(a.enabled=
!1);else if(e.key===v.SKETCH_KEYS.complete)e.stopPropagation(),a.completeCreateOperation();else if(e.key!==v.SKETCH_KEYS.vertexAdd||e.repeat)e.key===v.SKETCH_KEYS.undo?(e.stopPropagation(),f.undo()):e.key===v.SKETCH_KEYS.redo?(e.stopPropagation(),f.redo()):e.key!==v.SKETCH_KEYS.snappingToggle||"rectangle"===a.geometryType||"circle"===a.geometryType||e.repeat?e.key!==v.SKETCH_KEYS.constraint||"rectangle"!==a.geometryType&&"circle"!==a.geometryType||e.repeat?e.key!==v.SKETCH_KEYS.center||e.repeat||
(a.centered=!d,e.stopPropagation()):(a.forceUniformSize=!c,e.stopPropagation()):(this.snappingOptions.enabledToggled=!0,e.stopPropagation());else{const l=a.drawOperation.geometryType;if("polyline"===l||"polygon"===l||"multipoint"===l)e.stopPropagation(),a.drawOperation.commitStagedVertex()}},z.ViewEventPriorities.WIDGET),this.view.on("key-up",e=>{e.key===v.SKETCH_KEYS.pan?a.enabled=!0:e.key===v.SKETCH_KEYS.snappingToggle&&"rectangle"!==a.geometryType&&"circle"!==a.geometryType?(this.snappingOptions.enabledToggled=
!1,e.stopPropagation()):e.key!==v.SKETCH_KEYS.constraint||"rectangle"!==a.geometryType&&"circle"!==a.geometryType?e.key===v.SKETCH_KEYS.center&&(a.centered=d,e.stopPropagation()):(a.forceUniformSize=c,e.stopPropagation())},z.ViewEventPriorities.WIDGET),a.on("vertex-add",e=>{b=p.isNone(b)?"start":"active";switch(e.operation){case "apply":this.emit("create",{graphic:p.unwrap(a.graphic),state:b,tool:this.activeTool,toolEventInfo:e,type:"create"});break;case "undo":this._emitUndoEvent({graphics:[p.unwrap(a.graphic)],
tool:a.geometryType});break;case "redo":this._emitRedoEvent({graphics:[p.unwrap(a.graphic)],tool:a.geometryType})}}),a.on("cursor-update",e=>{0<a.drawOperation.numCommittedVertices&&this.emit("create",{graphic:p.unwrap(a.graphic),state:"active",tool:this.activeTool,toolEventInfo:{coordinates:e.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),a.on("vertex-remove",e=>{switch(e.operation){case "apply":this.emit("create",{graphic:p.unwrap(a.graphic),state:"active",tool:this.activeTool,
toolEventInfo:e,type:"create"});break;case "undo":this._emitUndoEvent({graphics:[p.unwrap(a.graphic)],tool:a.geometryType});break;case "redo":this._emitRedoEvent({graphics:[p.unwrap(a.graphic)],tool:a.geometryType})}}),a.on("complete",e=>{this._set("createGraphic",p.unwrap(e.graphic));b="complete";e.aborted?f&&f.cancel():f&&f.complete()}),F.watch(()=>this._getGraphicSymbolFromTool(a.geometryType),e=>{a.graphicSymbol=e})],f=new K.OperationHandle({activeComponent:a,tool:a.geometryType,type:"create",
onEnd:()=>{var e;g.forEach(l=>l.remove());g.length=0;null==(e=this.view.tools)?void 0:e.remove(a)},undo:()=>{a.canUndo&&a.undo()},redo:()=>{a.canRedo&&a.redo()},canUndo:()=>a.canUndo,canRedo:()=>a.canRedo});return f};n._getGraphicSymbolFromTool=function(a){switch(a){case "point":case "multipoint":return this.pointSymbol;case "polyline":return this.polylineSymbol;case "circle":case "rectangle":case "polygon":return this.polygonSymbol;default:return null}};n._setupUpdateOperation=function(){var a=u._asyncToGenerator(function*(b,
c){const {layer:d,view:g}=this;c={tool:this._defaultUpdateTool,...this.defaultUpdateOptions,...c,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...null==c?void 0:c.reshapeOptions}};var f=c.tool;for(var e of b)d.remove(e),d.add(e);if("3d"===g.type){if(0===b.length)return null;switch(f){case "move":return this._setupMove3DOperation(b,c,g,f);case "reshape":if(1<b.length)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;f=M.isSupportedGraphic(b[0]);
if(f===H.SupportedGraphicResult.SUPPORTED)return this._setupReshape3DOperation(b[0],c,g);this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${H.isSupportedGraphicResultMessage(f)}).`);return null;case "transform":return this._setupGraphicTransform3DOperation(b,c,g)}}switch(f){case "move":return this._setupMove2DOperation(b,c,g);case "reshape":if(1<b.length)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),
null;e=M.isSupportedGraphic(b[0]);if(e===H.SupportedGraphicResult.SUPPORTED)return this._setupTransformOrReshape2DOperation(b,f,c,g);this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${H.isSupportedGraphicResultMessage(e)}).`);return null;case "transform":return 1===b.length&&(e=p.get(b[0].geometry,"type"),"point"===e||"multipoint"===e)&&(f="reshape"),this._setupTransformOrReshape2DOperation(b,f,c,g)}});return function(b,c){return a.apply(this,arguments)}}();
n._setupMove3DOperation=function(){var a=u._asyncToGenerator(function*(b,c,d,g,f=!1){var e=this;for(var l of b){const h=oa.isSupportedGraphic(l);if(h!==H.SupportedGraphicResult.SUPPORTED)return this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${H.isSupportedGraphicResultMessage(h)}).`),null}l=yield this._requireModule(new Promise((h,q)=>E(["../../views/3d/interactive/editingTools"],h,q)));if(C(l))return l;const r=new l.module.GraphicMoveTool({view:d,enableZ:c.enableZ,
snappingManager:this._snappingManager,tooltipOptions:this.tooltipOptions});this.view.tools.add(r);r.graphics.addMany(b);f||this.updateGraphics.addMany(b);const m=[],k=new K.UpdateOperationHandle({activeComponent:r,tool:g,type:"update",onEnd:()=>{var h;m.forEach(q=>q.remove());m.length=0;null==(h=this.view.tools)?void 0:h.remove(r);r.destroyed||r.destroy()},undo:()=>{N(k,this.updateGraphics.toArray());this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:g})},redo:()=>{O(k,this.updateGraphics.toArray());
this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:g})},addToSelection:h=>{this.updateGraphics.push(h);r.graphics.push(h);this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[h],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:h=>{const q=this.updateGraphics.indexOf(h);k.history.undo.forEach(t=>t.updates.splice(q,1));k.history.redo.forEach(t=>t.updates.splice(q,1));this.updateGraphics.remove(h);
this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[h],type:"selection-change"},type:"update"});0===this.updateGraphics.length?k.complete():r.graphics.remove(h)},toggleTool:function(){var h=u._asyncToGenerator(function*(){if(1===e.updateGraphics.length&&!1!==c.toggleToolOnClick&&"transform"===g){var q=e.updateGraphics.getItemAt(0);M.isSupportedGraphic(q)===H.SupportedGraphicResult.SUPPORTED&&(q=yield e._setupReshape3DOperation(q,
c,d,!0),C(q)||(k.onEnd(),k.destroy(),e._setUpdateOperationHandle(q,c)))}});return function(){return h.apply(this,arguments)}}()});m.push(...this._getHandlesForComponent(k,c),this.view.on("immediate-click",h=>this._getCommonUpdateOperationClickHandlers(k,h,c),z.ViewEventPriorities.WIDGET),d.on("key-down",h=>{this._getCommonUpdateOperationKeyDownHandlers(k,h);h.key===v.SKETCH_KEYS.snappingToggle&&(this.snappingOptions.enabledToggled=!0,h.stopPropagation())},z.ViewEventPriorities.WIDGET),d.on("key-up",
h=>{h.key===v.SKETCH_KEYS.snappingToggle&&(this.snappingOptions.enabledToggled=!1,h.stopPropagation())},z.ViewEventPriorities.WIDGET));return k});return function(b,c,d,g){return a.apply(this,arguments)}}();n._setupGraphicTransform3DOperation=function(a,b,c,d=!1){if(1===a.length&&pa.isSupportedGraphic(a[0])===H.SupportedGraphicResult.SUPPORTED){const g=a[0],f=g.geometry;if(p.isSome(f)&&("point"===f.type||"mesh"===f.type))return this._setupPointTransform3DOperation(g,b,c);if(p.isSome(f)&&("polygon"===
f.type||"polyline"===f.type))return this._setupPolyTransform3DOperation(g,b,c,d)}return this._setupMove3DOperation(a,b,c,"transform",d)};n._setupPointTransform3DOperation=function(){var a=u._asyncToGenerator(function*(b,c,d){var g=this;const {enableRotation:f,enableScaling:e,enableZ:l}=c,r=yield this._requireModule(new Promise((q,t)=>E(["../../views/3d/interactive/editingTools"],q,t)));if(C(r))return r;const m=new r.module.GraphicTransformTool({graphic:b,view:d,enableRotation:f,enableScaling:e,enableZ:l,
snappingManager:this._snappingManager,tooltipOptions:this.tooltipOptions});this.view.tools.add(m);this.updateGraphics.add(b);const k=[],h=new K.UpdateOperationHandle({activeComponent:m,tool:"transform",type:"update",onEnd:()=>{var q;k.forEach(t=>t.remove());k.length=0;null==(q=this.view.tools)?void 0:q.remove(m);m.destroyed||m.destroy()},undo:()=>{N(h,this.updateGraphics.toArray());this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:"transform"})},redo:()=>{O(h,this.updateGraphics.toArray());
this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:"transform"})},addToSelection:function(){var q=u._asyncToGenerator(function*(t){g.updateGraphics.add(t);g.emit("update",{graphics:g.updateGraphics.toArray(),state:"active",aborted:!1,tool:g.activeTool,toolEventInfo:{added:[t],removed:[],type:"selection-change"},type:"update"});t=yield g._setupMove3DOperation(g.updateGraphics.toArray(),c,d,"transform",!0);C(t)||(h.onEnd(),h.destroy(),g._setUpdateOperationHandle(t,c))});return function(t){return q.apply(this,
arguments)}}(),removeFromSelection:q=>{this.updateGraphics.remove(q);this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[q],type:"selection-change"},type:"update"});h.complete()},toggleTool:()=>{}});k.push(...this._getHandlesForComponent(h,c),this.view.on("immediate-click",q=>this._getCommonUpdateOperationClickHandlers(h,q,c),z.ViewEventPriorities.WIDGET),d.on("key-down",q=>{this._getCommonUpdateOperationKeyDownHandlers(h,
q);q.key===v.SKETCH_KEYS.snappingToggle&&(this.snappingOptions.enabledToggled=!0,q.stopPropagation())},z.ViewEventPriorities.WIDGET),d.on("key-up",q=>{q.key===v.SKETCH_KEYS.snappingToggle&&(this.snappingOptions.enabledToggled=!1,q.stopPropagation())},z.ViewEventPriorities.WIDGET));return h});return function(b,c,d){return a.apply(this,arguments)}}();n._setupPolyTransform3DOperation=function(){var a=u._asyncToGenerator(function*(b,c,d,g=!1){var f=this;const {enableRotation:e,enableScaling:l,enableZ:r,
preserveAspectRatio:m}=c,k=yield this._requireModule(new Promise((A,D)=>E(["../../views/3d/interactive/editingTools"],A,D)));if(C(k))return k;const h=new k.module.ExtentTransformTool({graphic:b,view:d,enableRotation:e,enableScaling:l,enableZ:r,preserveAspectRatio:m,tooltipOptions:this.tooltipOptions});this.view.tools.add(h);g||this.updateGraphics.add(b);const q=[],t=new K.UpdateOperationHandle({activeComponent:h,tool:"transform",type:"update",onEnd:()=>{var A;q.forEach(D=>D.remove());q.length=0;null==
(A=this.view.tools)?void 0:A.remove(h);h.destroyed||h.destroy()},canUndo:()=>h.canUndo,undo:()=>{h.undo();this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:"transform"})},canRedo:()=>h.canRedo,redo:()=>{h.redo();this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:"transform"})},addToSelection:function(){var A=u._asyncToGenerator(function*(D){f.updateGraphics.add(D);f.emit("update",{graphics:f.updateGraphics.toArray(),state:"active",aborted:!1,tool:f.activeTool,toolEventInfo:{added:[D],
removed:[],type:"selection-change"},type:"update"});D=yield f._setupMove3DOperation(f.updateGraphics.toArray(),c,d,"transform",!0);C(D)||(t.onEnd(),t.destroy(),f._setUpdateOperationHandle(D,c))});return function(D){return A.apply(this,arguments)}}(),removeFromSelection:A=>{this.updateGraphics.remove(A);this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[A],type:"selection-change"},type:"update"});t.complete()},
toggleTool:function(){var A=u._asyncToGenerator(function*(){if(1===f.updateGraphics.length&&!1!==c.toggleToolOnClick){var D=f.updateGraphics.getItemAt(0);M.isSupportedGraphic(D)===H.SupportedGraphicResult.SUPPORTED&&(D=yield f._setupReshape3DOperation(D,c,d,!0),C(D)||(t.onEnd(),t.destroy(),f._setUpdateOperationHandle(D,c)))}});return function(){return A.apply(this,arguments)}}()});q.push(...this._getHandlesForComponent(t,c),this.view.on("immediate-click",A=>this._getCommonUpdateOperationClickHandlers(t,
A,c),z.ViewEventPriorities.WIDGET),this.view.on("key-down",A=>this._getCommonUpdateOperationKeyDownHandlers(t,A),z.ViewEventPriorities.WIDGET),this.view.on("key-down",A=>{A.key!==v.SKETCH_KEYS.constraint||A.repeat||(h.preserveAspectRatio=!h.preserveAspectRatio,A.stopPropagation())},z.ViewEventPriorities.WIDGET),this.view.on("key-up",A=>{A.key===v.SKETCH_KEYS.constraint&&(h.preserveAspectRatio=!h.preserveAspectRatio,A.stopPropagation())},z.ViewEventPriorities.WIDGET));return t});return function(b,
c,d){return a.apply(this,arguments)}}();n._setupMove2DOperation=function(){var a=u._asyncToGenerator(function*(b,c,d){var g=this;this.updateGraphics.addMany(b);yield this._updateSpatialReference(b);const f=yield this._getGraphicMover(b,c,d);if(C(f))return f;const e=new K.UpdateOperationHandle({activeComponent:f,tool:"move",type:"update",onEnd:()=>{var k;this._displayDefaultCursor();m.forEach(h=>h.remove());r.forEach(h=>h.remove());m=[];r=[];f.destroy();null==(k=this._internalGraphicsLayer)?void 0:
k.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const k=this.updateGraphics.toArray();N(e,k);e.refreshComponent();this._emitUndoEvent({graphics:k,tool:"move"})},redo:()=>{const k=this.updateGraphics.toArray();O(e,k);e.refreshComponent();this._emitRedoEvent({graphics:k,tool:"move"})},addToSelection:function(){var k=u._asyncToGenerator(function*(h){yield g._updateSpatialReference(h);g.updateGraphics.push(h);f.graphics=g.updateGraphics.toArray();g.emit("update",{graphics:g.updateGraphics.toArray(),
state:"active",aborted:!1,tool:g.activeTool,toolEventInfo:{added:[h],removed:[],type:"selection-change"},type:"update"})});return function(h){return k.apply(this,arguments)}}(),removeFromSelection:k=>{const h=this.updateGraphics.indexOf(k);e.history.undo.forEach(t=>t.updates.splice(h,1));e.history.redo.forEach(t=>t.updates.splice(h,1));this.updateGraphics.remove(k);const q=this.updateGraphics.toArray();this.emit("update",{graphics:q,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],
removed:[k],type:"selection-change"},type:"update"});0===this.updateGraphics.length?e.complete():f.graphics=q}});let l=!1,r=[d.on("immediate-click",k=>this._getCommonUpdateOperationClickHandlers(e,k,c),z.ViewEventPriorities.WIDGET),d.on("key-down",k=>{this._getCommonUpdateOperationKeyDownHandlers(e,k);k.key!==v.SKETCH_KEYS.constraint||k.repeat||(l=!0,f.enableMoveAllGraphics=!f.enableMoveAllGraphics)},z.ViewEventPriorities.WIDGET),d.on("key-up",k=>{k.key===v.SKETCH_KEYS.constraint&&l&&(l=!1,f.enableMoveAllGraphics=
!f.enableMoveAllGraphics)},z.ViewEventPriorities.WIDGET)],m=this._getHandlesForComponent(e,c);return e});return function(b,c,d){return a.apply(this,arguments)}}();n._setupReshape3DOperation=function(){var a=u._asyncToGenerator(function*(b,c,d,g=!1){var f=this;const e=yield this._requireModule(new Promise((k,h)=>E(["../../views/3d/interactive/editingTools"],k,h)));if(C(e))return e;this.snappingOptions.enabledToggled=!1;const l=new e.module.GraphicReshapeTool({view:d,graphic:b,enableZVertex:c.enableZ&&
"move"===c.reshapeOptions.vertexOperation,enableZShape:c.enableZ&&"move"===c.reshapeOptions.shapeOperation,enableMoveGraphic:"move"===c.reshapeOptions.shapeOperation||"move-xy"===c.reshapeOptions.shapeOperation,enableMidpoints:"split"===c.reshapeOptions.edgeOperation,enableEdgeOffset:"offset"===c.reshapeOptions.edgeOperation,snappingManager:this._snappingManager,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions});d.tools.add(l);g||this.updateGraphics.add(b);const r=[],m=new K.UpdateOperationHandle({activeComponent:l,
tool:"reshape",type:"update",onEnd:()=>{var k;r.forEach(h=>h.remove());r.length=0;null==(k=this.view.tools)?void 0:k.remove(l);l.destroyed||l.destroy()},canUndo:()=>l.canUndo,undo:()=>{l.undo();this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:"reshape"})},canRedo:()=>l.canRedo,redo:()=>{l.redo();this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:"reshape"})},addToSelection:function(){var k=u._asyncToGenerator(function*(h){f.updateGraphics.add(h);f.emit("update",{graphics:f.updateGraphics.toArray(),
state:"active",aborted:!1,tool:f.activeTool,toolEventInfo:{added:[h],removed:[],type:"selection-change"},type:"update"});h=yield f._setupMove3DOperation(f.updateGraphics.toArray(),c,d,"transform",!0);C(h)||(m.onEnd(),m.destroy(),f._setUpdateOperationHandle(h,c))});return function(h){return k.apply(this,arguments)}}(),removeFromSelection:k=>{this.updateGraphics.remove(k);this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],
removed:[k],type:"selection-change"},type:"update"});m.complete()},toggleTool:function(){var k=u._asyncToGenerator(function*(){if(!1!==c.toggleToolOnClick){var h=yield f._setupGraphicTransform3DOperation(f.updateGraphics.toArray(),c,d,!0);C(h)||(m.onEnd(),m.destroy(),f._setUpdateOperationHandle(h,c))}});return function(){return k.apply(this,arguments)}}()});r.push(...this._getHandlesForComponent(m,c),d.on("immediate-click",k=>this._getCommonUpdateOperationClickHandlers(m,k,c),z.ViewEventPriorities.WIDGET),
d.on("key-down",k=>{this._getCommonUpdateOperationKeyDownHandlers(m,k);k.key===v.SKETCH_KEYS.snappingToggle&&(this.snappingOptions.enabledToggled=!0,k.stopPropagation())},z.ViewEventPriorities.WIDGET),d.on("key-up",k=>{k.key===v.SKETCH_KEYS.snappingToggle&&(this.snappingOptions.enabledToggled=!1,k.stopPropagation())},z.ViewEventPriorities.WIDGET));return m});return function(b,c,d){return a.apply(this,arguments)}}();n._setupTransformOrReshape2DOperation=function(){var a=u._asyncToGenerator(function*(b,
c,d,g){var f=this;this.updateGraphics.addMany(b);yield this._updateSpatialReference(b);b="transform"===c?yield this._getBox(b,d,g):yield this._getReshape(b,d,g);if(C(b))return b;const e=new K.UpdateOperationHandle({activeComponent:b,type:"update",onEnd:()=>{r.forEach(m=>m.remove());l.forEach(m=>m.remove());r=[];l=[];e.activeComponent&&!e.activeComponent.destroyed&&e.activeComponent.destroy();this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{N(e,this.updateGraphics.toArray());
e.refreshComponent();this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:e.tool})},redo:()=>{O(e,this.updateGraphics.toArray());e.refreshComponent();this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:e.tool})},addToSelection:function(){var m=u._asyncToGenerator(function*(k){var h=e.activeComponent;if("reshape"===h.type){h=[...f.updateGraphics,k];f.updateGraphics.removeAll();h=yield f._setupMove2DOperation(h,d,g);if(C(h))return;e.onEnd();e.destroy();f._setUpdateOperationHandle(h,
d)}else f.updateGraphics.add(k),h.graphics=f.updateGraphics.toArray(),h.refresh(),e.resetHistory();f.emit("update",{graphics:f.updateGraphics.toArray(),state:"active",aborted:!1,tool:f.activeTool,toolEventInfo:{added:[k],removed:[],type:"selection-change"},type:"update"})});return function(k){return m.apply(this,arguments)}}(),removeFromSelection:function(){var m=u._asyncToGenerator(function*(k){const h=f.updateGraphics.indexOf(k);e.history.undo.forEach(t=>t.updates.splice(h,1));e.history.redo.forEach(t=>
t.updates.splice(h,1));f.updateGraphics.remove(k);const q=f.updateGraphics.toArray();if(0===q.length)e.complete();else{const t=q[0].geometry;1!==q.length||!p.isSome(t)||"point"!==t.type&&"multipoint"!==t.type?e.activeComponent.graphics=q:e.toggleTool()}f.emit("update",{graphics:q,state:"active",aborted:!1,tool:f.activeTool,toolEventInfo:{added:[],removed:[k],type:"selection-change"},type:"update"})});return function(k){return m.apply(this,arguments)}}(),toggleTool:function(){var m=u._asyncToGenerator(function*(){if(!(1<
f.updateGraphics.length)){var k=f.updateGraphics.getItemAt(0),h=k.geometry;p.isSome(h)&&("reshape"===e.tool&&("point"===h.type||"multipoint"===h.type)||"transform"===e.tool&&"extent"===h.type)||(h=null,"transform"===e.tool?h=yield f._getReshape([k],d,g):"reshape"===e.tool&&(h=yield f._getBox([k],d,g)),C(h)||(e.activeComponent.destroy(),e.activeComponent=h,e.activeComponent&&(r.forEach(q=>q.remove()),r=f._getHandlesForComponent(e,d))))}});return function(){return m.apply(this,arguments)}}()});let l=
[g.on("immediate-click",m=>this._getCommonUpdateOperationClickHandlers(e,m,d),z.ViewEventPriorities.WIDGET),g.on("key-down",m=>{this._getCommonUpdateOperationKeyDownHandlers(e,m);m.key!==v.SKETCH_KEYS.snappingToggle||m.repeat||(this.snappingOptions.enabledToggled=!0,m.stopPropagation());m.key===v.SKETCH_KEYS.constraint&&!m.repeat&&e&&(m=e.activeComponent)&&"box"===m.type&&(m.preserveAspectRatio=!m.preserveAspectRatio)},z.ViewEventPriorities.WIDGET),g.on("key-up",m=>{var k;m.key===v.SKETCH_KEYS.snappingToggle&&
"reshape"===(null==e?void 0:null==(k=e.activeComponent)?void 0:k.type)&&(this.snappingOptions.enabledToggled=!1,m.stopPropagation());m.key===v.SKETCH_KEYS.constraint&&e&&(m=e.activeComponent)&&"box"===m.type&&(m.preserveAspectRatio=!m.preserveAspectRatio)},z.ViewEventPriorities.WIDGET)],r=this._getHandlesForComponent(e,d);return e});return function(b,c,d,g){return a.apply(this,arguments)}}();n._getGraphicMover=function(){var a=u._asyncToGenerator(function*(b,c,d){({enableMoveAllGraphics:c}=c);const g=
yield this._requireModule(new Promise((f,e)=>E(["../../views/draw/support/GraphicMover"],l=>f(P(l)),e)));return C(g)?g:new g.module.default({enableMoveAllGraphics:c,highlightsEnabled:!0,indicatorsEnabled:!1,graphics:b,view:d,callbacks:{onGraphicMoveStart:({dx:f,dy:e,graphic:l})=>{this._displayGrabbingCursor();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:f,dy:e,mover:l,type:"move-start"},type:"update"})},onGraphicMove:({dx:f,
dy:e,graphic:l})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:f,dy:e,mover:l,type:"move"},type:"update"}),onGraphicMoveStop:({dx:f,dy:e,graphic:l})=>{this._displayPointerCursor();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:f,dy:e,mover:l,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>
this._displayDefaultCursor()}})});return function(b,c,d){return a.apply(this,arguments)}}();n._getBox=function(){var a=u._asyncToGenerator(function*(b,c,d){const {enableRotation:g,enableScaling:f,preserveAspectRatio:e}=c;c=yield this._requireModule(new Promise((l,r)=>E(["../../views/draw/support/Box"],m=>l(P(m)),r)));return C(c)?c:new c.module.default({graphics:b,enableRotation:g,enableScaling:f,preserveAspectRatio:e,layer:this._internalGraphicsLayer,view:d,callbacks:{onMoveStart:l=>this.emit("update",
{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"}),onMove:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"}),onMoveStop:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"}),onScaleStart:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),
state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"}),onScale:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"}),onScaleStop:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"}),onRotateStart:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,
toolEventInfo:{...l},type:"update"}),onRotate:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"}),onRotateStop:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"})}})});return function(b,c,d){return a.apply(this,arguments)}}();n._getReshape=function(){var a=u._asyncToGenerator(function*(b,c,d){var g,f;const e="split"===
(null==(g=c.reshapeOptions)?void 0:g.edgeOperation);c="move"===(null==(f=c.reshapeOptions)?void 0:f.shapeOperation);f=yield this._requireModule(new Promise((l,r)=>E(["../../views/draw/support/Reshape"],m=>l(P(m)),r)));return C(f)?f:new f.module.default({enableMidpoints:e,enableMovement:c,graphic:b[0],layer:this._internalGraphicsLayer,snappingManager:this._snappingManager,view:d,callbacks:{onReshapeStart:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,
toolEventInfo:{...l},type:"update"}),onReshape:l=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...l},type:"update"}),onReshapeStop:({mover:l,type:r})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:l,type:r},type:"update"}),onMoveStart:({dx:l,dy:r,mover:m,type:k})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,
tool:this.activeTool,toolEventInfo:{dx:l,dy:r,mover:m,type:k},type:"update"}),onMove:({dx:l,dy:r,mover:m,type:k})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:r,mover:m,type:k},type:"update"}),onMoveStop:({dx:l,dy:r,mover:m,type:k})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:l,dy:r,mover:m,type:k},type:"update"}),onVertexAdd:({added:l,
type:r,vertices:m})=>{l=l.map(k=>U.geometryToCoordinates(k.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:l,vertices:m,type:r},type:"update"})},onVertexRemove:({removed:l,type:r,vertices:m})=>{l=l.map(k=>U.geometryToCoordinates(k.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:l,vertices:m,type:r},type:"update"})}}})});
return function(b,c,d){return a.apply(this,arguments)}}();n._getHandlesForComponent=function(a,b){const c=a.activeComponent;switch(c.type){case "graphic-mover":return[c.on("graphic-click",({graphic:d,viewEvent:g})=>{var f;null!=(f=g.native)&&f.shiftKey&&(g.stopPropagation(),a.removeFromSelection(d))}),c.on("graphic-move-start",d=>a.addToHistory(I(d.allGraphics)))];case "box":return[c.on("graphic-click",d=>this._onTransformOrReshape2DGraphicClick(a,b,d)),c.on("move-start",d=>a.addToHistory(I(d.graphics))),
c.on("rotate-start",d=>a.addToHistory(I(d.graphics))),c.on("scale-start",d=>a.addToHistory(I(d.graphics)))];case "reshape":return[c.on("graphic-click",d=>this._onTransformOrReshape2DGraphicClick(a,b,d)),c.on("move-start",d=>a.addToHistory(I([d.mover]))),c.on("reshape-start",d=>a.addToHistory(I([d.graphic]))),c.on("vertex-add",d=>a.addToHistory(I([d.oldGraphic]))),c.on("vertex-remove",d=>a.addToHistory(I([d.oldGraphic])))];case "move-3d":return[c.on("graphic-move-start",d=>{a.addToHistory(I(d.allGraphics));
this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:0<d.allGraphics.length?d.allGraphics[0]:null,type:"move-start"},type:"update"})}),c.on("graphic-move",d=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:d.dx,dy:d.dy,mover:0<d.allGraphics.length?d.allGraphics[0]:null,type:"move"},type:"update"})}),c.on("graphic-move-stop",d=>{this.emit("update",
{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:0<d.allGraphics.length?d.allGraphics[0]:null,type:"move-stop"},type:"update"})}),c.on("immediate-click",d=>{d.shiftKey?this._toggleSelection([d.graphic],a,b):a.toggleTool()})];case "transform-3d":return[c.on("record-undo",({record:d})=>{a.addToHistory({updates:[d]})}),c.on("graphic-translate-start",d=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,
tool:this.activeTool,toolEventInfo:{mover:d.graphic,dx:d.dxScreen,dy:d.dyScreen,type:"move-start"},type:"update"})}),c.on("graphic-translate-stop",d=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:d.graphic,dx:d.dxScreen,dy:d.dyScreen,type:"move-stop"},type:"update"})}),c.on("graphic-rotate-start",d=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:d.graphic,
angle:d.angle,type:"rotate-start"},type:"update"})}),c.on("graphic-rotate-stop",d=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:d.graphic,angle:d.angle,type:"rotate-stop"},type:"update"})}),c.on("graphic-scale-start",d=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:d.graphic,xScale:d.xScale,yScale:d.yScale,type:"scale-start"},type:"update"})}),
c.on("graphic-scale-stop",d=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:d.graphic,xScale:d.xScale,yScale:d.yScale,type:"scale-stop"},type:"update"})}),c.on("graphic-translate",d=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:d.graphic,dx:d.dxScreen,dy:d.dyScreen,type:"move"},type:"update"})}),c.on("graphic-rotate",d=>{this.emit("update",
{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:d.graphic,angle:d.angle,type:"rotate"},type:"update"})}),c.on("graphic-scale",d=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:d.graphic,xScale:d.xScale,yScale:d.yScale,type:"scale"},type:"update"})}),c.on("immediate-click",d=>{d.shiftKey?this._toggleSelection([d.graphic],a,b):a.toggleTool()})];case "reshape-3d":return[c.on("reshape",
d=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:d,type:"update"})}),c.on("move",d=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:d,type:"update"})}),c.on("vertex-add",d=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:d,type:"update"})}),c.on("vertex-remove",d=>{this.emit("update",
{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:d,type:"update"})}),c.on("immediate-click",d=>{d.shiftKey?this._toggleSelection([d.graphic],a,b):a.toggleTool()})]}};n._onTransformOrReshape2DGraphicClick=function(a,b,c){var d;const {graphic:g,viewEvent:f}=c;if(null!=(d=f.native)&&d.shiftKey&&g.layer===this.layer)return f.stopPropagation(),a.removeFromSelection(g);if(b.toggleToolOnClick)return f.stopPropagation(),a.toggleTool()};n._setUpdateOperationHandle=
function(a,b){this._operationHandle=a;const c=this.view.map;this._disablePopup(b);a.on("complete",()=>{if(a===this._operationHandle){const d=this.updateGraphics.toArray(),g=this._operationHandle.tool;this._operationHandle.destroy();this._operationHandle=null;this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray());this.updateGraphics.removeAll();c&&c.remove(this._internalGraphicsLayer);this._restorePopup(b);this.emit("update",{graphics:d,state:"complete",aborted:a.cancelled,tool:g,toolEventInfo:null,
type:"update"})}})};n._getCommonUpdateOperationClickHandlers=function(){var a=u._asyncToGenerator(function*(b,c,d){const g=Z.createScreenPointFromEvent(c),f=yield c.async(()=>this._getFirstHit(g));p.isNone(f)?b.complete():c.native.shiftKey&&this._toggleSelection([f.graphic],b,d)?c.stopPropagation():this.updateGraphics.includes(f.graphic)?c.stopPropagation():b.complete()});return function(b,c,d){return a.apply(this,arguments)}}();n._toggleSelection=function(a,b,c){const d=!!c.multipleSelectionEnabled;
return a.some(g=>null==g?!1:d&&g.layer===this.layer?(this.updateGraphics.includes(g)?b.removeFromSelection(g):b.addToSelection(g),!0):!1)};n._getCommonUpdateOperationKeyDownHandlers=function(a,b){if(a){var c=b.key;c===v.SKETCH_KEYS.undo&&a.canUndo()?(b.stopPropagation(),a.undo()):c===v.SKETCH_KEYS.redo&&a.canRedo()?(b.stopPropagation(),a.redo()):c===v.SKETCH_KEYS.cancel?(b.stopPropagation(),a.cancel()):this.allowDeleteKey&&v.SKETCH_KEYS.delete.includes(c)&&this._onDeleteKey(b)}};n._onDeleteKey=function(a){if(this._operationHandle&&
"update"===this._operationHandle.type){var b=this.activeComponent,c=this.updateGraphics.toArray();p.isNone(b)||"reshape-3d"===b.type||"reshape"===b.type&&(1!==c.length||"point"!==p.get(c[0].geometry,"type"))||(a.stopPropagation(),this.delete())}};n._removeDefaultLayer=function(){this._internalGraphicsLayer&&(this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=p.destroyMaybe(this._internalGraphicsLayer))};n._isComponentGraphic=function(a){const {activeComponent:b}=
this;return!a||p.isNone(b)?!1:a.attributes&&a.attributes.esriSketchTool||"draw-2d"===b.type&&b.graphic===a||("box"===b.type||"reshape"===b.type)&&b.isUIGraphic(a)};n._displayPointerCursor=function(){this.view&&this.view.container&&"pointer"!==this.view.cursor&&(this.view.cursor="pointer")};n._displayGrabbingCursor=function(){this.view&&this.view.container&&"grabbing"!==this.view.cursor&&(this.view.cursor="grabbing")};n._displayDefaultCursor=function(){this.view&&this.view.container&&null!==this.view.cursor&&
(this.view.cursor=null)};n._logError=function(a,b,c){ta.error(new fa(a,b,c))};n._requireModule=function(){var a=u._asyncToGenerator(function*(b){const c=new AbortController;this._moduleLoaderAbortController=c;b=yield b;return this._moduleLoaderAbortController!==c||c.signal.aborted?{requireError:"aborted"}:{module:b}});return function(b){return a.apply(this,arguments)}}();n._emitUndoEvent=function(a){this.emit("undo",{...a,type:"undo"})};n._emitRedoEvent=function(a){this.emit("redo",{...a,type:"redo"})};
n._emitDeleteEvent=function(a){this.emit("delete",{...a,type:"delete"})};n.wait=function(){return F.whenOnce(()=>!this.updating)};n._beginAsyncOperation=function(){this._numUpdating+=1;this.notifyChange("updating")};n._endAsyncOperation=function(){--this._numUpdating;this.notifyChange("updating")};n._disablePopupEnabled=function(a){var b;return"3d"!==(null==(b=this.view)?void 0:b.type)||this.updateOnGraphicClick||p.isSome(a)&&a.toggleToolOnClick};n._disablePopup=function(a){this._disablePopupEnabled(a)&&
(a=this.view.popup)&&p.isNone(this._originalAutoOpenEnabled)&&(this._originalAutoOpenEnabled=a.autoOpenEnabled,a.autoOpenEnabled=!1)};n._restorePopup=function(a){this._disablePopupEnabled(a)&&(a=this.view.popup)&&p.isSome(this._originalAutoOpenEnabled)&&(a.autoOpenEnabled=this._originalAutoOpenEnabled,this._originalAutoOpenEnabled=null)};n._waitViewReady=function(){var a=u._asyncToGenerator(function*(){const b=this.view;b&&(p.abortMaybe(this._viewReadyAbortController),this._viewReadyAbortController=
new AbortController,yield R.whenOrAbort(F.whenOnce(()=>null==b?void 0:b.ready),this._viewReadyAbortController.signal))});return function(){return a.apply(this,arguments)}}();u._createClass(G,[{key:"_defaultUpdateTool",get:function(){return"3d"===this.view.type?"move":"transform"}},{key:"updating",get:function(){return 0<this._numUpdating}},{key:"activeTool",get:function(){return this._operationHandle&&this._operationHandle.tool?this._operationHandle.tool:null}},{key:"activeComponent",get:function(){return this._operationHandle?
this._operationHandle.activeComponent:null}},{key:"createGraphic",get:function(){return!p.isSome(this.activeComponent)||"draw-3d"!==this.activeComponent.type&&"draw-2d"!==this.activeComponent.type?this._get("createGraphic"):p.unwrap(this.activeComponent.graphic)}},{key:"defaultCreateOptions",set:function(a){this._set("defaultCreateOptions",{...da,...a})}},{key:"defaultUpdateOptions",set:function(a){this._set("defaultUpdateOptions",{...Q,...a,reshapeOptions:{...Q.reshapeOptions,...null==a?void 0:a.reshapeOptions}})}},
{key:"snappingOptions",set:function(a){p.isSome(this._snappingManager)&&(this._snappingManager.options=a);this._set("snappingOptions",a)}},{key:"state",get:function(){var a;const b=!(null==(a=this.view)||!a.ready||!this.layer);a=this._operationHandle;return b&&a?"active":b?"ready":"disabled"}},{key:"view",get:function(){return this._get("view")},set:function(a){const b=this._get("view");if(b){const {container:c,map:d}=b;c&&(b.cursor=null);d&&d.remove(this._internalGraphicsLayer);this._viewHandles.removeAll();
this.cancel()}this._handles.remove("view-ready");a&&this._handles.add(F.when(()=>a.ready,c=>{this._viewHandles.removeAll();c&&this._viewHandles.add(this._generateViewHandles(a))},F.syncAndInitial),"view-ready");this._set("view",a)}},{key:"test",get:function(){return{operationHandle:this._operationHandle,defaultUpdateOptions:Q}}}]);return G}(ha.EventedAccessor);x.__decorate([y.property()],w.prototype,"updating",null);x.__decorate([y.property()],w.prototype,"_operationHandle",void 0);x.__decorate([y.property({readOnly:!0})],
w.prototype,"activeTool",null);x.__decorate([y.property()],w.prototype,"activeFillSymbol",void 0);x.__decorate([y.property()],w.prototype,"activeLineSymbol",void 0);x.__decorate([y.property()],w.prototype,"activeVertexSymbol",void 0);x.__decorate([y.property()],w.prototype,"allowDeleteKey",void 0);x.__decorate([y.property({readOnly:!0})],w.prototype,"createGraphic",null);x.__decorate([y.property()],w.prototype,"defaultCreateOptions",null);x.__decorate([y.property()],w.prototype,"defaultUpdateOptions",
null);x.__decorate([y.property({type:W,nonNullable:!0})],w.prototype,"labelOptions",void 0);x.__decorate([y.property()],w.prototype,"layer",void 0);x.__decorate([y.property({types:J.symbolTypes})],w.prototype,"pointSymbol",void 0);x.__decorate([y.property({types:J.symbolTypes})],w.prototype,"polygonSymbol",void 0);x.__decorate([y.property({types:J.symbolTypes})],w.prototype,"polylineSymbol",void 0);x.__decorate([y.property({type:Y,nonNullable:!0})],w.prototype,"snappingOptions",null);x.__decorate([y.property()],
w.prototype,"_snappingManager",void 0);x.__decorate([y.property({readOnly:!0})],w.prototype,"state",null);x.__decorate([y.property({type:X,nonNullable:!0})],w.prototype,"tooltipOptions",void 0);x.__decorate([y.property({readOnly:!0})],w.prototype,"updateGraphics",void 0);x.__decorate([y.property()],w.prototype,"updateOnGraphicClick",void 0);x.__decorate([y.property({types:J.symbolTypes})],w.prototype,"updatePointSymbol",void 0);x.__decorate([y.property({types:J.symbolTypes})],w.prototype,"updatePolygonSymbol",
void 0);x.__decorate([y.property({types:J.symbolTypes})],w.prototype,"updatePolylineSymbol",void 0);x.__decorate([y.property({types:J.symbolTypes})],w.prototype,"vertexSymbol",void 0);x.__decorate([y.property({value:null})],w.prototype,"view",null);return w=x.__decorate([ja.subclass("esri.widgets.Sketch.SketchViewModel")],w)});