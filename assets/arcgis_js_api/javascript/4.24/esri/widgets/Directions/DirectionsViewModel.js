// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../Graphic ../../symbols ../../core/Collection ../../core/deprecate ../../core/Error ../../core/Evented ../../core/HandleOwner ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../intl/locale ../../layers/GraphicsLayer ../../layers/RouteLayer ../../layers/support/RouteStopSymbols ../../layers/support/RouteSymbols ../../rest/networkService ../../rest/support/RouteParameters ../../rest/support/Stop ../support/GoTo ../../symbols/SimpleLineSymbol ../../symbols/SimpleMarkerSymbol ../../symbols/PictureMarkerSymbol".split(" "),
function(r,g,E,J,e,F,n,t,K,L,M,d,G,u,h,aa,ba,N,O,P,Q,R,S,T,U,H,x,V,W,y,I){function C(k){return"esri.Graphic"===(null==k?void 0:k.declaredClass)}function X(k){return Array.isArray(k)&&k.length&&C(k[0])}function Y(k){return F.isCollection(k)&&k.length&&C(k.getItemAt(0))}var m;(function(k){k[k.Active=0]="Active";k[k.Complete=1]="Complete";k[k.Failed=2]="Failed";k[k.Idle=3]="Idle";k[k.Suspended=4]="Suspended"})(m||(m={}));const p=M.getLogger("esri.widgets.Directions.DirectionsViewModel");e=function(k){function z(a){a=
k.call(this,a)||this;a._highlightLayer=new Q({listMode:"hide",internal:!0});a._highlight=null;a._legacyLayer=null;a._loadPromise=null;a._loadController=null;a._routeController=null;a._serviceDescriptionStatus=m.Idle;a.apiKey=void 0;a.departureTime="now";a.lastError=null;a.lastRoute=null;a.layer=null;a.maxStops=50;a.routeParameters=new H({directionsLengthUnits:"kilometers",findBestSequence:!1,restrictUTurns:"at-dead-ends-and-intersections",returnZ:!0,startTime:null,startTimeIsUTC:!0,useHierarchy:!0,
useTimeWindows:!1});a.serviceDescription=null;a.view=null;return a}r._inheritsLoose(z,k);var l=z.prototype;l.initialize=function(){this.own([u.on(()=>d.applySome(this.layer,a=>a.stops),"change",()=>{this.clearResults()}),u.watch(()=>this.layer,(a,b)=>{if(d.isSome(a))for(;2>a.stops.length;)a.stops.add(new x);d.isNone(a)&&(this.layer=this.legacyLayer);if(d.isSome(b)&&b===this.legacyLayer){var c,f;null==(c=this.view)?void 0:null==(f=c.map)?void 0:f.remove(b)}},u.syncAndInitial),u.watch(()=>{var a;return null==
(a=this.view)?void 0:a.map},(a,b)=>{this.layer===this.legacyLayer&&(null==b?void 0:b.remove(this.layer),null==a?void 0:a.add(this.layer));null==b?void 0:b.remove(this._highlightLayer);null==a?void 0:a.add(this._highlightLayer)},u.initial)])};l.destroy=function(){var a,b;null==(a=this.view)?void 0:null==(b=a.map)?void 0:b.remove(this._highlightLayer);if(this.layer===this.legacyLayer){var c,f;null==(c=this.view)?void 0:null==(f=c.map)?void 0:f.remove(this.layer)}};l.castStops=function(a){return X(a)||
Y(a)?a.map(b=>x.fromGraphic(b)):a};l.load=function(){var a=r._asyncToGenerator(function*(){if(d.isSome(this._loadPromise))return this._loadPromise;this._loadPromise=this._load();yield this._loadPromise;this._loadPromise=null});return function(){return a.apply(this,arguments)}}();l.highlight=function(){var a=r._asyncToGenerator(function*(b){this.clearHighlights();this._highlight=(yield this.view.whenLayerView(this.layer)).highlight(b)});return function(b){return a.apply(this,arguments)}}();l.highlightSegment=
function(a){n.deprecated(p,"highlightSegment",{replacement:"highlight",version:"4.24",warnOnce:!0});const {geometry:b,symbol:c}=a;d.isNone(this.view)||d.isNone(b)||d.isNone(c)||(this.clearHighlights(),a=c.clone(),a.color=new E([0,0,0,.8]),a.width=Math.ceil(a.width/2),a=new J({geometry:b,symbol:a}),this._highlightLayer.add(a))};l.clearHighlights=function(){this._highlightLayer.removeAll();d.isSome(this._highlight)&&(this._highlight.remove(),this._highlight=null)};l.centerAt=function(a){d.isNone(this.view)||
(a="esri.rest.support.Stop"===(null==a?void 0:a.declaredClass)||C(a)?a.geometry:a,d.isNone(a)||this.callGoTo({target:a}))};l.clearResults=function(){this._set("lastRoute",null);this.layer.removeResult()};l.getDirections=function(){var a=r._asyncToGenerator(function*(){const {apiKey:b,departureTime:c,layer:f,state:D}=this;if(d.isNone(f))throw new t("directions-view-model:missing-route-layer","A route layer must be associated with the view model.");f===this.legacyLayer&&n.deprecated(p,"Using the Directions widget or view model without setting `layer` is deprecated.",
{see:"https://developers.arcgis.com/javascript/latest/api-reference/esri-widgets-Directions-DirectionsViewModel.html#layer",version:"4.24",warnOnce:!0});if("unauthenticated"===D||"initializing"===D||"disabled"===D||this._serviceDescriptionStatus===m.Failed)throw new t("directions-view-model:not-loaded","Cannot get directions until view model loads.");this._set("lastError",null);d.isSome(this._routeController)&&(this._routeController.abort(),this._routeController=null);var A="now"===c,q="now"===c?
new Date:c;if(q&&!A){var v=6E4*q.getTimezoneOffset();q.setTime(q.getTime()-v)}const Z=d.isSome(this.view)?this.view.spatialReference:null;v=this.routeParameters.clone();v.set({startTime:q,startTimeIsUTC:A,directionsLanguage:this._directionsLanguage,apiKey:b,outSpatialReference:Z});d.isSome(this.selectedTravelMode)&&(v.travelMode=this.selectedTravelMode);if(2>f.stops.filter(B=>d.isSome(B.geometry)).length){var w=new t("directions-view-model:not-enough-stops","Not enough stops for routing");this._set("lastError",
w);throw w;}this._routeController=new AbortController;({signal:A}=this._routeController);q=null;try{q=yield f.solve(v,{signal:A}),f.update(q),this._set("lastRoute",q)}catch(B){if(!G.isAbortError(B))throw w=new t("directions-view-model:unable-to-route","Unable to route to these addresses",{error:B}),this._set("lastError",w),this._set("lastRoute",null),w;}finally{this._routeController=null}this.zoomToRoute();return q});return function(){return a.apply(this,arguments)}}();l.getCostAttribute=function(a){const b=
(d.isSome(this.serviceDescription)?this.serviceDescription.networkDataset.networkAttributes:[]).find(c=>c.name===a&&"cost"===c.usageType);return null!=b?b:null};l.reset=function(){this.clearHighlights();this.clearResults();d.isSome(this.layer)&&(this.layer.removeAll(),this.layer.stops=new F([new x,new x]))};l.save=function(){return this.layer.save()};l.saveAs=function(a,b={}){return this.layer.saveAs(a,b)};l.zoomToRoute=function(){const {view:a,layer:{routeInfo:b}}=this;if(!d.isNone(a)&&!d.isNone(b)){var {geometry:c}=
b;if(!d.isNone(c)){({extent:c}=c);var f=c.width>c.height;c=c.clone().expand(f?2:1);this.callGoTo({target:c})}}};l._getLegacyLayer=function(){const a=new E([255,128,0]);return new R({listMode:"hide",defaultSymbols:new T({directionLines:new W({color:a,width:7,cap:"round",join:"round"}),directionPoints:null,routeInfo:null,stops:new S({break:new y({color:[255,255,255],size:10,outline:{color:[20,89,127],width:2.5}}),first:new y({color:a,size:19,outline:{color:[51,51,51],width:3}}),last:new I({width:23,
height:23,url:`data:image/svg+xml;base64,${btoa(`<svg width="30" height="30" viewBox="0 0 30 30" xmlns="http://www.w3.org/2000/svg"><g fill-rule="nonzero" fill="none"><path d="M15.15.3C6.9.3.3 6.9.3 15.15S6.9 29.7 15.15 29.7 29.7 23.1 29.7 15.15C29.7 6.9 23.25.3 15.15.3z" fill="#333"/><path d="M15 4.8C9.3 4.8 4.8 9.45 4.8 15c0 5.55 4.65 10.2 10.2 10.2 5.55 0 10.2-4.5 10.2-10.2 0-5.55-4.5-10.2-10.2-10.2z" fill="${a.toHex()}"/><path fill="#333" d="M10.5 10.5h9v9h-9z"/></g></svg>`)}`}),middle:new y({color:[51,
51,51],size:12,outline:{color:a,width:3}}),unlocated:new I({height:18,width:18,url:`data:image/svg+xml;base64,${btoa(`<svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><g fill="none" fill-rule="evenodd"><path d="M10.1.2C4.6.2.2 4.6.2 10.1s4.4 9.7 9.9 9.7 9.7-4.4 9.7-9.7c0-5.5-4.3-9.9-9.7-9.9z" fill="#333" fill-rule="nonzero"/><path d="M10 2.7c-4.08 0-7.3 3.328-7.3 7.3s3.328 7.3 7.3 7.3 7.3-3.22 7.3-7.3c0-3.972-3.22-7.3-7.3-7.3z" fill="${a.toHex()}" fill-rule="nonzero"/><path d="M11.414 10l5.304-5.303-1.415-1.415L10 8.586 4.697 3.282 3.282 4.697 8.586 10l-5.304 5.303 1.415 1.415L10 11.414l5.303 5.304 1.415-1.415L11.414 10z" fill="#333"/></g></svg>`)}`}),
waypoint:new y({color:[255,255,255],size:10,outline:{color:[20,89,127],width:2.5}})})}),stops:[{},{}]})};l._load=function(){var a=r._asyncToGenerator(function*(){if(!d.isSome(this.serviceDescription)&&!d.isNone(this.layer)){d.isSome(this._loadController)&&(this._loadController.abort(),this._loadController=null);this._loadController=new AbortController;var {signal:b}=this._loadController;try{this._serviceDescriptionStatus=m.Active;const f=yield U.fetchServiceDescription(this.layer.url,this.apiKey,
{signal:b});this._set("serviceDescription",f);this._serviceDescriptionStatus=m.Complete}catch(f){if(G.isAbortError(f))this._serviceDescriptionStatus=m.Idle;else if("identity-manager:user-aborted"===f.name)this._serviceDescriptionStatus=m.Suspended;else{var c=new t("directions-view-model:service-metadata-unavailable","Cannot load route service metadata",{error:f});this._serviceDescriptionStatus=m.Failed;this._set("lastError",c);throw c;}}finally{this._loadController=null}}});return function(){return a.apply(this,
arguments)}}();r._createClass(z,[{key:"_directionsLanguage",get:function(){if(!d.isNone(this.serviceDescription)){var a=this.serviceDescription.directionsSupportedLanguages;if(a){var b=d.unwrapOr(this.routeParameters.directionsLanguage,P.getLocale()).slice(0,2);return a.find(c=>c.toLowerCase().slice(0,2)===b)}}}},{key:"impedanceAttribute",get:function(){var a,b,c,f=d.isSome(this.serviceDescription)?this.serviceDescription.impedance:null;f=null!=(a=null!=(b=null==(c=d.unwrap(this.routeParameters.travelMode))?
void 0:c.impedanceAttributeName)?b:d.unwrap(this.routeParameters.impedanceAttribute))?a:f;return this.getCostAttribute(f)}},{key:"legacyLayer",get:function(){d.isNone(this._legacyLayer)&&(this._legacyLayer=this._getLegacyLayer());return this._legacyLayer}},{key:"routeServiceUrl",get:function(){n.deprecatedProperty(p,"routeServiceUrl",{replacement:"layer.url",version:"4.24",warnOnce:!0});return this.legacyLayer.url},set:function(a){n.deprecatedProperty(p,"routeServiceUrl",{replacement:"layer.url",
version:"4.24",warnOnce:!0});this.legacyLayer.url=a}},{key:"routeSymbol",get:function(){n.deprecatedProperty(p,"routeSymbol",{replacement:"layer.defaultSymbols.directionLines",version:"4.24",warnOnce:!0});return this.legacyLayer.defaultSymbols.directionLines},set:function(a){n.deprecatedProperty(p,"routeSymbol",{replacement:"layer.defaultSymbols.directionLines",version:"4.24",warnOnce:!0});this.legacyLayer.defaultSymbols.directionLines=a}},{key:"selectedTravelMode",get:function(){const {serviceDescription:a}=
this;if(d.isNone(a))return null;const {defaultTravelMode:b,supportedTravelModes:c=[]}=a;return c.find(f=>f.id===b)||c[0]||null},set:function(a){void 0===a?this._clearOverride("selectedTravelMode"):this._override("selectedTravelMode",a)}},{key:"state",get:function(){if(d.isSome(this._routeController))return"routing";if(d.isSome(this.lastError))return"error";switch(this._serviceDescriptionStatus){case m.Suspended:return"unauthenticated";case m.Idle:return"disabled";case m.Active:return"initializing";
case m.Failed:return"error";default:return"ready"}}},{key:"stops",get:function(){n.deprecatedProperty(p,"stops",{replacement:"layer.stops",version:"4.24",warnOnce:!0});return this.legacyLayer.stops},set:function(a){n.deprecatedProperty(p,"stops",{replacement:"layer.stops",version:"4.24",warnOnce:!0});this.legacyLayer.stops=a}},{key:"stopSymbols",get:function(){n.deprecatedProperty(p,"stopSymbols",{replacement:"layer.defaultSymbols.stops",version:"4.24",warnOnce:!0});return this.legacyLayer.defaultSymbols.stops},
set:function(a){n.deprecatedProperty(p,"stopSymbols",{replacement:"layer.defaultSymbols.stops",version:"4.24",warnOnce:!0});this.legacyLayer.defaultSymbols.stops=a}},{key:"timeAttribute",get:function(){var a,b,c;const f=null!=(a=null!=(b=null==(c=d.unwrap(this.routeParameters.travelMode))?void 0:c.timeAttributeName)?b:d.unwrap(this.routeParameters.directionsTimeAttribute))?a:d.isSome(this.serviceDescription)?this.serviceDescription.directionsTimeAttribute:null;return this.getCostAttribute(f)}},{key:"travelModes",
get:function(){return d.isSome(this.serviceDescription)?this.serviceDescription.supportedTravelModes:[]}}]);return z}(L.HandleOwnerMixin(V.GoToMixin(K.EventedAccessor)));g.__decorate([h.property()],e.prototype,"_directionsLanguage",null);g.__decorate([h.property()],e.prototype,"_routeController",void 0);g.__decorate([h.property()],e.prototype,"_serviceDescriptionStatus",void 0);g.__decorate([h.property()],e.prototype,"apiKey",void 0);g.__decorate([h.property()],e.prototype,"departureTime",void 0);
g.__decorate([h.property({readOnly:!0})],e.prototype,"impedanceAttribute",null);g.__decorate([h.property()],e.prototype,"lastError",void 0);g.__decorate([h.property({readOnly:!0})],e.prototype,"lastRoute",void 0);g.__decorate([h.property()],e.prototype,"layer",void 0);g.__decorate([h.property({readOnly:!0})],e.prototype,"legacyLayer",null);g.__decorate([h.property({type:Number,range:{min:2,max:50},nonNullable:!0})],e.prototype,"maxStops",void 0);g.__decorate([h.property({type:H,nonNullable:!0})],
e.prototype,"routeParameters",void 0);g.__decorate([h.property()],e.prototype,"routeServiceUrl",null);g.__decorate([h.property()],e.prototype,"routeSymbol",null);g.__decorate([h.property()],e.prototype,"selectedTravelMode",null);g.__decorate([h.property({readOnly:!0})],e.prototype,"serviceDescription",void 0);g.__decorate([h.property({readOnly:!0})],e.prototype,"state",null);g.__decorate([h.property()],e.prototype,"stops",null);g.__decorate([N.cast("stops")],e.prototype,"castStops",null);g.__decorate([h.property()],
e.prototype,"stopSymbols",null);g.__decorate([h.property({readOnly:!0})],e.prototype,"timeAttribute",null);g.__decorate([h.property()],e.prototype,"travelModes",null);g.__decorate([h.property()],e.prototype,"view",void 0);g.__decorate([h.property()],e.prototype,"getDirections",null);g.__decorate([h.property()],e.prototype,"zoomToRoute",null);return e=g.__decorate([O.subclass("esri.widgets.Directions.DirectionsViewModel")],e)});