// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass ../../../popup/FieldInfo ../../../popup/content/support/ChartMediaInfoValueSeries ../support/featureUtils ../support/relatedFeatureUtils".split(" "),function(C,k,f,n,M,N,I,J,K,L,m,D){const E={chartAnimation:!0};f=
function(F){function A(a){a=F.call(this,a)||this;a.abilities={...E};a.activeMediaInfoIndex=0;a.attributes=null;a.description=null;a.fieldInfoMap=null;a.formattedAttributes=null;a.expressionAttributes=null;a.layer=null;a.mediaInfos=null;a.popupTemplate=null;a.relatedInfos=null;a.title=null;return a}C._inheritsLoose(A,F);var r=A.prototype;r.castAbilities=function(a){return{...E,...a}};r.setActiveMedia=function(a){this._setContentElementMedia(a)};r.next=function(){this._pageContentElementMedia(1)};r.previous=
function(){this._pageContentElementMedia(-1)};r._setContentElementMedia=function(a){const {formattedMediaInfoCount:c}=this;this.activeMediaInfoIndex=(a+c)%c};r._pageContentElementMedia=function(a){const {activeMediaInfoIndex:c}=this;this._setContentElementMedia(c+a)};r._formatMediaInfos=function(){const {attributes:a,mediaInfos:c,formattedAttributes:d,expressionAttributes:g,fieldInfoMap:e,layer:h}=this;return null==c?void 0:c.map(b=>{b=null==b?void 0:b.clone();if(!b)return null;b.title=m.substituteFieldsInLinksAndAttributes({attributes:a,
fieldInfoMap:e,globalAttributes:d,expressionAttributes:g,layer:h,text:b.title});b.caption=m.substituteFieldsInLinksAndAttributes({attributes:a,fieldInfoMap:e,globalAttributes:d,expressionAttributes:g,layer:h,text:b.caption});b.altText=m.substituteFieldsInLinksAndAttributes({attributes:a,fieldInfoMap:e,globalAttributes:d,expressionAttributes:g,layer:h,text:b.altText});if("image"===b.type){var {value:p}=b;this._setImageValue({value:p,formattedAttributes:d,layer:h});return b.value.sourceURL?b:void 0}return"pie-chart"===
b.type||"line-chart"===b.type||"column-chart"===b.type||"bar-chart"===b.type?({value:p}=b,this._setChartValue({value:p,chartType:b.type,attributes:a,formattedAttributes:d,layer:h}),b):null}).filter(Boolean)};r._setImageValue=function(a){const {fieldInfoMap:c}=this,{value:d,formattedAttributes:g,layer:e}=a,{linkURL:h,sourceURL:b}=d;b&&(a=m.fixTokens(b,e),d.sourceURL=m.substituteAttributes({formattedAttributes:g,template:a,fieldInfoMap:c}));h&&(a=m.fixTokens(h,e),d.linkURL=m.substituteAttributes({formattedAttributes:g,
template:a,fieldInfoMap:c}))};r._setChartValue=function(a){const {value:c,attributes:d,formattedAttributes:g,chartType:e,layer:h}=a,{popupTemplate:b,relatedInfos:p}=this,{fields:v,normalizeField:w}=c;c.fields=m.getFixedFieldNames(v,h);w&&(c.normalizeField=m.getFixedFieldName(w,h));if(v.some(l=>!!(null!=g[l]||m.isRelatedField(l)&&p.size))){var t=null==b?void 0:b.fieldInfos;v.forEach(l=>{m.isRelatedField(l)?c.series=[...c.series,...this._getRelatedChartInfos({fieldInfos:t,fieldName:l,formattedAttributes:g,
chartType:e,value:c})]:(l=this._getChartOption({value:c,attributes:d,chartType:e,formattedAttributes:g,fieldName:l,fieldInfos:t}),c.series.push(l))})}};r._getRelatedChartInfos=function(a){var c;const {fieldInfos:d,fieldName:g,formattedAttributes:e,chartType:h,value:b}=a,p=[];a=D.getRelatedFieldInfo(g);const {layerId:v,fieldName:w}=a;a=null==(c=this.relatedInfos)?void 0:c.get(v.toString());if(!a)return p;const {relatedFeatures:t,relation:l}=a;if(!l||!t)return p;({cardinality:c}=l);t.forEach(q=>{const {attributes:u}=
q;u&&Object.keys(u).forEach(x=>{x===w&&p.push(this._getChartOption({value:b,attributes:u,formattedAttributes:e,fieldName:g,chartType:h,relatedFieldName:x,fieldInfos:d}))})});return"one-to-many"===c||"many-to-many"===c?p:[p[0]]};r._getTooltip=function({label:a,value:c,chartType:d}){return"pie-chart"===d?`${a}`:`${a}: ${c}`};r._getChartOption=function(a){const {value:c,attributes:d,formattedAttributes:g,fieldName:e,relatedFieldName:h,fieldInfos:b,chartType:p}=a,{layer:v,fieldInfoMap:w}=this,{normalizeField:t,
tooltipField:l}=c;a=t?m.isRelatedField(t)?d[D.getRelatedFieldInfo(t).fieldName]:d[t]:null;var q=h&&void 0!==d[h]?d[h]:void 0!==d[e]?d[e]:g[e];a=new L({fieldName:e,value:void 0===q?null:q&&a?q/a:q});if(m.isRelatedField(e)){var u,x,z,y,G;q=w.get(e.toLowerCase());const H=w.get(l.toLowerCase());var B=null!=(u=null==q?void 0:q.fieldName)?u:e;u=null!=(x=null==H?void 0:H.fieldName)?x:l;x=null!=(z=null!=(y=null!=(G=g[u])?G:null==q?void 0:q.label)?y:null==q?void 0:q.fieldName)?z:h;a.tooltip=this._getTooltip({label:x,
value:g[B],chartType:p});return a}y=m.getFieldInfo(b,e);z=m.getFixedFieldName(e,v);y=l&&void 0!==g[l]?g[l]:m.getFieldInfoLabel(y||new K({fieldName:z}),null==(B=this.popupTemplate)?void 0:B.expressionInfos);a.tooltip=this._getTooltip({label:y,value:g[z],chartType:p});return a};C._createClass(A,[{key:"activeMediaInfo",get:function(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}},{key:"formattedMediaInfos",get:function(){return this._formatMediaInfos()||[]}},{key:"formattedMediaInfoCount",
get:function(){return this.formattedMediaInfos.length}}]);return A}(f);k.__decorate([n.property()],f.prototype,"abilities",void 0);k.__decorate([I.cast("abilities")],f.prototype,"castAbilities",null);k.__decorate([n.property()],f.prototype,"activeMediaInfoIndex",void 0);k.__decorate([n.property({readOnly:!0})],f.prototype,"activeMediaInfo",null);k.__decorate([n.property()],f.prototype,"attributes",void 0);k.__decorate([n.property()],f.prototype,"description",void 0);k.__decorate([n.property()],f.prototype,
"fieldInfoMap",void 0);k.__decorate([n.property()],f.prototype,"formattedAttributes",void 0);k.__decorate([n.property()],f.prototype,"expressionAttributes",void 0);k.__decorate([n.property({readOnly:!0})],f.prototype,"formattedMediaInfos",null);k.__decorate([n.property()],f.prototype,"layer",void 0);k.__decorate([n.property({readOnly:!0})],f.prototype,"formattedMediaInfoCount",null);k.__decorate([n.property()],f.prototype,"mediaInfos",void 0);k.__decorate([n.property()],f.prototype,"popupTemplate",
void 0);k.__decorate([n.property()],f.prototype,"relatedInfos",void 0);k.__decorate([n.property()],f.prototype,"title",void 0);return f=k.__decorate([J.subclass("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],f)});