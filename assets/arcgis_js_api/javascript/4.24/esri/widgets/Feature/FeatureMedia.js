// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/events ../../core/reactiveUtils ../../core/accessorSupport/decorators/aliasOf ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ../../renderers/support/utils ../Widget ./FeatureMedia/FeatureMediaViewModel ./support/FeatureElementInfo ./support/featureUtils ../support/chartUtils ../support/widgetUtils ../support/decorators/messageBundle ../support/jsxFactory ../../support/themeUtils".split(" "),
function(v,n,D,w,t,m,L,M,y,E,F,G,z,H,I,A,B,J,p,K){m=function(C){function x(a,b){var c=C.call(this,a,b)||this;c._refreshTimer=null;c._refreshIntervalInfo=null;c._featureElementInfo=null;c.attributes=null;c.activeMediaInfoIndex=null;c.description=null;c.fieldInfoMap=null;c.layer=null;c.mediaInfos=null;c.popupTemplate=null;c.relatedInfos=null;c.title=null;c.viewModel=new z;c.messages=null;c._getChartDependencies=function(){var l=v._asyncToGenerator(function*(e){const f=yield A.loadChartsModule(),{destroyed:g,
viewModel:d}=v._assertThisInitialized(c);if(!g&&d&&e){var {activeMediaInfo:h}=d,q=yield c._getRendererColors(f);c._renderChart({chartDiv:e,mediaInfo:h,chartsModule:f,colorMap:q})}});return function(e){return l.apply(this,arguments)}}();return c}v._inheritsLoose(x,C);var k=x.prototype;k.initialize=function(){this._featureElementInfo=new H;this.own([w.watch(()=>{var a,b;return[null==(a=this.viewModel)?void 0:a.activeMediaInfo,null==(b=this.viewModel)?void 0:b.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),
w.initial),w.watch(()=>{var a,b;return[null==(a=this.viewModel)?void 0:a.description,null==(b=this.viewModel)?void 0:b.title]},()=>this._setupFeatureElementInfo(),w.initial)])};k.destroy=function(){this._clearMediaRefreshTimer();this._featureElementInfo.destroy()};k.render=function(){var a;return p.tsx("div",{bind:this,class:"esri-feature-media",onkeyup:this._handleMediaKeyup},null==(a=this._featureElementInfo)?void 0:a.render(),this.renderMedia())};k.renderMedia=function(){const {formattedMediaInfoCount:a}=
this.viewModel;return a?p.tsx("div",{key:"media-element-container",class:"esri-feature-media__container"},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null};k.renderImageMediaInfo=function(a){var {_refreshIntervalInfo:b}=this;const {activeMediaInfoIndex:c,formattedMediaInfoCount:l}=this.viewModel,{value:e,refreshInterval:f,altText:g,title:d,type:h}=a,{sourceURL:q,linkURL:u}=e;a=I.shouldOpenInNewTab(u)?"_blank":"_self";const r="_blank"===a?"noreferrer":
"";b=f?b:null;b=p.tsx("img",{alt:g||d,key:`media-${h}-${c}-${l}-${b?b.timestamp:0}`,src:b?b.sourceURL:q});return(a=u?p.tsx("a",{title:d,href:u,rel:r,target:a},b):null)?a:b};k.renderChartMediaInfo=function(a){const {activeMediaInfoIndex:b,formattedMediaInfoCount:c}=this.viewModel;return p.tsx("div",{key:`media-${a.type}-${b}-${c}`,bind:this,class:"esri-feature-media__chart",afterCreate:this._getChartDependencies})};k.renderMediaInfoType=function(){const {activeMediaInfo:a}=this.viewModel;return a?
"image"===a.type?this.renderImageMediaInfo(a):a.type.includes("chart")?this.renderChartMediaInfo(a):null:null};k.renderMediaInfo=function(){var {activeMediaInfo:a}=this.viewModel;if(!a)return null;const b=a.title?p.tsx("div",{key:"media-title",class:"esri-feature-media__item-title",innerHTML:a.title}):null;a=a.caption?p.tsx("div",{key:"media-caption",class:"esri-feature-media__item-caption",innerHTML:a.caption}):null;return p.tsx("div",{key:"media-container",class:"esri-feature-media__item-container"},
p.tsx("div",{key:"media-item-container",class:"esri-feature-media__item"},this.renderMediaInfoType()),b,a)};k.renderMediaPageButton=function(a){if(2>this.viewModel.formattedMediaInfoCount)return null;const b=(a="previous"===a)?this.messages.previous:this.messages.next,c=a?this.classes("esri-feature-media__button","esri-feature-media__previous"):this.classes("esri-feature-media__button","esri-feature-media__next"),l=a?this.classes("esri-feature-media__icon","esri-feature-media__previous-icon","esri-icon-left-triangle-arrow"):
this.classes("esri-feature-media__icon","esri-feature-media__next-icon","esri-icon-right-triangle-arrow"),e=a?this.classes("esri-feature-media__icon","esri-feature-media__previous-icon--rtl","esri-icon-right-triangle-arrow"):this.classes("esri-feature-media__icon","esri-feature-media__next-icon--rtl","esri-icon-left-triangle-arrow");return p.tsx("button",{type:"button",key:a?"media-previous":"media-next",title:b,"aria-label":b,tabIndex:0,class:c,bind:this,onclick:a?this._previous:this._next},p.tsx("span",
{"aria-hidden":"true",class:l}),p.tsx("span",{"aria-hidden":"true",class:e}))};k._setupFeatureElementInfo=function(){const {description:a,title:b}=this;this._featureElementInfo.set({description:a,title:b})};k._next=function(){this.viewModel.next()};k._previous=function(){this.viewModel.previous()};k._getRendererColors=function(){var a=v._asyncToGenerator(function*(b){var c;const {am4core:l}=b;b=null==(c=this.viewModel)?void 0:c.layer;const e=new Map;if(!b)return e;const f=yield F.getColorsFromRenderer(b.renderer);
f.delete(null);if(!Array.from(f.values()).every(g=>1===(null==g?void 0:g.length)))return e;e.set("default-line-value",l.color({r:50,g:50,b:50,a:1}));Array.from(f.keys()).forEach(g=>{g&&e.set(g,l.color(f.get(g)[0].toCss(!0)))});return e});return function(b){return a.apply(this,arguments)}}();k._handleMediaKeyup=function(a){const b=D.eventKey(a);"ArrowLeft"===b&&(a.stopPropagation(),this.viewModel.previous());"ArrowRight"===b&&(a.stopPropagation(),this.viewModel.next())};k._renderChart=function(a){const {abilities:b}=
this.viewModel,{chartsModule:c,chartDiv:l,mediaInfo:e,colorMap:f}=a,{value:g,type:d}=e,{am4core:h}=c,q=A.getColorSet(h);K.isDarkTheme()&&h.useTheme(c.am4themes_dark);const u=window.matchMedia("(prefers-reduced-motion: reduce)");b.chartAnimation&&!u.matches?h.useTheme(c.am4themes_animated):h.unuseTheme(c.am4themes_animated);h.useTheme(function(r){r instanceof h.ColorSet&&q&&(r.list=q)});a="pie-chart"===d?this._createPieChart(a):this._createXYChart(a);l.setAttribute("aria-label",e.altText||e.title);
a.data=g.series.map(r=>({["tooltip"]:r.tooltip,["value"]:r.value,["color"]:f.get(r.fieldName)})).filter(r=>"pie-chart"===d?0<r.value:!0)};k._customizeChartTooltip=function(a,b){a.label.wrap=!0;a.label.maxWidth=200;a.autoTextColor=!1;a.getFillFromObject=!1;a.label.fill=b.color("#ffffff");a.background.fill=b.color({r:0,g:0,b:0,a:.7})};k._createPieChart=function(a){const {chartDiv:b,chartsModule:c}=a,{am4core:l,am4charts:e}=c;a=l.create(b,e.PieChart);a.rtl=B.isRTL(this.container);const f=a.series.push(new e.PieSeries);
f.labels.template.disabled=!0;f.ticks.template.disabled=!0;f.dataFields.value="value";f.dataFields.category="tooltip";this._customizeChartTooltip(f.tooltip,l);f.slices.template.tooltipText=a.rtl?"{category}: %{value.percent.formatNumber('#.0')}":"{category}: {value.percent.formatNumber('#.0')}%";f.slices.template.propertyFields.fill="color";f.slices.template.propertyFields.stroke="color";return a};k._getMinSeriesValue=function(a){let b=0;a.forEach(c=>b=Math.min(c.value,b));return b};k._createColumnChart=
function(a,b){const {chartsModule:c,mediaInfo:l}=b;({value:b}=l);const {am4core:e,am4charts:f}=c,g=a.xAxes.push(new f.CategoryAxis);g.dataFields.category="tooltip";g.renderer.labels.template.disabled=!0;this._customizeChartTooltip(g.tooltip,e);g.tooltip.events.on("sizechanged",()=>{g.tooltip.dy=-g.tooltip.contentHeight});var d=a.yAxes.push(new f.ValueAxis);const h=d.renderer.labels.template;d.renderer.minLabelPosition=.05;d.renderer.maxLabelPosition=.95;d.min=this._getMinSeriesValue(b.series);this._customizeChartTooltip(d.tooltip,
e);h.wrap=!0;d=a.series.push(new f.ColumnSeries);d.dataFields.valueY="value";d.dataFields.categoryX="tooltip";d.columns.template.propertyFields.fill="color";d.columns.template.propertyFields.stroke="color";a.cursor=new f.XYCursor;15<b.series.length&&(a.scrollbarX=new e.Scrollbar)};k._createBarChart=function(a,b){const {chartsModule:c,mediaInfo:l}=b;({value:b}=l);const {am4core:e,am4charts:f}=c,g=a.yAxes.push(new f.CategoryAxis);g.dataFields.category="tooltip";g.renderer.inversed=!0;g.renderer.labels.template.disabled=
!0;this._customizeChartTooltip(g.tooltip,e);g.tooltip.events.on("sizechanged",()=>{g.tooltip.dx=g.tooltip.contentWidth});var d=a.xAxes.push(new f.ValueAxis);const h=d.renderer.labels.template;d.renderer.minLabelPosition=.05;d.renderer.maxLabelPosition=.95;d.min=this._getMinSeriesValue(b.series);this._customizeChartTooltip(d.tooltip,e);h.wrap=!0;d=a.series.push(new f.ColumnSeries);d.dataFields.valueX="value";d.dataFields.categoryY="tooltip";d.columns.template.propertyFields.fill="color";d.columns.template.propertyFields.stroke=
"color";a.cursor=new f.XYCursor;15<b.series.length&&(a.scrollbarY=new e.Scrollbar)};k._createLineChart=function(a,b){const {chartsModule:c,mediaInfo:l,colorMap:e}=b;({value:b}=l);const {am4core:f,am4charts:g}=c,d=a.xAxes.push(new g.CategoryAxis);d.dataFields.category="tooltip";d.renderer.labels.template.disabled=!0;this._customizeChartTooltip(d.tooltip,f);d.tooltip.events.on("sizechanged",()=>{d.tooltip.dy=-d.tooltip.contentHeight});var h=a.yAxes.push(new g.ValueAxis),q=h.renderer.labels.template;
h.renderer.minLabelPosition=.05;h.renderer.maxLabelPosition=.95;h.min=this._getMinSeriesValue(b.series);this._customizeChartTooltip(h.tooltip,f);q.wrap=!0;h=a.series.push(new g.LineSeries);h.dataFields.categoryX="tooltip";h.dataFields.valueY="value";h.strokeWidth=1;if(q=e.get("default-line-value"))h.stroke=q;h=h.bullets.push(new g.CircleBullet);h.propertyFields.fill="color";h.propertyFields.stroke="color";a.cursor=new g.XYCursor;15<b.series.length&&(a.scrollbarX=new f.Scrollbar)};k._createXYChart=
function(a){const {chartDiv:b,chartsModule:c,mediaInfo:l}=a,{type:e}=l,{am4core:f,am4charts:g}=c,d=f.create(b,g.XYChart);d.rtl=B.isRTL(this.container);"column-chart"===e&&this._createColumnChart(d,a);"bar-chart"===e&&this._createBarChart(d,a);"line-chart"===e&&this._createLineChart(d,a);return d};k._clearMediaRefreshTimer=function(){const {_refreshTimer:a}=this;a&&(clearTimeout(a),this._refreshTimer=null)};k._updateMediaInfoTimestamp=function(a){const b=Date.now();this._refreshIntervalInfo={timestamp:b,
sourceURL:this._getImageSource(a,b)};this.scheduleRender()};k._setupMediaRefreshTimer=function(){this._clearMediaRefreshTimer();const {activeMediaInfo:a}=this.viewModel;a&&"image"===a.type&&a.refreshInterval&&this._setRefreshTimeout(a)};k._setRefreshTimeout=function(a){const {refreshInterval:b,value:c}=a;b&&(a=6E4*b,this._updateMediaInfoTimestamp(c.sourceURL),this._refreshTimer=setInterval(()=>{this._updateMediaInfoTimestamp(c.sourceURL)},a))};k._getImageSource=function(a,b){const c=a.includes("?")?
"\x26":"?",[l,e=""]=a.split("#");return`${l}${c}timestamp=${b}${e?"#":""}${e}`};return x}(G);n.__decorate([t.aliasOf("viewModel.attributes")],m.prototype,"attributes",void 0);n.__decorate([t.aliasOf("viewModel.activeMediaInfoIndex")],m.prototype,"activeMediaInfoIndex",void 0);n.__decorate([t.aliasOf("viewModel.description")],m.prototype,"description",void 0);n.__decorate([t.aliasOf("viewModel.fieldInfoMap")],m.prototype,"fieldInfoMap",void 0);n.__decorate([t.aliasOf("viewModel.layer")],m.prototype,
"layer",void 0);n.__decorate([t.aliasOf("viewModel.mediaInfos")],m.prototype,"mediaInfos",void 0);n.__decorate([t.aliasOf("viewModel.popupTemplate")],m.prototype,"popupTemplate",void 0);n.__decorate([t.aliasOf("viewModel.relatedInfos")],m.prototype,"relatedInfos",void 0);n.__decorate([t.aliasOf("viewModel.title")],m.prototype,"title",void 0);n.__decorate([y.property({type:z})],m.prototype,"viewModel",void 0);n.__decorate([y.property(),J.messageBundle("esri/widgets/Feature/t9n/Feature")],m.prototype,
"messages",void 0);return m=n.__decorate([E.subclass("esri.widgets.Feature.FeatureMedia")],m)});