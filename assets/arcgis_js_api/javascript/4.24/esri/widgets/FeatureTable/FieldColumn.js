// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../intl/date ../../intl/number ../../layers/support/CodedValueDomain ../../layers/support/fieldUtils ../FeatureForm/InputField ./Grid/EditorColumn ../support/DatePicker ../support/TimePicker ../support/widgetUtils".split(" "),
function(v,k,E,F,l,h,S,T,G,x,A,H,w,I,J,K,L,B){const M=x.convertDateFormatToIntlOptions("short-date-short-time"),N=x.convertDateFormatToIntlOptions("short-date"),O=A.convertNumberFormatToIntlOptions({digitSeparator:!0,places:null});h=function(C){function y(b){var a=C.call(this,b)||this;a._inputField=null;a.alias=null;a.cellValueFormatFunction=({rowData:c,value:d})=>{if(a.formatFunction){const {config:m,field:n}=v._assertThisInitialized(a);return a.formatFunction({config:m,field:n,value:B.renderingSanitizer.sanitize(d)})}if(null===
d)return"\x26nbsp;";const {config:e,field:f}=v._assertThisInitialized(a);({item:{feature:c}}=c);if(c=a._getDomainForFeature(c))return a._getComputedDomain(d,c);if("date"===f.type){var g;c=a._getDateFormatOptions();const m="feature"===(null==(g=a.layer)?void 0:g.type)&&a.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null;return d?x.formatDate(d,{...c,...m}):null}return w.isNumericField(f)?(g=null!=e&&e.format?A.convertNumberFormatToIntlOptions(e.format):O,A.formatNumber(parseFloat(d),g)):B.renderingSanitizer.sanitize(d)};
a.cellValueValidatorFunction=({oldValue:c,value:d})=>a._inputField&&!a._inputField.valid||a.required&&(!E.isSome(d)||""===d)?!1:c!==d;a.config=null;a.defaultValue=null;a.editingEnabled=!1;a.expressionInfos=null;a.field=null;a.formatFunction=null;a.headerRenderFunction=c=>{const {root:d}=c,{editable:e,editingEnabled:f,headerMenuEnabled:g,sortable:m}=v._assertThisInitialized(a);a.removeCellContent(d);d.classList.add("esri-field-column__header-content");f&&!e&&d.appendChild(a.createLockedElement());
if(m)a.headerSorterRenderFunction(c);else{const {header:n,path:q}=v._assertThisInitialized(a),r=document.createElement("div");r.classList.add("esri-field-column__header-label");r.innerHTML=n||q;d.appendChild(r)}g&&a.headerMenuRenderFunction(c)};a.inputRenderFunction=({root:c,column:d,rowData:e})=>{var f,g;if((null==(f=a.activeEditInfo)||!f.updating)&&a.editable){var m=a.getCellValue(d,e);f=a.createInputElement({root:c,column:d,rowData:e,value:m});a._set("activeEditInfo",{column:d,input:f,root:c,rowData:e,
updating:!0,oldValue:m});"date"===a.field.type?a._renderDateEditors(m,c,f):(d=a.createInputContainer(),d.appendChild(f),a.removeCellContent(c),c.appendChild(d),f.focus(),f instanceof HTMLInputElement&&f.select(),null==(g=a.grid)?void 0:g.notifyResize())}};a.layer=null;a.name=null;a.nullable=!0;a.parseInputValueFunction=({input:c})=>{c=c.value;const {required:d,type:e}=a._inputField;return d||""!==c?"number"===e||"date"===e?parseFloat(c):"text"===e?c.trim():c:null};a.path=null;a.template=null;a.updateRowItemFunction=
({rowData:c,column:d,value:e})=>{c.item.feature.attributes[d.path]=e};return a}v._inheritsLoose(y,C);var p=y.prototype;p.createInputElement=function({rowData:b,value:a}){({item:b}=b);if(!b||!b.feature)return null;this._inputField=this._setUpInputField(b.feature,a);const {field:c,maxLength:d,minLength:e,required:f}=this;({domain:b}=this._inputField);let g=null;"coded-value"===(null==b?void 0:b.type)?(g=this._createSelectElement(a,b.codedValues.map(({code:q,name:r})=>({value:q,name:r})),this._inputField),
g.onchange=()=>{g.onblur=null;n()}):(g=document.createElement("input"),g.type=w.isNumericField(c)?"number":"text",-1<d&&(g.maxLength=d),0<e&&(g.minLength=e));g.classList.add("esri-field-column__cell-input");g.value=a;g.required=f;let m=!1;g.onkeydown=q=>{m="Escape"===q.key};g.onblur=()=>{g.onblur=null;n()};const n=()=>{m?this.cancel():this.submit();this._inputField=null};return g};p.createInputContainer=function(){const b=document.createElement("div");b.classList.add("esri-field-column__cell__input-container");
return b};p.createLockedElement=function(){const b=document.createElement("div");b.classList.add("esri-icon-locked");return b};p.getCellValue=function({path:b},{item:a}){var c,d,e;return null!=(c=null==a?void 0:null==(d=a.feature)?void 0:null==(e=d.attributes)?void 0:e[b])?c:null};p._renderDateEditors=function(b,a,c){var d;const {config:e,messagesCommon:f,template:g}=this;var m=b?new Date(b):new Date(Date.now());const n=new K({dateInputEnabled:!0,value:m}),q=new L({value:m});c.value=m.getTime().toString();
let r=!b;const P=()=>{r=!0;const u=this._getCombinedDateTime(n.value,q.value);c.value=u.getTime().toString()},Q=()=>{r?this.submit():this.cancel()},R=()=>{c.value=null;this.submit()};F.watch(()=>[n.value,q.value],()=>P());var t=document.createElement("div");const D=document.createElement("div");n.container=t;q.container=D;b=document.createElement("button");b.classList.add("esri-field-column__button","esri-icon-save");b.onclick=()=>Q();b.title=null==f?void 0:f.save;m=document.createElement("button");
m.classList.add("esri-field-column__button","esri-icon-trash");m.onclick=()=>R();m.title=null==f?void 0:f.clear;const z=document.createElement("div");z.classList.add("esri-field-column__cell__date-input-wrapper");z.appendChild(t);(g&&g.input&&"datetime-picker"===g.input.type&&!1!==g.input.includeTime||e&&!1!==e.includeTime)&&z.appendChild(D);t=document.createElement("div");t.classList.add("esri-field-column__cell__date-input-container");t.appendChild(z);t.appendChild(b);t.appendChild(m);n.when(()=>
{var u;return null==(u=this.grid)?void 0:u.notifyResize()});q.when(()=>{var u;return null==(u=this.grid)?void 0:u.notifyResize()});this.removeCellContent(a);a.appendChild(t);null==(d=this.grid)?void 0:d.notifyResize()};p._createSelectElement=function(b,a,c){let d=!1;a=a.map(f=>{f.value===b&&(d=!0);const g=document.createElement("option");g.text=f.name;g.value=f.value;return g});if(null!=b&&""!==b&&!d){const f=document.createElement("option");f.text=b;f.value=b;a.unshift(f)}c.required||null!=c.value||
(c=document.createElement("option"),c.value="",a.unshift(c));const e=document.createElement("select");a.forEach(f=>e.add(f));e.value=b;return e};p._setUpInputField=function(b,a){const {config:c,field:d,layer:e}=this;b=new I({config:c,feature:b,initialFeature:b.clone(),field:d,layer:e,group:null,messages:null});b.set("value",a);return b};p._isDomainCompatible=function(b){const {field:a}=this;if(b&&"coded-value"===b.type){const c=typeof b.codedValues[0].code;if("string"===c&&w.isStringField(a)||"number"===
c&&w.isNumericField(a))return!0}return b&&"range"===b.type&&w.isNumericField(a)?!0:!1};p._getDomainForFeature=function(b){const {config:a,layer:c,name:d,template:e}=this;if("wfs"===c.type||"geojson"===c.type)return null;if(null!=e&&e.domain&&this._isDomainCompatible(e.domain))return e.domain;var {typeIdField:f}=c;const g=this.field.domain;if(f===d&&!g)return new H({name:"__internal-type-based-coded-value-domain__",codedValues:c.types.map(({id:m,name:n})=>({code:m,name:n}))});b=f&&c.getFieldDomain(d,
{feature:b})||g;f=null==a?void 0:a.domain;return this._isDomainCompatible(f)?f:b};p._getComputedDomain=function(b,a){return a?"range"===a.type?b:"coded-value"===a.type?(a=a.codedValues.filter(c=>c.hasOwnProperty("code")&&c.code===b))&&a.length?a[0].name:b:null:null};p._getCombinedDateTime=function(b,a){return new Date(b.getFullYear(),b.getMonth(),b.getDate(),a.getHours(),a.getMinutes(),a.getSeconds())};p._getDateFormatOptions=function(){var b,a;const {config:c,template:d}=this,e=(null==d?void 0:null==
(b=d.format)?void 0:b.dateFormat)||(null==c?void 0:null==(a=c.format)?void 0:a.dateFormat);return e?x.convertDateFormatToIntlOptions(e):d&&d.input&&!1==="includeTime"in d.input||!1===(null==c?void 0:c.includeTime)?N:M};v._createClass(y,[{key:"description",get:function(){var b,a,c;return(null==(b=this.template)?void 0:b.description)||(null==(a=this.config)?void 0:a.description)||(null==(c=this.field)?void 0:c.description)||null}},{key:"editable",get:function(){const {config:b,editingEnabled:a,field:c,
template:d}=this;return a?!1===(null==d?void 0:d.editable)?!1:!1===(null==b?void 0:b.editable)?!1:null==c?void 0:c.editable:d?d.editable:b?!0===b.editable&&(null==c?void 0:c.editable):!1}},{key:"header",get:function(){var b,a;return(null==(b=this.template)?void 0:b.label)||(null==(a=this.config)?void 0:a.label)||this.alias||this.path||null}},{key:"hidden",get:function(){const {config:b}=this;return!1===(null==b?void 0:b.visible)||this._get("hidden")||!1},set:function(b){this._set("hidden",b)}},{key:"loadingMessage",
get:function(){var b;return(null==(b=this.messages)?void 0:b.loading)||"..."}},{key:"maxLength",get:function(){const {field:b,config:a,template:c}=this,d=null==b?void 0:b.length,e=null!=c&&c.input&&"maxLength"in c.input?c.input.maxLength:null==a?void 0:a.maxLength;return!isNaN(e)&&-1<=e&&(-1===d||e<=d)?e:d}},{key:"minLength",get:function(){const {config:b,template:a,maxLength:c}=this,d=null!=a&&a.input&&"minLength"in a.input?a.input.minLength:(null==b?void 0:b.minLength)||null;return c&&d<=c?d:null}},
{key:"required",get:function(){const {config:b,field:a,template:c}=this,d=null==a?void 0:a.nullable,e=null==b?void 0:b.required,f=null==c?void 0:c.required;return this.editable&&(!d||!0===e||!0===f)}},{key:"sortable",get:function(){var b,a;return this.template?!1!==(null==(b=this.template)?void 0:b.sortable):!1!==(null==(a=this.config)?void 0:a.sortable)}}]);return y}(J);k.__decorate([l.property({readOnly:!0,aliasOf:"field.alias"})],h.prototype,"alias",void 0);k.__decorate([l.property()],h.prototype,
"cellValueFormatFunction",void 0);k.__decorate([l.property()],h.prototype,"cellValueValidatorFunction",void 0);k.__decorate([l.property()],h.prototype,"config",void 0);k.__decorate([l.property({readOnly:!0,aliasOf:"field.defaultValue"})],h.prototype,"defaultValue",void 0);k.__decorate([l.property({readOnly:!0})],h.prototype,"description",null);k.__decorate([l.property({readOnly:!0})],h.prototype,"editable",null);k.__decorate([l.property()],h.prototype,"editingEnabled",void 0);k.__decorate([l.property()],
h.prototype,"expressionInfos",void 0);k.__decorate([l.property()],h.prototype,"field",void 0);k.__decorate([l.property()],h.prototype,"formatFunction",void 0);k.__decorate([l.property({readOnly:!0})],h.prototype,"header",null);k.__decorate([l.property()],h.prototype,"hidden",null);k.__decorate([l.property()],h.prototype,"headerRenderFunction",void 0);k.__decorate([l.property()],h.prototype,"inputRenderFunction",void 0);k.__decorate([l.property()],h.prototype,"layer",void 0);k.__decorate([l.property({readOnly:!0})],
h.prototype,"loadingMessage",null);k.__decorate([l.property()],h.prototype,"maxLength",null);k.__decorate([l.property()],h.prototype,"minLength",null);k.__decorate([l.property({readOnly:!0,aliasOf:"field.name"})],h.prototype,"name",void 0);k.__decorate([l.property({readOnly:!0,aliasOf:"field.nullable"})],h.prototype,"nullable",void 0);k.__decorate([l.property()],h.prototype,"parseInputValueFunction",void 0);k.__decorate([l.property({readOnly:!0,aliasOf:"field.name"})],h.prototype,"path",void 0);k.__decorate([l.property({readOnly:!0})],
h.prototype,"required",null);k.__decorate([l.property()],h.prototype,"sortable",null);k.__decorate([l.property()],h.prototype,"template",void 0);k.__decorate([l.property()],h.prototype,"updateRowItemFunction",void 0);return h=k.__decorate([G.subclass("esri.widgets.FeatureTable.FieldColumn")],h)});