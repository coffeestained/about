// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Basemap ../../core/Collection ../../core/HandleOwner ../../core/Loadable ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../geometry/projection ../../geometry/support/spatialReferenceUtils ../../support/basemapUtils ./support/basemapCompatibilityUtils ./support/BasemapGalleryItem ./support/LocalBasemapsSource ./support/PortalBasemapsSource".split(" "),
function(q,e,A,r,c,t,n,u,g,G,H,B,C,p,v,D,w,x,E,l){const y=r.ofType(x);c=function(z){function m(a){a=z.call(this,a)||this;a._loadingProjectionEngine=!1;a.items=new y;a.source=new l;a.view=null;return a}q._inheritsLoose(m,z);var h=m.prototype;h.initialize=function(){const a=()=>this._recreateItems();this.handles.add([u.watch(()=>"ready"===this.state?this.compatibilityFunction:null,()=>this._updateItems()),u.on(()=>{var b;return null==(b=this.source)?void 0:b.basemaps},"change",a,{onListenerAdd:a})])};
h.castSource=function(a){return Array.isArray(a)||r.isCollection(a)?new E({basemaps:a}):a&&"esri.portal.Portal"===a.declaredClass?new l({portal:a}):!a||a instanceof l||!a.portal&&!a.query?a&&"basemaps"in a&&"state"in a&&"refresh"in a?a:null:new l(a)};h.basemapEquals=function(a,b){return D.contentEquals(a,b)};h.refresh=function(){this._recreateItems()};h.load=function(a){this.addResolvingPromise(t.isLoadable(this.source)?this.source.load(a):null);return Promise.resolve(this)};h._recreateItems=function(){var a;
const b=null==(a=this.source)?void 0:a.basemaps,{view:k,compatibilityFunction:f}=this;this.items.removeAll().forEach(d=>d.destroy());b&&this.items.addMany(b.map(d=>new x({basemap:d,compatibilityFunction:f,view:k})))};h._updateItems=function(){for(const a of this.items)a.compatibilityFunction=this.compatibilityFunction,a.view=this.view};q._createClass(m,[{key:"activeBasemap",get:function(){var a,b,k;return null!=(a=null==(b=this.view)?void 0:null==(k=b.map)?void 0:k.basemap)?a:null},set:function(a){var b,
k;if(this.view.map){var f="string"===typeof a?A.fromId(a):a;if(f&&this.view.ready){var d=f.spatialReference||(null==(b=this.items)?void 0:null==(k=b.find(F=>this.basemapEquals(f,F.basemap)))?void 0:k.spatialReference);d&&"spatialReferenceLocked"in this.view&&!this.view.spatialReferenceLocked?(b=this.view.spatialReference,!n.isSome(d)||v.equals(b,d)||p.canProjectWithoutEngine(this.view.spatialReference,d)||p.isLoaded()?(this.view.map.basemap=f,this._clearOverride("activeBasemap"),n.isSome(d)&&!v.equals(this.view.spatialReference,
d)&&(this.view.spatialReference=d)):(this._override("activeBasemap",f),this._loadingProjectionEngine=!0,p.load().then(()=>{this._get("activeBasemap")===a&&(this.view.map.basemap=a,this.view.spatialReference=d,this._clearOverride("activeBasemap"))},()=>{}).then(()=>{this._loadingProjectionEngine=!1}))):(this.view.map.basemap=f,this._clearOverride("activeBasemap"))}else this.view.map.basemap=f,this._clearOverride("activeBasemap")}}},{key:"compatibilityFunction",get:function(){var a;return"3d"===(null==
(a=this.view)?void 0:a.type)?w.default3DCompatibility:w.default2DCompatibility},set:function(a){n.isSome(a)?this._override("compatibilityFunction",a):this._clearOverride("compatibilityFunction")}},{key:"state",get:function(){var a;return null!=(a=this.view)&&a.ready&&this.source?this._loadingProjectionEngine?"loading":"ready":"disabled"}}]);return m}(c.HandleOwnerMixin(t));e.__decorate([g.property()],c.prototype,"_loadingProjectionEngine",void 0);e.__decorate([g.property()],c.prototype,"activeBasemap",
null);e.__decorate([g.property()],c.prototype,"compatibilityFunction",null);e.__decorate([g.property({readOnly:!0,type:y})],c.prototype,"items",void 0);e.__decorate([g.property()],c.prototype,"source",void 0);e.__decorate([B.cast("source")],c.prototype,"castSource",null);e.__decorate([g.property({readOnly:!0})],c.prototype,"state",null);e.__decorate([g.property()],c.prototype,"view",void 0);return c=e.__decorate([C.subclass("esri.widgets.BasemapGallery.BasemapGalleryViewModel")],c)});