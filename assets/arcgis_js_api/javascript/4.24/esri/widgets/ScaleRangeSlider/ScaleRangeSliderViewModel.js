// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/HandleOwner ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./ScaleRanges ../Slider/SliderViewModel".split(" "),function(m,g,f,t,p,h,x,y,z,u,q,v){f=function(r){function l(a){a=r.call(this,a)||this;a.layer=null;a.scaleRanges=q.fromScaleRange({minScale:0,maxScale:0});
({max:b}=a._getSliderIndexRange(a.scaleRanges.length-1));var b=new v({precision:10,min:0,max:b,values:[0,b]});a.sliderViewModel=b;return a}m._inheritsLoose(l,r);var e=l.prototype;e.initialize=function(){var a=this;this.handles.add([p.watch(()=>{var b;return null==(b=this.layer)?void 0:b.loaded},m._asyncToGenerator(function*(){const {layer:b,view:c}=a;if(b){c&&(yield c.when());yield b.when();if(a._hasTiledLayer()){const d=a.mapScaleToSlider(a._getTiledLayerMaxScale()),k=a.mapScaleToSlider(a._getTiledLayerMinScale());
a.sliderViewModel.effectiveMax=d;a.sliderViewModel.effectiveMin=k}if("minScale"in b&&"maxScale"in b){const {minScale:d,maxScale:k}=b;a.set({minScale:d,maxScale:k})}else a.set({minScale:void 0,maxScale:void 0})}}),p.initial)])};e.mapScaleToSlider=function(a){const b=this.scaleRanges.scaleToRangeIndex(a),c=this.scaleRanges.findScaleRangeByIndex(b),{maxScale:d,minScale:k}=c,{max:n,min:w}=this._getSliderIndexRange(b);return this._mapToRange(a,k,d,w,n)};e.mapSliderToScale=function(a){const b=this.scaleRanges.findScaleRangeByIndex(a),
{maxScale:c,minScale:d}=b,{max:k,min:n}=this._getSliderIndexRange(a);return this._mapToRange(a,n,k,d,c)};e._setSliderRange=function(a){this.scaleRanges=q.fromScaleRange(a);({max:a}=this._getSliderIndexRange(this.scaleRanges.length-1));this.sliderViewModel.max=a;this.sliderViewModel.min=0;this.notifyChange("maxScaleLimit");this.notifyChange("minScaleLimit")};e._getSliderIndexRange=function(a){a=Math.floor(a);return{min:a,max:a+.99999}};e._mapToRange=function(a,b,c,d,k){return d+(a-b)*(k-d)/(c-b)};
e._setMaxScaleOnSlider=function(a){const {scaleRanges:b,sliderViewModel:c}=this;void 0!==a&&(a=this.mapScaleToSlider(this._constrainMaxScaleToLayer(b.clampMaxScale(a))),c.values=[c.values[0],a])};e._setMinScaleOnSlider=function(a){const {scaleRanges:b,sliderViewModel:c}=this;void 0!==a&&(a=this.mapScaleToSlider(this._constrainMinScaleToLayer(b.clampMinScale(a))),c.values=[a,c.values[1]])};e._constrainMinScaleToLayer=function(a){var {scaleRanges:b}=this;if(this._hasTiledLayer()){({firstRange:b}=b);
const c=this._getTiledLayerMinScale();a=.85<this._mapToRange(a,b.maxScale,b.minScale,0,1)?c:a>c?c:a}return a};e._constrainMaxScaleToLayer=function(a){if(this._hasTiledLayer()){const b=this._getTiledLayerMaxScale();a=a<b?b:a}return a};e._normalizeScale=function(a,b){var c="max"===a?"maxScale":"minScale";c=this._hasTiledLayer()?"min"===a?this._getTiledLayerMinScale():this._getTiledLayerMaxScale():this.scaleRanges[c];a=this._hasTiledLayer()?"min"===a?this._getTiledLayerRealMinScale():this._getTiledLayerRealMaxScale():
c;return Number((0===b||a===b||1E-6>=Math.abs(a-b)?0:b).toFixed(6))};e._getLayerLODS=function(){var a,b;return this.layer&&"tileInfo"in this.layer?"imagery-tile"===(null==(a=this.layer)?void 0:a.type)&&"Raster"===(null==(b=this.layer.raster)?void 0:b.tileType)?null:this.layer.tileInfo.lods:null};e._getTiledLayerMinScale=function(){const a=this._getLayerLODS();return this.scaleRanges.clampMinScale(a[0].scale)};e._getTiledLayerMaxScale=function(){const a=this._getLayerLODS();return a[a.length-1].scale};
e._getTiledLayerRealMinScale=function(){var a,b,c,d=this._getLayerLODS();d="sourceJSON"in this.layer?null!=(a=null==(b=this.layer.sourceJSON)?void 0:null==(c=b.tileInfo)?void 0:c.lods)?a:d:d;return this.scaleRanges.clampMinScale(d[0].scale)};e._getTiledLayerRealMaxScale=function(){var a,b,c,d=this._getLayerLODS();d="sourceJSON"in this.layer?null!=(a=null==(b=this.layer.sourceJSON)?void 0:null==(c=b.tileInfo)?void 0:c.lods)?a:d:d;return d[d.length-1].scale};e._hasTiledLayer=function(){return!!this._getLayerLODS()};
m._createClass(l,[{key:"effectiveMaxScale",get:function(){return 0===this.maxScale?this.maxScaleLimit:this.maxScale}},{key:"effectiveMinScale",get:function(){return 0===this.minScale?this.minScaleLimit:this.minScale}},{key:"maxScale",get:function(){const a=this.mapSliderToScale(this.sliderViewModel.values[1]);return this._normalizeScale("max",a)},set:function(a){this._setMaxScaleOnSlider(a)}},{key:"maxScaleLimit",get:function(){return this.mapSliderToScale(this.sliderViewModel.max)},set:function(a){this._setSliderRange({maxScale:a,
minScale:this.minScaleLimit})}},{key:"minScale",get:function(){const a=this.mapSliderToScale(this.sliderViewModel.values[0]);return this._normalizeScale("min",a)},set:function(a){this._setMinScaleOnSlider(a)}},{key:"minScaleLimit",get:function(){return this.mapSliderToScale(this.sliderViewModel.min)},set:function(a){this._setSliderRange({maxScale:this.maxScaleLimit,minScale:a})}},{key:"state",get:function(){const {view:a,layer:b}=this;return!a&&!b||!a&&b&&b.loaded||!b&&a&&a.ready||a&&a.ready&&b&&
b.loaded?"ready":"disabled"}},{key:"view",set:function(a){this._set("view",a)}}]);return l}(t.HandleOwnerMixin(f));g.__decorate([h.property({readOnly:!0})],f.prototype,"effectiveMaxScale",null);g.__decorate([h.property({readOnly:!0})],f.prototype,"effectiveMinScale",null);g.__decorate([h.property()],f.prototype,"layer",void 0);g.__decorate([h.property()],f.prototype,"maxScale",null);g.__decorate([h.property()],f.prototype,"maxScaleLimit",null);g.__decorate([h.property()],f.prototype,"minScale",null);
g.__decorate([h.property()],f.prototype,"minScaleLimit",null);g.__decorate([h.property()],f.prototype,"scaleRanges",void 0);g.__decorate([h.property()],f.prototype,"sliderViewModel",void 0);g.__decorate([h.property({readOnly:!0})],f.prototype,"state",null);g.__decorate([h.property()],f.prototype,"view",null);return f=g.__decorate([u.subclass("esri.widgets.ScaleRangeSlider.ScaleRangeSliderViewModel")],f)});