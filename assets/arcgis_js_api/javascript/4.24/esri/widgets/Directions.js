// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../intl ../core/deprecate ../core/events ../core/Handles ../core/Logger ../core/maybe ../core/reactiveUtils ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ../rest/support/Stop ../symbols/SimpleMarkerSymbol ./Search ./Widget ./Directions/DirectionsViewModel ./Directions/components/SaveLayer ./Directions/support/directionsUtils ./Directions/support/resources ./Search/support/locatorUtils ./support/DatePicker ./support/Heading ./support/TimePicker ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils ../chunks/sortable.esm ../intl/substitute ../intl/date ../intl/number".split(" "),
function(J,K,p,m,C,D,V,W,h,u,z,ka,la,X,v,Y,Z,aa,ba,ca,M,da,G,c,N,ea,A,fa,B,L,e,ma,ha,O,P,Q){function R(H){return!(null==H.composedPath||!H.composedPath().find(E=>{var f;return null==(f=E.classList)?void 0:f.contains("esri-search__suggestions-list")}))}const S={departureTime:!0,layerDetails:!0,printButton:!1,saveAsButton:!0,saveButton:!0,stops:!0,traveMode:!0},F=W.getLogger("esri.widgets.Directions");m=function(H){function E(a,d){var b=H.call(this,a,d)||this;b._autoStopRemovalDelay=100;b._departureTime=
c.DepartureTime.NOW;b._datePicker=new ea;b._handles=new V;b._newPlaceholderStop=null;b._pointerPressedSearchSuggestionStop=null;b._renderSavePopoverFunction=null;b._saveAsButtonNode=null;b._saveLayer=new da.SaveLayer;b._sections=null;b._stopsToSearches=new Map;b._timePicker=new fa;b.apiKey=null;b.goToOverride=null;b.headingLevel=2;b.iconClass=c.CSS.widgetIcon;b.label=void 0;b.lastRoute=null;b.layer=null;b.maxStops=null;b.messages=null;b.messagesCommon=null;b.messagesUnits=null;b.searchProperties=
null;b.view=null;b.viewModel=new M;b.visibleElements={...S};b._setUpDragAndDropStops=g=>{b._sortable=ha.Sortable.create(g,{draggable:`.${c.CSS.validStopRow}`,ghostClass:c.CSS.stopRowGhost,handle:`.${c.CSS.stopHandle}`,onEnd:b._handleStopInputDragEnd})};b._handleDragHandlePointerDown=()=>b.viewModel.layer.stops.forEach(g=>b._acquireSearch(g).activeMenu="none");b._handleStopInputDragEnd=({oldIndex:g,newIndex:k,target:l})=>{if(g!==k){var {children:n}=l,r=n[g];l.insertBefore(n[k],0>k-g?r.nextElementSibling:
r);l=b.viewModel.layer.stops;l.reorder(l.getItemAt(g),k);for(const q of l)q.sequence=null;b._getDirections()}};return b}K._inheritsLoose(E,H);var f=E.prototype;f.initialize=function(){this.own([u.watch(()=>this.viewModel.layer.routeInfo,()=>{this._focusedManeuver=this._activeManeuver=null;this._sections=this._getSections();this.scheduleRender()},u.initial),u.when(()=>this.view,(a,d)=>{d&&(this._viewClickHandle=null,this._handles.remove(d));if(a){d=this._prepPointerDownUpClick();const b=this._prepViewClick();
d.pause();b.pause();this._handles.add([D.on(a.surface,"mousedown",()=>this._autoStopRemovalDelay=500),D.on(a.surface,"mouseup",()=>this._autoStopRemovalDelay=100),d,b],this.view.surface);this._pointerDownUpHandle=d;this._viewClickHandle=b}},u.initial),u.when(()=>h.isNone(this.viewModel.serviceDescription),()=>{try{this.viewModel.load()}catch{}},u.initial),u.watch(()=>this._saveLayer.state,()=>{this.scheduleRender()})]);this.when(()=>{this.destroyed||(this._renderSavePopoverFunction=this._renderSavePopover.bind(this),
this._projector.append(document.body,this._renderSavePopoverFunction))})};f.loadDependencies=function(){return Promise.all([new Promise((a,d)=>J(["../chunks/calcite-button"],a,d)),new Promise((a,d)=>J(["../chunks/calcite-link"],a,d)),new Promise((a,d)=>J(["../chunks/calcite-popover"],a,d))])};f.destroy=function(){this._datePicker.destroy();this._timePicker.destroy();for(const a of this._stopsToSearches.values())a.destroy();this._sortable&&this._sortable.destroy();h.isSome(this._renderSavePopoverFunction)&&
this._projector.detach(this._renderSavePopoverFunction)};f.castVisibleElements=function(a){return{...S,...a}};f.getDirections=function(){return null};f.render=function(){return e.tsx("div",{class:this.classes(c.CSS.base,c.CSS.scroller)},this._renderPanelContent())};f.save=function(){return this.viewModel.layer.save()};f.saveAs=function(a,d={}){return this.viewModel.layer.saveAs(a,d)};f.zoomToRoute=function(){};f._renderPanelContent=function(){const {viewModel:{serviceDescription:a,state:d}}=this;
var b="initializing"===d;const g="error"===d&&!a,k="unauthenticated"===d,l={[c.CSS.panelContentLoading]:b,[c.CSS.panelContentError]:g,[c.CSS.panelContentSignIn]:k},n=b?"presentation":"group";b=k?this._renderSignIn():g?this._renderMessage(this._getErrorMessage()):b?this._renderLoader():this._renderReadyContent();return e.tsx("div",{class:this.classes(c.CSS.panelContent,l),role:n},b)};f._renderReadyContent=function(){return[this._renderStopsContainer(),this._renderTravelModeOptions(),this._renderDepartureTimeControls(),
this._renderSaveContainer(),this._renderSectionSplitter(),this._renderDirectionsContainer()]};f._renderSignIn=function(){return e.tsx("div",{key:"sign-in",class:c.CSS.signInContent},e.tsx(A.Heading,{class:c.CSS.contentTitle,level:this.headingLevel},this.messages.widgetLabel),this._renderPlaceholder(),e.tsx(A.Heading,{level:A.incrementHeadingLevel(this.headingLevel)},this.messages.signInRequired),e.tsx("button",{class:this.classes(c.CSS.button,c.CSS.buttonSecondary,c.CSS.signInButton),tabIndex:0,onclick:this._handleSignInClick,
bind:this,type:"button"},this.messagesCommon.auth.signIn))};f._handleSignInClick=function(){this.viewModel.load().catch(()=>{})};f._renderTravelModeOptions=function(){if(!this.visibleElements.traveMode)return null;const {selectedTravelMode:a,travelModes:d}=this.viewModel;if(0===d.length)return null;const b=h.isSome(a)?a.name:this.messages.travelMode;return e.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(c.CSS.travelMode,this._saveLayer.opened&&c.CSS.buttonDisabled),
key:"esri-directions__travel-mode-controls",role:"group"},e.tsx("select",{"aria-label":b,bind:this,class:this.classes(c.CSS.travelModeSelect,c.CSS.select),key:"esri-directions__travel-mode-options",onchange:this._handleTravelModeChange,title:b},d.map(g=>{const k=h.isSome(a)&&g.id===a.id;return e.tsx("option",{key:`esri-directions__travel-mode-${g.id}`,"data-mode":g,selected:k,value:g.id},g.name)})))};f._handleTravelModeChange=function(a){a=a.currentTarget;a=a.item(a.selectedIndex);this.viewModel.selectedTravelMode=
a["data-mode"];this._getDirections()};f._renderStopsContainer=function(){return this.visibleElements.stops?e.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(c.CSS.section,this._saveLayer.opened&&c.CSS.buttonDisabled),key:"esri-directions__stops-container",role:"group"},this._renderStops()):null};f._renderDepartureTimeControls=function(){if(!this.visibleElements.departureTime)return null;const a=this._departureTime,{messages:d}=this,b=d.departureTime;return e.tsx("div",
{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(c.CSS.departureTime,this._saveLayer.opened&&c.CSS.buttonDisabled),key:"esri-directions__departure-time-controls",role:"group"},e.tsx("select",{"aria-label":b,bind:this,class:this.classes(c.CSS.departureTimeSelect,c.CSS.select),onchange:this._handleDepartureOptionChange,title:b},e.tsx("option",{value:c.DepartureTime.NOW,selected:a===c.DepartureTime.NOW},d.leaveNow),e.tsx("option",{value:c.DepartureTime.DEPART_BY,selected:a===c.DepartureTime.DEPART_BY},
d.departBy),e.tsx("option",{value:c.DepartureTime.UNSPECIFIED,selected:a===c.DepartureTime.UNSPECIFIED},d.timeUnspecified)),a===c.DepartureTime.DEPART_BY?this._renderTimeControls():null)};f._renderStops=function(){const a=this.viewModel.layer.stops;let d=0;for(var b of this._stopsToSearches.keys())a.includes(b)||this._disposeSearch(b);for(var g of a)b=this._acquireSearch(g),"none"!==b.activeMenu&&(d+=1),h.isSome(g.name)&&(b.searchTerm=g.name);g=a.toArray().map((k,l)=>{var n=a.length,r=1<l&&h.isNone(k.geometry);
const q={[c.CSS.stopsIcon]:0<=l&&l<n-1,[c.CSS.lastStopIcon]:l===n-1},y={[c.CSS.lastStopIconContainer]:l===n-1};r={[c.CSS.validStopRow]:!r};var t=a.getItemAt(l+1);t=t&&h.isSome(t.geometry);var w=l===n-1,x=l===n-2;t=2===n&&0===l||2<n&&!w&&!x||2<n&&x&&t||2<n&&w&&h.isNone(k.geometry);n=3>n;w=this._acquireSearch(k);({messages:x}=this);const {removeStop:I,reverseStops:T,unlocated:ia}=x;x=O.substitute(x.stopLabelTemplate,{number:l+1,label:h.isSome(k.geometry)?k.name:ia});const U=`${this.id}__stop--${l}`;
k=!!w.searchTerm&&!!w.selectedResult&&h.isSome(k.geometry)&&w.selectedResult.name===k.name;const ja={zIndex:"none"!==w.activeMenu?`${d--}`:""};return e.tsx("li",{"aria-label":x,afterCreate:this._handleStopFieldCreation,bind:this,class:this.classes(c.CSS.stopRow,r),id:U,key:l,"data-stop-index":l,styles:ja},e.tsx("div",{class:c.CSS.stopHandle},e.tsx("span",{"aria-hidden":"true",class:this.classes(c.CSS.stopIcon,c.CSS.handleIcon,c.CSS.stopHandleIcon,c.CSS.interactiveStopIcon),onpointerdown:this._handleDragHandlePointerDown}),
e.tsx("div",{bind:this,"aria-labelledby":U,class:this.classes(c.CSS.stopIconContainer,y),"data-stop-index":l,onclick:this._handleStopIconClick,onkeydown:this._handleStopIconClick,role:"button"},e.tsx("span",{class:this.classes(c.CSS.stopIcon,q),tabindex:k?"0":null}))),e.tsx("div",{class:c.CSS.stopInput},w.render()),e.tsx("div",{class:c.CSS.stopOptions,role:"group"},e.tsx("div",{"aria-label":I,class:c.CSS.removeStopButton,bind:this,"data-stop-index":l,hidden:n,onkeydown:this._handleRemoveStop,onclick:this._handleRemoveStop,
role:"button",tabIndex:0,title:I},e.tsx("span",{"aria-hidden":"true",class:this.classes(c.CSS.stopIcon,c.CSS.removeStop,c.CSS.removeStopIcon,c.CSS.interactiveStopIcon)}),e.tsx("span",{class:c.CSS.screenReaderText},"removeStopTitle")),e.tsx("div",{"aria-label":T,class:c.CSS.reverseStops,bind:this,hidden:t,onkeydown:this._handleReverseStops,onclick:this._handleReverseStops,role:"button",tabIndex:0,title:T},e.tsx("span",{"aria-hidden":"true",class:this.classes(c.CSS.stopIcon,c.CSS.reverseStopIcon,c.CSS.interactiveStopIcon)}),
e.tsx("span",{class:c.CSS.screenReaderText},"removeStopTitle"))))});b=this._renderAddStop();return e.tsx("div",null,e.tsx("ol",{class:c.CSS.stops,role:"group",afterCreate:this._setUpDragAndDropStops},g),b)};f._renderAddStop=function(){var {stops:a}=this.viewModel.layer;const d=a.filter(({geometry:b})=>h.isSome(b));a=a.at(-1);return 1<d.length&&d.length<this.maxStops&&h.isSome(a)&&h.isSome(a.geometry)?e.tsx("div",{class:c.CSS.toolbarSection},e.tsx("div",{class:c.CSS.toolbarButtons},e.tsx("calcite-button",
{appearance:"outline",class:c.CSS.addStopButton,color:"neutral","icon-start":"plus",key:c.CSS.addStopButton,onclick:()=>{this._addNewPlaceholder()},text:this.messages.addStop,width:"half"},this.messages.addStop))):null};f._handleStopIconClick=function(a){(a=this.viewModel.layer.stops.getItemAt(a.currentTarget["data-stop-index"]))&&h.isSome(a.geometry)&&this._centerAtStop(a)};f._handleClearRouteClick=function(){this.viewModel.reset()};f._centerAtStop=function(a){this.viewModel.centerAt(a)};f._handleStopFieldCreation=
function(a){const d=this._newPlaceholderStop;if(d){a=this.viewModel.layer.stops.getItemAt(a["data-stop-index"]);if(d===a){const b=this._acquireSearch(a);b.when(()=>{this.renderNow();b.focus()})}this._newPlaceholderStop=null}};f._handleStopInputBlur=function(a,d){var b,g,k,l;this._saveLayer.opened||(this._handles.remove("awaiting-view-click-stop"),this.view.cursor=this._previousCursor,a.selectedResult&&h.isSome(d.geometry)&&h.isSome(null==(b=a.selectedResult)?void 0:b.feature.geometry)&&d.geometry===
(null==(g=a.selectedResult)?void 0:g.feature.geometry)?this._pointerDownUpHandle.pause():(b=h.isNone(d.geometry)&&h.isNone(null==(k=a.selectedResult)?void 0:k.feature.geometry),k=h.isSome(d.geometry)&&h.isSome(null==(l=a.selectedResult)?void 0:l.feature.geometry)&&d.geometry!==a.selectedResult.feature.geometry,(b||k)&&"none"===a.activeMenu&&a.searchTerm?(a.search(),this._pointerDownUpHandle.pause()):a.searchTerm||(this._viewClickHandle.resume(),clearTimeout(this._autoStopRemovalTimeoutId),this._autoStopRemovalTimeoutId=
setTimeout(()=>{this.destroyed||(this._viewClickHandle.pause(),"searching"===a.viewModel.state?this._pointerDownUpHandle.pause():this._pointerPressedSearchSuggestionStop||(h.isSome(d.geometry)&&(d.geometry=null,this._getDirections()),this.scheduleRender()))},this._autoStopRemovalDelay))))};f._handleStopInputFocus=function(a,d){this._pointerDownUpHandle.resume();if(!this._handles.has("awaiting-view-click-stop")){var {view:b,view:{cursor:g}}=this;this._previousCursor=g;this._handles.add(u.watch(()=>
a.searchTerm,k=>{a.destroyed||(b.cursor=0===k.length?"copy":g)},u.initial),"awaiting-view-click-stop");this._activeStop=d}};f._prepViewClick=function(){const {view:a}=this.viewModel,d=D.pausable(a,"click",this._handleViewClick.bind(this)),b=D.pausable(a.surface,"click",()=>{clearTimeout(this._autoStopRemovalTimeoutId);b.pause()});return{remove(){b.remove();d.remove()},pause(){b.pause();d.pause()},resume(){b.resume();d.resume()}}};f._prepPointerDownUpClick=function(){const a=D.pausable(document,"pointerdown",
b=>{this._pointerPressedSearchSuggestionStop=R(b)?this._activeStop:null}),d=D.pausable(document,"pointerup",b=>{this._pointerDownUpHandle.pause();b=R(b);const g=this._activeStop;b||g!==this._pointerPressedSearchSuggestionStop||this._removeStop(g);this.scheduleRender();this._pointerPressedSearchSuggestionStop=b?g:null});return{remove(){d.remove();a.remove()},pause(){d.pause();a.pause()},resume(){a.resume()}}};f._handleViewClick=function(a){const d=this._stopsToSearches.get(this._activeStop);d&&!d.searchTerm&&
(d.search(a.mapPoint).then(b=>{const {feature:g,name:k}=b.results[0].results[0];this._activeStop.geometry=g.geometry;this._activeStop.name=k;d.searchTerm=k}),this.scheduleRender());this._viewClickHandle.pause();clearTimeout(this._autoStopRemovalTimeoutId)};f._addNewPlaceholder=function(){this._pointerDownUpHandle.pause();if(!this._newPlaceholderStop){var a=new Z({symbol:new aa});this.viewModel.layer.stops.add(a);this._newPlaceholderStop=a}};f._handleReverseStops=function(){this._reverseStops()};f._reverseStops=
function(){this.viewModel.layer.stops.reverse();for(const a of this.viewModel.layer.stops)a.sequence=null;this._getDirections()};f._handleRemoveStop=function(a){a=this.viewModel.layer.stops.getItemAt(a.currentTarget["data-stop-index"]);this._removeStop(a);(h.isSome(a.geometry)||h.isNone(this.viewModel.layer.routeInfo))&&this._getDirections()};f._removeStop=function(a){2>=this.viewModel.layer.stops.length||(this._disposeSearch(a),this.viewModel.layer.stops.remove(a))};f._handleDepartureOptionChange=
function(a){a=a.currentTarget;a=a.item(a.selectedIndex);a.value===c.DepartureTime.NOW?(this._departureTime=c.DepartureTime.NOW,this.viewModel.departureTime=c.DepartureTime.NOW,this._handles.remove("departure-time-controls"),this._getDirections()):a.value===c.DepartureTime.DEPART_BY?(this._departureTime=c.DepartureTime.DEPART_BY,this._handles.add(u.watch(()=>[this._datePicker.value,this._timePicker.value],()=>{this._updateDepartureTime();this._getDirections()},u.initial),"departure-time-controls")):
(this._departureTime=c.DepartureTime.UNSPECIFIED,this.viewModel.departureTime=null,this._getDirections())};f._updateDepartureTime=function(){const a=this._datePicker.value,d=this._timePicker.value;a&&d&&(this.viewModel.departureTime=new Date(a.getFullYear(),a.getMonth(),a.getDate(),d.getHours(),d.getMinutes()))};f._renderTimeControls=function(){return e.tsx("div",{class:c.CSS.departureTimeControls,key:"esri-directions__time-controls",role:"group"},this._datePicker.render(),this._timePicker.render())};
f._renderSectionSplitter=function(){return e.tsx("div",{class:c.CSS.sectionSplitter})};f._renderSaveContainer=function(){const {saveButton:a,saveAsButton:d,printButton:b,layerDetails:g}=this.visibleElements;return a||d||b||g?e.tsx("div",{class:c.CSS.saveSection,key:c.CSS.saveSection},this._renderSaveButtons(),this._renderRouteLayerDetailsLink()):null};f._renderSaveButtons=function(){const {saveButton:a,saveAsButton:d,printButton:b}=this.visibleElements;return a||d||b?e.tsx("div",{class:c.CSS.saveButtons,
key:c.CSS.saveButtons},this._renderSaveButton(),this._renderSaveAsButton(),this._renderPrintButton()):null};f._renderSaveButton=function(){var a;if(!this.visibleElements.saveButton)return null;const d=null==(a=this.viewModel.layer.portalItem)?void 0:a.itemControl;a=h.isSome(this.viewModel.layer.routeInfo)&&("admin"===d||"update"===d);return e.tsx("calcite-button",{appearance:"outline",class:c.CSS.saveButton,color:"neutral",disabled:!a,"icon-start":"save",key:c.CSS.saveButton,onclick:()=>{this._handleSaveButtonClick()},
text:this.messagesCommon.save,width:"full"},this.messagesCommon.save)};f._renderSaveAsButton=function(){if(!this.visibleElements.saveAsButton)return null;const a=h.isNone(this.viewModel.layer.routeInfo);return e.tsx("div",{class:c.CSS.saveAsButtonPopover,key:c.CSS.saveAsButtonPopover},e.tsx("calcite-button",{afterCreate:d=>{this._saveAsButtonNode=d},appearance:"outline",class:c.CSS.saveAsButton,color:"neutral",disabled:a,"icon-start":"duplicate",key:c.CSS.saveAsButton,onclick:()=>this._handleSaveAsButtonClick(),
text:this.messagesCommon.saveAs,width:"full"},this.messagesCommon.saveAs))};f._renderSavePopover=function(){return e.tsx("calcite-popover",{label:this._saveLayer.label,open:this._saveLayer.opened,"overlay-positioning":"fixed",referenceElement:h.unwrap(this._saveAsButtonNode)},this._saveLayer.render())};f._handleSaveAsButtonClick=function(){this._saveLayer.opened?this._saveLayer.close():this._saveLayer.open(this.viewModel.layer)};f._renderPrintButton=function(){return this.visibleElements.printButton?
e.tsx("calcite-button",{appearance:"outline",class:c.CSS.printButton,color:"neutral","icon-start":"print",key:c.CSS.printButton,text:this.messagesCommon.print}):null};f._renderRouteLayerDetailsLink=function(){if(!this.visibleElements.layerDetails)return null;const {portalItem:a}=this.viewModel.layer;if(!a)return null;const {id:d,portal:{url:b}}=a;return e.tsx("calcite-link",{class:c.CSS.layerDetailsLink,href:`${b}/home/item.html?id=${d}`,key:c.CSS.layerDetailsLink,target:"_blank"},this.messages.viewLayerDetails)};
f._handleSaveButtonClick=function(){this.viewModel.layer.save()};f._renderDirectionsContainer=function(){return e.tsx("div",{class:this.classes(c.CSS.directionsSection,c.CSS.section),key:"esri-directions__container"},this._renderDirectionsContainerContent())};f._renderLoader=function(){return e.tsx("div",{class:c.CSS.loader,key:"loader"})};f._renderWarningCard=function(){return e.tsx("div",{class:c.CSS.warningCard,role:"alert"},e.tsx("div",{class:c.CSS.warningHeader},e.tsx("span",{class:c.CSS.warningIcon,
"aria-hidden":"true"}),e.tsx(A.Heading,{class:c.CSS.warningHeading,level:this.headingLevel},this.messagesCommon.warning)),e.tsx("div",{class:c.CSS.warningMessage},this._getErrorMessage()))};f._renderDirectionsContainerContent=function(){const {viewModel:{layer:a,state:d}}=this,b="routing"===d;return"error"===d?this._renderWarningCard():b?this._renderLoader():h.isSome(a.directionLines)?e.tsx("div",{"aria-disabled":this._saveLayer.opened.toString(),class:this.classes(c.CSS.summary,this._saveLayer.opened&&
c.CSS.buttonDisabled),key:"esri-directions__summary",role:"group"},this._renderCosts(),this._renderRouteActions(),this._renderManeuverSections()):e.tsx("div",{key:"esri-directions__placeholder",class:c.CSS.emptyContent},this._renderPlaceholder(),e.tsx(A.Heading,{class:c.CSS.message,level:this.headingLevel},this.messages.directionsPlaceholder))};f._renderPlaceholder=function(){return e.tsx("svg",{class:c.CSS.emptyIllustration,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 256 256"},e.tsx("path",{fill:"currentcolor",
d:"M192 36c-15.477 0-24 6.034-24 16.99v45.822l24 24 24-24v-45.82C216 42.033 207.477 36 192 36zm20 61.155l-20 20-20-20V52.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM192 52a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zM92 140.99C92 130.035 83.477 124 68 124s-24 6.034-24 16.99v45.822l24 24 24-24zm-4 44.165l-20 20-20-20V140.99c0-8.62 6.73-12.99 20-12.99s20 4.37 20 12.99zM68 140a12 12 0 1 0 12 12 12.013 12.013 0 0 0-12-12zm0 20a8 8 0 1 1 8-8 8.008 8.008 0 0 1-8 8zm84-44h16v4h-16zm-24 80h4v12h-12v-4h8zm0-28h4v16h-4zm0-52h12v4h-8v8h-4zm0 24h4v16h-4zm-36 64h16v4H92z"}))};
f._renderMessage=function(a){return e.tsx(A.Heading,{level:this.headingLevel},a)};f._renderRouteActions=function(){return e.tsx("div",{class:c.CSS.routeActions},e.tsx("button",{"aria-label":this.messages.clearRoute,class:this.classes(c.CSS.clearRouteButton,c.CSS.button,c.CSS.buttonTertiary),tabIndex:0,onclick:this._handleClearRouteClick,bind:this,type:"button"},this.messages.clearRoute))};f._getSections=function(){const {directionPoints:a,directionLines:d,stops:b}=this.viewModel.layer;if(h.isNone(a)||
h.isNone(d))return null;const g=[];let k=null;for(const n of a){const {objectId:r,stopId:q}=n;if(h.isSome(q)){var l=b.find(t=>t.objectId===q);const y=0===g.length;if(h.isNone(k)||k.stop!==l)k={stop:l,directions:[],open:y},g.push(k)}else h.isNone(k)||(l=d.find(y=>y.directionPointId===r),h.isNone(l)||k.directions.push({directionPoint:n,directionLine:l}))}return g};f._renderManeuverSections=function(){return h.isNone(this._sections)?null:e.tsx("div",{class:c.CSS.maneuvers,role:"group"},this._sections.map((a,
d)=>{const {open:b}=a;let g;0<a.directions.length&&b&&(g=e.tsx("ol",{class:c.CSS.maneuverList},a.directions.map(q=>this._renderManeuver(q))));var k=2<h.unwrap(this._sections).length;const l=d===h.unwrap(this._sections).length-1,n={[c.CSS.collapsibleSection]:k},r={[c.CSS.openIcon]:!b,[c.CSS.closeIcon]:b};k&&!l?(k=b?this.messagesCommon.close:this.messagesCommon.open,a=e.tsx("header",{class:this.classes(c.CSS.maneuverSectionHeader,c.CSS.maneuverSectionToggle),key:c.CSS.maneuverSectionHeader},e.tsx("div",
{"aria-expanded":b.toString(),"aria-label":k,bind:this,class:c.CSS.maneuverSectionHeaderButton,"data-maneuver-section":a,onkeydown:this._handleSectionToggle,onclick:this._handleSectionToggle,role:"button",tabIndex:0,title:k},e.tsx(A.Heading,{class:c.CSS.maneuverSectionTitle,level:this.headingLevel},a.stop.name),e.tsx("span",{"aria-hidden":"true",class:this.classes(r)})))):a=e.tsx("header",{class:c.CSS.maneuverSectionHeader,key:c.CSS.maneuverSectionHeader},e.tsx(A.Heading,{class:c.CSS.maneuverSectionTitle,
level:this.headingLevel},a.stop.name));return e.tsx("section",{class:this.classes(c.CSS.maneuverSection,n),key:d},a,g)}))};f._handleSectionToggle=function(a){a=a.currentTarget["data-maneuver-section"];a.open=!a.open};f._renderCosts=function(){var a=this._getCostSummary(),{directionPoints:d}=this.viewModel.layer;if(h.isNone(d)||h.isNone(a))return null;d=d.getItemAt(d.length-1).arrivalTime;const {primary:b,secondary:g}=a,{eta:k,etaTemplate:l,primaryCosts:n,secondaryCosts:r,zoomToRoute:q}=this.messages;
a=P.convertDateFormatToIntlOptions("short-time");a=h.isSome(d)?`<strong>${P.formatDate(d,a)}</strong>`:null;if(h.isSome(d)){{d=d.getTimezoneOffset();const y=Math.abs(Math.floor(d)%60),t={minimumIntegerDigits:2};d=`GMT${0<d?"-":"+"}${Q.formatNumber(Math.abs(Math.floor(d/60)),t)}${Q.formatNumber(y,t)}`}d=`${d}`}else d=null;a=O.substitute(l,{time:a,gmt:d});return e.tsx("div",{"aria-label":q,bind:this,class:c.CSS.directionCosts,onkeydown:this._handleSummaryInteraction,onclick:this._handleSummaryInteraction,
role:"button",tabIndex:0,title:q},e.tsx("div",{class:c.CSS.costsDetails,role:"group"},e.tsx("div",{class:c.CSS.primaryCosts,title:n},b),e.tsx("div",{class:c.CSS.verticalSplitter}),e.tsx("div",{class:c.CSS.secondaryCosts,title:r},g)),e.tsx("div",{innerHTML:a,title:k}))};f._handleSummaryInteraction=function(){this._focusedManeuver=this._activeManeuver=null;this.viewModel.clearHighlights();this.zoomToRoute()};f._getErrorMessage=function(){const {messages:a,viewModel:{lastError:d}}=this;if(h.isSome(d))switch(d.name){case "directions-view-model:unable-to-route":return a.errors.unableToRoute;
case "directions-view-model:service-metadata-unavailable":return a.errors.unableToLoadServiceMetadata}return a.errors.unknownError};f._normalizeSearchSources=function(a){this._overrideDefaultSources(a);this._applyLocatorSourceOverrides(a)};f._overrideDefaultSources=function(a){a.viewModel.defaultSources.forEach(d=>{d.autoNavigate=!1})};f._applyLocatorSourceOverrides=function({allSources:a}){for(const b of a)if("url"in b&&b.url){var d;null!=(d=b.locationType)?d:b.locationType="street";N.isArcGISWorldGeocoder(b.url)&&
this.apiKey&&null==b.apiKey&&(b.apiKey=this.apiKey,b.url=N.meteredArcGISLocatorUrl)}};f._acquireSearch=function(a){const {view:d}=this.viewModel;if(this._stopsToSearches.has(a)){const g=this._stopsToSearches.get(a);g.view=d;this._overrideDefaultSources(g);return g}const b=new ba({view:d,resultGraphicEnabled:!1,popupEnabled:!1,...this.searchProperties});this._normalizeSearchSources(b);this._handles.add([u.on(()=>b.allSources,"change",()=>this._normalizeSearchSources(b)),b.on("select-result",()=>{a.geometry=
b.selectedResult.feature.geometry;a.name=b.selectedResult.name;this._getDirections()}),b.on("search-focus",()=>this._handleStopInputFocus(b,a)),b.on("search-blur",()=>this._handleStopInputBlur(b,a)),b.on("search-clear",()=>{a.geometry=null;a.name=null;this._activeStop=a;this.viewModel.layer.removeResult()}),u.watch(()=>b.searchTerm,g=>{a.name=g})],b);this._stopsToSearches.set(a,b);return b};f._disposeSearch=function(a){this._stopsToSearches.has(a)&&(this._stopsToSearches.get(a).destroy(),this._stopsToSearches.delete(a))};
f._renderManeuver=function(a){var {directionsLengthUnits:d}=this.viewModel.routeParameters;const {directionPoint:b,directionLine:g}=a,{distance:k,duration:l}=g,{messages:n,messagesUnits:r}=this;a=G.formatDistance(n,r,h.unwrapOrValue(k,0),{fromUnits:"meters",toUnits:d});d=G.formatTime(h.unwrapOrValue(l,0),"minutes");a=a&&d?`${a}&nbsp;&middot;&nbsp;${d}`:`${a}${d}`;d=this._getFormattedManeuverText(b);const {objectId:q,directionPointType:y}=b,t=c.getIconPath(y),w=`esri-directions__maneuver-${q}`,x=`esri-directions__cumulative-costs-${q}`,
I=`esri-directions__intermediate-costs-${q}`;return e.tsx("li",{"aria-labelledby":`${w} ${x} ${I}`,bind:this,class:this.classes(c.CSS.maneuver,{[c.CSS.maneuverActive]:this._activeManeuver===g}),"data-maneuver":g,key:g,onclick:this._handleManeuverClick,onkeydown:this._handleManeuverClick,onfocus:this._handleManeuverFocus,onmouseover:this._handleManeuverMouseOver,onmouseout:this._handleManeuverMouseOut,onblur:this._handleManeuverBlur,tabIndex:0},h.isSome(t)&&e.tsx("img",{alt:"",class:c.CSS.maneuverIcon,
src:t}),e.tsx("div",{class:c.CSS.maneuverCostsContainer},e.tsx("span",{id:w,innerHTML:h.unwrapOrValue(d,"")}),e.tsx("div",{class:c.CSS.maneuverCosts},e.tsx("div",{class:c.CSS.horizontalSplitter}),e.tsx("div",{id:x,class:c.CSS.cumulativeCost,innerHTML:"",title:n.cumulativeCosts}),e.tsx("div",{id:I,class:c.CSS.intermediateCost,innerHTML:a,title:n.intermediateCosts}))))};f._handleManeuverClick=function(a){a=a.currentTarget["data-maneuver"];if(this._activeManeuver===a)this._activeManeuver=null,this.zoomToRoute();
else{this._activeManeuver=a;var {geometry:d}=a;this.viewModel.centerAt(d);this.viewModel.highlight(a)}};f._handleManeuverMouseOver=function(a){this._activeManeuver||this._focusedManeuver||this.viewModel.highlight(a.currentTarget["data-maneuver"])};f._handleManeuverMouseOut=function(){this._activeManeuver||this._focusedManeuver||this.viewModel.clearHighlights()};f._handleManeuverBlur=function(){this._activeManeuver||(this._focusedManeuver=null,this.viewModel.clearHighlights())};f._handleManeuverFocus=
function(a){this._activeManeuver||(this._focusedManeuver=a=a.currentTarget["data-maneuver"],this.viewModel.highlight(a))};f._getFormattedManeuverText=function(a){const {displayText:d,name:b,intersectingName:g}=a;if(h.isNone(d))return"";a=d;h.isSome(b)&&a.includes(b)&&(a=a.replace(b,`<strong>${b}</strong>`));h.isSome(g)&&a.includes(g)&&(a=a.replace(g,`<strong>${g}</strong>`));return a};f._getCostSummary=function(){const {viewModel:{impedanceAttribute:a,layer:{routeInfo:d},routeParameters:b}}=this;
if(h.isNone(a)||h.isNone(d))return null;let {totalDuration:g,totalDistance:k}=d;var {directionsLengthUnits:l}=b;k=h.isSome(k)?k:0;g=h.isSome(g)?g:0;l=G.formatDistance(this.messages,this.messagesUnits,k,{fromUnits:"meters",toUnits:l});const n=G.formatTime(g,"minutes"),[r,q]=G.isTimeUnits(a.units)?[n,l]:[l,n];return{primary:r,secondary:q}};f._getDirections=function(){var a=K._asyncToGenerator(function*(){if(!(2>this.viewModel.layer.stops.filter(d=>h.isSome(d.geometry)).length))try{yield this.viewModel.getDirections()}catch{}});
return function(){return a.apply(this,arguments)}}();K._createClass(E,[{key:"routeServiceUrl",get:function(){C.deprecatedProperty(F,"routeServiceUrl",{replacement:"viewModel.layer.url",version:"4.24",warnOnce:!0});return this.viewModel.legacyLayer.url},set:function(a){C.deprecatedProperty(F,"routeServiceUrl",{replacement:"viewModel.layer.url",version:"4.24",warnOnce:!0});this.viewModel.legacyLayer.url=a}},{key:"routeSymbol",get:function(){C.deprecatedProperty(F,"routeSymbol",{replacement:"viewModel.layer.defaultSymbols.directionLines",
version:"4.24",warnOnce:!0});return this.viewModel.legacyLayer.defaultSymbols.directionLines},set:function(a){C.deprecatedProperty(F,"routeSymbol",{replacement:"viewModel.layer.defaultSymbols.directionLines",version:"4.24",warnOnce:!0});this.viewModel.legacyLayer.defaultSymbols.directionLines=a}},{key:"stopSymbols",get:function(){C.deprecatedProperty(F,"stopSymbols",{replacement:"viewModel.layer.defaultSymbols.stops",version:"4.24",warnOnce:!0});return this.viewModel.legacyLayer.defaultSymbols.stops},
set:function(a){C.deprecatedProperty(F,"stopSymbols",{replacement:"viewModel.layer.defaultSymbols.stops",version:"4.24",warnOnce:!0});this.viewModel.legacyLayer.defaultSymbols.stops=a}}]);return E}(ca);p.__decorate([z.aliasOf("viewModel.apiKey")],m.prototype,"apiKey",void 0);p.__decorate([z.aliasOf("viewModel.goToOverride")],m.prototype,"goToOverride",void 0);p.__decorate([v.property()],m.prototype,"headingLevel",void 0);p.__decorate([v.property()],m.prototype,"iconClass",void 0);p.__decorate([v.property({aliasOf:{source:"messages.widgetLabel",
overridable:!0}})],m.prototype,"label",void 0);p.__decorate([z.aliasOf("viewModel.lastRoute")],m.prototype,"lastRoute",void 0);p.__decorate([z.aliasOf("viewModel.layer")],m.prototype,"layer",void 0);p.__decorate([z.aliasOf("viewModel.maxStops")],m.prototype,"maxStops",void 0);p.__decorate([v.property(),L.messageBundle("esri/widgets/Directions/t9n/Directions")],m.prototype,"messages",void 0);p.__decorate([v.property(),L.messageBundle("esri/t9n/common")],m.prototype,"messagesCommon",void 0);p.__decorate([v.property(),
L.messageBundle("esri/core/t9n/Units")],m.prototype,"messagesUnits",void 0);p.__decorate([v.property()],m.prototype,"routeServiceUrl",null);p.__decorate([v.property()],m.prototype,"routeSymbol",null);p.__decorate([v.property()],m.prototype,"searchProperties",void 0);p.__decorate([v.property()],m.prototype,"stopSymbols",null);p.__decorate([z.aliasOf("viewModel.view")],m.prototype,"view",void 0);p.__decorate([v.property({type:M})],m.prototype,"viewModel",void 0);p.__decorate([v.property()],m.prototype,
"visibleElements",void 0);p.__decorate([X.cast("visibleElements")],m.prototype,"castVisibleElements",null);p.__decorate([z.aliasOf("viewModel.getDirections")],m.prototype,"getDirections",null);p.__decorate([z.aliasOf("viewModel.zoomToRoute")],m.prototype,"zoomToRoute",null);p.__decorate([B.accessibleHandler()],m.prototype,"_handleStopIconClick",null);p.__decorate([B.accessibleHandler()],m.prototype,"_handleClearRouteClick",null);p.__decorate([B.accessibleHandler()],m.prototype,"_handleReverseStops",
null);p.__decorate([B.accessibleHandler()],m.prototype,"_handleRemoveStop",null);p.__decorate([B.accessibleHandler()],m.prototype,"_handleSectionToggle",null);p.__decorate([B.accessibleHandler()],m.prototype,"_handleSummaryInteraction",null);p.__decorate([B.accessibleHandler()],m.prototype,"_handleManeuverClick",null);return m=p.__decorate([Y.subclass("esri.widgets.Directions")],m)});