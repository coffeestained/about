// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/maybe ../core/memoize ../core/promiseUtils ../core/reactiveUtils ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./ElevationProfile/css ./ElevationProfile/ElevationProfileViewModel ./ElevationProfile/ElevationProfileVisibleElements ./ElevationProfile/components/Legend ./ElevationProfile/components/SettingsButton ./ElevationProfile/support/chartUtils ./ElevationProfile/support/constants ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory".split(" "),
function(y,f,h,A,B,t,q,e,M,N,k,E,F,g,C,D,G,H,I,m,J,z,p){var n;(function(r){r.Sketch="sketch";r.SketchCancel="sketch-cancel";r.SketchDone="sketch-done";r.Select="select";r.SelectCancel="select-cancel"})(n||(n={}));const v=[{type:n.Select},{type:n.Sketch}],K={[m.ElevationProfileErrorState.None]:null,[m.ElevationProfileErrorState.NoValidInput]:"noProfile",[m.ElevationProfileErrorState.NoVisibleProfiles]:"noProfile",[m.ElevationProfileErrorState.RefinedButNoChartData]:"noProfile",[m.ElevationProfileErrorState.TooComplex]:"tooComplex",
[m.ElevationProfileErrorState.UnknownError]:"unknown",[m.ElevationProfileErrorState.InvalidGeometry]:"invalidGeometry",[m.ElevationProfileErrorState.InvalidElevationInfo]:"invalidElevationInfo"};e=function(r){function x(a,b){b=r.call(this,a,b)||this;b.viewModel=null;b.view=null;b.input=null;b.profiles=null;b.unitOptions=[];b.unit="metric";b.geodesicDistanceThreshold=1E5;b.visibleElements=new D;b.iconClass=g.CSS.widgetIcon;b.label=void 0;b.messages=null;b.messagesCommon=null;b.messagesUnits=null;b._chartContainer=
null;b._chart=null;b._chartInitTask=null;b._chartIsRefined=!1;b._width=0;b._zoomOutButtonVisible=!1;b._getChartUpdateParamsMemoized=A.memoize((c,l,u,w)=>({chart:c,data:l,stationary:u,messages:w}));b._getDetailsPropsMemoized=A.memoize((c,l)=>({effectiveUnits:c,profiles:l}));null!=a&&a.viewModel||(b._defaultViewModel=new C({view:null==a?void 0:a.view}),b.viewModel=b._defaultViewModel);return b}y._inheritsLoose(x,r);var d=x.prototype;d.initialize=function(){this._legend=new G.Legend(this._legendProps);
this._settingsButton=new H.SettingsButton(this._settingsButtonProps);this.own([t.watch(()=>this._legendProps,a=>this._legend.set(a)),t.watch(()=>this._settingsButtonProps,a=>this._settingsButton.set(a))])};d.postInitialize=function(){this.own([t.watch(()=>({container:this._chartContainer,width:this._width}),({container:a,width:b})=>{this._destroyChart();h.isSome(a)&&0<b&&this._initializeChart(a)},t.initial),t.watch(()=>this._chartUpdateParams,()=>this._updateChart(this._chartUpdateParams),t.initial)])};
d.destroy=function(){this._destroyChart();h.isSome(this._defaultViewModel)&&this.viewModel!==this._defaultViewModel&&this._defaultViewModel.destroy();this._legend=h.destroyMaybe(this._legend);this._settingsButton=h.destroyMaybe(this._settingsButton)};d.render=function(){const {viewModel:a,visible:b}=this;return p.tsx("div",{key:this,class:this.classes({[g.CSS.base]:b,[g.CSS.esriWidget]:b,[g.CSS.esriWidgetDisabled]:b&&"disabled"===a.state,[g.CSS.portrait]:this._portrait,[g.CSS.refined]:1===a.progress}),
"aria-label":this.messages.widgetLabel,afterCreate:c=>{this.own(J.onResize(c,l=>{this._width=l.contentRect.width}))}},b&&this._renderContentForState())};d._renderContentForState=function(){switch(this.viewModel.state){case m.ElevationProfileState.Ready:return this._renderContentForReadyState();case m.ElevationProfileState.Selecting:return this._renderContentForSelectingState();case m.ElevationProfileState.Creating:return this._renderContentForCreatingState();case m.ElevationProfileState.Selected:return this._renderContentForSelectedState();
case m.ElevationProfileState.Created:return this._renderContentForCreatedState();case m.ElevationProfileState.Disabled:return this._renderContentForReadyState()}};d._renderContentForReadyState=function(){const {sketchButton:a,selectButton:b}=this.visibleElements;var c=this.messages;if(a&&b)c=c.readyPrompt;else if(a)c=c.readyPromptCreateOnly;else if(b)c=c.readyPromptSelectOnly;else{var l;c=null==(l=c.errors)?void 0:l.noProfile}return this._renderContent({prompt:c,chart:!1,actions:v})};d._renderContentForSelectingState=
function(){const a=this.view;return h.isNone(a)?null:this._renderContent({prompt:this.messages[`selectingPrompt-${a.type}`],chart:!1,actions:[{type:n.SelectCancel}]})};d._renderContentForCreatingState=function(){const {view:a,viewModel:b}=this;if(h.isNone(a))return null;const c=b.hasVertices?[{type:n.SketchCancel},{type:n.SketchDone,disabled:!b.tool.interaction.canStopCreating}]:[{type:n.Select},{type:n.Sketch,disabled:!0}];if(b.errorState===m.ElevationProfileErrorState.NoValidInput)return this._renderContent({chart:!1,
actions:c,prompt:this.messages[`creatingPrompt-${a.type}`]});const l=this._getErrorMessage();return l?this._renderContent({chart:!1,actions:c,prompt:l}):this._renderContent({chart:!0,actions:c})};d._renderContentForSelectedState=function(){const a=this._getErrorMessage();return a?this._renderContent({chart:!1,actions:v,prompt:a}):this._renderContent({chart:!0,actions:v})};d._renderContentForCreatedState=function(){const a=this._getErrorMessage();return a?this._renderContent({chart:!1,actions:v,prompt:a}):
this._renderContent({chart:!0,actions:v})};d._getErrorMessage=function(){var a,b;const c=K[this.viewModel.errorState];return null==(a=this.messages)?void 0:null==(b=a.errors)?void 0:b[c]};d._renderContent=function(a){const b=h.isSome(a.prompt)?this._renderPrompt(a.prompt):a.chart&&this._renderChart(),c=h.isSome(this.viewModel.input);return[p.tsx("header",{key:"header",class:g.CSS.header},this._zoomOutButtonVisible&&this._renderZoomOutButton(),this.visibleElements.clearButton&&c&&this._renderClearButton(),
this.visibleElements.settingsButton&&this._settingsButton.render()),p.tsx("div",{class:g.CSS.mainContainer},...b),this.visibleElements.legend&&this._legend.render(),this._renderActions(a)]};d._renderZoomOutButton=function(){return p.tsx("button",{key:"zoom-out",class:g.CSS.zoomOutButton,bind:this,onclick:this._onZoomOutButtonClick,title:this.messages.zoomOut,type:"button"})};d._onZoomOutButtonClick=function(){h.applySome(this._chart,a=>a.zoomOut())};d._renderClearButton=function(){return p.tsx("button",
{key:"clear-profile",class:g.CSS.clearButton,bind:this,onclick:this._onClearButtonClick,title:this.messages.clearProfile,type:"button"})};d._onClearButtonClick=function(){this.viewModel.clear()};d._renderPrompt=function(a){return[p.tsx("div",{key:"prompt-container",bind:this,class:g.CSS.promptContainer},p.tsx("p",null,a))]};d._renderChart=function(){if(!this.visibleElements.chart)return[p.tsx("div",{key:"empty-chart-container",class:g.CSS.chartContainer})];const a=this._chartIsRefined||this._canRenderChart();
if(!a)return[this._renderSpinner({size:"large"}),p.tsx("div",{key:"chart-container-empty",class:g.CSS.chartContainer})];const {chartData:b,progress:c}=this.viewModel;return[h.isSome(b)&&0<c&&1>c&&this._renderSpinner({size:a?"small":"large"}),p.tsx("div",{key:"chart-container",bind:this,class:g.CSS.chartContainer,afterCreate:this._onChartContainerAfterCreate,afterRemoved:this._onChartContainerRemoved})]};d._renderSpinner=function(a){return p.tsx("div",{key:"spinner",class:this.classes(g.CSS.chartSpinner,
{[g.CSS.chartSpinnerSmall]:"small"===a.size}),afterCreate:this._onSpinnerAfterCreate,exitAnimation:this._onSpinnerExit})};d._onSpinnerAfterCreate=function(a){requestAnimationFrame(()=>a.classList.add(g.CSS.chartSpinnerVisible))};d._onSpinnerExit=function(a,b){a.classList.remove(g.CSS.chartSpinnerVisible);setTimeout(b,200)};d._canRenderChart=function(){const a=this.viewModel.chartData;if(h.isNone(a))return!1;if(!this.viewModel.inputIsSketched)return a.refined;let b=0;for(const {samples:c}of a.lines)b+=
h.isSome(c)?c.length:0;return a.refined||b<=m.LARGE_CHART_SAMPLES};d._renderActions=function({actions:a}){a=a.map(b=>{switch(b.type){case n.Sketch:return this.visibleElements.sketchButton&&this._renderAction({action:b,onClick:this._onSketchButtonClick,className:g.CSS.sketchButton,label:this.messages.sketchButtonLabel});case n.SketchCancel:return this.visibleElements.sketchButton&&this._renderAction({action:b,onClick:this._onCancelButtonClick,className:g.CSS.sketchCancelButton,label:this.messagesCommon.cancel});
case n.SketchDone:return this.visibleElements.sketchButton&&this._renderAction({action:b,onClick:this._onDoneButtonClick,className:g.CSS.sketchDoneButton,label:this.messagesCommon.done});case n.Select:return this.visibleElements.selectButton&&this._renderAction({action:b,onClick:this._onSelectButtonClick,className:g.CSS.selectButton,label:this.messages.selectButtonLabel});case n.SelectCancel:return this.visibleElements.selectButton&&this._renderAction({action:b,onClick:this._onCancelButtonClick,className:g.CSS.selectCancelButton,
label:this.messagesCommon.cancel})}}).filter(Boolean);return a.length?p.tsx("footer",{key:"footer",class:g.CSS.footer},...a):null};d._renderAction=function({action:a,onClick:b,className:c,label:l}){return p.tsx("button",{key:`action-${a.type}`,class:this.classes(g.CSS.actionButton,c,{[g.CSS.buttonDisabled]:a.disabled}),bind:this,disabled:a.disabled,onclick:b,type:"button"},l)};d._onSketchButtonClick=function(){this.viewModel.start({mode:"sketch"})};d._onSelectButtonClick=function(){this.viewModel.start({mode:"select"})};
d._onCancelButtonClick=function(){this.viewModel.cancel()};d._onDoneButtonClick=function(){this.viewModel.stop()};d._updateChart=function(a){const {data:b,chart:c,messages:l,stationary:u}=a;!h.isNone(c)&&!h.isNone(l)&&u&&this._canRenderChart()&&(c.update(a),this._chartIsRefined=h.isSome(b)&&b.refined)};d._onChartContainerAfterCreate=function(a){this._chartContainer=a};d._onChartContainerRemoved=function(){this._chartContainer=null};d._initializeChart=function(a){var b=this;h.abortMaybe(this._chartInitTask);
this._chartInitTask=B.createTask(function(){var c=y._asyncToGenerator(function*(l){const u=yield I.createChart({container:a,abortOptions:{signal:l},onRangeChange:(w,L)=>{b._zoomOutButtonVisible=1!==w||1!==L},onCursorPositionChange:w=>{b.viewModel.hoveredChartPosition=w}});if(l.aborted)throw h.destroyMaybe(u),B.createAbortError();b._chart=u;b._updateChart(b._chartUpdateParams)});return function(l){return c.apply(this,arguments)}}())};d._destroyChart=function(){this._chartInitTask=h.abortMaybe(this._chartInitTask);
this._chart=h.destroyMaybe(this._chart);this._chartIsRefined=!1};y._createClass(x,[{key:"_portrait",get:function(){return this._width<m.PORTRAIT_MODE_PIXEL_BREAKPOINT}},{key:"_chartUpdateParams",get:function(){const a=this.view;return this._getChartUpdateParamsMemoized(this._chart,this.viewModel.chartData,h.isSome(a)?a.stationary:!0,this._chartMessages)}},{key:"_chartMessages",get:function(){return{...this.messagesUnits,...this.messages}}},{key:"_legendProps",get:function(){return this._getDetailsPropsMemoized(this.viewModel.effectiveUnits,
this._profilesArray)}},{key:"_profilesArray",get:function(){return this.profiles.toArray()}},{key:"_settingsButtonProps",get:function(){return{viewModel:this.viewModel,visibleElements:this.visibleElements}}}]);return x}(F);f.__decorate([k.property({type:C})],e.prototype,"viewModel",void 0);f.__decorate([q.aliasOf("viewModel.view")],e.prototype,"view",void 0);f.__decorate([q.aliasOf("viewModel.input")],e.prototype,"input",void 0);f.__decorate([q.aliasOf("viewModel.profiles")],e.prototype,"profiles",
void 0);f.__decorate([q.aliasOf("viewModel.unitOptions")],e.prototype,"unitOptions",void 0);f.__decorate([q.aliasOf("viewModel.unit")],e.prototype,"unit",void 0);f.__decorate([q.aliasOf("viewModel.geodesicDistanceThreshold")],e.prototype,"geodesicDistanceThreshold",void 0);f.__decorate([k.property({type:D,nonNullable:!0})],e.prototype,"visibleElements",void 0);f.__decorate([k.property()],e.prototype,"iconClass",void 0);f.__decorate([q.aliasOf("messages.widgetLabel",{overridable:!0})],e.prototype,
"label",void 0);f.__decorate([q.aliasOf("viewModel.visible")],e.prototype,"visible",void 0);f.__decorate([k.property(),z.messageBundle("esri/widgets/ElevationProfile/t9n/ElevationProfile")],e.prototype,"messages",void 0);f.__decorate([k.property(),z.messageBundle("esri/t9n/common")],e.prototype,"messagesCommon",void 0);f.__decorate([k.property(),z.messageBundle("esri/core/t9n/Units")],e.prototype,"messagesUnits",void 0);f.__decorate([k.property()],e.prototype,"_chartContainer",void 0);f.__decorate([k.property()],
e.prototype,"_chart",void 0);f.__decorate([k.property()],e.prototype,"_chartInitTask",void 0);f.__decorate([k.property()],e.prototype,"_chartIsRefined",void 0);f.__decorate([k.property()],e.prototype,"_settingsButton",void 0);f.__decorate([k.property()],e.prototype,"_legend",void 0);f.__decorate([k.property()],e.prototype,"_width",void 0);f.__decorate([k.property()],e.prototype,"_portrait",null);f.__decorate([k.property()],e.prototype,"_zoomOutButtonVisible",void 0);f.__decorate([k.property()],e.prototype,
"_chartUpdateParams",null);f.__decorate([k.property()],e.prototype,"_chartMessages",null);f.__decorate([k.property()],e.prototype,"_legendProps",null);f.__decorate([k.property()],e.prototype,"_profilesArray",null);f.__decorate([k.property()],e.prototype,"_settingsButtonProps",null);return e=f.__decorate([E.subclass("esri.widgets.ElevationProfile")],e)});