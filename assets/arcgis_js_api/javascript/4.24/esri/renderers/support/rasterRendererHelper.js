// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../Color ../../rasterRenderers ../../core/maybe ../../core/unitUtils ../../layers/support/Field ../../layers/support/RasterInfo ../FlowRenderer ./AuthoringInfo ./ClassBreakInfo ./colorRampUtils ./UniqueValueInfo ../../rest/support/AlgorithmicColorRamp ../../rest/support/ClassBreaksDefinition ../../rest/support/generateRendererUtils ../../rest/support/MultipartColorRamp ../RasterStretchRenderer ../UniqueValueRenderer ../RasterColormapRenderer ../RasterShadedReliefRenderer ../ClassBreaksRenderer ../VectorFieldRenderer".split(" "),
function(h,z,wa,g,ea,fa,ha,ia,O,ja,E,P,ka,la,ma,G,na,oa,pa,qa,ra,sa){function Q(a,b){var d,c,e,f;a=R(a,null==b?void 0:b.variableName);const {bandCount:k}=a;let {bandIds:m,stretchType:n}=b||{};null!=(d=m)&&d.some(t=>t>=k)&&(m=null);let u=g.unwrap(a.statistics),p=g.unwrap(a.histograms);if(1<k){var w;m=null!=(w=m)&&w.length?m:S(a);u=null==u?null:m.map(t=>u[t]);p=null==p?null:m.map(t=>p[t])}else m=[0];null==n&&(n=ta(a));d=!1;switch(n){case "none":d=!1;break;case "percent-clip":d=!(null!=(c=p)&&c.length);
break;default:d=!(null!=(e=u)&&e.length)}({dataType:c}=a);c=1===(null==(f=m)?void 0:f.length)&&T.has(c)?U:null;f=new na({stretchType:n,dynamicRangeAdjustment:d,colorRamp:c,outputMin:0,outputMax:255,gamma:1===m.length?[1]:[1,1,1],useGamma:!1});"percent-clip"===n?f.maxPercent=f.minPercent=.25:"standard-deviation"===n&&(f.numberOfStandardDeviations=2);if(!d&&(g.isSome(a.multidimensionalInfo)||null!=b&&b.includeStatisticsInStretch))if("percent-clip"===n)f.histograms=p;else if("min-max"===n||"standard-deviation"===
n)f.statistics=u;return f}function R(a,b){if(null==b)return a;let d=g.unwrap(a.statistics),c=g.unwrap(a.histograms);var {multidimensionalInfo:e}=a;if(b&&g.isSome(e)&&(e=e.variables.find(f=>f.name===b))){const {statistics:f,histograms:k}=e;null!=f&&f.length&&(d=f);null!=k&&k.length&&(c=k)}return ha.fromJSON({...a.toJSON(),statistics:d,histograms:c})}function S(a){const b=a.bandCount;if(1===b)return null;if(2===b)return[0];a=a.keyProperties&&a.keyProperties.BandProperties;let d;if(a&&a.length===b){const {red:c,
green:e,blue:f,nir:k}=V(a);null!=c&&null!=e&&null!=f?d=[c,e,f]:null!=k&&null!=c&&null!=e&&(d=[k,c,e])}!d&&3<=b&&(d=[0,1,2]);return d}function V(a){const b={};for(let f=0;f<a.length;f++){var d,c=a[f],e=null==(d=c.BandName)?void 0:d.toLowerCase();"red"===e?b.red=f:"green"===e?b.green=f:"blue"===e?b.blue=f:"nearinfrared"===e||"nearinfrared_1"===e||"nir"===e?b.nir=f:c.WavelengthMax&&c.WavelengthMin&&(e=c.WavelengthMin,c=c.WavelengthMax,null==b.blue&&410<=e&&480>=e&&480<=c&&540>=c?b.blue=f:null==b.green&&
490<=e&&560>=e&&560<=c&&610>=c?b.green=f:null==b.red&&595<=e&&670>=e&&660<=c&&730>=c?b.red=f:null==b.nir&&700<=e&&860>=e&&800<=c&&950>=c&&(b.nir=f))}return b}function ta(a){let b="percent-clip";const {pixelType:d,dataType:c,histograms:e,statistics:f}=a;"u8"!==d||"processed"!==c&&g.isSome(e)&&g.isSome(f)?"u8"===d||"elevation"===c||T.has(c)?b="min-max":g.isSome(e)?b="percent-clip":g.isSome(f)&&(b="min-max"):b="none";return b}function W(a,b,d,c){if(!H(a,b))return null;const {attributeTable:e,statistics:f}=
a,k=I(e,b),m=A(e,"red"),n=A(e,"green"),u=A(e,"blue");a=new O;const p=[],w=new Set,t=!!(m&&n&&u);if(g.isSome(e))e.features.forEach(q=>{var r=q.attributes[k.name];w.has(q.attributes[k.name])||null==r||(w.add(r),r=!t||"single"!==m.type&&"double"!==m.type||"single"!==n.type&&"double"!==n.type||"single"!==u.type&&"double"!==u.type||e.features.some(l=>1<l.attributes[m.name]||1<l.attributes[n.name]||1<l.attributes[u.name])?1:255,p.push(new P({value:q.attributes[k.name],label:q.attributes[k.name]+"",symbol:{type:"simple-fill",
style:"solid",outline:null,color:t?new z([q.attributes[m.name]*r,q.attributes[n.name]*r,q.attributes[u.name]*r,1]):new z([0,0,0,0])}})))});else if(null!=f&&f[0])for(b=f[0].min;b<=f[0].max;b++)p.push(new P({value:b,label:b.toString(),symbol:{type:"simple-fill",style:"solid",outline:null,color:new z([0,0,0,0])}}));p.sort((q,r)=>q.value&&"string"===typeof q.value.valueOf()?0:q.value>r.value?1:-1);if(!t){const q=E.convertColorRampToColormap(X,p.length);p.forEach((r,l)=>r.symbol.color=new z(q[l].slice(1,
4)));a.colorRamp=X}if(d||c){const q=d||E.convertColorRampToColormap(c,p.length).map(r=>r.slice(1));p.forEach((r,l)=>r.symbol.color=new z(q[l]));a.colorRamp=c}return new oa({field:k.name,uniqueValueInfos:p,authoringInfo:a})}function I(a,b,d){let c;g.isSome(a)?(c=b?a.fields.find(e=>b.toLowerCase()===e.name.toLowerCase()):ua(a.fields),c||(d||(c=a.fields.find(e=>"string"===e.type)),c||(c=A(a,"value")))):c=new fa({name:"value"});return c}function ua(a){let b;for(let d=0;d<a.length;d++){const c=a[d].name.toLowerCase();
if("string"===a[d].type){if(c.startsWith("class")){b=a[d];break}null==b&&(c.endsWith("name")||c.endsWith("type"))&&(b=a[d])}}return b}function A(a,b){return g.isNone(a)?null:a.fields.find(d=>d.name.toLowerCase()===b)}function H(a,b){const {attributeTable:d,bandCount:c}=a;return g.isNone(d)&&Y(a)?!0:g.isNone(d)||1<c||b&&null==d.fields.find(e=>e.name.toLowerCase()===b.toLowerCase())?!1:!0}function J(a){const {bandCount:b,colormap:d}=a;return g.isSome(d)&&d.length&&1===b}function Z(a){if(!J(a))return null;
let b;const {attributeTable:d,colormap:c}=a;if(g.isSome(d)){const e=A(d,"value"),f=I(d,null,!0);"string"===f.type&&(b={},d.features.forEach(k=>{k=k.attributes;b[k[e.name]]=f?k[f.name]:k[e.name]}))}return pa.createFromColormap(g.unwrap(c),b)}function K(a){const {bandCount:b,dataType:d,pixelType:c}=a;return"elevation"===d||"generic"===d&&1===b&&("s16"===c||"f32"===c||"f64"===c)}function L(a){const {attributeTable:b,bandCount:d}=a;return 1===d&&(g.isSome(b)||g.isSome(a.histograms))}function aa(a,b,d){let c=
0,e=0;g.isSome(a.attributeTable)?(a=a.attributeTable,c=e=a.features[0].attributes[b.name],a.features.forEach(f=>{f=f.attributes[b.name];f<c&&(c=f);f>e&&(e=f)})):g.isSome(a.histograms)&&(a=a.histograms,c=a[0].min,e=a[0].max);return(e-c)/d}function Y(a){var b,d,c;return["u8","s8"].includes(a.pixelType)&&null!=(null==(b=a.statistics)?void 0:null==(d=b[0])?void 0:d.min)&&null!=(null==(c=a.statistics[0])?void 0:c.max)&&1===a.bandCount}function F(a){({dataType:a}=a);return"vector-uv"===a||"vector-magdir"===
a}function M(a){({dataType:a}=a);return"vector-uv"===a||"vector-magdir"===a}function ba(a){if(!F(a))return null;if(g.isSome(a.statistics)&&a.statistics.length&&("vector-magdir"===a.dataType||"vector-uv"===a.dataType)){const {minMagnitude:d,maxMagnitude:c}=N(a.dataType,a.statistics);var b=[{type:"size",field:"Magnitude",minSize:10,maxSize:40,minDataValue:d,maxDataValue:c}]}a=g.isSome(a.multidimensionalInfo)?va.get(a.multidimensionalInfo.variables[0].unit):null;b=new sa({visualVariables:b,inputUnit:a,
rotationType:"geographic"});b.visualVariables=[...b.sizeVariables,...b.rotationVariables];return b}function ca(a){var b;return{color:null==(b=a.symbolLayers[0].material)?void 0:b.color,type:"esriSFS",style:"esriSFSSolid"}}function N(a,b){if("vector-magdir"===a)a=b[0].min,b=b[0].max;else{const d=b[0].min,c=b[0].max,e=b[1].min;b=b[1].max;a=0;b=Math.max(Math.abs(d),Math.abs(e),Math.abs(c),Math.abs(b))}return{minMagnitude:a,maxMagnitude:b}}const U=G.fromJSON({type:"multipart",colorRamps:[{fromColor:[0,
0,255],toColor:[0,255,255]},{fromColor:[0,255,255],toColor:[255,255,0]},{fromColor:[255,255,0],toColor:[255,0,0]}]}),X=G.fromJSON(E.PREDEFINED_JSON_COLOR_RAMPS[0]),T=new Set("scientific standard-time vector-uv vector-magdir vector-u vector-v vector-magnitude vector-direction".split(" ")),va=new Map([["m/s","meter-per-second"],["km/h","kilometer-per-hour"],["knots","knots"],["ft/s","feet-per-second"],["mph","mile-per-hour"]]);h.createClassBreaksRenderer=function(a,b){a=R(a,null==b?void 0:b.variableName);
const {attributeTable:d}=a;if(!L(a))return null;const c=g.isSome(a.histograms)?a.histograms[0]:null,e=isFinite(null==b?void 0:b.numClasses)?b.numClasses:5,f=new O({classificationMethod:null==b?void 0:b.classificationMethod,colorRamp:null==b?void 0:b.colorRamp});let k=(null==b?void 0:b.field)||"value";const m=[],n=[],u=g.isSome(d),p=u&&d.fields.find(l=>"count"===l.name.toLowerCase()),w=u&&d.fields.find(l=>l.name.toLowerCase()===k.toLowerCase());if(w){k=w.name;const l=d.features.length;let B=0;d.features.forEach(v=>
B+=(p?v.attributes[p.name]:50)/l);d.features.forEach(v=>{const C=v.attributes[w.name];v=p?v.attributes[p.name]:50;if(0<v){n.push(v);v=Math.max(1,Math.round(v/l/B*1E3));for(let D=0;D<v;D++)m.push(C)}})}else{var {pixelType:t}=a;const l=(c.max-c.min)/c.size,B=(t=t.includes("s")||t.includes("u"))&&1===l?Math.floor(c.min+.5):c.min,v=t&&1===l?Math.floor(c.max-.5):c.max,C=c.size;let D=0,da;c.counts.forEach(x=>D+=x/C);c.counts.forEach((x,y)=>{if(0<x)for(n.push(x),x=Math.max(1,Math.round(x/C/D*1E3)),da=u?
d.features[y].attributes[w.name]:0===y?B:y===C-1?v:c.min+l*(y+.5),y=0;y<x;y++)m.push(da)})}t=(null==b?void 0:b.classificationMethod)||"natural-breaks";let q=null==b?void 0:b.definedInterval;"defined-interval"!==t||q||(q=aa(a,w,e));a=ma.createGenerateRendererClassBreaks({values:m,valueFrequency:n,normalizationTotal:null,definition:new la({classificationMethod:t,breakCount:e,definedInterval:q})});let r=null==b?void 0:b.colors;r||(b=(null==b?void 0:b.colorRamp)||U,f.colorRamp=b,r=E.convertColorRampToColormap(b,
a.classBreaks.length,!0).map(l=>l.slice(1)));b=a.classBreaks.map((l,B)=>new ja({minValue:l.minValue,maxValue:l.maxValue,label:l.label,symbol:{type:"simple-fill",color:r[B]}}));return new ra({field:k,classBreakInfos:b,authoringInfo:f})};h.createColorRamp=function(a){const b=[];for(let d=0;d<a.length-1;d++)b[d]=new ka({algorithm:"hsv",fromColor:a[d],toColor:a[d+1]||new z({r:255,g:255,b:255,a:1})});return 2<a.length?new G({colorRamps:b}):b[0]};h.createColormapRenderer=Z;h.createDefaultRenderer=function(a,
b){const {attributeTable:d,colormap:c}=a;if(F(a)){var e=ba(a);if(g.isSome(e))return e}return g.isSome(c)&&(e=Z(a),g.isSome(e))||g.isSome(d)&&(e=W(a),g.isSome(e))?e:Q(a,b)};h.createFlowRenderer=function(a){if(!M(a))return null;let b;if(g.isSome(a.statistics)&&0<a.statistics.length&&("vector-magdir"===a.dataType||"vector-uv"===a.dataType)){const {minMagnitude:d,maxMagnitude:c}=N(a.dataType,a.statistics);b=[{type:"color",field:"Magnitude",stops:[{value:d,color:"#1020C0"},{value:c,color:"#C02010"}]}]}return new ia({visualVariables:b})};
h.createShadedReliefRenderer=function(a,b){var d;if(!K(a))return null;({extent:a}=a);a=a.width*ea.getMetersPerUnitForSR(a.spatialReference);b=null!=(d=b)?d:"multi-directional";return new qa({hillshadeType:b,scalingType:5E6<a?"adjusted":"none"})};h.createStretchRenderer=Q;h.createUVRenderer=W;h.createVectorFieldRenderer=ba;h.estimateMagnitudeRange=N;h.getBandNames=function(a,b){var d;const c=a.keyProperties&&a.keyProperties.BandProperties;b=null!=(d=b)&&d.length?b:Array.from(Array(a.bandCount).keys());
return b.map(e=>c&&c.length===a.bandCount?c[e]&&c[e].BandName||"band_"+(e+1):"band_"+(e+1))};h.getClassField=I;h.getDefaultBandCombination=S;h.getDefaultInterpolation=function(a,b,d){const c=["nearest","bilinear","cubic","majority"].find(e=>e===(null==d?void 0:d.toLowerCase()));return"Map"===b?null!=c?c:"bilinear":"standard-time"===a.dataType?null!=c?c:"nearest":"thematic"===a.dataType||a.attributeTable||a.colormap?"nearest"===c||"majority"===c?c:"nearest":null!=c?c:"bilinear"};h.getDefinedInterval=
aa;h.getField=A;h.getSupportedRendererTypes=function(a){const b=["raster-stretch"];J(a)&&b.push("raster-colormap");H(a)&&b.push("unique-value");L(a)&&b.push("class-breaks");K(a)&&b.push("raster-shaded-relief");F(a)&&b.push("vector-field");M(a)&&b.push("flow");return b};h.getWellKnownBandIndexes=V;h.isClassBreaksSupported=L;h.isColormapRendererSupported=J;h.isFlowRendererSupported=M;h.isShadedReliefRendererSupported=K;h.isSingleBand8BitRasterWithStats=Y;h.isUVRendererSupported=H;h.isVectorFieldRendererSupported=
F;h.normalizeRendererJSON=function(a){if("uniqueValue"===a.type){var b,d=a.uniqueValueInfos,c=d[0].symbol;null!=c&&null!=(b=c.symbolLayers)&&b.length&&(a.uniqueValueInfos=d.map(e=>({value:e.value,label:e.label,symbol:e.symbol?ca(e.symbol):null})));return a}"classBreaks"===a.type&&(b=a.classBreakInfos,c=b[0].symbol,null!=c&&null!=(d=c.symbolLayers)&&d.length&&(a.classBreakInfos=b.map(e=>({classMinValue:e.classMinValue,classMaxValue:e.classMaxValue,label:e.label,symbol:e.symbol?ca(e.symbol):null}))));
return a};Object.defineProperties(h,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});