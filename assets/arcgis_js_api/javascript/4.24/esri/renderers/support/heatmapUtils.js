// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define(["exports","../../core/mathUtils","../../core/screenUtils","../../chunks/vec4","../../chunks/vec4f64"],function(l,B,t,F,G){function H(a,b,c,e){let {color:k,ratio:h}=b,{color:d,ratio:f}=c;f===h&&(1===f?h-=1E-6:f+=1E-6);b=B.clamp((e-h)/(f-h),0,1);F.lerp(a,k.toArray(),d.toArray(),b)}function C(a,b,c,e,k){a=new Uint32Array(a*a);b="buffer"in b?b:new Float64Array(b);c="buffer"in c?new Uint32Array(c.buffer):new Uint32Array((new Uint8Array(c)).buffer);k=c.length/(k-e);for(let h=0;h<b.length;h++)a[h]=
c[B.clamp(Math.floor((b[h]-e)*k),0,c.length-1)];return a.buffer}function v(a,b,c){a=Math.sqrt(a**2+b**2)/c;return 1<a?0:3/(Math.PI*c**2)*(1-a**2)**2}function D(a,b){return"function"===typeof a?a:a?"string"===typeof b?c=>-1*+c[a]:c=>+c[a]+b:()=>1}function E(a,b){return null!=a?"string"===typeof b?c=>-1*+c.readAttribute(a):c=>+c.readAttribute(a)+b:c=>1}l.MAGIC_KERNEL_DENSITY_RADIUS_INFLATION_FACTOR=2.4;l.calculateHeatmapIntensityInfo=function(a,b,c,e){const {radius:k,fieldOffset:h,field:d}=b;b=t.pt2px(k);
const f=new Float64Array(c*e);let n=Number.NEGATIVE_INFINITY;const w=D(d,h);for(const {geometry:m,attributes:p}of a){a=Math.max(0,m.x-b);var q=Math.max(0,m.y-b);const x=Math.min(e,m.y+b),y=Math.min(c,m.x+b),z=+w(p);for(;q<x;q++)for(let r=a;r<y;r++){var g=q*c+r;const A=v(m.x-r,m.y-q,b);g=f[g]+=A*z;g>n&&(n=g)}}return{matrix:f.buffer,max:n}};l.calculateHeatmapIntensityInfoReaders=function(a,b,c,e){const {radius:k,fieldOffset:h,field:d}=b;b=Math.round(t.pt2px(k));const f=new Float64Array(c*e);let n=Number.NEGATIVE_INFINITY;
const w=E(d,h),q=new Set;for(const x of a)for(a=x.getCursor();a.next();){var g=a.getObjectId();if(q.has(g))continue;q.add(g);g=a.readLegacyPointGeometry();if(-128>g.x||g.x>=c+128||-128>g.y||g.y>e+128)continue;const y=+w(a),z=Math.max(0,Math.round(g.x)-b);var m=Math.max(0,Math.round(g.y)-b);const r=Math.min(e,Math.round(g.y)+b),A=Math.min(c,Math.round(g.x)+b);for(;m<r;m++)for(let u=z;u<A;u++){var p=m*c+u;const I=v(g.x-u,g.y-m,b);p=f[p]+=I*y;p>n&&(n=p)}}return{matrix:f.buffer,max:n}};l.createHeatmapImageData=
C;l.createValueFunction=D;l.createValueFunctionCursor=E;l.drawHeatmap=function(a,b,c,e,k,h){a.canvas.width=a.canvas.height=b;a.clearRect(0,0,b,b);const d=a.getImageData(0,0,b,b);c&&e&&d.data.set(new Uint8ClampedArray(C(b,c,e,k,h)));a.putImageData(d,0,0)};l.evaluateDensityKernel=v;l.gaussianBlurRadiusPxToKernelDensityRadiusPt=function(a){return t.px2pt(2.4*a)};l.generateGradient=function(a){const b=new Uint8ClampedArray(2048);a=a.filter(({ratio:d})=>0<=d&&1>=d).sort((d,f)=>d.ratio-f.ratio).map(({color:d,
ratio:f})=>({color:d,ratio:Math.max(f,.001)}));if(1>a.length)return b;let c=a[0],e=a[0],k=1;const h=G.create();for(let d=0;512>d;d++){const f=(d+.5)/512;for(;f>e.ratio&&k<a.length;)c=e,e=a[k++];H(h,c,e,f);b.set(h,4*d)}return b};l.kernelDensityRadiusPtToGaussianBlurRadiusPx=function(a){return t.pt2px(a)/2.4};Object.defineProperties(l,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});