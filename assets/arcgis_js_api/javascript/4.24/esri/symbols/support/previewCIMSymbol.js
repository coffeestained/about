// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/screenUtils ../cim/CIMSymbolRasterizer ./cimSymbolUtils ./previewUtils ./renderUtils".split(" "),function(h,p,q,r,k,t,u){function f(){f=p._asyncToGenerator(function*(a,e={}){const {size:g,maxSize:l,node:m,opacity:n}=e,{feature:v,fieldMap:w,geometryType:x,style:y}=e.cimOptions||e;var d=k.getCIMSymbolSize(a),c="number"===typeof g?g:null;c=Math.min(null!=c?c:d,null!=l?l:q.px2pt(z));c!==d&&(a=a.clone(),k.scaleCIMSymbolTo(a,c,{preserveOutlineWidth:!0}));
var b=3;a&&a.data&&a.data.symbol&&"CIMPointSymbol"!==a.data.symbol.type&&(b=1);d=yield A.rasterizeCIMSymbolAsync(a,v,w,x,{scaleFactor:b,style:y});a=document.createElement("canvas");a.width=d.imageData.width;a.height=d.imageData.height;a.getContext("2d").putImageData(d.imageData,0,0);d=a.width/b;b=a.height/b;if(null==g?0:null!=(null==e?void 0:e.scale)?null==e?0:e.scale:1)b=d/b,d=1>=b?Math.ceil(c*b):c,b=1>=b?c:Math.ceil(c/b);c=new Image(d,b);c.src=a.toDataURL();null!=n&&(c.style.opacity=`${n}`);a=c;
null!=e.effectView&&(a=u.renderSymbol([[{shape:{type:"image",x:0,y:0,width:d,height:b,src:c.src},fill:null,stroke:null,offset:[0,0]}]],[d,b],{effectView:e.effectView}));m&&m.appendChild(a);return a});return f.apply(this,arguments)}const A=new r.CIMSymbolRasterizer(null,!0),z=t.SymbolSizeDefaults.maxSize;h.previewCIMSymbol=function(a){return f.apply(this,arguments)};Object.defineProperties(h,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});