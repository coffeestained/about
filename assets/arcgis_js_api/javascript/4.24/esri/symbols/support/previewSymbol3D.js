// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../assets ../../core/colorUtils ../../core/has ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./IconSymbol3DLayerResource ./ObjectSymbol3DLayerResource ./previewUtils ./renderUtils ./utils ./webStyleSymbolUtils".split(" "),function(A,P,Q,R,la,S,Y,w,Z,x,B,aa,ba,q,C,T,ca){function z(a){const b=a.outline;var d=w.isSome(a.material)?a.material.color:null;d=w.isSome(d)?d.toHex():null;
if(w.isNone(b)||"pattern"in b&&w.isSome(b.pattern)&&"style"===b.pattern.type&&"none"===b.pattern.style)return"fill"===a.type&&"#ffffff"===d?{color:"#bdc3c7",width:.75}:null;a=x.pt2px(b.size)||0;return{color:"rgba("+(w.isSome(b.color)?b.color.toRgba():"255,255,255,1")+")",width:Math.min(a,J),style:"pattern"in b&&w.isSome(b.pattern)&&"style"===b.pattern.type?B.dekebabifyLineStyle(b.pattern.style):null,join:"butt",cap:"patternCap"in b?b.patternCap:"butt"}}function da(a,b){var d=b&&b.resource;d=d&&d.href;
if(a.thumbnail&&a.thumbnail.url)return Promise.resolve(a.thumbnail.url);if(d&&"object"!==b.type)return Promise.resolve(T.getIconHref(a,b));const e=Q.getAssetUrl("esri/images/Legend/legend3dsymboldefault.png");return a.styleOrigin&&(a.styleOrigin.styleName||a.styleOrigin.styleUrl)?ca.resolveWebStyleSymbol(a.styleOrigin,{portal:a.styleOrigin.portal},"webRef").catch(n=>n).then(n=>{var v;return(null==n?void 0:null==(v=n.thumbnail)?void 0:v.url)||e}):Promise.resolve(e)}function K(a,b=1){const d=a.a;a=
R.toHSV(a);const {r:e,g:n,b:v}=R.toRGB({h:a.h,s:a.s/b,v:100-(100-a.v)/b});return[e,n,v,d]}function D(a){return"water"===a.type?w.isNone(a.color)?null:a.color:w.isNone(a.material)||w.isNone(a.material.color)?null:a.material.color}function g(a,b=0){var d=D(a);if(!d){if("fill"===a.type)return null;b=q.adjustColorComponentBrightness(B.defaultThematicColor.r,b);return[b,b,b,100]}a=d.toRgba();for(d=0;3>d;d++)a[d]=q.adjustColorComponentBrightness(a[d],b);return a}function U(a,b){return L.apply(this,arguments)}
function L(){L=P._asyncToGenerator(function*(a,b){a=a.style;return"none"===a?null:{type:"pattern",x:0,y:0,src:yield B.getPatternUrlWithColor(Q.getAssetUrl(`esri/symbols/patterns/${a}.png`),b.toCss(!0)),width:5,height:5}});return L.apply(this,arguments)}function V(a){return a.outline?z(a):{color:"rgba(0, 0, 0, 1)",width:1.5}}function W(a,b){a=D(a);if(!a)return null;let d;d="rgba("+(q.adjustColorComponentBrightness(a.r,b)+",");d+=q.adjustColorComponentBrightness(a.g,b)+",";d+=q.adjustColorComponentBrightness(a.b,
b)+",";return d+a.a+");"}function M(a,b){b=W(a,b);if(!b)return{};if("pattern"in a&&w.isSome(a.pattern)&&"style"===a.pattern.type&&"none"===a.pattern.style)return null;const d=Math.min(a.size?x.pt2px(a.size):.75,J);return{color:b,width:d,style:"pattern"in a&&w.isSome(a.pattern)&&"style"===a.pattern.type?B.dekebabifyLineStyle(a.pattern.style):null,cap:"cap"in a?a.cap:null,join:"join"in a?"miter"===a.join?x.pt2px(2):a.join:null}}function E(a,b,d){d*=.75;return{type:"linear",x1:d?.25*d:0,y1:d?.5*d:0,
x2:d||4,y2:d?.5*d:4,colors:[{color:a,offset:0},{color:b,offset:1}]}}function ea(a){const b=a.depth,d=a.height;return(a=a.width)&&b&&d&&a===b&&a<d}function fa(a,b,d){const e=[];if(!a)return e;switch(a.type){case "icon":switch(a.resource&&a.resource.primitive||aa.defaultPrimitive){case "circle":e.push({shape:{type:"circle",cx:0,cy:0,r:.5*b},fill:g(a,0),stroke:z(a)});break;case "square":e.push({shape:{type:"path",path:[{command:"M",values:[0,b]},{command:"L",values:[0,0]},{command:"L",values:[b,0]},
{command:"L",values:[b,b]},{command:"Z",values:[]}]},fill:g(a,0),stroke:z(a)});break;case "triangle":e.push({shape:{type:"path",path:[{command:"M",values:[0,b]},{command:"L",values:[.5*b,0]},{command:"L",values:[b,b]},{command:"Z",values:[]}]},fill:g(a,0),stroke:z(a)});break;case "cross":e.push({shape:{type:"path",path:[{command:"M",values:[.5*b,0]},{command:"L",values:[.5*b,b]},{command:"M",values:[0,.5*b]},{command:"L",values:[b,.5*b]}]},stroke:V(a)});break;case "x":e.push({shape:{type:"path",path:[{command:"M",
values:[0,0]},{command:"L",values:[b,b]},{command:"M",values:[b,0]},{command:"L",values:[0,b]}]},stroke:V(a)});break;case "kite":e.push({shape:{type:"path",path:[{command:"M",values:[0,.5*b]},{command:"L",values:[.5*b,0]},{command:"L",values:[b,.5*b]},{command:"L",values:[.5*b,b]},{command:"Z",values:[]}]},fill:g(a,0),stroke:z(a)})}break;case "object":switch(a.resource&&a.resource.primitive||ba.defaultPrimitive){case "cone":var n=g(a,0);a=g(a,-.6);a=E(n,a,d?N:b);b=q.getConeShapes(b,d);e.push({shape:b[0],
fill:a});e.push({shape:b[1],fill:a});break;case "inverted-cone":d=g(a,0);a=g(a,-.6);a=E(d,a,b);b=q.getInvertedConeShapes(b);e.push({shape:b[0],fill:a});e.push({shape:b[1],fill:d});break;case "cube":b=q.getCubeShapes(b,d);e.push({shape:b[0],fill:g(a,0)});e.push({shape:b[1],fill:g(a,-.3)});e.push({shape:b[2],fill:g(a,-.5)});break;case "cylinder":{n=g(a,0);const v=g(a,-.6);n=E(n,v,d?N:b);b=q.getCylinderShapes(b,d);e.push({shape:b[0],fill:n});e.push({shape:b[1],fill:n});e.push({shape:b[2],fill:g(a,0)});
break}case "diamond":b=q.getDiamondShapes(b);e.push({shape:b[0],fill:g(a,-.3)});e.push({shape:b[1],fill:g(a,0)});e.push({shape:b[2],fill:g(a,-.3)});e.push({shape:b[3],fill:g(a,-.7)});break;case "sphere":d=g(a,0);a=g(a,-.6);a=E(d,a);a.x1=0;a.y1=0;a.x2=.25*b;a.y2=.25*b;e.push({shape:{type:"circle",cx:0,cy:0,r:.5*b},fill:a});break;case "tetrahedron":b=q.getTetrahedronShapes(b),e.push({shape:b[0],fill:g(a,-.3)}),e.push({shape:b[1],fill:g(a,0)}),e.push({shape:b[2],fill:g(a,-.6)})}}return e}function F(a){return(a=
"number"===typeof(null==a?void 0:a.size)?null==a?void 0:a.size:null)?x.pt2px(a):null}function ha(a,b){const d=F(b),e=b&&b.maxSize?x.pt2px(b.maxSize):null,n=b&&b.disableUpsampling,v=a.symbolLayers,r=[];let p=0,t=0;const c=v.getItemAt(v.length-1);let l;c&&"icon"===c.type&&(l=c.size&&x.pt2px(c.size));v.forEach(f=>{if("icon"===f.type||"object"===f.type){var h="icon"===f.type?f.size&&x.pt2px(f.size):0,k=d||h?Math.ceil(Math.min(d||h,e||G)):y;if(f&&f.resource&&f.resource.href){var u=da(a,f).then(m=>{const H=
f.get("material.color");var I="icon"===f.type?"multiply":"tint";return C.tintImageWithColor(m,k,H,I,n)}).then(m=>{const H=m.width,I=m.height;p=Math.max(p,H);t=Math.max(t,I);return[{shape:{type:"image",x:0,y:0,width:H,height:I,src:m.url},fill:null,stroke:null}]});r.push(u)}else{let m=k;"icon"===f.type&&l&&d&&(m=h/l*k);h="tall"===(null==b?void 0:b.symbolConfig)||(null==b?void 0:null==(u=b.symbolConfig)?void 0:u.isTall)||("object"===f.type?ea(f):!1);p=Math.max(p,h?N:m);t=Math.max(t,m);r.push(Promise.resolve(fa(f,
m,h)))}}});return Z.eachAlways(r).then(f=>{const h=[];f.forEach(k=>{k.value?h.push(k.value):k.error&&ia.warn("error while building swatchInfo!",k.error)});return C.renderSymbol(h,[p,t],{node:b&&b.node,scale:!1,opacity:b&&b.opacity})})}function ja(a,b){const d=a.symbolLayers,e=[];a=T.isVolumetricSymbol(a);const n=F(b),v=(b&&b.maxSize?x.pt2px(b.maxSize):null)||J;let r=0,p=0,t;d.forEach((c,l)=>{if(c&&("line"===c.type||"path"===c.type)){var f=[];switch(c.type){case "line":var h=M(c,0);if(w.isNone(h))break;
var k=h&&h.width||0;0===l&&(t=k);c=Math.min(n||k,v);l=0===l?c:n?k/t*c:c;k=l>X/2?2*l:X;p=Math.max(p,l);r=Math.max(r,k);h.width=l;f.push({shape:{type:"path",path:[{command:"M",values:[0,.5*p]},{command:"L",values:[r,.5*p]}]},stroke:h});break;case "path":h=Math.min(n||y,v);l=g(c,0);k=g(c,-.2);var u=W(c,-.4);u=u?{color:u,width:1}:{};if("quad"===c.profile){const m=c.width;c=c.height;c=q.getPathSymbolShapes(m&&c?m/c:1,0===c,0===m);u={...u,join:"bevel"};f.push({shape:c[0],fill:k,stroke:u});f.push({shape:c[1],
fill:k,stroke:u});f.push({shape:c[2],fill:l,stroke:u})}else f.push({shape:q.shapes.pathSymbol3DLayer[0],fill:k,stroke:u}),f.push({shape:q.shapes.pathSymbol3DLayer[1],fill:l,stroke:u});r=p=Math.max(p,h)}e.push(f)}});return Promise.resolve(C.renderSymbol(e,[r,p],{node:b&&b.node,scale:a,opacity:b&&b.opacity}))}function ka(a,b){return O.apply(this,arguments)}function O(){O=P._asyncToGenerator(function*(a,b){const d="mesh-3d"===a.type;a=a.symbolLayers;var e=F(b);const n=b&&b.maxSize?x.pt2px(b.maxSize):
null;e=e||y;const v=[];let r=0,p=0;var t=!1;for(let u=0;u<a.length;u++){var c=a.getItemAt(u);const m=[];if(!d||"fill"===c.type){var l=q.shapes.fill[0];switch(c.type){case "fill":var f=z(c);t=Math.min(e,n||G);r=Math.max(r,t);p=Math.max(p,t);t=!0;var h=g(c,0),k="pattern"in c&&c.pattern;c=D(c);!d&&w.isSome(k)&&"style"===k.type&&"solid"!==k.style&&c&&(h=yield U(k,c));m.push({shape:l,fill:h,stroke:f});break;case "line":c=M(c,0);if(w.isNone(c))break;c={stroke:c,shape:l};r=Math.max(r,y);p=Math.max(p,y);
m.push(c);break;case "extrude":l={join:"round",width:1,...M(c,-.4)};f=g(c,0);c=g(c,-.2);h=Math.min(e,n||G);k=q.getExtrudeSymbolShapes(h);l.width=1;m.push({shape:k[0],fill:c,stroke:l});m.push({shape:k[1],fill:c,stroke:l});m.push({shape:k[2],fill:f,stroke:l});c=.7*y+.5*h;r=Math.max(r,y);p=Math.max(p,c);break;case "water":t=D(c),c=K(t),l=K(t,2),f=K(t,3),h=q.getWaterSymbolShapes(),t=!0,m.push({shape:h[0],fill:c}),m.push({shape:h[1],fill:l}),m.push({shape:h[2],fill:f}),c=Math.min(e,n||G),r=Math.max(r,
c),p=Math.max(p,c)}v.push(m)}}return C.renderSymbol(v,[r,p],{node:b&&b.node,scale:t,opacity:b&&b.opacity})});return O.apply(this,arguments)}const y=q.SymbolSizeDefaults.size,G=q.SymbolSizeDefaults.maxSize,J=q.SymbolSizeDefaults.maxOutlineSize,X=q.SymbolSizeDefaults.lineWidth,N=q.SymbolSizeDefaults.tallSymbolWidth,ia=Y.getLogger("esri.symbols.support.previewSymbol3D");A.getPatternDescriptor=U;A.getSizeFromOptions=F;A.getSymbolLayerFill=g;A.previewSymbol3D=function(a,b){if(0===a.symbolLayers.length)return Promise.reject(new S("symbolPreview: renderPreviewHTML3D",
"No symbolLayers in the symbol."));switch(a.type){case "point-3d":return ha(a,b);case "line-3d":return ja(a,b);case "polygon-3d":case "mesh-3d":return ka(a,b)}return Promise.reject(new S("symbolPreview: swatchInfo3D","symbol not supported."))};Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});