// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../Color ../../core/BidiText ../../core/floatRGBA ../../core/lang ../../core/Logger ../../core/mathUtils ../../core/maybe ../../core/RandomLCG ../../core/screenUtils ../../geometry/support/aaBoundingRect ../../geometry/support/boundsUtils ./CIMPlacements ./CIMSymbolDrawHelper ./enums ./utils ../../views/2d/engine/vectorTiles/GeometryUtils ../../views/2d/engine/webgl/definitions ../../views/2d/engine/webgl/mesh/templates/shapingUtils".split(" "),function(A,X,O,Y,P,H,Q,I,Z,E,C,aa,
R,D,n,q,F,J,ba){function G(d,a){switch(a.type){case "CIMSymbolReference":return G(d,a.symbol);case "CIMPointSymbol":d.drawSymbol(a,{x:0,y:0});break;case "CIMLineSymbol":d.drawSymbol(a,{paths:[[[0,0],[0,1]]]});break;case "CIMPolygonSymbol":d.drawSymbol(a,{rings:[[[0,0],[0,1],[0,0]]]});break;case "CIMTextSymbol":d.drawSymbol(a,{x:0,y:0});break;case "CIMVectorMarker":{const b=new R.Placement;d.drawMarker(a,b)}}return d.envelope()}function ca(d){if(!d)return 0;switch(d.type){case "CIMMarkerPlacementAlongLineSameSize":return Math.abs(d.offset);
case "CIMMarkerPlacementAlongLineRandomSize":return Math.abs(d.offset);case "CIMMarkerPlacementAtExtremities":return Math.abs(d.offset);case "CIMMarkerPlacementAtMeasuredUnits":return Math.abs(d.offset);case "CIMMarkerPlacementAtRatioPositions":return Math.abs(d.offset);case "CIMMarkerPlacementInsidePolygon":return 0;case "CIMMarkerPlacementOnLine":return Math.abs(d.offset);case "CIMMarkerPlacementOnVertices":return Math.abs(d.offset);case "CIMMarkerPlacementPolygonCenter":return 0;default:return 0}}
function da(d){if(!d)return 0;switch(d.type){case "CIMGeometricEffectArrow":return Math.abs(.5*d.width);case "CIMGeometricEffectBuffer":return Math.abs(d.size);case "CIMGeometricEffectExtension":return Math.abs(d.length);case "CIMGeometricEffectJog":return Math.abs(.5*d.length);case "CIMGeometricEffectMove":return Math.max(Math.abs(q.getValue(d.offsetX)),Math.abs(q.getValue(d.offsetY)));case "CIMGeometricEffectOffset":return Math.abs(d.offset);case "CIMGeometricEffectOffsetTangent":return Math.abs(d.offset);
case "CIMGeometricEffectRadial":return Math.abs(d.length);case "CIMGeometricEffectRegularPolygon":return Math.abs(d.radius);case "CIMGeometricEffectRotate":return 0;case "CIMGeometricEffectScale":return 0;case "CIMGeometricEffectTaperedPolygon":return.5*Math.max(Math.abs(d.fromWidth),Math.abs(d.toWidth));case "CIMGeometricEffectWave":return Math.abs(d.amplitude);default:return 0}}function S(d){if(!d)return 0;let a=0;for(const b of d)a+=da(b);return a}const T=Math.PI,ea=T/2,x=96/72,U=Math.PI/180,K=
H.getLogger("esri.symbols.cim.CIMSymbolHelper");H=function(){function d(){}var a=d.prototype;a.getSymbolInflateSize=function(b,c,f,h,g){b||(b=[0,0,0,0]);return c?this._getInflateSize(b,c,f,h,g):b};d.safeSize=function(b){const c=Math.max(Math.abs(b[0]),Math.abs(b[2]));b=Math.max(Math.abs(b[1]),Math.abs(b[3]));return Math.sqrt(c*c+b*b)};a._vectorMarkerBounds=function(b,c,f,h){let g=!0;const l=C.create();if(c&&c.markerGraphics)for(const e of c.markerGraphics)c=[0,0,0,0],e.geometry&&(aa.getBoundsXY(l,
e.geometry),c[0]=0,c[1]=0,c[2]=0,c[3]=0,this.getSymbolInflateSize(c,e.symbol,f,0,h),l[0]+=c[0],l[1]+=c[1],l[2]+=c[2],l[3]+=c[3],g?(b[0]=l[0],b[1]=l[1],b[2]=l[2],b[3]=l[3],g=!1):(b[0]=Math.min(b[0],l[0]),b[1]=Math.min(b[1],l[1]),b[2]=Math.max(b[2],l[2]),b[3]=Math.max(b[3],l[3])));return b};a._getInflateSize=function(b,c,f,h,g){return void 0!==c.symbolLayers?(b=this._getLayersInflateSize(b,c.symbolLayers,f,h,g),c=S(c.effects),0<c&&(b[0]-=c,b[1]-=c,b[2]+=c,b[3]+=c),b):this._getTextInflatedSize(b,c,g)};
a._getLayersInflateSize=function(b,c,f,h,g){let l=!0;if(!c)return b;for(const t of c)if(t){var e=[0,0,0,0];switch(t.type){case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":c=t;var k=c.width;k=c.capStyle===n.LineCapStyle.Square||c.joinStyle===n.LineJoinStyle.Miter?k/1.4142135623730951:k/2;e[0]=-k;e[1]=-k;e[2]=k;e[3]=k;break;case "CIMCharacterMarker":case "CIMVectorMarker":case "CIMPictureMarker":c=t;if("CIMVectorMarker"===t.type){if(k=t,e=this._vectorMarkerBounds(e,k,f,g),k.frame){var m=
(k.frame.xmin+k.frame.xmax)/2,p=(k.frame.ymin+k.frame.ymax)/2;e[0]-=m;e[1]-=p;e[2]-=m;e[3]-=p;k=k.size/(k.frame.ymax-k.frame.ymin);e[0]*=k;e[1]*=k;e[2]*=k;e[3]*=k}}else"CIMPictureMarker"===t.type?(e=t,m=f.getResource(e.url),k=1,I.isSome(m)&&m.height&&(k=m.width/m.height),m=c.size/2,e=c.size*k*e.scaleX/2,e=[-e,-m,e,m]):(e=c.size/2,e=[-e,-e,e,e]);c.anchorPoint&&("Absolute"===c.anchorPointUnits?(k=c.anchorPoint.x,m=c.anchorPoint.y):(k=c.anchorPoint.x*(e[2]-e[0]),m=c.anchorPoint.y*(e[3]-e[1])),e[0]-=
k,e[1]-=m,e[2]-=k,e[3]-=m);k=q.getValue(c.rotation);c.rotateClockwise&&(k=-k);h&&(k-=h);k&&(m=U*k,k=Math.cos(m),m=Math.sin(m),p=C.create([F.C_INFINITY,F.C_INFINITY,-F.C_INFINITY,-F.C_INFINITY]),C.expandPointInPlace(p,[e[0]*k-e[1]*m,e[0]*m+e[1]*k]),C.expandPointInPlace(p,[e[0]*k-e[3]*m,e[0]*m+e[3]*k]),C.expandPointInPlace(p,[e[2]*k-e[1]*m,e[2]*m+e[1]*k]),C.expandPointInPlace(p,[e[2]*k-e[3]*m,e[2]*m+e[3]*k]),e=p);k=q.getValue(c.offsetX);m=q.getValue(c.offsetY);if(h){var r=U*h;p=Math.cos(r);r=Math.sin(r);
const u=k*r+m*p;k=k*p-m*r;m=u}e[0]+=k;e[1]+=m;e[2]+=k;e[3]+=m;c=ca(c.markerPlacement);0<c&&(e[0]-=c,e[1]-=c,e[2]+=c,e[3]+=c)}c=S(t.effects);0<c&&(e[0]-=c,e[1]-=c,e[2]+=c,e[3]+=c);l?(b[0]=e[0],b[1]=e[1],b[2]=e[2],b[3]=e[3],l=!1):(b[0]=Math.min(b[0],e[0]),b[1]=Math.min(b[1],e[1]),b[2]=Math.max(b[2],e[2]),b[3]=Math.max(b[3],e[3]))}return b};a._getTextInflatedSize=function(b,c,f){var h,g;const l=null!=(h=c.height)?h:10;b[0]=-l/2;b[1]=-l/2;b[2]=l/2;b[3]=l/2;if(!f)return b;f=f.get(c);if(!f)return b;const {text:e,
mosaicItem:k}=f;if(!k||0===k.glyphMosaicItems.length)return b;f=D.lineGapType2LineHeight(c.lineGapType,null!=(g=c.lineGap)?g:0,l);g=O.bidiText(e)[1];c=ba.shapeGlyphs(k.glyphMosaicItems,g,{scale:l/J.GLYPH_SIZE,angle:q.getValue(c.angle),xOffset:q.getValue(c.offsetX),yOffset:q.getValue(c.offsetY),hAlign:D.horizontalAlignment2HAlign(c.horizontalAlignment),vAlign:D.verticalAlignment2VAlign(c.verticalAlignment),maxLineWidth:512,lineHeight:J.MAGIC_LABEL_LINE_HEIGHT*Math.max(.25,Math.min(f||1,4)),decoration:c.font.decoration||
"none",isCIM:!0}).boundsT;b[0]=c.x-c.halfWidth;b[1]=-c.y-c.halfHeight;b[2]=c.x+c.halfWidth;b[3]=-c.y+c.halfHeight;return b};return d}();let B=function(){function d(){}d.getEnvelope=function(a,b){b=new D.EnvDrawHelper(b);if(Array.isArray(a)){let c;for(const f of a)c?c.union(G(b,f)):c=G(b,f);return c}return G(b,a)};d.getTextureAnchor=function(a,b){a=this.getEnvelope(a,b);if(!a)return[0,0,0];b=a.height*x+2;return[(a.x+.5*a.width)*x/(a.width*x+2),-(a.y+.5*a.height)*x/b,b]};d.rasterize=function(a,b,c,
f,h=!0){var g=c||this.getEnvelope(b,f);if(!g)return[null,0,0,0,0];const l=(g.x+.5*g.width)*x,e=(g.y+.5*g.height)*x;a.width=g.width*x;a.height=g.height*x;c||(a.width+=2,a.height+=2);c=a.getContext("2d");g=D.Transformation.createScale(x,-x);g.translate(.5*a.width-l,.5*a.height+e);f=new D.CanvasDrawHelper(c,f,g);switch(b.type){case "CIMPointSymbol":f.drawSymbol(b,{type:"point",x:0,y:0});break;case "CIMVectorMarker":g=new R.Placement,f.drawMarker(b,g)}b=c.getImageData(0,0,a.width,a.height);b=new Uint8Array(b.data);
if(h)for(f=0;f<b.length;f+=4)h=b[f+3]/255,b[f]*=h,b[f+1]*=h,b[f+2]*=h;return[b,a.width,a.height,-l/a.width,-e/a.height]};d.fromTextSymbol=function(a){const {angle:b,color:c,font:f,haloColor:h,haloSize:g,horizontalAlignment:l,kerning:e,text:k,verticalAlignment:m,xoffset:p,yoffset:r}=a;let t,u;if(f){var y=f.family;var w=f.style;var z=f.weight;t=f.size;u=f.decoration}a=!1;k&&(a=O.bidiText(k)[1]);var fa=n.BlockProgression.BTT,ha=n.FontEffects.Normal,ia=n.FontEncoding.Unicode;y=y||"Arial";b:{if(z)switch(z.toLowerCase()){case "bold":case "bolder":z=
"bold";break b}z=""}b:{if(w)switch(w.toLowerCase()){case "italic":case "oblique":w="italic";break b}w=""}z=z&&w?`${z}-${w}`:`${z}${w}`;return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPointUnits:"Relative",dominantSizeAxis3D:"Y",size:10,billboardMode3D:"FaceNearPlane",frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{x:0,y:0},symbol:{type:"CIMTextSymbol",angle:b,blockProgression:fa,depth3D:1,extrapolateBaselines:!0,fontEffects:ha,
fontEncoding:ia,fontFamilyName:y,fontStyleName:z,fontType:n.FontType.Unspecified,haloSize:g,height:t,hinting:n.GlyphHinting.Default,horizontalAlignment:ja(null!=l?l:"center"),kerning:e,letterWidth:100,ligatures:!0,lineGapType:"Multiple",offsetX:q.getValue(p),offsetY:q.getValue(r),strikethrough:"line-through"===u,underline:"underline"===u,symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:v(c)}]},haloSymbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",
enable:!0,color:v(h)}]},shadowColor:[0,0,0,255],shadowOffsetX:1,shadowOffsetY:1,textCase:"Normal",textDirection:a?n.TextReadingDirection.RTL:n.TextReadingDirection.LTR,verticalAlignment:ka(null!=m?m:"baseline"),verticalGlyphOrientation:n.VerticalGlyphOrientation.Right,wordSpacing:100,billboardMode3D:n.BillBoardMode.FaceNearPlane},textString:k}],scaleSymbolsProportionally:!0,respectFrame:!0}],scaleX:1,angleAlignment:"Display"}};d.fromPictureFillSymbol=function(a){const {height:b,outline:c,width:f,
xoffset:h,xscale:g,yoffset:l,yscale:e}=a,k=[],m={type:"CIMPolygonSymbol",symbolLayers:k};if(c){const {cap:r,join:t,miterLimit:u,width:y}=c;k.push({type:"CIMSolidStroke",color:v(c.color),capStyle:L(r),joinStyle:M(t),miterLimit:u,width:y})}let p=a.url;"esriPFS"===a.type&&a.imageData&&(p=a.imageData);a="angle"in a?a.angle:0;k.push({type:"CIMPictureFill",invertBackfaceTexture:!1,scaleX:1,textureFilter:n.TextureFilter.Picture,tintColor:null,url:p,height:b*(e||1),width:f*(g||1),offsetX:q.getValue(h),offsetY:q.getValue(l),
rotation:q.getValue(-a),colorSubstitutions:null});return m};d.fromSimpleFillSymbol=function(a){const {color:b,style:c,outline:f}=a;a=[];const h={type:"CIMPolygonSymbol",symbolLayers:a};var g=null;if(f){const {cap:e,join:k,style:m}=f;"solid"!==m&&"none"!==m&&"esriSLSSolid"!==m&&"esriSLSNull"!==m&&(g=[{type:"CIMGeometricEffectDashes",dashTemplate:N(m,e),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);a.push({type:"CIMSolidStroke",color:v(f.color),capStyle:L(e),joinStyle:M(k),miterLimit:f.miterLimit,
width:f.width,effects:g})}if(c&&"solid"!==c&&"none"!==c&&"esriSFSSolid"!==c&&"esriSFSNull"!==c){g={type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",color:v(b),capStyle:n.LineCapStyle.Butt,joinStyle:n.LineJoinStyle.Miter,width:.75}]};let e=0;var l=Q.nextPowerOfTwo(Math.ceil(window.devicePixelRatio));l=V(c)?8*l:10*l;switch(c){case "vertical":case "esriSFSVertical":e=90;break;case "forward-diagonal":case "esriSFSForwardDiagonal":e=-45;break;case "backward-diagonal":case "esriSFSBackwardDiagonal":e=
45;break;case "cross":case "esriSFSCross":e=0;break;case "diagonal-cross":case "esriSFSDiagonalCross":e=-45}a.push({type:"CIMHatchFill",lineSymbol:g,offsetX:0,offsetY:0,rotation:e,separation:l});"cross"===c||"esriSFSCross"===c?a.push({type:"CIMHatchFill",lineSymbol:P.clone(g),offsetX:0,offsetY:0,rotation:90,separation:l}):("diagonal-cross"===c||"esriSFSDiagonalCross"===c)&&a.push({type:"CIMHatchFill",lineSymbol:P.clone(g),offsetX:0,offsetY:0,rotation:45,separation:l})}else!c||"solid"!==c&&"esriSFSSolid"!==
c||a.push({type:"CIMSolidFill",enable:!0,color:v(b)});return h};d.fromSimpleLineSymbol=function(a){const {cap:b,color:c,join:f,marker:h,miterLimit:g,style:l,width:e}=a;a=null;"solid"!==l&&"none"!==l&&"esriSLSSolid"!==l&&"esriSLSNull"!==l&&(a=[{type:"CIMGeometricEffectDashes",dashTemplate:N(l,b),lineDashEnding:"NoConstraint",scaleDash:!0,offsetAlongLine:null}]);const k=[];if(h){let m;switch(h.placement){case "begin-end":m=n.ExtremityPlacement.Both;break;case "begin":m=n.ExtremityPlacement.JustBegin;
break;case "end":m=n.ExtremityPlacement.JustEnd;break;default:m=n.ExtremityPlacement.None}const p=d.fromSimpleMarker(h,e,c).symbolLayers[0];p.markerPlacement={type:"CIMMarkerPlacementAtExtremities",angleToLine:!0,offset:0,extremityPlacement:m,offsetAlongLine:0};k.push(p)}"none"!==l&&"esriSLSNull"!==l&&k.push({type:"CIMSolidStroke",color:v(c),capStyle:L(b),joinStyle:M(f),miterLimit:g,width:e,effects:a});return{type:"CIMLineSymbol",symbolLayers:k}};d.fromPictureMarker=function(a){const {angle:b,height:c,
width:f,xoffset:h,yoffset:g}=a;let l=a.url;"esriPMS"===a.type&&a.imageData&&(l=a.imageData);return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMPictureMarker",invertBackfaceTexture:!1,scaleX:1,textureFilter:n.TextureFilter.Picture,tintColor:null,url:l,size:c,width:f,offsetX:q.getValue(h),offsetY:q.getValue(g),rotation:q.getValue(-b)}]}};d.fromSimpleMarker=function(a,b,c){var f,{style:h}=a;c=null!=(f=a.color)?f:c;if("path"===h){b=[];"outline"in a&&a.outline&&(f=a.outline,b.push({type:"CIMSolidStroke",
enable:!0,width:E.pt2px(Math.round(E.px2pt(f.width))),color:v(f.color)}));b.push({type:"CIMSolidFill",enable:!0,color:v(c),path:a.path});const [k,m]=W("square");return{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:q.getValue(-a.angle),size:q.getValue(a.size||6),offsetX:q.getValue(a.xoffset),offsetY:q.getValue(a.yoffset),frame:k,markerGraphics:[{type:"CIMMarkerGraphic",geometry:m,symbol:{type:"CIMPolygonSymbol",symbolLayers:b}}]}]}}const [g,l]=W(h);let e;l&&g&&(f=[],
"outline"in a&&a.outline?(h=a.outline,f.push({type:"CIMSolidStroke",enable:!0,width:.667<h.width?E.pt2px(Math.round(E.px2pt(h.width))):h.width,color:v(h.color)})):!b||"line-marker"!==a.type||"cross"!==a.style&&"x"!==a.style||f.push({type:"CIMSolidStroke",enable:!0,width:b,color:v(c)}),f.push({type:"CIMSolidFill",enable:!0,color:v(c)}),c={type:"CIMPolygonSymbol",symbolLayers:f},e={type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,rotation:q.getValue(-a.angle),size:q.getValue(a.size||
6*b),offsetX:q.getValue(a.xoffset),offsetY:q.getValue(a.yoffset),frame:g,markerGraphics:[{type:"CIMMarkerGraphic",geometry:l,symbol:c}]}]});return e};d.fromCIMHatchFill=function(a){var b;const c=null!=(b=a.separation)?b:4;b=c/2;const f=a.lineSymbol;for(a=this._getLineSymbolPeriod(a.lineSymbol)||4;4>a;)a*=2;a/=2;return{type:"CIMVectorMarker",frame:{xmin:-a,xmax:a,ymin:-b,ymax:b},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[-a,0],[a,0]]]},symbol:f}],size:c}};d._getLineSymbolPeriod=function(a){if(a){const b=
this._getEffectsRepeat(a.effects);if(b)return b;if(a.symbolLayers)for(const c of a.symbolLayers)if(c){if(a=this._getEffectsRepeat(c.effects))return a;switch(c.type){case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":if(a=this._getPlacementRepeat(c.markerPlacement))return a}}}return 0};d._getEffectsRepeat=function(a){if(a)for(var b of a)if(b)switch(b.type){case "CIMGeometricEffectDashes":if((a=b.dashTemplate)&&a.length){b=0;for(const c of a)b+=
c;a.length&1&&(b*=2);return b}break;case "CIMGeometricEffectWave":return b.period;default:K.error(`unsupported geometric effect type ${b.type}`)}return 0};d._getPlacementRepeat=function(a){if(a)switch(a.type){case "CIMMarkerPlacementAlongLineSameSize":case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineVariableSize":if((a=a.placementTemplate)&&a.length){let b=0;for(const c of a)b+=c;a.length&1&&(b*=2);return b}}return 0};d.fromCIMInsidePolygon=function(a){var b,c=a.markerPlacement;
const f={type:a.type,...a,markerPlacement:null,anchorPoint:null};a=Math.abs(c.stepX);const h=Math.abs(c.stepY);var g=(null!=(b=c.randomness)?b:100)/100;let l,e;if("Random"===c.gridType){b=E.px2pt(J.RANDOM_INSIDE_POLYGON_TEXTURE_SIZE);const k=Math.max(Math.floor(b/a),1),m=Math.max(Math.floor(b/h),1);b=k*a/2;l=m*h/2;e=2*l;c=new Z(c.seed);const p=g*a/1.5,r=g*h/1.5;g=[];for(let t=0;t<k;t++)for(let u=0;u<m;u++){const y=t*a-b+p*(.5-c.getFloat()),w=u*h-l+r*(.5-c.getFloat());g.push({x:y,y:w});0===t&&g.push({x:y+
2*b,y:w});0===u&&g.push({x:y,y:w+2*l})}}else!0===c.shiftOddRows?(b=a/2,l=h,e=2*h,g=[{x:-b,y:0},{x:b,y:0},{x:0,y:l},{x:0,y:-l}]):(b=a/2,l=h/2,e=h,g=[{x:0,y:0}]);a=g.map(k=>({type:"CIMMarkerGraphic",geometry:k,symbol:{type:"CIMPointSymbol",symbolLayers:[f]}}));return{type:"CIMVectorMarker",frame:{xmin:-b,xmax:b,ymin:-l,ymax:l},markerGraphics:a,size:e}};d.getFillColor=function(a){if(!a)return null;switch(a.type){case "CIMPolygonSymbol":if(a.symbolLayers)for(const b of a.symbolLayers)if(a=d.getFillColor(b),
null!=a)return a;break;case "CIMTextSymbol":return d.getFillColor(a.symbol);case "CIMSolidFill":return a.color}};d.getStrokeColor=function(a){if(a)switch(a.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(a.symbolLayers)for(const b of a.symbolLayers)if(a=d.getStrokeColor(b),void 0!==a)return a;break;case "CIMTextSymbol":return d.getStrokeColor(a.symbol);case "CIMSolidStroke":return a.color}};d.getStrokeWidth=function(a){if(a)switch(a.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(a.symbolLayers)for(const b of a.symbolLayers)if(a=
d.getStrokeWidth(b),void 0!==a)return a;break;case "CIMTextSymbol":return d.getStrokeWidth(a.symbol);case "CIMSolidStroke":case "CIMGradientStroke":case "CIMPictureStroke":return a.width}};d.getSize=function(a){if(a)switch(a.type){case "CIMTextSymbol":return a.height;case "CIMPointSymbol":var b=0;if(a.symbolLayers)for(var c of a.symbolLayers)if(c)switch(c.type){case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":a=c.size,a>b&&(b=
a)}return b;case "CIMLineSymbol":case "CIMPolygonSymbol":c=0;if(a.symbolLayers)for(b of a.symbolLayers)if(b)switch(b.type){case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":a=b.width;a>c&&(c=a);break;case "CIMCharacterMarker":case "CIMPictureMarker":case "CIMVectorMarker":case "CIMObjectMarker3D":case "CIMglTFMarker3D":q.isCIMMarkerStrokePlacement(b.markerPlacement)&&(a=b.size,a>c&&(c=a))}return c}};d.getMarkerScaleRatio=function(a){if(a)switch(a.type){case "CIMVectorMarker":if(!1!==
a.scaleSymbolsProportionally&&a.frame)return a.size/(a.frame.ymax-a.frame.ymin)}return 1};return d}(),la=function(){function d(){}d.rasterizeSimpleFill=function(a,b,c){"solid"!==b&&"none"!==b&&"esriSFSSolid"!==b&&"esriSFSNull"!==b||console.error("Unexpected: style does not require rasterization");c=Q.nextPowerOfTwo(Math.ceil(c));var f=V(b)?8*c:16*c;const h=2*c;a.width=f;a.height=f;const g=a.getContext("2d");g.strokeStyle="#FFFFFF";g.lineWidth=c;g.beginPath();if("vertical"===b||"cross"===b||"esriSFSCross"===
b||"esriSFSVertical"===b)g.moveTo(f/2,-h),g.lineTo(f/2,f+h);if("horizontal"===b||"cross"===b||"esriSFSCross"===b||"esriSFSHorizontal"===b)g.moveTo(-h,f/2),g.lineTo(f+h,f/2);if("forward-diagonal"===b||"diagonal-cross"===b||"esriSFSDiagonalCross"===b||"esriSFSForwardDiagonal"===b)g.moveTo(-h,-h),g.lineTo(f+h,f+h),g.moveTo(f-h,-h),g.lineTo(f+h,h),g.moveTo(-h,f-h),g.lineTo(h,f+h);if("backward-diagonal"===b||"diagonal-cross"===b||"esriSFSBackwardDiagonal"===b||"esriSFSDiagonalCross"===b)g.moveTo(f+h,-h),
g.lineTo(-h,f+h),g.moveTo(h,-h),g.lineTo(-h,h),g.moveTo(f+h,f-h),g.lineTo(f-h,f+h);g.stroke();b=g.getImageData(0,0,a.width,a.height);b=new Uint8Array(b.data);for(f=0;f<b.length;f+=4)c=b[f+3]/255,b[f]*=c,b[f+1]*=c,b[f+2]*=c;return[b,a.width,a.height]};d.rasterizeSimpleLine=function(a,b){return this.rasterizeDash(a,b)};d.rasterizeDash=function(a,b){var c="Butt"===b,f="Square"===b;b=!c&&!f;1===a.length%2&&(a=[...a,...a]);var h=0;for(var g of a)h+=g;g=Math.round(15.5*h);h=new Float32Array(31*g);let l=
0,e=0,k=.5,m=!0;for(var p of a){l=e;for(e+=15.5*p;k<=e;){for(a=.5;31>a;){const r=b?(a-15.5)*(a-15.5):Math.abs(a-15.5);h[(a-.5)*g+k-.5]=m?c?Math.max(Math.max(l+7.75-k,r),Math.max(k-e+7.75,r)):r:b?Math.min((k-l)*(k-l)+r,(k-e)*(k-e)+r):f?Math.min(Math.max(k-l,r),Math.max(e-k,r)):Math.min(Math.max(k-l+7.75,r),Math.max(e+7.75-k,r));a++}k++}m=!m}c=h.length;p=new Uint8Array(4*c);for(f=0;f<c;++f)Y.packFloatRGBA((b?Math.sqrt(h[f]):h[f])/15.5,p,4*f);return[p,g,31]};return d}(),ma=function(){function d(){}d.findApplicableOverrides=
function(a,b,c){if(a&&b){if(a.primitiveName){let f=!1;for(const h of c)if(h.primitiveName===a.primitiveName){f=!0;break}if(!f)for(const h of b)h.primitiveName===a.primitiveName&&c.push(h)}switch(a.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(a.effects)for(const f of a.effects)d.findApplicableOverrides(f,b,c);if(a.symbolLayers)for(const f of a.symbolLayers)d.findApplicableOverrides(f,b,c);break;case "CIMSolidStroke":case "CIMPictureStroke":case "CIMGradientStroke":case "CIMSolidFill":case "CIMPictureFill":case "CIMHatchFill":case "CIMGradientFill":case "CIMVectorMarker":case "CIMCharacterMarker":case "CIMPictureMarker":if(a.effects)for(const f of a.effects)d.findApplicableOverrides(f,
b,c);a.markerPlacement&&d.findApplicableOverrides(a.markerPlacement,b,c);if("CIMVectorMarker"===a.type){if(a.markerGraphics)for(const f of a.markerGraphics)d.findApplicableOverrides(f,b,c),d.findApplicableOverrides(f.symbol,b,c)}else"CIMCharacterMarker"===a.type?d.findApplicableOverrides(a.symbol,b,c):"CIMHatchFill"===a.type?d.findApplicableOverrides(a.lineSymbol,b,c):"CIMPictureMarker"===a.type&&d.findApplicableOverrides(a.animatedSymbolProperties,b,c)}}};d.findEffectOverrides=function(a,b,c){if(b&&
a){var f=a.length;for(let g=0;g<f;g++){var h=a[g];if(h=null==h?void 0:h.primitiveName){let l=!1;for(const e of c)if(e.primitiveName===h){l=!0;break}if(!l)for(const e of b)e.primitiveName===h&&c.push(e)}}}};d.applyOverrides=function(a,b,c,f){if(b){if(a.primitiveName)for(const g of b)if(g.primitiveName===a.primitiveName){var h=(h=g.propertyName)?h.charAt(0).toLowerCase()+h.substr(1):h;f&&f.push({cim:a,nocapPropertyName:h,value:a[h]});g.expression&&(g.value=d.toValue(g.propertyName,g.expression));if(c){let l=
!1;for(const e of c)e.primitiveName===a.primitiveName&&(l=!0);l||c.push(g)}a[h]=g.value}switch(a.type){case "CIMPointSymbol":case "CIMLineSymbol":case "CIMPolygonSymbol":if(a.effects)for(const g of a.effects)d.applyOverrides(g,b,c,f);if(a.symbolLayers)for(const g of a.symbolLayers)d.applyOverrides(g,b,c,f);break;case "CIMSolidStroke":case "CIMSolidFill":case "CIMVectorMarker":if(a.effects)for(const g of a.effects)d.applyOverrides(g,b,c,f);if("CIMVectorMarker"===a.type&&a.markerGraphics)for(const g of a.markerGraphics)d.applyOverrides(g,
b,c,f),d.applyOverrides(g.symbol,b,c,f)}}};d.restoreOverrides=function(a){for(const b of a)b.cim[b.nocapPropertyName]=b.value};d.buildOverrideKey=function(a){let b="";for(const c of a)void 0!==c.value&&(b+=`${c.primitiveName}${c.propertyName}${JSON.stringify(c.value)}`);return b};d.toValue=function(a,b){return"DashTemplate"===a?b.split(" ").map(c=>Number(c)):"Color"===a?(a=(new X(b)).toRgba(),a[3]*=255,a):b};return d}();const L=d=>{if(!d)return n.LineCapStyle.Butt;switch(d){case "butt":return n.LineCapStyle.Butt;
case "square":return n.LineCapStyle.Square;case "round":return n.LineCapStyle.Round}},M=d=>{if(!d)return n.LineJoinStyle.Miter;switch(d){case "miter":return n.LineJoinStyle.Miter;case "round":return n.LineJoinStyle.Round;case "bevel":return n.LineJoinStyle.Bevel}},ja=d=>{if(I.isNone(d))return"Center";switch(d){case "left":return"Left";case "right":return"Right";case "center":return"Center"}},ka=d=>{if(I.isNone(d))return"Center";switch(d){case "baseline":return"Baseline";case "top":return"Top";case "middle":return"Center";
case "bottom":return"Bottom"}},v=d=>{if(!d)return[0,0,0,0];const {r:a,g:b,b:c,a:f}=d;return[a,b,c,255*f]},N=(d,a)=>{a="butt"===a;switch(d){case "dash":case "esriSLSDash":return a?[4,3]:[3,4];case "dash-dot":case "esriSLSDashDot":return a?[4,3,1,3]:[3,4,0,4];case "dot":case "esriSLSDot":return a?[1,3]:[0,4];case "long-dash":case "esriSLSLongDash":return a?[8,3]:[7,4];case "long-dash-dot":case "esriSLSLongDashDot":return a?[8,3,1,3]:[7,4,0,4];case "long-dash-dot-dot":case "esriSLSDashDotDot":return a?
[8,3,1,3,1,3]:[7,4,0,4,0,4];case "short-dash":case "esriSLSShortDash":return a?[4,1]:[3,2];case "short-dash-dot":case "esriSLSShortDashDot":return a?[4,1,1,1]:[3,2,0,2];case "short-dash-dot-dot":case "esriSLSShortDashDotDot":return a?[4,1,1,1,1,1]:[3,2,0,2,0,2];case "short-dot":case "esriSLSShortDot":return a?[1,1]:[0,2];case "solid":case "esriSLSSolid":case "none":return K.error("Unexpected: style does not require rasterization"),[0,0];default:return K.error(`Tried to rasterize SLS, but found an unexpected style: ${d}!`),
[0,0]}},W=d=>{if("circle"===d||"esriSMSCircle"===d){var a=Math.acos(.995);d=Math.ceil(T/a/4);0===d&&(d=1);a=ea/d;d*=4;var b=[];b.push([50,0]);for(let c=1;c<d;c++)b.push([50*Math.cos(c*a),-50*Math.sin(c*a)]);b.push([50,0]);a={rings:[b]};b={xmin:-50,ymin:-50,xmax:50,ymax:50}}else"cross"===d||"esriSMSCross"===d?(a={rings:[[[0,50],[0,0],[50,0],[50,-0],[0,-0],[0,-50],[-0,-50],[-0,-0],[-50,-0],[-50,0],[-0,0],[-0,50],[0,50]]]},b={xmin:-50,ymin:-50,xmax:50,ymax:50}):"diamond"===d||"esriSMSDiamond"===d?(a=
{rings:[[[-50,0],[0,50],[50,0],[0,-50],[-50,0]]]},b={xmin:-50,ymin:-50,xmax:50,ymax:50}):"square"===d||"esriSMSSquare"===d?(a={rings:[[[-50,-50],[-50,50],[50,50],[50,-50],[-50,-50]]]},b={xmin:-50,ymin:-50,xmax:50,ymax:50}):"x"===d||"esriSMSX"===d?(a={rings:[[[0,0],[50,50],[50,50],[0,0],[50,-50],[50,-50],[0,-0],[-50,-50],[-50,-50],[-0,0],[-50,50],[-50,50],[0,0]]]},b={xmin:-50,ymin:-50,xmax:50,ymax:50}):"triangle"===d||"esriSMSTriangle"===d?(d=2/3*100,b=d-100,a={rings:[[[-57.735026918962575,b],[0,d],
[57.735026918962575,b],[-57.735026918962575,b]]]},b={xmin:-57.735026918962575,ymin:b,xmax:57.735026918962575,ymax:d}):"arrow"===d&&(a={rings:[[[-50,50],[50,0],[-50,-50],[-33,-20],[-33,20],[-50,50]]]},b={xmin:-50,ymin:-50,xmax:50,ymax:50});return[b,a]},V=d=>"vertical"===d||"horizontal"===d||"cross"===d||"esriSFSCross"===d||"esriSFSVertical"===d||"esriSFSHorizontal"===d;A.CIMSimbolInflatedSizeHelper=H;A.CIMSymbolHelper=B;A.OverrideHelper=ma;A.SymbolHelper=la;A.slsDashToTemplateArray=N;A.symbolToCIM=
function(d){if(!d||!d.type)return null;let a;switch(d.type){case "cim":return d.data;case "web-style":return d;case "simple-marker":a=B.fromSimpleMarker(d);break;case "picture-marker":a=B.fromPictureMarker(d);break;case "simple-line":a=B.fromSimpleLineSymbol(d);break;case "simple-fill":a=B.fromSimpleFillSymbol(d);break;case "picture-fill":a=B.fromPictureFillSymbol(d);break;case "text":a=B.fromTextSymbol(d)}return{type:"CIMSymbolReference",symbol:a}};Object.defineProperties(A,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})});