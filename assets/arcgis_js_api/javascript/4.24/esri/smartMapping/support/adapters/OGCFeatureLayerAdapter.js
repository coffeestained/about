// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/arrayUtils ../../../core/Error ../../../core/maybe ../../../core/reactiveUtils ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/has ../../../core/accessorSupport/set ../../../core/accessorSupport/decorators/subclass ../../../layers/support/fieldUtils ../../statistics/support/predominanceUtils ../../statistics/support/utils ../../statistics/support/WorkerClient ./FeatureLayerAdapter ./support/utils ../../../statistics/utils".split(" "),
function(l,x,y,h,n,q,t,G,H,I,z,A,B,C,D,E,r,v){t=function(w){function u(b){return w.call(this,b)||this}l._inheritsLoose(u,w);var g=u.prototype;g._waitForLayerViewUpdate=function(){var b=l._asyncToGenerator(function*(a){if(!a)throw new h("ogc-feature-layer-adapter:insufficient-data","layerView is required to fetch the features");yield q.whenOnce(()=>!a.updating)});return function(a){return b.apply(this,arguments)}}();g._summaryStatsFromClientQuery=function(){var b=l._asyncToGenerator(function*(a,c){const {signal:e,
view:d}=a;if(!d)throw new h("ogc-feature-layer-adapter:insufficient-data","view is required to fetch the features from layerView");a=this._getSummaryStatsQuery(a,c);const f=yield d.whenLayerView(this.layer);yield q.whenOnce(()=>!f.updating,n.unwrap(e));a=yield f.queryFeatures(a,{signal:e});c=r.getSummaryStatisticsFromFeatureSet(a,c);return v.processSummaryStatisticsResult(c)});return function(a,c){return b.apply(this,arguments)}}();g._uvFromClientQuery=function(){var b=l._asyncToGenerator(function*(a,
c){const {signal:e,view:d}=a;if(!d)throw new h("ogc-feature-layer-adapter:insufficient-data","view is required to fetch the features from layerView");var f=this._getUVQuery(a);const k=yield d.whenLayerView(this.layer);yield q.whenOnce(()=>!k.updating,n.unwrap(e));f=yield k.queryFeatures(f,{signal:e});f=yield r.getUniqueValuesFromFeatureSet(f,this,a.field,a.view,null,e);return v.createUVResult(f,c,a.returnAllCodedValues)});return function(a,c){return b.apply(this,arguments)}}();g.summaryStatistics=
function(b){const {field:a,valueExpression:c,sqlExpression:e,features:d,view:f}=b,k=a?this.getField(a):null,p=A.isDateField(k),m=!!c,F="3d"===(null==f?void 0:f.type);if(!c&&e&&!this.supportsSQLExpression)throw new h("ogc-feature-layer-adapter:not-supported","Layer does not support standardized SQL expression for queries");return m||d||F?this._summaryStatsFromMemory(b,k):this._summaryStatsFromClientQuery(b,p)};g.uniqueValues=function(b){const {field:a,valueExpression:c,sqlExpression:e,features:d,view:f}=
b,k=(a?this.getField(a):null)&&this.getFieldDomain(a),p=!!c,m="3d"===(null==f?void 0:f.type);if(!c&&e&&!this.supportsSQLExpression)throw new h("ogc-feature-layer-adapter:not-supported","Layer does not support standardized SQL expression for queries");return p||d||m?this._uvFromMemory(b,k):this._uvFromClientQuery(b,k)};g.histogram=function(b){const {features:a,valueExpression:c,normalizationType:e,sqlExpression:d}=b,f=a||!!c;if(!c&&d&&!this.supportsSQLExpression)throw new h("ogc-feature-layer-adapter:not-supported",
"Layer does not support standardized SQL expression for queries");return f||e?this._histogramFromMemory(b):this._histogramForField(b)};g.classBreaks=function(b){return!1!==b.analyzeData?this._classBreaksFromMemory(b):this._classBreaksFromInterpolation(b)};g.queryFeatureCount=function(){var b=l._asyncToGenerator(function*(a){const {whereClause:c,view:e,signal:d}=a;if(!e)throw new h("ogc-feature-layer-adapter:insufficient-data","view is required to fetch the features from layerView");a=this.layer.createQuery();
a.where=C.mergeWhereClauses(a.where,c);const f=yield e.whenLayerView(this.layer);yield q.whenOnce(()=>!f.updating,n.unwrap(d));return f.queryFeatureCount(a,{signal:d})});return function(a){return b.apply(this,arguments)}}();g.generateRenderer=function(b,a){throw new h("ogc-feature-layer-adapter:not-supported","OGCFeatureLayer does not support generateRenderer operation");};g.predominantCategories=function(){var b=l._asyncToGenerator(function*(a){const {fields:c,view:e,signal:d}=a;a=B.getArcadeForPredominantCategory(c);
a=yield this._uvFromMemory({valueExpression:a,view:e,signal:d});return r.getPredominantCategoriesFromUVInfos(a.uniqueValueInfos,c)});return function(a){return b.apply(this,arguments)}}();g.getSampleFeatures=function(){var b=l._asyncToGenerator(function*(a,c){const {view:e,sampleSize:d,requiredFields:f,returnGeometry:k,signal:p}=a,m=this.layer.createQuery();m.outSpatialReference=a.spatialReference||e&&e.spatialReference;m.returnGeometry=!!k;m.outFields=f;if(!e)throw new h("ogc-feature-layer-adapter:not-supported",
"view is required to get sample features for OGCFeatureLayer");a=yield e.whenLayerView(this.layer);if((yield r.getMissingFields(this,f,a)).length)throw new h("ogc-feature-layer-adapter:not-supported","Required fields need to be passed in the outFields for OGCFeatureLayer");c=yield this._fetchFeaturesFromMemory(a,m,p,c);return y.pickRandom(c,0<d&&d<=c.length?d:c.length,1)});return function(a,c){return b.apply(this,arguments)}}();g.load=function(b){var a=this;const c=this.layer.load(b).then(function(){var e=
l._asyncToGenerator(function*(d){a.geometryType=d.geometryType;a.objectIdField=d.objectIdField;a.supportsSQLExpression=d.get("capabilities.query.supportsSqlExpression");a.minScale=d.minScale;a.maxScale=d.maxScale;a.fullExtent=d.fullExtent;a.workerClient=D.WorkerClient.getInstance();yield a.workerClient.open(n.unwrap(n.unwrap(b).signal))});return function(d){return e.apply(this,arguments)}}());this.addResolvingPromise(c);return Promise.resolve(this)};return u}(E);return t=x.__decorate([z.subclass("esri.smartMapping.support.adapters.OGCFeatureLayerAdapter")],
t)});