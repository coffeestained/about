// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/PieChartRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../symbols ../../core/Error ../../core/maybe ../../core/screenUtils ../../intl/messages ../heuristics/outline ../heuristics/sizeRange ./size ./support/utils ../statistics/predominantCategories ../statistics/support/utils ../support/utils ../support/adapters/support/layerUtils ../symbology/pieChart ../../symbols/SimpleLineSymbol".split(" "),
function(G,t,Y,Z,aa,ba,J,ca,da,ea,fa,ha,p,w,K,L,M,N,O,l,P,Q,R,g,x,S){function T(a){return y.apply(this,arguments)}function y(){y=t._asyncToGenerator(function*(a){var c;if(!(a&&a.layer&&a.view&&null!=(c=a.attributes)&&c.length))throw new p("pie-chart-renderer:missing-parameters","'layer', 'view' and 'attributes' parameters are required");if(10<a.attributes.length)throw new p("pie-chart-renderer:invalid-parameters","PieChart renderer does not support more than 10 attributes");c={...a};c.shape=c.shape||
"pie";c.othersCategoryEnabled=null==c.othersCategoryEnabled?!0:c.othersCategoryEnabled;c.includeSizeVariable=a.includeSizeVariable||!1;var b=[g.LayerType.CSVLayer,g.LayerType.FeatureLayer,g.LayerType.OGCFeatureLayer,g.LayerType.GeoJSONLayer,g.LayerType.WFSLayer];a=g.createLayerAdapter(c.layer,b);c.layer=a;if(!a)throw new p("pie-chart-renderer:invalid-parameters","'layer' must be one of these types: "+g.getLayerTypeLabels(b).join(", "));b=w.isSome(c.signal)?{signal:c.signal}:null;yield Promise.all([c.view.when(),
a.load(b)]);var d=a.geometryType;b="polygon"===d;d="point"===d||"multipoint"===d||b;c.outlineOptimizationEnabled=b?c.outlineOptimizationEnabled:!1;c.sizeOptimizationEnabled=d?c.sizeOptimizationEnabled:!1;if(!d)throw new p("pie-chart-renderer:not-supported","PieChart renderer is only supported for point and polygon layers");b=[];d=c.attributes;for(var f of d)d=yield R.getFieldsList({field:f.field,valueExpression:f.valueExpression}),b.push(...d);if(f=l.verifyBasicFieldValidity(a,b.filter(Boolean),"pie-chart-renderer:invalid-parameters"))throw f;
return c});return y.apply(this,arguments)}function U(a){return z.apply(this,arguments)}function z(){z=t._asyncToGenerator(function*(a){let c=a.pieChartScheme,b=null;var d=null;d=yield l.getBasemapInfo(a.basemap,a.view);b=w.isSome(d.basemapId)?d.basemapId:null;d=w.isSome(d.basemapTheme)?d.basemapTheme:null;if(c)return{scheme:x.cloneScheme(c),basemapId:b,basemapTheme:d};if(a=x.getSchemes({basemap:b,numColors:a.attributes.length,geometryType:a.layer.geometryType,basemapTheme:d}))c=a.primaryScheme,b=
a.basemapId,d=a.basemapTheme;return{scheme:c,basemapId:b,basemapTheme:d}});return z.apply(this,arguments)}function V(a,c){return A.apply(this,arguments)}function A(){A=t._asyncToGenerator(function*(a,c){const {valueExpression:b,sqlExpression:d,sqlWhere:f}=Q.getSumOfAttributesExpr(a.attributes),u=yield L.fetchMessageBundle("esri/smartMapping/t9n/smartMapping");return O.createVisualVariables({layer:a.layer,basemap:a.basemap,valueExpression:b,sqlExpression:d,sqlWhere:f,sizeScheme:c,sizeOptimizationEnabled:a.sizeOptimizationEnabled,
legendOptions:{title:u.sumOfCategories},view:a.view,signal:a.signal})});return A.apply(this,arguments)}function B(){B=t._asyncToGenerator(function*(a){var c,b=yield T(a);a=yield U(b);const d=null==a?void 0:a.scheme;if(!d)throw new p("pie-chart-renderer:insufficient-info","Unable to find pie-chart scheme");var f=b.layer;const {includeSizeVariable:u,sizeOptimizationEnabled:C,outlineOptimizationEnabled:W,view:D,signal:E}=b;var h=d.sizeScheme,q=b.attributes,r=q.map(e=>e.field);const [F,m,n,k]=yield Promise.all([1<
r.length?P({layer:f,fields:r,view:D,signal:E}):null,u?V(b,h):null,!u&&C?N({layer:f,view:D,signal:E}):null,W?M({layer:f,view:D,signal:E}):null]);r=F&&F.predominantCategoryInfos?{uniqueValueInfos:F.predominantCategoryInfos}:{uniqueValueInfos:r.map(e=>({value:e,count:0}))};const X=l.createColors(d.colors,q.length);q=q.map((e,v)=>({field:e.field,valueExpression:e.valueExpression,label:e.label,valueExpressionTitle:e.valueExpressionTitle,color:X[v]}));f=f.geometryType;h="background"in h&&h.background;b=
new J({attributes:q,othersCategory:{color:b.othersCategoryEnabled?d.colorForOthersCategory:null,threshold:.04},holePercentage:"donut"===b.shape?.45:0,backgroundFillSymbol:h?l.createSymbol(f,{type:"2d",color:h.color,outline:l.getSymbolOutlineFromScheme(h,f,null==k?void 0:k.opacity)}):null,size:K.toPt(d.size),outline:new S(l.getSymbolOutlineFromScheme(d,"point",null==k?void 0:k.opacity)),legendOptions:b.legendOptions});if(m){var H;C||m.visualVariables.forEach(e=>{"number"===typeof e.minSize&&"number"===
typeof e.maxSize&&(e.minSize*=2.5,e.maxSize*=1.8)});C&&"point"===f&&m.visualVariables.forEach(e=>{if(null!=e&&e.minSize&&"object"===typeof e.minSize){var v;null==(v=e.minSize)?void 0:v.stops.forEach(I=>{I.size*=1.8})}});b.authoringInfo=m.authoringInfo.clone();b.visualVariables=null==(H=m.visualVariables)?void 0:H.map(e=>e.clone())}null!=k&&null!=(c=k.visualVariables)&&c.length&&(c=k.visualVariables.map(e=>e.clone()),b.visualVariables?b.visualVariables.push(...c):b.visualVariables=c);null!=n&&n.minSize&&
("point"===f&&n.minSize.stops.forEach(e=>{e.size*=2.5}),"polygon"===f&&n.minSize.stops.forEach(e=>{e.size*=1.8}),b.visualVariables?b.visualVariables.push(n.minSize):b.visualVariables=[n.minSize]);return{renderer:b,pieChartScheme:x.cloneScheme(d),size:m,basemapId:a.basemapId,basemapTheme:a.basemapTheme,statistics:r}});return B.apply(this,arguments)}G.createRenderer=function(a){return B.apply(this,arguments)};Object.defineProperties(G,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});