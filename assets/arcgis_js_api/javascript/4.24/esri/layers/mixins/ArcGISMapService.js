// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/promiseUtils ../../core/urlUtils ../../core/Version ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../geometry/Extent ../../geometry/SpatialReference ../support/commonProperties".split(" "),function(r,n,d,y,z,A,B,g,K,L,M,t,C,D,E,
u){r.ArcGISMapService=c=>{c=function(v){function p(){var b=v.apply(this,arguments)||this;b.capabilities=void 0;b.copyright=null;b.fullExtent=null;b.legendEnabled=!0;b.spatialReference=null;b.version=void 0;return b}n._inheritsLoose(p,v);var l=p.prototype;l.readCapabilities=function(b,a){var e,h,f=a.capabilities&&a.capabilities.split(",").map(F=>F.toLowerCase().trim());if(!f)return{operations:{supportsExportMap:!1,supportsExportTiles:!1,supportsIdentify:!1,supportsQuery:!1,supportsTileMap:!1},exportMap:null,
exportTiles:null};var k=this.type;b=f.includes("data");const G=f.includes("query"),w=f.includes("map"),x=!!a.exportTilesAllowed;f=f.includes("tilemap");const q="tile"!==k&&!!a.supportsDynamicLayers,H="tile"!==k&&(!a.tileInfo||q),I="tile"!==k&&(!a.tileInfo||q);k="tile"!==k;const m=a.cimVersion&&B.Version.parse(a.cimVersion),J=null!=(e=null==m?void 0:m.since(1,4))?e:!1;e=null!=(h=null==m?void 0:m.since(2,0))?h:!1;return{operations:{supportsExportMap:w,supportsExportTiles:x,supportsIdentify:G,supportsQuery:b,
supportsTileMap:f},exportMap:w?{supportsArcadeExpressionForLabeling:J,supportsSublayersChanges:k,supportsDynamicLayers:q,supportsSublayerVisibility:H,supportsSublayerDefinitionExpression:I,supportsCIMSymbols:e}:null,exportTiles:x?{maxExportTilesCount:+a.maxExportTilesCount}:null}};l.readVersion=function(b,a){(b=a.currentVersion)||(b=a.hasOwnProperty("capabilities")||a.hasOwnProperty("tables")?10:a.hasOwnProperty("supportedImageFormatTypes")?9.31:9.3);return b};l.fetchSublayerInfo=function(){var b=
n._asyncToGenerator(function*(a,e){yield this.fetchAllLayersAndTables(e);return this._allLayersAndTablesMap.get(a)});return function(a,e){return b.apply(this,arguments)}}();l.fetchAllLayersAndTables=function(){var b=n._asyncToGenerator(function*(a){yield this.load(a);this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=y(A.urlToObject(this.url).path+"/layers",{responseType:"json",query:{f:"json",...this.customParameters,token:this.apiKey}}).then(h=>{this._allLayersAndTablesMap=new Map;
for(const f of h.data.layers)this._allLayersAndTablesMap.set(f.id,f);return{result:h.data}},h=>({error:h})));const e=yield this._allLayersAndTablesPromise;z.throwIfAborted(a);if("result"in e)return e.result;throw e.error;});return function(a){return b.apply(this,arguments)}}();return p}(c);d.__decorate([g.property({readOnly:!0})],c.prototype,"capabilities",void 0);d.__decorate([t.reader("service","capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount","supportsDynamicLayers","tileInfo"])],
c.prototype,"readCapabilities",null);d.__decorate([g.property({json:{read:{source:"copyrightText"}}})],c.prototype,"copyright",void 0);d.__decorate([g.property({type:D})],c.prototype,"fullExtent",void 0);d.__decorate([g.property(u.id)],c.prototype,"id",void 0);d.__decorate([g.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],c.prototype,"legendEnabled",void 0);d.__decorate([g.property(u.popupEnabled)],c.prototype,"popupEnabled",
void 0);d.__decorate([g.property({type:E})],c.prototype,"spatialReference",void 0);d.__decorate([g.property({readOnly:!0})],c.prototype,"version",void 0);d.__decorate([t.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],c.prototype,"readVersion",null);return c=d.__decorate([C.subclass("esri.layers.mixins.ArcGISMapService")],c)};Object.defineProperties(r,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});