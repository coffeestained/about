// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../geometry/Extent ../../../geometry/Polygon ../../ogc/crsUtils ../RasterInfo ./xmlUtilities".split(" "),function(K,z,U,V,L,b){function W(a){const e=b.getElementValues(a,"requestResponseCRSs").map(c=>c.split(":")[1]);a=b.getElementValues(a,"nativeCRSs").map(c=>c.split(":")[1]);return{requestResponseCRSs:e,nativeCRSs:a}}function Q(a,e){const c=b.getElementValues(a,"1.0.0"===e?"interpolationMethod":"InterpolationMethod"),h="1.0.0"===e?a.getAttribute("default"):b.getElementValue(a,
"InterpolationMethods/Default");return null!=h?[h].concat(c.filter(f=>f.toLowerCase()!==h.toLowerCase())):c}function M(a){return null==a?["nearest"]:a.map(e=>{e=e.toLowerCase();return e.includes("nearest")?"nearest":e.includes("linear")?"bilinear":e.includes("cubic")?"cubic":null}).filter(e=>!!e)}function N(a,e){a=b.getElementValues(a,e);return null!=a&&a.length&&""!==a[0]&&!isNaN(Number(a[0]))?a.map(c=>Number(c)):null}function O(a){return a.every(e=>e===a[0])?a[0]:a}function X(a=null){if(!a)return{resolution:null,
units:null};let e=a.toUpperCase();var c=["Y","M","D"];const h=["H","M","S"];a="Years Months Days Hours Minutes Seconds".split(" ");let f;e.includes("PT")?(e=e.slice(2),c=h.findIndex(k=>e.includes(k)),f=a[3+c]):(e=e.slice(1),c=c.findIndex(k=>e.includes(k)),-1<c&&(f=a[c]));return{resolution:parseFloat(e.substring(0,e.length-1)),units:f}}function E(a){var e=b.getElements(a,"timeposition");if(0<e.length){a=[];for(var c=0;c<e.length;c++)a.push(new Date(b.getElementValue(e[c])));return{begin:a[0],end:a[a.length-
1],values:a}}return(c=b.getElement(a,"timePeriod")||b.getElement(a,"TimePeriod"))?(e=new Date(b.getElementValue(c,"beginPosition")||b.getElementValue(c,"BeginPosition")),a=new Date(b.getElementValue(c,"endPosition")||b.getElementValue(c,"EndPosition")),c=b.getElementValue(c,"timeResolution")||b.getElementValue(c,"TimeResolution"),c=X(c),{begin:e,end:a,...c}):null}function Y(a){if(!a.temporalDomain)return null;const {begin:e,end:c,values:h,units:f,resolution:k}=a.temporalDomain;return{variables:[{name:"default",
description:"",dimensions:[{name:"StdTime",description:"",unit:"ISO8601",values:null==h?void 0:h.map(m=>m.getTime()),hasRegularIntervals:!h,interval:k,intervalUnit:f,extent:[e.getTime(),c.getTime()]}]}]}}function Z(a,e){if(!e.temporalDomain)return null;a=a.filter(h=>!h.identifier.toLowerCase().includes("field_1")&&!h.axis.some(f=>f.identifier.includes("band")));const c=[];a.length&&a.forEach(h=>{var f,k;const m=h.axis.map(g=>{const d=g.values.map(p=>"ISO8601"===g.uom?(p=p.trim(),p.toLowerCase().includes("z")?
(new Date(p)).getTime():(new Date(p+"Z")).getTime()):parseFloat(p.trim())),l=[Math.min.apply(null,d),Math.max.apply(null,d)];return{name:g.identifier.trim(),description:"",field:g.identifier.trim(),unit:g.uom?g.uom.trim():"",hasRegularIntervals:!1,values:d,extent:l}});c.push({name:h.identifier.trim(),description:null!=(f=null==(k=h.description)?void 0:k.trim())?f:"",unit:"",dimensions:m})});if(e.temporalDomain){const {begin:h,end:f,values:k,units:m,resolution:g}=e.temporalDomain;c.some(d=>d.dimensions.some(l=>
"stdtime"===l.name.toLowerCase()))||c.forEach(d=>{d.dimensions.push({name:"StdTime",description:"",unit:"ISO8601",values:null==k?void 0:k.map(l=>l.getTime()),hasRegularIntervals:!k,interval:g,intervalUnit:m,extent:[h.getTime(),f.getTime()]})})}return c.length?{variables:c}:null}function aa(a){var e,c=b.getElement(a,"SpatialDomain"),h=b.getElement(c,"GridCRS"),f=b.getElementValue(h,"GridBaseCRS"),k=b.getElementValue(h,"GridOrigin");k=null!=(e=null==k?void 0:k.split(" ").map(q=>parseFloat(q)))?e:[0,
0];e=b.getSpaceDelimitedNumericValues(h,"GridOffsets");c=b.getElements(c,"BoundingBox");let m;for(h=0;h<c.length;h++){var g,d=null==(g=c[h].getAttribute("crs"))?void 0:g.toLowerCase();if(null!=d)if(d.includes("imagecrs")){var l=b.getSpaceDelimitedNumericValues(c[h],"LowerCorner");d=b.getSpaceDelimitedNumericValues(c[h],"UpperCorner");m=d[0]-l[0]+1;l=d[1]-l[1]+1}else if(0<d.indexOf("epsg")){var p=d.split(":");p=parseInt(p[p.length-1],10);var n=b.getSpaceDelimitedNumericValues(c[h],"LowerCorner");d=
b.getSpaceDelimitedNumericValues(c[h],"UpperCorner");n=new z({xmin:n[0],ymin:n[1],xmax:d[0],ymax:d[1],spatialReference:{wkid:p}})}}g=m>l;c=n.xmax-n.xmin>n.ymax-n.ymin;h=!1;V.isAxesOrderReversedForWkid(p)&&(g===c?h=!1:(h=!0,n=new z({xmin:n.ymin,ymin:n.xmin,xmax:n.ymax,ymax:n.xmax,spatialReference:{wkid:p}})));f={columns:m,rows:l,origin:{x:k[0],y:k[1]},offset:{x:e[0],y:e[e.length-1]},gridBaseCRS:f,envelope:n,useEPSGAxis:h};a=(a=b.getElement(a,"temporalDomain")||b.getElement(a,"TemporalDomain"))?E(a):
null;return{spatialDomain:f,temporalDomain:a}}function ba(a){const e=b.getElement(a,"Envelope")||b.getElement(a,"EnvelopeWithTimePeriod");var c=e.getAttribute("srsName"),h=c.slice(c.lastIndexOf("/")+1);c=e.getAttribute("axisLabels").split(" ").map(l=>l.trim()).filter(l=>""!==l.trim());var f=b.getSpaceDelimitedNumericValues(e,"lowerCorner"),k=b.getSpaceDelimitedNumericValues(e,"upperCorner");const m=!"y lat latitude north nor n b".split(" ").includes(c[0].toLowerCase());h=parseInt(h,10);h=isNaN(h)?
null:{wkid:h};h=m?new z({xmin:f[0],ymin:f[1],xmax:k[0],ymax:k[1],spatialReference:h}):new z({xmin:f[1],ymin:f[0],xmax:k[1],ymax:k[0],spatialReference:h});f={mins:f,maxs:k};k=e.getAttribute("uomLabels").trim().split(" ");let g,d;b.isSameTagIgnoreNS(e,"EnvelopeWithTimePeriod")&&(g=new Date(b.getElementValue(a,"beginPosition")||b.getElementValue(a,"BeginPosition")),d=new Date(b.getElementValue(a,"endPosition")||b.getElementValue(a,"EndPosition")),a=null==k?void 0:k.findIndex(l=>"oledatetime"===(null==
l?void 0:l.toLowerCase())),-1<a&&(k[a]="ISO8601"));return{envelope:h,axisLabels:c,uomLabels:k.length?k:null,envelopeAllDims:f,beginPosition:g,endPosition:d,isEastFirst:m}}function ca(a,e){const c=[];a=b.getElements(a,"DataRecord");const h=[];let f=[],k;for(let d=0;d<a.length;d++){const l=b.getElements(a[d],"field"),p=[];for(let n=0;n<l.length;n++){var m,g;const q=l[n].getAttribute("name"),u=b.getElementValue(l[n],"description")||"",v=(null==(m=b.getElement(l[n],"uom"))?void 0:m.getAttribute("code"))||
"",t=b.getSpaceDelimitedNumericValues(l[n],"interval"),w=null==(g=N(l[n],"nilValue"))?void 0:g[0];if(!e||q.toLowerCase().includes("band"))h.push(q),null!=t&&t.length&&(k=k||[],k.push({min:t[0],max:t[1],avg:-1,stddev:-1})),f.push(w);p.push({name:q,description:u,uom:v,allowedValues:t,nilValue:w})}c.push(p)}f.some(d=>null!=d)||(f=null);return{rangeType:c,bandNames:h,bandStats:k,bandNoDataValues:f}}function da(a){let e=1,c="";Math.abs(a-1/24)<1/24*.01?c="Hours":.01>Math.abs(a-1)?c="Days":1>a?(e=Math.round(24*
a),c="Hours"):27.99<a&&31.01>a?c="Months":12>Math.round(a/30)?c="Months":364.99<a&&366.01>a&&(c="Years");return{interval:e,intervalUnit:c}}function ea(a,e,c){if(2>=c.axisLabels.length)return null;const h=[];for(var f=0;f<a.length;f++){var k=a[f];for(var m=0;m<k.length;m++)k[m].name.toLowerCase().includes("band")||h.push(k[m])}const g=[];if(h.length){const d=[];for(a=2;a<c.axisLabels.length;a++){m=(e.uomLabels&&e.uomLabels.length)>a?e.uomLabels[a]:"";(f=c.axisLabels[a].toLowerCase().includes("time")||
"iso8601"===m.toLowerCase()||"oledatetime"===m.toLowerCase())?(m=da(c.offset[a]),k=m.interval,m=m.intervalUnit):k=c.offset[a];const l=[];f?(l.push((new Date).setTime(864E5*(e.envelopeAllDims.mins[a]-25569))),l.push((new Date).setTime(864E5*(e.envelopeAllDims.maxs[a]-25569)))):(l.push(e.envelopeAllDims.mins[a]),l.push(e.envelopeAllDims.maxs[a]));d.push({name:c.axisLabels[a].trim(),description:c.axisLabels[a].trim(),unit:e.uomLabels&&e.uomLabels.length>a?e.uomLabels[a].trim():"",hasRegularIntervals:!0,
extent:l,interval:k,intervalUnit:m})}h.forEach(l=>{var p,n,{allowedValues:q}=l;q=2===(null==q?void 0:q.length)?[{min:q[0],max:q[1],avg:-1,stddev:-1}]:null;g.push({name:l.name.trim(),description:null!=(p=null==(n=l.description)?void 0:n.trim())?p:"",unit:l.uom.trim(),statistics:q,dimensions:d})});if(g.length)return{variables:g}}return null}function fa(a,e){var c=b.getElement(a,"RectifiedGrid"),h=b.getSpaceDelimitedNumericValues(c,"low"),f=b.getSpaceDelimitedNumericValues(c,"high");a=[];for(var k=0;k<
h.length;k++)a.push(f[k]-h[k]+1);h=b.getElementValue(c,"axisLabels").split(" ");f=b.getSpaceDelimitedNumericValues(c,"origin/pos");k=b.getElements(c,"offsetVector");c=[];for(var m=0;m<k.length;m++){var g=b.getSpaceDelimitedNumericValues(k[m]);const d=g.findIndex(l=>0!==l);c[d]=g[d]}k=!1;null!=e&&e.length&&null!=h&&h.length&&(k=[...e].sort((d,l)=>d<l?-1:1).join(","),m=[...h].sort((d,l)=>d<l?-1:1).join(","),k=k===m);"y lat latitude north nor n b".split(" ").includes((k?h:e)[0].toLowerCase())?(e=a[1],
m=a[0],g={y:Math.abs(c[0]),x:Math.abs(c[1])}):(e=a[0],m=a[1],g={x:Math.abs(c[0]),y:Math.abs(c[1])});return{columns:e,rows:m,origin:f,offset:c,resolution:g,gridSamples:a,axisLabels:h,hasSameAxisLabelsAsBoundedBy:k}}function ha(a){var e=b.getElement(a,"EarthObservation");if(!e)return null;var c=b.getElement(e,"phenomenonTime");c=c?E(c):null;var h=b.getElement(e,"phenomenonTime");h=h?E(h):null;var f=b.getElementValue(e,"featureOfInterest/Footprint/multiExtentOf/MultiSurface/surfaceMembers/Polygon/exterior/LinearRing/posList");
e=null;if(f&&(f=f.split(" ").map(m=>m.trim()).filter(m=>null!=m&&""!==m),f.length)){e=[];for(var k=0;k<f.length/2;k+=2)e.push(f[k],f[k+1]);e=new U({rings:[e],spatialReference:{wkid:4326}})}f=b.getElementValue(a,"metaDataProperty/EarthObservationMetaData/identifier");k=b.getElementValue(a,"metaDataProperty/EarthObservationMetaData/acquisitionType");a=b.getElementValue(a,"metaDataProperty/EarthObservationMetaData/status");return{observation:{phonomenonTime:c,resultTime:h,footprint:e,identifier:f,acquisitionType:k,
status:a}}}K.parseCoverages=function(a,e){let c=null;c="string"===typeof a?(new DOMParser).parseFromString(a,"text/xml"):a;if("1.0.0"===e)return b.getElements(c,"CoverageOffering").map(h=>{{var f={version:"1.0"};var k=[],m;for(var g=0;g<h.childNodes.length;g++){var d=h.childNodes[g];if(1===d.nodeType)if(b.isSameTagIgnoreNS(d,"description"))f.description=b.getElementValue(d);else if(b.isSameTagIgnoreNS(d,"name"))f.name=b.getElementValue(d);else if(b.isSameTagIgnoreNS(d,"label"))f.label=b.getElementValue(d);
else if(b.isSameTagIgnoreNS(d,"supportedFormats"))f.supportedFormats=b.getElementValues(d,"formats");else if(b.isSameTagIgnoreNS(d,"supportedCRSs"))f.supportedCRSs=W(d);else if(b.isSameTagIgnoreNS(d,"supportedInterpolations"))f.supportedInterpolations=Q(d,"1.0.0");else if(b.isSameTagIgnoreNS(d,"lonLatEnvelope")){var l=b.getElements(d,"pos");d=b.getSpaceDelimitedNumericValues(l[0]);l=b.getSpaceDelimitedNumericValues(l[1]);d=new z({xmin:d[0],ymin:d[1],xmax:l[0],ymax:l[1],spatialReference:{wkid:4326}});
f.lonLatEnvelope=d}else if(b.isSameTagIgnoreNS(d,"rangeSet")){k=[];d=b.getElements(d,"RangeSet");l=[];for(var p=0;p<d.length;p++){var n=b.getElementValue(d[p],"name"),q=b.getElementValue(d[p],"label"),u=[],v=N(d[p],"nullValues/singleValue");const r=b.getElements(d[p],"AxisDescription");for(let x=0;x<r.length;x++){const F=b.getElementValue(r[x],"name"),P=b.getElementValue(r[x],"label"),A=b.getElementValues(r[x],"singleValue");if(0===A.length){var t=b.getElementValue(r[x],"min");const G=b.getElementValue(r[x],
"max"),H=Number(b.getElementValue(r[x],"res"))||1;if(null!==t&&null!==G)for(t=parseInt(t,10);t<=parseInt(G,10);t+=H)A.push(t.toString())}"band"===F.toLowerCase()&&(l=A);u.push({name:F,label:P,values:A})}k.push({name:n,label:q,nullValues:v,axis:u})}d=k={rangeSet:k,bandNames:l};f.rangeSet=d.rangeSet;k=d.bandNames;d=d.rangeSet[0].nullValues;null!=d&&d.length&&(m=O(d))}else b.isSameTagIgnoreNS(d,"domainSet")&&(l=b.getElement(d,"spatialDomain"),p=b.getElement(l,"Envelope")||b.getElement(l,"EnvelopeWithTimePeriod"),
n=p.getAttribute("srsName").split(":"),n=n[n.length-1],q=b.getElements(p,"pos"),p=b.getSpaceDelimitedNumericValues(q[0]),q=b.getSpaceDelimitedNumericValues(q[1]),n=parseInt(n,10),n=isNaN(n)?null:{wkid:n},p=new z({xmin:p[0],ymin:p[1],xmax:q[0],ymax:q[1],spatialReference:n}),n=b.getElement(l,"RectifiedGrid"),q=b.getElementValue(n,"low").split(" "),u=b.getElementValue(n,"high").split(" "),n=parseInt(u[0],10)-parseInt(q[0],10)+1,q=parseInt(u[1],10)-parseInt(q[1],10)+1,u=b.getSpaceDelimitedNumericValues(l,
"origin/pos"),v=b.getElements(l,"offsetVector"),l=parseFloat(b.getElementValue(v[0]).split(" ")[0]),v=parseFloat(b.getElementValue(v[1]).split(" ")[1]),l={envelope:p,columns:n,rows:q,offset:{x:l,y:v},origin:{x:u[0],y:u[1]}},d=(d=b.getElement(d,"temporalDomain")||b.getElement(d,"TemporalDomain"))?E(d):null,d={spatialDomain:l,temporalDomain:d},f.domainSet=d)}h=M(f.supportedInterpolations);const {name:w,description:y,label:C,lonLatEnvelope:I,supportedFormats:J}=f;({spatialDomain:g}=f.domainSet);d={x:Math.abs(g.offset.x),
y:Math.abs(g.offset.y)};l=Y(f.domainSet);m=new L({width:g.columns,height:g.rows,pixelSize:d,extent:g.envelope,spatialReference:g.envelope.spatialReference,bandCount:k.length||1,noDataValue:m,multidimensionalInfo:l});f={id:w,title:f.name,description:y||C,lonLatEnvelope:I,rasterInfo:m,bandNames:k,supportedFormats:J,supportedInterpolations:h,coverageDescription:f,version:"1.0.0",useEPSGAxis:!1}}return f});a=b.getElements(c,"CoverageDescription");return"1.1.0"===e||"1.1.1"===e||"1.1.2"===e?a.map(h=>{{var f=
[];var k=[];const n={supportedFormats:f,supportedCRSs:k,version:"1.1"};let q;for(let C=0;C<h.childNodes.length;C++){var m=h.childNodes[C];if(1===m.nodeType){var g=b.getNodeNameIgnoreNS(m).toLowerCase();switch(g){case "title":case "abstract":case "identifier":n[g]=b.getElementValue(m);break;case "supportedformat":g=b.getElementValue(m);f.includes(g)||f.push(g);break;case "supportedcrs":g=b.getElementValue(m);k.includes(g)||k.push(g);break;case "range":var d;{g=void 0;var l=!(null==(d=n.domain)||!d.temporalDomain);
const I=[];m=b.getElements(m,"Field");let J=[];for(let r=0;r<m.length;r++){const x=b.getElementValue(m[r],"Identifier"),F=b.getElementValue(m[r],"Description"),P=b.getElementValue(m[r],"Definition"),A=b.getElementValue(m[r],"Abstract"),G=b.getElementValue(m[r],"Title"),H=N(m[r],"NullValue"),ia=Q(m[r],"1.1.0"),R=[],D=b.getElements(m[r],"Axis");for(let B=0;B<D.length;B++){const S=D[B].getAttribute("identifier"),ja=b.getElementValue(D[B],"UOM"),ka=b.getElementValue(D[B],"DataType"),T=b.getElementValues(D[B],
"Key");if(!l||S.toLowerCase().includes("band"))J=T,g=H;R.push({identifier:S,uom:ja,dataType:ka,values:T,bandNoDataValues:g})}I.push({identifier:x,description:F,definition:P,abstract:A,title:G,supportedInterpolations:ia,axis:R,nullValues:H})}l={rangeSet:I,bandNames:J,bandNoDataValues:g}}g=l;n.range=g.rangeSet;l=g.bandNames;({bandNoDataValues:g}=g);null!=g&&g.length&&(q=O(g));break;case "domain":n.domain=aa(m)}}}h=M(n.range[0].supportedInterpolations);const {identifier:u,abstract:v,title:t,domain:w,
range:y}=n;d={x:Math.abs(w.spatialDomain.offset.x),y:Math.abs(w.spatialDomain.offset.y)};if(k=Z(y,w)){var p;q=y[0].nullValues;1===(null==(p=q)?void 0:p.length)&&(q=q[0])}p=new L({width:w.spatialDomain.columns,height:w.spatialDomain.rows,pixelSize:d,extent:w.spatialDomain.envelope,spatialReference:w.spatialDomain.envelope.spatialReference,bandCount:l.length||1,noDataValue:q,multidimensionalInfo:k});f={id:u,title:n.title,description:v||t,lonLatEnvelope:null,bandNames:l,rasterInfo:p,supportedFormats:f,
supportedInterpolations:h,coverageDescription:n,version:e,useEPSGAxis:w.spatialDomain.useEPSGAxis}}return f}):a.map(h=>{{var f={version:"2.0"};var k=[];let n;var m;for(let y=0;y<h.childNodes.length;y++){var g=h.childNodes[y];if(1===g.nodeType)if(b.isSameTagIgnoreNS(g,"coverageId"))f.coverageId=b.getElementValue(g);else if(b.isSameTagIgnoreNS(g,"ServiceParameters"))f.serviceParameters={supportedFormats:b.getElementValues(g,"nativeFormat")};else if(b.isSameTagIgnoreNS(g,"boundedBy"))f.boundedBy=ba(g);
else if(b.isSameTagIgnoreNS(g,"rangeType")){var d,l;k=2<(null==(d=f.boundedBy)?void 0:d.axisLabels.length)||2<(null==(l=f.domainSet)?void 0:l.axisLabels.length);g=ca(g,k);f.rangeType=g.rangeType;k=g.bandNames;n=g.bandStats;({bandNoDataValues:g}=g);null!=g&&g.length&&(m=O(g))}else if(b.isSameTagIgnoreNS(g,"domainSet")){var p;f.domainSet=fa(g,null==(p=f.boundedBy)?void 0:p.axisLabels)}else b.isSameTagIgnoreNS(g,"metadata")&&(g=b.getElement(g,"EOMetadata"),f.eoMetadata=g?ha(g):null)}const {coverageId:q,
boundedBy:u,domainSet:v,rangeType:t,serviceParameters:w}=f;h=ea(t,u,v);!n&&h&&(n=null==h?void 0:h.variables[0].statistics);null!=h&&(m=t[0][0].nilValue);m=new L({width:v.columns,height:v.rows,pixelSize:v.resolution,extent:u.envelope,spatialReference:u.envelope.spatialReference,bandCount:k.length||1,statistics:n,noDataValue:m,multidimensionalInfo:h});f={id:q,title:q,description:q,lonLatEnvelope:null,bandNames:k,rasterInfo:m,supportedFormats:w.supportedFormats,supportedInterpolations:null,coverageDescription:f,
version:"2.0.1",useEPSGAxis:!1}}return f})};K.standardizeInterpolations=M;Object.defineProperties(K,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});