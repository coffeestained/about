// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/maybe","../DimensionalDefinition"],function(m,n,u){function q(d,c,g){const e=c.shift();0===g.length&&g.push({sliceId:-1,multidimensionalDefinition:[]});const a=g.length;for(let b=0;b<a;b++){const l=g.shift().multidimensionalDefinition;e.values.forEach(f=>{g.push({sliceId:-1,multidimensionalDefinition:[...l,{variableName:d,dimensionName:e.name,values:[f]}]})})}c.length&&q(d,c,g)}function v(d,c){var g,{values:e}=c;if(null!=e&&e.length)return Array.isArray(e[0])!==Array.isArray(d)?
-1:Array.isArray(e[0])?e.findIndex(l=>l[0]===d[0]&&l[1]===d[1]):e.indexOf(d);var {extent:a}=c;if(Array.isArray(d)||d<a[0]||d>a[1])return-1;e=c.interval||1;if("ISO8601"!==c.unit)return Math.round((d-a[0])/e);a=a[0];let b=-1;switch((null==(g=c.intervalUnit)?void 0:g.toLowerCase())||"seconds"){case "seconds":b=Math.round((d-a)/1E3/e);break;case "minutes":b=Math.round((d-a)/6E4/e);break;case "hours":b=Math.round((d-a)/36E5/e);break;case "days":b=Math.round((d-a)/864E5/e);break;case "months":c=(new Date(d)).getUTCFullYear()-
(new Date(a)).getUTCFullYear();g=(new Date(a)).getUTCMonth();e=(new Date(d)).getUTCMonth();b=0===c?e-g:e+11-g+12*(c-1);break;case "years":b=Math.round(((new Date(d)).getUTCFullYear()-(new Date(a)).getUTCFullYear())/e);break;case "decades":b=Math.round(((new Date(d)).getUTCFullYear()-(new Date(a)).getUTCFullYear())/10/e)}return b}function r(d){var c,g,e,a=null==(c=d.values)?void 0:c.length;if(a)return a;const {extent:b,unit:l}=d;c=d.interval||1;a=b[1]-b[0];if("ISO8601"!==l)return Math.round(a/c);switch(null!=
(g=null==(e=d.intervalUnit)?void 0:e.toLowerCase())?g:"seconds"){case "seconds":a=Math.round(a/1E3/c);break;case "minutes":a=Math.round(a/6E4/c);break;case "hours":a=Math.round(a/36E5/c);break;case "days":a=Math.round(a/864E5/c);break;case "months":d=(new Date(b[1])).getUTCFullYear()-(new Date(b[0])).getUTCFullYear();g=(new Date(b[1][0])).getUTCMonth();e=(new Date(b[1][1])).getUTCMonth();a=0===d?e-g+1:e+11-g+12*(d-1)+1;break;case "years":a=Math.round(((new Date(b[1])).getUTCFullYear()-(new Date(b[0])).getUTCFullYear())/
c);break;case "decades":a=Math.round(((new Date(b[1])).getUTCFullYear()-(new Date(b[0])).getUTCFullYear())/10/c);break;default:a=0}return a}m.createSlices=function(d,c){const g=[];let e=0;(c?d.variables.filter(a=>a.name.toLowerCase()===c.toLowerCase()):[...d.variables].sort((a,b)=>a.name>b.name?1:-1)).forEach(a=>{const b=[],l=[...a.dimensions].sort((f,h)=>f.name>h.name?-1:1);q(a.name,l,b);b.forEach(f=>{g.push({...f,sliceId:e++})})});return g};m.getDefaultMultidimensionalDefinition=function(d,c){var g;
const {multidimensionalInfo:e,keyProperties:a}=d;if(n.isNone(e))return null;const b=null==a?void 0:a.DefaultVariable;({variables:d}=e);const l=b?null!=(g=d.find(({name:f})=>f===b))?g:d[0]:d[0];return l.dimensions.map(f=>{var h;const {values:k,extent:p}=f;let t=null!=(h=null==k?void 0:k[0])?h:p[0];"stdz"===f.name.toLowerCase()&&!f.hasRanges&&Math.abs(p[1])<=Math.abs(p[0])&&(t=null!=k&&k.length?f.values[k.length-1]:p[1]);return new u({variableName:l.name,dimensionName:f.name,values:[t],isSlice:c?!!f.hasRanges:
!0})})};m.getSliceIds=function(d,c,g){let e=d;c&&(c=[...c].sort((a,b)=>a.dimensionName<b.dimensionName?-1:1),c.forEach(({dimensionName:a,values:b,isSlice:l})=>{b.length&&(e=e.filter(f=>{f=f.multidimensionalDefinition.find(k=>k.dimensionName===a);if(null==f)return!1;const h=f.values[0];return"number"===typeof h?"number"===typeof b[0]?b.includes(h):b.some(k=>k[0]<=h&&k[1]>=h):"number"===typeof b[0]?b.some(k=>h[0]<=k&&h[1]>=k):l?b.some(k=>k[0]===h[0]&&k[0]===h[1]):b.some(k=>k[0]>=h[0]&&k[0]<=h[1]||k[1]>=
h[0]&&k[1]<=h[1]||k[0]<h[0]&&k[1]>h[1])}))}));if(e.length&&g&&n.isSome(g.start)&&n.isSome(g.end)){const a=g.start.getTime(),b=g.end.getTime(),l=e[0].multidimensionalDefinition.findIndex(f=>"StdTime"===f.dimensionName);-1<l&&(e=e.filter(f=>{f=f.multidimensionalDefinition[l].values[0];return a<=f&&b>=f}))}return e.map(a=>a.sliceId)};m.getSliceIndex=function(d,c){let g=0;var e=d[0].variableName;c=[...c.variables].sort((b,l)=>b.name>l.name?1:-1);for(var a=0;a<c.length;a++){const b=c[a],l=[...b.dimensions].sort((f,
h)=>f.name>h.name?-1:1);if(b.name!==e)g+=l.map(f=>r(f)).reduce((f,h)=>f*h);else{e=l.map(f=>r(f));c=l.length;for(let f=0;f<c;f++){a=d.find(h=>h.dimensionName===l[f].name);if(null==a)return null;a=v(a.values[0],l[f]);if(-1===a)return null;e.shift();g=f===c-1?g+a:g+a*e.reduce((h,k)=>h*k)}break}}return g};m.isMultiSliceOrRangeDefinition=function(d){return n.isNone(d)||!d.length?!1:d.some(c=>{if(null==c.values)return!0;const g=c.values.length;return 0===g||1<g||!c.isSlice&&Array.isArray(c.values[0])})};
Object.defineProperties(m,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});