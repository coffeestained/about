// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../request ../../../core/Error ../../../core/JSONSupport ../../../core/Logger ../../../core/maybe ../../../core/Promise ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../arcgisLayerUrl ../commonProperties ../RasterStorageInfo ../TileInfo ./multidimensionalUtils ./RawBlockCache ../rasterFormats/RasterCodec ../rasterFunctions/pixelUtils ../rasterFunctions/rasterProjectionHelper ../rasterFunctions/vectorFieldUtils ../../../geometry/Point ../../../geometry/Extent".split(" "),
function(A,D,C,ba,S,ca,da,w,ea,fa,E,oa,pa,qa,ha,ia,ja,ka,T,M,F,la,H,y,U,N,O){C=function(V){function P(){var a=V.apply(this,arguments)||this;a.rasterJobHandler=null;a.datasetName=null;a.datasetFormat=null;a.rasterInfo=null;a.ioConfig={sampling:"closest"};return a}A._inheritsLoose(P,V);var t=P.prototype;t.init=function(){var a=A._asyncToGenerator(function*(){const b=y.load();this.addResolvingPromise(b);yield this.when()});return function(){return a.apply(this,arguments)}}();t.normalizeCtorArgs=function(a){a&&
a.ioConfig&&(a={...a,ioConfig:{resolution:null,bandIds:null,sampling:"closest",tileInfo:T.create(),...a.ioConfig}});return a};t.open=function(){var a=A._asyncToGenerator(function*(b){throw new S("BaseRaster:open-not-implemented","open() is not implemented");});return function(b){return a.apply(this,arguments)}}();t.fetchTile=function(){var a=A._asyncToGenerator(function*(b,c,d,e={}){const f=e.tileInfo||this.rasterInfo.storageInfo.tileInfo;b=this.getTileExtentFromTileInfo(b,c,d,f);return this.fetchPixels(b,
f.size[0],f.size[1],e)});return function(b,c,d){return a.apply(this,arguments)}}();t.identify=function(){var a=A._asyncToGenerator(function*(b,c={}){var d,e;const {multidimensionalDefinition:f,timeExtent:g}=c,{hasMultidimensionalTranspose:l,multidimensionalInfo:m}=this.rasterInfo;var {transposedVariableName:h}=c;const k=w.isSome(m)&&l&&(null!=g||M.isMultiSliceOrRangeDefinition(f));k&&!h&&(h=w.isSome(f)&&0<f.length?f[0].variableName:m.variables[0].name,c={...c,transposedVariableName:h});c=this._getRequestOptionsWithSliceId(c);
const {spatialReference:r,extent:u}=this.rasterInfo;var {datumTransformation:p}=c;p=y.projectPoint(b,r,p);if(!u.intersects(p)||w.isSome(this.rasterInfo.transform)&&(p=this.rasterInfo.transform.inverseTransform(p),!this.rasterInfo.nativeExtent.intersects(p)))return{location:p,value:null};let n=0;const q=h&&w.isSome(m)&&this.rasterInfo.hasMultidimensionalTranspose;if(!q)if(c.srcResolution)n=y.snapPyramid(c.srcResolution,this.rasterInfo,this.ioConfig.sampling).pyramidLevel;else if(n=yield this.computeBestPyramidLevelForLocation(b,
c),null==n)return{location:p,value:null};b=this.identifyPixelLocation(p,n,null,q);if(null===b)return{location:p,value:null};const {row:v,col:x,rowOffset:z,colOffset:B,blockWidth:G}=b;h=null!=(d=h)?d:w.unwrap(c.sliceId);d=F.getRasterId(this.url,h);h=`${n}/${v}/${x}`;b=F.getBlock(d,null,h);w.isNone(b)&&(b=this.fetchRawTile(n,v,x,c),F.putBlock(d,null,h,b));d=yield b;return w.isNone(d)||null==(e=d.pixels)||!e.length?{location:p,value:null}:this._processIdentifyResult(d,{srcLocation:p,position:z*G+B,pyramidLevel:n,
useTransposedTile:q,requestSomeSlices:k,identifyOptions:c})});return function(b){return a.apply(this,arguments)}}();t.fetchPixels=function(){var a=A._asyncToGenerator(function*(b,c,d,e={}){b=y.snapExtent(b);e=this._getRequestOptionsWithSliceId(e);if(e.requestRawData)return this._fetchPixels(b,c,d,e);var f=y.getWorldWidth(b.spatialReference),g=y.getWorldWrapCount(b);if(w.isNone(f)||0===g||1===g&&this._isGlobalWrappableSource)return this._fetchPixels(b,c,d,e);if(3<=g)return{extent:b,pixelBlock:null};
const l=[],{xmin:m,xmax:h}=b,k=Math.round(f/(h-m)*c),r=k-Math.round((f/2-m)/(h-m)*c);let u=0;const p=[];for(let q=0;q<=g;q++){var n=new O({xmin:0===q?m:-f/2,xmax:q===g?h-f*q:f/2,ymin:b.ymin,ymax:b.ymax,spatialReference:b.spatialReference});const v=0===q?k-r:q===g?c-u:k;u+=v;p.push(v);n=e.disableWrapAround&&0<q?null:this._fetchPixels(n,v,d,e);l.push(n)}f=(yield Promise.all(l)).map(q=>null==q?void 0:q.pixelBlock);g=null;c={width:c,height:d};g=this.rasterJobHandler?(yield this.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:f,
srcMosaicSize:c,destDimension:null,coefs:null,sampleSpacing:null,interpolation:"nearest",alignmentInfo:null,blockWidths:p},e)).pixelBlock:H.mosaic(f,c,{blockWidths:p});e=y.projectExtent(b,this.rasterInfo.spatialReference,e.datumTransformation);return{extent:b,srcExtent:e,pixelBlock:g}});return function(b,c,d){return a.apply(this,arguments)}}();t.fetchRawPixels=function(){var a=A._asyncToGenerator(function*(b,c,d,e={}){c={x:Math.floor(c.x),y:Math.floor(c.y)};const f=yield this._fetchRawTiles(b,c,d,
e),{nativeExtent:g,nativePixelSize:l,storageInfo:m}=this.rasterInfo;var h=2**b,k=l.x*h;h*=l.y;k=new O({xmin:g.xmin+k*c.x,xmax:g.xmin+k*(c.x+d.width-1),ymin:g.ymax-h*(c.y+d.height-1),ymax:g.ymax-h*c.y,spatialReference:g.spatialReference});if(!f)return{extent:k,srcExtent:k,pixelBlock:null};const {pixelBlocks:r,mosaicSize:u}=f;if(1===r.length&&w.isSome(r[0])&&r[0].width===d.width&&r[0].height===d.height)return{extent:k,srcExtent:k,pixelBlock:f.pixelBlocks[0]};b={x:c.x%(0<b?m.pyramidBlockWidth:m.blockWidth),
y:c.y%(0<b?m.pyramidBlockHeight:m.blockHeight)};d=this.rasterJobHandler?(yield this.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:r,srcMosaicSize:u,destDimension:d,clipOffset:b,clipSize:d,coefs:null,sampleSpacing:null,interpolation:e.interpolation,alignmentInfo:null,blockWidths:null},e)).pixelBlock:H.mosaic(r,u,{clipOffset:b,clipSize:d});return{extent:k,srcExtent:k,pixelBlock:d}});return function(b,c,d){return a.apply(this,arguments)}}();t.fetchRawTile=function(a,b,c,d){throw new S("BaseRaster:read-not-implemented",
"fetchRawTile() is not implemented");};t.computeExtent=function(a){return y.projectExtent(this.rasterInfo.extent,a)};t.decodePixelBlock=function(a,b){return!this.rasterJobHandler||b.useCanvas?la.decode(a,b):this.rasterJobHandler.decode({data:a,options:b})};t.request=function(){var a=A._asyncToGenerator(function*(b,c,d){var e,f;const {customFetchParameters:g}=this.ioConfig,{range:l,query:m,headers:h}=c;d=null!=(e=null!=(f=d)?f:c.retryCount)?e:this.ioConfig.retryCount;e=l?{Range:`bytes=${l.from}-${l.to}`}:
null;try{return yield ba(b,{...c,query:{...m,...g},headers:{...h,...e}})}catch(k){if(0<d)return d--,this.request(b,c,d);throw k;}});return function(b,c,d){return a.apply(this,arguments)}}();t.getSliceIndex=function(a){const {multidimensionalInfo:b}=this.rasterInfo;return w.isNone(b)||w.isNone(a)||0===a.length?null:M.getSliceIndex(a,b)};t.getTileExtentFromTileInfo=function(a,b,c,d){a=d.lodAt(a);return this.getTileExtent({x:a.resolution,y:a.resolution},b,c,d.origin,d.spatialReference,d.size)};t.updateTileInfo=
function(){const {storageInfo:a,spatialReference:b,extent:c,pixelSize:d}=this.rasterInfo;if(!a.tileInfo){const f=[];var e=a.maximumPyramidLevel||0;let g=Math.max(d.x,d.y),l=1/.0254*96*g;for(let m=0;m<=e;m++)f.push({level:e-m,resolution:g,scale:l}),g*=2,l*=2;e=new N({x:c.xmin,y:c.ymax,spatialReference:b});a.tileInfo=new T({origin:e,size:[a.blockWidth,a.blockHeight],spatialReference:b,lods:f});a.isVirtualTileInfo=!0}};t.createRemoteDatasetStorageInfo=function(a,b=512,c=512,d){const {width:e,height:f,
nativeExtent:g,pixelSize:l,spatialReference:m}=a,h=new N({x:g.xmin,y:g.ymax,spatialReference:m});null==d&&(d=Math.max(0,Math.round(Math.log(Math.max(e,f))/Math.LN2-8)));const k=this.computeBlockBoundary(g,512,512,{x:g.xmin,y:g.ymax},[l],d);a.storageInfo=new ka({blockWidth:b,blockHeight:c,pyramidBlockWidth:b,pyramidBlockHeight:c,origin:h,firstPyramidLevel:1,maximumPyramidLevel:d,blockBoundary:k})};t.computeBestPyramidLevelForLocation=function(){var a=A._asyncToGenerator(function*(b,c){return 0});return function(b){return a.apply(this,
arguments)}}();t.computeBlockBoundary=function(a,b,c,d,e,f=0,g=2){if(1===e.length&&0<f){e=[...e];let {x:h,y:k}=e[0];for(let r=0;r<f;r++)h*=g,k*=g,e.push({x:h,y:k})}f=[];const {x:l,y:m}=d;for(d=0;d<e.length;d++){const {x:h,y:k}=e[d];f.push({minCol:Math.floor((a.xmin-l+.1*h)/b/h),maxCol:Math.floor((a.xmax-l-.1*h)/b/h),minRow:Math.floor((m-a.ymax+.1*k)/c/k),maxRow:Math.floor((m-a.ymin-.1*k)/c/k)})}return f};t.getPyramidPixelSize=function(a){const {nativePixelSize:b}=this.rasterInfo,{pyramidResolutions:c,
pyramidScalingFactor:d}=this.rasterInfo.storageInfo;if(0===a)return b;if(w.isSome(c)&&c.length)return c[a-1];a=d**a;return{x:b.x*a,y:b.y*a}};t.identifyPixelLocation=function(a,b,c,d){const {spatialReference:e,nativeExtent:f,storageInfo:g}=this.rasterInfo,{maximumPyramidLevel:l,origin:m,transposeInfo:h}=g,k=d&&w.isSome(h)?h.tileSize[0]:g.blockWidth;d=d&&w.isSome(h)?h.tileSize[1]:g.blockHeight;a=y.projectPoint(a,e,c);if(!f.intersects(a)||0>b||b>l)return null;c=this.getPyramidPixelSize(b);const {x:r,
y:u}=c;c=(m.y-a.y)/u/d;const p=(a.x-m.x)/r/k;return{pyramidLevel:b,row:Math.floor(c),col:Math.floor(p),rowOffset:Math.min(d-1,Math.floor((c-Math.floor(c))*d)),colOffset:Math.min(k-1,Math.floor((p-Math.floor(p))*k)),blockWidth:k,srcLocation:a}};t.getTileExtent=function(a,b,c,d,e,f){const [g,l]=f;c=d.x+c*g*a.x;b=d.y-b*l*a.y;return new O({xmin:c,xmax:c+g*a.x,ymin:b-l*a.y,ymax:b,spatialReference:e})};t.getBlockWidthHeight=function(a){return{blockWidth:0<a?this.rasterInfo.storageInfo.pyramidBlockWidth:
this.rasterInfo.storageInfo.blockWidth,blockHeight:0<a?this.rasterInfo.storageInfo.pyramidBlockHeight:this.rasterInfo.storageInfo.blockHeight}};t.isBlockOutside=function(a,b,c){a=this.rasterInfo.storageInfo.blockBoundary[a];return!a||a.maxRow<b||a.maxCol<c||a.minRow>b||a.minCol>c};t._fetchPixels=function(){var a=A._asyncToGenerator(function*(b,c,d,e={}){var f=y.getWorldWrapCount(b);if(2<=f)return{extent:b,pixelBlock:null};var g=this._getSourceDataInfo(b,c,d,e);const {pyramidLevel:l,pyramidResolution:m,
srcResolution:h,srcExtent:k,srcWidth:r,srcHeight:u}=g;if(0===r||0===u)return{extent:b,srcExtent:k,pixelBlock:null};var p=w.unwrap(this.rasterInfo.transform),n="gcs-shift"===(null==p?void 0:p.type),q=w.isSome(y.getWorldWidth(b.spatialReference));if(n||!q)f=y.getWorldWrapCount(g.srcExtent,n);var v=this.rasterInfo.storageInfo,x={x:Math.floor((k.xmin-v.origin.x)/m.x+.1),y:Math.floor((v.origin.y-k.ymax)/m.y+.1)};g=yield this._fetchRawTiles(l,x,{width:r,height:u,wrapCount:f},e);if(!g)return{extent:b,srcExtent:k,
pixelBlock:null};n=0<l?v.pyramidBlockWidth:v.blockWidth;const z=0<l?v.pyramidBlockHeight:v.blockHeight,B=n===r&&z===u&&0===x.x%n&&0===x.y%z;x=new N({x:(b.xmax-b.xmin)/c,y:(b.ymax-b.ymin)/d,spatialReference:b.spatialReference});const G=!b.spatialReference.equals(this.rasterInfo.spatialReference);({datumTransformation:v}=e);if(!G&&B&&1===g.pixelBlocks.length&&n===c&&z===d&&h.x===x.x&&h.y===x.y)return{extent:b,srcExtent:k,pixelBlock:g.pixelBlocks[0]};n=q&&w.isSome(y.getWorldWidth(k.spatialReference));
(q=e.requestProjectedLocalDirections&&this.rasterInfo.dataType.startsWith("vector"))&&!this.rasterJobHandler&&(yield y.load());f=this.rasterJobHandler?yield this.rasterJobHandler.getProjectionOffsetGrid({projectedExtent:b,srcBufferExtent:g.extent,pixelSize:x.toJSON(),datumTransformation:v,rasterTransform:p,hasWrapAround:0<f||n,isAdaptive:!1!==this.ioConfig.optimizeProjectionAccuracy,includeGCSGrid:q},e):y.getProjectionOffsetGrid({projectedExtent:b,srcBufferExtent:g.extent,pixelSize:x,datumTransformation:v,
rasterTransform:p,hasWrapAround:0<f||n,isAdaptive:!1,includeGCSGrid:q});p=!e.requestRawData;n={rows:f.spacing[0],cols:f.spacing[1]};x=w.unwrap(this._getRasterTileAlignmentInfo(l,g.extent.xmin));const {pixelBlocks:I,mosaicSize:J,isPartiallyFilled:Q}=g;g=null;this.rasterJobHandler?(c=yield this.rasterJobHandler.mosaicAndTransform({srcPixelBlocks:I,srcMosaicSize:J,destDimension:p?{width:c,height:d}:null,coefs:p?f.coefficients:null,sampleSpacing:p?n:null,projectDirections:q,gcsGrid:q?f.gcsGrid:null,isUV:"vector-uv"===
this.rasterInfo.dataType,interpolation:e.interpolation,alignmentInfo:x,blockWidths:null},e),{pixelBlock:p,localNorthDirections:g}=c):(x=H.mosaic(I,J,{alignmentInfo:x}),p=p?H.approximateTransform(x,{width:c,height:d},f.coefficients,n,e.interpolation):x,q&&f.gcsGrid&&(g=H.getLocalArithmeticNorthRotations({width:c,height:d},f.gcsGrid),p=U.convertToLocalDirections(p,this.rasterInfo.dataType,g)));return e.requestRawData||q?{srcExtent:k,pixelBlock:p,transformGrid:f,localNorthDirections:g,extent:b,isPartiallyFilled:Q}:
{srcExtent:k,extent:b,pixelBlock:p}});return function(b,c,d){return a.apply(this,arguments)}}();t._fetchRawTiles=function(){var a=A._asyncToGenerator(function*(b,c,d,e){const {origin:f,blockBoundary:g}=this.rasterInfo.storageInfo,{blockWidth:l,blockHeight:m}=this.getBlockWidthHeight(b);let {x:h,y:k}=c,{width:r,height:u,wrapCount:p}=d;var n=this._getRasterTileAlignmentInfo(b,0);e.buffer&&(h-=e.buffer.cols,k-=e.buffer.rows,r+=2*e.buffer.cols,u+=2*e.buffer.rows);var q=0,v=0;let x=0;p&&w.isSome(n)&&({worldColumnCountFromOrigin:v,
originColumnOffset:x,rightPadding:q}=n,v*n.blockWidth-q>=h+r&&(q=0));c=Math.floor(h/l);d=Math.floor(k/m);const z=Math.floor((h+r+q-1)/l);q=Math.floor((k+u+q-1)/m);var B=g[b];if(!B)return null;const {minRow:G,minCol:I,maxCol:J,maxRow:Q}=B;if(0===p&&(q<G||z<I||d>Q||c>J))return null;B=[];let W=!1;const ma=null==this.ioConfig.allowPartialFill?e.allowPartialFill:this.ioConfig.allowPartialFill;for(let K=d;K<=q;K++)for(let L=c;L<=z;L++){let R=L;!e.disableWrapAround&&p&&w.isSome(n)&&v<=L&&(R=L-v-x);if(K>=
G&&R>=I&&Q>=K&&J>=R){const X=this._fetchRawTile(b,K,R,e);ma?B.push(new Promise(Y=>{X.then(na=>Y(na)).catch(()=>{W=!0;Y(null)})})):B.push(X)}else B.push(null)}if(0===B.length)return null;e=yield Promise.all(B);n={height:(q-d+1)*m,width:(z-c+1)*l};({spatialReference:v}=this.rasterInfo);b=this.getPyramidPixelSize(b);const {x:Z,y:aa}=b;return{extent:new O({xmin:f.x+c*l*Z,xmax:f.x+(z+1)*l*Z,ymin:f.y-(q+1)*m*aa,ymax:f.y-d*m*aa,spatialReference:v}),pixelBlocks:e,mosaicSize:n,isPartiallyFilled:W}});return function(b,
c,d,e){return a.apply(this,arguments)}}();t._fetchRawTile=function(a,b,c,d){var e=this.rasterInfo.storageInfo.blockBoundary[a];if(!e)return Promise.resolve(null);const {minRow:f,minCol:g,maxCol:l,maxRow:m}=e;if(b<f||c<g||b>m||c>l)return Promise.resolve(null);const h=F.getRasterId(this.url,d.sliceId),k=`${a}/${b}/${c}`;e=F.getBlock(h,d.registryId,k);if(w.isNone(e)){const r=new AbortController;e=this.fetchRawTile(a,b,c,{...d,signal:r.signal});F.putBlock(h,d.registryId,k,e,r);e.catch(()=>F.deleteBlock(h,
d.registryId,k))}if(d.signal)fa.onAbort(d,()=>{F.decreaseRefCount(h,d.registryId,k)});return e};t._computeMagDirValues=function(a){var b;const {bandCount:c,dataType:d}=this.rasterInfo;if((2!==c||"vector-magdir"!==d)&&"vector-uv"!==d||2!==(null==a?void 0:a.length)||null==(b=a[0])||!b.length)return null;b=a[0].length;if("vector-magdir"===d)return b=a[1].map(l=>(l+360)%360),[a[0],b];const [e,f]=a;a=[];const g=[];for(let l=0;l<b;l++){const [m,h]=U.uvComponentToVector([e[l],f[l]]);a.push(m);g.push(h)}return[a,
g]};t._getRasterTileAlignmentInfo=function(a,b){null==this._rasterTileAlighmentInfo&&(this._rasterTileAlighmentInfo=y.getRasterDatasetAlignmentInfo(this.rasterInfo));return w.isNone(this._rasterTileAlighmentInfo.pyramidsInfo)?null:{startX:b,halfWorldWidth:this._rasterTileAlighmentInfo.halfWorldWidth,hasGCSSShiftTransform:this._rasterTileAlighmentInfo.hasGCSSShiftTransform,...this._rasterTileAlighmentInfo.pyramidsInfo[a]}};t._getSourceDataInfo=function(a,b,c,d={}){const e={datumTransformation:d.datumTransformation,
pyramidLevel:0,pyramidResolution:null,srcExtent:null,srcHeight:0,srcResolution:null,srcWidth:0};d.srcResolution&&(e.srcResolution=d.srcResolution,this._updateSourceDataInfo(a,e));var f=this.rasterInfo.storageInfo.maximumPyramidLevel||0;const {srcWidth:g,srcHeight:l,pyramidLevel:m}=e;var h=g/b;const k=l/c,r=m<f&&16<=h*k;if(r||m===f&&(8<h||8<k)||0===g||0===l){var u=new N({x:(a.xmax-a.xmin)/b,y:(a.ymax-a.ymin)/c,spatialReference:a.spatialReference});u=y.projectResolution(u,this.rasterInfo.spatialReference,
a,e.datumTransformation);const p=!u||d.srcResolution&&u.x+u.y<d.srcResolution.x+d.srcResolution.y;r&&d.srcResolution&&p&&(h=Math.round(Math.log(Math.max(h,k))/Math.LN2)-1,f-m+3>=h&&(f=2**h,u={x:d.srcResolution.x*f,y:d.srcResolution.y*f}));u&&(e.srcResolution=u,this._updateSourceDataInfo(a,e))}if(8<e.srcWidth/b||8<e.srcHeight/c)e.srcWidth=0,e.srcHeight=0;return e};t._updateSourceDataInfo=function(a,b){b.srcWidth=0;b.srcHeight=0;var c=this.rasterInfo.spatialReference;const {srcResolution:d,datumTransformation:e}=
b,{pyramidLevel:f,pyramidResolution:g,excessiveReading:l}=y.snapPyramid(d,this.rasterInfo,this.ioConfig.sampling);l||(a=b.srcExtent||y.projectExtent(a,c,e),null!=a&&((c=w.unwrap(this.rasterInfo.transform))&&(a=c.inverseTransform(a)),b.srcExtent=a,c=Math.ceil((a.xmax-a.xmin)/g.x-.1),a=Math.ceil((a.ymax-a.ymin)/g.y-.1),b.pyramidLevel=f,b.pyramidResolution=g,b.srcWidth=c,b.srcHeight=a))};t._getRequestOptionsWithSliceId=function(a){w.isSome(this.rasterInfo.multidimensionalInfo)&&null==a.sliceId&&(a={...a,
sliceId:this.getSliceIndex(a.multidimensionalDefinition)});return a};t._processIdentifyResult=function(a,b){const {srcLocation:c,position:d,pyramidLevel:e,useTransposedTile:f}=b,g=a.pixels[0].length/a.width/a.height;if(a.mask&&!a.mask[d])return{location:c,value:null};const {multidimensionalInfo:l}=this.rasterInfo;if(w.isNone(l)||!f)return b=a.pixels.map(n=>n[d]),a={location:c,value:b,pyramidLevel:e},b=this._computeMagDirValues(b.map(n=>[n])),null!=b&&b.length&&(a.magdirValue=b.map(n=>n[0])),a;let m=
a.pixels.map(n=>Array.prototype.slice.call(n,d*g,d*g+g)),h=this._computeMagDirValues(m);const {requestSomeSlices:k,identifyOptions:r}=b;let u=M.createSlices(l,r.transposedVariableName);if(k){var p;const n=M.getSliceIds(u,w.unwrap(r.multidimensionalDefinition),w.unwrap(r.timeExtent));m=m.map(q=>n.map(v=>q[v]));h=null==(p=h)?void 0:p.map(q=>n.map(v=>q[v]));u=n.map(q=>u[q])}a=u.map((n,q)=>{var v;const x={value:m.map(z=>z[q]),multidimensionalDefinition:n.multidimensionalDefinition,variableName:n.multidimensionalDefinition[0].variableName,
dimensionValues:{}};null!=(v=h)&&v.length&&(x.magdirValue=[h[0][q],h[1][q]]);n.multidimensionalDefinition.forEach(z=>x.dimensionValues[z.dimensionName]=z.values[0]);return x});return{location:c,value:null,dataSeries:a,pyramidLevel:e}};A._createClass(P,[{key:"_isGlobalWrappableSource",get:function(){const {rasterInfo:a}=this,b=y.getWorldWidth(a.spatialReference);return w.isSome(b)&&a.extent.width>=b/2}},{key:"url",set:function(a){this._set("url",ia.sanitizeUrl(a,da.getLogger(this.declaredClass)))}}]);
return P}(ea.EsriPromiseMixin(ca.JSONSupport));D.__decorate([E.property()],C.prototype,"_rasterTileAlighmentInfo",void 0);D.__decorate([E.property({readOnly:!0})],C.prototype,"_isGlobalWrappableSource",null);D.__decorate([E.property(ja.url)],C.prototype,"url",null);D.__decorate([E.property({type:String,json:{write:!0}})],C.prototype,"datasetName",void 0);D.__decorate([E.property({type:String,json:{write:!0}})],C.prototype,"datasetFormat",void 0);D.__decorate([E.property()],C.prototype,"rasterInfo",
void 0);D.__decorate([E.property()],C.prototype,"ioConfig",void 0);D.__decorate([E.property()],C.prototype,"sourceJSON",void 0);return C=D.__decorate([ha.subclass("esri.layers.support.rasterDatasets.BaseRaster")],C)});