// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../core/lang ./RasterFunction ./rasterFunctionUtils ../../renderers/support/colorRampUtils ../../renderers/support/stretchRendererUtils ../../renderers/visualVariables/SizeVariable".split(" "),function(v,B,l,H,w,I,J){function C(a,b){for(const c in a)"raster"===c.toLowerCase()&&("RasterFunctionVariable"===a[c].type?(a[c]=b.rasterFunctionDefinition,a[c].type="RasterFunctionTemplate"):"RasterFunctionTemplate"===a[c].type&&C(a[c].arguments,b))}function q(a){const b=B.clone(H.schema[a.functionName+
"Function"]);a=a.functionArguments;for(const c in a)"raster"===c.toLowerCase()?(b.arguments[c]=q(a[c]),b.arguments[c].type="RasterFunctionTemplate"):"colormap"===c.toLowerCase()?(b.arguments[c].value=K(a[c]),b.arguments.ColorSchemeType.value=0):b.arguments[c].value=a[c];return b}function D(a){const b=a.Raster;return b&&"esri.layers.support.RasterFunction"===b.declaredClass?D(b.functionArguments):a}function L(a,b){const c=new l;c.functionName="VectorFieldRenderer";const {dataType:f,bandProperties:e}=
b,d="vector-uv"===f?!0:!1;let m,h;e&&2===e.length&&(m=e.map(k=>k.BandName.toLowerCase()).indexOf("magnitude"),h=e.map(k=>k.BandName.toLowerCase()).indexOf("direction"));if(-1===m||null===m)m=0,h=1;const r="arithmetic"===a.rotationType?1:2,x="flow-from"===a.flowRepresentation?0:1,p=a.visualVariables?a.visualVariables.find(k=>"Magnitude"===k.field):new J;a={magnitudeBandID:m,directionBandID:h,isUVComponents:d,referenceSystem:r,massFlowAngleRepresentation:x,symbolTileSize:50,symbolTileSizeUnits:100,
calculationMethod:"Vector Average",symbologyName:M[a.style.toLowerCase().replace("-","_")],minimumMagnitude:p.minDataValue,maximumMagnitude:p.maxDataValue,minimumSymbolSize:p.minSize,maximumSymbolSize:p.maxSize};c.functionArguments=a;return b.convertToRFT?new l({rasterFunctionDefinition:q(c)}):c}function N(a,b){const c=b.convertToRFT,f=new l;f.functionName="Stretch";var e=y[I.stretchTypeJSONDict.toJSON(a.stretchType)],d=O(a.statistics);d={StretchType:e,Statistics:d,DRA:a.dynamicRangeAdjustment,UseGamma:a.useGamma,
Gamma:a.gamma,ComputeGamma:a.computeGamma};null!=a.outputMin&&(d.Min=a.outputMin);null!=a.outputMax&&(d.Max=a.outputMax);e===y.standardDeviation?(d.NumberOfStandardDeviations=a.numberOfStandardDeviations,f.outputPixelType="u8"):e===y.percentClip?(d.MinPercent=a.minPercent,d.MaxPercent=a.maxPercent,f.outputPixelType="u8"):e===y.minMax?f.outputPixelType="u8":e===y.sigmoid&&(d.SigmoidStrengthLevel=a.sigmoidStrengthLevel);f.functionArguments=d;f.variableName="Raster";if(a.colorRamp){d=a.colorRamp;e=new l;
if(c)e.functionArguments={ColorRamp:w.getRFxArgColorRampValue(d)};else{const h=w.getColorRampName(d);if(h)e.functionArguments={colorRamp:h};else if(!b.convertColorRampToColormap||"algorithmic"!==d.type&&"multipart"!==d.type){var m;a=a.colorRamp.toJSON();"algorithmic"===a.type?a.algorithm=a.algorithm||"esriCIELabAlgorithm":"multipart"===a.type&&null!=(m=a.colorRamps)&&m.length&&a.colorRamps.forEach(r=>r.algorithm=r.algorithm||"esriCIELabAlgorithm");e.functionArguments={colorRamp:a}}else e.functionArguments=
{Colormap:w.convertColorRampToColormap(d,256)}}e.variableName="Raster";e.functionName="Colormap";e.functionArguments.Raster=f;return c?new l({rasterFunctionDefinition:q(e)}):e}return c?new l({rasterFunctionDefinition:q(f)}):f}function P(a,b){const c=[],f=[],e=[],d=[],{pixelType:m,rasterAttributeTable:h}=b,r=h&&h.features,x=E(h);if(r&&Array.isArray(r)&&a.classBreakInfos){a.classBreakInfos.forEach((g,u)=>{const t=g.symbol.color;let z;t.a&&r.forEach(F=>{z=F.attributes[a.field];(z>=g.minValue&&z<g.maxValue||
u===a.classBreakInfos.length-1&&z>=g.minValue)&&d.push([F.attributes[x],t.r,t.g,t.b])})});var p=m?A(d,m):d,k=new l;k.functionName="Colormap";k.functionArguments={};k.functionArguments.Colormap=p;k.variableName="Raster";return b.convertToRFT?new l({rasterFunctionDefinition:q(k)}):k}a.classBreakInfos.forEach((g,u)=>{const t=g.symbol&&g.symbol.color;t.a?(0===u?c.push(g.minValue,g.maxValue+1E-6):c.push(g.minValue+1E-6,g.maxValue+1E-6),f.push(u),d.push([u,t.r,t.g,t.b])):e.push(g.minValue,g.maxValue)});
p=m?A(d,m):d;k=new l;k.functionName="Remap";k.functionArguments={InputRanges:c,OutputValues:f,NoDataRanges:e};k.variableName="Raster";const n=new l;n.functionName="Colormap";n.functionArguments={Colormap:p,Raster:k};return b.convertToRFT?new l({rasterFunctionDefinition:q(n)}):n}function A(a,b){(b=G[String(b).toLowerCase()])&&a.push([Math.floor(b[0]-1),0,0,0],[Math.ceil(b[1]+1),0,0,0]);return a}function E(a){if(a)return{fields:a}=a,(a=a&&a.find(b=>b&&b.name&&"value"===b.name.toLowerCase()))&&a.name}
function Q(a,b){var c,f;const e=[],{pixelType:d,rasterAttributeTable:m}=b;var h=m&&m.features;const r=E(m),x=null==(c=a.defaultSymbol)?void 0:null==(f=c.color)?void 0:f.toRgb();if(c=a.uniqueValueInfos)if(h){const p=new Map;c.forEach(n=>{var g;const u=n.value;n=null==(g=n.symbol.color)?void 0:g.toRgb();null!=u&&n&&p.set(String(u),n)});const k=a.field;h.forEach(({attributes:n})=>{var g=String(n[k]);n=n[r];p.has(g)?(g=p.get(g),e.push([n,...g])):x&&e.push([n,...x])})}else for(a=0;a<c.length;a++)if(f=
c[a],h=f.symbol.color,f=+f.value,null!=h&&h.a){if(isNaN(f))return null;e.push([f,h.r,h.g,h.b])}c=d&&0<e.length?A(e,d):e;a=new l;a.functionName="Colormap";a.functionArguments={};a.functionArguments.Colormap=c;a.variableName="Raster";return b.convertToRFT?new l({rasterFunctionDefinition:q(a)}):a}function O(a){const b=[];a.forEach(c=>{Array.isArray(c)?b.push(c):null!=c.min&&null!=c.max&&b.push([c.min,c.max,c.avg||0,c.stddev||0])});return b}function K(a){const b=[],c=[];a.forEach(f=>{b.push(f[0]);c.push(w.rgbaConvertTo32Bit([...f.slice(1),
255]))});return{type:"RasterColormap",values:b,colors:c}}const G={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767]},M={simple_scalar:"Simple Scalar",wind_barb:"Wind Barb",single_arrow:"Single Arrow",beaufort_kn:"Beaufort Wind (Knots)",beaufort_m:"Beaufort Wind (MetersPerSecond)",ocean_current_m:"Ocean Current (MetersPerSecond)",ocean_current_kn:"Ocean Current (Knots)"},R=new Set("raster-stretch unique-value class-breaks raster-shaded-relief vector-field raster-colormap".split(" ")),
y={none:0,standardDeviation:3,histogramEqualization:4,minMax:5,percentClip:6,sigmoid:9};v.combineRenderingRules=function(a,b){if(!a||!b)return B.clone(a||b);a=B.clone(a);if(b.rasterFunctionDefinition){const c=b.rasterFunctionDefinition;if(c.thumbnail||c.thumbnailEx)c.thumbnail=c.thumbnailEx=null;C(a.rasterFunctionDefinition.arguments,b)}else"none"!==b.functionName.toLowerCase()&&(D(a.functionArguments).Raster=b);return a};v.convertRendererToRenderingRule=function(a,b){b=b||{};switch(a.type){case "raster-stretch":return N(a,
b);case "class-breaks":return P(a,b);case "unique-value":return Q(a,b);case "raster-colormap":var c=b;(b=a.extractColormap())&&0!==b.length?({pixelType:a}=c,a=a?A(b,a):b,b=new l,b.functionName="Colormap",b.functionArguments={},b.functionArguments.Colormap=a,a=c.convertToRFT?new l({rasterFunctionDefinition:q(b)}):b):a=void 0;return a;case "vector-field":return L(a,b);case "raster-shaded-relief":c=b.convertToRFT;if("elevation"!==b.dataType)a=new l;else{b=new l;b.functionName="Hillshade";var f="traditional"===
a.hillshadeType?0:1,e="none"===a.scalingType?1:3,d={HillshadeType:f,SlopeType:e,ZFactor:a.zFactor};0===f&&(d.Azimuth=a.azimuth,d.Altitude=a.altitude);3===e&&(d.PSPower=a.pixelSizePower,d.PSZFactor=a.pixelSizeFactor);b.functionArguments=d;b.variableName="Raster";a.colorRamp&&(b.functionName="ShadedRelief",c?d.ColorRamp=w.getRFxArgColorRampValue(a.colorRamp):d.Colormap=w.convertColorRampToColormap(a.colorRamp,256));a=c?new l({rasterFunctionDefinition:q(b)}):b}return a;case "flow":throw Error("Unsupported rendering rule.");
}};v.convertRenderingRuleToRFT=q;v.isSupportedRendererType=function(a){return R.has(a.type)};v.pixelTypeRanges=G;Object.defineProperties(v,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});