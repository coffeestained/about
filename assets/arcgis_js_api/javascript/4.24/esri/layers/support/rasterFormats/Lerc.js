// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../assets"],function(R,G,S){function z(h,n,e){e.set(h.slice(n,n+e.length))}function T(h){const {_malloc:n,_free:e,_lerc_getBlobInfo:r,_lerc_getDataRanges:K,_lerc_decode_4D:L,asm:J}=h;let f;const x=Object.values(J).find(a=>a&&"buffer"in a&&a.buffer===h.HEAPU8.buffer),A=a=>{a=a.map(k=>(k>>3<<3)+16);var d=a.reduce((k,m)=>k+m),l=n(d);f=new Uint8Array(x.buffer);d=a[0];a[0]=l;for(l=1;l<a.length;l++){const k=a[l];a[l]=a[l-1]+d;d=k}return a};H.getBlobInfo=a=>{var d=new Uint8Array(48),
l=new Uint8Array(24);const [k,m,t]=A([a.length,d.length,l.length]);f.set(a,k);f.set(d,m);f.set(l,t);var b=r(k,a.length,m,t,12,3);if(b)throw e(k),`lerc-getBlobInfo: error code is ${b}`;f=new Uint8Array(x.buffer);z(f,m,d);z(f,t,l);d=new Uint32Array(d.buffer);var c=new Float64Array(l.buffer);const [p,q,g,v,y,w,B,C,I,,E]=d;l={version:p,dimCount:g,width:v,height:y,validPixelCount:B,bandCount:w,blobSize:C,maskCount:I,dataType:q,minValue:c[0],maxValue:c[1],maxZerror:c[2],statistics:[],bandCountWithNoData:E};
if(E)return l;if(1===g&&1===w)return e(k),l.statistics.push({minValue:c[0],maxValue:c[1]}),l;b=g*w*8;var u=new Uint8Array(b),F=new Uint8Array(b);d=k;var D=c=0;let M=!1;f.byteLength<k+2*b?(e(k),M=!0,[d,c,D]=A([a.length,b,b]),f.set(a,d)):[c,D]=A([b,b]);f.set(u,c);f.set(F,D);if(b=K(d,a.length,g,w,c,D))throw e(d),M||e(c),`lerc-getDataRanges: error code is ${b}`;f=new Uint8Array(x.buffer);z(f,c,u);z(f,D,F);a=new Float64Array(u.buffer);b=new Float64Array(F.buffer);F=l.statistics;for(u=0;u<w;u++)if(1<g){D=
a.slice(u*g,(u+1)*g);const O=b.slice(u*g,(u+1)*g),U=Math.min.apply(null,D),V=Math.max.apply(null,O);F.push({minValue:U,maxValue:V,dimStats:{minValues:D,maxValues:O}})}else F.push({minValue:a[u],maxValue:b[u]});e(d);M||e(c);return l};H.decode=(a,d)=>{const {maskCount:l,dimCount:k,bandCount:m,width:t,height:b,dataType:c,bandCountWithNoData:p}=d;var q=P[c],g=t*b;d=new Uint8Array(g*m);q=new Uint8Array(g*k*m*q.size);g=new Uint8Array(m);var v=new Uint8Array(8*m);const [y,w,B,C,I]=A([a.length,d.length,q.length,
g.length,v.length]);f.set(a,y);f.set(d,w);f.set(q,B);f.set(g,C);f.set(v,I);if(a=L(y,a.length,l,w,k,t,b,m,c,B,C,I))throw e(y),`lerc-decode: error code is ${a}`;f=new Uint8Array(x.buffer);z(f,B,q);z(f,w,d);a=null;if(p){z(f,C,g);z(f,I,v);a=[];v=new Float64Array(v.buffer);for(let E=0;E<g.length;E++)a.push(g[E]?v[E]:null)}e(y);return{data:q,maskData:d,noDataValues:a}}}const P=[{pixelType:"S8",size:1,ctor:Int8Array,range:[-128,128]},{pixelType:"U8",size:1,ctor:Uint8Array,range:[0,255]},{pixelType:"S16",
size:2,ctor:Int16Array,range:[-32768,32767]},{pixelType:"U16",size:2,ctor:Uint16Array,range:[0,65536]},{pixelType:"S32",size:4,ctor:Int32Array,range:[-2147483648,2147483647]},{pixelType:"U32",size:4,ctor:Uint32Array,range:[0,4294967296]},{pixelType:"F32",size:4,ctor:Float32Array,range:[-3.4027999387901484E38,3.4027999387901484E38]},{pixelType:"F64",size:8,ctor:Float64Array,range:[-1.7976931348623157E308,1.7976931348623157E308]}];let N=null,Q=!1;const H={getBlobInfo:null,decode:null};G.decode=function(h,
n={}){var e,r=null!=(e=n.inputOffset)?e:0;e=h instanceof Uint8Array?h.subarray(r):new Uint8Array(h,r);h=H.getBlobInfo(e);const {data:K,maskData:L}=H.decode(e,h),{width:J,height:f,bandCount:x,dimCount:A,dataType:a,maskCount:d,statistics:l}=h;e=P[a];var k=new e.ctor(K.buffer);r=[];const m=[],t=J*f;var b=t*A;for(var c=0;c<x;c++){var p=k.subarray(c*b,(c+1)*b);if(n.returnPixelInterleavedDims)r.push(p);else{a:{var q=t,g=A;if(2>g)break a;const v=new e.ctor(q*g);for(let y=0,w=0;y<q;y++)for(let B=0,C=y;B<
g;B++,C+=q)v[C]=p[w++];p=v}r.push(p)}m.push(L.subarray(c*b,(c+1)*b))}k=0===d?null:1===d?m[0]:new Uint8Array(t);if(1<d)for(k.set(m[0]),b=1;b<m.length;b++)for(c=m[b],p=0;p<t;p++)k[p]&=c[p];({noDataValue:b}=n);c=null!=b&&e.range[0]<=b&&e.range[1]>=b;if(0<d&&c)for(c=0;c<x;c++)for(p=r[c],q=m[c]||k,g=0;g<t;g++)0===q[g]&&(p[g]=b);return{width:J,height:f,bandCount:x,pixelType:n.pixelType&&0===h.version?n.pixelType:e.pixelType,dimCount:A,statistics:l,pixels:r,mask:k,bandMasks:d===x&&1<x?m:null}};G.getBlobInfo=
function(h,n={}){var e,r;h=h instanceof Uint8Array?h.subarray(null!=(e=n.inputOffset)?e:0):new Uint8Array(h,null!=(r=n.inputOffset)?r:0);return H.getBlobInfo(h)};G.isLoaded=function(){return Q};G.load=function(){return N?N:N=(new Promise((h,n)=>R(["../../../chunks/lerc-wasm"],h,n))).then(h=>h.lercWasm).then(({default:h})=>h({locateFile:n=>S.getAssetUrl(`esri/layers/support/rasterFormats/${n}`)})).then(h=>{T(h);Q=!0})};Object.defineProperties(G,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});