// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../PixelBlock ./ImageCanvasDecoder ./JpgPlus ./Lerc ./Lzw ../../../chunks/Zlib ./Raw ./TiffDecoder ./utils".split(" "),function(B,A,y,w,M,N,H,O,I,P,J,Q){function R(a,d){return C.apply(this,arguments)}function C(){C=A._asyncToGenerator(function*(a,d){var m;if(!Q.isPlatformLittleEndian)throw new y("rasterCoded:decode","lerc decoder is not supported on big endian platform");yield H.load();const {offset:l,noDataValue:q}=d;let b=
null==(m=d.pixelType)?void 0:m.toUpperCase();b&&!S.has(b)&&(b=null);const {width:f,height:e,pixelType:c,statistics:g,pixels:h,mask:k}=H.decode(a,{inputOffset:l,noDataValue:q,pixelType:b,returnPixelInterleavedDims:d.returnPixelInterleavedDims});return new w({width:f,height:e,pixelType:c.toLowerCase(),pixels:h,mask:k,statistics:g})});return C.apply(this,arguments)}function T(a,d){return D.apply(this,arguments)}function D(){D=A._asyncToGenerator(function*(a,d){a=yield J.decode(a,d);a=new w({width:a.width,
height:a.height,pixels:a.pixels,pixelType:a.pixelType.toLowerCase(),mask:a.mask,statistics:null});a.updateStatistics();return a});return D.apply(this,arguments)}function U(a,d){return E.apply(this,arguments)}function E(){E=A._asyncToGenerator(function*(a,d){a=yield J.decodeTileOrStrip(a,d.customOptions);a=new w({width:a.width,height:a.height,pixels:a.pixels,pixelType:a.pixelType.toLowerCase(),mask:a.mask,statistics:null});a.updateStatistics();return a});return E.apply(this,arguments)}function K(a,
d){const m=d.pixelType||"u8",l=w.getPixelArrayConstructor(m),q="u8"===m?a:new l(a.buffer),b=[],f=d.planes||1;if(1===f)b.push(q);else for(let e=0;e<f;e++){const c=(d.width||1)*(d.height||a.length),g=new l(c);for(let h=0;h<c;h++)g[h]=q[h*f+e];b.push(g)}a=new w({width:d.width||1,height:d.height||a.length,pixels:b,pixelType:m,statistics:null});a.updateStatistics();return a}function V(a,d){a=(new I.Zlib(new Uint8Array(a))).getBytes();return K(a,d)}function W(a,d){a=O.decode(a,d.offset,d.eof,!d.isInputBigEndian);
return K(a,d)}function X(a,d){a=N.decode(a,d.hasNoZlibMask);a=new w({width:a.width,height:a.height,pixels:a.pixels,pixelType:"U8",mask:a.mask,statistics:null});a.updateStatistics();return a}function Y(a,d){a=new Uint8Array(a);a=new Z(a);const {width:m,height:l}=d;d=m*l;a=a.decode();let q=0;var b=0;let f;b=new Uint8Array(d);for(q=0;q<d;q++)b[q]=a[4*q+3];const e=new w({width:m,height:l,pixels:[],pixelType:"U8",mask:b,statistics:[]});for(q=0;3>q;q++){f=new Uint8Array(d);for(b=0;b<d;b++)f[b]=a[4*b+q];
e.addData({pixels:f})}e.updateStatistics();return e}function aa(a,d,m,l){return F.apply(this,arguments)}function F(){F=A._asyncToGenerator(function*(a,d,m,l){a=yield(new M).decode(a,{applyJpegMask:!1,format:d,...m},l);a=new w(a);a.updateStatistics();return a});return F.apply(this,arguments)}function L(a){if(null==a)throw new y("rasterCodec:decode","parameter encodeddata is required.");a=new Uint8Array(a,0,10);let d="";255===a[0]&&216===a[1]?d="jpg":137===a[0]&&80===a[1]&&78===a[2]&&71===a[3]?d="png":
67===a[0]&&110===a[1]&&116===a[2]&&90===a[3]&&73===a[4]&&109===a[5]&&97===a[6]&&103===a[7]&&101===a[8]&&32===a[9]?d="lerc":76===a[0]&&101===a[1]&&114===a[2]&&99===a[3]&&50===a[4]&&32===a[5]?d="lerc2":73===a[0]&&73===a[1]&&42===a[2]&&0===a[3]||77===a[0]&&77===a[1]&&0===a[2]&&42===a[3]||73===a[0]&&73===a[1]&&43===a[2]&&0===a[3]||77===a[0]&&77===a[1]&&0===a[2]&&43===a[3]?d="tiff":71===a[0]&&73===a[1]&&70===a[2]?d="gif":66===a[0]&&77===a[1]?d="bmp":String.fromCharCode.apply(null,a).toLowerCase().includes("error")&&
(d="error");return d}function ba(a){let d=null;switch(a){case "lerc":case "lerc2":d=R;break;case "jpg":d=X;break;case "png":d=Y;break;case "bsq":case "bip":d=(m,l)=>{{var q=l.pixelType;var b=null;let f=null;switch(q?q.toLowerCase():"f32"){case "u1":case "u2":case "u4":case "u8":f=255;b=Uint8Array;break;case "u16":f=f||65535;b=Uint16Array;break;case "u32":f=f||2**32-1;b=Uint32Array;break;case "s8":f=f||-128;b=Int8Array;break;case "s16":f=f||-32768;b=Int16Array;break;case "s32":f=f||-(2**31);b=Int32Array;
break;default:b=Float32Array}q={pixelTypeCtor:b,noDataValue:f}}({pixelTypeCtor:q}=q);b=P.decode;m=b(m,{width:l.width,height:l.height,pixelType:q,format:a});l=new w({width:l.width,height:l.height,pixels:m.pixels,pixelType:l.pixelType,mask:m.mask,statistics:null});l.updateStatistics();return l};break;case "tiff":d=T;break;case "deflate":d=V;break;case "lzw":d=W;break;case "error":d=()=>{throw new y("rasterCodec:decode","input data contains error");};break;default:d=()=>{throw new y("rasterCodec:decode",
"unsupported raster format");}}return d}function ca(a,d=1){if(a){var {pixels:m,width:l,height:q,mask:b}=a;if(m&&0!==m.length){var f=m.length,e=l-1,c=q-1,g=[],h,k,t=w.getPixelArrayConstructor(a.pixelType);if(0===d){for(d=0;d<f;d++){var n=m[d];var p=new t(e*c);for(h=0;h<c;h++){var r=h*l;for(k=0;k<e;k++)p[h*e+k]=n[r+k]}g.push(p)}if(b){var u=new Uint8Array(e*c);for(h=0;h<c;h++)for(r=h*l,k=0;k<e;k++)u[h*e+k]=b[r+k]}}else{for(d=0;d<f;d++){n=m[d];p=new t(e*c);for(h=0;h<c;h++)for(r=h*l,k=0;k<e;k++)p[h*e+
k]=(n[r+k]+n[r+k+1]+n[r+l+k]+n[r+l+k+1])/4;g.push(p)}if(b)for(u=new Uint8Array(e*c),h=0;h<c;h++)for(r=h*l,k=0;k<e;k++)u[h*e+k]=Math.min.apply(null,[b[r+k],b[r+k+1],b[r+l+k],b[r+l+k+1]])}a.width=e;a.height=c;a.mask=u;a.pixels=g}}}function G(){G=A._asyncToGenerator(function*(a,d={},m){if(null==a)throw new y("rasterCodec:decode","missing encodeddata parameter.");let l=d.format&&d.format.toLowerCase();if(!("bsq"!==l&&"bip"!==l||null!=d.width&&null!=d.height))throw new y("rasterCodec:decode","requires width and height in options parameter.");
if("tiff"===l&&d.customOptions)return U(a,d);if(!l||"bsq"!==l&&"bip"!==l&&"deflate"!==l&&"lzw"!==l)l=L(a);d.useCanvas&&da.has(l)?a=yield aa(a,l,d,m):(m=ba(l),d.isPoint&&(d={...d},d.width++,d.height++),a=yield m(a,d),d.isPoint&&ca(a));return a});return G.apply(this,arguments)}var Z=function(a){function d(b){var f,e;this.data=b;this.pos=8;this.palette=[];this.imgData=[];this.transparency={};this.animation=null;this.text={};for(e=null;;){var c=this.readUInt32();var g=b=void 0;b=[];for(g=0;4>g;++g)b.push(String.fromCharCode(this.data[this.pos++]));
b=b.join("");switch(b){case "IHDR":this.width=this.readUInt32();this.height=this.readUInt32();this.bits=this.data[this.pos++];this.colorType=this.data[this.pos++];this.compressionMethod=this.data[this.pos++];this.filterMethod=this.data[this.pos++];this.interlaceMethod=this.data[this.pos++];break;case "acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||Infinity,frames:[]};break;case "PLTE":this.palette=this.read(c);break;case "fcTL":e&&this.animation.frames.push(e);this.pos+=
4;e={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};b=this.readUInt16();c=this.readUInt16()||100;e.delay=1E3*b/c;e.disposeOp=this.data[this.pos++];e.blendOp=this.data[this.pos++];e.data=[];break;case "IDAT":case "fdAT":"fdAT"===b&&(this.pos+=4,c-=4);b=(null!=e?e.data:void 0)||this.imgData;for(g=0;0<=c?g<c:g>c;0<=c?++g:--g)b.push(this.data[this.pos++]);break;case "tRNS":this.transparency={};switch(this.colorType){case 3:this.transparency.indexed=
this.read(c);c=255-this.transparency.indexed.length;if(0<c)for(b=0;0<=c?b<c:b>c;0<=c?++b:--b)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(c)[0];break;case 2:this.transparency.rgb=this.read(c)}break;case "tEXt":g=this.read(c);c=g.indexOf(0);b=String.fromCharCode.apply(String,g.slice(0,c));this.text[b]=String.fromCharCode.apply(String,g.slice(c+1));break;case "IEND":e&&this.animation.frames.push(e);a:{switch(this.colorType){case 0:case 3:case 4:e=1;break a;
case 2:case 6:e=3;break a}e=void 0}this.colors=e;this.hasAlphaChannel=4===(f=this.colorType)||6===f;f=this.colors+(this.hasAlphaChannel?1:0);this.pixelBitlength=this.bits*f;a:{switch(this.colors){case 1:f="DeviceGray";break a;case 3:f="DeviceRGB";break a}f=void 0}this.colorSpace=f;this.imgData=new Uint8Array(this.imgData);return;default:this.pos+=c}this.pos+=4;if(this.pos>this.data.length)throw Error("Incomplete or corrupt PNG file");}}var m;d.load=function(b,f,e){"function"===typeof f&&(e=f);var c=
new XMLHttpRequest;c.open("GET",b,!0);c.responseType="arraybuffer";c.onload=function(){var g=new Uint8Array(c.response||c.mozResponseArrayBuffer);g=new d(g);"function"===typeof(null!=f?f.getContext:void 0)&&g.render(f);return"function"===typeof e?e(g):void 0};return c.send(null)};d.prototype.read=function(b){var f;var e=[];for(f=0;0<=b?f<b:f>b;0<=b?++f:--f)e.push(this.data[this.pos++]);return e};d.prototype.readUInt32=function(){var b=this.data[this.pos++]<<24;var f=this.data[this.pos++]<<16;var e=
this.data[this.pos++]<<8;var c=this.data[this.pos++];return b|f|e|c};d.prototype.readUInt16=function(){var b=this.data[this.pos++]<<8;var f=this.data[this.pos++];return b|f};d.prototype.decodePixels=function(b){var f,e,c,g,h,k,t,n;null==b&&(b=this.imgData);if(0===b.length)return new Uint8Array(0);b=new I.Zlib(b);b=b.getBytes();var p=this.pixelBitlength/8;var r=p*this.width;var u=new Uint8Array(r*this.height);var ea=b.length;for(e=g=h=0;g<ea;){switch(b[g++]){case 0:for(c=f=0;f<r;c=f+=1)u[e++]=b[g++];
break;case 1:for(c=k=0;k<r;c=k+=1){f=b[g++];var v=c<p?0:u[e-p];u[e++]=(f+v)%256}break;case 2:for(c=v=0;v<r;c=v+=1){f=b[g++];var x=(c-c%p)/p;k=h&&u[(h-1)*r+x*p+c%p];u[e++]=(k+f)%256}break;case 3:for(c=n=0;n<r;c=n+=1)f=b[g++],x=(c-c%p)/p,v=c<p?0:u[e-p],k=h&&u[(h-1)*r+x*p+c%p],u[e++]=(f+Math.floor((v+k)/2))%256;break;case 4:for(c=n=0;n<r;c=n+=1){f=b[g++];x=(c-c%p)/p;v=c<p?0:u[e-p];0===h?k=t=0:(k=u[(h-1)*r+x*p+c%p],t=x&&u[(h-1)*r+(x-1)*p+c%p]);var z=v+k-t;c=Math.abs(z-v);x=Math.abs(z-k);z=Math.abs(z-
t);v=c<=x&&c<=z?v:x<=z?k:t;u[e++]=(f+v)%256}break;default:throw Error("Invalid filter algorithm: "+b[g-1]);}h++}return u};d.prototype.decodePalette=function(){var b,f,e,c;var g=this.palette;var h=this.transparency.indexed||[];var k=new Uint8Array((h.length||0)+g.length);var t=0;g.length;var n=f=b=0;for(e=g.length;f<e;n=f+=3)k[t++]=g[n],k[t++]=g[n+1],k[t++]=g[n+2],k[t++]=null!=(c=h[b++])?c:255;return k};d.prototype.copyToImageData=function(b,f){var e,c;var g=this.colors;var h=null;var k=this.hasAlphaChannel;
this.palette.length&&(h=null!=(e=this._decodedPalette)?e:this._decodedPalette=this.decodePalette(),g=4,k=!0);b=b.data||b;var t=b.length;var n=h||f;e=c=0;if(1===g)for(;e<t;)g=h?4*f[e/4]:c,c=n[g++],b[e++]=c,b[e++]=c,b[e++]=c,b[e++]=k?n[g++]:this.transparency.grayscale&&this.transparency.grayscale===c?0:255,c=g;else for(;e<t;)g=h?4*f[e/4]:c,b[e++]=n[g++],b[e++]=n[g++],b[e++]=n[g++],b[e++]=k?n[g++]:this.transparency.rgb&&this.transparency.rgb[1]===n[g-3]&&this.transparency.rgb[3]===n[g-2]&&this.transparency.rgb[5]===
n[g-1]?0:255,c=g};d.prototype.decode=function(){var b=new Uint8Array(this.width*this.height*4);this.copyToImageData(b,this.decodePixels());return b};var l=(m=a.document&&a.document.createElement("canvas"))&&m.getContext("2d");var q=function(b){l.width=b.width;l.height=b.height;l.clearRect(0,0,b.width,b.height);l.putImageData(b,0,0);b=new Image;b.src=m.toDataURL();return b};d.prototype.decodeFrames=function(b){var f,e;if(this.animation){var c=this.animation.frames;var g=[];var h=f=0;for(e=c.length;f<
e;h=++f){h=c[h];var k=b.createImageData(h.width,h.height);var t=this.decodePixels(new Uint8Array(h.data));this.copyToImageData(k,t);h.imageData=k;g.push(h.image=q(k))}return g}};d.prototype.renderFrame=function(b,f){var e=this.animation.frames;var c=e[f];e=e[f-1];0===f&&b.clearRect(0,0,this.width,this.height);1===(null!=e?e.disposeOp:void 0)?b.clearRect(e.xOffset,e.yOffset,e.width,e.height):2===(null!=e?e.disposeOp:void 0)&&b.putImageData(e.imageData,e.xOffset,e.yOffset);0===c.blendOp&&b.clearRect(c.xOffset,
c.yOffset,c.width,c.height);return b.drawImage(c.image,c.xOffset,c.yOffset)};d.prototype.animate=function(b){var f,e=this;var c=0;var g=this.animation;var h=g.numFrames;var k=g.frames;var t=g.numPlays;return(f=function(){var n=c++%h;var p=k[n];e.renderFrame(b,n);if(1<h&&c/h<t)return e.animation._timeout=setTimeout(f,p.delay)})()};d.prototype.stopAnimation=function(){var b;return clearTimeout(null!=(b=this.animation)?b._timeout:void 0)};d.prototype.render=function(b){b._png&&b._png.stopAnimation();
b._png=this;b.width=this.width;b.height=this.height;b=b.getContext("2d");if(this.animation)return this.decodeFrames(b),this.animate(b);var f=b.createImageData(this.width,this.height);this.copyToImageData(f,this.decodePixels());return b.putImageData(f,0,0)};return d}(self);const da=new Set(["jpg","png","bmp","gif"]),S=new Set("S8 U8 S16 U16 S32 U32 F32 F64".split(" "));B.decode=function(a){return G.apply(this,arguments)};B.getFormat=function(a){a=L(a);"lerc2"===a?a="lerc":"error"===a&&(a="");return a};
Object.defineProperties(B,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});