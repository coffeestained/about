// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define(["exports","../../../core/maybe","../PixelBlock"],function(C,K,F){function D(a){return K.isSome(a)&&"esri.layers.support.PixelBlock"===a.declaredClass&&a.pixels&&0<a.pixels.length}function Q(a,c,b,d,f,h,k,g){return{xmin:f<=b*a?0:f<b*a+a?f-b*a:a,ymin:h<=d*c?0:h<d*c+c?h-d*c:c,xmax:f+k<=b*a?0:f+k<b*a+a?f+k-b*a:a,ymax:h+g<=d*c?0:h+g<d*c+c?h+g-d*c:c}}function M(a,c,b,d,f,h){const {width:k,height:g}=b.block,{x:e,y:p}=b.offset,{width:l,height:n}=b.mosaic;b=Q(k,g,d,f,e,p,l,n);let q=0;var m=0;if(h){var r=
h.hasGCSSShiftTransform?360:h.halfWorldWidth,t=k*h.resolutionX,u=h.startX+d*t;t=u+t;u<r&&t>r?m=h.rightPadding:u>=r&&(q=h.leftMargin-h.rightPadding,m=0)}b.xmax-=m;if("number"===typeof c)for(h=b.ymin;h<b.ymax;h++)for(m=(f*g+h-p)*l+(d*k-e)+q,r=b.xmin;r<b.xmax;r++)a[m+r]=c;else for(h=b.ymin;h<b.ymax;h++)for(m=(f*g+h-p)*l+(d*k-e)+q,r=h*k,u=b.xmin;u<b.xmax;u++)a[m+u]=c[r+u]}function R(a,c,b={}){const {clipOffset:d,clipSize:f,alignmentInfo:h,blockWidths:k}=b;if(k)return X(a,c,{blockWidths:k});var g=a.find(x=>
D(x));if(K.isNone(g))return null;b=f?f.width:c.width;const e=f?f.height:c.height;var p=g.width,l=g.height;const n=c.width/p,q=c.height/l;c={offset:d||{x:0,y:0},mosaic:f||c,block:{width:p,height:l}};p=g.pixelType;l=F.getPixelArrayConstructor(p);var m=g.pixels.length;g=[];for(var r=0;r<m;r++){var t=new l(b*e);for(let x=0;x<q;x++)for(let w=0;w<n;w++){var u=a[x*n+w];D(u)&&(u=u.pixels[r],M(t,u,c,w,x,h))}g.push(t)}let v;if(a.some(x=>K.isNone(x)||x.mask&&0<x.mask.length))for(v=new Uint8Array(b*e),l=0;l<
q;l++)for(m=0;m<n;m++)t=a[l*n+m],(r=K.isSome(t)?t.mask:null)?M(v,r,c,m,l,h):t?M(v,1,c,m,l,h):M(v,0,c,m,l,h);a=new F({width:b,height:e,pixels:g,pixelType:p,mask:v});a.updateStatistics();return a}function X(a,c,b){const d=a.find(m=>K.isSome(m));if(K.isNone(d))return null;var f=a.some(m=>K.isSome(m)?!!m.mask:!0);const {width:h,height:k}=c;c=f?new Uint8Array(h*k):null;({blockWidths:b}=b);const g=[],e=d.getPlaneCount(),p=F.getPixelArrayConstructor(d.pixelType);if(f)for(let m=0,r=0;m<a.length;r+=b[m],m++)if(f=
a[m],D(f)){var l=f.mask;for(var n=0;n<k;n++)for(var q=0;q<b[m];q++)c[n*h+q+r]=null==l?255:l[n*f.width+q]}for(f=0;f<e;f++){l=new p(h*k);for(let m=0,r=0;m<a.length;r+=b[m],m++)if(n=a[m],D(n)&&(q=n.pixels[f],null!=q))for(let t=0;t<k;t++)for(let u=0;u<b[m];u++)l[t*h+u+r]=q[t*n.width+u];g.push(l)}a=new F({width:h,height:k,mask:c,pixels:g,pixelType:d.pixelType});a.updateStatistics();return a}function S(a){if(!D(a))return null;const c=a.clone(),{width:b,height:d,pixels:f,mask:h}=a;var k=f[0];a=c.pixels[0];
for(let p=2;p<d-1;p++){const l=new Map;for(var g=p-2;g<p+2;g++)for(var e=0;4>e;e++){const n=g*b+e;L(l,k[n],h?h[n]:1)}a[p*b]=T(l);a[p*b+1]=a[p*b+2]=a[p*b];for(g=3;g<b-1;g++)e=(p-2)*b+g+1,L(l,k[e],h?h[e]:1),e=(p-1)*b+g+1,L(l,k[e],h?h[e]:1),e=p*b+g+1,L(l,k[e],h?h[e]:1),e=(p+1)*b+g+1,L(l,k[e],h?h[e]:1),e=(p-2)*b+g-3,N(l,k[e],h?h[e]:1),e=(p-1)*b+g-3,N(l,k[e],h?h[e]:1),e=p*b+g-3,N(l,k[e],h?h[e]:1),e=(p+1)*b+g-3,N(l,k[e],h?h[e]:1),a[p*b+g]=T(l);a[p*b+g+1]=a[p*b+g]}for(k=0;k<b;k++)a[k]=a[b+k]=a[2*b+k],a[(d-
1)*b+k]=a[(d-2)*b+k];c.updateStatistics();return c}function T(a){if(0===a.size)return 0;let c=0,b=-1,d=0;const f=a.keys();let h=f.next();for(;!h.done;)d=a.get(h.value),d>c&&(b=h.value,c=d),h=f.next();return b}function N(a,c,b){0!==b&&(b=a.get(c),1===b?a.delete(c):a.set(c,b-1))}function L(a,c,b){0!==b&&a.set(c,a.has(c)?a.get(c)+1:1)}function U(a,c,b){let {x:d,y:f}=c;const {width:h,height:k}=b;if(0===d&&0===f&&k===a.height&&h===a.width)return a;const {width:g,height:e}=a;c=Math.max(0,f);const p=Math.max(0,
d),l=Math.min(d+h,g),n=Math.min(f+k,e);if(0>l||0>n||!D(a))return null;d=Math.max(0,-d);f=Math.max(0,-f);const {pixels:q,mask:m}=a;var r=h*k,t=q.length;const u=[];for(var v=0;v<t;v++){var x=q[v],w=F.createEmptyBand(a.pixelType,r);for(let A=c;A<n;A++){const z=A*g;let J=(A+f-c)*h+d;for(let G=p;G<l;G++)w[J++]=x[z+G]}u.push(w)}r=new Uint8Array(r);for(t=c;t<n;t++)for(v=t*g,x=(t+f-c)*h+d,w=p;w<l;w++)r[x++]=m?m[v+w]:1;a=new F({width:b.width,height:b.height,pixelType:a.pixelType,pixels:u,mask:r});a.updateStatistics();
return a}function Y(a,c=!0){if(!D(a))return null;const {pixels:b,width:d,height:f,mask:h,pixelType:k}=a;a=[];const g=Math.round(d/2),e=Math.round(f/2),p=f-1,l=d-1;for(var n=0;n<b.length;n++){var q=b[n],m=F.createEmptyBand(k,g*e),r=0;for(var t=0;t<f;t+=2)for(var u=0;u<d;u+=2){var v=q[t*d+u];if(c){var x=u===l?v:q[t*d+u+1];const w=t===p?v:q[t*d+u+d],A=u===l?w:t===p?x:q[t*d+u+d+1];m[r++]=(v+x+w+A)/4}else m[r++]=v}a.push(m)}n=null;if(h)for(n=new Uint8Array(g*e),q=0,m=0;m<f;m+=2)for(r=0;r<d;r+=2)t=h[m*
d+r],c?(u=r===l?t:h[m*d+r+1],v=m===p?t:h[m*d+r+d],x=r===l?v:m===p?u:h[m*d+r+d+1],n[q++]=t*u*v*x?1:0):n[q++]=t;return new F({width:g,height:e,pixelType:k,pixels:a,mask:n})}function V(a,c,b,d,f=.5){const {width:h,height:k}=a,{width:g,height:e}=c;a=d.cols;d=d.rows;c=Math.ceil(g/a-.1/a);const p=Math.ceil(e/d-.1/d);let l,n,q,m,r;const t=c*a;var u=t*p*d;const v=new Float32Array(u),x=new Float32Array(u),w=new Uint32Array(u),A=new Uint32Array(u);let z=0,J,G;for(let H=0;H<p;H++)for(let I=0;I<c;I++){var y=
12*(H*c+I);u=b[y];l=b[y+1];n=b[y+2];q=b[y+3];m=b[y+4];r=b[y+5];for(var B=0;B<d;B++){z=(H*d+B)*t+I*a;G=(B+.5)/d;for(let E=0;E<B;E++)J=(E+.5)/a,v[z+E]=(u*J+l*G+n)*h-f,x[z+E]=(q*J+m*G+r)*k-f,w[z+E]=Math.round(v[z+E]),A[z+E]=Math.round(x[z+E])}y+=6;u=b[y];l=b[y+1];n=b[y+2];q=b[y+3];m=b[y+4];r=b[y+5];for(y=0;y<d;y++)for(z=(H*d+y)*t+I*a,G=(y+.5)/d,B=y;B<a;B++)J=(B+.5)/a,v[z+B]=(u*J+l*G+n)*h-f,x[z+B]=(q*J+m*G+r)*k-f,w[z+B]=Math.round(v[z+B]),A[z+B]=Math.round(x[z+B])}return{offsets_x:v,offsets_y:x,offsets_xi:w,
offsets_yi:A,gridWidth:t}}C.approximateTransform=function(a,c,b,d,f="nearest"){if(!D(a))return null;"majority"===f&&(a=S(a));const {pixels:h,mask:k,pixelType:g}=a,e=a.width;var p=a.height;const l=F.getPixelArrayConstructor(g),n=h.length,{width:q,height:m}=c;a=!1;for(let A=0;A<b.length;A+=3)-1===b[A]&&-1===b[A+1]&&-1===b[A+2]&&(a=!0);const {offsets_x:r,offsets_y:t,offsets_xi:u,offsets_yi:v,gridWidth:x}=V({width:e,height:p},c,b,d,"majority"===f?0:.5);let w;c=(A,z,J)=>{const G=A instanceof Float32Array||
A instanceof Float64Array?0:.5;for(let y=0;y<m;y++){w=y*x;for(let B=0;B<q;B++){if(0>r[w]||0>t[w])A[y*q+B]=0;else if(J)A[y*q+B]=z[u[w]+v[w]*e];else{const H=Math.floor(r[w]),I=Math.floor(t[w]),E=Math.ceil(r[w]),O=Math.ceil(t[w]),P=r[w]-H,W=t[w]-I;A[y*q+B]=!k||k[H+I*e]&&k[H+I*e]&&k[H+O*e]&&k[E+O*e]?(1-W)*((1-P)*z[H+I*e]+P*z[E+I*e])+W*((1-P)*z[H+O*e]+P*z[E+O*e])+G:z[u[w]+v[w]*e]}w++}}};b=[];for(p=0;p<n;p++)d=new l(q*m),c(d,h[p],"nearest"===f||"majority"===f),b.push(d);f=new F({width:q,height:m,pixelType:g,
pixels:b});if(k)f.mask=new Uint8Array(q*m),c(f.mask,k,!0);else if(a)for(f.mask=new Uint8Array(q*m),a=0;a<q*m;a++)f.mask[a]=0>r[a]||0>t[a]?0:1;f.updateStatistics();return f};C.clip=U;C.colorize=function(a,c){if(!D(a)||!c&&(c.indexedColormap||c.indexed2DColormap))return a;const b=a.clone();var d=b.pixels;let f=b.mask;const h=b.width*b.height;if(1!==d.length)return a;const {indexedColormap:k,indexed2DColormap:g,offset:e,alphaSpecified:p}=c;c=k.length-1;a=0;d=d[0];const l=new Uint8Array(d.length),n=new Uint8Array(d.length),
q=new Uint8Array(d.length);let m=0;if(k)if(f)for(a=0;a<h;a++)f[a]&&(m=4*(d[a]-e),m<e||m>c?f[a]=0:(l[a]=k[m],n[a]=k[m+1],q[a]=k[m+2],f[a]=k[m+3]));else{f=new Uint8Array(h);for(a=0;a<h;a++)m=4*(d[a]-e),m<e||m>c?f[a]=0:(l[a]=k[m],n[a]=k[m+1],q[a]=k[m+2],f[a]=k[m+3]);b.mask=f}else if(f)for(a=0;a<h;a++)f[a]&&(c=g[d[a]],l[a]=c[0],n[a]=c[1],q[a]=c[2],f[a]=c[3]);else{f=new Uint8Array(h);for(a=0;a<h;a++)c=g[d[a]],l[a]=c[0],n[a]=c[1],q[a]=c[2],f[a]=c[3];b.mask=f}b.pixels=[l,n,q];b.statistics=null;b.pixelType=
"u8";b.maskIsAlpha=p;return b};C.createColormapLUT=function(a){if(a){var c=a.colormap;if(c&&0!==c.length){c=c.sort((p,l)=>p[0]-l[0]);var b=0;0>c[0][0]&&(b=c[0][0]);var d=Math.max(256,c[c.length-1][0]-b+1),f=new Uint8Array(4*d),h=[],k=0,g=0,e=5===c[0].length;if(65536<d)return c.forEach(p=>{h[p[0]-b]=e?p.slice(1):p.slice(1).concat([255])}),{indexed2DColormap:h,offset:b,alphaSpecified:e};if(a.fillUnspecified)for(a=c[g],k=a[0]-b;k<d;k++)f[4*k]=a[1],f[4*k+1]=a[2],f[4*k+2]=a[3],f[4*k+3]=e?a[4]:255,k===
a[0]-b&&(a=g===c.length-1?a:c[++g]);else for(k=0;k<c.length;k++)a=c[k],g=4*(a[0]-b),f[g]=a[1],f[g+1]=a[2],f[g+2]=a[3],f[g+3]=e?a[4]:255;return{indexedColormap:f,offset:b,alphaSpecified:e}}}};C.extractBands=function(a,c){if(null==c||!c.length||!D(a))return a;const b=a.pixels.length;return c&&c.some(d=>d>=b)||1===b&&1===c.length&&0===c[0]||b===c.length&&!c.some((d,f)=>d!==f)?a:new F({pixelType:a.pixelType,width:a.width,height:a.height,mask:a.mask,validPixelCount:a.validPixelCount,maskIsAlpha:a.maskIsAlpha,
pixels:c.map(d=>a.pixels[d]),statistics:a.statistics&&c.map(d=>a.statistics[d])})};C.getClipBounds=Q;C.getLocalArithmeticNorthRotations=function(a,c){const {coefficients:b,spacing:d}=c,{offsets_x:f,offsets_y:h,gridWidth:k}=V(a,a,b,{rows:d[0],cols:d[1]},.5),{width:g,height:e}=a;a=new Float32Array(g*e);c=180/Math.PI;for(let n=0;n<e;n++)for(let q=0;q<g;q++){var p=n*k+q,l=0===n?p:p-k;const m=n===e-1?p:p+k;p=f[l]-f[m];l=h[m]-h[l];isNaN(p)||isNaN(l)?a[n*g+q]=90:(l=Math.atan2(l,p)*c,l=(360+l)%360,a[n*g+
q]=l)}return a};C.isValidPixelBlock=D;C.lookupPixels=function(a,c){if(!D(a))return null;const {pixels:b,mask:d}=a,f=a.width*a.height,h=b.length;let k=c.lut;({offset:c}=c);let g,e;k&&1===k[0].length&&(k=b.map(()=>k));const p=[];let l,n,q;if(c)if(null==d)for(g=0;g<h;g++){l=b[g];n=k[g];q=new Uint8Array(f);for(e=0;e<f;e++)q[e]=n[l[e]-c];p.push(q)}else for(g=0;g<h;g++){l=b[g];n=k[g];q=new Uint8Array(f);for(e=0;e<f;e++)d[e]&&(q[e]=n[l[e]-c]);p.push(q)}else if(null==d)for(g=0;g<h;g++){l=b[g];n=k[g];q=new Uint8Array(f);
for(e=0;e<f;e++)q[e]=n[l[e]];p.push(q)}else for(g=0;g<h;g++){l=b[g];n=k[g];q=new Uint8Array(f);for(e=0;e<f;e++)d[e]&&(q[e]=n[l[e]]);p.push(q)}a=new F({width:a.width,height:a.height,pixels:p,mask:d,pixelType:"u8"});a.updateStatistics();return a};C.mosaic=R;C.mosaicPixelData=function(a,c){if(!a||0===a.length)return null;var b=a.find(n=>n.pixelBlock);if(!b||K.isNone(b.pixelBlock))return null;var d=(b.extent.xmax-b.extent.xmin)/b.pixelBlock.width;const f=(b.extent.ymax-b.extent.ymin)/b.pixelBlock.height,
h=.01*Math.min(d,f),k=a.sort((n,q)=>Math.abs(n.extent.ymax-q.extent.ymax)>h?q.extent.ymax-n.extent.ymax:Math.abs(n.extent.xmin-q.extent.xmin)>h?n.extent.xmin-q.extent.xmin:0);var g=Math.min.apply(null,k.map(n=>n.extent.xmin));const e=Math.min.apply(null,k.map(n=>n.extent.ymin)),p=Math.max.apply(null,k.map(n=>n.extent.xmax)),l=Math.max.apply(null,k.map(n=>n.extent.ymax));a={x:Math.round((c.xmin-g)/d),y:Math.round((l-c.ymax)/f)};g={width:Math.round((p-g)/d),height:Math.round((l-e)/f)};d={width:Math.round((c.xmax-
c.xmin)/d),height:Math.round((c.ymax-c.ymin)/f)};if(Math.round(g.width/b.pixelBlock.width)*Math.round(g.height/b.pixelBlock.height)!==k.length||0>a.x||0>a.y||g.width<d.width||g.height<d.height)return null;b=k.map(n=>n.pixelBlock);b=R(b,g,{clipOffset:a,clipSize:d});return{extent:c,pixelBlock:b}};C.remapColor=function(a,c){if(!D(a))return null;a=a.clone();var {pixels:b}=a;const d=a.width*a.height,f=c.length,h=Math.floor(f/2),k=c[Math.floor(h)];b=b[0];let g,e,p,l,n,q,m=!1;const r=new Uint8Array(d),t=
new Uint8Array(d),u=new Uint8Array(d);let v=a.mask;const x=4===c[0].mappedColor.length;v||(v=new Uint8Array(d),v.fill(x?255:1),a.mask=v);for(n=0;n<d;n++)if(v[n]){g=b[n];m=!1;q=h;e=k;p=0;for(l=f-1;1<l-p;){if(g===e.value){m=!0;break}g>e.value?p=q:l=q;q=Math.floor((p+l)/2);e=c[Math.floor(q)]}m||(g===c[p].value?(e=c[p],m=!0):g===c[l].value?(e=c[l],m=!0):g<c[p].value?(m=!1,e=null):g>c[p].value&&(g<c[l].value?(e=c[p],m=!0):l===f-1?(m=!1,e=null):(e=c[l],m=!0)));m?(r[n]=e.mappedColor[0],t[n]=e.mappedColor[1],
u[n]=e.mappedColor[2],v[n]=e.mappedColor[3]):r[n]=t[n]=u[n]=v[n]=0}a.pixels=[r,t,u];a.mask=v;a.pixelType="u8";a.maskIsAlpha=x;return a};C.resampleByMajority=S;C.setValidBoundary=function(a,c,b){if(!D(a))return null;const {width:d,height:f}=a,h=c.x;c=c.y;const k=b.width+h;b=b.height+c;if(0>h||0>c||k>d||b>f||0===h&&0===c&&k===d&&b===f)return a;a.mask||(a.mask=new Uint8Array(d*f));const g=a.mask;for(let e=0;e<f;e++){const p=e*d;for(let l=0;l<d;l++)g[p+l]=e<c||e>=b||l<h||l>=k?0:1}a.updateStatistics();
return a};C.split=function(a,c,b){if(!D(a))return null;const {width:d,height:f}=c;let {width:h,height:k}=a;const g=new Map,e={x:0,y:0};b=null==b?1:1+b;for(let p=0;p<b;p++){const l=Math.ceil(h/d),n=Math.ceil(k/f);for(let q=0;q<n;q++){e.y=q*f;for(let m=0;m<l;m++){e.x=m*d;const r=U(a,e,c);g.set(`${p}/${q}/${m}`,r)}}p<b-1&&(a=Y(a));h=Math.round(h/2);k=Math.round(k/2)}return g};Object.defineProperties(C,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});