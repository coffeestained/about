// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Collection ../core/Error ../core/Logger ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../chunks/vec3 ../chunks/vec3f64 ./Layer ./mixins/APIKeyMixin ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./mixins/SceneService ./support/arcgisLayerUrl ./support/commonProperties ./support/VoxelDynamicSection ./support/VoxelSection ./support/VoxelSimpleShading ./support/VoxelSlice ./support/VoxelVariable ./support/VoxelVariableStyle ./support/VoxelVolume ./support/VoxelVolumeIndex ./support/VoxelVolumeStyle".split(" "),
function(r,d,l,n,c,k,y,z,e,T,U,A,B,C,D,E,F,G,H,I,J,K,L,M,p,t,u,v,w,N,O,P,Q,R){const S=c.getLogger(" esri.layers.VoxelLayer");c=function(q){function m(a){a=q.call(this,a)||this;a.serviceRoot="";a.popupEnabled=!0;a.operationalLayerType="Voxel";a.legendEnabled=!0;a.title=null;a.sections=new l;a.currentVariableId=0;a.volumeStyles=null;a.renderMode="volume";a.variableStyles=null;a.enableSlices=!0;a.enableSections=!0;a.enableDynamicSections=!0;a.enableIsosurfaces=!0;a.shading=new v;a.opacity=1;a.variables=
new l;a.volumes=new l;a.index=null;a.minScale=0;a.maxScale=0;a.type="voxel";a.version={major:Number.NaN,minor:Number.NaN,versionString:""};a.volumeStyles=new l;a.variableStyles=new l;return a}r._inheritsLoose(m,q);var h=m.prototype;h.load=function(a){const b=k.isSome(a)?a.signal:null;a=this.loadFromPortal({supportedTypes:["Scene Service"]},a).catch(z.throwIfAbortError).then(()=>this._fetchService(b)).then(()=>this.serviceRoot=this.url);this.addResolvingPromise(a);return Promise.resolve(this)};h.readVersion=
function(a,b){return q.prototype.parseVersionString.call(this,a)};h.validateLayer=function(a){if(a.layerType&&a.layerType!==this.operationalLayerType)throw new n("voxel-layer:layer-type-not-supported","VoxelLayer does not support this layer type",{layerType:a.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor)||3>this.version.major)throw new n("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"3.x"});
if(3<this.version.major)throw new n("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"3.x"});};h.getConfiguration=function(){const a={layerType:this.operationalLayerType,version:this.version.versionString,name:this.title,spatialReference:this.spatialReference,fullExtent:this.fullExtent,volumes:this.volumes.toJSON(),variables:this.variables.toJSON(),index:this.index.toJSON(),sections:this.sections.toJSON(),style:{volumeStyles:this.volumeStyles.toJSON(),
currentVariableId:this.currentVariableId,renderMode:this.renderMode,variableStyles:this.variableStyles.toJSON(),enableSections:this.enableSections,enableDynamicSections:this.enableDynamicSections,enableIsosurfaces:this.enableIsosurfaces,enableSlices:this.enableSlices,shading:this.shading}};return a.index&&this.index.isValid()?JSON.stringify(a):""};h.getVariableStyle=function(a){let b=-1;b=k.isSome(a)?a:this.currentVariableId;if(!this.variableStyles||-1===b)return null;a=this.variableStyles.findIndex(g=>
g.variableId===b);return 0>a?null:this.variableStyles.getItemAt(a)};h.getVariable=function(a){let b=-1;b=k.isSome(a)?a:this.currentVariableId;if(!this.variables||-1===b)return null;a=this.variables.findIndex(g=>g.id===b);return 0>a?null:this.variables.getItemAt(a)};h.getSections=function(){const a=[];for(const b of this.sections)a.push(new u({enabled:b.enabled,href:b.href,id:b.id,label:b.label,normal:b.normal,point:b.point,sizeInPixel:b.sizeInPixel,slices:b.slices,timeId:b.timeId,variableId:b.variableId}));
return a};h.getVolume=function(a){const b=this.getVariable(a);return k.isSome(b)?this.volumes.find(({id:g})=>g===b.volumeId):null};h.getVolumeStyle=function(a){const b=this.getVariable(a);return k.isSome(b)?this.volumeStyles.find(({volumeId:g})=>g===b.volumeId):null};h.getSlices=function(){const a=[],b=this.getVolume(null);if(k.isNone(b)||!b.isVolumeValid())return a;const g=this.getVolumeStyle(null);if(k.isNone(g))return a;for(const f of g.slices)this._isPlaneValid(f,[0,1,b.getZDimension()],b.dimensions)?
a.push(new w({enabled:f.enabled,label:f.label,point:f.point,normal:f.normal})):a.push(new w({enabled:!1,label:"invalid",point:f.point,normal:f.normal}));return a};h.getDynamicSections=function(){const a=[],b=this.getVolume(null);if(k.isNone(b)||!b.isVolumeValid())return a;const g=this.getVolumeStyle(null);if(k.isNone(g))return a;for(const f of g.dynamicSections)this._isPlaneValid(f,[0,1,b.getZDimension()],b.dimensions)?a.push(new t({enabled:f.enabled,label:f.label,point:f.point,normal:f.normal})):
a.push(new t({enabled:!1,label:"invalid",point:f.point,normal:f.normal}));return a};h.getVerticalExaggeration=function(){const a=this.getVolumeStyle(null);return k.isNone(a)?1:a.verticalExaggeration};h.getVerticalOffset=function(){const a=this.getVolumeStyle(null);return k.isNone(a)?1:a.verticalOffset};h._isPlaneValid=function(a,b,g){if(!(a.point&&Array.isArray(a.point)&&3===a.point.length&&a.normal&&Array.isArray(a.normal)&&3===a.normal.length))return!1;for(let f=0;3>f;++f){const x=a.point[f];if(0>
x||x>=g[b[f]].size)return!1}b=E.fromValues(a.normal[0],a.normal[1],a.normal[2]);D.normalize(b,b);if(1E-6>Math.abs(b[0])+Math.abs(b[1])+Math.abs(b[2]))return!1;a.normal[0]=b[0];a.normal[1]=b[1];a.normal[2]=b[2];return!0};r._createClass(m,[{key:"url",set:function(a){this._set("url",M.sanitizeUrl(a,S))}}]);return m}(L.SceneService(H.ArcGISService(I.OperationalLayer(J.PortalLayer(K.ScaleRangeLayer(y.MultiOriginJSONMixin(G.APIKeyMixin(F))))))));d.__decorate([e.property(p.popupEnabled)],c.prototype,"popupEnabled",
void 0);d.__decorate([e.property({type:["Voxel"]})],c.prototype,"operationalLayerType",void 0);d.__decorate([e.property(p.legendEnabled)],c.prototype,"legendEnabled",void 0);d.__decorate([e.property({json:{write:!0}})],c.prototype,"title",void 0);d.__decorate([e.property(p.url)],c.prototype,"url",null);d.__decorate([e.property({type:l.ofType(u),json:{origins:{"web-scene":{name:"layerDefinition.sections",write:!0}}}})],c.prototype,"sections",void 0);d.__decorate([e.property({type:A.Integer,json:{origins:{"web-scene":{name:"layerDefinition.style.currentVariableId",
write:{enabled:!0,isRequired:!0}},service:{name:"style.currentVariableId"}}}})],c.prototype,"currentVariableId",void 0);d.__decorate([e.property({type:l.ofType(R),json:{origins:{"web-scene":{name:"layerDefinition.style.volumeStyles",write:!0},service:{name:"style.volumeStyles"}}}})],c.prototype,"volumeStyles",void 0);d.__decorate([e.property({type:["volume","surfaces"],json:{origins:{"web-scene":{name:"layerDefinition.style.renderMode",write:!0},service:{name:"style.renderMode"}}}})],c.prototype,
"renderMode",void 0);d.__decorate([e.property({type:l.ofType(O),json:{origins:{"web-scene":{name:"layerDefinition.style.variableStyles",write:!0},service:{name:"style.variableStyles"}}}})],c.prototype,"variableStyles",void 0);d.__decorate([e.property({type:Boolean,json:{origins:{"web-scene":{name:"layerDefinition.style.enableSlices",write:!0},service:{name:"style.enableSlices"}}}})],c.prototype,"enableSlices",void 0);d.__decorate([e.property({type:Boolean,json:{origins:{"web-scene":{name:"layerDefinition.style.enableSections",
write:!0},service:{name:"style.enableSections"}}}})],c.prototype,"enableSections",void 0);d.__decorate([e.property({type:Boolean,json:{origins:{"web-scene":{name:"layerDefinition.style.enableDynamicSections",write:!0},service:{name:"style.enableDynamicSections"}}}})],c.prototype,"enableDynamicSections",void 0);d.__decorate([e.property({type:Boolean,json:{origins:{"web-scene":{name:"layerDefinition.style.enableIsosurfaces",write:!0},service:{name:"style.enableIsosurfaces"}}}})],c.prototype,"enableIsosurfaces",
void 0);d.__decorate([e.property({type:v,json:{origins:{"web-scene":{name:"layerDefinition.style.shading",write:!0},service:{name:"style.shading"}}}})],c.prototype,"shading",void 0);d.__decorate([e.property({type:["show","hide"]})],c.prototype,"listMode",void 0);d.__decorate([e.property({type:Number,range:{min:0,max:1},nonNullable:!0,json:{read:!1,write:!1,origins:{"web-scene":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"opacity",void 0);d.__decorate([e.property({type:l.ofType(N)})],
c.prototype,"variables",void 0);d.__decorate([e.property({type:l.ofType(P)})],c.prototype,"volumes",void 0);d.__decorate([e.property({type:Q})],c.prototype,"index",void 0);d.__decorate([e.property({type:Number,json:{name:"layerDefinition.minScale",read:!1,write:!1,origins:{service:{read:!1,write:!1}}}})],c.prototype,"minScale",void 0);d.__decorate([e.property({type:Number,json:{name:"layerDefinition.maxScale",read:!1,write:!1,origins:{service:{read:!1,write:!1}}}})],c.prototype,"maxScale",void 0);
d.__decorate([e.property({json:{read:!1},readOnly:!0})],c.prototype,"type",void 0);d.__decorate([e.property({readOnly:!0,json:{name:"serviceVersion"}})],c.prototype,"version",void 0);d.__decorate([B.reader("service","version")],c.prototype,"readVersion",null);return c=d.__decorate([C.subclass("esri.layers.VoxelLayer")],c)});