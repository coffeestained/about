// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ./chunks/_rollupPluginBabelHelpers ./Graphic ./arcade/Dictionary ./arcade/Feature ./arcade/ImmutableArray ./arcade/parser ./core/Error ./layers/FeatureLayer ./rest/support/FeatureSet ./support/arcadeOnDemand".split(" "),function(v,w,E,F,G,H,I,x,J,K,L){function M(a,b,c,e={}){b=b.elementType;const d="array"===b.type?[{name:"value",type:b.type,elementType:b.elementType}]:"dictionary"===b.type?[{name:"value",type:b.type,properties:b.properties}]:[{name:"value",type:b.type}];return new H(a.map(f=>
{const h={};r(h,d,{["value"]:f},c,e);return h.value}))}function N(a,b,c={}){a=a instanceof K?new J({source:a.features,geometryType:a.geometryType,fields:a.fields,spatialReference:a.spatialReference}):a;return b.constructFeatureSet(a,c.spatialReference,null,!0,c.lruCache,c.interceptor)}function O(a,b,c={}){const {spatialReference:e,interceptor:d,lruCache:f}=c;return"string"===typeof a?b.createFeatureSetCollectionFromService(a,e,f,d):b.createFeatureSetCollectionFromMap(a,e,f,d)}function P(a,b,c,e={}){const d=
{};r(d,b.properties,a,c,e);return new F(d)}function r(a,b,c,e,d={}){const f={};for(const h of Object.keys(c))f[h.toLowerCase()]=c[h];for(const h of b)if(b=h.name.toLowerCase(),d.variablesPreProcessed)a[b]=f[b];else switch(h.type){case "array":a[b]=M(f[b],h,e,d);break;case "feature":c=f[b];a[b]=null==c?null:G.createFromGraphic(c);break;case "featureSet":c=f[b];a[b]=e?N(c,e,d):null;break;case "featureSetCollection":c=f[b];a[b]=e?O(c,e,d):null;break;case "dictionary":a[b]=P(f[b],h,e,d);break;case "geometry":case "boolean":case "date":case "text":case "number":a[b]=
f[b]}}function y(a,b){for(const c of a)b.push(c),"dictionary"===c.type&&y(c.properties,b);return b}function z(a,b,c,e,d){const {spatialReference:f,interceptor:h,lruCache:t,services:m,console:k}=c;d={vars:{},spatialReference:f,interceptor:h,lrucache:t,useAsync:d,services:m,console:k};if(!b)return d;r(d.vars,a.variables,b,e,c);return d}function q(a,b){switch(b.getArcadeType(a)){case "date":return new Date(a.getTime());case "feature":var c="geometry"in a?a.geometry():null;a="readAttributes"in a?a.readAttributes():
a.attributes;return new E({geometry:c,attributes:a});case "dictionary":{c=a.attributes;const e={};for(const d of Object.keys(c))e[d]=q(a.field(d),b);return e}case "array":return("toArray"in a?a.toArray():a).map(e=>q(e,b))}return a}function u(){u=w._asyncToGenerator(function*(a,b,c={}){const {arcade:e,arcadeUtils:d}=yield L.loadArcade(),{loadScriptDependencies:f,referencesMember:h,scriptIsAsync:t}=e;var m=y(b.variables,[]),k=m.filter(g=>"featureSet"===g.type||"featureSetCollection"===g.type).map(g=>
g.name.toLowerCase());const n=I.parseScript(a,k);if(!n)throw new x("arcade:invalid-script","Unable to create SyntaxTree");a=d.extractFieldNames(n);m=m.map(g=>g.name.toLowerCase()).filter(g=>h(n,g));const p=t(n,k);yield f(n,p,k);k={vars:{},spatialReference:null,useAsync:p};for(const g of m)k.vars[g]="any";const {lruCache:A}=c,B=e.compileScript(n,k),C=e.featureSetUtils();return{execute:(g,l={})=>{if(p)throw new x("arcade:invalid-execution-mode","Cannot execute the script in synchronous mode");g=B(z(b,
g,{lruCache:A,...l},C,p));return l.rawOutput?g:q(g,d)},executeAsync:function(){var g=w._asyncToGenerator(function*(l,D={}){l=yield B(z(b,l,{lruCache:A,...D},C,p));return D.rawOutput?l:q(l,d)});return function(l){return g.apply(this,arguments)}}(),isAsync:p,variablesUsed:m,fieldsUsed:a,syntaxTree:n}});return u.apply(this,arguments)}v.createArcadeExecutor=function(a,b){return u.apply(this,arguments)};Object.defineProperties(v,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});