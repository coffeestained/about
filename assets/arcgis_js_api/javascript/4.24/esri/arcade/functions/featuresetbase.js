// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../ArcadePortal ../Dictionary ../Feature ../featureSetCollection ../featureSetUtils ../FunctionWrapper ../ImmutableArray ../../chunks/languageUtils ../featureset/actions/Adapted ../featureset/actions/AttributeFilter ../featureset/actions/OrderBy ../featureset/actions/Top ../featureset/sources/Empty ../featureset/sources/FeatureLayerMemory ../featureset/support/OrderbyClause ../featureset/support/shared ../featureset/support/sqlUtils ./fieldStats ../../core/promiseUtils ../../core/sql/WhereClause ../../layers/FeatureLayer ../../layers/support/Field".split(" "),
function(P,y,H,z,U,Q,x,V,W,d,t,X,Y,Z,aa,ba,ca,I,R,J,da,v,K,D){function L(k,e,n){return M.apply(this,arguments)}function M(){M=y._asyncToGenerator(function*(k,e,n){const h=k.getVariables();if(0<h.length){const c=[];for(let b=0;b<h.length;b++)c.push(yield e.evaluateIdentifier(n,{name:h[b]}));e={};for(n=0;n<h.length;n++)e[h[n]]=c[n];k.parameters=e}return k});return M.apply(this,arguments)}function q(k,e,n=null){for(const h in k)if(h.toLowerCase()===e.toLowerCase())return k[h];return n}function S(k){if(null===
k)return null;const e={type:q(k,"type",""),name:q(k,"name","")};if("range"===e.type)e.range=q(k,"range",[]);else{e.codedValues=[];for(const n of q(k,"codedValues",[]))e.codedValues.push({name:q(n,"name",""),code:q(n,"code",null)})}return e}function N(k){if(null===k)return null;const e={},n=q(k,"wkt",null);null!==n&&(e.wkt=n);k=q(k,"wkid",null);null!==k&&(e.wkid=k);return e}function T(k){if(null===k)return null;const e={hasZ:q(k,"hasz",!1),hasM:q(k,"hasm",!1)};var n=q(k,"spatialreference",null);n&&
(e.spatialReference=N(n));n=q(k,"x",null);if(null!==n)return e.x=n,e.y=q(k,"y",null),e;n=q(k,"rings",null);if(null!==n)return e.rings=n,e;n=q(k,"paths",null);if(null!==n)return e.paths=n,e;n=q(k,"points",null);if(null!==n)return e.points=n,e;for(const h of"xmin xmax ymin ymax zmin zmax mmin mmax".split(" "))n=q(k,h,null),null!==n&&(e[h]=n);return e}P.registerFunctions=function(k){"async"===k.mode&&(k.functions.getuser=function(e,n){return k.standardFunctionAsync(e,n,function(){var h=y._asyncToGenerator(function*(c,
b,a){d.pcCheck(a,1,2);c=d.defaultUndefined(a[1],"");b=!0===c;c=!0===c||!1===c?"":d.toString(c);if(a[0]instanceof H){var l=null;e.services&&e.services.portal&&(l=e.services.portal);l=x.getPortal(a[0],l);if(l=yield x.lookupUser(l,c,b)){l=JSON.parse(JSON.stringify(l));for(var g of["lastLogin","created","modified"])void 0!==l[g]&&null!==l[g]&&(l[g]=new Date(l[g]));return z.convertObjectToArcadeDictionary(l)}return null}g=null;d.isFeatureSet(a[0])&&(g=a[0]);if(g){b=!1;if(c)return null;yield g.load();a=
yield g.getOwningSystemUrl();if(!a)return!c&&(l=yield g.getIdentityUser())?z.convertObjectToArcadeDictionary({username:l}):null;g=null;e.services&&e.services.portal&&(g=e.services.portal);g=x.getPortal(new H(a),g);if(g=yield x.lookupUser(g,c,b)){g=JSON.parse(JSON.stringify(g));for(l of["lastLogin","created","modified"])void 0!==g[l]&&null!==g[l]&&(g[l]=new Date(g[l]));return z.convertObjectToArcadeDictionary(g)}return null}throw Error("Invalid Parameter");});return function(c,b,a){return h.apply(this,
arguments)}}())},k.signatures.push({name:"getuser",min:"1",max:"2"}),k.functions.featuresetbyid=function(e,n){return k.standardFunctionAsync(e,n,(h,c,b)=>{d.pcCheck(b,2,4);if(b[0]instanceof Q){h=d.toString(b[1]);c=d.defaultUndefined(b[2],null);const a=d.toBoolean(d.defaultUndefined(b[3],!0));null===c&&(c=["*"]);if(!1===d.isArray(c))throw Error("Invalid Parameter");return b[0].featureSetById(h,a,c)}throw Error("Invalid Parameter");})},k.signatures.push({name:"featuresetbyid",min:"2",max:"4"}),k.functions.getfeatureset=
function(e,n){return k.standardFunctionAsync(e,n,(h,c,b)=>{d.pcCheck(b,1,2);if(d.isFeature(b[0]))return h=d.defaultUndefined(b[1],"datasource"),null===h&&(h="datasource"),h=d.toString(h).toLowerCase(),x.convertToFeatureSet(b[0].fullSchema(),h,e.lrucache,e.interceptor,e.spatialReference);throw Error("Invalid Parameter");})},k.signatures.push({name:"getfeatureset",min:"1",max:"2"}),k.functions.featuresetbyportalitem=function(e,n){return k.standardFunctionAsync(e,n,(h,c,b)=>{d.pcCheck(b,2,5);if(null===
b[0])throw Error("Portal is required");if(b[0]instanceof H){h=d.toString(b[1]);c=d.toString(b[2]);var a=d.defaultUndefined(b[3],null);const l=d.toBoolean(d.defaultUndefined(b[4],!0));null===a&&(a=["*"]);if(!1===d.isArray(a))throw Error("Invalid Parameter");let g=null;e.services&&e.services.portal&&(g=e.services.portal);g=x.getPortal(b[0],g);return x.constructFeatureSetFromPortalItem(h,c,e.spatialReference,a,l,g,e.lrucache,e.interceptor)}if(!1===d.isString(b[0]))throw Error("Portal is required");h=
d.toString(b[0]);c=d.toString(b[1]);a=d.defaultUndefined(b[2],null);b=d.toBoolean(d.defaultUndefined(b[3],!0));null===a&&(a=["*"]);if(!1===d.isArray(a))throw Error("Invalid Parameter");if(e.services&&e.services.portal)return x.constructFeatureSetFromPortalItem(h,c,e.spatialReference,a,b,e.services.portal,e.lrucache,e.interceptor);throw Error("Portal is required");})},k.signatures.push({name:"featuresetbyportalitem",min:"2",max:"5"}),k.functions.featuresetbyname=function(e,n){return k.standardFunctionAsync(e,
n,(h,c,b)=>{d.pcCheck(b,2,4);if(b[0]instanceof Q){h=d.toString(b[1]);c=d.defaultUndefined(b[2],null);const a=d.toBoolean(d.defaultUndefined(b[3],!0));null===c&&(c=["*"]);if(!1===d.isArray(c))throw Error("Invalid Parameter");return b[0].featureSetByName(h,a,c)}throw Error("Invalid Parameter");})},k.signatures.push({name:"featuresetbyname",min:"2",max:"4"}),k.functions.featureset=function(e,n){return k.standardFunction(e,n,(h,c,b)=>{d.pcCheck(b,1,1);c=b[0];h={layerDefinition:{geometryType:"",objectIdField:"",
globalIdField:"",typeIdField:"",fields:[]},featureSet:{geometryType:"",features:[]}};if(d.isString(c))c=JSON.parse(c),void 0!==c.layerDefinition?(h.layerDefinition=c.layerDefinition,h.featureSet=c.featureSet,c.layerDefinition.spatialReference&&(h.layerDefinition.spatialReference=c.layerDefinition.spatialReference)):(h.featureSet.features=c.features,h.featureSet.geometryType=c.geometryType,h.layerDefinition.geometryType=h.featureSet.geometryType,h.layerDefinition.objectIdField=c.objectIdFieldName,
h.layerDefinition.typeIdField=c.typeIdFieldName,h.layerDefinition.globalIdField=c.globalIdFieldName,h.layerDefinition.fields=c.fields,c.spatialReference&&(h.layerDefinition.spatialReference=c.spatialReference));else if(b[0]instanceof z)if(c=JSON.parse(b[0].castToText()),b=q(c,"layerdefinition"),null!==b){h.layerDefinition.geometryType=q(b,"geometrytype","");h.featureSet.geometryType=h.layerDefinition.geometryType;h.layerDefinition.globalIdField=q(b,"globalidfield","");h.layerDefinition.objectIdField=
q(b,"objectidfield","");h.layerDefinition.typeIdField=q(b,"typeidfield","");var a=q(b,"spatialreference",null);a&&(h.layerDefinition.spatialReference=N(a));for(const p of q(b,"fields",[]))a={name:q(p,"name",""),alias:q(p,"alias",""),type:q(p,"type",""),nullable:q(p,"nullable",!0),editable:q(p,"editable",!0),length:q(p,"length",null),domain:S(q(p,"domain"))},h.layerDefinition.fields.push(a);var l=q(c,"featureset",null);if(l){a={};for(var g of h.layerDefinition.fields)a[g.name.toLowerCase()]=g.name;
for(var f of q(l,"features",[])){l={};g=q(f,"attributes",{});for(var m in g)l[a[m.toLowerCase()]]=g[m];h.featureSet.features.push({attributes:l,geometry:T(q(f,"geometry",null))})}}}else{h.layerDefinition.geometryType=q(c,"geometrytype","");h.featureSet.geometryType=h.layerDefinition.geometryType;h.layerDefinition.objectIdField=q(c,"objectidfieldname","");h.layerDefinition.typeIdField=q(c,"typeidfieldname","");if(f=q(c,"spatialreference",null))h.layerDefinition.spatialReference=N(f);for(const p of q(c,
"fields",[]))f={name:q(p,"name",""),alias:q(p,"alias",""),type:q(p,"type",""),nullable:q(p,"nullable",!0),editable:q(p,"editable",!0),length:q(p,"length",null),domain:S(q(p,"domain"))},h.layerDefinition.fields.push(f);f={};for(const p of h.layerDefinition.fields)f[p.name.toLowerCase()]=p.name;for(a of q(c,"features",[])){m={};g=q(a,"attributes",{});for(l in g)m[f[l.toLowerCase()]]=g[l];h.featureSet.features.push({attributes:m,geometry:T(q(a,"geometry",null))})}}else throw Error("Invalid Parameter");
if(h.layerDefinition&&h.featureSet){b:{f=" esriGeometryPoint esriGeometryPolyline esriGeometryPolygon esriGeometryMultipoint esriGeometryEnvelope".split(" ");for(r of f)if(r===h.layerDefinition.geometryType){var r=!0;break b}r=!1}r=!1===r||null===h.layerDefinition.objectIdField||""===h.layerDefinition.objectIdField||!1===d.isArray(h.layerDefinition.fields)||!1===d.isArray(h.featureSet.features)?!1:!0}else r=!1;if(!1===r)throw Error("Invalid Parameter");return ba.create(h,e.spatialReference)})},k.signatures.push({name:"featureset",
min:"1",max:"1"}),k.functions.filter=function(e,n){return k.standardFunctionAsync(e,n,function(){var h=y._asyncToGenerator(function*(c,b,a){d.pcCheck(a,2,2);if(d.isArray(a[0])||d.isImmutableArray(a[0])){c=[];var l=a[0];l instanceof W&&(l=l.toArray());b=null;if(a[1]instanceof V)b=k.arcadeCustomFunctionHandler(a[1]);else if(a[1]instanceof d.NativeFunction)b=(...f)=>a[1].fn(e,{preparsed:!0,arguments:f});else if(a[1]instanceof d.SizzleFunction)b=(...f)=>{if(f.length!==a[1].paramCount)throw Error("Invalid parameters");
return a[1].fn(...f)};else throw Error("Invalid Parameter");for(var g of l)l=b(g),da.isPromiseLike(l)?!0===(yield l)&&c.push(g):!0===l&&c.push(g);return c}if(d.isFeatureSet(a[0])){g=yield a[0].load();g=v.WhereClause.create(a[1],g.getFieldsIndex());c=g.getVariables();if(0<c.length){b=[];for(l=0;l<c.length;l++)b.push(yield k.evaluateIdentifier(e,{name:c[l]}));l={};for(let f=0;f<c.length;f++)l[c[f]]=b[f];g.parameters=l}return new X({parentfeatureset:a[0],whereclause:g})}throw Error("Filter cannot accept this parameter type");
});return function(c,b,a){return h.apply(this,arguments)}}())},k.signatures.push({name:"filter",min:"2",max:"2"}),k.functions.orderby=function(e,n){return k.standardFunctionAsync(e,n,function(){var h=y._asyncToGenerator(function*(c,b,a){d.pcCheck(a,2,2);if(d.isFeatureSet(a[0]))return c=new ca(a[1]),new Y({parentfeatureset:a[0],orderbyclause:c});throw Error("Order cannot accept this parameter type");});return function(c,b,a){return h.apply(this,arguments)}}())},k.signatures.push({name:"orderby",min:"2",
max:"2"}),k.functions.top=function(e,n){return k.standardFunctionAsync(e,n,function(){var h=y._asyncToGenerator(function*(c,b,a){d.pcCheck(a,2,2);if(d.isFeatureSet(a[0]))return new Z({parentfeatureset:a[0],topnum:a[1]});if(d.isArray(a[0]))return d.toNumber(a[1])>=a[0].length?a[0].slice(0):a[0].slice(0,d.toNumber(a[1]));if(d.isImmutableArray(a[0]))return d.toNumber(a[1])>=a[0].length()?a[0].slice(0):a[0].slice(0,d.toNumber(a[1]));throw Error("Top cannot accept this parameter type");});return function(c,
b,a){return h.apply(this,arguments)}}())},k.signatures.push({name:"top",min:"2",max:"2"}),k.functions.first=function(e,n){return k.standardFunctionAsync(e,n,function(){var h=y._asyncToGenerator(function*(c,b,a){d.pcCheck(a,1,1);return d.isFeatureSet(a[0])?(c=yield a[0].first(c.abortSignal),null!==c?(a=U.createFromGraphicLikeObject(c.geometry,c.attributes,a[0]),a._underlyingGraphic=c,a):c):d.isArray(a[0])?0===a[0].length?null:a[0][0]:d.isImmutableArray(a[0])?0===a[0].length()?null:a[0].get(0):null});
return function(c,b,a){return h.apply(this,arguments)}}())},k.signatures.push({name:"first",min:"1",max:"1"}),k.functions.attachments=function(e,n){return k.standardFunctionAsync(e,n,function(){var h=y._asyncToGenerator(function*(c,b,a){d.pcCheck(a,1,2);b=c=-1;var l=null,g=!1;if(1<a.length)if(a[1]instanceof z){if(a[1].hasField("minsize")&&(c=d.toNumber(a[1].field("minsize"))),a[1].hasField("metadata")&&(g=d.toBoolean(a[1].field("metadata"))),a[1].hasField("maxsize")&&(b=d.toNumber(a[1].field("maxsize"))),
a[1].hasField("types")){var f=d.toStringArray(a[1].field("types"),!1);0<f.length&&(l=f)}}else if(null!==a[1])throw Error("Invalid Parameter");if(d.isFeature(a[0])){f=a[0]._layer;f instanceof K&&(f=x.constructFeatureSet(f,e.spatialReference,["*"],!0,e.lrucache,e.interceptor));if(null===f||!1===d.isFeatureSet(f))return[];yield f.load();return f.queryAttachments(a[0].field(f.objectIdField),c,b,l,g)}if(null===a[0])return[];throw Error("Invalid Parameter");});return function(c,b,a){return h.apply(this,
arguments)}}())},k.signatures.push({name:"attachments",min:"1",max:"2"}),k.functions.featuresetbyrelationshipname=function(e,n){return k.standardFunctionAsync(e,n,function(){var h=y._asyncToGenerator(function*(c,b,a){d.pcCheck(a,2,4);c=a[0];const l=d.toString(a[1]);b=d.defaultUndefined(a[2],null);var g=d.toBoolean(d.defaultUndefined(a[3],!0));null===b&&(b=["*"]);if(!1===d.isArray(b))throw Error("Invalid Parameter");if(null===a[0])return null;if(!d.isFeature(a[0]))throw Error("Invalid Parameter");
a=c._layer;a instanceof K&&(a=x.constructFeatureSet(a,e.spatialReference,["*"],!0,e.lrucache,e.interceptor));if(null===a||!1===d.isFeatureSet(a))return null;a=yield a.load();const f=a.relationshipMetaData().filter(r=>r.name===l);if(0===f.length)return null;if(void 0!==f[0].relationshipTableId&&null!==f[0].relationshipTableId&&-1<f[0].relationshipTableId)return x.constructFeatureSetFromRelationship(a,f[0],c.field(a.objectIdField),a.spatialReference,b,g,e.lrucache,e.interceptor);let m=a.serviceUrl();
if(!m)return null;m="/"===m.charAt(m.length-1)?m+f[0].relatedTableId.toString():m+"/"+f[0].relatedTableId.toString();b=yield x.constructFeatureSetFromUrl(m,a.spatialReference,b,g,e.lrucache,e.interceptor);yield b.load();g=b.relationshipMetaData();g=g.filter(r=>r.id===f[0].id);if(!1===c.hasField(f[0].keyField)||null===c.field(f[0].keyField))return(c=yield a.getFeatureByObjectId(c.field(a.objectIdField),[f[0].keyField]))?(a=v.WhereClause.create(g[0].keyField+"\x3d @id",b.getFieldsIndex()),a.parameters=
{id:c.attributes[f[0].keyField]},b.filter(a)):new aa({parentfeatureset:b});a=v.WhereClause.create(g[0].keyField+"\x3d @id",b.getFieldsIndex());a.parameters={id:c.field(f[0].keyField)};return b.filter(a)});return function(c,b,a){return h.apply(this,arguments)}}())},k.signatures.push({name:"featuresetbyrelationshipname",min:"2",max:"4"}),k.functions.featuresetbyassociation=function(e,n){return k.standardFunctionAsync(e,n,function(){var h=y._asyncToGenerator(function*(c,b,a){d.pcCheck(a,2,3);var l=a[0],
g=d.toString(d.defaultUndefined(a[1],"")).toLowerCase(),f=d.isString(a[2])?d.toString(a[2]):null;if(null===a[0])return null;if(!d.isFeature(a[0]))throw Error("Invalid Parameter");var m=l._layer;m instanceof K&&(m=x.constructFeatureSet(m,e.spatialReference,["*"],!0,e.lrucache,e.interceptor));if(null===m||!1===d.isFeatureSet(m))return null;yield m.load();a=m.serviceUrl();a=yield x.constructAssociationMetaDataFeatureSetFromUrl(a,e.spatialReference);let r=b=null;c=!1;if(null!==f&&""!==f&&void 0!==f){for(var p of a.terminals)p.terminalName===
f&&(r=p.terminalId);null===r&&(c=!0)}var u=a.associations.getFieldsIndex();p=u.get("TOGLOBALID").name;f=u.get("FROMGLOBALID").name;const w=u.get("TOTERMINALID").name,O=u.get("FROMTERMINALID").name,E=u.get("FROMNETWORKSOURCEID").name,F=u.get("TONETWORKSOURCEID").name,C=u.get("ASSOCIATIONTYPE").name,ea=u.get("ISCONTENTVISIBLE").name,fa=u.get("OBJECTID").name;for(var G of m.fields)if("global-id"===G.type){b=l.field(G.name);break}let B=null;G=new t.SqlExpressionAdapted(new D({name:"percentalong",alias:"percentalong",
type:"double"}),v.WhereClause.create("0",a.associations.getFieldsIndex()));l=new t.SqlExpressionAdapted(new D({name:"side",alias:"side",type:"string"}),v.WhereClause.create("''",a.associations.getFieldsIndex()));m={};for(var A in a.lkp)m[A]=a.lkp[A].sourceId;A=new t.StringToCodeAdapted(new D({name:"classname",alias:"classname",type:"string"}),null,m);m="";switch(g){case "midspan":m=`((${p}='${b}') OR ( ${f}='${b}')) AND (${C} IN (5))`;A.codefield=v.WhereClause.create(`CASE WHEN (${p}='${b}') THEN ${E} ELSE ${F} END`,
a.associations.getFieldsIndex());g=I.cloneField(t.AdaptedFeatureSet.findField(a.associations.fields,f));g.name="globalid";g.alias="globalid";B=new t.SqlExpressionAdapted(g,v.WhereClause.create(`CASE WHEN (${f}='${b}') THEN ${p} ELSE ${f} END`,a.associations.getFieldsIndex()));G=4<=a.unVersion?new t.OriginalField(t.AdaptedFeatureSet.findField(a.associations.fields,u.get("PERCENTALONG").name)):new t.SqlExpressionAdapted(new D({name:"percentalong",alias:"percentalong",type:"double"}),v.WhereClause.create("0",
a.associations.getFieldsIndex()));break;case "junctionedge":m=`((${p}='${b}') OR ( ${f}='${b}')) AND (${C} IN (4,6))`;A.codefield=v.WhereClause.create(`CASE WHEN (${p}='${b}') THEN ${E} ELSE ${F} END`,a.associations.getFieldsIndex());g=I.cloneField(t.AdaptedFeatureSet.findField(a.associations.fields,f));g.name="globalid";g.alias="globalid";B=new t.SqlExpressionAdapted(g,v.WhereClause.create(`CASE WHEN (${f}='${b}') THEN ${p} ELSE ${f} END`,a.associations.getFieldsIndex()));l=new t.SqlExpressionAdapted(new D({name:"side",
alias:"side",type:"string"}),v.WhereClause.create(`CASE WHEN (${C}=4) THEN 'from' ELSE 'to' END`,a.associations.getFieldsIndex()));break;case "connected":g=`${p}='@T'`;u=`${f}='@T'`;null!==r&&(g+=` AND ${w}=@A`,u+=` AND ${O}=@A`);m="(("+g+") OR ("+u+"))";m=d.multiReplace(m,"@T",b);g=d.multiReplace(g,"@T",b);null!==r&&(g=d.multiReplace(g,"@A",r.toString()),m=d.multiReplace(m,"@A",r.toString()));A.codefield=v.WhereClause.create("CASE WHEN "+g+` THEN ${E} ELSE ${F} END`,a.associations.getFieldsIndex());
b=I.cloneField(t.AdaptedFeatureSet.findField(a.associations.fields,f));b.name="globalid";b.alias="globalid";B=new t.SqlExpressionAdapted(b,v.WhereClause.create("CASE WHEN "+g+` THEN ${f} ELSE ${p} END`,a.associations.getFieldsIndex()));break;case "container":m=`${p}='${b}' AND ${C} = 2`,null!==r&&(m+=` AND ${w} = `+r.toString()),A.codefield=E,m="( "+m+" )",B=new t.FieldRename(t.AdaptedFeatureSet.findField(a.associations.fields,f),"globalid","globalid");case "content":m=`(${f}='${b}' AND ${C} = 2)`;
null!==r&&(m+=` AND ${O} = `+r.toString());A.codefield=F;m="( "+m+" )";B=new t.FieldRename(t.AdaptedFeatureSet.findField(a.associations.fields,p),"globalid","globalid");break;case "structure":m=`(${p}='${b}' AND ${C} = 3)`;null!==r&&(m+=` AND ${w} = `+r.toString());A.codefield=E;m="( "+m+" )";B=new t.FieldRename(t.AdaptedFeatureSet.findField(a.associations.fields,f),"globalid","globalId");break;case "attached":m=`(${f}='${b}' AND ${C} = 3)`;null!==r&&(m+=` AND ${O} = `+r.toString());A.codefield=F;
m="( "+m+" )";B=new t.FieldRename(t.AdaptedFeatureSet.findField(a.associations.fields,p),"globalid","globalId");break;default:throw Error("Invalid Parameter");}c&&(m="1 \x3c\x3e 1");return new t.AdaptedFeatureSet({parentfeatureset:a.associations,adaptedFields:[new t.OriginalField(t.AdaptedFeatureSet.findField(a.associations.fields,fa)),new t.OriginalField(t.AdaptedFeatureSet.findField(a.associations.fields,ea)),B,l,A,G],extraFilter:m?v.WhereClause.create(m,a.associations.getFieldsIndex()):null})});
return function(c,b,a){return h.apply(this,arguments)}}())},k.signatures.push({name:"featuresetbyassociation",min:"2",max:"6"}),k.functions.groupby=function(e,n){return k.standardFunctionAsync(e,n,function(){var h=y._asyncToGenerator(function*(c,b,a){d.pcCheck(a,3,3);if(!d.isFeatureSet(a[0]))throw Error("Illegal Value: GroupBy");const l=yield a[0].load();c=[];b=[];let g=!1;var f=[];if(d.isString(a[1]))f.push(a[1]);else if(a[1]instanceof z)f.push(a[1]);else if(d.isArray(a[1]))f=a[1];else if(d.isImmutableArray(a[1]))f=
a[1].toArray();else throw Error("Illegal Value: GroupBy");for(var m of f)if(d.isString(m)){f=v.WhereClause.create(d.toString(m),l.getFieldsIndex());var r=!0===R.isSingleField(f)?d.toString(m):"%%%%FIELDNAME";c.push({name:r,expression:f});"%%%%FIELDNAME"===r&&(g=!0)}else if(m instanceof z){f=m.hasField("name")?m.field("name"):"%%%%FIELDNAME";r=m.hasField("expression")?m.field("expression"):"";"%%%%FIELDNAME"===f&&(g=!0);if(!f)throw Error("Illegal Value: GroupBy");c.push({name:f,expression:v.WhereClause.create(r?
r:f,l.getFieldsIndex())})}else throw Error("Illegal Value: GroupBy");f=[];if(d.isString(a[2]))f.push(a[2]);else if(d.isArray(a[2]))f=a[2];else if(d.isImmutableArray(a[2]))f=a[2].toArray();else if(a[2]instanceof z)f.push(a[2]);else throw Error("Illegal Value: GroupBy");for(var p of f)if(p instanceof z){m=p.hasField("name")?p.field("name"):"";f=p.hasField("statistic")?p.field("statistic"):"";r=p.hasField("expression")?p.field("expression"):"";if(!m||!f||!r)throw Error("Illegal Value: GroupBy");b.push({name:m,
statistic:f.toLowerCase(),expression:v.WhereClause.create(r,l.getFieldsIndex())})}else throw Error("Illegal Value: GroupBy");if(g){p={};for(var u of l.fields)p[u.name.toLowerCase()]=1;for(const w of c)"%%%%FIELDNAME"!==w.name&&(p[w.name.toLowerCase()]=1);for(const w of b)"%%%%FIELDNAME"!==w.name&&(p[w.name.toLowerCase()]=1);u=0;for(const w of c)if("%%%%FIELDNAME"===w.name){for(;1===p["field_"+u.toString()];)u++;p["field_"+u.toString()]=1;w.name="FIELD_"+u.toString()}}for(const w of c)yield L(w.expression,
k,e);for(const w of b)yield L(w.expression,k,e);return a[0].groupby(c,b)});return function(c,b,a){return h.apply(this,arguments)}}())},k.signatures.push({name:"groupby",min:"3",max:"3"}),k.functions.distinct=function(e,n){return k.standardFunctionAsync(e,n,function(){var h=y._asyncToGenerator(function*(c,b,a){if(d.isFeatureSet(a[0])){d.pcCheck(a,2,2);b=yield a[0].load();c=[];var l=[];if(d.isString(a[1]))l.push(a[1]);else if(a[1]instanceof z)l.push(a[1]);else if(d.isArray(a[1]))l=a[1];else if(d.isImmutableArray(a[1]))l=
a[1].toArray();else throw Error("Illegal Value: GroupBy");let r=!1;for(var g of l)if(d.isString(g)){l=v.WhereClause.create(d.toString(g),b.getFieldsIndex());var f=!0===R.isSingleField(l)?d.toString(g):"%%%%FIELDNAME";c.push({name:f,expression:l});"%%%%FIELDNAME"===f&&(r=!0)}else if(g instanceof z){l=g.hasField("name")?g.field("name"):"%%%%FIELDNAME";f=g.hasField("expression")?g.field("expression"):"";"%%%%FIELDNAME"===l&&(r=!0);if(!l)throw Error("Illegal Value: GroupBy");c.push({name:l,expression:v.WhereClause.create(f?
f:l,b.getFieldsIndex())})}else throw Error("Illegal Value: GroupBy");if(r){g={};for(var m of b.fields)g[m.name.toLowerCase()]=1;for(const p of c)"%%%%FIELDNAME"!==p.name&&(g[p.name.toLowerCase()]=1);m=0;for(const p of c)if("%%%%FIELDNAME"===p.name){for(;1===g["field_"+m.toString()];)m++;g["field_"+m.toString()]=1;p.name="FIELD_"+m.toString()}}for(const p of c)yield L(p.expression,k,e);return a[0].groupby(c,[])}a:{if(1===a.length){if(d.isArray(a[0])){a=J.calculateStat("distinct",a[0],-1);break a}if(d.isImmutableArray(a[0])){a=
J.calculateStat("distinct",a[0].toArray(),-1);break a}}a=J.calculateStat("distinct",a,-1)}return a});return function(c,b,a){return h.apply(this,arguments)}}())})};Object.defineProperties(P,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});