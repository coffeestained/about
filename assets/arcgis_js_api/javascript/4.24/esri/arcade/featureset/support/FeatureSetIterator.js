// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define(["../../../chunks/_rollupPluginBabelHelpers"],function(m){return function(){function n(b,a){this._lastId=-1;this._progress=a;this._parent=b}var l=n.prototype;l.reset=function(){this._lastId=-1};l.nextBatch=function(b){if(null!==this._parent._mainSetInUse)return this._parent._mainSetInUse.then(d=>this.nextBatch(b),d=>this.nextBatch(b));var a=null,c=!1;const h=[];a=new Promise((d,e)=>{this._parent._getSet(this._progress).then(f=>{var k=f._known.length-1;"GETPAGES"===f._known[f._known.length-
1]&&--k;if(this._lastId+b>k&&0<f._known.length&&"GETPAGES"===f._known[f._known.length-1])this._parent._expandPagedSet(f,this._parent._maxQueryRate(),0,0,this._progress).then(g=>{c=!0;this._parent._mainSetInUse=null;this.nextBatch(b).then(d,e)},g=>{c=!0;this._parent._mainSetInUse=null;e(g)});else if(k>=this._lastId+b||0===f._candidates.length){for(k=0;k<b;k++){const g=k+this._lastId+1;if(g>=f._known.length)break;h[k]=f._known[g]}this._lastId+=h.length;0===h.length&&(c=!0,this._parent._mainSetInUse=
null,d([]));this._parent._getFeatureBatch(h,this._progress).then(g=>{c=!0;this._parent._mainSetInUse=null;d(g)},g=>{c=!0;this._parent._mainSetInUse=null;e(g)})}else this._parent._refineSetBlock(f,this._parent._maxProcessingRate(),this._progress).then(()=>{c=!0;this._parent._mainSetInUse=null;this.nextBatch(b).then(d,e)},g=>{c=!0;this._parent._mainSetInUse=null;e(g)})},f=>{c=!0;this._parent._mainSetInUse=null;e(f)})});!1===c&&(this._parent._mainSetInUse=a,c=!0);return a};l.next=function(){if(null!==
this._parent._mainSetInUse)return this._parent._mainSetInUse.then(c=>this.next(),c=>this.next());var b=null,a=!1;b=new Promise((c,h)=>{this._parent._getSet(this._progress).then(d=>{this._lastId<d._known.length-1?"GETPAGES"===d._known[this._lastId+1]?this._parent._expandPagedSet(d,this._parent._maxQueryRate(),0,0,this._progress).then(e=>{a=!0;this._parent._mainSetInUse=null;return this.next()}).then(c,h):(this._lastId+=1,this._parent._getFeature(d,d._known[this._lastId],this._progress).then(e=>{a=
!0;this._parent._mainSetInUse=null;c(e)},e=>{a=!0;this._parent._mainSetInUse=null;h(e)})):0<d._candidates.length?this._parent._refineSetBlock(d,this._parent._maxProcessingRate(),this._progress).then(()=>{a=!0;this._parent._mainSetInUse=null;this.next().then(c,h)},e=>{a=!0;this._parent._mainSetInUse=null;h(e)}):(a=!0,this._parent._mainSetInUse=null,c(null))},d=>{a=!0;this._parent._mainSetInUse=null;h(d)})});!1===a&&(this._parent._mainSetInUse=b,a=!0);return b};l.count=function(){var b=m._asyncToGenerator(function*(){if(-1!==
this._parent._totalCount)return this._parent._totalCount;var a=yield this._parent._getSet(this._progress);a=yield this._refineAllSets(a);this._parent._totalCount=a._known.length;return this._parent._totalCount});return function(){return b.apply(this,arguments)}}();l._refineAllSets=function(){var b=m._asyncToGenerator(function*(a){if(0<a._known.length&&"GETPAGES"===a._known[a._known.length-1])return yield this._parent._expandPagedSet(a,this._parent._maxQueryRate(),0,1,this._progress),this._refineAllSets(a);
if(0<a._candidates.length){if("GETPAGES"===a._known[a._candidates.length-1])return yield this._parent._expandPagedSet(a,this._parent._maxQueryRate(),0,2,this._progress),this._refineAllSets(a);a=yield this._parent._refineSetBlock(a,this._parent._maxProcessingRate(),this._progress);return 0<a._candidates.length?this._refineAllSets(a):a}return a});return function(a){return b.apply(this,arguments)}}();return n}()});