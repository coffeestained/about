// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define(["exports","../rest/support/ClassBreaksDefinition","../rest/support/generateRendererUtils"],function(m,E,F){function u(a){const b=null!=a.minValue||null!=a.maxValue,c=!!a.sqlExpression&&a.supportsSQLExpression;return!(null!=a.normalizationField||null!=a.normalizationType)&&!b&&!c}function v(a){const {values:b,useSampleStdDev:c,supportsNullCount:d}=a;var e=Number.POSITIVE_INFINITY;let g=Number.NEGATIVE_INFINITY,f=null,k=null;var h=null;let p=null,l=0;const q=null==a.minValue?-Infinity:a.minValue,
r=null==a.maxValue?Infinity:a.maxValue;for(const n of b)Number.isFinite(n)?n>=q&&n<=r&&(f+=n,e=Math.min(e,n),g=Math.max(g,n),l++):"string"===typeof n&&l++;if(l&&null!=f){k=f/l;h=0;for(const n of b)Number.isFinite(n)&&n>=q&&n<=r&&(h+=(n-k)**2);p=c?1<l?h/(l-1):0:0<l?h/l:0;h=Math.sqrt(p)}else g=e=null;e={avg:k,count:l,max:g,min:e,stddev:h,sum:f,variance:p};d&&(e.nullcount=b.length-l);a.percentileParams&&(e.median=t(b,a.percentileParams));return e}function t(a,b){const {fieldType:c,value:d,orderBy:e,
isDiscrete:g}=b,f=w(c,"desc"===e);a=[...a].filter(l=>null!=l).sort((l,q)=>f(l,q));if(0===a.length)return null;if(0>=d)return a[0];if(1<=d)return a[a.length-1];var k=(a.length-1)*d,h=Math.floor(k);b=h+1;k%=1;h=a[h];const p=a[b];return b>=a.length||g||"string"===typeof h||"string"===typeof p?h:h*(1-k)+p*k}function w(a,b){const c=b?1:-1,d=G(b),e=x(b);if(!a||!["esriFieldTypeDate","esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...y].includes(a))return(g,f)=>"number"===typeof g&&"number"===
typeof f?d(g,f):"string"===typeof g&&"string"===typeof f?e(g,f):c;if("esriFieldTypeDate"===a)return(g,f)=>{g=(new Date(g)).getTime();f=(new Date(f)).getTime();return isNaN(g)||isNaN(f)?c:d(g,f)};if(y.has(a))return(g,f)=>d(g,f);if("esriFieldTypeString"===a)return(g,f)=>e(g,f);if("esriFieldTypeGUID"===a||"esriFieldTypeGlobalID"===a){const g=x(b);return(f,k)=>g(z(f),z(k))}return b?(g,f)=>1:(g,f)=>-1}function x(a){return a?(b,c)=>{var d,e;b=null==(d=b)?void 0:d.toUpperCase();c=null==(e=c)?void 0:e.toUpperCase();
return b>c?-1:b<c?1:0}:(b,c)=>{var d,e;b=null==(d=b)?void 0:d.toUpperCase();c=null==(e=c)?void 0:e.toUpperCase();return b<c?-1:b>c?1:0}}function G(a){return a?(b,c)=>c-b:(b,c)=>b-c}function z(a){return a.substr(24,12)+a.substr(19,4)+a.substr(16,2)+a.substr(14,2)+a.substr(11,2)+a.substr(9,2)+a.substr(6,2)+a.substr(4,2)+a.substr(2,2)+a.substr(0,2)}function A(a,b){const c=B({field:b.field,normalizationType:b.normalizationType,normalizationField:b.normalizationField,classificationMethod:b.classificationMethod,
standardDeviationInterval:b.standardDeviationInterval,breakCount:b.numClasses||5});a=H(a,b.minValue,b.maxValue);return F.createGenerateRendererClassBreaks({definition:c,values:a,normalizationTotal:b.normalizationTotal})}function H(a,b,c){b=null==b?-Infinity:b;c=null==c?Infinity:c;return a.filter(d=>Number.isFinite(d)&&d>=b&&d<=c)}function B(a){const b=a.field,c=a.classificationMethod||"equal-interval",d=a.normalizationType,e=a.normalizationField,g=new E;g.classificationField=b;g.breakCount=a.breakCount;
g.classificationMethod=c;g.standardDeviationInterval="standard-deviation"===c?a.standardDeviationInterval||1:void 0;g.normalizationType=d;g.normalizationField="field"===d?e:void 0;return g}function I(a,b){const {field:c,classificationMethod:d,standardDeviationInterval:e,normalizationType:g,normalizationField:f,normalizationTotal:k,minValue:h,maxValue:p}=b,l=b.numBins||10;let q=b=null,r=null;d&&"equal-interval"!==d||g?({classBreaks:a}=A(a,{field:c,normalizationType:g,normalizationField:f,normalizationTotal:k,
classificationMethod:d,standardDeviationInterval:e,minValue:h,maxValue:p,numClasses:l}),b=a[0].minValue,q=a[a.length-1].maxValue,r=a.map(n=>[n.minValue,n.maxValue])):(null!=h&&null!=p?(b=h,q=p):(a=v({values:a,minValue:h,maxValue:p,useSampleStdDev:!g,supportsNullCount:u({normalizationType:g,normalizationField:f,minValue:h,maxValue:p})}),b=a.min,q=a.max),r=C(b,q,l));return{min:b,max:q,intervals:r}}function J(a,b){let c=-1;for(let d=a.length-1;0<=d;d--)if(b>=a[d][0]){c=d;break}return c}function C(a,
b,c){const d=(b-a)/c,e=[];let g;for(let f=1;f<=c;f++)g=a+d,g=Number(g.toFixed(16)),e.push([a,f===c?b:g]),a=g;return e}const K=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,y=new Set(["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),D="min max avg stddev count sum variance nullcount median".split(" ");m.calculateClassBreaks=A;m.calculateHistogram=function(a,b){const {min:c,max:d,intervals:e}=I(a,b),g=e.map((f,k)=>({minValue:e[k][0],maxValue:e[k][1],count:0}));
for(const f of a)null!=f&&f>=c&&f<=d&&(a=J(e,f),-1<a&&g[a].count++);return{bins:g,minValue:c,maxValue:d,normalizationTotal:b.normalizationTotal}};m.calculatePercentile=t;m.calculateStatistics=v;m.calculateStringStatistics=function(a){const b=a.returnDistinct?[...new Set(a.values)]:a.values,c=b.filter(e=>null!=e).length,d={count:c};a.supportsNullCount&&(d.nullcount=b.length-c);a.percentileParams&&(d.median=t(b,a.percentileParams));return d};m.calculateUniqueValuesCount=function(a){const b={};for(let c of a){if(null==
c||"string"===typeof c&&""===c.trim())c=null;null==b[c]?b[c]={count:1,data:c}:b[c].count++}return{count:b}};m.createClassBreaksDefinition=B;m.createUVResult=function(a,b,c){const d=a.count;a=[];c&&b&&"coded-value"===b.type&&b.codedValues.forEach(e=>{e=e.code;d.hasOwnProperty(e)||(d[e]={data:e,count:0})});for(const e in d)b=d[e],a.push({value:b.data,count:b.count,label:b.label});return{uniqueValueInfos:a}};m.getAttributeComparator=w;m.getEqualIntervalBins=C;m.getNormalizedValue=function(a,b,c,d){let e=
null;switch(b){case "log":0!==a&&(e=Math.log(a)*Math.LOG10E);break;case "percent-of-total":Number.isFinite(d)&&0!==d&&(e=a/d*100);break;case "field":Number.isFinite(c)&&0!==c&&(e=a/c);break;case "natural-log":0<a&&(e=Math.log(a));break;case "square-root":0<a&&(e=a**.5)}return e};m.isNullCountSupported=u;m.processSummaryStatisticsResult=function(a,b){let c;for(c in a)D.includes(c)&&(Number.isFinite(a[c])||(a[c]=null));if(!b)return a;["avg","stddev","variance"].forEach(d=>{null!=a[d]&&(a[d]=Math.ceil(a[d]))});
return a};m.resolveCBResult=function(a,b){let c=a.classBreaks;const d=c[0].minValue,e=c[c.length-1].maxValue,g="standard-deviation"===b;c=c.map(f=>{const k=f.label;f={minValue:f.minValue,maxValue:f.maxValue,label:k};if(g&&k){const h=k.match(K).map(p=>+p.trim());2===h.length?(f.minStdDev=h[0],f.maxStdDev=h[1],0>h[0]&&0<h[1]&&(f.hasAvg=!0)):1===h.length&&(k.includes("\x3c")?(f.minStdDev=null,f.maxStdDev=h[0]):k.includes("\x3e")&&(f.minStdDev=h[0],f.maxStdDev=null))}return f});return{minValue:d,maxValue:e,
classBreakInfos:c,normalizationTotal:a.normalizationTotal}};m.statisticTypes=D;Object.defineProperties(m,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});