// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../core/MapUtils ../../core/mathUtils ../../core/maybe ../../core/screenUtils ./interactiveToolUtils ../support/screenUtils".split(" "),function(y,z,u,g,A,v,m){const q={manipulator:null,tool:null};return function(){function r(){this._pointerLocations=new Map;this._hoveredManipulators=new Map;this._grabbedManipulators=new Map;this._draggedManipulators=new Map;this._stopDrag=!1;this._currentlyActiveTool=null;this._revertToActiveTool=!1;this._cursor=
null}var h=r.prototype;h.handleInputEvent=function(a,d){var c=()=>a.stopPropagation();switch(a.type){case "pointer-move":"mouse"===a.pointerType&&this._pointerLocations.set(a.pointerId,{x:a.x,y:a.y,pointerType:a.pointerType});break;case "drag":0<this._grabbedManipulators.size&&(this._stopDrag=!0);this._stopDrag&&(a.stopPropagation(),"end"===a.action&&(this._stopDrag=!1));break;case "pointer-down":if("mouse"===a.pointerType&&0!==a.button)break;c=m.createScreenPointFromEvent(a);var e=this._intersect(c,
a.pointerType,d.forEachTool);if(g.isNone(e))break;var f=this._findToolAndManipulatorByKey(e,d.forEachTool,q),b=g.applySome(f,l=>l.manipulator);f=g.applySome(f,l=>l.tool);!(g.isSome(b)&&g.isSome(f)&&b.interactive)||b.grabbable&&b.grabbableForEvent(a)||!b.grabbing||b.dragging||this._ungrabManipulatorBeforeDragging(b,f,a);g.isSome(b)&&b.interactive&&b.grabbable&&b.grabbableForEvent(a)&&!b.grabbing&&(this._grabbedManipulators.set(a.pointerId,{key:e,start:c,pointerType:a.pointerType}),1===this._grabbedManipulators.size&&
d.activeTool!==e.tool&&(this._currentlyActiveTool=d.activeTool,this._revertToActiveTool=!0,d.setActiveTool(e.tool)),b.grabbing=!0,b.events.emit("grab-changed",{action:"start",pointerType:a.pointerType,screenPoint:c}),a.stopPropagation());break;case "pointer-up":this._handlePointerEnd(a,d);break;case "pointer-drag":if("mouse"===a.pointerType&&0!==a.button)break;var k=this._grabbedManipulators.get(a.pointerId);c=this._draggedManipulators.get(a.pointerId);e=g.applySome(k||c,({key:l})=>l);b=this._findManipulatorByKey(e,
d.forEachTool);if(g.isNone(b))break;f=m.createScreenPointFromEvent(a);f.x=u.clamp(f.x,0,d.view.width);f.y=u.clamp(f.y,0,d.view.height);k=g.unwrap(k||c).start;switch(a.action){case "start":case "update":if("update"===a.action||1===this._grabbedManipulators.size)b.dragging=!0,c?b.events.emit("drag",{action:"update",start:k,screenPoint:f}):b.events.emit("drag",{action:"start",start:k,screenPoint:f,pointerType:a.pointerType}),this._draggedManipulators.set(a.pointerId,{key:g.unwrap(e),start:k});break;
case "end":b.dragging=!1,c&&b.events.emit("drag",{action:"end",start:k,screenPoint:f}),this._draggedManipulators.delete(a.pointerId),this._handlePointerEnd(a,d)}a.stopPropagation();break;case "immediate-click":{e=m.createScreenPointFromEvent(a);b=this._intersect(e,a.pointerType,d.forEachTool);const l=this._findToolAndManipulatorByKey(b,d.forEachTool,q);a.native.shiftKey||d.forEachTool(n=>{if((!g.isSome(l)||l.tool!==n||n.automaticManipulatorSelection)&&n.manipulators){let w=!1;n.manipulators.forEach(({manipulator:x})=>
{x.selected&&(x.selected=!1,w=!0)});w&&n.manipulatorSelectionChanged&&n.manipulatorSelectionChanged()}});if(g.isNone(l))break;const {manipulator:p,tool:t}=l;if(!p.interactive)break;p.selectable&&t.automaticManipulatorSelection&&(p.selected=!p.selected,t.manipulatorSelectionChanged&&t.manipulatorSelectionChanged());p.events.emit("immediate-click",{screenPoint:e,button:a.button,pointerType:a.pointerType,shiftKey:a.native.shiftKey,stopPropagation:c});break}case "click":c=m.createScreenPointFromEvent(a);
e=this._intersect(c,a.pointerType,d.forEachTool);e=this._findManipulatorByKey(e,d.forEachTool);if(g.isNone(e)||!e.interactive)break;e.events.emit(a.type,{screenPoint:c,button:a.button,pointerType:a.pointerType,shiftKey:a.native.shiftKey});a.stopPropagation();break;case "double-click":e=m.createScreenPointFromEvent(a);b=this._intersect(e,a.pointerType,d.forEachTool);b=this._findManipulatorByKey(b,d.forEachTool);if(g.isNone(b)||!b.interactive)break;b.events.emit("double-click",{screenPoint:e,button:a.button,
pointerType:a.pointerType,shiftKey:a.native.shiftKey,stopPropagation:c});break;case "immediate-double-click":e=m.createScreenPointFromEvent(a),b=this._intersect(e,a.pointerType,d.forEachTool),b=this._findManipulatorByKey(b,d.forEachTool),!g.isNone(b)&&b.interactive&&b.events.emit("immediate-double-click",{screenPoint:e,button:a.button,pointerType:a.pointerType,shiftKey:a.native.shiftKey,stopPropagation:c})}this._onFocusChange(d.forEachTool)};h._ungrabManipulatorBeforeDragging=function(a,d,c){a.grabbing=
!1;a.events.emit("grab-changed",{action:"end",pointerType:c.pointerType,screenPoint:m.createScreenPointFromEvent(c)});this._grabbedManipulators.forEach(({key:e},f)=>{e.tool===d&&d.manipulators.findById(e.manipulatorId)===a&&this._grabbedManipulators.delete(f)})};h._handlePointerEnd=function(a,d){var c=g.applySome(this._grabbedManipulators.get(a.pointerId),({key:e})=>e);c=this._findManipulatorByKey(c,d.forEachTool);g.isSome(c)&&!c.dragging&&(1===this._grabbedManipulators.size&&0===this._draggedManipulators.size&&
this._revertToActiveTool&&(d.setActiveTool(this._currentlyActiveTool),this._revertToActiveTool=!1,this._currentlyActiveTool=null),c.grabbing&&(c.grabbing=!1,c.events.emit("grab-changed",{action:"end",pointerType:a.pointerType,screenPoint:m.createScreenPointFromEvent(a)})),this._grabbedManipulators.delete(a.pointerId))};h._cursorFromMap=function(a,d){let c=null;z.someMap(a,({key:e})=>{e=this._findManipulatorByKey(e,d);return g.isSome(e)&&e.interactive&&"cursor"in e&&e.cursor?(c=e.cursor,!0):!1});return c};
h._onFocusChange=function(a){this._updateCursor(a);this._updateFocusedManipulatorTools(a)};h._updateCursor=function(a){this._cursor=0<this._grabbedManipulators.size?this._cursorFromMap(this._grabbedManipulators,a)||"grabbing":0<this._hoveredManipulators.size?this._cursorFromMap(this._hoveredManipulators,a)||"pointer":null};h._updateFocusedManipulatorTools=function(a){const d=new Set;this._grabbedManipulators.forEach(({key:{tool:c}})=>{d.add(c)});this._hoveredManipulators.forEach(({key:{tool:c}})=>
{d.add(c)});a(c=>{c.hasFocusedManipulators=d.has(c)})};h.clearPointers=function(a,d,c=!0,e){const f=b=>b.tool===a&&(g.isNone(e)||b.manipulatorId===e);this._grabbedManipulators.forEach(({key:b,pointerType:k},l)=>{f(b)&&(this._grabbedManipulators.delete(l),b=this._findManipulatorByKey(b,d),g.isSome(b)&&(b.grabbing=!1,b.events.emit("grab-changed",{action:"end",screenPoint:null,pointerType:k})))});this._draggedManipulators.forEach(({key:b},k)=>{f(b)&&(this._draggedManipulators.delete(k),b=this._findManipulatorByKey(b,
d),g.isSome(b)&&(b.dragging=!1,b.events.emit("drag",{action:"cancel"})))});c&&this._hoveredManipulators.forEach(({key:b},k)=>{f(b)&&(this._hoveredManipulators.delete(k),b=this._findManipulatorByKey(b,d),g.isSome(b)&&(b.hovering=!1))});this._onFocusChange(d)};h._intersect=function(a,d,c){let e=null;c(f=>{if(null==f.manipulators||!v.areToolManipulatorsEditable(f))return!1;const b=f.manipulators.intersect(a,d);if(g.isNone(b))return!1;e={manipulatorId:b.id,tool:f};return!0});return e};h.updateHoveredStateFromKnownPointers=
function(a){this._pointerLocations.forEach((d,c)=>{this._updateHoveredStateForPointerAtScreenPosition(A.createScreenPoint(d.x,d.y),c,d.pointerType,a)})};h.handleHoverEvent=function(a,d){"pointer-up"!==a.type&&"immediate-click"!==a.type&&"pointer-move"!==a.type||"mouse"!==a.pointerType||this._updateHoveredStateForPointerAtScreenPosition(m.createScreenPointFromEvent(a),a.pointerId,a.pointerType,d)};h._updateHoveredStateForPointerAtScreenPosition=function(a,d,c,e){a=this._intersect(a,c,e);c=this._findManipulatorByKey(a,
e);var f=g.applySome(this._hoveredManipulators.get(d),({key:b})=>b);f=this._findManipulatorByKey(f,e);g.isSome(c)&&!c.interactive&&(c=null);f!==c&&(g.isSome(f)&&(f.hovering=!1),g.isSome(c)?(c.hovering=!0,this._hoveredManipulators.set(d,{key:g.unwrap(a)})):this._hoveredManipulators.delete(d),this._onFocusChange(e))};h._findManipulatorByKey=function(a,d){return this._findToolAndManipulatorByKey(a,d,q)?q.manipulator:null};h._findToolAndManipulatorByKey=function(a,d,c){if(g.isNone(a))return null;c.tool=
null;c.manipulator=null;d(e=>{if(e!==a.tool||null==e.manipulators||!v.areToolManipulatorsEditable(e))return!1;const f=e.manipulators.findById(a.manipulatorId);return g.isSome(f)?(c.manipulator=f,c.tool=e,!0):!1});return c.manipulator?c:null};y._createClass(r,[{key:"cursor",get:function(){return this._cursor}}]);return r}()});