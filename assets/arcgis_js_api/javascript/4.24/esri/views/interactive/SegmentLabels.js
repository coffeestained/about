// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/handleUtils ../../core/maybe ../../core/promiseUtils ../../core/quantityFormatUtils ../../core/reactiveUtils ../../core/screenUtils ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../chunks/vec2 ../../chunks/vec2f64 ../../chunks/vec3 ../../geometry/support/coordsUtils ../../intl/messages ../../support/elevationInfoUtils ../overlay/TextOverlayItem ../support/automaticLengthMeasurementUtils".split(" "),
function(f,y,n,G,H,k,A,I,B,C,J,p,U,V,W,K,q,D,L,M,N,O,P,Q){const R={default:15,far:25};f.SegmentLabels=function(E){function v(a){a=E.call(this,a)||this;a.context=null;a.stagedVertex=null;a.visible=!0;a.edgeDistance="default";a._messagesUnits=null;a._labelInfos=[];a._nextLabelIndex=0;return a}y._inheritsLoose(v,E);var r=v.prototype;r.initialize=function(){var a=this;const b=A.createTask(function(){var d=y._asyncToGenerator(function*(h){const e=yield N.fetchMessageBundle("esri/core/t9n/Units");A.throwIfAborted(h);
a._messagesUnits=e});return function(h){return d.apply(this,arguments)}}()),l=()=>k.applySome(this.context,d=>d.editGeometryOperations);this.own([B.watch(()=>[k.isSome(this.context)&&this.getCameraOrExtent(this.context),this.visible,this._edgeDistancePixels,this.stagedVertex,this._messagesUnits],()=>this._update()),...["vertex-add","vertex-update","vertex-remove"].map(d=>B.on(l,d,()=>this._update())),H.makeHandle(()=>b.abort())])};r.destroy=function(){for(this._nextLabelIndex=0;this._labelInfos.length;)this._destroyLabel(this._labelInfos.pop())};
r._update=function(){this._nextLabelIndex=0;const a=this.context;if(!k.isNone(a)){var {components:b,geometry:l,coordinateHelper:d}=a.editGeometryOperations.data;if(l){var h=b.length;for(let t=0;t<h;++t){const c=[];b[t].iterateVertices(z=>{c.push(d.toXYZ(z.pos))});0===t&&k.isSome(this.stagedVertex)&&c.push(d.toXYZ(this.stagedVertex));if(2>c.length)continue;var e=c[0],m=c[c.length-1];"polygon"===l.type&&2<c.length&&!L.equals(e,m)&&c.push(e);m=1===h?!M.isClockwise(c,!1,!1):!1;let w=S,x=T;this.toScreenPointArray(a,
e,w);for(e=1;e<c.length;++e){const z=c[e-1],F=c[e];this.toScreenPointArray(a,F,x);this._addLabel(a,z,w,F,x,m);[w,x]=[x,w]}}}}this._destroyUnusedLabels()};r._addLabel=function(a,b,l,d,h,e){const {label:m}=this._getOrCreateLabel(a);if(!this.visible||3025>q.squaredDistance(l,h))m.visible=!1;else{var t=k.isSome(a.graphicState)?a.graphicState.isDraped?"on-the-ground":"absolute-height":O.getGeometryEffectiveElevationMode(a.editGeometryOperations.data.geometry,a.elevationInfo),{spatialReference:c}=a.editGeometryOperations.data;
b=Q.autoDirectDistanceByElevationMode(b,d,c,t);d=this._messagesUnits;a=J.getDefaultUnitForView(a.view);m.text=k.isSome(d)&&k.isSome(b)?I.formatLength(d,b,a):"";m.visible=!0;a=h[0]-l[0];b=h[1]-l[1];e?q.set(g,-b,a):q.set(g,b,-a);q.normalize(g,g);q.scale(g,g,this._edgeDistancePixels);q.lerp(u,l,h,.5);q.add(u,u,g);m.position=[u[0],u[1]];m.anchor=Math.abs(g[0])>Math.abs(g[1])?0<g[0]?"left":"right":0>-g[1]?"top":"bottom"}};r._getOrCreateLabel=function(a){if(this._labelInfos.length>this._nextLabelIndex)return this._labelInfos[this._nextLabelIndex++];
const b=new P({fontSize:10,anchor:"center"});a.view.overlay.items.add(b);a={label:b};this._labelInfos.push(a);this._nextLabelIndex=this._labelInfos.length;return a};r._destroyUnusedLabels=function(){for(;this._labelInfos.length>this._nextLabelIndex;)this._destroyLabel(this._labelInfos.pop())};r._destroyLabel=function({label:a}){k.applySome(this.context,b=>b.view.overlay.items.remove(a));a.destroy()};y._createClass(v,[{key:"updating",get:function(){return k.isNone(this._messagesUnits)}},{key:"test",
get:function(){return{labelContents:this._labelInfos.slice(0,this._nextLabelIndex).map(a=>a.label.text)}}},{key:"_edgeDistancePixels",get:function(){return R[this.edgeDistance]}}]);return v}(G);n.__decorate([p.property()],f.SegmentLabels.prototype,"context",void 0);n.__decorate([p.property()],f.SegmentLabels.prototype,"stagedVertex",void 0);n.__decorate([p.property()],f.SegmentLabels.prototype,"visible",void 0);n.__decorate([p.property()],f.SegmentLabels.prototype,"edgeDistance",void 0);n.__decorate([p.property()],
f.SegmentLabels.prototype,"updating",null);n.__decorate([p.property()],f.SegmentLabels.prototype,"_messagesUnits",void 0);n.__decorate([p.property()],f.SegmentLabels.prototype,"_edgeDistancePixels",null);f.SegmentLabels=n.__decorate([K.subclass("esri.views.interactive")],f.SegmentLabels);const g=D.create(),u=D.create(),S=C.createScreenPointArray(),T=C.createScreenPointArray();Object.defineProperties(f,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});