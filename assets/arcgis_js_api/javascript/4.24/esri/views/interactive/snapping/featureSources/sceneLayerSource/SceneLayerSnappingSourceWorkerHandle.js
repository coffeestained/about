// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/HandleOwner ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3f64 ../../../../../core/workers/WorkerHandle ../../../../../chunks/sphere ../../../../../support/elevationInfoUtils ../../candidates/EdgeSnappingCandidate ../../candidates/VertexSnappingCandidate".split(" "),
function(e,f,m,u,q,D,E,F,v,w,x,y,t,z,A){e.SceneLayerSnappingSourceWorkerHandle=function(n){function k(b){b=n.call(this,b)||this;b.availability=0;b._ids=new Set;b.tmpP=w.create();return b}f._inheritsLoose(k,n);var d=k.prototype;d.destroy=function(){this.workerHandle.destroy();this.workerHandle=null};d.initialize=function(){this.workerHandle=new B(this.schedule,{fetchAllEdgeLocations:(b,a)=>this._fetchAllEdgeLocations(b,a)})};d.fetchCandidates=function(){var b=f._asyncToGenerator(function*(a,c){const g=
a.coordinateHelper.toXYZ(a.point);this.view.renderCoordsHelper.toRenderCoords(g,a.coordinateHelper.spatialReference,g);c=yield this.workerHandle.invoke({bounds:y.fromValues(g[0],g[1],g[2],"number"===typeof a.distance?a.distance:a.distance.pixelSize),types:a.types},c);const r=a.coordinateHelper;c.candidates.sort((l,h)=>l.distance-h.distance);return c.candidates.map(l=>this._convertCandidate(r,l))});return function(a,c){return b.apply(this,arguments)}}();d.add=function(){var b=f._asyncToGenerator(function*(a,
c){this._ids.add(a.id);yield this.workerHandle.invokeMethod("add",a,c)});return function(a,c){return b.apply(this,arguments)}}();d.remove=function(){var b=f._asyncToGenerator(function*(a,c){this._ids.delete(a.id);yield this.workerHandle.invokeMethod("remove",a,c)});return function(a,c){return b.apply(this,arguments)}}();d._convertCandidate=function(b,a){switch(a.type){case "edge":return new z.EdgeSnappingCandidate({coordinateHelper:b,objectId:a.objectId,targetPoint:this._convertRenderCoordinate(b,
a.target),edgeStart:this._convertRenderCoordinate(b,a.start),edgeEnd:this._convertRenderCoordinate(b,a.end),elevationInfo:t.absoluteHeightElevationInfo});case "vertex":return new A.VertexSnappingCandidate({coordinateHelper:b,objectId:a.objectId,targetPoint:this._convertRenderCoordinate(b,a.target),elevationInfo:t.absoluteHeightElevationInfo})}};d._convertRenderCoordinate=function(b,a){this.view.renderCoordsHelper.fromRenderCoords(a,this.tmpP,b.spatialReference);return b.fromXYZ(this.tmpP)};d._fetchAllEdgeLocations=
function(){var b=f._asyncToGenerator(function*(a,c){var g=this;const r=[],l=[];for(const {id:h,uid:C}of a.components)this._ids.has(h)&&r.push(f._asyncToGenerator(function*(){const p=yield g.fetchEdgeLocations(h,c.signal);l.push(p.locations.buffer);return{id:h,uid:C,objectIds:p.objectIds,locations:p.locations.buffer,origin:p.origin,type:p.type}})());return{result:{components:(yield Promise.all(r)).filter(({id:h})=>this._ids.has(h))},transferList:l}});return function(a,c){return b.apply(this,arguments)}}();
return k}(u.HandleOwner);m.__decorate([q.property({constructOnly:!0})],e.SceneLayerSnappingSourceWorkerHandle.prototype,"view",void 0);m.__decorate([q.property({constructOnly:!0})],e.SceneLayerSnappingSourceWorkerHandle.prototype,"fetchEdgeLocations",void 0);m.__decorate([q.property({constructOnly:!0})],e.SceneLayerSnappingSourceWorkerHandle.prototype,"schedule",void 0);m.__decorate([q.property({readOnly:!0})],e.SceneLayerSnappingSourceWorkerHandle.prototype,"availability",void 0);e.SceneLayerSnappingSourceWorkerHandle=
m.__decorate([v.subclass("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],e.SceneLayerSnappingSourceWorkerHandle);let B=function(n){function k(d,b){return n.call(this,"SceneLayerSnappingSourceWorker","fetchCandidates",{},d,{strategy:"dedicated",client:b})||this}f._inheritsLoose(k,n);return k}(x.WorkerHandle);Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});