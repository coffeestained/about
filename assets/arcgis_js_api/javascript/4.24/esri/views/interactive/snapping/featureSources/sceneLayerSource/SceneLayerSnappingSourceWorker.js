// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/set ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/lineSegment ../../../../../chunks/sphere ../../../../../layers/graphics/data/QueryEngineResult ../../../../3d/webgl-engine/lib/Octree ../../../../3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker".split(" "),
function(n,t,A,u,B,G,H,I,J,K,C,l,h,v,p,w,x,D){n.SceneLayerSnappingSourceWorker=function(){function y(){this._idToComponent=new Map;this._components=new x(b=>b.bounds);this._edges=new x(b=>b.bounds);this._tmpLineSegment=v.create();this._tmpP1=h.create();this._tmpP2=h.create();this._tmpP3=h.create();this.remoteClient=null}var g=y.prototype;g.fetchCandidates=function(){var b=t._asyncToGenerator(function*(a,c){yield Promise.resolve();B.throwIfAborted(c);yield this._ensureEdgeLocations(a,c);const d=[];
this._edges.forEachNeighbor(e=>this._addCandidates(a,e,d),a.bounds);return{result:{candidates:d}}});return function(a,c){return b.apply(this,arguments)}}();g._ensureEdgeLocations=function(){var b=t._asyncToGenerator(function*(a,c){const d=[];this._components.forEachNeighbor(e=>{if(u.isNone(e.info)){const {id:k,uid:f}=e;d.push({id:k,uid:f})}},a.bounds);if(d.length){a=yield this.remoteClient.invoke("fetchAllEdgeLocations",{components:d},u.unwrapOr(c,{}));for(const e of a.components)this._setFetchEdgeLocations(e)}});
return function(a,c){return b.apply(this,arguments)}}();g.add=function(){var b=t._asyncToGenerator(function*(a){a=new z(a.id,a.bounds);this._idToComponent.set(a.id,a);this._components.add([a]);return{result:{}}});return function(a){return b.apply(this,arguments)}}();g.remove=function(){var b=t._asyncToGenerator(function*(a){const c=this._idToComponent.get(a.id);if(c){const d=[];this._edges.forEachNeighbor(e=>{e.component===c&&d.push(e)},c.bounds);this._edges.remove(d);this._components.remove([c]);
this._idToComponent.delete(c.id)}return{result:{}}});return function(a){return b.apply(this,arguments)}}();g._setFetchEdgeLocations=function(b){const a=this._idToComponent.get(b.id);if(!u.isNone(a)&&b.uid===a.uid){var c=D.extractComponentsEdgeLocationsLayout.createView(b.locations),d=Array(c.count),e=h.create(),k=h.create();for(let q=0;q<c.count;q++){var f=p.create();const m=p.getCenter(f);c.position0.getVec(q,e);c.position1.getVec(q,k);l.scaleAndAdd(m,m,e,.5);l.scaleAndAdd(m,m,k,.5);l.add(m,m,b.origin);
f[3]=l.distance(m,e);f=new E(a,q,f);d[q]=f}this._edges.add(d);var {objectIds:r,origin:F}=b;a.info={locations:c,objectIds:r,origin:F}}};g._addCandidates=function(b,a,c){const {locations:d,origin:e,objectIds:k}=a.component.info,f=d.position0.getVec(a.index,this._tmpP1),r=d.position1.getVec(a.index,this._tmpP2);l.add(f,f,e);l.add(r,r,e);a=k[d.componentIndex.get(a.index)];this._addEdgeCandidate(b,a,f,r,c);this._addVertexCandidate(b,a,f,c);this._addVertexCandidate(b,a,r,c)};g._addEdgeCandidate=function(b,
a,c,d,e){if(b.types&w.SnappingTypes.EDGE){var k=p.getCenter(b.bounds),f=v.fromPoints(c,d,this._tmpLineSegment);f=v.projectPoint(f,k,this._tmpP3);if(!p.containsPoint(b.bounds,f))return null;e.push({type:"edge",objectId:a,target:h.clone(f),distance:l.distance(k,f),start:h.clone(c),end:h.clone(d)})}};g._addVertexCandidate=function(b,a,c,d){if(b.types&w.SnappingTypes.VERTEX){var e=p.getCenter(b.bounds);if(!p.containsPoint(b.bounds,c))return null;d.push({type:"vertex",objectId:a,target:h.clone(c),distance:l.distance(e,
c)})}};return y}();n.SceneLayerSnappingSourceWorker=A.__decorate([C.subclass("esri.views.interactive.snapping.featureSources.sceneLayerSource.SceneLayerSnappingSourceWorker")],n.SceneLayerSnappingSourceWorker);let z=function a(g,b){this.id=g;this.bounds=b;this.info=null;this.uid=++a.uid};z.uid=0;let E=function(g,b,a){this.component=g;this.index=b;this.bounds=a};n.default=function(){return new n.SceneLayerSnappingSourceWorker};Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});