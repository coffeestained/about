// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/arrayUtils ../../core/Logger ../../core/maybe ../../core/typedArrayUtil ./checkWebGLError ./context-util ./enums".split(" "),function(u,v,x,r,w,n,p,m,e){const f=r.getLogger("esri.views.webgl.BufferObject");r=function(){function g(a,b,c,d){this._context=a;this.bufferType=b;this.usage=c;this._glName=null;this._size=-1;this._indexType=void 0;a.instanceCounter.increment(e.ResourceType.BufferObject,this);this._glName=this._context.gl.createBuffer();
p.checkWebGLError(this._context.gl);d&&this.setData(d)}g.createIndex=function(a,b,c){return new g(a,e.BufferType.ELEMENT_ARRAY_BUFFER,b,c)};g.createVertex=function(a,b,c){return new g(a,e.BufferType.ARRAY_BUFFER,b,c)};g.createUniform=function(a,b,c){if(a.type!==m.ContextType.WEBGL2)throw Error("Uniform buffers are supported in WebGL2 only!");return new g(a,e.BufferType.UNIFORM_BUFFER,b,c)};g.createPixelPack=function(a,b=e.Usage.STREAM_READ,c){if(a.type!==m.ContextType.WEBGL2)throw Error("Pixel pack buffers are supported in WebGL2 only!");
a=new g(a,e.BufferType.PIXEL_PACK_BUFFER,b);c&&a.setSize(c);return a};g.createPixelUnpack=function(a,b=e.Usage.STREAM_DRAW,c){if(a.type!==m.ContextType.WEBGL2)throw Error("Pixel unpack buffers are supported in WebGL2 only!");return new g(a,e.BufferType.PIXEL_UNPACK_BUFFER,b,c)};var k=g.prototype;k.dispose=function(){var a;null!=(a=this._context)&&a.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(e.ResourceType.BufferObject,
this),this._context=null):this._glName&&f.warn("Leaked WebGL buffer object")};k.setSize=function(a,b=null){0>=a&&f.error("Buffer size needs to be positive!");if(this.bufferType===e.BufferType.ELEMENT_ARRAY_BUFFER&&w.isSome(b))switch(this._indexType=b,b){case e.DataType.UNSIGNED_SHORT:a*=2;break;case e.DataType.UNSIGNED_INT:a*=4}this._setBufferData(a)};k.setData=function(a){if(a){var b=a.byteLength;this.bufferType===e.BufferType.ELEMENT_ARRAY_BUFFER&&(n.isUint16Array(a)&&(b/=2,this._indexType=e.DataType.UNSIGNED_SHORT),
n.isUint32Array(a)&&(b/=4,this._indexType=e.DataType.UNSIGNED_INT));this._setBufferData(b,a)}};k._setBufferData=function(a,b=null){this._size=a;const c=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);const d=this._context.gl;w.isSome(b)?d.bufferData(this.bufferType,b,this.usage):d.bufferData(this.bufferType,a,this.usage);p.checkWebGLError(d);this._isVAOAware&&this._context.bindVAO(c)};k.setSubData=function(a,b=0,c=0,d=a.byteLength){if(a){(0>
b||b>=this._size)&&f.error("offset is out of range!");var h=b,l=c,q=d,t=a.byteLength;this.bufferType===e.BufferType.ELEMENT_ARRAY_BUFFER&&(n.isUint16Array(a)?(t/=2,h*=2,l*=2,q*=2):n.isUint32Array(a)&&(t/=4,h*=4,l*=4,q*=4));void 0===d&&(d=t-1);c>=d&&f.error("end must be bigger than start!");b+c-d>this._size&&f.error("An attempt to write beyond the end of the buffer!");b=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);c=this._context.gl;d=ArrayBuffer.isView(a)?
a.buffer:a;a=0===l&&q===a.byteLength?d:d.slice(l,q);c.bufferSubData(this.bufferType,h,a);p.checkWebGLError(c);this._isVAOAware&&this._context.bindVAO(b)}};k.setSubDataFromView=function(a,b,c,d){if(a){(0>b||b>=this._size)&&f.error("offset is out of range!");c>=d&&f.error("end must be bigger than start!");b+c-d>this._size&&f.error("An attempt to write beyond the end of the buffer!");var h=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);var l=
this._context.gl;this._context.type===m.ContextType.WEBGL2?l.bufferSubData(this.bufferType,b*a.BYTES_PER_ELEMENT,a,c,d-c):(c=0===c&&d===a.length?a:a.subarray(c,d),l.bufferSubData(this.bufferType,b*a.BYTES_PER_ELEMENT,c));p.checkWebGLError(l);this._isVAOAware&&this._context.bindVAO(h)}};k.getSubData=function(a,b=0,c,d){if(this._context.type!==m.ContextType.WEBGL2)f.error("Get buffer subdata is supported in WebGL2 only!");else if(0>c||0>d)f.error("Problem getting subdata: offset and length were less than zero!");
else{var h=x.isArrayLike(a)?a.BYTES_PER_ELEMENT:1;h*((null!=c?c:0)+(null!=d?d:0))>a.byteLength?f.error("Problem getting subdata: offset and length exceeded destination size!"):(b+h*(null!=d?d:0)>this.byteSize&&f.warn("Potential problem getting subdata: requested data exceeds buffer size!"),h=this._context.gl,this._context.bindBuffer(this,e.BufferType.COPY_READ_BUFFER),h.getBufferSubData(e.BufferType.COPY_READ_BUFFER,b,a,c,d),this._context.unbindBuffer(e.BufferType.COPY_READ_BUFFER))}};k.getSubDataAsync=
function(){var a=v._asyncToGenerator(function*(b,c=0,d,h){this._context.type!==m.ContextType.WEBGL2?f.error("Get buffer subdata is supported in WebGL2 only!"):(yield this._context.clientWaitAsync(),this.getSubData(b,c,d,h))});return function(b){return a.apply(this,arguments)}}();v._createClass(g,[{key:"glName",get:function(){return this._glName}},{key:"size",get:function(){return this._size}},{key:"indexType",get:function(){return this._indexType}},{key:"byteSize",get:function(){return this.bufferType===
e.BufferType.ELEMENT_ARRAY_BUFFER?this._indexType===e.DataType.UNSIGNED_INT?4*this._size:2*this._size:this._size}},{key:"_isVAOAware",get:function(){return this.bufferType===e.BufferType.ELEMENT_ARRAY_BUFFER||this.bufferType===e.BufferType.ARRAY_BUFFER}}]);return g}();u.BufferObject=r;Object.defineProperties(u,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});