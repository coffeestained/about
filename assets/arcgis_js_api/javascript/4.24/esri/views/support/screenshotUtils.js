// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define(["exports","../../core/has","../../core/mathUtils","../../core/maybe"],function(p,Z,E,Q){function F(a,b){const {format:d,quality:e,rotation:g,disableDecorations:k}=a||{};var c=B(a,b.padding);var f=b.width-c.left-c.right;b=b.height-c.top-c.bottom;c={x:0,y:0,width:f,height:b};if(a&&a.area){null!=a.area.x&&(c.x=Math.floor(a.area.x));null!=a.area.y&&(c.y=Math.floor(a.area.y));var h=null!=a.area.width?Math.floor(a.area.width):null,m=null!=a.area.height?Math.floor(a.area.height):null;c.width=f-c.x;
c.height=b-c.y;null!=h&&null!=m?(c.width=Math.min(c.width,h),c.height=Math.min(c.height,m)):null==h&&null!=m?(h=Math.min(c.width,h),c.height*=h/c.width,c.width=h):null!=h&&null==m&&(h=Math.min(c.height,m),c.width*=h/c.height,c.height=h)}c=R(c,a);h=Math.floor(Math.max(c.x,0));m=Math.floor(Math.max(c.y,0));f={x:h,y:m,width:Math.floor(Math.min(c.width,f-h)),height:Math.floor(Math.min(c.height,b-m))};b=f.width/f.height;c=c.width/c.height;c!==b&&(c>b?(b=Math.floor(f.width/c),f={x:f.x,y:Math.floor(f.y+
(f.height-b)/2),width:f.width,height:b}):(b=Math.floor(f.height*c),f={x:Math.floor(f.x+(f.width-b)/2),y:f.y,width:b,height:f.height}));const {width:n,height:r}=S(a,f);b=G(d);c=H[b];c=E.clamp(null!=e?e:c,0,100);return{format:b,quality:c,area:f,width:n,height:r,rotation:g,disableDecorations:!!k,ignoreBackground:!(!a||!a.ignoreBackground),ignorePadding:!(!a||!a.ignorePadding)}}function I(a,b){Q.isNone(C)&&(C=document.createElement("canvas"));var d=C;if(b.premultipliedAlpha){{var e=a.data;const k=e.length;
for(let c=0;c<k;c+=4){var g=e[c+3];255!==g&&0<g&&(g=255/g,e[c+0]*=g,e[c+1]*=g,e[c+2]*=g)}}}d.width=a.width;d.height=a.height;e=d.getContext("2d");e.putImageData(a,0,0);b.flipY&&(e.save(),e.globalCompositeOperation="copy",e.scale(1,-1),e.translate(0,-e.canvas.height),e.drawImage(e.canvas,0,0),e.restore());return{ctx:e,canvas:d}}function J(a,b){return a.toDataURL(T[b.format],b.quality/100)}function K(a,b,d){d||(v||(v=document.createElement("canvas"),v.width=1,v.height=1),d=v);return d.getContext("2d").createImageData(a,
b)}function S(a,b){if(!a)return b;const d=a.width;a=a.height;if(null!=d&&null!=a)return{width:Math.floor(d),height:Math.floor(a)};if(null==d&&null==a)return b;b=b.width/b.height;return null==a?{width:Math.floor(d),height:Math.floor(d/b)}:{width:Math.floor(a*b),height:Math.floor(a)}}function R(a,b){if(!b||null==b.width||null==b.height)return a;b=b.width/b.height;const d=a.width/a.height;if(d===b)return a;if(d<b)return b=Math.floor(a.height*b),a.x-=(b-a.width)/2,a.width=b,a;b=Math.floor(a.width/b);
a.y-=(b-a.height)/2;a.height=b;return a}function B(a,b){return!b||a&&a.ignorePadding?U:b}function G(a){switch(a){case "png":case "jpg":case "jpeg":return a;case null:case void 0:return"png";default:return"png"}}let C=null,v=null,w=!0;const T={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},H={png:100,jpg:98,jpeg:98},U={top:0,right:0,bottom:0,left:0};p.completeUserSettings=F;p.createEmptyImageData=function(a,b,d){if(!a||!b)throw Error("Cannot construct image data without dimensions");if(w)try{return new ImageData(a,
b)}catch(e){w=!1}return K(a,b,d)};p.encode=function(a,b,d){const {ctx:e,canvas:g}=I(a,d);a=e.getImageData(0,0,a.width,a.height);b=J(g,b);g.width=0;g.height=0;return{dataUrl:b,data:a}};p.encodeData=function(a,b){const {ctx:d,canvas:e}=I(a,b);a=d.getImageData(0,0,a.width,a.height);e.width=0;e.height=0;return a};p.getFormatAndQuality=function(a,b){a=G(a);const d=H[a];b=E.clamp(null!=b?b:d,0,100);return{format:a,quality:b}};p.getMaximumResolutionScale=function(a,b){return b/Math.max(a[0],a[1])};p.resampleHermite=
function(a,b,d,e=0,g=0,k=a.width-e,c=a.height-g,f=!1){const {data:h}=a,{width:m,height:n,data:r}=b;k/=m;c/=n;const V=Math.ceil(k/2),W=Math.ceil(c/2);a=a.width;for(let q=0;q<n;q++)for(let t=0;t<m;t++){const x=4*(t+(f?n-q-1:q)*m);let y=0,L=0,M=0,N=0,O=0,P=0;const X=(q+.5)*c;for(let z=Math.floor(q*c);z<(q+1)*c;z++){var D=Math.abs(X-(z+.5))/W;const Y=(t+.5)*k;D*=D;for(let A=Math.floor(t*k);A<(t+1)*k;A++){var l=Math.abs(Y-(A+.5))/V;l=Math.sqrt(D+l*l);if(1<=l)continue;l=2*l*l*l-3*l*l+1;const u=4*(e+A+(g+
z)*a);P+=l*h[u+3];L+=l;!d&&255>h[u+3]&&(l=l*h[u+3]/255);M+=l*h[u];N+=l*h[u+1];O+=l*h[u+2];y+=l}}r[x]=M/y;r[x+1]=N/y;r[x+2]=O/y;r[x+3]=P/L}return b};p.screenshotSuperSampleSettings=function(a,b,d){if(!b)return a;const {framebufferWidth:e,framebufferHeight:g,pixelRatio:k,region:c}=a;b=B(a,d);d=b.left+b.right;const f=b.top+b.bottom,h=e-d,m=g-f,n=Math.min(8,Math.min((2048-d)/h,(2048-f)/m));return 1.5>n?a:{...a,framebufferWidth:Math.round(h*n)+d,framebufferHeight:Math.round(m*n)+f,pixelRatio:k*n,resample:{region:{x:Math.round((c.x-
b.left)*n)+b.left,y:Math.round((c.y-b.top)*n)+b.top,width:Math.round(c.width*n),height:Math.round(c.height*n)},width:e,height:g}}};p.toDataUrl=J;p.toRenderSettings=function(a,b){const d=F(a,b),e=d.area,g=d.width/e.width,k=B(d,b.padding),c=k.left+k.right,f=k.top+k.bottom;return{framebufferWidth:Math.floor((b.width-c)*g+c),framebufferHeight:Math.floor((b.height-f)*g+f),region:{x:Math.floor(e.x*g)+k.left,y:Math.floor(e.y*g)+k.top,width:d.width,height:d.height},format:d.format,quality:d.quality,rotation:d.rotation,
pixelRatio:g,layers:a&&a.layers?a.layers:[],disableDecorations:d.disableDecorations,ignoreBackground:d.ignoreBackground,ignorePadding:d.ignorePadding}};p.wrapImageData=function(a,b,d,e){if(!b||!d)throw Error("Cannot construct image data without dimensions");if(w)try{return new ImageData(a,b,d)}catch(g){w=!1}b=K(b,d,e);b.data.set(a,0);return b};Object.defineProperties(p,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});