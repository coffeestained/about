// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Handles ../../../../core/reactiveUtils ../../../../core/scheduling ../../viewpointUtils ../../../input/InputHandler ../../../navigation/gamepadAndKeyboardUtils".split(" "),function(l,p,q,m,r,n,g,h){g=function(e){function k(b){var a=e.call(this,!0)||this;a.view=b;a.frameTask=null;a.watchHandles=new q;a.currentDevice=null;a.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0};a.handle=a.registerIncoming("gamepad",
c=>a._handleGamePadEvent(c));a.handle.pause();return a}p._inheritsLoose(k,e);var f=k.prototype;f.onInstall=function(b){e.prototype.onInstall.call(this,b);this.watchHandles.add([m.watch(()=>{var a;return null==(a=this.view.navigation.gamepad)?void 0:a.enabled},a=>{a?(this.handle.resume(),this.frameTask||(this.frameTask=r.addFrameTask({update:c=>this._frameUpdate(c.deltaTime)}))):(this.handle.pause(),this.frameTask&&(this.frameTask.remove(),this.frameTask=null))},m.initial)])};f.onUninstall=function(){this.watchHandles.removeAll();
this.frameTask&&(this.frameTask.remove(),this.frameTask=null);e.prototype.onUninstall.call(this)};f._handleGamePadEvent=function(b){const a=this.view.navigation.gamepad.device;a&&b.data.device!==a||this.currentDevice&&this.currentDevice!==b.data.device||("end"===b.data.action?(this.currentDevice=null,h.resetTransformation(this.transformation)):(this.currentDevice=b.data.device,h.extractTransformation(b.data,this.view.navigation.gamepad,this.transformation)))};f._frameUpdate=function(b){const a=this.transformation;
if(!h.isZeroTransformation(a)){var c=this.view.viewpoint.clone(),d=.7*this.view.navigation.gamepad.velocityFactor*b;n.translateBy(c,c,[a.translation[0]*d,-a.translation[1]*d]);d=this.view.size;n.scaleAndRotateBy(c,c,1+6E-4*a.translation[2]*b,this.view.constraints.rotationEnabled?.06*-a.heading*b:0,[d[0]/2,d[1]],d);b=this.view.constraints.constrain(c,this.view.viewpoint);this.view.viewpoint=b}};return k}(g.InputHandler);l.GamepadNavigation=g;Object.defineProperties(l,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});