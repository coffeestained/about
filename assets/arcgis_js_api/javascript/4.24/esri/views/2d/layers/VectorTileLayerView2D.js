// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/vectorTiles/TileHandler":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/workers/workers ./GlyphMosaic ./GlyphSource ./SpriteMosaic ./decluttering/debugging ../../tiling/TileKey".split(" "),function(A,D,v,x,e,q,b,c,a,d){let g=function(){function l(m,h,u){this._layer=m;this._styleRepository=h;this.devicePixelRatio=u;this._connection=this._glyphMosaic=this._spriteMosaic=
null}var p=l.prototype;p.destroy=function(){this._connection&&(this._connection.close(),this._connection=null);this._layer=this._styleRepository=null;this._spriteMosaic&&(this._spriteMosaic=null);this._glyphMosaic&&(this._glyphMosaic=null)};p.start=function(){var m=D._asyncToGenerator(function*(h){this._spriteSourcePromise=this._layer.loadSpriteSource(this.devicePixelRatio,h);this._spriteSourcePromise.then(w=>{this._spriteMosaic=new c(1024,1024,250);this._spriteMosaic.setSpriteSource(w)});const u=
new b(this._layer.currentStyleInfo.glyphsUrl?x.addQueryParameters(this._layer.currentStyleInfo.glyphsUrl,{...this._layer.customParameters,token:this._layer.apiKey}):null);this._glyphMosaic=new q(1024,1024,u);this._broadcastPromise=e.open("WorkerTileHandler",{client:this,schedule:h.schedule,signal:h.signal}).then(w=>{this._connection=w;this._connection.broadcast("setStyle",this._layer.currentStyleInfo.style,h)})});return function(h){return m.apply(this,arguments)}}();p.updateStyle=function(){var m=
D._asyncToGenerator(function*(h){yield this._broadcastPromise;return this._broadcastPromise=Promise.all(this._connection.broadcast("updateStyle",h))});return function(h){return m.apply(this,arguments)}}();p.setSpriteSource=function(m){const h=new c(1024,1024,250);h.setSpriteSource(m);this._spriteMosaic=h;this._spriteSourcePromise=Promise.resolve(m);return h};p.setStyle=function(){var m=D._asyncToGenerator(function*(h,u){yield this._broadcastPromise;this._styleRepository=h;this._spriteSourcePromise=
this._layer.loadSpriteSource(this.devicePixelRatio,null);this._spriteSourcePromise.then(w=>{this._spriteMosaic=new c(1024,1024,250);this._spriteMosaic.setSpriteSource(w)});h=new b(this._layer.currentStyleInfo.glyphsUrl?x.addQueryParameters(this._layer.currentStyleInfo.glyphsUrl,{...this._layer.customParameters,token:this._layer.apiKey}):null);this._glyphMosaic=new q(1024,1024,h);return this._broadcastPromise=Promise.all(this._connection.broadcast("setStyle",u))});return function(h,u){return m.apply(this,
arguments)}}();p.fetchTileData=function(m,h){return this._getRefKeys(m,h).then(u=>{const w=this._layer.sourceNameToSource,k=[];for(const t in w)k.push(t);return this._getSourcesData(k,u,h)})};p.parseTileData=function(m,h){const u=m&&m.data;if(!u)return Promise.resolve(null);const {sourceName2DataAndRefKey:w,transferList:k}=u;return 0===Object.keys(w).length?Promise.resolve(null):this._broadcastPromise.then(()=>this._connection.invoke("createTileAndParse",{key:m.key.id,sourceName2DataAndRefKey:w,styleLayerUIDs:m.styleLayerUIDs},
{...h,transferList:k}))};p.getSprites=function(){var m=D._asyncToGenerator(function*(h){yield this._spriteSourcePromise;return this._spriteMosaic.getSpriteItems(h)});return function(h){return m.apply(this,arguments)}}();p.getGlyphs=function(m){return this._glyphMosaic.getGlyphItems(m.font,m.codePoints)};p.perfReport=function({key:m,milliseconds:h}){a.perfAdd(m,h,"ms")};p._getTilePayload=function(){var m=D._asyncToGenerator(function*(h,u,w){h=d.pool.acquire(h.id);const k=this._layer.sourceNameToSource[u],
{level:t,row:C,col:I}=h;d.pool.release(h);try{return{protobuff:yield k.requestTile(t,C,I,w),sourceName:u}}catch(H){if(v.isAbortError(H))throw H;return{protobuff:null,sourceName:u}}});return function(h,u,w){return m.apply(this,arguments)}}();p._getRefKeys=function(m,h){const u=this._layer.sourceNameToSource,w=[];for(const k in u){const t=u[k].getRefKey(m,h);w.push(t)}return v.eachAlways(w)};p._getSourcesData=function(m,h,u){const w=[];for(let k=0;k<h.length;k++)if(null==h[k].value||null==m[k])w.push(null);
else{const t=this._getTilePayload(h[k].value,m[k],u);w.push(t)}return v.eachAlways(w).then(k=>{const t={},C=[];for(let I=0;I<k.length;I++)k[I].value&&k[I].value&&k[I].value.protobuff&&0<k[I].value.protobuff.byteLength&&(t[k[I].value.sourceName]={refKey:h[I].value.id,protobuff:k[I].value.protobuff},C.push(k[I].value.protobuff));return{sourceName2DataAndRefKey:t,transferList:C}})};D._createClass(l,[{key:"spriteMosaic",get:function(){return this._spriteSourcePromise.then(()=>this._spriteMosaic)}},{key:"glyphMosaic",
get:function(){return this._glyphMosaic}}]);return l}();A.TileHandler=g;Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/GlyphMosaic":function(){define(["./RectangleBinPack","../webgl/Rect","../../../webgl/enums","../../../webgl/Texture"],function(A,D,v,x){return function(){function e(b,c,a){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphIndex={};this._textures=[];this._rangePromises=
new Map;this.width=b;this.height=c;this._glyphSource=a;this._binPack=new A(b-4,c-4);this._glyphData.push(new Uint8Array(b*c));this._dirties.push(!0);this._textures.push(void 0)}var q=e.prototype;q.getGlyphItems=function(b,c){const a=[],d=this._glyphSource,g=new Set,l=1/256;for(const m of c)g.add(Math.floor(m*l));const p=[];g.forEach(m=>{if(256>=m){const h=b+m;this._rangePromises.has(h)?p.push(this._rangePromises.get(h)):(m=d.getRange(b,m).then(()=>{this._rangePromises["delete"](h)},()=>{this._rangePromises["delete"](h)}),
this._rangePromises.set(h,m),p.push(m))}});return Promise.all(p).then(()=>{let m=this._glyphIndex[b];m||(m={},this._glyphIndex[b]=m);for(const t of c){var h=m[t];if(h){a[t]={sdf:!0,rect:h.rect,metrics:h.metrics,page:h.page,code:t};continue}var u=d.getGlyph(b,t);if(!u||!u.metrics)continue;h=u.metrics;let C;if(0===h.width)C=new D(0,0,0,0);else{const I=h.width+6,H=h.height+6;var w=I%4?4-I%4:4,k=H%4?4-H%4:4;1===w&&(w=5);1===k&&(k=5);C=this._binPack.allocate(I+w,H+k);C.isEmpty&&(this._dirties[this._currentPage]||
(this._glyphData[this._currentPage]=null),this._currentPage=this._glyphData.length,this._glyphData.push(new Uint8Array(this.width*this.height)),this._dirties.push(!0),this._textures.push(void 0),this._binPack=new A(this.width-4,this.height-4),C=this._binPack.allocate(I+w,H+k));w=this._glyphData[this._currentPage];u=u.bitmap;let B;if(u)for(let y=0;y<H;y++){k=I*y;B=this.width*(C.y+y+1)+C.x;for(let F=0;F<I;F++)w[B+F+1]=u[k+F]}}m[t]={rect:C,metrics:h,tileIDs:null,page:this._currentPage};a[t]={sdf:!0,
rect:C,metrics:h,page:this._currentPage,code:t};this._dirties[this._currentPage]=!0}return a})};q.removeGlyphs=function(b){for(const c in this._glyphIndex){const a=this._glyphIndex[c];if(!a)continue;let d;for(const g in a)if(d=a[g],d.tileIDs["delete"](b),0===d.tileIDs.size){const l=this._glyphData[d.page],p=d.rect;let m,h;for(let u=0;u<p.height;u++)for(m=this.width*(p.y+u)+p.x,h=0;h<p.width;h++)l[m+h]=0;delete a[g];this._dirties[d.page]=!0}}};q.bind=function(b,c,a,d=0){this._textures[a]||(this._textures[a]=
new x.Texture(b,{pixelFormat:v.PixelFormat.ALPHA,dataType:v.PixelType.UNSIGNED_BYTE,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));const g=this._textures[a];g.setSamplingMode(c);this._dirties[a]&&g.setData(this._glyphData[a]);b.bindTexture(g,d);this._dirties[a]=!1};q.dispose=function(){this._binPack=null;for(const b of this._textures)b&&b.dispose();this._textures.length=0};return e}()})},"esri/views/2d/engine/vectorTiles/RectangleBinPack":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"../webgl/Rect"],function(A,D){return function(){function v(e,q){this._height=this._width=0;this._free=[];this._width=e;this._height=q;this._free.push(new D(0,0,e,q))}var x=v.prototype;x.allocate=function(e,q){if(e>this._width||q>this._height)return new D;let b=null,c=-1;for(let a=0;a<this._free.length;++a){const d=this._free[a];e<=d.width&&q<=d.height&&(null===b||d.y<=b.y&&d.x<=b.x)&&(b=d,c=a)}if(null===b)return new D;this._free.splice(c,1);b.width<b.height?(b.width>e&&this._free.push(new D(b.x+
e,b.y,b.width-e,q)),b.height>q&&this._free.push(new D(b.x,b.y+q,b.width,b.height-q))):(b.width>e&&this._free.push(new D(b.x+e,b.y,b.width-e,b.height)),b.height>q&&this._free.push(new D(b.x,b.y+q,e,b.height-q)));return new D(b.x,b.y,e,q)};x.release=function(e){for(let q=0;q<this._free.length;++q){const b=this._free[q];if(b.y===e.y&&b.height===e.height&&b.x+b.width===e.x)b.width+=e.width;else if(b.x===e.x&&b.width===e.width&&b.y+b.height===e.y)b.height+=e.height;else if(e.y===b.y&&e.height===b.height&&
e.x+e.width===b.x)b.x=e.x,b.width+=e.width;else if(e.x===b.x&&e.width===b.width&&e.y+e.height===b.y)b.y=e.y,b.height+=e.height;else continue;this._free.splice(q,1);this.release(e)}this._free.push(e)};A._createClass(v,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]);return v}()})},"esri/views/2d/engine/vectorTiles/GlyphSource":function(){define(["../../../../request","../../../../core/pbf"],function(A,D){let v=function(){function e(b){this._metrics=
[];this._bitmaps=[];if(b)for(;b.next();)switch(b.tag()){case 1:{const c=b.getMessage();for(;c.next();)switch(c.tag()){case 3:{const a=c.getMessage();let d,g,l,p,m,h,u;for(;a.next();)switch(a.tag()){case 1:d=a.getUInt32();break;case 2:g=a.getBytes();break;case 3:l=a.getUInt32();break;case 4:p=a.getUInt32();break;case 5:m=a.getSInt32();break;case 6:h=a.getSInt32();break;case 7:u=a.getUInt32();break;default:a.skip()}a.release();d&&(this._metrics[d]={width:l,height:p,left:m,top:h,advance:u},this._bitmaps[d]=
g);break}default:c.skip()}c.release();break}default:b.skip()}}var q=e.prototype;q.getMetrics=function(b){return this._metrics[b]};q.getBitmap=function(b){return this._bitmaps[b]};return e}(),x=function(){function e(){this._ranges=[]}var q=e.prototype;q.getRange=function(b){return this._ranges[b]};q.addRange=function(b,c){this._ranges[b]=c};return e}();return function(){function e(b){this._glyphInfo={};this._baseURL=b}var q=e.prototype;q.getRange=function(b,c){const a=this._getFontStack(b);if(a.getRange(c))return Promise.resolve();
const d=256*c,g=d+255;if(this._baseURL)return b=this._baseURL.replace("{fontstack}",b).replace("{range}",d+"-"+g),A(b,{responseType:"array-buffer"}).then(l=>{a.addRange(c,new v(new D(new Uint8Array(l.data),new DataView(l.data))))}).catch(()=>{a.addRange(c,new v)});a.addRange(c,new v);return Promise.resolve()};q.getGlyph=function(b,c){if(b=this._getFontStack(b)){var a=Math.floor(c/256);if(!(256<a)&&(b=b.getRange(a)))return{metrics:b.getMetrics(c),bitmap:b.getBitmap(c)}}};q._getFontStack=function(b){let c=
this._glyphInfo[b];c||(c=this._glyphInfo[b]=new x);return c};return e}()})},"esri/views/2d/engine/vectorTiles/SpriteMosaic":function(){define(["../../../../symbols/cim/CIMSymbolHelper","./RectangleBinPack","../webgl/Rect","../../../webgl/enums","../../../webgl/Texture"],function(A,D,v,x,e){return function(){function q(c,a,d=0){this._size=[];this._mosaicsData=[];this._textures=[];this._dirties=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects={};this.pixelRatio=
1;(0>=c||0>=a)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");this._pageWidth=c;this._pageHeight=a;0<d&&(this._maxItemSize=d);this._binPack=new D(c-4,a-4)}var b=q.prototype;b.dispose=function(){this._binPack=null;this._mosaicRects={};for(const c of this._textures)c&&c.dispose();this._textures.length=0};b.getWidth=function(c){return c>=this._size.length?-1:this._size[c][0]};b.getHeight=function(c){return c>=this._size.length?-1:this._size[c][1]};b.getPageSize=
function(c){return c>=this._size.length?null:this._size[c]};b.setSpriteSource=function(c){this.dispose();this.pixelRatio=c.devicePixelRatio;if(0===this._mosaicsData.length){this._binPack=new D(this._pageWidth-4,this._pageHeight-4);const a=new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight));this._mosaicsData[0]=a;this._dirties.push(!0);this._size.push([this._pageWidth,this._pageHeight]);this._textures.push(void 0)}this._sprites=c};b.getSpriteItem=function(c,a=!1){var d=this._mosaicRects[c];
if(d)return d;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;let g;c&&c.startsWith("dasharray-")?([d,g]=this._rasterizeDash(c),a=!0):d=this._sprites.getSpriteInfo(c);if(!d||!d.width||!d.height||0>d.width||0>d.height)return null;const l=d.width,p=d.height,[m,h,u]=this._allocateImage(l,p);if(0>=m.width)return null;this._copy(m,d,h,u,a,g);d={rect:m,width:l,height:p,sdf:d.sdf,simplePattern:!1,pixelRatio:d.pixelRatio,page:h};return this._mosaicRects[c]=d};b.getSpriteItems=function(c){const a=
{};for(const d of c)a[d.name]=this.getSpriteItem(d.name,d.repeat);return a};b.getMosaicItemPosition=function(c,a){a=(c=this.getSpriteItem(c,a))&&c.rect;if(!a)return null;a.width=c.width;a.height=c.height;return{tl:[a.x+2,a.y+2],br:[a.x+2+c.width,a.y+2+c.height],page:c.page}};b.bind=function(c,a,d=0,g=0){this._textures[d]||(this._textures[d]=new e.Texture(c,{pixelFormat:x.PixelFormat.RGBA,dataType:x.PixelType.UNSIGNED_BYTE,wrapMode:x.TextureWrapMode.CLAMP_TO_EDGE,width:this._size[d][0],height:this._size[d][1]},
new Uint8Array(this._mosaicsData[d].buffer)));const l=this._textures[d];l.setSamplingMode(a);this._dirties[d]&&l.setData(new Uint8Array(this._mosaicsData[d].buffer));c.bindTexture(l,g);this._dirties[d]=!1};q._copyBits=function(c,a,d,g,l,p,m,h,u,w,k){let t=g*a+d;m=h*p+m;if(k)for(m-=p,k=-1;k<=w;k++,t=((k+w)%w+g)*a+d,m+=p)for(h=-1;h<=u;h++)l[m+h]=c[t+(h+u)%u];else for(d=0;d<w;d++){for(g=0;g<u;g++)l[m+g]=c[t+g];t+=a;m+=p}};b._copy=function(c,a,d,g,l,p){if(this._sprites&&"loaded"===this._sprites.loadStatus&&
!(d>=this._mosaicsData.length)){var m=new Uint32Array(p?p.buffer:this._sprites.image.buffer),h=this._mosaicsData[d];h&&m||console.error("Source or target images are uninitialized!");q._copyBits(m,p?a.width:this._sprites.width,a.x,a.y,h,g[0],c.x+2,c.y+2,a.width,a.height,l);this._dirties[d]=!0}};b._allocateImage=function(c,a){c+=2;a+=2;var d=Math.max(c,a);if(this._maxItemSize&&this._maxItemSize<d)return d=new v(0,0,c,a),this._mosaicsData.push(new Uint32Array(c*a)),this._dirties.push(!0),this._size.push([c,
a]),this._textures.push(void 0),[d,this._mosaicsData.length-1,[c,a]];d=c%4?4-c%4:4;let g=a%4?4-a%4:4;1===d&&(d=5);1===g&&(g=5);d=this._binPack.allocate(c+d,a+g);return 0>=d.width?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new D(this._pageWidth-
4,this._pageHeight-4),this._allocateImage(c,a)):[d,this._currentPage,[this._pageWidth,this._pageHeight]]};b._rasterizeDash=function(c){var a=c.match(/\[(.*?)\]/);if(!a)return null;a=a[1].split(",").map(Number);c=c.slice(c.lastIndexOf("-")+1);const [d,g,l]=A.SymbolHelper.rasterizeDash(a,c);c=new Uint8Array(d.buffer);return[{x:0,y:0,width:g,height:l,sdf:!0,pixelRatio:1},c]};return q}()})},"esri/views/2d/engine/vectorTiles/decluttering/debugging":function(){define(["exports"],function(A){function D(v,
x){return`${Math.round(10*v)/10}${x}`}A.drawColliders=function(v,x){const e=window.COLLISION_XRAY;for(let p=0;p<x.length;++p){const m=!x[p].unique.show;if(e||!m)for(const h of x[p].colliders){if(!h.enabled)continue;var q=!x[p].unique.parts[h.partIndex].show;if(!e&&q)continue;var b=h.xScreen,c=h.yScreen;const u=h.dxScreen,w=h.dyScreen;v.globalAlpha=m||q?.2:1;q=v;var a=b-1,d=c-1;q.fillStyle="green";q.fillRect(a,d,3,3);q=v;a=b+u;d=c+w;var g=h.width,l=h.height;q.strokeStyle="red";q.strokeRect(a,d,g,l);
q=v;b=b+u-1;c=c+w-1;q.fillStyle="blue";q.fillRect(b,c,3,3);v.globalAlpha=1}}};A.drawGridIndex=function(v,x){v.strokeStyle="black";const e=x.cellSize,q=x.rows,b=x.columns;for(let c=0;c<q;c++){const a=x.cells[c],d=c*e,g=(c+1)*e;for(let l=0;l<b;l++){const p=a[l],m=l*e;v.strokeRect(m,d,(l+1)*e-m,g-d);v.fillText(`cells:${p.length}`,m+4,d+12)}}};A.perfAdd=function(v,x,e){if(window.PERFORMANCE_RECORDING_STORAGE){var q=window.PERFORMANCE_RECORDING_STORAGE;q.perf=q.perf||{};q=q.perf;q[v]=q[v]||{start:null,
time:0,min:void 0,max:void 0,samples:[],unit:e};q[v].time+=x;q[v].samples.push(x);if(null==q[v].min||x<q[v].min)q[v].min=x;if(null==q[v].max||x>q[v].max)q[v].max=x}};A.perfClear=function(){window.PERFORMANCE_RECORDING_STORAGE&&(window.PERFORMANCE_RECORDING_STORAGE.perf={})};A.perfElement=function(v){if(!window.PERFORMANCE_RECORDING_STORAGE){var x=document.createElement("div");x.innerHTML="No recorded data is present because performance recording is disabled.";return x}x=document.createElement("div");
var e=window.PERFORMANCE_RECORDING_STORAGE.perf;var q='\x3ctable style\x3d"border-collapse: collapse;"\x3e'+`<tr style="text-weight: bold; border-bottom: 1px solid "${v}";"><td>Name</td><td>Total</td><td>Runs</td><td>Average</td><td>Min</td><td>Distribution</td><td>Max</td><td>Histogram (${50} bins)</td></tr>`;const b=[];for(var c in e)b.push({name:c,value:e[c].time/e[c].samples.length,sortkey:e[c].max});b.sort((m,h)=>-(m.sortkey-h.sortkey));c=b.map(m=>m.name);for(var a of c)q+="\x3ctr\x3e",q+=`<td>${a}</td>`,
q+=`<td>${D(e[a].time,e[a].unit)}</td>`,q+=`<td>${e[a].samples.length}</td>`,q+=`<td>${D(e[a].time/e[a].samples.length,e[a].unit)}</td>`,q+=`<td style="text-align: right;">${D(e[a].min,e[a].unit)}</td>`,q+="\x3ctd data-distribution\x3d'1'\x3e\x3c/td\x3e",q+=`<td>${D(e[a].max,e[a].unit)}</td>`,q+="\x3ctd data-histogram\x3d'1'\x3e\x3c/td\x3e",q+="\x3c/tr\x3e";x.innerHTML=q+"\x3ctable\x3e";q=x.querySelectorAll("td[data-distribution\x3d'1']");a=x.querySelectorAll("td[data-histogram\x3d'1']");for(let m=
0;m<q.length;m++){let h=q[m];var d=document.createElement("canvas");d.height=10;d.width=100;var g=d.getContext("2d");g.strokeStyle=v;g.beginPath();g.moveTo(0,5);g.lineTo(100,5);if(e[c[m]].max>e[c[m]].min+.001)for(const u of e[c[m]].samples){var l=(u-e[c[m]].min)/(e[c[m]].max-e[c[m]].min);g.moveTo(100*l,3);g.lineTo(100*l,7)}g.stroke();g.strokeRect((b[m].value-e[c[m]].min)/(e[c[m]].max-e[c[m]].min)*100-2,0,4,9);h.appendChild(d);h=a[m];{d=Array(50);for(g=0;g<d.length;g++)d[g]=0;for(const w of e[c[m]].samples)g=
(w-e[c[m]].min)/(e[c[m]].max-e[c[m]].min),d[1===g?d.length-1:Math.floor(g*d.length)]++;g=document.createElement("canvas");g.height=30;g.width=120;l=g.getContext("2d");l.strokeStyle=v;l.fillStyle=v;let u=0;for(var p=0;p<d.length;p++)u=Math.max(u,d[p]);for(p=0;p<d.length;p++){const w=d[p];l.fillRect(p*g.width/d.length,g.height*(1-w/u),g.width/d.length,w/u*g.height)}l.beginPath();l.moveTo(0,g.height);l.lineTo(g.width,g.height);l.stroke();h.appendChild(g)}}v=x.querySelectorAll("td");for(e=0;e<v.length;e++)v[e].style.padding=
"5px";return x};Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/TileManager":function(){define(["exports","../../../../core/LRUCache","../../../../core/maybe","../../tiling/TileCoverage","../../tiling/TileKey"],function(A,D,v,x,e){const q=(c,a)=>c+1/(1<<2*a);let b=function(){function c(d,g){this._tiles=new Map;this._tileCache=new D(40,l=>l.dispose());this._viewSize=[0,0];this._visibleTiles=new Map;this.acquireTile=d.acquireTile;
this.releaseTile=d.releaseTile;this.tileInfoView=d.tileInfoView;this._container=g}var a=c.prototype;a.destroy=function(){for(const [,d]of this._tiles)d.dispose();this._tiles=null;this._tileCache.clear();this._tileCache=null};a.update=function(d){this._updateCacheSize(d);const g=this.tileInfoView;d=g.getTileCoverage(d.state,0,"smallest");const {spans:l,lodInfo:p}=d,{level:m}=p,h=this._tiles,u=new Set,w=new Set;for(const {row:t,colFrom:C,colTo:I}of l)for(let H=C;H<=I;H++){const B=e.getId(m,t,p.normalizeCol(H),
p.getWorldForColumn(H)),y=this._getOrAcquireTile(B);u.add(B);y.processed()?this._addToContainer(y):w.add(new e(B))}for(const [t,C]of h)C.isCoverage=u.has(t);for(var k of w)this._findPlaceholdersForMissingTiles(k,u);k=!1;for(const [t,C]of h)C.neededForCoverage=u.has(t),C.neededForCoverage||C.isHoldingForFade&&g.intersects(d,C.key)&&u.add(t),C.isFading&&(k=!0);for(const [t]of this._tiles)u.has(t)||this._releaseTile(t);x.pool.release(d);return!k};a.clear=function(){this._tiles.clear();this._tileCache.clear();
this._visibleTiles.clear()};a.clearCache=function(){this._tileCache.clear()};a._findPlaceholdersForMissingTiles=function(d,g){var l=[];for(const [,p]of this._tiles)this._addPlaceholderChild(l,p,d,g);l=l.reduce(q,0);1E-6>Math.abs(1-l)||this._addPlaceholderParent(d.id,g)};a._addPlaceholderChild=function(d,g,l,p){if(!(g.key.level<=l.level)&&g.hasData()){{var m=g.key;const h=m.level-l.level;m=l.row===m.row>>h&&l.col===m.col>>h&&l.world===m.world}m&&(this._addToContainer(g),p.add(g.id),d.push(g.key.level-
l.level))}};a._addPlaceholderParent=function(d,g){const l=this._tiles;for(;;){{const [m,h,u,w]=d.split("/");d=parseInt(m,10);d=0===d?null:`${d-1}/${parseInt(h,10)>>1}/${parseInt(u,10)>>1}/${parseInt(w,10)}`}if(!d||g.has(d))break;const p=l.get(d);if(p&&p.hasData()){this._addToContainer(p);g.add(p.id);break}}};a._getOrAcquireTile=function(d){let g=this._tiles.get(d);if(g)return g;(g=this._tileCache.pop(d))||(g=this.acquireTile(new e(d)));this._tiles.set(d,g);return g};a._releaseTile=function(d){const g=
this._tiles.get(d);this.releaseTile(g);this._removeFromContainer(g);this._tiles.delete(d);g.hasData()?this._tileCache.put(d,g,1):g.dispose()};a._addToContainer=function(d){let g;const l=[],p=this._container;if(!p.contains(d)){var m=this._visibleTiles;for(const [,h]of m)this._canConnectDirectly(d,h)&&l.push(h),v.isNone(g)&&this._canConnectDirectly(h,d)&&(g=h);if(v.isSome(g)){for(const h of l)g.childrenTiles.delete(h),d.childrenTiles.add(h),h.parentTile=d;g.childrenTiles.add(d);d.parentTile=g}else for(const h of l)d.childrenTiles.add(h),
h.parentTile=d;m.set(d.id,d);p.addChild(d)}};a._removeFromContainer=function(d){this._visibleTiles.delete(d.id);this._container.removeChild(d);if(v.isSome(d.parentTile)){d.parentTile.childrenTiles.delete(d);for(const g of d.childrenTiles)v.isSome(d.parentTile)&&d.parentTile.childrenTiles.add(g)}for(const g of d.childrenTiles)g.parentTile=d.parentTile;d.parentTile=null;d.childrenTiles.clear()};a._canConnectDirectly=function(d,g){d=d.key;let {level:l,row:p,col:m,world:h}=g.key;for(g=this._visibleTiles;0<
l;){l--;p>>=1;m>>=1;if(d.level===l&&d.row===p&&d.col===m&&d.world===h)return!0;if(g.has(`${l}/${p}/${m}/${h}`))break}return!1};a._updateCacheSize=function(d){d=d.state.size;if(d[0]!==this._viewSize[0]||d[1]!==this._viewSize[1]){var g=Math.ceil(d[0]/512)+1,l=Math.ceil(d[1]/512)+1;this._viewSize[0]=d[0];this._viewSize[1]=d[1];this._tileCache.maxSize=5*g*l}};return c}();A.TileManager=b;Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ./enums ./RenderBucket ./decluttering/config ../webgl/TiledDisplayObject".split(" "),
function(A,D,v,x,e,q,b,c,a){a=function(g){function l(m,h,u,w,k,t,C=null){h=g.call(this,m,h,u,w,k,4096,4096)||this;h._memCache=C;h.type="vector-tile";h._referenced=0;h._hasSymbolBuckets=!1;h._memoryUsedByLayerData=0;h.layerData=new Map;h.layerCount=0;h.status="loading";h.allSymbolsFadingOut=!1;h.lastOpacityUpdate=0;h.symbols=new Map;h.isCoverage=!1;h.neededForCoverage=!1;h.decluttered=!1;h.invalidating=!1;h.parentTile=null;h.childrenTiles=new Set;h._processed=!1;h._referenced=1;h.styleRepository=t;
h.id=m.id;return h}D._inheritsLoose(l,g);var p=l.prototype;p.setData=function(m){this.changeDataImpl(m);this.requestRender();this.ready();this.invalidating=!1;this._processed=!0};p.deleteLayerData=function(m){let h=!1;for(const u of m)this.layerData.has(u)&&(m=this.layerData.get(u),this._memoryUsedByLayerData-=m.memoryUsed,m.type===q.BucketType.SYMBOL&&this.symbols.has(u)&&(this.symbols.delete(u),h=!0),m.destroy(),this.layerData.delete(u),this.layerCount--);v.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,
this,this._memoryUsedByLayerData);h&&this.emit("symbols-changed");this.requestRender()};p.processed=function(){return this._processed};p.hasData=function(){return 0<this.layerCount};p.dispose=function(){"unloaded"!==this.status&&(d.delete(this),l._destroyRenderBuckets(this.layerData),this.layerData=null,this._memoryUsedByLayerData=this.layerCount=0,this.destroy(),this.status="unloaded")};p.release=function(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1};p.retain=function(){++this._referenced};
p.changeDataImpl=function(m){let h=!1;if(m){const {bucketsWithData:u,emptyBuckets:w}=m;m=this._createRenderBuckets(u);if(w&&0<w.byteLength){const k=new Uint32Array(w);for(const t of k)this._deleteLayerData(t)}for(const [k,t]of m)this._deleteLayerData(k),t.type===q.BucketType.SYMBOL&&(this.symbols.set(k,t.symbols),h=!0),this._memoryUsedByLayerData+=t.memoryUsed,this.layerData.set(k,t),this.layerCount++;v.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=
!1;for(const [,u]of this.layerData)u.type===q.BucketType.SYMBOL&&(this._hasSymbolBuckets=!0);h&&this.emit("symbols-changed")};p.attachWithContext=function(m){this.stage={context:m,trashDisplayObject(h){h.processDetach()},untrashDisplayObject(){return!1}}};p.setTransform=function(m,h){g.prototype.setTransform.call(this,m,h);var u=h/(m.resolution*m.pixelRatio);h=this.width/this.rangeX*u;u*=this.height/this.rangeY;const w=[0,0];m.toScreen(w,[this.x,this.y]);const k=this.transforms.tileUnitsToPixels;
x.identity(k);x.translate(k,k,w);x.rotate(k,k,Math.PI*m.rotation/180);x.scale(k,k,[h,u,1])};p._createTransforms=function(){return{dvs:e.create(),tileMat3:e.create(),tileUnitsToPixels:e.create()}};l._destroyRenderBuckets=function(m){if(m){var h=new Set;m.forEach(u=>{h.has(u)||(u.destroy(),h.add(u))});m.clear()}};p._createRenderBuckets=function(m){const h=new Map,u=new Map;for(const w of m){m=this._deserializeBucket(w,u);for(const k of m.layerUIDs)h.set(k,m)}return h};p._deserializeBucket=function(m,
h){let u=h.get(m);if(u)return u;switch((new Uint32Array(m))[0]){case q.BucketType.FILL:u=new b.FillRenderBucket(m,this.styleRepository);break;case q.BucketType.LINE:u=new b.LineRenderBucket(m,this.styleRepository);break;case q.BucketType.SYMBOL:u=new b.SymbolRenderBucket(m,this.styleRepository,this);break;case q.BucketType.CIRCLE:u=new b.CircleRenderBucket(m,this.styleRepository)}h.set(m,u);return u};p._deleteLayerData=function(m){if(this.layerData.has(m)){var h=this.layerData.get(m);this._memoryUsedByLayerData-=
h.memoryUsed;h.destroy();this.layerData.delete(m);this.layerCount--}};D._createClass(l,[{key:"hasSymbolBuckets",get:function(){return this._hasSymbolBuckets}},{key:"isFading",get:function(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<c.FADE_DURATION}},{key:"isHoldingForFade",get:function(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<c.FADE_DURATION)}},{key:"wasRequested",get:function(){return"errored"===this.status||
"loaded"===this.status||"reloading"===this.status}},{key:"referenced",get:function(){return this._referenced}},{key:"memoryUsage",get:function(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}}]);return l}(a.TiledDisplayObject);const d=new Map;A.VectorTile=a;A.printAllocations=function(){d.forEach((g,l)=>{console.log(`\n${l.key}:`);g[0].forEach(p=>console.log(p));console.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");g[1].forEach(p=>console.log(p))})};Object.defineProperties(A,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./enums ./decluttering/util ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),function(A,D,v,x,e,q,b,c){let a=function(){function m(u,w){this.layerUIDs=[];this.isDestroyed=!1;this.data=u;this.memoryUsed=u.byteLength;let k=1;u=new Uint32Array(u);this.layerUIDs=[];const t=
u[k++];for(let C=0;C<t;C++)this.layerUIDs[C]=u[k++];this.bufferDataOffset=k;w&&(this.layer=w.getStyleLayerByUID(this.layerUIDs[0]))}var h=m.prototype;h.destroy=function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)};h.prepareForRendering=function(u){v.isNone(this.data)||(this.doPrepareForRendering(u,this.data,this.bufferDataOffset),this.data=null)};D._createClass(m,[{key:"isPreparedForRendering",get:function(){return v.isNone(this.data)}},{key:"offset",get:function(){return this.bufferDataOffset}}]);
return m}(),d=function(m){function h(w,k){k=m.call(this,w,k)||this;k.type=x.BucketType.LINE;k.lineIndexStart=0;k.lineIndexCount=0;w=new Uint32Array(w);let t=k.bufferDataOffset;k.lineIndexStart=w[t++];k.lineIndexCount=w[t++];const C=w[t++];if(0<C){const I=new Map;for(let H=0;H<C;H++){const B=w[t++],y=w[t++],F=w[t++];I.set(B,[y,F])}k.patternMap=I}k.bufferDataOffset=t;return k}D._inheritsLoose(h,m);var u=h.prototype;u.hasData=function(){return 0<this.lineIndexCount};u.triangleCount=function(){return this.lineIndexCount/
3};u.doDestroy=function(){v.isSome(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose();v.isSome(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose();v.isSome(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose();this.lineIndexBuffer=this.lineVertexBuffer=this.lineVertexArrayObject=null;this.memoryUsed=0};u.doPrepareForRendering=function(w,k,t){k=new Uint32Array(k);var C=new Int32Array(k.buffer);const I=k[t++];this.lineVertexBuffer=q.BufferObject.createVertex(w,b.Usage.STATIC_DRAW,
new Int32Array(C.buffer,4*t,I));t+=I;C=k[t++];this.lineIndexBuffer=q.BufferObject.createIndex(w,b.Usage.STATIC_DRAW,new Uint32Array(k.buffer,4*t,C));t+=C;t=this.layer.lineMaterial;this.lineVertexArrayObject=new c.VertexArrayObject(w,t.getAttributeLocations(),t.getLayoutInfo(),{geometry:this.lineVertexBuffer},this.lineIndexBuffer)};return h}(a),g=function(m){function h(w,k){k=m.call(this,w,k)||this;k.type=x.BucketType.FILL;k.fillIndexStart=0;k.fillIndexCount=0;k.outlineIndexStart=0;k.outlineIndexCount=
0;w=new Uint32Array(w);let t=k.bufferDataOffset;k.fillIndexStart=w[t++];k.fillIndexCount=w[t++];k.outlineIndexStart=w[t++];k.outlineIndexCount=w[t++];const C=w[t++];if(0<C){const I=new Map;for(let H=0;H<C;H++){const B=w[t++],y=w[t++],F=w[t++];I.set(B,[y,F])}k.patternMap=I}k.bufferDataOffset=t;return k}D._inheritsLoose(h,m);var u=h.prototype;u.hasData=function(){return 0<this.fillIndexCount||0<this.outlineIndexCount};u.triangleCount=function(){return(this.fillIndexCount+this.outlineIndexCount)/3};
u.doDestroy=function(){v.isSome(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose();v.isSome(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose();v.isSome(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose();this.fillIndexBuffer=this.fillVertexBuffer=this.fillVertexArrayObject=null;v.isSome(this.outlineVertexArrayObject)&&this.outlineVertexArrayObject.dispose();v.isSome(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose();v.isSome(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose();
this.outlineIndexBuffer=this.outlineVertexBuffer=this.outlineVertexArrayObject=null;this.memoryUsed=0};u.doPrepareForRendering=function(w,k,t){k=new Uint32Array(k);var C=new Int32Array(k.buffer),I=k[t++];this.fillVertexBuffer=q.BufferObject.createVertex(w,b.Usage.STATIC_DRAW,new Int32Array(C.buffer,4*t,I));t+=I;I=k[t++];this.fillIndexBuffer=q.BufferObject.createIndex(w,b.Usage.STATIC_DRAW,new Uint32Array(k.buffer,4*t,I));t+=I;I=k[t++];this.outlineVertexBuffer=q.BufferObject.createVertex(w,b.Usage.STATIC_DRAW,
new Int32Array(C.buffer,4*t,I));t+=I;C=k[t++];this.outlineIndexBuffer=q.BufferObject.createIndex(w,b.Usage.STATIC_DRAW,new Uint32Array(k.buffer,4*t,C));t+=C;k=this.layer;t=k.fillMaterial;k=k.outlineMaterial;this.fillVertexArrayObject=new c.VertexArrayObject(w,t.getAttributeLocations(),t.getLayoutInfo(),{geometry:this.fillVertexBuffer},this.fillIndexBuffer);this.outlineVertexArrayObject=new c.VertexArrayObject(w,k.getAttributeLocations(),k.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)};
return h}(a),l=function(m){function h(w,k,t){k=m.call(this,w,k)||this;k.type=x.BucketType.SYMBOL;k.iconPerPageElementsMap=new Map;k.glyphPerPageElementsMap=new Map;k.symbolInstances=[];k.isIconSDF=!1;k.opacityChanged=!1;k.lastOpacityUpdate=0;k.symbols=[];const C=new Uint32Array(w),I=new Int32Array(w);w=new Float32Array(w);let H=k.bufferDataOffset;k.isIconSDF=!!C[H++];var B=C[H++];for(var y=0;y<B;y++){var F=C[H++],N=C[H++],Q=C[H++];k.iconPerPageElementsMap.set(F,[N,Q])}B=C[H++];for(y=0;y<B;y++)F=C[H++],
N=C[H++],Q=C[H++],k.glyphPerPageElementsMap.set(F,[N,Q]);B=C[H++];y=C[H++];k.iconOpacity=new Int32Array(B);k.textOpacity=new Int32Array(y);H=e.deserializeSymbols(C,I,w,H,k.symbols,t);k.bufferDataOffset=H;return k}D._inheritsLoose(h,m);var u=h.prototype;u.hasData=function(){return 0<this.iconPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};u.triangleCount=function(){let w=0;for(const [,k]of this.iconPerPageElementsMap)w+=k[1];for(const [,k]of this.glyphPerPageElementsMap)w+=k[1];return w/
3};u.doDestroy=function(){v.isSome(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose();v.isSome(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose();v.isSome(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose();v.isSome(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose();this.iconIndexBuffer=this.iconOpacityBuffer=this.iconVertexBuffer=this.iconVertexArrayObject=null;v.isSome(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose();v.isSome(this.textVertexBuffer)&&
this.textVertexBuffer.dispose();v.isSome(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose();v.isSome(this.textIndexBuffer)&&this.textIndexBuffer.dispose();this.textIndexBuffer=this.textOpacityBuffer=this.textVertexBuffer=this.textVertexArrayObject=null;this.memoryUsed=0};u.updateOpacityInfo=function(){if(this.opacityChanged){this.opacityChanged=!1;var w=v.unwrap(this.iconOpacity),k=v.unwrap(this.iconOpacityBuffer);0<w.length&&w.byteLength===k.size&&k.setSubData(w);w=v.unwrap(this.textOpacity);
k=v.unwrap(this.textOpacityBuffer);0<w.length&&w.byteLength===k.size&&k.setSubData(w)}};u.doPrepareForRendering=function(w,k,t){k=new Uint32Array(k);var C=new Int32Array(k.buffer),I=k[t++];this.iconVertexBuffer=q.BufferObject.createVertex(w,b.Usage.STATIC_DRAW,new Int32Array(C.buffer,4*t,I));t+=I;I=k[t++];this.iconIndexBuffer=q.BufferObject.createIndex(w,b.Usage.STATIC_DRAW,new Uint32Array(k.buffer,4*t,I));t+=I;I=k[t++];this.textVertexBuffer=q.BufferObject.createVertex(w,b.Usage.STATIC_DRAW,new Int32Array(C.buffer,
4*t,I));t+=I;C=k[t++];this.textIndexBuffer=q.BufferObject.createIndex(w,b.Usage.STATIC_DRAW,new Uint32Array(k.buffer,4*t,C));t+=C;this.iconOpacityBuffer=q.BufferObject.createVertex(w,b.Usage.STATIC_DRAW,v.unwrap(this.iconOpacity).buffer);this.textOpacityBuffer=q.BufferObject.createVertex(w,b.Usage.STATIC_DRAW,v.unwrap(this.textOpacity).buffer);k=this.layer;t=k.iconMaterial;k=k.textMaterial;this.iconVertexArrayObject=new c.VertexArrayObject(w,t.getAttributeLocations(),t.getLayoutInfo(),{geometry:this.iconVertexBuffer,
opacity:this.iconOpacityBuffer},this.iconIndexBuffer);this.textVertexArrayObject=new c.VertexArrayObject(w,k.getAttributeLocations(),k.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)};return h}(a),p=function(m){function h(w,k){k=m.call(this,w,k)||this;k.type=x.BucketType.CIRCLE;k.circleIndexStart=0;k.circleIndexCount=0;w=new Uint32Array(w);let t=k.bufferDataOffset;k.circleIndexStart=w[t++];k.circleIndexCount=w[t++];k.bufferDataOffset=t;return k}
D._inheritsLoose(h,m);var u=h.prototype;u.hasData=function(){return 0<this.circleIndexCount};u.triangleCount=function(){return this.circleIndexCount/3};u.doDestroy=function(){v.isSome(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose();v.isSome(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose();v.isSome(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose();this.circleIndexBuffer=this.circleVertexBuffer=this.circleVertexArrayObject=null;this.memoryUsed=0};u.doPrepareForRendering=
function(w,k,t){k=new Uint32Array(k);var C=new Int32Array(k.buffer);const I=k[t++];this.circleVertexBuffer=q.BufferObject.createVertex(w,b.Usage.STATIC_DRAW,new Int32Array(C.buffer,4*t,I));t+=I;C=k[t++];this.circleIndexBuffer=q.BufferObject.createIndex(w,b.Usage.STATIC_DRAW,new Uint32Array(k.buffer,4*t,C));t+=C;t=this.layer.circleMaterial;this.circleVertexArrayObject=new c.VertexArrayObject(w,t.getAttributeLocations(),t.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)};return h}(a);
A.CircleRenderBucket=p;A.FillRenderBucket=g;A.LineRenderBucket=d;A.RenderBucketBase=a;A.SymbolRenderBucket=l;Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../enums","./core"],function(A,D,v,x,e){let q=function(d){this.tile=d;this.parent=null;this.children=new Set},b=function(){function d(){this.nodes=
new Map;this.roots=new Set}var g=d.prototype;g.create=function(l){const p=new q(l);let m;const h=[];this.nodes.forEach(u=>{this._canConnectDirectly(p,u)&&h.push(u);!m&&this._canConnectDirectly(u,p)&&(m=u)});if(m){for(const u of h)m.children.delete(u),p.children.add(u),u.parent=p;m.children.add(p);p.parent=m}else{this.roots.add(p);for(const u of h)p.children.add(u),u.parent=p,this.roots.delete(u)}this.nodes.set(l.key.id,p);return p};g.destroy=function(l){v.isSome(l.parent)?(l.parent.children.delete(l),
l.children.forEach(p=>{v.isSome(l.parent)&&l.parent.children.add(p)})):this.roots.delete(l);l.children.forEach(p=>{(p.parent=l.parent)||this.roots.add(p)});this.nodes.delete(l.tile.key.id)};g.clear=function(){this.roots.clear();this.nodes.clear()};g._canConnectDirectly=function(l,p){let {level:m,row:h,col:u}=p.tile.key;for({world:p}=p.tile.key;0<m;){m--;h>>=1;u>>=1;if(l.tile.key.level===m&&l.tile.key.row===h&&l.tile.key.col===u&&l.tile.key.world===p)return!0;if(this.nodes.has(`${m}/${h}/${u}/${p}`))break}return!1};
return d}(),c=function(){function d(){this._tileGraph=new b;this._tileArray=null}var g=d.prototype;g.has=function(l){return"string"===typeof l?this._tileGraph.nodes.has(l):this._tileGraph.nodes.has(l.key.id)};g.getAll=function(){this._tileArray||(this._tileArray=[],this._tileGraph.nodes.forEach(l=>{this._tileArray.push(l.tile)}));return this._tileArray};g.getRoots=function(){const l=[];this._tileGraph.roots.forEach(p=>{l.push(p.tile)});return l};g.getParent=function(l){l=this._tileGraph.nodes.get("string"===
typeof l?l:l.key.id);return v.isSome(l.parent)&&l.parent.tile};g.getChildren=function(l){const p=[];this._tileGraph.nodes.get("string"===typeof l?l:l.key.id).children.forEach(m=>{p.push(m.tile)});return p};g.get=function(l){return this._tileGraph.nodes.get(l).tile};g.removeKey=function(l){l=this._tileGraph.nodes.get(l);this._tileGraph.destroy(l);this._tileArray=null};g.forEach=function(l){this._tileGraph.nodes.forEach((p,m)=>l(p.tile,m))};g.add=function(l){this._tileGraph.create(l);this._tileArray=
null};g.remove=function(l){l=this._tileGraph.nodes.get(l.key.id);this._tileGraph.destroy(l);this._tileArray=null};g.clear=function(){this._tileGraph.clear();this._tileArray=[]};return d}(),a=function(){function d(l,p,m){this._rows=Math.ceil(p/m);this._columns=Math.ceil(l/m);this._cellSize=m;this.cells=Array(this._rows);for(l=0;l<this._rows;l++)for(this.cells[l]=Array(this._columns),p=0;p<this._columns;p++)this.cells[l][p]=[]}var g=d.prototype;g.getCell=function(l,p){p=Math.min(Math.max(Math.floor(p/
this._cellSize),0),this._rows-1);l=Math.min(Math.max(Math.floor(l/this._cellSize),0),this._columns-1);return this.cells[p]&&this.cells[p][l]||null};g.getCellSpan=function(l,p,m,h){return[Math.min(Math.max(Math.floor(l/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(p/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(m/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(h/this._cellSize),0),this.rows-1)]};D._createClass(d,[{key:"cellSize",get:function(){return this._cellSize}},
{key:"columns",get:function(){return this._columns}},{key:"rows",get:function(){return this._rows}}]);return d}();A.GridIndex=a;A.TileForest=c;A.TileGraph=b;A.TileNode=q;A.deserializeSymbols=function(d,g,l,p,m,h){const u=g[p++];for(let t=0;t<u;t++){const C=new e.VTLSymbol(h);C.xTile=g[p++];C.yTile=g[p++];C.hash=g[p++];C.priority=g[p++];var w=g[p++];for(var k=0;k<w;k++){const I=g[p++],H=g[p++],B=g[p++],y=g[p++],F=!!g[p++],N=g[p++],Q=l[p++],L=l[p++],S=g[p++],R=g[p++];C.colliders.push({xTile:I,yTile:H,
dxPixels:B,dyPixels:y,hard:F,partIndex:N,width:S,height:R,minLod:Q,maxLod:L})}w=d[p++];for(k=0;k<w;k++)C.textVertexRanges.push([d[p++],d[p++]]);w=d[p++];for(k=0;k<w;k++)C.iconVertexRanges.push([d[p++],d[p++]]);m.push(C)}return p};A.tileCoordChange=function(d,g,l,p,m,h){l-=m;if(0<=l)return(g>>l)+(p-(h<<l))*(d>>l);l=-l;return g-(h-(p<<l))*(d>>l)<<l};A.writeOpacityToBuffers=function(d,g,l){for(const [t,C]of d.symbols){{var p=d,m=g,h=l,u=C;const I=p.layerData.get(t);if(I.type===x.BucketType.SYMBOL){for(const H of u){u=
H.unique;var w=void 0;if(H.selectedForRendering){var k=u.parts[0];w=k.startOpacity;k=k.targetOpacity;p.allSymbolsFadingOut=p.allSymbolsFadingOut&&0===k;w=h?Math.floor(127*w)|k<<7:k?255:0;w|=w<<24|w<<16|w<<8}else w=0;for(const [B,y]of H.iconVertexRanges)for(k=B;k<B+y;k+=4)I.iconOpacity[k/4]=w;H.selectedForRendering?(w=u.parts[1],u=w.startOpacity,w=w.targetOpacity,p.allSymbolsFadingOut=p.allSymbolsFadingOut&&0===w,u=h?Math.floor(127*u)|w<<7:w?255:0,w=u<<24|u<<16|u<<8|u):w=0;for(const [B,y]of H.textVertexRanges)for(u=
B;u<B+y;u+=4)I.textOpacity[u/4]=w}I.lastOpacityUpdate=m;I.opacityChanged=!0}}}};Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports"],function(A){A.VTLSymbol=function(D){this.hash=this.yTile=this.xTile=0;this.priority=1;this.colliders=[];this.textVertexRanges=[];this.iconVertexRanges=[];this.tile=D};A.VTLUniqueSymbol=function(){this.tileSymbols=[];this.parts=[{startTime:0,startOpacity:0,
targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}];this.show=!1};Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/VectorTileContainer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../../../../geometry/support/aaBoundingRect ./decluttering/SymbolFader ./style/StyleDefinition ../webgl/enums ../webgl/RenderableTile ../webgl/TileContainer ../../tiling/TileCoverage ../../tiling/TileKey ../../../webgl/enums".split(" "),
function(A,D,v,x,e,q,b,c,a,d,g,l,p){function m(h,u){if(h){const w=h.getLayoutProperty("visibility");if(!w||w.getValue()!==b.Visibility.NONE&&(void 0===h.minzoom||h.minzoom<u+1E-6)&&(void 0===h.maxzoom||h.maxzoom>=u-1E-6))return!0}return!1}d=function(h){function u(k){k=h.call(this,k)||this;k._backgroundTiles=[];k._pointToCallbacks=new Map;return k}D._inheritsLoose(u,h);var w=u.prototype;w.destroy=function(){this.removeAllChildren();this._spriteMosaic&&(this._spriteMosaic.dispose(),this._spriteMosaic=
null);this._glyphMosaic&&(this._glyphMosaic.dispose(),this._glyphMosaic=null);v.isSome(this._symbolFader)&&(this._symbolFader.clear(),this._symbolFader=null);this._styleRepository=null;this._backgroundTiles=[];this._pointToCallbacks.clear()};w.setStyleResources=function(k,t,C){this._spriteMosaic=k;this._glyphMosaic=t;this._styleRepository=C;v.isNone(this._symbolFader)&&(k=new q.SymbolFader(this._styleRepository,this.children),k.on("fade-start",()=>{this.emit("fade-start");this.requestRender()}),k.on("fade-complete",
()=>{this.emit("fade-complete");this.requestRender()}),this._symbolFader=k);v.unwrap(this._symbolFader).styleRepository=C};w.setSpriteMosaic=function(k){this._spriteMosaic.dispose();this._spriteMosaic=k};w.deleteStyleLayers=function(k){v.isSome(this._symbolFader)&&this._symbolFader.deleteStyleLayers(k)};w.hitTest=function(){var k=D._asyncToGenerator(function*(t){const C=x.createResolver();this._pointToCallbacks.set(t,C);this.requestRender();return C.promise});return function(t){return k.apply(this,
arguments)}}();w.enterTileInvalidation=function(){for(const k of this.children)k.invalidating=!0};w.createRenderParams=function(k){return{...h.prototype.createRenderParams.call(this,k),renderPass:null,styleLayer:null,styleLayerUID:-1,glyphMosaic:this._glyphMosaic,spriteMosaic:this._spriteMosaic,hasClipping:!!this._clippingInfos}};w.doRender=function(k){!this.visible||k.drawPhase!==c.WGLDrawPhase.MAP&&k.drawPhase!==c.WGLDrawPhase.DEBUG||void 0===this._spriteMosaic||h.prototype.doRender.call(this,k)};
w.addChild=function(k){h.prototype.addChild.call(this,k);v.isSome(this._symbolFader)?this._symbolFader.addTile(k):k.decluttered=!0;this.requestRender();return k};w.removeChild=function(k){v.isSome(this._symbolFader)&&this._symbolFader.removeTile(k);this.requestRender();return h.prototype.removeChild.call(this,k)};w.renderChildren=function(k){const {drawPhase:t}=k;if(t===c.WGLDrawPhase.DEBUG)h.prototype.renderChildren.call(this,k);else if(this._doRender(k),0<this._pointToCallbacks.size){k.drawPhase=
c.WGLDrawPhase.HITTEST;const C=k.painter.effects.hittestVTL;C.bind(k);this._doRender(k);C.draw(k,this._pointToCallbacks);C.unbind(k);k.drawPhase=t}};w.removeAllChildren=function(){for(let k=0;k<this.children.length;k++){const t=this.children[k];v.isSome(this._symbolFader)&&this._symbolFader.removeTile(t);t.dispose()}h.prototype.removeAllChildren.call(this)};w.getStencilTarget=function(){return this.children.filter(k=>k.neededForCoverage&&k.hasData())};w.restartDeclutter=function(){v.isSome(this._symbolFader)&&
this._symbolFader.restartDeclutter()};w._doRender=function(k){const {context:t}=k;var C=this._styleRepository;if(C){var I=C.layers,H=!0;k.drawPhase===c.WGLDrawPhase.HITTEST&&(H=!1);0<C.backgroundBucketIds.length&&(k.renderPass="background",this._renderBackgroundLayers(k,C.backgroundBucketIds));h.prototype.renderChildren.call(this,k);k.drawPhase===c.WGLDrawPhase.MAP&&this._fade(k.displayLevel,k.state);if((C=this.children.filter(y=>y.visible&&y.hasData()))&&0!==C.length){for(var B of C)B.triangleCount=
0;t.setStencilWriteMask(0);t.setColorMask(!0,!0,!0,!0);t.setStencilOp(p.StencilOperation.KEEP,p.StencilOperation.KEEP,p.StencilOperation.REPLACE);t.setStencilTestEnabled(!0);t.setBlendingEnabled(!1);t.setDepthTestEnabled(!0);t.setDepthWriteEnabled(!0);t.setDepthFunction(p.CompareFunction.LEQUAL);t.setClearDepth(1);t.clear(t.gl.DEPTH_BUFFER_BIT);k.renderPass="opaque";for(B=I.length-1;0<=B;B--)this._renderStyleLayer(I[B],k,C);t.setDepthWriteEnabled(!1);t.setBlendingEnabled(H);t.setBlendFunctionSeparate(p.BlendFactor.ONE,
p.BlendFactor.ONE_MINUS_SRC_ALPHA,p.BlendFactor.ONE,p.BlendFactor.ONE_MINUS_SRC_ALPHA);k.renderPass="translucent";for(H=0;H<I.length;H++)this._renderStyleLayer(I[H],k,C);t.setDepthTestEnabled(!1);k.renderPass="symbol";for(H=0;H<I.length;H++)this._renderStyleLayer(I[H],k,C)}t.bindVAO();t.setStencilTestEnabled(!0);t.setBlendingEnabled(!0)}};w._fade=function(k,t){v.isSome(this._symbolFader)&&(this._symbolFader.update(k,t)||this.requestRender())};w._renderStyleLayer=function(k,t,C){const {painter:I,renderPass:H}=
t;if(void 0!==k){var B=k.getLayoutProperty("visibility");if(!B||B.getValue()!==b.Visibility.NONE){switch(k.type){case b.StyleLayerType.BACKGROUND:return;case b.StyleLayerType.FILL:if("opaque"!==H&&"translucent"!==t.renderPass)return;var y="vtlFill";break;case b.StyleLayerType.LINE:if("translucent"!==H)return;y="vtlLine";break;case b.StyleLayerType.CIRCLE:if("symbol"!==H)return;y="vtlCircle";break;case b.StyleLayerType.SYMBOL:if("symbol"!==H)return;y="vtlSymbol"}C=k.type===b.StyleLayerType.SYMBOL?
C.filter(F=>F.decluttered):C.filter(F=>F.neededForCoverage);if("vtlSymbol"!==y&&(B=t.displayLevel,0===C.length||void 0!==k.minzoom&&k.minzoom>=B+1E-6||void 0!==k.maxzoom&&k.maxzoom<B-1E-6))return;B=k.uid;t.styleLayerUID=B;t.styleLayer=k;for(const F of C)if(F.layerData.has(B)){I.renderObjects(t,C,y);break}}}};w._renderBackgroundLayers=function(k,t){const {context:C,displayLevel:I,painter:H,state:B}=k,y=this._styleRepository;var F=!1;for(var N of t)if(y.getLayerById(N).type===b.StyleLayerType.BACKGROUND&&
m(y.getLayerById(N),I)){F=!0;break}if(F){F=this._tileInfoView.getTileCoverage(k.state,0,"smallest");var {spans:Q,lodInfo:L}=F,{level:S}=L,R=e.create();N=[];if(this._renderPasses){var T=this._renderPasses[0];v.isSome(this._clippingInfos)&&(T.brushes[0].prepareState(k,this._clippingInfos[0]),T.brushes[0].drawMany(k,this._clippingInfos))}T=this._backgroundTiles;var O=0;for(const {row:G,colFrom:M,colTo:U}of Q)for(let Y=M;Y<=U;Y++){if(O<T.length){var K=T[O];K.key.set(S,G,L.normalizeCol(Y),L.getWorldForColumn(Y));
this._tileInfoView.getTileBounds(R,K.key,!1);K.x=R[0];K.y=R[3]}else{K=new l(S,G,L.normalizeCol(Y),L.getWorldForColumn(Y));const ca=this._tileInfoView.getTileBounds(e.create(),K);K=new a.RenderableTile(K,ca[0],ca[3],512,512,4096,4096);T.push(K)}K.setTransform(B,this._tileInfoView.getTileResolution(K.key));N.push(K);O++}C.setStencilWriteMask(0);C.setColorMask(!0,!0,!0,!0);C.setStencilOp(p.StencilOperation.KEEP,p.StencilOperation.KEEP,p.StencilOperation.REPLACE);C.setStencilFunction(p.CompareFunction.EQUAL,
0,255);S=!0;k.drawPhase===c.WGLDrawPhase.HITTEST&&(S=!1);C.setStencilTestEnabled(S);for(const G of t)t=y.getLayerById(G),t.type===b.StyleLayerType.BACKGROUND&&m(t,I)&&(k.styleLayerUID=t.uid,k.styleLayer=t,H.renderObjects(k,N,"vtlBackground"));g.pool.release(F)}};return u}(d);A.VectorTileContainer=d;Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolFader":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Evented ../../../../../core/maybe ./config ./core ./jobs ./SymbolDeclutterer ./SymbolRepository ./util ../style/StyleDefinition".split(" "),
function(A,D,v,x,e,q,b,c,a,d,g){v=function(l){function p(h,u){var w=l.call(this)||this;w.styleRepository=h;w._tileToHandle=new Map;w._viewState={scale:0,rotation:0,center:[0,0],size:[0,0]};w._declutterViewState={scale:0,rotation:0,center:[0,0],size:[0,0]};w._completed=!1;w._symbolRepository=new a.SymbolRepository(4096,u,()=>new q.VTLUniqueSymbol);w._symbolDeclutterer=new c.SymbolDeclutterer(u,w._symbolRepository,(k,t,C)=>new b.CollisionJob(k,t,C,w.styleRepository,w._zoom,w._viewState.rotation),(k,
t)=>{k.allSymbolsFadingOut=!0;k.lastOpacityUpdate=t;d.writeOpacityToBuffers(k,t,!0);k.decluttered=!0;k.requestRender()},(k,t)=>w.styleRepository.getStyleLayerByUID(k.styleLayerUID).z-w.styleRepository.getStyleLayerByUID(t.styleLayerUID).z,k=>{k=w.styleRepository.getStyleLayerByUID(k);return w._zoom+1E-6<k.minzoom||w._zoom-1E-6>=k.maxzoom?!1:(k=k.getLayoutProperty("visibility"))&&k.getValue()===g.Visibility.NONE?!1:!0});return w}D._inheritsLoose(p,l);var m=p.prototype;m.addTile=function(h){h.decluttered=
!1;this._tileToHandle.set(h,h.on("symbols-changed",()=>{this._symbolRepository.add(h);this.restartDeclutter()}));this._symbolRepository.add(h);this.restartDeclutter()};m.removeTile=function(h){const u=this._tileToHandle.get(h);u&&(this._symbolRepository.removeTile(h),this.restartDeclutter(),u.remove(),this._tileToHandle.delete(h))};m.update=function(h,u){this._zoom=h;this._viewState={scale:u.scale,rotation:u.rotation,center:[u.center[0],u.center[1]],size:[u.size[0],u.size[1]]};this._continueDeclutter();
return this._completed};m.restartDeclutter=function(){this._completed=!1;this._symbolDeclutterer.restart();this._notifyUnstable()};m.clear=function(){this._completed=!1;this._symbolRepository=null;this._symbolDeclutterer.restart();this._tileToHandle.forEach(h=>h.remove());this._tileToHandle.clear()};m.deleteStyleLayers=function(h){this._symbolRepository.deleteStyleLayers(h)};m._continueDeclutter=function(){if(!this._completed||this.stale)this._symbolDeclutterer.running||(this._declutterZoom=this._zoom,
this._declutterViewState.center[0]=this._viewState.center[0],this._declutterViewState.center[1]=this._viewState.center[1],this._declutterViewState.rotation=this._viewState.rotation,this._declutterViewState.scale=this._viewState.scale,this._declutterViewState.size[0]=this._viewState.size[0],this._declutterViewState.size[1]=this._viewState.size[1],this._symbolDeclutterer.restart()),this._symbolDeclutterer.setScreenSize(this._viewState.size[0],this._viewState.size[1]),(this._completed=this._symbolDeclutterer.continue(e.DECLUTTER_BUDGET))&&
this._scheduleNotifyStable()};m._scheduleNotifyStable=function(){x.isSome(this._stableNotificationHandle)&&clearTimeout(this._stableNotificationHandle);this._stableNotificationHandle=setTimeout(()=>{this._stableNotificationHandle=null;this.emit("fade-complete")},1.5*e.FADE_DURATION)};m._notifyUnstable=function(){x.isSome(this._stableNotificationHandle)&&(clearTimeout(this._stableNotificationHandle),this._stableNotificationHandle=null);this.emit("fade-start")};D._createClass(p,[{key:"stale",get:function(){return this._zoom!==
this._declutterZoom||this._viewState.size[0]!==this._declutterViewState.size[0]||this._viewState.size[1]!==this._declutterViewState.size[1]||this._viewState.scale!==this._declutterViewState.scale||this._viewState.rotation!==this._declutterViewState.rotation}}]);return p}(v);A.SymbolFader=v;Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/decluttering/jobs":function(){define(["exports","../../../../../chunks/mat3f32","./config",
"./util","../style/StyleDefinition"],function(A,D,v,x,e){let q=function(){function b(a,d,g,l,p,m){this._symbols=a;this._styleRepository=l;this._zoom=p;this._currentSymbolCursor=this._currentLayerCursor=0;this._styleProps=new Map;this._allNeededMatrices=new Map;this._gridIndex=new x.GridIndex(d,g,v.COLLISION_GRID_CELL_SIZE);this._si=Math.sin(Math.PI*m/180);this._co=Math.cos(Math.PI*m/180);for(const h of a)for(const u of h.symbols)this._allNeededMatrices.has(u.tile)||this._allNeededMatrices.set(u.tile,
D.clone(u.tile.transforms.tileUnitsToPixels))}var c=b.prototype;c.work=function(a){const d=this._gridIndex,g=performance.now();for(;this._currentLayerCursor<this._symbols.length;this._currentLayerCursor++,this._currentSymbolCursor=0){const H=this._symbols[this._currentLayerCursor],B=this._getProperties(H.styleLayerUID);for(;this._currentSymbolCursor<H.symbols.length;this._currentSymbolCursor++){if(99===this._currentSymbolCursor%100&&performance.now()-g>a)return!1;var l=H.symbols[this._currentSymbolCursor];
if(!l.unique.show)continue;{var p=l,m=this._si,h=this._co,u=this._allNeededMatrices.get(l.tile),w=this._zoom;const {iconRotationAlignment:L,textRotationAlignment:S,iconTranslate:R,iconTranslateAnchor:T,textTranslate:O,textTranslateAnchor:K}=B;var k=0;for(const G of p.colliders){const [M,U]=0===G.partIndex?R:O;var t=0===G.partIndex?T:K,C=G.minLod<=w&&w<=G.maxLod;k+=C?0:1;G.enabled=C;G.xScreen=G.xTile*u[0]+G.yTile*u[3]+u[6];G.yScreen=G.xTile*u[1]+G.yTile*u[4]+u[7];t===e.TranslateAnchor.MAP?(G.xScreen+=
h*M-m*U,G.yScreen+=m*M+h*U):(G.xScreen+=M,G.yScreen+=U);e.RotationAlignment.VIEWPORT===(0===G.partIndex?L:S)?(G.dxScreen=G.dxPixels,G.dyScreen=G.dyPixels):(G.dxScreen=h*(G.dxPixels+G.width/2)-m*(G.dyPixels+G.height/2)-G.width/2,G.dyScreen=m*(G.dxPixels+G.width/2)+h*(G.dyPixels+G.height/2)-G.height/2)}0<p.colliders.length&&k===p.colliders.length&&(p.unique.show=!1)}p=l.unique;if(!p.show)continue;const {iconAllowOverlap:y,iconIgnorePlacement:F,textAllowOverlap:N,textIgnorePlacement:Q}=B;for(const L of l.colliders)if(L.enabled&&
(m=p.parts[L.partIndex],m.show)){if(h=!(L.partIndex?N:y))a:{h=L.xScreen+L.dxScreen;u=L.yScreen+L.dyScreen;w=h+L.width;k=u+L.height;const [S,R,T,O]=d.getCellSpan(h,u,w,k);for(t=R;t<=O;t++)for(C=S;C<=T;C++){var I=d.cells[t][C];for(const K of I){I=K.xScreen+K.dxScreen;const G=K.yScreen+K.dyScreen,M=I+K.width,U=G+K.height;if(!(w<I||h>M||k<G||u>U)){h=!0;break a}}}h=!1}h&&(L.hard?p.show=!1:m.show=!1)}if(p.show)for(const L of l.colliders){if(!L.enabled)continue;if(L.partIndex?Q:F)continue;if(!p.parts[L.partIndex].show)continue;
l=L.xScreen+L.dxScreen;m=L.yScreen+L.dyScreen;const [S,R,T,O]=this._gridIndex.getCellSpan(l,m,l+L.width,m+L.height);for(l=R;l<=O;l++)for(m=S;m<=T;m++)this._gridIndex.cells[l][m].push(L)}}}return!0};c._getProperties=function(a){var d=this._styleProps.get(a);if(d)return d;d=this._zoom;const g=this._styleRepository.getStyleLayerByUID(a);var l=g.getLayoutValue("symbol-placement",d)!==e.SymbolPlacement.POINT;let p=g.getLayoutValue("icon-rotation-alignment",d);p===e.RotationAlignment.AUTO&&(p=l?e.RotationAlignment.MAP:
e.RotationAlignment.VIEWPORT);let m=g.getLayoutValue("text-rotation-alignment",d);m===e.RotationAlignment.AUTO&&(m=l?e.RotationAlignment.MAP:e.RotationAlignment.VIEWPORT);l=g.getPaintValue("icon-translate",d);const h=g.getPaintValue("icon-translate-anchor",d),u=g.getPaintValue("text-translate",d),w=g.getPaintValue("text-translate-anchor",d);d={iconAllowOverlap:g.getLayoutValue("icon-allow-overlap",d),iconIgnorePlacement:g.getLayoutValue("icon-ignore-placement",d),textAllowOverlap:g.getLayoutValue("text-allow-overlap",
d),textIgnorePlacement:g.getLayoutValue("text-ignore-placement",d),iconRotationAlignment:p,textRotationAlignment:m,iconTranslateAnchor:h,iconTranslate:l,textTranslateAnchor:w,textTranslate:u};this._styleProps.set(a,d);return d};return b}();A.CollisionJob=q;Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolDeclutterer":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe",
"./config"],function(A,D,v,x){function e(b,c){if(b.priority-c.priority)return b.priority-c.priority;const a=b.tile.key,d=c.tile.key;return a.world-d.world?a.world-d.world:a.level-d.level?a.level-d.level:a.row-d.row?a.row-d.row:a.col-d.col?a.col-d.col:b.xTile-c.xTile?b.xTile-c.xTile:b.yTile-c.yTile}let q=function(){function b(a,d,g,l,p,m){this._visibleTiles=a;this._symbolRepository=d;this._createCollisionJob=g;this._assignTileSymbolsOpacity=l;this._symbolLayerSorter=p;this._isLayerVisible=m;this._selectionJob=
null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=!0}var c=b.prototype;c.setScreenSize=function(a,d){this._screenWidth===a&&this._screenHeight===d||this.restart();this._screenWidth=a;this._screenHeight=d};c.restart=function(){this._selectionJob=null;this._selectionJobCompleted=!1;this._collisionJob=null;this._collisionJobCompleted=!1;this._opacityJob=null;this._opacityJobCompleted=!1;this._running=
!0};c.continue=function(a){this._selectionJob||(this._selectionJob=this._createSelectionJob());if(!this._selectionJobCompleted){var d=performance.now();if(!this._selectionJob.work(a))return!1;this._selectionJobCompleted=!0;a=Math.max(0,a-(performance.now()-d));if(0===a)return!1}this._collisionJob||(this._collisionJob=this._createCollisionJob(this._selectionJob.sortedSymbols,this._screenWidth,this._screenHeight));if(!this._collisionJobCompleted){d=performance.now();if(!this._collisionJob.work(a))return!1;
this._collisionJobCompleted=!0;a=Math.max(0,a-(performance.now()-d));if(0===a)return!1}this._opacityJob||(this._opacityJob=this._createOpacityJob());if(!this._opacityJobCompleted){d=performance.now();if(!this._opacityJob.work(a))return!1;this._opacityJobCompleted=!0;a=Math.max(0,a-(performance.now()-d));if(0===a)return!1}this._running=!1;return!0};c._createSelectionJob=function(){const a=this._symbolRepository.uniqueSymbols;for(let h=0;h<a.length;h++){const u=a[h];for(let w=0;w<u.uniqueSymbols.length;w++){const k=
u.uniqueSymbols[w];for(const t of k.tileSymbols)t.selectedForRendering=!1}}const d=[];let g=0,l=0;const p=this._isLayerVisible,m=this._symbolLayerSorter;return{work:function(h){const u=performance.now();for(;l<a.length;l++,g=0){const k=a[l];var w=k.styleLayerUID;if(!p(w)){d[l]||(d[l]={styleLayerUID:w,symbols:[]});continue}d[l]=d[l]||{styleLayerUID:w,symbols:[]};const t=d[l];for(;g<k.uniqueSymbols.length;g++){w=k.uniqueSymbols[g];if(99===g%100&&performance.now()-u>h)return!1;let C=null,I=!1,H=!1;for(const B of w.tileSymbols)if(!H||
!I){const y=B.tile;if(!C||y.isCoverage||y.neededForCoverage&&!I){C=B;if(y.neededForCoverage||y.isCoverage)H=!0;y.isCoverage&&(I=!0)}}C.selectedForRendering=!0;if(H){t.symbols.push(C);w.show=!0;for(const B of w.parts)B.show=!0}else w.show=!1}}for(const k of d)k.symbols.sort(e);return!0},get sortedSymbols(){return d.sort(m)}}};c._createOpacityJob=function(){function a(p,m){var h=p.symbols;for(const [,w]of h){var u=w;h=m;for(const k of u){u=k.unique;for(const t of u.parts)t.startOpacity+=(h-t.startTime)/
x.FADE_DURATION*(.5<t.targetOpacity?1:-1),t.startOpacity=Math.min(Math.max(t.startOpacity,0),1),t.startTime=h,t.targetOpacity=u.show&&t.show?1:0}}d(p,m);for(const w of p.childrenTiles)a(w,m)}const d=this._assignTileSymbolsOpacity,g=this._visibleTiles;let l=0;return{work(p){const m=performance.now();for(;l<g.length;l++){if(performance.now()-m>p)return!1;const h=g[l];if(v.isSome(h.parentTile))continue;const u=performance.now();a(h,u)}return!0}}};D._createClass(b,[{key:"running",get:function(){return this._running}}]);
return b}();A.SymbolDeclutterer=q;Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/decluttering/SymbolRepository":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","./util"],function(A,D,v,x){let e=function(){function q(c,a,d){this.tileCoordRange=c;this._visibleTiles=a;this._createUnique=d;this._tiles=new Map;this._uniqueSymbolsReferences=new Map}var b=q.prototype;
b.add=function(c,a){this._uniqueSymbolLayerArray=null;let d=this._tiles.get(c.id);d||(d={symbols:new Map},this._tiles.set(c.id,d));var g=new Map;if(a)for(var l of a)d.symbols.has(l)&&(g.set(l,d.symbols.get(l)),d.symbols.delete(l));else for(var [p]of c.layerData)d.symbols.has(p)&&(g.set(p,d.symbols.get(p)),d.symbols.delete(p));this._removeSymbols(g);a=c.symbols;g=new Map;for(const [m,h]of a)if(l=h.length,32<=l){p=this.tileCoordRange;do p/=2,l/=4;while(8<l&&64<p);l=new x.GridIndex(this.tileCoordRange,
this.tileCoordRange,p);g.set(m,{flat:h,index:l});d.symbols.set(m,{flat:h,index:l});for(const u of h)l.getCell(u.xTile,u.yTile).push(u)}else g.set(m,{flat:h}),d.symbols.set(m,{flat:h});this._addSymbols(c.key,a)};b.deleteStyleLayers=function(c){this._uniqueSymbolLayerArray=null;for(const [a,d]of this._tiles){const g=new Map;for(const l of c)d.symbols.has(l)&&(g.set(l,d.symbols.get(l)),d.symbols.delete(l));this._removeSymbols(g);0===d.symbols.size&&this._tiles.delete(a)}};b.removeTile=function(c){this._uniqueSymbolLayerArray=
null;const a=this._tiles.get(c.id);if(a){var d=new Map;for(const [g]of c.symbols)a.symbols.has(g)&&(d.set(g,a.symbols.get(g)),a.symbols.delete(g));this._removeSymbols(d);0===a.symbols.size&&this._tiles.delete(c.id)}};b._removeSymbols=function(c){for(const [d,{flat:g}]of c)for(const l of g){c=l.unique;var a=c.tileSymbols;const p=a.length-1;for(let m=0;m<p;m++)if(a[m]===l){a[m]=a[p];break}a.length=p;0===p&&(a=this._uniqueSymbolsReferences.get(d),a.delete(c),0===a.size&&this._uniqueSymbolsReferences.delete(d));
l.unique=null}};b._addSymbols=function(c,a){if(0!==a.size){var d=this._visibleTiles;for(const g of d)g.parentTile||g.key.world!==c.world||g.key.level===c.level&&!g.key.equals(c)||this._matchSymbols(g,c,a);for(const [g,l]of a)for(const p of l)v.isNone(p.unique)&&(c=this._createUnique(),p.unique=c,c.tileSymbols.push(p),a=this._uniqueSymbolsReferences.get(g),a||(a=new Set,this._uniqueSymbolsReferences.set(g,a)),a.add(c))}};b._matchSymbols=function(c,a,d){if(c.key.level>a.level){var g=c.key.level-a.level;
if(c.key.row>>g!==a.row||c.key.col>>g!==a.col)return}if(a.level>c.key.level&&(g=a.level-c.key.level,a.row>>g!==c.key.row||a.col>>g!==c.key.col))return;if(a.equals(c.key))for(var l of c.childrenTiles)this._matchSymbols(l,a,d);else{l=new Map;for(const [h,u]of d){var p=[];for(const k of u)d=x.tileCoordChange(this.tileCoordRange,k.xTile,a.level,a.col,c.key.level,c.key.col),g=x.tileCoordChange(this.tileCoordRange,k.yTile,a.level,a.row,c.key.level,c.key.row),0<=d&&d<this.tileCoordRange&&0<=g&&g<this.tileCoordRange&&
p.push({symbol:k,xTransformed:d,yTransformed:g});d=[];g=c.key.level<a.level?1:1<<c.key.level-a.level;const w=this._tiles.get(c.id).symbols.get(h);if(w){const k=w.flat;for(const t of p){var m=!1;let C;const I=t.xTransformed,H=t.yTransformed;C=v.isSome(w.index)?w.index.getCell(I,H):k;p=t.symbol;const B=p.hash;for(const y of C)if(B===y.hash&&Math.abs(I-y.xTile)<=g&&Math.abs(H-y.yTile)<=g){m=y.unique;p.unique=m;m.tileSymbols.push(p);m=!0;break}m||d.push(p)}}0<d.length&&l.set(h,d)}for(const h of c.childrenTiles)this._matchSymbols(h,
a,l)}};b._createUniqueSymbolLayerArray=function(){var c=this._uniqueSymbolsReferences;const a=Array(c.size);let d=0;for(const [g,l]of c){const p=Array(l.size);c=0;for(const m of l)p[c++]=m;a[d]={styleLayerUID:g,uniqueSymbols:p};d++}return a};D._createClass(q,[{key:"uniqueSymbols",get:function(){v.isNone(this._uniqueSymbolLayerArray)&&(this._uniqueSymbolLayerArray=this._createUniqueSymbolLayerArray());return this._uniqueSymbolLayerArray}}]);return q}();A.SymbolRepository=e;Object.defineProperties(A,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/webgl/RenderableTile":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/mat3f32","./TiledDisplayObject"],function(A,D,v,x){x=function(e){function q(){return e.apply(this,arguments)||this}D._inheritsLoose(q,e);q.prototype._createTransforms=function(){return{dvs:v.create(),tileMat3:v.create()}};return q}(x.TiledDisplayObject);A.RenderableTile=x;Object.defineProperties(A,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/style/StyleRepository":function(){define(["./StyleDefinition","./StyleLayer"],function(A,D){return function(){function v(e){this._style=e;this.backgroundBucketIds=[];this._uidToLayer=new Map;this._layerByName={};this._runningId=0;e.layers||(e.layers=[]);this.version=parseFloat(e.version);if(this.layers=e.layers.map((q,b,c)=>this._create(q,b,c)).filter(q=>!!q))for(let q=0;q<this.layers.length;q++)e=
this.layers[q],this._layerByName[e.id]=e,this._uidToLayer.set(e.uid,e),e.type===A.StyleLayerType.BACKGROUND&&this.backgroundBucketIds.push(e.id);this._identifyRefLayers()}var x=v.prototype;x.isPainterDataDriven=function(e){return(e=this._layerByName[e])?e.isPainterDataDriven():!1};x.getStyleLayerId=function(e){return e>=this.layers.length?null:this.layers[e].id};x.getStyleLayerByUID=function(e){e=this._uidToLayer.get(e);return null!=e?e:null};x.getStyleLayerIndex=function(e){return(e=this._layerByName[e])?
this.layers.indexOf(e):-1};x.setStyleLayer=function(e,q){if(e&&e.id){var b=this._style;null!=q&&q>=this.layers.length&&(q=this.layers.length-1);var c=!0,a;if(a=this._layerByName[e.id]){const d=this.layers.indexOf(a);q||(q=d);q===d?(c=!1,a=v._recreateLayer(e,a),this.layers[q]=a,b.layers[q]=e):(this.layers.splice(d,1),b.layers.splice(d,1),a=this._create(e,q,this.layers),this.layers.splice(q,0,a),b.layers.splice(q,0,e))}else a=this._create(e,q,this.layers),!q||q>=this.layers.length?(this.layers.push(a),
b.layers.push(e)):(this.layers.splice(q,0,a),b.layers.splice(q,0,e));this._layerByName[e.id]=a;this._uidToLayer.set(a.uid,a);c&&this._recomputeZValues();this._identifyRefLayers()}};x.getStyleLayer=function(e){return(e=this._layerByName[e])?{type:e.typeName,id:e.id,source:e.source,"source-layer":e.sourceLayer,minzoom:e.minzoom,maxzoom:e.maxzoom,filter:e.filter,layout:e.layout,paint:e.paint}:null};x.deleteStyleLayer=function(e){const q=this._layerByName[e];q&&(delete this._layerByName[e],this._uidToLayer.delete(q.uid),
e=this.layers.indexOf(q),this.layers.splice(e,1),this._style.layers.splice(e,1),this._recomputeZValues(),this._identifyRefLayers())};x.getLayerById=function(e){return this._layerByName[e]};x.getLayoutProperties=function(e){return(e=this._layerByName[e])?e.layout:null};x.getPaintProperties=function(e){return(e=this._layerByName[e])?e.paint:null};x.setPaintProperties=function(e,q){if(e=this._layerByName[e]){var b=v._recreateLayer({type:e.typeName,id:e.id,source:e.source,"source-layer":e.sourceLayer,
minzoom:e.minzoom,maxzoom:e.maxzoom,filter:e.filter,layout:e.layout,paint:q},e),c=this.layers.indexOf(e);this.layers[c]=b;this._style.layers[c].paint=q;this._layerByName[e.id]=b;this._uidToLayer.set(e.uid,b)}};x.setLayoutProperties=function(e,q){if(e=this._layerByName[e]){var b=v._recreateLayer({type:e.typeName,id:e.id,source:e.source,"source-layer":e.sourceLayer,minzoom:e.minzoom,maxzoom:e.maxzoom,filter:e.filter,layout:q,paint:e.paint},e),c=this.layers.indexOf(e);this.layers[c]=b;this._style.layers[c].layout=
q;this._layerByName[e.id]=b;this._uidToLayer.set(e.uid,b)}};x.setStyleLayerVisibility=function(e,q){if(e=this._layerByName[e]){var b=e.layout||{};b.visibility=q;q=v._recreateLayer({type:e.typeName,id:e.id,source:e.source,"source-layer":e.sourceLayer,minzoom:e.minzoom,maxzoom:e.maxzoom,filter:e.filter,layout:b,paint:e.paint},e);var c=this.layers.indexOf(e);this.layers[c]=q;this._style.layers[c].layout=b;this._layerByName[e.id]=q;this._uidToLayer.set(e.uid,q)}};x.getStyleLayerVisibility=function(e){var q;
e=this._layerByName[e];if(!e)return"none";e=e.layout;return null!=(q=null==e?void 0:e.visibility)?q:"visible"};x._recomputeZValues=function(){const e=this.layers,q=1/(e.length+1);for(let b=0;b<e.length;b++)e[b].z=1-(1+b)*q};x._identifyRefLayers=function(){const e=[],q=[];let b=0;for(const l of this.layers){const p=l.layout;if(l.type===A.StyleLayerType.FILL){var c,a=l,d=l.source+"|"+l.sourceLayer;d+=null!=(c="|"+(null==p?void 0:p.visibility))?c:"";d+="|"+l.minzoom;d+="|"+l.maxzoom;d+="|"+JSON.stringify(l.filter);
if(a.hasDataDrivenFill||a.hasDataDrivenOutline)d+="|"+b;e.push({key:d,layer:l})}else if(l.type===A.StyleLayerType.LINE){var g;a=l;d=l.source+"|"+l.sourceLayer;d+=null!=(g="|"+(null==p?void 0:p.visibility))?g:"";d+="|"+l.minzoom;d+="|"+l.maxzoom;d+="|"+JSON.stringify(l.filter);d+="|"+(void 0!==p?p["line-cap"]:"");d+="|"+(void 0!==p?p["line-join"]:"");a.hasDataDrivenLine&&(d+="|"+b);q.push({key:d,layer:l})}++b}this._assignRefLayers(e);this._assignRefLayers(q)};x._assignRefLayers=function(e){e.sort((g,
l)=>g.key<l.key?-1:g.key>l.key?1:0);let q,b;const c=e.length;for(let g=0;g<c;g++){const l=e[g];if(l.key===q)l.layer.refLayerId=b;else if(q=l.key,b=l.layer.id,l.layer.type===A.StyleLayerType.FILL){if(!l.layer.getPaintProperty("fill-outline-color"))for(var a=g+1;a<c;a++){var d=e[a];if(d.key===q){if(d.layer.getPaintProperty("fill-outline-color")){e[g]=d;e[a]=l;b=d.layer.id;break}}else break}}else if(l.layer.type===A.StyleLayerType.LINE)for(a=l.layer,d=g+1;d<c;d++){const p=e[d];if(p.key!==q)break;const m=
p.layer;if(a.canUseThinTessellation&&!m.canUseThinTessellation||!a.canUseThinTessellation&&(m.getPaintProperty("line-pattern")||m.getPaintProperty("line-dasharray")))a=m,e[g]=p,e[d]=l,b=p.layer.id}}};x._create=function(e,q,b){q=1-1/(b.length+1)*(1+q);b=this._runningId++;switch(e.type){case "background":return new D.BackgroundStyleLayer(A.StyleLayerType.BACKGROUND,e,q,b);case "fill":return new D.FillStyleLayer(A.StyleLayerType.FILL,e,q,b);case "line":return new D.LineStyleLayer(A.StyleLayerType.LINE,
e,q,b);case "symbol":return new D.SymbolStyleLayer(A.StyleLayerType.SYMBOL,e,q,b);case "raster":console.warn(`Unsupported vector tile raster layer ${e.id}`);case "circle":return new D.CircleStyleLayer(A.StyleLayerType.CIRCLE,e,q,b)}};v._recreateLayer=function(e,q){switch(e.type){case "background":return new D.BackgroundStyleLayer(A.StyleLayerType.BACKGROUND,e,q.z,q.uid);case "fill":return new D.FillStyleLayer(A.StyleLayerType.FILL,e,q.z,q.uid);case "line":return new D.LineStyleLayer(A.StyleLayerType.LINE,
e,q.z,q.uid);case "symbol":return new D.SymbolStyleLayer(A.StyleLayerType.SYMBOL,e,q.z,q.uid);case "raster":console.warn(`Unsupported vector tile raster layer ${e.id}`);case "circle":return new D.CircleStyleLayer(A.StyleLayerType.CIRCLE,e,q.z,q.uid)}};return v}()})},"esri/views/2d/engine/vectorTiles/style/StyleLayer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../symbols/cim/enums ../enums ../shaders/VTLBackgroundMaterial ../shaders/VTLCircleMaterial ../shaders/VTLFillMaterial ../shaders/VTLLineMaterial ../shaders/VTLSymbolMaterial ./Filter ./StyleDefinition ./StyleProperty ../../webgl/definitions".split(" "),
function(A,D,v,x,e,q,b,c,a,d,g,l,p){let m=function(){function H(y,F,N,Q){this.type=y;this.typeName=F.type;this.id=F.id;this.source=F.source;this.sourceLayer=F["source-layer"];this.minzoom=F.minzoom;this.maxzoom=F.maxzoom;this.filter=F.filter;this.layout=F.layout;this.paint=F.paint;this.z=N;this.uid=Q;switch(y){case g.StyleLayerType.BACKGROUND:this._layoutDefinition=g.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=g.StyleDefinition.backgroundPaintDefinition;break;case g.StyleLayerType.FILL:this._layoutDefinition=
g.StyleDefinition.fillLayoutDefinition;this._paintDefinition=g.StyleDefinition.fillPaintDefinition;break;case g.StyleLayerType.LINE:this._layoutDefinition=g.StyleDefinition.lineLayoutDefinition;this._paintDefinition=g.StyleDefinition.linePaintDefinition;break;case g.StyleLayerType.SYMBOL:this._layoutDefinition=g.StyleDefinition.symbolLayoutDefinition;this._paintDefinition=g.StyleDefinition.symbolPaintDefinition;break;case g.StyleLayerType.CIRCLE:this._layoutDefinition=g.StyleDefinition.circleLayoutDefinition,
this._paintDefinition=g.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout);this._paintProperties=this._parsePaint(this.paint)}var B=H.prototype;B.getFeatureFilter=function(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=d.createFilter(this.filter)};B.getLayoutProperty=function(y){return this._layoutProperties[y]};B.getPaintProperty=function(y){return this._paintProperties[y]};B.getLayoutValue=function(y,F,N){let Q;const L=this._layoutProperties[y];
L&&(Q=L.getValue(F,N));void 0===Q&&(Q=this._layoutDefinition[y]["default"]);return Q};B.getPaintValue=function(y,F,N){let Q;const L=this._paintProperties[y];L&&(Q=L.getValue(F,N));void 0===Q&&(Q=this._paintDefinition[y]["default"]);return Q};B.isPainterDataDriven=function(){const y=this._paintProperties;if(y)for(const F in y)if(y[F].isDataDriven)return!0;return!1};B._parseLayout=function(y){const F={};for(const N in y){const Q=this._layoutDefinition[N];Q&&(F[N]=new l(Q,y[N]))}return F};B._parsePaint=
function(y){const F={};for(const N in y){const Q=this._paintDefinition[N];Q&&(F[N]=new l(Q,y[N]))}return F};B.computeAttributesKey=function(y,F,N,Q){let L=0,S=0;for(const R of F){F=3;if(!R||R!==Q){const {isLayout:T,isOptional:O}=N[R];F=T?this.getLayoutProperty(R):this.getPaintProperty(R);F=null!=F&&F.interpolator?2:null!=F&&F.isDataDriven?1:O&&!F?3:0}S|=F<<L;L+=2}return S<<3|y};return H}(),h=function(H){function B(y,F,N,Q){y=H.call(this,y,F,N,Q)||this;y.backgroundMaterial=new e.VTLBackgroundMaterial(y.computeAttributesKey(x.ShaderProgramType.BACKGROUND,
e.VTLBackgroundMaterial.ATTRIBUTES,e.VTLBackgroundMaterial.ATTRIBUTES_INFO));return y}D._inheritsLoose(B,H);return B}(m),u=function(H){function B(y,F,N,Q){y=H.call(this,y,F,N,Q)||this;F=y.getPaintProperty("fill-color");N=y.getPaintProperty("fill-opacity");Q=y.getPaintProperty("fill-pattern");y.hasDataDrivenColor=null==F?void 0:F.isDataDriven;y.hasDataDrivenOpacity=null==N?void 0:N.isDataDriven;y.hasDataDrivenFill=y.hasDataDrivenColor||y.hasDataDrivenOpacity||(null==Q?void 0:Q.isDataDriven);N=y.getPaintProperty("fill-outline-color");
y.outlineUsesFillColor=!N;y.hasDataDrivenOutlineColor=null==N?void 0:N.isDataDriven;y.hasDataDrivenOutline=N?N.isDataDriven:F?F.isDataDriven:!1;y.hasDataDrivenOutline=(N?y.hasDataDrivenOutlineColor:y.hasDataDrivenColor)||y.hasDataDrivenOpacity;y.fillMaterial=new b.VTLFillMaterial(y.computeAttributesKey(x.ShaderProgramType.FILL,b.VTLFillMaterial.ATTRIBUTES,b.VTLFillMaterial.ATTRIBUTES_INFO));y.outlineMaterial=new b.VTLOutlineMaterial(y.computeAttributesKey(x.ShaderProgramType.OUTLINE,y.outlineUsesFillColor?
b.VTLOutlineMaterial.ATTRIBUTES_FILL:b.VTLOutlineMaterial.ATTRIBUTES_OUTLINE,y.outlineUsesFillColor?b.VTLOutlineMaterial.ATTRIBUTES_INFO_FILL:b.VTLOutlineMaterial.ATTRIBUTES_INFO_OUTLINE),y.outlineUsesFillColor);return y}D._inheritsLoose(B,H);return B}(m),w=function(H){function B(y,F,N,Q){var L,S,R,T,O,K,G,M,U;y=H.call(this,y,F,N,Q)||this;F=y.getPaintProperty("line-pattern");y.lineMaterial=new c.VTLLineMaterial(y.computeAttributesKey(x.ShaderProgramType.LINE,c.VTLLineMaterial.ATTRIBUTES,c.VTLLineMaterial.ATTRIBUTES_INFO,
F?"line-dasharray":""));y.hasDataDrivenLine=(null==(L=y.getPaintProperty("line-blur"))?void 0:L.isDataDriven)||(null==(S=y.getPaintProperty("line-color"))?void 0:S.isDataDriven)||(null==(R=y.getPaintProperty("line-gap-width"))?void 0:R.isDataDriven)||(null==(T=y.getPaintProperty("line-offset"))?void 0:T.isDataDriven)||(null==(O=y.getPaintProperty("line-opacity"))?void 0:O.isDataDriven)||(null==(K=y.getPaintProperty("line-pattern"))?void 0:K.isDataDriven)||(null==(G=y.getPaintProperty("line-dasharray"))?
void 0:G.isDataDriven)||(null==(M=y.getLayoutProperty("line-cap"))?void 0:M.isDataDriven)||(null==(U=y.getPaintProperty("line-width"))?void 0:U.isDataDriven);y.canUseThinTessellation=!1;!y.hasDataDrivenLine&&(L=y.getPaintProperty("line-width"),!L||"number"===typeof L&&.5*L<p.THIN_LINE_HALF_WIDTH_THRESHOLD)&&(L=y.getPaintProperty("line-offset"),!L||"number"===typeof L&&0===L)&&(y.canUseThinTessellation=!0);return y}D._inheritsLoose(B,H);B.prototype.getDashKey=function(y,F){switch(F){case v.CapType.BUTT:F=
"Butt";break;case v.CapType.ROUND:F="Round";break;case v.CapType.SQUARE:F="Square";break;default:F="Butt"}return`dasharray-[${y.toString()}]-${F}`};return B}(m),k=function(H){function B(y,F,N,Q){var L,S,R,T,O,K,G,M,U,Y,ca,da;y=H.call(this,y,F,N,Q)||this;y.iconMaterial=new a.VTLIconMaterial(y.computeAttributesKey(x.ShaderProgramType.ICON,a.VTLIconMaterial.ATTRIBUTES,a.VTLIconMaterial.ATTRIBUTES_INFO));y.textMaterial=new a.VTLTextMaterial(y.computeAttributesKey(x.ShaderProgramType.TEXT,a.VTLTextMaterial.ATTRIBUTES,
a.VTLTextMaterial.ATTRIBUTES_INFO));y.hasDataDrivenIcon=(null==(L=y.getPaintProperty("icon-color"))?void 0:L.isDataDriven)||(null==(S=y.getPaintProperty("icon-halo-blur"))?void 0:S.isDataDriven)||(null==(R=y.getPaintProperty("icon-halo-color"))?void 0:R.isDataDriven)||(null==(T=y.getPaintProperty("icon-halo-width"))?void 0:T.isDataDriven)||(null==(O=y.getPaintProperty("icon-opacity"))?void 0:O.isDataDriven)||(null==(K=y.getLayoutProperty("icon-size"))?void 0:K.isDataDriven);y.hasDataDrivenText=(null==
(G=y.getPaintProperty("text-color"))?void 0:G.isDataDriven)||(null==(M=y.getPaintProperty("text-halo-blur"))?void 0:M.isDataDriven)||(null==(U=y.getPaintProperty("text-halo-color"))?void 0:U.isDataDriven)||(null==(Y=y.getPaintProperty("text-halo-width"))?void 0:Y.isDataDriven)||(null==(ca=y.getPaintProperty("text-opacity"))?void 0:ca.isDataDriven)||(null==(da=y.getLayoutProperty("text-size"))?void 0:da.isDataDriven);return y}D._inheritsLoose(B,H);return B}(m),t=function(H){function B(y,F,N,Q){y=H.call(this,
y,F,N,Q)||this;y.circleMaterial=new q.VTLCircleMaterial(y.computeAttributesKey(x.ShaderProgramType.CIRCLE,q.VTLCircleMaterial.ATTRIBUTES,q.VTLCircleMaterial.ATTRIBUTES_INFO));return y}D._inheritsLoose(B,H);return B}(m),C=function(){function H(B,y,F){var N,Q,L,S,R;this.allowOverlap=B.getLayoutValue("icon-allow-overlap",y);this.ignorePlacement=B.getLayoutValue("icon-ignore-placement",y);this.keepUpright=B.getLayoutValue("icon-keep-upright",y);this.optional=B.getLayoutValue("icon-optional",y);this.rotationAlignment=
B.getLayoutValue("icon-rotation-alignment",y);this.rotationAlignment===g.RotationAlignment.AUTO&&(this.rotationAlignment=F?g.RotationAlignment.MAP:g.RotationAlignment.VIEWPORT);F=B.getLayoutProperty("icon-anchor");null!=(N=F)&&N.isDataDriven?this._anchorProp=F:this.anchor=B.getLayoutValue("icon-anchor",y);F=B.getLayoutProperty("icon-offset");null!=(Q=F)&&Q.isDataDriven?this._offsetProp=F:this.offset=B.getLayoutValue("icon-offset",y);F=B.getLayoutProperty("icon-padding");null!=(L=F)&&L.isDataDriven?
this._paddingProp=F:this.padding=B.getLayoutValue("icon-padding",y);F=B.getLayoutProperty("icon-rotate");null!=(S=F)&&S.isDataDriven?this._rotateProp=F:this.rotate=B.getLayoutValue("icon-rotate",y);F=B.getLayoutProperty("icon-size");null!=(R=F)&&R.isDataDriven?this._sizeProp=F:this.size=B.getLayoutValue("icon-size",y)}H.prototype.update=function(B,y){this._anchorProp&&(this.anchor=this._anchorProp.getValue(B,y));this._offsetProp&&(this.offset=this._offsetProp.getValue(B,y));this._paddingProp&&(this.padding=
this._paddingProp.getValue(B,y));this._rotateProp&&(this.rotate=this._rotateProp.getValue(B,y));this._sizeProp&&(this.size=this._sizeProp.getValue(B,y))};return H}(),I=function(){function H(B,y,F){var N,Q,L,S,R,T,O,K,G,M,U;this.allowOverlap=B.getLayoutValue("text-allow-overlap",y);this.ignorePlacement=B.getLayoutValue("text-ignore-placement",y);this.keepUpright=B.getLayoutValue("text-keep-upright",y);this.optional=B.getLayoutValue("text-optional",y);this.rotationAlignment=B.getLayoutValue("text-rotation-alignment",
y);this.rotationAlignment===g.RotationAlignment.AUTO&&(this.rotationAlignment=F?g.RotationAlignment.MAP:g.RotationAlignment.VIEWPORT);F=B.getLayoutProperty("text-anchor");null!=(N=F)&&N.isDataDriven?this._anchorProp=F:this.anchor=B.getLayoutValue("text-anchor",y);F=B.getLayoutProperty("text-justify");null!=(Q=F)&&Q.isDataDriven?this._justifyProp=F:this.justify=B.getLayoutValue("text-justify",y);F=B.getLayoutProperty("text-letter-spacing");null!=(L=F)&&L.isDataDriven?this._letterSpacingProp=F:this.letterSpacing=
B.getLayoutValue("text-letter-spacing",y);F=B.getLayoutProperty("text-line-height");null!=(S=F)&&S.isDataDriven?this._lineHeightProp=F:this.lineHeight=B.getLayoutValue("text-line-height",y);F=B.getLayoutProperty("text-max-angle");null!=(R=F)&&R.isDataDriven?this._maxAngleProp=F:this.maxAngle=B.getLayoutValue("text-max-angle",y);F=B.getLayoutProperty("text-max-width");null!=(T=F)&&T.isDataDriven?this._maxWidthProp=F:this.maxWidth=B.getLayoutValue("text-max-width",y);F=B.getLayoutProperty("text-offset");
null!=(O=F)&&O.isDataDriven?this._offsetProp=F:this.offset=B.getLayoutValue("text-offset",y);F=B.getLayoutProperty("text-padding");null!=(K=F)&&K.isDataDriven?this._paddingProp=F:this.padding=B.getLayoutValue("text-padding",y);F=B.getLayoutProperty("text-rotate");null!=(G=F)&&G.isDataDriven?this._rotateProp=F:this.rotate=B.getLayoutValue("text-rotate",y);F=B.getLayoutProperty("text-size");null!=(M=F)&&M.isDataDriven?this._sizeProp=F:this.size=B.getLayoutValue("text-size",y);F=B.getLayoutProperty("text-writing-mode");
null!=(U=F)&&U.isDataDriven?this._writingModeProp=F:this.writingMode=B.getLayoutValue("text-writing-mode",y)}H.prototype.update=function(B,y){this._anchorProp&&(this.anchor=this._anchorProp.getValue(B,y));this._justifyProp&&(this.justify=this._justifyProp.getValue(B,y));this._letterSpacingProp&&(this.letterSpacing=this._letterSpacingProp.getValue(B,y));this._lineHeightProp&&(this.lineHeight=this._lineHeightProp.getValue(B,y));this._maxAngleProp&&(this.maxAngle=this._maxAngleProp.getValue(B,y));this._maxWidthProp&&
(this.maxWidth=this._maxWidthProp.getValue(B,y));this._offsetProp&&(this.offset=this._offsetProp.getValue(B,y));this._paddingProp&&(this.padding=this._paddingProp.getValue(B,y));this._rotateProp&&(this.rotate=this._rotateProp.getValue(B,y));this._sizeProp&&(this.size=this._sizeProp.getValue(B,y));this._writingModeProp&&(this.writingMode=this._writingModeProp.getValue(B,y))};return H}();A.BackgroundStyleLayer=h;A.CircleStyleLayer=t;A.FillStyleLayer=u;A.IconLayout=C;A.LineStyleLayer=w;A.StyleLayer=
m;A.SymbolStyleLayer=k;A.TextLayout=I;Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/shaders/VTLBackgroundMaterial":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./VTLMaterial","../../../../webgl/enums","../../../../webgl/VertexElementDescriptor"],function(A,D,v,x,e){v=function(q){function b(a){return q.call(this,a)||this}D._inheritsLoose(b,q);var c=b.prototype;c.geometryInfo=function(){return b.GEOMETRY_LAYOUT};
c.opacityInfo=function(){return null};c.attributes=function(){return b.ATTRIBUTES};c.attributesInfo=function(){return b.ATTRIBUTES_INFO};return b}(v.VTLMaterial);v.ATTRIBUTES=[];v.GEOMETRY_LAYOUT=[new e.VertexElementDescriptor("a_pos",2,x.DataType.BYTE,0,2)];v.ATTRIBUTES_INFO={};A.VTLBackgroundMaterial=v;Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/shaders/VTLMaterial":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../MemoryBuffer ./enums ../../../../webgl/enums ../../../../webgl/VertexElementDescriptor".split(" "),
function(A,D,v,x,e,q,b){let c=function(){function g(p){this._locations=new Map;this._key=p}var l=g.prototype;l.defines=function(){return[]};l.getStride=function(){this._layoutInfo||this._buildAttributesInfo();return this._stride};l.getAttributeLocations=function(){0===this._locations.size&&this._buildAttributesInfo();return this._locations};l.getLayoutInfo=function(){this._layoutInfo||this._buildAttributesInfo();return this._layoutInfo};l.getEncodingInfos=function(){this._propertyEncodingInfo||this._buildAttributesInfo();
return this._propertyEncodingInfo};l.getUniforms=function(){this._uniforms||this._buildAttributesInfo();return this._uniforms};l.getShaderHeader=function(){this._shaderHeader||this._buildAttributesInfo();return this._shaderHeader};l.getShaderMain=function(){this._shaderMain||this._buildAttributesInfo();return this._shaderMain};l.setDataUniforms=function(p,m,h,u,w){var k=this.getUniforms();for(const t of k){const {name:C,type:I,getValue:H}=t;k=H(h,m,u,w);if(null!==k)switch(I){case "float":p.setUniform1f(C,
k);break;case "vec2":p.setUniform2fv(C,k);break;case "vec4":p.setUniform4fv(C,k)}}};l.encodeAttributes=function(p,m,h,u){const w=this.attributesInfo(),k=this.getEncodingInfos(),t=[];let C=0,I=0;for(const y of Object.keys(k)){var H,B=k[y];const {type:F,precisionFactor:N,isLayout:Q}=w[y],L=Q?h.getLayoutProperty(y):h.getPaintProperty(y),S=null==(H=L.interpolator)?void 0:H.getInterpolationRange(m);let R=0;for(const T of B){const {offset:O,bufferElementsToAdd:K}=T;if(0<K){for(B=0;B<K;B++)t.push(0);C+=
I;I=T.bufferElementsToAdd}B=null!=u?u:L.getValue(S?S[R]:m,p);switch(F){case e.EncodingType.R8_SIGNED:case e.EncodingType.R8_UNSIGNED:t[C]|=this._encodeByte(B*(N||1),8*O);break;case e.EncodingType.R16_SIGNED:case e.EncodingType.R16_UNSIGNED:t[C]|=this._encodeShort(B*(N||1),8*O);break;case e.EncodingType.R8G8_SIGNED:case e.EncodingType.R8G8_UNSIGNED:t[C]|=this._encodeByte(B*(N||1),8*O);t[C]|=this._encodeByte(B*(N||1),8*O+8);break;case e.EncodingType.R16G16_SIGNED:case e.EncodingType.R16G16_UNSIGNED:t[C]|=
this._encodeShort(B*(N||1),8*O);t[C]|=this._encodeShort(B*(N||1),8*O+16);break;case e.EncodingType.R8G8B8A8_SIGNED:case e.EncodingType.R8G8B8A8_UNSIGNED:t[C]|=this._encodeByte(B*(N||1),8*O);t[C]|=this._encodeByte(B*(N||1),8*O+8);t[C]|=this._encodeByte(B*(N||1),8*O+16);t[C]|=this._encodeByte(B*(N||1),8*O+24);break;case e.EncodingType.R8G8B8A8_COLOR:t[C]=this._encodeColor(B);break;case e.EncodingType.R16G16B16A16_DASHARRAY:case e.EncodingType.R16G16B16A16_PATTERN:this._encodePattern(C,t,B);break;default:throw Error("Unsupported encoding type");
}R++}}return t};l.getAtributeState=function(p){const m=3+2*p;p=0|this._bit(m);return p|=this._bit(m+1)<<1};l._buildAttributesInfo=function(){const p=[],m={};var h={},u=-1;const w=this.attributesInfo();var k=this.attributes();let t=-1;for(const B of k){t++;k=this.getAtributeState(t);if(k===e.AttributeStatus.UNIFORM||k===e.AttributeStatus.UNUSED)continue;var C=w[B];const y=[];m[B]=y;C=C.type;for(let F=0;F<k;F++){const {dataType:N,bytesPerElement:Q,count:L,normalized:S}=g._encodingInfo[C],R=Q*L;var I=
`${N}-${!0===S}`;let T=h[I],O=0;!T||4<T.count+L?(u++,T={dataIndex:u,count:0,offset:0},4!==L&&(h[I]=T),p.push({location:-1,name:"a_data_"+u,count:L,type:N,normalized:S}),O=Math.ceil(Math.max(R/4,1))):(I=p[T.dataIndex],I.count+=L,O=Math.ceil(Math.max(I.count*Q/4,1))-Math.ceil(Math.max(T.offset/4,1)));y.push({dataIndex:T.dataIndex,offset:T.offset,bufferElementsToAdd:O});T.offset+=R;T.count+=L}}for(const B of p)switch(B.type){case q.DataType.BYTE:case q.DataType.UNSIGNED_BYTE:B.count=4;break;case q.DataType.SHORT:case q.DataType.UNSIGNED_SHORT:B.count+=
B.count%2}this._buildVertexBufferLayout(p);h=0;u=this._layoutInfo.geometry;for(var H of u)this._locations.set(H.name,h++);if(H=this._layoutInfo.opacity)for(const B of H)this._locations.set(B.name,h++);this._buildShaderInfo(p,m);this._propertyEncodingInfo=m};l._buildVertexBufferLayout=function(p){const m={},h=this.geometryInfo();let u=h[0].stride;if(0===p.length)m.geometry=h;else{const w=[];let k=u;for(const t of p)u+=a(t.type)*t.count;for(const t of h)w.push(new b.VertexElementDescriptor(t.name,t.count,
t.type,t.offset,u,t.normalized));for(const t of p)w.push(new b.VertexElementDescriptor(t.name,t.count,t.type,k,u,t.normalized)),k+=a(t.type)*t.count;m.geometry=w}this.opacityInfo()&&(m.opacity=this.opacityInfo());this._layoutInfo=m;this._stride=u};l._buildShaderInfo=function(p,m){let h="\n",u="\n";const w=[];for(var k of p)h+=`attribute ${this._getType(k.count)} ${k.name};\n`;var t=this.attributes();p=this.attributesInfo();k=-1;for(const H of t){k++;const {name:B,type:y,precisionFactor:F,isLayout:N}=
p[H];t=F&&1!==F?` * ${1/F}`:"";const {bytesPerElement:Q,count:L}=g._encodingInfo[y];var C=S=>`a_data_${S.dataIndex}${d(L,S.offset,Q)}`;switch(this.getAtributeState(k)){case e.AttributeStatus.UNIFORM:t=this._getType(L);var I=`u_${B}`;w.push({name:I,type:t,getValue:(S,R,T,O)=>{T=N?S.getLayoutValue(H,R):S.getPaintValue(H,R);if(y===e.EncodingType.R16G16B16A16_DASHARRAY){S=S.getDashKey(T,S.getLayoutValue("line-cap",R));O=O.getMosaicItemPosition(S,!1);if(v.isNone(O))return null;const {tl:K,br:G}=O;return[K[0],
G[1],G[0],K[1]]}if(y===e.EncodingType.R16G16B16A16_PATTERN){O=O.getMosaicItemPosition(T,!H.includes("line-"));if(v.isNone(O))return null;const {tl:K,br:G}=O;return[K[0],G[1],G[0],K[1]]}return y===e.EncodingType.R8G8B8A8_COLOR?(O=T[3],[O*T[0],O*T[1],O*T[2],O]):T}});h+=`uniform ${t} ${I};\n`;u+=`${t} ${B} = ${I};\n`;break;case e.AttributeStatus.DATA_DRIVEN:I=C(m[H][0]);u+=`${this._getType(L)} ${B} = ${I}${t};\n`;break;case e.AttributeStatus.INTERPOLATED_DATA_DRIVEN:{I=`u_t_${B}`;w.push({name:I,type:"float",
getValue:(R,T,O,K)=>(N?R.getLayoutProperty(H):R.getPaintProperty(H)).interpolator.interpolationUniformValue(O,T)});h+=`uniform float ${I};\n`;const S=C(m[H][0]);C=C(m[H][1]);u+=`${this._getType(L)} ${B} = mix(${S}${t}, ${C}${t}, ${I});\n`}}}this._shaderHeader=h;this._shaderMain=u;this._uniforms=w};l._bit=function(p){return(this._key&1<<p)>>p};l._getType=function(p){switch(p){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4"}throw Error("Invalid count");};l._encodeColor=
function(p){const m=255*p[3];return x.i8888to32(p[0]*m,p[1]*m,p[2]*m,m)};l._encodePattern=function(p,m,h){if(h&&h.rect){var u=h.rect,w=h.width;h=h.height;m[p]=this._encodeShort(u.x+2,0);m[p]|=this._encodeShort(u.y+2+h,16);m[p+1]=this._encodeShort(u.x+2+w,0);m[p+1]|=this._encodeShort(u.y+2,16)}};l._encodeByte=function(p,m){return(p&255)<<m};l._encodeShort=function(p,m){return(p&65535)<<m};D._createClass(g,[{key:"key",get:function(){return this._key}},{key:"type",get:function(){return this._key&7}}]);
return g}();c._encodingInfo={[e.EncodingType.R8_SIGNED]:{dataType:q.DataType.BYTE,bytesPerElement:1,count:1,normalized:!1},[e.EncodingType.R8_UNSIGNED]:{dataType:q.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:1,normalized:!1},[e.EncodingType.R16_SIGNED]:{dataType:q.DataType.SHORT,bytesPerElement:2,count:1,normalized:!1},[e.EncodingType.R16_UNSIGNED]:{dataType:q.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:1,normalized:!1},[e.EncodingType.R8G8_SIGNED]:{dataType:q.DataType.BYTE,bytesPerElement:1,
count:2,normalized:!1},[e.EncodingType.R8G8_UNSIGNED]:{dataType:q.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:2,normalized:!1},[e.EncodingType.R16G16_SIGNED]:{dataType:q.DataType.SHORT,bytesPerElement:2,count:2,normalized:!1},[e.EncodingType.R16G16_UNSIGNED]:{dataType:q.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:2,normalized:!1},[e.EncodingType.R8G8B8A8_SIGNED]:{dataType:q.DataType.BYTE,bytesPerElement:1,count:4,normalized:!1},[e.EncodingType.R8G8B8A8_UNSIGNED]:{dataType:q.DataType.UNSIGNED_BYTE,
bytesPerElement:1,count:4,normalized:!1},[e.EncodingType.R8G8B8A8_COLOR]:{dataType:q.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!0},[e.EncodingType.R16G16B16A16_DASHARRAY]:{dataType:q.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1},[e.EncodingType.R16G16B16A16_PATTERN]:{dataType:q.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1}};const a=g=>{switch(g){case q.DataType.FLOAT:return 4;case q.DataType.INT:return 4;case q.DataType.UNSIGNED_INT:return 4;
case q.DataType.SHORT:return 2;case q.DataType.UNSIGNED_SHORT:return 2;case q.DataType.BYTE:return 1;case q.DataType.UNSIGNED_BYTE:return 1}},d=(g,l,p)=>{l/=p;if(1===g)switch(l){case 0:return".x";case 1:return".y";case 2:return".z";case 3:return".w"}else if(2===g)switch(l){case 0:return".xy";case 1:return".yz";case 2:return".zw"}else if(3===g)switch(l){case 0:return".xyz";case 1:return".yzw"}return""};A.VTLMaterial=c;Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/2d/engine/vectorTiles/MemoryBuffer":function(){define(["../../../../chunks/_rollupPluginBabelHelpers"],function(A){return function(){function D(x){this._array=[];0>=x&&console.error("strideInBytes must be positive!");this._stride=x}var v=D.prototype;v.reset=function(){this.array.length=0};v.toBuffer=function(){return(new Uint32Array(this._array)).buffer};D.i1616to32=function(x,e){return 65535&x|e<<16};D.i8888to32=function(x,e,q,b){return x&255|(e&255)<<8|(q&255)<<16|b<<24};D.i8816to32=
function(x,e,q){return x&255|(e&255)<<8|q<<16};A._createClass(D,[{key:"array",get:function(){return this._array}},{key:"index",get:function(){return 4*this._array.length/this._stride}},{key:"itemSize",get:function(){return this._stride}},{key:"sizeInBytes",get:function(){return 4*this._array.length}}]);return D}()})},"esri/views/2d/engine/vectorTiles/shaders/enums":function(){define(["exports"],function(A){A.EncodingType=void 0;(function(D){D[D.R8_SIGNED=0]="R8_SIGNED";D[D.R8_UNSIGNED=1]="R8_UNSIGNED";
D[D.R16_SIGNED=2]="R16_SIGNED";D[D.R16_UNSIGNED=3]="R16_UNSIGNED";D[D.R8G8_SIGNED=4]="R8G8_SIGNED";D[D.R8G8_UNSIGNED=5]="R8G8_UNSIGNED";D[D.R16G16_SIGNED=6]="R16G16_SIGNED";D[D.R16G16_UNSIGNED=7]="R16G16_UNSIGNED";D[D.R8G8B8A8_SIGNED=8]="R8G8B8A8_SIGNED";D[D.R8G8B8A8_UNSIGNED=9]="R8G8B8A8_UNSIGNED";D[D.R8G8B8A8_COLOR=10]="R8G8B8A8_COLOR";D[D.R16G16B16A16_DASHARRAY=11]="R16G16B16A16_DASHARRAY";D[D.R16G16B16A16_PATTERN=12]="R16G16B16A16_PATTERN"})(A.EncodingType||(A.EncodingType={}));A.AttributeStatus=
void 0;(function(D){D[D.UNIFORM=0]="UNIFORM";D[D.DATA_DRIVEN=1]="DATA_DRIVEN";D[D.INTERPOLATED_DATA_DRIVEN=2]="INTERPOLATED_DATA_DRIVEN";D[D.UNUSED=3]="UNUSED"})(A.AttributeStatus||(A.AttributeStatus={}));Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/shaders/VTLCircleMaterial":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ./enums ./VTLMaterial ../../../../webgl/enums ../../../../webgl/VertexElementDescriptor".split(" "),
function(A,D,v,x,e,q){x=function(b){function c(d){return b.call(this,d)||this}D._inheritsLoose(c,b);var a=c.prototype;a.geometryInfo=function(){return c.GEOMETRY_LAYOUT};a.opacityInfo=function(){return null};a.attributes=function(){return c.ATTRIBUTES};a.attributesInfo=function(){return c.ATTRIBUTES_INFO};return c}(x.VTLMaterial);x.ATTRIBUTES="circle-radius circle-color circle-opacity circle-stroke-width circle-stroke-color circle-stroke-opacity circle-blur".split(" ");x.GEOMETRY_LAYOUT=[new q.VertexElementDescriptor("a_pos",
2,e.DataType.SHORT,0,4)];x.ATTRIBUTES_INFO={"circle-radius":{name:"radius",type:v.EncodingType.R8_UNSIGNED},"circle-color":{name:"color",type:v.EncodingType.R8G8B8A8_COLOR},"circle-opacity":{name:"opacity",type:v.EncodingType.R8_UNSIGNED,precisionFactor:100},"circle-stroke-width":{name:"stroke_width",type:v.EncodingType.R8_UNSIGNED,precisionFactor:4},"circle-stroke-color":{name:"stroke_color",type:v.EncodingType.R8G8B8A8_COLOR},"circle-stroke-opacity":{name:"stroke_opacity",type:v.EncodingType.R8_UNSIGNED,
precisionFactor:100},"circle-blur":{name:"blur",type:v.EncodingType.R8_UNSIGNED,precisionFactor:32}};A.VTLCircleMaterial=x;Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/shaders/VTLFillMaterial":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ./enums ./VTLMaterial ../../../../webgl/enums ../../../../webgl/VertexElementDescriptor".split(" "),function(A,D,v,x,e,q){let b=function(c){function a(g){return c.call(this,
g)||this}D._inheritsLoose(a,c);var d=a.prototype;d.geometryInfo=function(){return a.GEOMETRY_LAYOUT};d.opacityInfo=function(){return null};d.attributes=function(){return a.ATTRIBUTES};d.attributesInfo=function(){return a.ATTRIBUTES_INFO};return a}(x.VTLMaterial);b.ATTRIBUTES=["fill-color","fill-opacity","fill-pattern"];b.GEOMETRY_LAYOUT=[new q.VertexElementDescriptor("a_pos",2,e.DataType.SHORT,0,4)];b.ATTRIBUTES_INFO={"fill-color":{name:"color",type:v.EncodingType.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",
type:v.EncodingType.R8_UNSIGNED,precisionFactor:100},"fill-pattern":{name:"tlbr",type:v.EncodingType.R16G16B16A16_PATTERN,isOptional:!0}};x=function(c){function a(g,l){g=c.call(this,g)||this;g.usefillColor=l;return g}D._inheritsLoose(a,c);var d=a.prototype;d.geometryInfo=function(){return a.GEOMETRY_LAYOUT};d.opacityInfo=function(){return null};d.attributes=function(){return this.usefillColor?a.ATTRIBUTES_FILL:a.ATTRIBUTES_OUTLINE};d.attributesInfo=function(){return this.usefillColor?a.ATTRIBUTES_INFO_FILL:
a.ATTRIBUTES_INFO_OUTLINE};return a}(x.VTLMaterial);x.ATTRIBUTES_OUTLINE=["fill-outline-color","fill-opacity"];x.ATTRIBUTES_FILL=["fill-color","fill-opacity"];x.GEOMETRY_LAYOUT=[new q.VertexElementDescriptor("a_pos",2,e.DataType.SHORT,0,8),new q.VertexElementDescriptor("a_offset",2,e.DataType.BYTE,4,8),new q.VertexElementDescriptor("a_xnormal",2,e.DataType.BYTE,6,8)];x.ATTRIBUTES_INFO_OUTLINE={"fill-outline-color":{name:"color",type:v.EncodingType.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:v.EncodingType.R8_UNSIGNED,
precisionFactor:100}};x.ATTRIBUTES_INFO_FILL={"fill-color":{name:"color",type:v.EncodingType.R8G8B8A8_COLOR},"fill-opacity":{name:"opacity",type:v.EncodingType.R8_UNSIGNED,precisionFactor:100}};A.VTLFillMaterial=b;A.VTLOutlineMaterial=x;Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/shaders/VTLLineMaterial":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ./enums ./VTLMaterial ../../../../webgl/enums ../../../../webgl/VertexElementDescriptor".split(" "),
function(A,D,v,x,e,q){x=function(b){function c(d){return b.call(this,d)||this}D._inheritsLoose(c,b);var a=c.prototype;a.geometryInfo=function(){return c.GEOMETRY_LAYOUT};a.opacityInfo=function(){return null};a.attributes=function(){return c.ATTRIBUTES};a.attributesInfo=function(){return c.ATTRIBUTES_INFO};return c}(x.VTLMaterial);x.ATTRIBUTES="line-blur line-color line-gap-width line-offset line-opacity line-width line-pattern line-dasharray".split(" ");x.GEOMETRY_LAYOUT=[new q.VertexElementDescriptor("a_pos",
2,e.DataType.SHORT,0,16),new q.VertexElementDescriptor("a_extrude_offset",4,e.DataType.BYTE,4,16),new q.VertexElementDescriptor("a_dir_normal",4,e.DataType.BYTE,8,16),new q.VertexElementDescriptor("a_accumulatedDistance",2,e.DataType.UNSIGNED_SHORT,12,16)];x.ATTRIBUTES_INFO={"line-width":{name:"width",type:v.EncodingType.R8_UNSIGNED,precisionFactor:2},"line-gap-width":{name:"gap_width",type:v.EncodingType.R8_UNSIGNED,precisionFactor:2},"line-offset":{name:"offset",type:v.EncodingType.R8_SIGNED,precisionFactor:2},
"line-color":{name:"color",type:v.EncodingType.R8G8B8A8_COLOR},"line-opacity":{name:"opacity",type:v.EncodingType.R8_UNSIGNED,precisionFactor:100},"line-blur":{name:"blur",type:v.EncodingType.R8_UNSIGNED,precisionFactor:4},"line-pattern":{name:"tlbr",type:v.EncodingType.R16G16B16A16_PATTERN,isOptional:!0},"line-dasharray":{name:"tlbr",type:v.EncodingType.R16G16B16A16_DASHARRAY,isOptional:!0}};A.VTLLineMaterial=x;Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/2d/engine/vectorTiles/shaders/VTLSymbolMaterial":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ./enums ./VTLMaterial ../../../../webgl/enums ../../../../webgl/VertexElementDescriptor".split(" "),function(A,D,v,x,e,q){const b=[new q.VertexElementDescriptor("a_pos",2,e.DataType.SHORT,0,16),new q.VertexElementDescriptor("a_vertexOffset",2,e.DataType.SHORT,4,16),new q.VertexElementDescriptor("a_texAngleRange",4,e.DataType.UNSIGNED_BYTE,8,16),new q.VertexElementDescriptor("a_levelInfo",
4,e.DataType.UNSIGNED_BYTE,12,16)],c=[new q.VertexElementDescriptor("a_opacityInfo",1,e.DataType.UNSIGNED_BYTE,0,1)];e=function(a){function d(l){return a.call(this,l)||this}D._inheritsLoose(d,a);var g=d.prototype;g.geometryInfo=function(){return b};g.opacityInfo=function(){return c};g.attributes=function(){return d.ATTRIBUTES};g.attributesInfo=function(){return d.ATTRIBUTES_INFO};return d}(x.VTLMaterial);e.ATTRIBUTES="icon-color icon-opacity icon-halo-blur icon-halo-color icon-halo-width icon-size".split(" ");
e.ATTRIBUTES_INFO={"icon-color":{name:"color",type:v.EncodingType.R8G8B8A8_COLOR},"icon-opacity":{name:"opacity",type:v.EncodingType.R8_UNSIGNED,precisionFactor:100},"icon-halo-color":{name:"halo_color",type:v.EncodingType.R8G8B8A8_COLOR},"icon-halo-width":{name:"halo_width",type:v.EncodingType.R8_UNSIGNED,precisionFactor:4},"icon-halo-blur":{name:"halo_blur",type:v.EncodingType.R8_UNSIGNED,precisionFactor:4},"icon-size":{name:"size",type:v.EncodingType.R8_UNSIGNED,precisionFactor:32,isLayout:!0}};
x=function(a){function d(l){return a.call(this,l)||this}D._inheritsLoose(d,a);var g=d.prototype;g.geometryInfo=function(){return b};g.opacityInfo=function(){return c};g.attributes=function(){return d.ATTRIBUTES};g.attributesInfo=function(){return d.ATTRIBUTES_INFO};return d}(x.VTLMaterial);x.ATTRIBUTES="text-color text-opacity text-halo-blur text-halo-color text-halo-width text-size".split(" ");x.ATTRIBUTES_INFO={"text-color":{name:"color",type:v.EncodingType.R8G8B8A8_COLOR},"text-opacity":{name:"opacity",
type:v.EncodingType.R8_UNSIGNED,precisionFactor:100},"text-halo-color":{name:"halo_color",type:v.EncodingType.R8G8B8A8_COLOR},"text-halo-width":{name:"halo_width",type:v.EncodingType.R8_UNSIGNED,precisionFactor:4},"text-halo-blur":{name:"halo_blur",type:v.EncodingType.R8_UNSIGNED,precisionFactor:4},"text-size":{name:"size",type:v.EncodingType.R8_UNSIGNED,isLayout:!0}};A.VTLIconMaterial=e;A.VTLTextMaterial=x;Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/2d/engine/vectorTiles/style/Filter":function(){define(["../expression/expression","../expression/types"],function(A,D){return function(){function v(x){this._expression=x}v.prototype.filter=function(x,e){if(!this._expression)return!0;try{return this._expression.evaluate(x,e)}catch(q){return console.log(q.message),!0}};v.createFilter=function(x){if(!x)return null;this.isLegacyFilter(x)&&(x=this.convertLegacyFilter(x));try{const e=A.createExpression(x,null,D.BooleanType);return new v(e)}catch(e){return console.log(e.message),
null}};v.isLegacyFilter=function(x){if(!Array.isArray(x)||0===x.length)return!0;switch(x[0]){case "\x3d\x3d":case "!\x3d":case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return 3===x.length&&"string"===typeof x[1]&&!Array.isArray(x[2]);case "in":return 3<=x.length&&"string"===typeof x[1]&&!Array.isArray(x[2]);case "!in":return!0;case "any":case "all":for(let e=1;e<x.length;e++)if(this.isLegacyFilter(x[e]))return!0;return!1;case "none":return!0;case "has":return 2===x.length&&("$id"===x[1]||
"$type"===x[1]);case "!has":return!0;default:return!1}};v.convertLegacyFilter=function(x){if(!Array.isArray(x)||0===x.length)return!0;const e=x[0];if(1===x.length)return"any"!==e;switch(e){case "\x3d\x3d":return v.convertComparison("\x3d\x3d",x[1],x[2]);case "!\x3d":return v.negate(v.convertComparison("\x3d\x3d",x[1],x[2]));case "\x3e":case "\x3c":case "\x3e\x3d":case "\x3c\x3d":return v.convertComparison(e,x[1],x[2]);case "in":return v.convertIn(x[1],x.slice(2));case "!in":return v.negate(v.convertIn(x[1],
x.slice(2)));case "any":case "all":case "none":return v.convertCombining(e,x.slice(1));case "has":return v.convertHas(x[1]);case "!has":return v.negate(v.convertHas(x[1]));default:throw Error("Unexpected legacy filter.");}};v.convertComparison=function(x,e,q){switch(e){case "$type":return[x,["geometry-type"],q];case "$id":return[x,["id"],q];default:return[x,["get",e],q]}};v.convertIn=function(x,e){switch(x){case "$type":return["in",["geometry-type"],["literal",e]];case "$id":return["in",["id"],["literal",
e]];default:return["in",["get",x],["literal",e]]}};v.convertHas=function(x){switch(x){case "$type":return!0;case "$id":return["has-id"];default:return["has",x]}};v.convertCombining=function(x,e){return[x].concat(e.map(this.convertLegacyFilter))};v.negate=function(x){return["!",x]};return v}()})},"esri/views/2d/engine/vectorTiles/expression/expression":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../Color ../../../../../core/colorUtils ../../../unitBezier ../GeometryUtils ./types ../../webgl/Geometry".split(" "),
function(A,D,v,x,e,q,b,c){function a(r,f,n){var z=typeof r;if("string"===z||"boolean"===z||"number"===z||null===r){if(n)switch(n.kind){case "string":"string"!==z&&(r=ea.toString(r));break;case "number":"number"!==z&&(r=ea.toNumber(r));break;case "color":r=ea.toColor(r)}r=["literal",r]}if(!Array.isArray(r)||0===r.length)throw Error("Expression must be a non empty array");z=r[0];if("string"!==typeof z)throw Error("First element of expression must be a string");const E=ja[z];if(void 0===E)throw Error(`Invalid expression operator "${z}"`);
if(!E)throw Error(`Unimplemented expression operator "${z}"`);return E.parse(r,f,n)}let d=function(){function r(n){this.parent=n;this.vars={}}var f=r.prototype;f.add=function(n,z){this.vars[n]=z};f.get=function(n){return this.vars[n]?this.vars[n]:this.parent?this.parent.get(n):null};return r}(),g=function(){function r(){this.type=b.ValueType}r.parse=function(f){if(1<f.length)throw Error('"id" does not expect arguments');return new r};r.prototype.evaluate=function(f,n){return null==f?void 0:f.id};
return r}(),l=function(){function r(){this.type=b.StringType}r.parse=function(f){if(1<f.length)throw Error('"geometry-type" does not expect arguments');return new r};r.prototype.evaluate=function(f,n){if(!f)return null;switch(f.type){case c.GeometryType.Point:return"Point";case c.GeometryType.LineString:return"LineString";case c.GeometryType.Polygon:return"Polygon";default:return null}};return r}(),p=function(){function r(){this.type=b.ObjectType}r.parse=function(f){if(1<f.length)throw Error('"properties" does not expect arguments');
return new r};r.prototype.evaluate=function(f,n){return null==f?void 0:f.values};return r}(),m=function(){function r(){this.type=b.NumberType}r.parse=function(f){if(1<f.length)throw Error('"zoom" does not expect arguments');return new r};r.prototype.evaluate=function(f,n){return n};return r}(),h=function(){function r(f,n,z){this.lhs=f;this.rhs=n;this.compare=z;this.type=b.BooleanType}r.parse=function(f,n,z){if(3!==f.length&&4!==f.length)throw Error(`"${f[0]}" expects 2 or 3 arguments`);if(4===f.length)throw Error(`"${f[0]}" collator not supported`);
return new r(a(f[1],n),a(f[2],n),z)};r.prototype.evaluate=function(f,n){return this.compare(this.lhs.evaluate(f,n),this.rhs.evaluate(f,n))};return r}(),u=function(r){function f(){return r.apply(this,arguments)||this}D._inheritsLoose(f,r);f.parse=function(n,z){return h.parse(n,z,(E,J)=>E===J)};return f}(h),w=function(r){function f(){return r.apply(this,arguments)||this}D._inheritsLoose(f,r);f.parse=function(n,z){return h.parse(n,z,(E,J)=>E!==J)};return f}(h),k=function(r){function f(){return r.apply(this,
arguments)||this}D._inheritsLoose(f,r);f.parse=function(n,z){return h.parse(n,z,(E,J)=>E<J)};return f}(h),t=function(r){function f(){return r.apply(this,arguments)||this}D._inheritsLoose(f,r);f.parse=function(n,z){return h.parse(n,z,(E,J)=>E<=J)};return f}(h),C=function(r){function f(){return r.apply(this,arguments)||this}D._inheritsLoose(f,r);f.parse=function(n,z){return h.parse(n,z,(E,J)=>E>J)};return f}(h),I=function(r){function f(){return r.apply(this,arguments)||this}D._inheritsLoose(f,r);f.parse=
function(n,z){return h.parse(n,z,(E,J)=>E>=J)};return f}(h),H=function(){function r(f){this.arg=f;this.type=b.BooleanType}r.parse=function(f,n){if(2!==f.length)throw Error('"!" expects 1 argument');return new r(a(f[1],n))};r.prototype.evaluate=function(f,n){return!this.arg.evaluate(f,n)};return r}(),B=function(){function r(f){this.args=f;this.type=b.BooleanType}r.parse=function(f,n){const z=[];for(let E=1;E<f.length;E++)z.push(a(f[E],n));return new r(z)};r.prototype.evaluate=function(f,n){for(const z of this.args)if(!z.evaluate(f,
n))return!1;return!0};return r}(),y=function(){function r(f){this.args=f;this.type=b.BooleanType}r.parse=function(f,n){const z=[];for(let E=1;E<f.length;E++)z.push(a(f[E],n));return new r(z)};r.prototype.evaluate=function(f,n){for(const z of this.args)if(z.evaluate(f,n))return!0;return!1};return r}(),F=function(){function r(f){this.args=f;this.type=b.BooleanType}r.parse=function(f,n){const z=[];for(let E=1;E<f.length;E++)z.push(a(f[E],n));return new r(z)};r.prototype.evaluate=function(f,n){for(const z of this.args)if(z.evaluate(f,
n))return!1;return!0};return r}(),N=function(){function r(f,n,z){this.type=f;this.args=n;this.fallback=z}r.parse=function(f,n,z){if(4>f.length)throw Error('"case" expects at least 3 arguments');if(1===f.length%2)throw Error('"case" expects an odd number of arguments');let E;const J=[];for(let P=1;P<f.length-1;P+=2){const W=a(f[P],n),V=a(f[P+1],n,z);E||(E=V.type);J.push({condition:W,output:V})}f=a(f[f.length-1],n,z);E||(E=f.type);return new r(E,J,f)};r.prototype.evaluate=function(f,n){for(const z of this.args)if(z.condition.evaluate(f,
n))return z.output.evaluate(f,n);return this.fallback.evaluate(f,n)};return r}(),Q=function(){function r(f,n){this.type=f;this.args=n}r.parse=function(f,n){if(2>f.length)throw Error('"coalesce" expects at least 1 argument');let z;const E=[];for(let J=1;J<f.length;J++){const P=a(f[J],n);z||(z=P.type);E.push(P)}return new r(z,E)};r.prototype.evaluate=function(f,n){for(const z of this.args){const E=z.evaluate(f,n);if(null!==E)return E}return null};return r}(),L=function(){function r(f,n,z,E,J){this.type=
f;this.input=n;this.labels=z;this.outputs=E;this.fallback=J}r.parse=function(f,n){if(3>f.length)throw Error('"match" expects at least 3 arguments');if(0===f.length%2)throw Error('"case" expects an even number of arguments');let z;const E=a(f[1],n),J=[],P={};let W;for(let aa=2;aa<f.length-1;aa+=2){var V=f[aa];Array.isArray(V)||(V=[V]);for(const fa of V){V=typeof fa;if("string"!==V&&"number"!==V)throw Error('"match" requires string or number literal as labels');if(!W)W=V;else if(V!==W)throw Error('"match" requires labels to have the same type');
P[fa]=J.length}V=a(f[aa+1],n);z||(z=V.type);J.push(V)}return new r(z,E,P,J,a(f[f.length-1],n))};r.prototype.evaluate=function(f,n){const z=this.input.evaluate(f,n);return(this.outputs[this.labels[z]]||this.fallback).evaluate(f,n)};return r}(),S=function(){function r(n,z,E,J,P){this.operator=n;this.type=z;this.interpolation=E;this.input=J;this.stops=P}r.parse=function(n,z,E){const J=n[0];if(5>n.length)throw Error(`"${J}" expects at least 4 arguments`);const P=n[1];if(!Array.isArray(P)||0===P.length)throw Error(`"${P}" is not a valid interpolation`);
switch(P[0]){case "linear":if(1!==P.length)throw Error("Linear interpolation cannot have parameters");break;case "exponential":if(2!==P.length||"number"!==typeof P[1])throw Error("Exponential interpolation requires one numeric argument");break;case "cubic-bezier":if(5!==P.length)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");for(var W=1;5>W;W++){var V=P[W];if("number"!==typeof V||0>V||1<V)throw Error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1");
}break;default:throw Error(`"${n[0]}" unknown interpolation type "${P[0]}"`);}if(1!==n.length%2)throw Error(`"${J}" expects an even number of arguments`);W=a(n[2],z,b.NumberType);let aa;"interpolate-hcl"===J||"interpolate-lab"===J?aa=b.ColorType:E&&"value"!==E.kind&&(aa=E);E=[];for(V=3;V<n.length;V+=2){const fa=n[V];if("number"!==typeof fa)throw Error(`"${J}" requires stop inputs as literal numbers`);if(E.length&&E[E.length-1][0]>=fa)throw Error(`"${J}" requires strictly ascending stop inputs`);const ka=
a(n[V+1],z,aa);aa||(aa=ka.type);E.push([fa,ka])}if(aa&&aa!==b.ColorType&&aa!==b.NumberType&&("array"!==aa.kind||aa.itemType!==b.NumberType))throw Error(`"${J}" cannot interpolate type ${b.typeToString(aa)}`);return new r(J,aa,P,W,E)};var f=r.prototype;f.evaluate=function(n,z){var E=this.stops;if(1===E.length)return E[0][1].evaluate(n,z);var J=this.input.evaluate(n,z);if(J<=E[0][0])return E[0][1].evaluate(n,z);if(J>=E[E.length-1][0])return E[E.length-1][1].evaluate(n,z);let P=0;for(;++P<E.length&&
!(J<E[P][0]););const W=r.interpolationRatio(this.interpolation,J,E[P-1][0],E[P][0]);J=E[P-1][1].evaluate(n,z);const V=E[P][1].evaluate(n,z);if("interpolate"===this.operator){if("array"===this.type.kind&&Array.isArray(J)&&Array.isArray(V))return J.map((aa,fa)=>q.interpolate(aa,V[fa],W));if("color"===this.type.kind&&J instanceof v&&V instanceof v)return J=new v(J),n=new v(V),new v([q.interpolate(J.r,n.r,W),q.interpolate(J.g,n.g,W),q.interpolate(J.b,n.b,W),q.interpolate(J.a,n.a,W)]);if("number"===this.type.kind&&
"number"===typeof J&&"number"===typeof V)return q.interpolate(J,V,W);throw Error(`"${this.operator}" cannot interpolate type ${b.typeToString(this.type)}`);}if("interpolate-hcl"===this.operator)return n=x.toLCH(J),z=x.toLCH(V),E=z.h-n.h,n=x.toRGB({h:n.h+W*(180<E||-180>E?E-360*Math.round(E/360):E),c:q.interpolate(n.c,z.c,W),l:q.interpolate(n.l,z.l,W)}),new v({a:q.interpolate(J.a,V.a,W),...n});if("interpolate-lab"===this.operator)return n=x.toLAB(J),z=x.toLAB(V),n=x.toRGB({l:q.interpolate(n.l,z.l,W),
a:q.interpolate(n.a,z.a,W),b:q.interpolate(n.b,z.b,W)}),new v({a:q.interpolate(J.a,V.a,W),...n});throw Error(`Unexpected operator "${this.operator}"`);};f.interpolationUniformValue=function(n,z){const E=this.stops;if(1===E.length||n>=E[E.length-1][0])return 0;let J=0;for(;++J<E.length&&!(n<E[J][0]););return r.interpolationRatio(this.interpolation,z,E[J-1][0],E[J][0])};f.getInterpolationRange=function(n){const z=this.stops;if(1===z.length)return n=z[0][0],[n,n];var E=z[z.length-1][0];if(n>=E)return[E,
E];for(E=0;++E<z.length&&!(n<z[E][0]););return[z[E-1][0],z[E][0]]};r.interpolationRatio=function(n,z,E,J){let P=0;"linear"===n[0]?P=r._exponentialInterpolationRatio(z,1,E,J):"exponential"===n[0]?P=r._exponentialInterpolationRatio(z,n[1],E,J):"cubic-bezier"===n[0]&&(P=e.unitBezier(n[1],n[2],n[3],n[4])(r._exponentialInterpolationRatio(z,1,E,J),1E-5));0>P?P=0:1<P&&(P=1);return P};r._exponentialInterpolationRatio=function(n,z,E,J){J-=E;if(0===J)return 0;n-=E;return 1===z?n/J:(z**n-1)/(z**J-1)};return r}(),
R=function(){function r(f,n,z){this.type=f;this.input=n;this.stops=z}r.parse=function(f,n){if(5>f.length)throw Error('"step" expects at least 4 arguments');if(1!==f.length%2)throw Error('"step" expects an even number of arguments');const z=a(f[1],n,b.NumberType);let E;const J=[];J.push([-Infinity,a(f[2],n)]);for(let P=3;P<f.length;P+=2){const W=f[P];if("number"!==typeof W)throw Error('"step" requires stop inputs as literal numbers');if(J.length&&J[J.length-1][0]>=W)throw Error('"step" requires strictly ascending stop inputs');
const V=a(f[P+1],n);E||(E=V.type);J.push([W,V])}return new r(E,z,J)};r.prototype.evaluate=function(f,n){const z=this.stops;if(1===z.length)return z[0][1].evaluate(f,n);const E=this.input.evaluate(f,n);let J=0;for(;++J<z.length&&!(E<z[J][0]););return this.stops[J-1][1].evaluate(f,n)};return r}(),T=function(){function r(f,n){this.type=f;this.output=n}r.parse=function(f,n,z){if(4>f.length)throw Error('"let" expects at least 3 arguments');if(1===f.length%2)throw Error('"let" expects an odd number of arguments');
const E=new d(n);for(let J=1;J<f.length-1;J+=2){const P=f[J];if("string"!==typeof P)throw Error(`"let" requires a string to define variable names - found ${P}`);E.add(P,a(f[J+1],n))}f=a(f[f.length-1],E,z);return new r(f.type,f)};r.prototype.evaluate=function(f,n){return this.output.evaluate(f,n)};return r}(),O=function(){function r(f,n){this.type=f;this.output=n}r.parse=function(f,n,z){if(2!==f.length||"string"!==typeof f[1])throw Error('"var" requires just one literal string argument');n=n.get(f[1]);
if(!n)throw Error(`${f[1]} must be defined before being used in a "var" expression`);return new r(z||b.ValueType,n)};r.prototype.evaluate=function(f,n){return this.output.evaluate(f,n)};return r}(),K=function(){function r(f,n,z){this.type=f;this.index=n;this.array=z}r.parse=function(f,n){if(3!==f.length)throw Error('"at" expects 2 arguments');const z=a(f[1],n,b.NumberType);f=a(f[2],n);return new r(f.type.itemType,z,f)};r.prototype.evaluate=function(f,n){const z=this.index.evaluate(f,n);f=this.array.evaluate(f,
n);if(0>z||z>=f.length)throw Error('"at" index out of bounds');if(z!==Math.floor(z))throw Error('"at" index must be an integer');return f[z]};return r}(),G=function(){function r(f,n){this.key=f;this.obj=n;this.type=b.ValueType}r.parse=function(f,n){let z;switch(f.length){case 2:return z=a(f[1],n),new r(z);case 3:return z=a(f[1],n),f=a(f[2],n),new r(z,f);default:throw Error('"get" expects 1 or 2 arguments');}};r.prototype.evaluate=function(f,n){const z=this.key.evaluate(f,n);return this.obj?this.obj.evaluate(f,
n)[z]:null==f?void 0:f.values[z]};return r}(),M=function(){function r(f,n){this.key=f;this.obj=n;this.type=b.BooleanType}r.parse=function(f,n){let z;switch(f.length){case 2:return z=a(f[1],n),new r(z);case 3:return z=a(f[1],n),f=a(f[2],n),new r(z,f);default:throw Error('"has" expects 1 or 2 arguments');}};r.prototype.evaluate=function(f,n){const z=this.key.evaluate(f,n);return this.obj?(f=this.obj.evaluate(f,n),z in f):!(null==f||!f.values[z])};return r}(),U=function(){function r(f,n){this.key=f;
this.vals=n;this.type=b.BooleanType}r.parse=function(f,n){if(3!==f.length)throw Error('"in" expects 2 arguments');return new r(a(f[1],n),a(f[2],n))};r.prototype.evaluate=function(f,n){const z=this.key.evaluate(f,n);return this.vals.evaluate(f,n).includes(z)};return r}(),Y=function(){function r(f,n,z){this.item=f;this.array=n;this.from=z;this.type=b.NumberType}r.parse=function(f,n){if(3>f.length||4<f.length)throw Error('"index-of" expects 3 or 4 arguments');const z=a(f[1],n),E=a(f[2],n);return 4===
f.length?(f=a(f[3],n,b.NumberType),new r(z,E,f)):new r(z,E)};r.prototype.evaluate=function(f,n){const z=this.item.evaluate(f,n),E=this.array.evaluate(f,n);if(this.from){f=this.from.evaluate(f,n);if(f!==Math.floor(f))throw Error('"index-of" index must be an integer');return E.indexOf(z,f)}return E.indexOf(z)};return r}(),ca=function(){function r(f){this.arg=f;this.type=b.NumberType}r.parse=function(f,n){if(2!==f.length)throw Error('"length" expects 2 arguments');f=a(f[1],n);return new r(f)};r.prototype.evaluate=
function(f,n){f=this.arg.evaluate(f,n);if("string"===typeof f||Array.isArray(f))return f.length;throw Error('"length" expects string or array');};return r}(),da=function(){function r(f,n,z,E){this.type=f;this.array=n;this.from=z;this.to=E}r.parse=function(f,n){if(3>f.length||4<f.length)throw Error('"slice" expects 2 or 3 arguments');const z=a(f[1],n),E=a(f[2],n,b.NumberType);if(E.type!==b.NumberType)throw Error('"slice" index must return a number');if(4===f.length){f=a(f[3],n,b.NumberType);if(f.type!==
b.NumberType)throw Error('"slice" index must return a number');return new r(z.type,z,E,f)}return new r(z.type,z,E)};r.prototype.evaluate=function(f,n){const z=this.array.evaluate(f,n);if(!Array.isArray(z)&&"string"!==typeof z)throw Error('"slice" input must be an array or a string');const E=this.from.evaluate(f,n);if(0>E||E>=z.length)throw Error('"slice" index out of bounds');if(E!==Math.floor(E))throw Error('"slice" index must be an integer');if(this.to){f=this.to.evaluate(f,n);if(0>f||f>=z.length)throw Error('"slice" index out of bounds');
if(f!==Math.floor(f))throw Error('"slice" index must be an integer');return z.slice(E,f)}return z.slice(E)};return r}(),ba=function(){function r(){this.type=b.BooleanType}r.parse=function(f){if(1!==f.length)throw Error('"has-id" expects no arguments');return new r};r.prototype.evaluate=function(f,n){return f&&void 0!==f.id};return r}(),X=function(){function r(f,n){this.args=f;this.calculate=n;this.type=b.NumberType}r.parse=function(f,n,z){f=f.slice(1).map(E=>a(E,n));return new r(f,z)};r.prototype.evaluate=
function(f,n){let z;this.args&&(z=this.args.map(E=>E.evaluate(f,n)));return this.calculate(z)};return r}(),la=function(r){function f(){return r.apply(this,arguments)||this}D._inheritsLoose(f,r);f.parse=function(n,z){switch(n.length){case 2:return X.parse(n,z,E=>-E[0]);case 3:return X.parse(n,z,E=>E[0]-E[1]);default:throw Error('"-" expects 1 or 2 arguments');}};return f}(X),ma=function(r){function f(){return r.apply(this,arguments)||this}D._inheritsLoose(f,r);f.parse=function(n,z){return X.parse(n,
z,E=>{let J=1;for(const P of E)J*=P;return J})};return f}(X),na=function(r){function f(){return r.apply(this,arguments)||this}D._inheritsLoose(f,r);f.parse=function(n,z){if(3===n.length)return X.parse(n,z,E=>E[0]/E[1]);throw Error('"/" expects 2 arguments');};return f}(X),oa=function(r){function f(){return r.apply(this,arguments)||this}D._inheritsLoose(f,r);f.parse=function(n,z){if(3===n.length)return X.parse(n,z,E=>E[0]%E[1]);throw Error('"%" expects 2 arguments');};return f}(X),pa=function(r){function f(){return r.apply(this,
arguments)||this}D._inheritsLoose(f,r);f.parse=function(n,z){if(3===n.length)return X.parse(n,z,E=>E[0]**E[1]);throw Error('"^" expects 1 or 2 arguments');};return f}(X),qa=function(r){function f(){return r.apply(this,arguments)||this}D._inheritsLoose(f,r);f.parse=function(n,z){return X.parse(n,z,E=>{let J=0;for(const P of E)J+=P;return J})};return f}(X),Z=function(){function r(f,n){this.args=f;this.calculate=n;this.type=b.NumberType}r.parse=function(f,n){const z=f.slice(1).map(E=>a(E,n));return new r(z,
r.ops[f[0]])};r.prototype.evaluate=function(f,n){let z;this.args&&(z=this.args.map(E=>E.evaluate(f,n)));return this.calculate(z)};return r}();Z.ops={abs:r=>Math.abs(r[0]),acos:r=>Math.acos(r[0]),asin:r=>Math.asin(r[0]),atan:r=>Math.atan(r[0]),ceil:r=>Math.ceil(r[0]),cos:r=>Math.cos(r[0]),e:()=>Math.E,floor:r=>Math.floor(r[0]),ln:r=>Math.log(r[0]),ln2:()=>Math.LN2,log10:r=>Math.log(r[0])/Math.LN10,log2:r=>Math.log(r[0])/Math.LN2,max:r=>Math.max(...r),min:r=>Math.min(...r),pi:()=>Math.PI,round:r=>Math.round(r[0]),
sin:r=>Math.sin(r[0]),sqrt:r=>Math.sqrt(r[0]),tan:r=>Math.tan(r[0])};let ra=function(){function r(f){this.args=f;this.type=b.StringType}r.parse=function(f,n){return new r(f.slice(1).map(z=>a(z,n)))};r.prototype.evaluate=function(f,n){return this.args.map(z=>z.evaluate(f,n)).join("")};return r}(),ia=function(){function r(f,n){this.arg=f;this.calculate=n;this.type=b.StringType}r.parse=function(f,n){if(2!==f.length)throw Error(`${f[0]} expects 1 argument`);n=a(f[1],n);return new r(n,r.ops[f[0]])};r.prototype.evaluate=
function(f,n){return this.calculate(this.arg.evaluate(f,n))};return r}();ia.ops={downcase:r=>r.toLowerCase(),upcase:r=>r.toUpperCase()};let sa=function(){function r(n){this.args=n;this.type=b.ColorType}r.parse=function(n,z){if(4!==n.length)throw Error('"rgb" expects 3 arguments');n=n.slice(1).map(E=>a(E,z));return new r(n)};var f=r.prototype;f.evaluate=function(n,z){const E=this._validate(this.args[0].evaluate(n,z)),J=this._validate(this.args[1].evaluate(n,z));n=this._validate(this.args[2].evaluate(n,
z));return new v({r:E,g:J,b:n})};f._validate=function(n){if("number"!==typeof n||0>n||255<n)throw Error(`${n}: invalid color component`);return Math.round(n)};return r}(),ta=function(){function r(n){this.args=n;this.type=b.ColorType}r.parse=function(n,z){if(5!==n.length)throw Error('"rgba" expects 4 arguments');n=n.slice(1).map(E=>a(E,z));return new r(n)};var f=r.prototype;f.evaluate=function(n,z){const E=this._validate(this.args[0].evaluate(n,z)),J=this._validate(this.args[1].evaluate(n,z)),P=this._validate(this.args[2].evaluate(n,
z));n=this._validateAlpha(this.args[3].evaluate(n,z));return new v({r:E,g:J,b:P,a:n})};f._validate=function(n){if("number"!==typeof n||0>n||255<n)throw Error(`${n}: invalid color component`);return Math.round(n)};f._validateAlpha=function(n){if("number"!==typeof n||0>n||1<n)throw Error(`${n}: invalid alpha color component`);return n};return r}(),ua=function(){function r(f){this.color=f;this.type=b.arrayType(b.NumberType,4)}r.parse=function(f,n){if(2!==f.length)throw Error('"to-rgba" expects 1 argument');
f=a(f[1],n);return new r(f)};r.prototype.evaluate=function(f,n){return(new v(this.color.evaluate(f,n))).toRgba()};return r}(),ha=function(){function r(f,n){this.type=f;this.args=n}r.parse=function(f,n){var z=f[0];if(2>f.length)throw Error(`${z} expects at least one argument`);let E=1,J;if("array"===z){if(2<f.length){switch(f[1]){case "string":J=b.StringType;break;case "number":J=b.NumberType;break;case "boolean":J=b.BooleanType;break;default:throw Error('"array" type argument must be string, number or boolean');
}E++}else J=b.ValueType;if(3<f.length){var P=f[2];if(null!==P&&("number"!==typeof P||0>P||P!==Math.floor(P)))throw Error('"array" length argument must be a positive integer literal');E++}J=b.arrayType(J,P)}else switch(z){case "string":J=b.StringType;break;case "number":J=b.NumberType;break;case "boolean":J=b.BooleanType;break;case "object":J=b.ObjectType}for(z=[];E<f.length;E++)P=a(f[E],n),z.push(P);return new r(J,z)};r.prototype.evaluate=function(f,n){let z;for(const E of this.args){const J=E.evaluate(f,
n);z=b.getType(J);if(b.matchType(z,this.type))return J}throw Error(`Expected ${b.typeToString(this.type)} but got ${b.typeToString(z)}`);};return r}(),ea=function(){function r(f,n){this.type=f;this.args=n}r.parse=function(f,n){var z=f[0];const E=r.types[z];if(E===b.BooleanType||E===b.StringType){if(2!==f.length)throw Error(`${z} expects one argument`);}else if(2>f.length)throw Error(`${z} expects at least one argument`);z=[];for(let J=1;J<f.length;J++){const P=a(f[J],n);z.push(P)}return new r(E,z)};
r.prototype.evaluate=function(f,n){if(this.type===b.BooleanType)return!!this.args[0].evaluate(f,n);if(this.type===b.StringType)return b.valueToString(this.args[0].evaluate(f,n));if(this.type===b.NumberType){for(const E of this.args){var z=Number(E.evaluate(f,n));if(!isNaN(z))return z}return null}if(this.type===b.ColorType){for(z of this.args)try{const E=r.toColor(z.evaluate(f,n));if(E instanceof v)return E}catch{}return null}};r.toBoolean=function(f){return!!f};r.toString=function(f){return b.valueToString(f)};
r.toNumber=function(f){const n=Number(f);if(isNaN(n))throw Error(`"${f}" is not a number`);return n};r.toColor=function(f){if(f instanceof v)return f;if("string"===typeof f){const n=v.fromString(f);if(n)return n;throw Error(`"${f}" is not a color`);}if(Array.isArray(f))return v.fromArray(f);throw Error(`"${f}" is not a color`);};return r}();ea.types={"to-boolean":b.BooleanType,"to-color":b.ColorType,"to-number":b.NumberType,"to-string":b.StringType};let va=function(){function r(f){this.val=f;this.type=
b.getType(f)}r.parse=function(f){if(2!==f.length)throw Error('"literal" expects 1 argument');return new r(f[1])};r.prototype.evaluate=function(f,n){return this.val};return r}(),wa=function(){function r(f){this.arg=f;this.type=b.StringType}r.parse=function(f,n){if(2!==f.length)throw Error('"typeof" expects 1 argument');return new r(a(f[1],n))};r.prototype.evaluate=function(f,n){return b.typeToString(b.getType(this.arg.evaluate(f,n)))};return r}();const ja={array:ha,boolean:ha,collator:null,format:null,
image:null,literal:va,number:ha,"number-format":null,object:ha,string:ha,"to-boolean":ea,"to-color":ea,"to-number":ea,"to-string":ea,typeof:wa,accumulated:null,"feature-state":null,"geometry-type":l,id:g,"line-progress":null,properties:p,at:K,get:G,has:M,in:U,"index-of":Y,length:ca,slice:da,"!":H,"!\x3d":w,"\x3c":k,"\x3c\x3d":t,"\x3d\x3d":u,"\x3e":C,"\x3e\x3d":I,all:B,any:y,case:N,coalesce:Q,match:L,within:null,interpolate:S,"interpolate-hcl":S,"interpolate-lab":S,step:R,let:T,var:O,concat:ra,downcase:ia,
"is-supported-script":null,"resolved-locale":null,upcase:ia,rgb:sa,rgba:ta,"to-rgba":ua,"-":la,"*":ma,"/":na,"%":oa,"^":pa,"+":qa,abs:Z,acos:Z,asin:Z,atan:Z,ceil:Z,cos:Z,e:Z,floor:Z,ln:Z,ln2:Z,log10:Z,log2:Z,max:Z,min:Z,pi:Z,round:Z,sin:Z,sqrt:Z,tan:Z,zoom:m,"heatmap-density":null,"has-id":ba,none:F};A.ALL=B;A.ANY=y;A.Add=qa;A.Assert=ha;A.At=K;A.Calculate=Z;A.Case=N;A.Coalesce=Q;A.Coerce=ea;A.Concat=ra;A.Div=na;A.EQ=u;A.GE=I;A.GT=C;A.GeomType=l;A.Get=G;A.Has=M;A.HasID=ba;A.ID=g;A.In=U;A.IndexOf=Y;
A.Interpolate=S;A.LE=t;A.LT=k;A.Length=ca;A.Let=T;A.Literal=va;A.Match=L;A.Mod=oa;A.Mul=ma;A.NE=w;A.NONE=F;A.NOT=H;A.Pow=pa;A.Properties=p;A.Rgb=sa;A.Rgba=ta;A.Slice=da;A.Step=R;A.String=ia;A.Sub=la;A.ToRgba=ua;A.TypeOf=wa;A.Var=O;A.Zoom=m;A.createExpression=a;A.ops=ja;Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/expression/types":function(){define(["exports","../../../../../Color"],function(A,D){function v(h,u){return{kind:"array",
itemType:h,n:u}}function x(h){if("array"===h.kind){const u=x(h.itemType);return"number"===typeof h.n?`array<${u}, ${h.n}>`:"value"===h.itemType.kind?"array":`array<${u}>`}return h.kind}function e(h){if(null===h)return b;if("string"===typeof h)return a;if("boolean"===typeof h)return d;if("number"===typeof h)return c;if(h instanceof D)return g;if(Array.isArray(h)){let u;for(const w of h){const k=e(w);if(!u)u=k;else if(u!==k){u=p;break}}return v(u||p,h.length)}return"object"===typeof h?l:p}function q(h,
u){if("array"===u.kind)return"array"===h.kind&&(0===h.n&&"value"===h.itemType.kind||q(h.itemType,u.itemType))&&("number"!==typeof u.n||u.n===h.n);if("value"===u.kind)for(const w of m)if(q(h,w))return!0;return u.kind===h.kind}const b={kind:"null"},c={kind:"number"},a={kind:"string"},d={kind:"boolean"},g={kind:"color"},l={kind:"object"},p={kind:"value"},m=[b,c,a,d,g,l,v(p)];A.BooleanType=d;A.ColorType=g;A.NullType=b;A.NumberType=c;A.ObjectType=l;A.StringType=a;A.ValueType=p;A.arrayType=v;A.getType=
e;A.matchType=q;A.typeToString=x;A.valueToString=function(h){if(null===h)return"";const u=typeof h;return"string"===u?h:"number"===u||"boolean"===u?String(h):h instanceof D?h.toString():JSON.stringify(h)};Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/style/StyleProperty":function(){define(["../../../../../Color","../GeometryUtils","../expression/expression","../expression/types"],function(A,D,v,x){return function(){function e(b,
c){this.isDataDriven=!1;this.interpolator=null;switch(b.type){case "number":var a=!0;break;case "color":a=!0;break;case "array":a="number"===b.value;break;default:a=!1}null==c&&(c=b.default);if(Array.isArray(c)&&0<c.length&&v.ops[c[0]]){a={number:x.NumberType,color:x.ColorType,string:x.StringType,boolean:x.BooleanType,enum:x.StringType};try{var d="array"===b.type?x.arrayType(a[b.value]||x.ValueType,b.length):a[b.type];const g=v.createExpression(c,null,d);this.getValue=this._buildExpression(g,b);this.isDataDriven=
!0;g instanceof v.Interpolate&&g.input instanceof v.Zoom&&(this.interpolator=g)}catch(g){console.log(g.message),this.getValue=this._buildSimple(b.default)}}else{a&&"interval"===c.type&&(a=!1);if(d=c&&c.stops&&0<c.stops.length)for(const g of c.stops)g[1]=this._validate(g[1],b);if(this.isDataDriven=c?!!c.property:!1)if(void 0!==c.default&&(c.default=this._validate(c.default,b)),d)switch(c.type){case "identity":this.getValue=this._buildIdentity(c,b);break;case "categorical":this.getValue=this._buildCategorical(c,
b);break;default:this.getValue=a?this._buildInterpolate(c,b):this._buildInterval(c,b)}else this.getValue=this._buildIdentity(c,b);else d?this.getValue=a?this._buildZoomInterpolate(c):this._buildZoomInterval(c):(c=this._validate(c,b),this.getValue=this._buildSimple(c))}}var q=e.prototype;q._validate=function(b,c){if("number"===c.type){if(b<c.minimum)return c.minimum;if(b>c.maximum)return c.maximum}else"color"===c.type?b=e._parseColor(b):"enum"===c.type?"string"===typeof b&&(b=c.values.indexOf(b)):
"array"===c.type&&"enum"===c.value?b=b.map(a=>"string"===typeof a?c.values.indexOf(a):a):"string"===c.type&&(b=x.valueToString(b));return b};q._buildSimple=function(b){return()=>b};q._buildExpression=function(b,c){return(a,d)=>{try{const g=b.evaluate(d,a);return void 0===g?c.default:this._validate(g,c)}catch(g){return console.log(g.message),c.default}}};q._buildIdentity=function(b,c){return(a,d)=>{let g;d&&(g=d.values[b.property]);void 0!==g&&(g=this._validate(g,c));return null!=g?g:void 0!==b.default?
b.default:c.default}};q._buildCategorical=function(b,c){return(a,d)=>{let g;d&&(g=d.values[b.property]);g=this._categorical(g,b.stops);return void 0!==g?g:void 0!==b.default?b.default:c.default}};q._buildInterval=function(b,c){return(a,d)=>{let g;d&&(g=d.values[b.property]);return"number"===typeof g?this._interval(g,b.stops):void 0!==b.default?b.default:c.default}};q._buildInterpolate=function(b,c){return(a,d)=>{let g;d&&(g=d.values[b.property]);return"number"===typeof g?this._interpolate(g,b.stops,
b.base||1):void 0!==b.default?b.default:c.default}};q._buildZoomInterpolate=function(b){return c=>this._interpolate(c,b.stops,b.base||1)};q._buildZoomInterval=function(b){return c=>this._interval(c,b.stops)};q._categorical=function(b,c){const a=c.length;for(let d=0;d<a;d++)if(c[d][0]===b)return c[d][1]};q._interval=function(b,c){const a=c.length;let d=0;for(let g=0;g<a;g++)if(c[g][0]<=b)d=g;else break;return c[d][1]};q._interpolate=function(b,c,a){const d=c.length;for(let p=0;p<d;p++){const m=c[p];
if(m[0]<=b)var g=m;else{var l=m;break}}if(g&&l){c=l[0]-g[0];b-=g[0];a=1===a?b/c:(a**b-1)/(a**c-1);if(Array.isArray(g[1])){g=g[1];l=l[1];b=[];for(c=0;c<g.length;c++)b.push(D.interpolate(g[c],l[c],a));return b}return D.interpolate(g[1],l[1],a)}if(g)return g[1];if(l)return l[1]};e._isEmpty=function(b){for(const c in b)if(b.hasOwnProperty(c))return!1;return!0};e._parseColor=function(b){if(Array.isArray(b))return b;"string"===typeof b&&(b=new A(b));if(b instanceof A&&!this._isEmpty(b))return A.toUnitRGBA(b)};
return e}()})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../engine/Container ../../layers/support/ClipArea ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(A,D,v,x,e,q,b,c,a,d,g,l,p,m,h,u,w){const k=x.ofType({key:"type",base:m,typeMap:{rect:h,path:w,geometry:u}});A.LayerView2DMixin=t=>{t=function(C){function I(){var B=C.apply(this,arguments)||this;B.attached=!1;B.clips=new k;B.lastUpdateId=-1;B.moving=!1;B.updateRequested=!1;return B}D._inheritsLoose(I,C);var H=I.prototype;H.initialize=function(){var B,y,F,N;const Q=null!=(B=null==(y=this.view)?void 0:y.spatialReferenceLocked)?B:!0;(null==(F=this.view)?0:F.spatialReference)&&Q&&!this.spatialReferenceSupported?
this.addResolvingPromise(Promise.reject(new q("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new p.Container),this.container.fadeTransitionEnabled=!0,this.container.opacity=0,this.container.clips=this.clips,this.handles.add([b.watch(()=>this.suspended,L=>{this.container&&(this.container.visible=!L);this.view&&!L&&this.updateRequested&&this.view.requestUpdate()},b.syncAndInitial),
b.watch(()=>{var L,S;return null!=(L=null==(S=this.layer)?void 0:S.opacity)?L:1},L=>{this.container&&(this.container.opacity=L)},b.syncAndInitial),b.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",L=>{this.container&&(this.container.blendMode=L)},b.syncAndInitial),b.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,L=>{this.container&&(this.container.effect=L)},b.syncAndInitial),b.on(()=>this.clips,"change",()=>{this.container&&(this.container.clips=this.clips)})]),
null!=(N=this.view)&&N.whenLayerView?this.view.whenLayerView(this.layer).then(L=>{L===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},()=>{}))};H.destroy=function(){this.processDetach();this.updateRequested=!1};H.processAttach=function(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())};H.processDetach=function(){this.attached&&(this.attached=!1,this.detach(),this.updateRequested=
!1)};H.isVisibleAtScale=function(B){const y=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!y)return!0;const {minScale:F,maxScale:N}=y;return(0===F||B<=F)&&(0===N||B>=N)};H.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};H.processUpdate=function(B){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",B),this.updateRequested&&!this.suspended&&
(this.updateRequested=!1,this.update(B)))};H.hitTest=function(B,y){return Promise.resolve(null)};H.supportsSpatialReference=function(B){return!0};H.canResume=function(){return this.spatialReferenceSupported?C.prototype.canResume.call(this)?this.visibleAtCurrentScale:!1:!1};H.getSuspendInfo=function(){const B=C.prototype.getSuspendInfo.call(this),y=!this.spatialReferenceSupported,F=this.visibleAtCurrentScale;y&&(B.spatialReferenceNotSupported=y);F&&(B.outsideScaleRange=F);return B};D._createClass(I,
[{key:"spatialReferenceSupported",get:function(){var B;const y=null==(B=this.view)?void 0:B.spatialReference;return null==y||this.supportsSpatialReference(y)}},{key:"updating",get:function(){var B;return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!(null==(B=this.updatingHandles)||!B.updating))}},{key:"visibleAtCurrentScale",get:function(){return this.isVisibleAtScale(this.view.scale)}}]);return I}(t);v.__decorate([c.property()],t.prototype,
"attached",void 0);v.__decorate([c.property({type:k,set(C){C=e.referenceSetter(C,this._get("clips"),k);this._set("clips",C)}})],t.prototype,"clips",void 0);v.__decorate([c.property()],t.prototype,"container",void 0);v.__decorate([c.property()],t.prototype,"moving",void 0);v.__decorate([c.property({readOnly:!0})],t.prototype,"spatialReferenceSupported",null);v.__decorate([c.property({readOnly:!0})],t.prototype,"updateParameters",void 0);v.__decorate([c.property()],t.prototype,"updateRequested",void 0);
v.__decorate([c.property()],t.prototype,"updating",null);v.__decorate([c.property()],t.prototype,"view",void 0);v.__decorate([c.property({readOnly:!0})],t.prototype,"visibleAtCurrentScale",null);return t=v.__decorate([l.subclass("esri.views.2d.layers.LayerView2D")],t)};Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/set ../../../core/accessorSupport/decorators/subclass".split(" "),
function(A,D,v,x,e,q,b,c,a){v=function(d){function g(){return d.apply(this,arguments)||this}A._inheritsLoose(g,d);return g}(v.JSONSupport);return v=D.__decorate([a.subclass("esri.views.layers.support.ClipArea")],v)})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),
function(A,D,v,x,e,q,b,c){var a;x=a=function(d){function g(){var l=d.apply(this,arguments)||this;l.type="rect";l.left=null;l.right=null;l.top=null;l.bottom=null;return l}A._inheritsLoose(g,d);g.prototype.clone=function(){return new a({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};A._createClass(g,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return g}(c);D.__decorate([v.property({type:[Number,String],json:{write:!0}})],x.prototype,"left",void 0);D.__decorate([v.property({type:[Number,
String],json:{write:!0}})],x.prototype,"right",void 0);D.__decorate([v.property({type:[Number,String],json:{write:!0}})],x.prototype,"top",void 0);D.__decorate([v.property({type:[Number,String],json:{write:!0}})],x.prototype,"bottom",void 0);D.__decorate([v.property({readOnly:!0})],x.prototype,"version",null);return x=a=D.__decorate([b.subclass("esri.views.layers.support.ClipRect")],x)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(A,D,v,x,e,q,b,c,a,d,g,l,p){var m;v={base:a,key:"type",typeMap:{extent:l,polygon:p}};g=m=function(h){function u(){var w=h.apply(this,arguments)||this;w.type="geometry";w.geometry=null;return w}A._inheritsLoose(u,h);u.prototype.clone=function(){return new m({geometry:this.geometry.clone()})};A._createClass(u,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return u}(g);D.__decorate([x.property({types:v,json:{read:d.fromJSON,write:!0}})],g.prototype,"geometry",void 0);D.__decorate([x.property({readOnly:!0})],
g.prototype,"version",null);return g=m=D.__decorate([c.subclass("esri.views.layers.support.Geometry")],g)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(A,D,v,x,e,q,b,c){x=function(a){function d(){var g=a.apply(this,
arguments)||this;g.type="path";g.path=[];return g}A._inheritsLoose(d,a);A._createClass(d,[{key:"version",get:function(){return(this._get("version")||0)+1}}]);return d}(c);D.__decorate([v.property({type:[[[Number]]],json:{write:!0}})],x.prototype,"path",void 0);D.__decorate([v.property({readOnly:!0})],x.prototype,"version",null);return x=D.__decorate([b.subclass("esri.views.layers.support.Path")],x)})},"esri/views/2d/layers/support/Display":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../engine/Bitmap","../../engine/BitmapContainer"],function(A,D,v,x){x=function(e){function q(c){var a=e.call(this)||this;a.requestRender=a.requestRender.bind(D._assertThisInitialized(a));a._layerView=c;a._canvas=document.createElement("canvas");a._context=a._canvas.getContext("2d");a._bitmap=new v.Bitmap(null,"standard",!1);a.addChild(a._bitmap);return a}D._inheritsLoose(q,e);var b=q.prototype;b.doRender=function(c){const a=c.state,d=this._createCustomRenderParams(c),g=this._canvas,l=this._bitmap,
p=window.devicePixelRatio;g.width=a.size[0]*p;g.height=a.size[1]*p;l.resolution=a.resolution;const m=a.clone();m.pixelRatio=p;l.pixelRatio=p;d.state=m;l.x=a.viewpoint.targetGeometry.x-Math.abs(a.extent.xmax-a.extent.xmin)/2;l.y=a.viewpoint.targetGeometry.y+Math.abs(a.extent.ymax-a.extent.ymin)/2;this._layerView.render(d);l.source=g;l.rotation=a.rotation;e.prototype.doRender.call(this,{...c,state:m})};b._createCustomRenderParams=function(c){return{globalOpacity:c.globalOpacity,state:c.state,stationary:c.stationary,
pixelRatio:window.devicePixelRatio,context:this._context}};return q}(x.BitmapContainer);A.Display=x;Object.defineProperties(A,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/tiling/TileInfoViewPOT":function(){define(["../../../chunks/_rollupPluginBabelHelpers","../../../layers/support/TileInfo","./TileInfoView","./TileKey"],function(A,D,v,x){return function(e){function q(){var c=e.apply(this,arguments)||this;c._fullCacheLodInfos=null;c._levelByScale={};return c}A._inheritsLoose(q,
e);var b=q.prototype;b.getTileParentId=function(c){c=x.pool.acquire(c);const a=0===c.level?null:x.getId(c.level-1,c.row>>1,c.col>>1,c.world);x.pool.release(c);return a};b.getTileCoverage=function(c,a,d){c=e.prototype.getTileCoverage.call(this,c,a,d);if(!c)return c;const g=1<<c.lodInfo.level;c.spans=c.spans.filter(l=>0<=l.row&&l.row<g);return c};b.scaleToLevel=function(c){this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos);if(this._levelByScale[c])return this._levelByScale[c];{var a=
this._fullCacheLodInfos;if(c>a[0].scale)return a[0].level;let d;for(let g=0;g<a.length-1;g++)if(d=a[g+1],c>d.scale)return a=a[g],a.level+(a.scale-c)/(a.scale-d.scale);return a[a.length-1].level}};b._initializeFullCacheLODs=function(c){c=0===c[0].level?c.map(a=>({level:a.level,resolution:a.resolution,scale:a.scale})):D.create({size:this.tileInfo.size[0],spatialReference:this.tileInfo.spatialReference}).lods.map(a=>({level:a.level,resolution:a.resolution,scale:a.scale}));for(let a=0;a<c.length;a++)this._levelByScale[c[a].scale]=
c[a].level;this._fullCacheLodInfos=c};return q}(v)})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/diffUtils ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../engine/vectorTiles/enums ../engine/vectorTiles/TileHandler ../engine/vectorTiles/TileManager ../engine/vectorTiles/VectorTile ../engine/vectorTiles/VectorTileContainer ../engine/vectorTiles/decluttering/debugging ../engine/vectorTiles/style/StyleDefinition ../engine/vectorTiles/style/StyleRepository ./LayerView2D ./support/Display ../tiling/TileInfoViewPOT ../tiling/TileQueue ../../layers/LayerView".split(" "),function(A,
D,v,x,e,q,b,c,a,d,g,l,p,m,h,u,w,k,t,C,I,H,B,y,F,N,Q){function L(R){if(q.isNone(R))return 0;switch(R.type){case "partial":return Object.keys(R.diff).length;case "complete":return Math.max(Object.keys(R.oldValue).length,Object.keys(R.newValue).length);case "collection":return Object.keys(R.added).length+Object.keys(R.changed).length+Object.keys(R.removed).length}}const S=e.getLogger("esri.views.2d.layers.VectorTileLayerView2D");e=function(R){function T(){var K=R.apply(this,arguments)||this;K._styleChanges=
[];K._fetchQueue=null;K._parseQueue=null;K._isTileHandlerReady=!1;K.fading=!1;return K}A._inheritsLoose(T,R);var O=T.prototype;O.hitTest=function(){var K=A._asyncToGenerator(function*(G,M){if(!this._tileHandlerPromise)return null;yield this._tileHandlerPromise;M=yield this._vectorTileContainer.hitTest(M);if(!M||0===M.length)return null;M=M[0]-1;var U=this._styleRepository;const Y=U.getStyleLayerByUID(M);if(!Y)return null;U=U.getStyleLayerIndex(Y.id);return[{type:"graphic",mapPoint:G,layer:this.layer,
graphic:new v({attributes:{layerId:U,layerName:Y.id,layerUID:M},layer:this.layer,sourceLayer:this.layer})}]});return function(G,M){return K.apply(this,arguments)}}();O.update=function(K){this._tileHandlerPromise&&this._isTileHandlerReady&&(K.pixelRatio!==this._tileHandler.devicePixelRatio?(this._start(),this._tileHandler.devicePixelRatio=K.pixelRatio):0<this._styleChanges.length?this._tileHandlerPromise=this._applyStyleChanges():(this._fetchQueue.pause(),this._parseQueue.pause(),this._fetchQueue.state=
K.state,this._parseQueue.state=K.state,this._tileManager.update(K)||this.requestUpdate(),this._parseQueue.resume(),this._fetchQueue.resume()))};O.attach=function(){const {style:K}=this.layer.currentStyleInfo;this._styleRepository=new H(K);this._tileInfoView=new F(this.layer.tileInfo,this.layer.fullExtent);this._vectorTileContainer=new t.VectorTileContainer(this._tileInfoView);this._tileHandler=new u.TileHandler(this.layer,this._styleRepository,window.devicePixelRatio||1);this.container.addChild(this._vectorTileContainer);
this._start();this.handles.add([this._vectorTileContainer.on("fade-start",()=>{this.fading=!0;this.notifyChange("updating");this.requestUpdate()}),this._vectorTileContainer.on("fade-complete",()=>{var G;null==(G=this._collisionBoxesDisplay)?void 0:G.requestRender();this.fading=!1;this.notifyChange("updating");this.requestUpdate()}),c.watch(()=>this.layer.symbolCollisionBoxesVisible,G=>{G?(this._collisionBoxesDisplay=new y.Display({render:M=>this._renderCollisionBoxes(M.context)}),this.container.addChild(this._collisionBoxesDisplay)):
(this.container.removeChild(this._collisionBoxesDisplay),this._collisionBoxesDisplay=null)},c.initial),this.layer.on("paint-change",G=>{if(G.isDataDriven)this._styleChanges.push({type:h.StyleUpdateType.PAINTER_CHANGED,data:G}),this.notifyChange("updating"),this.requestUpdate();else{const U=this._styleRepository;var M=U.getLayerById(G.layer);M&&(M=M.type===I.StyleLayerType.SYMBOL,U.setPaintProperties(G.layer,G.paint),M&&this._vectorTileContainer.restartDeclutter(),this._vectorTileContainer.requestRender())}}),
this.layer.on("layout-change",G=>{const M=this._styleRepository,U=M.getLayerById(G.layer);if(U){var Y=l.diff(U.layout,G.layout);q.isNone(Y)||(l.hasDiff(Y,"visibility")&&1===L(Y)?(M.setLayoutProperties(G.layer,G.layout),U.type===I.StyleLayerType.SYMBOL&&this._vectorTileContainer.restartDeclutter(),this._vectorTileContainer.requestRender()):(this._styleChanges.push({type:h.StyleUpdateType.LAYOUT_CHANGED,data:G}),this.notifyChange("updating"),this.requestUpdate()))}}),this.layer.on("style-layer-visibility-change",
G=>{const M=this._styleRepository,U=M.getLayerById(G.layer);U&&(M.setStyleLayerVisibility(G.layer,G.visibility),U.type===I.StyleLayerType.SYMBOL&&this._vectorTileContainer.restartDeclutter(),this._vectorTileContainer.requestRender())}),this.layer.on("style-layer-change",G=>{this._styleChanges.push({type:h.StyleUpdateType.LAYER_CHANGED,data:G});this.notifyChange("updating");this.requestUpdate()}),this.layer.on("delete-style-layer",G=>{this._styleChanges.push({type:h.StyleUpdateType.LAYER_REMOVED,data:G});
this.notifyChange("updating");this.requestUpdate()}),this.layer.on("load-style",()=>this._loadStyle()),this.layer.on("spriteSource-change",G=>{this._newSpriteSource=G.spriteSource;this._styleChanges.push({type:h.StyleUpdateType.SPRITES_CHANGED,data:null});G=this._styleRepository.layers;for(const M of G)switch(M.type){case I.StyleLayerType.SYMBOL:M.getLayoutProperty("icon-image")&&this._styleChanges.push({type:h.StyleUpdateType.LAYOUT_CHANGED,data:{layer:M.id,layout:M.layout}});break;case I.StyleLayerType.LINE:M.getPaintProperty("line-pattern")&&
this._styleChanges.push({type:h.StyleUpdateType.PAINTER_CHANGED,data:{layer:M.id,paint:M.paint,isDataDriven:M.isPainterDataDriven()}});break;case I.StyleLayerType.FILL:M.getLayoutProperty("fill-pattern")&&this._styleChanges.push({type:h.StyleUpdateType.PAINTER_CHANGED,data:{layer:M.id,paint:M.paint,isDataDriven:M.isPainterDataDriven()}})}this.notifyChange("updating");this.requestUpdate()})],this.declaredClass)};O.detach=function(){var K,G;this._stop();this.container.removeAllChildren();null==(K=this._vectorTileContainer)?
void 0:K.destroy();this._vectorTileContainer=null;null==(G=this._tileHandler)?void 0:G.destroy();this._tileHandler=null;this.handles.remove(this.declaredClass)};O.moveStart=function(){this.requestUpdate()};O.viewChange=function(){this.requestUpdate()};O.moveEnd=function(){this._collisionBoxesDisplay&&this._vectorTileContainer.restartDeclutter();this.requestUpdate()};O.supportsSpatialReference=function(K){var G;return m.equals(null==(G=this.layer.tileInfo)?void 0:G.spatialReference,K)};O.canResume=
function(){let K=R.prototype.canResume.call(this);const {currentStyleInfo:G}=this.layer;if(K&&null!=G&&G.layerDefinition){const M=this.view.scale,{minScale:U,maxScale:Y}=G.layerDefinition;G&&G.layerDefinition&&(U&&U<M&&(K=!1),Y&&Y>M&&(K=!1))}return K};O.isUpdating=function(){const K=this._vectorTileContainer.children;return!this._isTileHandlerReady||!this._fetchQueue||!this._parseQueue||this._fetchQueue.updating||this._parseQueue.updating||0<K.length&&K.some(G=>G.invalidating)||this.fading};O.acquireTile=
function(K){const G=this._createVectorTile(K);this._tileHandlerPromise.then(()=>{this._fetchQueue.push(G.key).then(M=>this._parseQueue.push({key:G.key,data:M})).then(M=>{G.once("attach",()=>this.requestUpdate());G.setData(M);this.requestUpdate();this.notifyChange("updating")}).catch(M=>{this.notifyChange("updating");b.isAbortError(M)||S.error(M)})});return G};O.releaseTile=function(K){K=K.key.id;this._fetchQueue.abort(K);this._parseQueue.abort(K);this.requestUpdate()};O._start=function(){this._stop();
this._tileManager=new w.TileManager({acquireTile:M=>this.acquireTile(M),releaseTile:M=>this.releaseTile(M),tileInfoView:this._tileInfoView},this._vectorTileContainer);if(this.layer.currentStyleInfo){var K=new AbortController,G=this._tileHandler.start({signal:K.signal}).then(()=>{this._fetchQueue=new N({tileInfoView:this._tileInfoView,process:(M,U)=>this._getTileData(M,U),concurrency:15});this._parseQueue=new N({tileInfoView:this._tileInfoView,process:(M,U)=>this._parseTileData(M,U),concurrency:8});
this.requestUpdate();this._isTileHandlerReady=!0});this._tileHandler.spriteMosaic.then(M=>{this._vectorTileContainer.setStyleResources(M,this._tileHandler.glyphMosaic,this._styleRepository);this.requestUpdate()});this._tileHandlerAbortController=K;this._tileHandlerPromise=G}};O._stop=function(){if(this._tileHandlerAbortController&&this._vectorTileContainer){var K=this._tileHandlerAbortController;K&&K.abort();this._tileHandlerPromise=null;this._isTileHandlerReady=!1;this._fetchQueue&&(this._fetchQueue.destroy(),
this._fetchQueue=null);this._parseQueue&&(this._parseQueue.destroy(),this._parseQueue=null);this._tileManager&&(this._tileManager.destroy(),this._tileManager=null);this._vectorTileContainer.removeAllChildren()}};O._getTileData=function(){var K=A._asyncToGenerator(function*(G,M){G=yield this._tileHandler.fetchTileData(G,M);this.notifyChange("updating");return G});return function(G,M){return K.apply(this,arguments)}}();O._parseTileData=function(){var K=A._asyncToGenerator(function*(G,M){return this._tileHandler.parseTileData(G,
M)});return function(G,M){return K.apply(this,arguments)}}();O._applyStyleChanges=function(){var K=A._asyncToGenerator(function*(){this._isTileHandlerReady=!1;this._fetchQueue.pause();this._parseQueue.pause();this._fetchQueue.clear();this._parseQueue.clear();this._tileManager.clearCache();var G=this._styleChanges;try{yield this._tileHandler.updateStyle(G)}catch(ba){S.error("error applying vector-tiles style update",ba.message),this._fetchQueue.resume(),this._parseQueue.resume(),this._isTileHandlerReady=
!0}const M=this._styleRepository,U=[];G.forEach(ba=>{ba.type===h.StyleUpdateType.LAYER_REMOVED&&(ba=M.getLayerById(ba.data.layer))&&U.push(ba.uid)});const Y=[];let ca;G.forEach(ba=>{const X=ba.data;switch(ba.type){case h.StyleUpdateType.PAINTER_CHANGED:M.setPaintProperties(X.layer,X.paint);ca=X.layer;break;case h.StyleUpdateType.LAYOUT_CHANGED:M.setLayoutProperties(X.layer,X.layout);ca=X.layer;break;case h.StyleUpdateType.LAYER_REMOVED:M.deleteStyleLayer(X.layer);return;case h.StyleUpdateType.LAYER_CHANGED:M.setStyleLayer(X.layer,
X.index);ca=X.layer.id;break;case h.StyleUpdateType.SPRITES_CHANGED:this._vectorTileContainer.setSpriteMosaic(this._tileHandler.setSpriteSource(this._newSpriteSource)),ca=this._newSpriteSource=null}(ba=M.getLayerById(ca))&&Y.push(ba.uid)});G=this._vectorTileContainer.children;if(0<U.length){this._vectorTileContainer.deleteStyleLayers(U);for(var da of G)da.deleteLayerData(U)}this._fetchQueue.resume();this._parseQueue.resume();if(0<Y.length){da=[];for(const ba of G)G=this._fetchQueue.push(ba.key).then(X=>
this._parseQueue.push({key:ba.key,data:X,styleLayerUIDs:Y})).then(X=>ba.setData(X)),da.push(G);yield Promise.all(da)}this._styleChanges=[];this._isTileHandlerReady=!0;this.notifyChange("updating");this.requestUpdate()});return function(){return K.apply(this,arguments)}}();O._loadStyle=function(){var K=A._asyncToGenerator(function*(){var {style:G}=this.layer.currentStyleInfo;G=x.clone(G);this._isTileHandlerReady=!1;this._fetchQueue.pause();this._parseQueue.pause();this._fetchQueue.clear();this._parseQueue.clear();
this.notifyChange("updating");this._styleRepository=new H(G);this._vectorTileContainer.destroy();this._tileManager.clear();this._tileHandlerAbortController.abort();this._tileHandlerAbortController=new AbortController;const {signal:M}=this._tileHandlerAbortController;try{this._tileHandlerPromise=this._tileHandler.setStyle(this._styleRepository,G),yield this._tileHandlerPromise}catch(U){if(!b.isAbortError(U))throw U;}M.aborted||(G=yield this._tileHandler.spriteMosaic,this._vectorTileContainer.setStyleResources(G,
this._tileHandler.glyphMosaic,this._styleRepository));this._fetchQueue.resume();this._parseQueue.resume();this._isTileHandlerReady=!0;this.notifyChange("updating");this.requestUpdate()});return function(){return K.apply(this,arguments)}}();O._createVectorTile=function(K){const G=this._tileInfoView.getTileBounds(p.create(),K);return new k.VectorTile(K,G[0],G[3],512,512,this._styleRepository)};O._renderCollisionBoxes=function(K){for(const G of this._vectorTileContainer.children)if(G.symbols){const M=
[];for(const [,U]of G.symbols)M.push(...U);C.drawColliders(K,M)}};return T}(B.LayerView2DMixin(Q));D.__decorate([a.property()],e.prototype,"_fetchQueue",void 0);D.__decorate([a.property()],e.prototype,"_parseQueue",void 0);D.__decorate([a.property()],e.prototype,"_isTileHandlerReady",void 0);D.__decorate([a.property()],e.prototype,"fading",void 0);return e=D.__decorate([g.subclass("esri.views.2d.layers.VectorTileLayerView2D")],e)});