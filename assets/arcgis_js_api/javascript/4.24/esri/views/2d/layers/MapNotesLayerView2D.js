// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Collection ../../../core/maybe ../../../core/reactiveUtils ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/set ../../../core/accessorSupport/decorators/subclass ./LayerView2D ./graphics/GraphicContainer ./graphics/GraphicsView2D ../../layers/LayerView".split(" "),function(l,t,u,v,k,h,m,B,C,D,E,w,x,p,q,y){const z=
Object.freeze({remove(){},pause(){},resume(){}});m=function(r){function n(){var a=r.apply(this,arguments)||this;a._highlightIds=new Map;return a}l._inheritsLoose(n,r);var e=n.prototype;e.fetchPopupFeatures=function(){var a=l._asyncToGenerator(function*(b){return Array.from(this.graphicsViews(),c=>c.hitTest(b).filter(d=>!!d.popupTemplate)).flat()});return function(b){return a.apply(this,arguments)}}();e.graphicsViews=function*(){k.isSome(this._graphicsViewsFeatureCollectionMap)?yield*this._graphicsViewsFeatureCollectionMap.keys():
k.isSome(this._graphicsViews)?yield*this._graphicsViews:yield*[]};e.hitTest=function(){var a=l._asyncToGenerator(function*(b,c){return Array.from(this.graphicsViews(),d=>{const f=d.hitTest(b);if(k.isSome(this._graphicsViewsFeatureCollectionMap)){d=this._graphicsViewsFeatureCollectionMap.get(d);for(const g of f)!g.popupTemplate&&d.popupTemplate&&(g.popupTemplate=d.popupTemplate)}return f}).flat().map(d=>({type:"graphic",graphic:d,layer:this.layer,mapPoint:b}))});return function(b,c){return a.apply(this,
arguments)}}();e.highlight=function(a){let b;"number"===typeof a?b=[a]:a instanceof u?b=[a.uid]:Array.isArray(a)&&0<a.length?b="number"===typeof a[0]?a:a.map(c=>c&&c.uid):v.isCollection(a)&&(b=a.map(c=>c&&c.uid).toArray());b=b.filter(c=>null!=c);if(!b.length)return z;this._addHighlight(b);return{remove:()=>{this._removeHighlight(b)}}};e.update=function(a){for(const b of this.graphicsViews())b.processUpdate(a)};e.attach=function(){const a=this.view,b=()=>this.requestUpdate();var c=this.layer.featureCollections;
if(k.isSome(c)&&c.length){this._graphicsViewsFeatureCollectionMap=new Map;for(const d of c){c=new p(this.view.featuresTilingScheme);c.fadeTransitionEnabled=!0;const f=new q({view:a,graphics:d.source,renderer:d.renderer,requestUpdateCallback:b,container:c});this._graphicsViewsFeatureCollectionMap.set(f,d);this.container.addChild(f.container);this.handles.add([h.watch(()=>d.visible,g=>f.container.visible=g,h.initial),h.watch(()=>f.updating,()=>this.notifyChange("updating"),h.initial)],"layerView")}this._updateHighlight()}else k.isSome(this.layer.sublayers)&&
this.handles.add(h.on(()=>this.layer.sublayers,"change",()=>this._createGraphicsViews(),{onListenerAdd:()=>this._createGraphicsViews(),onListenerRemove:()=>this._destroyGraphicsViews()}),"sublayers")};e.detach=function(){this._destroyGraphicsViews();this.handles.remove("sublayers")};e.moveStart=function(){};e.moveEnd=function(){};e.viewChange=function(){for(const a of this.graphicsViews())a.viewChange()};e.isUpdating=function(){for(const a of this.graphicsViews())if(a.updating)return!0;return!1};
e._destroyGraphicsViews=function(){this.container.removeAllChildren();this.handles.remove("layerView");for(const a of this.graphicsViews())a.destroy();this._graphicsViewsFeatureCollectionMap=this._graphicsViews=null};e._createGraphicsViews=function(){this._destroyGraphicsViews();if(!k.isNone(this.layer.sublayers)){var a=[],b=this.view,c=()=>this.requestUpdate();for(const d of this.layer.sublayers){const f=new p(this.view.featuresTilingScheme);f.fadeTransitionEnabled=!0;const g=new q({view:b,graphics:d.graphics,
requestUpdateCallback:c,container:f});this.handles.add([d.on("graphic-update",g.graphicUpdateHandler),h.watch(()=>d.visible,A=>g.container.visible=A,h.initial),h.watch(()=>g.updating,()=>this.notifyChange("updating"),h.initial)],"layerView");this.container.addChild(g.container);a.push(g)}this._graphicsViews=a;this._updateHighlight()}};e._addHighlight=function(a){for(const b of a)this._highlightIds.has(b)?(a=this._highlightIds.get(b),this._highlightIds.set(b,a+1)):this._highlightIds.set(b,1);this._updateHighlight()};
e._removeHighlight=function(a){for(const b of a)this._highlightIds.has(b)&&(a=this._highlightIds.get(b)-1,0===a?this._highlightIds.delete(b):this._highlightIds.set(b,a));this._updateHighlight()};e._updateHighlight=function(){const a=Array.from(this._highlightIds.keys());for(const b of this.graphicsViews())b.setHighlight(a)};return n}(x.LayerView2DMixin(y));return m=t.__decorate([w.subclass("esri.views.2d.layers.MapNotesLayerView2D")],m)});