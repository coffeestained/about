// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Logger ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/Extent ../engine/BitmapContainer ./LayerView2D ./support/ExportStrategy ../../layers/LayerView ../../layers/RefreshableLayerView ../../layers/WMSLayerView".split(" "),
function(r,k,e,A,B,t,M,N,O,C,D,E,F,G,H,I,J){const K=e.getLogger("esri.views.2d.layers.WMSLayerView2D");e=function(u){function l(){var a=u.apply(this,arguments)||this;a.container=new E.BitmapContainer;return a}r._inheritsLoose(l,u);var b=l.prototype;b.supportsSpatialReference=function(a){return this.layer.serviceSupportsSpatialReference(a)};b.update=function(a){this.strategy.update(a).catch(c=>{A.isAbortError(c)||K.error(c)})};b.attach=function(){const {layer:a,container:c}=this,{imageMaxHeight:g,
imageMaxWidth:d}=a;this.strategy=new G({container:c,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:g,imageMaxWidth:d,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1});this.handles.add(B.watch(()=>this.exportImageVersion,()=>this.requestUpdate()),"exportImageVersion")};b.detach=function(){this.handles.remove("exportImageVersion");this.strategy.destroy();this.strategy=null;this.container.removeAllChildren()};b.moveStart=function(){};
b.viewChange=function(){};b.moveEnd=function(){this.requestUpdate()};b.createFetchPopupFeaturesQuery=function(a){const {view:c,container:g}=this,{x:d,y:m}=a,{spatialReference:L}=c;let f=null,n=0,v=0;g.children.some(h=>{const {width:w,height:x,resolution:y,x:p,y:q}=h;h=p+y*w;const z=q-y*x;return d>=p&&d<=h&&m<=q&&m>=z?(f=new D({xmin:p,ymin:z,xmax:h,ymax:q,spatialReference:L}),n=w,v=x,!0):!1});if(!f)return null;a=f.width/n;return{extent:f,width:n,height:v,x:Math.round((d-f.xmin)/a),y:Math.round((f.ymax-
m)/a)}};b.doRefresh=function(){var a=r._asyncToGenerator(function*(){this.requestUpdate()});return function(){return a.apply(this,arguments)}}();b.isUpdating=function(){return this.strategy.updating||this.updateRequested};b.fetchImage=function(a,c,g,d){return this.layer.fetchImage(a,c,g,{timeExtent:this.timeExtent,...d})};return l}(J(I(F.LayerView2DMixin(H))));k.__decorate([t.property()],e.prototype,"strategy",void 0);k.__decorate([t.property()],e.prototype,"updating",void 0);return e=k.__decorate([C.subclass("esri.views.2d.layers.WMSLayerView2D")],
e)});