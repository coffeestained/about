// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/maybe ../../../../../../core/screenUtils ../../color ../../definitions ../../GeometryUtils ../../number ../../materialKey/MaterialKey ./util ./WGLBaseFillTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),function(A,B,q,x,n,y,r,C,k,D,E,F){return function(z){function v(a,h,t){var c;var b=z.call(this,a)||this;b._minMaxZoom=r.i1616to32(Math.round(h*n.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(t*n.MIN_MAX_ZOOM_PRECISION_FACTOR));
k.isFunction(a.color)?b._dynamicPropertyMap.set("fillColor",(d,g,f)=>(d=a.color(d,g,f))&&x.premultiplyAlphaRGBA(d)||0):(h=a.color,b.fillColor=h&&x.premultiplyAlphaRGBA(h)||0);const e="CIMMarkerPlacementInsidePolygon"===(null==(c=a.cim.placement)?void 0:c.type)&&a.cim.placement.shiftOddRows?2:1,l=a.height;k.isFunction(l)?b._dynamicPropertyMap.set("_height",(d,g,f)=>l(d,g,f)*e):b._height=(l||0)*e;const m=a.offsetX;k.isFunction(m)?b._dynamicPropertyMap.set("_offsetX",(d,g,f)=>q.pt2px(m(d,g,f))):b._offsetX=
q.pt2px(m||0);const u=a.offsetY;k.isFunction(u)?b._dynamicPropertyMap.set("_offsetY",(d,g,f)=>q.pt2px(-u(d,g,f))):b._offsetY=q.pt2px(-u||0);c=a.scaleX;k.isFunction(c)?b._dynamicPropertyMap.set("_scaleX",c):b._scaleX=c||1;const p=a.angle;k.isFunction(p)?b._dynamicPropertyMap.set("_angle",(d,g,f)=>y.radToByte(p(d,g,f))):b._angle=y.radToByte(p)||0;B.isSome(a.effects)&&(c=a.effects,k.isFunction(c)?b._dynamicPropertyMap.set("_effects",c):b._effects=c);b._cimFillLayer=a;b._bitset=(a.colorLocked?n.BITSET_GENERIC_LOCK_COLOR:
0)|(a.applyRandomOffset?n.BITSET_FILL_RANDOM_PATTERN_OFFSET:0)|(a.sampleAlphaOnly?n.BITSET_GENERIC_CONSIDER_ALPHA_ONLY:0);b._fillMaterialKey=C.FillMaterialKey.load(a.materialKey);return b}A._inheritsLoose(v,z);v.fromCIMFill=function(a,h){const [t,c]=k.getMinMaxZoom(a.scaleInfo,h);return new v(a,t,c)};v.prototype.bindFeature=function(a,h,t){const c=a.readLegacyFeature();this._dynamicPropertyMap.forEach((l,m)=>{this[m]=l(c,h,t)});a=this._fillMaterialKey;var b=this._materialCache,e=this._cimFillLayer.materialHash;
e=e(c,h,t);e=b.get(e);b=null;e&&F.ok(e.spriteMosaicItem)&&(b=e.spriteMosaicItem);if(b){const {rect:l,width:m,height:u}=b;e=l.x+n.SPRITE_PADDING;const p=l.y+n.SPRITE_PADDING,d=e+m,g=p+u;let f=Math.round(q.pt2px(this._height));0>=f&&(f=g-p);let w=Math.round(q.pt2px(this._height/u*m||0));0>=w&&(w=d-e);const G=this._scaleX;this.tl=r.i1616to32(e,p);this.br=r.i1616to32(d,g);this.aux2_1=r.i1616to32(w,f);this.aux2_2=r.i1616to32(this._offsetX,this._offsetY);this.aux3=r.i8888to32(G,1,this._angle,0);a.sdf=b.sdf;
a.pattern=!0;a.textureBinding=b.textureBinding}else this.aux3=this.aux2_2=this.aux2_1=this.br=this.tl=0,a.sdf=!1,a.pattern=!1,a.textureBinding=0;this._materialKey=a.data};return v}(D(E))});