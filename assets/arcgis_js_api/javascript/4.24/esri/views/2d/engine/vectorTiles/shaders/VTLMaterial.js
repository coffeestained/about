// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../MemoryBuffer ./enums ../../../../webgl/enums ../../../../webgl/VertexElementDescriptor".split(" "),function(E,J,F,K,e,n,G){let I=function(){function z(b){this._locations=new Map;this._key=b}var m=z.prototype;m.defines=function(){return[]};m.getStride=function(){this._layoutInfo||this._buildAttributesInfo();return this._stride};m.getAttributeLocations=function(){0===this._locations.size&&this._buildAttributesInfo();
return this._locations};m.getLayoutInfo=function(){this._layoutInfo||this._buildAttributesInfo();return this._layoutInfo};m.getEncodingInfos=function(){this._propertyEncodingInfo||this._buildAttributesInfo();return this._propertyEncodingInfo};m.getUniforms=function(){this._uniforms||this._buildAttributesInfo();return this._uniforms};m.getShaderHeader=function(){this._shaderHeader||this._buildAttributesInfo();return this._shaderHeader};m.getShaderMain=function(){this._shaderMain||this._buildAttributesInfo();
return this._shaderMain};m.setDataUniforms=function(b,d,h,k,v){var p=this.getUniforms();for(const a of p){const {name:c,type:q,getValue:r}=a;p=r(h,d,k,v);if(null!==p)switch(q){case "float":b.setUniform1f(c,p);break;case "vec2":b.setUniform2fv(c,p);break;case "vec4":b.setUniform4fv(c,p)}}};m.encodeAttributes=function(b,d,h,k){const v=this.attributesInfo(),p=this.getEncodingInfos(),a=[];let c=0,q=0;for(const x of Object.keys(p)){var r,f=p[x];const {type:B,precisionFactor:u,isLayout:C}=v[x],w=C?h.getLayoutProperty(x):
h.getPaintProperty(x),t=null==(r=w.interpolator)?void 0:r.getInterpolationRange(d);let y=0;for(const l of f){const {offset:g,bufferElementsToAdd:A}=l;if(0<A){for(f=0;f<A;f++)a.push(0);c+=q;q=l.bufferElementsToAdd}f=null!=k?k:w.getValue(t?t[y]:d,b);switch(B){case e.EncodingType.R8_SIGNED:case e.EncodingType.R8_UNSIGNED:a[c]|=this._encodeByte(f*(u||1),8*g);break;case e.EncodingType.R16_SIGNED:case e.EncodingType.R16_UNSIGNED:a[c]|=this._encodeShort(f*(u||1),8*g);break;case e.EncodingType.R8G8_SIGNED:case e.EncodingType.R8G8_UNSIGNED:a[c]|=
this._encodeByte(f*(u||1),8*g);a[c]|=this._encodeByte(f*(u||1),8*g+8);break;case e.EncodingType.R16G16_SIGNED:case e.EncodingType.R16G16_UNSIGNED:a[c]|=this._encodeShort(f*(u||1),8*g);a[c]|=this._encodeShort(f*(u||1),8*g+16);break;case e.EncodingType.R8G8B8A8_SIGNED:case e.EncodingType.R8G8B8A8_UNSIGNED:a[c]|=this._encodeByte(f*(u||1),8*g);a[c]|=this._encodeByte(f*(u||1),8*g+8);a[c]|=this._encodeByte(f*(u||1),8*g+16);a[c]|=this._encodeByte(f*(u||1),8*g+24);break;case e.EncodingType.R8G8B8A8_COLOR:a[c]=
this._encodeColor(f);break;case e.EncodingType.R16G16B16A16_DASHARRAY:case e.EncodingType.R16G16B16A16_PATTERN:this._encodePattern(c,a,f);break;default:throw Error("Unsupported encoding type");}y++}}return a};m.getAtributeState=function(b){const d=3+2*b;b=0|this._bit(d);return b|=this._bit(d+1)<<1};m._buildAttributesInfo=function(){const b=[],d={};var h={},k=-1;const v=this.attributesInfo();var p=this.attributes();let a=-1;for(const f of p){a++;p=this.getAtributeState(a);if(p===e.AttributeStatus.UNIFORM||
p===e.AttributeStatus.UNUSED)continue;var c=v[f];const x=[];d[f]=x;c=c.type;for(let B=0;B<p;B++){const {dataType:u,bytesPerElement:C,count:w,normalized:t}=z._encodingInfo[c],y=C*w;var q=`${u}-${!0===t}`;let l=h[q],g=0;!l||4<l.count+w?(k++,l={dataIndex:k,count:0,offset:0},4!==w&&(h[q]=l),b.push({location:-1,name:"a_data_"+k,count:w,type:u,normalized:t}),g=Math.ceil(Math.max(y/4,1))):(q=b[l.dataIndex],q.count+=w,g=Math.ceil(Math.max(q.count*C/4,1))-Math.ceil(Math.max(l.offset/4,1)));x.push({dataIndex:l.dataIndex,
offset:l.offset,bufferElementsToAdd:g});l.offset+=y;l.count+=w}}for(const f of b)switch(f.type){case n.DataType.BYTE:case n.DataType.UNSIGNED_BYTE:f.count=4;break;case n.DataType.SHORT:case n.DataType.UNSIGNED_SHORT:f.count+=f.count%2}this._buildVertexBufferLayout(b);h=0;k=this._layoutInfo.geometry;for(var r of k)this._locations.set(r.name,h++);if(r=this._layoutInfo.opacity)for(const f of r)this._locations.set(f.name,h++);this._buildShaderInfo(b,d);this._propertyEncodingInfo=d};m._buildVertexBufferLayout=
function(b){const d={},h=this.geometryInfo();let k=h[0].stride;if(0===b.length)d.geometry=h;else{const v=[];let p=k;for(const a of b)k+=H(a.type)*a.count;for(const a of h)v.push(new G.VertexElementDescriptor(a.name,a.count,a.type,a.offset,k,a.normalized));for(const a of b)v.push(new G.VertexElementDescriptor(a.name,a.count,a.type,p,k,a.normalized)),p+=H(a.type)*a.count;d.geometry=v}this.opacityInfo()&&(d.opacity=this.opacityInfo());this._layoutInfo=d;this._stride=k};m._buildShaderInfo=function(b,
d){let h="\n",k="\n";const v=[];for(var p of b)h+=`attribute ${this._getType(p.count)} ${p.name};\n`;var a=this.attributes();b=this.attributesInfo();p=-1;for(const r of a){p++;const {name:f,type:x,precisionFactor:B,isLayout:u}=b[r];a=B&&1!==B?` * ${1/B}`:"";const {bytesPerElement:C,count:w}=z._encodingInfo[x];var c=t=>`a_data_${t.dataIndex}${L(w,t.offset,C)}`;switch(this.getAtributeState(p)){case e.AttributeStatus.UNIFORM:a=this._getType(w);var q=`u_${f}`;v.push({name:q,type:a,getValue:(t,y,l,g)=>
{l=u?t.getLayoutValue(r,y):t.getPaintValue(r,y);if(x===e.EncodingType.R16G16B16A16_DASHARRAY){t=t.getDashKey(l,t.getLayoutValue("line-cap",y));g=g.getMosaicItemPosition(t,!1);if(F.isNone(g))return null;const {tl:A,br:D}=g;return[A[0],D[1],D[0],A[1]]}if(x===e.EncodingType.R16G16B16A16_PATTERN){g=g.getMosaicItemPosition(l,!r.includes("line-"));if(F.isNone(g))return null;const {tl:A,br:D}=g;return[A[0],D[1],D[0],A[1]]}return x===e.EncodingType.R8G8B8A8_COLOR?(g=l[3],[g*l[0],g*l[1],g*l[2],g]):l}});h+=
`uniform ${a} ${q};\n`;k+=`${a} ${f} = ${q};\n`;break;case e.AttributeStatus.DATA_DRIVEN:q=c(d[r][0]);k+=`${this._getType(w)} ${f} = ${q}${a};\n`;break;case e.AttributeStatus.INTERPOLATED_DATA_DRIVEN:{q=`u_t_${f}`;v.push({name:q,type:"float",getValue:(y,l,g,A)=>(u?y.getLayoutProperty(r):y.getPaintProperty(r)).interpolator.interpolationUniformValue(g,l)});h+=`uniform float ${q};\n`;const t=c(d[r][0]);c=c(d[r][1]);k+=`${this._getType(w)} ${f} = mix(${t}${a}, ${c}${a}, ${q});\n`}}}this._shaderHeader=
h;this._shaderMain=k;this._uniforms=v};m._bit=function(b){return(this._key&1<<b)>>b};m._getType=function(b){switch(b){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4"}throw Error("Invalid count");};m._encodeColor=function(b){const d=255*b[3];return K.i8888to32(b[0]*d,b[1]*d,b[2]*d,d)};m._encodePattern=function(b,d,h){if(h&&h.rect){var k=h.rect,v=h.width;h=h.height;d[b]=this._encodeShort(k.x+2,0);d[b]|=this._encodeShort(k.y+2+h,16);d[b+1]=this._encodeShort(k.x+2+v,0);
d[b+1]|=this._encodeShort(k.y+2,16)}};m._encodeByte=function(b,d){return(b&255)<<d};m._encodeShort=function(b,d){return(b&65535)<<d};J._createClass(z,[{key:"key",get:function(){return this._key}},{key:"type",get:function(){return this._key&7}}]);return z}();I._encodingInfo={[e.EncodingType.R8_SIGNED]:{dataType:n.DataType.BYTE,bytesPerElement:1,count:1,normalized:!1},[e.EncodingType.R8_UNSIGNED]:{dataType:n.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:1,normalized:!1},[e.EncodingType.R16_SIGNED]:{dataType:n.DataType.SHORT,
bytesPerElement:2,count:1,normalized:!1},[e.EncodingType.R16_UNSIGNED]:{dataType:n.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:1,normalized:!1},[e.EncodingType.R8G8_SIGNED]:{dataType:n.DataType.BYTE,bytesPerElement:1,count:2,normalized:!1},[e.EncodingType.R8G8_UNSIGNED]:{dataType:n.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:2,normalized:!1},[e.EncodingType.R16G16_SIGNED]:{dataType:n.DataType.SHORT,bytesPerElement:2,count:2,normalized:!1},[e.EncodingType.R16G16_UNSIGNED]:{dataType:n.DataType.UNSIGNED_SHORT,
bytesPerElement:2,count:2,normalized:!1},[e.EncodingType.R8G8B8A8_SIGNED]:{dataType:n.DataType.BYTE,bytesPerElement:1,count:4,normalized:!1},[e.EncodingType.R8G8B8A8_UNSIGNED]:{dataType:n.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!1},[e.EncodingType.R8G8B8A8_COLOR]:{dataType:n.DataType.UNSIGNED_BYTE,bytesPerElement:1,count:4,normalized:!0},[e.EncodingType.R16G16B16A16_DASHARRAY]:{dataType:n.DataType.UNSIGNED_SHORT,bytesPerElement:2,count:4,normalized:!1},[e.EncodingType.R16G16B16A16_PATTERN]:{dataType:n.DataType.UNSIGNED_SHORT,
bytesPerElement:2,count:4,normalized:!1}};const H=z=>{switch(z){case n.DataType.FLOAT:return 4;case n.DataType.INT:return 4;case n.DataType.UNSIGNED_INT:return 4;case n.DataType.SHORT:return 2;case n.DataType.UNSIGNED_SHORT:return 2;case n.DataType.BYTE:return 1;case n.DataType.UNSIGNED_BYTE:return 1}},L=(z,m,b)=>{m/=b;if(1===z)switch(m){case 0:return".x";case 1:return".y";case 2:return".z";case 3:return".w"}else if(2===z)switch(m){case 0:return".xy";case 1:return".yz";case 2:return".zw"}else if(3===
z)switch(m){case 0:return".xyz";case 1:return".yzw"}return""};E.VTLMaterial=I;Object.defineProperties(E,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});