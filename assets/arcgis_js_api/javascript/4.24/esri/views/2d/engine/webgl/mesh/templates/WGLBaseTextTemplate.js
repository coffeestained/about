// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/maybe ../../../../../../core/screenUtils ../../../../../../layers/graphics/featureConversionUtils ../../../../../../symbols/cim/placements/CIMMarkerPlacementHelper ../../definitions ../../enums ../../number ../../materialKey/MaterialKey ./shapingUtils".split(" "),function(v,l,w,p,x,y,z,m,q,A){return B=>function(r){function n(...a){a=r.call(this,...a)||this;a._isCIM=!1;a._vertexBoundsScale=1;a.geometryType=z.WGLGeometryType.TEXT;
a._aux=m.i8888to32(0,0,a._referenceSize,a._bitset);return a}v._inheritsLoose(n,r);var k=n.prototype;k.bindTextInfo=function(a,e){this._shapingInfo=a&&a.length?l.applySome(a,c=>A.shapeGlyphs(c,e,{scale:this._scale,angle:this._angle,xOffset:this._xOffset,yOffset:this._yOffset,hAlign:this._xAlignD,vAlign:this._yAlignD,maxLineWidth:Math.max(32,Math.min(this._lineWidth,512)),lineHeight:y.MAGIC_LABEL_LINE_HEIGHT*Math.max(.25,Math.min(this._lineHeight,4)),decoration:this._decoration,isCIM:this._isCIM})):
null};k._write=function(a,e,c,b){const d=e.getDisplayId();this._writeGeometry(a,e,d,c,b)};k._writeGeometry=function(a,e,c,b,d){const f=this._shapingInfo;if(!l.isNone(f)){if(l.isSome(this._textPlacement))return e=null!=d?d:e.readLegacyGeometryForDisplay(),this._writePlacedText(a,c,e,f,b);b=d?p.deltaDecodeGeometry(p.convertFromGeometry(d),2):"esriGeometryPolygon"===e.geometryType?e.readCentroid():e.readGeometryForDisplay();if(!l.isNone(b)){if(b.isPoint){const [g,h]=b.coords;return!a.hasAggregates&&
a.hasPixelBufferEnabled&&(0>g||512<=g||0>h||512<=h)?void 0:this._writeGlyphs(a,c,{x:g,y:h},f)}b.forEachVertex((g,h)=>this._writeGlyphs(a,c,{x:g,y:h},f))}}};k._writePlacedText=function(a,e,c,b,d){var f=l.unwrap(this._textPlacement);if(c=x.CIMMarkerPlacementHelper.getPlacement(c,f,w.pt2px(1),d.geometryEngine))for(var g=c.next();null!=g;)d=-g.getAngle(),b.setRotation(d),f=g.tx,g=-g.ty,0>f||512<=f||0>g||512<=g||(this._writeGlyphs(a,e,{x:f,y:g},b),b.setRotation(-d)),g=c.next()};k._writeGlyphs=function(a,
e,c,b){const d=q.MaterialKeyBase.load(this._materialKey),f=m.i1616to32(Math.round(8*c.x),Math.round(8*c.y)),g=this._vertexBoundsScale,h=b.bounds,t=2*Math.max(h.width,h.height);for(const u of b.glyphs)d.textureBinding=u.textureBinding,a.recordStart(e,d.data,this.geometryType,!0),a.vertexBounds(c.x+h.x+this._xOffset,c.y+h.y-this._yOffset,t*g,t*g),this._writeVertices(a,e,f,u),a.recordEnd()};k._writeGlyph=function(a,e,c,b,d){var f=q.MaterialKeyBase.load(this._materialKey);const g=m.i1616to32(Math.round(8*
c),Math.round(8*b));f.textureBinding=d.textureBinding;a.recordStart(e,f.data,this.geometryType,!0);f=d.bounds;const h=this._vertexBoundsScale;a.vertexBounds(c+f.x*h,b+f.y*h,f.width*h,f.height*h);this._writeVertices(a,e,g,d);a.recordEnd()};k._writeVertices=function(a,e,c,b){const d=a.vertexCount();this._writeVertexCommon(a,e,c,b);a.vertexWrite(b.offsets.upperLeft);a.vertexWrite(b.texcoords.upperLeft);a.vertexEnd();this._writeVertexCommon(a,e,c,b);a.vertexWrite(b.offsets.upperRight);a.vertexWrite(b.texcoords.upperRight);
a.vertexEnd();this._writeVertexCommon(a,e,c,b);a.vertexWrite(b.offsets.lowerLeft);a.vertexWrite(b.texcoords.lowerLeft);a.vertexEnd();this._writeVertexCommon(a,e,c,b);a.vertexWrite(b.offsets.lowerRight);a.vertexWrite(b.texcoords.lowerRight);a.vertexEnd();a.indexWrite(d+0);a.indexWrite(d+1);a.indexWrite(d+2);a.indexWrite(d+1);a.indexWrite(d+3);a.indexWrite(d+2)};k._writeVertexCommon=function(a,e,c,b){b=this._color;const d=this._haloColor,f=m.i8888to32(0,0,this._referenceSize,this._bitset),g=m.i8888to32(0,
0,this._size,this._haloSize);a.vertexWrite(c);a.vertexWrite(e);a.vertexWrite(b);a.vertexWrite(d);a.vertexWrite(g);a.vertexWrite(f);a.vertexWrite(this._minMaxZoom)};return n}(B)});