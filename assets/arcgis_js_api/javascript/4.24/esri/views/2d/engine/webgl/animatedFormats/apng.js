// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/_commonjsHelpers ../../../../../core/Error ../../../../../core/promiseUtils ../../../../../core/time ./BaseAnimatableTextureResource".split(" "),function(D,F,J,Q,K,R,H){function L(q,y,d){return I.apply(this,arguments)}function I(){I=F._asyncToGenerator(function*(q,y,d){q=S(q);if(q instanceof Error)throw q;yield q.createImages();K.throwIfAborted(d);const {frames:f,width:g,height:h}=q;d=document.createElement("canvas");
d.width=g;d.height=h;d=d.getContext("2d");const m=[];q=[];for(const a of f){q.push(R.Milliseconds(a.delay));var c=a.imageElement;d.globalCompositeOperation=0===a.blendOp?"copy":"source-over";const b=2===a.disposeOp&&d.getImageData(a.left,a.top,a.width,a.height);d.drawImage(c,a.left,a.top);c=d.getImageData(0,0,g,h);m.push(c);0!==a.disposeOp&&(1===a.disposeOp?d.clearRect(a.left,a.top,a.width,a.height):2===a.disposeOp&&d.putImageData(b,a.left,a.top))}return{frameDurations:q,selectFrame:a=>{y(m[a])},
width:g,height:h}});return I.apply(this,arguments)}function M(q){const y=new Uint8Array(q);return!T.some((d,f)=>d!==y[f])}var N={exports:{}};(function(q,y){(function(d,f){q.exports=f()})(J.commonjsGlobal,function(){return function(d){function f(h){if(g[h])return g[h].exports;var m=g[h]={exports:{},id:h,loaded:!1};d[h].call(m.exports,m,m.exports,f);m.loaded=!0;return m.exports}var g={};f.m=d;f.c=g;f.p="";return f(0)}([function(d,f,g){function h(n,w){var v=new DataView(n.buffer),u=8,x=void 0,C=void 0,
p=void 0;do C=v.getUint32(u),x=u+4,x=Array.prototype.slice.call(n.subarray(x,x+4)),x=String.fromCharCode.apply(String,x),p=w(x,n,u,C),u+=12+C;while(!1!==p&&"IEND"!=x&&u<n.length)}function m(n){for(var w=new Uint8Array(n.length),v=0;v<n.length;v++)w[v]=n.charCodeAt(v);return w}function c(n,w,v){var u=new Uint8Array(v);u.set(n.subarray(w,w+v));return u}Object.defineProperty(f,"__esModule",{value:!0});f.isNotPNG=function(n){return n===e};f.isNotAPNG=function(n){return n===l};f.default=function(n){var w=
new Uint8Array(n);if(Array.prototype.some.call(k,function(z,t){return z!==w[t]}))return e;var v=!1;h(w,function(z){return!(v="acTL"===z)});if(!v)return l;var u=[],x=[],C=null,p=null,O=0,B=new b.APNG;h(w,function(z,t,r,E){var A=new DataView(t.buffer);switch(z){case "IHDR":C=t.subarray(r+8,r+8+E);B.width=A.getUint32(r+8);B.height=A.getUint32(r+12);break;case "acTL":B.numPlays=A.getUint32(r+8+4);break;case "fcTL":p&&(B.frames.push(p),O++);p=new b.Frame;p.width=A.getUint32(r+8+4);p.height=A.getUint32(r+
8+8);p.left=A.getUint32(r+8+12);p.top=A.getUint32(r+8+16);z=A.getUint16(r+8+20);t=A.getUint16(r+8+22);0===t&&(t=100);p.delay=1E3*z/t;10>=p.delay&&(p.delay=100);B.playTime+=p.delay;p.disposeOp=A.getUint8(r+8+24);p.blendOp=A.getUint8(r+8+25);p.dataParts=[];0===O&&2===p.disposeOp&&(p.disposeOp=1);break;case "fdAT":p&&p.dataParts.push(t.subarray(r+8+4,r+8+E));break;case "IDAT":p&&p.dataParts.push(t.subarray(r+8,r+8+E));break;case "IEND":x.push(c(t,r,12+E));break;default:u.push(c(t,r,12+E))}});p&&B.frames.push(p);
if(0==B.frames.length)return l;var U=new Blob(u),V=new Blob(x);B.frames.forEach(function(z){var t=[];t.push(k);C.set(P(z.width),0);C.set(P(z.height),4);t.push(G("IHDR",C));t.push(U);z.dataParts.forEach(function(r){return t.push(G("IDAT",r))});t.push(V);z.imageData=new Blob(t,{type:"image/png"});delete z.dataParts;t=null});return B};var a=(d=g(1))&&d.__esModule?d:{default:d},b=g(2),e=Error("Not a PNG"),l=Error("Not an animated PNG"),k=new Uint8Array([137,80,78,71,13,10,26,10]),G=function(n,w){var v=
n.length+w.length,u=new Uint8Array(v+8),x=new DataView(u.buffer);x.setUint32(0,w.length);u.set(m(n),4);u.set(w,8);n=(0,a.default)(u,4,v);x.setUint32(v+4,n);return u},P=function(n){return new Uint8Array([n>>>24&255,n>>>16&255,n>>>8&255,n&255])}},function(d,f){Object.defineProperty(f,"__esModule",{value:!0});f.default=function(m){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,a=-1,b=c;for(c+=2<arguments.length&&void 0!==arguments[2]?arguments[2]:m.length-c;b<c;b++)a=a>>>8^g[(a^m[b])&
255];return a^-1};var g=new Uint32Array(256);for(d=0;256>d;d++){f=d;for(var h=0;8>h;h++)f=0!==(f&1)?3988292384^f>>>1:f>>>1;g[d]=f}},function(d,f,g){function h(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}Object.defineProperty(f,"__esModule",{value:!0});f.Frame=f.APNG=void 0;var m=function(){function a(b,e){for(var l=0;l<e.length;l++){var k=e[l];k.enumerable=k.enumerable||!1;k.configurable=!0;"value"in k&&(k.writable=!0);Object.defineProperty(b,k.key,k)}}return function(b,
e,l){e&&a(b.prototype,e);l&&a(b,l);return b}}(),c=(d=g(3))&&d.__esModule?d:{default:d};f.APNG=function(){function a(){h(this,a);this.playTime=this.numPlays=this.height=this.width=0;this.frames=[]}m(a,[{key:"createImages",value:function(){return Promise.all(this.frames.map(function(b){return b.createImage()}))}},{key:"getPlayer",value:function(b){var e=this,l=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!1;return this.createImages().then(function(){return new c.default(e,b,l)})}}]);return a}();
f.Frame=function(){function a(){h(this,a);this.blendOp=this.disposeOp=this.delay=this.height=this.width=this.top=this.left=0;this.imageElement=this.imageData=null}m(a,[{key:"createImage",value:function(){var b=this;return this.imageElement?Promise.resolve():new Promise(function(e,l){var k=URL.createObjectURL(b.imageData);b.imageElement=document.createElement("img");b.imageElement.onload=function(){URL.revokeObjectURL(k);e()};b.imageElement.onerror=function(){URL.revokeObjectURL(k);b.imageElement=
null;l(Error("Image creation error"))};b.imageElement.src=k})}}]);return a}()},function(d,f,g){function h(c,a){if("function"!==typeof a&&null!==a)throw new TypeError("Super expression must either be null or a function, not "+typeof a);c.prototype=Object.create(a&&a.prototype,{constructor:{value:c,enumerable:!1,writable:!0,configurable:!0}});a&&(Object.setPrototypeOf?Object.setPrototypeOf(c,a):c.__proto__=a)}Object.defineProperty(f,"__esModule",{value:!0});var m=function(){function c(a,b){for(var e=
0;e<b.length;e++){var l=b[e];l.enumerable=l.enumerable||!1;l.configurable=!0;"value"in l&&(l.writable=!0);Object.defineProperty(a,l.key,l)}}return function(a,b,e){b&&c(a.prototype,b);e&&c(a,e);return a}}();d=g(4);d=function(c){function a(b,e,l){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");var k=(a.__proto__||Object.getPrototypeOf(a)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");k=!k||"object"!==typeof k&&
"function"!==typeof k?this:k;k.playbackRate=1;k._currentFrameNumber=0;k._ended=!1;k._paused=!0;k._numPlays=0;k._apng=b;k.context=e;k.stop();l&&k.play();return k}h(a,c);m(a,[{key:"renderNextFrame",value:function(){this._currentFrameNumber=(this._currentFrameNumber+1)%this._apng.frames.length;this._currentFrameNumber===this._apng.frames.length-1&&(this._numPlays++,0!==this._apng.numPlays&&this._numPlays>=this._apng.numPlays&&(this._paused=this._ended=!0));this._prevFrame&&1==this._prevFrame.disposeOp?
this.context.clearRect(this._prevFrame.left,this._prevFrame.top,this._prevFrame.width,this._prevFrame.height):this._prevFrame&&2==this._prevFrame.disposeOp&&this.context.putImageData(this._prevFrameData,this._prevFrame.left,this._prevFrame.top);var b=this.currentFrame;this._prevFrame=b;this._prevFrameData=null;2==b.disposeOp&&(this._prevFrameData=this.context.getImageData(b.left,b.top,b.width,b.height));0==b.blendOp&&this.context.clearRect(b.left,b.top,b.width,b.height);this.context.drawImage(b.imageElement,
b.left,b.top);this.emit("frame",this._currentFrameNumber);this._ended&&this.emit("end")}},{key:"play",value:function(){var b=this;this.emit("play");this._ended&&this.stop();this._paused=!1;var e=performance.now()+this.currentFrame.delay/this.playbackRate;requestAnimationFrame(function G(k){if(!b._ended&&!b._paused){if(k>=e){for(;k-e>=b._apng.playTime/b.playbackRate;)e+=b._apng.playTime/b.playbackRate,b._numPlays++;do b.renderNextFrame(),e+=b.currentFrame.delay/b.playbackRate;while(!b._ended&&k>e)}requestAnimationFrame(G)}})}},
{key:"pause",value:function(){this._paused||(this.emit("pause"),this._paused=!0)}},{key:"stop",value:function(){this.emit("stop");this._numPlays=0;this._ended=!1;this._paused=!0;this._currentFrameNumber=-1;this.context.clearRect(0,0,this._apng.width,this._apng.height);this.renderNextFrame()}},{key:"currentFrameNumber",get:function(){return this._currentFrameNumber}},{key:"currentFrame",get:function(){return this._apng.frames[this._currentFrameNumber]}},{key:"paused",get:function(){return this._paused}},
{key:"ended",get:function(){return this._ended}}]);return a}((d&&d.__esModule?d:{default:d}).default);f.default=d},function(d,f){function g(){this._events=this._events||{};this._maxListeners=this._maxListeners||void 0}function h(c){return"function"===typeof c}function m(c){return"object"===typeof c&&null!==c}d.exports=g;g.EventEmitter=g;g.prototype._events=void 0;g.prototype._maxListeners=void 0;g.defaultMaxListeners=10;g.prototype.setMaxListeners=function(c){if("number"!==typeof c||0>c||isNaN(c))throw TypeError("n must be a positive number");
this._maxListeners=c;return this};g.prototype.emit=function(c){var a;this._events||(this._events={});if("error"===c&&(!this._events.error||m(this._events.error)&&!this._events.error.length)){var b=arguments[1];if(b instanceof Error)throw b;var e=Error('Uncaught, unspecified "error" event. ('+b+")");e.context=b;throw e;}e=this._events[c];if(void 0===e)return!1;if(h(e))switch(arguments.length){case 1:e.call(this);break;case 2:e.call(this,arguments[1]);break;case 3:e.call(this,arguments[1],arguments[2]);
break;default:b=Array.prototype.slice.call(arguments,1),e.apply(this,b)}else if(m(e)){b=Array.prototype.slice.call(arguments,1);var l=e.slice();e=l.length;for(a=0;a<e;a++)l[a].apply(this,b)}return!0};g.prototype.addListener=function(c,a){if(!h(a))throw TypeError("listener must be a function");this._events||(this._events={});this._events.newListener&&this.emit("newListener",c,h(a.listener)?a.listener:a);this._events[c]?m(this._events[c])?this._events[c].push(a):this._events[c]=[this._events[c],a]:
this._events[c]=a;m(this._events[c])&&!this._events[c].warned&&(a=void 0!==this._maxListeners?this._maxListeners:g.defaultMaxListeners)&&0<a&&this._events[c].length>a&&(this._events[c].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[c].length),"function"===typeof console.trace&&console.trace());return this};g.prototype.on=g.prototype.addListener;g.prototype.once=function(c,a){function b(){this.removeListener(c,
b);e||(e=!0,a.apply(this,arguments))}if(!h(a))throw TypeError("listener must be a function");var e=!1;b.listener=a;this.on(c,b);return this};g.prototype.removeListener=function(c,a){if(!h(a))throw TypeError("listener must be a function");if(!this._events||!this._events[c])return this;var b=this._events[c];var e=b.length;var l=-1;if(b===a||h(b.listener)&&b.listener===a)delete this._events[c],this._events.removeListener&&this.emit("removeListener",c,a);else if(m(b)){for(;0<e--;)if(b[e]===a||b[e].listener&&
b[e].listener===a){l=e;break}if(0>l)return this;1===b.length?(b.length=0,delete this._events[c]):b.splice(l,1);this._events.removeListener&&this.emit("removeListener",c,a)}return this};g.prototype.removeAllListeners=function(c){if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[c]&&delete this._events[c],this;if(0===arguments.length){for(a in this._events)"removeListener"!==a&&this.removeAllListeners(a);this.removeAllListeners("removeListener");
this._events={};return this}var a=this._events[c];if(h(a))this.removeListener(c,a);else if(a)for(;a.length;)this.removeListener(c,a[a.length-1]);delete this._events[c];return this};g.prototype.listeners=function(c){return this._events&&this._events[c]?h(this._events[c])?[this._events[c]]:this._events[c].slice():[]};g.prototype.listenerCount=function(c){if(this._events){c=this._events[c];if(h(c))return 1;if(c)return c.length}return 0};g.listenerCount=function(c,a){return c.listenerCount(a)}}])})})(N);
const S=J.getDefaultExportFromCjs(N.exports);H=function(q){function y(){return q.apply(this,arguments)||this}F._inheritsLoose(y,q);y.create=function(){var d=F._asyncToGenerator(function*(f,g,h,m,c){m=new y(m);try{yield m._load(f,g,h,c)}catch(a){if(!K.isAbortError(a))return new Q("invalid-resource",`Could not load PNG: ${a.message}`)}return m});return function(f,g,h,m,c){return d.apply(this,arguments)}}();y.prototype._loadAnimation=function(){var d=F._asyncToGenerator(function*(f,g,h){return L(f,g,
h)});return function(f,g,h){return d.apply(this,arguments)}}();return y}(H.BaseAnimatableTextureResource);const T=[137,80,78,71,13,10,26,10];D.APNG=H;D.isAnimatedPNG=function(q){if(!M(q))return!1;const y=new DataView(q);q=new Uint8Array(q);let d=8,f;do{const g=y.getUint32(d);f=String.fromCharCode.apply(String,Array.prototype.slice.call(q.subarray(d+4,d+8)));if("acTL"===f)return!0;d+=12+g}while("IEND"!==f&&d<q.length);return!1};D.isPNG=M;D.parseApng=L;Object.defineProperties(D,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})});