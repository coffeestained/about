// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/mat3 ../../../chunks/mat3f32 ../../../chunks/vec2f32 ./DisplayObject ./ImageryBitmapSource ../../webgl/enums ../../webgl/Texture".split(" "),function(l,n,w,g,x,m,p,y,h,z){function t(e){return e&&"render"in e}function u(e){const f=document.createElement("canvas");f.width=e.width;f.height=e.height;e.render(f.getContext("2d"));return f}function v(e,f,d){const a={target:h.TextureType.TEXTURE_2D,pixelFormat:h.PixelFormat.RGBA,
internalFormat:h.PixelFormat.RGBA,dataType:h.PixelType.UNSIGNED_BYTE,wrapMode:h.TextureWrapMode.CLAMP_TO_EDGE};f&&d&&(a.width=f,a.height=d);return new z.Texture(e,a)}p=function(e){function f(a=null,c,q=!0){var b=e.call(this)||this;b.requestRenderOnSourceChangedEnabled=q;b._textureInvalidated=!0;b.stencilRef=0;b.coordScale=[1,1];b._height=void 0;b.pixelRatio=1;b.resolution=0;b.rotation=0;b._source=null;b._width=void 0;b.x=0;b.y=0;b.blendFunction=c;b.source=a;b.requestRender=b.requestRender.bind(n._assertThisInitialized(b));
return b}n._inheritsLoose(f,e);var d=f.prototype;d.destroy=function(){this._texture&&(this._texture.dispose(),this._texture=null)};d.beforeRender=function(a){e.prototype.beforeRender.call(this,a);this.updateTexture(a.context)};d.invalidateTexture=function(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRenderOnSourceChangedEnabled&&this.requestRender())};d._createTransforms=function(){return{dvs:x.create()}};d.setTransform=function(a){const c=g.identity(this.transforms.dvs),[q,
b]=a.toScreenNoRotation([0,0],[this.x,this.y]);var k=this.resolution/this.pixelRatio/a.resolution;const r=k*this.width;k*=this.height;const A=Math.PI*this.rotation/180;g.translate(c,c,m.fromValues(q,b));g.translate(c,c,m.fromValues(r/2,k/2));g.rotate(c,c,-A);g.translate(c,c,m.fromValues(-r/2,-k/2));g.scaleByVec2(c,c,m.fromValues(r,k));g.multiply(this.transforms.dvs,a.displayViewMat3,c)};d.setSamplingProfile=function(a){this._texture&&(a.mips&&!this._texture.descriptor.hasMipmap&&this._texture.generateMipmap(),
this._texture.setSamplingMode(a.samplingMode))};d.bind=function(a,c){this._texture&&a.bindTexture(this._texture,c)};d.updateTexture=function(a){if(this.stage)this._textureInvalidated&&(this._textureInvalidated=!1,this._texture||(this._texture=this.source?v(a,this.sourceWidth,this.sourceHeight):v(a)),(a=this.source)?(this._texture.resize(this.sourceWidth,this.sourceHeight),t(a)?a instanceof y?(a=a.getRenderedRasterPixels(),this._texture.setData(w.isSome(a)?a.renderedRasterPixels:null)):this._texture.setData(u(a)):
!a||"render"in a||this._texture.setData(a),this.ready()):this._texture.setData(null));else{var c;null==(c=this._texture)?void 0:c.dispose();this._texture=null}};d.onAttach=function(){this.invalidateTexture()};d.onDetach=function(){this.invalidateTexture()};n._createClass(f,[{key:"isSourceScaled",get:function(){return this.width!==this.sourceWidth||this.height!==this.sourceHeight}},{key:"height",get:function(){return void 0!==this._height?this._height:this.sourceHeight},set:function(a){this._height=
a}},{key:"source",get:function(){return this._source},set:function(a){this._source=a;this.invalidateTexture()}},{key:"sourceHeight",get:function(){return this._source instanceof HTMLImageElement?this._source.naturalHeight:this._source.height}},{key:"sourceWidth",get:function(){return this._source instanceof HTMLImageElement?this._source.naturalWidth:this._source.width}},{key:"width",get:function(){return void 0!==this._width?this._width:this.sourceWidth},set:function(a){this._width=a}}]);return f}(p.DisplayObject);
l.Bitmap=p;l.isImageSource=t;l.rasterize=u;Object.defineProperties(l,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});