// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/events ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../DisplayObject ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/Texture ../../../webgl/VertexArrayObject ../../../webgl/capabilities/isWebGL2Context".split(" "),function(u,x,y,z,p,q,l,A,v,m,B,C,w){return function(t){function r(d){var a=t.call(this)||this;a.elementView=d;a.isWrapAround=
!1;a._vertices=new Float32Array(20);a._handles=[];a._handles.push(l.watch(()=>a.elementView.element.opacity,b=>a.opacity=b,l.initial),l.watch(()=>[a.elementView.coords],()=>{a.requestRender()},l.initial),l.when(()=>a.elementView.element.loaded,()=>{const b=a.elementView.element;a.ready();"video"===b.type&&q.isSome(b.content)&&a._handles.push(y.on(b.content,"play",()=>a.requestRender()))},l.initial));d.element.load().catch(b=>{z.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new x("element-load-error",
"Element cannot be displayed",{element:d,error:b}))});return a}u._inheritsLoose(r,t);var n=r.prototype;n.destroy=function(){var d;this._handles.forEach(a=>a.remove());null==(d=this.texture)?void 0:d.dispose();this.texture=null};n.beforeRender=function(d){const {context:a}=d,b=this.elementView.element.content;if(q.isSome(b)){var c=b instanceof HTMLImageElement;const g=b instanceof HTMLVideoElement,h=c?b.naturalWidth:g?b.videoWidth:b.width;c=c?b.naturalHeight:g?b.videoHeight:b.height;this.texture?g&&
!b.paused&&(this.texture.setData(b),this.requestRender(),(w(a.gl)||p.isPowerOfTwo(h)&&p.isPowerOfTwo(c))&&this.texture.generateMipmap()):(this.texture=new B.Texture(a,{pixelFormat:m.PixelFormat.RGBA,dataType:m.PixelType.UNSIGNED_BYTE,samplingMode:m.TextureSamplingMode.LINEAR,wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE,width:h,height:c},b),(w(a.gl)||p.isPowerOfTwo(h)&&p.isPowerOfTwo(c))&&this.texture.generateMipmap(),g&&!b.paused&&this.requestRender())}t.prototype.beforeRender.call(this,d)};n._createTransforms=
function(){return null};n.updateDrawCoords=function(d,a){var b=this.elementView.coords;if(!q.isNone(b)){var [c,g,h,k]=b.rings[0];b=this._vertices;var {x:e,y:f}=d;(d=0!==a)?b.set([g[0]-e,g[1]-f,c[0]-e,c[1]-f,h[0]-e,h[1]-f,k[0]-e,k[1]-f,k[0]-e,k[1]-f,g[0]+a-e,g[1]-f,g[0]+a-e,g[1]-f,c[0]+a-e,c[1]-f,h[0]+a-e,h[1]-f,k[0]+a-e,k[1]-f]):b.set([g[0]-e,g[1]-f,c[0]-e,c[1]-f,h[0]-e,h[1]-f,k[0]-e,k[1]-f]);this.isWrapAround=d}};n.getVAO=function(d,a,b){if(q.isNone(this.elementView.coords))return null;var c=this._vertices;
this._vao?this._geometryVbo.setData(c):(this._geometryVbo=v.BufferObject.createVertex(d,m.Usage.DYNAMIC_DRAW,c),c=v.BufferObject.createVertex(d,m.Usage.STATIC_DRAW,new Uint16Array([0,0,0,1,1,0,1,1,1,1,0,0,0,0,0,1,1,0,1,1])),this._vao=new C.VertexArrayObject(d,b,a,{geometry:this._geometryVbo,tex:c}));return this._vao};u._createClass(r,[{key:"dvsMat3",get:function(){return this.parent.dvsMat3}}]);return r}(A.DisplayObject)});