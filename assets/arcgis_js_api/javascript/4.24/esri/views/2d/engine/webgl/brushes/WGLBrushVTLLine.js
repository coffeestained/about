// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../vectorTiles/style/StyleDefinition ../definitions ../enums ../number ./WGLBrush ../../../../webgl/enums".split(" "),function(C,J,p,K,u,L,M,y,l){y=function(D){function z(){var b=D.apply(this,arguments)||this;b._programOptions={id:!1,pattern:!1,sdf:!1};return b}J._inheritsLoose(z,D);var E=z.prototype;E.dispose=function(){};E.drawMany=function(b,e){const {context:g,displayLevel:m,state:A,drawPhase:N,painter:O,
pixelRatio:F,spriteMosaic:n,styleLayerUID:v,requestRender:G}=b;if(e.some(f=>{var q,r;return null!=(q=null==(r=f.layerData.get(v))?void 0:r.lineIndexCount)?q:!1})){b=b.styleLayer;var H=b.lineMaterial,P=O.vectorTilesMaterialManager,d=b.getPaintValue("line-translate",m),c=b.getPaintValue("line-translate-anchor",m),h=b.getPaintProperty("line-pattern"),w=void 0!==h,I=w&&h.isDataDriven;if(w&&!I){h=h.getValue(m);var k=n.getMosaicItemPosition(h)}var a;h=!1;if(!w){var t=b.getPaintProperty("line-dasharray");
h=(a=void 0!==t)&&t.isDataDriven;a&&!h&&(k=t.getValue(m),k=b.getDashKey(k,b.getLayoutValue("line-cap",m)),k=n.getMosaicItemPosition(k))}t=1/F;var B=N===L.WGLDrawPhase.HITTEST,x=this._programOptions;x.id=B;x.pattern=w;x.sdf=a;a=P.getMaterialProgram(g,H,x);if(!p.isSome(G)||B||a.isCompiled){g.useProgram(a);a.setUniformMatrix3fv("u_displayViewMat3",A.displayViewMat3);a.setUniformMatrix3fv("u_displayMat3",c===K.TranslateAnchor.VIEWPORT?A.displayMat3:A.displayViewMat3);a.setUniform2fv("u_lineTranslation",
d);a.setUniform1f("u_depth",b.z);a.setUniform1f("u_antialiasing",t);B&&(d=M.u32to4Xu8(v+1),a.setUniform4fv("u_id",d));k&&p.isSome(k)&&({page:d}=k,c=n.getPageSize(d),p.isSome(c)&&(n.bind(g,l.TextureSamplingMode.LINEAR,d,u.VTL_TEXTURE_BINDING_UNIT_SPRITES),a.setUniform2fv("u_mosaicSize",c),a.setUniform1i("u_texture",u.VTL_TEXTURE_BINDING_UNIT_SPRITES)));d=-1;for(const f of e)if(f.layerData.has(v)&&(f.key.level!==d&&(d=f.key.level,H.setDataUniforms(a,m,b,d,n)),a.setUniform1f("u_zoomFactor",2**(m-d)/
F),e=f.layerData.get(v),e.lineIndexCount&&(e.prepareForRendering(g),c=e.lineVertexArrayObject,!p.isNone(c)))){g.bindVAO(c);a.setUniformMatrix3fv("u_dvsMat3",f.transforms.dvs);g.setStencilFunction(l.CompareFunction.EQUAL,f.stencilRef,255);if(I||h){c=e.patternMap;if(!c)continue;for(const [q,r]of c)c=n.getPageSize(q),p.isSome(c)&&(n.bind(g,l.TextureSamplingMode.LINEAR,q,u.VTL_TEXTURE_BINDING_UNIT_SPRITES),a.setUniform2fv("u_mosaicSize",c),a.setUniform1i("u_texture",u.VTL_TEXTURE_BINDING_UNIT_SPRITES),
g.drawElements(l.PrimitiveType.TRIANGLES,r[1],l.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*r[0]))}else g.drawElements(l.PrimitiveType.TRIANGLES,e.lineIndexCount,l.DataType.UNSIGNED_INT,Uint32Array.BYTES_PER_ELEMENT*e.lineIndexStart);f.triangleCount+=e.lineIndexCount/3}}else G()}};return z}(y);C.WGLBrushVTLLine=y;Object.defineProperties(C,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});