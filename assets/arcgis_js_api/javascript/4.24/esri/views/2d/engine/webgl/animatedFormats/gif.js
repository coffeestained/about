// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Error ../../../../../core/promiseUtils ../../../../../core/time ../../../../../geometry/support/meshUtils/exporters/gltf/imageutils ./BaseAnimatableTextureResource".split(" "),function(x,B,Q,R,S,T,G){function K(m,d,c){return H.apply(this,arguments)}function H(){H=B._asyncToGenerator(function*(m,d,c){m=L(m);var e=M(m,!0);const {width:f,height:a}=m.lsd;m=document.createElement("canvas");m.width=f;m.height=a;m=m.getContext("2d");
const k=[];c=[];for(const g of e){c.push(S.Milliseconds(g.delay));e=new ImageData(g.patch,g.dims.width,g.dims.height);var b=T.imageTypeToCanvas(e);e=3===g.disposalType&&m.getImageData(g.dims.left,g.dims.top,g.dims.width,g.dims.height);m.drawImage(b,g.dims.left,g.dims.top);b=m.getImageData(0,0,f,a);k.push(b);1!==g.disposalType&&(2===g.disposalType?m.clearRect(g.dims.left,g.dims.top,g.dims.width,g.dims.height):3===g.disposalType&&m.putImageData(e,g.dims.left,g.dims.top))}return{frameDurations:c,selectFrame:g=>
{d(k[g])},width:f,height:a}});return H.apply(this,arguments)}function N(m){const d=new Uint8Array(m);return!U.some((c,e)=>c!==d[e])}var t={},y={},p={};Object.defineProperty(p,"__esModule",{value:!0});p.loop=p.conditional=p.parse=void 0;p.parse=function e(d,c){var f=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:f;if(Array.isArray(c))c.forEach(function(b){return e(d,b,f,a)});else if("function"===typeof c)c(d,f,a,e);else{var k=Object.keys(c)[0];
Array.isArray(c[k])?(a[k]={},e(d,c[k],f,a[k])):a[k]=c[k](d,f,a,e)}return f};p.conditional=function(d,c){return function(e,f,a,k){c(e,f,a)&&k(e,d,f,a)}};p.loop=function(d,c){return function(e,f,a,k){for(var b=[],g=e.pos;c(e,f,a);){var l={};k(e,d,f,l);if(e.pos===g)break;g=e.pos;b.push(l)}return b}};var h={};Object.defineProperty(h,"__esModule",{value:!0});h.readBits=h.readArray=h.readUnsigned=h.readString=h.peekBytes=h.readBytes=h.peekByte=h.readByte=h.buildStream=void 0;h.buildStream=function(d){return{data:d,
pos:0}};var O=function(){return function(d){return d.data[d.pos++]}};h.readByte=O;h.peekByte=function(){var d=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return function(c){return c.data[c.pos+d]}};var C=function(d){return function(c){return c.data.subarray(c.pos,c.pos+=d)}};h.readBytes=C;h.peekBytes=function(d){return function(c){return c.data.subarray(c.pos,c.pos+d)}};h.readString=function(d){return function(c){return Array.from(C(d)(c)).map(function(e){return String.fromCharCode(e)}).join("")}};
h.readUnsigned=function(d){return function(c){c=C(2)(c);return d?(c[1]<<8)+c[0]:(c[0]<<8)+c[1]}};h.readArray=function(d,c){return function(e,f,a){f="function"===typeof c?c(e,f,a):c;a=C(d);for(var k=Array(f),b=0;b<f;b++)k[b]=a(e);return k}};h.readBits=function(d){return function(c){c=O()(c);for(var e=Array(8),f=0;8>f;f++)e[7-f]=!!(c&1<<f);return Object.keys(d).reduce(function(a,k){var b=d[k];if(b.length){for(var g=b.length,l=0,n=0;n<g;n++)l+=e[b.index+n]&&Math.pow(2,g-n-1);a[k]=l}else a[k]=e[b.index];
return a},{})}};(function(d){Object.defineProperty(d,"__esModule",{value:!0});d["default"]=void 0;var c={blocks:function(b){for(var g=[],l=b.data.length,n=0,q=(0,h.readByte)()(b);0!==q&&q;q=(0,h.readByte)()(b)){if(b.pos+q>=l){l-=b.pos;g.push((0,h.readBytes)(l)(b));n+=l;break}g.push((0,h.readBytes)(q)(b));n+=q}b=new Uint8Array(n);for(l=n=0;l<g.length;l++)b.set(g[l],n),n+=g[l].length;return b}},e=(0,p.conditional)({gce:[{codes:(0,h.readBytes)(2)},{byteSize:(0,h.readByte)()},{extras:(0,h.readBits)({future:{index:0,
length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,h.readUnsigned)(!0)},{transparentColorIndex:(0,h.readByte)()},{terminator:(0,h.readByte)()}]},function(b){b=(0,h.peekBytes)(2)(b);return 33===b[0]&&249===b[1]}),f=(0,p.conditional)({image:[{code:(0,h.readByte)()},{descriptor:[{left:(0,h.readUnsigned)(!0)},{top:(0,h.readUnsigned)(!0)},{width:(0,h.readUnsigned)(!0)},{height:(0,h.readUnsigned)(!0)},{lct:(0,h.readBits)({exists:{index:0},interlaced:{index:1},
sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,p.conditional)({lct:(0,h.readArray)(3,function(b,g,l){return Math.pow(2,l.descriptor.lct.size+1)})},function(b,g,l){return l.descriptor.lct.exists}),{data:[{minCodeSize:(0,h.readByte)()},c]}]},function(b){return 44===(0,h.peekByte)()(b)}),a=(0,p.conditional)({text:[{codes:(0,h.readBytes)(2)},{blockSize:(0,h.readByte)()},{preData:function(b,g,l){return(0,h.readBytes)(l.text.blockSize)(b)}},c]},function(b){b=(0,h.peekBytes)(2)(b);
return 33===b[0]&&1===b[1]}),k=(0,p.conditional)({application:[{codes:(0,h.readBytes)(2)},{blockSize:(0,h.readByte)()},{id:function(b,g,l){return(0,h.readString)(l.blockSize)(b)}},c]},function(b){b=(0,h.peekBytes)(2)(b);return 33===b[0]&&255===b[1]});c=(0,p.conditional)({comment:[{codes:(0,h.readBytes)(2)},c]},function(b){b=(0,h.peekBytes)(2)(b);return 33===b[0]&&254===b[1]});e=[{header:[{signature:(0,h.readString)(3)},{version:(0,h.readString)(3)}]},{lsd:[{width:(0,h.readUnsigned)(!0)},{height:(0,
h.readUnsigned)(!0)},{gct:(0,h.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,h.readByte)()},{pixelAspectRatio:(0,h.readByte)()}]},(0,p.conditional)({gct:(0,h.readArray)(3,function(b,g){return Math.pow(2,g.lsd.gct.size+1)})},function(b,g){return g.lsd.gct.exists}),{frames:(0,p.loop)([e,k,c,f,a],function(b){b=(0,h.peekByte)()(b);return 33===b||44===b})}];d["default"]=e})(y);var D={};Object.defineProperty(D,"__esModule",{value:!0});
D.deinterlace=void 0;D.deinterlace=function(d,c){for(var e=Array(d.length),f=d.length/c,a=[0,4,2,1],k=[8,8,4,2],b=0,g=0;4>g;g++)for(var l=a[g];l<f;l+=k[g]){var n=l,q=d.slice(b*c,(b+1)*c);e.splice.apply(e,[n*c,c].concat(q));b++}return e};var E={};Object.defineProperty(E,"__esModule",{value:!0});E.lzw=void 0;E.lzw=function(d,c,e){var f,a,k,b,g,l,n,q,I=Array(e),J=Array(4096),z=Array(4096),A=Array(4097);var v=1<<d;var V=v+1;var r=v+2;var w=-1;var u=d+1;var F=(1<<u)-1;for(a=0;a<v;a++)J[a]=0,z[a]=a;for(k=
b=f=g=l=q=n=0;k<e;){if(0===l){if(f<u){b+=c[n]<<f;f+=8;n++;continue}a=b&F;b>>=u;f-=u;if(a>r||a==V)break;if(a==v){u=d+1;F=(1<<u)-1;r=v+2;w=-1;continue}if(-1==w){A[l++]=z[a];g=w=a;continue}var W=a;a==r&&(A[l++]=g,a=w);for(;a>v;)A[l++]=z[a],a=J[a];g=z[a]&255;A[l++]=g;4096>r&&(J[r]=w,z[r]=g,r++,0===(r&F)&&4096>r&&(u++,F+=r));w=W}l--;I[q++]=A[l];k++}for(k=q;k<e;k++)I[k]=0;return I};Object.defineProperty(t,"__esModule",{value:!0});var M=t.decompressFrames=t.decompressFrame=L=t.parseGIF=void 0,X=y&&y.__esModule?
y:{default:y},L=t.parseGIF=function(d){d=new Uint8Array(d);return(0,p.parse)((0,h.buildStream)(d),X["default"])},P=function(d,c,e){if(d.image){var f=d.image,a=f.descriptor.width*f.descriptor.height;a=(0,E.lzw)(f.data.minCodeSize,f.data.blocks,a);f.descriptor.lct.interlaced&&(a=(0,D.deinterlace)(a,f.descriptor.width));a={pixels:a,dims:{top:d.image.descriptor.top,left:d.image.descriptor.left,width:d.image.descriptor.width,height:d.image.descriptor.height}};a.colorTable=f.descriptor.lct&&f.descriptor.lct.exists?
f.lct:c;d.gce&&(a.delay=10*(d.gce.delay||10),a.disposalType=d.gce.extras.disposal,d.gce.extras.transparentColorGiven&&(a.transparentIndex=d.gce.transparentColorIndex));if(e){d=a.pixels.length;c=new Uint8ClampedArray(4*d);for(e=0;e<d;e++){f=4*e;var k=a.pixels[e],b=a.colorTable[k]||[0,0,0];c[f]=b[0];c[f+1]=b[1];c[f+2]=b[2];c[f+3]=k!==a.transparentIndex?255:0}a.patch=c}return a}console.warn("gif frame does not have associated image.")};t.decompressFrame=P;M=t.decompressFrames=function(d,c){return d.frames.filter(function(e){return e.image}).map(function(e){return P(e,
d.gct,c)})};G=function(d){function c(){return d.apply(this,arguments)||this}B._inheritsLoose(c,d);c.create=function(){var e=B._asyncToGenerator(function*(f,a,k,b,g){b=new c(b);try{yield b._load(f,a,k,g)}catch(l){if(!R.isAbortError(l))return new Q("invalid-resource",`Could not load GIF: ${l.message}`)}return b});return function(f,a,k,b,g){return e.apply(this,arguments)}}();c.prototype._loadAnimation=function(){var e=B._asyncToGenerator(function*(f,a,k){return K(f,a,k)});return function(f,a,k){return e.apply(this,
arguments)}}();return c}(G.BaseAnimatableTextureResource);const U=[71,73,70];x.GIF=G;x.isAnimatedGIF=function(d){function c(){k++;a+=8;const g=f.getUint8(a++);a+=g&128?3*2**((g&7)+1):0;a++;e()}function e(){let g;for(;g=f.getUint8(a++);)a+=g}if(!N(d))return!1;const f=new DataView(d);d=f.getUint8(10);let a=13+(d&128?3*2**((d&7)+1):0),k=0;for(d=!1;!d;){switch(f.getUint8(a++)){case 33:a:{switch(f.getUint8(a++)){case 249:a++;a+=4;e();break;case 1:k++;a++;a+=12;e();break;case 254:e();break;case 255:a++;
a+=8;a+=3;e();break;default:var b=!1;break a}b=!0}if(!b)return!1;break;case 44:c();break;case 59:d=!0;break;default:return!1}if(1<k)return!0}return!1};x.isGIF=N;x.parseGif=K;Object.defineProperties(x,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});