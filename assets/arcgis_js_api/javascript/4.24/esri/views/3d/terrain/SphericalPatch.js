// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/frustum ../../../geometry/support/plane ./interfaces ./PatchGeometryFactory ./Tile".split(" "),function(f,y,v,g,w,n,z,q,A,m,r,t){t=function(k){function u(b,a,e){var c=k.call(this)||this;c.obb=Array(8);for(let d=0;8>d;d++)c.obb[d]=w.create();void 0!==b&&c.init(b,a,e);return c}y._inheritsLoose(u,
k);var l=u.prototype;l.init=function(b,a,e){k.prototype.init.call(this,b,a,e);a=this.ellipsoid.radius;e=this.extentInRadians[0];const c=this.extentInRadians[1],d=this.extentInRadians[2],h=this.extentInRadians[3];b=b[0];const B=v.lerp(c,h,.5),C=v.lerp(e,d,.5);this._edgeLen=(d-e)*Math.cos(0===b?0:Math.min(Math.abs(c),Math.abs(h)))*a;this._edgeLen2=this._edgeLen*this._edgeLen;this._curvatureHeight=a-Math.sqrt(a*a-this._edgeLen2/4);n.lonLatToSphericalPCPF(this.centerAtSeaLevel,C,B,this.ellipsoid.radius);
a=w.fromArray(this.centerAtSeaLevel);g.normalize(a,a);this.up=a;this._updateOBB();this.updateRadiusAndCenter()};l.updateRadiusAndCenter=function(){if(0===this.lij[0])g.set(this._center[f.CenterPosition.MIDDLE],0,0,0),g.set(this._center[f.CenterPosition.TOP],0,0,0),g.set(this._center[f.CenterPosition.BOTTOM],0,0,0),this.ellipsoid||(this.ellipsoid=z.getReferenceEllipsoid(this.surface.spatialReference)),this._center[f.CenterPosition.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();
const b=Math.max(g.squaredDistance(this._center[f.CenterPosition.MIDDLE],this.obb[0]),g.squaredDistance(this._center[f.CenterPosition.MIDDLE],this.obb[1]));this._center[f.CenterPosition.MIDDLE][3]=Math.sqrt(b)}};l._isVisible=function(b){if(!q.intersectsSphere(b,this._center[f.CenterPosition.MIDDLE]))return!1;if(10>this.lij[0])return!0;const a=this.obb;for(let d=0;d<q.NumPlanes.NUM;d++){var e=d===q.PlaneIndex.NEAR,c=b[d];e&&(p[0]=c[0],p[1]=c[1],p[2]=c[2],p[3]=c[3]-this.surface.view.state.camera.near);
e=e?p:c;for(c=0;8>c;c++){const h=a[c];if(0>e[0]*h[0]+e[1]*h[1]+e[2]*h[2]+e[3])break}if(8===c)return!1}return!0};l.computeElevationBounds=function(){k.prototype.computeElevationBounds.call(this);this._updateOBB()};l.createGeometry=function(){const b=this._getPatchType(this.lij[1],this.lij[0]);r.createSphericalGlobePatch(this.renderData,b);this.setMemoryDirty()};l._updateOBB=function(){const b=this.extentInRadians,a=this.obb;for(let e=0;2>e;e++){const c=this.elevationBounds[e];let d=4*e;n.lonLatToSphericalPCPF(a[d++],
b[0],b[1],this.ellipsoid.radius+c);n.lonLatToSphericalPCPF(a[d++],b[0],b[3],this.ellipsoid.radius+c);n.lonLatToSphericalPCPF(a[d++],b[2],b[3],this.ellipsoid.radius+c);n.lonLatToSphericalPCPF(a[d++],b[2],b[1],this.ellipsoid.radius+c)}if(this.surface.isWebMercator)switch(this._getPatchType(this.lij[1],this.lij[0])){case m.PatchType.HAS_NORTH_POLE:g.set(a[1],0,0,this.ellipsoid.radius);g.set(a[2],0,0,this.ellipsoid.radius);g.set(a[5],0,0,this.ellipsoid.radius);g.set(a[6],0,0,this.ellipsoid.radius);break;
case m.PatchType.HAS_SOUTH_POLE:g.set(a[0],0,0,-this.ellipsoid.radius),g.set(a[3],0,0,-this.ellipsoid.radius),g.set(a[4],0,0,-this.ellipsoid.radius),g.set(a[7],0,0,-this.ellipsoid.radius)}};l._getPatchType=function(b,a){return b===(1<<a)-1?0===b?m.PatchType.HAS_BOTH_POLES:m.PatchType.HAS_SOUTH_POLE:0===b?m.PatchType.HAS_NORTH_POLE:m.PatchType.REGULAR};l.intersectsRay=function(b,a,e,c){var d=this._center[f.CenterPosition.MIDDLE];e=d[3]+e;var h=d[0]-b[0];c=d[1]-b[1];b=d[2]-b[2];d=(h*a[0]+c*a[1]+b*a[2])/
(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]);h=a[0]*d-h;c=a[1]*d-c;a=a[2]*d-b;return h*h+c*c+a*a<e*e};l.getDefaultVerticesPerRowOnLevel=function(){return this.level<x.length?x[this.level]+1:2};l.updateCornerElevations=function(){r.updateCornerElevationsSpherical(this.renderData)};l.updateEdgeElevations=function(){r.updateEdgesElevationsSpherical(this.renderData)};return u}(t.Tile);const x=[128,64,32,16,16,8,8,4],p=A.create();f.CenterPosition=void 0;(function(k){k[k.TOP=0]="TOP";k[k.MIDDLE=1]="MIDDLE";k[k.BOTTOM=
2]="BOTTOM"})(f.CenterPosition||(f.CenterPosition={}));f.SphericalPatch=t;Object.defineProperties(f,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});