// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Color ../../../../core/Accessor ../../../../core/Handles ../../../../core/handleUtils ../../../../core/lang ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../interactive/visualElements/LineVisualElement ../../interactive/visualElements/PointVisualElement".split(" "),
function(f,F,m,e,J,K,L,M,k,v,p,W,N,O,z,g,A,G){f.LineOfSightVisualization=function(H){function w(a){a=H.call(this,a)||this;a._lineOfSightVisualizations=[];a._computationHandles=new K;return a}F._inheritsLoose(w,H);var h=w.prototype;h.initialize=function(){this.own(this._connectComputations());this._createObserverVisualization()};h.destroy=function(){this._computationHandles=k.destroyMaybe(this._computationHandles);this._observerVisualElement=k.destroyMaybe(this._observerVisualElement)};h._createLineOfSightVisualization=
function(){var a=this._configuration,b=this.view,c={view:b,attached:!0,width:a.outerWidth,innerWidth:a.innerWidth},d=e.toUnitRGBA(a.visibleOuterColor);const t=e.toUnitRGBA(a.visibleInnerColor);var u=e.toUnitRGBA(a.occludedOuterColor);const B=e.toUnitRGBA(a.occludedInnerColor),C=e.toUnitRGBA(a.undefinedOuterColor);a=e.toUnitRGBA(a.undefinedInnerColor);d=new A.LineVisualElement({...c,color:d,innerColor:t});u=new A.LineVisualElement({...c,color:u,innerColor:B});c=new A.LineVisualElement({...c,color:C,
innerColor:a});b=new G.PointVisualElement({view:b,attached:!0,...I,size:8});b={visibleLineVisualElement:d,occludedLineVisualElement:u,undefinedLineVisualElement:c,targetVisualElement:b};this._lineOfSightVisualizations.push(b);return b};h._destroyLineOfSightVisualization=function(a){a.visibleLineVisualElement=k.destroyMaybe(a.visibleLineVisualElement);a.occludedLineVisualElement=k.destroyMaybe(a.occludedLineVisualElement);a.undefinedLineVisualElement=k.destroyMaybe(a.undefinedLineVisualElement);a.targetVisualElement=
k.destroyMaybe(a.targetVisualElement);this._lineOfSightVisualizations.splice(this._lineOfSightVisualizations.indexOf(a),1)};h._updateLineOfSightVisualization=function(a,b,c){const d=this._configuration,{computationResult:t,inputPoints:u}=a,{start:B,end:C,intersection:P,isValid:Q,isTargetVisible:R}=t;var {observer:l}=u;const q=S;q[12]=l[0];q[13]=l[1];q[14]=l[2];const D=z.subtract(T,B,l),E=z.subtract(U,C,l);l=z.subtract(V,P,l);const {visibleLineVisualElement:n,occludedLineVisualElement:x,undefinedLineVisualElement:y,
targetVisualElement:r}=b;b=k.isNone(this.analysisViewData.elevationAlignedObserver)||k.isNone(a.elevationAlignedTargetLocation);b=this.visible&&!b;n.visible=b;x.visible=b;y.visible=b;r.visible=b;r.attached=!c.interactiveAndEditable;b&&(n.geometry=null,x.geometry=null,y.geometry=null,r.geometry=a.elevationAlignedTargetLocation,Q?R?(n.geometry=[[g.fromArray(D),g.fromArray(E)]],n.transform=q,n.color=e.toUnitRGBA(d.visibleOuterColor),r.color=e.toUnitRGBA(d.visibleInnerColor)):(n.geometry=[[g.fromArray(D),
g.fromArray(l)]],n.transform=q,n.color=e.toUnitRGBA(d.occludedOuterColor),x.geometry=[[g.fromArray(l),g.fromArray(E)]],x.transform=q,r.color=e.toUnitRGBA(d.occludedInnerColor)):(y.geometry=[[g.fromArray(D),g.fromArray(E)]],y.transform=q,r.color=e.toUnitRGBA(d.undefinedInnerColor)))};h._getLineOfSightVisualizationDependencies=function(a){({computationResult:a}=a);const {occludedOuterColor:b,visibleOuterColor:c}=this._configuration;return{computationResult:a,occludedOuterColor:b,visibleOuterColor:c,
visible:this.visible,interactiveAndEditable:this.interactiveAndEditable}};h._connectComputation=function(a){const b=this._computationHandles;if(!b.has(a)){var c=this._createLineOfSightVisualization();b.add([v.watch(()=>this._getLineOfSightVisualizationDependencies(a),d=>this._updateLineOfSightVisualization(a,c,d),{sync:!0,initial:!0,equals:M.equals}),L.makeHandle(()=>this._destroyLineOfSightVisualization(c))],a)}};h._disconnectComputation=function(a){this._computationHandles.remove(a)};h._connectComputations=
function(){return v.on(()=>this.analysisViewData.computations,"change",a=>this._onComputationsCollectionChange(a),{sync:!0,onListenerAdd:a=>{for(const b of a)this._connectComputation(b)},onListenerRemove:a=>{for(const b of a)this._disconnectComputation(b)}})};h._onComputationsCollectionChange=function({added:a,removed:b}){for(const c of b)this._disconnectComputation(c);for(const c of a)this._connectComputation(c)};h._createObserverVisualization=function(){const a=e.toUnitRGBA(this._configuration.visibleInnerColor),
b=new G.PointVisualElement({view:this.view,attached:!1,color:a,...I});this._observerVisualElement=b;this.own(v.watch(()=>({observer:this.analysisViewData.elevationAlignedObserver,interactiveAndEditable:this.interactiveAndEditable,visible:this.visible}),({observer:c,interactiveAndEditable:d,visible:t})=>{k.isNone(c)||d||!t?b.attached=!1:(b.geometry=c,this._observerVisualElement.attached=!0)},v.initial))};F._createClass(w,[{key:"visible",get:function(){return this.analysisViewData.visible}},{key:"interactiveAndEditable",
get:function(){return this.analysisViewData.interactive&&this.analysisViewData.editable}},{key:"testInfo",get:function(){return{visualizations:this._lineOfSightVisualizations}}},{key:"_configuration",get:function(){return this.analysisViewData.configuration}}]);return w}(J);m.__decorate([p.property({constructOnly:!0})],f.LineOfSightVisualization.prototype,"analysis",void 0);m.__decorate([p.property({constructOnly:!0})],f.LineOfSightVisualization.prototype,"analysisViewData",void 0);m.__decorate([p.property({constructOnly:!0})],
f.LineOfSightVisualization.prototype,"view",void 0);m.__decorate([p.property({readOnly:!0})],f.LineOfSightVisualization.prototype,"visible",null);m.__decorate([p.property()],f.LineOfSightVisualization.prototype,"interactiveAndEditable",null);m.__decorate([p.property()],f.LineOfSightVisualization.prototype,"testInfo",null);m.__decorate([p.property()],f.LineOfSightVisualization.prototype,"_configuration",null);f.LineOfSightVisualization=m.__decorate([N.subclass("esri.views.3d.analysis.LineOfSight.LineOfSightVisualization")],
f.LineOfSightVisualization);const I={size:6,pixelSnappingEnabled:!1,primitive:"circle",elevationInfo:{mode:"absolute-height",offset:0},outlineSize:0},T=g.create(),U=g.create(),V=g.create(),S=O.create();Object.defineProperties(f,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});