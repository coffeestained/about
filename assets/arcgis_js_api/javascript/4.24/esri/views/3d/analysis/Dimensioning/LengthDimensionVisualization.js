// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/handleUtils ../../../../core/maybe ../../../../core/quantityUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/Axis ../../../../geometry/support/vectorStacks ../../../../intl/number ./settings ../../interactive/visualElements/LabelVisualElement ../../interactive/visualElements/LineVisualElement ../../interactive/visualElements/support/Segment ../../webgl-engine/lib/Material ../../webgl-engine/materials/lineStippleUtils".split(" "),
function(n,A,w,D,t,x,E,p,B,P,Q,R,F,c,y,G,H,u,I,C,J,z,r,K,L){function M(k,g,f,b=0){g=c.dot(g,f);k=c.dot(k,f);f=Math.abs(g-k)+b;return g>k?[f,b]:[b,f]}n.LengthDimensionVisualization=function(k){function g(b){var a=k.call(this,b)||this;a._directSegment=new r.EuclideanSegment;a._dimensionSegment=new r.EuclideanSegment;a._offsetAxis=y.create();a._startOffsetSegment=new r.EuclideanSegment(a._directSegment.startRenderSpace,a._dimensionSegment.startRenderSpace);a._endOffsetSegment=new r.EuclideanSegment(a._directSegment.endRenderSpace,
a._dimensionSegment.endRenderSpace);a._labelSegment=new r.EuclideanSegment;a._hasValidGeometry=!1;const d={view:b.view,attached:!0,width:1,color:G.fromValues(1,.5,0,1),renderOccluded:K.RenderOccludedFlag.OccludeAndTransparent},e={...d,stipplePattern:L.createStipplePatternSimple(5)};a._dimensionVisualElement=new z.LineVisualElement(d);a._startOffsetVisualElement=new z.LineVisualElement(e);a._endOffsetVisualElement=new z.LineVisualElement(e);a._label=new J.LabelVisualElement({view:b.view,attached:!0,
distance:0,fontSize:C.settings.labels.fontSize});return a}A._inheritsLoose(g,k);var f=g.prototype;f.initialize=function(){this.own([t.destroyHandle(this._dimensionVisualElement),t.destroyHandle(this._startOffsetVisualElement),t.destroyHandle(this._endOffsetVisualElement),t.destroyHandle(this._label)]);const {computation:b,view:a}=this,{dimension:d}=b;this.own([p.watch(()=>({startPoint:d.startPoint,endPoint:d.endPoint,offset:d.offset,axis:d.axis,heading:d.heading}),e=>{this._updateGeometry(e);this._updateLines();
this._updateLabelGeometry(a.state.camera)},p.initial),p.watch(()=>b.length,e=>this._updateLabelContent(e),p.initial),p.watch(()=>a.state.camera,e=>this._updateLabelGeometry(e),p.initial)])};f._updateGeometry=function({startPoint:b,endPoint:a,offset:d,axis:e}){const {renderCoordsHelper:h}=this.view,q=this._directSegment;if(x.isNone(b)||x.isNone(a)||!h.toRenderCoords(b,q.startRenderSpace)||!h.toRenderCoords(a,q.endRenderSpace))this._hasValidGeometry=!1;else{var {startRenderSpace:l,endRenderSpace:m}=
q;a=q.eval(.5,u.sv3d.get());b=h.worldUpAtPosition(a,u.sv3d.get());var v=h.worldBasisAtPosition(a,H.Axis.X,u.sv3d.get());a=this._offsetAxis;a:switch(e){case "horizontal":c.copy(a,b);break a;case "vertical":c.dot(l,b)<c.dot(m,b)?c.sub(a,m,l):c.sub(a,l,m);c.cross(a,a,b);if(c.equals(a,y.ZEROS)){c.copy(a,v);break a}c.cross(a,a,b);c.normalize(a,a);break a;case "direct":c.dot(l,v)>c.dot(m,v)?c.sub(a,m,l):c.sub(a,l,m),c.cross(a,a,b),c.equals(a,y.ZEROS)?c.copy(a,v):c.normalize(a,a)}var [N,O]=M(l,m,a,d/h.unitInMeters);
d=this._dimensionSegment;c.scaleAndAdd(d.startRenderSpace,q.startRenderSpace,a,N);c.scaleAndAdd(d.endRenderSpace,q.endRenderSpace,a,O);this._hasValidGeometry=!0}};f._updateLines=function(){this._hasValidGeometry?(this._dimensionVisualElement.setGeometryFromSegment(this._dimensionSegment),this._startOffsetVisualElement.setGeometryFromSegment(this._startOffsetSegment),this._endOffsetVisualElement.setGeometryFromSegment(this._endOffsetSegment),this._dimensionVisualElement.visible=!0,this._startOffsetVisualElement.visible=
!0,this._endOffsetVisualElement.visible=!0):(this._dimensionVisualElement.visible=!1,this._startOffsetVisualElement.visible=!1,this._endOffsetVisualElement.visible=!1)};f._updateLabelContent=function(b){x.isNone(b)||!this._hasValidGeometry?(this._label.text="",this._label.visible=!1):({value:b}=E.toUnit(b,"meters"),this._label.text=`${I.formatNumber(b,{minimumFractionDigits:2,maximumFractionDigits:2})} m`,this._label.visible=!0)};f._updateLabelGeometry=function(b){if(this._hasValidGeometry){var {offset:a}=
this.computation.dimension,d=b.computeRenderPixelSizeAt(this._dimensionSegment.eval(.5,u.sv3d.get()));b=this._labelSegment;var e=this._dimensionSegment,h=this._offsetAxis;a=(0<=Math.sign(a)?1:-1)*C.settings.labels.offset*d;c.scaleAndAdd(b.startRenderSpace,e.startRenderSpace,h,a);c.scaleAndAdd(b.endRenderSpace,e.endRenderSpace,h,a);this._label.geometry={type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1}}else this._label.visible=!1};A._createClass(g,[{key:"testInfo",get:function(){return{dimensionVisualElement:this._dimensionVisualElement,
label:this._label}}}]);return g}(D);w.__decorate([B.property({constructOnly:!0,nonNullable:!0})],n.LengthDimensionVisualization.prototype,"computation",void 0);w.__decorate([B.property({constructOnly:!0,nonNullable:!0})],n.LengthDimensionVisualization.prototype,"view",void 0);n.LengthDimensionVisualization=w.__decorate([F.subclass("esri.views.3d.analysis.Dimensioning.LengthDimensionVisualization")],n.LengthDimensionVisualization);Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});