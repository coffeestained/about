// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../intl ../../../../core/Accessor ../../../../core/Handles ../../../../core/mathUtils ../../../../core/maybe ../../../../core/quantityFormatUtils ../../../../core/quantityUtils ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/unitUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f32 ../interfaces ./interfaces ../support/viewUtils ../../interactive/visualElements/LabelVisualElement ../../interactive/visualElements/LineVisualElement ../../interactive/visualElements/MeasurementArrowVisualElement ../../interactive/visualElements/RightAngleQuadVisualElement ../../interactive/visualElements/support/Segment ../../webgl-engine/lib/Material ../../webgl-engine/materials/lineStippleUtils ../../../../intl/locale ../../../../intl/messages".split(" "),
function(h,G,n,fa,P,Q,K,e,t,H,v,z,L,p,ha,ia,ja,R,M,N,A,S,T,k,I,B,C,U,V,y,D,J,W,X){h.State=void 0;(function(w){w[w.Pending=0]="Pending";w[w.Ready=1]="Ready";w[w.Destroyed=2]="Destroyed"})(h.State||(h.State={}));h.DirectLineMeasurementVisualization=function(w){function E(a){a=w.call(this,a)||this;a._params={...Y};a._handles=new Q;a._segmentVisualElement=null;a._triangleVisualElement=null;a._rightAngleQuad=null;a._projectedGeodesicLine=null;a._geodesicStartHint=null;a._geodesicEndHint=null;a._segmentLabel=
null;a._verticalLabel=null;a._horizontalLabel=null;a._startPosition=A.create();a._endPosition=A.create();a._cornerPosition=A.create();a._startPositionAtSeaLevel=A.create();a._endPositionAtSeaLevel=A.create();a._triangleOrientationOverride=null;a.messages=null;a.loadingMessages=!0;a.visualElementOrientation=k.VisualElementOrientation.Auto;a.triangleCollapseRatioThreshold=.03;return a}G._inheritsLoose(E,w);var u=E.prototype;u.initialize=function(){var a=this;const b=this._params,c={attached:!0,view:this.view};
this._segmentVisualElement=new U.MeasurementArrowVisualElement({...c,geometry:null,renderOccluded:D.RenderOccludedFlag.OccludeAndTransparent});this._triangleVisualElement=new C.LineVisualElement({...c,width:b.triangleLineWidth,color:b.triangleColor,renderOccluded:D.RenderOccludedFlag.OccludeAndTransparent});this._rightAngleQuad=new V.RightAngleQuadVisualElement({...c,color:F,renderOccluded:D.RenderOccludedFlag.OccludeAndTransparent});const f={...c,polygonOffset:!0,renderOccluded:D.RenderOccludedFlag.OccludeAndTransparent};
this._projectedGeodesicLine=new C.LineVisualElement({...f,width:b.geodesicProjectionLineWidth,color:b.geodesicProjectionLineColor,stipplePattern:J.createStipplePatternSimple(b.guideStippleLengthPixels)});this._geodesicStartHint=new C.LineVisualElement({...f,width:b.guideLineWidth,color:b.geodesicProjectionLineColor,stipplePattern:J.createStipplePatternSimple(b.guideStippleLengthPixels)});this._geodesicEndHint=new C.LineVisualElement({...f,width:b.guideLineWidth,color:b.geodesicProjectionLineColor,
stipplePattern:J.createStipplePatternSimple(b.guideStippleLengthPixels)});this._segmentLabel=new B.LabelVisualElement({...c,fontSize:b.direcLabelFontSize});this._verticalLabel=new B.LabelVisualElement({...c,fontSize:b.verticalLabelFontSize});this._horizontalLabel=new B.LabelVisualElement({...c,fontSize:b.horizontalLabelFontSize});this._handles.add([v.watch(()=>{const {elevationAlignedStartPoint:d,elevationAlignedEndPoint:g}=this.analysisView,q=this.view;return{view:q,camera:q.state.camera,viewMode:this.viewMode,
elevationAlignedStartPoint:d,elevationAlignedEndPoint:g,orientation:this._actualVisualElementsOrientation,visualizedMeasurement:this.actualVisualizedMeasurement,stripeLength:this._measurementArrowStripeLength}},d=>this._updateGeometryAndViewMode(d),v.syncAndInitial),v.watch(()=>({visible:this.visible,viewMode:this.viewMode}),d=>this._updateVisualElementVisibility(d),v.syncAndInitial),v.watch(()=>({text:this._labelsText,visualizedMeasurement:this.actualVisualizedMeasurement}),d=>this._updateLabelText(d),
v.syncAndInitial),v.watch(()=>({visible:this.visible,viewMode:this.viewMode}),d=>this._updateLabelVisibility(d),v.syncAndInitial),v.watch(()=>this._measurementArrowStripeLength,d=>this._updateSegmentStripeLength(d),v.syncAndInitial),W.onLocaleChange(G._asyncToGenerator(function*(){return a._updateMessageBundle()}))]);this._updateMessageBundle()};u.destroy=function(){this._handles=e.destroyMaybe(this._handles);this._segmentVisualElement=e.destroyMaybe(this._segmentVisualElement);this._triangleVisualElement=
e.destroyMaybe(this._triangleVisualElement);this._rightAngleQuad=e.destroyMaybe(this._rightAngleQuad);this._projectedGeodesicLine=e.destroyMaybe(this._projectedGeodesicLine);this._geodesicStartHint=e.destroyMaybe(this._geodesicStartHint);this._geodesicEndHint=e.destroyMaybe(this._geodesicEndHint);this._segmentLabel=e.destroyMaybe(this._segmentLabel);this._verticalLabel=e.destroyMaybe(this._verticalLabel);this._horizontalLabel=e.destroyMaybe(this._horizontalLabel);this.set("view",null)};u._updateVisualElementVisibility=
function({visible:a,viewMode:b}){this._segmentVisualElement.visible=!1;this._triangleVisualElement.visible=!1;this._rightAngleQuad.visible=!1;this._projectedGeodesicLine.visible=!1;this._geodesicStartHint.visible=!1;this._geodesicEndHint.visible=!1;if(a)switch(b){case k.ViewMode.Direct:this._segmentVisualElement.visible=!0;break;case k.ViewMode.Triangle:this._segmentVisualElement.visible=!0;this._triangleVisualElement.visible=!0;this._rightAngleQuad.visible=!0;break;case k.ViewMode.ProjectedGeodesic:this._segmentVisualElement.visible=
!0,this._projectedGeodesicLine.visible=!0,this._geodesicStartHint.visible=!0,this._geodesicEndHint.visible=!0}};u._updateGeometryAndViewMode=function({view:a,camera:b,viewMode:c,elevationAlignedStartPoint:f,elevationAlignedEndPoint:d,orientation:g,visualizedMeasurement:q,stripeLength:l}){const m=a.renderCoordsHelper;if(!(e.isNone(m)||e.isNone(f)||e.isNone(d)||f.equals(d))){var r=this._startPosition,x=this._endPosition;m.toRenderCoords(f,r);m.toRenderCoords(d,x);f=g===k.VisualElementOrientation.AboveSegment?
1:-1;d=m.getAltitude(x);var Z=m.getAltitude(r);d=f*(d-Z);0>d&&(r=this._endPosition,x=this._startPosition);q="geodesic"===q?new y.GeodesicSegment(this._startPosition,this._endPosition,m.spatialReference):new y.EuclideanSegment(this._startPosition,this._endPosition);this._segmentVisualElement.geometry=q;this._updateSegmentStripeLength(l);switch(c){case k.ViewMode.Direct:this._updateSegment(q,g);break;case k.ViewMode.Triangle:this._updateSegmentAndTriangle({view:a,camera:b,segment:q,orientation:g,startPosition:r,
endPosition:x,deltaSign:f,altitudeDelta:d});break;case k.ViewMode.ProjectedGeodesic:this._updateSegmentAndProjection({view:a,orientation:g,startPosition:r,endPosition:x})}}};u._updateSegment=function(a,b){this._segmentLabel.anchor=b===k.VisualElementOrientation.AboveSegment?"top":"bottom";this._segmentLabel.geometry={type:"segment",segment:a,sampleLocation:"center"}};u._updateSegmentAndTriangle=function({view:{renderCoordsHelper:a},camera:b,segment:c,orientation:f,startPosition:d,endPosition:g,deltaSign:q,
altitudeDelta:l}){const m=this._cornerPosition;a.worldUpAtPosition(d,m);N.scale(m,m,q*Math.abs(l));N.add(m,m,d);this._triangleVisualElement.geometry=[[[d[0],d[1],d[2]],[m[0],m[1],m[2]],[g[0],g[1],g[2]]]];this._rightAngleQuad.geometry={previous:d,center:m,next:g};a=new y.EuclideanSegment(d,m);q=new y.EuclideanSegment(m,g);l=aa;var r=ba;b.projectToRenderScreen(m,l);b.projectToRenderScreen(g,r);l={segment:"bottom",horizontal:"top",vertical:l[0]<r[0]?"left":"right"};{const x=ca;r=da;I.screenSpaceTangent(d,
m,x,b);I.screenSpaceTangent(d,g,r,b);M.dot(x,r)>=O?l.segment=Math.sign(x[1])===Math.sign(r[1])?B.mirrorPosition(l.vertical):l.vertical:(d=ea,I.screenSpaceTangent(m,g,d,b),M.dot(d,r)>=O&&(l.segment=Math.sign(d[0])===Math.sign(r[0])?B.mirrorPosition(l.horizontal):l.horizontal))}f===k.VisualElementOrientation.BelowSegment&&(l.segment="top"===l.segment?"bottom":"top",l.horizontal="top"===l.horizontal?"bottom":"top",l.vertical="top"===l.vertical?"bottom":"top");b=l;this._segmentLabel.anchor=b.segment;
this._segmentLabel.geometry={type:"segment",segment:c,sampleLocation:"center"};this._verticalLabel.geometry={type:"segment",segment:a,sampleLocation:"center"};this._verticalLabel.anchor=b.vertical;this._horizontalLabel.geometry={type:"segment",segment:q,sampleLocation:"center"};this._horizontalLabel.anchor=b.horizontal};u._updateSegmentAndProjection=function({view:{renderCoordsHelper:a},orientation:b,startPosition:c,endPosition:f}){a.setAltitude(this._startPositionAtSeaLevel,0,c);a.setAltitude(this._endPositionAtSeaLevel,
0,f);a=new y.GeodesicSegment(this._startPositionAtSeaLevel,this._endPositionAtSeaLevel,a.spatialReference);this._projectedGeodesicLine.setGeometryFromSegment(a);this._geodesicStartHint.setGeometryFromSegment(new y.EuclideanSegment(this._startPositionAtSeaLevel,c));this._geodesicEndHint.setGeometryFromSegment(new y.EuclideanSegment(this._endPositionAtSeaLevel,f));this._segmentLabel.geometry={type:"segment",segment:a,sampleLocation:"center"};this._segmentLabel.anchor=b===k.VisualElementOrientation.AboveSegment?
"top":"bottom"};u._updateLabelText=function({text:a,visualizedMeasurement:b}){e.isSome(a)?(this._segmentLabel.text="euclidean"===b?a.euclideanDistance:a.geodesicDistance,this._horizontalLabel.text=a.horizontalDistance,this._verticalLabel.text=a.verticalDistance):(this._segmentLabel.text=null,this._horizontalLabel.text=null,this._verticalLabel.text=null);this.notifyChange("labels")};u._updateLabelVisibility=function({visible:a,viewMode:b}){const c=this._segmentLabel,f=this._horizontalLabel,d=this._verticalLabel;
c.visible=!1;f.visible=!1;d.visible=!1;if(a)switch(b){case k.ViewMode.Direct:c.visible=!0;break;case k.ViewMode.Triangle:c.visible=!0;f.visible=!0;d.visible=!0;break;case k.ViewMode.ProjectedGeodesic:c.visible=!0}};u._updateSegmentStripeLength=function(a){const b=this._segmentVisualElement;e.isSome(a)?(b.stripeLength=a,b.stripesEnabled=!0):b.stripesEnabled=!1};u._requiresGeodesicGuideAt=function(a){var b=this.view;if(null==b||!b.state)return!1;const c=b.renderCoordsHelper;b=b.state.camera.computeScreenPixelSizeAt(a);
return 10<=c.getAltitude(a)/b};u._updateMessageBundle=function(){this.loadingMessages=!0;X.fetchMessageBundle("esri/core/t9n/Units").then(a=>{this.messages=a}).finally(()=>{this.loadingMessages=!1})};G._createClass(E,[{key:"visible",get:function(){return this.analysisView.visible}},{key:"viewMode",get:function(){const {elevationAlignedStartPoint:a,elevationAlignedEndPoint:b}=this.analysisView;if(e.isNone(a)||e.isNone(b)||a.equals(b))return k.ViewMode.None;var c=this.analysisView.result;if(e.isNone(c))return k.ViewMode.Direct;
if("geodesic"===c.mode)return this._requiresGeodesicGuideAt(this._startPosition)||this._requiresGeodesicGuideAt(this._endPosition)?k.ViewMode.ProjectedGeodesic:k.ViewMode.Direct;const {verticalDistance:f,horizontalDistance:d}=c;c=f.value;const g=d.value;return Math.min(c/g,g/c)<this.triangleCollapseRatioThreshold?k.ViewMode.Direct:k.ViewMode.Triangle}},{key:"actualVisualizedMeasurement",get:function(){if(e.isNone(this.analysisView.result))switch(this.analysisView.measurementMode){default:return"euclidean";
case T.MeasurementMode.Geodesic:return"geodesic"}return this.analysisView.result.mode}},{key:"allowVisualElementsOrientationChange",get:function(){return e.isNone(this._triangleOrientationOverride)},set:function(a){e.isNone(this._triangleOrientationOverride)!==a&&(e.isNone(this._triangleOrientationOverride)?this._triangleOrientationOverride=this._actualVisualElementsOrientation:this._triangleOrientationOverride=null)}},{key:"labels",get:function(){return{direct:this._segmentLabel,horizontal:"geodesic"===
this.actualVisualizedMeasurement?this._segmentLabel:this._horizontalLabel,vertical:this._verticalLabel}}},{key:"_labelsText",get:function(){if(this.destroyed)return null;const a=this.messages;var b=this.analysisView.result;if(e.isNone(b)||e.isNone(a))return null;const {directDistance:c,horizontalDistance:f,verticalDistance:d,geodesicDistance:g}=b;b=this.analysisView.unit;const q=l=>({euclideanDistance:"",geodesicDistance:"",horizontalDistance:"",verticalDistance:"",...l});switch(b){case "metric":return q({euclideanDistance:c&&
t.formatMetricLength(a,c),geodesicDistance:g&&t.formatMetricLength(a,g),horizontalDistance:f&&t.formatMetricLength(a,f),verticalDistance:d&&t.formatMetricVerticalLength(a,d)});case "imperial":return q({euclideanDistance:c&&t.formatImperialLength(a,c),geodesicDistance:g&&t.formatImperialLength(a,g),horizontalDistance:f&&t.formatImperialLength(a,f),verticalDistance:d&&t.formatImperialVerticalLength(a,d)});default:return q({euclideanDistance:c&&t.formatDecimal(a,c,b),geodesicDistance:g&&t.formatDecimal(a,
g,b),horizontalDistance:f&&t.formatDecimal(a,f,b),verticalDistance:d&&t.formatDecimal(a,d,b)})}}},{key:"_actualVisualElementsOrientation",get:function(){if(e.isSome(this._triangleOrientationOverride))return this._triangleOrientationOverride;const a=this.visualElementOrientation;return a===k.VisualElementOrientation.Auto?this.view.state.camera.aboveGround?k.VisualElementOrientation.AboveSegment:k.VisualElementOrientation.BelowSegment:a}},{key:"_measurementArrowStripeLength",get:function(){const {result:a,
unit:b}=this.analysisView;if(e.isNone(a))return null;var c=null;c=a.directDistance;switch(b){case "metric":c=c&&H.toUnit(c,"meters");break;case "imperial":c=c&&H.toUnit(c,L.preferredImperialLengthUnit(c.value,c.unit));break;default:c=c&&H.toUnit(c,b)}return e.isNone(c)?null:K.nextHighestPowerOfTen(c.value/30)*L.convertUnit(1,c.unit,"meters")}},{key:"testData",get:function(){var a;return{labels:this.labels,stripeLength:null==(a=this._segmentVisualElement)?void 0:a.stripeLength}}}]);return E}(P);n.__decorate([p.property()],
h.DirectLineMeasurementVisualization.prototype,"_triangleOrientationOverride",void 0);n.__decorate([p.property()],h.DirectLineMeasurementVisualization.prototype,"messages",void 0);n.__decorate([p.property()],h.DirectLineMeasurementVisualization.prototype,"view",void 0);n.__decorate([p.property()],h.DirectLineMeasurementVisualization.prototype,"analysis",void 0);n.__decorate([p.property()],h.DirectLineMeasurementVisualization.prototype,"analysisView",void 0);n.__decorate([p.property()],h.DirectLineMeasurementVisualization.prototype,
"loadingMessages",void 0);n.__decorate([p.property()],h.DirectLineMeasurementVisualization.prototype,"visible",null);n.__decorate([p.property()],h.DirectLineMeasurementVisualization.prototype,"viewMode",null);n.__decorate([p.property()],h.DirectLineMeasurementVisualization.prototype,"actualVisualizedMeasurement",null);n.__decorate([p.property()],h.DirectLineMeasurementVisualization.prototype,"visualElementOrientation",void 0);n.__decorate([p.property()],h.DirectLineMeasurementVisualization.prototype,
"triangleCollapseRatioThreshold",void 0);n.__decorate([p.property()],h.DirectLineMeasurementVisualization.prototype,"allowVisualElementsOrientationChange",null);n.__decorate([p.property()],h.DirectLineMeasurementVisualization.prototype,"labels",null);n.__decorate([p.property()],h.DirectLineMeasurementVisualization.prototype,"_labelsText",null);n.__decorate([p.property()],h.DirectLineMeasurementVisualization.prototype,"_actualVisualElementsOrientation",null);n.__decorate([p.property()],h.DirectLineMeasurementVisualization.prototype,
"_measurementArrowStripeLength",null);h.DirectLineMeasurementVisualization=n.__decorate([R.subclass("esri.views.3d.analysis.DirectLineMeasurement.DirectLineMeasurementVisualization")],h.DirectLineMeasurementVisualization);const F=S.fromValues(1,.5,0,.75),Y={laserLineGlowColor:[1,.5,0],laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:[1,1,1],laserLineInnerWidth:.75,laserLineGlobalAlpha:.75,laserLineEnabled:!0,handleColor:[1,.5,0],handleOpacity:.5,handleRadius:5,triangleColor:F,triangleLineWidth:3,
triangleCornerSize:32,triangleSubdivisions:128,arrowWidth:16,arrowOutlineColor:[1,.5,0,1],arrowOutlineWidth:.2,arrowStripeEvenColor:[1,1,1,1],arrowStripeOddColor:[1,.5,0,1],arrowStripeLength:16,arrowSubdivisions:128,geodesicProjectionLineWidth:2,geodesicProjectionLineColor:F,guideLineWidth:2,guideLineColor:F,guideStippleLengthPixels:6,labelDistance:25,direcLabelFontSize:16,horizontalLabelFontSize:12,verticalLabelFontSize:12},O=Math.cos(K.deg2rad(12)),aa=z.createRenderScreenPointArray3(),ba=z.createRenderScreenPointArray3(),
ca=z.createRenderScreenPointArray(),da=z.createRenderScreenPointArray(),ea=z.createRenderScreenPointArray();Object.defineProperties(h,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});