// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/Error ../../../../core/lang ../../../../core/Logger ./LEPCC ../../webgl-engine/lib/VertexAttribute".split(" "),function(h,l,G,H,w,n){function I(a,b,c){let g="",d=0;for(;d<c;){var e=a[b+d];if(128>e)g+=String.fromCharCode(e),d++;else if(192<=e&&224>e){if(d+1>=c)throw new l("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");g+=String.fromCharCode((e&31)<<6|a[b+d+1]&63);d+=2}else if(224<=e&&240>e){if(d+2>=c)throw new l("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");
g+=String.fromCharCode((e&15)<<12|(a[b+d+1]&63)<<6|a[b+d+2]&63);d+=3}else if(240<=e&&248>e){if(d+3>=c)throw new l("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");e=(e&7)<<18|(a[b+d+1]&63)<<12|(a[b+d+2]&63)<<6|a[b+d+3]&63;g=65536<=e?g+String.fromCharCode((e-65536>>10)+55296,(e&1023)+56320):g+String.fromCharCode(e);d+=4}else throw new l("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");}return g}function r(a,b){const c={byteOffset:0,byteCount:0,
fields:Object.create(null)};let g=0;for(let d=0;d<b.length;d++){const e=b[d],f=e.valueType||e.type;c.fields[e.property]=(0,x[f])(a,g);g+=p[f].BYTES_PER_ELEMENT}c.byteCount=g;return c}function y(a,b,c){const g=[];let d,e=0,f;for(f=0;f<a;f+=1){d=b[f];if(0<d){if(g.push(I(c,e,d-1)),0!==c[e+d-1])throw new l("string-array-error","Invalid string array: missing null termination.");}else g.push(null);e+=d}return g}function t(a,b){return new p[b.valueType](a,b.byteOffset,b.count*b.valuesPerElement)}function z(a,
b){return new Uint8Array(a,b.byteOffset,b.byteCount)}function A(a,b,c){a=null!=b.header?r(a,b.header):{byteOffset:0,byteCount:0,fields:{count:c}};c={header:a,byteOffset:a.byteCount,byteCount:0,entries:Object.create(null)};let g=a.byteCount;for(let d=0;d<b.ordering.length;d++){const e=b.ordering[d],f=G.clone(b[e]);f.count=a.fields.count;if("String"===f.valueType){if(f.byteOffset=g,f.byteCount=a.fields[e+"ByteCount"],"UTF-8"!==f.encoding)throw new l("unsupported-encoding","Unsupported String encoding.",
{encoding:f.encoding});}else if(u(f.valueType)){const k=q(f.valueType);g+=0!==g%k?k-g%k:0;f.byteOffset=g;f.byteCount=k*f.valuesPerElement*f.count}else throw new l("unsupported-value-type","Unsupported binary valueType",{valueType:f.valueType});g+=f.byteCount;c.entries[e]=f}c.byteCount=g-c.byteOffset;return c}function B(a,b,c){b!==a&&v.error(`Invalid ${c} buffer size\n expected: ${a}, actual: ${b})`);if(b<a)throw new l("buffer-too-small","Binary buffer is too small",{expectedSize:a,actualSize:b});
}function C(a){return{isDraco:!1,isLegacy:!1,color:null!=a.color,normal:null!=a.normal,uv0:null!=a.uv0,uvRegion:null!=a.uvRegion,featureIndex:null!=a.faceRange&&null!=a.featureId}}function D(a){const b={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const c of a.ordering)if(a.vertexAttributes[c])switch(c){case "normal":b.normal=!0;break;case "color":b.color=!0;break;case "uv0":b.uv0=!0;break;case "region":b.uvRegion=!0}a.featureAttributes&&a.featureAttributeOrder&&
(b.featureIndex=!0);return b}function E(a){const b={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const c of a)switch(c){case "normal":b.normal=!0;break;case "uv0":b.uv0=!0;break;case "color":b.color=!0;break;case "uv-region":b.uvRegion=!0;break;case "feature-index":b.featureIndex=!0}return b}function u(a){return p.hasOwnProperty(a)}function q(a){return u(a)?p[a].BYTES_PER_ELEMENT:0}const v=H.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader"),F={position:n.VertexAttribute.POSITION,
normal:n.VertexAttribute.NORMAL,color:n.VertexAttribute.COLOR,uv0:n.VertexAttribute.UV0,region:n.VertexAttribute.UVREGION},p={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},x={Float32:(a,b)=>(new DataView(a,0)).getFloat32(b,!0),Float64:(a,b)=>(new DataView(a,0)).getFloat64(b,!0),UInt8:(a,b)=>(new DataView(a,0)).getUint8(b),Int8:(a,b)=>(new DataView(a,0)).getInt8(b),UInt16:(a,b)=>(new DataView(a,0)).getUint16(b,
!0),Int16:(a,b)=>(new DataView(a,0)).getInt16(b,!0),UInt32:(a,b)=>(new DataView(a,0)).getUint32(b,!0),Int32:(a,b)=>(new DataView(a,0)).getInt32(b,!0)};h.createAttributeDataIndex=A;h.createGeometryDescriptor=function(a,b){return a&&a.compressedAttributes&&"draco"===a.compressedAttributes.encoding?E(a.compressedAttributes.attributes):a?C(a):D(b)};h.createGeometryDescriptorForDraco=E;h.createGeometryDescriptorFromDefinition=C;h.createGeometryDescriptorFromSchema=D;h.createGeometryIndexFromSchema=function(a,
b){var c=r(a,b&&b.header);let g=c.byteCount;const d={isDraco:!1,header:c,byteOffset:c.byteCount,byteCount:0,vertexAttributes:{}};c=c.fields;var e=null!=c.vertexCount?c.vertexCount:c.count;for(var f of b.ordering){if(!b.vertexAttributes[f])continue;const m={...b.vertexAttributes[f],byteOffset:g,count:e};d.vertexAttributes[F[f]?F[f]:"_"+f]=m;g+=q(m.valueType)*m.valuesPerElement*e}f=c.faceCount;if(b.faces&&f){d.faces={};for(var k of b.ordering)b.faces[k]&&(e={...b.faces[k],byteOffset:g,count:f},d.faces[k]=
e,g+=q(e.valueType)*e.valuesPerElement*f)}k=c.featureCount;if(b.featureAttributes&&b.featureAttributeOrder&&k){d.featureAttributes={};for(const m of b.featureAttributeOrder)b.featureAttributes[m]&&(c={...b.featureAttributes[m],byteOffset:g,count:k},d.featureAttributes[m]=c,f="UInt64"===c.valueType?8:q(c.valueType),g+=f*c.valuesPerElement*k)}B(g,a.byteLength,"geometry");d.byteCount=g-d.byteOffset;return d};h.createRawView=z;h.createTypedView=t;h.getBytesPerValue=q;h.isValueType=u;h.readBinaryAttribute=
function(a,b,c){if("lepcc-rgb"===a.encoding)return w.decodeRGB(b);if("lepcc-intensity"===a.encoding)return w.decodeIntensity(b);if(null!=a.encoding&&""!==a.encoding)throw new l("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");a["attributeByteCounts "]&&!a.attributeByteCounts&&(v.warn("Warning: Trailing space in 'attributeByteCounts '."),a.attributeByteCounts=a["attributeByteCounts "]);"ObjectIds"===a.ordering[0]&&a.hasOwnProperty("objectIds")&&(v.warn("Warning: Case error in objectIds"),
a.ordering[0]="objectIds");c=A(b,a,c);B(c.byteOffset+c.byteCount,b.byteLength,"attribute");if(a=c.entries.attributeValues||c.entries.objectIds){if("String"===a.valueType){c=c.entries.attributeByteCounts;const g=t(b,c);b=z(b,a);return y(c.count,g,b)}return t(b,a)}throw new l("bad-attribute-storage-info","Bad attributeStorageInfo specification.");};h.readHeader=r;h.readStringArray=y;h.valueType2ArrayBufferReader=x;h.valueType2TypedArrayClassMap=p;Object.defineProperties(h,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});