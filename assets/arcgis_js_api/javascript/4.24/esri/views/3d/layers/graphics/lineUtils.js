// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/has ../../../../core/maybe ../../../../core/typedArrayUtil ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/support/triangulationUtils ../../../ViewingMode ./constants ./elevationAlignmentUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/shaders/RibbonLineTechniqueConfiguration".split(" "),
function(m,J,n,x,y,t,u,v,z,p,A,B,C,D,E,F,g,r){function w(a,d,e){const b=[];for(const {index:f,count:c}of a){if(1>=c)continue;a=3*f;const k=a+3*c;b.push({position:d.subarray(a,k),mapPosition:e?e.subarray(a,k):void 0})}return b}m.RemoveDuplicateStartEnd=void 0;(function(a){a[a.KEEP=0]="KEEP";a[a.REMOVE=1]="REMOVE"})(m.RemoveDuplicateStartEnd||(m.RemoveDuplicateStartEnd={}));const G=u.create(),H=u.create();m.createGeometry=function(a){const d=[],e=[];{const {attributeData:{position:h},removeDuplicateStartEnd:I}=
a;var b=h.length;b=(b=h[0]===h[b-3]&&h[1]===h[b-2]&&h[2]===h[b-1])&&I===m.RemoveDuplicateStartEnd.REMOVE;var f=h.length/3-(b?1:0),c=new Uint32Array(2*(f-1)),k=b?x.slice(h,0,h.length-3):h,q=0;for(var l=0;l<f-1;l++)c[q++]=l,c[q++]=l+1;e.push([g.VertexAttribute.POSITION,{size:3,data:k,exclusive:b}]);d.push([g.VertexAttribute.POSITION,c])}f=e[0][1].data;b=new Uint16Array(d[0][1].length);c=a.attributeData.mapPosition;n.isNone(c)||(d.push([g.VertexAttribute.MAPPOS,d[0][1]]),e.push([g.VertexAttribute.MAPPOS,
{size:3,data:c}]));n.isSome(a.attributeData.colorFeature)||(e.push([g.VertexAttribute.COLOR,{size:4,data:n.unwrapOr(a.attributeData.color,B.WHITE_UNIT)}]),d.push([g.VertexAttribute.COLOR,b]));n.isSome(a.attributeData.sizeFeature)||(e.push([g.VertexAttribute.SIZE,{size:1,data:[n.unwrapOr(a.attributeData.size,1)]}]),d.push([g.VertexAttribute.SIZE,b]));c=a.attributeData.colorFeature;n.isNone(c)||(e.push([g.VertexAttribute.COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([c])}]),d.push([g.VertexAttribute.COLOR,
b]));c=a.attributeData.sizeFeature;n.isNone(c)||(e.push([g.VertexAttribute.SIZEFEATUREATTRIBUTE,{size:1,data:new Float32Array([c])}]),d.push([g.VertexAttribute.SIZEFEATUREATTRIBUTE,b]));c=a.attributeData.opacityFeature;n.isNone(c)||(e.push([g.VertexAttribute.OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([c])}]),d.push([g.VertexAttribute.OPACITYFEATUREATTRIBUTE,b]));if(!n.isNone(a.overlayInfo)&&a.overlayInfo.renderCoordsHelper.viewingMode===A.ViewingMode.Global&&a.overlayInfo.spatialReference.isGeographic){b=
new Float64Array(f.length);a=z.getReferenceEllipsoid(a.overlayInfo.spatialReference);for(c=0;c<b.length;c+=3)v.lonLatToWebMercatorComparable(f,c,b,c,a);a=f.length/3;f=new Float32Array(a+1);c=G;k=H;l=q=0;t.set(c,b[l++],b[l++],b[l++]);f[0]=0;for(let h=1;h<a+1;++h)h===a&&(l=0),t.set(k,b[l++],b[l++],b[l++]),q+=y.dist(c,k),f[h]=q,[c,k]=[k,c];e.push([g.VertexAttribute.DISTANCETOSTART,{size:1,data:f}]);d.push([g.VertexAttribute.DISTANCETOSTART,d[0][1]])}return new F.Geometry(e,d,E.PrimitiveType.Line)};m.geometryToRenderInfo=
function(a,d,e,b){const {position:f,outlines:c}=p.pathsToTriangulationInfo("polygon"===a.type?a.rings:a.paths,a.hasZ,"polygon"===a.type?p.CounterClockwiseMode.CCW_IS_HOLE:p.CounterClockwiseMode.NONE),k=new Float64Array(f.length);a=C.applyPerVertexElevationAlignment(f,a.spatialReference,0,k,0,f,0,f.length/3,d,e,b);d=null!=a;return{lines:d?w(c,f,k):[],projectionSuccess:d,sampledElevation:a}};m.geometryToRenderInfoDraped=function(a,d){const {position:e,outlines:b}=p.pathsToTriangulationInfo("polygon"===
a.type?a.rings:a.paths,!1,"polygon"===a.type?p.CounterClockwiseMode.CCW_IS_HOLE:p.CounterClockwiseMode.NONE);a=v.projectBuffer(e,a.spatialReference,0,e,d,0,e.length/3);for(d=2;d<e.length;d+=3)e[d]=D.DRAPED_Z;return{lines:a?w(b,e):[],projectionSuccess:a}};m.parseCapType=function(a){switch(a){case "butt":return r.CapType.BUTT;case "square":return r.CapType.SQUARE;case "round":return r.CapType.ROUND;default:return null}};Object.defineProperties(m,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});