// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/Handles ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/spatialReferenceUtils ./LayerView3D ../../layers/LayerView ../../webgl/context-util".split(" "),function(r,
q,l,w,m,c,h,t,C,D,E,x,y,z,A,B){var f;(function(k){k[k.API=1]="API";k[k.VerboseAPI=2]="VerboseAPI";k[k.Error=3]="Error"})(f||(f={}));const u=m.getLogger(" esri.views.3d.layers.VoxelLayerView3D");m=function(k){function p(){var a=k.apply(this,arguments)||this;a._usedMemory=0;a._futureMemory=0;a.type="voxel-3d";a._wasmLayerId=-1;a._handles=new w;a._dbgFlags=new Set;return a}r._inheritsLoose(p,k);var d=p.prototype;d.initialize=function(){var a;if("local"!==this.view.viewingMode)throw new l("voxel:unsupported-viewingMode",
"Voxel layers support local viewingMode only.",{});if(this.view._stage.renderView.renderingContext.type!==B.ContextType.WEBGL2)throw new l("voxel:unsupported-context","Voxel layers are supported in WebGL2 rendering contexts only.",{});if(null==(a=this.view._stage.renderView.renderingContext.capabilities.colorBufferFloat)||!a.textureFloat)throw new l("voxel:missing-color-buffer-float","Voxel layers require the WebGL2 extension EXT_color_buffer_float",{});if(!y.equals(this.layer.spatialReference,this.view.spatialReference))throw new l("layerview:spatial-reference-incompatible",
"The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});a=this.layer.currentVariableId;var b=this.layer.getVolume(a);a=this.layer.getVariable(a);if(c.isSome(b)&&c.isSome(a)){var g=b.dimensions[0];const n=b.dimensions[1],e=b.getZDimension();if(1<e){b=g.size*n.size*b.dimensions[e].size;g=1;switch(a.renderingFormat.type){case "Int16":case "UInt16":g=2;break;case "Int32":case "UInt32":case "Float32":g=4}this._futureMemory=g*b}}a=this.view.addVoxelLayerViewToWasm(this).then(n=>
{this._wasmLayerId=n;this._suspendedHandle=h.watch(()=>this.suspended,e=>{const v=this.view.voxelWasm;c.isSome(v)&&v.setEnabled(this,!e)},h.initial);this._handles.add([h.watch(()=>this.layer.renderMode,e=>this._pushRenderModeToWasm(e)),h.watch(()=>this.layer.currentVariableId,e=>this._pushCurrentVariableIdToWasm(e)),h.watch(()=>this.layer.getDynamicSections(),e=>this._pushDynamicSectionsToWasm(e)),h.watch(()=>this.layer.getSlices(),e=>this._pushSlicesToWasm(e)),h.watch(()=>this.layer.getSections(),
e=>this._pushSectionsToWasm(e)),h.watch(()=>this.layer.getVerticalExaggeration(),e=>this._pushVerticalExaggerationToWasm(e)),h.watch(()=>this.layer.getVerticalOffset(),e=>this._pushVerticalOffsetToWasm(e))])}).catch(n=>{this.view.removeVoxelLayerViewFromWasm(this);this._wasmLayerId=-1;if(-1===n)throw new l("voxel:addLayer-failure","The voxel layer description was invalid.",{});if(-2===n)throw new l("voxel:addLayer-failure","The voxel layer web assembly module failed to download.",{});});this.addResolvingPromise(a)};
d.destroy=function(){this.view.removeVoxelLayerViewFromWasm(this);this._suspendedHandle&&(this._suspendedHandle.remove(),this._suspendedHandle=null);this._handles=c.destroyMaybe(this._handles)};d.isUpdating=function(){const a=this.view.voxelWasm;return 0>this._wasmLayerId||!c.isSome(a)?!1:a.isUpdating(this._wasmLayerId)};d.updatingFlagChanged=function(){this.notifyChange("updating")};d.getUsedMemory=function(){return this._usedMemory};d.getUnloadedMemory=function(){return this._futureMemory};d.ignoresMemoryFactor=
function(){return!0};d.setUsedMemory=function(a){this._usedMemory=a;this._futureMemory=0};d.captureFrustum=function(){const a=this.view.voxelWasm;c.isSome(a)&&a.captureFrustum()};d.toggleFullVolumeExtentDraw=function(){const a=this.view.voxelWasm;c.isSome(a)&&a.toggleFullVolumeExtentDraw(this)};d._pushRenderModeToWasm=function(a){const b=this.view.voxelWasm;this._dbg(f.VerboseAPI,`VoxelLayerView3D._pushRenderModeToWasm() called, ${c.isSome(b)?"have WASM":"don't have WASM!!!"}`);c.isSome(b)&&b.setRenderMode(this,
a)||this._dbg(f.Error,"VoxelLayerView3D._pushRenderModeToWasm() failed!")};d._pushSlicesToWasm=function(a){const b=this.view.voxelWasm;this._dbg(f.VerboseAPI,`VoxelLayerView3D._pushSlicesToWasm() called, ${c.isSome(b)?"have WASM":"don't have WASM!!!"}`);c.isSome(b)&&b.setSlices(this,a)||this._dbg(f.Error,"VoxelLayerView3D._pushSlicesToWasm() failed!")};d._pushSectionsToWasm=function(a){const b=this.view.voxelWasm;this._dbg(f.VerboseAPI,`VoxelLayerView3D._pushSectionsToWasm() called, ${c.isSome(b)?
"have WASM":"don't have WASM!!!"}`);c.isSome(b)&&b.setStaticSections(this,a)||this._dbg(f.Error,"VoxelLayerView3D._pushSectionsToWasm() failed!")};d._pushDynamicSectionsToWasm=function(a){const b=this.view.voxelWasm;this._dbg(f.VerboseAPI,`VoxelLayerView3D._pushDynamicSectionsToWasm() called, ${c.isSome(b)?"have WASM":"don't have WASM!!!"}`);c.isSome(b)&&b.setDynamicSections(this,a)||this._dbg(f.Error,"VoxelLayer._updateDynamicSections() failed!")};d._pushCurrentVariableIdToWasm=function(a){const b=
this.view.voxelWasm;this._dbg(f.VerboseAPI,`VoxelLayerView3D._pushCurrentVariableIdToWasm() called!, ${c.isSome(b)?"have WASM":"don't have WASM!!!"}`);c.isSome(b)&&b.setCurrentVariable(this,a)||this._dbg(f.Error,"VoxelLayerView3D._pushCurrentVariableIdToWasm() failed!")};d._pushVerticalExaggerationToWasm=function(a){const b=this.layer.getVolumeStyle(null),g=this.view.voxelWasm;this._dbg(f.VerboseAPI,`VoxelLayerView3D._pushVerticalExaggerationToWasm() called, ${c.isSome(g)?"have WASM":"don't have WASM!!!"}, ${c.isSome(b)?
"have style":"don't have style!!!"}`);c.isNone(b)||c.isSome(g)&&g.setVerticalExaggerationAndOffset(this,b.volumeId,a,b.verticalOffset)||this._dbg(f.Error,"VoxelLayerView3D._pushVerticalExaggerationToWasm() failed!")};d._pushVerticalOffsetToWasm=function(a){const b=this.layer.getVolumeStyle(null),g=this.view.voxelWasm;this._dbg(f.VerboseAPI,`VoxelLayerView3D._pushVerticalOffsetToWasm() called, ${c.isSome(g)?"have WASM":"don't have WASM!!!"}, ${c.isSome(b)?"have style":"don't have style!!!"}`);c.isNone(b)||
c.isSome(g)&&g.setVerticalExaggerationAndOffset(this,b.volumeId,b.verticalExaggeration,a)||this._dbg(f.Error,"VoxelLayerView3D._pushVerticalOffsetToWasm() failed!")};d._dbg=function(a,b){this._dbgFlags.has(a)&&(a===f.Error?u.error(b):u.warn(b))};r._createClass(p,[{key:"wasmLayerId",get:function(){return this._wasmLayerId}},{key:"performanceInfo",get:function(){return{nodes:0,displayedNumberOfFeatures:0,maximumNumberOfFeatures:0,totalNumberOfFeatures:0,core:null}}}]);return p}(z.LayerView3D(A));q.__decorate([t.property()],
m.prototype,"layer",void 0);q.__decorate([t.property({readOnly:!0,aliasOf:"layer.parsedUrl.path"})],m.prototype,"baseUrl",void 0);return m=q.__decorate([x.subclass("esri.views.3d.layers.VoxelLayerView3D")],m)});