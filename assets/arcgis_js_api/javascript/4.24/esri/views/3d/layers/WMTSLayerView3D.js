// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../layers/support/layerUtils ./LayerView3D ./TiledLayerView3D ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),function(l,
h,r,d,g,t,m,A,B,C,u,v,w,x,y,z){const q=d.getLogger("esri.views.3d.layers.WMTSLayerView3d");d=function(n){function k(){var a=n.apply(this,arguments)||this;a.type="wmts-3d";return a}l._inheritsLoose(k,n);var e=k.prototype;e._getCompatibleTileInfoMatrixSet=function(a,b=!1){const c=v.getTileMaxtrixSetFromActiveLayer(this.layer);if(g.isSome(c)){if(r.isCollection(c))return c.find(f=>{f=a(f);g.isSome(f)&&(b?q.error("The selected tile matrix set is not compatible with the view",f):this.addResolvingPromise(Promise.reject(f)));
return null==f});const p=a(c);g.isSome(p)&&(b?q.error("The selected tile matrix set is not compatible with the view",p):this.addResolvingPromise(Promise.reject(p)));return c}return null};e.initialize=function(){this._getCompatibleTileInfoMatrixSet(b=>this._getTileInfoSupportError(b.tileInfo,b.fullExtent));const a=t.whenOnce(()=>{var b,c;return null==(b=this.view)?void 0:null==(c=b.basemapTerrain)?void 0:c.tilingSchemeLocked}).then(()=>{const b=this._getCompatibleTileInfoMatrixSet(c=>this._getTileInfoSupportError(c.tileInfo,
c.fullExtent)||this._getTileInfoCompatibilityError(c.tileInfo,this.view.basemapTerrain.tilingScheme));g.isNone(b)||(this.layer.activeLayer.tileMatrixSetId!==b.id&&(this.layer.activeLayer.tileMatrixSetId=b.id),this.tileInfo=b.tileInfo,this.layer.fullExtent=b.fullExtent)});this.addResolvingPromise(a);this.when(()=>this._initialized())};e.refresh=function(){this.emit("data-changed")};e.canResume=function(){if(!n.prototype.canResume.call(this))return!1;const a=this.layer.activeLayer.tileMatrixSet;return a&&
!this._getTileInfoError(a.tileInfo,a.fullExtent)};e.doRefresh=function(){var a=l._asyncToGenerator(function*(){this.suspended||this.emit("data-changed")});return function(){return a.apply(this,arguments)}}();e._initialized=function(){this.updatingHandles.add(()=>{var a,b;return null==(a=this.layer)?void 0:null==(b=a.activeLayer)?void 0:b.styleId},()=>this.refresh());this.updatingHandles.add(()=>{var a;return null==(a=this.layer)?void 0:a.activeLayer},a=>{const b=this._getCompatibleTileInfoMatrixSet(c=>
this._getTileInfoSupportError(c.tileInfo,c.fullExtent)||this._getTileInfoCompatibilityError(c.tileInfo,this.view.basemapTerrain.tilingScheme),!0);g.isSome(b)&&a.tileMatrixSetId!==b.id&&(this.layer.activeLayer.tileMatrixSetId=b.id);this.notifyChange("suspended");this.canResume()&&this.refresh()})};e._getTileInfoError=function(a,b){return this._getTileInfoSupportError(a,b)||this._getTileInfoCompatibilityError(a,this.view.basemapTerrain.tilingScheme)};l._createClass(k,[{key:"hasMixedImageFormats",get:function(){return!0}}]);
return k}(z(x.TiledLayerView3D(w.LayerView3D(y))));h.__decorate([m.property({readOnly:!0})],d.prototype,"hasMixedImageFormats",null);h.__decorate([m.property()],d.prototype,"layer",void 0);h.__decorate([m.property()],d.prototype,"suspended",void 0);return d=h.__decorate([u.subclass("esri.views.3d.layers.WMTSLayerView3D")],d)});