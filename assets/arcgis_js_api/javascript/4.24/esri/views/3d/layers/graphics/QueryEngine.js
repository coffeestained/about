// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/graphics/data/QueryEngine ../../../../rest/support/FeatureSet ../../../../rest/support/Query ../../../../geometry/support/typeUtils".split(" "),
function(d,g,h,F,r,n,k,G,H,I,t,u,v,p,w,x){const y=v.QueryEngine;d.QueryEngine=function(q){function l(b){b=q.call(this,b)||this;b._dataQueryEngineInstance=null;return b}g._inheritsLoose(l,q);var e=l.prototype;e.destroy=function(){this.clear()};e.clear=function(){return this._dataQueryEngineInstance?(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0):!1};e.executeQueryForIdSet=function(){var b=g._asyncToGenerator(function*(a,c){return this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(a,
c))});return function(a,c){return b.apply(this,arguments)}}();e.executeQueryForCount=function(){var b=g._asyncToGenerator(function*(a,c){return this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(a),c)});return function(a,c){return b.apply(this,arguments)}}();e.executeQueryForExtent=function(){var b=g._asyncToGenerator(function*(a,c){const {count:f,extent:m}=yield this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(a),c);a=u.fromJSON(m);return{count:f,extent:a}});return function(a,
c){return b.apply(this,arguments)}}();e.executeQueryForIds=function(){var b=g._asyncToGenerator(function*(a,c){return this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(a),c)});return function(a,c){return b.apply(this,arguments)}}();e.executeQueryForLatestObservations=function(){var b=g._asyncToGenerator(function*(a,c){a=yield this.dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(a),c);a=p.fromJSON(a);a.features.forEach(f=>{f.layer=this.layer;f.sourceLayer=this.layer});
return a});return function(a,c){return b.apply(this,arguments)}}();e.executeQuery=function(){var b=g._asyncToGenerator(function*(a,c){a=yield this.dataQueryEngine.executeQuery(this._ensureQueryJSON(a),c);a=p.fromJSON(a);a.features.forEach(f=>{f.layer=this.layer;f.sourceLayer=this.layer});return a});return function(a,c){return b.apply(this,arguments)}}();e._ensureQueryJSON=function(b,a){let c=this.defaultQueryJSON;n.isSome(b)&&("outSpatialReference"in b&&!b.outSpatialReference&&(b.outSpatialReference=
this.spatialReference),c=b.toJSON());n.isSome(a)&&(c={...c,sceneFilter:{...a,geometry:a.geometry.toJSON()}});return c};e._ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const b="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,a=this.layer.objectIdField,c=x.featureGeometryTypeKebabDictionary.toJSON(this.queryGeometryType),f=this.layer.fields.map(z=>z.toJSON()),m=this.layerView.view.resourceController.scheduler,
A=this.priority,B=this.spatialReference.toJSON(),C=this.layerView.processor.featureStore,{hasZ:D,hasM:E}=this.layerView;return this._dataQueryEngineInstance=new y({hasZ:D,hasM:E,geometryType:c,fields:f,timeInfo:b,spatialReference:B,objectIdField:a,featureStore:C,scheduler:m,priority:A})};g._createClass(l,[{key:"queryGeometryType",get:function(){switch(this.layer.geometryType){case "multipoint":case "point":case "polygon":case "polyline":return this.layer.geometryType;case "mesh":return"polygon"}}},
{key:"defaultQueryJSON",get:function(){return(new w({outSpatialReference:this.spatialReference})).toJSON()}},{key:"dataQueryEngine",get:function(){return this._ensureDataQueryEngine()}}]);return l}(r);h.__decorate([k.property({constructOnly:!0})],d.QueryEngine.prototype,"layerView",void 0);h.__decorate([k.property({constructOnly:!0})],d.QueryEngine.prototype,"priority",void 0);h.__decorate([k.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],d.QueryEngine.prototype,"spatialReference",
void 0);h.__decorate([k.property({readOnly:!0,aliasOf:"layerView.layer"})],d.QueryEngine.prototype,"layer",void 0);h.__decorate([k.property({readOnly:!0})],d.QueryEngine.prototype,"queryGeometryType",null);h.__decorate([k.property({readOnly:!0})],d.QueryEngine.prototype,"defaultQueryJSON",null);d.QueryEngine=h.__decorate([t.subclass("esri.views.3d.layers.graphics.QueryEngine")],d.QueryEngine);Object.defineProperties(d,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});