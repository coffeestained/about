// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/Collection ../../../../core/HandleOwner ../../../../core/handleUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../core/accessorSupport/diffUtils ../../../../layers/Layer ../../../../layers/graphics/hydratedFeatures ../../../../renderers/support/renderingInfoUtils ../../../../rest/support/Query ../interfaces ./constants ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DFrustumVisibility ./Graphics3DObjectStates ./Graphics3DScaleVisibility ./graphicUtils ../../webgl-engine/lib/basicInterfaces".split(" "),
function(c,q,e,r,w,x,y,g,z,m,f,N,O,P,A,B,C,D,t,E,F,G,H,I,J,K,L,M,n){c.GraphicsProcessor=function(u){function p(a){a=u.call(this,a)||this;a.type="graphics-3d";a.graphicsCore=null;a.elevationAlignment=new I;a.drapeSourceType=F.DrapeSourceType.Features;a._suspendResumeExtent=null;return a}q._inheritsLoose(p,u);var h=p.prototype;h.normalizeCtorArgs=function(a){const b={...a,scaleVisibility:null,frustumVisibility:null};delete b.scaleVisibilityEnabled;delete b.frustumVisibilityEnabled;a.scaleVisibilityEnabled&&
(b.scaleVisibility=new L);a.frustumVisibilityEnabled&&(b.frustumVisibility=new J);return b};h.initialize=function(){const a=new H.Graphics3DCore({owner:this,layer:this.owner.layer,preferredUpdatePolicy:n.UpdatePolicy.SYNC,graphicSymbolSupported:!0});this._set("graphicsCore",a);const {layer:b,scaleVisibility:d}=this;g.isSome(d)&&"effectiveScaleRange"in b&&this.updatingHandles.add(()=>b.effectiveScaleRange,()=>d.layerMinMaxScaleChangeHandler());if("fullOpacity"in this.owner){const k=this.owner;this.updatingHandles.add(()=>
k.fullOpacity,()=>this.graphicsCore.opacityChange())}"elevationInfo"in b&&this.updatingHandles.add(()=>b.elevationInfo,(k,l)=>{B.diff(k,l)&&this.updatingHandles.addPromise(this.graphicsCore.elevationInfoChange())})};h.setup=function(){var a=q._asyncToGenerator(function*(){const b=(d,k,l)=>this.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(d,k,l);this.elevationAlignment.setup(this,b,this.graphicsCore,this.view.elevationProvider);g.isSome(this.scaleVisibility)&&"effectiveScaleRange"in this.layer&&
this.scaleVisibility.setup(this,this.layer,b,this.graphicsCore,this.owner.view.basemapTerrain);g.isSome(this.frustumVisibility)&&this.frustumVisibility.setup(this);this._set("objectStates",new K.Graphics3DObjectStates(this.graphicsCore));try{yield this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,objectStates:this.objectStates})}catch(d){if(z.isAbortError(d))return;throw d;}this.destroyed||(this.handles.add(m.watch(()=>this.view.clippingArea,
()=>this._updateClippingExtent(),m.sync)),this._updateClippingExtent(),this._setupSuspendResumeExtent(),this.graphicsCore.startCreateGraphics())});return function(){return a.apply(this,arguments)}}();h.destroy=function(){this.handles.removeAll();this.updatingHandles.removeAll();this._set("elevationAlignment",g.destroyMaybe(this.elevationAlignment));this._set("scaleVisibility",g.destroyMaybe(this.scaleVisibility));this._set("frustumVisibility",g.destroyMaybe(this.frustumVisibility));this._set("objectStates",
g.destroyMaybe(this.objectStates));this._set("graphicsCore",g.destroyMaybe(this.graphicsCore))};h.notifyGraphicGeometryChanged=function(a){this.graphicsCore.notifyGraphicGeometryChanged(a)};h.notifyGraphicVisibilityChanged=function(a){this.graphicsCore.notifyGraphicVisibilityChanged(a)};h.getRenderingInfo=function(a,b,d){a=t.getRenderingInfo(a,{renderer:b,arcade:d});g.isSome(a)&&a.color&&(b=a.color,b[0]/=255,b[1]/=255,b[2]/=255);return a};h.getRenderingInfoAsync=function(a,b,d,k){return t.getRenderingInfoAsync(a,
{renderer:b,arcade:d,...k})};h.getHit=function(a){if(this.owner.loadedGraphics){var b=this.owner.loadedGraphics.find(d=>d.uid===a);if(b)return b=D.hydrateGraphic(b,this.layer instanceof C?this.layer:null),{type:"graphic",graphic:b,layer:b.layer}}return null};h.whenGraphicBounds=function(a,b){return this.graphicsCore?this.graphicsCore.whenGraphicBounds(a,b):Promise.reject()};h.computeAttachmentOrigin=function(a,b){return this.graphicsCore?this.graphicsCore.computeAttachmentOrigin(a,b):null};h.getSymbolLayerSize=
function(a,b){return this.graphicsCore?this.graphicsCore.getSymbolLayerSize(a,b):null};h.maskOccludee=function(a){const {set:b,handle:d}=this.objectStates.acquireSet(n.Object3DState.MaskOccludee,null);this.objectStates.setUid(b,a.uid);return d};h.highlight=function(a){if(a instanceof E)return v;if("number"===typeof a||a instanceof r)return this.highlight([a]);a instanceof w&&(a=a.toArray());if(Array.isArray(a)&&0<a.length){if(a[0]instanceof r){a=a.map(k=>k.uid);const {set:b,handle:d}=this.objectStates.acquireSet(n.Object3DState.Highlight,
null);this.objectStates.setUids(b,a);return d}if("number"===typeof a[0]){const {set:b,handle:d}=this.objectStates.acquireSet(n.Object3DState.Highlight,null);this.objectStates.setObjectIds(b,a);return d}}return v};h._setupSuspendResumeExtent=function(){const {scaleVisibility:a,frustumVisibility:b}=this;if(!g.isNone(a)||!g.isNone(b)){var d=({computedExtent:k,extentPadding:l})=>{this._suspendResumeExtent=M.enlargeExtent(k,this._suspendResumeExtent,G.SUSPEND_RESUME_EXTENT_OPTIMISM,l);g.isSome(a)&&a.setExtent(this._suspendResumeExtent);
g.isSome(b)&&b.setExtent(this._suspendResumeExtent)};this.handles.add(m.watch(()=>{var k,l;return{computedExtent:null==(k=this.graphicsCore)?void 0:k.computedExtent,extentPadding:null==(l=this.graphicsCore)?void 0:l.extentPadding}},k=>d(k),m.syncAndInitial))}};h._updateClippingExtent=function(){this.graphicsCore.setClippingExtent(this.view.clippingArea,this.view.spatialReference)&&this.graphicsCore.recreateAllGraphics()};q._createClass(p,[{key:"layer",get:function(){return this.owner.layer}},{key:"view",
get:function(){return this.owner.view}},{key:"scaleVisibilitySuspended",get:function(){return!(!g.isSome(this.scaleVisibility)||!this.scaleVisibility.suspended)}},{key:"frustumVisibilitySuspended",get:function(){return!(!g.isSome(this.frustumVisibility)||!this.frustumVisibility.suspended)}},{key:"suspended",get:function(){var a;return null!=(a=this.owner.suspended)?a:!1}},{key:"updating",get:function(){var a;return!!(null!=(a=this.graphicsCore)&&a.updating||g.isSome(this.scaleVisibility)&&this.scaleVisibility.updating||
g.isSome(this.frustumVisibility)&&this.frustumVisibility.updating||this.updatingHandles.updating)}},{key:"graphics3DGraphics",get:function(){var a;return null==(a=this.graphicsCore)?void 0:a.graphics3DGraphics}},{key:"graphics3DGraphicsByObjectID",get:function(){var a;return null==(a=this.graphicsCore)?void 0:a.graphics3DGraphicsByObjectID}},{key:"loadedGraphics",get:function(){return this.owner.loadedGraphics}},{key:"fullOpacity",get:function(){var a;return null!=(a=this.owner.fullOpacity)?a:1}},
{key:"slicePlaneEnabled",get:function(){return this.owner.slicePlaneEnabled}},{key:"updatePolicy",get:function(){return this.owner.updatePolicy}}]);return p}(x.HandleOwner);e.__decorate([f.property()],c.GraphicsProcessor.prototype,"type",void 0);e.__decorate([f.property({constructOnly:!0})],c.GraphicsProcessor.prototype,"owner",void 0);e.__decorate([f.property()],c.GraphicsProcessor.prototype,"layer",null);e.__decorate([f.property()],c.GraphicsProcessor.prototype,"view",null);e.__decorate([f.property({constructOnly:!0})],
c.GraphicsProcessor.prototype,"graphicsCore",void 0);e.__decorate([f.property({constructOnly:!0})],c.GraphicsProcessor.prototype,"scaleVisibility",void 0);e.__decorate([f.property({constructOnly:!0})],c.GraphicsProcessor.prototype,"frustumVisibility",void 0);e.__decorate([f.property({readOnly:!0})],c.GraphicsProcessor.prototype,"elevationAlignment",void 0);e.__decorate([f.property({readOnly:!0})],c.GraphicsProcessor.prototype,"objectStates",void 0);e.__decorate([f.property({readOnly:!0})],c.GraphicsProcessor.prototype,
"scaleVisibilitySuspended",null);e.__decorate([f.property({readOnly:!0})],c.GraphicsProcessor.prototype,"frustumVisibilitySuspended",null);e.__decorate([f.property()],c.GraphicsProcessor.prototype,"suspended",null);e.__decorate([f.property({readOnly:!0})],c.GraphicsProcessor.prototype,"updating",null);e.__decorate([f.property()],c.GraphicsProcessor.prototype,"loadedGraphics",null);e.__decorate([f.property()],c.GraphicsProcessor.prototype,"fullOpacity",null);e.__decorate([f.property()],c.GraphicsProcessor.prototype,
"slicePlaneEnabled",null);e.__decorate([f.property()],c.GraphicsProcessor.prototype,"drapeSourceType",void 0);e.__decorate([f.property()],c.GraphicsProcessor.prototype,"updatePolicy",null);c.GraphicsProcessor=e.__decorate([A.subclass("esri.views.3d.layers.graphics.GraphicsProcessor")],c.GraphicsProcessor);const v=y.makeHandle();Object.defineProperties(c,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});