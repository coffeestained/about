// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define(["exports","../../../../core/lang","../../../../core/maybe","../support/attributeUtils"],function(y,C,z,A){function D(a,d){const b=d.edits.updateFeatures;if(!b||0===b.length)return new B;const k=E(d),g=new B;d=new Map;for(let c=0;c<a.attributeStorageInfo.length;c++)d.set(a.attributeStorageInfo[c].name,c);const q=a.fieldsIndex,l=a.objectIdField,u=b.filter(c=>{c=A.attributeLookup(q,c.attributes,l);return k.has(c)});a.forEachNode((c,e)=>{const v=new Set(e);for(const m of u){const n=A.attributeLookup(q,
m.attributes,l);if(!v.has(n))continue;const w=e.indexOf(n);for(const x in m.attributes){var p=a.fieldsIndex.normalizeFieldName(x);var f=g;var h=c.index,r=f.get(h);r?f=r:(r=new F,f.set(h,r),f=r);(h=f.get(p))?p=h:(h=[],f.set(p,h),p=h);p.push({featureIndex:w,featureId:n,value:m.attributes[x]})}}});return g}function E(a){const d=new Set;if(!a.updatedFeatures)return d;for(const b of a.updatedFeatures)null!=b.objectId&&null==b.error&&d.add(b.objectId);return d}const G={setAttribute(){},rollback(){},commit(){}};
var t;(function(a){a[a.EDITING=0]="EDITING";a[a.ROLLED_BACK=1]="ROLLED_BACK";a[a.COMMITTED=2]="COMMITTED"})(t||(t={}));const F=Map,B=Map;y.createInteractiveEditSession=function(a,d){const b=d.attributes[a.objectIdField];var k=a.sessions.get(b);if(k)return k;const g=C.clone(d.attributes),q=new Set;if(null==b)return G;const l=a.attributeOverrides.createInteractiveEditSession(b),u=new Map;let c=t.EDITING;k={setAttribute(e,v){if(c===t.EDITING){var p=a.fieldsIndex.get(e);if(!z.isNone(p)){var f=a.attributeStorageInfo.findIndex(m=>
m.name===p.name);if(!(0>f)){l.set(f,v);var h=a.attributeStorageInfo[f],r=!1;q.add(e);a.forEachNode((m,n)=>{var w=u.get(m);null==w?(n=n.indexOf(b),u.set(m,n)):n=w;if(-1!==n&&(w=a.getAttributeData(m.index))){const x=w[h.name];x&&(x[n]=v,a.setAttributeData(m.index,w,d),r=!0)}});r&&a.clearMemCache()}}}},rollback(){if(c===t.EDITING){for(const e of q)this.setAttribute(e,g[e]);l.rollback();c=t.ROLLED_BACK;a.sessions.delete(b)}},commit(){c===t.EDITING&&(l.commit(),c=t.COMMITTED,a.sessions.delete(b))}};a.sessions.set(b,
k);return k};y.processAttributeEdits=function(a,d){d=D(a,d);if(0!==d.size){var b=new Map;for(let g=0;g<a.attributeStorageInfo.length;g++)b.set(a.attributeStorageInfo[g].name,g);var k=!1;d.forEach((g,q)=>{const l=a.getAttributeData(q);let u=!1;g.forEach((c,e)=>{const v=z.isSome(l)?l[e]:null;e=b.get(e);for(const {featureIndex:p,value:f,featureId:h}of c)v&&(v[p]=f,k=u=!0),a.attributeOverrides.updateValue(h,e,f)});u&&a.setAttributeData(q,l,null)});k&&a.clearMemCache()}};Object.defineProperties(y,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})});