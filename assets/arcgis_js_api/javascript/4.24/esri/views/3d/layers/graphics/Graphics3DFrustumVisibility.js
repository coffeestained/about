// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projectionEllipsoid ../../support/FrustumExtentIntersection ../../../support/Scheduler".split(" "),function(l,k,e,t,f,
m,x,y,z,u,n,v,w){e=function(p){function g(){var a=p.apply(this,arguments)||this;a.suspended=!1;a.extent=null;a.extentIntersectionDirty=!0;a._isVisibleBelowSurface=!1;a.handles=new t;a.graphicsCoreOwner=null;a.updating=!0;return a}l._inheritsLoose(g,p);var c=g.prototype;c.setup=function(a){this.graphicsCoreOwner=a;this.extentIntersection=new v.FrustumExtentIntersection({renderCoordsHelper:a.view.renderCoordsHelper});const b=a.view,d=b.basemapTerrain;a=b.resourceController.scheduler;this.handles.add([b.on("resize",
()=>this._viewChange()),f.watch(()=>b.state.camera,()=>this._viewChange(),f.sync),a.registerTask(w.TaskPriority.FRUSTUM_VISIBILITY,this),d.on("elevation-bounds-change",()=>this._elevationBoundsChange())]);"local"===b.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([f.watch(()=>{var h,q,r;return[d.baseOpacity,d.wireframe,null==(h=b.map)?void 0:null==(q=h.ground)?void 0:null==(r=q.navigationConstraint)?void 0:r.type]},()=>this._updateIsVisibleBelowSurface(),f.initial)])};c.destroy=function(){this.extentIntersection=
this.extent=this.graphicsCoreOwner=null;this.handles&&(this.handles.destroy(),this.handles=null)};c._setDirty=function(){this.updating||this._set("updating",!0)};c.setExtent=function(a){this.extent=a;this.extentIntersectionDirty=!0;this._setDirty()};c._viewChange=function(){this._setDirty()};c._elevationBoundsChange=function(){this._setDirty();this.extentIntersectionDirty=!0};c._updateIsVisibleBelowSurface=function(){const a=this.graphicsCoreOwner.view,b=a.basemapTerrain,d=a.map.ground&&a.map.ground.navigationConstraint&&
"none"===a.map.ground.navigationConstraint.type;this.isVisibleBelowSurface="local"===a.viewingMode||!b.opaque||d};c._updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var a=this.graphicsCoreOwner.view;if(this._isVisibleBelowSurface)var b=-.3*n.getReferenceEllipsoid(a.spatialReference).radius;else{const {min:d,max:h}=a.basemapTerrain.elevationBounds;b=d-Math.max(1,(h-d)*(1.2-1))}this.extentIntersection.update(this.extent,a.spatialReference,b)}};c.runTask=
function(){this._set("updating",!1);if(this.extent){this._updateExtentIntersection();var a=this.graphicsCoreOwner.view.frustum,b=n.getReferenceEllipsoid(this.graphicsCoreOwner.view.spatialReference).radius;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(a,b))}else this._set("suspended",!1)};l._createClass(g,[{key:"isVisibleBelowSurface",set:function(a){this._isVisibleBelowSurface=a;this._setDirty();this.extentIntersectionDirty=!0}},{key:"running",get:function(){return this.updating}}]);
return g}(e);k.__decorate([m.property({readOnly:!0})],e.prototype,"suspended",void 0);k.__decorate([m.property({readOnly:!0})],e.prototype,"updating",void 0);return e=k.__decorate([u.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],e)});