// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/CollectionFlattener ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../rest/support/DirectionLine ../../../rest/support/DirectionPoint ../../../rest/support/PointBarrier ../../../rest/support/PolygonBarrier ../../../rest/support/PolylineBarrier ../../../rest/support/RouteInfo ../../../rest/support/Stop ./LayerView3D ./graphics/GraphicsProcessor ./support/projectExtentUtils ../support/EventedSet ../webgl-engine/lib/basicInterfaces ../../layers/LayerView".split(" "),
function(m,g,t,u,r,n,h,e,J,K,v,w,x,y,z,A,B,C,D,E,F,G,H,I){e=function(p){function q(){var a=p.apply(this,arguments)||this;a.type="route-3d";a.loadedGraphics=new G.EventedSet;a._byObjectID=new Map;a.slicePlaneEnabled=!1;a.fullExtentInLocalViewSpatialReference=null;return a}m._inheritsLoose(q,p);var d=q.prototype;d.initialize=function(){this._set("processor",new E.GraphicsProcessor({owner:this,scaleVisibilityEnabled:!0,frustumVisibilityEnabled:!0}));this.addResolvingPromise(this.processor.setup());this.updatingHandles.addOnCollectionChange(()=>
this._routeItems,a=>this._routeItemsChanged(a),n.initial);this.addResolvingPromise(F.toViewIfLocal(this).then(a=>this.fullExtentInLocalViewSpatialReference=a));this.handles.add(n.when(()=>{var a,b;return null==(a=this.view)?void 0:null==(b=a.basemapTerrain)?void 0:b.ready},()=>()=>this.notifyChange("updating"),{once:!0}))};d.destroy=function(){this.handles.removeAll();this.updatingHandles.removeAll();this._set("processor",r.destroyMaybe(this.processor))};d._routeItemsChanged=function(a){if(a.removed.length){this.loadedGraphics.removeMany(a.removed.map(b=>
{const c=this._byObjectID.get(b);this._byObjectID.delete(b);return c}));for(const b of a.removed)this.handles.remove(b)}if(a.added.length){this.loadedGraphics.addMany(a.added.map(b=>{const c=b.toGraphic();this._byObjectID.set(b,c);return c}));for(const b of a.added)this.handles.add([n.watch(()=>b.geometry,(c,f)=>{this._updateGraphic(b,"geometry",c,f)}),n.watch(()=>b.symbol,(c,f)=>{this._updateGraphic(b,"symbol",c,f)})],b)}};d.getSuspendInfo=function(){var a,b,c,f;const k=p.prototype.getSuspendInfo.call(this);
k.outsideScaleRange=null!=(a=null==(b=this.processor)?void 0:b.scaleVisibilitySuspended)?a:!1;k.outsideOfView=null!=(c=null==(f=this.processor)?void 0:f.frustumVisibilitySuspended)?c:!1;return k};d.fetchPopupFeatures=function(){var a=m._asyncToGenerator(function*(b,c){return r.isSome(c)?c.clientGraphics:null});return function(b,c){return a.apply(this,arguments)}}();d.getHit=function(a){return this.processor.getHit(a)};d.whenGraphicBounds=function(a,b){return this.processor.whenGraphicBounds(a,b)};
d.computeAttachmentOrigin=function(a,b){var c;return null==(c=this.processor)?void 0:c.computeAttachmentOrigin(a,b)};d.getSymbolLayerSize=function(a,b){return this.processor.getSymbolLayerSize(a,b)};d.queryGraphics=function(){var a=m._asyncToGenerator(function*(){return new t(this.loadedGraphics.toArray())});return function(){return a.apply(this,arguments)}}();d.maskOccludee=function(a){return this.processor.maskOccludee(a)};d.highlight=function(a){return a instanceof w||a instanceof x||a instanceof
y||a instanceof z||a instanceof A||a instanceof B||a instanceof C?(a=this._byObjectID.get(a),this.processor.highlight(a)):this.processor.highlight(a)};d.canResume=function(){var a;return p.prototype.canResume.call(this)&&!(null!=(a=this.processor)&&a.scaleVisibilitySuspended)};d.isUpdating=function(){var a,b,c;return!((null==(a=this.processor)||!a.updating)&&null!=(b=this.view)&&null!=(c=b.basemapTerrain)&&c.ready)};d._updateGraphic=function(a,b,c,f){var k;a=this._byObjectID.get(a);a[b]=c;l.graphic=
a;l.property=b;l.oldValue=f;l.newValue=c;null==(k=this.processor)?void 0:k.graphicsCore.graphicUpdateHandler(l)};m._createClass(q,[{key:"_routeItems",get:function(){return new u({getCollections:()=>[this.layer.pointBarriers,this.layer.polygonBarriers,this.layer.polylineBarriers,this.layer.stops,this.layer.directionLines,this.layer.directionPoints,r.isSome(this.layer.routeInfo)?new t([this.layer.routeInfo]):null]})}},{key:"legendEnabled",get:function(){var a;return this.canResume()&&!(null!=(a=this.processor)&&
a.frustumVisibilitySuspended)}},{key:"updatePolicy",get:function(){var a;return(null==(a=this.processor)?void 0:a.graphicsCore.effectiveUpdatePolicy)||H.UpdatePolicy.SYNC}},{key:"performanceInfo",get:function(){var a,b,c;return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:-1,totalNumberOfFeatures:-1,nodes:0,core:null,updating:this.updating,elevationUpdating:null!=(a=null==(b=this.processor)?void 0:b.elevationAlignment.updating)?a:!1,visibilityFrustum:!(null!=(c=this.processor)&&
c.frustumVisibilitySuspended)}}}]);return q}(D.LayerView3D(I));g.__decorate([h.property()],e.prototype,"_routeItems",null);g.__decorate([h.property()],e.prototype,"loadedGraphics",void 0);g.__decorate([h.property({readOnly:!0})],e.prototype,"legendEnabled",null);g.__decorate([h.property()],e.prototype,"layer",void 0);g.__decorate([h.property({readOnly:!0})],e.prototype,"processor",void 0);g.__decorate([h.property({type:Boolean})],e.prototype,"slicePlaneEnabled",void 0);e=g.__decorate([v.subclass("esri.views.3d.layers.RouteLayerView3D")],
e);const l={graphic:null,property:null,oldValue:null,newValue:null};return e});