// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Handles ../../../../../core/lang ../../../../../core/maybe ../../../../../core/reactiveUtils ../../../../../core/screenUtils ../../../../../chunks/vec3f64 ../../manipulatorUtils ../support/PickRequest ../../visualElements/LaserlineVisualElement ../../../webgl-engine/lib/GeometryUtil ../../../webgl-engine/lib/Intersector ../../../webgl-engine/lib/IntersectorInterfaces ../../../../interactive/ManipulatorCollection".split(" "),
function(m,u,v,w,d,k,x,n,p,y,z,A,B,C,D){function q(e,b){return{...e,...w.clone(b)}}function r(e,b,a,c){for(;e.length<b;)e.push(a());if(c)for(;e.length>b;)a=e.pop(),c(a);else e.length=b}const E={laserLineGlowColor:[1,.5,0],laserLineGlowWidth:8,laserLineGlowFalloff:8,laserLineInnerColor:[1,1,1],laserLineInnerWidth:1,laserLineGlobalAlpha:.75,laserLineEnabled:!0,handleColor:[1,.5,0],handleOpacity:.5,handleRadius:5,handleRadiusHovered:10,handleRadiusMouse:10,handleRadiusTouch:25,pathLineColor:[1,.5,0,
1],pathLineWidth:3,intersectingLineColor:[1,.2,0,1],perimeterLineColor:[1,.5,0,1],perimeterLineWidth:2,projectionLineColor:[1,.5,0,1],projectionLineWidth:2,projectionLineStippleSize:5,areaColor1:[1,.5,0,.5],areaColor2:[1,1,1,.5],fillColor:[1,.5,0,.5],lineSubdivisions:64,labelDistance:25};let t=function(){function e(a){this.vertexManipulators=[];this._analysisViewData=null;this._destroyed=!1;this._visible=this._isManipulatorsOwner=!0;this._listenerHandles=this._cursorManipulator=this._laserLine=null;
this._tempHandlePosition=n.create();const {analysisViewData:c,manipulators:f,toolState:h,view:g,visible:F}=a;this._analysisViewData=c;this._toolState=h;null!=f?(this._manipulators=f,this._isManipulatorsOwner=!1):this._manipulators=new D.ManipulatorCollection;this._view=g;a=this._style=q(E,a.style);this._intersector=B.newIntersector(g.state.viewingMode);this._intersector.options.store=C.StoreResults.MIN;const l=p.createSphereManipulator(g,a.handleColor,a.handleOpacity);l.available=!1;l.radius=a.handleRadius;
l.interactive=!1;this._manipulators.add(l);this._cursorManipulator=l;this._laserLine=new z.LaserlineVisualElement({view:g,attached:!0,style:{glowColor:a.laserLineGlowColor,glowWidth:a.laserLineGlowWidth,glowFalloff:a.laserLineGlowFalloff,innerColor:a.laserLineInnerColor,innerWidth:a.laserLineInnerWidth,globalAlpha:a.laserLineGlobalAlpha}});this._updateVisibility(F||!0)}var b=e.prototype;b.destroy=function(){this._listenerHandles=d.destroyMaybe(this._listenerHandles);this._manipulators=this._isManipulatorsOwner?
d.destroyMaybe(this._manipulators):null;this._laserLine=d.destroyMaybe(this._laserLine);this._destroyed=!0};b.show=function(){this._setVisibility(!0)};b.hide=function(){this._setVisibility(!1)};b._setVisibility=function(a){this._destroyed||this._visible===a||this._updateVisibility(a)};b._updateVisibility=function(a){this._visible=a;(this._laserLine.visible=a)?(this._initializeListeners(),this._updateAll()):(this._destroyListeners(),this.vertexManipulators.forEach(c=>{this._removeVertexManipulator(c.manipulator)}),
this.vertexManipulators=[],this._view.cursor=null)};b.vertexHandleAt=function(a,c){a=this._manipulators.intersect(a,c);return d.isSome(a)?a.manipulator.metadata:null};b.pick=function(a){var c=this._view.spatialReference;a=x.screenPointObjectToArray(a.screenPoint);this._view.sceneIntersectionHelper.intersectToolIntersectorScreen(a,this._intersector);const f=this._intersector.results.min;a=n.create();if(!f.getIntersectionPoint(a))return null;c=this._view.renderCoordsHelper.fromRenderCoords(a,c);return d.isNone(c)?
null:new y.PickResult(a,c)};b._updateAll=function(){this._visible&&(this._updateVertexManipulators(),this._updateLaserLine())};b._createVertexManipulator=function(){const a=p.createSphereManipulator(this._view,this._style.handleColor,this._style.handleOpacity);a.radius=this._style.handleRadius;return{id:this._manipulators.add(a),manipulator:a}};b._removeVertexManipulator=function(a){this._manipulators.remove(a)};b._updateVertexManipulators=function(){const {viewData:a}=this._analysisViewData,c=this._analysisViewData.path?
this._analysisViewData.path.vertices:[],f=this.vertexManipulators;r(f,c.length,()=>this._createVertexManipulator(),h=>this._removeVertexManipulator(h.manipulator));f.forEach((h,g)=>{h.manipulator.metadata=c[g];h.manipulator.renderLocation=a.positionsRenderCoords[g]});"drawing"===this._toolState.polygonState&&d.isSome(this._analysisViewData.cursorPoint)?(this._cursorManipulator.available=!0,this._cursorManipulator.location=this._analysisViewData.cursorPoint):this._cursorManipulator.available=!1};b._getFocusPoint=
function(){const {lastDraggedVertex:a}=this._analysisViewData;switch(this._toolState.polygonState){case "drawing":return d.isSome(this._analysisViewData.cursorPoint)?this._analysisViewData.cursorPoint:d.isSome(a)?this._analysisViewData.path.getVertexPositionAsPoint(a):d.unwrap(this._analysisViewData.path.lastPoint);case "editing":return d.isSome(a)?this._analysisViewData.path.getVertexPositionAsPoint(a):null;default:return this._analysisViewData.cursorPoint}};b._updateLaserLine=function(){var a=this._style.laserLineEnabled&&
"measured"!==this._toolState.polygonState&&this._toolState.active;const c=this._getFocusPoint();a&&d.isSome(c)?(a=this._tempHandlePosition,this._view.renderCoordsHelper.toRenderCoords(c,a),this._laserLine.heightManifoldTarget=a):this._laserLine.heightManifoldTarget=null};b._initializeListeners=function(){this._listenerHandles=new v;this._listenerHandles.add([k.watch(()=>this._toolState.polygonState,()=>this._updateLaserLine()),k.watch(()=>this._analysisViewData.viewData,()=>this._updateAll(),k.sync),
k.watch(()=>({lastDraggedVertex:this._analysisViewData.lastDraggedVertex,cursorPoint:this._analysisViewData.cursorPoint}),()=>this._updateLaserLine()),k.watch(()=>this._toolState.active,()=>this._updateAll())])};b._destroyListeners=function(){this._listenerHandles=d.destroyMaybe(this._listenerHandles)};u._createClass(e,[{key:"destroyed",get:function(){return this._destroyed}},{key:"visible",get:function(){return this._visible},set:function(a){a?this.show():this.hide()}},{key:"testData",get:function(){const a=
this._laserLine.testData;return{laserLineRenderer:d.isSome(a)?{heightManifoldEnabled:a.heightManifoldEnabled,heightManifoldTarget:a.heightManifoldTarget,pointDistanceEnabled:a.pointDistanceEnabled,pointDistanceOrigin:a.pointDistanceOrigin,pointDistanceTarget:a.pointDistanceTarget,lineVerticalPlaneEnabled:a.lineVerticalPlaneEnabled}:{heightManifoldEnabled:!1,heightManifoldTarget:null,pointDistanceEnabled:!1,pointDistanceOrigin:null,pointDistanceTarget:null,lineVerticalPlaneEnabled:!1}}}}]);return e}();
t._handleGeometry=A.createSphereGeometry(1,32,32);m.copyParameter=q;m.default=t;m.resizeArray=r;Object.defineProperties(m,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});