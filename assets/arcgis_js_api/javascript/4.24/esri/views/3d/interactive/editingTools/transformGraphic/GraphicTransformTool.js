// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Evented ../../../../../core/HandleOwner ../../../../../core/handleUtils ../../../../../core/maybe ../../../../../core/reactiveUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../geometry/Point ../../../../../support/elevationInfoUtils ../../../../ViewingMode ../../Manipulator3D ../../manipulatorUtils ../../SnappingVisualizer3D ../ManipulatorType ../manipulatorUtils ../visualElementUtils ../manipulations/config ../manipulations/MoveManipulation ./GraphicScaleRotateTransform ./ScaleRotateMeshAdapter ./ScaleRotateObjectSymbol3DAdapter ./undoRecords ../../../layers/graphics/GraphicState ../../../../interactive/InteractiveToolBase ../../../../interactive/editGeometry/EditGeometryOperations ../../../../interactive/sketch/SketchTooltipOptions ../../../../interactive/snapping/SnappingContext ../../../../interactive/snapping/SnappingDragPipelineStep ../../../../interactive/tooltip/Tooltip ../../../../interactive/tooltip/TranslateTooltipInfos ../../../../support/automaticLengthMeasurementUtils ../../../../support/euclideanLengthMeasurementUtils".split(" "),
function(d,w,f,H,I,J,b,m,g,fa,ha,ia,K,L,x,M,N,O,P,Q,y,R,S,n,T,U,V,W,X,Y,Z,z,aa,ba,ca,q,da,ea){d.GraphicTransformTool=function(A){function r(a){a=A.call(this,a)||this;a.enableZ=!0;a.enableRotation=!0;a.enableScaling=!0;a.tooltipOptions=new z;a.type="transform-3d";a._scaleRotate=null;a._snappingPipeline=new ba.SnappingPipeline;a._tooltip=null;return a}w._inheritsLoose(r,A);var e=r.prototype;e.initialize=function(){const {graphic:a,view:l}=this;this.graphicState=new X.GraphicState({graphic:a});this.own(m.watch(()=>
this.tooltipOptions.enabled,c=>{this._tooltip=c?new ca.Tooltip({view:l}):b.destroyMaybe(this._tooltip)},m.syncAndInitial));this._moveManipulation=new n.MoveManipulation({tool:this,view:l,snapToScene:this.snapToScene,xyAvailable:!0,xyAxisAvailable:!0,zAvailable:this.enableZ&&y.canMoveZ(a),radius:n.MoveManipulation.radiusForSymbol(a.symbol)});this._moveManipulation.forEachManipulator((c,t)=>this.handles.add([c.events.on("immediate-click",h=>{this.emit("immediate-click",{...h,graphic:a});h.stopPropagation()}),
c.events.on("focus-changed",({action:h})=>{const {tooltipOptions:p,_tooltip:k}=this;b.isNone(k)||(k.clear(),"focus"===h&&(k.info=new (t===Q.ManipulatorType.TRANSLATE_Z?q.TranslateZTooltipInfo:q.TranslateGraphicTooltipInfo)({tooltipOptions:p})))})]));this._moveManipulation.elevationInfo=x.getGraphicEffectiveElevationInfo(a);const B=a.geometry;this._moveManipulation.createGraphicDragPipeline((c,t,h,p,k)=>{b.isSome(B)&&c===n.ManipulationType.XY&&(h=h.next(this._snappingPipeline.createSnapDragEventPipelineStep({snappingContext:new aa.SnappingContext({elevationInfo:x.getGraphicEffectiveElevationInfo(a),
pointer:k,editGeometryOperations:Z.EditGeometryOperations.fromGeometry(new L({spatialReference:B.spatialReference}),l.state.viewingMode),visualizer:new P.SnappingVisualizer3D,excludeFeature:a}),snappingManager:this.snappingManager,updatingHandles:this.updatingHandles,cancel:p}),this._snappingPipeline.next));return h=h.next(u=>{const {tooltipOptions:C,_tooltip:v}=this;if(b.isNone(v))return u;const {mapStart:D,mapEnd:E}=u;v.clear();const F=c===n.ManipulationType.Z?q.TranslateZTooltipInfo:q.TranslateGraphicTooltipInfo;
if("end"===u.action)v.info=new F({tooltipOptions:C});else{const G=c===n.ManipulationType.Z?ea.verticalSignedDistanceBetweenPoints(D,E):da.autoHorizontalDistanceByElevationModeBetweenPoints(D,E,this.graphicState.isDraped?"on-the-ground":"absolute-height");b.isSome(G)&&(v.info=new F({tooltipOptions:C,distance:G}))}return u})},this.graphicState,c=>{const {action:t,graphic:h,dxScreen:p,dyScreen:k}=c;c={graphic:h,dxScreen:p,dyScreen:k};switch(t){case "start":this.emit("graphic-translate-start",c);this.emit("record-undo",
{record:this._createGeometryUndoRecord()});break;case "update":this.emit("graphic-translate",c);break;case "end":this.emit("graphic-translate-stop",c)}});this._moveManipulation.angle=b.isSome(this._scaleRotate)?this._scaleRotate.angle:0;this._scaleRotateAdapter=this._createScaleRotateAdapter();this.handles.add(m.watch(()=>this._scaleRotateAdapter.angle,()=>this._updateMoveAngle()));if(this.enableScaling||this.enableRotation)this._scaleRotate=new T.GraphicScaleRotateTransform({tool:this,mode:this.enableScaling&&
this.enableRotation?null:this.enableScaling?"scale":"rotate",adapter:this._scaleRotateAdapter,tooltipOptions:this.tooltipOptions}),this.handles.add(this._scaleRotate.events.on("scale-changed",()=>this._onScaleChanged()));this.handles.add([R.createVisualElements({view:this.view,graphic:this.graphic,forEachManipulator:c=>this._forEachManipulator(c),onManipulatorsChanged:()=>J.makeHandle()}),this.graphicState.on("changed",()=>this._onGeometryChanged()),this._hideManipulatorsForGraphicState(),m.watch(()=>
l.scale,()=>this._updateMoveAngle())]);this.handles.add(this.view.trackGraphicState(this.graphicState));this._onGeometryChanged();this._updateMoveAngle();this._forEachManipulator(c=>{c instanceof N.Manipulator3D&&this.handles.add(c.events.on("grab-changed",()=>this._updateManipulatorsInteractive()))});this.finishToolCreation()};e.destroy=function(){this._tooltip=b.destroyMaybe(this._tooltip);this._moveManipulation.destroy();this._scaleRotate=b.destroyMaybe(this._scaleRotate);this._scaleRotateAdapter=
b.destroyMaybe(this._scaleRotateAdapter);this._set("view",null);this._set("graphic",null)};e._updateManipulatorsInteractive=function(){b.isNone(this._scaleRotate)||(this._scaleRotate.interactive=!this._moveManipulation.grabbing,this._moveManipulation.interactive=!this._scaleRotate.grabbing)};e._createScaleRotateAdapter=function(){return b.isSome(this.graphic.geometry)&&"mesh"===this.graphic.geometry.type?new U.ScaleRotateMeshAdapter({graphic:this.graphic,geometry:this.graphic.geometry,viewingMode:this.view.state.viewingMode}):
new V.ScaleRotateObjectSymbol3DAdapter({graphic:this.graphic,sizeFilter:a=>this._enforceNonZeroSize(a),findLayerView:()=>this.view.allLayerViews.find(a=>a.layer===this.graphic.layer),sizeAxis:b.isSome(this.tooltipOptions.visualVariables)&&b.isSome(this.tooltipOptions.visualVariables.size)?this.tooltipOptions.visualVariables.size.axis:null})};e._forEachManipulator=function(a){this._moveManipulation.forEachManipulator(a);b.isSome(this._scaleRotate)&&this._scaleRotate.forEachManipulator(a)};e._hideManipulatorsForGraphicState=
function(){return m.watch(()=>this.graphicState.displaying,a=>{this._forEachManipulator(l=>l.available=a);this._moveManipulation.zManipulation.available=a&&this.enableZ&&y.canMoveZ(this.graphic)})};e._createGeometryUndoRecord=function(){return W.createGraphicGeometryUndoRecord(this.graphic)};e.reset=function(){};e.onHide=function(){b.isSome(this._scaleRotate)&&this._scaleRotate.cancelActiveAnimation()};e._onScaleChanged=function(){if(!b.isNone(this._scaleRotate)){var a=this._scaleRotate.getScale();
this._moveManipulation.displayScale=a}};e._updateMoveAngle=function(){this._moveManipulation.angle=this.view.state.viewingMode===M.ViewingMode.Local||this.view.scale<S.ALIGN_ARROWS_SCALE_THRESHOLD?this._scaleRotateAdapter.angle:0};e._onGeometryChanged=function(){O.placeAtGraphic(this.view,this,this.graphic)};e._enforceNonZeroSize=function(a){return a||this.view.state.camera.computeRenderPixelSizeAt(this._moveManipulation.renderLocation)};w._createClass(r,[{key:"snapToScene",set:function(a){this._moveManipulation&&
(this._moveManipulation.snapToScene=a);this._set("snapToScene",a)}},{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"location",set:function(a){this._moveManipulation.location=a;b.isSome(this._scaleRotate)&&(this._scaleRotate.location=a)}},{key:"elevationAlignedLocation",set:function(a){this._moveManipulation.elevationAlignedLocation=a;b.isSome(this._scaleRotate)&&(this._scaleRotate.elevationAlignedLocation=a)}},{key:"test",get:function(){return{discManipulator:this._moveManipulation.xyManipulation.test.discManipulator,
zManipulator:this._moveManipulation.zManipulation.test.manipulator,ringManipulator:b.isSome(this._scaleRotate)?this._scaleRotate.test.ringManipulator:null,arrowManipulators:this._moveManipulation.xyAxisManipulation.test.arrowManipulators,scaleRotateAdapter:this._scaleRotateAdapter,scaleRotateTransform:this._scaleRotate,tooltip:this._tooltip}}}]);return r}(I.HandleOwnerMixin(H.EventedMixin(Y.InteractiveToolBase)));f.__decorate([g.property({constructOnly:!0,nonNullable:!0})],d.GraphicTransformTool.prototype,
"view",void 0);f.__decorate([g.property({constructOnly:!0,nonNullable:!0})],d.GraphicTransformTool.prototype,"graphic",void 0);f.__decorate([g.property({constructOnly:!0,nonNullable:!0})],d.GraphicTransformTool.prototype,"enableZ",void 0);f.__decorate([g.property()],d.GraphicTransformTool.prototype,"enableRotation",void 0);f.__decorate([g.property()],d.GraphicTransformTool.prototype,"enableScaling",void 0);f.__decorate([g.property({constructOnly:!0,type:z})],d.GraphicTransformTool.prototype,"tooltipOptions",
void 0);f.__decorate([g.property()],d.GraphicTransformTool.prototype,"graphicState",void 0);f.__decorate([g.property({value:!1})],d.GraphicTransformTool.prototype,"snapToScene",null);f.__decorate([g.property({constructOnly:!0})],d.GraphicTransformTool.prototype,"snappingManager",void 0);f.__decorate([g.property({readOnly:!0})],d.GraphicTransformTool.prototype,"type",void 0);f.__decorate([g.property({readOnly:!0})],d.GraphicTransformTool.prototype,"updating",null);d.GraphicTransformTool=f.__decorate([K.subclass("esri.views.3d.interactive.editingTools.graphicTransform3D.GraphicTransformTool")],
d.GraphicTransformTool);Object.defineProperties(d,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});