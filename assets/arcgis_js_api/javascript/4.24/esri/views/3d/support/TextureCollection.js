// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../support/Scheduler".split(" "),function(e,l,h,p,q,m,t,u,v,r,n){e.TextureCollection=function(k){function f(a,b){var g;var c=k.call(this,{})||this;c._stage=a;c._textureRequests=new Map;c._frameTask=
null!=(g=null==b?void 0:b.registerTask(n.TaskPriority.TEXTURE_UNLOAD))?g:n.ImmediateTask;return c}l._inheritsLoose(f,k);var d=f.prototype;d.normalizeCtorArgs=function(){return{}};d.destroy=function(){k.prototype.destroy.call(this);this._frameTask.remove();this._textureRequests.forEach(a=>this._releaseTextureRequest(a));this._textureRequests.clear()};d.fromData=function(a,b,g){const c=this.makeUid(a);a=this._textureRequests.get(c);a||(a={referenceCount:0,texture:b(),textureAsync:null,abortController:null,
onRemove:g},this._stage&&(this._stage.add(a.texture),this._stage.loadImmediate(a.texture)),this._textureRequests.set(c,a));a.referenceCount++;return{uid:c,texture:a.texture,release:()=>this._release(c)}};d._release=function(a){const b=this._textureRequests.get(a);b?(1>b.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+a),b.referenceCount--,1>b.referenceCount&&this._frameTask.schedule(()=>this._releaseNow(a))):console.warn(`TextureCollection: texture doesn't exist: '${a}'`)};
d._releaseNow=function(a){if(this._textureRequests){var b=this._textureRequests.get(a);!b||0<b.referenceCount||(this._releaseTextureRequest(b),this._textureRequests.delete(a))}};d._releaseTextureRequest=function(a){if(a.onRemove)a.onRemove();if(a.texture){var b;null==(b=this._stage)?void 0:b.remove(a.texture)}else a.abortController&&(a.abortController.abort(),a.abortController=null)};d.makeUid=function(a,b=null){return q.isSome(b)?`${a}.${b}px`:a};l._createClass(f,[{key:"updating",get:function(){return this._frameTask.updating}},
{key:"test",get:function(){return{textureRequests:this._textureRequests}}}]);return f}(p);h.__decorate([m.property()],e.TextureCollection.prototype,"_frameTask",void 0);h.__decorate([m.property()],e.TextureCollection.prototype,"updating",null);e.TextureCollection=h.__decorate([r.subclass("esri.views.3d.support.TextureCollection")],e.TextureCollection);Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});