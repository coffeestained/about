// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/support/clipRay ../../../geometry/support/frustum ../../../geometry/support/lineSegment ../../../geometry/support/plane ../../../geometry/support/ray ../../../chunks/sphere ./LaserlinePathData ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/RenderSlot ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/shaders/LaserlinePathTechnique ../webgl-engine/shaders/LaserlinePathTechniqueConfiguration ../webgl-engine/shaders/LaserlineTechnique ../webgl-engine/shaders/LaserlineTechniqueConfiguration ../../webgl/enums".split(" "),
function(t,D,r,h,e,g,u,v,p,E,k,w,F,G,x,H,y,z,I,J,K,L,M){function A(l,f,a,c){const b=N,d=O;e.transformMat4(b,f,c);e.copy(d,a);d[3]=0;u.transformMat4(d,d,c);w.fromPositionAndNormal(b,d,l)}const N=g.create(),O=v.create(),P={glowColor:[1,.5,0],glowWidth:8,glowFalloff:8,innerColor:[1,1,1],innerWidth:1,globalAlpha:.75,angleCutoff:r.deg2rad(6),globalAlphaContrastBoost:2,__tagStrict:"NoParameters"};r=function(){function l(a,c={},b={contrastControlEnabled:!1}){this._renderCoordsHelper=a;this._config=b;this._technique=
null;this._heightManifoldEnabled=!1;this._heightManifoldTarget=g.create();this._pointDistanceEnabled=!1;this._pointDistanceOrigin=g.create();this._pointDistanceTarget=g.create();this._lineVerticalPlaneEnabled=!1;this._lineVerticalPlaneSegment=k.create();this._intersectsLineEnabled=!1;this._intersectsLineSegment=k.create();this._intersectsLineRadius=3;this._pathVerticalPlaneEnabled=this._intersectsLineInfinite=!1;this._pathTechnique=this._pathVerticalPlaneData=null;this.canRender=!0;this._tempNormal=
g.create();this._tempDir=g.create();this._tempUp=g.create();this._tempVec3A=g.create();this._tempVec3B=g.create();this._tempVec4=v.create();this._tempPlane=w.create();this._tempSphere=G.create();this._parameters=z.copyParameters(c,P)}var f=l.prototype;f.setParameters=function(a){z.updateParameters(this._parameters,a)&&this._requestRender()};f.initializeRenderContext=function(a){this._context=a;this._quadVAO=H.createQuadVAO(a.renderContext.rctx);this._techniqueRepository=a.shaderTechniqueRepository;
this._techniqueConfig=new L.LaserlineTechniqueConfiguration;a=new J.LaserlinePathTechniqueConfiguration;a.contrastControlEnabled=this._config.contrastControlEnabled;this._pathTechnique=this._techniqueRepository.acquire(I.LaserlinePathTechnique,a)};f.uninitializeRenderContext=function(){this._quadVAO=h.disposeMaybe(this._quadVAO);this._technique=h.releaseMaybe(this._technique);this._pathVerticalPlaneData=h.disposeMaybe(this._pathVerticalPlaneData);this._pathTechnique=h.releaseMaybe(this._pathTechnique)};
f.prepareTechnique=function(){return this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled?(this._techniqueConfig.heightManifoldEnabled=this.heightManifoldEnabled,this._techniqueConfig.lineVerticalPlaneEnabled=this.lineVerticalPlaneEnabled,this._techniqueConfig.pointDistanceEnabled=this.pointDistanceEnabled,this._techniqueConfig.intersectsLineEnabled=this.intersectsLineEnabled,this._techniqueConfig.contrastControlEnabled=this._config.contrastControlEnabled,
this._technique=this._techniqueRepository.releaseAndAcquire(K.LaserlineTechnique,this._techniqueConfig,this._technique)):this._pathTechnique};f.render=function(a,c){(this.heightManifoldEnabled||this.pointDistanceEnabled||this.lineVerticalPlaneSegment||this.intersectsLineEnabled)&&this._renderUnified(a,c);this.pathVerticalPlaneEnabled&&this._renderPath(a)};f._renderUnified=function(a,c){const b=a.rctx;c=b.bindTechnique(c,this._parameters,a.bindParameters);this._bindGlobalUniforms(a,c);this._bindHeightManifoldUniforms(a,
c);this._bindPointDistanceUniforms(a,c);this._bindLineVerticalPlaneUniforms(a,c);this._bindIntersectsLineUniforms(a,c);b.bindVAO(this._quadVAO);b.drawArrays(M.PrimitiveType.TRIANGLE_STRIP,0,4)};f._renderPath=function(a){if(!h.isNone(this._pathVerticalPlaneData)&&!h.isNone(this._pathTechnique)){var c=a.rctx.bindTechnique(this._pathTechnique,{...this._parameters,origin:this._pathVerticalPlaneData.origin},a.bindParameters);this._bindGlobalUniforms(a,c);this._pathVerticalPlaneData.draw(a.rctx)}};f._bindHeightManifoldUniforms=
function(a,c){if(this.heightManifoldEnabled){var b=this._tempVec3A,d=this._tempPlane;a=a.bindParameters.camera;this._renderCoordsHelper.worldUpAtPosition(this._heightManifoldTarget,b);A(d,this._heightManifoldTarget,b,a.viewMatrix);c.setUniform4fv("heightPlane",d)}};f._bindPointDistanceUniforms=function(a,c){if(this._pointDistanceEnabled){a=a.bindParameters.camera;var b=this._tempSphere;e.copy(b,this._pointDistanceOrigin);e.transformMat4(b,b,a.viewMatrix);b[3]=e.distance(this._pointDistanceOrigin,
this._pointDistanceTarget);c.setUniform4f("pointDistanceSphere",b[0],b[1],b[2],b[3])}};f._bindLineVerticalPlaneUniforms=function(a,c){if(this._lineVerticalPlaneEnabled){var b=this._renderCoordsHelper;a=a.bindParameters.camera;var d=this._tempPlane,m=this._tempVec3A,B=this._tempUp,C=this._tempDir,q=this._tempNormal;k.pointAt(this._lineVerticalPlaneSegment,.5,m);b.worldUpAtPosition(m,B);e.normalize(C,this._lineVerticalPlaneSegment.vector);e.cross(q,B,C);e.normalize(q,q);A(d,this._lineVerticalPlaneSegment.origin,
q,a.viewMatrix);c.setUniform4fv("lineVerticalPlane",d);d=this._tempVec3A;e.copy(d,this._lineVerticalPlaneSegment.origin);b.setAltitude(d,0);e.transformMat4(d,d,a.viewMatrix);c.setUniform3fv("lineVerticalStart",d);d=this._tempVec3B;e.add(d,this._lineVerticalPlaneSegment.origin,this._lineVerticalPlaneSegment.vector);b.setAltitude(d,0);e.transformMat4(d,d,a.viewMatrix);c.setUniform3fv("lineVerticalEnd",d)}};f._bindIntersectsLineUniforms=function(a,c){if(this._intersectsLineEnabled){var b=Q,d=R;a=a.bindParameters.camera;
if(this._intersectsLineInfinite){p.fromRay(F.wrap(this._intersectsLineSegment.origin,this._intersectsLineSegment.vector),n);n.c0=-Number.MAX_VALUE;if(!E.intersectClipRay(a.frustum,n))return;p.getStart(n,b);p.getEnd(n,d)}else e.copy(b,this._intersectsLineSegment.origin),e.add(d,this._intersectsLineSegment.origin,this._intersectsLineSegment.vector);var m=this._tempVec3A;e.transformMat4(m,b,a.viewMatrix);c.setUniform3fv("intersectsLineStart",m);b=this._tempVec4;e.copy(b,this._intersectsLineSegment.vector);
this._tempVec4[3]=0;u.transformMat4(this._tempVec4,this._tempVec4,a.viewMatrix);e.transformMat4(d,d,a.viewMatrix);c.setUniform3fv("intersectsLineEnd",d);e.normalize(b,b);c.setUniform3f("intersectsLineDirection",b[0],b[1],b[2]);c.setUniform1f("intersectsLineRadius",this._intersectsLineRadius)}};f._bindGlobalUniforms=function(a,c){const b=a.bindParameters.camera;this._heightManifoldEnabled?c.setUniform1f("maxPixelDistance",2*b.computeScreenPixelSizeAt(this._heightManifoldTarget)):this._pointDistanceEnabled?
c.setUniform1f("maxPixelDistance",2*b.computeScreenPixelSizeAt(this._pointDistanceTarget)):this._lineVerticalPlaneEnabled&&c.setUniform1f("maxPixelDistance",2*b.computeScreenPixelSizeAt(this._lineVerticalPlaneSegment.origin));c.bindTexture("frameColor",a.offscreenRenderingHelper.mainColorTexture)};f._requestRender=function(){this._context&&this._context.requestRender()};D._createClass(l,[{key:"renderSlots",get:function(){return[this._config.contrastControlEnabled?y.RenderSlot.LASERLINES_CONTRAST_CONTROL:
y.RenderSlot.LASERLINES]}},{key:"needsLinearDepth",get:function(){return!0}},{key:"heightManifoldEnabled",get:function(){return this._heightManifoldEnabled},set:function(a){this._heightManifoldEnabled!==a&&(this._heightManifoldEnabled=a,this._requestRender())}},{key:"heightManifoldTarget",get:function(){return this._heightManifoldTarget},set:function(a){e.copy(this._heightManifoldTarget,a);this._requestRender()}},{key:"pointDistanceEnabled",get:function(){return this._pointDistanceEnabled},set:function(a){a!==
this._pointDistanceEnabled&&(this._pointDistanceEnabled=a,this._requestRender())}},{key:"pointDistanceTarget",get:function(){return this._pointDistanceTarget},set:function(a){e.copy(this._pointDistanceTarget,a);this._requestRender()}},{key:"pointDistanceOrigin",get:function(){return this._pointDistanceOrigin},set:function(a){e.copy(this._pointDistanceOrigin,a);this._requestRender()}},{key:"lineVerticalPlaneEnabled",get:function(){return this._lineVerticalPlaneEnabled},set:function(a){a!==this._lineVerticalPlaneEnabled&&
(this._lineVerticalPlaneEnabled=a,this._requestRender())}},{key:"lineVerticalPlaneSegment",get:function(){return this._lineVerticalPlaneSegment},set:function(a){k.copy(a,this._lineVerticalPlaneSegment);this._requestRender()}},{key:"intersectsLineEnabled",get:function(){return this._intersectsLineEnabled},set:function(a){a!==this._intersectsLineEnabled&&(this._intersectsLineEnabled=a,this._requestRender())}},{key:"intersectsLineSegment",get:function(){return this._intersectsLineSegment},set:function(a){k.copy(a,
this._intersectsLineSegment);this._requestRender()}},{key:"intersectsLineRadius",get:function(){return this._intersectsLineRadius},set:function(a){a!==this._intersectsLineRadius&&(this._intersectsLineRadius=a,this._requestRender())}},{key:"intersectsLineInfinite",get:function(){return this._intersectsLineInfinite},set:function(a){a!==this._intersectsLineInfinite&&(this._intersectsLineInfinite=a,this._requestRender())}},{key:"pathVerticalPlaneEnabled",get:function(){return this._pathVerticalPlaneEnabled},
set:function(a){a!==this._pathVerticalPlaneEnabled&&(this._pathVerticalPlaneEnabled=a,h.isSome(this._pathVerticalPlaneData)&&this._requestRender())}},{key:"pathVerticalPlaneVertices",set:function(a){h.isNone(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=new x.LaserlinePathData(this._renderCoordsHelper));this._pathVerticalPlaneData.vertices=a;this.pathVerticalPlaneEnabled&&this._requestRender()}},{key:"pathVerticalPlaneBuffers",set:function(a){h.isNone(this._pathVerticalPlaneData)&&(this._pathVerticalPlaneData=
new x.LaserlinePathData(this._renderCoordsHelper));this._pathVerticalPlaneData.buffers=a;this.pathVerticalPlaneEnabled&&this._requestRender()}}]);return l}();const n=p.create(),Q=g.create(),R=g.create();t.LaserLineRenderer=r;Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});