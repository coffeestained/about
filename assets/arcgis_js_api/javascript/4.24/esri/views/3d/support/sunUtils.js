// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../ViewingMode ../../../chunks/SunCalc ./mathUtils".split(" "),function(E,F,C,S,p,r,M,B,ba){function T(c,h,l,e){const k=ca,g=C.identity(da);if(l===M.ViewingMode.Global)B.SunCalc.getPosition(c,0,0,k),p.set(e,0,0,-1),C.rotateX(g,g,-k.azimuth),C.rotateY(g,g,-k.altitude);else{var b=x.planarDirection;l=b.globalAngles;b=(Math.abs(h[2])-b.localAltitude)/(b.globalAltitude-b.localAltitude);
b=F.clamp(b,0,1);1>b?(B.SunCalc.getPosition(c,h[1],h[0],k),k.azimuth=(1-b)*k.azimuth+b*l.azimuth,k.altitude=(1-b)*k.altitude+b*l.altitude):(k.azimuth=l.azimuth,k.altitude=l.altitude);p.set(e,0,-1,0);C.rotateZ(g,g,-k.azimuth);C.rotateX(g,g,-k.altitude)}p.transformMat4(e,e,g)}function U(c){switch(c){case "disabled":case "sunny":return{direct:1,ambient:1};case "cloudy":return{direct:1,ambient:1};case "rainy":return{direct:.4,ambient:1.2};case "snowy":return{direct:.5,ambient:1.3};case "foggy":return{direct:.2,
ambient:1.6}}}function V(c,h){const l=(c[0]+c[1]+c[2])/3;for(let e=0;3>e;e++)c[e]+=(l-c[e])*h;return c}function m(c,h,l,e){const k=[];for(let g=0;g<l.length;g++)k[g]=(e[g]-l[g])*c/h+l[g];return k}const x={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8E5,ambient:.015,direct:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}},ea=r.fromValues(.5773502691896258,
-.5773502691896258,.5773502691896258),da=S.create(),ca={azimuth:0,altitude:0},W=new Date(0),X=S.create(),N=r.create(),O=r.create(),fa=r.create();E.ColorAndIntensity=function(){this.ambient={color:r.fromValues(1,1,1),intensity:.55};this.direct={color:r.fromValues(1,1,1),intensity:.55,directionToLightSource:r.clone(ea)};this.noonFactor=.5;this.globalFactor=0;this.environmentStrength=this.specularStrength=1};E.computeColorAndIntensity=function(c,h,l,e,k,g,b){p.set(b.ambient.color,1,1,1);b.ambient.intensity=
x.global.ambient;p.set(b.direct.color,1,1,1);b.direct.intensity=x.global.direct;var t=F.clamp((Math.abs(h[2])-x.local.altitude)/(x.global.altitude-x.local.altitude),0,1);b.globalFactor=t;var y;"sun"===g&&(y=B.SunCalc.getTimes(c,h[1],h[0]));if(1>t){if("sun"===g){{var n=y;var a=c.valueOf();if(n.polarException===B.SunCalc.PolarException.MIDNIGHT_SUN){var q=a-36E5*(c.getHours()+48)-6E4*c.getMinutes();var f=q+432E6}else n.polarException===B.SunCalc.PolarException.POLAR_NIGHT?(q=a-2,f=a-1):(q=n.sunrise.valueOf(),
f=n.sunset.valueOf());var z=f-q;n=q+z/2;var u=z/4;var v=n-u;u=n+u;var A=.06*z;z=q-A/2;q+=A/2;const D=f-A/2,P=f+A/2;f=x.local;A=[.01,f.ambientAtNight];const Q=[.8,.8,1],R=[.01,.01,.01],G=[f.directAtTwilight,f.ambientAtTwilight],H=[1,.6,.5],I=[.8,.8,1],J=[.9*f.directAtNoon,f.ambientAtNoon],K=[1,.98,.98],L=[.98,.98,1],Y=[f.directAtNoon,f.ambientAtNoon],Z=[1,1,1],aa=[1,1,1];f=[0,0];let w=[0,0,0];var d=[0,0,0];a<z||a>P?(f=A,w=R,d=Q):a<q?(d=q-z,f=m(a-z,d,A,G),w=m(a-z,d,R,H),d=m(a-z,d,Q,I)):a<v?(d=v-q,f=
m(a-q,d,G,J),w=m(a-q,d,H,K),d=m(a-q,d,I,L)):a<n?(d=n-v,f=m(a-v,d,J,Y),w=m(a-v,d,K,Z),d=m(a-v,d,L,aa)):a<u?(d=u-n,f=m(a-n,d,Y,J),w=m(a-n,d,Z,K),d=m(a-n,d,aa,L)):a<D?(d=D-u,f=m(a-u,d,J,G),w=m(a-u,d,K,H),d=m(a-u,d,L,I)):a<P&&(d=P-D,f=m(a-D,d,G,A),w=m(a-D,d,H,R),d=m(a-D,d,I,Q));a=0;switch(e){case "rainy":case "foggy":a=.9;case "snowy":a=.5}0<a&&(w=V(w,a),d=V(d,a));n=r.fromValues(w[0],w[1],w[2]);v=r.fromValues(d[0],d[1],d[2]);u=U(e);a=f[0]*u.direct;f=f[1]*u.ambient}}else v=U(e),a=x.local.directAtNoon*
v.direct,n=r.fromValues(1,1,1),f=x.local.ambientAtNoon*v.ambient,v=r.fromValues(1,1,1);p.lerp(b.ambient.color,v,b.ambient.color,t);b.ambient.intensity=F.lerp(f,b.ambient.intensity,t);p.lerp(b.direct.color,n,b.direct.color,t);b.direct.intensity=F.lerp(a,b.direct.intensity,t);b.specularStrength="rainy"===e||"snowy"===e||"foggy"===e?0:1;b.environmentStrength="rainy"===e?.7:"snowy"===e||"foggy"===e?.75:1}"sun"===g?(e=c.valueOf(),y.polarException===B.SunCalc.PolarException.MIDNIGHT_SUN?(t=e-36E5*(c.getHours()+
48)-6E4*c.getMinutes(),y=t+432E6):y.polarException===B.SunCalc.PolarException.POLAR_NIGHT?(t=e-2,y=e-1):(t=y.sunrise.valueOf(),y=y.sunset.valueOf()),e=1-F.clamp(Math.abs(e-(t+(y-t)/2))/432E5,0,1)):e=1;b.noonFactor=e;"sun"===g?T(c,h,l,b.direct.directionToLightSource):(c=b.direct.directionToLightSource,l===M.ViewingMode.Global?p.normalize(N,k.eye):p.set(N,0,0,1),p.scale(O,k.viewForward,-1),l=ba.angle(O,N),h=Math.max(l-.5,0),C.fromRotation(X,-Math.max(.25,l-.25-.85*h/(h+1)),k.viewRight),p.transformMat4(c,
O,X),p.add(c,c,p.scale(fa,k.viewRight,.2)),p.normalize(c,c))};E.computeDirectionsOverTime=function(c,h,l,e,k){c=c.getTime();h=h.getTime()-c;h=Math.floor(h/l)+1;const g=Array(h);for(let b=0;b<h;++b)W.setTime(c+l*b),g[b]=r.create(),T(W,e,k,g[b]);return g};E.computeShadowsEnabled=function(c,h){return h===M.ViewingMode.Global?!0:Math.abs(c)<x.planarDirection.localAltitude};Object.defineProperties(E,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});