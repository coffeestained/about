// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/shading/Normals.glsl ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/PathGeometry ../lib/RenderPass ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./PathTechnique ./internal/bufferWriterUtils ./internal/MaterialUtil".split(" "),
function(t,u,z,A,G,H,I,l,v,J,K,w,L,x,y,M,h,q,B,N){w=function(k){function e(a){a=k.call(this,a,new C)||this;a.supportsEdges=!0;a._vertexAttributeLocations=q.pathVertexAttributeLocations;a._configuration=new q.PathTechniqueConfiguration;a.vertexBufferLayout=e.getVertexBufferLayout(a.parameters);return a}u._inheritsLoose(e,k);var b=e.prototype;b.getConfiguration=function(a,c){this._configuration.output=a;this._configuration.vvSize=this.parameters.vvSizeEnabled;this._configuration.vvColor=this.parameters.vvColorEnabled;
this._configuration.vvOpacity=this.parameters.vvOpacityEnabled;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=this.parameters.transparent;this._configuration.hasOccludees=this.parameters.hasOccludees;if(a===l.ShaderOutput.Color||a===l.ShaderOutput.Alpha)this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?v.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?
v.NormalsDoubleSidedMode.WindingOrder:v.NormalsDoubleSidedMode.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=c.ssaoHelper.ready?this.parameters.receiveSSAO:!1;this._configuration.transparencyPassType=c.transparencyPassType;this._configuration.hasMultipassTerrain=c.multipassTerrain.enabled;this._configuration.cullAboveGround=c.multipassTerrain.cullAboveGround;return this._configuration};b.isVisibleInPass=function(a){return a===x.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL||
a===x.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT||a===x.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT?this.parameters.castShadows:!0};b.isVisible=function(){const a=this.parameters;return k.prototype.isVisible.call(this)?0<a.opacity:!1};b.intersect=function(a,c,f,m,g,n,r){if(L.isPathGeometry(a)){c=a.path;f=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){var d=this.parameters.vvSizeOffset,p=this.parameters.vvSizeFactor;const D=this.parameters.vvSizeMinSize,E=this.parameters.vvSizeMaxSize,
F=c.sizeAttributeValue;f[0]*=z.clamp(d[0]+F*p[0],D[0],E[0]);f[1]*=z.clamp(d[2]+F*p[2],D[2],E[2])}d=Math.max(f[0],f[1]);a=a.boundingInfo;A.isNone(a)?this._intersectTriangles(c,f,g,n,r):(a=G.fromValues(a.bbMin[0]-d,a.bbMin[1]-d,a.bbMin[2]-d,a.bbMax[0]+d,a.bbMax[1]+d,a.bbMax[2]+d),d=[n[0]-g[0],n[1]-g[1],n[2]-g[2]],p=Math.sqrt(d[0]*d[0]+d[1]*d[1]+d[2]*d[2]),N.intersectAabbInvDir(a,g,[p/d[0],p/d[1],p/d[2]],m.tolerance)&&this._intersectTriangles(c,f,g,n,r))}};b._intersectTriangles=function(a,c,f,m,g){a.baked.size&&
a.baked.size[0]===c[0]&&a.baked.size[1]===c[1]||a.baked.bake(c);a.baked.intersect(f,m,g)};b.computeAttachmentOrigin=function(a,c){a=a.vertexAttributes;if(!a)return null;a=a.get(h.VertexAttribute.POSITION);return J.computeAttachmentOriginLines(a,null,!1,c)};b.createBufferWriter=function(){return new O(this.vertexBufferLayout)};b.requiresSlot=function(a){return a===(this.parameters.transparent?y.RenderSlot.TRANSPARENT_MATERIAL:y.RenderSlot.OPAQUE_MATERIAL)||a===y.RenderSlot.DRAPED_MATERIAL};b.createGLMaterial=
function(a){return a.output===l.ShaderOutput.Color||a.output===l.ShaderOutput.Alpha||a.output===l.ShaderOutput.Depth||a.output===l.ShaderOutput.Normal||a.output===l.ShaderOutput.Highlight||a.output===l.ShaderOutput.Shadow&&this.parameters.castShadows?new P(a):null};e.getVertexBufferLayout=function(a){let c=I.newLayout().vec3f(h.VertexAttribute.POSITION).vec4f(h.VertexAttribute.PROFILERIGHT).vec4f(h.VertexAttribute.PROFILEUP).vec4f(h.VertexAttribute.PROFILEVERTEXANDNORMAL);if(a.vvColorEnabled||a.vvSizeEnabled||
a.vvOpacityEnabled)c=c.vec4f(h.VertexAttribute.FEATUREVALUE);return c};return e}(w.Material);let P=function(k){function e(){return k.apply(this,arguments)||this}u._inheritsLoose(e,k);var b=e.prototype;b._updateOccludeeState=function(a){a.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:a.hasOccludees})};b._updateShadowState=function(a){(A.isNone(this.technique)||a.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:a.shadowMap.enabled})};
b.beginSlot=function(a){if(this._output===l.ShaderOutput.Color||this._output===l.ShaderOutput.Alpha)this._updateShadowState(a),this._updateOccludeeState(a);return this.ensureTechnique(q.PathTechnique,a)};return e}(K),C=function(k){function e(){var b=k.apply(this,arguments)||this;b.doubleSided=!1;b.doubleSidedType="normal";b.receiveSSAO=!0;b.receiveShadows=!1;b.castShadows=!0;b.hasSlicePlane=!1;b.transparent=!1;b.hasOccludees=!1;return b}u._inheritsLoose(e,k);return e}(q.PathPassParameters),O=function(){function k(b){this.vertexBufferLayout=
b}var e=k.prototype;e.allocate=function(b){return this.vertexBufferLayout.createBuffer(b)};e.elementCount=function(b){return b.indices.get(h.VertexAttribute.POSITION).length};e.write=function(b,a,c,f){const m=g=>{if(a.vertexAttributes.has(g)){const n=a.vertexAttributes.get(g),r=a.indices.get(g);M.assert(4===n.size);const d=c.getField(g,H.BufferViewVec4f);if(d)B.writeBufferVec4(r,n.data,d,f);else throw Error("unable to acquire view for "+g);}};m(h.VertexAttribute.PROFILERIGHT);m(h.VertexAttribute.PROFILEUP);
m(h.VertexAttribute.PROFILEVERTEXANDNORMAL);this.vertexBufferLayout.hasField(h.VertexAttribute.FEATUREVALUE)&&m(h.VertexAttribute.FEATUREVALUE);B.writeDefaultAttributes(a,this.vertexBufferLayout,b.transformation,b.invTranspTransformation,c,f)};return k}();t.PathMaterial=w;t.PathMaterialParameters=C;Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});