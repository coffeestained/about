// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../../../chunks/vec3 ../../../support/debugFlags ../../core/shaderLibrary/util/DoublePrecision.glsl ../../core/util/TwoVectorPosition ./EdgeShaderParameters ./EdgeShaderTechnique ./EdgeShaderTechniqueConfiguration ./interfaces ../../shaders/sources/edgeRenderer/EdgeUtil.glsl ../../../../webgl/enums".split(" "),function(k,
t,n,m,p,u,q,v,w,x,y,z,A,c,l,B){const C={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0};let D=function(){function g(){this._value=0}var e=g.prototype;e.increment=function(){this._value++};e.decrement=function(){this._value--};t._createClass(g,[{key:"value",get:function(){return this._value}}]);return g}();const E={solid:l.EdgeUtilMode.SOLID,sketch:l.EdgeUtilMode.SKETCH,uber:l.EdgeUtilMode.MIXED};l=function(){function g(b,a,d){this.rctx=b;this.shaderTechniqueRepository=a;this._configuration=
new A.EdgeShaderTechniqueConfiguration;this.refCount=new D;this.renderables=new Set;this.sortedRenderables={[c.Transparency.TRANSPARENT]:{[c.Transparency.TRANSPARENT]:new m,[c.Transparency.OPAQUE]:new m},[c.Transparency.OPAQUE]:{[c.Transparency.TRANSPARENT]:new m,[c.Transparency.OPAQUE]:new m}};this._renderablesDirty=!1;this._drawParameters=new y.EdgeDrawParameters;this._settings={...C,...d};this.key=g.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);this.writerSettings=
{variants:this._settings.strokesTexture.variants,reducedPrecision:v.TESTS_DISABLE_OPTIMIZATIONS};this._configuration.legacy=this._settings.legacy;this._configuration.mode=E[this._settings.type];this._configuration.silhouette=!1;this._configuration.antialiasing=!!this.rctx.capabilities.blendMinMax;this._configuration.hasSlicePlane=this._settings.hasSlicePlane;this._configuration.doublePrecisionRequiresObfuscation=w.doublePrecisionRequiresObfuscation(b);this._configuration.spherical=d.spherical}var e=
g.prototype;e.dispose=function(){this._technique=n.releaseMaybe(this._technique)};e.addRenderable=function(b){this.renderables.add(b);this._renderablesDirty=!0};e.removeRenderable=function(b){this.renderables.delete(b);this._renderablesDirty=!0};e.setRenderablesDirty=function(){this._renderablesDirty=!0};e.forEachRenderable=function(b,a){this._renderablesDirty&&this._sortRenderables();this.sortedRenderables[a][c.Transparency.TRANSPARENT].forAll(b);this.sortedRenderables[a][c.Transparency.OPAQUE].forAll(b)};
e.updateTechnique=function(b,a){this._configuration.hasMultipassTerrain=!!b.multipassTerrain.enabled;this._configuration.cullAboveGround=!!b.multipassTerrain.cullAboveGround;this._configuration.silhouette=a;return this._technique=this.shaderTechniqueRepository.releaseAndAcquire(z.EdgeShaderTechnique,this._configuration,this._technique)};e.bindRegularEdges=function(b,a){return this.rctx.bindTechnique(this.updateTechnique(a,!1),b,a)};e.bindSilhouetteEdges=function(b,a){return this.rctx.bindTechnique(this.updateTechnique(a,
!0),b,a)};e.renderRegularEdges=function(b,a,d,f,h){this._render(b,a,a.regular.vao,d,f,h)};e.renderSilhouetteEdges=function(b,a,d,f,h){this._render(b,a,a.silhouette.vao,d,f,h)};e._render=function(b,a,d,f,h,F){this._bindDraw(b,a,f,F);this.rctx.bindVAO(d);this.rctx.capabilities.instancing.drawArraysInstanced(B.PrimitiveType.TRIANGLE_FAN,0,4,h)};e._bindDraw=function(b,a,d,f){a.components.buffer.textureBuffer.bind(b,"componentDataTex","componentDataTexInvDim");if("origin"in a.transform)b.setUniformMatrix4fv("localView",
f),b.setUniformMatrix4fv("model",a.transform.modelMatrix),q.copy(this._drawParameters.slicePlaneLocalOrigin,a.transform.origin.vec3);else{f=new x.TwoVectorPosition(a.transform.position);const h=p.transpose(r,p.invert(r,a.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=f.low;this._drawParameters.transformWorldFromModelTH=f.high;this._drawParameters.transformWorldFromModelRS=a.transform.rotationScale;this._drawParameters.transformNormalGlobalFromModel=h;a=d.camera.viewInverseTransposeMatrix;
q.set(this._drawParameters.slicePlaneLocalOrigin,a[3],a[7],a[11])}b.bindDraw(this._drawParameters,d);"uber"!==this._settings.type&&"sketch"!==this._settings.type||this._setSketchUniforms(b)};e._setSketchUniforms=function(b){const a=this._settings.strokesTexture,d=a.texture;n.isNone(d)||(b.bindTexture("strokesTexture",d),b.setUniform2f("strokesTextureScale",1/d.descriptor.width,1/d.descriptor.height),b.setUniform1f("strokesLog2Resolution",Math.log2(a.resolution)),b.setUniform1f("strokesNormalizationScale",
a.normalizationScale),b.setUniform1f("strokesAmplitude",a.amplitude),b.setUniform1f("strokeVariants",a.variants))};e._sortRenderables=function(){this._renderablesDirty=!1;this.sortedRenderables[c.Transparency.TRANSPARENT][c.Transparency.TRANSPARENT].clear();this.sortedRenderables[c.Transparency.TRANSPARENT][c.Transparency.OPAQUE].clear();this.sortedRenderables[c.Transparency.OPAQUE][c.Transparency.TRANSPARENT].clear();this.sortedRenderables[c.Transparency.OPAQUE][c.Transparency.OPAQUE].clear();this.renderables.forEach(a=>
{a.objectTransparency!==c.Transparency.INVISIBLE&&a.edgeTransparency!==c.Transparency.INVISIBLE&&this.sortedRenderables[a.objectTransparency][a.edgeTransparency].push(a)});const b=(a,d)=>"origin"in a.transform&&"origin"in d.transform?a.transform.origin.id<d.transform.origin.id?-1:a.transform.origin.id>d.transform.origin.id?1:0:0;this.sortedRenderables[c.Transparency.TRANSPARENT][c.Transparency.TRANSPARENT].sort(b);this.sortedRenderables[c.Transparency.TRANSPARENT][c.Transparency.OPAQUE].sort(b);this.sortedRenderables[c.Transparency.OPAQUE][c.Transparency.TRANSPARENT].sort(b);
this.sortedRenderables[c.Transparency.OPAQUE][c.Transparency.OPAQUE].sort(b)};g.getKey=function(b,a,d){return`edges-t:${b}:${a}:${d}`};return g}();const r=u.create();k.EXTENSION_LENGTH_OFFSET=128;k.EdgeRenderer=l;k.LINE_WIDTH_FRACTION_FACTOR=8;k.componentDataInvDimName="componentDataTexInvDim";k.componentDataTexName="componentDataTex";Object.defineProperties(k,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});