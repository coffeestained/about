// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../support/requestImageUtils ./glUtil3D ./SMAATechnique ./SMAATechniqueConfiguration ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture".split(" "),
function(w,l,r,p,x,g,q,t,D,E,F,y,z,A,B,m,b,u,C){l.SmaaRenderPass=function(v){function n(e,a){var c=v.call(this,{})||this;c.rctx=e;c._techniqueRep=a;c._isEnabled=!1;return c}r._inheritsLoose(n,v);var h=n.prototype;h.normalizeCtorArgs=function(){return{}};h.dispose=function(){this._abortController=g.abortMaybe(this._abortController);this.disable()};h._loadResources=function(e){if(g.isSome(this._abortController))return!1;if(g.isSome(this._searchTexture))return!0;this._abortController=new AbortController;
const a=this._abortController.signal;(new Promise((c,d)=>w(["./SmaaRenderPassData"],c,d))).then(c=>this._loadTextures(c,a)).then(()=>e()).finally(()=>this._abortController=null);return!1};h._loadTextures=function(e,a){q.throwIfAborted(a);return Promise.all([this._loadTextureFromBase64(e.areaTexture,b.TextureSamplingMode.LINEAR,b.PixelFormat.RGB),this._loadTextureFromBase64(e.searchTexure,b.TextureSamplingMode.NEAREST,b.PixelFormat.LUMINANCE)]).then(([c,d])=>{q.isAborted(a)?(c.dispose(),d.dispose(),
q.throwIfAborted(a)):(this._areaTexture=c,this._searchTexture=d)})};h.enable=function(e){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const a=new m.SMAATechniqueConfiguration,c=(d,f)=>this._techniqueRep.releaseAndAcquire(B.SMAATechnique,d,f);a.output=m.SMAAOutput.EdgeDetector;this._edgeDetectTechnique=c(a,this._edgeDetectTechnique);a.output=m.SMAAOutput.BlendWeight;this._blendWeightsTechnique=c(a,this._blendWeightsTechnique);a.output=
m.SMAAOutput.Blur;this._blurTechnique=c(a,this._blurTechnique)}if(!this._loadResources(e))return!1;this._vao=A.createScreenSizeTriangleVAO(this.rctx);this._edges=new u.FramebufferObject(this.rctx,{colorTarget:b.TargetType.TEXTURE,depthStencilTarget:b.DepthStencilTargetType.NONE},{target:b.TextureType.TEXTURE_2D,pixelFormat:b.PixelFormat.RGB,dataType:b.PixelType.UNSIGNED_BYTE,samplingMode:b.TextureSamplingMode.LINEAR,wrapMode:b.TextureWrapMode.CLAMP_TO_EDGE,width:4,height:4});this._blend=new u.FramebufferObject(this.rctx,
{colorTarget:b.TargetType.TEXTURE,depthStencilTarget:b.DepthStencilTargetType.NONE},{target:b.TextureType.TEXTURE_2D,pixelFormat:b.PixelFormat.RGBA,dataType:b.PixelType.UNSIGNED_BYTE,samplingMode:b.TextureSamplingMode.LINEAR,wrapMode:b.TextureWrapMode.CLAMP_TO_EDGE,width:4,height:4});return this._isEnabled=!0};h.disable=function(){this._isEnabled&&(this._vao=g.disposeMaybe(this._vao),this._areaTexture=g.disposeMaybe(this._areaTexture),this._searchTexture=g.disposeMaybe(this._searchTexture),this._blend=
g.disposeMaybe(this._blend),this._edges=g.disposeMaybe(this._edges),this._isEnabled=!1)};h.render=function(e){if(this._isEnabled){var a=this.rctx,c=a.getBoundFramebufferObject(),d=e.descriptor.width,f=e.descriptor.height;a.bindVAO(this._vao);a.setViewport(0,0,d,f);this._edges.resize(d,f);a.bindFramebuffer(this._edges);a.setClearColor(0,0,0,1);a.clear(b.ClearBufferBit.COLOR_BUFFER_BIT);var k=a.bindTechnique(this._edgeDetectTechnique);k.bindTexture("tColor",e);k.setUniform4f("resolution",1/d,1/f,d,
f);a.drawArrays(b.PrimitiveType.TRIANGLES,0,3);this._blend.resize(d,f);a.bindFramebuffer(this._blend);a.setClearColor(0,0,1,1);a.clear(b.ClearBufferBit.COLOR_BUFFER_BIT);k=a.bindTechnique(this._blendWeightsTechnique);k.setUniform4f("resolution",1/d,1/f,d,f);k.bindTexture("tSearch",this._searchTexture);k.bindTexture("tArea",this._areaTexture);k.bindTexture("tEdges",this._edges.colorTexture);a.drawArrays(b.PrimitiveType.TRIANGLES,0,3);a.bindFramebuffer(c);a.setClearColor(0,1,0,1);a.clear(b.ClearBufferBit.COLOR_BUFFER_BIT);
c=a.bindTechnique(this._blurTechnique);c.setUniform4f("resolution",1/d,1/f,d,f);c.bindTexture("tColor",e);c.bindTexture("tBlendWeights",this._blend.colorTexture);a.drawArrays(b.PrimitiveType.TRIANGLES,0,3)}};h._loadTextureFromBase64=function(e,a,c){return z.requestImage(e).then(d=>new C.Texture(this.rctx,{pixelFormat:c,dataType:b.PixelType.UNSIGNED_BYTE,wrapMode:b.TextureWrapMode.CLAMP_TO_EDGE,width:d.width,height:d.height,samplingMode:a},d))};r._createClass(n,[{key:"updating",get:function(){return g.isSome(this._abortController)}}]);
return n}(x);p.__decorate([t.property()],l.SmaaRenderPass.prototype,"_abortController",void 0);p.__decorate([t.property({readOnly:!0})],l.SmaaRenderPass.prototype,"updating",null);l.SmaaRenderPass=p.__decorate([y.subclass("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],l.SmaaRenderPass);Object.defineProperties(l,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});