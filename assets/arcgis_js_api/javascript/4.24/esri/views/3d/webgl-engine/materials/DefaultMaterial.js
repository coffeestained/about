// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../lib/basicInterfaces ../lib/GLTextureMaterial ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderPass ../lib/RenderSlot ../lib/VertexAttribute ../lib/verticalOffsetUtils ./internal/bufferWriterUtils ./internal/MaterialUtil ../shaders/DefaultMaterialTechnique ../shaders/DefaultMaterialTechniqueConfiguration ../shaders/RealisticTreeTechnique".split(" "),
function(u,y,l,h,q,E,F,m,G,v,z,Q,w,A,R,B,x,g,S,T,H,I,U,V){function J(f){let e=F.newLayout();e=f.instancedDoublePrecision?e.vec3f(g.VertexAttribute.MODELORIGINHI).vec3f(g.VertexAttribute.MODELORIGINLO).mat3f(g.VertexAttribute.MODEL).mat3f(g.VertexAttribute.MODELNORMAL):e.mat4f(g.VertexAttribute.MODEL).mat4f(g.VertexAttribute.MODELNORMAL);l.isSome(f.instanced)&&f.instanced.includes("color")&&(e=e.vec4f(g.VertexAttribute.INSTANCECOLOR));l.isSome(f.instanced)&&f.instanced.includes("featureAttribute")&&
(e=e.vec4f(g.VertexAttribute.INSTANCEFEATUREATTRIBUTE));return e}A=function(f){function e(a){var d=f.call(this,a,W)||this;d.supportsEdges=!0;d.techniqueConfig=new U.DefaultMaterialTechniqueConfiguration;{var b=d.parameters;const n=b.textureId||b.normalTextureId||b.metallicRoughnessTextureId||b.emissiveTextureId||b.occlusionTextureId,k=F.newLayout().vec3f(g.VertexAttribute.POSITION).vec3f(g.VertexAttribute.NORMAL);b.hasVertexTangents&&k.vec4f(g.VertexAttribute.TANGENT);n&&k.vec2f(g.VertexAttribute.UV0);
b.hasVertexColors&&k.vec4u8(g.VertexAttribute.COLOR);b.hasSymbolColors&&k.vec4u8(g.VertexAttribute.SYMBOLCOLOR);b=k}d.vertexBufferLayout=b;d.instanceBufferLayout=a.instanced?J(d.parameters):null;return d}y._inheritsLoose(e,f);var c=e.prototype;c.isVisibleInPass=function(a){return a===B.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL||a===B.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT||a===B.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT?this.parameters.castShadows:!0};c.isVisible=function(){var a=this.parameters;
if(!f.prototype.isVisible.call(this)||0===a.layerOpacity)return!1;const {instanced:d,hasVertexColors:b,hasSymbolColors:n,vvColorEnabled:k}=a,r=l.isSome(d)&&d.includes("color"),t="replace"===a.colorMixMode,p=0<a.opacity;a=a.externalColor&&0<a.externalColor[3];return b&&(r||k||n)?t?!0:p:b?t?a:p:r||k||n?t?!0:p:t?a:p};c.getConfiguration=function(a,d){this.techniqueConfig.output=a;this.techniqueConfig.hasNormalTexture=!!this.parameters.normalTextureId;this.techniqueConfig.hasColorTexture=!!this.parameters.textureId;
this.techniqueConfig.hasVertexTangents=this.parameters.hasVertexTangents;this.techniqueConfig.instanced=!!this.parameters.instanced;this.techniqueConfig.instancedDoublePrecision=this.parameters.instancedDoublePrecision;this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled;this.techniqueConfig.hasVerticalOffset=l.isSome(this.parameters.verticalOffset);this.techniqueConfig.hasScreenSizePerspective=l.isSome(this.parameters.screenSizePerspective);this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane;
this.techniqueConfig.hasSliceHighlight=this.parameters.hasSliceHighlight;this.techniqueConfig.alphaDiscardMode=this.parameters.textureAlphaMode;this.techniqueConfig.normalType="screenDerivative"===this.parameters.normals?G.NormalAttributeType.ScreenDerivative:G.NormalAttributeType.Attribute;this.techniqueConfig.transparent=this.parameters.transparent;this.techniqueConfig.writeDepth=this.parameters.writeDepth;l.isSome(this.parameters.customDepthTest)&&(this.techniqueConfig.customDepthTest=this.parameters.customDepthTest);
this.techniqueConfig.hasOccludees=this.parameters.hasOccludees;this.techniqueConfig.cullFace=this.parameters.hasSlicePlane?Q.CullFaceOptions.None:this.parameters.cullFace;this.techniqueConfig.hasMultipassTerrain=d.multipassTerrain.enabled;this.techniqueConfig.cullAboveGround=d.multipassTerrain.cullAboveGround;this.techniqueConfig.hasModelTransformation=l.isSome(this.parameters.modelTransformation);if(a===m.ShaderOutput.Color||a===m.ShaderOutput.Alpha)this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,
this.techniqueConfig.hasSymbolColors=this.parameters.hasSymbolColors,this.techniqueConfig.doubleSidedMode=this.parameters.treeRendering?v.NormalsDoubleSidedMode.WindingOrder:this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?v.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?v.NormalsDoubleSidedMode.WindingOrder:v.NormalsDoubleSidedMode.None,this.techniqueConfig.instancedColor=l.isSome(this.parameters.instanced)&&this.parameters.instanced.includes("color"),
this.techniqueConfig.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=d.ssaoHelper.ready?this.parameters.receiveSSAO:!1,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this.techniqueConfig.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?z.PBRMode.Schematic:z.PBRMode.Normal:z.PBRMode.Disabled,this.techniqueConfig.hasMetalnessAndRoughnessTexture=
!!this.parameters.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.parameters.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this.techniqueConfig.transparencyPassType=d.transparencyPassType,this.techniqueConfig.enableOffset=d.camera.relativeElevation<R.OITPolygonOffsetLimit,this.techniqueConfig.snowCover=this.hasSnowCover(d);
return this.techniqueConfig};c.hasSnowCover=function(a){return l.isSome(a.weather)&&a.weatherVisible&&"snowy"===a.weather.type&&"enabled"===a.weather.snowCover};c.intersect=function(a,d,b,n,k,r,t){if(l.isSome(this.parameters.verticalOffset)){const K=n.camera;h.set(C,b[12],b[13],b[14]);b=null;switch(n.viewingMode){case E.ViewingMode.Global:b=h.normalize(L,C);break;case E.ViewingMode.Local:b=h.copy(L,X)}let M=0;var p=h.subtract(Y,C,K.eye);const N=h.length(p);p=h.scale(p,p,1/N);let O=null;this.parameters.screenSizePerspective&&
(O=h.dot(b,p));M+=H.verticalOffsetAtDistance(K,N,this.parameters.verticalOffset,O,this.parameters.screenSizePerspective);h.scale(b,b,M);h.transformMat3(D,b,n.transform.inverseRotation);k=h.subtract(Z,k,D);r=h.subtract(aa,r,D)}H.intersectTriangleGeometry(a,d,n,k,r,S.getVerticalOffsetObject3D(n.verticalOffset),t)};c.requiresSlot=function(a){return a===(this.parameters.transparent?this.parameters.writeDepth?x.RenderSlot.TRANSPARENT_MATERIAL:x.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:x.RenderSlot.OPAQUE_MATERIAL)||
a===x.RenderSlot.DRAPED_MATERIAL};c.createGLMaterial=function(a){return a.output===m.ShaderOutput.Color||a.output===m.ShaderOutput.Alpha||a.output===m.ShaderOutput.Depth||a.output===m.ShaderOutput.Normal||a.output===m.ShaderOutput.Shadow||a.output===m.ShaderOutput.Highlight?new P(a):null};c.createBufferWriter=function(){return new ba(this.vertexBufferLayout,this.instanceBufferLayout)};return e}(A.Material);let P=function(f){function e(a){return f.call(this,{...a,...a.material.parameters})||this}y._inheritsLoose(e,
f);var c=e.prototype;c._updateParameters=function(a){const d=this._material.parameters;this.updateTexture(d.textureId);const b=a.camera.viewInverseTransposeMatrix;h.set(d.origin,b[3],b[7],b[11]);this._material.setParameters(this.textureBindParameters);return this.ensureTechnique(d.treeRendering?V.RealisticTreeTechnique:I.DefaultMaterialTechnique,a)};c._updateShadowState=function(a){a.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:a.shadowMap.enabled})};
c._updateOccludeeState=function(a){a.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:a.hasOccludees})};c.beginSlot=function(a){if(this._output===m.ShaderOutput.Color||this._output===m.ShaderOutput.Alpha)this._updateShadowState(a),this._updateOccludeeState(a);return this._updateParameters(a)};return e}(w.GLTextureMaterial);w=function(f){function e(){var c=f.apply(this,arguments)||this;c.initTextureTransparent=!1;c.treeRendering=!1;c.hasVertexTangents=
!1;return c}y._inheritsLoose(e,f);return e}(I.DefaultMaterialPassParameters);const W=new w;let ba=function(){function f(c,a){this.vertexBufferLayout=c;this.instanceBufferLayout=a}var e=f.prototype;e.allocate=function(c){return this.vertexBufferLayout.createBuffer(c)};e.elementCount=function(c){return c.indices.get(g.VertexAttribute.POSITION).length};e.write=function(c,a,d,b){T.writeDefaultAttributes(a,this.vertexBufferLayout,c.transformation,c.invTranspTransformation,d,b)};return f}();const Z=q.create(),
aa=q.create(),X=q.fromValues(0,0,1),L=q.create(),D=q.create(),C=q.create(),Y=q.create();u.DefaultGLMaterial=P;u.DefaultMaterial=A;u.DefaultMaterialParameters=w;u.getInstanceBufferLayout=J;Object.defineProperties(u,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});