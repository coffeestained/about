// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../geometry/projectionEllipsoid ./atmosphereUtils ./FogTechnique ./weather ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(e,r,p,w,t,f,u,G,H,I,x,d,q,y,z,l,m,A,B,C,D){e.Fog=function(v){function h(a){var b=v.call(this,a)||this;b._fogColor=q.create();b._fogColorAtNight=q.create();b._cameraDirection=q.create();b._foggyFadeStart=.95;b._foggyFadeEnd=1;b._hazeFadeStart=.7;b._hazeFadeEnd=1;b._strength=4E-6;b._vao=C.createQuadVAO(a.context.renderContext.rctx,B.Pos2Tex);a=y.getReferenceEllipsoid(a.view.spatialReference);b._planetRadius=a.radius;b._atmosphereRadius=a.radius+z.atmosphereHeight;return b}r._inheritsLoose(h,
v);var k=h.prototype;k.destroy=function(){this._hazeFogTechnique=f.releaseMaybe(this._hazeFogTechnique);this._thickFogTechnique=f.releaseMaybe(this._thickFogTechnique);this._vao=f.disposeMaybe(this._vao)};k.when=function(){return Promise.resolve()};k.render=function(a,b,g){if(0!==this.view.basemapTerrain.baseOpacity||b)if(this._update(a,b,g),!(0>=this._fogAmount)){var c=b?this.thickFogTechnique:this.hazeFogTechnique;if(c.compiled){var n=a.offscreenRenderingHelper,F=a.rctx.bindTechnique(c,E,a.bindParameters);
n.renderDepthDetached(()=>{F.bindTexture("depthTex",n.depthTexture);this._renderFog(c.program,a)})}else this.context.requestRender()}};k._renderFog=function(a,b){if(f.isNone(this._vao))return!1;const g=b.rctx;a.setUniform3fv("cameraPosition",b.bindParameters.camera.eye);a.setUniform1f("atmosphereC",this._atmosphereC);a.setUniform1f("fogStrength",this._strength);a.setUniform1f("fogAmount",this._fogAmount);a.setUniform3fv("fogColor",this._fogColor);g.bindVAO(this._vao);a.assertCompatibleVertexAttributeLocations(this._vao);
g.drawArrays(D.PrimitiveType.TRIANGLE_STRIP,0,4);return!0};k._update=function(a,b,g){var c=a.bindParameters.camera;const n=b?.1:0;g?d.set(this._fogColor,.5,.5,.5):b?d.set(this._fogColor,1.5,1.5,1.5):d.set(this._fogColor,.24,.44,.8);d.scale(this._fogColorAtNight,this._fogColor,n);d.normalize(this._cameraDirection,c.eye);a=Math.max(0,d.dot(this._cameraDirection,a.bindParameters.lighting.lightingMainDirection));d.lerp(this._fogColor,this._fogColorAtNight,this._fogColor,a);c=d.length(c.eye);this._atmosphereC=
c*c-this._atmosphereRadius*this._atmosphereRadius;this._fogAmount=b?1-t.smoothstep(this._foggyFadeStart*m.weatherHeightLimit,this._foggyFadeEnd*m.weatherHeightLimit,Math.abs(c-this._planetRadius)):1-t.smoothstep(this._hazeFadeStart*m.weatherHeightLimit,this._hazeFadeEnd*m.weatherHeightLimit,Math.abs(c-this._planetRadius))};h.isSupported=function(a){return a.capabilities.depthTexture};r._createClass(h,[{key:"_shaderTechniqueRepository",get:function(){return this.context.shaderTechniqueRepository}},
{key:"strength",get:function(){return this._strength},set:function(a){this._strength=a}},{key:"thickFogTechnique",get:function(){if(f.isNone(this._thickFogTechnique)){const a=new l.FogTechniqueConfiguration;a.haze=!1;this._thickFogTechnique=this._shaderTechniqueRepository.acquire(l.FogTechnique,a)}return this._thickFogTechnique}},{key:"hazeFogTechnique",get:function(){if(f.isNone(this._hazeFogTechnique)){const a=new l.FogTechniqueConfiguration;a.haze=!0;this._hazeFogTechnique=this._shaderTechniqueRepository.acquire(l.FogTechnique,
a)}return this._hazeFogTechnique}}]);return h}(w);p.__decorate([u.property({constructOnly:!0})],e.Fog.prototype,"context",void 0);p.__decorate([u.property({constructOnly:!0})],e.Fog.prototype,"view",void 0);e.Fog=p.__decorate([x.subclass("esri.views.3d.environment.Fog")],e.Fog);const E=new A.NoParameters;Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});