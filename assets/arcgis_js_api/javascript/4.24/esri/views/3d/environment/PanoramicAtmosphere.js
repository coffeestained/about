// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../support/requestImageUtils ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechnique ./SimpleAtmosphereTechniqueConfiguration ./resources/SimpleAtmosphereTexture ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(q,w,k,l,r,x,y,z,A,B,t,C,D,E,F,G,m,H,e,I,J,K){const L=k.getLogger("esri.views.3d.environment.PanoramicAtmosphere");k=function(){function n(){this.type="panoramic";this._techniqueConfig=new t.SimpleAtmosphereTechniqueConfiguration;this._passParameters=new A.SimpleAtmospherePassParameters;this._readyResolver=r.createResolver();this._readyController=new AbortController}var f=n.prototype;f.destroy=function(){this._readyResolver.reject();this._passParameters.texture=l.disposeMaybe(this._passParameters.texture);
this._vao=l.disposeMaybe(this._vao);this._readyController=l.abortMaybe(this._readyController)};f.when=function(){return this._readyResolver.promise};f.initializeRenderContext=function(d){this._techniqueConfig.geometry=t.SimpleAtmosphereGeometry.Cylinder;this._technique=d.shaderTechniqueRepository.acquire(B.SimpleAtmosphereTechnique,this._techniqueConfig);const c=d.renderContext.rctx;this._vao=this._createVertexArrayObject(c);this._vaoCount=J.vertexCount(this._vao,"geometry");z.requestImage(C,{signal:this._readyController.signal}).then(a=>
{this._passParameters.texture=new I.Texture(c,{pixelFormat:e.PixelFormat.RGBA,dataType:e.PixelType.UNSIGNED_BYTE,wrapMode:e.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:e.TextureSamplingMode.LINEAR,flipped:!0},a);d.requestRender();this._readyController=null;this._readyResolver.resolve()}).catch(a=>{r.isAbortError(a)||L.error("Unable to initialize atmosphere: image request failed",a);this._readyResolver.reject()})};f.render=function(d){const c=d.rctx,a=c.bindTechnique(this._technique,this._passParameters,
d.bindParameters);var b=u;x.copy(b,d.bindParameters.camera.viewMatrix);b[12]=0;b[13]=0;b[14]=0;b[15]=1;a.setUniformMatrix4fv("view",u);c.bindVAO(this._vao);a.assertCompatibleVertexAttributeLocations(this._vao);c.drawArrays(e.PrimitiveType.TRIANGLES,0,this._vaoCount)};f.renderHaze=function(){return!1};f._createVertexArrayObject=function(d){var c=G.createPolySphereGeometry(1,2,!1);const a=c.indices.get(m.VertexAttribute.POSITION);for(var b=0;b<a.length;b+=3){var h=a[b];a[b]=a[b+2];a[b+2]=h}c=c.vertexAttributes.get(m.VertexAttribute.POSITION).data;
b=v.createBuffer(a.length);h=b.position;for(let g=0;g<a.length;++g){const p=3*a[g];h.set(g,0,c[p]);h.set(g,1,c[p+1]);h.set(g,2,c[p+2])}return new K.VertexArrayObject(d,F.Default3D,{geometry:D.glLayout(v)},{geometry:H.BufferObject.createVertex(d,e.Usage.STATIC_DRAW,b.buffer)})};w._createClass(n,[{key:"canRender",get:function(){return null!=this._passParameters.texture}}]);return n}();const u=y.create(),v=E.newLayout().vec3f(m.VertexAttribute.POSITION);q.PanoramicAtmosphere=k;Object.defineProperties(q,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});