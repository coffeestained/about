// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../chunks/vec2f32 ./NoiseTextureAtlasConfiguration ./NoiseTextureAtlasDimensions ./NoiseTextureAtlasTechnique ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/FramebufferObject".split(" "),function(m,n,r,h,c,t,u,e,f,p,v,g,w){h=function(q){function k(a){var b=q.call(this,a)||this;b._weatherTile=u.fromValues(0,
0);b._needsRender=!0;b._frameBuffer=new w.FramebufferObject(a.context.renderContext.rctx,{colorTarget:g.TargetType.TEXTURE,width:f.ATLAS_SIZE,height:f.ATLAS_SIZE},{target:g.TextureType.TEXTURE_2D,pixelFormat:g.PixelFormat.RGBA,dataType:g.PixelType.UNSIGNED_BYTE,wrapMode:g.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:g.TextureSamplingMode.LINEAR,hasMipmap:!1,width:f.ATLAS_SIZE,height:f.ATLAS_SIZE});b._vao=v.createQuadVAO(a.context.renderContext.rctx);b._shaderTechniqueRepository=a.context.shaderTechniqueRepository;
let d;b._ensureRendered=()=>{c.isSome(d)?c.isSome(b.weatherMapTechnique)&&b.weatherMapTechnique.compiled&&b._needsRender&&(d=b._render(a.context.renderContext.rctx,e.NoiseTextureRenderMode.WeatherMap)):c.isSome(b.fullTechnique)&&b.fullTechnique.compiled&&(d=b._render(a.context.renderContext.rctx,e.NoiseTextureRenderMode.Full));return d};return b}n._inheritsLoose(k,q);var l=k.prototype;l._setDirty=function(){this._needsRender=!0};l.updateWeatherMap=function(a){if(this._weatherTile[0]!==a[0]||this._weatherTile[1]!==
a[1])this._weatherTile=a,this._setDirty()};l.destroy=function(){this._fullTechnique=c.releaseMaybe(this._fullTechnique);this._weatherMapTechnique=c.releaseMaybe(this._weatherMapTechnique);this._frameBuffer=c.disposeMaybe(this._frameBuffer);this._vao=c.disposeMaybe(this._vao)};l._render=function(a,b){if(c.isNone(this._vao)||c.isNone(this._frameBuffer))return null;var d=b===e.NoiseTextureRenderMode.Full?this.fullTechnique:this.weatherMapTechnique;if(c.isNone(d))return null;b=a.getViewport();a.setViewport(0,
0,f.ATLAS_SIZE,f.ATLAS_SIZE);a.bindFramebuffer(this._frameBuffer);d=a.bindTechnique(d);d.setUniform2f("weatherTile",this._weatherTile[0],this._weatherTile[1]);a.bindVAO(this._vao);d.assertCompatibleVertexAttributeLocations(this._vao);a.gl.drawArrays(a.gl.TRIANGLE_STRIP,0,4);a.setViewport(b.x,b.y,b.width,b.height);this._needsRender=!1;return this._frameBuffer.colorTexture};n._createClass(k,[{key:"textureAtlas",get:function(){return this._ensureRendered()}},{key:"fullTechnique",get:function(){if(c.isNone(this._fullTechnique)){const a=
new e.NoiseTextureAtlasTechniqueConfiguration;a.mode=e.NoiseTextureRenderMode.Full;this._fullTechnique=this._shaderTechniqueRepository.acquire(p.NoiseTextureAtlasTechnique,a)}return this._fullTechnique}},{key:"weatherMapTechnique",get:function(){if(c.isNone(this._weatherMapTechnique)){const a=new e.NoiseTextureAtlasTechniqueConfiguration;a.mode=e.NoiseTextureRenderMode.WeatherMap;this._weatherMapTechnique=this._shaderTechniqueRepository.acquire(p.NoiseTextureAtlasTechnique,a)}return this._weatherMapTechnique}}]);
return k}(h);r.__decorate([t.property({constructOnly:!0})],h.prototype,"context",void 0);m.NoiseTextureAtlas=h;Object.defineProperties(m,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});