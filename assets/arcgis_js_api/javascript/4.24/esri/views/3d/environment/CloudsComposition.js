// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/support/axisAngle ./CloudsCompositionParameters ./CloudsCompositionTechnique ./CloudsData ./weather ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(k,C,p,D,E,r,t,M,N,O,F,w,x,f,u,q,d,G,y,l,H,I,J){k.CloudsComposition=function(z){function v(a){var e=z.call(this,a)||this;e._technique=new G.CloudsCompositionTechnique(a);e._vao=I.createQuadVAO(a.rctx);return e}C._inheritsLoose(v,z);var m=v.prototype;m.destroy=function(){this._technique=r.releaseMaybe(this._technique);this._vao=r.disposeMaybe(this._vao)};m.render=function(a,e){const c=a.bindParameters.clouds;r.isNone(this._vao)||r.isNone(c.data)||(this._technique.compiled?(this._setParallaxParameters(c,
a.bindParameters.camera.eye,e),e=a.rctx.bindTechnique(this._technique,K,a.bindParameters),a.rctx.bindVAO(this._vao),e.assertCompatibleVertexAttributeLocations(this._vao),a.rctx.drawArrays(J.PrimitiveType.TRIANGLE_STRIP,0,4),(c.crossFade.enabled||c.fadeInOut.stage!==d.FadeInOutStages.FINISHED||c.fadeIn.stage!==d.FadeInStages.FINISHED||c.fadeInOutHeight.stage!==d.FadeHeightStages.FINISHED)&&this.requestRender()):this.requestRender())};m._setFadeInStage=function(a,e){const c=performance.now(),b=a.parallax.anchorPointClouds;
a.fadeIn.stage===d.FadeInStages.FINISHED&&(a.fadeIn.factor=1,f.copy(b,h),a.fadeIn.stage=d.FadeInStages.CHANGE_ANCHOR,a.crossFade.enabled=!1,a.fadeInOut.stage=d.FadeInOutStages.FINISHED);e=f.equals(a.cameraPositionLastFrame,e);a.fadeIn.stage===d.FadeInStages.CHANGE_ANCHOR&&e&&y.ensureClouds(a.data)&&(f.copy(b,h),a.fadeIn.stage=d.FadeInStages.FADE_IN,a.startTime=c);0<a.fadeIn.factor&&a.fadeIn.stage===d.FadeInStages.FADE_IN&&(a.fadeIn.factor=1-(c-a.startTime)/500);0>=a.fadeIn.factor&&a.fadeIn.stage===
d.FadeInStages.FADE_IN&&(a.fadeIn.stage=d.FadeInStages.FINISHED,a.fadeIn.factor=0)};m._setCrossFadingStage=function(a){const e=performance.now(),{crossFade:c}=a,b=a.parallax.anchorPointClouds;a.crossFade.enabled||(f.copy(a.parallaxNew.anchorPointClouds,h),a.startTime=e,c.factor=0,a.crossFade.enabled=!0);1>c.factor&&a.crossFade.enabled&&(c.factor=(e-a.startTime)/500);1<=c.factor&&a.crossFade.enabled&&(a.crossFade.enabled=!1,c.factor=1,f.copy(b,a.parallaxNew.anchorPointClouds))};m._setFadeInOutStage=
function(a,e){const c=performance.now(),{fadeInOut:b,crossFade:g}=a;b.stage===d.FadeInOutStages.FINISHED&&(a.startTime=c,b.factor=0,b.stage=d.FadeInOutStages.FADE_OUT);1>b.factor&&b.stage===d.FadeInOutStages.FADE_OUT&&(b.factor=(c-a.startTime)/250);1<=b.factor&&b.stage===d.FadeInOutStages.FADE_OUT&&(b.factor=1,f.copy(a.parallax.anchorPointClouds,h));1<=b.factor&&b.stage===d.FadeInOutStages.FADE_OUT&&f.equals(a.cameraPositionLastFrame,e)&&(b.factor=1,b.stage=d.FadeInOutStages.SWITCH,a.crossFade.enabled=
!1,g.factor=1);y.ensureClouds(a.data)&&b.stage===d.FadeInOutStages.SWITCH&&(a.startTime=c,b.factor=1,b.stage=d.FadeInOutStages.FADE_IN,f.copy(a.parallax.anchorPointClouds,h),a.crossFade.enabled=!1,g.factor=1);0<b.factor&&b.stage===d.FadeInOutStages.FADE_IN&&(b.factor=1-(c-a.startTime)/500);0>=b.factor&&b.stage===d.FadeInOutStages.FADE_IN&&(b.stage=d.FadeInOutStages.FINISHED,b.factor=0)};m._setFadeInOutHeight=function(a,e){const c=performance.now(),b=a.fadeInOutHeight,g=(c-(b.stage===d.FadeHeightStages.FINISHED?
c:a.startTimeHeightFade))/500;b.factor+=e?-g:g;a.startTimeHeightFade=c;b.factor=E.clamp(b.factor,0,1);b.stage=d.FadeHeightStages.HEIGHT_FADE};m._setParallaxParameters=function(a,e,c){var {parallax:b}=a;0>a.fadeInOutHeight.factor&&(a.fadeInOutHeight.factor=f.length(e)-this.planetRadius>l.weatherHeightLimit?1:0);f.normalize(h,e);f.scale(h,h,this.planetRadius);0===b.anchorPointClouds[0]&&0===b.anchorPointClouds[1]&&0===b.anchorPointClouds[2]&&f.copy(b.anchorPointClouds,h);var g=f.length(f.subtract(L,
b.anchorPointClouds,h));let A=!0;g>a.fadeIn.distanceThresholdFactor*b.cloudsHeight||a.fadeIn.stage!==d.FadeInStages.FINISHED?this._setFadeInStage(a,e):g>a.fadeInOut.distanceThresholdFactor*b.cloudsHeight||a.fadeInOut.stage!==d.FadeInOutStages.FINISHED?this._setFadeInOutStage(a,e):g>a.crossFade.distanceThresholdFactor*b.cloudsHeight&&!c||a.crossFade.enabled?this._setCrossFadingStage(a):A=!1;c=f.length(e);g=c-this.planetRadius;(g>1.7*l.weatherHeightLimit||g<-l.weatherHeightLimit)&&1>a.fadeInOutHeight.factor?
a.fadeInOutHeight.factor=1:(g>l.weatherHeightLimit||g<-.35*l.weatherHeightLimit)&&1>a.fadeInOutHeight.factor?this._setFadeInOutHeight(a,!1):g<l.weatherHeightLimit&&g>-.35*l.weatherHeightLimit&&0<a.fadeInOutHeight.factor?this._setFadeInOutHeight(a,!0):a.fadeInOutHeight.stage=d.FadeHeightStages.FINISHED;b.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(c*c-this.planetRadius*this.planetRadius,0))/c;q.fromPoints(B,b.anchorPointClouds,n);b.transform=x.create();w.rotate(b.transform,b.transform,n[3],
q.axis(n));A&&({parallaxNew:b}=a,q.fromPoints(B,b.anchorPointClouds,n),b.transform=x.create(),w.rotate(b.transform,b.transform,n[3],q.axis(n)));f.copy(a.cameraPositionLastFrame,e)};return v}(D);p.__decorate([t.property({constructOnly:!0})],k.CloudsComposition.prototype,"rctx",void 0);p.__decorate([t.property({constructOnly:!0})],k.CloudsComposition.prototype,"viewingMode",void 0);p.__decorate([t.property({constructOnly:!0})],k.CloudsComposition.prototype,"planetRadius",void 0);p.__decorate([t.property({constructOnly:!0})],
k.CloudsComposition.prototype,"requestRender",void 0);k.CloudsComposition=p.__decorate([F.subclass("esri.views.3d.environment.CloudsComposition")],k.CloudsComposition);const B=u.fromValues(0,0,1),n=q.create(),h=u.create(),L=u.create(),K=new H.NoParameters;Object.defineProperties(k,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});