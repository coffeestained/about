// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/time ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/set ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../PointToPointAnimationController ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../webgl-engine/lib/verticalOffsetUtils ../../../../animation/easing".split(" "),
function(g,u,v,w,F,G,H,I,J,x,d,e,y,l,z,p,A,B,C){g.ZoomStepController=function(q){function m(){var b=q.apply(this,arguments)||this;b.zoomLocation=e.create();b.tmpCamera=new p.Camera;b.tmpRayDir=e.create();b.tmpCenter=e.create();b.constraintOptions={selection:l.ConstraintTypes.ALL,interactionType:l.InteractionType.ZOOM,interactionFactor:null,interactionStartCamera:new p.Camera,interactionDirection:null,tiltMode:l.TiltMode.TUMBLE};return b}u._inheritsLoose(m,q);var n=m.prototype;n.zoomStep=function(b,
c){if(this.active){var a=this.view.state,{interactionStartCamera:f}=this.constraintOptions;this.animation.finished?f.copyFrom(a.camera):this.animation.cameraAt(1,f);this.tmpCamera.copyFrom(a.camera);a=A.newIntersector(this.view.state.viewingMode);0<b?(0===this.view.map.ground.opacity?this.intersectionHelper.intersectScreenFreePointFallback(c,this.zoomLocation,D):this.intersectionHelper.intersectScreenFreePointFallback(c,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,a,
this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,a,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:d.copy(this.zoomLocation,this.tmpCamera.center);b=.6**b;c=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,c[0],c[1],this.view.state.camera,60);d.subtract(h,this.tmpCamera.eye,this.zoomLocation);d.normalize(h,h);a=Math.max(Math.min(14,1/Math.abs(d.dot(E,h)))*Math.abs(this.view.camera.position.z),200);if(c=
c?Math.min(c,a):a)a=e.create(),d.subtract(a,this.zoomLocation,this.tmpCamera.eye),c<d.length(a)&&(d.normalize(a,a),d.add(this.zoomLocation,this.tmpCamera.eye,d.scale(a,a,c)));this._updateCamera(this.tmpCamera,b,this.zoomLocation);this.begin(this.tmpCamera)}};n.animationSettings=function(){return{apex:null,duration:w.Milliseconds(600),easing:C.outExpo}};n._updateCamera=function(b,c,a){d.subtract(this.tmpRayDir,a,b.eye);const f=d.length(this.tmpRayDir);let k=f*c;const r=Math.max(4,1.01*b.nearFar[0]);
1>=c&&k<r&&(k=r,c=k/f);1E-6>Math.abs(f-k)||(d.scale(this.tmpRayDir,this.tmpRayDir,c),b.eye=d.subtract(t,a,this.tmpRayDir),b.center=d.lerp(t,b.center,a,1-c),y.applyAll(this.view,b,this.constraintOptions))};return m}(z.PointToPointAnimationController);g.ZoomStepController=v.__decorate([x.subclass("esri.views.3d.state.controllers.local.ZoomStepController")],g.ZoomStepController);const t=e.create(),E=e.fromValues(0,0,1),h=e.create(),D={exclude:new Set([B.TERRAIN_ID])};Object.defineProperties(g,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})});