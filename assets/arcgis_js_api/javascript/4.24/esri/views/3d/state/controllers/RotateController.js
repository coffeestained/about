// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../camera/constraintUtils ../../camera/constraintUtils/common ../Constraints ./InteractiveController ../utils/navigationUtils".split(" "),
function(c,w,u,x,C,y,J,K,L,D,z,E,F,A,d,l,G,H,f,B,I,r){c.PivotPoint=void 0;(function(m){m[m.CENTER=0]="CENTER";m[m.EYE=1]="EYE"})(c.PivotPoint||(c.PivotPoint={}));c.RotateController=function(m){function t(a){a=m.call(this,a)||this;a.view=null;a.pivot=c.PivotPoint.CENTER;a.lastPoint=A.create();a.tmpWorldUp=l.create();a.tmpViewDir=l.create();a.tmpRotCurPoint=A.create();a.tmpTransf=E.create();a.tmpAxis=l.create();a.tmpPivotPoint=l.create();a.pivotPos=l.create();a.constraintOptions={selection:f.ConstraintTypes.ALL,
interactionType:f.InteractionType.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:f.TiltMode.TUMBLE};return a}w._inheritsLoose(t,m);var n=t.prototype;n.initialize=function(){this.rotScale=this.pivot===c.PivotPoint.CENTER?3:1.5};n.begin=function(a){if(this.active){switch(this.pivot){case c.PivotPoint.EYE:d.copy(this.pivotPos,this.startCamera.eye);this.constraintOptions.interactionType=f.InteractionType.LOOK_AROUND;this.constraintOptions.tiltMode=f.TiltMode.LOOK_AROUND;
this.constraintOptions.selection=f.ConstraintTypes.NONE;break;case c.PivotPoint.CENTER:{const e=this.intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this.pivotPos);e||d.copy(this.pivotPos,this.startCamera.center);this._constrainPivotPoint(a,e);this.startCamera.center=this.pivotPos;this.constraintOptions.interactionType=f.InteractionType.TUMBLE;this.constraintOptions.tiltMode=f.TiltMode.TUMBLE;this.constraintOptions.selection=f.ConstraintTypes.ALL&~f.ConstraintTypes.DISTANCE}}this.constraintOptions.interactionStartCamera=
this.startCamera;r.normalizeCoordinate(this.startCamera,a,this.lastPoint)}};n._constrainPivotPoint=function(a,e){const b=this.startCamera,g=l.create();d.subtract(g,this.pivotPos,b.eye);const p=d.length(g);let k=Math.min(p,7*Math.abs(this.view.camera.position.z));var q=G.getReferenceEllipsoid(this.view.spatialReference),h=C.createScreenPointArray(b.width/b.pixelRatio*.5,b.height/b.pixelRatio*.5);q=r.decideNavigationMode(this.startCamera,h,!0,q);h=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,
b.fullWidth/b.pixelRatio*.5,b.fullHeight/b.pixelRatio*.5,b,225,90);a=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,a[0],a[1],b,90);if(void 0!==h||void 0!==a)h=void 0===h?a:h,a=void 0===a||q===r.NavigationMode.Horizontal?h:a,k=h>a?a:h,k=e?Math.min(k,p):k;d.normalize(g,g);d.copy(this.pivotPos,d.add(this.tmpPivotPoint,b.eye,d.scale(this.tmpPivotPoint,g,k)))};n.update=function(a){if(this.active){switch(this.pivot){case c.PivotPoint.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,
a,this.currentCamera.center,this.pivotPos);break;case c.PivotPoint.CENTER:this.currentCamera.center=this.pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,a,this.currentCamera.eye,this.pivotPos)}H.applyAll(this.view,this.currentCamera,this.constraintOptions)}};n.end=function(){this.active&&this.finishController()};n._applyRotation=function(a,e,b,g){this.view.renderCoordsHelper.worldUpAtPosition(g,this.tmpWorldUp);r.normalizeCoordinate(a,e,this.tmpRotCurPoint);e=(this.lastPoint[1]-
this.tmpRotCurPoint[1])*this.rotScale;let p=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;d.subtract(this.tmpViewDir,b,g);b=d.length(this.tmpViewDir);b=x.acosClamped(d.dot(this.tmpViewDir,this.tmpWorldUp)/b);if(this.pivot===c.PivotPoint.EYE){const k=.5*Math.PI-b,q=.495*Math.PI;e=k-Math.max(-q,Math.min(q,k+-.5*e))}e=x.clamp(e+b,B.TiltDefault.min,B.TiltDefault.max)-b;d.cross(this.tmpAxis,a.up,this.tmpViewDir);this.pivot===c.PivotPoint.CENTER&&(p=-p);z.fromRotation(this.tmpTransf,p,this.tmpWorldUp);
z.rotate(this.tmpTransf,this.tmpTransf,e,this.tmpAxis);d.transformMat4(this.tmpViewDir,this.tmpViewDir,this.tmpTransf);a.up=d.transformMat4(v,a.up,this.tmpTransf);d.add(v,g,this.tmpViewDir);F.copy(this.lastPoint,this.tmpRotCurPoint);return v};w._createClass(t,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return t}(I.InteractiveController);u.__decorate([y.property({constructOnly:!0})],c.RotateController.prototype,"view",void 0);u.__decorate([y.property()],c.RotateController.prototype,
"pivot",void 0);c.RotateController=u.__decorate([D.subclass("esri.views.3d.state.controllers.RotateController")],c.RotateController);const v=l.create();Object.defineProperties(c,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});