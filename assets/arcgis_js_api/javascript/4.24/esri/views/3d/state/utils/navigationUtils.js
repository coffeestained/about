// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/Cyclical ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/axisAngle ../../../../geometry/support/coordinateSystem ../../../../geometry/support/plane ../../../../chunks/sphere ../../../../geometry/support/vector ../../../../geometry/support/vectorStacks ../../support/geometryUtils/ray ../../support/geometryUtils/sphere ../../webgl-engine/lib/Camera".split(" "),
function(g,y,q,Z,wa,t,Q,xa,ya,d,n,F,C,D,R,za,w,G,aa,Aa){function S(a,c,b){b=t.fromRotation(w.sm4d.get(),b[3],F.axis(b));Z.isNone(b)||(d.subtract(k,a.eye,c),d.transformMat4(k,k,b),a.eye=d.add(k,k,c),d.subtract(k,a.center,c),d.transformMat4(k,k,b),a.center=d.add(k,k,c),a.up=d.transformMat4(k,a.up,b))}function ba(a,c){d.set(c,0,0,0);for(const b of a)d.add(c,c,b);d.scale(c,c,1/a.length)}function ca(a,c,b,e){return Math.sin(a/d.length(c))*(b+e.radius)}function da(a,c,b,e){b=G.fromScreenAtEye(c,b,T);if(Z.isNone(b))return!1;
R.closestPointOnSilhouette(a,b,H);return R.intersectRay(a,b,e)?d.squaredDistance(H,b.origin)<d.squaredDistance(e,b.origin)?(d.copy(e,H),!1):!0:(d.subtract(z,c.eye,c.center),d.normalize(z,z),D.fromNormalAndOffset(z,-d.dot(d.normalize(z,z),H),ea),D.intersectRay(ea,b,e),!1)}function fa(a,c,b,e,f,h){d.cross(I,a,c);d.subtract(J,a,c);d.length(a)<=f||!e.aboveGround?(d.cross(b,J,e.eye),a=d.dot(a,c)/(d.length(a)*d.length(c)),h=Math.cos(q.clamp(y.cyclicalPI.normalize(q.deg2rad(h)),0,U)),c=-q.acosClamped(a)-
Math.max(0,d.length(c)-f)/(h*f)):(d.subtract(ha,e.eye,e.center),d.cross(b,J,ha),c=-d.length(J)/f);d.normalize(b,b);d.scale(b,b,d.length(I));return c}function V(a,c,b,e){e=Math.cos(q.clamp(y.cyclicalPI.normalize(q.deg2rad(e)),0,U));c=c>b?-(c-b)/(e*b):c<-b?Math.PI-(c+b)/(e*b):q.acosClamped(c/b);return((a>b?-(a-b)/(e*b):a<-b?Math.PI-(a+b)/(e*b):q.acosClamped(a/b))-c)*b}function ia(a,c,b,e,f,h,m,l,p,r){p=V(a[2],c[2],m[3],p);c=r?V(a[0],c[0],m[3],180):c[0]-a[0];a=Math.sin(l)*c-Math.cos(l)*p;l=Math.cos(l)*
c+Math.sin(l)*p;d.normalize(k,f);f=r?a/Math.sqrt(Math.abs(m[3]**2-d.dot(b,k)**2)):a/m[3];b=l/Math.sqrt(Math.abs(m[3]**2-d.dot(b,e)**2));xa.set(h,f,b)}function ja(a,c,b,e,f,h,m,l,p,r){d.cross(I,a,c);C.coordinateSystemFromOneAxisAndNormalVector(h.up,h.eye,K,L,M);C.coordinateSystemFromOneAxisAndNormalVector([0,0,1],h.eye,u,v,ka);d.copy(b,v);d.copy(e,u);d.normalize(b,b);d.scale(b,b,d.length(I));C.vectorCoordinates(a,d.normalize(L,L),d.normalize(M,M),d.normalize(K,K),la);C.vectorCoordinates(c,L,M,K,ma);
ia(la,ma,a,u,v,f,m,l,p,r)}function na(a,c,b,e,f,h,m){t.fromRotation(N,f,e);t.fromRotation(O,m,h);t.multiply(A,N,O);d.subtract(c,a,b);d.transformMat4(c,c,A);d.add(c,c,b)}function oa(a,c,b,e,f,h){t.fromRotation(N,e,b);t.fromRotation(O,h,f);t.multiply(A,N,O);d.subtract(k,a.eye,c);d.transformMat4(k,k,A);a.eye=d.add(k,k,c);d.subtract(k,a.center,c);d.transformMat4(k,k,A);a.center=d.add(k,k,c);d.subtract(k,a.up,c);d.transformMat4(k,k,A);a.up=d.add(k,k,c)}function W(a,c,b,e,f,h,m=B.Pole,l=B.Angle){a=Math.abs(a[2])<
b*m||Math.abs(c)>b;return(Math.abs(e)>Math.PI-l||Math.abs(e)<l)&&a&&h.aboveGround&&f<B.Tilt?!0:!1}function pa(a,c,b,e,f,h){h?(F.fromPoints(b,e,qa),S(c,a,qa)):(b=fa(b,e,ra,c,a[3],f),S(c,a,F.wrapAxisAngle(ra,b)))}function sa(a,c,b,e,f,h,m){const l=m?20:1;d.copy(x,e);P.copyFrom(c);let p;for(let r=0;r<l&&1E-12<d.squaredDistance(b,x);r++)if(e=d.squaredDistance(b,x),ja(b,x,v,u,E,P,a,f,h,m),oa(P,a,u,E[1],v,E[0]),na(x,x,a,u,E[1],v,E[0]),p=d.squaredDistance(b,x),p<e||0===r)c.copyFrom(P);else break}g.SpherePickPointFallback=
void 0;(function(a){a[a.Ellipsoid=0]="Ellipsoid";a[a.Silhouette=1]="Silhouette"})(g.SpherePickPointFallback||(g.SpherePickPointFallback={}));const ta=wa.createScreenPointArray();g.NavigationMode=void 0;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(g.NavigationMode||(g.NavigationMode={}));const X={Elevation:3E4,Angle:q.deg2rad(6)},B={Pole:.95,Angle:q.deg2rad(18),Tilt:45},U=q.deg2rad(80),Y=n.create(),H=n.create(),z=n.create(),ea=D.create(),ha=n.create(),u=n.create(),v=n.create(),
ka=n.create(),K=n.create(),L=n.create(),M=n.create(),la=n.create(),ma=n.create(),E=ya.create(),qa=F.create(),N=Q.create(),O=Q.create(),A=Q.create(),x=n.create(),k=n.create(),J=n.create(),P=new Aa.Camera,I=n.create(),ra=n.create(),T={origin:n.create(),direction:n.create()},ua={origin:n.create(),direction:n.create()};g.DISTANCE_CLAMP_VALUES=[1,3E8];g.PIVOT_DISTANCE_MODIFIER=30;g.PreservingHeadingThreshold=B;g.SCREEN_PIXEL_AREA=70;g.TiltThresholdPanningSpeed=U;g.VerticalPanTresholds=X;g.applyPanPlanar=
function(a,c,b){d.subtract(Y,b,c);a.eye=d.subtract(k,a.eye,Y);a.center=d.subtract(k,a.center,Y)};g.applyPanSphericalDirectRotation=pa;g.applyPanSphericalPreserveHeading=sa;g.applyRotation=S;g.applyRotationWithTwoAxes=oa;g.applyZoomOnSphere=function(a,c,b){c.getScreenCenter(ta);aa.intersectScreen(a,c,ta,k)&&(c.center=k);a=c.distance;b*=a;1E-6>Math.abs(a-b)||(b=d.scale(w.sv3d.get(),c.viewForward,b),c.eye=d.subtract(k,c.center,b))};g.applyZoomToPoint=function(a,c,b,e){const f=w.sv3d.get();b=1-b;d.subtract(f,
c,a.eye);const h=d.length(f);let m=h*(1-b);0<=b&&m<e&&(m=e,b=-(m-h)/h);1E-6>Math.abs(h-m)||(d.scale(f,f,b),a.eye=d.add(k,a.eye,f),a.center=d.lerp(k,a.center,c,b))};g.centroid=ba;g.centroidOnSphere=function(a,c,b){ba(c,b);d.normalize(b,b);d.scale(b,b,a)};g.decideNavigationMode=function(a,c,b,e){if(d.length(a.eye)-e.radius>X.Elevation)return g.NavigationMode.Horizontal;if(!b)return g.NavigationMode.Vertical;G.fromScreenAtEye(a,c,ua);return-Math.sign(a.relativeElevation)*(.5*Math.PI+za.angle(a.eye,ua.direction))<
X.Angle?g.NavigationMode.Vertical:g.NavigationMode.Horizontal};g.intersectPlaneFromScreenPoint=function(a,c,b,e){return D.intersectRay(a,G.fromScreen(c,b,T),e)};g.intersectPlaneFromScreenPointAtEye=function(a,c,b,e){return D.intersectRay(a,G.fromScreenAtEye(c,b,T),e)};g.lengthFromPoints=V;g.normalizeCoordinate=function(a,c,b){b[0]=c[0]/(a.fullWidth/a.pixelRatio);b[1]=c[1]/(a.fullHeight/a.pixelRatio);return b};g.normalizeRotationDelta=function(a){for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*
Math.PI;return a};g.offSurfaceTiltToEyeTiltGlobal=function(a,c,b,e){return ca(Math.PI/2,c,b,e)+(a-Math.PI/2)};g.onSurfaceTiltToEyeTiltGlobal=ca;g.panMotionToRotationMatrix=function(a,c,b,e,f,h,m,l,p){if(W(a.center,d.dot(a.up,a.center),d.length(a.center),-y.cyclicalPI.normalize(q.deg2rad(h)),m,c))switch(a=-y.cyclicalPI.normalize(q.deg2rad(f)),{eye:f}=c,C.coordinateSystemFromOneAxisAndNormalVector([0,0,1],f,u,v,ka),f=b.translation[0]*e.pan,h="zoom"===p.mode?0:b.translation[1]*e.pan,c=Math.max(Math.sqrt(Math.abs(1-
d.dot(c.center,u)**2/d.length(c.center)**2)),.5),m=-Math.cos(a)*h+Math.sin(a)*f,t.rotate(l.pan.matrix,l.pan.matrix,(Math.sin(a)*h+Math.cos(a)*f)/c,u),l.pan.enabled=!0,p.mode){case "pan":t.rotate(l.pan.matrix,l.pan.matrix,m,v);l.pan.enabled=!0;break;case "zoom":l.zoom=-b.translation[1]*e.zoom}else{{const {eye:r,viewRight:va}=c;c=d.cross(w.sv3d.get(),va,r);a=b.translation[0]*e.pan;0!==a&&(t.rotate(l.pan.matrix,l.pan.matrix,-a,c),l.pan.enabled=!0);switch(p.mode){case "pan":b=b.translation[1]*e.pan;0!==
b&&(t.rotate(l.pan.matrix,l.pan.matrix,b,va),l.pan.enabled=!0);break;case "zoom":l.zoom=-b.translation[1]*e.zoom}}}};g.panToPosition=function(a,c,b,e,f,h,m){W(b,d.dot(c.up,b),a[3],-y.cyclicalPI.normalize(q.deg2rad(f)),h,c,B.Pole,B.Angle)?sa(a,c,b,e,-y.cyclicalPI.normalize(q.deg2rad(f)),h,m):pa(a,c,b,e,h,m)};g.pickPointAndInitSphere=function(a,c,b,e,f,h){const m=n.create(),l=R.create();let p=!0,r=!0;a.intersectScreen(b,m,h)?l[3]=d.length(m):(r=!1,l[3]=c.aboveGround&&f!==g.SpherePickPointFallback.Ellipsoid?
Math.max(d.length(c.center),.9*e.radius):d.length(c.eye)-c.relativeElevation,f===g.SpherePickPointFallback.Silhouette?da(l,c,b,m):p=aa.intersectScreen(l,c,b,m));return{sphere:l,scenePickPoint:p?m:null,hasGeometryIntersection:r}};g.preserveHeadingThreshold=W;g.rotatePointAroundTwoAxes=na;g.rotationAngleAndAxisDirectRotation=fa;g.rotationAnglesAndAxesHeadingPreserving=ja;g.rotationAnglesHeadingPreserving=ia;g.rotationFromPointsAroundAxis=function(a,c,b){const e=w.sv3d.get(),f=w.sv3d.get(),h=w.sv3d.get();
d.copy(f,a);d.copy(h,c);a=d.dot(f,b);c=d.dot(h,b);d.scale(e,b,a);d.subtract(f,f,e);d.normalize(f,f);d.scale(e,b,c);d.subtract(h,h,e);d.normalize(h,h);a=d.dot(f,h);d.cross(e,b,f);b=d.dot(h,e);return Math.atan2(b,a)};g.sphereOrPlanePointFromScreenPoint=da;Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});