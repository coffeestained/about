// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.24/esri/copyright.txt for details.
//>>built
require({cache:{"esri/chunks/boundedPlane":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ../core/ObjectStack ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/support/Axis ../geometry/support/lineSegment ../geometry/support/plane ../geometry/support/ray ../geometry/support/vector ../geometry/support/vectorStacks".split(" "),function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w){function t(ba=da){return{plane:e.create(ba.plane),origin:k.clone(ba.origin),basis1:k.clone(ba.basis1),basis2:k.clone(ba.basis2)}}
function x(ba,Z,fa){const ja=ka.get();ja.origin=ba;ja.basis1=Z;ja.basis2=fa;ja.plane=e.wrap(0,0,0,0);C(ja);return ja}function B(ba,Z=t()){return u(ba.origin,ba.basis1,ba.basis2,Z)}function q(ba,Z){g.copy(Z.origin,ba.origin);g.copy(Z.basis1,ba.basis1);g.copy(Z.basis2,ba.basis2);e.copy(Z.plane,ba.plane)}function u(ba,Z,fa,ja=t()){g.copy(ja.origin,ba);g.copy(ja.basis1,Z);g.copy(ja.basis2,fa);C(ja);1E-6<Math.abs(g.dot(ja.basis1,ja.basis2)/(g.length(ja.basis1)*g.length(ja.basis2)))&&V.warn("fromValues()",
"Provided basis vectors are not perpendicular");1E-6<Math.abs(g.dot(ja.basis1,T(ja)))&&V.warn("fromValues()","Basis vectors and plane normal are not perpendicular");1E-6<Math.abs(-g.dot(T(ja),ja.origin)-ja.plane[3])&&V.warn("fromValues()","Plane offset is not consistent with plane origin");return ja}function C(ba){e.fromVectorsAndPoint(ba.basis2,ba.basis1,ba.origin,ba.plane)}function z(ba,Z,fa){ba!==fa&&B(ba,fa);ba=g.scale(w.sv3d.get(),T(ba),Z);g.add(fa.origin,fa.origin,ba);fa.plane[3]-=Z;return fa}
function A(ba,Z,fa){p(Z,fa);z(fa,H(ba,ba.origin),fa);return fa}function p(ba,Z=t()){const fa=(ba[2]-ba[0])/2,ja=(ba[3]-ba[1])/2;g.set(Z.origin,ba[0]+fa,ba[1]+ja,0);g.set(Z.basis1,fa,0,0);g.set(Z.basis2,0,ja,0);e.fromValues(0,0,1,0,Z.plane);return Z}function y(ba,Z,fa){return e.intersectRay(ba.plane,Z,fa)?U(ba,fa):!1}function D(ba,Z,fa){if(y(ba,Z,fa))return fa;ba=E(ba,Z,w.sv3d.get());g.add(fa,Z.origin,g.scale(w.sv3d.get(),Z.direction,g.distance(Z.origin,ba)/g.length(Z.direction)));return fa}function E(ba,
Z,fa){const ja=ca.get();var oa=ca.get();R(ba,Z,ja,oa);oa=Number.POSITIVE_INFINITY;for(const qa of la){var sa=W(ba,qa,ha.get());const Ha=w.sv3d.get();e.intersectLineSegment(ja,sa,Ha)&&(sa=g.direction(w.sv3d.get(),Z.origin,Ha),sa=Math.abs(m.acosClamped(g.dot(Z.direction,sa))),sa<oa&&(oa=sa,g.copy(fa,Ha)))}return oa===Number.POSITIVE_INFINITY?F(ba,Z,fa):fa}function F(ba,Z,fa){if(y(ba,Z,fa))return fa;const ja=ca.get(),oa=ca.get();R(ba,Z,ja,oa);let sa=Number.POSITIVE_INFINITY;for(const Ha of la){var qa=
W(ba,Ha,ha.get());const Ga=w.sv3d.get();e.intersectLineSegmentClamp(ja,qa,Ga)&&(qa=h.distance2(Z,Ga),e.isPointInside(oa,Ga)&&qa<sa&&(sa=qa,g.copy(fa,Ga)))}K(ba,Z.origin)<sa&&G(ba,Z.origin,fa);return fa}function G(ba,Z,fa){var ja=e.projectPoint(ba.plane,Z,w.sv3d.get());Z=d.projectPointClamp(aa(ba,ba.basis1),ja,-1,1,w.sv3d.get());ja=d.projectPointClamp(aa(ba,ba.basis2),ja,-1,1,w.sv3d.get());g.subtract(fa,g.add(w.sv3d.get(),Z,ja),ba.origin);return fa}function P(ba,Z,fa){const {origin:ja,basis1:oa,basis2:sa}=
ba,qa=g.subtract(w.sv3d.get(),Z,ja);Z=v.projectPointSignedLength(oa,qa);const Ha=v.projectPointSignedLength(sa,qa);ba=v.projectPointSignedLength(T(ba),qa);return g.set(fa,Z,Ha,ba)}function K(ba,Z){Z=P(ba,Z,w.sv3d.get());const {basis1:fa,basis2:ja}=ba;ba=g.length(fa);var oa=g.length(ja);ba=Math.max(Math.abs(Z[0])-ba,0);oa=Math.max(Math.abs(Z[1])-oa,0);Z=Z[2];return ba*ba+oa*oa+Z*Z}function N(ba,Z){return Math.sqrt(K(ba,Z))}function M(ba,Z){let fa=Number.NEGATIVE_INFINITY;for(const oa of la){var ja=
W(ba,oa,ha.get());ja=d.distance2(ja,Z);ja>fa&&(fa=ja)}return Math.sqrt(fa)}function L(ba,Z){return e.isPointInside(ba.plane,Z)&&U(ba,Z)}function J(ba,Z,fa,ja){switch(fa){case f.Axis.X:g.copy(ja,ba.basis1);g.normalize(ja,ja);break;case f.Axis.Y:g.copy(ja,ba.basis2);g.normalize(ja,ja);break;case f.Axis.Z:g.copy(ja,T(ba))}return ja}function H(ba,Z){const fa=-ba.plane[3];return v.projectPointSignedLength(T(ba),Z)-fa}function I(ba,Z,fa,ja){const oa=H(ba,Z);ba=g.scale(ia,T(ba),fa-oa);g.add(ja,Z,ba);return ja}
function O(ba,Z){return g.exactEquals(ba.basis1,Z.basis1)&&g.exactEquals(ba.basis2,Z.basis2)&&g.exactEquals(ba.origin,Z.origin)}function Q(ba,Z,fa){ba!==fa&&B(ba,fa);r.invert(Y,Z);r.transpose(Y,Y);g.transformMat4(fa.basis1,ba.basis1,Y);g.transformMat4(fa.basis2,ba.basis2,Y);g.transformMat4(e.normal(fa.plane),e.normal(ba.plane),Y);g.transformMat4(fa.origin,ba.origin,Z);e.setOffsetFromPoint(fa.plane,fa.plane,fa.origin);return fa}function S(ba,Z,fa,ja){ba!==ja&&B(ba,ja);r.fromRotation(ea,Z,fa);g.transformMat4(ja.basis1,
ba.basis1,ea);g.transformMat4(ja.basis2,ba.basis2,ea);C(ja);return ja}function T(ba){return e.normal(ba.plane)}function U(ba,Z){const fa=g.subtract(w.sv3d.get(),Z,ba.origin);Z=g.squaredLength(ba.basis1);const ja=g.squaredLength(ba.basis2),oa=g.dot(ba.basis1,fa);ba=g.dot(ba.basis2,fa);return 0>-oa-Z&&0>oa-Z&&0>-ba-ja&&0>ba-ja}function aa(ba,Z){const fa=ha.get();g.copy(fa.origin,ba.origin);g.copy(fa.vector,Z);return fa}function W(ba,Z,fa){const {basis1:ja,basis2:oa,origin:sa}=ba;ba=g.scale(w.sv3d.get(),
ja,Z.origin[0]);const qa=g.scale(w.sv3d.get(),oa,Z.origin[1]);g.add(fa.origin,ba,qa);g.add(fa.origin,fa.origin,sa);ba=g.scale(w.sv3d.get(),ja,Z.direction[0]);Z=g.scale(w.sv3d.get(),oa,Z.direction[1]);g.scale(fa.vector,g.add(ba,ba,Z),2);return fa}function R(ba,Z,fa,ja){ba=T(ba);e.fromVectorsAndPoint(ba,Z.direction,Z.origin,fa);e.fromVectorsAndPoint(e.normal(fa),ba,Z.origin,ja)}const V=c.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");b=function(){this.plane=e.create();this.origin=k.create();
this.basis1=k.create();this.basis2=k.create()};const da={plane:e.create(),origin:k.fromValues(0,0,0),basis1:k.fromValues(1,0,0),basis2:k.fromValues(0,1,0)},ca=new l.ObjectStack(e.create),ha=new l.ObjectStack(d.create),ia=k.create(),ka=new l.ObjectStack(()=>({origin:null,basis1:null,basis2:null,plane:null})),la=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Y=n.create(),ea=n.create();l=Object.freeze(Object.defineProperty({__proto__:null,
BoundedPlaneClass:b,create:t,wrap:x,copy:B,copyWithoutVerify:q,fromValues:u,updateUnboundedPlane:C,elevate:z,setExtent:A,fromAABoundingRect:p,intersectRay:y,intersectRayClosestSilhouette:D,closestPointOnSilhouette:E,closestPoint:F,projectPoint:G,projectPointLocal:P,distance2:K,distance:N,distanceToSilhouette:M,extrusionContainsPoint:L,axisAt:J,altitudeAt:H,setAltitudeAt:I,equals:O,transform:Q,rotate:S,normal:T,UP:da},Symbol.toStringTag,{value:"Module"}));a.BoundedPlaneClass=b;a.UP=da;a.altitudeAt=
H;a.axisAt=J;a.boundedPlane=l;a.closestPoint=F;a.closestPointOnSilhouette=E;a.copy=B;a.copyWithoutVerify=q;a.create=t;a.distance=N;a.distance2=K;a.distanceToSilhouette=M;a.elevate=z;a.equals=O;a.extrusionContainsPoint=L;a.fromAABoundingRect=p;a.fromValues=u;a.intersectRay=y;a.intersectRayClosestSilhouette=D;a.normal=T;a.projectPoint=G;a.projectPointLocal=P;a.rotate=S;a.setAltitudeAt=I;a.setExtent=A;a.transform=Q;a.updateUnboundedPlane=C;a.wrap=x})},"esri/core/ObjectStack":function(){define(["exports",
"./nextTick"],function(a,b){let c=function(){function m(r){this.allocator=r;this._items=[];this._itemsPtr=0;this._grow()}var l=m.prototype;l.get=function(){0===this._itemsPtr&&b.nextTick(()=>this._reset());this._itemsPtr===this._items.length&&this._grow();return this._items[this._itemsPtr++]};l._reset=function(){this._items.length=Math.min(Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3072),this._items.length);this._itemsPtr=0};l._grow=function(){for(let r=0;r<Math.max(8,Math.min(this._items.length,
1024));r++)this._items.push(this.allocator())};return m}();a.ObjectStack=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/mat4f64":function(){define(["exports"],function(a){function b(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function c(g){return[g[0],g[1],g[2],g[3],g[4],g[5],g[6],g[7],g[8],g[9],g[10],g[11],g[12],g[13],g[14],g[15]]}function m(g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A){return[g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A]}function l(g,k){return new Float64Array(g,
k,16)}const r=b(),n=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:m,createView:l,IDENTITY:r},Symbol.toStringTag,{value:"Module"}));a.IDENTITY=r;a.clone=c;a.create=b;a.createView=l;a.fromValues=m;a.mat4f64=n})},"esri/geometry/support/Axis":function(){define(["exports"],function(a){a.Axis=void 0;var b=a.Axis||(a.Axis={});b[b.X=0]="X";b[b.Y=1]="Y";b[b.Z=2]="Z";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/lineSegment":function(){define("exports ../../core/mathUtils ../../core/ObjectStack ../../chunks/vec3 ../../chunks/vec3f64 ./vectorStacks".split(" "),
function(a,b,c,m,l,r){function n(w){return w?{origin:l.clone(w.origin),vector:l.clone(w.vector)}:{origin:l.create(),vector:l.create()}}function g(w,t){const x=v.get();x.origin=w;x.vector=t;return x}function k(w,t,x=n()){m.copy(x.origin,w);m.copy(x.vector,t);return x}function f(w,t){t=m.subtract(r.sv3d.get(),t,w.origin);var x=m.dot(w.vector,t);const B=m.dot(w.vector,w.vector);x=b.clamp(x/B,0,1);w=m.subtract(r.sv3d.get(),m.scale(r.sv3d.get(),w.vector,x),t);return m.dot(w,w)}function d(w,t,x,B,q){const {vector:u,
origin:C}=w;t=m.subtract(r.sv3d.get(),t,C);t=m.dot(u,t)/m.squaredLength(u);m.scale(q,u,b.clamp(t,x,B));return m.add(q,q,w.origin)}function e(w,t,x,B){const q=w.origin;var u=m.add(r.sv3d.get(),q,w.vector);w=t.origin;var C=m.add(r.sv3d.get(),w,t.vector),z=r.sv3d.get();t=r.sv3d.get();z[0]=q[0]-w[0];z[1]=q[1]-w[1];z[2]=q[2]-w[2];t[0]=C[0]-w[0];t[1]=C[1]-w[1];t[2]=C[2]-w[2];if(1E-6>Math.abs(t[0])&&1E-6>Math.abs(t[1])&&1E-6>Math.abs(t[2]))return!1;C=r.sv3d.get();C[0]=u[0]-q[0];C[1]=u[1]-q[1];C[2]=u[2]-
q[2];if(1E-6>Math.abs(C[0])&&1E-6>Math.abs(C[1])&&1E-6>Math.abs(C[2]))return!1;u=z[0]*t[0]+z[1]*t[1]+z[2]*t[2];var A=t[0]*C[0]+t[1]*C[1]+t[2]*C[2];const p=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],y=(C[0]*C[0]+C[1]*C[1]+C[2]*C[2])*p-A*A;if(1E-6>Math.abs(y))return!1;z=(u*A-(z[0]*C[0]+z[1]*C[1]+z[2]*C[2])*p)/y;u=(u+A*z)/p;x&&(z=b.clamp(z,0,1),u=b.clamp(u,0,1));x=r.sv3d.get();A=r.sv3d.get();x[0]=q[0]+z*C[0];x[1]=q[1]+z*C[1];x[2]=q[2]+z*C[2];A[0]=w[0]+u*t[0];A[1]=w[1]+u*t[1];A[2]=w[2]+u*t[2];B.tA=z;B.tB=u;B.pA=x;
B.pB=A;B.distance2=m.squaredDistance(x,A);return!0}const h={tA:0,tB:0,pA:l.create(),pB:l.create(),distance2:0},v=new c.ObjectStack(()=>({origin:null,vector:null}));a.closestLineSegmentDistance2=function(w,t){return e(w,t,!0,h)?h.distance2:null};a.closestLineSegmentPoint=function(w,t,x){return e(w,t,!0,h)?(m.copy(x,h.pA),!0):!1};a.closestRayDistance2=function(w,t){if(e(w,g(t.origin,t.direction),!1,h)){const {tA:x,pB:B,distance2:q}=h;if(0<=x&&1>=x)return q;if(0>x)return m.squaredDistance(w.origin,B);
if(1<x)return m.squaredDistance(m.add(r.sv3d.get(),w.origin,w.vector),B)}return null};a.copy=function(w,t=n()){return k(w.origin,w.vector,t)};a.create=n;a.distance=function(w,t){return Math.sqrt(f(w,t))};a.distance2=f;a.fromPoints=function(w,t,x=n()){m.copy(x.origin,w);m.subtract(x.vector,t,w);return x};a.fromValues=k;a.pointAt=function(w,t,x){return m.add(x,w.origin,m.scale(x,w.vector,t))};a.projectPoint=function(w,t,x){return d(w,t,0,1,x)};a.projectPointClamp=d;a.wrap=g;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/vectorStacks":function(){define(["exports","../../core/VectorStack"],function(a,b){const c=b.VectorStack.createVec2f64(),m=b.VectorStack.createVec3f64(),l=b.VectorStack.createVec4f64(),r=b.VectorStack.createMat3f64(),n=b.VectorStack.createMat4f64();b=b.VectorStack.createQuatf64();a.sm3d=r;a.sm4d=n;a.sq4d=b;a.sv2d=c;a.sv3d=m;a.sv4d=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/core/VectorStack":function(){define("exports ../chunks/_rollupPluginBabelHelpers ./byteSizeEstimations ./nextTick ../chunks/mat3f64 ../chunks/mat4f64 ../chunks/quatf64 ../chunks/vec2f64 ../chunks/vec3f64 ../chunks/vec4f64".split(" "),function(a,b,c,m,l,r,n,g,k,f){let d=function(){function h(w,t,x){this.itemByteSize=w;this.itemCreate=t;this._buffers=[];this._items=[];this._itemsPtr=0;this._itemsPerBuffer=Math.ceil(x/this.itemByteSize)}var v=h.prototype;v.get=function(){0===this._itemsPtr&&m.nextTick(()=>
this._reset());const w=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=w;){const t=new ArrayBuffer(this._itemsPerBuffer*this.itemByteSize);for(let x=0;x<this._itemsPerBuffer;++x)this._items.push(this.itemCreate(t,x*this.itemByteSize));this._buffers.push(t)}return this._items[this._itemsPtr++]};v._reset=function(){const w=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>w;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;
this._itemsPtr=0};h.createVec2f64=function(w=e){return new h(16,g.createView,w)};h.createVec3f64=function(w=e){return new h(24,k.createView,w)};h.createVec4f64=function(w=e){return new h(32,f.createView,w)};h.createMat3f64=function(w=e){return new h(72,l.createView,w)};h.createMat4f64=function(w=e){return new h(128,r.createView,w)};h.createQuatf64=function(w=e){return new h(32,n.createView,w)};b._createClass(h,[{key:"test",get:function(){return{size:this._buffers.length*this._itemsPerBuffer*this.itemByteSize}}}]);
return h}();const e=4*c.ByteSizeUnit.KILOBYTES;a.VectorStack=d;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/byteSizeEstimations":function(){define(["exports"],function(a){function b(c){return 32+c.length}a.ByteSizeUnit=void 0;(function(c){c[c.KILOBYTES=1024]="KILOBYTES";c[c.MEGABYTES=1048576]="MEGABYTES";c[c.GIGABYTES=1073741824]="GIGABYTES"})(a.ByteSizeUnit||(a.ByteSizeUnit={}));a.estimateAttributesObjectSize=function(c){if(!c)return 0;let m=
32;for(const l in c)if(c.hasOwnProperty(l)){const r=c[l];switch(typeof r){case "string":m+=b(r);break;case "number":m+=16;break;case "boolean":m+=4}}return m};a.estimateFixedArraySize=function(c,m){return 32+c.length*m};a.estimateNumberByteSize=function(){return 16};a.estimateStringByteSize=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/mat3f64":function(){define(["exports"],function(a){function b(){return[1,0,0,0,1,0,0,0,1]}function c(n){return[n[0],
n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8]]}function m(n,g,k,f,d,e,h,v,w){return[n,g,k,f,d,e,h,v,w]}function l(n,g){return new Float64Array(n,g,9)}const r=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:m,createView:l},Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;a.createView=l;a.fromValues=m;a.mat3f64=r})},"esri/chunks/quatf64":function(){define(["exports"],function(a){function b(){return[0,0,0,1]}function c(g){return[g[0],g[1],g[2],g[3]]}function m(g,k,
f,d){return[g,k,f,d]}function l(g,k){return new Float64Array(g,k,4)}const r=b(),n=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:m,createView:l,IDENTITY:r},Symbol.toStringTag,{value:"Module"}));a.IDENTITY=r;a.clone=c;a.create=b;a.createView=l;a.fromValues=m;a.quatf64=n})},"esri/chunks/vec2f64":function(){define(["exports"],function(a){function b(){return[0,0]}function c(t){return[t[0],t[1]]}function m(t,x){return[t,x]}function l(t){const x=[0,0],B=Math.min(2,t.length);
for(let q=0;q<B;++q)x[q]=t[q];return x}function r(t,x){return new Float64Array(t,x,2)}function n(){return[0,0]}function g(){return[1,1]}function k(){return[1,0]}function f(){return[0,1]}const d=[0,0],e=[1,1],h=[1,0],v=[0,1],w=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:m,fromArray:l,createView:r,zeros:n,ones:g,unitX:k,unitY:f,ZEROS:d,ONES:e,UNIT_X:h,UNIT_Y:v},Symbol.toStringTag,{value:"Module"}));a.ONES=e;a.UNIT_X=h;a.UNIT_Y=v;a.ZEROS=d;a.clone=c;a.create=b;a.createView=
r;a.fromArray=l;a.fromValues=m;a.ones=g;a.unitX=k;a.unitY=f;a.vec2f64=w;a.zeros=n})},"esri/geometry/support/plane":function(){define("exports ../../core/mathUtils ../../core/maybe ../../chunks/vec3 ../../chunks/vec3f64 ../../chunks/sphere ./vector ./vectorStacks ../../views/3d/support/mathUtils".split(" "),function(a,b,c,m,l,r,n,g,k){function f(F=p){return[F[0],F[1],F[2],F[3]]}function d(F,G){return e(G[0],G[1],G[2],G[3],F)}function e(F,G,P,K,N=f()){N[0]=F;N[1]=G;N[2]=P;N[3]=K;return N}function h(F,
G,P){var K=G[0]*G[0]+G[1]*G[1]+G[2]*G[2];K=1E-5<Math.abs(K-1)&&1E-12<K?1/Math.sqrt(K):1;P[0]=G[0]*K;P[1]=G[1]*K;P[2]=G[2]*K;P[3]=-(P[0]*F[0]+P[1]*F[1]+P[2]*F[2]);return P}function v(F,G,P,K=f()){var N=P[0]-G[0],M=P[1]-G[1],L=P[2]-G[2];P=F[0]-G[0];const J=F[1]-G[1],H=F[2]-G[2];G=M*H-L*J;L=L*P-N*H;N=N*J-M*P;M=G*G+L*L+N*N;M=1E-5<Math.abs(M-1)&&1E-12<M?1/Math.sqrt(M):1;K[0]=G*M;K[1]=L*M;K[2]=N*M;K[3]=-(K[0]*F[0]+K[1]*F[1]+K[2]*F[2]);return K}function w(F,G,P,K,N){if(3>F.count)return!1;F.getVec(P,q);let M=
K,L=!1;for(;M<F.count-1&&!L;)F.getVec(M,u),M++,L=!m.exactEquals(q,u);if(!L)return!1;M=Math.max(M,N);for(L=!1;M<F.count&&!L;)F.getVec(M,C),M++,m.subtract(z,q,u),m.normalize(z,z),m.subtract(A,u,C),m.normalize(A,A),L=!m.exactEquals(q,C)&&!m.exactEquals(u,C)&&.99619469809>Math.abs(m.dot(z,A));if(!L)return 0===P&&1===K&&2===N?!1:w(F,G,0,1,2);v(q,u,C,G);return!0}function t(F,G,P){F=m.scale(g.sv3d.get(),F,m.dot(F,G));m.subtract(P,G,F);return P}function x(F,G){return m.dot(F,G)+F[3]}function B(F,G,P,K,N){const M=
m.dot(F,P);if(0===M)return!1;F=-(m.dot(F,G)+F[3])/M;K&y.CLAMP&&(F=b.clamp(F,0,1));if(!(K&y.INFINITE_MIN)&&0>F||!(K&y.INFINITE_MAX)&&1<F)return!1;m.add(N,G,m.scale(N,P,F));return!0}const q=l.create(),u=l.create(),C=l.create(),z=l.create(),A=l.create(),p=[0,0,1,0];var y;(function(F){F[F.NONE=0]="NONE";F[F.CLAMP=1]="CLAMP";F[F.INFINITE_MIN=4]="INFINITE_MIN";F[F.INFINITE_MAX=8]="INFINITE_MAX"})(y||(y={}));const D=y.INFINITE_MIN|y.INFINITE_MAX,E=y.INFINITE_MAX;a.UP=p;a.clip=function(F,G){const P=m.dot(F,
G.ray.direction);F=-x(F,G.ray.origin);if(0>F&&0<=P)return!1;if(-1E-6<P&&1E-6>P)return 0<F;if((0>F||0>P)&&!(0>F&&0>P))return!0;F/=P;0<P?F<G.c1&&(G.c1=F):F>G.c0&&(G.c0=F);return G.c0<=G.c1};a.clipInfinite=function(F,G){const P=m.dot(F,G.ray.direction);F=-x(F,G.ray.origin);if(-1E-6<P&&1E-6>P)return 0<F;F/=P;0<P?F<G.c1&&(G.c1=F):F>G.c0&&(G.c0=F);return G.c0<=G.c1};a.copy=d;a.create=f;a.distance=function(F,G){return Math.abs(x(F,G))};a.fromManyPoints=function(F,G){return w(F,G,0,1,2)};a.fromManyPointsSampleAt=
w;a.fromNormalAndOffset=function(F,G,P){m.copy(P,F);P[3]=G;return P};a.fromPoints=v;a.fromPositionAndNormal=h;a.fromValues=e;a.fromVectorsAndPoint=function(F,G,P,K){m.cross(C,G,F);return h(P,C,K)};a.intersectLine=function(F,G,P,K){P=m.subtract(g.sv3d.get(),P,G);return B(F,G,P,D,K)};a.intersectLineSegment=function(F,G,P){return B(F,G.origin,G.vector,y.NONE,P)};a.intersectLineSegmentClamp=function(F,G,P){return B(F,G.origin,G.vector,y.CLAMP,P)};a.intersectRay=function(F,G,P){return c.isSome(G)?B(F,
G.origin,G.direction,E,P):!1};a.isAABBFullyInside=function(F,G){const P=G[0],K=G[1],N=G[2],M=G[3],L=G[4];G=G[5];return 0<=F[0]*(0<F[0]?P:M)+F[1]*(0<F[1]?K:L)+F[2]*(0<F[2]?N:G)+F[3]};a.isPointInside=function(F,G){return 0<=x(F,G)};a.isPointOutside=function(F,G){return 0>x(F,G)};a.isSphereFullyInside=function(F,G){return 0<=x(F,r.getCenter(G))-G[3]};a.isSphereFullyOutside=function(F,G){return 0>x(F,r.getCenter(G))+G[3]};a.negate=function(F,G){G[0]=-F[0];G[1]=-F[1];G[2]=-F[2];G[3]=-F[3];return G};a.normal=
function(F){return F};a.projectPoint=function(F,G,P){const K=m.scale(g.sv3d.get(),F,-F[3]);G=m.subtract(g.sv3d.get(),G,K);F=t(F,G,g.sv3d.get());m.add(P,F,K);return P};a.projectPointLocal=function(F,G,P,K){var N=g.sv3d.get(),M=g.sv3d.get();k.tangentFrame(F,N,M);G=m.subtract(g.sv3d.get(),P,G);N=n.projectPointSignedLength(N,G);M=n.projectPointSignedLength(M,G);F=n.projectPointSignedLength(F,G);return m.set(K,N,M,F)};a.projectVector=t;a.setOffsetFromPoint=function(F,G,P){G!==F&&d(F,G);F[3]=-m.dot(F,P);
return F};a.signedDistance=x;a.wrap=function(F=p[0],G=p[1],P=p[2],K=p[3]){return e(F,G,P,K,g.sv4d.get())};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/sphere":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ../core/maybe ./mat4 ./vec3 ./vec3f64 ./vec4 ./vec4f64 ../geometry/support/Axis ../geometry/support/ray ../geometry/support/vector ../geometry/support/vectorStacks".split(" "),function(a,b,c,m,l,r,n,g,k,f,d,e,h,
v){function w(){return f.create()}function t(U,aa=w()){return k.copy(aa,U)}function x(U,aa){return f.fromValues(U[0],U[1],U[2],aa)}function B(U){return U}function q(U){U[0]=U[1]=U[2]=U[3]=0}function u(U,aa){U[0]=U[1]=U[2]=0;U[3]=aa;return U}function C(U){return U[3]}function z(U){return U}function A(U,aa,W,R){return f.fromValues(U,aa,W,R)}function p(U,aa,W){U!==W&&n.copy(W,U);W[3]=U[3]+aa;return W}function y(U,aa,W){O.error("sphere.setExtent is not yet supported");return U===W?W:t(U,W)}function D(U,
aa,W){if(l.isNone(aa))return!1;const {origin:R,direction:V}=aa;var da=Q;da[0]=R[0]-U[0];da[1]=R[1]-U[1];da[2]=R[2]-U[2];aa=V[0]*V[0]+V[1]*V[1]+V[2]*V[2];const ca=2*(V[0]*da[0]+V[1]*da[1]+V[2]*da[2]);U=ca*ca-4*aa*(da[0]*da[0]+da[1]*da[1]+da[2]*da[2]-U[3]*U[3]);if(0>U)return!1;da=Math.sqrt(U);U=(-ca-da)/(2*aa);aa=(-ca+da)/(2*aa);if(0>U||aa<U&&0<aa)U=aa;if(0>U)return!1;W&&(W[0]=R[0]+V[0]*U,W[1]=R[1]+V[1]*U,W[2]=R[2]+V[2]*U);return!0}function E(U,aa){return D(U,aa,null)}function F(U,aa,W){if(D(U,aa,W))return W;
U=G(U,aa,v.sv3d.get());n.add(W,aa.origin,n.scale(v.sv3d.get(),aa.direction,n.distance(aa.origin,U)/n.length(aa.direction)));return W}function G(U,aa,W){const R=v.sv3d.get(),V=v.sm4d.get();n.cross(R,aa.origin,aa.direction);const da=U[3];n.cross(W,R,aa.origin);n.scale(W,W,1/n.length(W)*da);U=M(U,aa.origin);aa=h.angle(aa.origin,W);r.fromRotation(V,aa+U,R);n.transformMat4(W,W,V);return W}function P(U,aa,W){if(D(U,aa,W))return W;e.closestPoint(aa,U,W);return K(U,W,W)}function K(U,aa,W){aa=n.subtract(v.sv3d.get(),
aa,U);aa=n.scale(v.sv3d.get(),aa,U[3]/n.length(aa));return n.add(W,aa,U)}function N(U,aa){aa=n.subtract(v.sv3d.get(),aa,U);aa=n.squaredLength(aa);return Math.sqrt(Math.abs(aa-U[3]*U[3]))}function M(U,aa){aa=n.subtract(v.sv3d.get(),aa,U);aa=n.length(aa);U=U[3];return m.acosClamped(U/(U+Math.abs(U-aa)))}function L(U,aa,W,R){U=n.subtract(S,aa,U);switch(W){case d.Axis.X:return W=m.cartesianToSpherical(U,S)[2],n.set(R,-Math.sin(W),Math.cos(W),0);case d.Axis.Y:return U=m.cartesianToSpherical(U,S),W=U[1],
U=U[2],aa=Math.sin(W),n.set(R,-aa*Math.cos(U),-aa*Math.sin(U),Math.cos(W));case d.Axis.Z:return n.normalize(R,U)}}function J(U,aa){aa=n.subtract(T,aa,U);return n.length(aa)-U[3]}function H(U,aa,W,R){const V=J(U,aa);U=L(U,aa,d.Axis.Z,T);W=n.scale(T,U,W-V);return n.add(R,aa,W)}function I(U,aa){aa=n.squaredDistance(U,aa);U=U[3];return aa<=U*U}const O=c.getLogger("esri.geometry.support.sphere"),Q=g.create(),S=g.create(),T=g.create();b=w();c=Object.freeze(Object.defineProperty({__proto__:null,create:w,
copy:t,fromCenterAndRadius:x,wrap:B,clear:q,fromRadius:u,getRadius:C,getCenter:z,fromValues:A,elevate:p,setExtent:y,intersectRay:D,intersectsRay:E,intersectRayClosestSilhouette:F,closestPointOnSilhouette:G,closestPoint:P,projectPoint:K,distanceToSilhouette:N,angleToSilhouette:M,axisAt:L,altitudeAt:J,setAltitudeAt:H,containsPoint:I,tmpSphere:b},Symbol.toStringTag,{value:"Module"}));a.altitudeAt=J;a.angleToSilhouette=M;a.axisAt=L;a.clear=q;a.closestPoint=P;a.closestPointOnSilhouette=G;a.containsPoint=
I;a.copy=t;a.create=w;a.distanceToSilhouette=N;a.elevate=p;a.fromCenterAndRadius=x;a.fromRadius=u;a.fromValues=A;a.getCenter=z;a.getRadius=C;a.intersectRay=D;a.intersectRayClosestSilhouette=F;a.intersectsRay=E;a.projectPoint=K;a.setAltitudeAt=H;a.setExtent=y;a.sphere=c;a.tmpSphere=b;a.wrap=B})},"esri/geometry/support/ray":function(){define("exports ../../core/arrayUtils ../../core/ObjectStack ../../chunks/vec3 ../../chunks/vec3f64 ./vectorStacks".split(" "),function(a,b,c,m,l,r){function n(d){return d?
{origin:l.clone(d.origin),direction:l.clone(d.direction)}:{origin:l.create(),direction:l.create()}}function g(d,e,h=n()){m.copy(h.origin,d);m.copy(h.direction,e);return h}function k(d,e){d=m.cross(r.sv3d.get(),m.normalize(r.sv3d.get(),d.direction),m.subtract(r.sv3d.get(),e,d.origin));return m.dot(d,d)}const f=new c.ObjectStack(function(){return{origin:null,direction:null}});a.closestPoint=function(d,e,h){e=m.dot(d.direction,m.subtract(h,e,d.origin));m.add(h,d.origin,m.scale(h,d.direction,e));return h};
a.copy=function(d,e=n()){return g(d.origin,d.direction,e)};a.create=n;a.distance=function(d,e){return Math.sqrt(k(d,e))};a.distance2=k;a.equals=function(d,e){return b.equals(d.origin,e.origin)&&b.equals(d.direction,e.direction)};a.fromPoints=function(d,e,h=n()){m.copy(h.origin,d);m.subtract(h.direction,e,d);return h};a.fromValues=g;a.wrap=function(d,e){const h=f.get();h.origin=d;h.direction=e;return h};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/vector":function(){define(["exports",
"../../core/mathUtils","../../chunks/vec3","../../chunks/vec3f64"],function(a,b,c,m){const l=m.create(),r=m.create();a.angle=function(n,g){n=c.dot(n,g)/(c.length(n)*c.length(g));return-b.acosClamped(n)};a.angleAroundAxis=function(n,g,k){c.normalize(l,n);c.normalize(r,g);n=c.dot(l,r);n=b.acosClamped(n);g=c.cross(l,l,r);return 0>c.dot(g,k)?2*Math.PI-n:n};a.projectPoint=function(n,g,k){g=c.dot(n,g)/c.dot(n,n);return c.scale(k,n,g)};a.projectPointSignedLength=function(n,g){return c.dot(n,g)/c.length(n)};
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/mathUtils":function(){define(["exports","../../../core/mathUtils","../../../chunks/vec3","../../../chunks/vec3f64"],function(a,b,c,m){const l=m.create(),r=m.create(),n=m.create(),g=m.create(),k=m.create();a.angle=function(f,d,e){f=c.normalize(g,f);d=c.normalize(k,d);const h=b.acosClamped(c.dot(f,d));return e&&(f=c.cross(n,f,d),0>c.dot(f,e))?-h:h};a.bilerp=function(f,d,e,h,v,w){f+=(d-
f)*v;return f+(e+(h-e)*v-f)*w};a.cosCapped=function(f,d){return f>d?Math.cos(d):Math.cos(f)};a.fovx2fovy=function(f,d,e){return 2*Math.atan(e*Math.tan(.5*f)/d)};a.fovy2fovx=function(f,d,e){return 2*Math.atan(d*Math.tan(.5*f)/e)};a.makeOrthonormal=function(f,d,e){e=e||f;const h=c.dot(f,d);c.set(e,f[0]-h*d[0],f[1]-h*d[1],f[2]-h*d[2]);c.normalize(e,e)};a.makePiecewiseLinearFunction=function(f){const d=f.length;return e=>{if(e<=f[0][0])return f[0][1];if(e>=f[d-1][0])return f[d-1][1];let h=1;for(;e>f[h][0];)h++;
const v=f[h][0];e=(v-e)/(v-f[h-1][0]);return e*f[h-1][1]+(1-e)*f[h][1]}};a.maxScale=function(f){return Math.sqrt(Math.max(f[0]*f[0]+f[4]*f[4]+f[8]*f[8],f[1]*f[1]+f[5]*f[5]+f[9]*f[9],f[2]*f[2]+f[6]*f[6]+f[10]*f[10]))};a.moduloPositive=function(f,d){return(f%d+d)%d};a.planeFromPoints=function(f,d,e,h){c.subtract(l,d,f);c.subtract(r,e,f);c.cross(h,l,r);c.normalize(h,h);h[3]=-c.dot(f,h)};a.scaleFromMatrix=function(f,d){c.set(f,Math.sqrt(d[0]*d[0]+d[4]*d[4]+d[8]*d[8]),Math.sqrt(d[1]*d[1]+d[5]*d[5]+d[9]*
d[9]),Math.sqrt(d[2]*d[2]+d[6]*d[6]+d[10]*d[10]));return f};a.slerp=function(f,d,e,h=m.create()){const v=c.length(f);var w=c.length(d),t=c.dot(f,d)/(v*w);if(.9999999999999999>t){t=Math.acos(t);const x=((1-e)*v+e*w)/Math.sin(t);w=x/w*Math.sin(e*t);c.scale(g,f,x/v*Math.sin((1-e)*t));c.scale(k,d,w);return c.add(h,g,k)}return c.lerp(h,f,d,e)};a.slerpTangent=function(f,d,e,h=m.create(),v=m.create()){const w=c.length(f),t=c.length(d);var x=c.dot(f,d)/(w*t);if(.9999999999999999>x){x=Math.acos(x);const B=
Math.sin(x),q=Math.sin(e*x),u=Math.sin((1-e)*x),C=(1-e)*w+e*t;{const z=C/B,A=z/t*q;c.scale(g,f,z/w*u);c.scale(k,d,A);c.add(h,g,k)}c.scale(g,f,1/w*(-Math.cos((1-e)*x)*x*C+u*(-w+t)));c.scale(k,d,1/t*(Math.cos(e*x)*x*C+q*(-w+t)));c.add(v,g,k);c.scale(v,v,1/B);return v}c.lerp(h,f,d,e);c.subtract(v,d,f);c.normalize(v,v);return v};a.tangentFrame=function(f,d,e){Math.abs(f[0])>Math.abs(f[1])?c.set(d,0,1,0):c.set(d,1,0,0);c.cross(e,f,d);c.normalize(d,d);c.cross(d,e,f);c.normalize(e,e)};Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/coordinateSystem":function(){define("exports ../../chunks/mat4 ../../chunks/vec3 ../../chunks/vec3f64 ../projectionEllipsoid ../SpatialReference ./Axis ../../chunks/boundedPlane ../../chunks/sphere".split(" "),function(a,b,c,m,l,r,n,g,k){function f(x){return{operations:x,value:x.create()}}function d(x,B,q=f(x)){q.operations=x;x.copy(B,q.value);return q}function e(x,B,q,u){return x.operations.setAltitudeAt(x.value,
B,q,u)}const h=2**50,v=m.create(),w={operations:null,value:null},t=m.create();a.altitudeAt=function(x,B){return x.operations.altitudeAt(x.value,B)};a.axisAt=function(x,B,q,u){return x.operations.axisAt(x.value,B,q,u)};a.closestPoint=function(x,B,q){return x.operations.closestPoint(x.value,B,q)};a.closestPointOnSilhouette=function(x,B,q){return x.operations.closestPointOnSilhouette(x.value,B,q)};a.coordinateSystemFromOneAxisAndNormalVector=function(x,B,q,u,C){c.copy(q,x);c.copy(t,B);c.normalize(t,
t);c.cross(u,t,q);c.cross(C,u,q)};a.create=function(x){const {value:B,operations:q}=x;return{operations:q,value:q.create(B)}};a.createFromOperations=f;a.createGlobal=function(x){return d(k.sphere,k.fromValues(0,0,0,l.getReferenceEllipsoid(x).radius))};a.createLocal=function(){return d(g.boundedPlane,g.fromValues([0,0,0],[h,0,0],[0,h,0]))};a.distanceToSilhouette=function(x,B){return x.operations.distanceToSilhouette(x.value,B)};a.elevate=function(x,B,q){return x.operations.elevate(x.value,B,q.value)};
a.fromValues=d;a.intersectRay=function(x,B,q){return x.operations.intersectRay(x.value,B,q)};a.intersectRayClosestSilhouette=function(x,B,q){return x.operations.intersectRayClosestSilhouette(x.value,B,q)};a.intersectsRay=function(x,B){return x.operations.intersectRay(x.value,B,null)};a.normalAt=function(x,B,q){return x.operations.axisAt(x.value,B,n.Axis.Z,q)};a.renderSRFromViewSR=function(x,B){return x?l.getSphericalPCPF(B):B.isGeographic?r.PlateCarree:B};a.setAltitudeAt=e;a.setAltitudeOfTransformation=
function(x,B,q,u){B!==u&&b.copy(u,B);c.set(v,u[12],u[13],u[14]);e(x,v,q,v);u[12]=v[0];u[13]=v[1];u[14]=v[2];return u};a.setExtent=function(x,B,q){x.operations.setExtent(x.value,B,q.value);return q};a.vectorCoordinates=function(x,B,q,u,C){C[0]=c.dot(x,B);C[1]=c.dot(x,q);C[2]=c.dot(x,u);return C};a.wrap=function(x,B){w.operations=x;w.value=B;return w};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/scaleUtils":function(){define(["exports",
"../../core/unitUtils"],function(a,b){function c(m,l){l=b.getMetersPerUnitForSR(l);return m/(l*b.inchesPerMeter*96)}a.getExtentForScale=function(m,l){const r=m.extent;m=m.width;l=c(l,r.spatialReference);return r.clone().expand(l*m/r.width)};a.getResolutionForScale=c;a.getScale=function(m,l){l=l||m.extent;m=m.width;const r=b.getMetersPerUnitForSR(l&&l.spatialReference);return l&&m?l.width/m*r*b.inchesPerMeter*96:0};a.getScaleForResolution=function(m,l){l=b.getMetersPerUnitForSR(l);return m*l*b.inchesPerMeter*
96};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/BreakpointsOwner":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/ArrayPool ../core/Handles ../core/maybe ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,m,l,r,n,g,k,f,d,e){function h(t,x){return x?
v[t].valueToClassName[x].split(" "):[]}const v={widthBreakpoint:{getValue(t){const x=t.viewSize[0];t=t.breakpoints;const B=this.values;return x<=t.xsmall?B.xsmall:x<=t.small?B.small:x<=t.medium?B.medium:x<=t.large?B.large:B.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",
medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},
heightBreakpoint:{getValue(t){const x=t.viewSize[1];t=t.breakpoints;const B=this.values;return x<=t.xsmall?B.xsmall:x<=t.small?B.small:x<=t.medium?B.medium:x<=t.large?B.large:B.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",
medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},
orientation:{getValue(t){t=t.viewSize;const x=this.values;return t[1]>=t[0]?x.portrait:x.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},w={xsmall:544,small:768,medium:992,large:1200};a.BreakpointsOwner=t=>{t=function(x){function B(...u){u=x.call(this,...u)||this;u._breakpointsHandles=new l;u.orientation=null;u.widthBreakpoint=null;u.heightBreakpoint=null;u.breakpoints=w;return u}
b._inheritsLoose(B,x);var q=B.prototype;q.initialize=function(){this._breakpointsHandles.add(n.watch(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),n.initial))};q.destroy=function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=r.destroyMaybe(this._breakpointsHandles))};q._updateClassNames=function(){if(this.container){var u=m.acquire(),C=m.acquire(),z=!1,A;for(A in v){const p=this[A],y=v[A].getValue({viewSize:this.size,breakpoints:this.breakpoints});p!==
y&&(z=!0,this[A]=y,h(A,p).forEach(D=>C.push(D)),h(A,y).forEach(D=>u.push(D)))}z&&(this._applyClassNameChanges(u,C),m.release(u),m.release(C))}};q._applyClassNameChanges=function(u,C){const z=this.container;z&&(C.forEach(A=>z.classList.remove(A)),u.forEach(A=>z.classList.add(A)))};q._removeActiveClassNames=function(){const u=this.container;if(u)for(var C in v)h(C,this[C]).forEach(z=>u.classList.remove(z))};b._createClass(B,[{key:"breakpoints",set:function(u){var C=this._get("breakpoints");if(u!==C){C=
(C=u)&&C.xsmall<C.small&&C.small<C.medium&&C.medium<C.large;if(!C){const z=JSON.stringify(w,null,2);console.warn("provided breakpoints are not valid, using defaults:"+z)}u=C?u:w;this._set("breakpoints",{...u})}}}]);return B}(t);c.__decorate([g.property()],t.prototype,"breakpoints",null);c.__decorate([g.property()],t.prototype,"orientation",void 0);c.__decorate([g.property()],t.prototype,"widthBreakpoint",void 0);c.__decorate([g.property()],t.prototype,"heightBreakpoint",void 0);return t=c.__decorate([e.subclass("esri.views.BreakpointsOwner")],
t)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/DOMContainer":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/domUtils ../core/reactiveUtils ../core/scheduling ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./overlay/ViewOverlay ../widgets/Popup".split(" "),function(a,b,c,m,l,r,n,g,k,f,d,e,
h){function v(t){t&&(m.empty(t),t.parentNode&&t.parentNode.removeChild(t))}const w=[0,0];a.DOMContainer=t=>{t=function(x){function B(...u){var C=x.call(this,...u)||this;C._freqInfo={freq:16,time:750};C._overlayRenderTaskHandle=null;C.height=0;C.position=null;C.resizing=!1;C.root=null;C.surface=null;C.suspended=!0;C.ui=null;C.userContent=null;C.width=0;C.widthBreakpoint=null;C.handles.add([l.watch(()=>C.cursor,z=>{const {surface:A}=b._assertThisInitialized(C);A&&A.setAttribute("data-cursor",z)}),l.watch(()=>
C.interacting,z=>{const {surface:A}=b._assertThisInitialized(C);A&&A.setAttribute("data-interacting",z.toString())})]);return C}b._inheritsLoose(B,x);var q=B.prototype;q.initialize=function(){this.handles.add(l.watch(()=>this.ui,(u,C)=>this._handleUIChange(u,C)));this._wireUI(this.ui);this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])};q.destroy=function(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&
this.popup.destroy(),this.container=null)};q.blur=function(){this.surface&&this.surface.blur()};q.focus=function(){this.surface&&this.surface.focus()};q.pageToContainer=function(u,C,z){const A=this.position;u-=A[0];C-=A[1];z?(z[0]=u,z[1]=C):z=[u,C];return z};q.containerToPage=function(u,C,z){const A=this.position;u+=A[0];C+=A[1];z?(z[0]=u,z[1]=C):z=[u,C];return z};q._handleUIChange=function(u,C){C&&(this.handles.remove("ui"),C.destroy());u&&this._wireUI(u);this._set("ui",u)};q._wireUI=function(u){this.handles.remove("ui");
u&&(u.view=this,this.handles.add([l.watch(()=>this.root,C=>{if(C){{const z=document.createElement("div");C.appendChild(z);C=z}}else C=null;u.container=C},l.initial),l.watch(()=>this.popup,(C,z)=>{z&&u.remove(z,"popup");C&&(C.view=u.view,u.add(C,{key:"popup",position:"manual"}))},l.initial)],"ui"))};q._stopMeasuring=function(){this.handles.remove("measuring");this._get("resizing")&&this._set("resizing",!1)};q._startMeasuring=function(){const u=this._freqInfo;u.freq=16;u.time=750;this.handles.add([(()=>
{const C=()=>{u.freq=16;u.time=750};window.addEventListener("resize",C);return{remove(){window.removeEventListener("resize",C)}}})(),r.addFrameTask({prepare:C=>{const z=this._measure(),A=this._freqInfo;A.time+=C.deltaTime;z&&(A.freq=16,this._get("resizing")||this._set("resizing",!0));A.time<A.freq||(A.time=0,this._position()||z?A.freq=16:A.freq=Math.min(750,2*A.freq),!z&&512<=A.freq&&this._get("resizing")&&this._set("resizing",!1))}})],"measuring");this._measure();this._position()};q._measure=function(){var u=
this.container;const C=u?u.clientWidth:0;u=u?u.clientHeight:0;if(0===C||0===u)return this.suspended||this._set("suspended",!0),!1;const z=this.width,A=this.height;if(C===z&&u===A)return this.suspended&&this._set("suspended",!1),!1;this._set("width",C);this._set("height",u);this.suspended&&this._set("suspended",!1);this.emit("resize",{oldWidth:z,oldHeight:A,width:C,height:u});return!0};q._position=function(){var u=this.container;const C=this.position;{const z=(u.ownerDocument||window.document).defaultView;
u=u.getBoundingClientRect();w[0]=u.left+z.pageXOffset;w[1]=u.top+z.pageYOffset}return C&&w[0]===C[0]&&w[1]===C[1]?!1:(this._set("position",[w[0],w[1]]),!0)};q.forceDOMReadyCycle=function(){};b._createClass(B,[{key:"container",set:function(u){var C=this._get("container");if(C!==u)if(this.handles.remove("dom-size"),this._stopMeasuring(),C&&(C.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),
this._set("overlay",null),v(this.root),this._set("root",null),m.reparent(this.userContent,C),v(this.userContent),this._set("userContent",null)),u){u.classList.add("esri-view");C=document.createElement("div");C.className="esri-view-user-storage";m.reparent(u,C);u.appendChild(C);this._set("userContent",C);C=document.createElement("div");C.className="esri-view-root";u.insertBefore(C,u.firstChild);this._set("root",C);const z=document.createElement("div");z.className="esri-view-surface";z.setAttribute("role",
"application");z.tabIndex=0;C.appendChild(z);this._set("surface",z);const A=new e;C.appendChild(A.surface);this._set("overlay",A);l.watch(()=>A.needsRender,p=>{p&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=r.addFrameTask({render:()=>{this.overlay.render()}}):this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null)});this.forceDOMReadyCycle();this.handles.add(l.watch(()=>this.size,p=>{const [y,D]=p;y>=document.body.clientWidth||D>=
document.body.clientHeight?z.classList.add("esri-view-surface--inset-outline"):z.classList.remove("esri-view-surface--inset-outline")},l.initial),"dom-size");this._set("container",u);this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}},{key:"focused",get:function(){const u=document.activeElement===this.surface;return document.hasFocus()&&u}},{key:"popup",get:function(){return this._get("popup")||
new h({view:this})},set:function(u){const C=this._get("popup");C&&C!==u&&C.destroy();this._set("popup",u)}},{key:"size",get:function(){return[this.width,this.height]}}]);return B}(t);c.__decorate([n.property({value:null,cast:x=>m.byId(x)})],t.prototype,"container",null);c.__decorate([n.property({readOnly:!0})],t.prototype,"focused",null);c.__decorate([n.property({readOnly:!0})],t.prototype,"height",void 0);c.__decorate([n.property({type:h})],t.prototype,"popup",null);c.__decorate([n.property({type:e})],
t.prototype,"overlay",void 0);c.__decorate([n.property({readOnly:!0})],t.prototype,"position",void 0);c.__decorate([n.property({readOnly:!0})],t.prototype,"resizing",void 0);c.__decorate([n.property({readOnly:!0})],t.prototype,"root",void 0);c.__decorate([n.property({value:null,readOnly:!0})],t.prototype,"size",null);c.__decorate([n.property({readOnly:!0})],t.prototype,"surface",void 0);c.__decorate([n.property({readOnly:!0})],t.prototype,"suspended",void 0);c.__decorate([n.property()],t.prototype,
"ui",void 0);c.__decorate([n.property({readOnly:!0})],t.prototype,"userContent",void 0);c.__decorate([n.property({readOnly:!0})],t.prototype,"width",void 0);c.__decorate([n.property()],t.prototype,"widthBreakpoint",void 0);return t=c.__decorate([d.subclass("esri.views.DOMContainer")],t)};a.isDOMContainer=function(t){return t&&"focus"in t};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/overlay/ViewOverlay":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Collection ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../core/support/WatchUpdatingTracking ../../libs/maquette/projection ../../libs/maquette/projector".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e){c=function(h){function v(){var t=h.apply(this,arguments)||this;t.items=new m;t._watchUpdatingTracking=new f.WatchUpdatingTracking;t._callbacks=new Map;t._projector=e.createProjector();t._hiddenProjector=e.createProjector();return t}a._inheritsLoose(v,h);var w=v.prototype;w.initialize=function(){const t=document.createElement("div");t.className="esri-overlay-surface";this._set("surface",t);this._hiddenSurface=document.createElement("div");this._hiddenSurface.setAttribute("style",
"visibility: hidden;");t.appendChild(this._hiddenSurface);this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,x=>{for(const B of x.added){const q=()=>B.render();this._callbacks.set(B,q);this._projector.append(this.surface,q)}for(const B of x.removed)x=this._projector.detach(this._callbacks.get(B)),this.surface.removeChild(x.domNode),this._callbacks.delete(B)})};w.addItem=function(t){this.items.add(t)};w.removeItem=function(t){this.items.remove(t)};w.destroy=function(){this.items.removeAll();
this._callbacks.forEach(t=>this._projector.detach(t));this._projector=this._callbacks=null;this._watchUpdatingTracking.destroy()};w.render=function(){this._projector.renderNow()};w.computeBoundingRect=function(t){const x=this._hiddenSurface,B=this._hiddenProjector;let q=null;const u=()=>q=t.render();B.append(x,u);B.renderNow();const C={left:0,top:0,right:0,bottom:0};if(q&&q.domNode){const z=q.domNode.getBoundingClientRect();C.left=z.left;C.top=z.top;C.right=z.right;C.bottom=z.bottom}for(B.detach(u);x.firstChild;)x.removeChild(x.firstChild);
return C};w.overlaps=function(t,x){t=this.computeBoundingRect(t);x=this.computeBoundingRect(x);return Math.max(t.left,x.left)<=Math.min(t.right,x.right)&&Math.max(t.top,x.top)<=Math.min(t.bottom,x.bottom)};w.renderCanvas=function(t){if(this.items.some(B=>B.visible)){var x=t.getContext("2d");x.save();x.font=`10px ${getComputedStyle(this.surface).fontFamily}`;this.items.forEach(B=>{x.save();B.renderCanvas(x);x.restore()});x.restore()}};a._createClass(v,[{key:"needsRender",get:function(){return 0<this.items.length}},
{key:"hasVisibleItems",get:function(){return this.items.some(t=>t.visible)}}]);return v}(c);b.__decorate([l.property({readOnly:!0})],c.prototype,"surface",void 0);b.__decorate([l.property({readOnly:!0})],c.prototype,"items",void 0);b.__decorate([l.property({readOnly:!0})],c.prototype,"needsRender",null);b.__decorate([l.property({readOnly:!0})],c.prototype,"_watchUpdatingTracking",void 0);b.__decorate([l.property({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],c.prototype,"updating",void 0);
return c=b.__decorate([k.subclass("esri.views.overlay.ViewOverlay")],c)})},"esri/widgets/Popup":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../intl ../core/Collection ../core/events ../core/Handles ../core/Logger ../core/maybe ../core/reactiveUtils ../core/throttle ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Feature ./Spinner ./Widget ./Feature/support/FeatureContentMixin ./Popup/PopupViewModel ./support/Heading ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/decorators/vmEvent ./support/jsxFactory ./support/widgetUtils ../intl/substitute".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F){function G(M,L){return void 0===L?`${"esri-popup"}__${M}`:`${"esri-popup"}__${M}-${L}`}const P={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},K=n.getLogger("esri.widgets.Popup"),N={closeButton:!0,featureNavigation:!0};c=function(M){function L(H,I){var O=M.call(this,H,I)||this;O._blurClose=!1;O._blurContainer=!1;O._containerNode=null;O._mainContainerNode=null;O._featureMenuNode=null;O._actionsMenuNode=null;O._focusClose=!1;
O._focusContainer=!1;O._focusDockButton=!1;O._focusFeatureMenuButton=!1;O._focusActionsMenuButton=!1;O._focusFirstFeature=!1;O._focusFirstAction=!1;O._handles=new r;O._pointerOffsetInPx=16;O._spinner=null;O._feature=null;O._featureMenuIntersectionObserverCallback=([Q])=>{null!=Q&&Q.isIntersecting&&O.viewModel.featurePage++};O._featureMenuIntersectionObserver=new IntersectionObserver(O._featureMenuIntersectionObserverCallback,{root:window.document});O._displaySpinnerThrottled=f.throttle(()=>O._displaySpinner(),
0);O.actions=null;O.alignment="auto";O.autoCloseEnabled=null;O.autoOpenEnabled=null;O.defaultPopupTemplateEnabled=null;O.content=null;O.collapsed=!1;O.collapseEnabled=!0;O.dockEnabled=!1;O.featureCount=null;O.featureMenuOpen=!1;O.features=null;O.goToOverride=null;O.headingLevel=2;O.highlightEnabled=null;O.location=null;O.label=void 0;O.maxInlineActions=3;O.messages=null;O.messagesCommon=null;O.promises=null;O.selectedFeature=null;O.selectedFeatureIndex=null;O.spinnerEnabled=!0;O.title=null;O.updateLocationEnabled=
null;O.view=null;O.viewModel=new C;O.visible=null;O.visibleElements={...N};O._addSelectedFeatureIndexHandle();O.own([k.watch(()=>{var Q;return null==(Q=O.viewModel)?void 0:Q.screenLocation},()=>O._positionContainer()),k.watch(()=>{var Q;return[null==(Q=O.viewModel)?void 0:Q.active,O.dockEnabled]},()=>O._toggleScreenLocationEnabled()),k.watch(()=>{var Q;return null==(Q=O.viewModel)?void 0:Q.screenLocation},(Q,S)=>{!!Q!==!!S&&O.reposition()}),k.watch(()=>{var Q,S,T,U,aa,W;return[null==(Q=O.viewModel)?
void 0:null==(S=Q.view)?void 0:S.padding,null==(T=O.viewModel)?void 0:null==(U=T.view)?void 0:U.size,null==(aa=O.viewModel)?void 0:aa.active,null==(W=O.viewModel)?void 0:W.location,O.alignment]},()=>O.reposition()),k.watch(()=>O.spinnerEnabled,Q=>O._spinnerEnabledChange(Q)),k.watch(()=>{var Q,S;return null==(Q=O.viewModel)?void 0:null==(S=Q.view)?void 0:S.size},(Q,S)=>O._updateDockEnabledForViewSize(Q,S)),k.watch(()=>{var Q;return null==(Q=O.viewModel)?void 0:Q.view},(Q,S)=>O._viewChange(Q,S)),k.watch(()=>
{var Q,S;return null==(Q=O.viewModel)?void 0:null==(S=Q.view)?void 0:S.ready},(Q,S)=>O._viewReadyChange(Q,S)),k.watch(()=>{var Q,S;return[null==(Q=O.viewModel)?void 0:Q.waitingForResult,null==(S=O.viewModel)?void 0:S.location]},()=>{O._hideSpinner();O._displaySpinnerThrottled()}),k.watch(()=>{var Q,S,T,U;return[null==(Q=O.selectedFeatureWidget)?void 0:null==(S=Q.viewModel)?void 0:S.title,null==(T=O.selectedFeatureWidget)?void 0:null==(U=T.viewModel)?void 0:U.state]},()=>O._setTitleFromFeatureWidget()),
k.watch(()=>{var Q,S,T,U;return[null==(Q=O.selectedFeatureWidget)?void 0:null==(S=Q.viewModel)?void 0:S.content,null==(T=O.selectedFeatureWidget)?void 0:null==(U=T.viewModel)?void 0:U.state]},()=>O._setContentFromFeatureWidget()),k.when(()=>!O.collapsed,()=>{var Q,S;"xsmall"===(null==(Q=O.viewModel)?void 0:null==(S=Q.view)?void 0:S.widthBreakpoint)&&O.viewModel.active&&O.collapseEnabled&&O.viewModel.centerAtLocation()}),k.on(()=>{var Q;return null==(Q=O.viewModel)?void 0:Q.allActions},"change",()=>
O._watchActions()),k.watch(()=>{var Q;return null==(Q=O.viewModel)?void 0:Q.allActions},()=>O._watchActions(),k.initial),k.watch(()=>{var Q;return null==(Q=O.viewModel)?void 0:Q.featureViewModels},()=>O._featureMenuViewportScrollTop())]);return O}a._inheritsLoose(L,M);var J=L.prototype;J.destroy=function(){var H,I;this._destroySelectedFeatureWidget();this._destroySpinner();null==(H=this._handles)?void 0:H.destroy();this._unobserveFeatureMenuObserver();null==(I=this._featureMenuIntersectionObserver)?
void 0:I.disconnect();this._handles=null};J.castVisibleElements=function(H){return{...N,...H}};J.blur=function(){const {active:H}=this.viewModel;H||K.warn("Popup can only be blurred when currently active.");this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0;this.scheduleRender()};J.clear=function(){this.viewModel.clear()};J.close=function(){this.visible=!1};J.fetchFeatures=function(H,I){return this.viewModel.fetchFeatures(H,I)};J.focus=function(){const {active:H}=this.viewModel;
H||K.warn("Popup can only be focused when currently active.");this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0;this.scheduleRender()};J.next=function(){return this.viewModel.next()};J.open=function(H){var I,O;this._handles.remove("selected-index");const Q={collapsed:H?!!H.collapsed:!1,actionsMenuOpen:H?!!H.actionsMenuOpen:!1,featureMenuOpen:H?!!H.featureMenuOpen:!1};"xsmall"===(null==(I=this.viewModel)?void 0:null==(O=I.view)?void 0:O.widthBreakpoint)&&(Q.collapsed=!0);
this.set(Q);this.viewModel.open(H);this._shouldFocus(H);this._addSelectedFeatureIndexHandle()};J.previous=function(){return this.viewModel.previous()};J.reposition=function(){this.renderNow();this._positionContainer();this._setCurrentAlignment()};J.triggerAction=function(H){this.viewModel.triggerAction(H)};J.render=function(){var H,I,O,Q;const {actionsMenuOpen:S,dockEnabled:T,featureMenuVisible:U,dividedActions:aa,currentAlignment:W,currentDockPosition:R}=this,{active:V}=this.viewModel;var {menuActions:da}=
aa;da=V&&1<da.length&&S;const ca=null==(H=this.selectedFeature)?void 0:null==(I=H.layer)?void 0:I.title;H=null==(O=this.selectedFeature)?void 0:null==(Q=O.layer)?void 0:Q.id;return D.tsx("div",{class:this.classes("esri-popup",{["esri-popup--aligned-top-center"]:"top-center"===W,["esri-popup--aligned-bottom-center"]:"bottom-center"===W,["esri-popup--aligned-top-left"]:"top-left"===W,["esri-popup--aligned-bottom-left"]:"bottom-left"===W,["esri-popup--aligned-top-right"]:"top-right"===W,["esri-popup--aligned-bottom-right"]:"bottom-right"===
W,["esri-popup--is-docked"]:V&&T,["esri-popup--shadow"]:V&&!T,["esri-popup--is-docked-top-left"]:"top-left"===R,["esri-popup--is-docked-top-center"]:"top-center"===R,["esri-popup--is-docked-top-right"]:"top-right"===R,["esri-popup--is-docked-bottom-left"]:"bottom-left"===R,["esri-popup--is-docked-bottom-center"]:"bottom-center"===R,["esri-popup--is-docked-bottom-right"]:"bottom-right"===R,["esri-popup--feature-menu-open"]:U,["esri-popup--actions-menu-open"]:da}),role:"presentation","data-layer-title":ca,
"data-layer-id":H,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},V?[this.renderMainContainer(),this.renderPointer()]:null)};J.renderLoadingIcon=function(){return D.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-loading-indicator","esri-rotating")})};J.renderNavigationLoading=function(){const {messagesCommon:H}=this;return this.viewModel.pendingPromisesCount?D.tsx("div",{key:G("loading-container"),role:"presentation",class:"esri-popup__loading-container",
"aria-label":H.loading,title:H.loading},this.renderLoadingIcon()):null};J.renderPreviousIcon=function(){const H=E.isRTL(this.container);return D.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",{["esri-icon-right-triangle-arrow"]:H,["esri-popup__pagination-previous-icon--rtl"]:H,["esri-icon-left-triangle-arrow"]:!H,["esri-popup__pagination-previous-icon"]:!H})})};J.renderPreviousButton=function(){const {messages:H}=this;return D.tsx("div",{role:"button",tabIndex:0,bind:this,
onclick:this._previous,onkeydown:this._previous,class:this.classes("esri-popup__button","esri-popup__pagination-previous"),"aria-label":H.previous,title:H.previous},this.renderPreviousIcon())};J.renderNextIcon=function(){const H=E.isRTL(this.container);return D.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",{["esri-icon-left-triangle-arrow"]:H,["esri-popup__pagination-next-icon--rtl"]:H,["esri-icon-right-triangle-arrow"]:!H,["esri-popup__pagination-next-icon"]:!H})})};J.renderNextButton=
function(){const {messages:H}=this;return D.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes("esri-popup__button","esri-popup__pagination-next"),"aria-label":H.next,title:H.next},this.renderNextIcon())};J.renderFeatureMenuButton=function(){const {featureMenuOpen:H,featureMenuId:I,messagesCommon:O}=this,{featureCount:Q,selectedFeatureIndex:S}=this.viewModel;return D.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,
onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes("esri-popup__button","esri-popup__feature-menu-button"),"aria-haspopup":"true","aria-controls":I,"aria-expanded":H.toString(),"aria-label":O.menu,title:O.menu},this._getPageText(Q,S))};J.renderNavigationButtons=function(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:
null};J.renderDockIcon=function(){const {dockEnabled:H}=this,I=this._wouldDockTo();return D.tsx("span",{"aria-hidden":"true",class:this.classes({["esri-icon-minimize"]:H,["esri-popup__icon--dock-icon"]:!H,["esri-icon-dock-right"]:!H&&("top-right"===I||"bottom-right"===I),["esri-icon-dock-left"]:!H&&("top-left"===I||"bottom-left"===I),["esri-icon-maximize"]:!H&&"top-center"===I,["esri-icon-dock-bottom"]:!H&&"bottom-center"===I},"esri-popup__icon")})};J.renderDockButton=function(){var H,I,O;const {dockEnabled:Q,
messages:S}=this,T=null==(H=this.viewModel)?void 0:null==(I=H.view)?void 0:I.widthBreakpoint;H=Q?S.undock:S.dock;return"xsmall"!==T&&null!=(O=this.dockOptions)&&O.buttonEnabled?D.tsx("div",{role:"button","aria-label":H,title:H,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes("esri-popup__button","esri-popup__button--dock")},this.renderDockIcon()):null};J.renderTitle=
function(){const {title:H}=this.viewModel,{titleId:I,collapsible:O,contentCollapsed:Q,messagesCommon:S}=this;var T={["esri-popup__header-container--button"]:O};const U=D.tsx(z.Heading,{level:this.headingLevel,class:"esri-popup__header-title",innerHTML:H});T=O?D.tsx("button",{key:`${H}--collapsible`,id:I,title:Q?S.expand:S.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes("esri-popup__header-container",T),"aria-expanded":Q?"false":"true",onclick:this._toggleCollapsed,
type:"button"},U):D.tsx("div",{key:H,id:I,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes("esri-popup__header-container",T)},U);return H?T:null};J.renderCloseIcon=function(){return D.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-close")})};J.renderCloseButton=function(){const {visibleElements:H,messagesCommon:I}=this;return H.closeButton?D.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:"esri-popup__button",
"aria-label":I.close,title:I.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null};J.renderHeader=function(){return D.tsx("header",{class:"esri-popup__header"},this.renderTitle(),D.tsx("div",{class:"esri-popup__header-buttons"},this.renderDockButton(),this.renderCloseButton()))};J.renderContentContainer=function(){const {contentId:H,hasContent:I,contentCollapsed:O}=this,{content:Q}=this.viewModel;return I&&!O?D.tsx("article",{key:Q,
enterAnimation:this._createFeatureUpdatedAnimation(),id:H,class:"esri-popup__content"},this.renderContent()):null};J.renderActionsMenuButton=function(){const {actionsMenuId:H,actionsMenuButtonId:I,actionsMenuOpen:O,dividedActions:Q,messagesCommon:S}=this,T=O?S.close:S.open,{menuActions:U}=Q;return U.length?D.tsx("div",{key:G("actions-menu-button"),class:this.classes("esri-popup__button","esri-popup__actions-menu-button"),role:"button",id:I,"aria-haspopup":"true","aria-controls":O?H:null,tabIndex:0,
bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":T,title:T},D.tsx("span",{"aria-hidden":"true",class:"esri-icon-handle-horizontal"})):null};J.renderMenuActions=function(){const {actionsMenuId:H,actionsMenuButtonId:I,actionsMenuOpen:O,dividedActions:Q}=this,{menuActions:S}=Q;return S.length&&O?D.tsx("ul",{id:H,role:"menu","aria-labelledby":I,key:G("actions"),class:"esri-popup__actions",
bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},S.toArray().map(T=>this.renderAction({action:T,type:"menu-item"}))):null};J.renderInlineActions=function(){const {inlineActions:H}=this.dividedActions;return!!H.length&&H.toArray().map(I=>this.renderAction({action:I,type:"inline"}))};J.renderInlineActionsContainer=function(){const {inlineActions:H,menuActions:I}=this.dividedActions,O=!!H.length,Q=!!I.length;return O||Q?
D.tsx("div",{key:"inline-actions-container","data-inline-actions":O.toString(),"data-menu-actions":Q.toString(),class:"esri-popup__inline-actions-container"},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null};J.renderNavigation=function(){return this.featureNavigationVisible?D.tsx("section",{key:G("navigation"),class:this.classes("esri-popup__navigation")},this.renderNavigationButtons()):null};J.renderFooter=function(){const {featureNavigationVisible:H,dividedActions:I}=
this,{inlineActions:O,menuActions:Q}=I,S=!!O.length,T={["esri-popup__footer--has-pagination"]:H,["esri-popup__footer--has-actions"]:S,["esri-popup__footer--has-actions-menu"]:!!Q.length};return H||S?D.tsx("div",{key:G("feature-buttons"),class:this.classes("esri-popup__footer",T)},this.renderInlineActionsContainer(),this.renderNavigation()):null};J.renderFeatureMenuContainer=function(){var {messages:H}=this;const {featureViewModels:I,isLoadingFeature:O}=this.viewModel;H=F.substitute(H.selectedFeatures,
{total:I.length});return D.tsx("section",{key:G("menu"),class:"esri-popup__feature-menu"},D.tsx("strong",{class:"esri-popup__feature-menu-header"},H),D.tsx("nav",{bind:this,class:"esri-popup__feature-menu-viewport","data-node-ref":"_featureMenuViewportNode",afterCreate:E.storeNode},this.renderFeatureMenu(),D.tsx("div",{class:"esri-popup__feature-menu-observer",bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),O?D.tsx("div",{class:"esri-popup__feature-menu-loader"},this.renderLoadingIcon()):
null))};J.renderPointer=function(){return this.dockEnabled?null:D.tsx("div",{key:G("pointer"),class:"esri-popup__pointer",role:"presentation"},D.tsx("div",{class:this.classes("esri-popup__pointer-direction","esri-popup--shadow")}))};J.renderMainContainer=function(){const {dockEnabled:H,currentAlignment:I,currentDockPosition:O,titleId:Q,contentId:S,collapsible:T,hasContent:U,contentCollapsed:aa,visibleElements:W}=this,{title:R}=this.viewModel,V="bottom-left"===I||"bottom-center"===I||"bottom-right"===
I||"top-left"===O||"top-center"===O||"top-right"===O,da="top-left"===I||"top-center"===I||"top-right"===I||"bottom-left"===O||"bottom-center"===O||"bottom-right"===O;return D.tsx("div",{class:this.classes("esri-popup__main-container","esri-widget",{["esri-popup--shadow"]:H,["esri-popup--is-collapsible"]:T,["esri-popup--is-collapsed"]:aa}),tabIndex:W.closeButton?null:-1,role:"dialog","aria-labelledby":R?Q:"","aria-describedby":U&&!aa?S:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,
afterUpdate:this._mainContainerNodeUpdated},V?this.renderFooter():null,V?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),da?this.renderFooter():null,da?this.renderFeatureMenuContainer():null)};J.renderContent=function(){var H;const I=null==(H=this.viewModel)?void 0:H.content;return I?"string"===typeof I?D.tsx("div",{key:I,innerHTML:I}):this.renderNodeContent(I):null};J.renderActionText=function(H){return D.tsx("span",{key:"text",class:"esri-popup__action-text"},
H)};J.renderActionIcon=function(H){const I=this._getActionClass(H),O=this._getActionImage(H),Q={["esri-icon-loading-indicator"]:H.active,["esri-rotating"]:H.active,["esri-popup__icon"]:!!I,["esri-popup__action-image"]:!H.active&&!!O};I&&(Q[I]=!H.active);return D.tsx("span",{key:"icon","aria-hidden":"true",class:this.classes("esri-popup__icon",Q),styles:this._getIconStyles(O)})};J.renderAction=function(H){const {action:I,type:O}=H;H=this._getActionTitle(I);const Q={["esri-popup__action"]:"toggle"!==
I.type,["esri-popup__action-toggle"]:"toggle"===I.type,["esri-popup__action-toggle--on"]:"toggle"===I.type&&I.value,["esri-popup__button--disabled"]:I.disabled},S=[this.renderActionIcon(I),this.renderActionText(H)];H="menu-item"===O?D.tsx("li",{key:I.uid,role:"menuitem",tabIndex:0,title:H,"aria-label":H,class:this.classes("esri-popup__button",Q),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":I.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},S):D.tsx("div",{key:I.uid,
role:"button",tabIndex:0,title:H,"aria-label":H,class:this.classes("esri-popup__button",Q),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":I.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},S);return I.visible?H:null};J.renderFeatureMenuItem=function(H,I){const {messages:O,messagesCommon:Q}=this,{selectedFeatureIndex:S,selectedFeatureViewModel:T}=this.viewModel;var U=H===T;const aa={["esri-popup__feature-menu-item--selected"]:U};U=U?D.tsx("span",{key:G(`feature-menu-selected-feature-${S}`),
title:O.selectedFeature,"aria-label":O.selectedFeature,class:"esri-icon-check-mark"}):null;H=D.tsx("span",{innerHTML:H.title||Q.untitled});return D.tsx("li",{role:"menuitem",tabIndex:-1,key:G(`feature-menu-feature-${S}`),class:this.classes(aa,"esri-popup__feature-menu-item"),bind:this,"data-feature-index":I,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,
onmouseleave:this._removeActiveFeature},D.tsx("span",{class:"esri-popup__feature-menu-title"},H,U))};J.renderFeatureMenu=function(){const {featureMenuId:H}=this,{featureViewModels:I}=this.viewModel;return 1<I.length?D.tsx("ol",{class:"esri-popup__feature-menu-list",id:H,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},I.filter(O=>!!O.graphic).map((O,Q)=>this.renderFeatureMenuItem(O,Q))):null};J._getActionTitle=
function(H){const {messages:I,selectedFeature:O,messagesCommon:Q}=this,{id:S}=H,T=null==O?void 0:O.attributes;return(H="zoom-to-feature"===S?F.substitute(H.title,{messages:I}):"remove-selected-feature"===S?F.substitute(H.title,{messages:Q}):"zoom-to-clustered-features"===S?F.substitute(H.title,{messages:I}):"browse-clustered-features"===S?F.substitute(H.title,{messages:I}):H.title)&&T?F.substitute(H,T):H};J._getActionClass=function(H){var {selectedFeature:I}=this;I=null==I?void 0:I.attributes;const {className:O,
image:Q}=H;return(H=Q||O?O:"esri-icon-default-action")&&I?F.substitute(H,I):H};J._getActionImage=function(H){var {selectedFeature:I}=this;I=null==I?void 0:I.attributes;({image:H}=H);return H&&I?F.substitute(H,I):H};J._createFeatureUpdatedAnimation=function(){return E.cssTransition("enter","esri-popup--feature-updated")};J._getInlineActionCount=function(){const {maxInlineActions:H,featureNavigationVisible:I}=this;if("number"!==typeof H)return null;const O=Math.round(H);return Math.max(I?O-1:O,0)};
J._watchActions=function(){const {allActions:H}=this.viewModel;this.notifyChange("dividedActions");this._handles.remove("actions");H&&H.forEach(I=>{this._handles.add(k.watch(()=>[I.uid,I.active,I.className,I.disabled,I.id,I.title,I.image,I.visible],()=>this.scheduleRender()),"actions")})};J._divideActions=function(){var {allActions:H}=this.viewModel;H=H.filter(S=>S.visible);const I=this._getInlineActionCount(),O=null===I,Q=0===I;return{inlineActions:O?H.slice(0):Q?new m:H.slice(0,I),menuActions:O?
new m:Q?H.slice(0):H.slice(I)}};J._featureMenuOpenChanged=function(H){H?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0};J._actionsMenuOpenChanged=function(H){H?this._focusFirstAction=!0:this._focusActionsMenuButton=!0};J._setTitleFromFeatureWidget=function(){const {selectedFeatureWidget:H,messagesCommon:I}=this;if(H){var O,Q;this.viewModel.title="error"===(null==(O=H.viewModel)?void 0:O.state)?I.errorMessage:(null==(Q=H.viewModel)?void 0:Q.title)||""}};J._setContentFromFeatureWidget=function(){const {selectedFeatureWidget:H}=
this;H&&(this.viewModel.content=H)};J._unobserveFeatureMenuObserver=function(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)};J._featureMenuIntersectionObserverCreated=function(H){this._unobserveFeatureMenuObserver();this._featureMenuIntersectionObserver.observe(H);this._featureMenuIntersectionObserverNode=H};J._handleFeatureMenuKeyup=function(H){"Escape"===l.eventKey(H)&&(H.stopPropagation(),this._focusFeatureMenuButton=
!0,this.featureMenuOpen=!1,this.scheduleRender())};J._handleActionMenuKeyup=function(H){"Escape"===l.eventKey(H)&&(H.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())};J._setActiveFeature=function(H){const {viewModel:I}=this;I.activeFeature=I.features[H.currentTarget["data-feature-index"]]||null};J._removeActiveFeature=function(){this.viewModel.activeFeature=null};J._handleFeatureMenuItemKeyup=function(H){const I=l.eventKey(H);var {_featureMenuNode:O}=
this;const Q=H.currentTarget["data-feature-index"];if(O){O=O.querySelectorAll("li");var S=O.length;"ArrowUp"===I?(H.stopPropagation(),O[(Q-1+S)%S].focus()):"ArrowDown"===I?(H.stopPropagation(),O[(Q+1+S)%S].focus()):"Home"===I?(H.stopPropagation(),O[0].focus()):"End"===I&&(H.stopPropagation(),O[O.length-1].focus())}};J._handleActionMenuItemKeyup=function(H){const I=l.eventKey(H);var {_actionsMenuNode:O}=this;const Q=H.currentTarget.dataset.actionUid;var {menuActions:S}=this.dividedActions;S=S.findIndex(U=>
U.uid===Q);if(O){O=O.querySelectorAll("li");var T=O.length;"ArrowUp"===I?(H.stopPropagation(),O[(S-1+T)%T].focus()):"ArrowDown"===I?(H.stopPropagation(),O[(S+1+T)%T].focus()):"Home"===I?(H.stopPropagation(),O[0].focus()):"End"===I&&(H.stopPropagation(),O[O.length-1].focus())}};J._handleMainKeyup=function(H){const I=l.eventKey(H);"ArrowLeft"===I&&(H.stopPropagation(),this.previous());"ArrowRight"===I&&(H.stopPropagation(),this.next())};J._spinnerEnabledChange=function(H){this._destroySpinner();H&&
(H=this.get("viewModel.view"),this._createSpinner(H))};J._hideSpinner=function(){const {_spinner:H}=this;H&&(H.location=null,H.hide())};J._displaySpinner=function(){const {_spinner:H}=this;if(H){var {location:I,waitingForResult:O}=this.viewModel;O?H.show({location:I}):H.hide()}};J._getIconStyles=function(H){return{"background-image":H?`url(${H})`:""}};J._shouldFocus=function(){var H=a._asyncToGenerator(function*(I){I.shouldFocus&&(yield k.whenOnce(()=>{var O;return!0===(null==(O=this.viewModel)?void 0:
O.active)}),this.focus())});return function(I){return H.apply(this,arguments)}}();J._addSelectedFeatureIndexHandle=function(){const H=k.watch(()=>{var I;return null==(I=this.viewModel)?void 0:I.selectedFeatureIndex},(I,O)=>this._selectedFeatureIndexUpdated(I,O));this._handles.add(H,"selected-index")};J._selectedFeatureIndexUpdated=function(H,I){const {featureCount:O}=this;O&&H!==I&&-1!==H&&(this.featureMenuOpen=this.actionsMenuOpen=!1)};J._destroySelectedFeatureWidget=function(){const {_feature:H}=
this;H&&(H.viewModel=null,H&&!H.destroyed&&H.destroy());this._feature=null};J._isScreenLocationWithinView=function(H,I){return-1<H.x&&-1<H.y&&H.x<=I.width&&H.y<=I.height};J._isOutsideView=function(H){const {popupHeight:I,popupWidth:O,screenLocation:Q,side:S,view:T}=H;if(isNaN(O)||isNaN(I)||!T||!Q)return!1;H=T.padding;return"right"===S&&Q.x+O/2>T.width-H.right||"left"===S&&Q.x-O/2<H.left||"top"===S&&Q.y-I<H.top||"bottom"===S&&Q.y+I>T.height-H.bottom?!0:!1};J._calculateAutoAlignment=function(H){if("auto"!==
H)return H;const {_pointerOffsetInPx:I,_containerNode:O,_mainContainerNode:Q,viewModel:S}=this,{screenLocation:T,view:U}=S;if(g.isNone(T)||!U||!O)return"top-center";if(!this._isScreenLocationWithinView(T,U))return this._get("currentAlignment")||"top-center";var aa=(H=Q?window.getComputedStyle(Q,null):null)?parseInt(H.getPropertyValue("max-height").replace(/[^-\d\.]/g,""),10):0,W=H?parseInt(H.getPropertyValue("height").replace(/[^-\d\.]/g,""),10):0;const {height:R,width:V}=O.getBoundingClientRect();
H=V+I;const da=Math.max(R,aa,W)+I;aa=this._isOutsideView({popupHeight:da,popupWidth:H,screenLocation:T,side:"right",view:U});W=this._isOutsideView({popupHeight:da,popupWidth:H,screenLocation:T,side:"left",view:U});const ca=this._isOutsideView({popupHeight:da,popupWidth:H,screenLocation:T,side:"top",view:U});H=this._isOutsideView({popupHeight:da,popupWidth:H,screenLocation:T,side:"bottom",view:U});return W?ca?"bottom-right":"top-right":aa?ca?"bottom-left":"top-left":ca?H?"top-center":"bottom-center":
"top-center"};J._callCurrentAlignment=function(H){return"function"===typeof H?H.call(this):H};J._getCurrentAlignment=function(){const {alignment:H,dockEnabled:I}=this;return I||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(H)))};J._setCurrentAlignment=function(){this._set("currentAlignment",this._getCurrentAlignment())};J._setCurrentDockPosition=function(){this._set("currentDockPosition",this._getCurrentDockPosition())};J._calculatePositionResult=
function(H){const I=["left","right"];E.isRTL(this.container)&&I.reverse();return H.replace(/leading/gi,I[0]).replace(/trailing/gi,I[1])};J._callDockPosition=function(H){return"function"===typeof H?H.call(this):H};J._getDockPosition=function(){var H;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(null==(H=this.dockOptions)?void 0:H.position)))};J._getCurrentDockPosition=function(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null};
J._wouldDockTo=function(){return this.dockEnabled?null:this._getDockPosition()};J._calculateAutoDockPosition=function(H){var I;if("auto"!==H)return H;H=null==(I=this.viewModel)?void 0:I.view;I=E.isRTL(this.container)?"top-left":"top-right";if(!H)return I;var O=H.padding||{left:0,right:0,top:0,bottom:0};O=H.width-O.left-O.right;({breakpoints:H}=H);return H&&O<=H.xsmall?"bottom-center":I};J._positionContainer=function(H=this._containerNode){H&&(this._containerNode=H);if(H){var {screenLocation:I}=this.viewModel,
{width:O}=H.getBoundingClientRect();if(I=this._calculatePositionStyle(I,O))H.style.top=I.top,H.style.left=I.left,H.style.bottom=I.bottom,H.style.right=I.right}};J._calculateFullWidth=function(H){const {currentAlignment:I,_pointerOffsetInPx:O}=this;return"top-left"===I||"bottom-left"===I||"top-right"===I||"bottom-right"===I?H+O:H};J._calculateAlignmentPosition=function(H,I,O,Q){const {currentAlignment:S,_pointerOffsetInPx:T}=this;Q/=2;const U=O.height-I;O=O.width-H;const {padding:aa}=this.view;if("bottom-center"===
S)return{top:I+T-aa.top,left:H-Q-aa.left};if("top-left"===S)return{bottom:U+T-aa.bottom,right:O+T-aa.right};if("bottom-left"===S)return{top:I+T-aa.top,right:O+T-aa.right};if("top-right"===S)return{bottom:U+T-aa.bottom,left:H+T-aa.left};if("bottom-right"===S)return{top:I+T-aa.top,left:H+T-aa.left};if("top-center"===S)return{bottom:U+T-aa.bottom,left:H-Q-aa.left}};J._calculatePositionStyle=function(H,I){const {dockEnabled:O,view:Q}=this;if(Q){if(O)return{left:"",top:"",right:"",bottom:""};if(!g.isNone(H)&&
I&&(I=this._calculateFullWidth(I),H=this._calculateAlignmentPosition(H.x,H.y,Q,I)))return{top:void 0!==H.top?`${H.top}px`:"auto",left:void 0!==H.left?`${H.left}px`:"auto",bottom:void 0!==H.bottom?`${H.bottom}px`:"auto",right:void 0!==H.right?`${H.right}px`:"auto"}}};J._viewChange=function(H,I){H&&I&&(this.close(),this.clear())};J._viewReadyChange=function(H,I){H?(H=this.get("viewModel.view"),this._wireUpView(H)):I&&(this.close(),this.clear())};J._wireUpView=function(H){this._destroySpinner();if(H){var {spinnerEnabled:I}=
this;I&&this._createSpinner(H);this._setDockEnabledForViewSize(this.dockOptions)}};J._dockingThresholdCrossed=function(H,I,O){const [Q,S]=H,[T,U]=I,{width:aa,height:W}=O;return Q<=aa&&T>aa||Q>aa&&T<=aa||S<=W&&U>W||S>W&&U<=W};J._updateDockEnabledForViewSize=function(H,I){if(H&&I){var O=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},Q=O.left+O.right,S=O.top+O.bottom;O=[];var T=[];O[0]=H[0]-Q;O[1]=H[1]-S;T[0]=I[0]-Q;T[1]=I[1]-S;({dockOptions:H}=this);this._dockingThresholdCrossed(O,
T,H.breakpoint)&&this._setDockEnabledForViewSize(H);this._setCurrentDockPosition()}};J._focusDockButtonNode=function(H){this._focusDockButton&&(this._focusDockButton=!1,H.focus())};J._closeButtonNodeUpdated=function(H){this._focusClose?(this._focusClose=!1,H.focus()):this._blurClose&&(this._blurClose=!1,H.blur())};J._mainContainerNodeUpdated=function(H){this._mainContainerNode=H;this._focusContainer?(this._focusContainer=!1,H.focus()):this._blurContainer&&(this._blurContainer=!1,H.blur())};J._featureMenuNodeUpdated=
function(H){(this._featureMenuNode=H)&&this._focusFirstFeature&&(this._focusFirstFeature=!1,H=H.querySelectorAll("li"),H.length&&H[0].focus())};J._actionsMenuNodeUpdated=function(H){(this._actionsMenuNode=H)&&this._focusFirstAction&&(this._focusFirstAction=!1,H=H.querySelectorAll("li"),H.length&&H[0].focus())};J._focusFeatureMenuButtonNode=function(H){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,H.focus())};J._focusActionsMenuButtonNode=function(H){this._focusActionsMenuButton&&
(this._focusActionsMenuButton=!1,H.focus())};J._featureMenuViewportScrollTop=function(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)};J._toggleScreenLocationEnabled=function(){const {dockEnabled:H,viewModel:I}=this;I&&(I.screenLocationEnabled=I.active&&!H)};J._shouldDockAtCurrentViewSize=function(H){var I,O;H=H.breakpoint;const Q=null==(I=this.viewModel)?void 0:null==(O=I.view)?void 0:O.ui;if(!Q)return!1;const {width:S,height:T}=Q;if(isNaN(S)||isNaN(T))return!1;I=H.hasOwnProperty("width")&&
S<=H.width;O=H.hasOwnProperty("height")&&T<=H.height;return I||O};J._setDockEnabledForViewSize=function(H){H.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(H))};J._getPageText=function(H,I){return this.featureNavigationVisible?F.substitute(this.messages.pageText,{index:I+1,total:H}):null};J._destroySpinner=function(){const {_spinner:H,view:I}=this;H&&(I&&I.ui&&I.ui.remove(this._spinner,"popup-spinner"),H.destroy(),this._spinner=null)};J._createSpinner=function(H){H&&(this._spinner=
new B({view:H}),H.ui.add(this._spinner,{key:"popup-spinner",position:"manual"}))};J._toggleCollapsed=function(){this.collapsed=!this.collapsed};J._close=function(){this.close();this.view&&this.view.focus()};J._toggleDockEnabled=function(){this.dockEnabled=!this.dockEnabled;this._focusDockButton=!0;this.scheduleRender()};J._toggleFeatureMenu=function(){const H=!this.featureMenuOpen;this._featureMenuOpenChanged(H);this.actionsMenuOpen=!1;this.featureMenuOpen=H};J._toggleActionsMenu=function(){const H=
!this.actionsMenuOpen;this._actionsMenuOpenChanged(H);this.featureMenuOpen=!1;this.actionsMenuOpen=H};J._triggerAction=function(H){const I=H.currentTarget.dataset.actionUid;var {allActions:O}=this.viewModel;H=O.findIndex(Q=>Q.uid===I);(O=O.getItemAt(H))&&"toggle"===O.type&&(O.value=!O.value);this.actionsMenuOpen=!1;this.viewModel.triggerAction(H)};J._selectFeature=function(H){H=H.currentTarget["data-feature-index"];isNaN(H)||(this.viewModel.selectedFeatureIndex=H);this.featureMenuOpen=!1;this._focusFeatureMenuButton=
!0;this.scheduleRender()};J._next=function(){this.next()};J._previous=function(){this.previous()};a._createClass(L,[{key:"actionsMenuId",get:function(){return`${this.id}-actions-menu`}},{key:"actionsMenuButtonId",get:function(){return`${this.id}-actions-menu-button`}},{key:"featureMenuId",get:function(){return`${this.id}-feature-menu`}},{key:"titleId",get:function(){return`${this.id}-popup-title`}},{key:"contentId",get:function(){return`${this.id}-popup-content`}},{key:"hasContent",get:function(){var H,
I,O,Q,S,T,U;return!!(this.selectedFeatureWidget?(null==(H=this.selectedFeatureWidget)?0:null==(I=H.viewModel)?0:I.waitingForContent)||"error"===(null==(O=this.selectedFeatureWidget)?void 0:null==(Q=O.viewModel)?void 0:Q.state)||(null==(S=this.selectedFeatureWidget)?0:null==(T=S.viewModel)?0:T.content):null==(U=this.viewModel)?0:U.content)}},{key:"featureNavigationVisible",get:function(){return this.viewModel.active&&1<this.viewModel.featureCount&&this.visibleElements.featureNavigation}},{key:"collapsible",
get:function(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}},{key:"featureMenuVisible",get:function(){return this.featureNavigationVisible&&this.featureMenuOpen}},{key:"contentCollapsed",get:function(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}},{key:"dividedActions",get:function(){return this._divideActions()}},{key:"actionsMenuOpen",get:function(){return this.viewModel.active?this._get("actionsMenuOpen"):!1},set:function(H){this._set("actionsMenuOpen",
!!H)}},{key:"currentAlignment",get:function(){return this._getCurrentAlignment()}},{key:"currentDockPosition",get:function(){return this._getCurrentDockPosition()}},{key:"dockOptions",get:function(){return this._get("dockOptions")||P},set:function(H){var I={...P};const O=this.get("viewModel.view.breakpoints");var Q={};O&&(Q.width=O.xsmall,Q.height=O.xsmall);H={...I,...H};I={...I.breakpoint,...Q};({breakpoint:Q}=H);!0===Q?H.breakpoint=I:"object"===typeof Q&&(H.breakpoint={...I,...Q});this._set("dockOptions",
H);this._setCurrentDockPosition();this.reposition()}},{key:"selectedFeatureWidget",get:function(){const {_feature:H,visibleElements:I,headingLevel:O}=this,{selectedFeatureViewModel:Q}=this.viewModel,S={...I,title:!1};if(!Q)return null;H?(H.viewModel=Q,H.visibleElements=S):this._feature=new x({headingLevel:O+1,viewModel:Q,visibleElements:S});return this._feature}}]);return L}(u.FeatureContentMixin(q));b.__decorate([w.property({readOnly:!0})],c.prototype,"actionsMenuId",null);b.__decorate([w.property({readOnly:!0})],
c.prototype,"actionsMenuButtonId",null);b.__decorate([w.property({readOnly:!0})],c.prototype,"featureMenuId",null);b.__decorate([w.property({readOnly:!0})],c.prototype,"titleId",null);b.__decorate([w.property({readOnly:!0})],c.prototype,"contentId",null);b.__decorate([w.property({readOnly:!0})],c.prototype,"hasContent",null);b.__decorate([w.property({readOnly:!0})],c.prototype,"featureNavigationVisible",null);b.__decorate([w.property({readOnly:!0})],c.prototype,"collapsible",null);b.__decorate([w.property({readOnly:!0})],
c.prototype,"featureMenuVisible",null);b.__decorate([w.property({readOnly:!0})],c.prototype,"contentCollapsed",null);b.__decorate([w.property({readOnly:!0})],c.prototype,"dividedActions",null);b.__decorate([d.aliasOf("viewModel.actions")],c.prototype,"actions",void 0);b.__decorate([w.property()],c.prototype,"actionsMenuOpen",null);b.__decorate([w.property()],c.prototype,"alignment",void 0);b.__decorate([d.aliasOf("viewModel.autoCloseEnabled")],c.prototype,"autoCloseEnabled",void 0);b.__decorate([d.aliasOf("viewModel.autoOpenEnabled")],
c.prototype,"autoOpenEnabled",void 0);b.__decorate([d.aliasOf("viewModel.defaultPopupTemplateEnabled")],c.prototype,"defaultPopupTemplateEnabled",void 0);b.__decorate([d.aliasOf("viewModel.content")],c.prototype,"content",void 0);b.__decorate([w.property()],c.prototype,"collapsed",void 0);b.__decorate([w.property()],c.prototype,"collapseEnabled",void 0);b.__decorate([w.property({readOnly:!0})],c.prototype,"currentAlignment",null);b.__decorate([w.property({readOnly:!0})],c.prototype,"currentDockPosition",
null);b.__decorate([w.property()],c.prototype,"dockOptions",null);b.__decorate([w.property()],c.prototype,"dockEnabled",void 0);b.__decorate([d.aliasOf("viewModel.featureCount")],c.prototype,"featureCount",void 0);b.__decorate([w.property()],c.prototype,"featureMenuOpen",void 0);b.__decorate([d.aliasOf("viewModel.features")],c.prototype,"features",void 0);b.__decorate([d.aliasOf("viewModel.goToOverride")],c.prototype,"goToOverride",void 0);b.__decorate([w.property()],c.prototype,"headingLevel",void 0);
b.__decorate([d.aliasOf("viewModel.highlightEnabled")],c.prototype,"highlightEnabled",void 0);b.__decorate([d.aliasOf("viewModel.location")],c.prototype,"location",void 0);b.__decorate([w.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],c.prototype,"label",void 0);b.__decorate([w.property()],c.prototype,"maxInlineActions",void 0);b.__decorate([w.property(),p.messageBundle("esri/widgets/Popup/t9n/Popup")],c.prototype,"messages",void 0);b.__decorate([w.property(),p.messageBundle("esri/t9n/common")],
c.prototype,"messagesCommon",void 0);b.__decorate([d.aliasOf("viewModel.promises")],c.prototype,"promises",void 0);b.__decorate([d.aliasOf("viewModel.selectedFeature")],c.prototype,"selectedFeature",void 0);b.__decorate([d.aliasOf("viewModel.selectedFeatureIndex")],c.prototype,"selectedFeatureIndex",void 0);b.__decorate([w.property({readOnly:!0})],c.prototype,"selectedFeatureWidget",null);b.__decorate([w.property()],c.prototype,"spinnerEnabled",void 0);b.__decorate([d.aliasOf("viewModel.title")],
c.prototype,"title",void 0);b.__decorate([d.aliasOf("viewModel.updateLocationEnabled")],c.prototype,"updateLocationEnabled",void 0);b.__decorate([d.aliasOf("viewModel.view")],c.prototype,"view",void 0);b.__decorate([w.property({type:C}),y.vmEvent(["triggerAction","trigger-action"])],c.prototype,"viewModel",void 0);b.__decorate([d.aliasOf("viewModel.visible")],c.prototype,"visible",void 0);b.__decorate([w.property()],c.prototype,"visibleElements",void 0);b.__decorate([v.cast("visibleElements")],c.prototype,
"castVisibleElements",null);b.__decorate([A.accessibleHandler()],c.prototype,"_close",null);b.__decorate([A.accessibleHandler()],c.prototype,"_toggleDockEnabled",null);b.__decorate([A.accessibleHandler()],c.prototype,"_toggleFeatureMenu",null);b.__decorate([A.accessibleHandler()],c.prototype,"_toggleActionsMenu",null);b.__decorate([A.accessibleHandler()],c.prototype,"_triggerAction",null);b.__decorate([A.accessibleHandler()],c.prototype,"_selectFeature",null);b.__decorate([A.accessibleHandler()],
c.prototype,"_next",null);b.__decorate([A.accessibleHandler()],c.prototype,"_previous",null);return c=b.__decorate([t.subclass("esri.widgets.Popup")],c)})},"esri/core/throttle":function(){define(["exports"],function(a){a.throttle=function(b,c,m,l){let r=null,n=1E3;"number"===typeof c?(n=c,l=m):(r=null!=c?c:null,n=m);let g=0,k;const f=()=>{g=0;b.apply(l,k)};c=(...d)=>{r&&r.apply(l,d);k=d;n?g||(g=setTimeout(f,n)):f()};c.remove=()=>{g&&(clearTimeout(g),g=0)};c.forceUpdate=()=>{g&&(clearTimeout(g),f())};
c.hasPendingUpdates=()=>!!g;return c};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Feature":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../intl ../core/reactiveUtils ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Feature/FeatureAttachments ./Feature/FeatureContent ./Feature/FeatureExpression ./Feature/FeatureFields ./Feature/FeatureMedia ./Feature/FeatureViewModel ./Feature/support/FeatureContentMixin ./support/Heading ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory ../intl/substitute".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p){const y={title:!0,content:!0,lastEditedInfo:!0};m=function(D){function E(G,P){G=D.call(this,G,P)||this;G._contentWidgets=[];G.graphic=null;G.defaultPopupTemplateEnabled=!1;G.headingLevel=2;G.label=void 0;G.messages=null;G.messagesCommon=null;G.messagesURIUtils=null;G.spatialReference=null;G.title=null;G.visibleElements={...y};G.map=null;G.view=null;G.viewModel=new B;return G}b._inheritsLoose(E,D);var F=E.prototype;F.initialize=function(){this.own(l.watch(()=>
{var G;return null==(G=this.viewModel)?void 0:G.contentViewModels},()=>this._setupContentWidgets(),l.initial))};F.loadDependencies=function(){return new Promise((G,P)=>a(["../chunks/calcite-notice"],G,P))};F.destroy=function(){this._destroyContentWidgets()};F.castVisibleElements=function(G){return{...y,...G}};F.render=function(){var {state:G}=this.viewModel;G=A.tsx("div",{class:"esri-feature__size-container",key:"container"},this.renderTitle(),"error"===G?this.renderError():"loading"===G?this.renderLoading():
this.renderContentContainer());return A.tsx("div",{class:this.classes("esri-feature","esri-widget")},G)};F.setActiveMedia=function(G,P){this.viewModel.setActiveMedia(G,P)};F.nextMedia=function(G){this.viewModel.nextMedia(G)};F.previousMedia=function(G){this.viewModel.previousMedia(G)};F.renderError=function(){const {messagesCommon:G,messages:P,visibleElements:K}=this;return A.tsx("calcite-notice",{active:!0,color:"red",icon:"exclamation-mark-circle",scale:"s"},K.title?A.tsx("div",{key:"error-title",
slot:"title"},G.errorMessage):null,A.tsx("div",{key:"error-message",slot:"message"},P.loadingError))};F.renderLoading=function(){return A.tsx("div",{key:"loading-container",class:"esri-feature__loading-container"},A.tsx("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")}))};F.renderContentContainer=function(){const {visibleElements:G}=this;return G.content?A.tsx("div",{class:"esri-feature__main-container"},[this.renderContent(),this.renderLastEditInfo()]):
null};F.renderTitle=function(){const {visibleElements:G,title:P}=this;return G.title?A.tsx(u.Heading,{level:this.headingLevel,class:"esri-feature__title",innerHTML:P}):null};F.renderContent=function(){var G=this.viewModel.content;return G?Array.isArray(G)?G.length?A.tsx("div",{key:"content-content-elements"},G.map(this.renderContentElement,this)):null:"string"===typeof G?(G=this._contentWidgets[0],!G||G.destroyed?null:A.tsx("div",{key:"content-content"},G.render())):this.renderNodeContent(G):null};
F.renderContentElement=function(G,P){const {visibleElements:K}=this;if("boolean"!==typeof K.content&&!K.content[G.type])return null;switch(G.type){case "attachments":return this.renderAttachments(P);case "custom":return this.renderCustom(G,P);case "fields":return this.renderFields(P);case "media":return this.renderMedia(P);case "text":return this.renderText(G,P);case "expression":return this.renderExpression(P);default:return null}};F.renderAttachments=function(G){const P=this._contentWidgets[G];
if(!P||P.destroyed)return null;const {state:K,attachmentInfos:N}=P.viewModel;return"loading"===K||0<N.length?A.tsx("div",{key:this._buildKey("attachments-element",G),class:this.classes("esri-feature__content-element")},P.render()):null};F.renderExpression=function(G){const P=this._contentWidgets[G];return!P||P.destroyed?null:A.tsx("div",{key:this._buildKey("expression-element",G),class:"esri-feature__content-element"},P.render())};F.renderCustom=function(G,P){({creator:G}=G);const K=this._contentWidgets[P];
return!K||K.destroyed?null:G?A.tsx("div",{key:this._buildKey("custom-element",P),class:"esri-feature__content-element"},K.render()):null};F.renderFields=function(G){const P=this._contentWidgets[G];return!P||P.destroyed?null:A.tsx("div",{key:this._buildKey("fields-element",G),class:"esri-feature__content-element"},P.render())};F.renderMedia=function(G){const P=this._contentWidgets[G];return!P||P.destroyed?null:A.tsx("div",{key:this._buildKey("media-element",G),class:"esri-feature__content-element"},
P.render())};F.renderLastEditInfo=function(){const {visibleElements:G,messages:P}=this;var {lastEditInfo:K}=this.viewModel;if(!K||!G.lastEditedInfo)return null;const {date:N,user:M}=K;K=p.substitute("edit"===K.type?M?P.lastEditedByUser:P.lastEdited:M?P.lastCreatedByUser:P.lastCreated,{date:N,user:M});return A.tsx("div",{key:"edit-info-element",class:this.classes("esri-feature__last-edited-info","esri-feature__content-element")},K)};F.renderText=function(G,P){const K=this._contentWidgets[P];return!K||
K.destroyed?null:G.text?A.tsx("div",{key:this._buildKey("text-element",P),class:this.classes("esri-feature__content-element","esri-feature__text")},K.render()):null};F._buildKey=function(G,...P){const K=this.get("viewModel.graphic.uid")||"0";P=P.join("-");return`${G}__${K}-${P}`};F._destroyContentWidget=function(G){G&&(G.viewModel=null,!G.destroyed&&G.destroy())};F._destroyContentWidgets=function(){this._contentWidgets.forEach(G=>this._destroyContentWidget(G));this._contentWidgets=[]};F._setupContentWidgets=
function(){this._destroyContentWidgets();const {headingLevel:G,visibleElements:P}=this;var K=this.get("viewModel.content");const {contentViewModels:N}=this.viewModel;Array.isArray(K)?K.forEach((M,L)=>{"attachments"===M.type&&(this._contentWidgets[L]=new h({displayType:M.displayType,headingLevel:P.title?G+1:G,viewModel:N[L]}));"fields"===M.type&&(this._contentWidgets[L]=new t({viewModel:N[L]}));"media"===M.type&&(this._contentWidgets[L]=new x({viewModel:N[L]}));"text"===M.type&&(this._contentWidgets[L]=
new v({viewModel:N[L]}));"custom"===M.type&&(this._contentWidgets[L]=new v({viewModel:N[L]}));"expression"===M.type&&(this._contentWidgets[L]=new w({viewModel:N[L]}))},this):(K=N[0])&&!K.destroyed&&(this._contentWidgets[0]=new v({viewModel:K}));this.scheduleRender()};return E}(q.FeatureContentMixin(e));c.__decorate([r.aliasOf("viewModel.graphic")],m.prototype,"graphic",void 0);c.__decorate([r.aliasOf("viewModel.defaultPopupTemplateEnabled")],m.prototype,"defaultPopupTemplateEnabled",void 0);c.__decorate([f.property()],
m.prototype,"headingLevel",void 0);c.__decorate([f.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],m.prototype,"label",void 0);c.__decorate([f.property(),z.messageBundle("esri/widgets/Feature/t9n/Feature")],m.prototype,"messages",void 0);c.__decorate([f.property(),z.messageBundle("esri/t9n/common")],m.prototype,"messagesCommon",void 0);c.__decorate([f.property(),z.messageBundle("esri/widgets/support/t9n/uriUtils")],m.prototype,"messagesURIUtils",void 0);c.__decorate([r.aliasOf("viewModel.spatialReference")],
m.prototype,"spatialReference",void 0);c.__decorate([r.aliasOf("viewModel.title")],m.prototype,"title",void 0);c.__decorate([f.property()],m.prototype,"visibleElements",void 0);c.__decorate([k.cast("visibleElements")],m.prototype,"castVisibleElements",null);c.__decorate([r.aliasOf("viewModel.map")],m.prototype,"map",void 0);c.__decorate([r.aliasOf("viewModel.view")],m.prototype,"view",void 0);c.__decorate([f.property({type:B})],m.prototype,"viewModel",void 0);return m=c.__decorate([d.subclass("esri.widgets.Feature")],
m)})},"esri/widgets/Feature/FeatureAttachments":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/reactiveUtils ../../core/accessorSupport/decorators/aliasOf ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ../Attachments ../Widget ./FeatureAttachments/FeatureAttachmentsViewModel ./support/FeatureElementInfo ../support/widgetUtils ../support/jsxFactory".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w){l=function(t){function x(q,u){q=t.call(this,q,u)||this;q._featureElementInfo=null;q.attachmentsWidget=new f;q.description=null;q.displayType=null;q.graphic=null;q.headingLevel=2;q.title=null;q.viewModel=new e;return q}a._inheritsLoose(x,t);var B=x.prototype;B.initialize=function(){this._featureElementInfo=new h;this.own([c.watch(()=>{var q,u;return[null==(q=this.viewModel)?void 0:q.description,null==(u=this.viewModel)?void 0:u.title,this.headingLevel]},()=>
this._setupFeatureElementInfo(),c.initial),c.watch(()=>{var q;return null==(q=this.viewModel)?void 0:q.graphic},q=>this.attachmentsWidget.graphic=q,c.initial)])};B.destroy=function(){this.attachmentsWidget.destroy();this._featureElementInfo.destroy()};B.render=function(){var q;const {attachmentsWidget:u}=this;return w.tsx("div",{class:"esri-feature-attachments"},null==(q=this._featureElementInfo)?void 0:q.render(),null==u?void 0:u.render())};B._setupFeatureElementInfo=function(){const {description:q,
title:u,headingLevel:C}=this;this._featureElementInfo.set({description:q,title:u,headingLevel:C})};return x}(d);b.__decorate([g.property({readOnly:!0})],l.prototype,"attachmentsWidget",void 0);b.__decorate([m.aliasOf("viewModel.description")],l.prototype,"description",void 0);b.__decorate([m.aliasOf("attachmentsWidget.displayType")],l.prototype,"displayType",void 0);b.__decorate([m.aliasOf("viewModel.graphic")],l.prototype,"graphic",void 0);b.__decorate([g.property()],l.prototype,"headingLevel",void 0);
b.__decorate([m.aliasOf("viewModel.title")],l.prototype,"title",void 0);b.__decorate([g.property({type:e})],l.prototype,"viewModel",void 0);return l=b.__decorate([k.subclass("esri.widgets.Feature.FeatureAttachments")],l)})},"esri/widgets/Attachments":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Error ../core/reactiveUtils ../core/unitFormatUtils ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Attachments/AttachmentsViewModel ./Attachments/support/attachmentUtils ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x){const B={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},q=window.CSS;n=function(u){function C(A,p){A=u.call(this,A,p)||this;A.abilities=null;A.displayType="auto";A.graphic=null;A.label=void 0;A.messages=null;A.messagesUnits=null;A.selectedFile=null;A.submitting=!1;A.viewModel=new h;A.visibleElements={...B};A._supportsImageOrientation=q&&q.supports&&q.supports("image-orientation",
"from-image");A._addAttachmentForm=null;A._updateAttachmentForm=null;return A}a._inheritsLoose(C,u);var z=C.prototype;z.initialize=function(){this.own([m.on(()=>{var A;return null==(A=this.viewModel)?void 0:A.attachmentInfos},"change",()=>this.scheduleRender()),m.watch(()=>{var A;return null==(A=this.viewModel)?void 0:A.mode},()=>this._modeChanged(),m.initial)])};z.castVisibleElements=function(A){return{...B,...A}};z.addAttachment=function(){const {_addAttachmentForm:A,viewModel:p}=this;this._set("submitting",
!0);this._set("error",null);return p.addAttachment(A).then(y=>{this._set("submitting",!1);this._set("error",null);p.mode="view";return y}).catch(y=>{this._set("submitting",!1);this._set("error",new c("attachments:add-attachment",this.messages.addErrorMessage,y));throw y;})};z.deleteAttachment=function(A){const {viewModel:p}=this;this._set("submitting",!0);this._set("error",null);return p.deleteAttachment(A).then(y=>{this._set("submitting",!1);this._set("error",null);p.mode="view";return y}).catch(y=>
{this._set("submitting",!1);this._set("error",new c("attachments:delete-attachment",this.messages.deleteErrorMessage,y));throw y;})};z.updateAttachment=function(){const {viewModel:A}=this,{_updateAttachmentForm:p}=this;this._set("submitting",!0);this._set("error",null);return A.updateAttachment(p).then(y=>{this._set("submitting",!1);this._set("error",null);A.mode="view";return y}).catch(y=>{this._set("submitting",!1);this._set("error",new c("attachments:update-attachment",this.messages.updateErrorMessage,
y));throw y;})};z.render=function(){const {submitting:A,viewModel:p}=this,{state:y}=p;return x.tsx("div",{class:this.classes("esri-attachments","esri-widget")},A?this.renderProgressBar():null,"loading"===y?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())};z.renderErrorMessage=function(){const {error:A,visibleElements:p}=this;return A&&p.errorMessage?x.tsx("div",{key:"error-message",class:"esri-attachments__error-message"},A.message):null};z.renderAttachments=function(){const {mode:A,
activeAttachmentInfo:p}=this.viewModel;return"add"===A?this.renderAddForm():"edit"===A?this.renderDetailsForm(p):this.renderAttachmentContainer()};z.renderLoading=function(){return x.tsx("div",{class:"esri-attachments__loader-container",key:"loader"},x.tsx("div",{class:"esri-attachments__loader"}))};z.renderProgressBar=function(){return this.visibleElements.progressBar?x.tsx("div",{class:"esri-attachments__progress-bar",key:"progress-bar"}):null};z.renderAddForm=function(){const {submitting:A,selectedFile:p}=
this;var y=A||!p,D=this.visibleElements.cancelAddButton?x.tsx("button",{type:"button",bind:this,disabled:A,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--tertiary","esri-button--small","esri-button--half",A&&"esri-button--disabled")},this.messages.cancel):null;y=this.visibleElements.addSubmitButton?x.tsx("button",{type:"submit",disabled:y,class:this.classes("esri-button","esri-button--secondary","esri-button--small","esri-button--half",{["esri-button--disabled"]:y})},this.messages.add):
null;const E=p?x.tsx("span",{key:"file-name",class:"esri-attachments__file-name"},p.name):null;D=x.tsx("form",{bind:this,afterCreate:w.storeNode,afterRemoved:w.discardNode,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},x.tsx("fieldset",{class:"esri-attachments__file-fieldset"},E,x.tsx("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},p?this.messages.changeFile:this.messages.selectFile,x.tsx("input",{class:"esri-attachments__file-input",
type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),y,D);return x.tsx("div",{key:"add-form-container",class:"esri-attachments__form-node"},D)};z.renderDetailsForm=function(A){const {visibleElements:p,viewModel:y,selectedFile:D,submitting:E}=this,{contentType:F,size:G,url:P}=A;var {abilities:K}=y,N=E||!D,M=K.editing&&K.operations.delete&&p.deleteButton?x.tsx("button",{key:"delete-button",type:"button",disabled:E,bind:this,onclick:I=>this._submitDeleteAttachment(I,A),class:this.classes("esri-button",
"esri-button--small","esri-button--tertiary","esri-attachments__delete-button",{["esri-button--disabled"]:E})},this.messages.delete):null;N=K.editing&&K.operations.update&&p.updateButton?x.tsx("button",{disabled:N,key:"update-button",type:"submit",class:this.classes("esri-button","esri-button--small","esri-button--third",{["esri-button--disabled"]:N})},this.messages.update):null;const L=this.visibleElements.cancelUpdateButton?x.tsx("button",{disabled:E,key:"cancel-button",type:"button",bind:this,
onclick:this._cancelForm,class:this.classes("esri-button","esri-button--small","esri-button--tertiary","esri-button--third",{["esri-button--disabled"]:E})},this.messages.cancel):null;var J=D?x.tsx("span",{key:"file-name",class:"esri-attachments__file-name"},D.name):null;K=K.editing&&K.operations.update?x.tsx("fieldset",{key:"file",class:"esri-attachments__file-fieldset"},J,x.tsx("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},this.messages.changeFile,
x.tsx("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):null;J=x.tsx("fieldset",{key:"size",class:"esri-attachments__metadata-fieldset"},x.tsx("label",null,l.formatFileSize(this.messagesUnits,G)));const H=x.tsx("fieldset",{key:"content-type",class:"esri-attachments__metadata-fieldset"},x.tsx("label",null,F));M=x.tsx("form",{bind:this,afterCreate:w.storeNode,afterRemoved:w.discardNode,"data-node-ref":"_updateAttachmentForm",
onsubmit:this._submitUpdateAttachment},x.tsx("div",{class:"esri-attachments__metadata"},J,H),K,x.tsx("div",{class:"esri-attachments__actions"},M,L,N));return x.tsx("div",{key:"edit-form-container",class:"esri-attachments__form-node"},x.tsx("a",{class:"esri-attachments__item-link",href:P,rel:"noreferrer",target:"_blank"},this.renderImageMask({attachmentInfo:A,size:400}),x.tsx("div",{class:"esri-attachments__item-link-overlay"},x.tsx("span",{class:"esri-attachments__item-link-overlay-icon"},x.tsx("svg",
{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},x.tsx("path",{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),x.tsx("path",{fill:"none",d:"M0 0h32v32H0z"}))))),M)};z.renderImageMask=function({attachmentInfo:A,size:p}){var {supportsResizeAttachments:y}=this.viewModel;const {contentType:D,name:E,url:F}=A,G=y&&v.isSupportedImage(D);A=(A=this._getCSSTransform(A,G))?{transform:A,"image-orientation":"none"}:{};const P=F.includes("?")?
"\x26":"?";p=G?`${F}${P}w=${p}`:v.getIconPath(D);y={["esri-attachments__image--resizable"]:y};return x.tsx("div",{class:this.classes({["esri-attachments__item-mask--icon"]:!G},"esri-attachments__item-mask")},x.tsx("img",{styles:A,alt:E,src:p,class:this.classes(y,"esri-attachments__image")}))};z.renderAttachmentInfo=function({attachmentInfo:A,displayType:p}){var {viewModel:y}=this;({abilities:y}=y);const {name:D,url:E}=A;p=this.renderImageMask({attachmentInfo:A,size:"list"===p?48:400});var F=y.editing?
x.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",w.isRTL(this.container)?"esri-icon-left":"esri-icon-right")}):null;F=x.tsx("label",{class:"esri-attachments__label"},x.tsx("span",{class:"esri-attachments__filename"},D||this.messages.noTitle),F);p=[p,F];y=y.editing?x.tsx("button",{key:"details-button",bind:this,class:"esri-attachments__item-button",title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":A.id,
onclick:()=>this._startEditAttachment(A),type:"button"},p):x.tsx("a",{key:"details-link",class:"esri-attachments__item-button",href:E,target:"_blank"},p);return x.tsx("li",{class:"esri-attachments__item",key:A},y)};z.renderAttachmentContainer=function(){const {effectiveDisplayType:A,viewModel:p,visibleElements:y}=this,{attachmentInfos:D,abilities:E}=p;var F=D&&D.length;const G={["esri-attachments__container--list"]:"preview"!==A,["esri-attachments__container--preview"]:"preview"===A},P=E.editing&&
E.operations.add&&y.addButton?x.tsx("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes("esri-button","esri-button--tertiary","esri-attachments__add-attachment-button"),type:"button"},x.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-add-icon","esri-icon-plus")}),this.messages.add):null;F=F?x.tsx("ul",{class:"esri-attachments__items"},D.toArray().map(K=>this.renderAttachmentInfo({attachmentInfo:K,displayType:A}))):x.tsx("div",{class:"esri-widget__content--empty"},
this.messages.noAttachments);return x.tsx("div",{key:"attachments-container",class:this.classes("esri-attachments__container",G)},F,P)};z._modeChanged=function(){this._set("error",null);this._set("selectedFile",null)};z._handleFileInputChange=function(A){A=(A=A.target)&&A.files&&A.files.item(0);this._set("selectedFile",A)};z._submitDeleteAttachment=function(A,p){A.preventDefault();this.deleteAttachment(p)};z._submitAddAttachment=function(A){A.preventDefault();this.addAttachment()};z._submitUpdateAttachment=
function(A){A.preventDefault();this.updateAttachment()};z._startEditAttachment=function(A){const {viewModel:p}=this;p.activeAttachmentInfo=A;p.mode="edit"};z._startAddAttachment=function(){this.viewModel.mode="add"};z._cancelForm=function(A){A.preventDefault();this.viewModel.mode="view"};z._getCSSTransform=function(A,p){({orientationInfo:A}=A);return!this._supportsImageOrientation&&p&&A?[A.rotation?`rotate(${A.rotation}deg)`:"",A.mirrored?"scaleX(-1)":""].join(" "):""};a._createClass(C,[{key:"effectiveDisplayType",
get:function(){const {displayType:A}=this;return A&&"auto"!==A?A:this.viewModel.supportsResizeAttachments?"preview":"list"}}]);return C}(e);b.__decorate([r.aliasOf("viewModel.abilities")],n.prototype,"abilities",void 0);b.__decorate([f.property()],n.prototype,"displayType",void 0);b.__decorate([f.property({readOnly:!0})],n.prototype,"effectiveDisplayType",null);b.__decorate([r.aliasOf("viewModel.graphic")],n.prototype,"graphic",void 0);b.__decorate([f.property({aliasOf:{source:"messages.widgetLabel",
overridable:!0}})],n.prototype,"label",void 0);b.__decorate([f.property(),t.messageBundle("esri/widgets/Attachments/t9n/Attachments")],n.prototype,"messages",void 0);b.__decorate([f.property(),t.messageBundle("esri/core/t9n/Units")],n.prototype,"messagesUnits",void 0);b.__decorate([f.property({readOnly:!0})],n.prototype,"selectedFile",void 0);b.__decorate([f.property({readOnly:!0})],n.prototype,"submitting",void 0);b.__decorate([f.property({readOnly:!0})],n.prototype,"error",void 0);b.__decorate([f.property({type:h})],
n.prototype,"viewModel",void 0);b.__decorate([f.property()],n.prototype,"visibleElements",void 0);b.__decorate([k.cast("visibleElements")],n.prototype,"castVisibleElements",null);return n=b.__decorate([d.subclass("esri.widgets.Attachments")],n)})},"esri/core/unitFormatUtils":function(){define("exports ./byteSizeEstimations ./Cyclical ./mathUtils ./maybe ./string ./unitUtils ../intl/number".split(" "),function(a,b,c,m,l,r,n,g){function k(v,w,t){return v.units[w][t]}function f(v,w,t,x=2,B="abbr"){return`${g.formatNumber(w,
{minimumFractionDigits:x,maximumFractionDigits:x})} ${k(v,t,B)}`}function d(v,w,t,x=2,B="abbr"){return`${g.formatNumber(w,{minimumFractionDigits:x,maximumFractionDigits:x,signDisplay:"exceptZero"})} ${k(v,t,B)}`}function e(v,w,t){if(w===t)return v;switch(t){case "arithmetic":return-v+90;case "geographic":return-v-90}}const h=["B","kB","MB","GB","TB"];a.formatAngleDegrees=function(v,w,t,x,B){v=c.cyclicalDegrees.normalize(e(n.convertUnit(v,w,"degrees"),t,x),0,!0);B=l.unwrapOr(B,2);return g.formatNumber(v,
{style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:B,minimumFractionDigits:B})};a.formatDMS=function(v,w,t=2){v=n.convertUnit(v,w,"degrees");w=v-Math.floor(v);v-=w;w*=60;let x=w-Math.floor(w);w-=x;x*=60;return`${v.toFixed()}\u00b0 ${w.toFixed()}' ${x.toFixed(t)}"`};a.formatDecimal=f;a.formatFileSize=function(v,w){let t=0===w?0:Math.floor(Math.log(w)/Math.log(b.ByteSizeUnit.KILOBYTES));t=m.clamp(t,0,h.length-1);w=g.formatNumber(w/b.ByteSizeUnit.KILOBYTES**t,{maximumFractionDigits:2});
return r.replace(v.units.bytes[h[t]],{fileSize:w})};a.formatImperialArea=function(v,w,t,x=2,B="abbr"){const q=n.preferredImperialAreaUnit(w,t);return f(v,n.convertUnit(w,t,q),q,x,B)};a.formatImperialLength=function(v,w,t,x=2,B="abbr"){const q=n.preferredImperialLengthUnit(w,t);return f(v,n.convertUnit(w,t,q),q,x,B)};a.formatImperialRelativeLength=function(v,w,t,x=2,B="abbr"){const q=n.preferredImperialLengthUnit(w,t);return d(v,n.convertUnit(w,t,q),q,x,B)};a.formatImperialRelativeVerticalLength=function(v,
w,t,x=2,B="abbr"){const q=n.preferredImperialVerticalLengthUnit(w,t);return d(v,n.convertUnit(w,t,q),q,x,B)};a.formatImperialVerticalLength=function(v,w,t,x=2,B="abbr"){const q=n.preferredImperialVerticalLengthUnit(w,t);return f(v,n.convertUnit(w,t,q),q,x,B)};a.formatMetricArea=function(v,w,t,x=2,B="abbr"){const q=n.preferredMetricAreaUnit(w,t);return f(v,n.convertUnit(w,t,q),q,x,B)};a.formatMetricLength=function(v,w,t,x=2,B="abbr"){const q=n.preferredMetricLengthUnit(w,t);return f(v,n.convertUnit(w,
t,q),q,x,B)};a.formatMetricRelativeLength=function(v,w,t,x=2,B="abbr"){const q=n.preferredMetricLengthUnit(w,t);return d(v,n.convertUnit(w,t,q),q,x,B)};a.formatMetricRelativeVerticalLength=function(v,w,t,x=2,B="abbr"){const q=n.preferredMetricVerticalLengthUnit(w,t);return d(v,n.convertUnit(w,t,q),q,x,B)};a.formatMetricVerticalLength=function(v,w,t,x=2,B="abbr"){const q=n.preferredMetricVerticalLengthUnit(w,t);return f(v,n.convertUnit(w,t,q),q,x,B)};a.formatRelativeAngleDegrees=function(v,w,t,x,B){t!==
x&&(v=-v);v=n.convertUnit(v,w,"degrees")%360;B=l.unwrapOr(B,2);return g.formatNumber(v,{style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:B,minimumFractionDigits:B,signDisplay:"exceptZero"})};a.formatRelativeDecimal=d;a.unitName=k;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Attachments/AttachmentsViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../core/Accessor ../../core/Collection ../../core/Error ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../rest/query/support/AttachmentInfo ../../rest/support/AttachmentQuery ../Feature/support/featureUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t){const x={editing:!1,operations:{add:!0,update:!0,delete:!0}},B=l.ofType(v);m=function(q){function u(z){var A=q.call(this,z)||this;A._getAttachmentsPromise=null;A._attachmentLayer=null;A.abilities={...x};A.activeAttachmentInfo=null;A.attachmentInfos=new B;A.graphic=null;A.mode="view";A.own(g.watch(()=>A.graphic,()=>A._graphicChanged(),g.initial));return A}a._inheritsLoose(u,q);var C=u.prototype;C.destroy=function(){this.graphic=this._attachmentLayer=null};
C.castAbilities=function(z){return{...x,...z}};C.getAttachments=function(){var z=a._asyncToGenerator(function*(){const {_attachmentLayer:A,attachmentInfos:p}=this;if(!A||"function"!==typeof A.queryAttachments)throw new r("invalid-layer","getAttachments(): A valid layer is required.");const y=this._getFeatureId();var D=new w({objectIds:[y],returnMetadata:!0});const E=[];this._getAttachmentsPromise=D=A.queryAttachments(D).then(F=>F[y]||E).catch(()=>E);this.notifyChange("state");D=yield D;p.removeAll();
D.length&&p.addMany(D);this._getAttachmentsPromise=null;this.notifyChange("state");return D});return function(){return z.apply(this,arguments)}}();C.addAttachment=function(){var z=a._asyncToGenerator(function*(A){const {_attachmentLayer:p,attachmentInfos:y,graphic:D,abilities:E}=this;if(!A)throw new r("invalid-attachment","addAttachment(): An attachment is required.",{attachment:A});if(!E.operations.add)throw new r("invalid-abilities","addAttachment(): add abilities are required.");if(!p||"function"!==
typeof p.addAttachment)throw new r("invalid-layer","addAttachment(): A valid layer is required.");A=yield p.addAttachment(D,A).then(F=>this._queryAttachment(F.objectId));y.add(A);return A});return function(A){return z.apply(this,arguments)}}();C.deleteAttachment=function(){var z=a._asyncToGenerator(function*(A){const {_attachmentLayer:p,attachmentInfos:y,graphic:D,abilities:E}=this;if(!A)throw new r("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:A});
if(!E.operations.delete)throw new r("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!p||"function"!==typeof p.deleteAttachments)throw new r("invalid-layer","deleteAttachment(): A valid layer is required.");const F=yield p.deleteAttachments(D,[A.id]).then(()=>A);y.remove(F);return F});return function(A){return z.apply(this,arguments)}}();C.updateAttachment=function(){var z=a._asyncToGenerator(function*(A,p=this.activeAttachmentInfo){const {_attachmentLayer:y,attachmentInfos:D,
graphic:E,abilities:F}=this;if(!A)throw new r("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:A});if(!p)throw new r("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:p});if(!F.operations.update)throw new r("invalid-abilities","updateAttachment(): Update abilities are required.");const G=D.findIndex(P=>P===p);if(!y||"function"!==typeof y.updateAttachment)throw new r("invalid-layer","updateAttachment(): A valid layer is required.");
A=yield y.updateAttachment(E,p.id,A).then(P=>this._queryAttachment(P.objectId));D.splice(G,1,A);return A});return function(A){return z.apply(this,arguments)}}();C._queryAttachment=function(){var z=a._asyncToGenerator(function*(A){if(!A)throw new r("invalid-attachment-id","Could not query attachment.");const {_attachmentLayer:p}=this,y=this._getFeatureId();A=new w({objectIds:[y],attachmentsWhere:`AttachmentId=${A}`,returnMetadata:!0});return p.queryAttachments(A).then(D=>D[y][0])});return function(A){return z.apply(this,
arguments)}}();C._getFeatureId=function(){const {_attachmentLayer:z,graphic:A}=this;if(!z||!A)return null;const {objectIdField:p}=z,{attributes:y}=A;return y&&y[p]};C._graphicChanged=function(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))};C._setAttachmentLayer=function(){var {graphic:z}=this;this._attachmentLayer=(z=t.getSourceLayer(z))?"scene"===z.type&&n.isSome(z.associatedLayer)?z.associatedLayer:z:null};a._createClass(u,[{key:"state",get:function(){return this._getAttachmentsPromise?
"loading":this.graphic?"ready":"disabled"}},{key:"supportsResizeAttachments",get:function(){return this.get("graphic.layer.capabilities.operations.supportsResizeAttachments")||!1}}]);return u}(m);b.__decorate([k.property()],m.prototype,"abilities",void 0);b.__decorate([e.cast("abilities")],m.prototype,"castAbilities",null);b.__decorate([k.property()],m.prototype,"activeAttachmentInfo",void 0);b.__decorate([k.property({readOnly:!0,type:B})],m.prototype,"attachmentInfos",void 0);b.__decorate([k.property({type:c})],
m.prototype,"graphic",void 0);b.__decorate([k.property()],m.prototype,"mode",void 0);b.__decorate([k.property({readOnly:!0})],m.prototype,"state",null);b.__decorate([k.property({readOnly:!0})],m.prototype,"supportsResizeAttachments",null);return m=b.__decorate([h.subclass("esri.widgets.Attachments.AttachmentsViewModel")],m)})},"esri/widgets/Feature/support/featureUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../intl ../../../core/Logger ../../../core/maybe ../../../core/string ../../../intl/date ../../../intl/number ../../../layers/support/fieldUtils ../../../popup/support/FieldInfoFormat ../../../support/arcadeOnDemand".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){function e(){e=b._asyncToGenerator(function*(ca,ha){return"function"===typeof ca?ca.call(null,ha):ca});return e.apply(this,arguments)}function h(ca){return ca?S.test(ca):!1}function v(ca,ha){if(!h(ha)||!ca)return null;const ia=ha.replace(S,"").toLowerCase();let ka;ca.some(la=>la.name.toLowerCase()===ia?(ka=la,!0):!1);return ka}function w(ca,ha){return(ha=t(ha,ca))?ha.name:ca}function t(ca,ha){return ca&&"function"===typeof ca.getField?ca.getField(ha):null}function x({formattedAttributes:ca,
template:ha,fieldInfoMap:ia}){return`${r.replace(r.replace(ha,ka=>{{const la=ia.get(ka.toLowerCase());ka=`{${la&&la.fieldName||ka}}`}return ka}),ca).replace(I,"")}`.trim()}function B(ca,ha,ia=!1){const ka=ha[ca];"string"===typeof ka&&(ia=(ia?encodeURIComponent(ka):ka).replace(Q,"%27"),ha[ca]=ia)}function q(ca,ha=!1){const ia={...ca};Object.keys(ia).forEach(ka=>B(ka,ia,ha));return ia}function u(ca,ha){return ca.replace(O,(ia,ka,la)=>(ia=t(ha,la))?`{${ia.name}}`:ka)}function C(ca,ha,ia){return(ca=u(ca,
ia))?ca.replace(aa,(ka,la,Y)=>{la=`${la||Y}`.trim();return r.replace(ka,q(ha,la&&"{"!==la[0]))}):ca}function z(ca,ha){var ia=ha.fieldName,ka=A(ha.fieldInfos,ia),la=null==ka?void 0:ka.clone();ka=ha.preventPlacesFormatting;ha=ha.layer;var Y=t(ha,ia);if(la&&"date"===(null==Y?void 0:Y.type)){Y=la.format||new f;Y.dateFormat=Y.dateFormat||"short-date-short-time";var ea;if(!(ea=!(null!=ha&&ha.layer)&&"feature"===(null==ha?void 0:ha.type)&&ha.datesInUnknownTimezone)){if(ea=!(null==ha||!ha.layer))ea=ha.layer,
ea="map-image"===(null==ea?void 0:ea.type);ea=ea&&ha.layer.datesInUnknownTimezone}Y.dateTimeFormatOptions=ea?{timeZone:"UTC"}:null;la.format=Y}la=la&&la.format;if("string"===typeof ca&&k.isRasterPixelValueField(ia)&&la)return la.formatRasterPixelValue(ca);"string"!==typeof ca||!la||null!=la.dateFormat||null==la.places&&null==la.digitSeparator||(ia=Number(ca),isNaN(ia)||(ca=ia));return"string"===typeof ca||null==ca||null==la?D(ca):ka?g.formatNumber(ca,{...g.convertNumberFormatToIntlOptions(la),minimumFractionDigits:0,
maximumFractionDigits:20}):la.format(ca)}function A(ca,ha){if(ca&&ca.length&&ha){var ia=ha.toLowerCase(),ka=void 0;ca.some(la=>la.fieldName&&la.fieldName.toLowerCase()===ia?(ka=la,!0):!1);return ka}}function p({fieldName:ca,graphic:ha,layer:ia}){if(M(ca)||!ia||"function"!==typeof ia.getFeatureType)return null;const {typeIdField:ka}=ia;return ka&&ca===ka?(ca=ia.getFeatureType(ha))?ca.name:null:null}function y({fieldName:ca,value:ha,graphic:ia,layer:ka}){return M(ca)||!ka||"function"!==typeof ka.getFieldDomain?
null:(ca=ka.getFieldDomain(ca,{feature:ia}))&&"coded-value"===ca.type?ca.getName(ha):null}function D(ca){return"string"===typeof ca?ca.replace(T,'\x3cbr class\x3d"esri-text-new-line" /\x3e'):ca}function E(ca){const {value:ha,fieldName:ia,fieldInfos:ka,fieldInfoMap:la,layer:Y,graphic:ea}=ca;return null==ha?"":(ca=y({fieldName:ia,value:ha,graphic:ea,layer:Y}))||(ca=p({fieldName:ia,graphic:ea,layer:Y}))?ca:la.get(ia.toLowerCase())?z(ha,{fieldInfos:ka||Array.from(la.values()),fieldName:ia,layer:Y}):(ca=
Y&&Y.fieldsIndex)&&ca.isDateField(ia)?n.formatDate(ha,R):D(ha)}function F(ca,ha){return G.apply(this,arguments)}function G(){G=b._asyncToGenerator(function*(ca,ha){var ia,ka;const {layer:la,graphic:Y,outFields:ea,objectIds:ba,returnGeometry:Z,spatialReference:fa}=ca;ca=ba[0];if("number"!==typeof ca&&"string"!==typeof ca)return H.warn("Could not query required fields for the specified feature. The feature's ID is invalid.",{layer:la,graphic:Y,objectId:ca,requiredFields:ea}),null;if(null==(ia=la.capabilities)||
null==(ka=ia.operations)||!ka.supportsQuery)return H.warn("The specified layer cannot be queried. The following fields will not be available.",{layer:la,graphic:Y,requiredFields:ea,returnGeometry:Z}),null;ia=la.createQuery();ia.objectIds=ba;ia.outFields=null!=ea&&ea.length?ea:[la.objectIdField];ia.returnGeometry=!!Z;ia.returnZ=!!Z;ia.returnM=!!Z;ia.outSpatialReference=fa;return(yield la.queryFeatures(ia,ha)).features[0]});return G.apply(this,arguments)}function P(ca){return K.apply(this,arguments)}
function K(){K=b._asyncToGenerator(function*(ca){var ha;if(null==(ha=ca.expressionInfos)||!ha.length)return!1;ha=yield d.loadArcade();({arcadeUtils:{hasGeometryFunctions:ha}}=ha);return ha(ca)});return K.apply(this,arguments)}function N(){N=b._asyncToGenerator(function*({graphic:ca,popupTemplate:ha,layer:ia,spatialReference:ka},la){if(ia&&ha&&("function"===typeof ia.load&&(yield ia.load(la)),ca.attributes)){var Y=ca.attributes[ia.objectIdField];if(null!=Y){Y=[Y];var ea=yield ha.getRequiredFields(ia.fieldsIndex),
ba=k.featureHasFields(ea,ca);ea=ba?[]:ea;ha=ha.returnGeometry||(yield P(ha));if(!ba||ha)if(ia=yield F({layer:ia,graphic:ca,outFields:ea,objectIds:Y,returnGeometry:ha,spatialReference:ka},la))ia.geometry&&(ca.geometry=ia.geometry),ia.attributes&&(ca.attributes={...ca.attributes,...ia.attributes})}}});return N.apply(this,arguments)}function M(ca=""){return ca?ca.includes("relationships/"):!1}function L({attributes:ca,graphic:ha,relatedInfo:ia,fieldInfos:ka,fieldInfoMap:la,layer:Y}){ca&&ha&&ia&&Object.keys(ha.attributes).forEach(ea=>
{var ba=(ba={layerId:ia.relation.id.toString(),fieldName:ea},`${"relationships/"}${ba.layerId}/${ba.fieldName}`);ca[ba]=E({fieldName:ba,fieldInfos:ka,fieldInfoMap:la,layer:Y,value:ha.attributes[ea],graphic:ha})})}function J({attributes:ca,relatedInfo:ha,fieldInfoMap:ia,fieldInfos:ka,layer:la}){ca&&ha&&(ha.relatedFeatures&&ha.relatedFeatures&&ha.relatedFeatures.forEach(Y=>L({attributes:ca,graphic:Y,relatedInfo:ha,fieldInfoMap:ia,fieldInfos:ka,layer:la})),ha.relatedStatsFeatures&&ha.relatedStatsFeatures&&
ha.relatedStatsFeatures.forEach(Y=>L({attributes:ca,graphic:Y,relatedInfo:ha,fieldInfoMap:ia,fieldInfos:ka,layer:la})))}const H=m.getLogger("esri.widgets.Feature.support.featureUtils"),I=/href=(""|'')/gi,O=/(\{([^\{\r\n]+)\})/g,Q=/'/g,S=/^\s*expression\//i,T=/(\n)/gi,U=/[\u00A0-\u9999<>&]/gim,aa=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,W=/^(?:mailto:|tel:)/,R=n.convertDateFormatToIntlOptions("short-date-short-time"),V=ca=>{if(!ca)return!1;ca=ca.toUpperCase();return ca.includes("CURRENT_TIMESTAMP")||
ca.includes("CURRENT_DATE")||ca.includes("CURRENT_TIME")},da=({layer:ca,method:ha,query:ia,definitionExpression:ka})=>{var la,Y;null!=(la=ca.capabilities)&&null!=(Y=la.query)&&Y.supportsCacheHint&&"attachments"!==ha&&(ca=l.isSome(ia.where)&&ia.where,ha=l.isSome(ia.geometry)&&ia.geometry,V(ka)||V(ca)||"extent"===(null==ha?void 0:ha.type)||"tile"===ia.resultType||(ia.cacheHint=!0))};a.applyTextFormattingHTML=D;a.createfieldInfoMap=function(ca,ha){const ia=new Map;ca&&ca.forEach(ka=>{const la=w(ka.fieldName,
ha);ka.fieldName=la;ia.set(la.toLowerCase(),ka)});return ia};a.fixTokens=u;a.formatAttributes=function({fieldInfos:ca,attributes:ha,layer:ia,graphic:ka,fieldInfoMap:la,relatedInfos:Y}){const ea={};null==Y?void 0:Y.forEach(ba=>J({attributes:ea,relatedInfo:ba,fieldInfoMap:la,fieldInfos:ca,layer:ia}));Object.keys(ha).forEach(ba=>{ea[ba]=E({fieldName:ba,fieldInfos:ca,fieldInfoMap:la,layer:ia,value:ha[ba],graphic:ka})});return ea};a.formatEditInfo=function(ca,ha){const {creatorField:ia,creationDateField:ka,
editorField:la,editDateField:Y}=ca;if(ha){ca=ha[Y];if("number"===typeof ca)return ha=ha[la],{type:"edit",date:n.formatDate(ca,R),user:ha};ca=ha[ka];return"number"===typeof ca?(ha=ha[ia],{type:"create",date:n.formatDate(ca,R),user:ha}):null}};a.formatValueToFieldInfo=z;a.getAllFieldInfos=function(ca){const ha=[];if(!ca)return ha;const {fieldInfos:ia,content:ka}=ca;ia&&ha.push(...ia);if(!ka||!Array.isArray(ka))return ha;ka.forEach(la=>{"fields"===la.type&&(la=la&&la.fieldInfos)&&ha.push(...la)});return ha};
a.getFieldInfo=A;a.getFieldInfoLabel=function(ca,ha){return(ha=v(ha,null==ca?void 0:ca.fieldName))?ha.title||null:ca?ca.label||ca.fieldName:null};a.getFixedFieldName=w;a.getFixedFieldNames=function(ca,ha){return ca&&ca.map(ia=>w(ia,ha))};a.getSourceLayer=function(ca){if(!l.isNone(ca))return ca.get("sourceLayer")||ca.get("layer")};a.graphicCallback=function(ca,ha){return e.apply(this,arguments)};a.htmlEntities=function(ca){return ca.replace(U,ha=>`&#${ha.charCodeAt(0)};`)};a.isExpressionField=h;a.isRelatedField=
M;a.preLayerQueryCallback=({query:ca,layer:ha,method:ia})=>{da({layer:ha,method:ia,query:ca,definitionExpression:`${ha.definitionExpression} ${ha.serviceDefinitionExpression}`})};a.preRequestCallback=({queryPayload:ca,layer:ha,method:ia})=>{da({layer:ha,method:ia,query:ca,definitionExpression:`${ha.definitionExpression} ${ha.serviceDefinitionExpression}`})};a.queryUpdatedFeature=function(ca,ha){return N.apply(this,arguments)};a.shouldOpenInNewTab=function(ca=""){if(ca)return!W.test(ca.trim().toLowerCase())};
a.substituteAttributes=x;a.substituteFieldsInLinksAndAttributes=function({attributes:ca,globalAttributes:ha,layer:ia,text:ka,expressionAttributes:la,fieldInfoMap:Y}){return ka?x({formattedAttributes:ha,template:C(ka,{...ha,...la,...ca},ia),fieldInfoMap:Y}):""};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Attachments/support/attachmentUtils":function(){define(["exports","../../../assets"],function(a,b){a.getIconPath=function(c){const m=b.getAssetUrl("esri/themes/base/images/files/");
return c?"text/plain"===c?`${m}text-32.svg`:"application/pdf"===c?`${m}pdf-32.svg`:"text/csv"===c?`${m}csv-32.svg`:"application/gpx+xml"===c?`${m}gpx-32.svg`:"application/x-dwf"===c?`${m}cad-32.svg`:"application/postscript"===c||"application/json"===c||"text/xml"===c||"model/vrml"===c?`${m}code-32.svg`:"application/x-zip-compressed"===c||"application/x-7z-compressed"===c||"application/x-gzip"===c||"application/x-tar"===c||"application/x-gtar"===c||"application/x-bzip2"===c||"application/gzip"===c||
"application/x-compress"===c||"application/x-apple-diskimage"===c||"application/x-rar-compressed"===c||"application/zip"===c?`${m}zip-32.svg`:c.includes("image/")?`${m}image-32.svg`:c.includes("audio/")?`${m}sound-32.svg`:c.includes("video/")?`${m}video-32.svg`:c.includes("msexcel")||c.includes("ms-excel")||c.includes("spreadsheetml")?`${m}excel-32.svg`:c.includes("msword")||c.includes("ms-word")||c.includes("wordprocessingml")?`${m}word-32.svg`:c.includes("powerpoint")||c.includes("presentationml")?
`${m}report-32.svg`:`${m}generic-32.svg`:`${m}generic-32.svg`};a.isSupportedImage=function(c){c=c.toLowerCase();return"image/bmp"===c||"image/emf"===c||"image/exif"===c||"image/gif"===c||"image/x-icon"===c||"image/jpeg"===c||"image/png"===c||"image/tiff"===c||"image/x-wmf"===c};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Feature/FeatureAttachments/FeatureAttachmentsViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../Attachments/AttachmentsViewModel".split(" "),
function(a,b,c,m,l,r,n,g){m=function(k){function f(d){d=k.call(this,d)||this;d.description=null;d.title=null;return d}a._inheritsLoose(f,k);return f}(g);b.__decorate([c.property()],m.prototype,"description",void 0);b.__decorate([c.property()],m.prototype,"title",void 0);return m=b.__decorate([n.subclass("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],m)})},"esri/widgets/Feature/support/FeatureElementInfo":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../Widget ../../support/Heading ../../support/widgetUtils ../../support/jsxFactory".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){m=function(e){function h(w,t){w=e.call(this,w,t)||this;w.description=null;w.headingLevel=2;w.title=null;return w}a._inheritsLoose(h,e);var v=h.prototype;v.render=function(){return d.tsx("div",{class:"esri-feature-element-info"},this.renderTitle(),this.renderDescription())};v.renderTitle=function(){const {title:w}=this;return w?d.tsx(k.Heading,{level:this.headingLevel,class:"esri-feature-element-info__title"},w):null};v.renderDescription=function(){const {description:w}=
this;return w?d.tsx("div",{key:"description",class:"esri-feature-element-info__description"},w):null};return h}(g);b.__decorate([c.property()],m.prototype,"description",void 0);b.__decorate([c.property()],m.prototype,"headingLevel",void 0);b.__decorate([c.property()],m.prototype,"title",void 0);return m=b.__decorate([n.subclass("esri.widgets.Feature.support.FeatureElementInfo")],m)})},"esri/widgets/support/Heading":function(){define(["exports","../../core/mathUtils","./widgetUtils","./jsxFactory"],
function(a,b,c,m){const l={heading:"esri-widget__heading"};a.CSS=l;a.Heading=function(r,n){const g=b.clamp(Math.ceil(r.level),1,6),k=`h${g}`;delete r.level;return m.tsx(k,{...r,class:c.classes(l.heading,r.class),role:"heading","aria-level":String(g)},n)};a.incrementHeadingLevel=function(r,n=1){return b.clamp(Math.ceil(r+n),1,6)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Feature/FeatureContent":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/aliasOf ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureContent/FeatureContentViewModel ./support/featureUtils ../support/widget ../support/jsxFactory".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h){m=function(v){function w(x,B){x=v.call(this,x,B)||this;x.creator=null;x.graphic=null;x.viewModel=null;x._addTargetToAnchors=q=>{Array.from(q.querySelectorAll("a")).forEach(u=>{d.shouldOpenInNewTab(u.href)&&!u.hasAttribute("target")&&u.setAttribute("target","_blank")})};return x}a._inheritsLoose(w,v);var t=w.prototype;t.renderLoading=function(){return h.tsx("div",{class:"esri-feature-content__loader-container",key:"loader"},h.tsx("div",{class:"esri-feature-content__loader"}))};
t.renderCreated=function(){var x;const B=null==(x=this.viewModel)?void 0:x.created;return B?B instanceof HTMLElement?h.tsx("div",{key:B,bind:B,afterCreate:this._attachToNode}):e.isWidget(B)?h.tsx("div",{key:B},!B.destroyed&&B.render()):h.tsx("div",{key:B,innerHTML:B,afterCreate:this._addTargetToAnchors}):null};t.render=function(){var x;const B=null==(x=this.viewModel)?void 0:x.state;return h.tsx("div",{class:"esri-feature-content"},"loading"===B?this.renderLoading():this.renderCreated())};t._attachToNode=
function(x){x.appendChild(this)};return w}(k);b.__decorate([c.aliasOf("viewModel.creator")],m.prototype,"creator",void 0);b.__decorate([c.aliasOf("viewModel.graphic")],m.prototype,"graphic",void 0);b.__decorate([n.property({type:f})],m.prototype,"viewModel",void 0);return m=b.__decorate([g.subclass("esri.widgets.Feature.FeatureContent")],m)})},"esri/widgets/Feature/FeatureContent/FeatureContentViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Accessor ../../../core/HandleOwner ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../support/featureUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e){m=function(h){function v(t){var x=h.call(this,t)||this;x._loadingPromise=null;x.created=null;x.creator=null;x.destroyer=null;x.graphic=null;x.handles.add(r.watch(()=>x.creator,B=>{x._destroyContent();x._createContent(B)},r.initial));return x}a._inheritsLoose(v,h);var w=v.prototype;w.destroy=function(){this._destroyContent()};w._destroyContent=function(){const {created:t,graphic:x,destroyer:B}=this;t&&(e.graphicCallback(B,{graphic:x}).catch(()=>null),this._set("created",
null))};w._createContent=function(){var t=a._asyncToGenerator(function*(x){var {graphic:B}=this;this._loadingPromise=x=e.graphicCallback(x,{graphic:B}).catch(()=>null);this.notifyChange("state");B=yield x;x===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",B))});return function(x){return t.apply(this,arguments)}}();a._createClass(v,[{key:"state",get:function(){return this._loadingPromise?"loading":"ready"}}]);return v}(l.HandleOwnerMixin(m));b.__decorate([n.property({readOnly:!0})],
m.prototype,"created",void 0);b.__decorate([n.property()],m.prototype,"creator",void 0);b.__decorate([n.property()],m.prototype,"destroyer",void 0);b.__decorate([n.property({type:c})],m.prototype,"graphic",void 0);b.__decorate([n.property({readOnly:!0})],m.prototype,"state",null);return m=b.__decorate([d.subclass("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],m)})},"esri/widgets/Feature/FeatureExpression":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureContent ./FeatureFields ./FeatureMedia ./FeatureExpression/FeatureExpressionViewModel ../support/widgetUtils ../support/jsxFactory".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w){l=function(t){function x(q,u){q=t.call(this,q,u)||this;q.viewModel=new h;return q}a._inheritsLoose(x,t);var B=x.prototype;B.initialize=function(){this.own(c.watch(()=>{var q;return null==(q=this.viewModel)?void 0:q.contentElementViewModel},()=>this._setupExpressionWidget(),c.initial))};B.destroy=function(){this._destroyContentWidget()};B.renderLoading=function(){return w.tsx("div",{key:"loading-container",class:"esri-feature__loading-container"},w.tsx("span",
{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")}))};B.render=function(){var q;const {state:u}=this.viewModel;return w.tsx("div",{class:"esri-feature-expression"},"loading"===u?this.renderLoading():"disabled"===u?null:null==(q=this._contentWidget)?void 0:q.render())};B._destroyContentWidget=function(){const {_contentWidget:q}=this;q&&(q.viewModel=null,q.destroy());this._contentWidget=null};B._setupExpressionWidget=function(){const {contentElementViewModel:q,
contentElement:u}=this.viewModel,C=null==u?void 0:u.type;this._destroyContentWidget();this._contentWidget=q?"fields"===C?new d({viewModel:q}):"media"===C?new e({viewModel:q}):"text"===C?new f({viewModel:q}):null:null;this.scheduleRender()};return x}(k);b.__decorate([m.property({type:h})],l.prototype,"viewModel",void 0);return l=b.__decorate([g.subclass("esri.widgets.Feature.FeatureExpression")],l)})},"esri/widgets/Feature/FeatureFields":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/reactiveUtils ../../core/accessorSupport/decorators/aliasOf ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureFields/FeatureFieldsViewModel ./support/FeatureElementInfo ../support/uriUtils ../support/widgetUtils ../support/decorators/messageBundle ../support/jsxFactory".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t){l=function(x){function B(u,C){u=x.call(this,u,C)||this;u._featureElementInfo=null;u.attributes=null;u.description=null;u.expressionInfos=null;u.fieldInfos=null;u.title=null;u.viewModel=new d;u.messages=null;u.messagesURIUtils=null;return u}a._inheritsLoose(B,x);var q=B.prototype;q.initialize=function(){this._featureElementInfo=new e;this.own(c.watch(()=>{var u,C;return[null==(u=this.viewModel)?void 0:u.description,null==(C=this.viewModel)?void 0:C.title]},
()=>this._setupFeatureElementInfo(),c.initial))};q.destroy=function(){this._featureElementInfo.destroy()};q.renderFieldInfo=function(u,C){var {attributes:z}=this.viewModel;const A=u.fieldName,p=u.label||A;z=z?null==z[A]?"":z[A]:"";u=!(!u.format||!u.format.dateFormat);z="number"!==typeof z||u?h.autoLink(this.messagesURIUtils,z):this._forceLTR(z);u={["esri-feature-fields__field-data--date"]:u};return t.tsx("tr",{key:`fields-element-info-row-${A}-${C}`},t.tsx("th",{key:`fields-element-info-row-header-${A}-${C}`,
class:"esri-feature-fields__field-header",innerHTML:p}),t.tsx("td",{key:`fields-element-info-row-data-${A}-${C}`,class:this.classes("esri-feature-fields__field-data",u),innerHTML:z}))};q.renderFields=function(){const {formattedFieldInfos:u}=this.viewModel;return null!=u&&u.length?t.tsx("table",{class:"esri-widget__table",summary:this.messages.fieldsSummary},t.tsx("tbody",null,u.map((C,z)=>this.renderFieldInfo(C,z)))):null};q.render=function(){var u;return t.tsx("div",{class:"esri-feature-fields"},
null==(u=this._featureElementInfo)?void 0:u.render(),this.renderFields())};q._setupFeatureElementInfo=function(){const {description:u,title:C}=this;this._featureElementInfo.set({description:u,title:C})};q._forceLTR=function(u){return`&lrm;${u}`};return B}(f);b.__decorate([m.aliasOf("viewModel.attributes")],l.prototype,"attributes",void 0);b.__decorate([m.aliasOf("viewModel.description")],l.prototype,"description",void 0);b.__decorate([m.aliasOf("viewModel.expressionInfos")],l.prototype,"expressionInfos",
void 0);b.__decorate([m.aliasOf("viewModel.fieldInfos")],l.prototype,"fieldInfos",void 0);b.__decorate([m.aliasOf("viewModel.title")],l.prototype,"title",void 0);b.__decorate([g.property({type:d})],l.prototype,"viewModel",void 0);b.__decorate([g.property(),w.messageBundle("esri/widgets/Feature/t9n/Feature")],l.prototype,"messages",void 0);b.__decorate([g.property(),w.messageBundle("esri/widgets/support/t9n/uriUtils")],l.prototype,"messagesURIUtils",void 0);return l=b.__decorate([k.subclass("esri.widgets.Feature.FeatureFields")],
l)})},"esri/widgets/Feature/FeatureFields/FeatureFieldsViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../popup/ExpressionInfo ../../../popup/FieldInfo ../support/featureUtils".split(" "),function(a,b,c,m,l,r,n,g,k,f,d){c=function(e){function h(v){v=
e.call(this,v)||this;v.attributes=null;v.expressionInfos=null;v.description=null;v.fieldInfos=null;v.title=null;return v}a._inheritsLoose(h,e);a._createClass(h,[{key:"formattedFieldInfos",get:function(){const {expressionInfos:v,fieldInfos:w}=this,t=[];null==w?void 0:w.forEach(x=>{if(!x.hasOwnProperty("visible")||x.visible)x=x.clone(),x.label=d.getFieldInfoLabel(x,v),t.push(x)});return t}}]);return h}(c);b.__decorate([m.property()],c.prototype,"attributes",void 0);b.__decorate([m.property({type:[k]})],
c.prototype,"expressionInfos",void 0);b.__decorate([m.property()],c.prototype,"description",void 0);b.__decorate([m.property({type:[f]})],c.prototype,"fieldInfos",void 0);b.__decorate([m.property({readOnly:!0})],c.prototype,"formattedFieldInfos",null);b.__decorate([m.property()],c.prototype,"title",void 0);return c=b.__decorate([g.subclass("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],c)})},"esri/widgets/support/uriUtils":function(){define(["exports","../../core/string"],function(a,
b){function c(l){let r=null;m.some(n=>{n.pattern.test(l)&&(r=n);return!!r});return r}const m=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},
{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},
{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];a.autoLink=function(l,r){if("string"!==typeof r||!r)return r;const n=c(r);if(!n)return r;const g=r.match(n.pattern);l=b.replace(b.replace(n.label,
{messages:l,hierPart:g&&g[2]}),{appName:n.appName});return r.replace(n.pattern,`<a${n.target?` target="${n.target}"`:""} href="$1"${"_blank"===n.target?' rel\x3d"noreferrer"':""}>${l}</a>`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Feature/FeatureMedia":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/events ../../core/reactiveUtils ../../core/accessorSupport/decorators/aliasOf ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ../../renderers/support/utils ../Widget ./FeatureMedia/FeatureMediaViewModel ./support/FeatureElementInfo ./support/featureUtils ../support/chartUtils ../support/widgetUtils ../support/decorators/messageBundle ../support/jsxFactory ../../support/themeUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u){r=function(C){function z(p,y){var D=C.call(this,p,y)||this;D._refreshTimer=null;D._refreshIntervalInfo=null;D._featureElementInfo=null;D.attributes=null;D.activeMediaInfoIndex=null;D.description=null;D.fieldInfoMap=null;D.layer=null;D.mediaInfos=null;D.popupTemplate=null;D.relatedInfos=null;D.title=null;D.viewModel=new h;D.messages=null;D._getChartDependencies=function(){var E=a._asyncToGenerator(function*(F){const G=yield t.loadChartsModule(),{destroyed:P,
viewModel:K}=a._assertThisInitialized(D);if(!P&&K&&F){var {activeMediaInfo:N}=K,M=yield D._getRendererColors(G);D._renderChart({chartDiv:F,mediaInfo:N,chartsModule:G,colorMap:M})}});return function(F){return E.apply(this,arguments)}}();return D}a._inheritsLoose(z,C);var A=z.prototype;A.initialize=function(){this._featureElementInfo=new v;this.own([m.watch(()=>{var p,y;return[null==(p=this.viewModel)?void 0:p.activeMediaInfo,null==(y=this.viewModel)?void 0:y.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),
m.initial),m.watch(()=>{var p,y;return[null==(p=this.viewModel)?void 0:p.description,null==(y=this.viewModel)?void 0:y.title]},()=>this._setupFeatureElementInfo(),m.initial)])};A.destroy=function(){this._clearMediaRefreshTimer();this._featureElementInfo.destroy()};A.render=function(){var p;return q.tsx("div",{bind:this,class:"esri-feature-media",onkeyup:this._handleMediaKeyup},null==(p=this._featureElementInfo)?void 0:p.render(),this.renderMedia())};A.renderMedia=function(){const {formattedMediaInfoCount:p}=
this.viewModel;return p?q.tsx("div",{key:"media-element-container",class:"esri-feature-media__container"},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null};A.renderImageMediaInfo=function(p){var {_refreshIntervalInfo:y}=this;const {activeMediaInfoIndex:D,formattedMediaInfoCount:E}=this.viewModel,{value:F,refreshInterval:G,altText:P,title:K,type:N}=p,{sourceURL:M,linkURL:L}=F;p=w.shouldOpenInNewTab(L)?"_blank":"_self";const J="_blank"===p?"noreferrer":
"";y=G?y:null;y=q.tsx("img",{alt:P||K,key:`media-${N}-${D}-${E}-${y?y.timestamp:0}`,src:y?y.sourceURL:M});return(p=L?q.tsx("a",{title:K,href:L,rel:J,target:p},y):null)?p:y};A.renderChartMediaInfo=function(p){const {activeMediaInfoIndex:y,formattedMediaInfoCount:D}=this.viewModel;return q.tsx("div",{key:`media-${p.type}-${y}-${D}`,bind:this,class:"esri-feature-media__chart",afterCreate:this._getChartDependencies})};A.renderMediaInfoType=function(){const {activeMediaInfo:p}=this.viewModel;return p?
"image"===p.type?this.renderImageMediaInfo(p):p.type.includes("chart")?this.renderChartMediaInfo(p):null:null};A.renderMediaInfo=function(){var {activeMediaInfo:p}=this.viewModel;if(!p)return null;const y=p.title?q.tsx("div",{key:"media-title",class:"esri-feature-media__item-title",innerHTML:p.title}):null;p=p.caption?q.tsx("div",{key:"media-caption",class:"esri-feature-media__item-caption",innerHTML:p.caption}):null;return q.tsx("div",{key:"media-container",class:"esri-feature-media__item-container"},
q.tsx("div",{key:"media-item-container",class:"esri-feature-media__item"},this.renderMediaInfoType()),y,p)};A.renderMediaPageButton=function(p){if(2>this.viewModel.formattedMediaInfoCount)return null;const y=(p="previous"===p)?this.messages.previous:this.messages.next,D=p?this.classes("esri-feature-media__button","esri-feature-media__previous"):this.classes("esri-feature-media__button","esri-feature-media__next"),E=p?this.classes("esri-feature-media__icon","esri-feature-media__previous-icon","esri-icon-left-triangle-arrow"):
this.classes("esri-feature-media__icon","esri-feature-media__next-icon","esri-icon-right-triangle-arrow"),F=p?this.classes("esri-feature-media__icon","esri-feature-media__previous-icon--rtl","esri-icon-right-triangle-arrow"):this.classes("esri-feature-media__icon","esri-feature-media__next-icon--rtl","esri-icon-left-triangle-arrow");return q.tsx("button",{type:"button",key:p?"media-previous":"media-next",title:y,"aria-label":y,tabIndex:0,class:D,bind:this,onclick:p?this._previous:this._next},q.tsx("span",
{"aria-hidden":"true",class:E}),q.tsx("span",{"aria-hidden":"true",class:F}))};A._setupFeatureElementInfo=function(){const {description:p,title:y}=this;this._featureElementInfo.set({description:p,title:y})};A._next=function(){this.viewModel.next()};A._previous=function(){this.viewModel.previous()};A._getRendererColors=function(){var p=a._asyncToGenerator(function*(y){var D;const {am4core:E}=y;y=null==(D=this.viewModel)?void 0:D.layer;const F=new Map;if(!y)return F;const G=yield d.getColorsFromRenderer(y.renderer);
G.delete(null);if(!Array.from(G.values()).every(P=>1===(null==P?void 0:P.length)))return F;F.set("default-line-value",E.color({r:50,g:50,b:50,a:1}));Array.from(G.keys()).forEach(P=>{P&&F.set(P,E.color(G.get(P)[0].toCss(!0)))});return F});return function(y){return p.apply(this,arguments)}}();A._handleMediaKeyup=function(p){const y=c.eventKey(p);"ArrowLeft"===y&&(p.stopPropagation(),this.viewModel.previous());"ArrowRight"===y&&(p.stopPropagation(),this.viewModel.next())};A._renderChart=function(p){const {abilities:y}=
this.viewModel,{chartsModule:D,chartDiv:E,mediaInfo:F,colorMap:G}=p,{value:P,type:K}=F,{am4core:N}=D,M=t.getColorSet(N);u.isDarkTheme()&&N.useTheme(D.am4themes_dark);const L=window.matchMedia("(prefers-reduced-motion: reduce)");y.chartAnimation&&!L.matches?N.useTheme(D.am4themes_animated):N.unuseTheme(D.am4themes_animated);N.useTheme(function(J){J instanceof N.ColorSet&&M&&(J.list=M)});p="pie-chart"===K?this._createPieChart(p):this._createXYChart(p);E.setAttribute("aria-label",F.altText||F.title);
p.data=P.series.map(J=>({["tooltip"]:J.tooltip,["value"]:J.value,["color"]:G.get(J.fieldName)})).filter(J=>"pie-chart"===K?0<J.value:!0)};A._customizeChartTooltip=function(p,y){p.label.wrap=!0;p.label.maxWidth=200;p.autoTextColor=!1;p.getFillFromObject=!1;p.label.fill=y.color("#ffffff");p.background.fill=y.color({r:0,g:0,b:0,a:.7})};A._createPieChart=function(p){const {chartDiv:y,chartsModule:D}=p,{am4core:E,am4charts:F}=D;p=E.create(y,F.PieChart);p.rtl=x.isRTL(this.container);const G=p.series.push(new F.PieSeries);
G.labels.template.disabled=!0;G.ticks.template.disabled=!0;G.dataFields.value="value";G.dataFields.category="tooltip";this._customizeChartTooltip(G.tooltip,E);G.slices.template.tooltipText=p.rtl?"{category}: %{value.percent.formatNumber('#.0')}":"{category}: {value.percent.formatNumber('#.0')}%";G.slices.template.propertyFields.fill="color";G.slices.template.propertyFields.stroke="color";return p};A._getMinSeriesValue=function(p){let y=0;p.forEach(D=>y=Math.min(D.value,y));return y};A._createColumnChart=
function(p,y){const {chartsModule:D,mediaInfo:E}=y;({value:y}=E);const {am4core:F,am4charts:G}=D,P=p.xAxes.push(new G.CategoryAxis);P.dataFields.category="tooltip";P.renderer.labels.template.disabled=!0;this._customizeChartTooltip(P.tooltip,F);P.tooltip.events.on("sizechanged",()=>{P.tooltip.dy=-P.tooltip.contentHeight});var K=p.yAxes.push(new G.ValueAxis);const N=K.renderer.labels.template;K.renderer.minLabelPosition=.05;K.renderer.maxLabelPosition=.95;K.min=this._getMinSeriesValue(y.series);this._customizeChartTooltip(K.tooltip,
F);N.wrap=!0;K=p.series.push(new G.ColumnSeries);K.dataFields.valueY="value";K.dataFields.categoryX="tooltip";K.columns.template.propertyFields.fill="color";K.columns.template.propertyFields.stroke="color";p.cursor=new G.XYCursor;15<y.series.length&&(p.scrollbarX=new F.Scrollbar)};A._createBarChart=function(p,y){const {chartsModule:D,mediaInfo:E}=y;({value:y}=E);const {am4core:F,am4charts:G}=D,P=p.yAxes.push(new G.CategoryAxis);P.dataFields.category="tooltip";P.renderer.inversed=!0;P.renderer.labels.template.disabled=
!0;this._customizeChartTooltip(P.tooltip,F);P.tooltip.events.on("sizechanged",()=>{P.tooltip.dx=P.tooltip.contentWidth});var K=p.xAxes.push(new G.ValueAxis);const N=K.renderer.labels.template;K.renderer.minLabelPosition=.05;K.renderer.maxLabelPosition=.95;K.min=this._getMinSeriesValue(y.series);this._customizeChartTooltip(K.tooltip,F);N.wrap=!0;K=p.series.push(new G.ColumnSeries);K.dataFields.valueX="value";K.dataFields.categoryY="tooltip";K.columns.template.propertyFields.fill="color";K.columns.template.propertyFields.stroke=
"color";p.cursor=new G.XYCursor;15<y.series.length&&(p.scrollbarY=new F.Scrollbar)};A._createLineChart=function(p,y){const {chartsModule:D,mediaInfo:E,colorMap:F}=y;({value:y}=E);const {am4core:G,am4charts:P}=D,K=p.xAxes.push(new P.CategoryAxis);K.dataFields.category="tooltip";K.renderer.labels.template.disabled=!0;this._customizeChartTooltip(K.tooltip,G);K.tooltip.events.on("sizechanged",()=>{K.tooltip.dy=-K.tooltip.contentHeight});var N=p.yAxes.push(new P.ValueAxis),M=N.renderer.labels.template;
N.renderer.minLabelPosition=.05;N.renderer.maxLabelPosition=.95;N.min=this._getMinSeriesValue(y.series);this._customizeChartTooltip(N.tooltip,G);M.wrap=!0;N=p.series.push(new P.LineSeries);N.dataFields.categoryX="tooltip";N.dataFields.valueY="value";N.strokeWidth=1;if(M=F.get("default-line-value"))N.stroke=M;N=N.bullets.push(new P.CircleBullet);N.propertyFields.fill="color";N.propertyFields.stroke="color";p.cursor=new P.XYCursor;15<y.series.length&&(p.scrollbarX=new G.Scrollbar)};A._createXYChart=
function(p){const {chartDiv:y,chartsModule:D,mediaInfo:E}=p,{type:F}=E,{am4core:G,am4charts:P}=D,K=G.create(y,P.XYChart);K.rtl=x.isRTL(this.container);"column-chart"===F&&this._createColumnChart(K,p);"bar-chart"===F&&this._createBarChart(K,p);"line-chart"===F&&this._createLineChart(K,p);return K};A._clearMediaRefreshTimer=function(){const {_refreshTimer:p}=this;p&&(clearTimeout(p),this._refreshTimer=null)};A._updateMediaInfoTimestamp=function(p){const y=Date.now();this._refreshIntervalInfo={timestamp:y,
sourceURL:this._getImageSource(p,y)};this.scheduleRender()};A._setupMediaRefreshTimer=function(){this._clearMediaRefreshTimer();const {activeMediaInfo:p}=this.viewModel;p&&"image"===p.type&&p.refreshInterval&&this._setRefreshTimeout(p)};A._setRefreshTimeout=function(p){const {refreshInterval:y,value:D}=p;y&&(p=6E4*y,this._updateMediaInfoTimestamp(D.sourceURL),this._refreshTimer=setInterval(()=>{this._updateMediaInfoTimestamp(D.sourceURL)},p))};A._getImageSource=function(p,y){const D=p.includes("?")?
"\x26":"?",[E,F=""]=p.split("#");return`${E}${D}timestamp=${y}${F?"#":""}${F}`};return z}(e);b.__decorate([l.aliasOf("viewModel.attributes")],r.prototype,"attributes",void 0);b.__decorate([l.aliasOf("viewModel.activeMediaInfoIndex")],r.prototype,"activeMediaInfoIndex",void 0);b.__decorate([l.aliasOf("viewModel.description")],r.prototype,"description",void 0);b.__decorate([l.aliasOf("viewModel.fieldInfoMap")],r.prototype,"fieldInfoMap",void 0);b.__decorate([l.aliasOf("viewModel.layer")],r.prototype,
"layer",void 0);b.__decorate([l.aliasOf("viewModel.mediaInfos")],r.prototype,"mediaInfos",void 0);b.__decorate([l.aliasOf("viewModel.popupTemplate")],r.prototype,"popupTemplate",void 0);b.__decorate([l.aliasOf("viewModel.relatedInfos")],r.prototype,"relatedInfos",void 0);b.__decorate([l.aliasOf("viewModel.title")],r.prototype,"title",void 0);b.__decorate([k.property({type:h})],r.prototype,"viewModel",void 0);b.__decorate([k.property(),B.messageBundle("esri/widgets/Feature/t9n/Feature")],r.prototype,
"messages",void 0);return r=b.__decorate([f.subclass("esri.widgets.Feature.FeatureMedia")],r)})},"esri/renderers/support/utils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/arrayUtils ../../core/Logger ../../core/MapUtils ../../intl/date ./numberUtils ../visualVariables/support/ColorStop ../../symbols/support/utils ../../widgets/Legend/support/colorRampUtils ../../widgets/Legend/support/heatmapRampUtils".split(" "),function(a,b,c,m,l,r,n,g,k,f,d){function e(C,z,A){l.getOrCreateMapValue(C,
z,()=>[]).push(...A)}function h(){h=b._asyncToGenerator(function*(C){const z=new Map;if("visualVariables"in C&&C.visualVariables){var A=C.visualVariables.filter(D=>"color"===D.type);for(const D of A){A=D.field||D.valueExpression;const E=(yield f.getRampStops(D)).map(F=>F.color);e(z,A,E)}}if("heatmap"===C.type){var p=d.getHeatmapRampStops(C).map(D=>D.color);e(z,C.field,p)}else if("pie-chart"===C.type){for(const D of C.attributes)e(z,D.field,[D.color]);e(z,null,[null==C?void 0:null==(p=C.othersCategory)?
void 0:p.color,k.getColorFromSymbol(C.backgroundFillSymbol,null)])}else if("dot-density"===C.type){for(const D of C.attributes)e(z,D.field,[D.color]);e(z,null,[C.backgroundColor])}else if("unique-value"===C.type){var y;if("predominance"===(null==(y=C.authoringInfo)?void 0:y.type))for(const D of C.uniqueValueInfos)e(z,D.value.toString(),[k.getColorFromSymbol(D.symbol,null)]);else{p=C.uniqueValueInfos.map(P=>k.getColorFromSymbol(P.symbol,null));const {field:D,field2:E,field3:F,valueExpression:G}=C;
(D||G)&&e(z,D||G,p);E&&e(z,E,p);F&&e(z,F,p)}}else"class-breaks"===C.type?(p=C.classBreakInfos.map(D=>k.getColorFromSymbol(D.symbol,null)),e(z,C.field||C.valueExpression,p)):"simple"===C.type&&e(z,null,[k.getColorFromSymbol(C.symbol,null)]);"defaultSymbol"in C&&C.defaultSymbol&&e(z,null,[k.getColorFromSymbol(C.defaultSymbol,null)]);z.forEach((D,E)=>{D=c.unique(D.filter(Boolean),(F,G)=>JSON.stringify(F)===JSON.stringify(G));z.set(E,D)});return z});return h.apply(this,arguments)}function v(C,z,A){let p=
"";0===z?p=B.lt+" ":z===A&&(p=B.gt+" ");return p+C}function w(C){let z=C.minValue,A=C.maxValue;const p=C.isFirstBreak?"":B.gt+" ";C="percent-of-total"===C.normalizationType?B.pct:"";z=null==z?"":n.format(z);A=null==A?"":n.format(A);return p+z+C+" "+B.ld+" "+A+C}function t(C,z){return"normalizationField"in C&&C.normalizationField?{type:"normalized-field",field:C.field,normalizationField:C.normalizationField}:"field"in C&&C.field?{type:"field",field:C.field}:"valueExpression"in C&&C.valueExpression?
{type:"expression",expression:C.valueExpression,title:C.valueExpressionTitle,returnType:z}:null}const x=m.getLogger("esri.renderers.support.utils"),B={lte:"\x3c\x3d",gte:"\x3e\x3d",lt:"\x3c",gt:"\x3e",pct:"%",ld:"\u2013"},q={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},u={millisecond:"long-month-day-year-long-time",second:"long-month-day-year-long-time",minute:"long-month-day-year-short-time",hour:"long-month-day-year-short-time",day:"long-month-day-year",month:"long-month-day-year",
year:"year"};m=r.convertDateFormatToIntlOptions("short-date");a.calculateDateFormatInterval=function(C){C=C.map(D=>new Date(D));const z=C.length;let A=Infinity,p=null;for(let D=0;D<z-1;D++){const E=C[D];let F=Infinity,G=null;for(let P=D+1;P<z;P++){var y=C[P];y=E.getFullYear()!==y.getFullYear()&&"year"||E.getMonth()!==y.getMonth()&&"month"||E.getDate()!==y.getDate()&&"day"||E.getHours()!==y.getHours()&&"hour"||E.getMinutes()!==y.getMinutes()&&"minute"||E.getSeconds()!==y.getSeconds()&&"second"||"millisecond";
const K=q[y];K<F&&(F=K,G=y)}F<A&&(A=F,p=G)}return p};a.createClassBreakLabel=w;a.createColorStops=function(C){const {values:z,colors:A,labelIndexes:p,isDate:y,dateFormatOptions:D}=C;return z.map((E,F)=>{let G=null;if(!p||p.includes(F)){let P;(P=y?r.formatDate(E,D):n.format(E))&&(G=v(P,F,z.length-1))}return new g({value:E,color:A[F],label:G})})};a.createUniqueValueLabel=function(C){const {value:z,domain:A,fieldInfo:p,dateFormatInterval:y}=C;C=String(z);const D=A&&"codedValues"in A&&A.codedValues?A.getName(z):
null;D?C=D:"number"===typeof z&&(C=p&&"date"===p.type?r.formatDate(z,y&&r.convertDateFormatToIntlOptions(u[y])):n.format(z));return C};a.getAttribute=t;a.getAttributes=function(C,z){const A=[];if("class-breaks"===C.type||"heatmap"===C.type)A.push(t(C,"number"));else if("unique-value"===C.type){var p=C.authoringInfo;if(p&&"relationship"===p.type){if(p.field1&&p.field2){var y=p.field2.field;const D=p.field2.normalizationField;A.push(t({field:p.field1.field,normalizationField:p.field1.normalizationField}));
A.push(t({field:y,normalizationField:D}))}}else y=C.uniqueValueInfos[0],p=null,y&&y.value&&(y=typeof C.uniqueValueInfos[0].value,"string"===y||"number"===y)&&(p=y),A.push(t(C,p)),[C.field2,C.field3].forEach(D=>D&&A.push({type:"field",field:D}))}else"attributes"in C&&C.attributes.forEach(D=>A.push(t(D,"number")));(C=z?z(C):"visualVariables"in C?C.visualVariables:null)&&C.forEach(D=>A.push(t(D,"number")));return c.unique(A.filter(Boolean),(D,E)=>"field"===D.type&&"field"===E.type?D.field===E.field:
"normalized-field"===D.type&&"normalized-field"===E.type?D.field===E.field&&D.normalizationField===E.normalizationField:"expression"===D.type&&"expression"===E.type?D.expression===E.expression:!1)};a.getColorsFromRenderer=function(C){return h.apply(this,arguments)};a.setLabelsForClassBreaks=function(C){const z=C.classBreakInfos,A=C.normalizationType;let p=[];if(z&&z.length)if("standard-deviation"===C.classificationMethod)x.warn("setLabelsForClassBreaks","cannot set labels for class breaks generated using 'standard-deviation' method.");
else if(C.round){p.push(z[0].minValue);for(const y of z)p.push(y.maxValue);p=n.round(p);z.forEach((y,D)=>{y.label=w({minValue:0===D?p[0]:p[D],maxValue:p[D+1],isFirstBreak:0===D,normalizationType:A})})}else z.forEach((y,D)=>{y.label=w({minValue:y.minValue,maxValue:y.maxValue,isFirstBreak:0===D,normalizationType:A})})};a.timelineDateFormatOptions=m;a.updateClassBreak=function(C){if("standard-deviation"===C.classificationMethod)x.warn("updateClassBreak","cannot update labels for class breaks generated using 'standard-deviation' method.");
else{var z=C.classBreaks,A=C.change,p=A.index;A=A.value;var y=z.length,D=-1,E=-1;0===p?D=p:p===y?E=p-1:(E=p-1,D=p);C=C.normalizationType;p=null;-1<D&&D<y&&(p=z[D],p.minValue=A,p.label=w({minValue:p.minValue,maxValue:p.maxValue,isFirstBreak:0===D,normalizationType:C}));-1<E&&E<y&&(p=z[E],p.maxValue=A,p.label=w({minValue:p.minValue,maxValue:p.maxValue,isFirstBreak:0===E,normalizationType:C}))}};a.updateColorStops=function(C){const {stops:z,changes:A,isDate:p,dateFormatOptions:y}=C,D=z.map(F=>F.value);
C=[];for(const F of A)C.push(F.index),D[F.index]=F.value;const E=n.round(D,{indexes:C});z.forEach((F,G)=>{F.value=D[G];if(null!=F.label){let P,K=null;(P=p?r.formatDate(E[G],y):n.format(E[G]))&&(K=v(P,G,z.length-1));F.label=K}})};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/renderers/support/numberUtils":function(){define(["exports","../../intl","../../intl/number"],function(a,b,c){function m(d,e){return d-e}function l(d,e){let h;h=Number(d.toFixed(e));
h<d?d=h+1/10**e:(d=h,h-=1/10**e);h=Number(h.toFixed(e));d=Number(d.toFixed(e));return[h,d]}function r(d,e,h,v,w){d=g(d,e,h,v);e=null==d.next||d.next<=w;return(null==d.previous||d.previous<=w)&&e||d.previous+d.next<=2*w}function n(d){d=String(d);var e=d.match(k);if(e&&e[1])return{integer:e[1].split("").length,fractional:e[3]?e[3].split("").length:0};if(d.toLowerCase().includes("e")&&(e=d.split("e"),d=e[0],e=e[1],d&&e)){d=Number(d);e=Number(e);const h=0<e;h||(e=Math.abs(e));d=n(d);h?(d.integer+=e,d.fractional=
e>d.fractional?0:d.fractional-e):(d.fractional+=e,d.integer=e>d.integer?1:d.integer-e);return d}return{integer:0,fractional:0}}function g(d,e,h,v){const w={previous:null,next:null};if(null!=h){const t=d-h;w.previous=Math.floor(Math.abs(100*(e-h-t)/t))}null!=v&&(d=v-d,w.next=Math.floor(Math.abs(100*(v-e-d)/d)));return w}const k=/^-?(\d+)(\.(\d+))?$/i,f={maximumFractionDigits:20};a.format=function(d){return c.formatNumber(d,f)};a.numDigits=n;a.percentChange=g;a.round=function(d,e={}){d=d.slice(0);const {tolerance:h=
2,strictBounds:v=!1,indexes:w=d.map((x,B)=>B)}=e;w.sort(m);for(e=0;e<w.length;e++){const x=w[e],B=d[x],q=0===x?null:d[x-1],u=x===d.length-1?null:d[x+1],C=n(B).fractional;if(C){let z=0,A=!1;for(var t=void 0;z<=C&&!A;)t=l(B,z),t=v&&0===e?t[1]:t[0],A=r(B,t,q,u,h),z++;A&&(d[x]=t)}}return d};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/symbols/support/utils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../Color ../../symbols ../../core/asyncUtils ../../core/has ../../core/maybe ../../core/screenUtils ../../chunks/vec3f64 ../../layers/effects/jsonUtils ./gfxUtils ./Symbol3DMaterial".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h){function v(K){K=K.symbolLayers;if(!K)return null;let N=null;K.forEach(M=>{if("object"!==M.type||null==M.resource.href)N="water"===M.type?g.unwrap(M.color):g.isSome(M.material)?g.unwrap(M.material.color):null});return N?new m(N):null}function w(K,N){if(null==N)return K;K=K.toRgba();K[3]*=N;return new m(K)}function t(K,N,M){if(K=K.symbolLayers){var L=J=>{J=g.isSome(J)?J:null;N=N||J||null!=M&&P;return w(N,M)};K.forEach(J=>{if("object"!==J.type||null==J.resource.href||
N)if("water"===J.type)J.color=L(J.color);else{var H=g.isSome(J.material)?J.material.color:null;H=L(H);g.isNone(J.material)?J.material=new h.Symbol3DMaterial({color:H}):J.material.color=H;null!=M&&"outline"in J&&g.isSome(J.outline)&&g.isSome(J.outline.color)&&(J.outline.color=w(J.outline.color,M))}})}}function x(K,N){return B.apply(this,arguments)}function B(){B=c._asyncToGenerator(function*(K,N){(K=K.symbolLayers)&&(yield r.forEach(K,function(){var M=c._asyncToGenerator(function*(L){return q(L,N)});
return function(L){return M.apply(this,arguments)}}()))});return B.apply(this,arguments)}function q(K,N){return u.apply(this,arguments)}function u(){u=c._asyncToGenerator(function*(K,N){switch(K.type){case "extrude":K.size="number"===typeof N[2]?N[2]:0;break;case "icon":case "line":case "text":N=C(N);g.isSome(N)&&(K.size=N);break;case "path":{const M=p(N,f.ONES,[K.width,void 0,K.height]);K.width=E(N[0],K.width,1,M);K.height=E(N[2],K.height,1,M)}break;case "object":yield z(K,N)}});return u.apply(this,
arguments)}function C(K){for(const N of K)if("number"===typeof N)return N;return null}function z(K,N){return A.apply(this,arguments)}function A(){A=c._asyncToGenerator(function*(K,N){const {resourceSize:M,symbolSize:L}=yield y(K),J=p(N,M,L);K.width=E(N[0],L[0],M[0],J);K.depth=E(N[1],L[1],M[1],J);K.height=E(N[2],L[2],M[2],J)});return A.apply(this,arguments)}function p(K,N,M){for(let L=0;3>L;L++){const J=K[L];switch(J){case "symbol-value":return null!=M[L]?M[L]/N[L]:1;case "proportional":break;default:if(J&&
N[L])return J/N[L]}}return 1}function y(K){return D.apply(this,arguments)}function D(){D=c._asyncToGenerator(function*(K){const N=yield(yield new Promise((O,Q)=>a(["./symbolLayerUtils"],O,Q))).computeObjectLayerResourceSize(K,10),{width:M,height:L,depth:J}=K;K=[M,J,L];let H=1;for(var I=0;3>I;I++)if(null!=K[I]){H=K[I]/N[I];break}for(I=0;3>I;I++)null==K[I]&&(K[I]=N[I]*H);return{resourceSize:N,symbolSize:K}});return D.apply(this,arguments)}function E(K,N,M,L){switch(K){case "proportional":return M*L;
case "symbol-value":return null!=N?N:M;default:return K}}function F(){F=c._asyncToGenerator(function*(K,N){if(K&&N){if(l.isSymbol3D(K))return x(K,N);if(l.isSymbol2D(K)&&(N=C(N),!g.isNone(N)))switch(K.type){case "simple-marker":K.size=N;break;case "picture-marker":{const M=K.width/K.height;1<M?(K.width=N,K.height=N*M):(K.width=N*M,K.height=N);break}case "simple-line":K.width=N;break;case "text":K.font.size=N}}});return F.apply(this,arguments)}const G=/\/resource\/(.*?)\.svg$/,P=new m("white");b.applyColorToSymbol=
function(K,N,M){if(K&&(N||null!=M))if(N&&(N=new m(N)),l.isSymbol3D(K))t(K,N,M);else if(l.isSymbol2D(K)){if(N=N||K.color)K.color=w(N,M);null!=M&&"outline"in K&&K.outline&&K.outline.color&&(K.outline.color=w(K.outline.color,M))}};b.applyOpacityToColor=w;b.applyRotationToSymbol=function(K,N,M){K&&null!=N&&(l.isSymbol3D(K)?(K=K.symbolLayers)&&K.forEach(L=>{if(L&&"object"===L.type)switch(M){case "tilt":L.tilt=N;break;case "roll":L.roll=N;break;default:L.heading=N}}):!l.isSymbol2D(K)||"simple-marker"!==
K.type&&"picture-marker"!==K.type&&"text"!==K.type||(K.angle=N))};b.applySizesToSymbol=function(K,N){return F.apply(this,arguments)};b.getCSSFilterFromEffectList=function(K){if(!K)return null;K=K.effects.filter(N=>"bloom"!==N.type).map(N=>N.toJSON());return d.effectFunctionsFromJSON(K)};b.getColorFromSymbol=function(K,N){if(!K)return null;let M=null;l.isSymbol3D(K)?M=v(K):l.isSymbol2D(K)&&(M=K.color?new m(K.color):null);return M?w(M,N):null};b.getIconHref=function(K,N){N=N.resource.href;return!n("esri-canvas-svg-support")&&
K.styleOrigin&&G.test(N)?N.replace(G,"/resource/png/$1.png"):N};b.getSymbolOutlineSize=function(K){if(!K)return 0;if(l.isSymbol3D(K)){{const N=K.symbolLayers&&K.symbolLayers.length;N?(K=K.symbolLayers.getItemAt(N-1),K="outline"in K?g.get(K,"outline","size"):void 0):K=void 0}return g.isSome(K)?K:0}return(K=e.getStroke(K))&&k.px2pt(K.width)||0};b.isVolumetricSymbol=function(K){if(g.isNone(K)||!("symbolLayers"in K)||g.isNone(K.symbolLayers))return!1;switch(K.type){case "point-3d":return K.symbolLayers.some(N=>
"object"===N.type);case "line-3d":return K.symbolLayers.some(N=>"path"===N.type);case "polygon-3d":return K.symbolLayers.some(N=>"object"===N.type||"extrude"===N.type);default:return!1}};Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/symbols/support/gfxUtils":function(){define("exports ../../assets ../../Color ../../request ../../core/ItemCache ../../core/screenUtils ./cimSymbolUtils".split(" "),function(a,b,c,m,l,r,n){function g(h){if(!h)return null;
let v;switch(h.type){case "simple-fill":case "picture-fill":case "simple-marker":v=g(h.outline);break;case "simple-line":{const w=r.pt2px(h.width);"none"!==h.style&&0!==w&&(v={color:h.color,style:e(h.style),width:w,cap:h.cap,join:"miter"===h.join?r.pt2px(h.miterLimit):h.join});break}default:v=null}return v}const k={left:"start",center:"middle",right:"end",justify:"start"},f={top:"text-before-edge",middle:"central",baseline:"alphabetic",bottom:"text-after-edge"},d=new l(1E3),e=(()=>{const h={};return v=>
{if(h[v])return h[v];const w=v.replace(/-/g,"");return h[v]=w}})();c=new c([128,128,128]);a.defaultThematicColor=c;a.dekebabifyLineStyle=e;a.getFill=function(h){const v=h.style;let w=null;if(h)switch(h.type){case "simple-marker":"cross"!==v&&"x"!==v&&(w=h.color);break;case "simple-fill":"solid"===v?w=h.color:"none"!==v&&(w={type:"pattern",x:0,y:0,src:b.getAssetUrl(`esri/symbols/patterns/${v}.png`),width:5,height:5});break;case "picture-fill":w={type:"pattern",src:h.url,width:r.pt2px(h.width)*h.xscale,
height:r.pt2px(h.height)*h.yscale,x:r.pt2px(h.xoffset),y:r.pt2px(h.yoffset)};break;case "text":w=h.color;break;case "cim":w=n.getCIMSymbolColor(h)}return w};a.getPatternUrlWithColor=function(h,v){const w=h+"-"+v;return void 0!==d.get(w)?Promise.resolve(d.get(w)):m(h,{responseType:"image"}).then(t=>{t=t.data;const x=t.naturalWidth,B=t.naturalHeight,q=document.createElement("canvas");q.width=x;q.height=B;const u=q.getContext("2d");u.fillStyle=v;u.fillRect(0,0,x,B);u.globalCompositeOperation="destination-in";
u.drawImage(t,0,0);t=q.toDataURL();d.put(w,t);return t})};a.getSVGAlign=function(h){return h=(h=h.horizontalAlignment)&&k[h.toLowerCase()]||"middle"};a.getSVGBaseline=function(h){return(h=h.verticalAlignment)&&f[h.toLowerCase()]||"alphabetic"};a.getSVGBaselineShift=function(h){return"bottom"===h.verticalAlignment?"super":null};a.getStroke=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/ItemCache":function(){define(["./MemCache"],function(a){return function(){function b(m,
l){this._storage=new a.MemCacheStorage;this._storage.maxSize=m;l&&this._storage.registerRemoveFunc("",l)}var c=b.prototype;c.put=function(m,l){this._storage.put(m,l,1,1)};c.pop=function(m){return this._storage.pop(m)};c.get=function(m){return this._storage.get(m)};c.clear=function(){this._storage.clearAll()};c.destroy=function(){this._storage.destroy()};return b}()})},"esri/symbols/support/cimSymbolUtils":function(){define(["exports","../../Color","../cim/utils"],function(a,b,c){function m(e){e=c.toCIMSymbolJSON(e);
if("CIMTextSymbol"===e.type)return e.height;let h=0;if(e.symbolLayers)for(const v of e.symbolLayers)c.isCIMMarker(v)&&v.size>h?h=v.size:c.isCIMStroke(v)&&v.width>h?h=v.width:c.isCIMFill(v);return h}function l(e,h,v,w){if("CIMTextSymbol"===e.type)e.height*=h;else{if(v&&e.effects)for(const t of e.effects)g(t,h);if(e.symbolLayers)for(const t of e.symbolLayers)switch(t.type){case "CIMPictureMarker":case "CIMVectorMarker":r(t,h,w);break;case "CIMPictureStroke":case "CIMSolidStroke":null!=w&&w.preserveOutlineWidth||
!t.width||(t.width*=h);break;case "CIMPictureFill":t.height&&(t.height*=h);t.offsetX&&(t.offsetX*=h);t.offsetY&&(t.offsetY*=h);break;case "CIMHatchFill":l(t.lineSymbol,h,!0,{...w,preserveOutlineWidth:!1}),t.offsetX&&(t.offsetX*=h),t.offsetY&&(t.offsetY*=h),t.separation&&(t.separation*=h)}}}function r(e,h,v){e.markerPlacement&&n(e.markerPlacement,h);e.offsetX&&(e.offsetX*=h);e.offsetY&&(e.offsetY*=h);e.anchorPoint&&"Absolute"===e.anchorPointUnits&&(e.anchorPoint={x:e.anchorPoint.x*h,y:e.anchorPoint.y*
h});e.size*=h;if("CIMVectorMarker"===e.type&&e.markerGraphics)for(const w of e.markerGraphics)e.scaleSymbolsProportionally||l(w.symbol,h,!0,v)}function n(e,h){c.isCIMMarkerStrokePlacement(e)&&e.offset&&(e.offset*=h);switch(e.type){case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineSameSize":e.customEndingOffset&&(e.customEndingOffset*=h);e.offsetAlongLine&&(e.offsetAlongLine*=h);if(e.placementTemplate&&e.placementTemplate.length){var v=e.placementTemplate.map(w=>w*h);e.placementTemplate=
v}break;case "CIMMarkerPlacementAlongLineVariableSize":e.maxRandomOffset&&(e.maxRandomOffset*=h);e.placementTemplate&&e.placementTemplate.length&&(v=e.placementTemplate.map(w=>w*h),e.placementTemplate=v);break;case "CIMMarkerPlacementOnLine":e.startPointOffset&&(e.startPointOffset*=h);break;case "CIMMarkerPlacementAtExtremities":e.offsetAlongLine&&(e.offsetAlongLine*=h);break;case "CIMMarkerPlacementAtRatioPositions":e.beginPosition&&(e.beginPosition*=h);e.endPosition&&(e.endPosition*=h);break;case "CIMMarkerPlacementPolygonCenter":e.offsetX&&
(e.offsetX*=h);e.offsetY&&(e.offsetY*=h);break;case "CIMMarkerPlacementInsidePolygon":e.offsetX&&(e.offsetX*=h),e.offsetY&&(e.offsetY*=h),e.stepX&&(e.stepX*=h),e.stepY&&(e.stepY*=h)}}function g(e,h){switch(e.type){case "CIMGeometricEffectArrow":case "CIMGeometricEffectDonut":e.width&&(e.width*=h);break;case "CIMGeometricEffectBuffer":e.size&&(e.size*=h);break;case "CIMGeometricEffectCut":e.beginCut&&(e.beginCut*=h);e.endCut&&(e.endCut*=h);e.middleCut&&(e.middleCut*=h);break;case "CIMGeometricEffectDashes":e.customEndingOffset&&
(e.customEndingOffset*=h);e.offsetAlongLine&&(e.offsetAlongLine*=h);if(e.dashTemplate&&e.dashTemplate.length){const v=e.dashTemplate.map(w=>w*h);e.dashTemplate=v}break;case "CIMGeometricEffectExtension":case "CIMGeometricEffectJog":case "CIMGeometricEffectRadial":e.length&&(e.length*=h);break;case "CIMGeometricEffectMove":e.offsetX&&(e.offsetX*=h);e.offsetY&&(e.offsetY*=h);break;case "CIMGeometricEffectOffset":case "CIMGeometricEffectOffsetTangent":e.offset&&(e.offset*=h);break;case "CIMGeometricEffectRegularPolygon":e.radius&&
(e.radius*=h);break;case "CIMGeometricEffectTaperedPolygon":e.fromWidth&&(e.fromWidth*=h);e.length&&(e.length*=h);e.toWidth&&(e.toWidth*=h);break;case "CIMGeometricEffectWave":e.amplitude&&(e.amplitude*=h),e.period&&(e.period*=h)}}function k(e,h){let v;v="CIMTextSymbol"===e.type?e.symbol:e;e="CIMPolygonSymbol"===e.type;if(v.symbolLayers)for(const w of v.symbolLayers)if(!(w.colorLocked||e&&(c.isCIMStroke(w)||c.isCIMMarker(w)&&w.markerPlacement&&c.isCIMMarkerStrokePlacement(w.markerPlacement))))switch(w.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":w.tintColor&&
f(h,w.tintColor);break;case "CIMVectorMarker":w.markerGraphics.forEach(t=>{k(t.symbol,h)});break;case "CIMSolidStroke":case "CIMSolidFill":f(h,w.color);break;case "CIMHatchFill":k(w.lineSymbol,h)}}function f(e,h){for(const v of e)if(v.join(".")===h.join("."))return;e.push(h)}function d(e,h,v){var w="CIMTextSymbol"===e.type?e.symbol:e;e="CIMPolygonSymbol"===w.type?!0:!1;if(w.symbolLayers)for(const t of w.symbolLayers)if(!t.colorLocked){if(e)if(v){if({layersToColor:w}=v,(c.isCIMStroke(t)||c.isCIMMarker(t)&&
t.markerPlacement&&c.isCIMMarkerStrokePlacement(t.markerPlacement))&&"fill"===w||c.isCIMFill(t)&&"outline"===w)continue}else if(c.isCIMStroke(t)||c.isCIMMarker(t)&&t.markerPlacement&&c.isCIMMarkerStrokePlacement(t.markerPlacement))continue;w=h.toArray();switch(t.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":t.tintColor=w;break;case "CIMVectorMarker":t.markerGraphics.forEach(x=>{d(x.symbol,h,v)});break;case "CIMSolidStroke":case "CIMSolidFill":t.color=w;break;case "CIMHatchFill":d(t.lineSymbol,
h,v)}}}a.applyCIMSymbolColor=function(e,h,v){h instanceof b||(h=new b(h));(e=c.toCIMSymbolJSON(e))&&d(e,h,v)};a.applyCIMSymbolRotation=function(e,h,v=!1){e=c.toCIMSymbolJSON(e);v&&0!==h&&(h=360-h);if("CIMTextSymbol"===e.type)e.angle=h;else if("CIMPointSymbol"===e.type&&e.symbolLayers){v=h-(e.angle||0);for(const w of e.symbolLayers)if(c.isCIMMarker(w)){let t=w.rotation||0;t=w.rotateClockwise?t-v:t+v;w.rotation=t}e.angle=h}};a.getCIMSymbolColor=function(e){e=c.toCIMSymbolJSON(e);const h=[];k(e,h);return h.length?
new b(c.fromCIMColor(h[0])):null};a.getCIMSymbolRotation=function(e,h=!1){e=c.toCIMSymbolJSON(e);return"CIMTextSymbol"===e.type||"CIMPointSymbol"===e.type?h&&0!==e.angle?360-e.angle:e.angle||0:0};a.getCIMSymbolSize=m;a.scaleCIMMarker=r;a.scaleCIMSymbolTo=function(e,h,v){const w=c.toCIMSymbolJSON(e);e=m(e);if(0===e)if("CIMTextSymbol"===w.type)w.height=h;else{if(w.symbolLayers)for(const t of w.symbolLayers)switch(t.type){case "CIMPictureMarker":case "CIMVectorMarker":t.size=h;break;case "CIMPictureStroke":case "CIMSolidStroke":t.width=
h}}else l(w,h/e,!1,v)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/symbols/cim/utils":function(){define(["require","exports"],function(a,b){function c(m,l){"string"!==typeof m&&(m=String(m));switch(l){case "LowerCase":return m.toLowerCase();case "Allcaps":return m.toUpperCase();default:return m}}b._adjustTextCase=c;b.colorToArray=function(m){return[m.r,m.g,m.b,m.a]};b.createLabelOverrideFunction=function(m,l,r){const n=d=>{let e=d.length;for(;e--;)if(!" /-,\n".includes(d.charAt(e)))return!1;
return!0},g=[];var k=0;let f=-1;do f=l.indexOf("[",k),f>=k&&(f>k&&(k=l.substr(k,f-k),g.push([k,null,n(k)])),k=f+1,f=l.indexOf("]",k),f>=k&&(f>k&&(k=l.substr(k,f-k),(k=m[k])&&g.push([null,k,!1])),k=f+1));while(-1!==f);k<l.length-1&&(m=l.substr(k),g.push([m,null,n(m)]));return d=>{let e="",h=null;for(const v of g){const [w,t,x]=v;if(w)x?h=w:(h&&(e+=h,h=null),e+=w);else{const B=d.attributes[t];B&&(h&&(e+=h,h=null),e+=B)}}return c(e,r)}};b.evaluateValueOrFunction=function(m,l,r,n){return"function"===
typeof m?m(l,r,n):m};b.fromCIMColor=function(m){return m?{r:m[0],g:m[1],b:m[2],a:m[3]/255}:{r:0,g:0,b:0,a:0}};b.getValue=m=>isNaN(m)||!m?0:m;b.importGeometryEngine=function(){return new Promise((m,l)=>a(["../../geometry/geometryEngineJSON"],m,l))};b.isCIMFill=function(m){return"CIMGradientFill"===m.type||"CIMHatchFill"===m.type||"CIMPictureFill"===m.type||"CIMSolidFill"===m.type||"CIMWaterFill"===m.type};b.isCIMMarker=function(m){return"CIMVectorMarker"===m.type||"CIMPictureMarker"===m.type||"CIMBarChartMarker"===
m.type||"CIMCharacterMarker"===m.type||"CIMPieChartMarker"===m.type||"CIMStackedBarChartMarker"===m.type};b.isCIMMarkerStrokePlacement=function(m){return"CIMMarkerPlacementAlongLineRandomSize"===m.type||"CIMMarkerPlacementAlongLineSameSize"===m.type||"CIMMarkerPlacementAlongLineVariableSize"===m.type||"CIMMarkerPlacementAtExtremities"===m.type||"CIMMarkerPlacementAtMeasuredUnits"===m.type||"CIMMarkerPlacementAtRatioPositions"===m.type||"CIMMarkerPlacementOnLine"===m.type||"CIMMarkerPlacementOnVertices"===
m.type};b.isCIMStroke=function(m){return"CIMGradientStroke"===m.type||"CIMPictureStroke"===m.type||"CIMSolidStroke"===m.type};b.isGeometryEngineRequired=m=>{if(!m)return!1;for(const l of m)switch(l.type){case "CIMGeometricEffectBuffer":case "CIMGeometricEffectOffset":return!0}return!1};b.resampleHermite=function(m,l,r,n,g,k,f=!0){const d=l/g;r/=k;const e=Math.ceil(d/2),h=Math.ceil(r/2);for(let t=0;t<k;t++)for(let x=0;x<g;x++){const B=4*(x+(f?k-t-1:t)*g);var v=0;let q=0,u=0,C=0,z=0,A=0,p=0;const y=
(t+.5)*r;for(let D=Math.floor(t*r);D<(t+1)*r;D++){var w=Math.abs(y-(D+.5))/h;const E=(x+.5)*d;w*=w;for(let F=Math.floor(x*d);F<(x+1)*d;F++){let G=Math.abs(E-(F+.5))/e;v=Math.sqrt(w+G*G);-1<=v&&1>=v&&(v=2*v*v*v-3*v*v+1,0<v&&(G=4*(F+D*l),p+=v*m[G+3],u+=v,255>m[G+3]&&(v=v*m[G+3]/250),C+=v*m[G],z+=v*m[G+1],A+=v*m[G+2],q+=v))}}n[B]=C/q;n[B+1]=z/q;n[B+2]=A/q;n[B+3]=p/u}};b.toCIMSymbolJSON=function(m){var l;return null==(l=m.data)?void 0:l.symbol};Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/widgets/Legend/support/colorRampUtils":function(){define(["require","exports","../../../chunks/_rollupPluginBabelHelpers","../../../Color","./utils"],function(a,b,c,m,l){function r(h,v){const w=[],t=h.length-1;5===h.length?w.push(0,2,4):w.push(0,t);return h.map((x,B)=>w.includes(B)?l.createStopLabel(x,B,t,v):null)}function n(){n=c._asyncToGenerator(function*(h,v,w){let t=!1,x=[],B=[];if(h.stops){var q=h.stops;x=q.map(C=>C.value);(t=q.some(C=>!!C.label))&&(B=q.map(C=>C.label))}q=x[x.length-1];
if(null==x[0]&&null==q)return null;const u=t?null:r(x,w);return(yield Promise.all(x.map(function(){var C=c._asyncToGenerator(function*(z,A){const p="opacity"===h.type?yield g(z,h,v):(yield new Promise((y,D)=>a(["../../../renderers/visualVariables/support/visualVariableUtils"],y,D))).getColor(h,z);return{value:z,color:p,label:t?B[A]:u[A]}});return function(z,A){return C.apply(this,arguments)}}()))).reverse()});return n.apply(this,arguments)}function g(h,v){return k.apply(this,arguments)}function k(){k=
c._asyncToGenerator(function*(h,v,w=e){w=new m(w);h=(yield new Promise((t,x)=>a(["../../../renderers/visualVariables/support/visualVariableUtils"],t,x))).getOpacity(v,h);null!=h&&(w.a=h);return w});return k.apply(this,arguments)}function f(h,v){const {startIndex:w,endIndex:t,weight:x}=d(h,v);if(w===t)return v[w].color;h=m.blendColors(v[w].color,v[t].color,x);return new m(h)}function d(h,v){let w=0,t=v.length-1;v.some((x,B)=>{if(h<x.value)return t=B,!0;w=B;return!1});return{startIndex:w,endIndex:t,
weight:(h-v[w].value)/(v[t].value-v[w].value)}}const e=new m([64,64,64]);b.getColorFromPointCloudStops=f;b.getRampStops=function(h,v,w){return n.apply(this,arguments)};b.getRampStopsForPointCloud=function(h){let v=!1,w=[],t=[];w=h.map(q=>q.value);(v=h.some(q=>!!q.label))&&(t=h.map(q=>q.label));const x=w[w.length-1];if(null==w[0]&&null==x)return null;const B=v?null:r(w,!1);return w.map((q,u)=>{const C=f(q,h);return{value:q,color:C,label:v?t[u]:B[u]}}).reverse()};b.getStrectchRampStops=function(h,v){let w=
[];if(h&&"multipart"===h.type)h.colorRamps.reverse().forEach((t,x)=>{0===x?w.push({value:v.max,color:new m(t.toColor),label:"high"}):w.push({value:null,color:new m(t.toColor),label:""});x===h.colorRamps.length-1?w.push({value:v.min,color:new m(t.fromColor),label:"low"}):w.push({value:null,color:new m(t.fromColor),label:""})});else{let t,x;h&&"algorithmic"===h.type?(t=h.fromColor,x=h.toColor):(t=[0,0,0,1],x=[255,255,255,1]);w=[{value:v.max,color:new m(x),label:"high"},{value:v.min,color:new m(t),label:"low"}]}return w};
Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Legend/support/utils":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../symbols ../../../intl/date ../../../renderers/support/numberUtils ../../../symbols/SimpleLineSymbol".split(" "),function(a,b,c,m,l,r,n){function g(e){return k.apply(this,arguments)}function k(){k=c._asyncToGenerator(function*(e){if(!("visualVariables"in e&&e.visualVariables))return null;
e=e.visualVariables.find(w=>"color"===w.type);if(!e)return null;var h=null,v=null;if(e.stops){if(1===e.stops.length)return e.stops[0].color;h=e.stops[0].value;v=e.stops[e.stops.length-1].value}h+=(v-h)/2;({getColor:v}=yield new Promise((w,t)=>a(["../../../renderers/visualVariables/support/visualVariableUtils"],w,t)));return v(e,h)});return k.apply(this,arguments)}function f(){f=c._asyncToGenerator(function*(e,h){const v=e.trailCap,w=e.trailWidth||1;e=h||(yield g(e))||e.color;return new n({cap:v,color:e,
width:w})});return f.apply(this,arguments)}const d=l.convertDateFormatToIntlOptions("short-date");b.RGB_IMG_SOURCE=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII\x3d","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII\x3d",
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII\x3d"];b.SPECIAL_CHARS_GREATER_THAN="\x3e";b.SPECIAL_CHARS_LESS_THAN="\x3c";b.createStopLabel=function(e,h,v,w){let t="";0===h?t="\x3c ":h===v&&(t="\x3e ");h=null;h=w?l.formatDate(e,d):r.format(e);return t+h};b.getMedianColor=g;b.getSymbolForFlowRenderer=function(e,h){return f.apply(this,arguments)};Object.defineProperties(b,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Legend/support/heatmapRampUtils":function(){define(["exports","../../../renderers/support/HeatmapColorStop"],function(a,b){a.getHeatmapRampStops=function(c){if(!c.colorStops)return[];const m=[...c.colorStops].filter(r=>{var n;return 0<(null==(n=r.color)?void 0:n.a)});let l=m.length-1;if(m&&m[0]){const r=m[l];r&&1!==r.ratio&&(m.push(new b({ratio:1,color:r.color})),l++)}return m.map((r,n)=>{let g="";if(0===n){var k;g=(null==
(k=c.legendOptions)?void 0:k.minLabel)||"low"}else if(n===l){var f;g=(null==(f=c.legendOptions)?void 0:f.maxLabel)||"high"}return{color:r.color,label:g,ratio:r.ratio}}).reverse()};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Feature/FeatureMedia/FeatureMediaViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass ../../../popup/FieldInfo ../../../popup/content/support/ChartMediaInfoValueSeries ../support/featureUtils ../support/relatedFeatureUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e){const h={chartAnimation:!0};c=function(v){function w(x){x=v.call(this,x)||this;x.abilities={...h};x.activeMediaInfoIndex=0;x.attributes=null;x.description=null;x.fieldInfoMap=null;x.formattedAttributes=null;x.expressionAttributes=null;x.layer=null;x.mediaInfos=null;x.popupTemplate=null;x.relatedInfos=null;x.title=null;return x}a._inheritsLoose(w,v);var t=w.prototype;t.castAbilities=function(x){return{...h,...x}};t.setActiveMedia=function(x){this._setContentElementMedia(x)};
t.next=function(){this._pageContentElementMedia(1)};t.previous=function(){this._pageContentElementMedia(-1)};t._setContentElementMedia=function(x){const {formattedMediaInfoCount:B}=this;this.activeMediaInfoIndex=(x+B)%B};t._pageContentElementMedia=function(x){const {activeMediaInfoIndex:B}=this;this._setContentElementMedia(B+x)};t._formatMediaInfos=function(){const {attributes:x,mediaInfos:B,formattedAttributes:q,expressionAttributes:u,fieldInfoMap:C,layer:z}=this;return null==B?void 0:B.map(A=>{A=
null==A?void 0:A.clone();if(!A)return null;A.title=d.substituteFieldsInLinksAndAttributes({attributes:x,fieldInfoMap:C,globalAttributes:q,expressionAttributes:u,layer:z,text:A.title});A.caption=d.substituteFieldsInLinksAndAttributes({attributes:x,fieldInfoMap:C,globalAttributes:q,expressionAttributes:u,layer:z,text:A.caption});A.altText=d.substituteFieldsInLinksAndAttributes({attributes:x,fieldInfoMap:C,globalAttributes:q,expressionAttributes:u,layer:z,text:A.altText});if("image"===A.type){var {value:p}=
A;this._setImageValue({value:p,formattedAttributes:q,layer:z});return A.value.sourceURL?A:void 0}return"pie-chart"===A.type||"line-chart"===A.type||"column-chart"===A.type||"bar-chart"===A.type?({value:p}=A,this._setChartValue({value:p,chartType:A.type,attributes:x,formattedAttributes:q,layer:z}),A):null}).filter(Boolean)};t._setImageValue=function(x){const {fieldInfoMap:B}=this,{value:q,formattedAttributes:u,layer:C}=x,{linkURL:z,sourceURL:A}=q;A&&(x=d.fixTokens(A,C),q.sourceURL=d.substituteAttributes({formattedAttributes:u,
template:x,fieldInfoMap:B}));z&&(x=d.fixTokens(z,C),q.linkURL=d.substituteAttributes({formattedAttributes:u,template:x,fieldInfoMap:B}))};t._setChartValue=function(x){const {value:B,attributes:q,formattedAttributes:u,chartType:C,layer:z}=x,{popupTemplate:A,relatedInfos:p}=this,{fields:y,normalizeField:D}=B;B.fields=d.getFixedFieldNames(y,z);D&&(B.normalizeField=d.getFixedFieldName(D,z));if(y.some(F=>!!(null!=u[F]||d.isRelatedField(F)&&p.size))){var E=null==A?void 0:A.fieldInfos;y.forEach(F=>{d.isRelatedField(F)?
B.series=[...B.series,...this._getRelatedChartInfos({fieldInfos:E,fieldName:F,formattedAttributes:u,chartType:C,value:B})]:(F=this._getChartOption({value:B,attributes:q,chartType:C,formattedAttributes:u,fieldName:F,fieldInfos:E}),B.series.push(F))})}};t._getRelatedChartInfos=function(x){var B;const {fieldInfos:q,fieldName:u,formattedAttributes:C,chartType:z,value:A}=x,p=[];x=e.getRelatedFieldInfo(u);const {layerId:y,fieldName:D}=x;x=null==(B=this.relatedInfos)?void 0:B.get(y.toString());if(!x)return p;
const {relatedFeatures:E,relation:F}=x;if(!F||!E)return p;({cardinality:B}=F);E.forEach(G=>{const {attributes:P}=G;P&&Object.keys(P).forEach(K=>{K===D&&p.push(this._getChartOption({value:A,attributes:P,formattedAttributes:C,fieldName:u,chartType:z,relatedFieldName:K,fieldInfos:q}))})});return"one-to-many"===B||"many-to-many"===B?p:[p[0]]};t._getTooltip=function({label:x,value:B,chartType:q}){return"pie-chart"===q?`${x}`:`${x}: ${B}`};t._getChartOption=function(x){const {value:B,attributes:q,formattedAttributes:u,
fieldName:C,relatedFieldName:z,fieldInfos:A,chartType:p}=x,{layer:y,fieldInfoMap:D}=this,{normalizeField:E,tooltipField:F}=B;x=E?d.isRelatedField(E)?q[e.getRelatedFieldInfo(E).fieldName]:q[E]:null;var G=z&&void 0!==q[z]?q[z]:void 0!==q[C]?q[C]:u[C];x=new f({fieldName:C,value:void 0===G?null:G&&x?G/x:G});if(d.isRelatedField(C)){var P,K,N,M,L;G=D.get(C.toLowerCase());const H=D.get(F.toLowerCase());var J=null!=(P=null==G?void 0:G.fieldName)?P:C;P=null!=(K=null==H?void 0:H.fieldName)?K:F;K=null!=(N=null!=
(M=null!=(L=u[P])?L:null==G?void 0:G.label)?M:null==G?void 0:G.fieldName)?N:z;x.tooltip=this._getTooltip({label:K,value:u[J],chartType:p});return x}M=d.getFieldInfo(A,C);N=d.getFixedFieldName(C,y);M=F&&void 0!==u[F]?u[F]:d.getFieldInfoLabel(M||new k({fieldName:N}),null==(J=this.popupTemplate)?void 0:J.expressionInfos);x.tooltip=this._getTooltip({label:M,value:u[N],chartType:p});return x};a._createClass(w,[{key:"activeMediaInfo",get:function(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||
null}},{key:"formattedMediaInfos",get:function(){return this._formatMediaInfos()||[]}},{key:"formattedMediaInfoCount",get:function(){return this.formattedMediaInfos.length}}]);return w}(c);b.__decorate([m.property()],c.prototype,"abilities",void 0);b.__decorate([n.cast("abilities")],c.prototype,"castAbilities",null);b.__decorate([m.property()],c.prototype,"activeMediaInfoIndex",void 0);b.__decorate([m.property({readOnly:!0})],c.prototype,"activeMediaInfo",null);b.__decorate([m.property()],c.prototype,
"attributes",void 0);b.__decorate([m.property()],c.prototype,"description",void 0);b.__decorate([m.property()],c.prototype,"fieldInfoMap",void 0);b.__decorate([m.property()],c.prototype,"formattedAttributes",void 0);b.__decorate([m.property()],c.prototype,"expressionAttributes",void 0);b.__decorate([m.property({readOnly:!0})],c.prototype,"formattedMediaInfos",null);b.__decorate([m.property()],c.prototype,"layer",void 0);b.__decorate([m.property({readOnly:!0})],c.prototype,"formattedMediaInfoCount",
null);b.__decorate([m.property()],c.prototype,"mediaInfos",void 0);b.__decorate([m.property()],c.prototype,"popupTemplate",void 0);b.__decorate([m.property()],c.prototype,"relatedInfos",void 0);b.__decorate([m.property()],c.prototype,"title",void 0);return c=b.__decorate([g.subclass("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],c)})},"esri/widgets/Feature/support/relatedFeatureUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../request ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../layers/support/fieldUtils ../../../core/has ../../../layers/support/source/DataLayerSource ../../../rest/query/executeQueryJSON ../../../core/arrayUtils ../../../core/urlUtils ../../../core/unitUtils ../../../geometry/support/spatialReferenceUtils ../../../layers/graphics/featureConversionUtils ../../../geometry/Extent ../../../geometry/Geometry ../../../geometry/Multipoint ../../../geometry/Point ../../../geometry/Polygon ../../../geometry/Polyline ../../../geometry/support/normalizeUtils ../../../core/pbf ../../../rest/support/FeatureSet ../../../rest/support/Query ../../../kernel ../../../rest/query/support/AttachmentInfo ../../../rest/support/AttachmentQuery ../../../geometry ../../../rest/support/RelationshipQuery ../../../rest/support/TopFeaturesQuery ../../../rest/support/StatisticDefinition ./featureUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N,M){function L(W,R){if(!R.relationships)return null;let V=null;({relationships:R}=R);R.some(da=>da.id===parseInt(W,10)?(V=da,!0):!1);return V}function J({originRelationship:W,relationships:R,layerId:V}){let da;R&&R.some(ca=>{`${ca.relatedTableId}`===V&&ca.id===W.id&&(da=ca);return!!da});return da}function H(W,R){R=R.toLowerCase();for(const V in W)if(V.toLowerCase()===R)return W[V];return null}function I(W,R,V,da){const ca=new P;
ca.outFields=["*"];ca.relationshipId="number"===typeof R.id?R.id:parseInt(R.id,10);ca.objectIds=[W.attributes[V.objectIdField]];return V.queryRelatedFeatures(ca,da)}function O(W,R,V){let da=0;const ca=[];for(;da<R.length;)ca.push(`${W} IN (${R.slice(da,V+da)})`),da+=V;return ca.join(" OR ")}function Q(W,R,V,da){return S.apply(this,arguments)}function S(){S=b._asyncToGenerator(function*(W,R,V,da){var ca=V.layerId.toString();const {layerInfo:ha,relation:ia,relatedFields:ka,outStatistics:la,url:Y,sourceSpatialReference:ea}=
R;ca=J({originRelationship:ia,relationships:ha.relationships,layerId:ca});if(ca.relationshipTableId&&ca.keyFieldInRelationshipTable){V=(yield I(W,ca,V,da))[W.attributes[V.objectIdField]];if(!V)return null;const ba=V.features.map(Z=>Z.attributes[ha.objectIdField]);if(0<(null==la?void 0:la.length)&&ha.supportsStatistics)return R=new y,R.where=O(ha.objectIdField,ba,1E3),R.outFields=ka,R.outStatistics=la,R.sourceSpatialReference=ea,R={features:Promise.resolve(V),statsFeatures:f.executeQueryJSON(Y,R)},
r.eachAlways(R)}return(ca=null==ca?void 0:ca.keyField)?(V=n.isNumericField(T(ha.fields,ca)),W=H(W.attributes,ia.keyField),ca=V?`${ca}=${W}`:`${ca}='${W}'`,W=f.executeQueryJSON(Y,new y({where:ca,outFields:R.relatedFields,sourceSpatialReference:ea}),da),R=R.outStatistics&&0<R.outStatistics.length&&ha.supportsStatistics?f.executeQueryJSON(Y,new y({where:ca,outFields:R.relatedFields,outStatistics:R.outStatistics,sourceSpatialReference:ea}),da):null,da={features:W},R&&(da.statsFeatures=R),r.eachAlways(da)):
null});return S.apply(this,arguments)}function T(W,R){if(null!=W){R=R.toLowerCase();for(const V of W)if(V&&V.name.toLowerCase()===R)return V}return null}const U=l.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),aa=new Map;a.createRelatedInfo=function(W,R){if(W=L(W,R))return{url:`${R.url}/${W.relatedTableId}`,sourceSpatialReference:R.spatialReference,relation:W,relatedFields:[],outStatistics:[]}};a.getDestinationRelation=J;a.getRelatedFieldInfo=function(W){if(!M.isRelatedField(W))return null;
const [R,V]=W.split("/").slice(1);return{layerId:R,fieldName:V}};a.queryLayerInfos=function({relatedInfos:W,layer:R},V){const da={};W.forEach((ca,ha)=>{({relation:ca}=ca);if(!ca)throw ha=new m("relation-required","A relation is required on a layer to retrieve related records."),U.error(ha),ha;({relatedTableId:ca}=ca);if("number"!==typeof ca)throw ha=new m("A related table ID is required on a layer to retrieve related records."),U.error(ha),ha;ca=`${R.url}/${ca}`;const ia=aa.get(ca),ka=ia?ia:c(ca,
{query:{f:"json"},signal:V&&V.signal});ia||aa.set(ca,ka);da[ha]=ka});return r.eachAlways(da)};a.queryRelatedFeatures=function({graphic:W,relatedInfos:R,layer:V},da){const ca={};R.forEach((ha,ia)=>{ha.layerInfo&&(ca[ia]=Q(W,ha,V,da))});return r.eachAlways(ca)};a.setRelatedFeatures=function(W,R){if(R&&W){var {features:V,statsFeatures:da}=W;W=V&&V.value;R.relatedFeatures=W?W.features:[];W=da&&da.value;R.relatedStatsFeatures=W?W.features:[]}};a.updateRelatedInfo=function({relatedInfo:W,fieldName:R,fieldInfo:V}){W.relatedFields.push(R);
V.statisticType&&(R=new N({statisticType:V.statisticType,onStatisticField:R,outStatisticFieldName:R}),W.outStatistics.push(R))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/support/chartUtils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../intl ../../core/has ../../intl/locale".split(" "),function(a,b,c,m,l,r){function n(h){if(!h)return"en-us";if(f.has(h.toLowerCase()))return h.toLowerCase();{h=h.split("-")[0].toLowerCase();
let w=null;for(v of f.keys())if(v.startsWith(h)){w=v;break}var v=w}return v||"en-us"}function g(){g=c._asyncToGenerator(function*(h=r.getLocale()){h=n(h);if(d&&h===e)return d;d=(new Promise((v,w)=>a(["../../chunks/index"],v,w))).then(v=>v.index);e=h;try{const [v,w]=yield Promise.all([d,f.get(e)()]);e===h&&(v.am4core.options.defaultLocale=w.default);v.am4core.options.suppressWarnings=!0;v.am4core.options.autoDispose=!0}catch{return e=d=null}return d});return g.apply(this,arguments)}m="#ffffff #858585 #ffbebe #ffebbe #ffebaf #ffffbe #e9ffbe #d3ffbe #beffe8 #bee8ff #bed2ff #e8beff #ffbee8 #ebebeb #707070 #ff7f7f #ffa77f #ffd37f #ffff73 #d1ff73 #a3ff73 #73ffdf #73dfff #73b2ff #df73ff #ff73df #d6d6d6 #5c5c5c #ff0000 #ff5500 #ffaa00 #ffff00 #aaff00 #55ff00 #00ffc5 #00c5ff #0070ff #c500ff #ff00c5 #c2c2c2 #474747 #e60000 #e64c00 #e69800 #e6e600 #98e600 #4ce600 #00e6a9 #00a9e6 #005ce6 #a900e6 #e600a9 #adadad #242424 #a80000 #a83800 #a87000 #a8a800 #70a800 #38a800 #00a884 #0084a8 #004da8 #8400a8 #a80084 #999999 #1a1a1a #730000 #732600 #734c00 #737300 #4c7300 #267300 #00734c #004c73 #002673 #4c0073 #73004".split(" ");
var k=[{name:"default",colors:[].concat(m.slice(30,39),m.slice(28,30).reverse())},{name:"cat-dark",colors:"#ed5151 #149ece #a7c636 #9e559c #fc921f #ffde3e #f789d8 #b7814a #3caf99 #6b6bd6 #b54779 #7f7f7f".split(" ")},{name:"tropical-bliss",colors:"#fce138 #ff9399 #fcd27e #f1983c #a553b7 #b1a9d0 #6ecffc #4c81cd #fc6f84 #fc3e5a #6af689 #48885c".split(" ")},{name:"desert-blooms",colors:"#102432 #144d59 #ffc730 #ed9310 #a64f1b #661510 #d9351a #b31515 #4a0932 #8c213f #18382e #2c6954".split(" ")},{name:"under-the-sea",
colors:"#bf9727 #607100 #00734c #704489 #01acca #024e76 #f09100 #ea311f #c6004b #7570b3 #666666 #333333".split(" ")},{name:"vibrant-rainbow",colors:"#fffb00 #f5cb11 #9fd40c #46e39c #32b8a6 #7ff2fa #ac08cc #dd33ff #eb7200 #e8a784 #bf2e2e #6c7000".split(" ")},{name:"ocean-bay",colors:"#191921 #11495c #78b1c2 #454f4b #8f8f82 #9be0c0 #87b051 #f7ec88 #ebdcc1 #dbb658 #c43541 #75351e".split(" ")},{name:"prairie-summer",colors:"#332424 #751555 #d47013 #d68989 #211173 #82aad6 #7bfaeb #6ec9a8 #6b6408 #eada40 #ccc54a #1fc235".split(" ")},
{name:"pastel-chalk",colors:"#fffd99 #f5e6a4 #c1d48c #b8e3d0 #a0b8b5 #cbf7fa #d791f2 #dfc1eb #f2b983 #e8c4b2 #bf8e8e #94995c".split(" ")},{name:"seq-yellow-orange-red-bright",colors:"#910000 #b1260b #c0370f #e05919 #ef6a1d #ff7b22 #ffa143 #ffb454 #ffda74 #ffed85".split(" ")},{name:"seq-reds-bright",colors:"#57453b #7b4238 #9f4036 #c23d33 #d7483c #ec5244 #f3696c #f9816c #ffc4ae #fff0dc".split(" ")},{name:"seq-purples-bright",colors:"#4e465c #5a4a78 #695291 #775baa #8663c3 #946bdc #aa89e8 #c1a6f3 #d7c4ff #e6e1ff".split(" ")},
{name:"seq-blues-bright",colors:"#404d54 #435c6c #48799d #4b88b6 #4d96ce #50a5e7 #74bbed #98d0f3 #bce6f9 #e6faff".split(" ")},{name:"seq-greens-bright",colors:"#39544c #386757 #368165 #359b73 #33b581 #4bc392 #64d2a2 #7ce0b3 #cbf6d9 #f4ffea".split(" ")},{name:"seq-browns-bright",colors:"#524834 #715b38 #8f6e3c #ae8140 #cc9444 #eba748 #eeb664 #f0c47f #f9e0b7 #fff8eb".split(" ")}];const f=new Map([["ar",()=>(new Promise((h,v)=>a(["../../chunks/ar"],h,v))).then(h=>h.ar)],["bg-bg",()=>(new Promise((h,
v)=>a(["../../chunks/bg_BG"],h,v))).then(h=>h.bg_BG)],["bs-ba",()=>(new Promise((h,v)=>a(["../../chunks/bs_BA"],h,v))).then(h=>h.bs_BA)],["ca-es",()=>(new Promise((h,v)=>a(["../../chunks/ca_ES"],h,v))).then(h=>h.ca_ES)],["cs-cz",()=>(new Promise((h,v)=>a(["../../chunks/cs_CZ"],h,v))).then(h=>h.cs_CZ)],["da-dk",()=>(new Promise((h,v)=>a(["../../chunks/da_DK"],h,v))).then(h=>h.da_DK)],["de-de",()=>(new Promise((h,v)=>a(["../../chunks/de_DE"],h,v))).then(h=>h.de_DE)],["de-ch",()=>(new Promise((h,v)=>
a(["../../chunks/de_CH"],h,v))).then(h=>h.de_CH)],["el-gr",()=>(new Promise((h,v)=>a(["../../chunks/el_GR"],h,v))).then(h=>h.el_GR)],["en-us",()=>(new Promise((h,v)=>a(["../../chunks/en_US"],h,v))).then(h=>h.en_US)],["en-ca",()=>(new Promise((h,v)=>a(["../../chunks/en_CA"],h,v))).then(h=>h.en_CA)],["es-es",()=>(new Promise((h,v)=>a(["../../chunks/es_ES"],h,v))).then(h=>h.es_ES)],["et-ee",()=>(new Promise((h,v)=>a(["../../chunks/et_EE"],h,v))).then(h=>h.et_EE)],["fi-fi",()=>(new Promise((h,v)=>a(["../../chunks/fi_FI"],
h,v))).then(h=>h.fi_FI)],["fr-fr",()=>(new Promise((h,v)=>a(["../../chunks/fr_FR"],h,v))).then(h=>h.fr_FR)],["he-il",()=>(new Promise((h,v)=>a(["../../chunks/he_IL"],h,v))).then(h=>h.he_IL)],["hr-hr",()=>(new Promise((h,v)=>a(["../../chunks/hr_HR"],h,v))).then(h=>h.hr_HR)],["hu-hu",()=>(new Promise((h,v)=>a(["../../chunks/hu_HU"],h,v))).then(h=>h.hu_HU)],["id-id",()=>(new Promise((h,v)=>a(["../../chunks/id_ID"],h,v))).then(h=>h.id_ID)],["it-it",()=>(new Promise((h,v)=>a(["../../chunks/it_IT"],h,v))).then(h=>
h.it_IT)],["ja-jp",()=>(new Promise((h,v)=>a(["../../chunks/ja_JP"],h,v))).then(h=>h.ja_JP)],["ko-kr",()=>(new Promise((h,v)=>a(["../../chunks/ko_KR"],h,v))).then(h=>h.ko_KR)],["lt-lt",()=>(new Promise((h,v)=>a(["../../chunks/lt_LT"],h,v))).then(h=>h.lt_LT)],["lv-lv",()=>(new Promise((h,v)=>a(["../../chunks/lv_LV"],h,v))).then(h=>h.lv_LV)],["nb-no",()=>(new Promise((h,v)=>a(["../../chunks/nb_NO"],h,v))).then(h=>h.nb_NO)],["nl-nl",()=>(new Promise((h,v)=>a(["../../chunks/nl_NL"],h,v))).then(h=>h.nl_NL)],
["pl-pl",()=>(new Promise((h,v)=>a(["../../chunks/pl_PL"],h,v))).then(h=>h.pl_PL)],["pt-br",()=>(new Promise((h,v)=>a(["../../chunks/pt_BR"],h,v))).then(h=>h.pt_BR)],["pt-pt",()=>(new Promise((h,v)=>a(["../../chunks/pt_PT"],h,v))).then(h=>h.pt_PT)],["ro-ro",()=>(new Promise((h,v)=>a(["../../chunks/ro_RO"],h,v))).then(h=>h.ro_RO)],["ru-ru",()=>(new Promise((h,v)=>a(["../../chunks/ru_RU"],h,v))).then(h=>h.ru_RU)],["sk-sk",()=>(new Promise((h,v)=>a(["../../chunks/sk_SK"],h,v))).then(h=>h.sk_SK)],["sl-sl",
()=>(new Promise((h,v)=>a(["../../chunks/sl_SL"],h,v))).then(h=>h.sl_SL)],["sr-rs",()=>(new Promise((h,v)=>a(["../../chunks/sr_RS"],h,v))).then(h=>h.sr_RS)],["sv-se",()=>(new Promise((h,v)=>a(["../../chunks/sv_SE"],h,v))).then(h=>h.sv_SE)],["th-th",()=>(new Promise((h,v)=>a(["../../chunks/th_TH"],h,v))).then(h=>h.th_TH)],["tr-tr",()=>(new Promise((h,v)=>a(["../../chunks/tr_TR"],h,v))).then(h=>h.tr_TR)],["uk-ua",()=>(new Promise((h,v)=>a(["../../chunks/uk_UA"],h,v))).then(h=>h.uk_UA)],["vi-vn",()=>
(new Promise((h,v)=>a(["../../chunks/vi_VN"],h,v))).then(h=>h.vi_VN)],["zh-cn",()=>(new Promise((h,v)=>a(["../../chunks/zh_Hans"],h,v))).then(h=>h.zh_Hans)],["zh-hk",()=>(new Promise((h,v)=>a(["../../chunks/zh_Hant"],h,v))).then(h=>h.zh_Hant)],["zh-tw",()=>(new Promise((h,v)=>a(["../../chunks/zh_Hant"],h,v))).then(h=>h.zh_Hant)]]);let d,e;b.getChartLocale=n;b.getColorSet=function(h,v="default"){const w=k.find(t=>t.name===v);return w?w.colors.map(t=>h.color(t)):null};b.loadChartsModule=function(){return g.apply(this,
arguments)};Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Feature/FeatureExpression/FeatureExpressionViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../chunks/languageUtils ../../../core/Accessor ../../../core/HandleOwner ../../../core/reactiveUtils ../../../core/throttle ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../popup/content/AttachmentsContent ../../../popup/content/Content ../../../popup/content/CustomContent ../../../popup/content/ExpressionContent ../../../popup/content/FieldsContent ../../../popup/content/MediaContent ../../../popup/content/TextContent ../../../popup/ElementExpressionInfo ../FeatureContent/FeatureContentViewModel ../FeatureFields/FeatureFieldsViewModel ../FeatureMedia/FeatureMediaViewModel ../support/arcadeFeatureUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y){l=function(D){function E(F){var G=D.call(this,F)||this;G._abortController=null;G.expressionInfo=null;G.graphic=null;G.contentElement=null;G.contentElementViewModel=null;G.interceptor=null;G.view=null;G._cancelQuery=()=>{const {_abortController:P}=a._assertThisInitialized(G);P&&P.abort();G._abortController=null};G._createVM=()=>{var P,K;const N=null==(P=G.contentElement)?void 0:P.type;null==(K=G.contentElementViewModel)?void 0:K.destroy();
P="fields"===N?new A:"media"===N?new p:"text"===N?new z:null;G._set("contentElementViewModel",P)};G._compile=a._asyncToGenerator(function*(){G._cancelQuery();const P=new AbortController;G._abortController=P;yield G._compileExpression();G._abortController===P&&(G._abortController=null)});G._compileThrottled=g.throttle(G._compile,1,a._assertThisInitialized(G));G._compileExpression=a._asyncToGenerator(function*(){const {expressionInfo:P,graphic:K,interceptor:N,spatialReference:M,map:L,view:J,_abortController:H}=
a._assertThisInitialized(G);if(P&&K&&M&&L){var I=yield y.loadArcadeUtils();if(H===G._abortController)if((I=yield y.createCompiledExpression({arcadeUtils:I,expressionInfo:P,graphic:K,interceptor:N,map:L,spatialReference:M,view:J}))&&"esri.arcade.Dictionary"===I.declaredClass){I=yield m.castAsJsonAsync(I,H.signal);var O=null==I?void 0:I.type;I="media"===O?q.fromJSON(I):"text"===O?u.fromJSON(I):"fields"===O?B.fromJSON(I):null;G._set("contentElement",I)}else G._set("contentElement",null)}else G._set("contentElement",
null)});G.handles.add([n.watch(()=>[G.expressionInfo,G.graphic,G.map,G.spatialReference,G.view],()=>G._compileThrottled(),n.initial),n.watch(()=>[G.contentElement],()=>G._createVM(),n.initial)]);return G}a._inheritsLoose(E,D);E.prototype.destroy=function(){var F;this._cancelQuery();null==(F=this.contentElementViewModel)?void 0:F.destroy();this._set("contentElementViewModel",null);this._set("contentElement",null)};a._createClass(E,[{key:"spatialReference",get:function(){var F;return(null==(F=this.view)?
void 0:F.spatialReference)||null},set:function(F){void 0===F?this._clearOverride("spatialReference"):this._override("spatialReference",F)}},{key:"state",get:function(){const {_abortController:F,contentElement:G,contentElementViewModel:P}=this;return F?"loading":G||P?"ready":"disabled"}},{key:"map",get:function(){var F;return(null==(F=this.view)?void 0:F.map)||null},set:function(F){void 0===F?this._clearOverride("map"):this._override("map",F)}}]);return E}(r.HandleOwnerMixin(l));b.__decorate([k.property()],
l.prototype,"_abortController",void 0);b.__decorate([k.property({type:C})],l.prototype,"expressionInfo",void 0);b.__decorate([k.property({type:c})],l.prototype,"graphic",void 0);b.__decorate([k.property({readOnly:!0})],l.prototype,"contentElement",void 0);b.__decorate([k.property({readOnly:!0})],l.prototype,"contentElementViewModel",void 0);b.__decorate([k.property()],l.prototype,"interceptor",void 0);b.__decorate([k.property()],l.prototype,"spatialReference",null);b.__decorate([k.property({readOnly:!0})],
l.prototype,"state",null);b.__decorate([k.property()],l.prototype,"map",null);b.__decorate([k.property()],l.prototype,"view",void 0);return l=b.__decorate([h.subclass("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],l)})},"esri/chunks/languageUtils":function(){define("exports ./_rollupPluginBabelHelpers ../arcade/FunctionWrapper ../arcade/ImmutableArray ../arcade/ImmutablePathArray ../arcade/ImmutablePointArray ../geometry/Extent ../geometry/Geometry ../geometry/Multipoint ../geometry/Point ../geometry/Polygon ../geometry/Polyline ./datetime ../core/maybe ../core/number ../geometry/support/coordsUtils ../intl/locale ../arcade/featureset/support/shared".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B){function q(Aa,Pa,ab){return""===Pa||null===Pa||void 0===Pa||Pa===ab||Pa===ab?Aa:Aa=Aa.split(Pa).join(ab)}function u(Aa){return Aa instanceof Ka||Aa instanceof c||Aa instanceof Oa}function C(Aa){return A(Aa)||y(Aa)||N(Aa)||p(Aa)||null===Aa||Aa===za||"number"===typeof Aa?!0:!1}function z(Aa,Pa){return void 0===Aa?Pa:Aa}function A(Aa){return"string"===typeof Aa||Aa instanceof String}function p(Aa){return"boolean"===typeof Aa}function y(Aa){return"number"===
typeof Aa}function D(Aa){return"number"===typeof Aa&&isFinite(Aa)&&Math.floor(Aa)===Aa}function E(Aa){return Aa instanceof Array}function F(Aa){return"esri.arcade.Feature"===(null==Aa?void 0:Aa.arcadeDeclaredClass)?!0:!1}function G(Aa){return!0===(Aa&&Aa.declaredRootClass&&"esri.arcade.featureset.support.FeatureSet"===Aa.declaredRootClass)}function P(Aa){return!0===(Aa&&Aa.declaredRootClass&&"esri.arcade.featureSetCollection"===Aa.declaredRootClass)}function K(Aa){return Aa instanceof m}function N(Aa){return Aa instanceof
Date}function M(Aa,Pa,ab){if(Aa.length<Pa||Aa.length>ab)throw Error("Function called with wrong number of Parameters");}function L(Aa){return 0>Aa?-Math.round(-Aa):Math.round(Aa)}function J(){let Aa=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(Pa){const ab=(Aa+16*Math.random())%16|0;Aa=Math.floor(Aa/16);return("x"===Pa?ab:ab&3|8).toString(16)})}function H(Aa,Pa){if(!1===isNaN(Aa)){if(void 0===Pa||null===Pa||""===Pa)return Aa.toString();Pa=q(Pa,"\u2030","");Pa=q(Pa,
"\u00a4","");return w.format(Aa,{pattern:Pa})}return Aa.toString()}function I(Aa,Pa){Aa=h.DateTime.fromJSDate(Aa);return void 0===Pa||null===Pa||""===Pa?Aa.toISO({suppressMilliseconds:!0}):Aa.toFormat(O(Pa),{locale:x.getLocale(),numberingSystem:"latn"})}function O(Aa){Aa=Aa.replace(/LTS|LT|LL?L?L?|l{1,4}/g,"[$\x26]");let Pa="";const ab=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;
for(const fb of Aa.match(ab))switch(fb){case "D":Pa+="d";break;case "DD":Pa+="dd";break;case "DDD":Pa+="o";break;case "d":Pa+="c";break;case "ddd":Pa+="ccc";break;case "dddd":Pa+="cccc";break;case "M":Pa+="L";break;case "MM":Pa+="LL";break;case "MMM":Pa+="LLL";break;case "MMMM":Pa+="LLLL";break;case "YY":Pa+="yy";break;case "Y":case "YYYY":Pa+="yyyy";break;case "Q":Pa+="q";break;case "Z":Pa+="ZZ";break;case "ZZ":Pa+="ZZZ";break;case "S":Pa+="'S'";break;case "SS":Pa+="'SS'";break;case "SSS":Pa+="u";
break;case "A":case "a":Pa+="a";break;case "m":case "mm":case "h":case "hh":case "H":case "HH":case "s":case "ss":case "X":case "x":Pa+=fb;break;default:Pa=2<=fb.length&&"["===fb.slice(0,1)&&"]"===fb.slice(-1)?Pa+`'${fb.slice(1,-1)}'`:Pa+`'${fb}'`}return Pa}function Q(Aa,Pa,ab){switch(ab){case "\x3e":return Aa>Pa;case "\x3c":return Aa<Pa;case "\x3e\x3d":return Aa>=Pa;case "\x3c\x3d":return Aa<=Pa}return!1}function S(Aa,Pa,ab){if(null===Aa){if(null===Pa||Pa===za)return Q(null,null,ab);if(y(Pa))return Q(0,
Pa,ab);if(A(Pa)||p(Pa))return Q(0,V(Pa),ab);if(N(Pa))return Q(0,Pa.getTime(),ab)}if(Aa===za){if(null===Pa||Pa===za)return Q(null,null,ab);if(y(Pa))return Q(0,Pa,ab);if(A(Pa)||p(Pa))return Q(0,V(Pa),ab);if(N(Pa))return Q(0,Pa.getTime(),ab)}else if(y(Aa)){if(y(Pa))return Q(Aa,Pa,ab);if(p(Pa))return Q(Aa,V(Pa),ab);if(null===Pa||Pa===za)return Q(Aa,0,ab);if(A(Pa))return Q(Aa,V(Pa),ab);if(N(Pa))return Q(Aa,Pa.getTime(),ab)}else if(A(Aa)){if(A(Pa))return Q(U(Aa),U(Pa),ab);if(N(Pa))return Q(V(Aa),Pa.getTime(),
ab);if(y(Pa))return Q(V(Aa),Pa,ab);if(null===Pa||Pa===za)return Q(V(Aa),0,ab);if(p(Pa))return Q(V(Aa),V(Pa),ab)}else if(N(Aa)){if(N(Pa))return Q(Aa,Pa,ab);if(null===Pa||Pa===za)return Q(Aa.getTime(),0,ab);if(y(Pa))return Q(Aa.getTime(),Pa,ab);if(p(Pa)||A(Pa))return Q(Aa.getTime(),V(Pa),ab)}else if(p(Aa)){if(p(Pa))return Q(Aa,Pa,ab);if(y(Pa))return Q(V(Aa),V(Pa),ab);if(N(Pa))return Q(V(Aa),Pa.getTime(),ab);if(null===Pa||Pa===za)return Q(V(Aa),0,ab);if(A(Pa))return Q(V(Aa),V(Pa),ab)}return!T(Aa,Pa)||
"\x3c\x3d"!==ab&&"\x3e\x3d"!==ab?!1:!0}function T(Aa,Pa){if(Aa===Pa||null===Aa&&Pa===za||null===Pa&&Aa===za)return!0;if(N(Aa)&&N(Pa))return Aa.getTime()===Pa.getTime();if(Aa instanceof l||Aa instanceof r)return Aa.equalityTest(Pa);if(Aa instanceof f&&Pa instanceof f){const ab=Aa.cache._arcadeCacheId,fb=Pa.cache._arcadeCacheId;if(void 0!==ab&&null!==ab)return ab===fb}return void 0!==Aa&&void 0!==Pa&&null!==Aa&&null!==Pa&&"object"===typeof Aa&&"object"===typeof Pa&&(Aa._arcadeCacheId===Pa._arcadeCacheId&&
void 0!==Aa._arcadeCacheId&&null!==Aa._arcadeCacheId||Aa._underlyingGraphic===Pa._underlyingGraphic&&void 0!==Aa._underlyingGraphic&&null!==Aa._underlyingGraphic)?!0:!1}function U(Aa,Pa){if(A(Aa))return Aa;if(null===Aa)return"";if(y(Aa))return H(Aa,Pa);if(p(Aa))return Aa.toString();if(N(Aa))return I(Aa,Pa);if(Aa instanceof g)return JSON.stringify(Aa.toJSON());if(E(Aa)){Pa=[];for(var ab=0;ab<Aa.length;ab++)Pa[ab]=R(Aa[ab]);return"["+Pa.join(",")+"]"}if(Aa instanceof m){Pa=[];for(ab=0;ab<Aa.length();ab++)Pa[ab]=
R(Aa.get(ab));return"["+Pa.join(",")+"]"}return null!==Aa&&"object"===typeof Aa&&void 0!==Aa.castToText?Aa.castToText():u(Aa)?"object, Function":""}function aa(Aa){const Pa=[];if(!1===E(Aa))return null;if(Aa instanceof m){for(var ab=0;ab<Aa.length();ab++)Pa[ab]=V(Aa.get(ab));return Pa}for(ab=0;ab<Aa.length;ab++)Pa[ab]=V(Aa[ab]);return Pa}function W(Aa,Pa){if(A(Aa))return Aa;if(null===Aa)return"";if(y(Aa))return H(Aa,Pa);if(p(Aa))return Aa.toString();if(N(Aa))return I(Aa,Pa);if(Aa instanceof g)return Aa instanceof
n?'{"xmin":'+Aa.xmin.toString()+',"ymin":'+Aa.ymin.toString()+","+(Aa.hasZ?'"zmin":'+Aa.zmin.toString()+",":"")+(Aa.hasM?'"mmin":'+Aa.mmin.toString()+",":"")+'"xmax":'+Aa.xmax.toString()+',"ymax":'+Aa.ymax.toString()+","+(Aa.hasZ?'"zmax":'+Aa.zmax.toString()+",":"")+(Aa.hasM?'"mmax":'+Aa.mmax.toString()+",":"")+'"spatialReference":'+fa(Aa.spatialReference)+"}":fa(Aa.toJSON(),(fb,hb)=>fb.key===hb.key?0:"spatialReference"===fb.key?1:"spatialReference"===hb.key||fb.key<hb.key?-1:fb.key>hb.key?1:0);if(E(Aa)){Pa=
[];for(var ab=0;ab<Aa.length;ab++)Pa[ab]=R(Aa[ab]);return"["+Pa.join(",")+"]"}if(Aa instanceof m){Pa=[];for(ab=0;ab<Aa.length();ab++)Pa[ab]=R(Aa.get(ab));return"["+Pa.join(",")+"]"}return null!==Aa&&"object"===typeof Aa&&void 0!==Aa.castToText?Aa.castToText():u(Aa)?"object, Function":""}function R(Aa){return null===Aa?"null":p(Aa)||y(Aa)||A(Aa)?JSON.stringify(Aa):Aa instanceof g||Aa instanceof m||Aa instanceof Array?W(Aa):Aa instanceof Date?JSON.stringify(I(Aa,"")):null!==Aa&&"object"===typeof Aa&&
void 0!==Aa.castToText?Aa.castToText():"null"}function V(Aa,Pa){return y(Aa)?Aa:null===Aa||""===Aa?0:N(Aa)?NaN:p(Aa)?Aa?1:0:E(Aa)||""===Aa||void 0===Aa?NaN:void 0!==Pa&&A(Aa)?(Pa=q(Pa,"\u2030",""),Pa=q(Pa,"\u00a4",""),w.parse(Aa,{pattern:Pa})):Aa===za?0:Number(Aa)}function da(Aa){return N(Aa)?Aa:A(Aa)&&(Aa=ha(Aa))?Aa.toJSDate():null}function ca(Aa){return N(Aa)?h.DateTime.fromJSDate(Aa):A(Aa)?ha(Aa):null}function ha(Aa){const Pa=/ (\d\d)/;let ab=h.DateTime.fromISO(Aa);return ab.isValid||Pa.test(Aa)&&
(Aa=Aa.replace(Pa,"T$1"),ab=h.DateTime.fromISO(Aa),ab.isValid)?ab:null}function ia(Aa){return p(Aa)?Aa:A(Aa)?(Aa=Aa.toLowerCase(),"true"===Aa?!0:!1):y(Aa)?0===Aa||isNaN(Aa)?!1:!0:!1}function ka(Aa,Pa){if(v.isNone(Aa))return null;if(null===Aa.spatialReference||void 0===Aa.spatialReference)Aa.spatialReference=Pa;return Aa}function la(Aa){if(null===Aa)return null;if(Aa instanceof f)return"NaN"===Aa.x||null===Aa.x||isNaN(Aa.x)?null:Aa;if(Aa instanceof d){if(0===Aa.rings.length)return null;for(const Pa of Aa.rings)if(0<
Pa.length)return Aa;return null}if(Aa instanceof e){if(0===Aa.paths.length)return null;for(const Pa of Aa.paths)if(0<Pa.length)return Aa;return null}return Aa instanceof k?0===Aa.points.length?null:Aa:Aa instanceof n?"NaN"===Aa.xmin||null===Aa.xmin||isNaN(Aa.xmin)?null:Aa:null}function Y(Aa,Pa){if(!Aa||!Aa.domain)return Pa;let ab=null;if("string"===Aa.field.type||"esriFieldTypeString"===Aa.field.type)Pa=U(Pa);else{if(null===Pa||void 0===Pa)return null;if(""===Pa)return Pa;Pa=V(Pa)}for(let fb=0;fb<
Aa.domain.codedValues.length;fb++){const hb=Aa.domain.codedValues[fb];hb.code===Pa&&(ab=hb)}return null===ab?Pa:ab.name}function ea(Aa,Pa){if(!Aa||!Aa.domain)return Pa;let ab=null;Pa=U(Pa);for(let fb=0;fb<Aa.domain.codedValues.length;fb++){const hb=Aa.domain.codedValues[fb];hb.name===Pa&&(ab=hb)}return null===ab?Pa:ab.code}function ba(Aa,Pa,ab=null,fb=null){if(!Pa||!Pa.fields)return null;let hb=null;for(let rb=0;rb<Pa.fields.length;rb++){const sb=Pa.fields[rb];sb.name.toLowerCase()===Aa.toString().toLowerCase()&&
(hb=sb)}if(null===hb)throw Error("Field not found");let kb,nb;null===fb&&ab&&Pa.typeIdField&&(fb=ab.hasField(Pa.typeIdField)?ab.field(Pa.typeIdField):null);null!==fb&&void 0!==fb&&Pa.types.some(function(rb){return rb.id===fb?((kb=rb.domains&&rb.domains[hb.name])&&"inherited"===kb.type&&(kb=Z(hb.name,Pa),nb=!0),!0):!1});nb||kb||(kb=Z(Aa,Pa));return{field:hb,domain:kb}}function Z(Aa,Pa){let ab;Pa.fields.some(function(fb){fb.name.toLowerCase()===Aa.toLowerCase()&&(ab=fb.domain);return!!ab});return ab}
function fa(Aa,Pa){Pa||(Pa={});"function"===typeof Pa&&(Pa={cmp:Pa});const ab="boolean"===typeof Pa.cycles?Pa.cycles:!1,fb=Pa.cmp&&function(kb){return function(nb){return function(rb,sb){return kb({key:rb,value:nb[rb]},{key:sb,value:nb[sb]})}}}(Pa.cmp),hb=[];return function rb(nb){nb&&nb.toJSON&&"function"===typeof nb.toJSON&&(nb=nb.toJSON());if(void 0!==nb){if("number"===typeof nb)return isFinite(nb)?""+nb:"null";if("object"!==typeof nb)return JSON.stringify(nb);var sb;if(Array.isArray(nb)){var jb=
"[";for(sb=0;sb<nb.length;sb++)sb&&(jb+=","),jb+=rb(nb[sb])||"null";return jb+"]"}if(null===nb)return"null";if(hb.includes(nb)){if(ab)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON");}var qb=hb.push(nb)-1,ob=Object.keys(nb).sort(fb&&fb(nb));jb="";for(sb=0;sb<ob.length;sb++){const db=ob[sb],va=rb(nb[db]);va&&(jb&&(jb+=","),jb+=JSON.stringify(db)+":"+va)}hb.splice(qb,1);return"{"+jb+"}"}}(Aa)}function ja(Aa){if(null===Aa)return null;const Pa=[];for(const ab of Aa)ab&&
ab.arcadeDeclaredClass&&"esri.arcade.Feature"===ab.arcadeDeclaredClass?Pa.push(ab.geometry()):Pa.push(ab);return Pa}function oa(Aa,Pa){if(Pa instanceof f)Aa.push(Pa.hasZ?Pa.hasM?[Pa.x,Pa.y,Pa.z,Pa.m]:[Pa.x,Pa.y,Pa.z]:[Pa.x,Pa.y]);else throw Error("Invalid Argument");}function sa(Aa,Pa){if(E(Aa)||K(Aa)){let ab=!1,fb=!1,hb=[];if(E(Aa)){for(const kb of Aa)oa(hb,kb);0<hb.length&&(Pa=Aa[0].spatialReference,ab=Aa[0].hasZ,fb=Aa[0].hasM)}else if(Aa instanceof r)hb=Aa._elements,0<hb.length&&(ab=Aa._hasZ,fb=
Aa._hasM,Pa=Aa.get(0).spatialReference);else if(K(Aa)){for(const kb of Aa.toArray())oa(hb,kb);0<hb.length&&(Pa=Aa.get(0).spatialReference,ab=!0===Aa.get(0).hasZ,fb=!0===Aa.get(0).hasM)}else throw Error("Invalid Argument");if(0===hb.length)return null;!1===t.isClockwise(hb,fb,ab)&&(hb=hb.slice(0).reverse());return new d({rings:[hb],spatialReference:Pa,hasZ:ab,hasM:fb})}return Aa}function qa(Aa,Pa){if(E(Aa)||K(Aa)){let ab=!1,fb=!1,hb=[];if(E(Aa)){for(const kb of Aa)oa(hb,kb);0<hb.length&&(Pa=Aa[0].spatialReference,
ab=!0===Aa[0].hasZ,fb=!0===Aa[0].hasM)}else if(Aa instanceof r)hb=Aa._elements,0<hb.length&&(ab=Aa._hasZ,fb=Aa._hasM,Pa=Aa.get(0).spatialReference);else if(K(Aa)){for(const kb of Aa.toArray())oa(hb,kb);0<hb.length&&(Pa=Aa.get(0).spatialReference,ab=!0===Aa.get(0).hasZ,fb=!0===Aa.get(0).hasM)}return 0===hb.length?null:new e({paths:[hb],spatialReference:Pa,hasZ:ab,hasM:fb})}return Aa}function Ha(Aa,Pa){if(E(Aa)||K(Aa)){let ab=!1,fb=!1,hb=[];if(E(Aa)){for(const kb of Aa)oa(hb,kb);0<hb.length&&(Pa=Aa[0].spatialReference,
ab=!0===Aa[0].hasZ,fb=!0===Aa[0].hasM)}else if(Aa instanceof r)hb=Aa._elements,0<hb.length&&(ab=Aa._hasZ,fb=Aa._hasM,Pa=Aa.get(0).spatialReference);else if(K(Aa)){for(const kb of Aa.toArray())oa(hb,kb);0<hb.length&&(Pa=Aa.get(0).spatialReference,ab=!0===Aa.get(0).hasZ,fb=!0===Aa.get(0).hasM)}return 0===hb.length?null:new k({points:hb,spatialReference:Pa,hasZ:ab,hasM:fb})}return Aa}function Ga(Aa,Pa=!1){const ab=[];if(null===Aa)return ab;if(!0===E(Aa)){for(var fb=0;fb<Aa.length;fb++){var hb=U(Aa[fb]);
""===hb&&!0!==Pa||ab.push(hb)}return ab}if(Aa instanceof m){for(fb=0;fb<Aa.length();fb++)hb=U(Aa.get(fb)),""===hb&&!0!==Pa||ab.push(hb);return ab}return C(Aa)?(Aa=U(Aa),""===Aa&&!0!==Pa||ab.push(Aa),ab):[]}function pa(Aa){Wa++;return 0===Wa%100?(Wa=0,new Promise(Pa=>{setTimeout(()=>{Pa(Aa)},0)})):Aa}function Da(Aa,Pa,ab){switch(ab){case "\x26":return Aa&Pa;case "|":return Aa|Pa;case "^":return Aa^Pa;case "\x3c\x3c":return Aa<<Pa;case "\x3e\x3e":return Aa>>Pa;case "\x3e\x3e\x3e":return Aa>>>Pa}}function ra(Aa,
Pa=null){if(null!=Aa){if(p(Aa)||y(Aa)||A(Aa))return Aa;if(Aa instanceof g)return!0===(null==Pa?void 0:Pa.keepGeometryType)?Aa:Aa.toJSON();if(Aa instanceof m)return Aa.toArray().map(ab=>ra(ab,Pa));if(Aa instanceof Array)return Aa.map(ab=>ra(ab,Pa));if(Aa instanceof Date)return Aa;if(null!==Aa&&"object"===typeof Aa&&void 0!==Aa.castAsJson)return Aa.castAsJson(Pa)}return null}function Ea(Aa,Pa,ab,fb,hb){return Ia.apply(this,arguments)}function Ia(){Ia=b._asyncToGenerator(function*(Aa,Pa,ab,fb,hb){Aa=
yield Ma(Aa,Pa,ab);hb[fb]=Aa});return Ia.apply(this,arguments)}function Ma(Aa){return Qa.apply(this,arguments)}function Qa(){Qa=b._asyncToGenerator(function*(Aa,Pa=null,ab=null){Aa instanceof m&&(Aa=Aa.toArray());if(null!=Aa){if(C(Aa)||Aa instanceof g||Aa instanceof Date)return ra(Aa,ab);if(Aa instanceof Array){const fb=[],hb=[];for(const kb of Aa)null===kb||C(kb)||kb instanceof g||kb instanceof Date?hb.push(ra(kb,ab)):(hb.push(null),fb.push(Ea(kb,Pa,ab,hb.length-1,hb)));0<fb.length&&(yield Promise.all(fb));
return hb}if(null!==Aa&&"object"===typeof Aa&&void 0!==Aa.castAsJsonAsync)return Aa.castAsJsonAsync(Pa,ab)}return null});return Qa.apply(this,arguments)}function wa(Aa,Pa,ab){const fb=Aa.fullSchema();return null!==fb&&fb.fields?ba(Pa,fb,Aa,ab):null}function Ja(Aa){Aa=Aa.fullSchema();return null!==Aa&&Aa.fields?Aa.typeIdField?{subtypeField:Aa.typeIdField,subtypes:Aa.types?Aa.types.map(Pa=>({name:Pa.name,code:Pa.id})):[]}:null:null}function Ta(Aa,Pa,ab,fb){const hb=Aa.fullSchema();if(null===hb||!hb.fields)return null;
fb=ba(Pa,hb,Aa,fb);if(void 0===ab)try{ab=Aa.field(Pa)}catch(kb){return null}return Y(fb,ab)}function Xa(Aa,Pa,ab,fb){const hb=Aa.fullSchema();if(null===hb||!hb.fields)return null;if(void 0===ab){try{ab=Aa.field(Pa)}catch(kb){return null}return ab}Aa=ba(Pa,hb,Aa,fb);return ea(Aa,ab)}function ma(Aa){Aa=Aa.fullSchema();if(null===Aa||!Aa.fields)return null;const Pa=[];for(const ab of Aa.fields)Pa.push(B.esriFieldToJson(ab));return{objectIdField:Aa.objectIdField,globalIdField:Aa.globalIdField,geometryType:void 0===
B.layerGeometryEsriRestConstants[Aa.geometryType]?"":B.layerGeometryEsriRestConstants[Aa.geometryType],fields:Pa}}let $a=function(Aa){this.value=Aa},xa=function(Aa){this.value=Aa},Ka=function(Aa){this.fn=Aa},Oa=function(Aa,Pa){this.paramCount=Pa;this.fn=Aa};const Va=Ka,Ra=Oa,za={type:"VOID"},ya={type:"BREAK"},Na={type:"CONTINUE"};let Wa=0;const bb=Object.freeze(Object.defineProperty({__proto__:null,ReturnResultE:$a,ImplicitResultE:xa,NativeFunctionE:Ka,SizzleFunctionE:Oa,NativeFunction:Va,ImplicitResult:xa,
ReturnResult:$a,SizzleFunction:Ra,voidOperation:za,breakResult:ya,continueResult:Na,multiReplace:q,isFunctionParameter:u,isSimpleType:C,defaultUndefined:z,isString:A,isBoolean:p,isNumber:y,isInteger:D,isArray:E,isFeature:F,isFeatureSet:G,isFeatureSetCollection:P,isImmutableArray:K,isDate:N,pcCheck:M,absRound:L,generateUUID:J,formatNumber:H,formatDate:I,standardiseDateFormat:O,greaterThanLessThan:S,equalityTest:T,toString:U,toNumberArray:aa,toStringExplicit:W,toNumber:V,toDate:da,toDateTime:ca,toBoolean:ia,
fixSpatialReference:ka,fixNullGeometry:la,getDomainValue:Y,getDomainCode:ea,getDomain:ba,stableStringify:fa,autoCastFeatureToGeometry:ja,autoCastArrayOfPointsToPolygon:sa,autoCastArrayOfPointsToPolyline:qa,autoCastArrayOfPointsToMultiPoint:Ha,toStringArray:Ga,tick:pa,binaryOperator:Da,castAsJson:ra,castAsJsonAsync:Ma,featureFullDomain:wa,featureSubtypes:Ja,featureDomainValueLookup:Ta,featureDomainCodeLookup:Xa,featureSchema:ma},Symbol.toStringTag,{value:"Module"}));a.ImplicitResult=xa;a.ImplicitResultE=
xa;a.NativeFunction=Va;a.NativeFunctionE=Ka;a.ReturnResult=$a;a.ReturnResultE=$a;a.SizzleFunction=Ra;a.SizzleFunctionE=Oa;a.absRound=L;a.autoCastArrayOfPointsToMultiPoint=Ha;a.autoCastArrayOfPointsToPolygon=sa;a.autoCastArrayOfPointsToPolyline=qa;a.autoCastFeatureToGeometry=ja;a.binaryOperator=Da;a.breakResult=ya;a.castAsJson=ra;a.castAsJsonAsync=Ma;a.continueResult=Na;a.defaultUndefined=z;a.equalityTest=T;a.featureDomainCodeLookup=Xa;a.featureDomainValueLookup=Ta;a.featureFullDomain=wa;a.featureSchema=
ma;a.featureSubtypes=Ja;a.fixNullGeometry=la;a.fixSpatialReference=ka;a.formatDate=I;a.formatNumber=H;a.generateUUID=J;a.getDomain=ba;a.getDomainCode=ea;a.getDomainValue=Y;a.greaterThanLessThan=S;a.isArray=E;a.isBoolean=p;a.isDate=N;a.isFeature=F;a.isFeatureSet=G;a.isFeatureSetCollection=P;a.isFunctionParameter=u;a.isImmutableArray=K;a.isInteger=D;a.isNumber=y;a.isSimpleType=C;a.isString=A;a.lc=bb;a.multiReplace=q;a.pcCheck=M;a.stableStringify=fa;a.standardiseDateFormat=O;a.tick=pa;a.toBoolean=ia;
a.toDate=da;a.toDateTime=ca;a.toNumber=V;a.toNumberArray=aa;a.toString=U;a.toStringArray=Ga;a.toStringExplicit=W;a.voidOperation=za})},"esri/arcade/FunctionWrapper":function(){define(function(){return function(a,b){this.context=this.definition=null;this.definition=a;this.context=b}})},"esri/arcade/ImmutableArray":function(){define(function(){return function(){function a(c=[]){this._elements=c}var b=a.prototype;b.length=function(){return this._elements.length};b.get=function(c){return this._elements[c]};
b.toArray=function(){const c=[];for(let m=0;m<this.length();m++)c.push(this.get(m));return c};return a}()})},"esri/arcade/ImmutablePathArray":function(){define(["../chunks/_rollupPluginBabelHelpers","./ImmutableArray","./ImmutablePointArray"],function(a,b,c){return function(m){function l(n,g,k,f,d){n=m.call(this,n)||this;n._lazyPath=[];n._hasZ=!1;n._hasM=!1;n._hasZ=k;n._hasM=f;n._spRef=g;n._cacheId=d;return n}a._inheritsLoose(l,m);var r=l.prototype;r.get=function(n){if(void 0===this._lazyPath[n]){const g=
this._elements[n];if(void 0===g)return;this._lazyPath[n]=new c(g,this._spRef,this._hasZ,this._hasM,this._cacheId,n)}return this._lazyPath[n]};r.equalityTest=function(n){return n===this?!0:null===n||!1===n instanceof l?!1:n.getUniqueHash()===this.getUniqueHash()};r.getUniqueHash=function(){return this._cacheId.toString()};return l}(b)})},"esri/arcade/ImmutablePointArray":function(){define(["../chunks/_rollupPluginBabelHelpers","./ImmutableArray","../geometry/Point"],function(a,b,c){return function(m){function l(n,
g,k,f,d,e){n=m.call(this,n)||this;n._lazyPt=[];n._hasZ=!1;n._hasM=!1;n._spRef=g;n._hasZ=k;n._hasM=f;n._cacheId=d;n._partId=e;return n}a._inheritsLoose(l,m);var r=l.prototype;r.get=function(n){if(void 0===this._lazyPt[n]){const g=this._elements[n];if(void 0===g)return;const k=this._hasZ,f=this._hasM;let d=null;d=k&&!f?new c(g[0],g[1],g[2],void 0,this._spRef):f&&!k?new c(g[0],g[1],void 0,g[2],this._spRef):k&&f?new c(g[0],g[1],g[2],g[3],this._spRef):new c(g[0],g[1],this._spRef);d.cache._arcadeCacheId=
this._cacheId.toString()+"-"+this._partId.toString()+"-"+n.toString();this._lazyPt[n]=d}return this._lazyPt[n]};r.equalityTest=function(n){return n===this?!0:null===n||!1===n instanceof l?!1:n.getUniqueHash()===this.getUniqueHash()};r.getUniqueHash=function(){return this._cacheId.toString()+"-"+this._partId.toString()};return l}(b)})},"esri/chunks/datetime":function(){define(["exports"],function(a){function b(X){return"undefined"===typeof X}function c(X){return"number"===typeof X}function m(X){return"number"===
typeof X&&0===X%1}function l(){try{return"undefined"!==typeof Intl&&!!Intl.RelativeTimeFormat}catch(X){return!1}}function r(X,na,Ca){if(0!==X.length)return X.reduce((La,Ua)=>{Ua=[na(Ua),Ua];return La?Ca(La[0],Ua[0])===La[0]?La:Ua:Ua},null)[1]}function n(X,na){return na.reduce((Ca,La)=>{Ca[La]=X[La];return Ca},{})}function g(X,na){return Object.prototype.hasOwnProperty.call(X,na)}function k(X,na,Ca){return m(X)&&X>=na&&X<=Ca}function f(X,na=2){return 0>X?"-"+(""+-X).padStart(na,"0"):(""+X).padStart(na,
"0")}function d(X){if(!b(X)&&null!==X&&""!==X)return parseInt(X,10)}function e(X){if(!b(X)&&null!==X&&""!==X)return parseFloat(X)}function h(X){if(!b(X)&&null!==X&&""!==X)return X=1E3*parseFloat("0."+X),Math.floor(X)}function v(X,na,Ca=!1){na=10**na;return(Ca?Math.trunc:Math.round)(X*na)/na}function w(X){return 0===X%4&&(0!==X%100||0===X%400)}function t(X,na){var Ca=na-1;Ca=Ca-12*Math.floor(Ca/12)+1;return 2===Ca?w(X+(na-Ca)/12)?29:28:[31,null,31,30,31,30,31,31,30,31,30,31][Ca-1]}function x(X){let na=
Date.UTC(X.year,X.month-1,X.day,X.hour,X.minute,X.second,X.millisecond);100>X.year&&0<=X.year&&(na=new Date(na),na.setUTCFullYear(na.getUTCFullYear()-1900));return+na}function B(X){var na=X-1;na=(na+Math.floor(na/4)-Math.floor(na/100)+Math.floor(na/400))%7;return 4===(X+Math.floor(X/4)-Math.floor(X/100)+Math.floor(X/400))%7||3===na?53:52}function q(X){return 99<X?X:60<X?1900+X:2E3+X}function u(X,na,Ca,La=null){X=new Date(X);const Ua={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",
minute:"2-digit"};La&&(Ua.timeZone=La);return(na=(new Intl.DateTimeFormat(Ca,{timeZoneName:na,...Ua})).formatToParts(X).find(Za=>"timezonename"===Za.type.toLowerCase()))?na.value:null}function C(X,na){X=parseInt(X,10);Number.isNaN(X)&&(X=0);na=parseInt(na,10)||0;na=0>X||Object.is(X,-0)?-na:na;return 60*X+na}function z(X){const na=Number(X);if("boolean"===typeof X||""===X||Number.isNaN(na))throw new Sa(`Invalid unit value ${X}`);return na}function A(X,na){const Ca={};for(const La in X)if(g(X,La)){const Ua=
X[La];void 0!==Ua&&null!==Ua&&(Ca[na(La)]=z(Ua))}return Ca}function p(X,na){const Ca=Math.trunc(Math.abs(X/60)),La=Math.trunc(Math.abs(X%60));X=0<=X?"+":"-";switch(na){case "short":return`${X}${f(Ca,2)}:${f(La,2)}`;case "narrow":return`${X}${Ca}${0<La?`:${La}`:""}`;case "techie":return`${X}${f(Ca,2)}${f(La,2)}`;default:throw new RangeError(`Value format ${na} is out of range for property format`);}}function y(X){return n(X,["hour","minute","second","millisecond"])}function D(X){switch(X){case "narrow":return[...Kb];
case "short":return[...Bc];case "long":return[...Cc];case "numeric":return"1 2 3 4 5 6 7 8 9 10 11 12".split(" ");case "2-digit":return"01 02 03 04 05 06 07 08 09 10 11 12".split(" ");default:return null}}function E(X){switch(X){case "narrow":return[...bc];case "short":return[...Gb];case "long":return[...Dc];case "numeric":return"1234567".split("");default:return null}}function F(X){switch(X){case "narrow":return[...Vd];case "short":return[...Yc];case "long":return[...Zc];default:return null}}function G(X,
na,Ca="always",La=!1){const Ua={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]};var Za=-1===["hours","minutes","seconds"].indexOf(X);if("auto"===Ca&&Za)switch(Ca="days"===X,na){case 1:return Ca?"tomorrow":`next ${Ua[X][0]}`;case -1:return Ca?"yesterday":`last ${Ua[X][0]}`;case 0:return Ca?"today":`this ${Ua[X][0]}`}Ca=Object.is(na,-0)||0>na;na=Math.abs(na);
Za=1===na;const gb=Ua[X];X=La?Za?gb[1]:gb[2]||gb[1]:Za?Ua[X][0]:X;return Ca?`${na} ${X} ago`:`in ${na} ${X}`}function P(X,na){let Ca="";for(const La of X)Ca=La.literal?Ca+La.val:Ca+na(La.val);return Ca}function K(X,na){if(b(X)||null===X)return na;if(X instanceof vc)return X;if("string"===typeof X){const Ca=X.toLowerCase();return"local"===Ca||"system"===Ca?na:"utc"===Ca||"gmt"===Ca?Qb.utcInstance:Qb.parseSpecifier(Ca)||gc.create(X)}return c(X)?Qb.instance(X):"object"===typeof X&&X.offset&&"number"===
typeof X.offset?X:new Wd(X)}function N(X,na={}){const Ca=JSON.stringify([X,na]);let La=qd[Ca];La||(La=new Intl.ListFormat(X,na),qd[Ca]=La);return La}function M(X,na={}){const Ca=JSON.stringify([X,na]);let La=$c[Ca];La||(La=new Intl.DateTimeFormat(X,na),$c[Ca]=La);return La}function L(X,na={}){const Ca=JSON.stringify([X,na]);let La=Ec[Ca];La||(La=new Intl.NumberFormat(X,na),Ec[Ca]=La);return La}function J(X,na={}){const {base:Ca,...La}=na,Ua=JSON.stringify([X,La]);let Za=ad[Ua];Za||(Za=new Intl.RelativeTimeFormat(X,
na),ad[Ua]=Za);return Za}function H(X){const na=[];for(let Ca=1;12>=Ca;Ca++){const La=Ba.utc(2016,Ca,1);na.push(X(La))}return na}function I(X){const na=[];for(let Ca=1;7>=Ca;Ca++){const La=Ba.utc(2016,11,13+Ca);na.push(X(La))}return na}function O(X,na,Ca,La,Ua){X=X.listingMode(Ca);return"error"===X?null:"en"===X?La(na):Ua(na)}function Q(...X){X=X.reduce((na,Ca)=>na+Ca.source,"");return RegExp(`^${X}$`)}function S(...X){return na=>X.reduce(([Ca,La,Ua],Za)=>{const [gb,lb,pb]=Za(na,Ua);return[{...Ca,
...gb},lb||La,pb]},[{},null,1]).slice(0,2)}function T(X,...na){if(null==X)return[null,null];for(const [Ca,La]of na)if(na=Ca.exec(X))return La(na);return[null,null]}function U(...X){return(na,Ca)=>{const La={};let Ua;for(Ua=0;Ua<X.length;Ua++)La[X[Ua]]=d(na[Ca+Ua]);return[La,null,Ca+Ua]}}function aa(X,na,Ca){X=X[na];return b(X)?Ca:d(X)}function W(X,na){return[{hours:aa(X,na,0),minutes:aa(X,na+1,0),seconds:aa(X,na+2,0),milliseconds:h(X[na+3])},null,na+4]}function R(X,na){const Ca=!X[na]&&!X[na+1];X=
C(X[na+1],X[na+2]);return[{},Ca?null:Qb.instance(X),na+3]}function V(X,na){return[{},X[na]?gc.create(X[na]):null,na+1]}function da(X){const [na,Ca,La,Ua,Za,gb,lb,pb,yb]=X,ub="-"===na[0];X=pb&&"-"===pb[0];const wb=(Ab,Jb=!1)=>void 0!==Ab&&(Jb||Ab&&ub)?-Ab:Ab;return[{years:wb(e(Ca)),months:wb(e(La)),weeks:wb(e(Ua)),days:wb(e(Za)),hours:wb(e(gb)),minutes:wb(e(lb)),seconds:wb(e(pb),"-0"===pb),milliseconds:wb(h(yb),X)}]}function ca(X,na,Ca,La,Ua,Za,gb){na={year:2===na.length?q(d(na)):d(na),month:Bc.indexOf(Ca)+
1,day:d(La),hour:d(Ua),minute:d(Za)};gb&&(na.second=d(gb));X&&(na.weekday=3<X.length?Dc.indexOf(X)+1:Gb.indexOf(X)+1);return na}function ha(X){const [,na,Ca,La,Ua,Za,gb,lb,pb,yb,ub,wb]=X;X=ca(na,Ua,La,Ca,Za,gb,lb);let Ab;Ab=pb?Xd[pb]:yb?0:C(ub,wb);return[X,new Qb(Ab)]}function ia(X){const [,na,Ca,La,Ua,Za,gb,lb]=X;return[ca(na,Ua,La,Ca,Za,gb,lb),Qb.utcInstance]}function ka(X){const [,na,Ca,La,Ua,Za,gb,lb]=X;return[ca(na,lb,Ca,La,Ua,Za,gb),Qb.utcInstance]}function la(X,na,Ca=!1){X={values:Ca?na.values:
{...X.values,...na.values||{}},loc:X.loc.clone(na.loc),conversionAccuracy:na.conversionAccuracy||X.conversionAccuracy};return new zb(X)}function Y(X,na,Ca,La,Ua){X=X[Ua][Ca];var Za=na[Ca]/X;Za=Math.sign(Za)!==Math.sign(La[Ua])&&0!==La[Ua]&&1>=Math.abs(Za)?0>Za?Math.floor(Za):Math.ceil(Za):Math.trunc(Za);La[Ua]+=Za;na[Ca]-=Za*X}function ea(X,na){Yd.reduce((Ca,La)=>{if(b(na[La]))return Ca;Ca&&Y(X,na,Ca,na,La);return La},null)}function ba(X,na){X=na.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf()-
X.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf();return Math.floor(zb.fromMillis(X).as("days"))}function Z(X,na,Ca){var La=[["years",(lb,pb)=>pb.year-lb.year],["quarters",(lb,pb)=>pb.quarter-lb.quarter],["months",(lb,pb)=>pb.month-lb.month+12*(pb.year-lb.year)],["weeks",(lb,pb)=>{lb=ba(lb,pb);return(lb-lb%7)/7}],["days",ba]];const Ua={};let Za,gb;for(const [lb,pb]of La)0<=Ca.indexOf(lb)&&(Za=lb,La=pb(X,na),gb=X.plus({[lb]:La}),gb>na?(X=X.plus({[lb]:La-1}),--La):X=gb,Ua[lb]=La);return[X,Ua,gb,
Za]}function fa(X,na,Ca,La){let [Ua,Za,gb,lb]=Z(X,na,Ca);X=na-Ua;Ca=Ca.filter(pb=>0<=["hours","minutes","seconds","milliseconds"].indexOf(pb));0===Ca.length&&(gb<na&&(gb=Ua.plus({[lb]:1})),gb!==Ua&&(Za[lb]=(Za[lb]||0)+X/(gb-Ua)));na=zb.fromObject(Za,La);return 0<Ca.length?zb.fromMillis(X,La).shiftTo(...Ca).plus(na):na}function ja({numberingSystem:X},na=""){return new RegExp(`${bd[X||"latn"]}${na}`)}function oa(X,na=Ca=>Ca){return{regex:X,deser:([Ca])=>{{let La=parseInt(Ca,10);if(isNaN(La)){La="";
for(let Ua=0;Ua<Ca.length;Ua++){const Za=Ca.charCodeAt(Ua);if(-1!==Ca[Ua].search(bd.hanidec))La+=Zd.indexOf(Ca[Ua]);else for(const gb in rd){const [lb,pb]=rd[gb];Za>=lb&&Za<=pb&&(La+=Za-lb)}}Ca=parseInt(La,10)}else Ca=La}return na(Ca)}}}function sa(X){return X.replace(/\./g,"\\.?").replace(cd,sd)}function qa(X,na){return null===X?null:{regex:RegExp(X.map(sa).join("|")),deser:([Ca])=>X.findIndex(La=>Ca.replace(/\./g,"").replace(cd," ").toLowerCase()===La.replace(/\./g,"").replace(cd," ").toLowerCase())+
na}}function Ha(X,na){return{regex:X,deser:([,Ca,La])=>C(Ca,La),groups:na}}function Ga(X){return{regex:X,deser:([na])=>na}}function pa(X,na){const Ca=ja(na),La=ja(na,"{2}"),Ua=ja(na,"{3}"),Za=ja(na,"{4}"),gb=ja(na,"{6}"),lb=ja(na,"{1,2}"),pb=ja(na,"{1,3}"),yb=ja(na,"{1,6}"),ub=ja(na,"{1,9}"),wb=ja(na,"{2,4}"),Ab=ja(na,"{4,6}"),Jb=cc=>({regex:RegExp(cc.val.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$\x26")),deser:([kc])=>kc,literal:!0}),Yb=(cc=>{if(X.literal)return Jb(cc);switch(cc.val){case "G":return qa(na.eras("short",
!1),0);case "GG":return qa(na.eras("long",!1),0);case "y":return oa(yb);case "yy":return oa(wb,q);case "yyyy":return oa(Za);case "yyyyy":return oa(Ab);case "yyyyyy":return oa(gb);case "M":return oa(lb);case "MM":return oa(La);case "MMM":return qa(na.months("short",!0,!1),1);case "MMMM":return qa(na.months("long",!0,!1),1);case "L":return oa(lb);case "LL":return oa(La);case "LLL":return qa(na.months("short",!1,!1),1);case "LLLL":return qa(na.months("long",!1,!1),1);case "d":return oa(lb);case "dd":return oa(La);
case "o":return oa(pb);case "ooo":return oa(Ua);case "HH":return oa(La);case "H":return oa(lb);case "hh":return oa(La);case "h":return oa(lb);case "mm":return oa(La);case "m":return oa(lb);case "q":return oa(lb);case "qq":return oa(La);case "s":return oa(lb);case "ss":return oa(La);case "S":return oa(pb);case "SSS":return oa(Ua);case "u":return Ga(ub);case "uu":return Ga(lb);case "uuu":return oa(Ca);case "a":return qa(na.meridiems(),0);case "kkkk":return oa(Za);case "kk":return oa(wb,q);case "W":return oa(lb);
case "WW":return oa(La);case "E":case "c":return oa(Ca);case "EEE":return qa(na.weekdays("short",!1,!1),1);case "EEEE":return qa(na.weekdays("long",!1,!1),1);case "ccc":return qa(na.weekdays("short",!0,!1),1);case "cccc":return qa(na.weekdays("long",!0,!1),1);case "Z":case "ZZ":return Ha(new RegExp(`([+-]${lb.source})(?::(${La.source}))?`),2);case "ZZZ":return Ha(new RegExp(`([+-]${lb.source})(${La.source})?`),2);case "z":return Ga(/[a-z_+-/]{1,256}?/i);default:return Jb(cc)}})(X)||{invalidReason:"missing Intl.DateTimeFormat.formatToParts support"};
Yb.token=X;return Yb}function Da(X){return[`^${X.map(na=>na.regex).reduce((na,Ca)=>`${na}(${Ca.source})`,"")}$`,X]}function ra(X,na,Ca){if(X=X.match(na)){na={};let La=1;for(const Ua in Ca)if(g(Ca,Ua)){const Za=Ca[Ua],gb=Za.groups?Za.groups+1:1;!Za.literal&&Za.token&&(na[Za.token.val[0]]=Za.deser(X.slice(La,La+gb)));La+=gb}return[X,na]}return[X,{}]}function Ea(X){const na=Ua=>{switch(Ua){case "S":return"millisecond";case "s":return"second";case "m":return"minute";case "h":case "H":return"hour";case "d":return"day";
case "o":return"ordinal";case "L":case "M":return"month";case "y":return"year";case "E":case "c":return"weekday";case "W":return"weekNumber";case "k":return"weekYear";case "q":return"quarter";default:return null}};let Ca=null,La;b(X.z)||(Ca=gc.create(X.z));b(X.Z)||(Ca||(Ca=new Qb(X.Z)),La=X.Z);b(X.q)||(X.M=3*(X.q-1)+1);b(X.h)||(12>X.h&&1===X.a?X.h+=12:12===X.h&&0===X.a&&(X.h=0));0===X.G&&X.y&&(X.y=-X.y);b(X.u)||(X.S=h(X.u));return[Object.keys(X).reduce((Ua,Za)=>{const gb=na(Za);gb&&(Ua[gb]=X[Za]);
return Ua},{}),Ca,La]}function Ia(){Fc||(Fc=Ba.fromMillis(1555555555555));return Fc}function Ma(X,na){if(X.literal)return X;const Ca=Rb.macroTokenToFormatOpts(X.val);if(!Ca)return X;na=Rb.create(na,Ca).formatDateTimeParts(Ia()).map(La=>{{const {type:Za,value:gb}=La;if("literal"===Za)La={literal:!0,val:gb};else{La=Ca[Za];var Ua=td[Za];"object"===typeof Ua&&(Ua=Ua[La]);La=Ua?{literal:!1,val:Ua}:void 0}}return La});return na.includes(void 0)?X:na}function Qa(X,na){return Array.prototype.concat(...X.map(Ca=>
Ma(Ca,na)))}function wa(X,na,Ca){Ca=Qa(Rb.parseFormat(Ca),X);var La=Ca.map(Za=>pa(Za,X));const Ua=La.find(Za=>Za.invalidReason);if(Ua)return{input:na,tokens:Ca,invalidReason:Ua.invalidReason};{const [Za,gb]=Da(La);La=RegExp(Za,"i");const [lb,pb]=ra(na,La,gb),[yb,ub,wb]=pb?Ea(pb):[null,null,void 0];if(g(pb,"a")&&g(pb,"H"))throw new ta("Can't include meridiem when specifying 24-hour format");return{input:na,tokens:Ca,regex:La,rawMatches:lb,matches:pb,result:yb,zone:ub,specificOffset:wb}}}function Ja(X,
na){return new Zb("unit out of range",`you specified ${na} (of type ${typeof na}) as a ${X}, which is invalid`)}function Ta(X,na,Ca){na=new Date(Date.UTC(X,na-1,Ca));100>X&&0<=X&&na.setUTCFullYear(na.getUTCFullYear()-1900);X=na.getUTCDay();return 0===X?7:X}function Xa(X,na){X=w(X)?Gc:Hc;const Ca=X.findIndex(La=>La<na);return{month:Ca+1,day:na-X[Ca]}}function ma(X){const {year:na,month:Ca,day:La}=X;var Ua=La+(w(na)?Gc:Hc)[Ca-1];const Za=Ta(na,Ca,La);Ua=Math.floor((Ua-Za+10)/7);let gb;1>Ua?(gb=na-1,
Ua=B(gb)):Ua>B(na)?(gb=na+1,Ua=1):gb=na;return{weekYear:gb,weekNumber:Ua,weekday:Za,...y(X)}}function $a(X){const {weekYear:na,weekNumber:Ca,weekday:La}=X;var Ua=Ta(na,1,4),Za=w(na)?366:365;Ua=7*Ca+La-Ua-3;1>Ua?(Za=na-1,Ua+=w(Za)?366:365):Ua>Za?(Za=na+1,Ua-=w(na)?366:365):Za=na;const {month:gb,day:lb}=Xa(Za,Ua);return{year:Za,month:gb,day:lb,...y(X)}}function xa(X){const {year:na,month:Ca,day:La}=X;var Ua=La+(w(na)?Gc:Hc)[Ca-1];return{year:na,ordinal:Ua,...y(X)}}function Ka(X){const {year:na,ordinal:Ca}=
X,{month:La,day:Ua}=Xa(na,Ca);return{year:na,month:La,day:Ua,...y(X)}}function Oa(X){const na=m(X.year),Ca=k(X.month,1,12),La=k(X.day,1,t(X.year,X.month));return na?Ca?La?!1:Ja("day",X.day):Ja("month",X.month):Ja("year",X.year)}function Va(X){const {hour:na,minute:Ca,second:La,millisecond:Ua}=X;X=k(na,0,23)||24===na&&0===Ca&&0===La&&0===Ua;const Za=k(Ca,0,59),gb=k(La,0,59),lb=k(Ua,0,999);return X?Za?gb?lb?!1:Ja("millisecond",Ua):Ja("second",La):Ja("minute",Ca):Ja("hour",na)}function Ra(X){return new Zb("unsupported zone",
`the zone "${X.name}" is not supported`)}function za(X){null===X.weekData&&(X.weekData=ma(X.c));return X.weekData}function ya(X,na){X={ts:X.ts,zone:X.zone,c:X.c,o:X.o,loc:X.loc,invalid:X.invalid};return new Ba({...X,...na,old:X})}function Na(X,na,Ca){let La=X-6E4*na;const Ua=Ca.offset(La);if(na===Ua)return[La,na];La-=6E4*(Ua-na);na=Ca.offset(La);return Ua===na?[La,Ua]:[X-6E4*Math.min(Ua,na),Math.max(Ua,na)]}function Wa(X,na){X=new Date(X+6E4*na);return{year:X.getUTCFullYear(),month:X.getUTCMonth()+
1,day:X.getUTCDate(),hour:X.getUTCHours(),minute:X.getUTCMinutes(),second:X.getUTCSeconds(),millisecond:X.getUTCMilliseconds()}}function bb(X,na,Ca){return Na(x(X),na,Ca)}function Aa(X,na){const Ca=X.o;var La=X.c.year+Math.trunc(na.years);const Ua=X.c.month+Math.trunc(na.months)+3*Math.trunc(na.quarters);La={...X.c,year:La,month:Ua,day:Math.min(X.c.day,t(La,Ua))+Math.trunc(na.days)+7*Math.trunc(na.weeks)};na=zb.fromObject({years:na.years-Math.trunc(na.years),quarters:na.quarters-Math.trunc(na.quarters),
months:na.months-Math.trunc(na.months),weeks:na.weeks-Math.trunc(na.weeks),days:na.days-Math.trunc(na.days),hours:na.hours,minutes:na.minutes,seconds:na.seconds,milliseconds:na.milliseconds}).as("milliseconds");La=x(La);let [Za,gb]=Na(La,Ca,X.zone);0!==na&&(Za+=na,gb=X.zone.offset(Za));return{ts:Za,o:gb}}function Pa(X,na,Ca,La,Ua,Za){const {setZone:gb,zone:lb}=Ca;return X&&0!==Object.keys(X).length?(X=Ba.fromObject(X,{...Ca,zone:na||lb,specificOffset:Za}),gb?X:X.setZone(lb)):Ba.invalid(new Zb("unparsable",
`the input "${Ua}" can't be parsed as ${La}`))}function ab(X,na,Ca=!0){return X.isValid?Rb.create(Eb.create("en-US"),{allowZ:Ca,forceSimple:!0}).formatDateTimeFromString(X,na):null}function fb(X,na){const Ca=9999<X.c.year||0>X.c.year;let La="";Ca&&0<=X.c.year&&(La+="+");La+=f(X.c.year,Ca?6:4);na?(La=La+"-"+f(X.c.month),La=La+"-"+f(X.c.day)):(La+=f(X.c.month),La+=f(X.c.day));return La}function hb(X,na,Ca,La,Ua,Za){let gb=f(X.c.hour);na?(gb=gb+":"+f(X.c.minute),0===X.c.second&&Ca||(gb+=":")):gb+=f(X.c.minute);
0===X.c.second&&Ca||(gb+=f(X.c.second),0===X.c.millisecond&&La||(gb=gb+"."+f(X.c.millisecond,3)));Ua&&(X.isOffsetFixed&&0===X.offset&&!Za?gb+="Z":0>X.o?(gb=gb+"-"+f(Math.trunc(-X.o/60)),gb=gb+":"+f(Math.trunc(-X.o%60))):(gb=gb+"+"+f(Math.trunc(X.o/60)),gb=gb+":"+f(Math.trunc(X.o%60))));Za&&(gb+="["+X.zone.ianaName+"]");return gb}function kb(X){const na={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",
quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[X.toLowerCase()];if(!na)throw new Fa(X);return na}function nb(X,na){const Ca=K(na.zone,Lb.defaultZone);na=Eb.fromObject(na);const La=Lb.now();var Ua;if(b(X.year))X=La;else{for(const Za of Ic)b(X[Za])&&(X[Za]=ua[Za]);if(Ua=Oa(X)||
Va(X))return Ba.invalid(Ua);Ua=Ca.offset(La);[X,Ua]=bb(X,Ua,Ca)}return new Ba({ts:X,zone:Ca,loc:na,o:Ua})}function rb(X,na,Ca){const La=b(Ca.round)?!0:Ca.round,Ua=(gb,lb)=>{gb=v(gb,La||Ca.calendary?0:2,!0);return na.loc.clone(Ca).relFormatter(Ca).format(gb,lb)},Za=gb=>Ca.calendary?na.hasSame(X,gb)?0:na.startOf(gb).diff(X.startOf(gb),gb).get(gb):na.diff(X,gb).get(gb);if(Ca.unit)return Ua(Za(Ca.unit),Ca.unit);for(const gb of Ca.units){const lb=Za(gb);if(1<=Math.abs(lb))return Ua(lb,gb)}return Ua(X>
na?-0:0,Ca.units[Ca.units.length-1])}function sb(X){let na={};0<X.length&&"object"===typeof X[X.length-1]?(na=X[X.length-1],X=Array.from(X).slice(0,X.length-1)):X=Array.from(X);return[na,X]}function jb(X){if(Ba.isDateTime(X))return X;if(X&&X.valueOf&&c(X.valueOf()))return Ba.fromJSDate(X);if(X&&"object"===typeof X)return Ba.fromObject(X);throw new Sa(`Unknown datetime argument: ${X}, of type ${typeof X}`);}class qb extends Error{}class ob extends qb{constructor(X){super(`Invalid DateTime: ${X.toMessage()}`)}}
class db extends qb{constructor(X){super(`Invalid Interval: ${X.toMessage()}`)}}class va extends qb{constructor(X){super(`Invalid Duration: ${X.toMessage()}`)}}class ta extends qb{}class Fa extends qb{constructor(X){super(`Invalid unit ${X}`)}}class Sa extends qb{}class Ya extends qb{constructor(){super("Zone is an abstract class")}}const cb={year:"numeric",month:"numeric",day:"numeric"},ib={year:"numeric",month:"short",day:"numeric"},mb={year:"numeric",month:"short",day:"numeric",weekday:"short"},
tb={year:"numeric",month:"long",day:"numeric"},Bb={year:"numeric",month:"long",day:"numeric",weekday:"long"},xb={hour:"numeric",minute:"numeric"},Hb={hour:"numeric",minute:"numeric",second:"numeric"},Ub={hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},Mb={hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"long"},vb={hour:"numeric",minute:"numeric",hourCycle:"h23"},Ib={hour:"numeric",minute:"numeric",second:"numeric",hourCycle:"h23"},Pb={hour:"numeric",minute:"numeric",
second:"numeric",hourCycle:"h23",timeZoneName:"short"},Sb={hour:"numeric",minute:"numeric",second:"numeric",hourCycle:"h23",timeZoneName:"long"},$b={year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric"},Jc={year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},ac={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"},rc={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},
hc={year:"numeric",month:"short",day:"numeric",weekday:"short",hour:"numeric",minute:"numeric"},wc={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",timeZoneName:"short"},xc={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},sc={year:"numeric",month:"long",day:"numeric",weekday:"long",hour:"numeric",minute:"numeric",timeZoneName:"long"},tc={year:"numeric",month:"long",day:"numeric",weekday:"long",hour:"numeric",
minute:"numeric",second:"numeric",timeZoneName:"long"},lc=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/,Cc="January February March April May June July August September October November December".split(" "),Bc="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),Kb="JFMAMJJASOND".split(""),Dc="Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),Gb="Mon Tue Wed Thu Fri Sat Sun".split(" "),bc="MTWTFSS".split(""),yc=["AM","PM"],Zc=["Before Christ",
"Anno Domini"],Yc=["BC","AD"],Vd=["B","A"],ud={D:cb,DD:ib,DDD:tb,DDDD:Bb,t:xb,tt:Hb,ttt:Ub,tttt:Mb,T:vb,TT:Ib,TTT:Pb,TTTT:Sb,f:$b,ff:ac,fff:wc,ffff:sc,F:Jc,FF:rc,FFF:xc,FFFF:tc};class Rb{static create(X,na={}){return new Rb(X,na)}static parseFormat(X){let na=null,Ca="",La=!1;const Ua=[];for(let Za=0;Za<X.length;Za++){const gb=X.charAt(Za);"'"===gb?(0<Ca.length&&Ua.push({literal:La,val:Ca}),na=null,Ca="",La=!La):La?Ca+=gb:gb===na?Ca+=gb:(0<Ca.length&&Ua.push({literal:!1,val:Ca}),na=Ca=gb)}0<Ca.length&&
Ua.push({literal:La,val:Ca});return Ua}static macroTokenToFormatOpts(X){return ud[X]}constructor(X,na){this.opts=na;this.loc=X;this.systemLoc=null}formatWithSystemDefault(X,na){null===this.systemLoc&&(this.systemLoc=this.loc.redefaultToSystem());return this.systemLoc.dtFormatter(X,{...this.opts,...na}).format()}formatDateTime(X,na={}){return this.loc.dtFormatter(X,{...this.opts,...na}).format()}formatDateTimeParts(X,na={}){return this.loc.dtFormatter(X,{...this.opts,...na}).formatToParts()}resolvedOptions(X,
na={}){return this.loc.dtFormatter(X,{...this.opts,...na}).resolvedOptions()}num(X,na=0){if(this.opts.forceSimple)return f(X,na);const Ca={...this.opts};0<na&&(Ca.padTo=na);return this.loc.numberFormatter(Ca).format(X)}formatDateTimeFromString(X,na){const Ca="en"===this.loc.listingMode(),La=this.loc.outputCalendar&&"gregory"!==this.loc.outputCalendar,Ua=(ub,wb)=>this.loc.extract(X,ub,wb),Za=ub=>X.isOffsetFixed&&0===X.offset&&ub.allowZ?"Z":X.isValid?X.zone.formatOffset(X.ts,ub.format):"",gb=(ub,wb)=>
Ca?D(ub)[X.month-1]:Ua(wb?{month:ub}:{month:ub,day:"numeric"},"month"),lb=(ub,wb)=>Ca?E(ub)[X.weekday-1]:Ua(wb?{weekday:ub}:{weekday:ub,month:"long",day:"numeric"},"weekday"),pb=ub=>{const wb=Rb.macroTokenToFormatOpts(ub);return wb?this.formatWithSystemDefault(X,wb):ub},yb=ub=>Ca?F(ub)[0>X.year?0:1]:Ua({era:ub},"era");return P(Rb.parseFormat(na),ub=>{switch(ub){case "S":return this.num(X.millisecond);case "u":case "SSS":return this.num(X.millisecond,3);case "s":return this.num(X.second);case "ss":return this.num(X.second,
2);case "uu":return this.num(Math.floor(X.millisecond/10),2);case "uuu":return this.num(Math.floor(X.millisecond/100));case "m":return this.num(X.minute);case "mm":return this.num(X.minute,2);case "h":return this.num(0===X.hour%12?12:X.hour%12);case "hh":return this.num(0===X.hour%12?12:X.hour%12,2);case "H":return this.num(X.hour);case "HH":return this.num(X.hour,2);case "Z":return Za({format:"narrow",allowZ:this.opts.allowZ});case "ZZ":return Za({format:"short",allowZ:this.opts.allowZ});case "ZZZ":return Za({format:"techie",
allowZ:this.opts.allowZ});case "ZZZZ":return X.zone.offsetName(X.ts,{format:"short",locale:this.loc.locale});case "ZZZZZ":return X.zone.offsetName(X.ts,{format:"long",locale:this.loc.locale});case "z":return X.zoneName;case "a":return Ca?yc[12>X.hour?0:1]:Ua({hour:"numeric",hourCycle:"h12"},"dayperiod");case "d":return La?Ua({day:"numeric"},"day"):this.num(X.day);case "dd":return La?Ua({day:"2-digit"},"day"):this.num(X.day,2);case "c":return this.num(X.weekday);case "ccc":return lb("short",!0);case "cccc":return lb("long",
!0);case "ccccc":return lb("narrow",!0);case "E":return this.num(X.weekday);case "EEE":return lb("short",!1);case "EEEE":return lb("long",!1);case "EEEEE":return lb("narrow",!1);case "L":return La?Ua({month:"numeric",day:"numeric"},"month"):this.num(X.month);case "LL":return La?Ua({month:"2-digit",day:"numeric"},"month"):this.num(X.month,2);case "LLL":return gb("short",!0);case "LLLL":return gb("long",!0);case "LLLLL":return gb("narrow",!0);case "M":return La?Ua({month:"numeric"},"month"):this.num(X.month);
case "MM":return La?Ua({month:"2-digit"},"month"):this.num(X.month,2);case "MMM":return gb("short",!1);case "MMMM":return gb("long",!1);case "MMMMM":return gb("narrow",!1);case "y":return La?Ua({year:"numeric"},"year"):this.num(X.year);case "yy":return La?Ua({year:"2-digit"},"year"):this.num(X.year.toString().slice(-2),2);case "yyyy":return La?Ua({year:"numeric"},"year"):this.num(X.year,4);case "yyyyyy":return La?Ua({year:"numeric"},"year"):this.num(X.year,6);case "G":return yb("short");case "GG":return yb("long");
case "GGGGG":return yb("narrow");case "kk":return this.num(X.weekYear.toString().slice(-2),2);case "kkkk":return this.num(X.weekYear,4);case "W":return this.num(X.weekNumber);case "WW":return this.num(X.weekNumber,2);case "o":return this.num(X.ordinal);case "ooo":return this.num(X.ordinal,3);case "q":return this.num(X.quarter);case "qq":return this.num(X.quarter,2);case "X":return this.num(Math.floor(X.ts/1E3));case "x":return this.num(X.ts);default:return pb(ub)}})}formatDurationFromString(X,na){const Ca=
Ua=>{switch(Ua[0]){case "S":return"millisecond";case "s":return"second";case "m":return"minute";case "h":return"hour";case "d":return"day";case "w":return"week";case "M":return"month";case "y":return"year";default:return null}};na=Rb.parseFormat(na);const La=na.reduce((Ua,{literal:Za,val:gb})=>Za?Ua:Ua.concat(gb),[]);X=X.shiftTo(...La.map(Ca).filter(Ua=>Ua));return P(na,(Ua=>Za=>{const gb=Ca(Za);return gb?this.num(Ua.get(gb),Za.length):Za})(X))}}class Zb{constructor(X,na){this.reason=X;this.explanation=
na}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}class vc{get type(){throw new Ya;}get name(){throw new Ya;}get ianaName(){return this.name}get isUniversal(){throw new Ya;}offsetName(X,na){throw new Ya;}formatOffset(X,na){throw new Ya;}offset(X){throw new Ya;}equals(X){throw new Ya;}get isValid(){throw new Ya;}}let dd=null;class ed extends vc{static get instance(){null===dd&&(dd=new ed);return dd}get type(){return"system"}get name(){return(new Intl.DateTimeFormat).resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(X,
{format:na,locale:Ca}){return u(X,na,Ca)}formatOffset(X,na){return p(this.offset(X),na)}offset(X){return-(new Date(X)).getTimezoneOffset()}equals(X){return"system"===X.type}get isValid(){return!0}}let Kc={};const vd={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};let Lc={};class gc extends vc{static create(X){Lc[X]||(Lc[X]=new gc(X));return Lc[X]}static resetCache(){Lc={};Kc={}}static isValidSpecifier(X){return this.isValidZone(X)}static isValidZone(X){if(!X)return!1;try{return(new Intl.DateTimeFormat("en-US",
{timeZone:X})).format(),!0}catch(na){return!1}}constructor(X){super();this.zoneName=X;this.valid=gc.isValidZone(X)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(X,{format:na,locale:Ca}){return u(X,na,Ca,this.name)}formatOffset(X,na){return p(this.offset(X),na)}offset(X){X=new Date(X);if(isNaN(X))return NaN;var na=this.name;Kc[na]||(Kc[na]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:na,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",
minute:"2-digit",second:"2-digit",era:"short"}));na=Kc[na];if(na.formatToParts){na=na.formatToParts(X);var Ca=[];for(let ub=0;ub<na.length;ub++){const {type:wb,value:Ab}=na[ub],Jb=vd[wb];"era"===wb?Ca[Jb]=Ab:b(Jb)||(Ca[Jb]=parseInt(Ab,10))}na=Ca}else{{na=na.format(X).replace(/\u200E/g,"");na=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(na);const [,ub,wb,Ab,Jb,Yb,cc,kc]=na;na=[Ab,ub,wb,Jb,Yb,cc,kc]}}let [La,Ua,Za,gb,lb,pb,yb]=na;"BC"===gb&&(La=-Math.abs(La)+1);na=x({year:La,month:Ua,day:Za,
hour:24===lb?0:lb,minute:pb,second:yb,millisecond:0});X=+X;Ca=X%1E3;return(na-(X-(0<=Ca?Ca:1E3+Ca)))/6E4}equals(X){return"iana"===X.type&&X.name===this.name}get isValid(){return this.valid}}let fd=null;class Qb extends vc{static get utcInstance(){null===fd&&(fd=new Qb(0));return fd}static instance(X){return 0===X?Qb.utcInstance:new Qb(X)}static parseSpecifier(X){return X&&(X=X.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i))?new Qb(C(X[1],X[2])):null}constructor(X){super();this.fixed=X}get type(){return"fixed"}get name(){return 0===
this.fixed?"UTC":`UTC${p(this.fixed,"narrow")}`}get ianaName(){return 0===this.fixed?"Etc/UTC":`Etc/GMT${p(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(X,na){return p(this.fixed,na)}get isUniversal(){return!0}offset(){return this.fixed}equals(X){return"fixed"===X.type&&X.fixed===this.fixed}get isValid(){return!0}}class Wd extends vc{constructor(X){super();this.zoneName=X}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}
let wd=()=>Date.now(),Mc="system",Nc=null,xd=null,yd=null,zd;class Lb{static get now(){return wd}static set now(X){wd=X}static set defaultZone(X){Mc=X}static get defaultZone(){return K(Mc,ed.instance)}static get defaultLocale(){return Nc}static set defaultLocale(X){Nc=X}static get defaultNumberingSystem(){return xd}static set defaultNumberingSystem(X){xd=X}static get defaultOutputCalendar(){return yd}static set defaultOutputCalendar(X){yd=X}static get throwOnInvalid(){return zd}static set throwOnInvalid(X){zd=
X}static resetCaches(){Eb.resetCache();gc.resetCache()}}let qd={},$c={},Ec={},ad={},zc=null;class Ad{constructor(X,na,Ca){this.padTo=Ca.padTo||0;this.floor=Ca.floor||!1;const {padTo:La,floor:Ua,...Za}=Ca;if(!na||0<Object.keys(Za).length)na={useGrouping:!1,...Ca},0<Ca.padTo&&(na.minimumIntegerDigits=Ca.padTo),this.inf=L(X,na)}format(X){if(this.inf)return this.inf.format(this.floor?Math.floor(X):X);X=this.floor?Math.floor(X):v(X,3);return f(X,this.padTo)}}class $d{constructor(X,na,Ca){this.opts=Ca;
if(X.zone.isUniversal){var La=X.offset/60*-1;La=0<=La?`Etc/GMT+${La}`:`Etc/GMT${La}`;0!==X.offset&&gc.create(La).valid?this.dt=X:(La="UTC",this.dt=Ca.timeZoneName?X:0===X.offset?X:Ba.fromMillis(X.ts+6E4*X.offset))}else"system"===X.zone.type?this.dt=X:(this.dt=X,La=X.zone.name);X={...this.opts};La&&(X.timeZone=La);this.dtf=M(na,X)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}
class ae{constructor(X,na,Ca){this.opts={style:"long",...Ca};!na&&l()&&(this.rtf=J(X,Ca))}format(X,na){return this.rtf?this.rtf.format(X,na):G(na,X,this.opts.numeric,"long"!==this.opts.style)}formatToParts(X,na){return this.rtf?this.rtf.formatToParts(X,na):[]}}class Eb{static fromOpts(X){return Eb.create(X.locale,X.numberingSystem,X.outputCalendar,X.defaultToEN)}static create(X,na,Ca,La=!1){X=X||Lb.defaultLocale;var Ua;(Ua=X)||(La?La="en-US":(zc||(zc=(new Intl.DateTimeFormat).resolvedOptions().locale),
La=zc),Ua=La);return new Eb(Ua,na||Lb.defaultNumberingSystem,Ca||Lb.defaultOutputCalendar,X)}static resetCache(){zc=null;$c={};Ec={};ad={}}static fromObject({locale:X,numberingSystem:na,outputCalendar:Ca}={}){return Eb.create(X,na,Ca)}constructor(X,na,Ca,La){var Ua=X.indexOf("-u-");if(-1===Ua)X=[X];else{let pb;Ua=X.substring(0,Ua);try{pb=M(X).resolvedOptions()}catch(wb){pb=M(Ua).resolvedOptions()}const {numberingSystem:yb,calendar:ub}=pb;X=[Ua,yb,ub]}const [Za,gb,lb]=X;this.locale=Za;this.numberingSystem=
na||gb||null;this.outputCalendar=Ca||lb||null;na=this.locale;Ca=this.numberingSystem;if((X=this.outputCalendar)||Ca)na+="-u",X&&(na+=`-ca-${X}`),Ca&&(na+=`-nu-${Ca}`);this.intl=na;this.weekdaysCache={format:{},standalone:{}};this.monthsCache={format:{},standalone:{}};this.meridiemCache=null;this.eraCache={};this.specifiedLocale=La;this.fastNumbersCached=null}get fastNumbers(){if(null==this.fastNumbersCached){var X=this.numberingSystem&&"latn"!==this.numberingSystem?!1:"latn"===this.numberingSystem||
!this.locale||this.locale.startsWith("en")||"latn"===(new Intl.DateTimeFormat(this.intl)).resolvedOptions().numberingSystem;this.fastNumbersCached=X}return this.fastNumbersCached}listingMode(){const X=this.isEnglish(),na=(null===this.numberingSystem||"latn"===this.numberingSystem)&&(null===this.outputCalendar||"gregory"===this.outputCalendar);return X&&na?"en":"intl"}clone(X){return X&&0!==Object.getOwnPropertyNames(X).length?Eb.create(X.locale||this.specifiedLocale,X.numberingSystem||this.numberingSystem,
X.outputCalendar||this.outputCalendar,X.defaultToEN||!1):this}redefaultToEN(X={}){return this.clone({...X,defaultToEN:!0})}redefaultToSystem(X={}){return this.clone({...X,defaultToEN:!1})}months(X,na=!1,Ca=!0){return O(this,X,Ca,D,()=>{const La=na?{month:X,day:"numeric"}:{month:X},Ua=na?"format":"standalone";this.monthsCache[Ua][X]||(this.monthsCache[Ua][X]=H(Za=>this.extract(Za,La,"month")));return this.monthsCache[Ua][X]})}weekdays(X,na=!1,Ca=!0){return O(this,X,Ca,E,()=>{const La=na?{weekday:X,
year:"numeric",month:"long",day:"numeric"}:{weekday:X},Ua=na?"format":"standalone";this.weekdaysCache[Ua][X]||(this.weekdaysCache[Ua][X]=I(Za=>this.extract(Za,La,"weekday")));return this.weekdaysCache[Ua][X]})}meridiems(X=!0){return O(this,void 0,X,()=>yc,()=>{if(!this.meridiemCache){const na={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[Ba.utc(2016,11,13,9),Ba.utc(2016,11,13,19)].map(Ca=>this.extract(Ca,na,"dayperiod"))}return this.meridiemCache})}eras(X,na=!0){return O(this,X,na,F,()=>{const Ca=
{era:X};this.eraCache[X]||(this.eraCache[X]=[Ba.utc(-40,1,1),Ba.utc(2017,1,1)].map(La=>this.extract(La,Ca,"era")));return this.eraCache[X]})}extract(X,na,Ca){return(X=this.dtFormatter(X,na).formatToParts().find(La=>La.type.toLowerCase()===Ca))?X.value:null}numberFormatter(X={}){return new Ad(this.intl,X.forceSimple||this.fastNumbers,X)}dtFormatter(X,na={}){return new $d(X,this.intl,na)}relFormatter(X={}){return new ae(this.intl,this.isEnglish(),X)}listFormatter(X={}){return N(this.intl,X)}isEnglish(){return"en"===
this.locale||"en-us"===this.locale.toLowerCase()||(new Intl.DateTimeFormat(this.intl)).resolvedOptions().locale.startsWith("en-us")}equals(X){return this.locale===X.locale&&this.numberingSystem===X.numberingSystem&&this.outputCalendar===X.outputCalendar}}const Bd=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,gd=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,Cd=RegExp(`${gd.source}${`(?:${Bd.source}?(?:\\[(${lc.source})\\])?)?`}`),hd=RegExp(`(?:T${Cd.source})?`),be=U("weekYear","weekNumber","weekDay"),
ce=U("year","ordinal"),Dd=RegExp(`${gd.source} ?(?:${Bd.source}|(${lc.source}))?`),de=RegExp(`(?: ${Dd.source})?`),ee=RegExp(`^T?${gd.source}$`),fe=/^-?P(?:(?:(-?\d{1,9}(?:\.\d{1,9})?)Y)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,9}(?:\.\d{1,9})?)W)?(?:(-?\d{1,9}(?:\.\d{1,9})?)D)?(?:T(?:(-?\d{1,9}(?:\.\d{1,9})?)H)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,9}))?S)?)?)$/,Xd={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480},ge=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/,
he=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,ie=/^(Monday|Tuesday|Wedsday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,je=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/,ke=Q(/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,hd),le=Q(/(\d{4})-?W(\d\d)(?:-?(\d))?/,hd),
me=Q(/(\d{4})-?(\d{3})/,hd),ne=Q(Cd),Ed=S(function(X,na){return[{year:aa(X,na),month:aa(X,na+1,1),day:aa(X,na+2,1)},null,na+3]},W,R,V),oe=S(be,W,R,V),pe=S(ce,W,R,V),qe=S(W,R,V),re=S(W),se=Q(/(\d{4})-(\d\d)-(\d\d)/,de),te=Q(Dd),ue=S(W,R,V),Fd={weeks:{days:7,hours:168,minutes:10080,seconds:604800,milliseconds:6048E5},days:{hours:24,minutes:1440,seconds:86400,milliseconds:864E5},hours:{minutes:60,seconds:3600,milliseconds:36E5},minutes:{seconds:60,milliseconds:6E4},seconds:{milliseconds:1E3}},ve={years:{quarters:4,
months:12,weeks:52,days:365,hours:8760,minutes:525600,seconds:31536E3,milliseconds:31536E6},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:131040,seconds:7862400,milliseconds:78624E5},months:{weeks:4,days:30,hours:720,minutes:43200,seconds:2592E3,milliseconds:2592E6},...Fd},we={years:{quarters:4,months:12,weeks:52.1775,days:365.2425,hours:8765.82,minutes:525949.2,seconds:31556952,milliseconds:31556952E3},quarters:{months:3,weeks:13.044375,days:91.310625,hours:2191.455,minutes:131487.3,seconds:7889238,
milliseconds:7889238E3},months:{weeks:30.436875/7,days:30.436875,hours:730.485,minutes:43829.1,seconds:2629746,milliseconds:2629746E3},...Fd},mc="years quarters months weeks days hours minutes seconds milliseconds".split(" "),Yd=mc.slice(0).reverse();class zb{constructor(X){const na="longterm"===X.conversionAccuracy||!1;this.values=X.values;this.loc=X.loc||Eb.create();this.conversionAccuracy=na?"longterm":"casual";this.invalid=X.invalid||null;this.matrix=na?we:ve;this.isLuxonDuration=!0}static fromMillis(X,
na){return zb.fromObject({milliseconds:X},na)}static fromObject(X,na={}){if(null==X||"object"!==typeof X)throw new Sa(`Duration.fromObject: argument expected to be an object, got ${null===X?"null":typeof X}`);return new zb({values:A(X,zb.normalizeUnit),loc:Eb.fromObject(na),conversionAccuracy:na.conversionAccuracy})}static fromDurationLike(X){if(c(X))return zb.fromMillis(X);if(zb.isDuration(X))return X;if("object"===typeof X)return zb.fromObject(X);throw new Sa(`Unknown duration argument ${X} of type ${typeof X}`);
}static fromISO(X,na){const [Ca]=T(X,[fe,da]);return Ca?zb.fromObject(Ca,na):zb.invalid("unparsable",`the input "${X}" can't be parsed as ISO 8601`)}static fromISOTime(X,na){const [Ca]=T(X,[ee,re]);return Ca?zb.fromObject(Ca,na):zb.invalid("unparsable",`the input "${X}" can't be parsed as ISO 8601`)}static invalid(X,na=null){if(!X)throw new Sa("need to specify a reason the Duration is invalid");X=X instanceof Zb?X:new Zb(X,na);if(Lb.throwOnInvalid)throw new va(X);return new zb({invalid:X})}static normalizeUnit(X){const na=
{year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[X?X.toLowerCase():X];if(!na)throw new Fa(X);return na}static isDuration(X){return X&&X.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?
this.loc.numberingSystem:null}toFormat(X,na={}){na={...na,floor:!1!==na.round&&!1!==na.floor};return this.isValid?Rb.create(this.loc,na).formatDurationFromString(this,X):"Invalid Duration"}toHuman(X={}){const na=mc.map(Ca=>{const La=this.values[Ca];return b(La)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...X,unit:Ca.slice(0,-1)}).format(La)}).filter(Ca=>Ca);return this.loc.listFormatter({type:"conjunction",style:X.listStyle||"narrow",...X}).format(na)}toObject(){return this.isValid?
{...this.values}:{}}toISO(){if(!this.isValid)return null;let X="P";0!==this.years&&(X+=this.years+"Y");if(0!==this.months||0!==this.quarters)X+=this.months+3*this.quarters+"M";0!==this.weeks&&(X+=this.weeks+"W");0!==this.days&&(X+=this.days+"D");if(0!==this.hours||0!==this.minutes||0!==this.seconds||0!==this.milliseconds)X+="T";0!==this.hours&&(X+=this.hours+"H");0!==this.minutes&&(X+=this.minutes+"M");if(0!==this.seconds||0!==this.milliseconds)X+=v(this.seconds+this.milliseconds/1E3,3)+"S";"P"===
X&&(X+="T0S");return X}toISOTime(X={}){if(!this.isValid)return null;var na=this.toMillis();if(0>na||864E5<=na)return null;X={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",...X};na=this.shiftTo("hours","minutes","seconds","milliseconds");let Ca="basic"===X.format?"hhmm":"hh:mm";X.suppressSeconds&&0===na.seconds&&0===na.milliseconds||(Ca+="basic"===X.format?"ss":":ss",X.suppressMilliseconds&&0===na.milliseconds||(Ca+=".SSS"));na=na.toFormat(Ca);X.includePrefix&&(na="T"+
na);return na}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(X){if(!this.isValid)return this;X=zb.fromDurationLike(X);const na={};for(const Ca of mc)if(g(X.values,Ca)||g(this.values,Ca))na[Ca]=X.get(Ca)+this.get(Ca);return la(this,{values:na},!0)}minus(X){if(!this.isValid)return this;X=zb.fromDurationLike(X);return this.plus(X.negate())}mapUnits(X){if(!this.isValid)return this;const na={};for(const Ca of Object.keys(this.values))na[Ca]=
z(X(this.values[Ca],Ca));return la(this,{values:na},!0)}get(X){return this[zb.normalizeUnit(X)]}set(X){if(!this.isValid)return this;X={...this.values,...A(X,zb.normalizeUnit)};return la(this,{values:X})}reconfigure({locale:X,numberingSystem:na,conversionAccuracy:Ca}={}){X={loc:this.loc.clone({locale:X,numberingSystem:na})};Ca&&(X.conversionAccuracy=Ca);return la(this,X)}as(X){return this.isValid?this.shiftTo(X).get(X):NaN}normalize(){if(!this.isValid)return this;const X=this.toObject();ea(this.matrix,
X);return la(this,{values:X},!0)}shiftTo(...X){if(!this.isValid||0===X.length)return this;X=X.map(Za=>zb.normalizeUnit(Za));const na={},Ca={},La=this.toObject();let Ua;for(const Za of mc)if(0<=X.indexOf(Za)){Ua=Za;let gb=0;for(const pb in Ca)gb+=this.matrix[pb][Za]*Ca[pb],Ca[pb]=0;c(La[Za])&&(gb+=La[Za]);const lb=Math.trunc(gb);na[Za]=lb;Ca[Za]=(1E3*gb-1E3*lb)/1E3;for(const pb in La)mc.indexOf(pb)>mc.indexOf(Za)&&Y(this.matrix,La,pb,na,Za)}else c(La[Za])&&(Ca[Za]=La[Za]);for(const Za in Ca)0!==Ca[Za]&&
(na[Ua]+=Za===Ua?Ca[Za]:Ca[Za]/this.matrix[Ua][Za]);return la(this,{values:na},!0).normalize()}negate(){if(!this.isValid)return this;const X={};for(const na of Object.keys(this.values))X[na]=0===this.values[na]?0:-this.values[na];return la(this,{values:X},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?
this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(X){if(!this.isValid||!X.isValid||!this.loc.equals(X.loc))return!1;
for(const La of mc){var na=this.values[La];var Ca=X.values[La];na=void 0===na||0===na?void 0===Ca||0===Ca:na===Ca;if(!na)return!1}return!0}}class Fb{constructor(X){this.s=X.start;this.e=X.end;this.invalid=X.invalid||null;this.isLuxonInterval=!0}static invalid(X,na=null){if(!X)throw new Sa("need to specify a reason the Interval is invalid");X=X instanceof Zb?X:new Zb(X,na);if(Lb.throwOnInvalid)throw new db(X);return new Fb({invalid:X})}static fromDateTimes(X,na){X=jb(X);na=jb(na);var Ca=X&&X.isValid?
na&&na.isValid?na<X?Fb.invalid("end before start",`The end of an interval must be after its start, but you had start=${X.toISO()} and end=${na.toISO()}`):null:Fb.invalid("missing or invalid end"):Fb.invalid("missing or invalid start");return null==Ca?new Fb({start:X,end:na}):Ca}static after(X,na){na=zb.fromDurationLike(na);X=jb(X);return Fb.fromDateTimes(X,X.plus(na))}static before(X,na){na=zb.fromDurationLike(na);X=jb(X);return Fb.fromDateTimes(X.minus(na),X)}static fromISO(X,na){const [Ca,La]=(X||
"").split("/",2);if(Ca&&La){let gb;try{var Ua=Ba.fromISO(Ca,na);gb=Ua.isValid}catch(pb){gb=!1}let lb;try{var Za=Ba.fromISO(La,na);lb=Za.isValid}catch(pb){lb=!1}if(gb&&lb)return Fb.fromDateTimes(Ua,Za);if(gb){if(Za=zb.fromISO(La,na),Za.isValid)return Fb.after(Ua,Za)}else if(lb&&(Ua=zb.fromISO(Ca,na),Ua.isValid))return Fb.before(Za,Ua)}return Fb.invalid("unparsable",`the input "${X}" can't be parsed as ISO 8601`)}static isInterval(X){return X&&X.isLuxonInterval||!1}get start(){return this.isValid?this.s:
null}get end(){return this.isValid?this.e:null}get isValid(){return null===this.invalidReason}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(X="milliseconds"){return this.isValid?this.toDuration(...[X]).get(X):NaN}count(X="milliseconds"){if(!this.isValid)return NaN;const na=this.start.startOf(X),Ca=this.end.startOf(X);return Math.floor(Ca.diff(na,X).get(X))+1}hasSame(X){return this.isValid?this.isEmpty()||
this.e.minus(1).hasSame(this.s,X):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(X){return this.isValid?this.s>X:!1}isBefore(X){return this.isValid?this.e<=X:!1}contains(X){return this.isValid?this.s<=X&&this.e>X:!1}set({start:X,end:na}={}){return this.isValid?Fb.fromDateTimes(X||this.s,na||this.e):this}splitAt(...X){if(!this.isValid)return[];X=X.map(jb).filter(Za=>this.contains(Za)).sort();const na=[];let {s:Ca}=this,La=0;for(;Ca<this.e;){var Ua=X[La]||this.e;Ua=+Ua>+this.e?this.e:
Ua;na.push(Fb.fromDateTimes(Ca,Ua));Ca=Ua;La+=1}return na}splitBy(X){X=zb.fromDurationLike(X);if(!this.isValid||!X.isValid||0===X.as("milliseconds"))return[];let {s:na}=this,Ca=1;const La=[];for(;na<this.e;){var Ua=this.start.plus(X.mapUnits(Za=>Za*Ca));Ua=+Ua>+this.e?this.e:Ua;La.push(Fb.fromDateTimes(na,Ua));na=Ua;Ca+=1}return La}divideEqually(X){return this.isValid?this.splitBy(this.length()/X).slice(0,X):[]}overlaps(X){return this.e>X.s&&this.s<X.e}abutsStart(X){return this.isValid?+this.e===
+X.s:!1}abutsEnd(X){return this.isValid?+X.e===+this.s:!1}engulfs(X){return this.isValid?this.s<=X.s&&this.e>=X.e:!1}equals(X){return this.isValid&&X.isValid?this.s.equals(X.s)&&this.e.equals(X.e):!1}intersection(X){if(!this.isValid)return this;const na=this.s>X.s?this.s:X.s;X=this.e<X.e?this.e:X.e;return na>=X?null:Fb.fromDateTimes(na,X)}union(X){return this.isValid?Fb.fromDateTimes(this.s<X.s?this.s:X.s,this.e>X.e?this.e:X.e):this}static merge(X){const [na,Ca]=X.sort((La,Ua)=>La.s-Ua.s).reduce(([La,
Ua],Za)=>Ua?Ua.overlaps(Za)||Ua.abutsStart(Za)?[La,Ua.union(Za)]:[La.concat([Ua]),Za]:[La,Za],[[],null]);Ca&&na.push(Ca);return na}static xor(X){let na=null,Ca=0;const La=[];X=X.map(Ua=>[{time:Ua.s,type:"s"},{time:Ua.e,type:"e"}]);X=Array.prototype.concat(...X).sort((Ua,Za)=>Ua.time-Za.time);for(const Ua of X)Ca+="s"===Ua.type?1:-1,1===Ca?na=Ua.time:(na&&+na!==+Ua.time&&La.push(Fb.fromDateTimes(na,Ua.time)),na=null);return Fb.merge(La)}difference(...X){return Fb.xor([this].concat(X)).map(na=>this.intersection(na)).filter(na=>
na&&!na.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} \u2013 ${this.e.toISO()})`:"Invalid Interval"}toISO(X){return this.isValid?`${this.s.toISO(X)}/${this.e.toISO(X)}`:"Invalid Interval"}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:"Invalid Interval"}toISOTime(X){return this.isValid?`${this.s.toISOTime(X)}/${this.e.toISOTime(X)}`:"Invalid Interval"}toFormat(X,{separator:na=" \u2013 "}={}){return this.isValid?`${this.s.toFormat(X)}${na}${this.e.toFormat(X)}`:
"Invalid Interval"}toDuration(X,na){return this.isValid?this.e.diff(this.s,X,na):zb.invalid(this.invalidReason)}mapEndpoints(X){return Fb.fromDateTimes(X(this.s),X(this.e))}}class Ac{static hasDST(X=Lb.defaultZone){const na=Ba.now().setZone(X).set({month:12});return!X.isUniversal&&na.offset!==na.set({month:6}).offset}static isValidIANAZone(X){return gc.isValidZone(X)}static normalizeZone(X){return K(X,Lb.defaultZone)}static months(X="long",{locale:na=null,numberingSystem:Ca=null,locObj:La=null,outputCalendar:Ua=
"gregory"}={}){return(La||Eb.create(na,Ca,Ua)).months(X)}static monthsFormat(X="long",{locale:na=null,numberingSystem:Ca=null,locObj:La=null,outputCalendar:Ua="gregory"}={}){return(La||Eb.create(na,Ca,Ua)).months(X,!0)}static weekdays(X="long",{locale:na=null,numberingSystem:Ca=null,locObj:La=null}={}){return(La||Eb.create(na,Ca,null)).weekdays(X)}static weekdaysFormat(X="long",{locale:na=null,numberingSystem:Ca=null,locObj:La=null}={}){return(La||Eb.create(na,Ca,null)).weekdays(X,!0)}static meridiems({locale:X=
null}={}){return Eb.create(X).meridiems()}static eras(X="short",{locale:na=null}={}){return Eb.create(na,null,"gregory").eras(X)}static features(){return{relative:l()}}}const bd={arab:"[\u0660-\u0669]",arabext:"[\u06f0-\u06f9]",bali:"[\u1b50-\u1b59]",beng:"[\u09e6-\u09ef]",deva:"[\u0966-\u096f]",fullwide:"[\uff10-\uff19]",gujr:"[\u0ae6-\u0aef]",hanidec:"[\u3007|\u4e00|\u4e8c|\u4e09|\u56db|\u4e94|\u516d|\u4e03|\u516b|\u4e5d]",khmr:"[\u17e0-\u17e9]",knda:"[\u0ce6-\u0cef]",laoo:"[\u0ed0-\u0ed9]",limb:"[\u1946-\u194f]",
mlym:"[\u0d66-\u0d6f]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0b66-\u0b6f]",tamldec:"[\u0be6-\u0bef]",telu:"[\u0c66-\u0c6f]",thai:"[\u0e50-\u0e59]",tibt:"[\u0f20-\u0f29]",latn:"\\d"},rd={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],
thai:[3664,3673],tibt:[3872,3881]},Zd=bd.hanidec.replace(/[\[|\]]/g,"").split(""),sd=`[ ${String.fromCharCode(160)}]`,cd=new RegExp(sd,"g"),td={year:{"2-digit":"yy",numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"}};let Fc=null;const Hc=[0,31,59,90,120,151,181,212,243,273,304,
334],Gc=[0,31,60,91,121,152,182,213,244,274,305,335],ua={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},Oc={weekNumber:1,weekday:1,hour:0,minute:0,second:0,millisecond:0},dc={ordinal:1,hour:0,minute:0,second:0,millisecond:0},Ic="year month day hour minute second millisecond".split(" "),eb="weekYear weekNumber weekday hour minute second millisecond".split(" "),id="year ordinal hour minute second millisecond".split(" ");class Ba{constructor(X){const na=X.zone||Lb.defaultZone;let Ca=X.invalid||
(Number.isNaN(X.ts)?new Zb("invalid input"):null)||(na.isValid?null:Ra(na));this.ts=b(X.ts)?Lb.now():X.ts;let La=null;var Ua=null;Ca||(X.old&&X.old.ts===this.ts&&X.old.zone.equals(na)?[La,Ua]=[X.old.c,X.old.o]:(Ua=na.offset(this.ts),La=Wa(this.ts,Ua),La=(Ca=Number.isNaN(La.year)?new Zb("invalid input"):null)?null:La,Ua=Ca?null:Ua));this._zone=na;this.loc=X.loc||Eb.create();this.invalid=Ca;this.weekData=null;this.c=La;this.o=Ua;this.isLuxonDateTime=!0}static now(){return new Ba({})}static local(){const [X,
na]=sb(arguments),[Ca,La,Ua,Za,gb,lb,pb]=na;return nb({year:Ca,month:La,day:Ua,hour:Za,minute:gb,second:lb,millisecond:pb},X)}static utc(){const [X,na]=sb(arguments),[Ca,La,Ua,Za,gb,lb,pb]=na;X.zone=Qb.utcInstance;return nb({year:Ca,month:La,day:Ua,hour:Za,minute:gb,second:lb,millisecond:pb},X)}static fromJSDate(X,na={}){X="[object Date]"===Object.prototype.toString.call(X)?X.valueOf():NaN;if(Number.isNaN(X))return Ba.invalid("invalid input");const Ca=K(na.zone,Lb.defaultZone);return Ca.isValid?new Ba({ts:X,
zone:Ca,loc:Eb.fromObject(na)}):Ba.invalid(Ra(Ca))}static fromMillis(X,na={}){if(c(X))return-864E13>X||864E13<X?Ba.invalid("Timestamp out of range"):new Ba({ts:X,zone:K(na.zone,Lb.defaultZone),loc:Eb.fromObject(na)});throw new Sa(`fromMillis requires a numerical input, but received a ${typeof X} with value ${X}`);}static fromSeconds(X,na={}){if(c(X))return new Ba({ts:1E3*X,zone:K(na.zone,Lb.defaultZone),loc:Eb.fromObject(na)});throw new Sa("fromSeconds requires a numerical input");}static fromObject(X,
na={}){X=X||{};var Ca=K(na.zone,Lb.defaultZone);if(!Ca.isValid)return Ba.invalid(Ra(Ca));var La=Lb.now();const Ua=b(na.specificOffset)?Ca.offset(La):na.specificOffset,Za=A(X,kb);var gb=!b(Za.ordinal),lb=!b(Za.year),pb=!b(Za.month)||!b(Za.day);lb=lb||pb;var yb=Za.weekYear||Za.weekNumber;na=Eb.fromObject(na);if((lb||gb)&&yb)throw new ta("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(pb&&gb)throw new ta("Can't mix ordinal dates with month/day");pb=yb||Za.weekday&&!lb;let ub=
Wa(La,Ua);pb?(La=eb,yb=Oc,ub=ma(ub)):gb?(La=id,yb=dc,ub=xa(ub)):(La=Ic,yb=ua);let wb=!1;for(var Ab of La)b(Za[Ab])?Za[Ab]=wb?yb[Ab]:ub[Ab]:wb=!0;pb?(Ab=m(Za.weekYear),La=k(Za.weekNumber,1,B(Za.weekYear)),yb=k(Za.weekday,1,7),Ab=Ab?La?yb?!1:Ja("weekday",Za.weekday):Ja("week",Za.week):Ja("weekYear",Za.weekYear)):gb?(Ab=m(Za.year),La=k(Za.ordinal,1,w(Za.year)?366:365),Ab=Ab?La?!1:Ja("ordinal",Za.ordinal):Ja("year",Za.year)):Ab=Oa(Za);if(Ab=Ab||Va(Za))return Ba.invalid(Ab);gb=pb?$a(Za):gb?Ka(Za):Za;const [Jb,
Yb]=bb(gb,Ua,Ca);Ca=new Ba({ts:Jb,zone:Ca,o:Yb,loc:na});return Za.weekday&&lb&&X.weekday!==Ca.weekday?Ba.invalid("mismatched weekday",`you can't specify both a weekday of ${Za.weekday} and a date of ${Ca.toISO()}`):Ca}static fromISO(X,na={}){const [Ca,La]=T(X,[ke,Ed],[le,oe],[me,pe],[ne,qe]);return Pa(Ca,La,na,"ISO 8601",X)}static fromRFC2822(X,na={}){const [Ca,La]=T(X.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim(),[ge,ha]);return Pa(Ca,La,na,"RFC 2822",X)}static fromHTTP(X,na={}){const [Ca,
La]=T(X,[he,ia],[ie,ia],[je,ka]);return Pa(Ca,La,na,"HTTP",na)}static fromFormat(X,na,Ca={}){if(b(X)||b(na))throw new Sa("fromFormat requires an input string and a format");const {locale:La=null,numberingSystem:Ua=null}=Ca;var Za=Eb.fromOpts({locale:La,numberingSystem:Ua,defaultToEN:!0});{const {result:ub,zone:wb,specificOffset:Ab,invalidReason:Jb}=wa(Za,X,na);Za=[ub,wb,Ab,Jb]}const [gb,lb,pb,yb]=Za;return yb?Ba.invalid(yb):Pa(gb,lb,Ca,`format ${na}`,X,pb)}static fromString(X,na,Ca={}){return Ba.fromFormat(X,
na,Ca)}static fromSQL(X,na={}){const [Ca,La]=T(X,[se,Ed],[te,ue]);return Pa(Ca,La,na,"SQL",X)}static invalid(X,na=null){if(!X)throw new Sa("need to specify a reason the DateTime is invalid");X=X instanceof Zb?X:new Zb(X,na);if(Lb.throwOnInvalid)throw new ob(X);return new Ba({invalid:X})}static isDateTime(X){return X&&X.isLuxonDateTime||!1}get(X){return this[X]}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?
this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:
NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?this.c.millisecond:NaN}get weekYear(){return this.isValid?za(this).weekYear:NaN}get weekNumber(){return this.isValid?za(this).weekNumber:NaN}get weekday(){return this.isValid?za(this).weekday:NaN}get ordinal(){return this.isValid?xa(this.c).ordinal:NaN}get monthShort(){return this.isValid?Ac.months("short",{locObj:this.loc})[this.month-
1]:null}get monthLong(){return this.isValid?Ac.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?Ac.weekdays("short",{locObj:this.loc})[this.weekday-1]:null}get weekdayLong(){return this.isValid?Ac.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,
{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return w(this.year)}get daysInMonth(){return t(this.year,this.month)}get daysInYear(){return this.isValid?w(this.year)?366:365:NaN}get weeksInWeekYear(){return this.isValid?B(this.weekYear):NaN}resolvedLocaleOptions(X={}){const {locale:na,numberingSystem:Ca,
calendar:La}=Rb.create(this.loc.clone(X),X).resolvedOptions(this);return{locale:na,numberingSystem:Ca,outputCalendar:La}}toUTC(X=0,na={}){return this.setZone(Qb.instance(X),na)}toLocal(){return this.setZone(Lb.defaultZone)}setZone(X,{keepLocalTime:na=!1,keepCalendarTime:Ca=!1}={}){X=K(X,Lb.defaultZone);if(X.equals(this.zone))return this;if(X.isValid){let La=this.ts;if(na||Ca)na=X.offset(this.ts),Ca=this.toObject(),[La]=bb(Ca,na,X);return ya(this,{ts:La,zone:X})}return Ba.invalid(Ra(X))}reconfigure({locale:X,
numberingSystem:na,outputCalendar:Ca}={}){X=this.loc.clone({locale:X,numberingSystem:na,outputCalendar:Ca});return ya(this,{loc:X})}setLocale(X){return this.reconfigure({locale:X})}set(X){if(!this.isValid)return this;X=A(X,kb);var na=!b(X.weekYear)||!b(X.weekNumber)||!b(X.weekday);const Ca=!b(X.ordinal),La=!b(X.year),Ua=!b(X.month)||!b(X.day),Za=X.weekYear||X.weekNumber;if((La||Ua||Ca)&&Za)throw new ta("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(Ua&&Ca)throw new ta("Can't mix ordinal dates with month/day");
na?na=$a({...ma(this.c),...X}):b(X.ordinal)?(na={...this.toObject(),...X},b(X.day)&&(na.day=Math.min(t(na.year,na.month),na.day))):na=Ka({...xa(this.c),...X});const [gb,lb]=bb(na,this.o,this.zone);return ya(this,{ts:gb,o:lb})}plus(X){if(!this.isValid)return this;X=zb.fromDurationLike(X);return ya(this,Aa(this,X))}minus(X){if(!this.isValid)return this;X=zb.fromDurationLike(X).negate();return ya(this,Aa(this,X))}startOf(X){if(!this.isValid)return this;const na={};X=zb.normalizeUnit(X);switch(X){case "years":na.month=
1;case "quarters":case "months":na.day=1;case "weeks":case "days":na.hour=0;case "hours":na.minute=0;case "minutes":na.second=0;case "seconds":na.millisecond=0}"weeks"===X&&(na.weekday=1);"quarters"===X&&(na.month=3*(Math.ceil(this.month/3)-1)+1);return this.set(na)}endOf(X){return this.isValid?this.plus({[X]:1}).startOf(X).minus(1):this}toFormat(X,na={}){return this.isValid?Rb.create(this.loc.redefaultToEN(na)).formatDateTimeFromString(this,X):"Invalid DateTime"}toLocaleString(X=cb,na={}){return this.isValid?
Rb.create(this.loc.clone(na),X).formatDateTime(this):"Invalid DateTime"}toLocaleParts(X={}){return this.isValid?Rb.create(this.loc.clone(X),X).formatDateTimeParts(this):[]}toISO({format:X="extended",suppressSeconds:na=!1,suppressMilliseconds:Ca=!1,includeOffset:La=!0,extendedZone:Ua=!1}={}){if(!this.isValid)return null;X="extended"===X;let Za=fb(this,X);return Za=Za+"T"+hb(this,X,na,Ca,La,Ua)}toISODate({format:X="extended"}={}){return this.isValid?fb(this,"extended"===X):null}toISOWeekDate(){return ab(this,
"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:X=!1,suppressSeconds:na=!1,includeOffset:Ca=!0,includePrefix:La=!1,extendedZone:Ua=!1,format:Za="extended"}={}){return this.isValid?(La?"T":"")+hb(this,"extended"===Za,na,X,Ca,Ua):null}toRFC2822(){return ab(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return ab(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?fb(this,!0):null}toSQLTime({includeOffset:X=!0,includeZone:na=!1,includeOffsetSpace:Ca=!0}={}){let La="HH:mm:ss.SSS";
if(na||X)Ca&&(La+=" "),na?La+="z":X&&(La+="ZZ");return ab(this,La,!0)}toSQL(X={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(X)}`:null}toString(){return this.isValid?this.toISO():"Invalid DateTime"}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1E3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1E3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(X={}){if(!this.isValid)return{};
const na={...this.c};X.includeConfig&&(na.outputCalendar=this.outputCalendar,na.numberingSystem=this.loc.numberingSystem,na.locale=this.loc.locale);return na}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(X,na="milliseconds",Ca={}){if(!this.isValid||!X.isValid)return zb.invalid("created by diffing an invalid DateTime");Ca={locale:this.locale,numberingSystem:this.numberingSystem,...Ca};const La=(Array.isArray(na)?na:[na]).map(zb.normalizeUnit);na=X.valueOf()>this.valueOf();X=fa(na?this:
X,na?X:this,La,Ca);return na?X.negate():X}diffNow(X="milliseconds",na={}){return this.diff(Ba.now(),X,na)}until(X){return this.isValid?Fb.fromDateTimes(this,X):this}hasSame(X,na){if(!this.isValid)return!1;const Ca=X.valueOf();X=this.setZone(X.zone,{keepLocalTime:!0});return X.startOf(na)<=Ca&&Ca<=X.endOf(na)}equals(X){return this.isValid&&X.isValid&&this.valueOf()===X.valueOf()&&this.zone.equals(X.zone)&&this.loc.equals(X.loc)}toRelative(X={}){if(!this.isValid)return null;const na=X.base||Ba.fromObject({},
{zone:this.zone}),Ca=X.padding?this<na?-X.padding:X.padding:0;let La="years months days hours minutes seconds".split(" "),Ua=X.unit;Array.isArray(X.unit)&&(La=X.unit,Ua=void 0);return rb(na,this.plus(Ca),{...X,numeric:"always",units:La,unit:Ua})}toRelativeCalendar(X={}){return this.isValid?rb(X.base||Ba.fromObject({},{zone:this.zone}),this,{...X,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...X){if(!X.every(Ba.isDateTime))throw new Sa("min requires all arguments be DateTimes");
return r(X,na=>na.valueOf(),Math.min)}static max(...X){if(!X.every(Ba.isDateTime))throw new Sa("max requires all arguments be DateTimes");return r(X,na=>na.valueOf(),Math.max)}static fromFormatExplain(X,na,Ca={}){const {locale:La=null,numberingSystem:Ua=null}=Ca;Ca=Eb.fromOpts({locale:La,numberingSystem:Ua,defaultToEN:!0});return wa(Ca,X,na)}static fromStringExplain(X,na,Ca={}){return Ba.fromFormatExplain(X,na,Ca)}static get DATE_SHORT(){return cb}static get DATE_MED(){return ib}static get DATE_MED_WITH_WEEKDAY(){return mb}static get DATE_FULL(){return tb}static get DATE_HUGE(){return Bb}static get TIME_SIMPLE(){return xb}static get TIME_WITH_SECONDS(){return Hb}static get TIME_WITH_SHORT_OFFSET(){return Ub}static get TIME_WITH_LONG_OFFSET(){return Mb}static get TIME_24_SIMPLE(){return vb}static get TIME_24_WITH_SECONDS(){return Ib}static get TIME_24_WITH_SHORT_OFFSET(){return Pb}static get TIME_24_WITH_LONG_OFFSET(){return Sb}static get DATETIME_SHORT(){return $b}static get DATETIME_SHORT_WITH_SECONDS(){return Jc}static get DATETIME_MED(){return ac}static get DATETIME_MED_WITH_SECONDS(){return rc}static get DATETIME_MED_WITH_WEEKDAY(){return hc}static get DATETIME_FULL(){return wc}static get DATETIME_FULL_WITH_SECONDS(){return xc}static get DATETIME_HUGE(){return sc}static get DATETIME_HUGE_WITH_SECONDS(){return tc}}
a.DateTime=Ba;a.Info=Ac;a.Interval=Fb})},"esri/core/number":function(){define(["exports","./string","../intl/locale"],function(a,b,c){function m(e){e||(e=c.getLocale());let h=e in k;if(!h){const x=e.split("-");1<x.length&&x[0]in k&&(e=x[0],h=!0);h||(e="en")}const [v,w,t="#,##0.###"]=k[e];return{decimal:v,group:w,pattern:t}}function l(e,h,v){v=v||{};!0===v.places&&(v.places=0);Infinity===v.places&&(v.places=6);h=h.split(".");var w="string"===typeof v.places&&v.places.indexOf(","),t=v.places;w?t=v.places.substring(w+
1):0<=t||(t=(h[1]||[]).length);0>v.round||(e=Number(e.toFixed(Number(t))));e=String(Math.abs(e)).split(".");const x=e[1]||"";h[1]||v.places?(w&&(v.places=v.places.substring(0,w)),w=void 0!==v.places?v.places:h[1]&&h[1].lastIndexOf("0")+1,w>x.length&&(e[1]=x.padEnd(Number(w),"0")),t<x.length&&(e[1]=x.substr(0,Number(t)))):e[1]&&e.pop();t=h[0].replace(",","");w=t.indexOf("0");-1!==w&&(w=t.length-w,w>e[0].length&&(e[0]=e[0].padStart(w,"0")),t.includes("#")||(e[0]=e[0].substr(e[0].length-w)));t=h[0].lastIndexOf(",");
let B,q;-1!==t&&(B=h[0].length-t-1,h=h[0].substr(0,t),t=h.lastIndexOf(","),-1!==t&&(q=h.length-t-1));h=[];for(t=e[0];t;)w=t.length-B,h.push(0<w?t.substr(w):t),t=0<w?t.slice(0,w):"",q&&(B=q,q=void 0);e[0]=h.reverse().join(v.group||",");return e.join(v.decimal||".")}function r(e){e=e||{};var h=m(e.locale);const v=e.pattern||h.pattern,w=h.group,t=h.decimal;let x=1;if(v.includes("%"))x/=100;else if(v.includes("\u2030"))x/=1E3;else if(v.includes("\u00a4"))throw Error("currency notation not supported");
h=v.split(";");1===h.length&&h.push("-"+h[0]);return{regexp:d(h,B=>{B="(?:"+b.escapeRegExpString(B,".")+")";return B.replace(f,q=>{const u={signed:!1,separator:e.strict?w:[w,""],fractional:e.fractional,decimal:t,exponent:!1};q=q.split(".");let C=e.places;1===q.length&&1!==x&&(q[1]="###");1===q.length||0===C?u.fractional=!1:(void 0===C&&(C=e.pattern?q[1].lastIndexOf("0")+1:Infinity),C&&null==e.fractional&&(u.fractional=!0),!e.places&&C<q[1].length&&(C+=","+q[1].length),u.places=C);q=q[0].split(",");
1<q.length&&(u.groupSize=q.pop().length,1<q.length&&(u.groupSize2=q.pop().length));return"("+n(u)+")"})},!0).replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:w,decimal:t,factor:x}}function n(e){e=e||{};"places"in e||(e.places=Infinity);"string"!==typeof e.decimal&&(e.decimal=".");"fractional"in e&&!/^0/.test(String(e.places))||(e.fractional=[!0,!1]);"exponent"in e||(e.exponent=[!0,!1]);"eSigned"in e||(e.eSigned=[!0,!1]);var h=g(e);const v=d(e.fractional,t=>{let x="";t&&0!==e.places&&(x="\\"+e.decimal,x=Infinity===
e.places?"(?:"+x+"\\d+)?":x+("\\d{"+e.places+"}"));return x},!0),w=d(e.exponent,t=>t?"([eE]"+g({signed:e.eSigned})+")":"");h+=v;v&&(h="(?:(?:"+h+")|(?:"+v+"))");return h+w}function g(e){e=e||{};"signed"in e||(e.signed=[!0,!1]);"separator"in e?"groupSize"in e||(e.groupSize=3):e.separator="";const h=d(e.signed,w=>w?"[-+]":"",!0),v=d(e.separator,w=>{if(!w)return"(?:\\d+)";w=b.escapeRegExpString(w);" "===w?w="\\s":"\u00a0"===w&&(w="\\s\\xa0");const t=e.groupSize,x=e.groupSize2;return x?(w="(?:0|[1-9]\\d{0,"+
(x-1)+"}(?:["+w+"]\\d{"+x+"})*["+w+"]\\d{"+t+"})",0<t-x?"(?:"+w+"|(?:0|[1-9]\\d{0,"+(t-1)+"}))":w):"(?:0|[1-9]\\d{0,"+(t-1)+"}(?:["+w+"]\\d{"+t+"})*)"},!0);return h+v}const k={ar:[".",","],bg:[",","\u00a0"],bs:[",","."],ca:[",","."],cs:[",","\u00a0"],da:[",","."],de:[",","."],"de-ch":[".","\u2019"],el:[",","."],en:[".",","],"en-au":[".",","],es:[",","."],"es-mx":[".",","],et:[",","\u00a0"],fi:[",","\u00a0"],fr:[",","\u202f"],"fr-ch":[",","\u202f"],he:[".",","],hi:[".",",","#,##,##0.###"],hr:[",",
"."],hu:[",","\u00a0"],id:[",","."],it:[",","."],"it-ch":[".","\u2019"],ja:[".",","],ko:[".",","],lt:[",","\u00a0"],lv:[",","\u00a0"],mk:[",","."],nb:[",","\u00a0"],nl:[",","."],pl:[",","\u00a0"],pt:[",","."],"pt-pt":[",","\u00a0"],ro:[",","."],ru:[",","\u00a0"],sk:[",","\u00a0"],sl:[",","."],sr:[",","."],sv:[",","\u00a0"],th:[".",","],tr:[",","."],uk:[",","\u00a0"],vi:[",","."],zh:[".",","]},f=/[#0,]*[#0](?:\.0*#*)?/,d=(e,h,v)=>{if(!(e instanceof Array))return h(e);const w=[];for(let t=0;t<e.length;t++)w.push(h(e[t]));
e=w.join("|");return"("+(v?"?:":"")+e+")"};a._parseInfo=r;a.format=function(e,h){h={...h};var v=m(h.locale);h.customs=v;var w=h.pattern||v.pattern;if(isNaN(e)||Infinity===Math.abs(e))return null;{h=h||{};v=h.customs.group;const x=h.customs.decimal;w=w.split(";");var t=w[0];w=w[0>e?1:0]||"-"+t;if(w.includes("%"))e*=100;else if(w.includes("\u2030"))e*=1E3;else{if(w.includes("\u00a4"))throw Error("currency notation not supported");if(w.includes("E"))throw Error("exponential notation not supported");
}const B=f;t=t.match(B);if(!t)throw Error("unable to find a number expression in pattern: "+w);!1===h.fractional&&(h.places=0);e=w.replace(B,l(e,t[0],{decimal:x,group:v,places:h.places,round:h.round}))}return e};a.getCustoms=m;a.parse=function(e,h){h=r(h);e=(new RegExp("^"+h.regexp+"$")).exec(e);if(!e)return NaN;let v=e[1];if(!e[1]){if(!e[2])return NaN;v=e[2];h.factor*=-1}v=v.replace(new RegExp("["+h.group+"\\s\\xa0]","g"),"").replace(h.decimal,".");return Number(v)*h.factor};a.regexp=function(e){return r(e).regexp};
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/arcade/featureset/support/shared":function(){define(["exports","../../../geometry/Extent","../../../layers/support/Field"],function(a,b,c){function m(l){return l instanceof Date}a.FeatureServiceDatabaseType=void 0;(function(l){l[l.Standardised=0]="Standardised";l[l.StandardisedNoInterval=1]="StandardisedNoInterval";l[l.SqlServer=2]="SqlServer";l[l.Oracle=3]="Oracle";l[l.Postgres=4]="Postgres";l[l.PGDB=
5]="PGDB";l[l.FILEGDB=6]="FILEGDB";l[l.NotEvaluated=7]="NotEvaluated"})(a.FeatureServiceDatabaseType||(a.FeatureServiceDatabaseType={}));a.IdState=void 0;(function(l){l[l.InFeatureSet=0]="InFeatureSet";l[l.NotInFeatureSet=1]="NotInFeatureSet";l[l.Unknown=2]="Unknown"})(a.IdState||(a.IdState={}));a.callback=function(l,r){return function(){try{l.apply(null,arguments)}catch(n){r.reject(n)}}};a.cloneAttributes=function(l){const r={};for(const n in l)r[n]=l[n];return r};a.cloneField=function(l){return c.fromJSON(l.toJSON())};
a.convertLinearUnitsToCode=function(l){if(void 0===l)return null;if("number"===typeof l||"number"===typeof l)return l;switch(l.toLowerCase()){case "meters":case "meter":return 9001;case "miles":case "mile":return 9035;case "kilometers":case "kilometer":case "km":return 9036}return null};a.convertSquareUnitsToCode=function(l){if(void 0===l)return null;if("number"===typeof l)return l;switch(l.toLowerCase()){case "meters":case "meter":return 109404;case "miles":case "mile":return 109413;case "kilometers":case "kilometer":case "km":return 109414}return null};
a.defaultMaxRecords=1E3;a.equalityTest=function(l,r){return l===r?!0:m(l)&&m(r)?l.getTime()===r.getTime():!1};a.errback=function(l){return function(r){l.reject(r)}};a.esriFieldToJson=function(l){return l.toJSON?l.toJSON():l};a.extractServiceUrl=function(l){if(void 0===l)return"";l=l.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer");l=l.replace(/\/mapserver\/[0-9]*/i,"/MapServer");return l=l.split("?")[0]};a.isArray=function(l){return l instanceof Array};a.isBoolean=function(l){return"boolean"===
typeof l};a.isDate=m;a.isNumber=function(l){return"number"===typeof l};a.isString=function(l){return"string"===typeof l||l instanceof String};a.layerFieldEsriConstants={"small-integer":"esriFieldTypeSmallInteger",integer:"esriFieldTypeInteger",long:"esriFieldTypeLong",single:"esriFieldTypeSingle",double:"esriFieldTypeDouble",string:"esriFieldTypeString",date:"esriFieldTypeDate",oid:"esriFieldTypeOID",geometry:"esriFieldTypeGeometry",blob:"esriFieldTypeBlob",raster:"esriFieldTypeRaster",guid:"esriFieldTypeGUID",
"global-id":"esriFieldTypeGlobalID",xml:"eesriFieldTypeXML",esriFieldTypeSmallInteger:"esriFieldTypeSmallInteger",esriFieldTypeInteger:"esriFieldTypeInteger",esriFieldTypeLong:"esriFieldTypeLong",esriFieldTypeSingle:"esriFieldTypeSingle",esriFieldTypeDouble:"esriFieldTypeDouble",esriFieldTypeString:"esriFieldTypeString",esriFieldTypeDate:"esriFieldTypeDate",esriFieldTypeOID:"esriFieldTypeOID",esriFieldTypeGeometry:"esriFieldTypeGeometry",esriFieldTypeBlob:"esriFieldTypeBlob",esriFieldTypeRaster:"esriFieldTypeRaster",
esriFieldTypeGUID:"esriFieldTypeGUID",esriFieldTypeGlobalID:"esriFieldTypeGlobalID",esriFieldTypeXML:"eesriFieldTypeXML"};a.layerGeometryEsriConstants={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",envelope:"extent"};a.layerGeometryEsriRestConstants={point:"esriGeometryPoint",polygon:"esriGeometryPolygon",
polyline:"esriGeometryPolyline",multipoint:"esriGeometryMultipoint",extent:"esriGeometryEnvelope",esriGeometryPoint:"esriGeometryPoint",esriGeometryPolygon:"esriGeometryPolygon",esriGeometryPolyline:"esriGeometryPolyline",esriGeometryMultipoint:"esriGeometryMultipoint",esriGeometryEnvelope:"esriGeometryEnvelope",envelope:"esriGeometryEnvelope"};a.sameGeomType=function(l,r){return l===r||"point"===l&&"esriGeometryPoint"===r||"polyline"===l&&"esriGeometryPolyline"===r||"polygon"===l&&"esriGeometryPolygon"===
r||"extent"===l&&"esriGeometryEnvelope"===r||"multipoint"===l&&"esriGeometryMultipoint"===r||"point"===r&&"esriGeometryPoint"===l||"polyline"===r&&"esriGeometryPolyline"===l||"polygon"===r&&"esriGeometryPolygon"===l||"extent"===r&&"esriGeometryEnvelope"===l||"multipoint"===r&&"esriGeometryMultipoint"===l?!0:!1};a.shapeExtent=function(l){if(null===l)return null;switch(l.type){case "polygon":case "multipoint":case "polyline":return l.extent;case "point":return new b({xmin:l.x,ymin:l.y,xmax:l.x,ymax:l.y,
spatialReference:l.spatialReference});case "extent":return l}return null};a.stableStringify=function(l,r){r||(r={});"function"===typeof r&&(r={cmp:r});const n="boolean"===typeof r.cycles?r.cycles:!1,g=r.cmp&&function(f){return function(d){return function(e,h){return f({key:e,value:d[e]},{key:h,value:d[h]})}}}(r.cmp),k=[];return function e(d){d&&d.toJSON&&"function"===typeof d.toJSON&&(d=d.toJSON());if(void 0!==d){if("number"===typeof d)return isFinite(d)?""+d:"null";if("object"!==typeof d)return JSON.stringify(d);
var h;if(Array.isArray(d)){var v="[";for(h=0;h<d.length;h++)h&&(v+=","),v+=e(d[h])||"null";return v+"]"}if(null===d)return"null";if(k.includes(d)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON");}var w=k.push(d)-1,t=Object.keys(d).sort(g&&g(d));v="";for(h=0;h<t.length;h++){const x=t[h],B=e(d[x]);B&&(v&&(v+=","),v+=JSON.stringify(x)+":"+B)}k.splice(w,1);return"{"+v+"}"}}(l)};a.toEsriGeometryType=function(l){switch(l){case "point":return"esriGeometryPoint";
case "polygon":return"esriGeometryPolygon";case "multipoint":return"esriGeometryMultipoint";case "polyline":return"esriGeometryPolyline";default:return"esriGeometryPoint"}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Feature/support/arcadeFeatureUtils":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/promiseUtils ../../../layers/FeatureLayer ./featureUtils".split(" "),function(a,
b,c,m,l,r,n){function g(q){return`<ul class="esri-widget__list">${q.map(u=>`<li>${"string"===typeof u?n.applyTextFormattingHTML(n.htmlEntities(u)):u}</li>`).join("")}</ul>`}function k(q){return`<table class="esri-widget__table">${q.keys().map(u=>{var C=q.field(u);C="string"===typeof C?n.applyTextFormattingHTML(n.htmlEntities(C)):C;return`<tr><th>${u}</th><td>${C}</td></tr>`}).join("")}</table>`}function f({aggregatedFeatures:q,arcadeUtils:u,featureSetVars:C,context:z,viewInfo:A,map:p,graphic:y,interceptor:D}){C.forEach(E=>
{E=E.toLowerCase();var F={map:p,spatialReference:A.sr,interceptor:D};"$map"===E&&(z.vars[E]=u.convertMapToFeatureSetCollection(F));"$layer"===E&&(z.vars[E]=u.convertFeatureLayerToFeatureSet({layer:y.sourceLayer,spatialReference:A.sr,interceptor:D}));"$datastore"===E&&(z.vars[E]=u.convertServiceUrlToWorkspace({url:y.sourceLayer.url,spatialReference:A.sr,interceptor:D}));if("$aggregatedfeatures"===E){F=y.layer;const {fields:G,objectIdField:P,geometryType:K,spatialReference:N,displayField:M}=F;F=new r({fields:G,
objectIdField:P,geometryType:K,spatialReference:N,displayField:M,..."feature"===F.type?{templates:F.templates,typeIdField:F.typeIdField,types:F.types}:null,source:q});z.vars[E]=u.convertFeatureLayerToFeatureSet({layer:F,spatialReference:A.sr,interceptor:D})}})}function d(){return new Promise((q,u)=>a(["../../../support/arcadeUtils"],q,u))}function e(q){return h.apply(this,arguments)}function h(){h=c._asyncToGenerator(function*({graphic:q,view:u}){const {isAggregate:C,layer:z}=q;if(!C||!z||"2d"!==
(null==u?void 0:u.type))return[];u=yield u.whenLayerView(z);if(!u.createQuery||!u.queryFeatures)return[];const A=u.createQuery();A.aggregateIds=[q.getObjectId()];({features:q}=yield u.queryFeatures(A));return q});return h.apply(this,arguments)}function v(q){return w.apply(this,arguments)}function w(){w=c._asyncToGenerator(function*({expressionInfo:q,arcadeUtils:u,interceptor:C,spatialReference:z,map:A,graphic:p,view:y}){if(!q||!q.expression)return null;const D=u.createSyntaxTree(q.expression),E=x.filter(G=>
u.hasVariable(D,G));[y]=yield Promise.all([e({graphic:p,view:y}),u.loadScriptDependencies(D,!0,E)]);const F=u.getViewInfo({spatialReference:z});z=u.createExecContext(p,F);z.interceptor=C;z.useAsync=!0;f({aggregatedFeatures:y,arcadeUtils:u,featureSetVars:E,context:z,viewInfo:F,map:A,graphic:p,interceptor:C});C=u.createFunction(D,z);return u.executeAsyncFunction(C,z).catch(G=>B.error("arcade-execution-error",{error:G,graphic:p,expressionInfo:q}))});return w.apply(this,arguments)}function t(){t=c._asyncToGenerator(function*({expressionInfos:q,
spatialReference:u,graphic:C,interceptor:z,map:A,view:p}){if(!q||!q.length)return{};const y=yield d(),D={};for(const E of q)D[`expression/${E.name}`]=v({expressionInfo:E,arcadeUtils:y,interceptor:z,spatialReference:u,map:A,graphic:C,view:p});q=yield l.eachAlways(D);u={};for(const E in q)C=q[E].value,C="string"===typeof C?n.applyTextFormattingHTML(n.htmlEntities(C)):Array.isArray(C)?g(C):"esri.arcade.Dictionary"===(null==C?void 0:C.declaredClass)?k(C):C,u[E]=C;return u});return t.apply(this,arguments)}
const x=["$datastore","$map","$layer","$aggregatedfeatures"],B=m.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");b.createCompiledExpression=v;b.createCompiledExpressions=function(q){return t.apply(this,arguments)};b.loadArcadeUtils=d;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Feature/FeatureViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../arcade/featureset/support/FeatureSetQueryInterceptor ../../core/Accessor ../../core/Handles ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/reactiveUtils ../../core/throttle ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../popup/content/TextContent ./FeatureAttachments/FeatureAttachmentsViewModel ./FeatureContent/FeatureContentViewModel ./FeatureExpression/FeatureExpressionViewModel ./FeatureFields/FeatureFieldsViewModel ./FeatureMedia/FeatureMediaViewModel ./support/arcadeFeatureUtils ./support/featureUtils ./support/relatedFeatureUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y){var D;const E=n.getLogger("esri.widgets.FeatureViewModel"),F={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0};l=D=function(G){function P(N){var M=G.call(this,N)||this;M._handles=new r;M._error=null;M._featureAbortController=null;M.graphicChangedThrottled=d.throttle(M._graphicChanged,1,a._assertThisInitialized(M));M._expressionAttributes=null;M._graphicExpressionAttributes=
null;M.abilities={...F};M.content=null;M.contentViewModels=[];M.defaultPopupTemplateEnabled=!1;M.formattedAttributes=null;M.lastEditInfo=null;M.relatedInfos=new Map;M.title="";M.view=null;M._isAllowedContentType=L=>{const {abilities:J}=a._assertThisInitialized(M);return"attachments"===L.type&&J.attachmentsContent||"custom"===L.type&&J.customContent||"fields"===L.type&&J.fieldsContent||"media"===L.type&&J.mediaContent||"text"===L.type&&J.textContent||"expression"===L.type&&J.expressionContent};M._handles.add(f.watch(()=>
[M.graphic,M._effectivePopupTemplate,M.abilities],()=>M.graphicChangedThrottled(),f.initial));return M}a._inheritsLoose(P,G);var K=P.prototype;K.destroy=function(){this._clear();this._cancelFeatureQuery();this._error=null;this._handles.destroy();this.graphic=this._handles=null;this._destroyContentViewModels();this.relatedInfos.clear()};K.castAbilities=function(N){return{...F,...N}};K.setActiveMedia=function(N,M){N=this.contentViewModels[N];N instanceof z&&N.setActiveMedia(M)};K.nextMedia=function(N){N=
this.contentViewModels[N];N instanceof z&&N.next()};K.previousMedia=function(N){N=this.contentViewModels[N];N instanceof z&&N.previous()};K._clear=function(){this._set("title","");this._set("content",null);this._set("formattedAttributes",null)};K._graphicChanged=function(){var N=a._asyncToGenerator(function*(){this._cancelFeatureQuery();this._error=null;this._clear();const {graphic:M}=this;if(M){var L=new AbortController;this._featureAbortController=L;try{yield this._queryFeature({signal:L.signal})}catch(J){k.isAbortError(J)||
(this._error=J,E.error("error","The popupTemplate could not be displayed for this feature.",{error:J,graphic:M,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===L&&(this._featureAbortController=null)}});return function(){return N.apply(this,arguments)}}();K._cancelFeatureQuery=function(){const {_featureAbortController:N}=this;N&&N.abort();this._featureAbortController=null};K._compileContentElement=function(N,M){if("attachments"===N.type)return this._compileAttachments(N,
M);if("custom"===N.type)return this._compileCustom(N,M);if("fields"===N.type)return this._compileFields(N,M);if("media"===N.type)return this._compileMedia(N,M);if("text"===N.type)return this._compileText(N,M);if("expression"===N.type)return this._compileExpression(N,M)};K._compileContent=function(N){this._destroyContentViewModels();if(this.graphic)return Array.isArray(N)?N.filter(this._isAllowedContentType).map((M,L)=>this._compileContentElement(M,L)):"string"===typeof N?this._compileText(new x({text:N}),
0).text:N};K._destroyContentViewModels=function(){var N;null==(N=this._handles)?void 0:N.remove("content-view-models");this.contentViewModels.forEach(M=>M&&!M.destroyed&&M.destroy());this._set("contentViewModels",[])};K._setExpressionContentVM=function(N,M){const {formattedAttributes:L}=this,{contentElement:J,contentElementViewModel:H}=N;N=null==J?void 0:J.type;H&&N&&("fields"===N&&(this._createFieldsFormattedAttributes({contentElement:J,contentElementIndex:M,formattedAttributes:L}),H.set(this._createFieldsVMParams(J,
M))),"media"===N&&(this._createMediaFormattedAttributes({contentElement:J,contentElementIndex:M,formattedAttributes:L}),H.set(this._createMediaVMParams(J,M))),"text"===N&&H.set(this._createTextVMParams(J)))};K._compileExpression=function(N,M){const {expressionInfo:L}=N,{graphic:J,map:H,spatialReference:I,view:O}=this,Q=new u({expressionInfo:L,graphic:J,interceptor:D.interceptor,map:H,spatialReference:I,view:O});this.contentViewModels[M]=Q;this._handles.add(f.watch(()=>Q.contentElementViewModel,()=>
this._setExpressionContentVM(Q,M),f.initial),"content-view-models");return N};K._compileAttachments=function(N,M){const {graphic:L}=this,{description:J,title:H}=N;this.contentViewModels[M]=new B({graphic:L,...this._compileTitleAndDesc({title:H,description:J})});return N};K._compileCustom=function(N,M){const {graphic:L}=this,{creator:J,destroyer:H}=N;this.contentViewModels[M]=new q({graphic:L,creator:J,destroyer:H});return N};K._compileTitleAndDesc=function({title:N,description:M}){const {_fieldInfoMap:L,
_sourceLayer:J,graphic:H,formattedAttributes:I,_expressionAttributes:O}=this,{attributes:Q}=H,S=I.global;return{title:p.substituteFieldsInLinksAndAttributes({attributes:Q,fieldInfoMap:L,globalAttributes:S,expressionAttributes:O,layer:J,text:N}),description:p.substituteFieldsInLinksAndAttributes({attributes:Q,fieldInfoMap:L,globalAttributes:S,expressionAttributes:O,layer:J,text:M})}};K._createFieldsVMParams=function(N,M){const {_effectivePopupTemplate:L,formattedAttributes:J}=this,H={...J.global,...J.content[M]};
M=(null==N?void 0:N.fieldInfos)||(null==L?void 0:L.fieldInfos);M=null==M?void 0:M.filter(({fieldName:S})=>p.isExpressionField(S)||p.isRelatedField(S)||H.hasOwnProperty(S));const I=null==L?void 0:L.expressionInfos,{description:O,title:Q}=N;return{attributes:H,expressionInfos:I,fieldInfos:M,...this._compileTitleAndDesc({title:Q,description:O})}};K._compileFields=function(N,M){const L=N.clone();N=new C(this._createFieldsVMParams(N,M));this.contentViewModels[M]=N;L.fieldInfos=N.formattedFieldInfos.slice(0);
return L};K._createMediaVMParams=function(N,M){const {abilities:L,graphic:J,_fieldInfoMap:H,formattedAttributes:I,_effectivePopupTemplate:O,relatedInfos:Q,_sourceLayer:S,_expressionAttributes:T}=this,{attributes:U}=J,{description:aa,mediaInfos:W,title:R}=N;return{abilities:{chartAnimation:L.chartAnimation},activeMediaInfoIndex:N.activeMediaInfoIndex||0,attributes:U,layer:S,fieldInfoMap:H,formattedAttributes:{...I.global,...I.content[M]},expressionAttributes:T,mediaInfos:W,popupTemplate:O,relatedInfos:Q,
...this._compileTitleAndDesc({title:R,description:aa})}};K._compileMedia=function(N,M){const L=N.clone();N=new z(this._createMediaVMParams(N,M));L.mediaInfos=N.formattedMediaInfos.slice(0);this.contentViewModels[M]=N;return L};K._createTextVMParams=function(N){const {graphic:M,_fieldInfoMap:L,_sourceLayer:J,_expressionAttributes:H}=this;if(N&&N.text){const {attributes:I}=M;N.text=p.substituteFieldsInLinksAndAttributes({attributes:I,fieldInfoMap:L,globalAttributes:this.formattedAttributes.global,expressionAttributes:H,
layer:J,text:N.text})}return{graphic:M,creator:N.text}};K._compileText=function(N,M){N=N.clone();this.contentViewModels[M]=new q(this._createTextVMParams(N));return N};K._compileLastEditInfo=function(){const {_effectivePopupTemplate:N,_sourceLayer:M,graphic:L}=this;if(N){var {lastEditInfoEnabled:J}=N,H=null==M?void 0:M.editFieldsInfo;if(J&&H)return p.formatEditInfo(H,L.attributes)}};K._compileTitle=function(N){const {_fieldInfoMap:M,_sourceLayer:L,graphic:J,_expressionAttributes:H}=this,{attributes:I}=
J;return p.substituteFieldsInLinksAndAttributes({attributes:I,fieldInfoMap:M,globalAttributes:this.formattedAttributes.global,expressionAttributes:H,layer:L,text:N})};K._getTitle=function(){var N=a._asyncToGenerator(function*(){const {_effectivePopupTemplate:M,graphic:L}=this;return p.graphicCallback(null==M?void 0:M.title,{graphic:L})});return function(){return N.apply(this,arguments)}}();K._getContent=function(){var N=a._asyncToGenerator(function*(){const {_effectivePopupTemplate:M,graphic:L}=this;
return p.graphicCallback(null==M?void 0:M.content,{graphic:L})});return function(){return N.apply(this,arguments)}}();K._queryFeature=function(){var N=a._asyncToGenerator(function*(M){const {_featureAbortController:L,_sourceLayer:J,graphic:H,_effectivePopupTemplate:I,spatialReference:O,map:Q,view:S}=this,{content:{value:T},title:{value:U}}=yield k.eachAlways({content:this._getContent(),title:this._getTitle()});L===this._featureAbortController&&H&&(yield p.queryUpdatedFeature({graphic:H,popupTemplate:I,
layer:J,spatialReference:O},M),{expressionAttributes:{value:M}}=yield k.eachAlways({checkForRelatedFeatures:this._checkForRelatedFeatures(M),expressionAttributes:A.createCompiledExpressions({expressionInfos:null==I?void 0:I.expressionInfos,spatialReference:O,graphic:H,map:Q,interceptor:D.interceptor,view:S})}),L===this._featureAbortController&&H&&(this._expressionAttributes=M,this._graphicExpressionAttributes={...H.attributes,...M},this._set("formattedAttributes",this._createFormattedAttributes(T)),
this._set("title",this._compileTitle(U)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(T)||null)))});return function(M){return N.apply(this,arguments)}}();K._createMediaFormattedAttributes=function({contentElement:N,contentElementIndex:M,formattedAttributes:L}){const {_effectivePopupTemplate:J,graphic:H,relatedInfos:I,_sourceLayer:O,_fieldInfoMap:Q,_graphicExpressionAttributes:S}=this;L.content[M]=p.formatAttributes({fieldInfos:null==J?void 0:
J.fieldInfos,graphic:H,attributes:{...S,...N.attributes},layer:O,fieldInfoMap:Q,relatedInfos:I})};K._createFieldsFormattedAttributes=function({contentElement:N,contentElementIndex:M,formattedAttributes:L}){if(N.fieldInfos){const {graphic:J,relatedInfos:H,_sourceLayer:I,_fieldInfoMap:O,_graphicExpressionAttributes:Q}=this;L.content[M]=p.formatAttributes({fieldInfos:N.fieldInfos,graphic:J,attributes:{...Q,...N.attributes},layer:I,fieldInfoMap:O,relatedInfos:H})}};K._createFormattedAttributes=function(N){const {_effectivePopupTemplate:M,
graphic:L,relatedInfos:J,_sourceLayer:H,_fieldInfoMap:I,_graphicExpressionAttributes:O}=this,Q={global:p.formatAttributes({fieldInfos:null==M?void 0:M.fieldInfos,graphic:L,attributes:O,layer:H,fieldInfoMap:I,relatedInfos:J}),content:[]};Array.isArray(N)&&N.forEach((S,T)=>{"fields"===S.type&&this._createFieldsFormattedAttributes({contentElement:S,contentElementIndex:T,formattedAttributes:Q});"media"===S.type&&this._createMediaFormattedAttributes({contentElement:S,contentElementIndex:T,formattedAttributes:Q})});
return Q};K._checkForRelatedFeatures=function(N){const {graphic:M,_effectivePopupTemplate:L}=this;return this._queryRelatedInfos(M,p.getAllFieldInfos(L),N)};K._queryRelatedInfos=function(){var N=a._asyncToGenerator(function*(M,L,J){const {relatedInfos:H,_sourceLayer:I}=this;H.clear();const O=g.isSome(I.associatedLayer)?yield I.associatedLayer.load(J):I;if(O){var Q=L.filter(U=>U&&p.isRelatedField(U.fieldName));if(Q&&Q.length){L.forEach(U=>this._configureRelatedInfo(U,O));var S=yield y.queryLayerInfos({relatedInfos:H,
layer:O},J);Object.keys(S).forEach(U=>{var aa;const W=H.get(U.toString());U=null==(aa=S[U])?void 0:aa.value;W&&U&&(W.layerInfo=U.data)});var T=yield y.queryRelatedFeatures({graphic:M,relatedInfos:H,layer:O},J);Object.keys(T).forEach(U=>{var aa;y.setRelatedFeatures(null==(aa=T[U])?void 0:aa.value,H.get(U.toString()))})}}});return function(M,L,J){return N.apply(this,arguments)}}();K._configureRelatedInfo=function(N,M){const {relatedInfos:L}=this,J=y.getRelatedFieldInfo(N.fieldName);if(J){var {layerId:H,
fieldName:I}=J;H&&(M=L.get(H.toString())||y.createRelatedInfo(H,M))&&(y.updateRelatedInfo({relatedInfo:M,fieldName:I,fieldInfo:N}),this.relatedInfos.set(H,M))}};a._createClass(P,[{key:"_effectivePopupTemplate",get:function(){return g.isSome(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}},{key:"_fieldInfoMap",get:function(){return p.createfieldInfoMap(p.getAllFieldInfos(this._effectivePopupTemplate),this._sourceLayer)}},{key:"_sourceLayer",get:function(){return p.getSourceLayer(this.graphic)}},
{key:"state",get:function(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}},{key:"graphic",set:function(N){this._set("graphic",N?N.clone():null)}},{key:"spatialReference",get:function(){return this.get("view.spatialReference")||null},set:function(N){void 0===N?this._clearOverride("spatialReference"):this._override("spatialReference",N)}},{key:"map",get:function(){return this.get("view.map")||null},set:function(N){void 0===N?this._clearOverride("map"):
this._override("map",N)}},{key:"waitingForContent",get:function(){return!!this._featureAbortController}}]);return P}(l);l.interceptor=new m.FeatureSetQueryInterceptor(p.preLayerQueryCallback,p.preRequestCallback);b.__decorate([e.property()],l.prototype,"_error",void 0);b.__decorate([e.property()],l.prototype,"_featureAbortController",void 0);b.__decorate([e.property({readOnly:!0})],l.prototype,"_effectivePopupTemplate",null);b.__decorate([e.property({readOnly:!0})],l.prototype,"_fieldInfoMap",null);
b.__decorate([e.property({readOnly:!0})],l.prototype,"_sourceLayer",null);b.__decorate([e.property()],l.prototype,"abilities",void 0);b.__decorate([w.cast("abilities")],l.prototype,"castAbilities",null);b.__decorate([e.property({readOnly:!0})],l.prototype,"content",void 0);b.__decorate([e.property({readOnly:!0})],l.prototype,"contentViewModels",void 0);b.__decorate([e.property({type:Boolean})],l.prototype,"defaultPopupTemplateEnabled",void 0);b.__decorate([e.property({readOnly:!0})],l.prototype,"state",
null);b.__decorate([e.property({readOnly:!0})],l.prototype,"formattedAttributes",void 0);b.__decorate([e.property({type:c,value:null})],l.prototype,"graphic",null);b.__decorate([e.property({readOnly:!0})],l.prototype,"lastEditInfo",void 0);b.__decorate([e.property({readOnly:!0})],l.prototype,"relatedInfos",void 0);b.__decorate([e.property()],l.prototype,"spatialReference",null);b.__decorate([e.property({readOnly:!0})],l.prototype,"title",void 0);b.__decorate([e.property()],l.prototype,"map",null);
b.__decorate([e.property({readOnly:!0})],l.prototype,"waitingForContent",null);b.__decorate([e.property()],l.prototype,"view",void 0);return l=D=b.__decorate([t.subclass("esri.widgets.FeatureViewModel")],l)})},"esri/arcade/featureset/support/FeatureSetQueryInterceptor":function(){define(["exports"],function(a){a.FeatureSetQueryInterceptor=function(b,c){this.preLayerQueryCallback=b;this.preRequestCallback=c;this.preLayerQueryCallback||(this.preLayerQueryCallback=m=>{});this.preRequestCallback||(this.preLayerQueryCallback=
m=>{})};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Feature/support/FeatureContentMixin":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/set ../../../core/accessorSupport/decorators/subclass ../../support/widget ../../support/jsxFactory".split(" "),function(a,
b,c,m,l,r,n,g,k,f,d){a.FeatureContentMixin=e=>{e=function(h){function v(){var w=h.apply(this,arguments)||this;w.renderNodeContent=t=>f.isWidget(t)&&!t.destroyed?d.tsx("div",{key:t},t.render()):t instanceof HTMLElement?d.tsx("div",{key:t,bind:t,afterCreate:w._attachToNode}):f.hasDomNode(t)?d.tsx("div",{key:t,bind:t.domNode,afterCreate:w._attachToNode}):null;return w}b._inheritsLoose(v,h);v.prototype._attachToNode=function(w){w.appendChild(this)};return v}(e);return e=c.__decorate([k.subclass("esri.widgets.Feature.ContentMixin")],
e)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Spinner":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/maybe ../core/promiseUtils ../core/reactiveUtils ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Spinner/SpinnerViewModel ./support/widgetUtils ./support/jsxFactory".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w){n=function(t){function x(q,u){q=t.call(this,q,u)||this;q._animationDelay=500;q._animationPromise=null;q.location=null;q.view=null;q.viewModel=new h;q.visible=!1;return q}a._inheritsLoose(x,t);var B=x.prototype;B.initialize=function(){this.own([l.watch(()=>this.visible,q=>this._visibleChange(q))])};B.destroy=function(){this._animationPromise=null};B.show=function(q){const {location:u,promise:C}=q;u&&(this.viewModel.location=u);this.visible=!0;q=()=>this.hide();
C&&C.catch(()=>{}).then(q)};B.hide=function(){this.visible=!1};B.render=function(){var {visible:q}=this,{screenLocation:u}=this.viewModel;u=!!u;q={["esri-spinner--start"]:q&&u,["esri-spinner--finish"]:!q&&u};u=this._getPositionStyles();return w.tsx("div",{class:this.classes("esri-spinner",q),styles:u})};B._visibleChange=function(q){if(q)this.viewModel.screenLocationEnabled=!0;else{var u=m.after(this._animationDelay);this._animationPromise=u;u.catch(()=>{}).then(()=>{this._animationPromise===u&&(this.viewModel.screenLocationEnabled=
!1,this._animationPromise=null)})}};B._getPositionStyles=function(){const {screenLocation:q,view:u}=this.viewModel;if(c.isNone(u)||c.isNone(q))return{};const {padding:C}=u;return{left:`${q.x-C.left}px`,top:`${q.y-C.top}px`}};return x}(e);b.__decorate([r.aliasOf("viewModel.location")],n.prototype,"location",void 0);b.__decorate([r.aliasOf("viewModel.view")],n.prototype,"view",void 0);b.__decorate([f.property({type:h})],n.prototype,"viewModel",void 0);b.__decorate([r.aliasOf("viewModel.visible")],n.prototype,
"visible",void 0);return n=b.__decorate([d.subclass("esri.widgets.Spinner")],n)})},"esri/widgets/Spinner/SpinnerViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../support/AnchorElementViewModel".split(" "),function(a,b,c,m,l,r,n,g){m=function(k){function f(d){d=k.call(this,d)||this;d.visible=
!1;return d}a._inheritsLoose(f,k);return f}(g);b.__decorate([c.property()],m.prototype,"visible",void 0);return m=b.__decorate([n.subclass("esri.widgets.CompassViewModel")],m)})},"esri/widgets/support/AnchorElementViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Evented ../../core/Handles ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){const e=Symbol("anchorHandles");c=function(v){function w(t){var x=v.call(this,t)||this;x[h]=new m;x.location=null;x.screenLocationEnabled=!1;x.view=null;x[e].add([r.when(()=>l.applySome(x.screenLocationEnabled?x.view:null,B=>[B.size,"3d"===B.type?B.camera:B.viewpoint]),()=>x.notifyChange("screenLocation")),r.watch(()=>x.screenLocation,(B,q)=>{l.isSome(B)&&l.isSome(q)&&x.emit("view-change")})]);return x}a._inheritsLoose(w,v);w.prototype.destroy=function(){this.view=
null;this[e]=l.destroyMaybe(this[e])};a._createClass(w,[{key:"screenLocation",get:function(){const {location:t,view:x,screenLocationEnabled:B}=this;return B&&l.isSome(t)&&l.isSome(x)&&x.ready?x.toScreen(t):null}}]);return w}(c.EventedAccessor);var h=e;b.__decorate([n.property()],c.prototype,"location",void 0);b.__decorate([n.property()],c.prototype,"screenLocation",null);b.__decorate([n.property()],c.prototype,"screenLocationEnabled",void 0);b.__decorate([n.property()],c.prototype,"view",void 0);
return c=b.__decorate([d.subclass("esri.widgets.support.AnchorElementViewModel")],c)})},"esri/widgets/Popup/PopupViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../Graphic ../../symbols ../../core/Collection ../../core/Error ../../core/Handles ../../core/Logger ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/webMercatorUtils ../../layers/Layer ../../support/actions/ActionBase ../../support/actions/ActionButton ../../support/actions/ActionToggle ../../symbols/support/symbolUtils ../../views/input/InputManager ../../views/support/layerViewUtils ../Feature/FeatureViewModel ./actions ./actionUtils ../support/AnchorElementViewModel ../support/GoTo ../../geometry/Point ../../symbols/SimpleFillSymbol".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K){const N=r.ofType({key:"type",defaultKeyValue:"button",base:q,typeMap:{button:u,toggle:C}}),M=k.getLogger("esri.widgets.Popup.PopupViewModel");c=function(L){function J(I){I=L.call(this,I)||this;I._handles=new g;I._pendingPromises=new Set;I._fetchFeaturesController=null;I._selectedClusterFeature=null;I.featurePage=null;I.actions=new N;I.activeFeature=null;I.defaultPopupTemplateEnabled=!1;I.autoCloseEnabled=!1;I.autoOpenEnabled=
!0;I.browseClusterEnabled=!1;I.content=null;I.featuresPerPage=20;I.featureViewModelAbilities=null;I.featureViewModels=[];I.highlightEnabled=!0;I.includeDefaultActions=!0;I.selectedClusterBoundaryFeature=new m({symbol:new K({outline:{width:1.5,color:"cyan"},style:"none"})});I.title=null;I.updateLocationEnabled=!1;I.view=null;I.visible=!1;I.zoomFactor=4;I.zoomToLocation=null;return I}a._inheritsLoose(J,L);var H=J.prototype;H.initialize=function(){this._handles.add([d.watch(()=>[this.autoOpenEnabled,
this.view],()=>this._autoOpenEnabledChange()),this.on("view-change",()=>this._autoClose()),d.watch(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),d.watch(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),d.watch(()=>{var I,O;return null==(I=this.view)?void 0:null==(O=I.animation)?void 0:O.state},I=>this._animationStateChange(I)),d.watch(()=>this.location,I=>this._locationChange(I)),
d.watch(()=>this.selectedFeature,I=>this._selectedFeatureChange(I)),d.watch(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),d.watch(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),d.watch(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",I=>E.triggerAction({event:I,view:this.view})),d.when(()=>
!this.waitingForResult,()=>this._waitingForResultChange(),d.sync),d.watch(()=>{var I,O;return[this.features,null==(I=this.view)?void 0:I.map,null==(O=this.view)?void 0:O.spatialReference]},()=>this._updateFeatureVMs()),d.watch(()=>{var I;return null==(I=this.view)?void 0:I.scale},()=>this._viewScaleChange()),d.when(()=>!this.visible,()=>this.browseClusterEnabled=!1),d.watch(()=>this.browseClusterEnabled,I=>I?this.enableClusterBrowsing():this.disableClusterBrowsing())])};H.destroy=function(){this._cancelFetchingFeatures();
this._handles.destroy();this._handles=null;this._pendingPromises.clear();this.browseClusterEnabled=!1;this.view=null};H.centerAtLocation=function(){var {view:I}=this;const O=E.getSelectedTarget(this);return O?this.callGoTo({target:{target:O,scale:I.scale}}):(I=new n("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:O,view:I}),M.error(I),Promise.reject(I))};H.clear=function(){this.set({promises:[],features:[],content:null,title:null,location:null,
activeFeature:null})};H.fetchFeatures=function(I,O){const {view:Q}=this;return Q&&I?Q.fetchPopupFeatures(I,{event:O&&O.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:O&&O.signal}):(I=new n("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:I,view:Q}),M.error(I),Promise.reject(I))};H.open=function(I){I={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...I,visible:!0};var {fetchFeatures:O}=I;delete I.fetchFeatures;
O&&this._setFetchFeaturesPromises(I.location);O=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const Q of O)delete I[Q];this.set(I)};H.triggerAction=function(I){(I=this.allActions.getItemAt(I))&&!I.disabled&&this.emit("trigger-action",{action:I})};H.next=function(){this.selectedFeatureIndex+=1;return this};H.previous=function(){--this.selectedFeatureIndex;return this};H.disableClusterBrowsing=function(){E.removeClusteredFeaturesForBrowsing(this);this._clearBrowsedClusterGraphics()};H.enableClusterBrowsing=
function(){var I=a._asyncToGenerator(function*(){const {view:O,selectedFeature:Q}=this;"2d"!==(null==O?void 0:O.type)?M.warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",Q):E.isClusterFeature(Q)?(yield E.displayClusterExtent(this),yield E.browseAggregateFeatures(this)):M.warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",Q)});return function(){return I.apply(this,arguments)}}();H._animationStateChange=function(I){this.zoomToLocation||
(D.zoomToFeature.disabled="waiting-for-target"===I)};H._clearBrowsedClusterGraphics=function(){var I;const O=null==(I=this.view)?void 0:I.graphics;O&&(O.remove(this.selectedClusterBoundaryFeature),O.remove(this._selectedClusterFeature));this._selectedClusterFeature=null;this.selectedClusterBoundaryFeature.geometry=null};H._viewScaleChange=function(){E.isClusterFeature(this.selectedFeature)?(this.visible=this.browseClusterEnabled=!1,this.clear()):this.browseClusterEnabled&&(this.features=[this.selectedFeature])};
H._locationChange=function(I){const {selectedFeature:O,updateLocationEnabled:Q}=this;Q&&I&&(!O||O.geometry)&&this.centerAtLocation()};H._selectedFeatureIndexChange=function(){this.featurePage=1<this.featureCount?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null};H._featureViewModelsChange=function(){this.featurePage=1<this.featureCount?1:null};H._setGraphicOnFeatureViewModels=function(){const {features:I,featureCount:O,featurePage:Q,featuresPerPage:S,featureViewModels:T}=this;if(null!==
Q){var U=((Q-1)*S+O)%O;T.slice(U,U+S).forEach((aa,W)=>{aa&&!aa.graphic&&(aa.graphic=I[U+W])})}};H._selectedFeatureChange=function(){var I=a._asyncToGenerator(function*(O){if(O){var {location:Q,updateLocationEnabled:S,view:T}=this;this.browseClusterEnabled?(this._selectedClusterFeature&&(T.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),E.isClusterFeature(O)||(O.symbol=yield z.getDisplayedSymbol(O),this._selectedClusterFeature=O,T.graphics.add(this._selectedClusterFeature))):
!S&&Q||!O.geometry?S&&!O.geometry&&this.centerAtLocation().then(()=>{this.location=T.center.clone()}):this.location=f.unwrap(this._getPointFromGeometry(O.geometry))}});return function(O){return I.apply(this,arguments)}}();H._waitingForResultChange=function(){!this.featureCount&&this.promises&&(this.visible=!1)};H._setFetchFeaturesPromises=function(I){return this._fetchFeaturesWithController(this._getScreenPoint(I||this.location)).then(O=>{const {clientOnlyGraphics:Q,promisesPerLayerView:S}=O;O=Promise.resolve(Q);
const T=S.map(U=>U.promise);this.promises=[O,...T]})};H._destroyFeatureVMs=function(){this.featureViewModels.forEach(I=>I&&!I.destroyed&&I.destroy());this._set("featureViewModels",[])};H._updateFeatureVMs=function(){const {selectedFeature:I,features:O,featureViewModels:Q}=this;E.isClusterFeature(I)||(this.browseClusterEnabled=!1);this._destroyFeatureVMs();if(O&&O.length){var S=Q.slice(0),T=[];O.forEach((U,aa)=>{if(U){var W=null;S.some((da,ca)=>{da&&da.graphic===U&&(W=da,S.splice(ca,1));return!!W});
if(W)T[aa]=W;else{var R,V;const da=new y({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:null==(R=this.view)?void 0:R.spatialReference,graphic:U===I?U:null,map:null==(V=this.view)?void 0:V.map,view:this.view});T[aa]=da}}});S.forEach(U=>U&&!U.destroyed&&U.destroy());this._set("featureViewModels",T)}};H._getScreenPoint=function(I){const {view:O}=this;return O&&I&&"function"===typeof O.toScreen?O.toScreen(I):null};H._autoOpenEnabledChange=
function(){const {_handles:I,autoOpenEnabled:O}=this;I.remove("auto-fetch-features");if(O&&this.view){const Q=this.view.on("click",S=>{"mouse"===S.pointerType&&0!==S.button||this._fetchFeaturesAndOpen(S)},A.ViewEventPriorities.WIDGET);I.add(Q,"auto-fetch-features")}};H._cancelFetchingFeatures=function(){const I=this._fetchFeaturesController;I&&I.abort();this._fetchFeaturesController=null;this.notifyChange("waitingForResult")};H._fetchFeaturesWithController=function(I,O){this._cancelFetchingFeatures();
const Q=new AbortController,{signal:S}=Q;this._fetchFeaturesController=Q;this.notifyChange("waitingForResult");I=this.fetchFeatures(I,{signal:S,event:O});I.catch(()=>{}).then(()=>{this._fetchFeaturesController=null;this.notifyChange("waitingForResult")});return I};H._fetchFeaturesAndOpen=function(I){const {screenPoint:O,mapPoint:Q}=I,{view:S}=this;this._fetchFeaturesWithController(O,I).then(T=>{const {clientOnlyGraphics:U,promisesPerLayerView:aa,location:W}=T,R=[Promise.resolve(U),...aa.map(V=>V.promise)];
S.popup.open({location:W||Q,promises:R});return T})};H._updatePendingPromises=function(I){I&&this._pendingPromises.has(I)&&(this._pendingPromises.delete(I),this.notifyChange("pendingPromisesCount"))};H._autoClose=function(){this.autoCloseEnabled&&(this.visible=!1)};H._getPointFromGeometry=function(I){return f.isNone(I)?null:"point"===I.type?I:"extent"===I.type?I.center:"polygon"===I.type?I.centroid:"multipoint"===I.type||"polyline"===I.type?I.extent.center:null};H._getLayerView=function(){var I=a._asyncToGenerator(function*(O,
Q){yield O.when();return O.whenLayerView(Q)});return function(O,Q){return I.apply(this,arguments)}}();H._getHighlightLayer=function(I){const {layer:O,sourceLayer:Q}=I;return"map-notes"===(null==Q?void 0:Q.type)||"subtype-group"===(null==Q?void 0:Q.type)?Q:O};H._getHighlightTarget=function(I,O){O="imagery"===O.type?void 0:"objectIdField"in O&&O.objectIdField;const Q=I.attributes;return Q&&O&&Q[O]||I};H._highlightActiveFeature=function(){var I=a._asyncToGenerator(function*(){this._handles.remove("highlight-active-feature");
const {highlightEnabled:O,view:Q,activeFeature:S,visible:T}=this;if(S&&Q&&O&&T){var U=this._getHighlightLayer(S);if(U&&U instanceof B){var aa=this._getLayerView(Q,U);this._highlightActiveFeaturePromise=aa;var W=yield aa;W&&p.highlightsSupported(W)&&this._highlightActiveFeaturePromise===aa&&this.activeFeature&&this.highlightEnabled&&(U=W.highlight(this._getHighlightTarget(S,U)),this._handles.add(U,"highlight-active-feature"))}}});return function(){return I.apply(this,arguments)}}();H._highlightSelectedFeature=
function(){var I=a._asyncToGenerator(function*(){this._handles.remove("highlight-selected-feature");const {selectedFeature:O,highlightEnabled:Q,view:S,visible:T}=this;if(O&&S&&Q&&T){var U=this._getHighlightLayer(O);if(U&&U instanceof B){var aa=this._getLayerView(S,U);this._highlightSelectedFeaturePromise=aa;var W=yield aa;W&&p.highlightsSupported(W)&&this._highlightSelectedFeaturePromise===aa&&this.selectedFeature&&this.highlightEnabled&&this.visible&&(U=W.highlight(this._getHighlightTarget(O,U)),
this._handles.add(U,"highlight-selected-feature"))}}});return function(){return I.apply(this,arguments)}}();H._updateFeatures=function(I){const {features:O}=this;I&&I.length&&(O.length?(I=I.filter(Q=>!O.includes(Q)),this.features=O.concat(I)):this.features=I)};a._createClass(J,[{key:"isLoadingFeature",get:function(){return this.featureViewModels.some(I=>I.waitingForContent)}},{key:"active",get:function(){return!(!this.visible||this.waitingForResult)}},{key:"allActions",get:function(){const I=this._get("allActions")||
new N;I.removeAll();const {actions:O,defaultActions:Q,defaultPopupTemplateEnabled:S,includeDefaultActions:T,selectedFeature:U}=this;var aa=T?Q.concat(O):O;const W=U&&("function"===typeof U.getEffectivePopupTemplate&&U.getEffectivePopupTemplate(S)||U.popupTemplate),R=W&&W.actions;(aa=W&&W.overwriteActions?R:R?R.concat(aa):aa)&&aa.filter(Boolean).forEach(V=>I.add(V));return I}},{key:"defaultActions",get:function(){const I=this._get("defaultActions")||new N;I.removeAll();I.addMany(E.isClusterFeature(this.selectedFeature)?
[D.zoomToClusteredFeatures.clone(),D.browseClusteredFeatures.clone()]:[D.zoomToFeature.clone()]);return I}},{key:"featureCount",get:function(){return this.features.length}},{key:"features",get:function(){return this._get("features")||[]},set:function(I){I=I||[];this._set("features",I);const {pendingPromisesCount:O,promiseCount:Q,selectedFeatureIndex:S}=this,T=Q&&I.length;T&&O&&-1===S?this.selectedFeatureIndex=0:T&&-1!==S||(this.selectedFeatureIndex=I.length?0:-1)}},{key:"location",get:function(){return this._get("location")||
null},set:function(I){const O=this.get("view.spatialReference.isWebMercator");I&&I.get("spatialReference.isWGS84")&&O&&(I=x.geographicToWebMercator(I));this._set("location",I)}},{key:"pendingPromisesCount",get:function(){return this._pendingPromises.size}},{key:"waitingForResult",get:function(){return!(!(this._fetchFeaturesController||0<this.pendingPromisesCount)||0!==this.featureCount)}},{key:"promiseCount",get:function(){return this.promises.length}},{key:"promises",get:function(){return this._get("promises")||
[]},set:function(I){this._pendingPromises.clear();this.features=[];Array.isArray(I)&&I.length?(this._set("promises",I),I=I.slice(0),I.forEach(O=>{this._pendingPromises.add(O);O.then(Q=>{this._pendingPromises.has(O)&&this._updateFeatures(Q);this._updatePendingPromises(O)},()=>this._updatePendingPromises(O))})):this._set("promises",[]);this.notifyChange("pendingPromisesCount")}},{key:"selectedFeature",get:function(){const {features:I,selectedFeatureIndex:O}=this;return-1===O?null:I[O]||null}},{key:"selectedFeatureIndex",
get:function(){const I=this._get("selectedFeatureIndex");return"number"===typeof I?I:-1},set:function(I){const {featureCount:O}=this;I=isNaN(I)||-1>I||!O?-1:(I+O)%O;this.activeFeature=null;this._set("selectedFeatureIndex",I)}},{key:"selectedFeatureViewModel",get:function(){return this.featureViewModels[this.selectedFeatureIndex]||null}},{key:"state",get:function(){return this.get("view.ready")?"ready":"disabled"}}]);return J}(G.GoToMixin(F));b.__decorate([e.property()],c.prototype,"featurePage",void 0);
b.__decorate([e.property()],c.prototype,"isLoadingFeature",null);b.__decorate([e.property({type:N})],c.prototype,"actions",void 0);b.__decorate([e.property({readOnly:!0})],c.prototype,"active",null);b.__decorate([e.property()],c.prototype,"activeFeature",void 0);b.__decorate([e.property({readOnly:!0})],c.prototype,"allActions",null);b.__decorate([e.property({type:Boolean})],c.prototype,"defaultPopupTemplateEnabled",void 0);b.__decorate([e.property()],c.prototype,"autoCloseEnabled",void 0);b.__decorate([e.property()],
c.prototype,"autoOpenEnabled",void 0);b.__decorate([e.property()],c.prototype,"browseClusterEnabled",void 0);b.__decorate([e.property()],c.prototype,"content",void 0);b.__decorate([e.property({type:N,readOnly:!0})],c.prototype,"defaultActions",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"featureCount",null);b.__decorate([e.property()],c.prototype,"features",null);b.__decorate([e.property()],c.prototype,"featuresPerPage",void 0);b.__decorate([e.property()],c.prototype,"featureViewModelAbilities",
void 0);b.__decorate([e.property({readOnly:!0})],c.prototype,"featureViewModels",void 0);b.__decorate([e.property()],c.prototype,"highlightEnabled",void 0);b.__decorate([e.property()],c.prototype,"includeDefaultActions",void 0);b.__decorate([e.property({type:P})],c.prototype,"location",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"pendingPromisesCount",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"selectedClusterBoundaryFeature",void 0);b.__decorate([e.property({readOnly:!0})],
c.prototype,"waitingForResult",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"promiseCount",null);b.__decorate([e.property()],c.prototype,"promises",null);b.__decorate([e.property({value:null,readOnly:!0})],c.prototype,"selectedFeature",null);b.__decorate([e.property({value:-1})],c.prototype,"selectedFeatureIndex",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"selectedFeatureViewModel",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"state",null);b.__decorate([e.property()],
c.prototype,"title",void 0);b.__decorate([e.property()],c.prototype,"updateLocationEnabled",void 0);b.__decorate([e.property()],c.prototype,"view",void 0);b.__decorate([e.property()],c.prototype,"visible",void 0);b.__decorate([e.property()],c.prototype,"zoomFactor",void 0);b.__decorate([e.property()],c.prototype,"zoomToLocation",void 0);b.__decorate([e.property()],c.prototype,"centerAtLocation",null);return c=b.__decorate([t.subclass("esri.widgets.Popup.PopupViewModel")],c)})},"esri/symbols/support/symbolUtils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/maybe ../../support/arcadeOnDemand ./gfxUtils ./previewUtils ./renderUtils ./utils".split(" "),
function(a,b,c,m,l,r,n,g,k,f){function d(q,u){if(u&&(q.style.filter=f.getCSSFilterFromEffectList(u),u=u.effects))for(const C of u)if("drop-shadow"===(null==C?void 0:C.type)){0>C.offsetX?q.style.marginLeft=`${Math.abs(C.offsetX)}px`:q.style.marginRight=`${C.offsetX}px`;break}}function e(q,u){return h.apply(this,arguments)}function h(){h=c._asyncToGenerator(function*(q,u){switch(q.type){case "web-style":var {previewWebStyleSymbol:C}=yield new Promise((z,A)=>a(["./previewWebStyleSymbol"],z,A));return C(q,
e,u);case "label-3d":case "line-3d":case "mesh-3d":case "point-3d":case "polygon-3d":return{previewSymbol3D:C}=yield new Promise((z,A)=>a(["./previewSymbol3D"],z,A)),C(q,u);case "simple-marker":case "simple-line":case "simple-fill":case "picture-marker":case "picture-fill":case "text":return{previewSymbol2D:C}=yield new Promise((z,A)=>a(["./previewSymbol2D"],z,A)),C(q,u);case "cim":return{previewCIMSymbol:C}=yield new Promise((z,A)=>a(["./previewCIMSymbol"],z,A)),C(q,u)}});return h.apply(this,arguments)}
function v(q){return q&&"opacity"in q?q.opacity*v(q.parent):1}function w(){w=c._asyncToGenerator(function*(q,u){var C,z;if(q){var A=q.sourceLayer;A=null!=(C=l.isSome(u)&&null!=(z=u.useSourceLayer)&&z?A:q.layer)?C:A;C=v(A);if(l.isSome(q.symbol)&&(!l.isSome(u)||!0!==u.ignoreGraphicSymbol))return q="web-style"===q.symbol.type?yield q.symbol.fetchSymbol({...u,cache:l.isSome(u)?u.webStyleCache:null}):q.symbol.clone(),f.applyColorToSymbol(q,null,C),q;var p=l.isSome(u)&&u.renderer||A&&"renderer"in A&&A.renderer;
if(z=p&&"getSymbolAsync"in p?yield p.getSymbolAsync(q,u):null){z="web-style"===z.type?yield z.fetchSymbol({...u,cache:l.isSome(u)?u.webStyleCache:null}):z.clone();if(!("visualVariables"in p&&p.visualVariables&&p.visualVariables.length))return f.applyColorToSymbol(z,null,C),z;"arcadeRequiredForVisualVariables"in p&&p.arcadeRequiredForVisualVariables&&(l.isNone(u)||l.isNone(u.arcade))&&(u={...l.unwrap(u)},u.arcade=yield r.loadArcade());A=yield new Promise((P,K)=>a(["../../renderers/visualVariables/support/visualVariableUtils"],
P,K));var y=[],D=[],E=[],F=[];for(var G of p.visualVariables)switch(G.type){case "color":y.push(G);break;case "opacity":D.push(G);break;case "rotation":F.push(G);break;case "size":G.target||E.push(G)}G=(G=!!y.length&&y[y.length-1])?A.getColor(G,q,u):null;D=(D=!!D.length&&D[D.length-1])?A.getOpacity(D,q,u):null;null!=C&&(D=null!=D?D*C:C);f.applyColorToSymbol(z,G,D);E.length&&(C=A.getAllSizes(E,q,u),yield f.applySizesToSymbol(z,C));for(const P of F)f.applyRotationToSymbol(z,A.getRotationAngle(P,q,u),
P.axis);return z}}});return w.apply(this,arguments)}function t(){t=c._asyncToGenerator(function*(q,u){var C;if(q){var z=v(q.layer||q.sourceLayer);if(l.isSome(q.symbol)&&(!l.isSome(u)||!0!==u.ignoreGraphicSymbol))return q="web-style"===q.symbol.type?yield q.symbol.fetchSymbol(u):q.symbol.clone(),f.getColorFromSymbol(q,z);var A=l.isSome(u)&&u.renderer||q.get("layer.renderer")||q.get("sourceLayer.renderer"),p=yield A.getSymbolAsync(q,u);if(p){p="web-style"===p.type?yield p.fetchSymbol(u):p.clone();p=
f.getColorFromSymbol(p,z);if(!("visualVariables"in A)||"visualVariables"in A&&!A.visualVariables||"visualVariables"in A&&(null==(C=A.visualVariables)||!C.length))return p;A.arcadeRequiredForVisualVariables&&(l.isNone(u)||l.isNone(u.arcade))&&(u={...l.unwrap(u)},u.arcade=yield r.loadArcade());C=yield new Promise((E,F)=>a(["../../renderers/visualVariables/support/visualVariableUtils"],E,F));var y=[],D=[];for(const E of A.visualVariables)switch(E.type){case "color":y.push(E);break;case "opacity":D.push(E)}A=
(A=0<y.length?y[y.length-1]:null)?C.getColor(A,q,u):p;q=(p=0<D.length?D[D.length-1]:null)?C.getOpacity(p,q,u):null;null!=z&&(q=null!=q?q*z:z);return A?f.applyOpacityToColor(A,q):null}}});return t.apply(this,arguments)}let x=null;const B=[255,255,255];b.getDisplayedColor=function(q,u){return t.apply(this,arguments)};b.getDisplayedSymbol=function(q,u){return w.apply(this,arguments)};b.renderColorRampPreviewHTML=function(q,u={}){var C="horizontal"===u.align;const {width:z=C?75:24,height:A=C?24:75,gradient:p=
!0}=u;var y=window.devicePixelRatio,D=z*y,E=A*y;y=document.createElement("canvas");y.width=D;y.height=E;y.style.width=`${z}px`;y.style.height=`${A}px`;const F=y.getContext("2d");var G=C?D:0,P=C?0:E;if(p){const K=F.createLinearGradient(0,0,G,P);C=q.length;const N=1===C?0:1/(C-1);q.forEach((M,L)=>K.addColorStop(L*N,M.toString()));F.fillStyle=K;F.fillRect(0,0,D,E)}else{D=C?D/q.length:D;E=C?E:E/q.length;P=G=0;for(const K of q)F.fillStyle=K.toString(),F.fillRect(G,P,D,E),G=C?G+D:0,P=C?0:P+E}q=document.createElement("div");
q.style.width=`${z}px`;q.style.height=`${A}px`;d(q,null==u?void 0:u.effectList);q.appendChild(y);return q};b.renderDotDensityPreviewHTML=function(q,u,C){const {backgroundColor:z,outline:A,dotSize:p}=q;C=C&&C.swatchSize||g.SymbolSizeDefaults.size;const y=Math.round(C*C/p**2*.8),D=window.devicePixelRatio;q=document.createElement("canvas");const E=C*D;q.width=E;q.height=E;q.style.width=`${q.width/D}px`;q.style.height=`${q.height/D}px`;const F=q.getContext("2d");z&&(F.fillStyle=z.toCss(!0),F.fillRect(0,
0,E,E),F.fill());F.fillStyle=u.toCss(!0);if(x&&x.length/2===y)for(u=0;u<2*y;u+=2)F.fillRect(x[u],x[u+1],p*D,p*D),F.fill();else for(x=[],u=0;u<2*y;u+=2){const G=Math.floor(Math.random()*(E-0+1)),P=Math.floor(Math.random()*(E-0+1));x.push(G,P);F.fillRect(G,P,p*D,p*D);F.fill()}A&&(A.color&&(F.strokeStyle=A.color.toCss(!0)),F.lineWidth=A.width,F.strokeRect(0,0,E,E));C=new Image(C,C);C.src=q.toDataURL();return C};b.renderPieChartPreviewHTML=function(q,u={}){const C=u.radius||40;var z=2*Math.PI*C,A=q.length;
const p=z/A,y=[],D=n.getStroke(u.outline);D&&(D.width*=2);(D||u.backgroundColor)&&y.push({shape:{type:"circle",cx:C,cy:C,r:C},fill:u.backgroundColor,stroke:D,offset:[0,0]});const E=u.values,F=E&&E.length===A&&100===E.reduce((P,K)=>P+K,0),G=[0];for(let P=0;P<A;P++){const K=F?E[P]*z/100:null;F&&G.push(K+G[P]);y.push({shape:{type:"circle",cx:C,cy:C,r:C/2},fill:[0,0,0,0],stroke:{width:C,dashArray:`${K||p} ${z}`,dashoffset:`-${F?G[P]/2:p/2*P}`,color:q[P]},offset:[0,0]})}A=null;q=2*C+((null==D?void 0:D.width)||
0);if(z=u.holePercentage)D&&y.push({shape:{type:"circle",cx:C,cy:C,r:C*z},fill:null,stroke:D,offset:[0,0]}),A=q/2,A=[[{shape:{type:"circle",cx:A,cy:A,r:A},fill:B,stroke:D?{...D,color:B}:null,offset:[0,0]},{shape:{type:"circle",cx:A,cy:A,r:C*z},fill:[0,0,0],stroke:null,offset:[0,0]}]];return k.renderSymbol([y],[q,q],{effectView:u.effectList,ignoreStrokeWidth:!0,masking:A,rotation:-90})};b.renderPreviewHTML=e;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/symbols/support/previewUtils":function(){define(["exports","../../Color"],function(a,b){function c(m,l){return Math.round(Math.min(Math.max(m+191.25*l,0),255))}a.SymbolSizeDefaults=void 0;(function(m){m[m.size=22]="size";m[m.lineWidth=50]="lineWidth";m[m.maxSize=120]="maxSize";m[m.maxOutlineSize=80]="maxOutlineSize";m[m.tallSymbolWidth=20]="tallSymbolWidth"})(a.SymbolSizeDefaults||(a.SymbolSizeDefaults={}));a.adjustColorBrightness=function(m,l){if("type"in m&&("linear"===m.type||"pattern"===
m.type))return m;m=new b(m);return new b([c(m.r,l),c(m.g,l),c(m.b,l),m.a])};a.adjustColorComponentBrightness=c;a.getConeShapes=function(m,l){let r=l?a.SymbolSizeDefaults.tallSymbolWidth:m;l=l?4:6;r=r<=a.SymbolSizeDefaults.size?r-.5*l:r-l;l=.15*r;const n=r;m-=l;return[{type:"ellipse",cx:.5*r,cy:m,rx:.5*r,ry:l},{type:"path",path:[{command:"M",values:[.5*n,0]},{command:"L",values:[n,m]},{command:"L",values:[0,m]},{command:"Z",values:[]}]}]};a.getCubeShapes=function(m,l){let r=l?a.SymbolSizeDefaults.tallSymbolWidth:
m;var n=l?4:6;n=r=r<=a.SymbolSizeDefaults.size?r-.5*n:r-n;l=l?.35*r:.5*r;return[{type:"path",path:[{command:"M",values:[.5*n,0]},{command:"L",values:[n,.5*l]},{command:"L",values:[.5*n,l]},{command:"L",values:[0,.5*l]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*l]},{command:"L",values:[.5*n,l]},{command:"L",values:[.5*n,m]},{command:"L",values:[0,m-.5*l]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*n,l]},{command:"L",values:[.5*n,m]},{command:"L",
values:[n,m-.5*l]},{command:"L",values:[n,.5*l]},{command:"Z",values:[]}]}]};a.getCylinderShapes=function(m,l){var r=l?a.SymbolSizeDefaults.tallSymbolWidth:m;l=l?4:6;r=r<=a.SymbolSizeDefaults.size?r-.5*l:r-l;l=.5*r;const n=.15*r;m-=n;return[{type:"ellipse",cx:.5*r,cy:m,rx:l,ry:n},{type:"path",path:[{command:"M",values:[0,n]},{command:"L",values:[0,m]},{command:"L",values:[r,m]},{command:"L",values:[r,n]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*r,cy:n,rx:l,ry:n}]};a.getDiamondShapes=function(m){var l=
m;l=l<a.SymbolSizeDefaults.size?l-2:l-4;const r=Math.floor(m/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*l,0]},{command:"L",values:[l,.5*m-r]},{command:"L",values:[.45*l-r,.5*m+r]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*l,0]},{command:"L",values:[.45*l-r,.5*m+r]},{command:"L",values:[0,.5*m-r]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*m-r]},{command:"L",values:[.45*l-r,.5*m+r]},{command:"L",values:[.45*l,m]},{command:"Z",
values:[]}]},{type:"path",path:[{command:"M",values:[.45*l,m]},{command:"L",values:[l,.5*m-r]},{command:"L",values:[.45*l-r,.5*m+r]},{command:"Z",values:[]}]}]};a.getExtrudeSymbolShapes=function(m){const l=a.SymbolSizeDefaults.size;m*=.5;return[{type:"path",path:[{command:"M",values:[0,.35*l]},{command:"L",values:[.3*l,.7*l]},{command:"L",values:[.3*l,.7*l+m]},{command:"L",values:[0,.7*l+m-.35*l]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*l,.7*l]},{command:"L",values:[.3*
l,.7*l+m]},{command:"L",values:[l,m]},{command:"L",values:[l,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*l,0]},{command:"L",values:[l,0]},{command:"L",values:[.3*l,.7*l]},{command:"L",values:[0,.35*l]},{command:"Z",values:[]}]}]};a.getInvertedConeShapes=function(m){let l=m;l=l<a.SymbolSizeDefaults.size?l-3:l-6;const r=.15*l,n=l;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[n,0]},{command:"L",values:[.5*n,m-r]},{command:"Z",values:[]}]},{type:"ellipse",
cx:.5*l,cy:0,rx:.5*l,ry:r}]};a.getPathSymbolShapes=function(m,l,r){var n=a.SymbolSizeDefaults.size;let g=n,k=n;1>m?g*=.75:1<m&&(k*=1.25);m=n;l&&r&&(g=k=m=n=0);return[{type:"path",path:[{command:"M",values:[m,0]},{command:"L",values:[r?m:.875*m,0]},{command:"L",values:[r?g-.5*m:0,k-.5*n]},{command:"L",values:[g-.5*m,k-.5*n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[m,0]},{command:"L",values:[m,l?0:.125*n]},{command:"L",values:[g-.5*m,l?k-.5*n:n]},{command:"L",values:[g-.5*
m,k-.5*n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[g-.5*m,k-.5*n]},{command:"L",values:[r?g-.5*m:0,k-.5*n]},{command:"L",values:[r?g-.5*m:0,l?k-.5*n:n]},{command:"L",values:[g-.5*m,l?k-.5*n:n]},{command:"Z",values:[]}]}]};a.getTetrahedronShapes=function(m){var l=m;l=l<a.SymbolSizeDefaults.size?l-1:l-2;return[{type:"path",path:[{command:"M",values:[.45*m,0]},{command:"L",values:[m,l]},{command:"L",values:[.45*m,.6*l]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",
values:[.45*m,0]},{command:"L",values:[.45*m,.6*l]},{command:"L",values:[0,l]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,l]},{command:"L",values:[.45*m,.6*l]},{command:"L",values:[m,l]},{command:"Z",values:[]}]}]};a.getWaterSymbolShapes=function(){return[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},
{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},
{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]};
a.shapes={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],squareFill:[{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],
cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],
tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",
path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/symbols/support/renderUtils":function(){define("exports ../../kernel ../../request ../../core/colorUtils ../../core/Error ../../core/has ../../libs/maquette/projection ../../libs/maquette/projector ./svgUtils ./utils".split(" "),
function(a,b,c,m,l,r,n,g,k,f){function d(h,v,w){return h?c(h,{responseType:"image"}).then(t=>{t=t.data;const x=t.width,B=t.height,q=x/B;let u=v;w&&(u=Math.min(u,Math.max(x,B)));return{image:t,width:1>=q?Math.ceil(u*q):u,height:1>=q?u:Math.ceil(u/q)}}):Promise.reject(new l("renderUtils: imageDataSize","href not provided."))}const e=g.createProjector();a.renderSymbol=function(h,v,w){const t=Math.ceil(v[0]);v=Math.ceil(v[1]);if(!h.some(B=>!!B.length))return null;const x=w&&w.node||document.createElement("div");
null!=w.opacity&&(x.style.opacity=w.opacity.toString());null!=w.effectView&&(x.style.filter=f.getCSSFilterFromEffectList(w.effectView));e.append(x,k.renderSVG.bind(null,h,t,v,w));return x};a.tintImageWithColor=function(h,v,w,t,x){return d(h,v,x).then(B=>{const q=B.width?B.width:v,u=B.height?B.height:v;var C;if(C=B.image)C=w&&"ignore"!==t?"multiply"===t&&255===w.r&&255===w.g&&255===w.b&&1===w.a?!1:!0:!1;if(C){var z=B.image.width,A=B.image.height;r("edge")&&/\.svg$/i.test(h)&&(--z,--A);C=Math.ceil(q);
var p=Math.ceil(u);var y=document.createElement("canvas");y.width=C;y.height=p;y.style.width=C+"px";y.style.height=p+"px";y=y.getContext("2d");y.clearRect(0,0,C,p);C=y;C.drawImage(B.image,0,0,z,A,0,0,q,u);p=C.getImageData(0,0,q,u);y=[w.r/255,w.g/255,w.b/255,w.a];const E=m.toHSV(w);for(let F=0;F<p.data.length;F+=4){B=p.data;z=F;A=y;var D=E;switch(t){case "multiply":B[z+0]*=A[0];B[z+1]*=A[1];B[z+2]*=A[2];B[z+3]*=A[3];break;default:{const G=m.toHSV({r:B[z+0],g:B[z+1],b:B[z+2]});G.h=D.h;G.s=D.s;G.v=G.v/
100*D.v;D=m.toRGB(G);B[z+0]=D.r;B[z+1]=D.g;B[z+2]=D.b;B[z+3]*=A[3]}}}C.putImageData(p,0,0);h=C.canvas.toDataURL("image/png")}else(C=b.id&&b.id.findCredential(h))&&C.token&&(B=h.includes("?")?"\x26":"?",h=`${h}${B}token=${C.token}`);return{url:h,width:q,height:u}}).catch(()=>({url:h,width:v,height:v}))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/colorUtils":function(){define(["exports"],function(a){function b(f,d){const e=[];let h,v;if(f[0].length!==
d.length)throw"dimensions do not match";const w=f.length,t=f[0].length;let x=0;for(h=0;h<w;h++){for(v=x=0;v<t;v++)x+=f[h][v]*d[v];e.push(x)}return e}function c(f){f=[f.r/255,f.g/255,f.b/255].map(d=>.04045>=d?d/12.92:((d+.055)/1.055)**2.4);f=b(g,f);return{x:100*f[0],y:100*f[1],z:100*f[2]}}function m(f){f=b(k,[f.x/100,f.y/100,f.z/100]).map(d=>Math.min(1,Math.max(.0031308>=d?12.92*d:1.055*d**(1/2.4)-.055,0)));return{r:Math.round(255*f[0]),g:Math.round(255*f[1]),b:Math.round(255*f[2])}}function l(f){f=
[f.x/95.047,f.y/100,f.z/108.883].map(d=>d>(6/29)**3?d**(1/3):1/3*(29/6)**2*d+4/29);return{l:116*f[1]-16,a:500*(f[0]-f[1]),b:200*(f[1]-f[2])}}function r(f){const d=f.l;f=[(d+16)/116+f.a/500,(d+16)/116,(d+16)/116-f.b/200].map(e=>e>6/29?e**3:3*(6/29)**2*(e-4/29));return{x:95.047*f[0],y:100*f[1],z:108.883*f[2]}}function n(f){if("r"in f&&"g"in f&&"b"in f)return f;if("l"in f&&"c"in f&&"h"in f){var d=f.c;var e=f.h;d={l:f.l,a:d*Math.cos(e),b:d*Math.sin(e)};return m(r(d))}if("l"in f&&"a"in f&&"b"in f)return m(r(f));
if("x"in f&&"y"in f&&"z"in f)return m(f);if("h"in f&&"s"in f&&"v"in f){{e=(f.h+360)%360/60;d=f.v/100*255;f=f.s/100*d;const h=f*(1-Math.abs(e%2-1));switch(Math.floor(e)){case 0:e={r:f,g:h,b:0};break;case 1:e={r:h,g:f,b:0};break;case 2:e={r:0,g:f,b:h};break;case 3:e={r:0,g:h,b:f};break;case 4:e={r:h,g:0,b:f};break;case 5:case 6:e={r:f,g:0,b:h};break;default:e={r:0,g:0,b:0}}e.r=Math.round(e.r+d-f);e.g=Math.round(e.g+d-f);e.b=Math.round(e.b+d-f);d=e}return d}return f}const g=[[.4124,.3576,.1805],[.2126,
.7152,.0722],[.0193,.1192,.9505]],k=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];a.darken=function(f,d){f=l(c(f));f.l*=1-d;return m(r(f))};a.toHSV=function(f){if("h"in f&&"s"in f&&"v"in f)return f;var d=n(f);{f=d.r;const e=d.g,h=d.b;d=Math.max(f,e,h);const v=d-Math.min(f,e,h);f=0===v?0:d===f?(e-h)/v%6:d===e?(h-f)/v+2:(f-e)/v+4;0>f&&(f+=6);f={h:60*f,s:100*(0===v?0:v/d),v:100/255*d}}return f};a.toLAB=function(f){return"l"in f&&"a"in f&&"b"in f?f:l(c(n(f)))};a.toLCH=function(f){if(!("l"in
f&&"c"in f&&"h"in f)){{var d=l(c(n(f)));f=d.l;var e=d.a;const h=d.b;d=Math.sqrt(e*e+h*h);e=Math.atan2(h,e);e=0<e?e:e+2*Math.PI;f={l:f,c:d,h:e}}}return f};a.toRGB=n;a.toXYZ=function(f){return"x"in f&&"y"in f&&"z"in f?f:c(n(f))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/symbols/support/svgUtils":function(){define("exports ../../Color ../../core/has ../../chunks/mat2df32 ../../chunks/mat2d ../../widgets/support/widgetUtils ../../widgets/support/jsxFactory".split(" "),
function(a,b,c,m,l,r,n){function g(H,I){H*=L/180;return Math.abs(I*Math.sin(H))+Math.abs(I*Math.cos(H))}function k(H){return H.map(I=>`${I.command} ${I.values.join(" ")}`).join(" ").trim()}function f(H,I,O,Q){if(H){if("circle"===H.type)return n.tsx("circle",{fill:I,"fill-rule":"evenodd",stroke:O.color,"stroke-width":O.width,"stroke-linecap":O.cap,"stroke-linejoin":O.join,"stroke-dasharray":O.dashArray,"stroke-dashoffset":O.dashOffset,"stroke-miterlimit":"4",cx:H.cx,cy:H.cy,r:H.r});if("ellipse"===
H.type)return n.tsx("ellipse",{fill:I,"fill-rule":"evenodd",stroke:O.color,"stroke-width":O.width,"stroke-linecap":O.cap,"stroke-linejoin":O.join,"stroke-dasharray":O.dashArray,"stroke-miterlimit":"4",cx:H.cx,cy:H.cy,rx:H.rx,ry:H.ry});if("rect"===H.type)return n.tsx("rect",{fill:I,"fill-rule":"evenodd",stroke:O.color,"stroke-width":O.width,"stroke-linecap":O.cap,"stroke-linejoin":O.join,"stroke-dasharray":O.dashArray,"stroke-miterlimit":"4",x:H.x,y:H.y,width:H.width,height:H.height});if("image"===
H.type)return n.tsx("image",{href:H.src,x:H.x,y:H.y,width:H.width,height:H.height,preserveAspectRatio:"none"});if("path"===H.type)return H="string"!==typeof H.path?k(H.path):H.path,n.tsx("path",{fill:I,"fill-rule":"evenodd",stroke:O.color,"stroke-width":O.width,"stroke-linecap":O.cap,"stroke-linejoin":O.join,"stroke-dasharray":O.dashArray,"stroke-miterlimit":"4",d:H});if("text"===H.type)return n.tsx("text",{"alignment-baseline":Q.alignBaseline,fill:I,"fill-rule":"evenodd",stroke:O.color,"stroke-width":O.width,
"stroke-linecap":O.cap,"stroke-linejoin":O.join,"stroke-dasharray":O.dashArray,"stroke-miterlimit":"4","text-anchor":Q.align,"text-decoration":Q.decoration,kerning:Q.kerning,rotate:Q.rotate,"text-rendering":F,"font-style":Q.font.style,"font-variant":Q.font.variant,"font-weight":Q.font.weight,"font-size":Q.font.size,"font-family":Q.font.family,x:H.x,y:H.y},H.text)}return null}function d(H){const I={fill:"none",pattern:null,linearGradient:null};if(H)if("type"in H&&"pattern"===H.type){var O=`patternId-${++D}`;
I.fill=`url(#${O})`;I.pattern={id:O,x:H.x,y:H.y,width:H.width,height:H.height,image:{x:0,y:0,width:H.width,height:H.height,href:H.src}}}else"type"in H&&"linear"===H.type?(O=`linearGradientId-${++E}`,I.fill=`url(#${O})`,I.linearGradient={id:O,x1:H.x1,y1:H.y1,x2:H.x2,y2:H.y2,stops:H.colors.map(Q=>({offset:Q.offset,color:Q.color&&(new b(Q.color)).toString()}))}):H&&(H=new b(H),I.fill=H.toString());return I}function e(H){const I={color:"none",width:1,cap:"butt",join:"4",dashArray:"none",dashOffset:"0"};
if(H&&(null!=H.width&&(I.width=H.width),H.cap&&(I.cap=H.cap),H.join&&(I.join=H.join.toString()),H.color&&(I.color=(new b(H.color)).toString()),H.dashArray&&(I.dashArray=H.dashArray),H.dashArray&&(I.dashOffset=H.dashoffset),H.style)){let Q=null;H.style in M&&(Q=M[H.style]);if(Array.isArray(Q)){Q=Q.slice(0);for(var O=0;O<Q.length;++O)Q[O]*=H.width;if("butt"!==H.cap){for(O=0;O<Q.length;O+=2)Q[O]-=H.width,1>Q[O]&&(Q[O]=1);for(O=1;O<Q.length;O+=2)Q[O]+=H.width}Q=Q.join(",")}I.dashArray=Q}return I}function h(H,
I){const O={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};H&&(O.align=H.align,O.alignBaseline=H.alignBaseline,O.decoration=H.decoration,O.kerning=H.kerning?"auto":"0",O.rotate=H.rotated?"90":"0",O.font.style=I.style||"normal",O.font.variant=I.variant||"normal",O.font.weight=I.weight||"normal",O.font.size=I.size&&I.size.toString()||"10pt",O.font.family=I.family||"serif");return O}function v(H){const {pattern:I,linearGradient:O}=
H;return I?n.tsx("pattern",{id:I.id,patternUnits:"userSpaceOnUse",x:I.x,y:I.y,width:I.width,height:I.height},n.tsx("image",{x:I.image.x,y:I.image.y,width:I.image.width,height:I.image.height,href:I.image.href})):O?(H=O.stops.map((Q,S)=>n.tsx("stop",{key:`${S}-stop`,offset:Q.offset,"stop-color":Q.color})),n.tsx("linearGradient",{id:O.id,gradientUnits:"userSpaceOnUse",x1:O.x1,y1:O.y1,x2:O.x2,y2:O.y2},H)):null}function w(H,I){if(!H)return null;const O=[];for(const Q of H){const {shape:S,fill:T,stroke:U,
font:aa}=Q;H=d(T);const W=e(U),R="text"===S.type?h(S,aa):null;O.push(f(S,H.fill,W,R))}return n.tsx("mask",{id:I,maskUnits:"userSpaceOnUse"},n.tsx("g",null,O))}function t(H,I,O){return l.translate(H,l.identity(H),[I,O])}function x(H,I,O,Q,S){l.scale(H,l.identity(H),[I,O]);H[4]=H[4]*I-Q*I+Q;H[5]=H[5]*O-S*O+S;return H}function B(H,I,O,Q){var S=I%360*Math.PI/180;l.rotate(H,l.identity(H),S);I=Math.cos(S);S=Math.sin(S);const T=H[4],U=H[5];H[4]=T*I-U*S+Q*S-O*I+O;H[5]=U*I+T*S-O*S-Q*I+Q;return H}function q(H,
I){K&&"left"in K?(K.left>H&&(K.left=H),K.right<H&&(K.right=H),K.top>I&&(K.top=I),K.bottom<I&&(K.bottom=I)):K={left:H,bottom:I,right:H,top:I}}function u(H){const I=H.args,O=I.length;switch(H.action){case "M":case "L":case "C":case "S":case "Q":case "T":for(H=0;H<O;H+=2)q(I[H],I[H+1]);N.x=I[O-2];N.y=I[O-1];break;case "H":for(H=0;H<O;++H)q(I[H],N.y);N.x=I[O-1];break;case "V":for(H=0;H<O;++H)q(N.x,I[H]);N.y=I[O-1];break;case "m":H=0;"x"in N||(q(N.x=I[0],N.y=I[1]),H=2);for(;H<O;H+=2)q(N.x+=I[H],N.y+=I[H+
1]);break;case "l":case "t":for(H=0;H<O;H+=2)q(N.x+=I[H],N.y+=I[H+1]);break;case "h":for(H=0;H<O;++H)q(N.x+=I[H],N.y);break;case "v":for(H=0;H<O;++H)q(N.x,N.y+=I[H]);break;case "c":for(H=0;H<O;H+=6)q(N.x+I[H],N.y+I[H+1]),q(N.x+I[H+2],N.y+I[H+3]),q(N.x+=I[H+4],N.y+=I[H+5]);break;case "s":case "q":for(H=0;H<O;H+=4)q(N.x+I[H],N.y+I[H+1]),q(N.x+=I[H+2],N.y+=I[H+3]);break;case "A":for(H=0;H<O;H+=7)q(I[H+5],I[H+6]);N.x=I[O-2];N.y=I[O-1];break;case "a":for(H=0;H<O;H+=7)q(N.x+=I[H+5],N.y+=I[H+6])}}function C(H,
I,O){const Q=G[H.toLowerCase()];"number"===typeof Q&&(Q?I.length>=Q&&(H={action:H,args:I.slice(0,I.length-I.length%Q)},O.push(H),u(H)):(H={action:H,args:[]},O.push(H),u(H)))}function z(H){const I={x:0,y:0,width:0,height:0};if("circle"===H.type)I.x=H.cx-H.r,I.y=H.cy-H.r,I.width=2*H.r,I.height=2*H.r;else if("ellipse"===H.type)I.x=H.cx-H.rx,I.y=H.cy-H.ry,I.width=2*H.rx,I.height=2*H.ry;else if("image"===H.type||"rect"===H.type)I.x=H.x,I.y=H.y,I.width=H.width,I.height=H.height;else if("path"===H.type){{const S=
("string"!==typeof H.path?k(H.path):H.path).match(P),T=[];K={};N={};if(S){H="";var O=[],Q=S.length;for(let U=0;U<Q;++U){const aa=S[U],W=parseFloat(aa);isNaN(W)?(H&&C(H,O,T),O=[],H=aa):O.push(W)}C(H,O,T);H={x:0,y:0,width:0,height:0};K&&"left"in K&&(H.x=K.left,H.y=K.top,H.width=K.right-K.left,H.height=K.bottom-K.top)}else H=null}I.x=H.x;I.y=H.y;I.width=H.width;I.height=H.height}return I}function A(H){const I={x:0,y:0,width:0,height:0};let O=null,Q=Number.NEGATIVE_INFINITY,S=Number.NEGATIVE_INFINITY;
for(const T of H)O?(O.x=Math.min(O.x,T.x),O.y=Math.min(O.y,T.y),Q=Math.max(Q,T.x+T.width),S=Math.max(S,T.y+T.height)):(O=I,O.x=T.x,O.y=T.y,Q=T.x+T.width,S=T.y+T.height);O&&(O.width=Q-O.x,O.height=S-O.y);return O}function p(H,I,O,Q,S,T,U,aa,W){var R=(U&&T?g(T,I):I)/2,V=(U&&T?g(T,O):O)/2;W&&(R=W[0],V=W[1],R=(U&&T?g(T,R):R)/2,V=(U&&T?g(T,V):V)/2);const da=H.width+Q,ca=H.height+Q;U=m.create();W=m.create();var ha=!1;if(S&&0!==da&&0!==ca){S=I!==O?I/O:da/ca;ha=I>O?I:O;let ia=1,ka=1;isNaN(ha)||(1<S?(ia=ha/
da,ka=ha/S/ca):(ka=ha/ca,ia=ha*S/da));l.multiply(W,W,x(U,ia,ka,R,V));ha=!0}S=H.x+(da-Q)/2;H=H.y+(ca-Q)/2;l.multiply(W,W,t(U,R-S,V-H));!ha&&(da>I||ca>O)&&(Q=da/I>ca/O,I=(Q?I:O)/(Q?da:ca),l.multiply(W,W,x(U,I,I,S,H)));T&&l.multiply(W,W,B(U,T,S,H));aa&&l.multiply(W,W,t(U,aa[0],aa[1]));return`matrix(${W[0]},${W[1]},${W[2]},${W[3]},${W[4]},${W[5]})`}function y(H,I,O){H=null==H?void 0:H.effects.find(aa=>"bloom"===aa.type);if(!H)return null;const {strength:Q,radius:S}=H;H=0<Q?S:0;const T=(Q+H)*I,U=4*Q+1;
return n.tsx("filter",{id:`bloom${O}`,x:"-100%",y:"-100%",width:"300%",height:"300%",filterUnits:"userSpaceOnUse"},n.tsx("feMorphology",{operator:"dilate",radius:(Q+.5*H)*5**(I/100)*(.4+I/100),in:"SourceGraphic",result:"dilate"}),n.tsx("feGaussianBlur",{in:"dilate",stdDeviation:T/25,result:"blur"}),n.tsx("feGaussianBlur",{in:"blur",stdDeviation:T/50,result:"intensityBlur"}),n.tsx("feComponentTransfer",{in:"SourceGraphic",result:"intensityBrightness"},n.tsx("feFuncR",{type:"linear",slope:U}),n.tsx("feFuncG",
{type:"linear",slope:U}),n.tsx("feFuncB",{type:"linear",slope:U})),n.tsx("feMerge",null,n.tsx("feMergeNode",{in:"intensityBlur"}),n.tsx("feMergeNode",{in:"intensityBrightness"}),n.tsx("feGaussianBlur",{stdDeviation:Q/10})))}let D=0,E=0;r=c("android");const F=c("chrome")||r&&4<=r?"auto":"optimizeLegibility",G={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},P=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g;let K={},N={};const M={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,
1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]},L=Math.PI;let J=1;a.computeBBox=A;a.generateFillAttributes=d;a.generateStrokeAttributes=e;a.generateTextAttributes=h;a.getBoundingBox=z;a.getTransformMatrix=p;a.renderDef=v;a.renderSVG=function(H,I,O,Q={}){const S=[],T=[],U=++J,aa=y(Q.effectView,I,U);var W=null;if(aa){var R;W=null==(R=Q.effectView)?void 0:R.effects.find(ha=>"bloom"===ha.type);W=(W.strength?W.strength+W.radius/2:0)/
3;W=[Math.max(I+I*W,10),Math.max(O+O*W,10)]}for(R=0;R<H.length;R++){var V=H[R];const ha=[];var da=[],ca=0;let ia=0,ka=0;for(const la of V){const {shape:Y,fill:ea,stroke:ba,font:Z,offset:fa}=la;Q.ignoreStrokeWidth||(ca+=ba&&ba.width||0);V=d(ea);const ja=e(ba),oa="text"===Y.type?h(Y,Z):null;S.push(v(V));ha.push(f(Y,V.fill,ja,oa));da.push(z(Y));fa&&(ia+=fa[0],ka+=fa[1])}da=p(A(da),I,O,ca,Q.scale,Q.rotation,Q.useRotationSize,[ia,ka],W);ca=null;Q.masking&&(ca=`mask-${R}`,S.push(w(Q.masking[R],ca)),ca=
`url(#${ca})`);T.push(ca?n.tsx("g",{mask:ca},n.tsx("g",{transform:da},ha)):n.tsx("g",{transform:da},ha))}Q.useRotationSize&&Q.rotation&&(I=g(Q.rotation,I),O=g(Q.rotation,O));aa&&(I=W[0],O=W[1]);return n.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:I,height:O,style:"display: block;"},aa,n.tsx("defs",null,S),aa?n.tsx("g",{filter:`url(#bloom${U})`},T):T)};a.renderShape=f;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/mat2df32":function(){define(["exports"],
function(a){function b(){const k=new Float32Array(6);k[0]=1;k[3]=1;return k}function c(k){const f=new Float32Array(6);f[0]=k[0];f[1]=k[1];f[2]=k[2];f[3]=k[3];f[4]=k[4];f[5]=k[5];return f}function m(k,f,d,e,h,v){const w=new Float32Array(6);w[0]=k;w[1]=f;w[2]=d;w[3]=e;w[4]=h;w[5]=v;return w}function l(k,f){return new Float32Array(k,f,6)}function r(k,f,d,e){const h=f[e];f=f[e+1];k[e]=d[0]*h+d[2]*f+d[4];k[e+1]=d[1]*h+d[3]*f+d[5]}function n(k,f,d,e=0,h=0,v=2){for(h=h||f.length/v;e<h;e++)r(k,f,d,e*v)}const g=
Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:m,createView:l,transform:r,transformMany:n},Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;a.createView=l;a.fromValues=m;a.mat2df32=g;a.transform=r;a.transformMany=n})},"esri/chunks/mat2d":function(){define(["exports","./common"],function(a,b){function c(p,y){p[0]=y[0];p[1]=y[1];p[2]=y[2];p[3]=y[3];p[4]=y[4];p[5]=y[5];return p}function m(p){p[0]=1;p[1]=0;p[2]=0;p[3]=1;p[4]=0;p[5]=0;return p}function l(p,y,
D,E,F,G,P){p[0]=y;p[1]=D;p[2]=E;p[3]=F;p[4]=G;p[5]=P;return p}function r(p,y){const D=y[0],E=y[1],F=y[2],G=y[3],P=y[4];y=y[5];let K=D*G-E*F;if(!K)return null;K=1/K;p[0]=G*K;p[1]=-E*K;p[2]=-F*K;p[3]=D*K;p[4]=(F*y-G*P)*K;p[5]=(E*P-D*y)*K;return p}function n(p){return p[0]*p[3]-p[1]*p[2]}function g(p,y,D){const E=y[0],F=y[1],G=y[2],P=y[3],K=y[4];y=y[5];const N=D[0],M=D[1],L=D[2],J=D[3],H=D[4];D=D[5];p[0]=E*N+G*M;p[1]=F*N+P*M;p[2]=E*L+G*J;p[3]=F*L+P*J;p[4]=E*H+G*D+K;p[5]=F*H+P*D+y;return p}function k(p,
y,D){const E=y[0],F=y[1],G=y[2],P=y[3],K=y[4];y=y[5];const N=Math.sin(D);D=Math.cos(D);p[0]=E*D+G*N;p[1]=F*D+P*N;p[2]=E*-N+G*D;p[3]=F*-N+P*D;p[4]=K;p[5]=y;return p}function f(p,y,D){const E=y[1],F=y[2],G=y[3],P=y[4],K=y[5],N=D[0];D=D[1];p[0]=y[0]*N;p[1]=E*N;p[2]=F*D;p[3]=G*D;p[4]=P;p[5]=K;return p}function d(p,y,D){const E=y[0],F=y[1],G=y[2],P=y[3],K=y[4];y=y[5];const N=D[0];D=D[1];p[0]=E;p[1]=F;p[2]=G;p[3]=P;p[4]=E*N+G*D+K;p[5]=F*N+P*D+y;return p}function e(p,y){const D=Math.sin(y);y=Math.cos(y);
p[0]=y;p[1]=D;p[2]=-D;p[3]=y;p[4]=0;p[5]=0;return p}function h(p,y){p[0]=y[0];p[1]=0;p[2]=0;p[3]=y[1];p[4]=0;p[5]=0;return p}function v(p,y){p[0]=1;p[1]=0;p[2]=0;p[3]=1;p[4]=y[0];p[5]=y[1];return p}function w(p){return"mat2d("+p[0]+", "+p[1]+", "+p[2]+", "+p[3]+", "+p[4]+", "+p[5]+")"}function t(p){return Math.sqrt(p[0]**2+p[1]**2+p[2]**2+p[3]**2+p[4]**2+p[5]**2+1)}function x(p,y,D){p[0]=y[0]+D[0];p[1]=y[1]+D[1];p[2]=y[2]+D[2];p[3]=y[3]+D[3];p[4]=y[4]+D[4];p[5]=y[5]+D[5];return p}function B(p,y,D){p[0]=
y[0]-D[0];p[1]=y[1]-D[1];p[2]=y[2]-D[2];p[3]=y[3]-D[3];p[4]=y[4]-D[4];p[5]=y[5]-D[5];return p}function q(p,y,D){p[0]=y[0]*D;p[1]=y[1]*D;p[2]=y[2]*D;p[3]=y[3]*D;p[4]=y[4]*D;p[5]=y[5]*D;return p}function u(p,y,D,E){p[0]=y[0]+D[0]*E;p[1]=y[1]+D[1]*E;p[2]=y[2]+D[2]*E;p[3]=y[3]+D[3]*E;p[4]=y[4]+D[4]*E;p[5]=y[5]+D[5]*E;return p}function C(p,y){return p[0]===y[0]&&p[1]===y[1]&&p[2]===y[2]&&p[3]===y[3]&&p[4]===y[4]&&p[5]===y[5]}function z(p,y){const D=p[0],E=p[1],F=p[2],G=p[3],P=p[4];p=p[5];const K=y[0],
N=y[1],M=y[2],L=y[3],J=y[4];y=y[5];return Math.abs(D-K)<=b.EPSILON*Math.max(1,Math.abs(D),Math.abs(K))&&Math.abs(E-N)<=b.EPSILON*Math.max(1,Math.abs(E),Math.abs(N))&&Math.abs(F-M)<=b.EPSILON*Math.max(1,Math.abs(F),Math.abs(M))&&Math.abs(G-L)<=b.EPSILON*Math.max(1,Math.abs(G),Math.abs(L))&&Math.abs(P-J)<=b.EPSILON*Math.max(1,Math.abs(P),Math.abs(J))&&Math.abs(p-y)<=b.EPSILON*Math.max(1,Math.abs(p),Math.abs(y))}const A=Object.freeze(Object.defineProperty({__proto__:null,copy:c,identity:m,set:l,invert:r,
determinant:n,multiply:g,rotate:k,scale:f,translate:d,fromRotation:e,fromScaling:h,fromTranslation:v,str:w,frob:t,add:x,subtract:B,multiplyScalar:q,multiplyScalarAndAdd:u,exactEquals:C,equals:z,mul:g,sub:B},Symbol.toStringTag,{value:"Module"}));a.add=x;a.copy=c;a.determinant=n;a.equals=z;a.exactEquals=C;a.frob=t;a.fromRotation=e;a.fromScaling=h;a.fromTranslation=v;a.identity=m;a.invert=r;a.mat2d=A;a.mul=g;a.multiply=g;a.multiplyScalar=q;a.multiplyScalarAndAdd=u;a.rotate=k;a.scale=f;a.set=l;a.str=
w;a.sub=B;a.subtract=B;a.translate=d})},"esri/views/support/layerViewUtils":function(){define(["exports","../../core/maybe"],function(a,b){a.extractSafeScaleBounds=function(c){var m,l;const r=c.effectiveScaleRange;c=null!=(m=null==r?void 0:r.minScale)?m:0;m=null!=(l=null==r?void 0:r.maxScale)?l:0;return{minScale:c,maxScale:m}};a.highlightsSupported=function(c){return c&&"function"===typeof c.highlight};a.isScaleRangeActive=function(c,m){return 0<c||0<m};a.occludeesSupported=function(c){return c&&
"function"===typeof c.maskOccludee};a.scaleBoundsPredicate=function(c,m,l){return b.isNone(c)||c>l&&(0===m||c<m)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Popup/actions":function(){define(["exports","../../support/actions/ActionButton"],function(a,b){const c=new b({id:"zoom-to-feature",title:"{messages.zoom}",className:"esri-icon-zoom-in-magnifying-glass"}),m=new b({id:"remove-selected-feature",title:"{messages.remove}",className:"esri-icon-trash"}),
l=new b({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:"esri-icon-zoom-in-magnifying-glass"});b=new b({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:"esri-icon-table"});a.all=[c,m,b,l];a.browseClusteredFeatures=b;a.removeSelectedFeature=m;a.zoomToClusteredFeatures=l;a.zoomToFeature=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Popup/actionUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Error ../../core/Logger ../../core/promiseUtils ./actions".split(" "),
function(a,b,c,m,l,r){function n(x){const {selectedFeature:B,location:q,view:u}=x;return u?"3d"===u.type?B||q:x.get("selectedFeature.geometry")||q:null}function g(x){var B,q;return(null==x?void 0:x.isAggregate)&&"cluster"===(null==x?void 0:null==(B=x.sourceLayer)?void 0:null==(q=B.featureReduction)?void 0:q.type)}function k(x,B){if("3d"!==(null==B?void 0:B.type)||!x||"esri.Graphic"!==x.declaredClass)return!0;if((B=B.getViewForGraphic(x))&&"whenGraphicBounds"in B){let q=!1;B.whenGraphicBounds(x,{useViewElevation:!0}).then(u=>
{q=!u||!u.boundingBox||u.boundingBox[0]===u.boundingBox[3]&&u.boundingBox[1]===u.boundingBox[4]&&u.boundingBox[2]===u.boundingBox[5]}).catch(()=>{const u=new c("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:x});t.error(u)});return q}return!0}function f(x){return d.apply(this,arguments)}function d(){d=b._asyncToGenerator(function*(x){const {location:B,selectedFeature:q,view:u,zoomFactor:C}=x,z=n(x);if(!z)throw x=new c("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",
{target:z,view:u}),t.error(x),x;const A=u.scale/C,p=x.get("selectedFeature.geometry")||B,y=p&&"point"===p.type&&k(q,u);r.zoomToFeature.active=!0;r.zoomToFeature.disabled=!0;try{yield x.view.goTo({target:z,scale:y?A:void 0})}finally{r.zoomToFeature.active=!1,r.zoomToFeature.disabled=!1,x.zoomToLocation=null,y&&(x.location=p)}});return d.apply(this,arguments)}function e(x){return h.apply(this,arguments)}function h(){h=b._asyncToGenerator(function*(x){const {selectedFeature:B,view:q}=x;if("2d"!==(null==
q?void 0:q.type))throw x=new c("zoomToCluster:invalid-view","View must be 2d MapView.",{view:q}),t.error(x),x;if(!g(B))throw x=new c("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:B}),t.error(x),x;x=yield q.whenLayerView(B.sourceLayer);const u=x.createQuery();u.aggregateIds=[B.getObjectId()];r.zoomToClusteredFeatures.active=!0;r.zoomToClusteredFeatures.disabled=!0;({extent:x}=yield x.queryExtent(u));yield q.goTo({target:x});
r.zoomToClusteredFeatures.active=!1;r.zoomToClusteredFeatures.disabled=!1});return h.apply(this,arguments)}function v(){v=b._asyncToGenerator(function*(x){const {selectedFeature:B,view:q}=x;var u=yield q.whenLayerView(B.sourceLayer);const C=u.createQuery();C.aggregateIds=[B.getObjectId()];({extent:u}=yield u.queryExtent(C));x.selectedClusterBoundaryFeature.geometry=u;q.graphics.add(x.selectedClusterBoundaryFeature)});return v.apply(this,arguments)}function w(){w=b._asyncToGenerator(function*(x){const {selectedFeature:B,
view:q}=x;x=yield q.whenLayerView(B.sourceLayer);const u=x.createQuery();u.aggregateIds=[B.getObjectId()];r.browseClusteredFeatures.active=!0;r.browseClusteredFeatures.disabled=!0;({features:x}=yield x.queryFeatures(u));r.browseClusteredFeatures.active=!1;r.browseClusteredFeatures.disabled=!1;q.popup.open({features:[B].concat(x),featureMenuOpen:!0})});return w.apply(this,arguments)}const t=m.getLogger("esri.widgets.Popup.PopupViewModel");a.browseAggregateFeatures=function(x){return w.apply(this,arguments)};
a.displayClusterExtent=function(x){return v.apply(this,arguments)};a.getSelectedTarget=n;a.isClusterFeature=g;a.isZoomScreenSize=k;a.removeClusteredFeaturesForBrowsing=function(x){const B=x.features.filter(q=>g(q));B.length&&(x.features=B)};a.triggerAction=x=>{const {event:B,view:q}=x;({action:x}=B);var u=q&&q.popup;if(!x)return Promise.reject(new c("trigger-action:missing-arguments","Event has no action"));if(!u)return Promise.reject(new c("trigger-action:missing-arguments","view.popup is missing"));
const {disabled:C,id:z}=x;if(!z)return Promise.reject(new c("trigger-action:invalid-action","action.id is missing"));if(C)return Promise.reject(new c("trigger-action:invalid-action","Action is disabled"));if(z===r.zoomToFeature.id)return f(u.viewModel).catch(l.throwIfNotAbortError);if(z===r.zoomToClusteredFeatures.id)return e(u.viewModel);if(z===r.browseClusteredFeatures.id)return u.featureMenuOpen=!u.featureMenuOpen,u.viewModel.browseClusterEnabled=!u.viewModel.browseClusterEnabled,Promise.resolve();
u.viewModel.browseClusterEnabled=!1;if(z===r.removeSelectedFeature.id){u.close();({selectedFeature:x}=u);if(!x)return Promise.reject(new c(`trigger-action:${r.removeSelectedFeature.id}`,"selectedFeature is required",{selectedFeature:x}));({sourceLayer:u}=x);u?u.remove(x):q.graphics.remove(x)}return Promise.resolve()};a.zoomToClusterExtent=e;a.zoomToLocation=f;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/support/GoTo":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,m,l,r,n,g){a.GoToMixin=k=>{k=function(f){function d(...e){e=f.call(this,...e)||this;e.goToOverride=null;e.view=null;return e}b._inheritsLoose(d,f);d.prototype.callGoTo=function(e){const {view:h}=this;return this.goToOverride?this.goToOverride(h,e):h.goTo(e.target,e.options)};return d}(k);c.__decorate([m.property()],k.prototype,"goToOverride",void 0);c.__decorate([m.property()],k.prototype,"view",void 0);return k=c.__decorate([g.subclass("esri.widgets.support.GoTo")],k)};Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/GroundView":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Accessor ../core/Collection ../core/Handles ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./support/GroundViewElevationSampler".split(" "),function(a,b,c,m,l,r,n,g,k,f,d,e){c=function(h){function v(t){t=
h.call(this,t)||this;t.handles=new l;t.view=null;t.layerViews=new m;return t}a._inheritsLoose(v,h);var w=v.prototype;w.initialize=function(){this.handles.add(r.when(()=>{var t,x;return null==(t=this.view)?void 0:null==(x=t.map)?void 0:x.ground},t=>t.load()));this.handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))};w.destroy=function(){this._set("view",null);this.handles&&(this.handles.destroy(),this.handles=null)};w._layerViewsAfterChangesHandler=function(){this.handles.remove("updating");
this.handles.add(this.layerViews.map(t=>r.watch(()=>t.updating,()=>this._updateUpdating(),r.sync)).toArray(),"updating");this._updateUpdating()};w._updateUpdating=function(){this.notifyChange("updating")};a._createClass(v,[{key:"elevationSampler",get:function(){return this.view&&"2d"!==this.view.type&&this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new e({view:this.view}):null}},{key:"updating",get:function(){return this.suspended?!1:this.layerViews.some(t=>t.updating)}},
{key:"suspended",get:function(){return!this.view||this.view.suspended}}]);return v}(c);b.__decorate([n.property({readOnly:!0})],c.prototype,"elevationSampler",null);b.__decorate([n.property({type:Boolean,readOnly:!0})],c.prototype,"updating",null);b.__decorate([n.property({constructOnly:!0})],c.prototype,"view",void 0);b.__decorate([n.property({type:m,readOnly:!0})],c.prototype,"layerViews",void 0);b.__decorate([n.property({readOnly:!0})],c.prototype,"suspended",null);return c=b.__decorate([d.subclass("esri.views.GroundView")],
c)})},"esri/views/support/GroundViewElevationSampler":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Evented ../../core/Logger ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../layers/support/ElevationSampler ../3d/terrain/TerrainConst".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){const w=m.getLogger("esri.views.support.GroundViewElevationSampler");c=function(t){function x(q){q=t.call(this,q)||this;q.demResolution={min:-1,max:-1};q.noDataValue=v.ELEVATION_NODATA_VALUE;return q}a._inheritsLoose(x,t);var B=x.prototype;B.initialize=function(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))};B.elevationAt=function(q,u){if(l.isNone(this.extent)||!e.extentContainsXYZ(this.extent,q,u)){const C=l.isSome(this.extent)?
`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;w.warn("#elevationAt()",`Point used to sample elevation (${q}, ${u}) is outside of the sampler extent (${C})`);return this.noDataValue}return l.unwrapOr(this.view.elevationProvider.getElevation(q,u,0,this.spatialReference,"ground"),this.noDataValue)};B.queryElevation=function(q){return h.updateGeometryElevation(q.clone(),this)};a._createClass(x,[{key:"extent",get:function(){const q=this.view.basemapTerrain;if(l.isNone(q.extent)||
!q.spatialReference)return null;const u=d.toExtent(q.extent,q.spatialReference);u.zmin=q.elevationBounds.min;u.zmax=q.elevationBounds.max;return u}}]);return x}(c.EventedAccessor);b.__decorate([r.property({readOnly:!0})],c.prototype,"demResolution",void 0);b.__decorate([r.property({readOnly:!0})],c.prototype,"extent",null);b.__decorate([r.property({readOnly:!0})],c.prototype,"noDataValue",void 0);b.__decorate([r.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],c.prototype,"spatialReference",
void 0);b.__decorate([r.property({constructOnly:!0})],c.prototype,"view",void 0);return c=b.__decorate([f.subclass("esri.views.support.GroundViewElevationSampler")],c)})},"esri/layers/support/ElevationSampler":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../geometry ../../core/has ../../core/Logger ../../core/maybe ../../core/unitUtils ../../geometry/support/aaBoundingRect ../../geometry/support/webMercatorUtils ../../geometry/Point".split(" "),function(a,b,c,m,l,r,n,g,k,f){function d(x,
B){const q=e(x,B.spatialReference);if(!q)return null;switch(x.type){case "point":x.z=B.elevationAt(q.x,q.y);break;case "polyline":w.spatialReference=q.spatialReference;var u=x.hasM&&!x.hasZ;for(var C=0;C<x.paths.length;C++){var z=x.paths[C],A=q.paths[C];for(let p=0;p<z.length;p++){const y=z[p],D=A[p];w.x=D[0];w.y=D[1];u&&(y[3]=y[2]);y[2]=B.elevationAt(w.x,w.y)}}x.hasZ=!0;break;case "multipoint":w.spatialReference=q.spatialReference;u=x.hasM&&!x.hasZ;for(C=0;C<x.points.length;C++)z=x.points[C],A=q.points[C],
w.x=A[0],w.y=A[1],u&&(z[3]=z[2]),z[2]=B.elevationAt(w.x,w.y);x.hasZ=!0}return x}function e(x,B){if(r.isNone(x))return null;const q=x.spatialReference;if(q.equals(B))return x;(x=k.project(x,B))||h.error(`Cannot project geometry spatial reference (wkid:${q.wkid}) to elevation sampler spatial reference (wkid:${B.wkid})`);return x}const h=l.getLogger("esri.layers.support.ElevationSampler");c=function(){function x(){}var B=x.prototype;B.queryElevation=function(q){return d(q.clone(),this)};B.on=function(){return t};
B.projectIfRequired=function(q,u){return e(q,u)};return x}();let v=function(x){function B(u,C,z){var A=x.call(this)||this;A.tile=u;A.noDataValue=z;A.extent=g.toExtent(u.tile.extent,C.spatialReference);A.extent.zmin=u.zmin;A.extent.zmax=u.zmax;A.aaExtent=u.tile.extent;z=n.getMetersPerUnitForSR(C.spatialReference);u=C.lodAt(u.tile.level).resolution*z;A.demResolution={min:u,max:u};return A}b._inheritsLoose(B,x);var q=B.prototype;q.contains=function(u){u=this.projectIfRequired(u,this.spatialReference);
return r.isNone(u)?!1:this.containsAt(u.x,u.y)};q.containsAt=function(u,C){return g.containsXY(this.aaExtent,u,C)};q.elevationAt=function(u,C){if(!this.containsAt(u,C)){const z=this.extent;h.warn("#elevationAt()",`Point used to sample elevation (${u}, ${C}) is outside of the sampler extent (${`${z.xmin}, ${z.ymin}, ${z.xmax}, ${z.ymax}`})`);return this.noDataValue}return r.unwrapOr(this.tile.sample(u,C),this.noDataValue)};b._createClass(B,[{key:"spatialReference",get:function(){return this.extent.spatialReference}}]);
return B}(c);m=function(x){function B(q,u,C){var z=x.call(this)||this;let A;"number"===typeof u?(z.noDataValue=u,A=null):(A=u,z.noDataValue=C);z.samplers=A?q.map(p=>new v(p,A,z.noDataValue)):q;if(q=z.samplers[0]){z.extent=q.extent.clone();const {min:p,max:y}=q.demResolution;z.demResolution={min:p,max:y};for(q=1;q<z.samplers.length;q++)u=z.samplers[q],z.extent.union(u.extent),z.demResolution.min=Math.min(z.demResolution.min,u.demResolution.min),z.demResolution.max=Math.max(z.demResolution.max,u.demResolution.max)}else z.extent=
g.toExtent(g.create(),A.spatialReference),z.demResolution={min:0,max:0};return z}b._inheritsLoose(B,x);B.prototype.elevationAt=function(q,u){for(const C of this.samplers)if(C.containsAt(q,u))return C.elevationAt(q,u);h.warn("#elevationAt()",`Point used to sample elevation (${q}, ${u}) is outside of the sampler`);return this.noDataValue};b._createClass(B,[{key:"spatialReference",get:function(){return this.extent.spatialReference}}]);return B}(c);const w=new f,t={remove(){}};a.ElevationSamplerBase=
c;a.MultiTileElevationSampler=m;a.TileElevationSampler=v;a.updateGeometryElevation=d;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TerrainConst":function(){define(["exports","../../../core/mathUtils","../../../geometry/support/aaBoundingRect","./TilingScheme"],function(a,b,c,m){b=b.clampFloat32(b.NUMBER_MAX_FLOAT32/10);const l=c.create();m.TilingScheme.WebMercatorAuxiliarySphere.getExtent(0,0,0,l);c=c.create([-180,-90,180,90]);a.DEFAULT_TILE_BACKGROUND=
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC";
a.ELEVATION_DESIRED_MAX_UPSCALING_DISTANCE=4;a.ELEVATION_NODATA_VALUE=b;a.GEOGRAPHIC_WORLD_EXTENT=c;a.GEOMETRY_VERTEX_STRIDE=8;a.MAX_MEMORY_LOD_BIAS=2.5;a.MAX_PATCH_TESSELATION=512;a.MAX_ROOT_TILES=64;a.PROGRESSIVE_LOADING_MODULO=4;a.TILE_LOADING_DEBUGLOG=!1;a.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR="Cannot extend surface to encompass all layers because it would result in too many root tiles.";a.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR="Surface extent is too large for tile resolution at level 0.";a.WEBMERCATOR_WORLD_EXTENT=
l;a.getElevationDesiredResolutionLevel=r=>4>r?3:4;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TilingScheme":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../geometry/Extent ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils ../../../layers/support/TileInfo".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h){function v(){return new c("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}let w=function(){function x(q){var u=x.checkUnsupported(q);if(l.isSome(u))throw u;q=l.unwrap(q);this.spatialReference=q.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;this._isGCS=g.canProjectToWGS84ComparableLonLat(this.spatialReference)||d.isMars(this.spatialReference)||d.isMoon(this.spatialReference);this.origin=[q.origin.x,q.origin.y];
this.pixelSize=q.size[0];this.dpi=q.dpi;var C=q.lods.reduce((p,y,D)=>{y.level<p.min&&(p.min=y.level,p.minIndex=D);p.max=Math.max(p.max,y.level);return p},{min:Infinity,minIndex:0,max:-Infinity}),z=q.lods[C.minIndex];const A=2**z.level;u=z.resolution*A;z=z.scale*A;this.levels=Array(C.max+1);for(C=0;C<this.levels.length;C++)this.levels[C]={resolution:u,scale:z,tileSize:[u*q.size[0],u*q.size[1]]},u/=2,z/=2}var B=x.prototype;B.clone=function(){return new x(this.toTileInfo())};B.toTileInfo=function(){return new h({dpi:this.dpi,
origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((q,u)=>({level:u,scale:q.scale,resolution:q.resolution}))})};B.getExtent=function(q,u,C,z){var A=this.levels[q];q=A.tileSize[0];A=A.tileSize[1];z[0]=this.origin[0]+C*q;z[2]=this.origin[0]+(C+1)*q;z[3]=this.origin[1]-u*A;z[1]=this.origin[1]-(u+1)*A};B.convertExtentToRadians=function(q,u){this._isWebMercator?(u[0]=e.x2lon(q[0]),
u[1]=e.y2lat(q[1]),u[2]=e.x2lon(q[2]),u[3]=e.y2lat(q[3])):this._isGCS&&(u[0]=m.deg2rad(q[0]),u[1]=m.deg2rad(q[1]),u[2]=m.deg2rad(q[2]),u[3]=m.deg2rad(q[3]))};B.getExtentGeometry=function(q,u,C,z=new n){this.getExtent(q,u,C,t);z.spatialReference=this.spatialReference;z.xmin=t[0];z.ymin=t[1];z.xmax=t[2];z.ymax=t[3];z.zmin=void 0;z.zmax=void 0;return z};B.ensureMaxLod=function(q){if(null==q)return!1;for(var u=!1;this.levels.length<=q;){u=this.levels[this.levels.length-1];const C=u.resolution/2;this.levels.push({resolution:C,
scale:u.scale/2,tileSize:[C*this.pixelSize,C*this.pixelSize]});u=!0}return u};B.capMaxLod=function(q){this.levels.length>q+1&&(this.levels.length=q+1)};B.getMaxLod=function(){return this.levels.length-1};B.scaleAtLevel=function(q){return this.levels[0].scale/2**q};B.levelAtScale=function(q){const u=this.levels[0].scale;return q>=u?0:Math.log(u/q)*Math.LOG2E};B.resolutionAtLevel=function(q){return this.levels[0].resolution/2**q};B.compatibleWith=function(q){if(!(q instanceof x)){if(x.checkUnsupported(q))return!1;
q=new x(q)}if(!q.spatialReference.equals(this.spatialReference)||q.pixelSize!==this.pixelSize)return!1;const u=Math.min(this.levels.length,q.levels.length)-1,C=this.levels[u].resolution;let z=.5*C;if(!m.floatEqualAbsolute(q.origin[0],this.origin[0],z)||!m.floatEqualAbsolute(q.origin[1],this.origin[1],z))return!1;z=.5*C/2**u/this.pixelSize*12;return m.floatEqualAbsolute(C,q.levels[u].resolution,z)};B.rootTilesInExtent=function(q,u=null,C=Infinity){const z=[],A=this.levels[0].tileSize;if(l.isNone(q)||
0===A[0]||0===A[1])return z;x.computeRowColExtent(q,A,this.origin,t);q=t[1];let p=t[3],y=t[0],D=t[2];var E=D-y;const F=p-q;E*F>C&&(C=Math.floor(Math.sqrt(C)),F>C&&(q=q+Math.floor(.5*F)-Math.floor(.5*C),p=q+C),E>C&&(y=y+Math.floor(.5*E)-Math.floor(.5*C),D=y+C));for(C=q;C<p;C++)for(E=y;E<D;E++)z.push([0,C,E]);l.isSome(u)&&(u[0]=this.origin[0]+y*A[0],u[1]=this.origin[1]-p*A[1],u[2]=this.origin[0]+D*A[0],u[3]=this.origin[1]-q*A[1]);return z};x.computeRowColExtent=function(q,u,C,z){const A=.001*(q[2]-
q[0]+(q[3]-q[1]));z[0]=Math.max(0,Math.floor((q[0]+A-C[0])/u[0]));z[2]=Math.max(0,Math.ceil((q[2]-A-C[0])/u[0]));z[1]=Math.max(0,Math.floor((C[1]-q[3]+A)/u[1]));z[3]=Math.max(0,Math.ceil((C[1]-q[1]-A)/u[1]))};x.isPowerOfTwo=function(q){q=q.lods;const u=q[0].resolution*2**q[0].level;return!q.some(C=>!m.floatEqualRelative(C.resolution,u/2**C.level))};x.hasGapInLevels=function(q){q=q.lods.map(u=>u.level);q.sort((u,C)=>u-C);for(let u=1;u<q.length;u++)if(q[u]!==q[0]+u)return!0;return!1};x.tileSizeSupported=
function(q){const u=q.size[1];return u===q.size[0]&&0===(u&u-1)&&128<=u&&512>=u};x.hasOriginPerLODs=function(q){const u=q.origin;return q.lods.some(C=>null!=C.origin&&(C.origin[0]!==u.x||C.origin[1]!==u.y))};x.getMissingTileInfoError=function(){return new c("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")};x.checkUnsupported=function(q){return l.isNone(q)?v():1>q.lods.length?new c("tilingscheme:generic","Tiling scheme must have at least one level"):x.isPowerOfTwo(q)?
x.hasGapInLevels(q)?new c("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):x.tileSizeSupported(q)?x.hasOriginPerLODs(q)?new c("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new c("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new c("tilingscheme:power-of-two","Tiling scheme must be power of two")};x.fromExtent=function(q,u){const C=q[2]-q[0],z=q[3]-q[1],A=r.getMetersPerUnitForSR(u),
p=1.2*Math.max(C,z);q=new x(new h({size:[256,256],origin:{x:q[0]-.5*(p-C),y:q[3]+.5*(p-z)},lods:[{level:0,resolution:p/256,scale:1/(256/96*.0254/(p*A))}],spatialReference:u}));q.ensureMaxLod(20);return q};x.makeWebMercatorAuxiliarySphere=function(q){const u=new x(x.WebMercatorAuxiliarySphereTileInfo);u.ensureMaxLod(q);return u};x.makeGCSWithTileSize=function(q,u=256,C=16){const z=256/u;q=new x(new h({size:[u,u],origin:{x:-180,y:90,spatialReference:q},spatialReference:q,lods:[{level:0,resolution:.703125*
z,scale:2.95497598570834E8*z}]}));q.ensureMaxLod(C);return q};b._createClass(x,[{key:"test",get:function(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}]);return x}();w.WebMercatorAuxiliarySphereTileInfo=new h({size:[256,256],origin:{x:-2.0037508342787E7,y:2.0037508342787E7,spatialReference:k.WebMercator},spatialReference:k.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:5.91657527591555E8}]});w.WebMercatorAuxiliarySphere=w.makeWebMercatorAuxiliarySphere(19);const t=
f.create();a.TilingScheme=w;a.getMissingTileInfoError=v;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/TileInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/maybe ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q){var u;c=new c.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});m=u=function(C){function z(p){p=C.call(this,p)||this;p.dpi=96;p.format=null;p.origin=null;p.minScale=0;p.maxScale=0;p.size=null;p.spatialReference=null;return p}a._inheritsLoose(z,C);z.create=function(p=
{}){const {resolutionFactor:y=1,scales:D,size:E=256,spatialReference:F=w.WebMercator,numLODs:G=24}=p;if(!x.isValid(F)){p=[];if(D)for(var P=0;P<D.length;P++){var K=D[P];p.push({level:P,scale:K,resolution:K})}else for(P=5E-4,K=G-1;0<=K;K--)p.unshift({level:K,scale:P,resolution:P}),P*=2;return new u({dpi:96,lods:p,origin:new v(0,0,F),size:[E,E],spatialReference:F})}P=x.getInfo(F);p=p.origin?new v({x:p.origin.x,y:p.origin.y,spatialReference:F}):P?new v({x:P.origin[0],y:P.origin[1],spatialReference:F}):
new v({x:0,y:0,spatialReference:F});P=1/(39.37*r.getMetersPerUnitForSR(F)*96);K=[];if(D)for(var N=0;N<D.length;N++){var M=D[N];K.push({level:N,scale:M,resolution:M*P})}else{var L=x.isGeographic(F)?512/E*5.916575275917094E8:256/E*5.91657527591555E8;N=Math.ceil(G/y);K.push({level:0,scale:L,resolution:L*P});for(M=1;M<N;M++)L/=2**y,K.push({level:M,scale:L,resolution:L*P})}return new u({dpi:96,lods:K,origin:p,size:[E,E],spatialReference:F})};var A=z.prototype;A.readOrigin=function(p,y){return v.fromJSON({spatialReference:y.spatialReference,
...p})};A.readSize=function(p,y){return[y.cols,y.rows]};A.writeSize=function(p,y){y.cols=p[0];y.rows=p[1]};A.zoomToScale=function(p){const y=this.scales;if(0>=p)return y[0];if(p>=y.length-1)return y[y.length-1];{const D=Math.floor(p);return y[D]/(y[D]/y[D+1])**(p-D)}};A.scaleToZoom=function(p){const y=this.scales,D=y.length-1;let E=0;for(;E<D;E++){const F=y[E],G=y[E+1];if(F<=p)break;if(G===p)return E+1;if(F>p&&G<p)return E+Math.log(F/p)/Math.log(F/G)}return E};A.snapScale=function(p,y=.95){p=this.scaleToZoom(p);
return p%Math.floor(p)>=y?this.zoomToScale(Math.ceil(p)):this.zoomToScale(Math.floor(p))};A.tileAt=function(p,y,D,E){var F=this.lodAt(p);if(!F)return null;let G;if("number"===typeof y)G=y,y=D;else{if(x.equals(y.spatialReference,this.spatialReference))G=y.x,y=y.y;else{E=B.project(y,this.spatialReference);if(l.isNone(E))return null;G=E.x;y=E.y}E=D}D=F.resolution*this.size[0];F=F.resolution*this.size[1];E||(E={id:null,level:0,row:0,col:0,extent:t.create()});E.level=p;E.row=Math.floor((this.origin.y-
y)/F+.001);E.col=Math.floor((G-this.origin.x)/D+.001);this.updateTileInfo(E);return E};A.updateTileInfo=function(p,y=u.ExtrapolateOptions.NONE){var D=this.lodAt(p.level);D||y!==u.ExtrapolateOptions.POWER_OF_TWO||(y=this.lods[this.lods.length-1],y.level<p.level&&(D=y));if(D){var E=p.level-D.level;y=D.resolution*this.size[0]/2**E;D=D.resolution*this.size[1]/2**E;p.id=`${p.level}/${p.row}/${p.col}`;p.extent||(p.extent=t.create());p.extent[0]=this.origin.x+p.col*y;p.extent[1]=this.origin.y-(p.row+1)*
D;p.extent[2]=p.extent[0]+y;p.extent[3]=p.extent[1]+D}};A.upsampleTile=function(p){const y=this._upsampleLevels[p.level];if(!y||-1===y.parentLevel)return!1;p.level=y.parentLevel;p.row=Math.floor(p.row/y.factor+.001);p.col=Math.floor(p.col/y.factor+.001);this.updateTileInfo(p);return!0};A.getTileBounds=function(p,y){var {resolution:D}=this.lodAt(y.level);const E=D*this.size[0];D*=this.size[1];p[0]=this.origin.x+y.col*E;p[1]=this.origin.y-(y.row+1)*D;p[2]=p[0]+E;p[3]=p[1]+D;return p};A.lodAt=function(p){return this._levelToLOD&&
this._levelToLOD[p]||null};A.clone=function(){return u.fromJSON(this.write({}))};A.getOrCreateCompatible=function(p,y){if(256===this.size[0]&&256===this.size[1])return 256===p?this:null;const D=[],E=this.lods.length;for(let F=0;F<E;F++){const G=this.lods[F];D.push(new q({level:G.level,scale:G.scale,resolution:G.resolution*y}))}return new u({size:[p,p],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,origin:this.origin,spatialReference:this.spatialReference,lods:D})};A._initializeUpsampleLevels=
function(){const p=this.lods;this._upsampleLevels=[];let y=null;for(let D=0;D<p.length;D++){const E=p[D];this._upsampleLevels[E.level]={parentLevel:y?y.level:-1,factor:y?y.resolution/E.resolution:0};y=E}};a._createClass(z,[{key:"isWrappable",get:function(){const {spatialReference:p,origin:y}=this;if(p&&y){const D=x.getInfo(p);return p.isWrappable&&Math.abs(D.origin[0]-y.x)<=D.dx}return!1}},{key:"lods",set:function(p){let y=0,D=0;const E=[];this._levelToLOD={};p&&(y=-Infinity,D=Infinity,p.forEach(F=>
{E.push(F.scale);y=F.scale>y?F.scale:y;D=F.scale<D?F.scale:D;this._levelToLOD[F.level]=F}));this._set("scales",E);this._set("minScale",y);this._set("maxScale",D);this._set("lods",p);this._initializeUpsampleLevels()}}]);return z}(m.JSONSupport);b.__decorate([n.property({type:Number,json:{write:!0}})],m.prototype,"compressionQuality",void 0);b.__decorate([n.property({type:Number,json:{write:!0}})],m.prototype,"dpi",void 0);b.__decorate([n.property({type:String,json:{read:c.read,write:c.write,origins:{"web-scene":{read:!1,
write:!1}}}})],m.prototype,"format",void 0);b.__decorate([n.property({readOnly:!0})],m.prototype,"isWrappable",null);b.__decorate([n.property({type:v,json:{write:!0}})],m.prototype,"origin",void 0);b.__decorate([d.reader("origin")],m.prototype,"readOrigin",null);b.__decorate([n.property({type:[q],value:null,json:{write:!0}})],m.prototype,"lods",null);b.__decorate([n.property({readOnly:!0})],m.prototype,"minScale",void 0);b.__decorate([n.property({readOnly:!0})],m.prototype,"maxScale",void 0);b.__decorate([n.property({readOnly:!0})],
m.prototype,"scales",void 0);b.__decorate([n.property({cast:C=>Array.isArray(C)?C:"number"===typeof C?[C,C]:[256,256]})],m.prototype,"size",void 0);b.__decorate([d.reader("size",["rows","cols"])],m.prototype,"readSize",null);b.__decorate([h.writer("size",{cols:{type:f.Integer},rows:{type:f.Integer}})],m.prototype,"writeSize",null);b.__decorate([n.property({type:w,json:{write:!0}})],m.prototype,"spatialReference",void 0);m=u=b.__decorate([e.subclass("esri.layers.support.TileInfo")],m);(function(C){C=
C.ExtrapolateOptions||(C.ExtrapolateOptions={});C[C.NONE=0]="NONE";C[C.POWER_OF_TWO=1]="POWER_OF_TWO"})(m||(m={}));return m})},"esri/layers/support/LOD":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,m,l,r,n,g){var k;c=k=function(f){function d(e){e=
f.call(this,e)||this;e.cols=null;e.level=0;e.levelValue=null;e.origin=null;e.resolution=0;e.rows=null;e.scale=0;return e}a._inheritsLoose(d,f);d.prototype.clone=function(){return new k({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})};return d}(c.JSONSupport);b.__decorate([m.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"cols",void 0);b.__decorate([m.property({type:n.Integer,
json:{write:!0}})],c.prototype,"level",void 0);b.__decorate([m.property({type:String,json:{write:!0}})],c.prototype,"levelValue",void 0);b.__decorate([m.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,"origin",void 0);b.__decorate([m.property({type:Number,json:{write:!0}})],c.prototype,"resolution",void 0);b.__decorate([m.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],c.prototype,
"rows",void 0);b.__decorate([m.property({type:Number,json:{write:!0}})],c.prototype,"scale",void 0);return c=k=b.__decorate([g.subclass("esri.layers.support.LOD")],c)})},"esri/views/PopupView":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/maybe ../core/promiseUtils ../core/Logger ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/set ../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,m,l,r,n,g,
k,f,d){a.PopupView=e=>{e=function(h){function v(){return h.apply(this,arguments)||this}b._inheritsLoose(v,h);var w=v.prototype;w.fetchPopupFeatures=function(){var t=b._asyncToGenerator(function*(x,B){yield this.when();const {location:q,queryArea:u,layerViewsAndGraphics:C,clientOnlyGraphics:z}=yield this._prepareFetchPopupFeatures(x,B);x=Promise.resolve(z);B=this._queryLayerPopupFeatures(u,C,B);const A=B.map(p=>p.promise);x=l.eachAlwaysValues([x,...A]).then(p=>Array.from(new Set(p.flat())));return{location:q,
clientOnlyGraphics:z,allGraphicsPromise:x,promisesPerLayerView:B}});return function(x,B){return t.apply(this,arguments)}}();w._queryLayerPopupFeatures=function(t,x,B){return x.map(({layerView:q,graphics:u})=>{u={clientGraphics:u,event:m.isSome(B)?B.event:null,signal:m.isSome(B)?B.signal:null,defaultPopupTemplateEnabled:m.isSome(B)?!!B.defaultPopupTemplateEnabled:!1};u=q.fetchPopupFeatures(t,u);return{layerView:q,promise:u}})};w._isValidPopupGraphic=function(t,x){return t&&!!t.getEffectivePopupTemplate(m.isSome(x)&&
x.defaultPopupTemplateEnabled)};w._prepareFetchPopupFeatures=function(){var t=b._asyncToGenerator(function*(x,B){const {clientGraphics:q,queryArea:u,location:C}=yield this._popupHitTestGraphics(x,B);x=this._getFetchPopupLayerViews();const {layerViewsAndGraphics:z,clientOnlyGraphics:A}=this._graphicsPerFetchPopupLayerView(q,x);return{clientOnlyGraphics:A,layerViewsAndGraphics:z,queryArea:u,location:C}});return function(x,B){return t.apply(this,arguments)}}();w._popupHitTestGraphics=function(){var t=
b._asyncToGenerator(function*(x,B){const {results:q,mapPoint:u}=yield this.popupHitTest(x);x=q.filter(z=>"graphic"===z.type&&this._isValidPopupGraphic(z.graphic,B));const C=x.length?x[0].mapPoint:null;return{clientGraphics:x.map(z=>z.graphic),queryArea:u,location:u||C}});return function(x,B){return t.apply(this,arguments)}}();w._getFetchPopupLayerViews=function(){const t=[];this.allLayerViews.forEach(x=>{this._isValidPopupLayerView(x)&&t.push(x)});m.isSome(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&
t.push(this.graphicsView);return t.reverse()};w._isValidPopupLayerView=function(t){return m.isSome(t)&&(!("layer"in t)||!t.suspended)&&"fetchPopupFeatures"in t};w._graphicsPerFetchPopupLayerView=function(t,x){const B=[],q=new Map;x=x.map(u=>{const C=[];"layer"in u?q.set(u.layer,C):q.set(u.graphics,C);return{layerView:u,graphics:C}});for(const u of t)(t=q.get(u.layer)||q.get(u.sourceLayer)||null)?t.push(u):B.push(u);return{layerViewsAndGraphics:x,clientOnlyGraphics:B}};return v}(e);return e=c.__decorate([d.subclass("esri.views.PopupView")],
e)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layerViewModuleImportUtils":function(){define(["require","exports","../../core/Error","../../core/maybe"],function(a,b,c,m){const l=k=>Object.freeze(Object.defineProperty({__proto__:null,default:k},Symbol.toStringTag,{value:"Module"})),r=()=>new Promise((k,f)=>a(["./layers/TileLayerView3D"],d=>k(l(d)),f)),n=()=>new Promise((k,f)=>a(["./layers/ElevationLayerView3D"],d=>k(l(d)),f)),g={"base-dynamic":()=>
new Promise((k,f)=>a(["./layers/BaseDynamicLayerView3D"],d=>k(l(d)),f)),"base-elevation":n,"base-tile":r,"bing-maps":r,"building-scene":()=>new Promise((k,f)=>a(["./layers/BuildingSceneLayerView3D"],d=>k(l(d)),f)),csv:()=>new Promise((k,f)=>a(["./layers/CSVLayerView3D"],d=>k(l(d)),f)),elevation:n,feature:()=>new Promise((k,f)=>a(["./layers/FeatureLayerView3D"],d=>k(l(d)),f)),geojson:()=>new Promise((k,f)=>a(["./layers/GeoJSONLayerView3D"],d=>k(l(d)),f)),graphics:()=>new Promise((k,f)=>a(["./layers/GraphicsLayerView3D"],
d=>k(l(d)),f)),group:()=>new Promise((k,f)=>a(["../layers/GroupLayerView"],d=>k(l(d)),f)),imagery:()=>new Promise((k,f)=>a(["./layers/ImageryLayerView3D"],d=>k(l(d)),f)),"integrated-mesh":()=>new Promise((k,f)=>a(["./layers/IntegratedMeshLayerView3D"],d=>k(l(d)),f)),"line-of-sight":()=>new Promise((k,f)=>a(["./layers/LineOfSightLayerView3D"],d=>k(l(d)),f)),"map-image":()=>new Promise((k,f)=>a(["./layers/MapImageLayerView3D"],d=>k(l(d)),f)),media:()=>new Promise((k,f)=>a(["./layers/MediaLayerView3D"],
d=>k(l(d)),f)),"ogc-feature":()=>new Promise((k,f)=>a(["./layers/OGCFeatureLayerView3D"],d=>k(l(d)),f)),"open-street-map":r,"point-cloud":()=>new Promise((k,f)=>a(["./layers/PointCloudLayerView3D"],d=>k(l(d)),f)),voxel:()=>new Promise((k,f)=>a(["./layers/VoxelLayerView3D"],d=>k(l(d)),f)),route:()=>new Promise((k,f)=>a(["./layers/RouteLayerView3D"],d=>k(l(d)),f)),scene:k=>null==k.profile||"mesh-pyramids"===k.profile?new Promise((f,d)=>a(["./layers/SceneLayerView3D"],e=>f(l(e)),d)):new Promise((f,d)=>
a(["./layers/SceneLayerGraphicsView3D"],e=>f(l(e)),d)),stream:()=>new Promise((k,f)=>a(["./layers/StreamLayerView3D"],d=>k(l(d)),f)),tile:r,"imagery-tile":()=>new Promise((k,f)=>a(["./layers/ImageryTileLayerView3D"],d=>k(l(d)),f)),"vector-tile":()=>new Promise((k,f)=>a(["./layers/VectorTileLayerView3D"],d=>k(l(d)),f)),wcs:()=>new Promise((k,f)=>a(["./layers/ImageryTileLayerView3D"],d=>k(l(d)),f)),"web-tile":r,wfs:()=>new Promise((k,f)=>a(["./layers/WFSLayerView3D"],d=>k(l(d)),f)),wms:()=>new Promise((k,
f)=>a(["./layers/WMSLayerView3D"],d=>k(l(d)),f)),wmts:()=>new Promise((k,f)=>a(["./layers/WMTSLayerView3D"],d=>k(l(d)),f)),"geo-rss":null,kml:null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null};b.layerView3DImporter={hasLayerViewModule:k=>m.isSome(g[k.type]),importLayerView:k=>{var f=g[k.type];if(m.isNone(f))throw k=k.declaredClass?k.declaredClass.slice(k.declaredClass.lastIndexOf(".")+1):"Unknown",f=k.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),k=new c(`${f}:view-not-supported`,
`${k} is not supported in 3D`),k;return f(k)}};Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/analysis/AnalysisViewManager3D":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/Error ../../../core/HandleOwner ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/scheduling ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e){const h=x=>Object.freeze(Object.defineProperty({__proto__:null,default:x},Symbol.toStringTag,{value:"Module"})),v=n.getLogger("esri.views.3d.analysis.AnalysisViewManager3D");var w;(function(x){x[x.PENDING=0]="PENDING";x[x.CREATED=1]="CREATED"})(w||(w={}));var t;(function(x){x[x.ADDED=0]="ADDED";x[x.REMOVED=1]="REMOVED"})(t||(t={}));r=function(x){function B(u){u=x.call(this,u)||this;u._allAnalysisViews=new m;u._creatingViewCount=0;u._items=new Map;u._scheduledUpdateHandle=
null;u._attachedToViewResolver=k.createResolver();u._analysisModules={"area-measurement":{module:null},dimensioning:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}};return u}b._inheritsLoose(B,x);var q=B.prototype;q.destroy=function(){this._disconnectOwners();this._attachedToViewResolver.reject(k.createAbortError("AnalysisViewManager was destroyed"))};q.attach=function(){this._connectOwners();this._attachedToViewResolver.resolve()};q.detach=
function(){this._disconnectOwners();this._attachedToViewResolver.reject(k.createAbortError());this._attachedToViewResolver=k.createResolver();this._attachedToViewResolver.promise.catch(()=>{})};q.whenAnalysisView=function(){var u=b._asyncToGenerator(function*(C){yield this._attachedToViewResolver.promise;const z=this._items.get(C);if(g.isNone(z)||z.state.list===t.REMOVED)throw new l("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:C});
return z.createAnalysisViewTask.promise});return function(C){return u.apply(this,arguments)}}();q._connectOwners=function(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),"analyses-owner-handles")};q._disconnectOwners=function(){this.handles.remove("analyses-owner-handles");this._update();this._creatingViewCount=0};q._connectAnalysesCollection=function(u){for(const A of u)this._addAnalysis(A);const C=u.on("after-add",A=>this._addAnalysis(A.item)),z=u.on("after-remove",A=>this._removeAnalysis(A.item));
return{remove:()=>{C.remove();z.remove();for(const A of u)this._removeAnalysis(A)}}};q._addAnalysis=function(u){const C=this._items.get(u);if(null==C){const z={state:{view:w.PENDING,list:t.ADDED},analysis:u,view:null,createAnalysisViewTask:null};this._items.set(u,z);z.createAnalysisViewTask=k.createTask(A=>this._createAnalysisViewPromise(z,A))}else C.state.list=t.ADDED};q._removeAnalysis=function(u){u=this._items.get(u);null==u?v.error("Trying to remove analysis which was not added"):(u.state.list=
t.REMOVED,this._scheduleUpdate())};q._scheduleUpdate=function(){g.isSome(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=f.schedule(()=>this._update()))};q._update=function(){this._scheduledUpdateHandle=g.removeMaybe(this._scheduledUpdateHandle);this._items.forEach(u=>{if(u.state.list===t.REMOVED)switch(this._items.delete(u.analysis),u.state.view){case w.PENDING:u.createAnalysisViewTask=g.abortMaybe(u.createAnalysisViewTask);break;case w.CREATED:g.isSome(u.view)&&(this._allAnalysisViews.remove(u.view),
u.view=g.destroyMaybe(u.view),u.createAnalysisViewTask=null)}})};q._createAnalysisViewPromise=function(){var u=b._asyncToGenerator(function*(C,z){var A=C.analysis;const p=A.type,y=this._analysisModules[p];this._creatingViewCount+=1;if(g.isNone(y.module))try{y.module=yield this._loadAnalysisModule(p)}catch(D){throw--this._creatingViewCount,D;}if(k.isAborted(z))throw--this._creatingViewCount,k.createAbortError("AnalysisView creation aborted");A=new y.module.default({analysis:A,view:this.view});try{yield A.when()}catch(D){throw--this._creatingViewCount,
D;}if(k.isAborted(z))throw--this._creatingViewCount,A.destroy(),k.createAbortError("AnalysisView creation aborted");C.view=A;C.state.view=w.CREATED;this._allAnalysisViews.add(A);--this._creatingViewCount;return A});return function(C,z){return u.apply(this,arguments)}}();q._loadAnalysisModule=function(u){switch(u){case "area-measurement":return new Promise((C,z)=>a(["./AreaMeasurementAnalysisView3D"],A=>C(h(A)),z));case "dimensioning":return new Promise((C,z)=>a(["./DimensioningAnalysisView3D"],A=>
C(h(A)),z));case "direct-line-measurement":return new Promise((C,z)=>a(["./DirectLineMeasurementAnalysisView3D"],A=>C(h(A)),z));case "line-of-sight":return new Promise((C,z)=>a(["./LineOfSightAnalysisView3D"],A=>C(h(A)),z));case "slice":return new Promise((C,z)=>a(["./SliceAnalysisView3D"],A=>C(h(A)),z))}};b._createClass(B,[{key:"updating",get:function(){return!this.view.ready||0!==this._creatingViewCount||this._allAnalysisViews.some(u=>u.updating)}},{key:"testInfo",get:function(){return{allAnalysisViews:this._allAnalysisViews}}}]);
return B}(r.HandleOwner);c.__decorate([d.property()],r.prototype,"updating",null);c.__decorate([d.property({constructOnly:!0})],r.prototype,"view",void 0);c.__decorate([d.property()],r.prototype,"_allAnalysisViews",void 0);c.__decorate([d.property()],r.prototype,"_creatingViewCount",void 0);return r=c.__decorate([e.subclass("esri.views.3d.analysis.AnalysisViewManager3D")],r)})},"esri/views/3d/constraints/Constraints":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./AltitudeConstraint ./ClipDistanceConstraint ./TiltConstraint".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e){a.Constraints=function(h){function v(){var w=h.apply(this,arguments)||this;w.tilt=new e.TiltConstraint;w.altitude=new f.AltitudeConstraint;w.clipDistance=new d.ClipDistanceConstraint;return w}b._inheritsLoose(v,h);return v}(m);c.__decorate([l.property({type:e.TiltConstraint})],a.Constraints.prototype,"tilt",void 0);c.__decorate([l.property({type:f.AltitudeConstraint})],a.Constraints.prototype,"altitude",void 0);c.__decorate([l.property({type:d.ClipDistanceConstraint})],
a.Constraints.prototype,"clipDistance",void 0);a.Constraints=c.__decorate([k.subclass("esri.views.3d.constraints.Constraints")],a.Constraints);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),
function(a,b,c,m,l,r,n,g,k,f){a.AltitudeConstraint=function(d){function e(){var h=d.apply(this,arguments)||this;h.min=f.earthAltitudeConstraint.min;h.max=f.earthAltitudeConstraint.max;return h}b._inheritsLoose(e,d);return e}(m);c.__decorate([l.property({type:Number})],a.AltitudeConstraint.prototype,"min",void 0);c.__decorate([l.property({type:Number})],a.AltitudeConstraint.prototype,"max",void 0);a.AltitudeConstraint=c.__decorate([k.subclass("esri.views.3d.constraints.AltitudeConstraint")],a.AltitudeConstraint);
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/Constraints":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Logger ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/Ellipsoid ../../ViewingMode ../support/mathUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){const w=l.getLogger("esri.views.3d.state.Constraints");a.Constraints=function(q){function u(z){z=q.call(this,z)||this;z.collision=new B;z.distance=Infinity;z.minimumPoiDistance=4;return z}b._inheritsLoose(u,q);var C=u.prototype;C.clampAltitude=function(z){return this.altitude?r.clamp(z,this.altitude.min,this.altitude.max):z};C.clampTilt=function(z,A){if(!this.tilt)return A;z=this.tilt(z);return r.clamp(A,z.min,z.max)};C.clampDistance=function(z){return Math.min(z,
this.distance)};C.createDefaultTilt=function(){return this.mode===h.ViewingMode.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()};C.createConstantMaxTilt=function(z){return(A,p=x)=>{p.min=t.min;p.max=z;return p}};C._createDefaultTiltLocal=function(){const z=this.collision.enabled?v.makePiecewiseLinearFunction([[4E3,t.max],[1E4,r.deg2rad(88)],[6E6,r.deg2rad(88)]]):()=>t.max;return(A,p=x)=>{p.min=t.min;p.max=z(A);return p}};C._createDefaultTiltGlobal=function(){const z=this.collision.enabled?
v.makePiecewiseLinearFunction([[4E3,t.max],[5E4,r.deg2rad(88)],[6E6,r.deg2rad(88)],[2E7,t.min]]):v.makePiecewiseLinearFunction([[3E5,t.max],[3E6,r.deg2rad(88)],[6E6,r.deg2rad(88)],[2E7,t.min]]);return(A,p=x)=>{p.min=t.min;p.max=z(A);return p}};b._createClass(u,[{key:"altitude",get:function(){return this.mode===h.ViewingMode.Local?null:this._get("altitude")||null},set:function(z){this.mode===h.ViewingMode.Local?w.warn("Altitude constraint is ignored in local scenes"):this._set("altitude",z)}}]);return u}(m);
c.__decorate([n.property()],a.Constraints.prototype,"altitude",null);c.__decorate([n.property({readOnly:!0})],a.Constraints.prototype,"collision",void 0);c.__decorate([n.property()],a.Constraints.prototype,"distance",void 0);c.__decorate([n.property({readOnly:!0})],a.Constraints.prototype,"minimumPoiDistance",void 0);c.__decorate([n.property()],a.Constraints.prototype,"tilt",void 0);c.__decorate([n.property({constructOnly:!0})],a.Constraints.prototype,"mode",void 0);a.Constraints=c.__decorate([d.subclass("esri.views.3d.state.Constraints")],
a.Constraints);l={min:-2E5,max:4*e.earth.radius};const t={min:r.deg2rad(.5),max:r.deg2rad(179.5)},x={min:0,max:0};let B=function(q){function u(){var C=q.apply(this,arguments)||this;C.enabled=!0;C.elevationMargin=5;return C}b._inheritsLoose(u,q);return u}(m);c.__decorate([n.property({type:Boolean})],B.prototype,"enabled",void 0);c.__decorate([n.property({type:Number})],B.prototype,"elevationMargin",void 0);B=c.__decorate([d.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],B);a.TiltDefault=
t;a.earthAltitudeConstraint=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,
b,c,m,l,r,n,g,k){a.ClipDistanceConstraint=function(f){function d(){var h=f.apply(this,arguments)||this;h.mode="auto";return h}b._inheritsLoose(d,f);var e=d.prototype;e.castNear=function(h){return Math.max(1E-8,h)};e.castFar=function(h){return Math.max(1E-8,h)};e.autoUpdate=function(h,v){"auto"===this.mode&&(this._get("near")!==h&&this._set("near",h),this._get("far")!==v&&this._set("far",v))};b._createClass(d,[{key:"near",get:function(){return this._get("near")},set:function(h){this._set("near",h);
h>=this._get("far")&&(this.far=h+1E-9);this.mode="manual"}},{key:"far",get:function(){return this._get("far")},set:function(h){this._set("far",h);h<=this._get("near")&&(this.near=h-1E-9);this.mode="manual"}}]);return d}(m);c.__decorate([l.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"near",null);c.__decorate([g.cast("near")],a.ClipDistanceConstraint.prototype,"castNear",null);c.__decorate([l.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"far",null);
c.__decorate([g.cast("far")],a.ClipDistanceConstraint.prototype,"castFar",null);c.__decorate([l.property({type:["auto","manual"]})],a.ClipDistanceConstraint.prototype,"mode",void 0);a.ClipDistanceConstraint=c.__decorate([k.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],a.ClipDistanceConstraint);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/constraints/TiltConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){var e=l.rad2deg(d.TiltDefault.min),h=l.rad2deg(d.TiltDefault.max);a.TiltConstraint=function(v){function w(){var x=v.apply(this,arguments)||this;x.mode="auto";return x}b._inheritsLoose(w,v);var t=w.prototype;t.castMax=function(x){return l.clamp(x,e,h)};t.autoUpdate=function(x){"auto"===this.mode&&this._get("max")!==x&&this._set("max",x)};b._createClass(w,[{key:"max",get:function(){return this._get("max")},set:function(x){this._set("max",x);this.mode="manual"}}]);return w}(m);
c.__decorate([r.property({type:["auto","manual"]})],a.TiltConstraint.prototype,"mode",void 0);c.__decorate([r.property({type:Number,value:h})],a.TiltConstraint.prototype,"max",null);c.__decorate([k.cast("max")],a.TiltConstraint.prototype,"castMax",null);a.TiltConstraint=c.__decorate([f.subclass("esri.views.3d.constraints.TiltConstraint")],a.TiltConstraint);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/ensureType ./lightingUtils ./SceneViewAtmosphere ./SunLighting ./VirtualLighting ../../../webscene/Environment ../../../webscene/SunLighting ../../../webscene/VirtualLighting".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){var w;e=w=function(t){function x(q){q=t.call(this,q)||this;q.atmosphere=new k.SceneViewAtmosphere;q.lighting=new f;return q}a._inheritsLoose(x,t);x.fromWebsceneEnvironment=function(q){q=q.cloneConstructProperties();return new w({...q,lighting:"virtual"===q.lighting.type?d.fromWebsceneLighting(q.lighting):f.fromWebsceneLighting(q.lighting)})};var B=x.prototype;B.castLighting=function(q){return this._convertLighting(q)};B.applyLighting=function(q){this.lighting=
this._convertLighting(q)};B._convertLighting=function(q){return q?q instanceof f||q instanceof d?q:q instanceof h?this.lighting&&"sun"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(q):new f(q.cloneConstructProperties()):q instanceof v?this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(q):new d(q.cloneConstructProperties()):n.ensureOneOfType(g.lightingTypes,q):new f};B.clone=function(){return new w({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),
weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:c.clone(this.background)})};B.cloneWithWebsceneEnvironment=function(q){return new w({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:c.clone(this.background),...q.cloneConstructProperties(),lighting:this._getLighting(q)})};B._getLighting=function(q){return"sun"===q.lighting.type?this.lighting&&
"sun"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(q.lighting):f.fromWebsceneLighting(q.lighting):"virtual"===q.lighting.type?this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(q.lighting):d.fromWebsceneLighting(q.lighting):f.fromWebsceneLighting(q.lighting)};return x}(e);b.__decorate([m.property({type:k.SceneViewAtmosphere,json:{read:!1},nonNullable:!0})],e.prototype,"atmosphere",void 0);b.__decorate([m.property({nonNullable:!0})],e.prototype,"lighting",
void 0);b.__decorate([l.cast("lighting")],e.prototype,"castLighting",null);return e=w=b.__decorate([r.subclass("esri.views.3d.environment.SceneViewEnvironment")],e)})},"esri/views/3d/environment/lightingUtils":function(){define(["exports","./SunLighting","./VirtualLighting"],function(a,b,c){a.lightingTypes={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:b,virtual:c}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/SunLighting":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Evented ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../webscene/SunLighting".split(" "),
function(a,b,c,m,l,r,n,g,k){var f;c=f=function(e){function h(w){w=e.call(this,w)||this;w.cameraTrackingEnabled=!0;w.ambientOcclusionEnabled=!1;w.waterReflectionEnabled=!1;w.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};var t=(new Date).getFullYear();t=new Date("March 15, "+t+" 12:00:00 UTC");w._set("defaultDate",t);w._set("date",t);return w}a._inheritsLoose(h,e);h.fromWebsceneLighting=function(w){return new f(w.cloneConstructProperties())};var v=h.prototype;v.autoUpdate=function(w,
t){const x=f.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=t.hours;this.positionTimezoneInfo.minutes=t.minutes;this.positionTimezoneInfo.seconds=t.seconds;t=null;null!=w&&(this.positionTimezoneInfo.autoUpdated=!0,t=this.date&&this.date.getTime(),this._set("date",new Date(w.getTime())));const B=f.calculateTimezoneOffset(this.positionTimezoneInfo);x!==B&&(d.target=this,d.timezoneOffset=B,this.emit("timezone-will-change",d));if(null!=w)return t!==w.getTime()};v.clone=
function(){const w=this._get("date")===this._get("defaultDate"),t=new f({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});w&&t._set("date",t._get("defaultDate"));t.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated;t.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours;t.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes;
t.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return t};v.cloneWithWebsceneLighting=function(w){const t=this.clone();null!=w.date&&(t.date=w.date);t.directShadowsEnabled=w.directShadowsEnabled;t.displayUTCOffset=w.displayUTCOffset;return t};a._createClass(h,[{key:"defaultDate",get:function(){return new Date(this._get("defaultDate").getTime())},set:function(w){const t=this._get("date")===this._get("defaultDate");w=new Date(w.getTime());this._set("defaultDate",w);t&&this._set("date",
w)}},{key:"date",set:function(w){null!=w&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(w.getTime())))}}]);return h}(c.EventedMixin(k));b.__decorate([m.property({type:Boolean})],c.prototype,"cameraTrackingEnabled",void 0);b.__decorate([m.property({type:Boolean})],c.prototype,"ambientOcclusionEnabled",void 0);b.__decorate([m.property({type:Boolean})],c.prototype,"waterReflectionEnabled",void 0);b.__decorate([m.property({type:Date})],c.prototype,"defaultDate",null);b.__decorate([m.property({type:Date})],
c.prototype,"date",null);c=f=b.__decorate([g.subclass("esri.views.3d.environment.SunLighting")],c);(function(e){e.calculateTimezoneOffset=function({hours:h,minutes:v,seconds:w}){return Math.round(h+v/60+w/3600)}})(c||(c={}));const d={target:null,timezoneOffset:0};return c})},"esri/webscene/SunLighting":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer".split(" "),
function(a,b,c,m,l,r,n,g,k,f){var d;c=d=function(e){function h(w){w=e.call(this,w)||this;w.type="sun";w.date=null;w.directShadowsEnabled=!1;w.displayUTCOffset=null;return w}a._inheritsLoose(h,e);var v=h.prototype;v.readDate=function(w,t){return null!=t.datetime&&new Date(t.datetime)||null};v.writeDate=function(w,t,x){t[x]=w.getTime()};v.readDirectShadowsEnabled=function(w,t){return!!t.directShadows};v.writedirectShadowsEnabled=function(w,t,x){w&&(t[x]=w)};v.writeDisplayUTCOffset=function(w,t){null!=
w&&(t.displayUTCOffset=w)};v.clone=function(){return new d(this.cloneConstructProperties())};v.cloneConstructProperties=function(){const w={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(w.date=new Date(this.date.getTime()));return w};return h}(c.JSONSupport);b.__decorate([m.property({readOnly:!0,type:["sun"],json:{write:!0}})],c.prototype,"type",void 0);b.__decorate([m.property({type:Date,json:{type:Number,
write:{target:"datetime"}}})],c.prototype,"date",void 0);b.__decorate([g.reader("date",["datetime"])],c.prototype,"readDate",null);b.__decorate([f.writer("date")],c.prototype,"writeDate",null);b.__decorate([m.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],c.prototype,"directShadowsEnabled",void 0);b.__decorate([g.reader("directShadowsEnabled",["directShadows"])],c.prototype,"readDirectShadowsEnabled",null);b.__decorate([f.writer("directShadowsEnabled")],c.prototype,"writedirectShadowsEnabled",
null);b.__decorate([m.property({type:Number,json:{write:!0}})],c.prototype,"displayUTCOffset",void 0);b.__decorate([f.writer("displayUTCOffset")],c.prototype,"writeDisplayUTCOffset",null);return c=d=b.__decorate([k.subclass("esri.webscene.SunLighting")],c)})},"esri/views/3d/environment/VirtualLighting":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Evented ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../webscene/VirtualLighting".split(" "),
function(a,b,c,m,l,r,n,g,k){var f;c=f=function(d){function e(v){v=d.call(this,v)||this;v.ambientOcclusionEnabled=!1;v.waterReflectionEnabled=!1;return v}a._inheritsLoose(e,d);var h=e.prototype;h.clone=function(){return new f({...this.cloneConstructProperties(),ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled})};e.fromWebsceneLighting=function(v){return new f(v.cloneConstructProperties())};h.cloneWithWebsceneLighting=function(v){const w=this.clone();
w.directShadowsEnabled=v.directShadowsEnabled;return w};return e}(c.EventedMixin(k));b.__decorate([m.property({type:Boolean})],c.prototype,"ambientOcclusionEnabled",void 0);b.__decorate([m.property({type:Boolean})],c.prototype,"waterReflectionEnabled",void 0);return c=f=b.__decorate([g.subclass("esri.views.3d.environment.VirtualLighting")],c)})},"esri/webscene/VirtualLighting":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,m,l,r,n,g){var k;c=k=function(f){function d(h){h=f.call(this,h)||this;h.type="virtual";h.directShadowsEnabled=!1;return h}a._inheritsLoose(d,f);var e=d.prototype;e.clone=function(){return new k(this.cloneConstructProperties())};e.cloneConstructProperties=function(){return{directShadowsEnabled:this.directShadowsEnabled}};return d}(c.JSONSupport);b.__decorate([m.property({readOnly:!0,type:["virtual"],json:{write:!0}})],c.prototype,"type",void 0);b.__decorate([m.property({type:Boolean,
json:{default:!1,name:"directShadows",write:!0}})],c.prototype,"directShadowsEnabled",void 0);return c=k=b.__decorate([g.subclass("esri.webscene.VirtualLighting")],c)})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,m,l,r,n,g,k){var f;a.SceneViewAtmosphere=f=function(d){function e(){return d.apply(this,arguments)||this}b._inheritsLoose(e,d);e.prototype.clone=function(){return new f({quality:this.quality})};b._createClass(e,[{key:"quality",set:function(h){["low","high"].includes(h)&&this._set("quality",h)}}]);return e}(m);c.__decorate([l.property({type:["low","high"],value:"low"})],a.SceneViewAtmosphere.prototype,"quality",null);a.SceneViewAtmosphere=f=c.__decorate([k.subclass("esri.views.3d.environment.SceneViewAtmosphere")],
a.SceneViewAtmosphere);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/webscene/Environment":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/lang ../core/Logger ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ../views/3d/environment/SunnyWeather ../views/3d/environment/weather ./lightingTypes ./SunLighting ./VirtualLighting ./background/utils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){var w;const t=l.getLogger("esri.webscene.Environment");l=(x,B,q)=>({enabled:!q||!q.isPresentation});c=w=function(x){function B(u){u=x.call(this,u)||this;u.lighting=new e;u.background=null;u.atmosphereEnabled=!0;u.starsEnabled=!0;return u}a._inheritsLoose(B,x);var q=B.prototype;q.clone=function(){return new w(this.cloneConstructProperties())};q.cloneConstructProperties=function(){return{lighting:this.lighting&&"virtual"===this.lighting.type?h.prototype.clone.call(this.lighting):
e.prototype.clone.call(this.lighting),background:m.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}};a._createClass(B,[{key:"weather",set:function(u){f.validateWeatherType(null==u?void 0:u.type,t)&&this._set("weather",u)}}]);return B}(c.JSONSupport);b.__decorate([r.property({types:d.lightingTypes,nonNullable:!0,json:{write:!0}})],c.prototype,"lighting",void 0);b.__decorate([r.property(v.backgroundProperty)],c.prototype,"background",
void 0);b.__decorate([r.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:l}}})],c.prototype,"atmosphereEnabled",void 0);b.__decorate([r.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:l}}})],c.prototype,"starsEnabled",void 0);b.__decorate([r.property({types:f.weatherTypes,nonNullable:!0,json:{write:!0},value:new k})],c.prototype,"weather",null);return c=w=b.__decorate([g.subclass("esri.webscene.Environment")],c)})},"esri/views/3d/environment/SunnyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,m,l,r,n,g,k){var f;c=f=function(d){function e(h){h=d.call(this,h)||this;h.type="sunny";h.cloudCover=.5;return h}a._inheritsLoose(e,d);e.prototype.clone=function(){return new f({cloudCover:this.cloudCover})};return e}(c.JSONSupport);b.__decorate([g.enumeration({sunny:"sunny"})],c.prototype,"type",void 0);b.__decorate([m.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0);return c=f=b.__decorate([k.subclass("esri.views.3d.environment.SunnyWeather")],
c)})},"esri/views/3d/environment/weather":function(){define("exports ./CloudyWeather ./FoggyWeather ./RainyWeather ./SnowyWeather ./SunnyWeather".split(" "),function(a,b,c,m,l,r){b={key:"type",base:r,typeMap:{sunny:r,cloudy:b,rainy:m,snowy:l,foggy:c}};const n=Object.keys(b.typeMap);a.validateWeatherType=function(g,k){return n.includes(g)?!0:(k.error(`"${g}" is not a valid weather type`),!1)};a.weatherEquals=function(g,k){if(g.type!==k.type)return!1;switch(g.type){case "sunny":return g.cloudCover===
k.cloudCover;case "rainy":return g.cloudCover===k.cloudCover&&g.precipitation===k.precipitation;case "snowy":return g.cloudCover===k.cloudCover&&g.precipitation===k.precipitation&&g.snowCover===k.snowCover;case "cloudy":return g.cloudCover===k.cloudCover;case "foggy":return g.fogStrength===k.fogStrength}};a.weatherHeightLimit=1E4;a.weatherTypes=b;a.weatherTypesArray=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/CloudyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,m,l,r,n,g,k){var f;c=f=function(d){function e(h){h=d.call(this,h)||this;h.type="cloudy";h.cloudCover=.5;return h}a._inheritsLoose(e,d);e.prototype.clone=function(){return new f({cloudCover:this.cloudCover})};return e}(c.JSONSupport);b.__decorate([g.enumeration({cloudy:"cloudy"})],c.prototype,"type",void 0);b.__decorate([m.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0);return c=f=b.__decorate([k.subclass("esri.views.3d.environment.CloudyWeather")],
c)})},"esri/views/3d/environment/FoggyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,m,l,r,n,g,k){var f;c=f=function(d){function e(h){h=d.call(this,h)||this;h.type=
"foggy";h.fogStrength=.5;return h}a._inheritsLoose(e,d);e.prototype.clone=function(){return new f({fogStrength:this.fogStrength})};return e}(c.JSONSupport);b.__decorate([g.enumeration({foggy:"foggy"})],c.prototype,"type",void 0);b.__decorate([m.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"fogStrength",void 0);return c=f=b.__decorate([k.subclass("esri.views.3d.environment.FoggyWeather")],c)})},"esri/views/3d/environment/RainyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,m,l,r,n,g,k){var f;c=f=function(d){function e(h){h=d.call(this,h)||this;h.type="rainy";h.cloudCover=.5;h.precipitation=.5;return h}a._inheritsLoose(e,d);e.prototype.clone=function(){return new f({cloudCover:this.cloudCover,precipitation:this.precipitation})};return e}(c.JSONSupport);b.__decorate([g.enumeration({rainy:"rainy"})],c.prototype,"type",void 0);b.__decorate([m.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0);b.__decorate([m.property({type:Number,
nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"precipitation",void 0);return c=f=b.__decorate([k.subclass("esri.views.3d.environment.RainyWeather")],c)})},"esri/views/3d/environment/SnowyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,m,l,r,n,g,k){var f;c=f=function(d){function e(h){h=d.call(this,h)||this;h.type="snowy";h.cloudCover=.5;h.precipitation=.5;h.snowCover="disabled";return h}a._inheritsLoose(e,d);e.prototype.clone=function(){return new f({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})};return e}(c.JSONSupport);b.__decorate([g.enumeration({snowy:"snowy"})],c.prototype,"type",void 0);b.__decorate([m.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],
c.prototype,"cloudCover",void 0);b.__decorate([m.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"precipitation",void 0);b.__decorate([m.property({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],c.prototype,"snowCover",void 0);return c=f=b.__decorate([k.subclass("esri.views.3d.environment.SnowyWeather")],c)})},"esri/webscene/lightingTypes":function(){define(["exports","./SunLighting","./VirtualLighting"],function(a,b,c){a.lightingTypes={key:"type",
defaultKeyValue:"sun",base:null,typeMap:{sun:b,virtual:c}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/webscene/background/utils":function(){define(["exports","./Background","./ColorBackground"],function(a,b,c){b={base:b,key:"type",typeMap:{color:c}};b={types:b,json:{read:function(m){return(l,r,n)=>{if(!l)return l;for(const g in m.typeMap)if(l.type===g)return r=new m.typeMap[g],r.read(l,n),r}}(b),write:{overridePolicy:(m,l,r)=>({enabled:!r||!r.isPresentation})}}};
a.backgroundProperty=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/webscene/background/Background":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,m,l,r,n,g){c=function(k){function f(d){return k.call(this,
d)||this}a._inheritsLoose(f,k);f.prototype.clone=function(){};return f}(c.JSONSupport);b.__decorate([m.property({readOnly:!0,json:{read:!1}})],c.prototype,"type",void 0);return c=b.__decorate([g.subclass("esri.webscene.background.Background")],c)})},"esri/webscene/background/ColorBackground":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../symbols/support/materialUtils ./Background".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){var e;l={...f.colorAndTransparencyProperty,nonNullable:!0};d=e=function(h){function v(t){t=h.call(this,t)||this;t.type="color";t.color=new c([0,0,0,1]);return t}a._inheritsLoose(v,h);var w=v.prototype;w.clone=function(){return new e(this.cloneProperties())};w.cloneProperties=function(){return{color:this.color.clone()}};return v}(d);b.__decorate([g.enumeration({color:"color"},{readOnly:!0})],d.prototype,"type",void 0);b.__decorate([m.property(l)],d.prototype,"color",
void 0);return d=e=b.__decorate([k.subclass("esri.webscene.background.ColorBackground")],d)})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Evented ../../../core/Handles ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../ViewingMode ./EnvironmentRenderer ../support/earthUtils ../support/sunUtils ../webgl-engine/lighting/Lightsources ../../../webscene/background/ColorBackground".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y){a.SceneViewEnvironmentManager=function(N){function M(){var J=N.call(this)||this;J._referencePointUpdateDelay=200;J._referencePointUpdateInterval=3E3;J._referencePointUpdateDistThreshold=1E6;J._referencePosUpdateQuery=null;J._referencePosMapCoordsRequested=null;J._viewHandles=new r;J._preserveAbsoluteDateTime=!1;J._trackingEnabled=!1;J._referencePosResetPreserveAbsoluteTime=!1;J._referencePosUpdateTimer=null;J._referencePosMapCoords=null;
J._mainLight=new p.MainLight;J._ambientLight=new p.AmbientLight;J._moonLight=new p.FillLight;J.disableQueries=!1;J._disableWeather=!1;J._renderer=null;J._referencePosWGS84Comparable=null;J._resetReferencePosition();return J}b._inheritsLoose(M,N);var L=M.prototype;L.destroy=function(){this.disconnectView();this._viewHandles.destroy()};L.connectView=function(J){if(!this._renderer){this._renderer=new C.EnvironmentRenderer({view:J});var H=()=>this._updateRenderParameters(),I=()=>this._cameraHandler(),
O=()=>this._updateLighting();this._viewHandles.add([k.watch(()=>J.environment.lighting,Q=>this._updateLightingHandler(Q),k.sync),k.watch(()=>"sun"===J.environment.lighting.type?J.environment.lighting.date:null,Q=>this._lightingDateHandler(Q),k.sync),k.watch(()=>J.stationary,()=>this._interactingStationaryHandler()),k.watch(()=>J.environment.lighting.directShadowsEnabled,H,k.sync),k.watch(()=>J.environment.lighting.ambientOcclusionEnabled,H,k.sync),k.watch(()=>J.environment.lighting.waterReflectionEnabled,
H,k.sync),k.watch(()=>{var Q;return null==(Q=J.environment.background)?void 0:Q.color},H,k.sync),k.watch(()=>J.spatialReference,()=>this._resetReferencePosition(!0),k.sync),k.watch(()=>J.environment.weather.type,O,k.sync),k.watch(()=>this.weatherEnabled,O,k.sync),k.watch(()=>J.viewingMode,()=>this._resetReferencePosition(!0),k.syncAndInitial),k.watch(()=>"sun"===J.environment.lighting.type?J.environment.lighting.cameraTrackingEnabled:!1,Q=>this._updateCameraTracking(Q),k.syncAndInitial),k.watch(()=>
J.state.camera,I,k.syncAndInitial),k.watch(()=>this.disableQueries,I)]);this._updateRenderParameters();this._updateLighting();this._cameraHandler();this.notifyChange("updating")}};L.disconnectView=function(){this._viewHandles.removeAll();this._resetReferencePosition();this._renderer=n.destroyMaybe(this._renderer)};L._updateLightingHandler=function(J){this._updateCameraTracking("sun"===J.type?J.cameraTrackingEnabled:!1);this._lightingDateHandler("sun"===J.type?J.date:null);this._updateRenderParameters()};
L._updateCameraTracking=function(J){(this._trackingEnabled=J)?this._cameraHandler():(J=this._view.environment.lighting,"sun"===(null==J?void 0:J.type)&&(J.positionTimezoneInfo.autoUpdated=!1))};L._lightingDateHandler=function(J){const H=this._view.environment.lighting;if("virtual"===(null==H?void 0:H.type))this._updateLighting();else if(J){if(!H.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;if(!B.canProjectToWGS84ComparableLonLat(this._view.spatialReference)){var I=this._view.camera.position;
if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(I)){this._requestReferencePositionUpdate(I);return}}this._preupdateTracking(J);n.isSome(this._referencePosWGS84Comparable)&&(I=z.positionToTimezoneInfo(this._referencePosWGS84Comparable,G),n.isSome(I)&&(H.autoUpdate(null,I),this._trackingEnabled&&(H.positionTimezoneInfo.autoUpdated=!0)))}this._updateLighting(J)}};L._preupdateTracking=function(J){!this._trackingEnabled&&"sun"===this._view.environment.lighting.type&&this._view.environment.lighting.cameraTrackingEnabled&&
this._cameraHandler(J)};L._cameraHandler=function(J=null){var H=this._view;H.ready&&(H=H.stateManager.camera)&&(this._cameraHandlerClientSide(H,J)||this._cameraHandlerServerSide(H))};L._cameraHandlerClientSide=function(J,H){const I=q.isEarth(this._view.spatialReference);if(I&&!B.canProjectToWGS84ComparableLonLat(this._view.spatialReference))return!1;J=J.position;n.isNone(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=t.create());I?B.projectPointToWGS84ComparableLonLat(J,this._referencePosWGS84Comparable):
w.set(this._referencePosWGS84Comparable,J.longitude,J.latitude,J.z);this.notifyChange("referencePositionWGS84Comparable");this._autoUpdateTimezone(this._referencePosWGS84Comparable,H)||this._updateLighting(H);return!0};L._cameraHandlerServerSide=function(J){J=J.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(J))&&this._requestReferencePositionUpdate(J,!0);this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=
J.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())};L._interactingStationaryHandler=function(){this._view.stationary&&this._executePendingReferencePositionUpdate()};L._updateLighting=function(J){const H=this._view;var I=J||("sun"===H.environment.lighting.type?H.environment.lighting.date:null),O=this._referencePosWGS84Comparable;J=n.isSome(O)?D:E;n.isSome(O)&&A.computeColorAndIntensity(I,O,H.state.viewingMode,this.weatherVisible?H.environment.weather.type:"disabled",H.state.camera,
H.environment.lighting.type,J);I=this._mainLight;O=J.direct;w.scale(I.intensity,O.color,O.intensity*Math.PI);w.copy(I.direction,O.directionToLightSource);I.specularStrength=J.specularStrength;I.environmentStrength=J.environmentStrength;const Q=this._ambientLight;w.scale(Q.intensity,J.ambient.color,J.ambient.intensity);const S=this._moonLight;w.lerp(S.intensity,P,K,J.globalFactor);w.scale(S.intensity,S.intensity,(1-.5*J.globalFactor)*(1-.4*J.noonFactor*(1-J.globalFactor)));w.copy(S.direction,O.directionToLightSource);
H._stage.renderView.updateLightSources([I,Q,S],1-J.noonFactor,J.globalFactor);this._updateRenderParameters()};L._autoUpdateTimezone=function(J,H=null){if("virtual"===this._view.environment.lighting.type||!this._view.environment.lighting.cameraTrackingEnabled||n.isNone(J))return!1;const I=F;I.setTime((H||this._view.environment.lighting.date).getTime());J=z.positionToTimezoneInfo(J,G);if(n.isNone(J))return!1;var O=this._view.environment.lighting.positionTimezoneInfo;if(!O.autoUpdated)O=J;else if(O.hours===
J.hours&&O.minutes===J.minutes&&O.seconds===J.seconds)return!1;const Q=I.getUTCHours()-(J.hours-O.hours),S=I.getUTCMinutes()-(J.minutes-O.minutes);O=I.getUTCSeconds()-(J.seconds-O.seconds);I.setUTCHours(Q);I.setUTCMinutes(S);I.setUTCSeconds(O);return H?!1:this._view.environment.lighting.autoUpdate(I,J)};L._updateRenderParameters=function(){const J=this._view._stage;if(J){var H=n.mapOr(this._referencePosWGS84Comparable,!0,O=>A.computeShadowsEnabled(O[2],this._view.state.viewingMode)),I=this._view.environment.background;
I=I instanceof y?{type:"color",color:x.fromArray(m.toUnitRGBA(I.color))}:{type:"color",color:x.fromValues(0,0,0,1)};J.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&H,background:I,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible})}};L._resetReferencePosition=function(J=!1){this._cancelReferencePosUpdates();this._referencePosWGS84Comparable=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=
this._referencePosMapCoords=null;this.notifyChange("updating");J&&this._cameraHandler()};L._requestReferencePositionUpdate=function(J,H=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(J):this._referencePosMapCoordsRequested=J.clone(),this._referencePosResetPreserveAbsoluteTime=!!H,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const I=this._referencePosUpdateQuery=g.after(this._referencePointUpdateDelay).then(()=>
{if(this._referencePosUpdateQuery===I)return this._doReferencePositionUpdateQuery(()=>this._referencePosUpdateQuery!==I)}).catch(Q=>{"mapcoordshelper:missing-geometry-service"===Q.name&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===I&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),O=this._referencePosUpdateTimer=g.after(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===
O&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}};L._doReferencePositionUpdateQuery=function(){var J=b._asyncToGenerator(function*(H){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1);this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone();this._referencePosMapCoordsRequested=
this._referencePosResetPreserveAbsoluteTime=null;const I=yield this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);H()||isNaN(I[0])||isNaN(I[1])||(H=this._referencePosMapCoords.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=I[0],this._referencePosWGS84Comparable[1]=I[1],this._referencePosWGS84Comparable[2]=H):this._referencePosWGS84Comparable=[I[0],I[1],H],this._referencePosChanged())});return function(H){return J.apply(this,
arguments)}}();L._executePendingReferencePositionUpdate=function(){const J=this._referencePosMapCoordsRequested;J&&this._requestReferencePositionUpdate(J,this._referencePosResetPreserveAbsoluteTime)};L._referencePosChanged=function(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting();this.notifyChange("referencePositionWGS84Comparable")};L._exceedsReferencePosDistThreshold=function(J){return this._referencePosMapCoords?
(J=this._referencePosMapCoords.distance(J),this._view.mapCoordsHelper&&(J*=this._view.mapCoordsHelper.unitInMeters),J>this._referencePointUpdateDistThreshold):!0};L._cancelReferencePosUpdates=function(){const J=!!this._referencePosUpdateQuery;this._referencePosUpdateTimer=this._referencePosUpdateQuery=null;return J};b._createClass(M,[{key:"_view",get:function(){var J;return null==(J=this._renderer)?void 0:J.view}},{key:"updating",get:function(){var J;return!!(!this.disableQueries&&(this._referencePosUpdateQuery||
this._referencePosMapCoordsRequested)||null!=(J=this._renderer)&&J.updating)}},{key:"weatherEnabled",get:function(){var J,H,I;return(null==(J=this._view)?void 0:J.environment.atmosphereEnabled)&&!this._disableWeather&&(null==(H=this._view)?void 0:null==(I=H.state)?void 0:I.viewingMode)===u.ViewingMode.Global&&q.isEarth(this._view.spatialReference)}},{key:"weatherVisible",get:function(){var J;return this.weatherEnabled&&(null==(J=this._renderer)?void 0:J.weatherVisible)}},{key:"referencePositionWGS84Comparable",
get:function(){return this._referencePosWGS84Comparable}},{key:"test",get:function(){const J=this;return{get renderer(){return J._renderer},set referencePointUpdateInterval(H){J._referencePointUpdateInterval=H},set referencePointUpdateDistThreshold(H){J._referencePointUpdateDistThreshold=H},set referencePosUpdateTimer(H){J._referencePosUpdateTimer=H},set referencePointUpdateDelay(H){J._referencePointUpdateDelay=H},set disableWeather(H){J._disableWeather=H}}}}]);return M}(l.EventedAccessor);c.__decorate([f.property({type:Boolean,
readOnly:!0})],a.SceneViewEnvironmentManager.prototype,"updating",null);c.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"disableQueries",void 0);c.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"_disableWeather",void 0);c.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"weatherEnabled",null);c.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"weatherVisible",null);c.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,
"referencePositionWGS84Comparable",null);c.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"_renderer",void 0);c.__decorate([f.property()],a.SceneViewEnvironmentManager.prototype,"_referencePosWGS84Comparable",void 0);a.SceneViewEnvironmentManager=c.__decorate([v.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],a.SceneViewEnvironmentManager);const D=new A.ColorAndIntensity,E=new A.ColorAndIntensity,F=new Date,G={hours:0,minutes:0,seconds:0},P=t.fromValues(.22,.22,
.33),K=t.fromValues(.22,.22,.22);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/has ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../geometry/projectionEllipsoid ../../../geometry/support/spatialReferenceUtils ./ChapmanAtmosphere ./CloudsComposition ./CloudsData ./CloudsGenerator ./CloudsPresets ./Fog ./PanoramicAtmosphere ./Precipitation ./SimpleAtmosphere ./Stars ./weather ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G){var P;const K=[G.RenderSlot.POSTPROCESSING_ENVIRONMENT_OPAQUE,G.RenderSlot.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];a.EnvironmentRenderer=P=function(M){function L(H){H=M.call(this,H)||this;H._handles=new r;H._context=null;H._pendingAtmosphere=null;H._atmosphere=null;return H}b._inheritsLoose(L,M);var J=L.prototype;J.initialize=function(){this.view._stage.addRenderPlugin(K,this)};J.destroy=function(){var H;this._pendingAtmosphere=g.destroyMaybe(this._pendingAtmosphere);
null!=(null==(H=this.view)?void 0:H._stage)&&this.view._stage.removeRenderPlugin(this);this._handles=g.destroyMaybe(this._handles);this._set("view",null)};J.updateAnimation=function(H){return g.isSome(this._precipitation)?this._precipitation.update(H):!1};J.initializeRenderContext=function(H=null){this._context=H;this._handles.add([k.when(()=>{var I;return null==(I=this.view)?void 0:I.basemapTerrain},()=>this._updateBasemapTerrain(),k.syncAndInitial),k.watch(()=>({viewingMode:this.view.viewingMode,
atmosphereEnabled:this.view.environment.atmosphereEnabled,atmosphereQuality:this.view.environment.atmosphere.quality}),()=>this._updateAtmosphere(),k.syncAndInitial),k.watch(()=>this._stars,()=>this._setNeedsRender()),k.watch(()=>this._clouds,()=>this._updateWeather(this._weatherUpdateParameters),k.initial),k.watch(()=>this._precipitation,()=>this._setNeedsRender()),k.watch(()=>this._fog,()=>this._updateFog(this._weatherUpdateParameters),k.initial),k.watch(()=>this._weatherUpdateParameters,I=>{this._updateWeather(I);
this._updateFog(I)},k.syncAndInitial)])};J.uninitializeRenderContext=function(){this._context=null;this._atmosphere=g.destroyMaybe(this._atmosphere);this._set("_stars",g.destroyMaybe(this._stars));this._set("_precipitation",g.destroyMaybe(this._precipitation));this._set("_clouds",g.destroyMaybe(this._clouds));this._set("_cloudsComposition",g.destroyMaybe(this._cloudsComposition));this._set("_fog",g.destroyMaybe(this._fog))};J.prepareRender=function(H){H.bindParameters.clouds.data=q.isReadyCloudsData(this._clouds)?
this._clouds:null};J.render=function(H){if(H.pass===F.RenderPass.MATERIAL)switch(H.bindParameters.slot){case G.RenderSlot.POSTPROCESSING_ENVIRONMENT_OPAQUE:g.isSome(this._stars)&&this._stars.render(H);g.isSome(this._atmosphere)&&this._atmosphere.canRender&&(this._atmosphere.render(H),g.isSome(this._cloudsComposition)&&g.isSome(H.bindParameters.clouds.data)&&(this.weatherVisible&&g.isSome(this._clouds)&&this._clouds.ensureWeatherTile(),this._cloudsComposition.render(H,g.isSome(this.view.animation))));
break;case G.RenderSlot.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(g.isSome(this._atmosphere)&&this._atmosphere.canRender){var I=this.weatherEnabled?this.view.environment.weather.type:"disabled";this._atmosphere.renderHaze(H,"rainy"===I);if(g.isSome(this._fog)){const O="foggy"===I||"rainy"===I||"snowy"===I;(O||"realistic"!==this._selectAtmosphereType())&&this._fog.render(H,O,"rainy"===I)}g.isSome(this._precipitation)&&(I=this.view.environment.weather,"rainy"!==I.type&&"snowy"!==I.type||this._precipitation.render(H,
I.precipitation,I.type))}}};J._updateWeather=function(H){g.isNone(H)||g.isNone(this._clouds)||(this._clouds.applyPreset(C.cloudPresets[H.type],H.weatherAdjustment),this._setNeedsRender())};J._setNeedsRender=function(){g.isSome(this._context)&&this._context.requestRender()};J._updateFog=function(H){if(!g.isNone(this._fog)&&!g.isNone(H))switch(H.type){case "foggy":this._fog.strength=n.lerp(3E-5,.005,H.weatherAdjustment**3);this._setNeedsRender();break;case "rainy":case "snowy":this._fog.strength=n.lerp(4E-6,
2E-4,H.effect**3);this._setNeedsRender();break;default:this._fog.strength=4E-6,this._setNeedsRender()}};J._updateAtmosphere=function(){var H=this._selectAtmosphereType();if(this.atmosphereType!==H)if(g.isSome(this._pendingAtmosphere)&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null),H=this._getAtmosphereClass()){var I=new H(this.view);g.isSome(this._context)&&I.initializeRenderContext(this._context);g.isNone(this._atmosphere)&&(this._atmosphere=
I,this._setNeedsRender());this._pendingAtmosphere=I;I.when().then(()=>{g.isSome(this._atmosphere)&&this._pendingAtmosphere&&this._pendingAtmosphere!==this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=this._pendingAtmosphere);this._pendingAtmosphere=null;this._setNeedsRender();this._updateBasemapTerrain()}).catch(()=>{this._pendingAtmosphere===I&&(this._pendingAtmosphere=null)})}else g.isSome(this._atmosphere)&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),
this._updateBasemapTerrain()};J._getAtmosphereClass=function(){switch(this._selectAtmosphereType()){case "none":return null;case "realistic":return x.ChapmanAtmosphere;case "panoramic":return A.PanoramicAtmosphere;case "simple":return y}};J._selectAtmosphereType=function(){const H=this.view.get("environment.atmosphereEnabled"),I=this.view.get("environment.atmosphere.quality"),O=this.view.viewingMode;return!H||null==I||t.isMoon(this.view.spatialReference)?"none":"local"===O?"panoramic":"high"===I&&
g.isSome(this._context)&&x.ChapmanAtmosphere.isSupported(this._context)&&t.isEarth(this.view.spatialReference)?"realistic":"simple"};J._updateBasemapTerrain=function(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=g.isSome(this._atmosphere)&&"simple"===this.atmosphereType)};b._createClass(L,[{key:"atmosphereType",get:function(){return g.isSome(this._pendingAtmosphere)?this._pendingAtmosphere.type:g.isSome(this._atmosphere)?this._atmosphere.type:"none"}},{key:"canRender",get:function(){var H;
return!(null==(H=this.view.basemapTerrain)||!H.renderer.canRender)||"global"!==this.view.viewingMode}},{key:"needsLinearDepth",get:function(){return"realistic"===this._selectAtmosphereType()}},{key:"updating",get:function(){return g.isSome(this._pendingAtmosphere)||g.isSome(this._stars)&&this._stars.updating||g.isSome(this._clouds)&&this._clouds.running}},{key:"weatherVisible",get:function(){return v.length(this.view.state.camera.eye)-w.getReferenceEllipsoid(this.view.spatialReference).radius<=E.weatherHeightLimit}},
{key:"_stars",get:function(){var H,I;const O=this.view,Q=null!=(H=null==(I=O.environment)?void 0:I.starsEnabled)?H:!1;H=this._get("_stars");return!Q||g.isNone(this._context)?(g.destroyMaybe(H),null):g.isSome(H)?H:new D.Stars({view:O,requestRender:()=>this._setNeedsRender()})}},{key:"_precipitation",get:function(){const H=this._get("_precipitation");if(!this._precipitationEnabled||g.isNone(this._context))return g.destroyMaybe(H),null;const I=this.view,O=this._context;if(g.isSome(H)&&H.context===O)return H;
g.destroyMaybe(H);return new p.Precipitation({context:O,view:I})}},{key:"_clouds",get:function(){const H=this._get("_clouds");if(!this.weatherEnabled||g.isNone(this._context))return g.destroyMaybe(H),null;if(g.isSome(H))return H;const I=this.view,O=this._context;g.destroyMaybe(H);return new u.CloudsGenerator({context:O,view:I,requestRender:()=>this._setNeedsRender()})}},{key:"_cloudsComposition",get:function(){const H=this._get("_cloudsComposition");if(!this.weatherEnabled||g.isNone(this._context))return g.destroyMaybe(H),
null;const I=this.view.state.viewingMode,O=this._context.renderContext.rctx,Q=w.getReferenceEllipsoid(this.view.spatialReference).radius;if(g.isSome(H)&&H.viewingMode===I&&H.planetRadius===Q)return H;g.destroyMaybe(H);return new B.CloudsComposition({rctx:O,viewingMode:I,planetRadius:Q,requestRender:()=>this._setNeedsRender()})}},{key:"_fog",get:function(){const H=this._get("_fog");if(!this.weatherEnabled||g.isNone(this._context))return g.destroyMaybe(H),null;if(g.isSome(H))return H;const I=this.view,
O=this._context;g.destroyMaybe(H);return new z.Fog({context:O,view:I})}},{key:"weatherEnabled",get:function(){var H,I;return!(null==(H=this.view)||null==(I=H.environmentManager)||!I.weatherEnabled)}},{key:"_precipitationEnabled",get:function(){return this.weatherEnabled&&("rainy"===this.view.environment.weather.type||"snowy"===this.view.environment.weather.type)}},{key:"_weatherUpdateParameters",get:function(){const H=this.weatherEnabled?this.view.environment.weather:null;return g.isNone(H)?null:
"rainy"===H.type||"snowy"===H.type?{type:H.type,weatherAdjustment:H.cloudCover,effect:H.precipitation}:{type:H.type,weatherAdjustment:"foggy"===H.type?H.fogStrength:H.cloudCover}}},{key:"test",get:function(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType(),stubGetAtmosphereClass:H=>{N=P.prototype._getAtmosphereClass;P.prototype._getAtmosphereClass=H},restoreGetAtmosphereClass:()=>{P.prototype._getAtmosphereClass=N}}}}]);return L}(m);c.__decorate([f.property({constructOnly:!0})],
a.EnvironmentRenderer.prototype,"view",void 0);c.__decorate([f.property({type:Boolean,readOnly:!0})],a.EnvironmentRenderer.prototype,"updating",null);c.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"weatherVisible",null);c.__decorate([f.property()],a.EnvironmentRenderer.prototype,"_context",void 0);c.__decorate([f.property()],a.EnvironmentRenderer.prototype,"_pendingAtmosphere",void 0);c.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_stars",null);
c.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_precipitation",null);c.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_clouds",null);c.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_cloudsComposition",null);c.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_fog",null);c.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"weatherEnabled",null);c.__decorate([f.property({readOnly:!0})],
a.EnvironmentRenderer.prototype,"_precipitationEnabled",null);c.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_weatherUpdateParameters",null);a.EnvironmentRenderer=P=c.__decorate([h.subclass("esri.views.3d.environment.EnvironmentRenderer")],a.EnvironmentRenderer);let N;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/ChapmanAtmosphere":function(){define("exports ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/support/Ellipsoid ./atmosphereUtils ./ChapmanAtmosphereTechnique ./ChapmanAtmosphereTechniqueConfiguration ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B){let q=function(){function C(A){this._view=A;this.type="realistic";this.canRender=!0;this._cameraPosition=k.create();this._heightParameters=f.create();this._betasRayleigh=k.create();this._betasCombined=k.create();this._scaleHeight=0;this._radii=n.create();this._lowerElevationBoundRadius=this._altitudeFade=this._innerFadeDistance=this._cAtmosphere=this._cameraHeightSq=this._cameraHeight=0;this._lowerBoundEarthRadius=d.earth.radius;this._hazeStrength=1;this._darkenHaze=
!1;this._updateRadius(d.earth.radius)}var z=C.prototype;z.destroy=function(){this._atmosphereTechnique=m.releaseMaybe(this._atmosphereTechnique);this._atmosphereHazeTechnique=m.releaseMaybe(this._atmosphereHazeTechnique);this._vao=m.disposeMaybe(this._vao);this._handles=m.destroyMaybe(this._handles)};z.when=function(){return Promise.resolve()};z.initializeRenderContext=function(A){const p=A.renderContext.rctx;var y=this._handles=new b;const D=this._view.basemapTerrain;m.isSome(D.rootTiles)&&this._updateElevation({spatialReference:D.spatialReference,
tile:D.rootTiles[0],extent:D.rootTiles[0].extent,context:"ground"});y.add(l.on(()=>this._view.basemapTerrain,"elevation-change",E=>this._updateElevation(E),{onListenerAdd:()=>this._updateElevation()}));y.add(l.on(()=>this._view.basemapTerrain,"elevation-bounds-change",()=>this._updateVisibleElevationBounds()));y=new v.ChapmanAtmosphereTechniqueConfiguration;y.haze=!1;this._atmosphereTechnique=A.shaderTechniqueRepository.acquire(h.ChapmanAtmosphereTechnique,y);y.haze=!0;this._atmosphereHazeTechnique=
A.shaderTechniqueRepository.acquire(h.ChapmanAtmosphereTechnique,y);this._vao=x.createQuadVAO(p,t.Pos2Tex);this._scaleHeight=e.rayLeighScaleHeight*e.atmosphereHeight;g.set(this._betasRayleigh,e.betaRayleigh[0],e.betaRayleigh[1],e.betaRayleigh[2]);g.set(this._betasCombined,e.betaRayleigh[0]+e.betaOzone[0],e.betaRayleigh[1]+e.betaOzone[1],e.betaRayleigh[2]+e.betaOzone[2])};z.render=function(A){this._render(A,this._atmosphereTechnique,A.offscreenRenderingHelper.depthTexture)};z.renderHaze=function(A,
p){this._darkenHaze=p;this._render(A,this._atmosphereHazeTechnique,A.offscreenRenderingHelper.linearDepthTexture)};z._render=function(A,p,y){this._update(A.bindParameters.camera);const D=A.rctx.bindTechnique(p,u,A.bindParameters);A.offscreenRenderingHelper.renderDepthDetached(()=>{D.bindTexture("depthTex",y);this._renderCommon(p.program,A)})};z._renderCommon=function(A,p){m.isNone(this._vao)||(p=p.rctx,A.setUniform4fv("heightParameters",this._heightParameters),A.setUniform3fv("cameraPosition",this._cameraPosition),
A.setUniform2fv("radii",this._radii),A.setUniform1f("scaleHeight",this._scaleHeight),A.setUniform1f("betaMie",e.betaMie),A.setUniform3fv("betaRayleigh",this._betasRayleigh),A.setUniform3fv("betaCombined",this._betasCombined),A.setUniform1f("innerFadeDistance",this._innerFadeDistance),A.setUniform1f("altitudeFade",this._altitudeFade),A.setUniform1f("hazeStrength",this._hazeStrength),p.bindVAO(this._vao),A.assertCompatibleVertexAttributeLocations(this._vao),p.drawArrays(B.PrimitiveType.TRIANGLE_STRIP,
0,4))};z._adjustRadiusForTesselation=function(A){return A*Math.cos(Math.PI/16/16)};z._updateElevation=function(A){A=A?A.tile:m.unwrapOr(this._view.basemapTerrain.rootTiles,[null])[0];m.isNone(A)||0!==A.level||(A=this._adjustRadiusForTesselation(d.earth.radius+A.elevationBounds[0]),A!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=A,this._lowerBoundEarthRadius=-1,this._updateVisibleElevationBounds()))};z._updateVisibleElevationBounds=function(){const A=this._adjustRadiusForTesselation(d.earth.radius+
this._view.basemapTerrain.elevationBounds.min);(0>this._lowerBoundEarthRadius||A<this._lowerBoundEarthRadius)&&this._updateRadius(A)};z._updateRadius=function(A){this._lowerBoundEarthRadius=A;r.set(this._radii,A,A+e.atmosphereHeight);this._innerFadeDistance=2*Math.sqrt((2*A-e.innerAtmosphereDepth)*e.innerAtmosphereDepth)};z._update=function(A){m.isNone(A)||(this._cameraHeight=g.length(A.eye),this._cameraHeightSq=this._cameraHeight*this._cameraHeight,this._cAtmosphere=this._cameraHeightSq-this._radii[1]*
this._radii[1],this._heightParameters=f.fromValues(this._cameraHeight,this._cameraHeightSq,this._cAtmosphere,Math.min(1,Math.max(0,(this._cameraHeight-this._radii[0])/e.atmosphereHeight))),g.copy(this._cameraPosition,A.eye),this._altitudeFade=e.computeInnerAltitudeFade(this._cameraHeight-this._lowerBoundEarthRadius),this._hazeStrength=this._darkenHaze?c.lerp(.6,1,c.smoothstep(9500,10500,this._cameraHeight-d.earth.radius)):1)};C.isSupported=function(A){return A.renderContext.rctx.capabilities.depthTexture};
return C}();const u=new w.NoParameters;a.ChapmanAtmosphere=q;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/vec2":function(){define(["exports","./common"],function(a,b){function c(O,Q){O[0]=Q[0];O[1]=Q[1];return O}function m(O,Q,S){O[0]=Q;O[1]=S;return O}function l(O,Q,S){O[0]=Q[0]+S[0];O[1]=Q[1]+S[1];return O}function r(O,Q,S){O[0]=Q[0]-S[0];O[1]=Q[1]-S[1];return O}function n(O,Q,S){O[0]=Q[0]*S[0];O[1]=Q[1]*S[1];return O}function g(O,Q,S){O[0]=
Q[0]/S[0];O[1]=Q[1]/S[1];return O}function k(O,Q){O[0]=Math.ceil(Q[0]);O[1]=Math.ceil(Q[1]);return O}function f(O,Q){O[0]=Math.floor(Q[0]);O[1]=Math.floor(Q[1]);return O}function d(O,Q,S){O[0]=Math.min(Q[0],S[0]);O[1]=Math.min(Q[1],S[1]);return O}function e(O,Q,S){O[0]=Math.max(Q[0],S[0]);O[1]=Math.max(Q[1],S[1]);return O}function h(O,Q){O[0]=Math.round(Q[0]);O[1]=Math.round(Q[1]);return O}function v(O,Q,S){O[0]=Q[0]*S;O[1]=Q[1]*S;return O}function w(O,Q,S,T){O[0]=Q[0]+S[0]*T;O[1]=Q[1]+S[1]*T;return O}
function t(O,Q){const S=Q[0]-O[0];O=Q[1]-O[1];return Math.sqrt(S*S+O*O)}function x(O,Q){const S=Q[0]-O[0];O=Q[1]-O[1];return S*S+O*O}function B(O){const Q=O[0];O=O[1];return Math.sqrt(Q*Q+O*O)}function q(O){const Q=O[0];O=O[1];return Q*Q+O*O}function u(O,Q){O[0]=-Q[0];O[1]=-Q[1];return O}function C(O,Q){O[0]=1/Q[0];O[1]=1/Q[1];return O}function z(O,Q){var S=Q[0];const T=Q[1];S=S*S+T*T;0<S&&(S=1/Math.sqrt(S),O[0]=Q[0]*S,O[1]=Q[1]*S);return O}function A(O,Q){return O[0]*Q[0]+O[1]*Q[1]}function p(O,
Q,S){Q=Q[0]*S[1]-Q[1]*S[0];O[0]=O[1]=0;O[2]=Q;return O}function y(O,Q,S,T){const U=Q[0];Q=Q[1];O[0]=U+T*(S[0]-U);O[1]=Q+T*(S[1]-Q);return O}function D(O,Q){Q=Q||1;const S=2*b.RANDOM()*Math.PI;O[0]=Math.cos(S)*Q;O[1]=Math.sin(S)*Q;return O}function E(O,Q,S){const T=Q[0];Q=Q[1];O[0]=S[0]*T+S[2]*Q;O[1]=S[1]*T+S[3]*Q;return O}function F(O,Q,S){const T=Q[0];Q=Q[1];O[0]=S[0]*T+S[2]*Q+S[4];O[1]=S[1]*T+S[3]*Q+S[5];return O}function G(O,Q,S){const T=Q[0];Q=Q[1];O[0]=S[0]*T+S[3]*Q+S[6];O[1]=S[1]*T+S[4]*Q+S[7];
return O}function P(O,Q,S){const T=Q[0];Q=Q[1];O[0]=S[0]*T+S[4]*Q+S[12];O[1]=S[1]*T+S[5]*Q+S[13];return O}function K(O,Q,S,T){const U=Q[0]-S[0];Q=Q[1]-S[1];const aa=Math.sin(T);T=Math.cos(T);O[0]=U*T-Q*aa+S[0];O[1]=U*aa+Q*T+S[1];return O}function N(O,Q){var S=O[0];O=O[1];const T=Q[0];Q=Q[1];let U=S*S+O*O;0<U&&(U=1/Math.sqrt(U));let aa=T*T+Q*Q;0<aa&&(aa=1/Math.sqrt(aa));S=(S*T+O*Q)*U*aa;return 1<S?0:-1>S?Math.PI:Math.acos(S)}function M(O){return"vec2("+O[0]+", "+O[1]+")"}function L(O,Q){return O[0]===
Q[0]&&O[1]===Q[1]}function J(O,Q){const S=O[0];O=O[1];const T=Q[0];Q=Q[1];return Math.abs(S-T)<=b.EPSILON*Math.max(1,Math.abs(S),Math.abs(T))&&Math.abs(O-Q)<=b.EPSILON*Math.max(1,Math.abs(O),Math.abs(Q))}function H(O,Q,S,T,U){let aa=Q[0]-S[0];S=Q[1]-S[1];U=(T[0]*aa+T[1]*S)*(U-1);aa=T[0]*U;S=T[1]*U;O[0]=Q[0]+aa;O[1]=Q[1]+S;return O}const I=Object.freeze(Object.defineProperty({__proto__:null,copy:c,set:m,add:l,subtract:r,multiply:n,divide:g,ceil:k,floor:f,min:d,max:e,round:h,scale:v,scaleAndAdd:w,distance:t,
squaredDistance:x,length:B,squaredLength:q,negate:u,inverse:C,normalize:z,dot:A,cross:p,lerp:y,random:D,transformMat2:E,transformMat2d:F,transformMat3:G,transformMat4:P,rotate:K,angle:N,str:M,exactEquals:L,equals:J,projectAndScale:H,len:B,sub:r,mul:n,div:g,dist:t,sqrDist:x,sqrLen:q},Symbol.toStringTag,{value:"Module"}));a.add=l;a.angle=N;a.ceil=k;a.copy=c;a.cross=p;a.dist=t;a.distance=t;a.div=g;a.divide=g;a.dot=A;a.equals=J;a.exactEquals=L;a.floor=f;a.inverse=C;a.len=B;a.length=B;a.lerp=y;a.max=e;
a.min=d;a.mul=n;a.multiply=n;a.negate=u;a.normalize=z;a.projectAndScale=H;a.random=D;a.rotate=K;a.round=h;a.scale=v;a.scaleAndAdd=w;a.set=m;a.sqrDist=x;a.sqrLen=q;a.squaredDistance=x;a.squaredLength=q;a.str=M;a.sub=r;a.subtract=r;a.transformMat2=E;a.transformMat2d=F;a.transformMat3=G;a.transformMat4=P;a.vec2=I})},"esri/views/3d/environment/atmosphereUtils":function(){define(["exports","../../../chunks/vec3f64"],function(a,b){const c=b.fromValues(5.802E-6,1.3558E-5,3.31E-5);b=b.fromValues(1.95E-6,
5.643E-6,2.55E-7);a.atmosphereHeight=1E5;a.betaMie=3.996E-6;a.betaOzone=b;a.betaRayleigh=c;a.computeInnerAltitudeFade=function(m){return Math.min(1,Math.max(0,(m-1E5)/9E5))};a.innerAtmosphereDepth=1E4;a.rayLeighScaleHeight=.085;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/ChapmanAtmosphereTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/ChapmanAtmosphere.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f){r=function(d){function e(){return d.apply(this,arguments)||this}c._inheritsLoose(e,d);var h=e.prototype;h.initializeProgram=function(v){const w=e.shader.get().build(this.configuration);return new g.Program(v.rctx,w,n.Default3D)};h.initializePipeline=function(){return this.configuration.haze?f.makePipelineState({blending:f.separateBlendingParams(k.BlendFactor.ONE,k.BlendFactor.ZERO,k.BlendFactor.ONE_MINUS_SRC_COLOR,k.BlendFactor.ONE),colorWrite:f.defaultColorWriteParams}):
f.makePipelineState({blending:f.separateBlendingParams(k.BlendFactor.SRC_ALPHA,k.BlendFactor.ONE,k.BlendFactor.ONE_MINUS_SRC_ALPHA,k.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:k.CompareFunction.LEQUAL},colorWrite:f.defaultColorWriteParams})};return e}(r.ShaderTechnique);r.shader=new l.ReloadableShaderModule(m.ChapmanAtmosphereShader,()=>new Promise((d,e)=>a(["./ChapmanAtmosphere.glsl"],d,e)));b.ChapmanAtmosphereTechnique=r;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/chunks/ChapmanAtmosphere.glsl":function(){define("exports ./mat4 ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float2Uniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3Uniform ../views/3d/webgl-engine/core/shaderModules/Float4Uniform ../views/3d/webgl-engine/core/shaderModules/FloatUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x){function B(u){const C=new w.ShaderBuilder;C.attributes.add(x.VertexAttribute.POSITION,"vec2");C.include(m.TextureCoordinateAttribute,{textureCoordinateType:m.TextureCoordinateAttributeType.Default});C.varyings.add("worldRay","vec3");C.varyings.add("eyeDir","vec3");const {vertex:z,fragment:A}=C;z.uniforms.add([new v.Matrix4PassUniform("inverseProjectionMatrix",(p,y)=>y.camera.inverseProjectionMatrix),new v.Matrix4PassUniform("inverseViewMatrix",(p,y)=>b.invert(q,
y.camera.viewMatrix))]);z.code.add(h.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`);A.uniforms.add([new k.Float3PassUniform("lightingMainDirection",(p,y)=>y.lighting.lightingMainDirection),new g.Float2Uniform("radii"),new e.FloatUniform("scaleHeight"),new f.Float3Uniform("cameraPosition"),new d.Float4Uniform("heightParameters"),new e.FloatUniform("innerFadeDistance"),new e.FloatUniform("altitudeFade"),new t.Texture2DUniform("depthTex"),new f.Float3Uniform("betaRayleigh"),new f.Float3Uniform("betaCombined"),new e.FloatUniform("betaMie"),new e.FloatUniform("hazeStrength")]);C.include(r.Gamma);
u.haze&&(A.include(l.ReadLinearDepth),A.uniforms.add(new n.Float2PassUniform("nearFar",(p,y)=>y.camera.nearFar)));A.code.add(h.glsl`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`);A.code.add(h.glsl`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`);A.code.add(h.glsl`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`);A.code.add(h.glsl`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${u.haze?h.glsl`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${u.haze?h.glsl``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${u.haze?"":h.glsl`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.05968310365 * mumu;

      ${u.haze?h.glsl`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:h.glsl`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.11936620731 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${u.haze?h.glsl`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:h.glsl`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${u.haze?h.glsl`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:h.glsl`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${u.haze?"":h.glsl`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, lightingMainDirection, gl_FragColor);
          }`}
    }
  `);return C}const q=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:B},Symbol.toStringTag,{value:"Module"}));a.ChapmanAtmosphereShader=c;a.build=B})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c,m){a.TextureCoordinateAttributeType=void 0;(function(l){l[l.None=0]="None";l[l.Default=
1]="Default";l[l.Atlas=2]="Atlas";l[l.COUNT=3]="COUNT"})(a.TextureCoordinateAttributeType||(a.TextureCoordinateAttributeType={}));a.TextureCoordinateAttribute=function(l,r){switch(r.textureCoordinateType){case a.TextureCoordinateAttributeType.Default:l.attributes.add(m.VertexAttribute.UV0,"vec2");l.varyings.add("vuv0","vec2");l.vertex.code.add(c.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);break;case a.TextureCoordinateAttributeType.Atlas:l.attributes.add(m.VertexAttribute.UV0,"vec2");l.varyings.add("vuv0","vec2");l.attributes.add(m.VertexAttribute.UVREGION,"vec4");l.varyings.add("vuvRegion","vec4");l.vertex.code.add(c.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);break;case a.TextureCoordinateAttributeType.None:l.vertex.code.add(c.glsl`void forwardTextureCoordinates() {}`);break;default:b.neverReached(r.textureCoordinateType);case a.TextureCoordinateAttributeType.COUNT:}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/interfaces":function(){define(["exports"],function(a){function b(c,...m){let l="";for(let r=0;r<m.length;r++)l+=c[r]+m[r];return l+=c[c.length-1]}
(function(c){c.int=function(m){return Math.round(m).toString()};c.float=function(m){return m.toPrecision(8)}})(b||(b={}));a.NoParameters=function(){};a.glsl=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/VertexAttribute":function(){define(["exports"],function(a){a.VertexAttribute=void 0;var b=a.VertexAttribute||(a.VertexAttribute={});b.POSITION="position";b.NORMAL="normal";b.UV0="uv0";b.AUXPOS1="auxpos1";b.AUXPOS2="auxpos2";
b.MAPPOS="mapPos";b.COLOR="color";b.SYMBOLCOLOR="symbolColor";b.SIZE="size";b.TANGENT="tangent";b.OFFSET="offset";b.SUBDIVISIONFACTOR="subdivisionFactor";b.COLORFEATUREATTRIBUTE="colorFeatureAttribute";b.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute";b.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute";b.DISTANCETOSTART="distanceToStart";b.UVMAPSPACE="uvMapSpace";b.BOUNDINGRECT="boundingRect";b.UVREGION="uvRegion";b.NORMALCOMPRESSED="normalCompressed";b.PROFILERIGHT="profileRight";b.PROFILEUP="profileUp";
b.PROFILEVERTEXANDNORMAL="profileVertexAndNormal";b.FEATUREVALUE="featureValue";b.MODELORIGINHI="modelOriginHi";b.MODELORIGINLO="modelOriginLo";b.MODEL="model";b.MODELNORMAL="modelNormal";b.INSTANCECOLOR="instanceColor";b.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute";b.LOCALTRANSFORM="localTransform";b.GLOBALTRANSFORM="globalTransform";b.BOUNDINGSPHERE="boundingSphere";b.MODELORIGIN="modelOrigin";b.MODELSCALEFACTORS="modelScaleFactors";b.FEATUREATTRIBUTE="featureAttribute";b.STATE="state";b.LODLEVEL=
"lodLevel";b.POSITION0="position0";b.POSITION1="position1";b.NORMALA="normalA";b.NORMALB="normalB";b.COMPONENTINDEX="componentIndex";b.VARIANTOFFSET="variantOffset";b.VARIANTSTROKE="variantStroke";b.VARIANTEXTENSION="variantExtension";b.U8PADDING="u8padding";b.U16PADDING="u16padding";b.SIDENESS="sideness";b.START="start";b.END="end";b.UP="up";b.EXTRUDE="extrude";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl":function(){define(["exports",
"../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,b,c){a.ReadLinearDepth=function(m){m.include(b.RgbaFloatEncoding);m.code.add(c.glsl`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.RgbaFloatEncoding=function(c){c.code.add(b.glsl`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.Gamma=function(c){c.fragment.code.add(b.glsl`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Float2PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,m){c=function(l){function r(n,g){return l.call(this,n,"vec2",m.BindType.Pass,(k,f,d)=>k.setUniform2fv(n,g(f,d)))||this}b._inheritsLoose(r,l);return r}(c.Uniform);a.Float2PassUniform=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Uniform":function(){define(["exports","../../../../../core/maybe","../shaderTechnique/BindType"],function(a,b,c){let m=function(){function l(r,n,g,k,f=null){this.name=r;this.type=n;this.arraySize=f;this.bind={[c.BindType.Pass]:null,[c.BindType.Draw]:null};b.isSome(g)&&b.isSome(k)&&(this.bind[g]=k)}l.prototype.equals=function(r){return this.type===r.type&&this.name===r.name&&this.arraySize===
r.arraySize};return l}();a.Uniform=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderTechnique/BindType":function(){define(["exports"],function(a){a.BindType=void 0;var b=a.BindType||(a.BindType={});b[b.Pass=0]="Pass";b[b.Draw=1]="Draw";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Float2Uniform":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","./Uniform"],function(a,b,c){c=function(m){function l(r){return m.call(this,r,"vec2")||this}b._inheritsLoose(l,m);return l}(c.Uniform);a.Float2Uniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Float3PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,m){c=
function(l){function r(n,g){return l.call(this,n,"vec3",m.BindType.Pass,(k,f,d)=>k.setUniform3fv(n,g(f,d)))||this}b._inheritsLoose(r,l);return r}(c.Uniform);a.Float3PassUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Float3Uniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform"],function(a,b,c){c=function(m){function l(r){return m.call(this,r,"vec3")||this}
b._inheritsLoose(l,m);return l}(c.Uniform);a.Float3Uniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4Uniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform"],function(a,b,c){c=function(m){function l(r){return m.call(this,r,"vec4")||this}b._inheritsLoose(l,m);return l}(c.Uniform);a.Float4Uniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/core/shaderModules/FloatUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform"],function(a,b,c){c=function(m){function l(r){return m.call(this,r,"float")||this}b._inheritsLoose(l,m);return l}(c.Uniform);a.FloatUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers",
"./Uniform","../shaderTechnique/BindType"],function(a,b,c,m){c=function(l){function r(n,g){return l.call(this,n,"mat4",m.BindType.Pass,(k,f,d)=>k.setUniformMatrix4fv(n,g(f,d)))||this}b._inheritsLoose(r,l);return r}(c.Uniform);a.Matrix4PassUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/ShaderBuilder":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/Error",
"../../../../../core/Logger","../../../../../core/maybe"],function(a,b,c,m,l){const r=m.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");m=function(){function w(){this.includedModules=new Map}w.prototype.include=function(t,x){if(this.includedModules.has(t)){const B=this.includedModules.get(t);if(B!==x){r.error("Trying to include shader module multiple times with different sets of options.");x=new Set;for(const q of Object.keys(B))B[q]!==t[q]&&x.add(q);for(const q of Object.keys(t))B[q]!==
t[q]&&x.add(q);x.forEach(q=>console.error(`  ${q}: current ${B[q]} new ${t[q]}`))}}else this.includedModules.set(t,x),t(this.builder,x)};return w}();let n=function(w){function t(){var B=w.apply(this,arguments)||this;B.vertex=new f;B.fragment=new f;B.attributes=new d;B.varyings=new e;B.extensions=new h;B.constants=new v;return B}b._inheritsLoose(t,w);var x=t.prototype;x.generate=function(B){const q=this.extensions.generateSource(B),u=this.attributes.generateSource(B),C=this.varyings.generateSource();
var z="vertex"===B?this.vertex:this.fragment;const A=z.uniforms.generateSource(),p=z.code.generateSource();B="vertex"===B?"precision highp float;\nprecision highp sampler2D;":"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif";z=this.constants.generateSource().concat(z.constants.generateSource());return`\n${q.join("\n")}\n\n${B}\n\n${z.join("\n")}\n\n${A.join("\n")}\n\n${u.join("\n")}\n\n${C.join("\n")}\n\n${p.join("\n")}`};
x.generateBind=function(B,q){const u=new Map;this.vertex.uniforms.entries.forEach(A=>{const p=A.bind[B];l.isSome(p)&&u.set(A.name,p)});this.fragment.uniforms.entries.forEach(A=>{const p=A.bind[B];l.isSome(p)&&u.set(A.name,p)});const C=Array.from(u.values()),z=C.length;return(A,p)=>{for(let y=0;y<z;++y)C[y](q,A,p)}};b._createClass(t,[{key:"fragmentUniforms",get:function(){return this.fragment.uniforms.entries}},{key:"builder",get:function(){return this}}]);return t}(m),g=function(){function w(){this._entries=
new Map}var t=w.prototype;t.add=function(x){if(!Array.isArray(x))return this._add(x);for(const B of x)this._add(B)};t._add=function(x){if(this._entries.has(x.name)&&!this._entries.get(x.name).equals(x))throw new c(`Duplicate uniform name ${x.name} for different uniform type`);this._entries.set(x.name,x)};t.generateSource=function(){return Array.from(this._entries.values()).map(x=>l.isSome(x.arraySize)?`uniform ${x.type} ${x.name}[${x.arraySize}];`:`uniform ${x.type} ${x.name};`)};b._createClass(w,
[{key:"entries",get:function(){return Array.from(this._entries.values())}}]);return w}(),k=function(){function w(){this._entries=[]}var t=w.prototype;t.add=function(x){this._entries.push(x)};t.generateSource=function(){return this._entries};return w}(),f=function(w){function t(){var x=w.apply(this,arguments)||this;x.uniforms=new g;x.code=new k;x.constants=new v;return x}b._inheritsLoose(t,w);b._createClass(t,[{key:"builder",get:function(){return this}}]);return t}(m),d=function(){function w(){this._entries=
[]}var t=w.prototype;t.add=function(x,B){this._entries.push([x,B])};t.generateSource=function(x){return"fragment"===x?[]:this._entries.map(B=>`attribute ${B[1]} ${B[0]};`)};return w}(),e=function(){function w(){this._entries=[]}var t=w.prototype;t.add=function(x,B){this._entries.push([x,B])};t.generateSource=function(){return this._entries.map(x=>`varying ${x[1]} ${x[0]};`)};return w}(),h=function(){function w(){this._entries=new Set}var t=w.prototype;t.add=function(x){this._entries.add(x)};t.generateSource=
function(x){const B="vertex"===x?w.ALLOWLIST_VERTEX:w.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(q=>B.includes(q)).map(q=>`#extension ${q} : enable`)};return w}();h.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"];h.ALLOWLIST_VERTEX=[];let v=function(){function w(){this._entries=new Set}var t=w.prototype;t.add=function(x,B,q){let u="ERROR_CONSTRUCTOR_STRING";switch(B){case "float":u=w._numberToFloatStr(q);break;case "int":u=w._numberToIntStr(q);break;
case "bool":u=q.toString();break;case "vec2":u=`vec2(${w._numberToFloatStr(q[0])},                            ${w._numberToFloatStr(q[1])})`;break;case "vec3":u=`vec3(${w._numberToFloatStr(q[0])},                            ${w._numberToFloatStr(q[1])},                            ${w._numberToFloatStr(q[2])})`;break;case "vec4":u=`vec4(${w._numberToFloatStr(q[0])},                            ${w._numberToFloatStr(q[1])},                            ${w._numberToFloatStr(q[2])},                            ${w._numberToFloatStr(q[3])})`;
break;case "ivec2":u=`ivec2(${w._numberToIntStr(q[0])},                             ${w._numberToIntStr(q[1])})`;break;case "ivec3":u=`ivec3(${w._numberToIntStr(q[0])},                             ${w._numberToIntStr(q[1])},                             ${w._numberToIntStr(q[2])})`;break;case "ivec4":u=`ivec4(${w._numberToIntStr(q[0])},                             ${w._numberToIntStr(q[1])},                             ${w._numberToIntStr(q[2])},                             ${w._numberToIntStr(q[3])})`;
break;case "mat2":case "mat3":case "mat4":u=`${B}(${Array.prototype.map.call(q,C=>w._numberToFloatStr(C)).join(", ")})`}this._entries.add(`const ${B} ${x} = ${u};`);return this};w._numberToIntStr=function(x){return x.toFixed(0)};w._numberToFloatStr=function(x){return Number.isInteger(x)?x.toFixed(1):x.toString()};t.generateSource=function(){return Array.from(this._entries)};return w}();a.Code=k;a.Includes=m;a.ShaderBuilder=n;a.Stage=f;a.Uniforms=g;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform"],function(a,b,c){c=function(m){function l(r){return m.call(this,r,"sampler2D")||this}b._inheritsLoose(l,m);return l}(c.Uniform);a.Texture2DUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function m(r,n){this._module=r;this._loadModule=n}var l=m.prototype;l.get=function(){return this._module};l.reload=function(){var r=b._asyncToGenerator(function*(){return this._module=yield this._loadModule()});return function(){return r.apply(this,arguments)}}();return m}();a.ReloadableShaderModule=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../webgl/enums"],function(a,b,c,m){let l=function(){function r(g,k,f){this.release=f;k&&(this.initializeConfiguration(g,k),this._configuration=k.snapshot());this._program=this.initializeProgram(g);this._pipeline=this.initializePipeline(g.rctx.capabilities)}var n=r.prototype;n.destroy=function(){this._program=c.disposeMaybe(this._program);this._pipeline=this._configuration=null};n.reload=function(g){c.disposeMaybe(this._program);
this._program=this.initializeProgram(g);this._pipeline=this.initializePipeline(g.rctx.capabilities)};n.bindPass=function(g,k){this.program.bindPass(g,k)};n.bindDraw=function(g,k){this.program.bindDraw(g,k);this.program.rebindTextures()};n.bindPipelineState=function(g,k=null,f){g.setPipelineState(this.getPipelineState(k,f))};n.ensureAttributeLocations=function(g){this.program.assertCompatibleVertexAttributeLocations(g)};n.getPipelineState=function(g,k){return this._pipeline};n.initializeConfiguration=
function(g,k){};b._createClass(r,[{key:"program",get:function(){return this._program}},{key:"compiled",get:function(){return this.program.isCompiled}},{key:"key",get:function(){return this._configuration.key}},{key:"configuration",get:function(){return this._configuration}},{key:"primitiveType",get:function(){return m.PrimitiveType.TRIANGLES}}]);return r}();a.ShaderTechnique=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/enums":function(){define(["exports"],
function(a){a.ClearBufferBit=void 0;(function(b){b[b.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT";b[b.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT";b[b.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(a.ClearBufferBit||(a.ClearBufferBit={}));a.PrimitiveType=void 0;(function(b){b[b.POINTS=0]="POINTS";b[b.LINES=1]="LINES";b[b.LINE_LOOP=2]="LINE_LOOP";b[b.LINE_STRIP=3]="LINE_STRIP";b[b.TRIANGLES=4]="TRIANGLES";b[b.TRIANGLE_STRIP=5]="TRIANGLE_STRIP";b[b.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(a.PrimitiveType||(a.PrimitiveType=
{}));a.BlendFactor=void 0;(function(b){b[b.ZERO=0]="ZERO";b[b.ONE=1]="ONE";b[b.SRC_COLOR=768]="SRC_COLOR";b[b.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR";b[b.SRC_ALPHA=770]="SRC_ALPHA";b[b.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA";b[b.DST_ALPHA=772]="DST_ALPHA";b[b.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA";b[b.DST_COLOR=774]="DST_COLOR";b[b.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR";b[b.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE";b[b.CONSTANT_COLOR=32769]="CONSTANT_COLOR";b[b.ONE_MINUS_CONSTANT_COLOR=
32770]="ONE_MINUS_CONSTANT_COLOR";b[b.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA";b[b.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"})(a.BlendFactor||(a.BlendFactor={}));a.BlendOperation=void 0;(function(b){b[b.ADD=32774]="ADD";b[b.SUBTRACT=32778]="SUBTRACT";b[b.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"})(a.BlendOperation||(a.BlendOperation={}));a.BufferType=void 0;(function(b){b[b.ARRAY_BUFFER=34962]="ARRAY_BUFFER";b[b.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER";b[b.UNIFORM_BUFFER=
35345]="UNIFORM_BUFFER";b[b.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER";b[b.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER";b[b.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER";b[b.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"})(a.BufferType||(a.BufferType={}));a.Face=void 0;(function(b){b[b.FRONT=1028]="FRONT";b[b.BACK=1029]="BACK";b[b.FRONT_AND_BACK=1032]="FRONT_AND_BACK"})(a.Face||(a.Face={}));a.CullMode=void 0;(function(b){b[b.CW=2304]="CW";b[b.CCW=2305]="CCW"})(a.CullMode||(a.CullMode={}));a.DataType=
void 0;(function(b){b[b.BYTE=5120]="BYTE";b[b.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";b[b.SHORT=5122]="SHORT";b[b.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT";b[b.INT=5124]="INT";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.FLOAT=5126]="FLOAT"})(a.DataType||(a.DataType={}));a.CompareFunction=void 0;(function(b){b[b.NEVER=512]="NEVER";b[b.LESS=513]="LESS";b[b.EQUAL=514]="EQUAL";b[b.LEQUAL=515]="LEQUAL";b[b.GREATER=516]="GREATER";b[b.NOTEQUAL=517]="NOTEQUAL";b[b.GEQUAL=518]="GEQUAL";b[b.ALWAYS=519]="ALWAYS"})(a.CompareFunction||
(a.CompareFunction={}));a.StencilOperation=void 0;(function(b){b[b.ZERO=0]="ZERO";b[b.KEEP=7680]="KEEP";b[b.REPLACE=7681]="REPLACE";b[b.INCR=7682]="INCR";b[b.DECR=7683]="DECR";b[b.INVERT=5386]="INVERT";b[b.INCR_WRAP=34055]="INCR_WRAP";b[b.DECR_WRAP=34056]="DECR_WRAP"})(a.StencilOperation||(a.StencilOperation={}));a.TextureSamplingMode=void 0;(function(b){b[b.NEAREST=9728]="NEAREST";b[b.LINEAR=9729]="LINEAR";b[b.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST";b[b.LINEAR_MIPMAP_NEAREST=9985]=
"LINEAR_MIPMAP_NEAREST";b[b.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR";b[b.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"})(a.TextureSamplingMode||(a.TextureSamplingMode={}));a.TextureWrapMode=void 0;(function(b){b[b.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE";b[b.REPEAT=10497]="REPEAT";b[b.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(a.TextureWrapMode||(a.TextureWrapMode={}));a.TextureType=void 0;(function(b){b[b.TEXTURE_2D=3553]="TEXTURE_2D";b[b.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP";b[b.TEXTURE_3D=
32879]="TEXTURE_3D";b[b.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X";b[b.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X";b[b.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y";b[b.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y";b[b.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z";b[b.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z";b[b.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"})(a.TextureType||(a.TextureType=
{}));a.PixelFormat=void 0;(function(b){b[b.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT";b[b.DEPTH_STENCIL=34041]="DEPTH_STENCIL";b[b.ALPHA=6406]="ALPHA";b[b.RGB=6407]="RGB";b[b.RGBA=6408]="RGBA";b[b.LUMINANCE=6409]="LUMINANCE";b[b.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA";b[b.RED=6403]="RED";b[b.RG=33319]="RG";b[b.RED_INTEGER=36244]="RED_INTEGER";b[b.RG_INTEGER=33320]="RG_INTEGER";b[b.RGB_INTEGER=36248]="RGB_INTEGER";b[b.RGBA_INTEGER=36249]="RGBA_INTEGER"})(a.PixelFormat||(a.PixelFormat={}));a.SizedPixelFormat=
void 0;(function(b){b[b.RGBA4=32854]="RGBA4";b[b.R16F=33325]="R16F";b[b.RG16F=33327]="RG16F";b[b.RGB32F=34837]="RGB32F";b[b.RGBA16F=34842]="RGBA16F";b[b.R32F=33326]="R32F";b[b.RG32F=33328]="RG32F";b[b.RGBA32F=34836]="RGBA32F";b[b.R11F_G11F_B10F=35898]="R11F_G11F_B10F";b[b.RGB8=32849]="RGB8";b[b.RGBA8=32856]="RGBA8";b[b.RGB5_A1=32855]="RGB5_A1";b[b.R8=33321]="R8";b[b.RG8=33323]="RG8";b[b.R8I=33329]="R8I";b[b.R8UI=33330]="R8UI";b[b.R16I=33331]="R16I";b[b.R16UI=33332]="R16UI";b[b.R32I=33333]="R32I";
b[b.R32UI=33334]="R32UI";b[b.RG8I=33335]="RG8I";b[b.RG8UI=33336]="RG8UI";b[b.RG16I=33337]="RG16I";b[b.RG16UI=33338]="RG16UI";b[b.RG32I=33339]="RG32I";b[b.RG32UI=33340]="RG32UI";b[b.RGB16F=34843]="RGB16F";b[b.RGB9_E5=35901]="RGB9_E5";b[b.SRGB8=35905]="SRGB8";b[b.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8";b[b.RGB565=36194]="RGB565";b[b.RGBA32UI=36208]="RGBA32UI";b[b.RGB32UI=36209]="RGB32UI";b[b.RGBA16UI=36214]="RGBA16UI";b[b.RGB16UI=36215]="RGB16UI";b[b.RGBA8UI=36220]="RGBA8UI";b[b.RGB8UI=36221]="RGB8UI";b[b.RGBA32I=
36226]="RGBA32I";b[b.RGB32I=36227]="RGB32I";b[b.RGBA16I=36232]="RGBA16I";b[b.RGB16I=36233]="RGB16I";b[b.RGBA8I=36238]="RGBA8I";b[b.RGB8I=36239]="RGB8I";b[b.R8_SNORM=36756]="R8_SNORM";b[b.RG8_SNORM=36757]="RG8_SNORM";b[b.RGB8_SNORM=36758]="RGB8_SNORM";b[b.RGBA8_SNORM=36759]="RGBA8_SNORM";b[b.RGB10_A2=32857]="RGB10_A2";b[b.RGB10_A2UI=36975]="RGB10_A2UI"})(a.SizedPixelFormat||(a.SizedPixelFormat={}));a.PixelType=void 0;(function(b){b[b.FLOAT=5126]="FLOAT";b[b.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";b[b.UNSIGNED_INT_24_8=
34042]="UNSIGNED_INT_24_8";b[b.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4";b[b.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1";b[b.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5";b[b.BYTE=5120]="BYTE";b[b.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT";b[b.SHORT=5122]="SHORT";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.INT=5124]="INT";b[b.HALF_FLOAT=5131]="HALF_FLOAT";b[b.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV";b[b.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV";
b[b.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV";b[b.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"})(a.PixelType||(a.PixelType={}));a.RenderbufferFormat=void 0;(function(b){b[b.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16";b[b.STENCIL_INDEX8=36168]="STENCIL_INDEX8";b[b.DEPTH_STENCIL=34041]="DEPTH_STENCIL";b[b.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24";b[b.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F";b[b.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8";b[b.DEPTH32F_STENCIL8=
36013]="DEPTH32F_STENCIL8"})(a.RenderbufferFormat||(a.RenderbufferFormat={}));a.Usage=void 0;(function(b){b[b.STATIC_DRAW=35044]="STATIC_DRAW";b[b.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW";b[b.STREAM_DRAW=35040]="STREAM_DRAW";b[b.STATIC_READ=35045]="STATIC_READ";b[b.DYNAMIC_READ=35049]="DYNAMIC_READ";b[b.STREAM_READ=35041]="STREAM_READ";b[b.STATIC_COPY=35046]="STATIC_COPY";b[b.DYNAMIC_COPY=35050]="DYNAMIC_COPY";b[b.STREAM_COPY=35042]="STREAM_COPY"})(a.Usage||(a.Usage={}));a.ShaderType=void 0;(function(b){b[b.FRAGMENT_SHADER=
35632]="FRAGMENT_SHADER";b[b.VERTEX_SHADER=35633]="VERTEX_SHADER"})(a.ShaderType||(a.ShaderType={}));a.FramebufferTarget=void 0;(function(b){b[b.FRAMEBUFFER=36160]="FRAMEBUFFER";b[b.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER";b[b.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"})(a.FramebufferTarget||(a.FramebufferTarget={}));a.TargetType=void 0;(function(b){b[b.TEXTURE=0]="TEXTURE";b[b.RENDER_BUFFER=1]="RENDER_BUFFER";b[b.CUBEMAP=2]="CUBEMAP"})(a.TargetType||(a.TargetType={}));a.DepthStencilTargetType=
void 0;(function(b){b[b.NONE=0]="NONE";b[b.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER";b[b.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER";b[b.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER";b[b.DEPTH_STENCIL_TEXTURE=4]="DEPTH_STENCIL_TEXTURE"})(a.DepthStencilTargetType||(a.DepthStencilTargetType={}));a.ResourceType=void 0;(function(b){b[b.Texture=0]="Texture";b[b.BufferObject=1]="BufferObject";b[b.VertexArrayObject=2]="VertexArrayObject";b[b.Shader=3]="Shader";b[b.Program=4]="Program";
b[b.FramebufferObject=5]="FramebufferObject";b[b.Renderbuffer=6]="Renderbuffer";b[b.Sync=7]="Sync";b[b.COUNT=8]="COUNT"})(a.ResourceType||(a.ResourceType={}));a.ColorAttachment=void 0;(function(b){b[b.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0";b[b.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1";b[b.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2";b[b.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3";b[b.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4";b[b.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5";b[b.COLOR_ATTACHMENT6=
36070]="COLOR_ATTACHMENT6";b[b.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7";b[b.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8";b[b.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9";b[b.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10";b[b.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11";b[b.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12";b[b.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13";b[b.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14";b[b.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"})(a.ColorAttachment||
(a.ColorAttachment={}));a.CompressedTextureFormat=void 0;(function(b){b[b.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT";b[b.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC";b[b.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC";b[b.COMPRESSED_RG11_EAC=37490]=
"COMPRESSED_RG11_EAC";b[b.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC";b[b.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2";b[b.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2";b[b.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2";b[b.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2";b[b.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC";b[b.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]=
"COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(a.CompressedTextureFormat||(a.CompressedTextureFormat={}));a.UniformType=void 0;(function(b){b[b.FLOAT=5126]="FLOAT";b[b.FLOAT_VEC2=35664]="FLOAT_VEC2";b[b.FLOAT_VEC3=35665]="FLOAT_VEC3";b[b.FLOAT_VEC4=35666]="FLOAT_VEC4";b[b.INT=5124]="INT";b[b.INT_VEC2=35667]="INT_VEC2";b[b.INT_VEC3=35668]="INT_VEC3";b[b.INT_VEC4=35669]="INT_VEC4";b[b.BOOL=35670]="BOOL";b[b.BOOL_VEC2=35671]="BOOL_VEC2";b[b.BOOL_VEC3=35672]="BOOL_VEC3";b[b.BOOL_VEC4=35673]="BOOL_VEC4";b[b.FLOAT_MAT2=
35674]="FLOAT_MAT2";b[b.FLOAT_MAT3=35675]="FLOAT_MAT3";b[b.FLOAT_MAT4=35676]="FLOAT_MAT4";b[b.SAMPLER_2D=35678]="SAMPLER_2D";b[b.SAMPLER_CUBE=35680]="SAMPLER_CUBE";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2";b[b.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3";b[b.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4";b[b.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3";b[b.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4";b[b.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2";b[b.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4";
b[b.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2";b[b.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3";b[b.SAMPLER_3D=35679]="SAMPLER_3D";b[b.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW";b[b.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY";b[b.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW";b[b.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW";b[b.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D";b[b.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D";b[b.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE";b[b.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY";
b[b.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D";b[b.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D";b[b.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE";b[b.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"})(a.UniformType||(a.UniformType={}));a.SyncParameter=void 0;(function(b){b[b.OBJECT_TYPE=37138]="OBJECT_TYPE";b[b.SYNC_CONDITION=37139]="SYNC_CONDITION";b[b.SYNC_STATUS=37140]="SYNC_STATUS";b[b.SYNC_FLAGS=37141]="SYNC_FLAGS"})(a.SyncParameter||
(a.SyncParameter={}));a.SyncStatus=void 0;(function(b){b[b.UNSIGNALED=37144]="UNSIGNALED";b[b.SIGNALED=37145]="SIGNALED"})(a.SyncStatus||(a.SyncStatus={}));a.ClientWaitSyncStatus=void 0;(function(b){b[b.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED";b[b.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED";b[b.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED";b[b.WAIT_FAILED=37149]="WAIT_FAILED"})(a.ClientWaitSyncStatus||(a.ClientWaitSyncStatus={}));a.SyncCondition=void 0;(function(b){b[b.SYNC_GPU_COMMANDS_COMPLETE=
37143]="SYNC_GPU_COMMANDS_COMPLETE"})(a.SyncCondition||(a.SyncCondition={}));a.SyncFlag=void 0;(function(b){b[b.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"})(a.SyncFlag||(a.SyncFlag={}));a.BASE_TEXTURE_UNIT=33984;a.DepthStencilAttachment=33306;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["exports","./VertexAttribute"],function(a,b){b=new Map([[b.VertexAttribute.POSITION,
0],[b.VertexAttribute.NORMAL,1],[b.VertexAttribute.UV0,2],[b.VertexAttribute.COLOR,3],[b.VertexAttribute.SIZE,4],[b.VertexAttribute.TANGENT,4],[b.VertexAttribute.AUXPOS1,5],[b.VertexAttribute.SYMBOLCOLOR,5],[b.VertexAttribute.AUXPOS2,6],[b.VertexAttribute.FEATUREATTRIBUTE,6],[b.VertexAttribute.INSTANCEFEATUREATTRIBUTE,6],[b.VertexAttribute.INSTANCECOLOR,7],[b.VertexAttribute.MODEL,8],[b.VertexAttribute.MODELNORMAL,12],[b.VertexAttribute.MODELORIGINHI,11],[b.VertexAttribute.MODELORIGINLO,15]]);a.Default3D=
b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Program":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../core/shaderTechnique/BindType ../../../webgl/checkWebGLError".split(" "),function(a,b,c,m,l,r){let n=function(){function g(f,d,e){this._context=f;this._locations=e;this._textures=new Map;this._freeTextureUnits=new m({deallocator:null});this._glProgram=
f.programCache.acquire(d.generate("vertex"),d.generate("fragment"),e);this._glProgram.stop=()=>{throw Error("Wrapped _glProgram used directly");};this.bindPass=d.generateBind(l.BindType.Pass,this);this.bindDraw=d.generateBind(l.BindType.Draw,this);this._fragmentUniforms=r.webglDebugEnabled()?d.fragmentUniforms:null}var k=g.prototype;k.dispose=function(){this._glProgram.dispose()};k.setUniform1b=function(f,d){this._glProgram.setUniform1i(f,d?1:0)};k.setUniform1i=function(f,d){this._glProgram.setUniform1i(f,
d)};k.setUniform1f=function(f,d){this._glProgram.setUniform1f(f,d)};k.setUniform2f=function(f,d,e){this._glProgram.setUniform2f(f,d,e)};k.setUniform2fv=function(f,d){this._glProgram.setUniform2fv(f,d)};k.setUniform3f=function(f,d,e,h){this._glProgram.setUniform3f(f,d,e,h)};k.setUniform3fv=function(f,d){this._glProgram.setUniform3fv(f,d)};k.setUniform4f=function(f,d,e,h,v){this._glProgram.setUniform4f(f,d,e,h,v)};k.setUniform4fv=function(f,d){this._glProgram.setUniform4fv(f,d)};k.setUniformMatrix3fv=
function(f,d){this._glProgram.setUniformMatrix3fv(f,d)};k.setUniformMatrix4fv=function(f,d){this._glProgram.setUniformMatrix4fv(f,d)};k.setUniform1fv=function(f,d){this._glProgram.setUniform1fv(f,d)};k.setUniform1iv=function(f,d){this._glProgram.setUniform1iv(f,d)};k.setUniform2iv=function(f,d){this._glProgram.setUniform3iv(f,d)};k.setUniform3iv=function(f,d){this._glProgram.setUniform3iv(f,d)};k.setUniform4iv=function(f,d){this._glProgram.setUniform4iv(f,d)};k.assertCompatibleVertexAttributeLocations=
function(f){f.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")};k.stop=function(){this._textures.clear();this._freeTextureUnits.clear()};k.bindTexture=function(f,d){if(c.isNone(d)||null==d.glName){if(d=this._textures.get(f))this._context.bindTexture(null,d.unit),this._freeTextureUnit(d),this._textures.delete(f);return null}let e=this._textures.get(f);null==e?(e=this._allocTextureUnit(d),this._textures.set(f,e)):e.texture=d;this._context.useProgram(this);this.setUniform1i(f,
e.unit);this._context.bindTexture(d,e.unit);return e.unit};k.rebindTextures=function(){this._context.useProgram(this);this._textures.forEach((f,d)=>{this._context.bindTexture(f.texture,f.unit);this.setUniform1i(d,f.unit)});c.isSome(this._fragmentUniforms)&&this._fragmentUniforms.forEach(f=>{"sampler2D"!==f.type&&"samplerCube"!==f.type||this._textures.has(f.name)||console.error(`Texture sampler ${f.name} has no bound texture`)})};k._allocTextureUnit=function(f){return{texture:f,unit:0===this._freeTextureUnits.length?
this._textures.size:this._freeTextureUnits.pop()}};k._freeTextureUnit=function(f){this._freeTextureUnits.push(f.unit)};b._createClass(g,[{key:"glName",get:function(){return this._glProgram.glName}},{key:"isCompiled",get:function(){return this._glProgram.isCompiled}}]);return g}();a.Program=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/checkWebGLError":function(){define(["exports","../../core/Error","../../core/has","../../core/Logger"],
function(a,b,c,m){function l(g,k){switch(k){case g.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case g.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case g.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case g.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";
case g.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case g.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const r=m.getLogger("esri/views/webgl"),n=!!c("enable-feature:webgl-debug");a.checkWebGLError=function(g){if(n){const k=g.getError();k&&(g=l(g,k),r.error(new b("webgl-error","WebGL error occured",{message:g,stack:Error().stack})))}};a.hasFeatureFlagWebGLDebug=n;a.webglDebugEnabled=function(){return n};a.webglValidateShadersEnabled=
function(){return n};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/renderState":function(){define(["exports","../3d/webgl-engine/lib/basicInterfaces","./enums"],function(a,b,c){function m(M){return p.intern(M)}function l(M){return y.intern(M)}function r(M){return D.intern(M)}function n(M){return E.intern(M)}function g(M){return F.intern(M)}function k(M){return G.intern(M)}function f(M){return P.intern(M)}function d(M){return K.intern(M)}
function e(M){return"["+M.join(",")+"]"}function h(M){return M?e([M.srcRgb,M.srcAlpha,M.dstRgb,M.dstAlpha,M.opRgb,M.opAlpha,M.color.r,M.color.g,M.color.b,M.color.a]):null}function v(M){return M?e([M.face,M.mode]):null}function w(M){return M?e([M.factor,M.units]):null}function t(M){return M?e([M.func]):null}function x(M){return M?e([M.function.func,M.function.ref,M.function.mask,M.operation.fail,M.operation.zFail,M.operation.zPass]):null}function B(M){return M?e([M.zNear,M.zFar]):null}function q(M){return M?
e([M.r,M.g,M.b,M.a]):null}function u(M){return M?e([M.mask]):null}const C={face:c.Face.BACK,mode:c.CullMode.CCW},z={face:c.Face.FRONT,mode:c.CullMode.CCW};var A=function(){function M(L,J){this.makeKey=L;this.makeRef=J;this.interns=new Map}M.prototype.intern=function(L){if(!L)return null;const J=this.makeKey(L),H=this.interns;H.has(J)||H.set(J,this.makeRef(L));return H.get(J)};return M}();const p=new A(h,M=>({__tag:"Blending",...M})),y=new A(v,M=>({__tag:"Culling",...M})),D=new A(w,M=>({__tag:"PolygonOffset",
...M})),E=new A(t,M=>({__tag:"DepthTest",...M})),F=new A(x,M=>({__tag:"StencilTest",...M})),G=new A(B,M=>({__tag:"DepthWrite",...M})),P=new A(q,M=>({__tag:"ColorWrite",...M})),K=new A(u,M=>({__tag:"StencilWrite",...M})),N=new A(function(M){return M?e([h(M.blending),v(M.culling),w(M.polygonOffset),t(M.depthTest),x(M.stencilTest),B(M.depthWrite),q(M.colorWrite),u(M.stencilWrite)]):null},M=>({blending:m(M.blending),culling:l(M.culling),polygonOffset:r(M.polygonOffset),depthTest:n(M.depthTest),stencilTest:g(M.stencilTest),
depthWrite:k(M.depthWrite),colorWrite:f(M.colorWrite),stencilWrite:d(M.stencilWrite)}));A=function(){function M(J){this._stencilWriteInvalid=this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=this._polygonOffsetInvalid=this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=J}var L=M.prototype;L.setPipeline=function(J){if(this._pipelineInvalid||J!==this._pipeline)this._setBlending(J.blending),this._setCulling(J.culling),this._setPolygonOffset(J.polygonOffset),
this._setDepthTest(J.depthTest),this._setStencilTest(J.stencilTest),this._setDepthWrite(J.depthWrite),this._setColorWrite(J.colorWrite),this._setStencilWrite(J.stencilWrite),this._pipeline=J;this._pipelineInvalid=!1};L.invalidateBlending=function(){this._pipelineInvalid=this._blendingInvalid=!0};L.invalidateCulling=function(){this._pipelineInvalid=this._cullingInvalid=!0};L.invalidatePolygonOffset=function(){this._pipelineInvalid=this._polygonOffsetInvalid=!0};L.invalidateDepthTest=function(){this._pipelineInvalid=
this._depthTestInvalid=!0};L.invalidateStencilTest=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};L.invalidateDepthWrite=function(){this._pipelineInvalid=this._depthWriteInvalid=!0};L.invalidateColorWrite=function(){this._pipelineInvalid=this._colorWriteInvalid=!0};L.invalidateStencilWrite=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};L._setBlending=function(J){this._blending=this._setSubState(J,this._blending,this._blendingInvalid,this._stateSetters.setBlending);this._blendingInvalid=
!1};L._setCulling=function(J){this._culling=this._setSubState(J,this._culling,this._cullingInvalid,this._stateSetters.setCulling);this._cullingInvalid=!1};L._setPolygonOffset=function(J){this._polygonOffset=this._setSubState(J,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1};L._setDepthTest=function(J){this._depthTest=this._setSubState(J,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=
!1};L._setStencilTest=function(J){this._stencilTest=this._setSubState(J,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest);this._stencilTestInvalid=!1};L._setDepthWrite=function(J){this._depthWrite=this._setSubState(J,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=!1};L._setColorWrite=function(J){this._colorWrite=this._setSubState(J,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=
!1};L._setStencilWrite=function(J){this._stencilWrite=this._setSubState(J,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite);this._stencilTestInvalid=!1};L._setSubState=function(J,H,I,O){if(I||J!==H)O(J),this._pipelineInvalid=!0;return J};return M}();a.StateTracker=A;a.backFaceCullingParams=C;a.cullingParams=M=>M===b.CullFaceOptions.Back?C:M===b.CullFaceOptions.Front?z:null;a.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0};a.defaultDepthWriteParams={zNear:0,zFar:1};a.frontFaceCullingParams=
z;a.makeBlending=m;a.makeColorWrite=f;a.makeCulling=l;a.makeDepthTest=n;a.makeDepthWrite=k;a.makePipelineState=function(M){return N.intern(M)};a.makePolygonOffset=r;a.makeStencilTest=g;a.makeStencilWrite=d;a.separateBlendingParams=function(M,L,J,H,I=c.BlendOperation.ADD,O=c.BlendOperation.ADD,Q=[0,0,0,0]){return{srcRgb:M,srcAlpha:L,dstRgb:J,dstAlpha:H,opRgb:I,opAlpha:O,color:{r:Q[0],g:Q[1],b:Q[2],a:Q[3]}}};a.simpleBlendingParams=function(M,L,J=c.BlendOperation.ADD,H=[0,0,0,0]){return{srcRgb:M,srcAlpha:M,
dstRgb:L,dstAlpha:L,opRgb:J,opAlpha:J,color:{r:H[0],g:H[1],b:H[2],a:H[3]}}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/basicInterfaces":function(){define(["exports"],function(a){a.CullFaceOptions=void 0;(function(b){b[b.None=0]="None";b[b.Front=1]="Front";b[b.Back=2]="Back";b[b.COUNT=3]="COUNT"})(a.CullFaceOptions||(a.CullFaceOptions={}));a.DepthTestFunction=void 0;(function(b){b[b.Less=0]="Less";b[b.Lequal=1]="Lequal";
b[b.COUNT=2]="COUNT"})(a.DepthTestFunction||(a.DepthTestFunction={}));a.AntiAliasingMode=void 0;(function(b){b[b.NONE=0]="NONE";b[b.SMAA=1]="SMAA"})(a.AntiAliasingMode||(a.AntiAliasingMode={}));a.TransparencyPassType=void 0;(function(b){b[b.Color=0]="Color";b[b.Alpha=1]="Alpha";b[b.FrontFace=2]="FrontFace";b[b.NONE=3]="NONE";b[b.COUNT=4]="COUNT"})(a.TransparencyPassType||(a.TransparencyPassType={}));a.RenderRequestType=void 0;(function(b){b[b.BACKGROUND=0]="BACKGROUND";b[b.UPDATE=1]="UPDATE"})(a.RenderRequestType||
(a.RenderRequestType={}));a.ResourceState=void 0;(function(b){b[b.NOT_LOADED=0]="NOT_LOADED";b[b.LOADING=1]="LOADING";b[b.LOADED=2]="LOADED"})(a.ResourceState||(a.ResourceState={}));a.StencilBits=void 0;(function(b){b[b.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded";b[b.OutlineVisualElementMask=2]="OutlineVisualElementMask"})(a.StencilBits||(a.StencilBits={}));a.UpdatePolicy=void 0;(function(b){b[b.ASYNC=0]="ASYNC";b[b.SYNC=1]="SYNC"})(a.UpdatePolicy||(a.UpdatePolicy={}));a.Object3DState=
void 0;(function(b){b[b.Highlight=0]="Highlight";b[b.MaskOccludee=1]="MaskOccludee";b[b.COUNT=2]="COUNT"})(a.Object3DState||(a.Object3DState={}));a.PrimitiveType=void 0;(function(b){b[b.Triangle=0]="Triangle";b[b.Point=1]="Point";b[b.Line=2]="Line"})(a.PrimitiveType||(a.PrimitiveType={}));a.PowerOfTwoResizeMode=void 0;(function(b){b[b.STRETCH=1]="STRETCH";b[b.PAD=2]="PAD"})(a.PowerOfTwoResizeMode||(a.PowerOfTwoResizeMode={}));a.ValidationState=void 0;(function(b){b[b.CHANGED=0]="CHANGED";b[b.UNCHANGED=
1]="UNCHANGED"})(a.ValidationState||(a.ValidationState={}));a.AlphaDiscardMode=void 0;(function(b){b[b.Blend=0]="Blend";b[b.Opaque=1]="Opaque";b[b.Mask=2]="Mask";b[b.MaskBlend=3]="MaskBlend";b[b.COUNT=4]="COUNT"})(a.AlphaDiscardMode||(a.AlphaDiscardMode={}));a.Decorations=void 0;(function(b){b[b.OFF=0]="OFF";b[b.ON=1]="ON"})(a.Decorations||(a.Decorations={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/ChapmanAtmosphereTechniqueConfiguration":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,m){let l=function(r){function n(){var g=r.apply(this,arguments)||this;g.haze=!1;return g}b._inheritsLoose(n,r);return n}(m.ShaderTechniqueConfiguration);c.__decorate([m.parameter()],l.prototype,"haze",void 0);a.ChapmanAtmosphereTechniqueConfiguration=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function m(){this._key="";this._keyDirty=!1;this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[];this._parameterNames||(this._parameterNames=[])}m.prototype.snapshot=function(){const l=this._parameterNames,r={key:this.key};for(const n of l)r[n]=this[n];return r};b._createClass(m,[{key:"key",
get:function(){this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits));return this._key}}]);return m}();a.ShaderTechniqueConfiguration=c;a.parameter=function(m={}){return(l,r)=>{var n;l._parameterNames=null!=(n=l._parameterNames)?n:[];l._parameterNames.push(r);if(null!=m.constValue)Object.defineProperty(l,r,{get(){return m.constValue}});else{var g;const k=l._parameterNames.length-1;n=Math.ceil(Math.log2(m.count||2));const f=null!=(g=l._parameterBits)?g:
[0];let d=0;for(;16<f[d]+n;)d++,d>=f.length&&f.push(0);l._parameterBits=f;const e=f[d],h=(1<<n)-1<<e;f[d]+=n;Object.defineProperty(l,r,{get(){return this[k]},set(v){if(this[k]!==v&&(this[k]=v,this._keyDirty=!0,this._parameterBits[d]=this._parameterBits[d]&~h|+v<<e&h,"number"!==typeof v&&"boolean"!==typeof v))throw"Configuration value for "+r+" must be boolean or number, got "+typeof v;}})}}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["exports",
"./VertexAttribute","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,b,c,m){const l=[new m.VertexElementDescriptor(b.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,12)],r=[new m.VertexElementDescriptor(b.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,20),new m.VertexElementDescriptor(b.VertexAttribute.UV0,2,c.DataType.FLOAT,12,20)],n=[new m.VertexElementDescriptor(b.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,32),new m.VertexElementDescriptor(b.VertexAttribute.NORMAL,3,
c.DataType.FLOAT,12,32),new m.VertexElementDescriptor(b.VertexAttribute.UV0,2,c.DataType.FLOAT,24,32)],g=[new m.VertexElementDescriptor(b.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,16),new m.VertexElementDescriptor(b.VertexAttribute.COLOR,4,c.DataType.UNSIGNED_BYTE,12,16)],k=[new m.VertexElementDescriptor(b.VertexAttribute.POSITION,2,c.DataType.FLOAT,0,8)];b=[new m.VertexElementDescriptor(b.VertexAttribute.POSITION,2,c.DataType.FLOAT,0,16),new m.VertexElementDescriptor(b.VertexAttribute.UV0,2,
c.DataType.FLOAT,8,16)];a.Pos2=k;a.Pos2Tex=b;a.Pos3=l;a.Pos3Col=g;a.Pos3NormalTex=n;a.Pos3Tex=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/VertexElementDescriptor":function(){define(["exports"],function(a){a.VertexElementDescriptor=function(b,c,m,l,r,n=!1,g=0){this.name=b;this.count=c;this.type=m;this.offset=l;this.stride=r;this.normalized=n;this.divisor=g};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),function(a,b,c,m,l,r,n){a.createColorTexture=function(g,k,f=4){const d=new Uint8Array(f*f*4);for(let e=0;e<d.length;e+=4)d[e+0]=255*k[0],d[e+1]=255*k[1],d[e+2]=255*k[2],d[e+3]=255*k[3];return new r.Texture(g,{target:l.TextureType.TEXTURE_2D,pixelFormat:l.PixelFormat.RGBA,
dataType:l.PixelType.UNSIGNED_BYTE,samplingMode:l.TextureSamplingMode.NEAREST,width:f,height:f},d)};a.createEmptyDepthTexture=function(g){return new r.Texture(g,{target:l.TextureType.TEXTURE_2D,pixelFormat:l.PixelFormat.RGBA,dataType:l.PixelType.UNSIGNED_BYTE,samplingMode:l.TextureSamplingMode.NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))};a.createEmptyTexture=function(g,k=4){return new r.Texture(g,{target:l.TextureType.TEXTURE_2D,pixelFormat:l.PixelFormat.RGBA,dataType:l.PixelType.UNSIGNED_BYTE,
samplingMode:l.TextureSamplingMode.NEAREST,width:k,height:k})};a.createQuadVAO=function(g,k=c.Pos2,f=b.Default3D,d=-1,e=1){let h=null;switch(k){case c.Pos2Tex:h=new Float32Array([d,d,0,0,e,d,1,0,d,e,0,1,e,e,1,1]);break;default:h=new Float32Array([d,d,e,d,d,e,e,e])}return new n.VertexArrayObject(g,f,{geometry:k},{geometry:m.BufferObject.createVertex(g,l.Usage.STATIC_DRAW,h)})};a.createScreenSizeTriangleVAO=function(g,k=c.Pos2,f=b.Default3D){const d=new Float32Array([-1,-1,3,-1,-1,3]);return new n.VertexArrayObject(g,
f,{geometry:k},{geometry:m.BufferObject.createVertex(g,l.Usage.STATIC_DRAW,d)})};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/BufferObject":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/arrayUtils ../../core/Logger ../../core/maybe ../../core/typedArrayUtil ./checkWebGLError ./context-util ./enums".split(" "),function(a,b,c,m,l,r,n,g,k){const f=m.getLogger("esri.views.webgl.BufferObject");m=function(){function d(h,
v,w,t){this._context=h;this.bufferType=v;this.usage=w;this._glName=null;this._size=-1;this._indexType=void 0;h.instanceCounter.increment(k.ResourceType.BufferObject,this);this._glName=this._context.gl.createBuffer();n.checkWebGLError(this._context.gl);t&&this.setData(t)}d.createIndex=function(h,v,w){return new d(h,k.BufferType.ELEMENT_ARRAY_BUFFER,v,w)};d.createVertex=function(h,v,w){return new d(h,k.BufferType.ARRAY_BUFFER,v,w)};d.createUniform=function(h,v,w){if(h.type!==g.ContextType.WEBGL2)throw Error("Uniform buffers are supported in WebGL2 only!");
return new d(h,k.BufferType.UNIFORM_BUFFER,v,w)};d.createPixelPack=function(h,v=k.Usage.STREAM_READ,w){if(h.type!==g.ContextType.WEBGL2)throw Error("Pixel pack buffers are supported in WebGL2 only!");h=new d(h,k.BufferType.PIXEL_PACK_BUFFER,v);w&&h.setSize(w);return h};d.createPixelUnpack=function(h,v=k.Usage.STREAM_DRAW,w){if(h.type!==g.ContextType.WEBGL2)throw Error("Pixel unpack buffers are supported in WebGL2 only!");return new d(h,k.BufferType.PIXEL_UNPACK_BUFFER,v,w)};var e=d.prototype;e.dispose=
function(){var h;null!=(h=this._context)&&h.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(k.ResourceType.BufferObject,this),this._context=null):this._glName&&f.warn("Leaked WebGL buffer object")};e.setSize=function(h,v=null){0>=h&&f.error("Buffer size needs to be positive!");if(this.bufferType===k.BufferType.ELEMENT_ARRAY_BUFFER&&l.isSome(v))switch(this._indexType=v,v){case k.DataType.UNSIGNED_SHORT:h*=2;break;case k.DataType.UNSIGNED_INT:h*=
4}this._setBufferData(h)};e.setData=function(h){if(h){var v=h.byteLength;this.bufferType===k.BufferType.ELEMENT_ARRAY_BUFFER&&(r.isUint16Array(h)&&(v/=2,this._indexType=k.DataType.UNSIGNED_SHORT),r.isUint32Array(h)&&(v/=4,this._indexType=k.DataType.UNSIGNED_INT));this._setBufferData(v,h)}};e._setBufferData=function(h,v=null){this._size=h;const w=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);const t=this._context.gl;l.isSome(v)?t.bufferData(this.bufferType,
v,this.usage):t.bufferData(this.bufferType,h,this.usage);n.checkWebGLError(t);this._isVAOAware&&this._context.bindVAO(w)};e.setSubData=function(h,v=0,w=0,t=h.byteLength){if(h){(0>v||v>=this._size)&&f.error("offset is out of range!");var x=v,B=w,q=t,u=h.byteLength;this.bufferType===k.BufferType.ELEMENT_ARRAY_BUFFER&&(r.isUint16Array(h)?(u/=2,x*=2,B*=2,q*=2):r.isUint32Array(h)&&(u/=4,x*=4,B*=4,q*=4));void 0===t&&(t=u-1);w>=t&&f.error("end must be bigger than start!");v+w-t>this._size&&f.error("An attempt to write beyond the end of the buffer!");
v=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);w=this._context.gl;t=ArrayBuffer.isView(h)?h.buffer:h;h=0===B&&q===h.byteLength?t:t.slice(B,q);w.bufferSubData(this.bufferType,x,h);n.checkWebGLError(w);this._isVAOAware&&this._context.bindVAO(v)}};e.setSubDataFromView=function(h,v,w,t){if(h){(0>v||v>=this._size)&&f.error("offset is out of range!");w>=t&&f.error("end must be bigger than start!");v+w-t>this._size&&f.error("An attempt to write beyond the end of the buffer!");
var x=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);var B=this._context.gl;this._context.type===g.ContextType.WEBGL2?B.bufferSubData(this.bufferType,v*h.BYTES_PER_ELEMENT,h,w,t-w):(w=0===w&&t===h.length?h:h.subarray(w,t),B.bufferSubData(this.bufferType,v*h.BYTES_PER_ELEMENT,w));n.checkWebGLError(B);this._isVAOAware&&this._context.bindVAO(x)}};e.getSubData=function(h,v=0,w,t){if(this._context.type!==g.ContextType.WEBGL2)f.error("Get buffer subdata is supported in WebGL2 only!");
else if(0>w||0>t)f.error("Problem getting subdata: offset and length were less than zero!");else{var x=c.isArrayLike(h)?h.BYTES_PER_ELEMENT:1;x*((null!=w?w:0)+(null!=t?t:0))>h.byteLength?f.error("Problem getting subdata: offset and length exceeded destination size!"):(v+x*(null!=t?t:0)>this.byteSize&&f.warn("Potential problem getting subdata: requested data exceeds buffer size!"),x=this._context.gl,this._context.bindBuffer(this,k.BufferType.COPY_READ_BUFFER),x.getBufferSubData(k.BufferType.COPY_READ_BUFFER,
v,h,w,t),this._context.unbindBuffer(k.BufferType.COPY_READ_BUFFER))}};e.getSubDataAsync=function(){var h=b._asyncToGenerator(function*(v,w=0,t,x){this._context.type!==g.ContextType.WEBGL2?f.error("Get buffer subdata is supported in WebGL2 only!"):(yield this._context.clientWaitAsync(),this.getSubData(v,w,t,x))});return function(v){return h.apply(this,arguments)}}();b._createClass(d,[{key:"glName",get:function(){return this._glName}},{key:"size",get:function(){return this._size}},{key:"indexType",
get:function(){return this._indexType}},{key:"byteSize",get:function(){return this.bufferType===k.BufferType.ELEMENT_ARRAY_BUFFER?this._indexType===k.DataType.UNSIGNED_INT?4*this._size:2*this._size:this._size}},{key:"_isVAOAware",get:function(){return this.bufferType===k.BufferType.ELEMENT_ARRAY_BUFFER||this.bufferType===k.BufferType.ARRAY_BUFFER}}]);return d}();a.BufferObject=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/context-util":function(){define(["exports",
"../../core/has","../../core/maybe"],function(a,b,c){function m(g){const k=b("esri-force-webgl");if(k===a.ContextType.WEBGL1||k===a.ContextType.WEBGL2)return[k];switch(g){case "2d":return b("mac")&&b("chrome")?[a.ContextType.WEBGL1,a.ContextType.WEBGL2]:[a.ContextType.WEBGL2,a.ContextType.WEBGL1];case "3d":return[a.ContextType.WEBGL2,a.ContextType.WEBGL1]}}function l(g,k,f={}){if(!window.WebGLRenderingContext)return n(g,'This page requires a browser that supports WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org"\x3eClick here to upgrade your browser.\x3c/a\x3e'),
null;k=r(g,k,f);c.isNone(k)&&n(g,'It doesn\'t appear your computer can support WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org/troubleshooting/"\x3eClick here for more information.\x3c/a\x3e');return k}function r(g,k,f={}){k=k===a.ContextType.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let d=null;for(const e of k){try{d=g.getContext(e,f)}catch(h){}if(d)break}return d}function n(g,k){(g=g.parentNode)&&(g.innerHTML='\x3ctable style\x3d"background-color: #8CE; width: 100%; height: 100%;"\x3e\x3ctr\x3e\x3ctd align\x3d"center"\x3e\x3cdiv style\x3d"display: table-cell; vertical-align: middle;"\x3e\x3cdiv style\x3d""\x3e'+
k+"\x3c/div\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e")}a.ContextType=void 0;(function(g){g[g.WEBGL1=1]="WEBGL1";g[g.WEBGL2=2]="WEBGL2"})(a.ContextType||(a.ContextType={}));a.createContext=r;a.createContextOrErrorHTML=function(g,k,f={}){for(g=m(g);1<g.length;){const d=r(k,g.shift(),f);if(c.isSome(d))return d}return l(k,g.shift(),f)};a.getContextTypes=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/Texture":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/mathUtils ../../core/maybe ./checkWebGLError ./context-util ./enums ./capabilities/isWebGL2Context".split(" "),
function(a,b,c,m,l,r,n,g,k){function f(v){return l.isSome(v)&&"type"in v&&"compressed"===v.type}function d(v){var w;if(w=l.isSome(v)&&!f(v))w=!(l.isSome(v)&&"byteLength"in v);return w}function e(v){return v===g.TextureType.TEXTURE_3D||v===g.TextureType.TEXTURE_2D_ARRAY}function h(v,w,t,x=1){w=Math.max(w,t);v===g.TextureType.TEXTURE_3D&&(w=Math.max(w,x));return Math.round(Math.log(w)/Math.LN2)+1}c=function(){function v(t,x,B=null){this._context=t;this.type="texture";this._glName=null;this._descriptor=
void 0;this._wasImmutablyAllocated=this._wrapModeDirty=this._samplingModeDirty=!1;t.instanceCounter.increment(g.ResourceType.Texture,this);this._descriptor={target:g.TextureType.TEXTURE_2D,samplingMode:g.TextureSamplingMode.LINEAR,wrapMode:g.TextureWrapMode.REPEAT,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1,...x};if(t.type!==n.ContextType.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),e(this._descriptor.target)))throw Error("3D and array textures are not supported in WebGL1");
this._descriptor.target===g.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(B):this.setData(B)}var w=v.prototype;w.dispose=function(){this._context.gl&&this._glName&&(this._context.unbindTexture(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(g.ResourceType.Texture,this))};w.release=function(){this.dispose()};w.resize=function(t,x){const B=this._descriptor;if(B.width!==t||B.height!==x){if(this._wasImmutablyAllocated)throw Error("Immutable textures can't be resized!");
B.width=t;B.height=x;this._descriptor.target===g.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}};w._setDataCubeMap=function(t=null){for(let x=g.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X;x<=g.TextureType.TEXTURE_CUBE_MAP_NEGATIVE_Z;x++)this._setData(t,x)};w.setData=function(t){this._setData(t)};w._setData=function(t,x){var B;if(this._context&&this._context.gl){var q=this._context.gl;this._glName||(this._glName=q.createTexture());void 0===t&&(t=null);var u=this._descriptor;
null!=(B=x)?B:x=u.target;B=e(x);if(null===t&&(u.width=u.width||4,u.height=u.height||4,B)){var C;u.depth=null!=(C=u.depth)?C:1}C=this._context.bindTexture(this,v.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(v.TEXTURE_UNIT_FOR_UPDATES);v._validateTexture(this._context,u);this._configurePixelStorage();var z=u.pixelFormat,A=u.internalFormat?u.internalFormat:this._deriveInternalFormat(z,u.dataType);if(d(t)){z=t.width;let p=t.height;t instanceof HTMLVideoElement&&(z=t.videoWidth,p=t.videoHeight);
u.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(x,A,u.hasMipmap,z,p,1);this._texImage(x,0,A,z,p,1,t);r.checkWebGLError(q);u.hasMipmap&&this.generateMipmap();void 0===u.width&&(u.width=z);void 0===u.height&&(u.height=p);B&&void 0===u.depth&&(u.depth=1)}else{const {width:p,height:y,depth:D}=u;null!=p&&null!=y||console.error("Width and height must be specified!");B&&null==D&&console.error("Depth must be specified!");u.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(x,A,u.hasMipmap,
p,y,D);q.DEPTH24_STENCIL8&&A===q.DEPTH_STENCIL&&(A=q.DEPTH24_STENCIL8);if(f(t)){const E=t.levels;t=h(x,p,y,D);B=Math.min(t-1,E.length-1);k(q)?q.texParameteri(u.target,q.TEXTURE_MAX_LEVEL,B):u.hasMipmap=u.hasMipmap&&t===E.length;const F=A;if(!(F in g.CompressedTextureFormat))throw Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((G,P,K,N)=>{this._compressedTexImage(x,G,F,P,K,N,E[Math.min(G,E.length-1)])},B)}else l.isSome(t)?(this._texImage(x,0,A,p,y,
D,t),r.checkWebGLError(q),u.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((E,F,G,P)=>{this._texImage(x,E,A,F,G,P,null);r.checkWebGLError(q)})}v._applySamplingMode(q,this._descriptor);v._applyWrapMode(q,this._descriptor);v._applyAnisotropicFilteringParameters(this._context,this._descriptor);r.checkWebGLError(q);this._context.bindTexture(C,v.TEXTURE_UNIT_FOR_UPDATES)}};w.updateData=function(t,x,B,q,u,C){C||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");
const z=this._context.gl,A=this._descriptor,{pixelFormat:p,internalFormat:y,dataType:D,isImmutable:E,target:F}=A;if(E&&!this._wasImmutablyAllocated)throw Error("Cannot update immutable texture before allocation!");const G=this._context.bindTexture(this,v.TEXTURE_UNIT_FOR_UPDATES);(0>x||0>B||q>A.width||u>A.height||x+q>A.width||B+u>A.height)&&console.error("An attempt to update out of bounds of the texture!");this._configurePixelStorage();d(C)?z.texSubImage2D(F,t,x,B,p,D,C):f(C)?z.compressedTexSubImage2D(F,
t,x,B,q,u,y,C.levels[t]):z.texSubImage2D(F,t,x,B,q,u,p,D,C);this._context.bindTexture(G,v.TEXTURE_UNIT_FOR_UPDATES)};w.updateData3D=function(t,x,B,q,u,C,z,A){A||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");const p=this._context.gl;if(!k(p))throw Error("3D textures are not supported in WebGL1");const y=this._descriptor,{pixelFormat:D,dataType:E,isImmutable:F,target:G,internalFormat:P}=y;if(F&&!this._wasImmutablyAllocated)throw Error("Cannot update immutable texture before allocation!");
e(G)||console.warn("Attempting to set 3D texture data on a non-3D texture");const K=this._context.bindTexture(this,v.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(v.TEXTURE_UNIT_FOR_UPDATES);(0>x||0>B||0>q||u>y.width||C>y.height||z>y.depth||x+u>y.width||B+C>y.height||q+z>y.depth)&&console.error("An attempt to update out of bounds of the texture!");this._configurePixelStorage();f(A)?(A=A.levels[t],p.compressedTexSubImage3D(G,t,x,B,q,u,C,z,P,A)):p.texSubImage3D(G,t,x,B,q,u,C,z,D,E,A);this._context.bindTexture(K,
v.TEXTURE_UNIT_FOR_UPDATES)};w.generateMipmap=function(){const t=this._descriptor;if(!t.hasMipmap){if(this._wasImmutablyAllocated)throw Error("Cannot add mipmaps to immutable texture after allocation");this._samplingModeDirty=t.hasMipmap=!0;v._validateTexture(this._context,t)}t.samplingMode===g.TextureSamplingMode.LINEAR?(this._samplingModeDirty=!0,t.samplingMode=g.TextureSamplingMode.LINEAR_MIPMAP_NEAREST):t.samplingMode===g.TextureSamplingMode.NEAREST&&(this._samplingModeDirty=!0,t.samplingMode=
g.TextureSamplingMode.NEAREST_MIPMAP_NEAREST);const x=this._context.bindTexture(this,v.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(v.TEXTURE_UNIT_FOR_UPDATES);this._context.gl.generateMipmap(t.target);this._context.bindTexture(x,v.TEXTURE_UNIT_FOR_UPDATES)};w.setSamplingMode=function(t){t!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=t,this._samplingModeDirty=!0)};w.setWrapMode=function(t){t!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=t,v._validateTexture(this._context,
this._descriptor),this._wrapModeDirty=!0)};w.applyChanges=function(){const t=this._context.gl,x=this._descriptor;this._samplingModeDirty&&(v._applySamplingMode(t,x),this._samplingModeDirty=!1);this._wrapModeDirty&&(v._applyWrapMode(t,x),this._wrapModeDirty=!1)};w._deriveInternalFormat=function(t,x){if(this._context.type===n.ContextType.WEBGL1)return t;switch(x){case g.PixelType.FLOAT:switch(t){case g.PixelFormat.RGBA:return g.SizedPixelFormat.RGBA32F;case g.PixelFormat.RGB:return g.SizedPixelFormat.RGB32F;
default:throw Error("Unable to derive format");}case g.PixelType.UNSIGNED_BYTE:switch(t){case g.PixelFormat.RGBA:return g.SizedPixelFormat.RGBA8;case g.PixelFormat.RGB:return g.SizedPixelFormat.RGB8}default:return t}};w._configurePixelStorage=function(){const t=this._context.gl,{unpackAlignment:x,flipped:B,preMultiplyAlpha:q}=this._descriptor;t.pixelStorei(t.UNPACK_ALIGNMENT,x);t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,B?1:0);t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,q?1:0)};w._texStorage=function(t,
x,B,q,u,C){const z=this._context.gl;if(!k(z))throw Error("Immutable textures are not supported in WebGL1");if(!(x in g.SizedPixelFormat))throw Error("Immutable textures must have a sized internal format");this._descriptor.isImmutable&&(B=B?h(t,q,u,C):1,e(t)?z.texStorage3D(t,B,x,q,u,C):z.texStorage2D(t,B,x,q,u),this._wasImmutablyAllocated=!0)};w._texImage=function(t,x,B,q,u,C,z){const A=this._context.gl;let p=null;const y=this._context.type===n.ContextType.WEBGL2,D=e(t),{isImmutable:E,pixelFormat:F,
dataType:G}=this._descriptor;y&&(p=A);!y&&d(z)?A.texImage2D(t,0,B,F,G,z):E?l.isSome(z)&&(D?p.texSubImage3D(t,x,0,0,0,q,u,C,F,G,z):A.texSubImage2D(t,x,0,0,q,u,F,G,z)):(z=l.unwrap(z),D?p.texImage3D(t,x,B,q,u,C,0,F,G,z):A.texImage2D(t,x,B,q,u,0,F,G,z))};w._compressedTexImage=function(t,x,B,q,u,C,z){const A=this._context.gl;let p=null;const y=e(t),D=this._descriptor.isImmutable;if(y){if(this._context.type!==n.ContextType.WEBGL2)throw Error("3D textures are not supported in WebGL1");p=A}D?l.isSome(z)&&
(y?p.compressedTexSubImage3D(t,x,0,0,0,q,u,C,B,z):A.compressedTexSubImage2D(t,x,0,0,q,u,B,z)):y?p.compressedTexImage3D(t,x,B,q,u,C,0,z):A.compressedTexImage2D(t,x,B,q,u,0,z)};w._forEachMipmapLevel=function(t,x=Infinity){let {width:B,height:q,depth:u,hasMipmap:C,target:z}=this._descriptor;const A=z===g.TextureType.TEXTURE_3D;for(let p=0;;++p){t(p,B,q,u);if(!C||1===B&&1===q&&(!A||1===u)||p>=x)break;B=Math.max(1,B>>1);q=Math.max(1,q>>1);A&&(u=Math.max(1,u>>1))}};v._validateTexture=function(t,x){(0>x.width||
0>x.height||0>x.depth)&&console.error("Negative dimension parameters are not allowed!");t=k(t.gl);const B=m.isPowerOfTwo(x.width)&&m.isPowerOfTwo(x.height);t||!x.isImmutable&&!e(x.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!");t||B||("number"===typeof x.wrapMode?x.wrapMode!==g.TextureWrapMode.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):(x.wrapMode.s!==g.TextureWrapMode.CLAMP_TO_EDGE||x.wrapMode.t!==g.TextureWrapMode.CLAMP_TO_EDGE)&&
console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),x.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};v._applySamplingMode=function(t,x){let B=x.samplingMode,q=x.samplingMode;if(B===g.TextureSamplingMode.LINEAR_MIPMAP_NEAREST||B===g.TextureSamplingMode.LINEAR_MIPMAP_LINEAR)B=g.TextureSamplingMode.LINEAR,x.hasMipmap||(q=g.TextureSamplingMode.LINEAR);else if(B===g.TextureSamplingMode.NEAREST_MIPMAP_NEAREST||B===g.TextureSamplingMode.NEAREST_MIPMAP_LINEAR)B=
g.TextureSamplingMode.NEAREST,x.hasMipmap||(q=g.TextureSamplingMode.NEAREST);t.texParameteri(x.target,t.TEXTURE_MAG_FILTER,B);t.texParameteri(x.target,t.TEXTURE_MIN_FILTER,q)};v._applyWrapMode=function(t,x){"number"===typeof x.wrapMode?(t.texParameteri(x.target,t.TEXTURE_WRAP_S,x.wrapMode),t.texParameteri(x.target,t.TEXTURE_WRAP_T,x.wrapMode)):(t.texParameteri(x.target,t.TEXTURE_WRAP_S,x.wrapMode.s),t.texParameteri(x.target,t.TEXTURE_WRAP_T,x.wrapMode.t))};v._applyAnisotropicFilteringParameters=function(t,
x){var B;const q=t.capabilities.textureFilterAnisotropic;q&&t.gl.texParameterf(x.target,q.TEXTURE_MAX_ANISOTROPY,null!=(B=x.maxAnisotropy)?B:1)};b._createClass(v,[{key:"glName",get:function(){return this._glName}},{key:"descriptor",get:function(){return this._descriptor}},{key:"isDirty",get:function(){return this._samplingModeDirty||this._wrapModeDirty}}]);return v}();c.TEXTURE_UNIT_FOR_UPDATES=0;a.Texture=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/webgl/capabilities/isWebGL2Context":function(){define(function(){return function(a){return window.WebGL2RenderingContext&&a instanceof window.WebGL2RenderingContext}})},"esri/views/webgl/VertexArrayObject":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Logger ../../core/maybe ./enums ./Util".split(" "),function(a,b,c,m,l,r){const n=c.getLogger("esri.views.webgl.VertexArrayObject");c=function(){function g(f,d,e,h,v=null){this._context=f;this._locations=d;this._layout=
e;this._buffers=h;this._indexBuffer=v;this._glName=null;this._initialized=!1;f.instanceCounter.increment(l.ResourceType.VertexArrayObject,this)}var k=g.prototype;k.dispose=function(f=!0){if(this._context){if(this._glName){var d,e;const h=null==(d=this._context)?void 0:null==(e=d.capabilities)?void 0:e.vao;h?(h.deleteVertexArray(this._glName),this._glName=null):n.warn("Leaked WebGL VAO")}this._context.getBoundVAO()===this&&this._context.bindVAO(null);if(f){for(const h in this._buffers)this._buffers[h].dispose(),
delete this._buffers[h];this._indexBuffer=m.disposeMaybe(this._indexBuffer)}this._context.instanceCounter.decrement(l.ResourceType.VertexArrayObject,this);this._context=null}else(this._glName||f&&0<Object.getOwnPropertyNames(this._buffers).length)&&n.warn("Leaked WebGL VAO")};k.initialize=function(){if(!this._initialized){var f=this._context.capabilities.vao;if(f){const d=f.createVertexArray();f.bindVertexArray(d);this._bindLayout();f.bindVertexArray(null);this._glName=d}this._initialized=!0}};k.bind=
function(){this.initialize();const f=this._context.capabilities.vao;f?f.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())};k._bindLayout=function(){const {_buffers:f,_layout:d,_indexBuffer:e}=this;f||n.error("Vertex buffer dictionary is empty!");const h=this._context.gl;for(const v in f){const w=f[v];w||n.error("Vertex buffer is uninitialized!");const t=d[v];t||n.error("Vertex element descriptor is empty!");r.bindVertexBufferLayout(this._context,this._locations,w,t)}m.isSome(e)&&
(this._context.capabilities.vao?h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,e.glName):this._context.bindBuffer(e))};k.unbind=function(){this.initialize();const f=this._context.capabilities.vao;f?f.bindVertexArray(null):this._unbindLayout()};k._unbindLayout=function(){const {_buffers:f,_layout:d}=this;f||n.error("Vertex buffer dictionary is empty!");for(const e in f){const h=f[e];h||n.error("Vertex buffer is uninitialized!");r.unbindVertexBufferLayout(this._context,this._locations,h,d[e])}m.isSome(this._indexBuffer)&&
this._context.unbindBuffer(this._indexBuffer.bufferType)};b._createClass(g,[{key:"glName",get:function(){return this._glName}},{key:"context",get:function(){return this._context}},{key:"vertexBuffers",get:function(){return this._buffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"size",get:function(){return Object.keys(this._buffers).reduce((f,d)=>f+this._buffers[d].size,m.isSome(this._indexBuffer)?this._indexBuffer.size:0)}},{key:"layout",get:function(){return this._layout}},
{key:"locations",get:function(){return this._locations}}]);return g}();a.VertexArrayObject=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/Util":function(){define(["exports","../../core/has","../../core/maybe","./enums"],function(a,b,c,m){function l(g){return g[0].stride}function r(g){switch(g){case m.PixelFormat.ALPHA:case m.PixelFormat.LUMINANCE:case m.PixelFormat.RED:case m.PixelFormat.RED_INTEGER:case m.SizedPixelFormat.R8:case m.SizedPixelFormat.R8I:case m.SizedPixelFormat.R8UI:case m.SizedPixelFormat.R8_SNORM:case m.RenderbufferFormat.STENCIL_INDEX8:return 1;
case m.PixelFormat.LUMINANCE_ALPHA:case m.PixelFormat.RG:case m.PixelFormat.RG_INTEGER:case m.SizedPixelFormat.RGBA4:case m.SizedPixelFormat.R16F:case m.SizedPixelFormat.R16I:case m.SizedPixelFormat.R16UI:case m.SizedPixelFormat.RG8:case m.SizedPixelFormat.RG8I:case m.SizedPixelFormat.RG8UI:case m.SizedPixelFormat.RG8_SNORM:case m.SizedPixelFormat.RGB565:case m.SizedPixelFormat.RGB5_A1:case m.RenderbufferFormat.DEPTH_COMPONENT16:return 2;case m.PixelFormat.DEPTH_COMPONENT:case m.PixelFormat.RGB:case m.PixelFormat.RGB_INTEGER:case m.SizedPixelFormat.RGB8:case m.SizedPixelFormat.RGB8I:case m.SizedPixelFormat.RGB8UI:case m.SizedPixelFormat.RGB8_SNORM:case m.SizedPixelFormat.SRGB8:case m.RenderbufferFormat.DEPTH_COMPONENT24:return 3;
case m.PixelFormat.DEPTH_STENCIL:case m.PixelFormat.RGBA:case m.PixelFormat.RGBA_INTEGER:case m.SizedPixelFormat.RGBA8:case m.SizedPixelFormat.R32F:case m.SizedPixelFormat.R11F_G11F_B10F:case m.SizedPixelFormat.RG16F:case m.SizedPixelFormat.R32I:case m.SizedPixelFormat.R32UI:case m.SizedPixelFormat.RG16I:case m.SizedPixelFormat.RG16UI:case m.SizedPixelFormat.RGBA8I:case m.SizedPixelFormat.RGBA8UI:case m.SizedPixelFormat.RGBA8_SNORM:case m.SizedPixelFormat.SRGB8_ALPHA8:case m.SizedPixelFormat.RGB9_E5:case m.SizedPixelFormat.RGB10_A2UI:case m.SizedPixelFormat.RGB10_A2:case m.RenderbufferFormat.DEPTH_STENCIL:case m.RenderbufferFormat.DEPTH_COMPONENT32F:case m.RenderbufferFormat.DEPTH24_STENCIL8:return 4;
case m.RenderbufferFormat.DEPTH32F_STENCIL8:return 5;case m.SizedPixelFormat.RGB16F:case m.SizedPixelFormat.RGB16I:case m.SizedPixelFormat.RGB16UI:return 6;case m.SizedPixelFormat.RG32F:case m.SizedPixelFormat.RG32I:case m.SizedPixelFormat.RG32UI:case m.SizedPixelFormat.RGBA16F:case m.SizedPixelFormat.RGBA16I:case m.SizedPixelFormat.RGBA16UI:return 8;case m.SizedPixelFormat.RGB32F:case m.SizedPixelFormat.RGB32I:case m.SizedPixelFormat.RGB32UI:return 12;case m.SizedPixelFormat.RGBA32F:case m.SizedPixelFormat.RGBA32I:case m.SizedPixelFormat.RGBA32UI:return 16;
case m.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT:case m.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case m.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT:case m.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case m.CompressedTextureFormat.COMPRESSED_R11_EAC:case m.CompressedTextureFormat.COMPRESSED_SIGNED_R11_EAC:case m.CompressedTextureFormat.COMPRESSED_RGB8_ETC2:case m.CompressedTextureFormat.COMPRESSED_SRGB8_ETC2:case m.CompressedTextureFormat.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case m.CompressedTextureFormat.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;
case m.CompressedTextureFormat.COMPRESSED_RG11_EAC:case m.CompressedTextureFormat.COMPRESSED_SIGNED_RG11_EAC:case m.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:case m.CompressedTextureFormat.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function n(g){if(c.isNone(g))return 0;if("descriptor"in g)return g.glName?n(g.descriptor):0;const k=g.internalFormat||"pixelFormat"in g&&g.pixelFormat;if(!k)return 0;const f="hasMipmap"in g&&g.hasMipmap?1.3:1;g=g.width*g.height;return r(k)*g*f}a.bindVertexBufferLayout=
function(g,k,f,d,e=0){const h=g.gl,v=g.capabilities.instancing;g.bindBuffer(f);for(const w of d)if(g=k.get(w.name),void 0===g&&console.error(`There is no location for vertex attribute '${w.name}' defined.`),f=e*w.stride,4>=w.count)h.vertexAttribPointer(g,w.count,w.type,w.normalized,w.stride,w.offset+f),h.enableVertexAttribArray(g),0<w.divisor&&v&&v.vertexAttribDivisor(g,w.divisor);else if(9===w.count)for(d=0;3>d;d++)h.vertexAttribPointer(g+d,3,w.type,w.normalized,w.stride,w.offset+12*d+f),h.enableVertexAttribArray(g+
d),0<w.divisor&&v&&v.vertexAttribDivisor(g+d,w.divisor);else if(16===w.count)for(d=0;4>d;d++)h.vertexAttribPointer(g+d,4,w.type,w.normalized,w.stride,w.offset+16*d+f),h.enableVertexAttribArray(g+d),0<w.divisor&&v&&v.vertexAttribDivisor(g+d,w.divisor);else console.error("Unsupported vertex attribute element count: "+w.count)};a.getBytesPerElementFormat=r;a.getErrorString=function(g){g=g.gl;switch(g.getError()){case g.NO_ERROR:return null;case g.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";
case g.INVALID_VALUE:return"A numeric argument is out of range";case g.INVALID_OPERATION:return"The specified command is not allowed for the current state";case g.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case g.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case g.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"};a.getGpuMemoryUsage=n;a.getStride=l;a.unbindVertexBufferLayout=function(g,k,f,d){const e=
g.gl,h=g.capabilities.instancing;g.bindBuffer(f);for(const v of d)if(f=k.get(v.name),4>=v.count)e.disableVertexAttribArray(f),v.divisor&&0<v.divisor&&h&&h.vertexAttribDivisor(f,0);else if(9===v.count)for(d=0;3>d;d++)e.disableVertexAttribArray(f+d),v.divisor&&0<v.divisor&&h&&h.vertexAttribDivisor(f+d,0);else if(16===v.count)for(d=0;4>d;d++)e.disableVertexAttribArray(f+d),v.divisor&&0<v.divisor&&h&&h.vertexAttribDivisor(f+d,0);else console.error("Unsupported vertex attribute element count: "+v.count);
g.unbindBuffer(m.BufferType.ARRAY_BUFFER)};a.vertexCount=function(g,k){return g.vertexBuffers[k].size/l(g.layout[k])};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/CloudsComposition":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/support/axisAngle ./CloudsCompositionParameters ./CloudsCompositionTechnique ./CloudsData ./weather ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A){a.CloudsComposition=function(G){function P(N){var M=G.call(this,N)||this;M._technique=new B.CloudsCompositionTechnique(N);M._vao=z.createQuadVAO(N.rctx);return M}b._inheritsLoose(P,G);var K=P.prototype;K.destroy=function(){this._technique=r.releaseMaybe(this._technique);this._vao=r.disposeMaybe(this._vao)};K.render=function(N,M){const L=N.bindParameters.clouds;r.isNone(this._vao)||r.isNone(L.data)||(this._technique.compiled?(this._setParallaxParameters(L,
N.bindParameters.camera.eye,M),M=N.rctx.bindTechnique(this._technique,F,N.bindParameters),N.rctx.bindVAO(this._vao),M.assertCompatibleVertexAttributeLocations(this._vao),N.rctx.drawArrays(A.PrimitiveType.TRIANGLE_STRIP,0,4),(L.crossFade.enabled||L.fadeInOut.stage!==x.FadeInOutStages.FINISHED||L.fadeIn.stage!==x.FadeInStages.FINISHED||L.fadeInOutHeight.stage!==x.FadeHeightStages.FINISHED)&&this.requestRender()):this.requestRender())};K._setFadeInStage=function(N,M){const L=performance.now(),J=N.parallax.anchorPointClouds;
N.fadeIn.stage===x.FadeInStages.FINISHED&&(N.fadeIn.factor=1,v.copy(J,D),N.fadeIn.stage=x.FadeInStages.CHANGE_ANCHOR,N.crossFade.enabled=!1,N.fadeInOut.stage=x.FadeInOutStages.FINISHED);M=v.equals(N.cameraPositionLastFrame,M);N.fadeIn.stage===x.FadeInStages.CHANGE_ANCHOR&&M&&q.ensureClouds(N.data)&&(v.copy(J,D),N.fadeIn.stage=x.FadeInStages.FADE_IN,N.startTime=L);0<N.fadeIn.factor&&N.fadeIn.stage===x.FadeInStages.FADE_IN&&(N.fadeIn.factor=1-(L-N.startTime)/500);0>=N.fadeIn.factor&&N.fadeIn.stage===
x.FadeInStages.FADE_IN&&(N.fadeIn.stage=x.FadeInStages.FINISHED,N.fadeIn.factor=0)};K._setCrossFadingStage=function(N){const M=performance.now(),{crossFade:L}=N,J=N.parallax.anchorPointClouds;N.crossFade.enabled||(v.copy(N.parallaxNew.anchorPointClouds,D),N.startTime=M,L.factor=0,N.crossFade.enabled=!0);1>L.factor&&N.crossFade.enabled&&(L.factor=(M-N.startTime)/500);1<=L.factor&&N.crossFade.enabled&&(N.crossFade.enabled=!1,L.factor=1,v.copy(J,N.parallaxNew.anchorPointClouds))};K._setFadeInOutStage=
function(N,M){const L=performance.now(),{fadeInOut:J,crossFade:H}=N;J.stage===x.FadeInOutStages.FINISHED&&(N.startTime=L,J.factor=0,J.stage=x.FadeInOutStages.FADE_OUT);1>J.factor&&J.stage===x.FadeInOutStages.FADE_OUT&&(J.factor=(L-N.startTime)/250);1<=J.factor&&J.stage===x.FadeInOutStages.FADE_OUT&&(J.factor=1,v.copy(N.parallax.anchorPointClouds,D));1<=J.factor&&J.stage===x.FadeInOutStages.FADE_OUT&&v.equals(N.cameraPositionLastFrame,M)&&(J.factor=1,J.stage=x.FadeInOutStages.SWITCH,N.crossFade.enabled=
!1,H.factor=1);q.ensureClouds(N.data)&&J.stage===x.FadeInOutStages.SWITCH&&(N.startTime=L,J.factor=1,J.stage=x.FadeInOutStages.FADE_IN,v.copy(N.parallax.anchorPointClouds,D),N.crossFade.enabled=!1,H.factor=1);0<J.factor&&J.stage===x.FadeInOutStages.FADE_IN&&(J.factor=1-(L-N.startTime)/500);0>=J.factor&&J.stage===x.FadeInOutStages.FADE_IN&&(J.stage=x.FadeInOutStages.FINISHED,J.factor=0)};K._setFadeInOutHeight=function(N,M){const L=performance.now(),J=N.fadeInOutHeight,H=(L-(J.stage===x.FadeHeightStages.FINISHED?
L:N.startTimeHeightFade))/500;J.factor+=M?-H:H;N.startTimeHeightFade=L;J.factor=l.clamp(J.factor,0,1);J.stage=x.FadeHeightStages.HEIGHT_FADE};K._setParallaxParameters=function(N,M,L){var {parallax:J}=N;0>N.fadeInOutHeight.factor&&(N.fadeInOutHeight.factor=v.length(M)-this.planetRadius>u.weatherHeightLimit?1:0);v.normalize(D,M);v.scale(D,D,this.planetRadius);0===J.anchorPointClouds[0]&&0===J.anchorPointClouds[1]&&0===J.anchorPointClouds[2]&&v.copy(J.anchorPointClouds,D);var H=v.length(v.subtract(E,
J.anchorPointClouds,D));let I=!0;H>N.fadeIn.distanceThresholdFactor*J.cloudsHeight||N.fadeIn.stage!==x.FadeInStages.FINISHED?this._setFadeInStage(N,M):H>N.fadeInOut.distanceThresholdFactor*J.cloudsHeight||N.fadeInOut.stage!==x.FadeInOutStages.FINISHED?this._setFadeInOutStage(N,M):H>N.crossFade.distanceThresholdFactor*J.cloudsHeight&&!L||N.crossFade.enabled?this._setCrossFadingStage(N):I=!1;L=v.length(M);H=L-this.planetRadius;(H>1.7*u.weatherHeightLimit||H<-u.weatherHeightLimit)&&1>N.fadeInOutHeight.factor?
N.fadeInOutHeight.factor=1:(H>u.weatherHeightLimit||H<-.35*u.weatherHeightLimit)&&1>N.fadeInOutHeight.factor?this._setFadeInOutHeight(N,!1):H<u.weatherHeightLimit&&H>-.35*u.weatherHeightLimit&&0<N.fadeInOutHeight.factor?this._setFadeInOutHeight(N,!0):N.fadeInOutHeight.stage=x.FadeHeightStages.FINISHED;J.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(L*L-this.planetRadius*this.planetRadius,0))/L;t.fromPoints(p,J.anchorPointClouds,y);J.transform=h.create();e.rotate(J.transform,J.transform,y[3],
t.axis(y));I&&({parallaxNew:J}=N,t.fromPoints(p,J.anchorPointClouds,y),J.transform=h.create(),e.rotate(J.transform,J.transform,y[3],t.axis(y)));v.copy(N.cameraPositionLastFrame,M)};return P}(m);c.__decorate([n.property({constructOnly:!0})],a.CloudsComposition.prototype,"rctx",void 0);c.__decorate([n.property({constructOnly:!0})],a.CloudsComposition.prototype,"viewingMode",void 0);c.__decorate([n.property({constructOnly:!0})],a.CloudsComposition.prototype,"planetRadius",void 0);c.__decorate([n.property({constructOnly:!0})],
a.CloudsComposition.prototype,"requestRender",void 0);a.CloudsComposition=c.__decorate([d.subclass("esri.views.3d.environment.CloudsComposition")],a.CloudsComposition);const p=w.fromValues(0,0,1),y=t.create(),D=w.create(),E=w.create(),F=new C.NoParameters;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/axisAngle":function(){define("exports ../../chunks/quat ../../chunks/quatf64 ../../chunks/vec3 ./vector ./vectorStacks".split(" "),
function(a,b,c,m,l,r){function n(h=f){return[h[0],h[1],h[2],h[3]]}function g(h,v,w,t,x=n()){x[0]=h;x[1]=v;x[2]=w;x[3]=t;return x}function k(h,v){h[3]=v;return h}const f=[0,0,1,0],d=c.create(),e=c.create();a.UP=f;a.angle=function(h){return h[3]};a.axis=function(h){return h};a.compose=function(h,v,w=n()){b.setAxisAngle(d,h,h[3]);b.setAxisAngle(e,v,v[3]);b.multiply(d,e,d);return k(w,b.getAxisAngle(w,d))};a.copy=function(h,v=n()){return g(h[0],h[1],h[2],h[3],v)};a.create=n;a.fromAxisAndAngle=function(h,
v,w=n()){m.copy(w,h);w[3]=v;return w};a.fromPoints=function(h,v,w=n()){m.cross(w,h,v);m.normalize(w,w);w[3]=l.angle(h,v);return w};a.fromValues=g;a.setAngle=k;a.wrap=function(h,v,w,t){return g(h,v,w,t,r.sv4d.get())};a.wrapAxisAngle=function(h,v){return g(h[0],h[1],h[2],v,r.sv4d.get())};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/quat":function(){define("exports ./mat3f64 ./quatf64 ./vec3f64 ./common ./vec3 ./vec4".split(" "),function(a,
b,c,m,l,r,n){function g(U){U[0]=0;U[1]=0;U[2]=0;U[3]=1;return U}function k(U,aa,W){W*=.5;const R=Math.sin(W);U[0]=R*aa[0];U[1]=R*aa[1];U[2]=R*aa[2];U[3]=Math.cos(W);return U}function f(U,aa){const W=2*Math.acos(aa[3]),R=Math.sin(W/2);R>l.EPSILON?(U[0]=aa[0]/R,U[1]=aa[1]/R,U[2]=aa[2]/R):(U[0]=1,U[1]=0,U[2]=0);return W}function d(U,aa,W){const R=aa[0],V=aa[1],da=aa[2];aa=aa[3];const ca=W[0],ha=W[1],ia=W[2];W=W[3];U[0]=R*W+aa*ca+V*ia-da*ha;U[1]=V*W+aa*ha+da*ca-R*ia;U[2]=da*W+aa*ia+R*ha-V*ca;U[3]=aa*
W-R*ca-V*ha-da*ia;return U}function e(U,aa,W){W*=.5;const R=aa[0],V=aa[1],da=aa[2];aa=aa[3];const ca=Math.sin(W);W=Math.cos(W);U[0]=R*W+aa*ca;U[1]=V*W+da*ca;U[2]=da*W-V*ca;U[3]=aa*W-R*ca;return U}function h(U,aa,W){W*=.5;const R=aa[0],V=aa[1],da=aa[2];aa=aa[3];const ca=Math.sin(W);W=Math.cos(W);U[0]=R*W-da*ca;U[1]=V*W+aa*ca;U[2]=da*W+R*ca;U[3]=aa*W-V*ca;return U}function v(U,aa,W){W*=.5;const R=aa[0],V=aa[1],da=aa[2];aa=aa[3];const ca=Math.sin(W);W=Math.cos(W);U[0]=R*W+V*ca;U[1]=V*W-R*ca;U[2]=da*
W+aa*ca;U[3]=aa*W-da*ca;return U}function w(U,aa){const W=aa[0],R=aa[1];aa=aa[2];U[0]=W;U[1]=R;U[2]=aa;U[3]=Math.sqrt(Math.abs(1-W*W-R*R-aa*aa));return U}function t(U,aa,W,R){const V=aa[0],da=aa[1],ca=aa[2];aa=aa[3];let ha=W[0],ia=W[1],ka=W[2];W=W[3];let la;let Y;var ea=V*ha+da*ia+ca*ka+aa*W;0>ea&&(ea=-ea,ha=-ha,ia=-ia,ka=-ka,W=-W);1-ea>l.EPSILON?(la=Math.acos(ea),Y=Math.sin(la),ea=Math.sin((1-R)*la)/Y,R=Math.sin(R*la)/Y):ea=1-R;U[0]=ea*V+R*ha;U[1]=ea*da+R*ia;U[2]=ea*ca+R*ka;U[3]=ea*aa+R*W;return U}
function x(U){var aa=l.RANDOM();const W=l.RANDOM(),R=l.RANDOM(),V=Math.sqrt(1-aa);aa=Math.sqrt(aa);U[0]=V*Math.sin(2*Math.PI*W);U[1]=V*Math.cos(2*Math.PI*W);U[2]=aa*Math.sin(2*Math.PI*R);U[3]=aa*Math.cos(2*Math.PI*R);return U}function B(U,aa){const W=aa[0],R=aa[1],V=aa[2];aa=aa[3];var da=W*W+R*R+V*V+aa*aa;da=da?1/da:0;U[0]=-W*da;U[1]=-R*da;U[2]=-V*da;U[3]=aa*da;return U}function q(U,aa){U[0]=-aa[0];U[1]=-aa[1];U[2]=-aa[2];U[3]=aa[3];return U}function u(U,aa){var W=aa[0]+aa[4]+aa[8];if(0<W)W=Math.sqrt(W+
1),U[3]=.5*W,W=.5/W,U[0]=(aa[5]-aa[7])*W,U[1]=(aa[6]-aa[2])*W,U[2]=(aa[1]-aa[3])*W;else{let R=0;aa[4]>aa[0]&&(R=1);aa[8]>aa[3*R+R]&&(R=2);const V=(R+1)%3,da=(R+2)%3;W=Math.sqrt(aa[3*R+R]-aa[3*V+V]-aa[3*da+da]+1);U[R]=.5*W;W=.5/W;U[3]=(aa[3*V+da]-aa[3*da+V])*W;U[V]=(aa[3*V+R]+aa[3*R+V])*W;U[da]=(aa[3*da+R]+aa[3*R+da])*W}return U}function C(U,aa,W,R){var V=.5*Math.PI/180;aa*=V;W*=V;R*=V;V=Math.sin(aa);aa=Math.cos(aa);const da=Math.sin(W);W=Math.cos(W);const ca=Math.sin(R);R=Math.cos(R);U[0]=V*W*R-aa*
da*ca;U[1]=aa*da*R+V*W*ca;U[2]=aa*W*ca-V*da*R;U[3]=aa*W*R+V*da*ca;return U}function z(U){return"quat("+U[0]+", "+U[1]+", "+U[2]+", "+U[3]+")"}function A(U,aa,W){const R=r.dot(aa,W);if(-.999999>R)return r.cross(H,I,aa),1E-6>r.len(H)&&r.cross(H,O,aa),r.normalize(H,H),k(U,H,Math.PI),U;if(.999999<R)return U[0]=0,U[1]=0,U[2]=0,U[3]=1,U;r.cross(H,aa,W);U[0]=H[0];U[1]=H[1];U[2]=H[2];U[3]=1+R;return L(U,U)}function p(U,aa,W,R,V,da){t(Q,aa,V,da);t(S,W,R,da);t(U,Q,S,2*da*(1-da));return U}function y(U,aa,W,
R){const V=T;V[0]=W[0];V[3]=W[1];V[6]=W[2];V[1]=R[0];V[4]=R[1];V[7]=R[2];V[2]=-aa[0];V[5]=-aa[1];V[8]=-aa[2];return L(U,u(U,V))}const D=n.copy,E=n.set,F=n.add,G=n.scale,P=n.dot,K=n.lerp,N=n.length,M=n.squaredLength,L=n.normalize,J=n.exactEquals;n=n.equals;const H=m.create(),I=m.fromValues(1,0,0),O=m.fromValues(0,1,0),Q=c.create(),S=c.create(),T=b.create();b=Object.freeze(Object.defineProperty({__proto__:null,identity:g,setAxisAngle:k,getAxisAngle:f,multiply:d,rotateX:e,rotateY:h,rotateZ:v,calculateW:w,
slerp:t,random:x,invert:B,conjugate:q,fromMat3:u,fromEuler:C,str:z,copy:D,set:E,add:F,mul:d,scale:G,dot:P,lerp:K,length:N,len:N,squaredLength:M,sqrLen:M,normalize:L,exactEquals:J,equals:n,rotationTo:A,sqlerp:p,setAxes:y},Symbol.toStringTag,{value:"Module"}));a.add=F;a.calculateW=w;a.conjugate=q;a.copy=D;a.dot=P;a.equals=n;a.exactEquals=J;a.fromEuler=C;a.fromMat3=u;a.getAxisAngle=f;a.identity=g;a.invert=B;a.len=N;a.length=N;a.lerp=K;a.mul=d;a.multiply=d;a.normalize=L;a.quat=b;a.random=x;a.rotateX=
e;a.rotateY=h;a.rotateZ=v;a.rotationTo=A;a.scale=G;a.set=E;a.setAxes=y;a.setAxisAngle=k;a.slerp=t;a.sqlerp=p;a.sqrLen=M;a.squaredLength=M;a.str=z})},"esri/views/3d/environment/CloudsCompositionParameters":function(){define(["exports","../../../chunks/mat4f64","../../../chunks/vec3f64"],function(a,b,c){a.FadeInStages=void 0;(function(m){m[m.FINISHED=0]="FINISHED";m[m.CHANGE_ANCHOR=1]="CHANGE_ANCHOR";m[m.FADE_IN=2]="FADE_IN"})(a.FadeInStages||(a.FadeInStages={}));a.FadeInOutStages=void 0;(function(m){m[m.FINISHED=
0]="FINISHED";m[m.FADE_OUT=1]="FADE_OUT";m[m.SWITCH=2]="SWITCH";m[m.FADE_IN=3]="FADE_IN"})(a.FadeInOutStages||(a.FadeInOutStages={}));a.FadeHeightStages=void 0;(function(m){m[m.FINISHED=0]="FINISHED";m[m.HEIGHT_FADE=1]="HEIGHT_FADE"})(a.FadeHeightStages||(a.FadeHeightStages={}));a.CloudsCompositionParameters=function(){this.startTimeHeightFade=this.startTime=0;this.cameraPositionLastFrame=c.create();this.parallax={anchorPointClouds:c.create(),cloudsHeight:1E5,radiusCurvatureCorrectionFactor:0,transform:b.create()};
this.parallaxNew={anchorPointClouds:c.create(),cloudsHeight:1E5,radiusCurvatureCorrectionFactor:0,transform:b.create()};this.crossFade={enabled:!1,factor:0,distanceThresholdFactor:.3};this.fadeInOut={stage:a.FadeInOutStages.FINISHED,factor:0,distanceThresholdFactor:.6};this.fadeIn={stage:a.FadeInStages.FINISHED,factor:0,distanceThresholdFactor:2};this.fadeInOutHeight={stage:a.FadeHeightStages.FINISHED,factor:-1}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/environment/CloudsCompositionTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/CloudsComposition.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),function(a,b,c,m,l,r,n,g,k,f){r=function(d){function e(v){var w;return w=d.call(this,
v,null,()=>w.destroy())||this}c._inheritsLoose(e,d);var h=e.prototype;h.initializeProgram=function(v){const w=e.shader.get().build();return new g.Program(v.rctx,w,n.Default3D)};h.initializePipeline=function(){return f.makePipelineState({blending:f.simpleBlendingParams(k.BlendFactor.ONE,k.BlendFactor.SRC_ALPHA),depthTest:{func:k.CompareFunction.LEQUAL},colorWrite:f.defaultColorWriteParams})};return e}(r.ShaderTechnique);r.shader=new l.ReloadableShaderModule(m.CloudsCompositionShader,()=>new Promise((d,
e)=>a(["./CloudsComposition.glsl"],d,e)));b.CloudsCompositionTechnique=r;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/CloudsComposition.glsl":function(){define("exports ./mat4 ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CloudsParallaxShading.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t){function x(){const q=new w.ShaderBuilder;q.attributes.add(t.VertexAttribute.POSITION,"vec2");q.varyings.add("worldRay","vec3");const {vertex:u,fragment:C}=q;u.uniforms.add([new v.Matrix4PassUniform("inverseProjectionMatrix",(z,A)=>A.camera.inverseProjectionMatrix),new v.Matrix4PassUniform("inverseViewMatrix",(z,A)=>b.invert(B,A.camera.viewMatrix))]);u.code.add(h.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`);C.include(f.ColorConversion);C.include(d.RgbaFloatEncoding);q.include(m.EvaluateAmbientLighting,{pbrMode:n.PBRMode.Disabled,lightingSphericalHarmonicsOrder:2});q.include(g.PiUtils);q.include(l.Gamma);q.include(r.MainLighting,{isGround:!1});q.include(k.CloudsParallaxShading,{instancedDoublePrecision:!1,isGround:!1});C.uniforms.add([new e.Float3PassUniform("cameraPosition",(z,A)=>A.camera.eye)]);C.code.add(h.glsl`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`);return q}const B=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:x},Symbol.toStringTag,{value:"Module"}));a.CloudsCompositionShader=c;a.build=x})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl":function(){define("exports ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ./PhysicallyBasedRenderingParameters.glsl ../../shaderModules/Float3PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),
function(a,b,c,m,l,r,n,g,k){const f=c.create(),d=l.create();a.EvaluateAmbientLighting=function(e,h){e=e.fragment;const v=void 0!==h.lightingSphericalHarmonicsOrder?h.lightingSphericalHarmonicsOrder:2;0===v?(e.uniforms.add(new n.Float3PassUniform("lightingAmbientSH0",(w,t)=>b.set(f,t.lighting.sh.r[0],t.lighting.sh.g[0],t.lighting.sh.b[0]))),e.code.add(k.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===v?(e.uniforms.add([new g.Float4PassUniform("lightingAmbientSH_R",(w,t)=>m.set(d,t.lighting.sh.r[0],t.lighting.sh.r[1],t.lighting.sh.r[2],t.lighting.sh.r[3])),new g.Float4PassUniform("lightingAmbientSH_G",(w,t)=>m.set(d,t.lighting.sh.g[0],t.lighting.sh.g[1],t.lighting.sh.g[2],t.lighting.sh.g[3])),new g.Float4PassUniform("lightingAmbientSH_B",(w,t)=>m.set(d,t.lighting.sh.b[0],t.lighting.sh.b[1],t.lighting.sh.b[2],t.lighting.sh.b[3]))]),e.code.add(k.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===v&&(e.uniforms.add([new n.Float3PassUniform("lightingAmbientSH0",(w,t)=>b.set(f,t.lighting.sh.r[0],t.lighting.sh.g[0],t.lighting.sh.b[0])),new g.Float4PassUniform("lightingAmbientSH_R1",(w,t)=>m.set(d,t.lighting.sh.r[1],t.lighting.sh.r[2],t.lighting.sh.r[3],t.lighting.sh.r[4])),new g.Float4PassUniform("lightingAmbientSH_G1",(w,t)=>m.set(d,t.lighting.sh.g[1],t.lighting.sh.g[2],t.lighting.sh.g[3],t.lighting.sh.g[4])),new g.Float4PassUniform("lightingAmbientSH_B1",(w,t)=>m.set(d,t.lighting.sh.b[1],
t.lighting.sh.b[2],t.lighting.sh.b[3],t.lighting.sh.b[4])),new g.Float4PassUniform("lightingAmbientSH_R2",(w,t)=>m.set(d,t.lighting.sh.r[5],t.lighting.sh.r[6],t.lighting.sh.r[7],t.lighting.sh.r[8])),new g.Float4PassUniform("lightingAmbientSH_G2",(w,t)=>m.set(d,t.lighting.sh.g[5],t.lighting.sh.g[6],t.lighting.sh.g[7],t.lighting.sh.g[8])),new g.Float4PassUniform("lightingAmbientSH_B2",(w,t)=>m.set(d,t.lighting.sh.b[5],t.lighting.sh.b[6],t.lighting.sh.b[7],t.lighting.sh.b[8]))]),e.code.add(k.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),h.pbrMode!==r.PBRMode.Normal&&h.pbrMode!==r.PBRMode.Schematic||e.code.add(k.glsl`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec3f32 ../attributes/VertexTextureCoordinates.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../shaderModules/Texture2DPassUniform ../../shaderTechnique/BindType ../../../lib/GLTextureMaterial".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){c=c.fromValues(0,.6,.2);a.PBRMode=void 0;(function(e){e[e.Disabled=0]="Disabled";e[e.Normal=1]="Normal";e[e.Schematic=2]="Schematic";e[e.Water=3]="Water";e[e.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh";e[e.COUNT=5]="COUNT"})(a.PBRMode||(a.PBRMode={}));d=function(e){function h(){return e.apply(this,arguments)||this}b._inheritsLoose(h,e);return h}(d.GLTextureMaterialBindParameters);a.PBRBindParameters=d;a.PBRSchematicMRRValues=c;a.PhysicallyBasedRenderingParameters=
function(e,h){const v=e.fragment,w=h.hasMetalnessAndRoughnessTexture||h.hasEmissionTexture||h.hasOcclusionTexture;h.pbrMode===a.PBRMode.Normal&&w&&e.include(m.VertexTextureCoordinates,h);if(h.pbrMode===a.PBRMode.Schematic)v.code.add(n.glsl`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`);else if(h.pbrMode===a.PBRMode.Disabled)v.code.add(n.glsl`float getBakedOcclusion() { return 1.0; }`);else if(h.pbrMode===a.PBRMode.Normal){v.code.add(n.glsl`vec3 mrr;
vec3 emission;
float occlusion;`);e=h.supportsTextureAtlas;const t=h.pbrTextureBindType;h.hasMetalnessAndRoughnessTexture&&(v.uniforms.add(t===f.BindType.Pass?k.createTexture2DPassSizeUniforms("texMetallicRoughness",x=>x.textureMetallicRoughness,e):g.createTexture2DDrawSizeUniforms("texMetallicRoughness",x=>x.textureMetallicRoughness,e)),v.code.add(n.glsl`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`));h.hasEmissionTexture&&(v.uniforms.add(t===f.BindType.Pass?k.createTexture2DPassSizeUniforms("texEmission",x=>x.textureEmissive,e):g.createTexture2DDrawSizeUniforms("texEmission",x=>x.textureEmissive,e)),v.code.add(n.glsl`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`));h.hasOcclusionTexture?(v.uniforms.add(t===f.BindType.Pass?k.createTexture2DPassSizeUniforms("texOcclusion",x=>x.textureOcclusion,e):g.createTexture2DDrawSizeUniforms("texOcclusion",x=>x.textureOcclusion,e)),v.code.add(n.glsl`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):v.code.add(n.glsl`float getBakedOcclusion() { return 1.0; }`);v.uniforms.add(t===f.BindType.Pass?[new r.Float3PassUniform("emissionFactor",x=>x.emissiveFactor),new r.Float3PassUniform("mrrFactors",x=>x.mrrFactors)]:[new l.Float3DrawUniform("emissionFactor",x=>x.emissiveFactor),new l.Float3DrawUniform("mrrFactors",x=>x.mrrFactors)]);v.code.add(n.glsl`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${w?"vtc.uv \x3d vuv0;":""}
      ${h.hasMetalnessAndRoughnessTexture?h.supportsTextureAtlas?"vtc.size \x3d texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":""}
      ${h.hasEmissionTexture?h.supportsTextureAtlas?"vtc.size \x3d texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":""}
      ${h.hasOcclusionTexture?h.supportsTextureAtlas?"vtc.size \x3d texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""}
    }
  `)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/vec3f32":function(){define(["exports"],function(a){function b(){return new Float32Array(3)}function c(x){const B=new Float32Array(3);B[0]=x[0];B[1]=x[1];B[2]=x[2];return B}function m(x,B,q){const u=new Float32Array(3);u[0]=x;u[1]=B;u[2]=q;return u}function l(x,B){return new Float32Array(x,B,3)}function r(){return b()}function n(){return m(1,1,1)}function g(){return m(1,0,0)}function k(){return m(0,
1,0)}function f(){return m(0,0,1)}const d=b(),e=n(),h=g(),v=k(),w=f(),t=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:m,createView:l,zeros:r,ones:n,unitX:g,unitY:k,unitZ:f,ZEROS:d,ONES:e,UNIT_X:h,UNIT_Y:v,UNIT_Z:w},Symbol.toStringTag,{value:"Module"}));a.ONES=e;a.UNIT_X=h;a.UNIT_Y=v;a.UNIT_Z=w;a.ZEROS=d;a.clone=c;a.create=b;a.createView=l;a.fromValues=m;a.ones=n;a.unitX=g;a.unitY=k;a.unitZ=f;a.vec3f32=t;a.zeros=r})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTextureCoordinates.glsl":function(){define(["exports",
"../../../../../../core/compilerUtils","./TextureCoordinateAttribute.glsl","../util/TextureAtlasLookup.glsl","../../shaderModules/interfaces"],function(a,b,c,m,l){a.VertexTextureCoordinates=function(r,n){r.include(c.TextureCoordinateAttribute,n);r.fragment.code.add(l.glsl`
  struct TextureLookupParameter {
    vec2 uv;
    ${n.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `);switch(n.textureCoordinateType){case c.TextureCoordinateAttributeType.Default:r.fragment.code.add(l.glsl`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return texture2D(texture, params.uv);
}`);break;case c.TextureCoordinateAttributeType.Atlas:r.include(m.TextureAtlasLookup);r.fragment.code.add(l.glsl`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return textureAtlasLookup(texture, params.size, params.uv, vuvRegion);
}`);break;default:b.neverReached(n.textureCoordinateType);case c.TextureCoordinateAttributeType.None:case c.TextureCoordinateAttributeType.COUNT:}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureAtlasLookup.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.TextureAtlasLookup=function(c){c.extensions.add("GL_EXT_shader_texture_lod");c.extensions.add("GL_OES_standard_derivatives");
c.fragment.code.add(b.glsl`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Float3DrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,m){c=function(l){function r(n,g){return l.call(this,n,"vec3",m.BindType.Draw,(k,f,d)=>k.setUniform3fv(n,g(f,d)))||this}b._inheritsLoose(r,l);return r}(c.Uniform);a.Float3DrawUniform=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ./Float2DrawUniform ./Uniform ../shaderTechnique/BindType".split(" "),function(a,b,c,m,l,r,n,g){let k=function(d){function e(h,v){return d.call(this,h,"sampler2D",g.BindType.Draw,(w,t,x)=>w.bindTexture(h,v(t,
x)))||this}b._inheritsLoose(e,d);return e}(n.Uniform);const f=l.create();a.Texture2DDrawUniform=k;a.createTexture2DDrawSizeUniforms=function(d,e,h){const v=[new k(d,e)];h&&v.push(new r.Float2DrawUniform(d+"Size",(w,t)=>{w=e(w,t);return c.isSome(w)?m.set(f,w.descriptor.width,w.descriptor.height):l.ZEROS}));return v};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Float2DrawUniform":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,m){c=function(l){function r(n,g){return l.call(this,n,"vec2",m.BindType.Draw,(k,f,d)=>k.setUniform2fv(n,g(f,d)))||this}b._inheritsLoose(r,l);return r}(c.Uniform);a.Float2DrawUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ./Float2PassUniform ./Uniform ../shaderTechnique/BindType".split(" "),
function(a,b,c,m,l,r,n,g){let k=function(d){function e(h,v){return d.call(this,h,"sampler2D",g.BindType.Pass,(w,t,x)=>w.bindTexture(h,v(t,x)))||this}b._inheritsLoose(e,d);return e}(n.Uniform);const f=l.create();a.Texture2DPassUniform=k;a.createTexture2DPassSizeUniforms=function(d,e,h){const v=[new k(d,e)];h&&v.push(new r.Float2PassUniform(d+"Size",(w,t)=>{w=e(w,t);return c.isSome(w)?m.set(f,w.descriptor.width,w.descriptor.height):l.ZEROS}));return v};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/GLTextureMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../core/shaderModules/interfaces ./basicInterfaces ./GLMaterial".split(" "),function(a,b,c,m,l,r,n){n=function(k){function f(e){var h=k.call(this,e)||this;h._numLoading=0;h._disposed=!1;h._textureRepository=e.textureRep;h._textureId=e.textureId;h._acquire(e.textureId,v=>h._texture=
v);h._acquire(e.normalTextureId,v=>h._textureNormal=v);h._acquire(e.emissiveTextureId,v=>h._textureEmissive=v);h._acquire(e.occlusionTextureId,v=>h._textureOcclusion=v);h._acquire(e.metallicRoughnessTextureId,v=>h._textureMetallicRoughness=v);return h}b._inheritsLoose(f,k);var d=f.prototype;d.dispose=function(){this._texture=c.releaseMaybe(this._texture);this._textureNormal=c.releaseMaybe(this._textureNormal);this._textureEmissive=c.releaseMaybe(this._textureEmissive);this._textureOcclusion=c.releaseMaybe(this._textureOcclusion);
this._textureMetallicRoughness=c.releaseMaybe(this._textureMetallicRoughness);this._disposed=!0};d.ensureResources=function(e){return 0===this._numLoading?r.ResourceState.LOADED:r.ResourceState.LOADING};d.updateTexture=function(e){if(c.isNone(this._texture)||e!==this._texture.id)this._texture=c.releaseMaybe(this._texture),this._textureId=e,this._acquire(this._textureId,h=>this._texture=h)};d._acquire=function(e,h){c.isNone(e)?h(null):(e=this._textureRepository.acquire(e),m.isPromiseLike(e)?(++this._numLoading,
e.then(v=>{this._disposed?(c.releaseMaybe(v),h(null)):h(v)}).finally(()=>--this._numLoading)):h(e))};b._createClass(f,[{key:"textureBindParameters",get:function(){return new g(c.isSome(this._texture)?this._texture.glTexture:null,c.isSome(this._textureNormal)?this._textureNormal.glTexture:null,c.isSome(this._textureEmissive)?this._textureEmissive.glTexture:null,c.isSome(this._textureOcclusion)?this._textureOcclusion.glTexture:null,c.isSome(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:
null)}}]);return f}(n);let g=function(k){function f(d=null,e=null,h=null,v=null,w=null){var t=k.call(this)||this;t.texture=d;t.textureNormal=e;t.textureEmissive=h;t.textureOcclusion=v;t.textureMetallicRoughness=w;return t}b._inheritsLoose(f,k);return f}(l.NoParameters);a.GLTextureMaterial=n;a.GLTextureMaterialBindParameters=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"./basicInterfaces"],function(a,b){return function(){function c(l){this._material=l.material;this._techniqueRepository=l.techniqueRep;this._output=l.output}var m=c.prototype;m.dispose=function(){this._techniqueRepository.release(this._technique)};m.ensureTechnique=function(l,r,n=this._output){return this._technique=this._techniqueRepository.releaseAndAcquire(l,this._material.getConfiguration(n,r),this._technique)};m.ensureResources=function(l){return b.ResourceState.LOADED};a._createClass(c,[{key:"technique",
get:function(){return this._technique}}]);return c}()})},"esri/views/3d/webgl-engine/core/shaderModules/Float4PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,m){c=function(l){function r(n,g){return l.call(this,n,"vec4",m.BindType.Pass,(k,f,d)=>k.setUniform4fv(n,g(f,d)))||this}b._inheritsLoose(r,l);return r}(c.Uniform);a.Float4PassUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl":function(){define(["exports","../../shaderModules/Float3PassUniform","../../shaderModules/FloatPassUniform","../../shaderModules/interfaces"],function(a,b,c,m){a.MainLighting=function(l,r){l=l.fragment;r.isGround?l.uniforms.add(new c.FloatPassUniform("lightingFixedFactor",(n,g)=>(1-g.lighting.groundLightingFactor)*(1-g.lighting.globalFactor))):l.constants.add("lightingFixedFactor","float",0);l.uniforms.add([new b.Float3PassUniform("lightingMainDirection",
(n,g)=>g.lighting.lightingMainDirection),new b.Float3PassUniform("lightingMainIntensity",(n,g)=>g.lighting.mainLight.intensity)]);l.code.add(m.glsl`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return lightingMainIntensity * ((1.0 - shadowing) * dotVal);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,m){c=function(l){function r(n,g){return l.call(this,n,"float",m.BindType.Pass,(k,f,d)=>k.setUniform1f(n,g(f,d)))||this}b._inheritsLoose(r,l);return r}(c.Uniform);a.FloatPassUniform=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.PiUtils=function(c){c.vertex.code.add(b.glsl`const float PI = 3.141592653589793;`);c.fragment.code.add(b.glsl`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CloudsParallaxShading.glsl":function(){define("exports ../../../../../../core/mathUtils ../../../../../../core/maybe ../../../../../../chunks/vec2 ../../../../../../chunks/vec2f64 ../../../../../../geometry/support/Ellipsoid ../../../../environment/CloudsCompositionParameters ../../shaderModules/BooleanPassUniform ../../shaderModules/Float2PassUniform ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/TextureCubePassUniform".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){const w=l.create();a.CloudsParallaxShading=function(t){t=t.fragment;t.uniforms.add([new h.Matrix4PassUniform("rotationMatrixClouds",(x,B)=>B.clouds.parallax.transform),new h.Matrix4PassUniform("rotationMatrixCloudsCrossFade",(x,B)=>B.clouds.parallaxNew.transform),new f.Float3PassUniform("anchorPosition",(x,B)=>B.clouds.parallax.anchorPointClouds),new f.Float3PassUniform("anchorPositionCrossFade",(x,B)=>B.clouds.parallaxNew.anchorPointClouds),new k.Float2PassUniform("cloudVariables",
(x,B)=>c.isSome(B.clouds.data)?m.set(w,B.clouds.data.coverage,B.clouds.data.absorption):l.ZEROS),new d.FloatPassUniform("cloudsHeight",(x,B)=>B.clouds.parallax.cloudsHeight),new d.FloatPassUniform("radiusCurvatureCorrectionFactor",(x,B)=>B.clouds.parallax.radiusCurvatureCorrectionFactor),new d.FloatPassUniform("totalFadeInOut",(x,B)=>B.clouds.fadeInOut.stage===n.FadeInOutStages.FINISHED?B.clouds.fadeInOutHeight.factor+Math.max(b.clamp(B.clouds.fadeIn.factor,0,1)):B.clouds.fadeInOutHeight.factor+Math.max(b.clamp(B.clouds.fadeInOut.factor,
0,1))),new d.FloatPassUniform("crossFadeAnchorFactor",(x,B)=>b.clamp(B.clouds.crossFade.factor,0,1)),new v.TextureCubePassUniform("cubeMap",(x,B)=>c.isSome(B.clouds.data)?B.clouds.data.cubeMap.colorTexture:null),new g.BooleanPassUniform("crossFade",(x,B)=>B.clouds.crossFade.enabled)]);t.constants.add("planetRadius","float",r.earth.radius);t.code.add(e.glsl`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`);t.code.add(e.glsl`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`);t.code.add(e.glsl`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`);t.uniforms.add([new f.Float3PassUniform("lightingMainDirection",(x,B)=>B.lighting.lightingMainDirection),new f.Float3PassUniform("lightingMainIntensity",(x,B)=>B.lighting.mainLight.intensity)]);t.code.add(e.glsl`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(lightingMainDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(lightingMainDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((lightingMainIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * pow(dirDotLight, RIM_SCATTERING_FACTOR) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`);t.code.add(e.glsl`vec4 getCloudData(vec3 rayDir)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
return mix(vec4(vec3(clamp(1.0 - cloudVariables.y, 0.6, 1.0)), 0.0), cloudData, smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(mu)));
}`);t.code.add(e.glsl`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`);t.code.add(e.glsl`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`);t.code.add(e.glsl`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/BooleanPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,m){c=function(l){function r(n,g){return l.call(this,n,"bool",m.BindType.Pass,(k,f,d)=>k.setUniform1b(n,g(f,d)))||this}b._inheritsLoose(r,l);return r}(c.Uniform);a.BooleanPassUniform=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/TextureCubePassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,m){c=function(l){function r(n,g){return l.call(this,n,"samplerCube",m.BindType.Pass,(k,f,d)=>k.bindTexture(n,g(f,d)))||this}b._inheritsLoose(r,l);return r}(c.Uniform);a.TextureCubePassUniform=c;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.ColorConversion=function(c){c.code.add(b.glsl`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/CloudsData":function(){define(["exports","../../../core/maybe"],function(a,b){a.ensureClouds=function(c){return b.isSome(c)&&!c.running};a.isReadyCloudsData=function(c){return b.isSome(c)&&b.isSome(c.cubeMap)&&0<c.coverage};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/CloudsGenerator":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/has ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat3 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2f32 ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../../chunks/Clouds.glsl ./CloudsCompositionParameters ./CloudsPresets ./CloudsTechnique ./CloudsTechniqueConfiguration ./NoiseTextureAtlas ../webgl-engine/lib/BindParameters ../webgl-engine/lib/glUtil3D ../../support/Scheduler ../../webgl/enums ../../webgl/FramebufferObject".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N){a.CloudsGenerator=function(I){function O(S){S=I.call(this,S)||this;S._frameTask=null;S._handles=new l;S._cubeMapSize=r("esri-mobile")?1024:2048;S._techniques=[];S._techniqueConfiguration=new D.CloudsTechniqueConfiguration;S._bindParameters=new F.BindParameters(null,null,null);S._drawParameters=new z.CloudsDrawParameters;S._weatherTile=x.fromValues(0,0);S._weatherTileCount=128;S.coverage=n.lerp(H.coverage[0],H.coverage[1],.5);
S.density=n.lerp(H.density[0],H.density[1],.5);S.absorption=n.lerp(H.absorption[0],H.absorption[1],.5);S.cloudSize=n.lerp(H.cloudSize[0],H.cloudSize[1],.5);S.detailSize=n.lerp(H.detailSize[0],H.detailSize[1],.5);S.smoothness=n.lerp(H.smoothness[0],H.smoothness[1],.5);S.cloudHeight=n.lerp(H.cloudHeight[0],H.cloudHeight[1],.5);S.raymarchingStepType=H.raymarchingStepType;S._cloudRadius=0;S._viewMatrix=t.create();S._cameraPositionLastFrame=u.create();S.running=!1;return S}b._inheritsLoose(O,I);var Q=
O.prototype;Q._getTechnique=function(S){const T=this._techniques[S];if(T)return T;this._techniqueConfiguration.steps=S;this._techniques[S]=new y.CloudsTechnique({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration);return this._techniques[S]};Q._getWeatherTile=function(){let S=x.fromValues((this.view.camera.position.latitude+90)/180,(this.view.camera.position.longitude+180)/360);S=x.fromValues(Math.floor(2*this._weatherTileCount*S[0]),Math.floor(4*
(this._weatherTileCount-Math.floor(this._weatherTileCount*Math.abs(2*S[0]-1)))*S[1]));let T=0;var U=0;g.isSome(this.view.environment)&&"sun"===this.view.environment.lighting.type&&g.isSome(this.view.environment.lighting.date)&&(U=new Date(this.view.environment.lighting.date),U.setUTCHours(this.view.environment.lighting.date.getUTCHours()+this.view.environment.lighting.displayUTCOffset),T=31*U.getUTCMonth()+U.getUTCDate(),U=U.getUTCFullYear());S[0]=(S[0]+T)%(2*this._weatherTileCount);S[1]=(S[1]+U%
100)%(4*this._weatherTileCount);return S};Q.initialize=function(){this._vao=G.createQuadVAO(this.context.renderContext.rctx);this._cloudRadius=.5*C.getReferenceEllipsoid(this.view.spatialReference).radius;this.setDirty();this._weatherTile=this._getWeatherTile();this._frameTask=this.view.resourceController.scheduler.registerTask(P.TaskPriority.CLOUDS_GENERATOR,this);this._handles.add(this._frameTask);this._handles.add(k.watch(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,
this.smoothness,this.cloudHeight,this.raymarchingStepType],()=>this.setDirty(),k.initial))};Q.destroy=function(){this._handles.destroy();this._techniques.forEach(S=>g.releaseMaybe(S));this._techniques=null;this._frameBufferCube=g.disposeMaybe(this._frameBufferCube);this._vao=g.disposeMaybe(this._vao);this._noiseTexture=g.destroyMaybe(this._noiseTexture)};Q._ensureNoiseTexture=function(){g.isNone(this._noiseTexture)&&(this._noiseTexture=new E.NoiseTextureAtlas({context:this.context}),this._noiseTexture.updateWeatherMap(this._weatherTile));
return this._noiseTexture.textureAtlas};Q.ensureWeatherTile=function(){const S=this._getWeatherTile();g.isSome(this._noiseTexture)&&g.isSome(this.context)&&this._noiseTexture.updateWeatherMap(S);if(S[0]!==this._weatherTile[0]||S[1]!==this._weatherTile[1])this._weatherTile=S,this.setDirty()};Q.isFading=function(S){return S.crossFade.enabled||S.fadeInOut.stage===A.FadeInOutStages.FADE_OUT||S.fadeInOutHeight.stage!==A.FadeHeightStages.FINISHED};Q.applyPreset=function(S,T){const U=S.median,aa=W=>{const R=
n.lerp(W[0],W[1],U);return.5>T?n.lerp(W[0],R,2*T):n.lerp(R,W[1],2*(T-.5))};this.coverage=aa(S.coverage);this.density=aa(S.density);this.absorption=aa(S.absorption);this.cloudSize=aa(S.cloudSize);this.detailSize=aa(S.detailSize);this.smoothness=aa(S.smoothness);this.cloudHeight=aa(S.cloudHeight);this.raymarchingStepType=S.raymarchingStepType};Q.setDirty=function(){this.running=!0};Q.runTask=function(S){if(0===this.coverage||g.isNone(this._vao))this.running=!1;else{var T=this._getTechnique(this.raymarchingStepType);
if(T.compiled)if(!B.equals(this._cameraPositionLastFrame,this.context.renderContext.bindParameters.camera.eye)||this.isFading(this.context.renderContext.bindParameters.clouds))B.copy(this._cameraPositionLastFrame,this.context.renderContext.bindParameters.camera.eye);else{this.ensureWeatherTile();var U=this._ensureNoiseTexture();if(!g.isNone(U)){var aa=this.context.renderContext.rctx;T=aa.bindTechnique(T);var W=1+this.absorption,R=n.lerp(35,120,this.absorption);T.bindTexture("cloudShapeTexture",U);
T.setUniform1f("cloudRadius",this._cloudRadius);T.setUniform1f("halfCubeMapSize",.5*this._cubeMapSize);T.setUniform1f("power",R);T.setUniform1f("sigmaE",W);T.setUniform1f("density",n.lerp(0,.3,this.density));T.setUniform1f("cloudSize",n.lerp(0,.02,Math.max(.01,1-this.cloudSize)));T.setUniform1f("detailSize",n.lerp(0,.2,Math.max(.01,1-this.detailSize)));T.setUniform1f("smoothness",n.lerp(0,.5,1-this.smoothness));T.setUniform1f("cloudHeight",n.lerp(0,1500,this.cloudHeight));T.setUniform1f("coverage",
this.coverage);aa.bindVAO(this._vao);T.assertCompatibleVertexAttributeLocations(this._vao);U=aa.getViewport();aa.setViewport(0,0,this._cubeMapSize,this._cubeMapSize);aa.bindFramebuffer(this.frameBufferCube);for(W=0;5>W;W++)w.targetTo(this._viewMatrix,J,M[W],L[W]),v.fromMat4(this._drawParameters.viewMatrix,this._viewMatrix),this.frameBufferCube.setColorTextureTarget(K.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X+W),T.bindDraw(this._drawParameters,this._bindParameters),aa.gl.drawArrays(aa.gl.TRIANGLE_STRIP,
0,4),aa.gl.flush();this.running=!1;aa.setViewport(U.x,U.y,U.width,U.height);this.requestRender();S.madeProgress()}}}};b._createClass(O,[{key:"frameBufferCube",get:function(){g.isNone(this._frameBufferCube)&&(this._frameBufferCube=new N.FramebufferObject(this.context.renderContext.rctx,{colorTarget:K.TargetType.CUBEMAP,width:this._cubeMapSize,height:this._cubeMapSize},{target:K.TextureType.TEXTURE_CUBE_MAP,pixelFormat:K.PixelFormat.RGBA,dataType:K.PixelType.UNSIGNED_BYTE,wrapMode:K.TextureWrapMode.CLAMP_TO_EDGE,
samplingMode:K.TextureSamplingMode.LINEAR,hasMipmap:!1,width:this._cubeMapSize,height:this._cubeMapSize}));return this._frameBufferCube}},{key:"cubeMap",get:function(){return this._frameBufferCube}}]);return O}(m);c.__decorate([f.property({constructOnly:!0})],a.CloudsGenerator.prototype,"context",void 0);c.__decorate([f.property({constructOnly:!0})],a.CloudsGenerator.prototype,"view",void 0);c.__decorate([f.property({constructOnly:!0})],a.CloudsGenerator.prototype,"requestRender",void 0);c.__decorate([f.property()],
a.CloudsGenerator.prototype,"_frameTask",void 0);c.__decorate([f.property()],a.CloudsGenerator.prototype,"coverage",void 0);c.__decorate([f.property()],a.CloudsGenerator.prototype,"density",void 0);c.__decorate([f.property()],a.CloudsGenerator.prototype,"absorption",void 0);c.__decorate([f.property()],a.CloudsGenerator.prototype,"cloudSize",void 0);c.__decorate([f.property()],a.CloudsGenerator.prototype,"detailSize",void 0);c.__decorate([f.property()],a.CloudsGenerator.prototype,"smoothness",void 0);
c.__decorate([f.property()],a.CloudsGenerator.prototype,"cloudHeight",void 0);c.__decorate([f.property()],a.CloudsGenerator.prototype,"raymarchingStepType",void 0);c.__decorate([f.property()],a.CloudsGenerator.prototype,"running",void 0);a.CloudsGenerator=c.__decorate([h.subclass("esri.views.3d.environment.CloudsGenerator")],a.CloudsGenerator);const M=[q.fromValues(1,0,0),q.fromValues(-1,0,0),q.fromValues(0,1,0),q.fromValues(0,-1,0),q.fromValues(0,0,1)],L=[q.fromValues(0,1,0),q.fromValues(0,1,0),
q.fromValues(0,0,-1),q.fromValues(0,0,1),q.fromValues(0,1,0)],J=q.zeros(),H=p.cloudPresets.sunny;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/mat3":function(){define(["exports","./common"],function(a,b){function c(L,J){L[0]=J[0];L[1]=J[1];L[2]=J[2];L[3]=J[4];L[4]=J[5];L[5]=J[6];L[6]=J[8];L[7]=J[9];L[8]=J[10];return L}function m(L,J){L[0]=J[0];L[1]=J[1];L[2]=J[2];L[3]=J[3];L[4]=J[4];L[5]=J[5];L[6]=J[6];L[7]=J[7];L[8]=J[8];return L}function l(L,
J,H,I,O,Q,S,T,U,aa){L[0]=J;L[1]=H;L[2]=I;L[3]=O;L[4]=Q;L[5]=S;L[6]=T;L[7]=U;L[8]=aa;return L}function r(L){L[0]=1;L[1]=0;L[2]=0;L[3]=0;L[4]=1;L[5]=0;L[6]=0;L[7]=0;L[8]=1;return L}function n(L,J){if(L===J){const H=J[1],I=J[2],O=J[5];L[1]=J[3];L[2]=J[6];L[3]=H;L[5]=J[7];L[6]=I;L[7]=O}else L[0]=J[0],L[1]=J[3],L[2]=J[6],L[3]=J[1],L[4]=J[4],L[5]=J[7],L[6]=J[2],L[7]=J[5],L[8]=J[8];return L}function g(L,J){const H=J[0],I=J[1],O=J[2],Q=J[3],S=J[4],T=J[5],U=J[6],aa=J[7];J=J[8];const W=J*S-T*aa,R=-J*Q+T*U,
V=aa*Q-S*U;let da=H*W+I*R+O*V;if(!da)return null;da=1/da;L[0]=W*da;L[1]=(-J*I+O*aa)*da;L[2]=(T*I-O*S)*da;L[3]=R*da;L[4]=(J*H-O*U)*da;L[5]=(-T*H+O*Q)*da;L[6]=V*da;L[7]=(-aa*H+I*U)*da;L[8]=(S*H-I*Q)*da;return L}function k(L,J){const H=J[0],I=J[1],O=J[2],Q=J[3],S=J[4],T=J[5],U=J[6],aa=J[7];J=J[8];L[0]=S*J-T*aa;L[1]=O*aa-I*J;L[2]=I*T-O*S;L[3]=T*U-Q*J;L[4]=H*J-O*U;L[5]=O*Q-H*T;L[6]=Q*aa-S*U;L[7]=I*U-H*aa;L[8]=H*S-I*Q;return L}function f(L){const J=L[3],H=L[4],I=L[5],O=L[6],Q=L[7],S=L[8];return L[0]*(S*
H-I*Q)+L[1]*(-S*J+I*O)+L[2]*(Q*J-H*O)}function d(L,J,H){const I=J[0],O=J[1],Q=J[2],S=J[3],T=J[4],U=J[5],aa=J[6],W=J[7];J=J[8];const R=H[0],V=H[1],da=H[2],ca=H[3],ha=H[4],ia=H[5],ka=H[6],la=H[7];H=H[8];L[0]=R*I+V*S+da*aa;L[1]=R*O+V*T+da*W;L[2]=R*Q+V*U+da*J;L[3]=ca*I+ha*S+ia*aa;L[4]=ca*O+ha*T+ia*W;L[5]=ca*Q+ha*U+ia*J;L[6]=ka*I+la*S+H*aa;L[7]=ka*O+la*T+H*W;L[8]=ka*Q+la*U+H*J;return L}function e(L,J,H){const I=J[0],O=J[1],Q=J[2],S=J[3],T=J[4],U=J[5],aa=J[6],W=J[7];J=J[8];const R=H[0];H=H[1];L[0]=I;L[1]=
O;L[2]=Q;L[3]=S;L[4]=T;L[5]=U;L[6]=R*I+H*S+aa;L[7]=R*O+H*T+W;L[8]=R*Q+H*U+J;return L}function h(L,J,H){const I=J[0],O=J[1],Q=J[2],S=J[3],T=J[4],U=J[5],aa=J[6],W=J[7];J=J[8];const R=Math.sin(H);H=Math.cos(H);L[0]=H*I+R*S;L[1]=H*O+R*T;L[2]=H*Q+R*U;L[3]=H*S-R*I;L[4]=H*T-R*O;L[5]=H*U-R*Q;L[6]=aa;L[7]=W;L[8]=J;return L}function v(L,J,H){const I=H[0],O=H[1];H=H[2];L[0]=I*J[0];L[1]=I*J[1];L[2]=I*J[2];L[3]=O*J[3];L[4]=O*J[4];L[5]=O*J[5];L[6]=H*J[6];L[7]=H*J[7];L[8]=H*J[8];return L}function w(L,J,H){const I=
H[0];H=H[1];L[0]=I*J[0];L[1]=I*J[1];L[2]=I*J[2];L[3]=H*J[3];L[4]=H*J[4];L[5]=H*J[5];return L}function t(L,J){L[0]=1;L[1]=0;L[2]=0;L[3]=0;L[4]=1;L[5]=0;L[6]=J[0];L[7]=J[1];L[8]=1;return L}function x(L,J){const H=Math.sin(J);J=Math.cos(J);L[0]=J;L[1]=H;L[2]=0;L[3]=-H;L[4]=J;L[5]=0;L[6]=0;L[7]=0;L[8]=1;return L}function B(L,J){L[0]=J[0];L[1]=0;L[2]=0;L[3]=0;L[4]=J[1];L[5]=0;L[6]=0;L[7]=0;L[8]=1;return L}function q(L,J){L[0]=J[0];L[1]=J[1];L[2]=0;L[3]=J[2];L[4]=J[3];L[5]=0;L[6]=J[4];L[7]=J[5];L[8]=1;
return L}function u(L,J){var H=J[0],I=J[1],O=J[2];J=J[3];var Q=H+H,S=I+I;const T=O+O;H*=Q;const U=I*Q;I*=S;const aa=O*Q,W=O*S;O*=T;Q*=J;S*=J;J*=T;L[0]=1-I-O;L[3]=U-J;L[6]=aa+S;L[1]=U+J;L[4]=1-H-O;L[7]=W-Q;L[2]=aa-S;L[5]=W+Q;L[8]=1-H-I;return L}function C(L,J){const H=J[0],I=J[1],O=J[2],Q=J[4],S=J[5],T=J[6],U=J[8],aa=J[9];J=J[10];const W=J*S-T*aa,R=-J*Q+T*U,V=aa*Q-S*U;var da=H*W+I*R+O*V;if(!da)return null;da=1/da;L[0]=W*da;L[1]=(-J*I+O*aa)*da;L[2]=(T*I-O*S)*da;L[3]=R*da;L[4]=(J*H-O*U)*da;L[5]=(-T*
H+O*Q)*da;L[6]=V*da;L[7]=(-aa*H+I*U)*da;L[8]=(S*H-I*Q)*da;return L}function z(L,J){const H=J[0],I=J[1],O=J[2],Q=J[3],S=J[4],T=J[5],U=J[6],aa=J[7];var W=J[8],R=J[9],V=J[10],da=J[11];const ca=J[12],ha=J[13],ia=J[14];J=J[15];const ka=H*T-I*S,la=H*U-O*S,Y=H*aa-Q*S,ea=I*U-O*T,ba=I*aa-Q*T,Z=O*aa-Q*U,fa=W*ha-R*ca,ja=W*ia-V*ca;W=W*J-da*ca;const oa=R*ia-V*ha;R=R*J-da*ha;V=V*J-da*ia;da=ka*V-la*R+Y*oa+ea*W-ba*ja+Z*fa;if(!da)return null;da=1/da;L[0]=(T*V-U*R+aa*oa)*da;L[1]=(U*W-S*V-aa*ja)*da;L[2]=(S*R-T*W+aa*
fa)*da;L[3]=(O*R-I*V-Q*oa)*da;L[4]=(H*V-O*W+Q*ja)*da;L[5]=(I*W-H*R-Q*fa)*da;L[6]=(ha*Z-ia*ba+J*ea)*da;L[7]=(ia*Y-ca*Z-J*la)*da;L[8]=(ca*ba-ha*Y+J*ka)*da;return L}function A(L,J,H){L[0]=2/J;L[1]=0;L[2]=0;L[3]=0;L[4]=-2/H;L[5]=0;L[6]=-1;L[7]=1;L[8]=1;return L}function p(L){return"mat3("+L[0]+", "+L[1]+", "+L[2]+", "+L[3]+", "+L[4]+", "+L[5]+", "+L[6]+", "+L[7]+", "+L[8]+")"}function y(L){return Math.sqrt(L[0]**2+L[1]**2+L[2]**2+L[3]**2+L[4]**2+L[5]**2+L[6]**2+L[7]**2+L[8]**2)}function D(L,J,H){L[0]=
J[0]+H[0];L[1]=J[1]+H[1];L[2]=J[2]+H[2];L[3]=J[3]+H[3];L[4]=J[4]+H[4];L[5]=J[5]+H[5];L[6]=J[6]+H[6];L[7]=J[7]+H[7];L[8]=J[8]+H[8];return L}function E(L,J,H){L[0]=J[0]-H[0];L[1]=J[1]-H[1];L[2]=J[2]-H[2];L[3]=J[3]-H[3];L[4]=J[4]-H[4];L[5]=J[5]-H[5];L[6]=J[6]-H[6];L[7]=J[7]-H[7];L[8]=J[8]-H[8];return L}function F(L,J,H){L[0]=J[0]*H;L[1]=J[1]*H;L[2]=J[2]*H;L[3]=J[3]*H;L[4]=J[4]*H;L[5]=J[5]*H;L[6]=J[6]*H;L[7]=J[7]*H;L[8]=J[8]*H;return L}function G(L,J,H,I){L[0]=J[0]+H[0]*I;L[1]=J[1]+H[1]*I;L[2]=J[2]+H[2]*
I;L[3]=J[3]+H[3]*I;L[4]=J[4]+H[4]*I;L[5]=J[5]+H[5]*I;L[6]=J[6]+H[6]*I;L[7]=J[7]+H[7]*I;L[8]=J[8]+H[8]*I;return L}function P(L,J){return L[0]===J[0]&&L[1]===J[1]&&L[2]===J[2]&&L[3]===J[3]&&L[4]===J[4]&&L[5]===J[5]&&L[6]===J[6]&&L[7]===J[7]&&L[8]===J[8]}function K(L,J){const H=L[0],I=L[1],O=L[2],Q=L[3],S=L[4],T=L[5],U=L[6],aa=L[7];L=L[8];const W=J[0],R=J[1],V=J[2],da=J[3],ca=J[4],ha=J[5],ia=J[6],ka=J[7];J=J[8];return Math.abs(H-W)<=b.EPSILON*Math.max(1,Math.abs(H),Math.abs(W))&&Math.abs(I-R)<=b.EPSILON*
Math.max(1,Math.abs(I),Math.abs(R))&&Math.abs(O-V)<=b.EPSILON*Math.max(1,Math.abs(O),Math.abs(V))&&Math.abs(Q-da)<=b.EPSILON*Math.max(1,Math.abs(Q),Math.abs(da))&&Math.abs(S-ca)<=b.EPSILON*Math.max(1,Math.abs(S),Math.abs(ca))&&Math.abs(T-ha)<=b.EPSILON*Math.max(1,Math.abs(T),Math.abs(ha))&&Math.abs(U-ia)<=b.EPSILON*Math.max(1,Math.abs(U),Math.abs(ia))&&Math.abs(aa-ka)<=b.EPSILON*Math.max(1,Math.abs(aa),Math.abs(ka))&&Math.abs(L-J)<=b.EPSILON*Math.max(1,Math.abs(L),Math.abs(J))}function N(L){const J=
b.EPSILON,H=L[0],I=L[1],O=L[2],Q=L[3],S=L[4],T=L[5],U=L[6],aa=L[7];L=L[8];return Math.abs(1-(H*H+Q*Q+U*U))<=J&&Math.abs(1-(I*I+S*S+aa*aa))<=J&&Math.abs(1-(O*O+T*T+L*L))<=J}const M=Object.freeze(Object.defineProperty({__proto__:null,fromMat4:c,copy:m,set:l,identity:r,transpose:n,invert:g,adjoint:k,determinant:f,multiply:d,translate:e,rotate:h,scale:v,scaleByVec2:w,fromTranslation:t,fromRotation:x,fromScaling:B,fromMat2d:q,fromQuat:u,normalFromMat4Legacy:C,normalFromMat4:z,projection:A,str:p,frob:y,
add:D,subtract:E,multiplyScalar:F,multiplyScalarAndAdd:G,exactEquals:P,equals:K,isOrthoNormal:N,mul:d,sub:E},Symbol.toStringTag,{value:"Module"}));a.add=D;a.adjoint=k;a.copy=m;a.determinant=f;a.equals=K;a.exactEquals=P;a.frob=y;a.fromMat2d=q;a.fromMat4=c;a.fromQuat=u;a.fromRotation=x;a.fromScaling=B;a.fromTranslation=t;a.identity=r;a.invert=g;a.isOrthoNormal=N;a.mat3=M;a.mul=d;a.multiply=d;a.multiplyScalar=F;a.multiplyScalarAndAdd=G;a.normalFromMat4=z;a.normalFromMat4Legacy=C;a.projection=A;a.rotate=
h;a.scale=v;a.scaleByVec2=w;a.set=l;a.str=p;a.sub=E;a.subtract=E;a.translate=e;a.transpose=n})},"esri/chunks/vec2f32":function(){define(["exports"],function(a){function b(){return new Float32Array(2)}function c(w){const t=new Float32Array(2);t[0]=w[0];t[1]=w[1];return t}function m(w,t){const x=new Float32Array(2);x[0]=w;x[1]=t;return x}function l(w,t){return new Float32Array(w,t,2)}function r(){return b()}function n(){return m(1,1)}function g(){return m(1,0)}function k(){return m(0,1)}const f=b(),
d=n(),e=g(),h=k(),v=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:m,createView:l,zeros:r,ones:n,unitX:g,unitY:k,ZEROS:f,ONES:d,UNIT_X:e,UNIT_Y:h},Symbol.toStringTag,{value:"Module"}));a.ONES=d;a.UNIT_X=e;a.UNIT_Y=h;a.ZEROS=f;a.clone=c;a.create=b;a.createView=l;a.fromValues=m;a.ones=n;a.unitX=g;a.unitY=k;a.vec2f32=v;a.zeros=r})},"esri/chunks/Clouds.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./mat3f64 ../views/3d/environment/CloudsTechniqueConfiguration ../views/3d/environment/NoiseTextureAtlasDimensions ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderModules/FloatUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix3DrawUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DUniform".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){function e(w){const t=new f.ShaderBuilder;t.include(r.ScreenSpacePass,!1);t.fragment.uniforms.add(new n.FloatUniform("cloudRadius"));t.fragment.uniforms.add(new n.FloatUniform("halfCubeMapSize"));t.fragment.uniforms.add(new n.FloatUniform("power"));t.fragment.uniforms.add(new n.FloatUniform("sigmaE"));t.fragment.uniforms.add(new n.FloatUniform("density"));t.fragment.uniforms.add(new n.FloatUniform("cloudSize"));t.fragment.uniforms.add(new n.FloatUniform("detailSize"));
t.fragment.uniforms.add(new n.FloatUniform("smoothness"));t.fragment.uniforms.add(new n.FloatUniform("cloudHeight"));t.fragment.uniforms.add(new n.FloatUniform("coverage"));t.fragment.uniforms.add(new k.Matrix3DrawUniform("view",x=>x.viewMatrix));t.fragment.uniforms.add(new d.Texture2DUniform("cloudShapeTexture"));t.fragment.code.add(g.glsl`
    const int STEPS = ${w.steps===m.RayMarchingSteps.SIXTEEN?g.glsl`16`:w.steps===m.RayMarchingSteps.HUNDRED?g.glsl`100`:g.glsl`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`);t.fragment.code.add(g.glsl`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${g.glsl.float(l.ATLAS_SIZE)};
      const float dataWidth = ${g.glsl.float(l.ATLAS_SIZE)};
      const float tileRows = ${g.glsl.float(l.TILE_ROWS)};
      const vec3 atlasDimensions = vec3(${g.glsl.float(l.TILE_SIZE)}, ${g.glsl.float(l.TILE_SIZE)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${g.glsl.float(l.TEXTURE_SCALE)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Non-power-of-two textures can't be tiled using WebGL1
      // Get fractional part of uv to tile
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = fract((${g.glsl.float(l.WEATHER_MAP_SCALE)} * p) / ${g.glsl.float(l.ATLAS_SIZE)} + 0.5);

      return texture2D(cloudShapeTexture, uv).a;
    }
    `);t.fragment.code.add(g.glsl`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`);t.fragment.code.add(g.glsl`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`);t.fragment.code.add("\n    vec3 multipleOctaves(float extinction, float mu, float stepL) {\n      float attenuation \x3d 1.0;\n      float contribution \x3d 1.0;\n      float phaseAttenuation \x3d 1.0;\n      vec3 luminance \x3d vec3(0);\n\n      for (int i \x3d 0; i \x3c 4; i++) {\n        float phase \x3d mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);\n        luminance +\x3d contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);\n        attenuation *\x3d 0.2;\n        contribution *\x3d 0.6;\n        phaseAttenuation *\x3d 0.5;\n      }\n\n      return luminance;\n    }");
t.fragment.code.add(g.glsl`vec3 lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
vec3 beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`);t.fragment.code.add(g.glsl`vec3 mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return vec3(0);
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
vec3 color = vec3(0.0);
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
vec3 luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
color += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return color;
}`);t.fragment.code.add(g.glsl`void main() {
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
if (hitsPlanet) {
gl_FragColor = vec4(vec3(0), 1);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
float totalTransmittance = 1.0;
vec3 sunDirection = normalize(vec3(0, 0, 1));
vec3 col = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance).rgb;
gl_FragColor = vec4(col, totalTransmittance);
}`);return t}let h=function(w){function t(){var x=w.apply(this,arguments)||this;x.viewMatrix=c.create();return x}b._inheritsLoose(t,w);return t}(g.NoParameters);const v=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:h,build:e},Symbol.toStringTag,{value:"Module"}));a.Clouds=v;a.CloudsDrawParameters=h;a.build=e})},"esri/views/3d/environment/CloudsTechniqueConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],
function(a,b,c,m){a.RayMarchingSteps=void 0;(function(r){r[r.SIXTEEN=0]="SIXTEEN";r[r.HUNDRED=1]="HUNDRED";r[r.TWOHUNDRED=2]="TWOHUNDRED";r[r.COUNT=3]="COUNT"})(a.RayMarchingSteps||(a.RayMarchingSteps={}));let l=function(r){function n(){var g=r.apply(this,arguments)||this;g.steps=a.RayMarchingSteps.SIXTEEN;return g}b._inheritsLoose(n,r);return n}(m.ShaderTechniqueConfiguration);c.__decorate([m.parameter({count:a.RayMarchingSteps.COUNT})],l.prototype,"steps",void 0);a.CloudsTechniqueConfiguration=
l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/NoiseTextureAtlasDimensions":function(){define(["exports","../../../core/has"],function(a,b){b=b("esri-mobile")?64:128;const c=Math.ceil(Math.sqrt(b)),m=(b+2)*c;a.ATLAS_SIZE=m;a.TEXTURE_SCALE=b/128;a.TILE_ROWS=c;a.TILE_SIZE=b;a.WEATHER_MAP_SCALE=m/1560;a.WEATHER_MAP_SIZE=1E5;a.WEATHER_TILE_SIZE=128;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass":function(){define(["exports","../shaderModules/interfaces","../../lib/VertexAttribute"],function(a,b,c){a.ScreenSpacePass=function(m,l=!0){m.attributes.add(c.VertexAttribute.POSITION,"vec2");l&&m.varyings.add("uv","vec2");m.vertex.code.add(b.glsl`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${l?b.glsl`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix3DrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,m){c=function(l){function r(n,g){return l.call(this,n,"mat3",m.BindType.Draw,(k,f,d)=>k.setUniformMatrix3fv(n,g(f,d)))||this}b._inheritsLoose(r,l);return r}(c.Uniform);a.Matrix3DrawUniform=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/CloudsPresets":function(){define(["exports","./CloudsTechniqueConfiguration"],function(a,b){let c=function(m,l,r,n,g,k,f,d,e=.5){this.coverage=m;this.density=l;this.absorption=r;this.cloudSize=n;this.detailSize=g;this.smoothness=k;this.cloudHeight=f;this.raymarchingStepType=d;this.median=e};b={sunny:new c([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],b.RayMarchingSteps.SIXTEEN),cloudy:new c([.3,
.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],b.RayMarchingSteps.TWOHUNDRED,.6),rainy:new c([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],b.RayMarchingSteps.TWOHUNDRED,.4),snowy:new c([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],b.RayMarchingSteps.HUNDRED,.65),foggy:new c([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],b.RayMarchingSteps.SIXTEEN)};a.CloudPresets=c;a.cloudPresets=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/environment/CloudsTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/Clouds.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),function(a,b,c,m,l,r,n,g,k,f){r=function(d){function e(v,w){var t;return t=d.call(this,v,w,()=>t.destroy())||
this}c._inheritsLoose(e,d);var h=e.prototype;h.initializeProgram=function(v){const w=e.shader.get().build(this.configuration);return new g.Program(v.rctx,w,n.Default3D)};h.initializePipeline=function(){return f.makePipelineState({blending:f.separateBlendingParams(k.BlendFactor.ONE,k.BlendFactor.ONE,k.BlendFactor.ZERO,k.BlendFactor.ZERO),depthTest:{func:k.CompareFunction.LEQUAL},colorWrite:f.defaultColorWriteParams})};return e}(r.ShaderTechnique);r.shader=new l.ReloadableShaderModule(m.Clouds,()=>
new Promise((d,e)=>a(["./Clouds.glsl"],d,e)));b.CloudsTechnique=r;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/NoiseTextureAtlas":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../chunks/vec2f32 ./NoiseTextureAtlasConfiguration ./NoiseTextureAtlasDimensions ./NoiseTextureAtlasTechnique ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/FramebufferObject".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h){m=function(v){function w(x){var B=v.call(this,x)||this;B._weatherTile=n.fromValues(0,0);B._needsRender=!0;B._frameBuffer=new h.FramebufferObject(x.context.renderContext.rctx,{colorTarget:e.TargetType.TEXTURE,width:k.ATLAS_SIZE,height:k.ATLAS_SIZE},{target:e.TextureType.TEXTURE_2D,pixelFormat:e.PixelFormat.RGBA,dataType:e.PixelType.UNSIGNED_BYTE,wrapMode:e.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:e.TextureSamplingMode.LINEAR,hasMipmap:!1,width:k.ATLAS_SIZE,height:k.ATLAS_SIZE});
B._vao=d.createQuadVAO(x.context.renderContext.rctx);B._shaderTechniqueRepository=x.context.shaderTechniqueRepository;let q;B._ensureRendered=()=>{l.isSome(q)?l.isSome(B.weatherMapTechnique)&&B.weatherMapTechnique.compiled&&B._needsRender&&(q=B._render(x.context.renderContext.rctx,g.NoiseTextureRenderMode.WeatherMap)):l.isSome(B.fullTechnique)&&B.fullTechnique.compiled&&(q=B._render(x.context.renderContext.rctx,g.NoiseTextureRenderMode.Full));return q};return B}b._inheritsLoose(w,v);var t=w.prototype;
t._setDirty=function(){this._needsRender=!0};t.updateWeatherMap=function(x){if(this._weatherTile[0]!==x[0]||this._weatherTile[1]!==x[1])this._weatherTile=x,this._setDirty()};t.destroy=function(){this._fullTechnique=l.releaseMaybe(this._fullTechnique);this._weatherMapTechnique=l.releaseMaybe(this._weatherMapTechnique);this._frameBuffer=l.disposeMaybe(this._frameBuffer);this._vao=l.disposeMaybe(this._vao)};t._render=function(x,B){if(l.isNone(this._vao)||l.isNone(this._frameBuffer))return null;var q=
B===g.NoiseTextureRenderMode.Full?this.fullTechnique:this.weatherMapTechnique;if(l.isNone(q))return null;B=x.getViewport();x.setViewport(0,0,k.ATLAS_SIZE,k.ATLAS_SIZE);x.bindFramebuffer(this._frameBuffer);q=x.bindTechnique(q);q.setUniform2f("weatherTile",this._weatherTile[0],this._weatherTile[1]);x.bindVAO(this._vao);q.assertCompatibleVertexAttributeLocations(this._vao);x.gl.drawArrays(x.gl.TRIANGLE_STRIP,0,4);x.setViewport(B.x,B.y,B.width,B.height);this._needsRender=!1;return this._frameBuffer.colorTexture};
b._createClass(w,[{key:"textureAtlas",get:function(){return this._ensureRendered()}},{key:"fullTechnique",get:function(){if(l.isNone(this._fullTechnique)){const x=new g.NoiseTextureAtlasTechniqueConfiguration;x.mode=g.NoiseTextureRenderMode.Full;this._fullTechnique=this._shaderTechniqueRepository.acquire(f.NoiseTextureAtlasTechnique,x)}return this._fullTechnique}},{key:"weatherMapTechnique",get:function(){if(l.isNone(this._weatherMapTechnique)){const x=new g.NoiseTextureAtlasTechniqueConfiguration;
x.mode=g.NoiseTextureRenderMode.WeatherMap;this._weatherMapTechnique=this._shaderTechniqueRepository.acquire(f.NoiseTextureAtlasTechnique,x)}return this._weatherMapTechnique}}]);return w}(m);c.__decorate([r.property({constructOnly:!0})],m.prototype,"context",void 0);a.NoiseTextureAtlas=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/NoiseTextureAtlasConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,m){a.NoiseTextureRenderMode=void 0;(function(r){r[r.Full=0]="Full";r[r.WeatherMap=1]="WeatherMap";r[r.COUNT=2]="COUNT"})(a.NoiseTextureRenderMode||(a.NoiseTextureRenderMode={}));let l=function(r){function n(){var g=r.apply(this,arguments)||this;g.mode=a.NoiseTextureRenderMode.Full;return g}b._inheritsLoose(n,r);return n}(m.ShaderTechniqueConfiguration);c.__decorate([m.parameter({count:a.NoiseTextureRenderMode.COUNT})],
l.prototype,"mode",void 0);a.NoiseTextureAtlasTechniqueConfiguration=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/NoiseTextureAtlasTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/NoiseTextureAtlas.glsl ./NoiseTextureAtlasConfiguration ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){n=function(e){function h(){return e.apply(this,arguments)||this}c._inheritsLoose(h,e);var v=h.prototype;v.initializeProgram=function(w){const t=h.shader.get().build(this.configuration);return new k.Program(w.rctx,t,g.Default3D)};v.initializePipeline=function(){return d.makePipelineState({blending:this.configuration.mode===l.NoiseTextureRenderMode.Full?d.simpleBlendingParams(f.BlendFactor.ONE,f.BlendFactor.ZERO):d.separateBlendingParams(f.BlendFactor.ZERO,f.BlendFactor.ONE,
f.BlendFactor.ONE,f.BlendFactor.ZERO),depthTest:{func:f.CompareFunction.ALWAYS},colorWrite:d.defaultColorWriteParams})};return h}(n.ShaderTechnique);n.shader=new r.ReloadableShaderModule(m.NoiseTextureAtlas,()=>new Promise((e,h)=>a(["./NoiseTextureAtlas.glsl"],e,h)));b.NoiseTextureAtlasTechnique=n;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/NoiseTextureAtlas.glsl":function(){define("exports ../views/3d/environment/NoiseTextureAtlasConfiguration ../views/3d/environment/NoiseTextureAtlasDimensions ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderModules/Float2Uniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,b,c,m,l,r,n){function g(f){const d=new n.ShaderBuilder;d.include(m.ScreenSpacePass,!1);d.fragment.code.add(r.glsl`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`);d.fragment.uniforms.add(new l.Float2Uniform("weatherTile"));f.mode===b.NoiseTextureRenderMode.Full&&d.fragment.code.add(r.glsl`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${r.glsl.float(c.TILE_ROWS)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${r.glsl.float(8)});

      float worley0 = worley(p, ${r.glsl.float(2)} * 2.0);
      float worley1 = worley(p, ${r.glsl.float(2)} * 8.0);
      float worley2 = worley(p, ${r.glsl.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${r.glsl.float(2)});
      float worley1 = worley(p, ${r.glsl.float(2)} * 2.0);
      float worley2 = worley(p, ${r.glsl.float(2)} * 4.0);
      float worley3 = worley(p, ${r.glsl.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `);d.fragment.code.add(r.glsl`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${r.glsl.float(c.WEATHER_TILE_SIZE)});

      // Get global coordinates of p
      p += weatherTile * ${r.glsl.float(c.WEATHER_TILE_SIZE)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${r.glsl.float(c.WEATHER_MAP_SIZE)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `);d.fragment.code.add(r.glsl`void main() {`);f.mode===b.NoiseTextureRenderMode.Full&&d.fragment.code.add(r.glsl`
        float padWidth = 1.0;
        float paddedSize = ${r.glsl.float(c.TILE_SIZE)} + 2.0 * padWidth;
        float tileCount = ${r.glsl.float(c.TILE_ROWS)} * ${r.glsl.float(c.TILE_ROWS)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${r.glsl.float(c.TILE_SIZE)};
          }

          if (startPadY) {
            pixel.y += ${r.glsl.float(c.TILE_SIZE)};
          }

          if (endPadX) {
            pixel.x -= ${r.glsl.float(c.TILE_SIZE)};
          }

          if (endPadY) {
            pixel.y -= ${r.glsl.float(c.TILE_SIZE)};
          }

          uv = vec2(pixel.xy / ${r.glsl.float(c.TILE_SIZE)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${r.glsl.float(c.TILE_SIZE)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${r.glsl.float(c.TILE_ROWS)} * ${r.glsl.float(c.TILE_ROWS)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${r.glsl.float(c.TILE_ROWS)} * ${r.glsl.float(c.TILE_ROWS)});
        p = p_;
        p.z /= (${r.glsl.float(c.TILE_ROWS)} * ${r.glsl.float(c.TILE_ROWS)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `);d.fragment.code.add(r.glsl`
      vec2 mapUV = ${r.glsl.float(c.WEATHER_TILE_SIZE)} * (gl_FragCoord.xy / ${r.glsl.float(c.ATLAS_SIZE)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${f.mode===b.NoiseTextureRenderMode.Full?r.glsl`gl_FragColor.ba = vec2(0.0, map);`:r.glsl`gl_FragColor = vec4(map);`};
    }
  `);return d}const k=Object.freeze(Object.defineProperty({__proto__:null,build:g},Symbol.toStringTag,{value:"Module"}));a.NoiseTextureAtlas=k;a.build=g})},"esri/views/webgl/FramebufferObject":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Logger ../../core/maybe ./BufferObject ./checkWebGLError ./context-util ./enums ./Renderbuffer ./Texture ./Util".split(" "),function(a,b,c,m,l,r,n,g,k,f,d){function e(B){return"type"in B&&"texture"===B.type}function h(B){return e(B)||
"pixelFormat"in B}function v(B,q){B.target!==g.TextureType.TEXTURE_2D&&B.target!==g.TextureType.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!");void 0!==q.width&&0<=q.width&&void 0!==q.height&&0<=q.height?q.width===B.width&&q.height===B.height||console.error("Color attachment texture must match the framebuffer's!"):(q.width=B.width,q.height=B.height)}function w(B,q){void 0!==q.width&&0<=q.width&&void 0!==q.height&&0<=q.height?q.width===B.width&&q.height===B.height||
console.error("Renderbuffer dimensions must match the framebuffer's!"):(q.width=B.width,q.height=B.height)}function t(B){return B.descriptor.target===g.TextureType.TEXTURE_CUBE_MAP?g.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X:g.TextureType.TEXTURE_2D}const x=c.getLogger("esri.views.webgl.FrameBufferObject");c=function(){function B(u,C,z=null,A=null){this._context=u;this._stencilAttachment=this._depthAttachment=this._glName=null;this._colorAttachments=new Map;this._initialized=!1;this._desc={...C};u.instanceCounter.increment(g.ResourceType.FramebufferObject,
this);if(m.isSome(z))for(Array.isArray(z)||(z=[z]),u=0;u<z.length;++u){C=z[u];const y=g.ColorAttachment.COLOR_ATTACHMENT0+u;let D;h(C)?(e(C)?(D=C.descriptor,this._colorAttachments.set(y,C)):(D=C,this._colorAttachments.set(y,new f.Texture(this._context,D))),v(D,this._desc)):("type"in C&&"renderbuffer"===C.type?(D=C.descriptor,this._colorAttachments.set(y,C)):(D=C,this._colorAttachments.set(y,new k.Renderbuffer(this._context,D))),w(D,this._desc));this._validateColorAttachmentPoint(y)}if(m.isSome(A))if(h(A))this._context.capabilities.depthTexture||
console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),e(A)?(z=A.descriptor,this._depthStencilTexture=A):(z=A,this._depthStencilTexture=new f.Texture(this._context,z)),v(z,this._desc);else{var p;"type"in A&&"renderbuffer"===A.type?z=A.descriptor:(z=A,A=new k.Renderbuffer(this._context,z));u=null!=(p=this._desc.depthStencilTarget)?p:g.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER;u===g.DepthStencilTargetType.STENCIL_RENDER_BUFFER?this._stencilAttachment=
A:u===g.DepthStencilTargetType.DEPTH_RENDER_BUFFER||u===g.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER?this._depthAttachment=A:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER');w(z,this._desc)}}var q=B.prototype;q.dispose=function(){if(this._desc){var u=this._context.getBoundFramebufferObject();this._disposeColorAttachments();this._disposeDepthStencilAttachments();this._glName&&(this._context.gl.deleteFramebuffer(this._glName),
this._glName=null);this._context.bindFramebuffer(u);this._context.instanceCounter.decrement(g.ResourceType.FramebufferObject,this);this._desc=null}};q.getColorTexture=function(u){return(u=this._colorAttachments.get(u))&&e(u)?u:null};q.attachColorTexture=function(u,C=g.ColorAttachment.COLOR_ATTACHMENT0){u&&(this._validateColorAttachmentPoint(C),v(u.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(u.glName,C)),
this._colorAttachments.set(C,u))};q.detachColorTexture=function(u=g.ColorAttachment.COLOR_ATTACHMENT0){const C=this._colorAttachments.get(u);if(e(C))return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,u)),this._colorAttachments.delete(u),C};q.setColorTextureTarget=function(u,C=g.ColorAttachment.COLOR_ATTACHMENT0){const z=this._colorAttachments.get(C);e(z)&&this._framebufferTexture2D(z.glName,C,u)};q.attachDepthStencilTexture=function(u){if(!m.isNone(u)){var C=
u.descriptor;C.pixelFormat!==g.PixelFormat.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");C.dataType!==g.PixelType.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!");this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");v(C,this._desc);this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==
g.DepthStencilTargetType.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=g.DepthStencilTargetType.DEPTH_STENCIL_TEXTURE);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(u.glName,g.DepthStencilAttachment));this._depthStencilTexture=u}};q.detachDepthStencilTexture=function(){const u=this._depthStencilTexture;u&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,g.DepthStencilAttachment));
this._depthStencilTexture=null;return u};q.attachDepthStencilBuffer=function(u){if(!m.isNone(u)){var C=u.descriptor;C.internalFormat!==g.RenderbufferFormat.DEPTH_STENCIL&&C.internalFormat!==g.RenderbufferFormat.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat");w(C,this._desc);this._disposeDepthStencilAttachments();this._desc.depthStencilTarget=C.internalFormat===g.RenderbufferFormat.DEPTH_STENCIL?g.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER:g.DepthStencilTargetType.DEPTH_RENDER_BUFFER;
this._initialized&&(this._context.bindFramebuffer(this),C=this._context.gl,C.framebufferRenderbuffer(g.FramebufferTarget.FRAMEBUFFER,this._desc.depthStencilTarget===g.DepthStencilTargetType.DEPTH_RENDER_BUFFER?C.DEPTH_ATTACHMENT:C.DEPTH_STENCIL_ATTACHMENT,C.RENDERBUFFER,u.glName));this._depthAttachment=u}};q.detachDepthStencilBuffer=function(){const u=this._context.gl,C=this._depthAttachment;C&&this._initialized&&(this._context.bindFramebuffer(this),u.framebufferRenderbuffer(g.FramebufferTarget.FRAMEBUFFER,
this._desc.depthStencilTarget===g.DepthStencilTargetType.DEPTH_RENDER_BUFFER?u.DEPTH_ATTACHMENT:u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,null));this._depthAttachment=null;return C};q.detachAll=function(){this._colorAttachments.forEach((u,C)=>this._detachColorAttachment(C));this.detachDepthStencilBuffer();this.detachDepthStencilTexture()};q.copyToTexture=function(u,C,z,A,p,y,D){(0>u||0>C||0>p||0>y)&&console.error("Offsets cannot be negative!");(0>=z||0>=A)&&console.error("Copy width and height must be greater than zero!");
var E=this._desc;const F=D.descriptor;D.descriptor.target!==g.TextureType.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!");(u+z>E.width||C+A>E.height||p+z>F.width||y+A>F.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");E=this._context;D=E.bindTexture(D,f.Texture.TEXTURE_UNIT_FOR_UPDATES);E.setActiveTexture(f.Texture.TEXTURE_UNIT_FOR_UPDATES);E.bindFramebuffer(this);E.gl.copyTexSubImage2D(g.TextureType.TEXTURE_2D,0,p,y,u,
C,z,A);E.bindTexture(D,f.Texture.TEXTURE_UNIT_FOR_UPDATES)};q.readPixels=function(u,C,z,A,p,y,D){(0>=z||0>=A)&&console.error("Copy width and height must be greater than zero!");D||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(u,C,z,A,p,y,D)};q.readPixelsAsync=function(){var u=b._asyncToGenerator(function*(C,z,A,p,y,D,E){if(this._context.type!==n.ContextType.WEBGL2)r.webglDebugEnabled()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),
this.readPixels(C,z,A,p,y,D,E);else{var F=this._context.gl,G=l.BufferObject.createPixelPack(this._context,g.Usage.STREAM_READ,E.byteLength);this._context.bindBuffer(G);this._context.bindFramebuffer(this);F.readPixels(C,z,A,p,y,D,0);this._context.unbindBuffer(g.BufferType.PIXEL_PACK_BUFFER);yield G.getSubDataAsync(E);G.dispose()}});return function(C,z,A,p,y,D,E){return u.apply(this,arguments)}}();q.resize=function(u,C){const z=this._desc;if(z.width!==u||z.height!==C)if(this._initialized){z.width=u;
z.height=C;this._colorAttachments.forEach(A=>{A&&A.resize(u,C)});if(null!=this._depthStencilTexture)this._depthStencilTexture.resize(u,C);else if(this._depthAttachment||this._stencilAttachment)this._depthAttachment&&this._depthAttachment.resize(u,C),this._stencilAttachment&&this._stencilAttachment.resize(u,C);this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null);this._initialized=!1}else z.width=u,z.height=C,this._colorAttachments.forEach(A=>{A&&A.resize(u,C)}),this._depthStencilTexture&&
this._depthStencilTexture.resize(u,C)};q.initializeAndBind=function(u=g.FramebufferTarget.FRAMEBUFFER){var C,z,A,p;const y=this._context.gl;if(this._initialized)y.bindFramebuffer(u,this.glName);else{this._glName&&y.deleteFramebuffer(this._glName);var D=this._context,E=y.createFramebuffer(),F=this._desc,G=null!=(C=F.colorTarget)?C:g.TargetType.RENDER_BUFFER;C=null!=(z=F.width)?z:1;z=null!=(A=F.height)?A:1;y.bindFramebuffer(u,E);0===this._colorAttachments.size&&(G===g.TargetType.TEXTURE||G===g.TargetType.CUBEMAP?
this._colorAttachments.set(g.ColorAttachment.COLOR_ATTACHMENT0,new f.Texture(D,{target:this.descriptor.colorTarget===g.TargetType.CUBEMAP?g.TextureType.TEXTURE_CUBE_MAP:g.TextureType.TEXTURE_2D,pixelFormat:g.PixelFormat.RGBA,dataType:g.PixelType.UNSIGNED_BYTE,samplingMode:g.TextureSamplingMode.NEAREST,wrapMode:g.TextureWrapMode.CLAMP_TO_EDGE,width:F.width,height:F.height})):(A=new k.Renderbuffer(D,{internalFormat:g.SizedPixelFormat.RGBA4,width:C,height:z}),this._colorAttachments.set(g.ColorAttachment.COLOR_ATTACHMENT0,
A)));this._colorAttachments.forEach((P,K)=>{P&&(e(P)?this._framebufferTexture2D(P.glName,K,t(P),u):y.framebufferRenderbuffer(u,K,y.RENDERBUFFER,P.glName))});A=null!=(p=F.depthStencilTarget)?p:g.DepthStencilTargetType.NONE;switch(A){case g.DepthStencilTargetType.DEPTH_RENDER_BUFFER:case g.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER:this._depthAttachment||(this._depthAttachment=new k.Renderbuffer(D,{internalFormat:F.depthStencilTarget===g.DepthStencilTargetType.DEPTH_RENDER_BUFFER?g.RenderbufferFormat.DEPTH_COMPONENT16:
g.RenderbufferFormat.DEPTH_STENCIL,width:C,height:z}));y.framebufferRenderbuffer(u,A===g.DepthStencilTargetType.DEPTH_RENDER_BUFFER?y.DEPTH_ATTACHMENT:y.DEPTH_STENCIL_ATTACHMENT,y.RENDERBUFFER,this._depthAttachment.glName);break;case g.DepthStencilTargetType.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new k.Renderbuffer(D,{internalFormat:g.RenderbufferFormat.STENCIL_INDEX8,width:C,height:z}));y.framebufferRenderbuffer(u,y.STENCIL_ATTACHMENT,y.RENDERBUFFER,this._stencilAttachment.glName);
break;case g.DepthStencilTargetType.DEPTH_STENCIL_TEXTURE:this._depthStencilTexture||(D.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new f.Texture(D,{target:g.TextureType.TEXTURE_2D,pixelFormat:g.PixelFormat.DEPTH_STENCIL,dataType:g.PixelType.UNSIGNED_INT_24_8,samplingMode:g.TextureSamplingMode.NEAREST,wrapMode:g.TextureWrapMode.CLAMP_TO_EDGE,width:C,
height:z})),this._framebufferTexture2D(this._depthStencilTexture.glName,y.DEPTH_STENCIL_ATTACHMENT,t(this._depthStencilTexture),u)}r.webglValidateShadersEnabled()&&y.checkFramebufferStatus(u)!==y.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");this._glName=E;this._initialized=!0}};q._framebufferTexture2D=function(u,C=g.ColorAttachment.COLOR_ATTACHMENT0,z=g.TextureType.TEXTURE_2D,A=g.FramebufferTarget.FRAMEBUFFER,p=0){this._context.gl.framebufferTexture2D(A,C,z,u,p)};q._detachColorAttachment=
function(u){r.webglDebugEnabled()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");const C=this._context.gl,z=this._colorAttachments.get(u);e(z)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,u)):this._initialized&&(this._context.bindFramebuffer(this),C.framebufferRenderbuffer(g.FramebufferTarget.FRAMEBUFFER,u,C.RENDERBUFFER,null));this._colorAttachments.delete(u);return z};q._disposeColorAttachments=
function(){this._colorAttachments.forEach((u,C)=>{this._detachColorAttachment(C);u.dispose()});this._colorAttachments.clear()};q._disposeDepthStencilAttachments=function(){const u=this._context.gl;this._depthAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),u.framebufferRenderbuffer(g.FramebufferTarget.FRAMEBUFFER,this._desc.depthStencilTarget===g.DepthStencilTargetType.DEPTH_RENDER_BUFFER?u.DEPTH_ATTACHMENT:u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,null)),this._depthAttachment.dispose(),
this._depthAttachment=null);this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),u.framebufferRenderbuffer(g.FramebufferTarget.FRAMEBUFFER,u.STENCIL_ATTACHMENT,u.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null);this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,u.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)};q._validateColorAttachmentPoint=
function(u){if(-1===B._MAX_COLOR_ATTACHMENTS){const C=this._context.capabilities.drawBuffers;B._MAX_COLOR_ATTACHMENTS=C?this._context.gl.getParameter(C.MAX_COLOR_ATTACHMENTS):1}u-=g.ColorAttachment.COLOR_ATTACHMENT0;u+1>B._MAX_COLOR_ATTACHMENTS&&x.error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${u+1}. Implementation supports up to ${B._MAX_COLOR_ATTACHMENTS} color attachments`)};b._createClass(B,[{key:"glName",get:function(){return this._glName}},{key:"descriptor",
get:function(){return this._desc}},{key:"colorTexture",get:function(){const u=this._colorAttachments.get(g.ColorAttachment.COLOR_ATTACHMENT0);return u&&e(u)?u:null}},{key:"colorAttachment",get:function(){return this._colorAttachments.get(g.ColorAttachment.COLOR_ATTACHMENT0)}},{key:"depthStencilAttachment",get:function(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}},{key:"depthStencilTexture",get:function(){return this._depthStencilTexture}},{key:"width",get:function(){return this._desc.width}},
{key:"height",get:function(){return this._desc.height}},{key:"gpuMemoryUsage",get:function(){return[...this._colorAttachments].reduce((u,[,C])=>u+d.getGpuMemoryUsage(C),0)+d.getGpuMemoryUsage(this.depthStencilAttachment)}}]);return B}();c._MAX_COLOR_ATTACHMENTS=-1;a.FramebufferObject=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/Renderbuffer":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./context-util","./enums"],
function(a,b,c,m){let l=function(){function r(g,k){this._context=g;this._desc=k;this.type="renderbuffer";this._context.instanceCounter.increment(m.ResourceType.Renderbuffer,this);g=this._context.gl;this.glName=g.createRenderbuffer();this._context.bindRenderbuffer(this);const {width:f,height:d,internalFormat:e,multisampled:h}=k;if(h){if(this._context.type!==c.ContextType.WEBGL2)throw Error("Multisampled renderbuffers are not supported in WebGL1!");g.renderbufferStorageMultisample(g.RENDERBUFFER,this.samples,
e,f,d)}else g.renderbufferStorage(g.RENDERBUFFER,e,f,d)}var n=r.prototype;n.resize=function(g,k){const f=this._desc;if(f.width!==g||f.height!==k)f.width=g,f.height=k,g=this._context.gl,this._context.bindRenderbuffer(this),f.multisampled?g.renderbufferStorageMultisample(g.RENDERBUFFER,this.samples,f.internalFormat,f.width,f.height):g.renderbufferStorage(g.RENDERBUFFER,f.internalFormat,f.width,f.height)};n.dispose=function(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(m.ResourceType.Renderbuffer,
this),this._context=null)};b._createClass(r,[{key:"descriptor",get:function(){return this._desc}},{key:"samples",get:function(){const g=this._desc.samples,k=this._context.parameters.maxSamples;return g?Math.min(g,k):k}}]);return r}();a.Renderbuffer=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/BindParameters":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec2f64 ../../environment/CloudsCompositionParameters ../core/shaderLibrary/shading/MultipassGeometryTest.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/ScreenSpaceReflections.glsl ./RenderSlot ../lighting/SceneLighting".split(" "),
function(a,b,c,m,l,r,n,g,k){let f=function(){function d(e,h,v){this.shadowMap=e;this.ssaoHelper=h;this.slicePlane=v;this.slot=g.RenderSlot.OPAQUE_MATERIAL;this.hasOccludees=!1;this.enableFillLights=!0;this._inverseViewport=c.create();this.lighting=new k.SceneLighting;this.ssr=new n.SSRUniforms;this.multipassTerrain=new r.MultipassTerrainUniforms;this.multipassGeometry=new l.MultipassGeometryUniforms;this.clouds=new m.CloudsCompositionParameters;this.overlays=[]}b._createClass(d,[{key:"camera",get:function(){return this._camera},
set:function(e){this._camera=this.ssr.camera=e;this._inverseViewport[0]=1/e.fullViewport[2];this._inverseViewport[1]=1/e.fullViewport[3]}},{key:"inverseViewport",get:function(){return this._inverseViewport}}]);return d}();a.BindParameters=f;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl":function(){define(["exports","../output/ReadLinearDepth.glsl","../../shaderModules/Float2PassUniform",
"../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,c,m,l){a.MultipassGeometryUniforms=function(){this.enabled=!1};a.multipassGeometryTest=function(r){r.include(b.ReadLinearDepth);r.uniforms.add([new l.Texture2DPassUniform("geometryDepthTexture",(n,g)=>g.multipassGeometry.linearDepthTexture),new c.Float2PassUniform("nearFar",(n,g)=>g.camera.nearFar)]);r.code.add(m.glsl`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl":function(){define(["exports","../output/ReadLinearDepth.glsl","../../shaderModules/Float2PassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,c,m,l){a.MultipassTerrainUniforms=function(){this.cullAboveGround=this.enabled=!1};a.multipassTerrainTest=function(r,n){n.hasMultipassTerrain&&
(r.fragment.include(b.ReadLinearDepth),r.fragment.uniforms.add(new l.Texture2DPassUniform("terrainDepthTexture",(g,k)=>k.multipassTerrain.linearDepthTexture)),r.fragment.uniforms.add(new c.Float2PassUniform("nearFar",(g,k)=>k.camera.nearFar)),r.fragment.uniforms.add(new c.Float2PassUniform("inverseViewport",(g,k)=>k.inverseViewport)),r.fragment.code.add(m.glsl`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${n.cullAboveGround?"\x3e":"\x3c\x3d"} terrainDepth){
        discard;
      }
    }
  `))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl":function(){define("exports ../../../../../../chunks/mat4f64 ../output/ReadLinearDepth.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,c,m,l,r,n,g){a.SSRUniforms=
function(){this.reprojectionMatrix=b.create()};a.ScreenSpaceReflections=function(k,f){const d=k.fragment.uniforms;d.add(new m.Float2PassUniform("nearFar",(e,h)=>h.camera.nearFar));d.add(new g.Texture2DPassUniform("depthMap",(e,h)=>h.linearDepthTexture));d.add(new n.Matrix4PassUniform("view",(e,h)=>h.ssr.camera.viewMatrix));d.add(new n.Matrix4PassUniform("proj",(e,h)=>h.ssr.camera.projectionMatrix));d.add(new l.FloatPassUniform("invResolutionHeight",(e,h)=>1/h.ssr.camera.height));d.add(new g.Texture2DPassUniform("lastFrameColorMap",
(e,h)=>h.ssr.lastFrameColorTexture));d.add(new n.Matrix4PassUniform("reprojectionMatrix",(e,h)=>h.ssr.reprojectionMatrix));k.fragment.include(c.ReadLinearDepth);k.fragment.code.add(r.glsl`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${f.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/RenderSlot":function(){define(["exports"],function(a){a.RenderSlot=void 0;var b=a.RenderSlot||(a.RenderSlot={});b[b.INTEGRATED_MESH=0]="INTEGRATED_MESH";b[b.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN";b[b.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL";b[b.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL";b[b.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN";b[b.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=
5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL";b[b.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN";b[b.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL";b[b.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL";b[b.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS";b[b.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE";b[b.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT";b[b.LASERLINES=12]="LASERLINES";b[b.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL";
b[b.HUD_MATERIAL=14]="HUD_MATERIAL";b[b.LABEL_MATERIAL=15]="LABEL_MATERIAL";b[b.LINE_CALLOUTS=16]="LINE_CALLOUTS";b[b.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH";b[b.DRAPED_MATERIAL=18]="DRAPED_MATERIAL";b[b.DRAPED_WATER=19]="DRAPED_WATER";b[b.VOXEL=20]="VOXEL";b[b.MAX_SLOTS=21]="MAX_SLOTS";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./Lightsources ./SphericalHarmonics".split(" "),
function(a,b,c,m,l,r){let n=function(){function k(){this._shOrder=2;this._oldSunlight={direction:m.create(),ambient:{color:m.create(),intensity:1},diffuse:{color:m.create(),intensity:1}};this.groundLightingFactor=this.globalFactor=.5;this._sphericalHarmonics=new l.SphericalHarmonicsAmbientLight;this._mainLight={intensity:m.create(),direction:m.fromValues(1,0,0),castShadows:!1,specularStrength:1,environmentStrength:1}}k.prototype.set=function(f){r.combineLights(f,this._shOrder,this._mainLight,this._sphericalHarmonics);
c.copy(this._oldSunlight.direction,this._mainLight.direction);f=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*f;this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*f;this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*f;c.scale(this._oldSunlight.diffuse.color,this._mainLight.intensity,f);c.copy(g,this._oldSunlight.diffuse.color);c.scale(g,g,.4*this.globalFactor);c.add(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,
g)};b._createClass(k,[{key:"sh",get:function(){return this._sphericalHarmonics}},{key:"mainLight",get:function(){return this._mainLight}},{key:"lightingMainDirection",get:function(){return this._mainLight.direction}},{key:"old",get:function(){return this._oldSunlight}}]);return k}();const g=m.create();a.SceneLighting=n;a.ambientBoost=.4;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["exports",
"../../../../chunks/vec3f64"],function(a,b){a.AmbientLight=function(c=b.create()){this.intensity=c};a.FillLight=function(c=b.create(),m=b.fromValues(.57735,.57735,.57735)){this.intensity=c;this.direction=m};a.MainLight=function(c=b.create(),m=b.fromValues(.57735,.57735,.57735),l=!0,r=1,n=1){this.intensity=c;this.direction=m;this.castShadows=l;this.specularStrength=r;this.environmentStrength=n};a.SphericalHarmonicsAmbientLight=function(){this.r=[0];this.g=[0];this.b=[0]};Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../lib/LongVectorMath ./Lightsources".split(" "),function(a,b,c,m,l,r){function n(u){return(u+1)*(u+1)}function g(u){return b.clamp(Math.floor(Math.sqrt(u)-1),0,2)}function k(u,C,z){const A=u[0],p=u[1];u=u[2];z=z||[];z.length=n(C);0<=C&&(z[0]=.28209479177);1<=C&&(z[1]=.4886025119*
A,z[2]=.4886025119*u,z[3]=.4886025119*p);2<=C&&(z[4]=1.09254843059*A*p,z[5]=1.09254843059*p*u,z[6]=.31539156525*(3*u*u-1),z[7]=1.09254843059*A*u,z[8]=.54627421529*(A*A-p*p));return z}function f(u,C){u=n(u);C=C||{r:[],g:[],b:[]};C.r.length=C.g.length=C.b.length=u;for(let z=0;z<u;z++)C.r[z]=C.g[z]=C.b[z]=0;return C}function d(u,C){const z=g(C.r.length);for(const A of u)c.negate(B,A.direction),k(B,z,t),l.elementwiseProduct(t,q),l.scalarProduct(t,A.intensity[0],x),l.add(C.r,x),l.scalarProduct(t,A.intensity[1],
x),l.add(C.g,x),l.scalarProduct(t,A.intensity[2],x),l.add(C.b,x);return C}function e(u,C){k(B,0,t);for(const z of u)C.r[0]+=t[0]*q[0]*z.intensity[0]*4*Math.PI,C.g[0]+=t[0]*q[0]*z.intensity[1]*4*Math.PI,C.b[0]+=t[0]*q[0]*z.intensity[2]*4*Math.PI;return C}const h=[],v=[],w=[],t=[0],x=[0],B=m.create(),q=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];a.combineLights=function(u,C,z,A){f(C,A);c.set(z.intensity,0,0,0);C=!1;h.length=0;v.length=0;w.length=0;for(const p of u)p instanceof
r.MainLight&&!C?(c.copy(z.direction,p.direction),c.copy(z.intensity,p.intensity),z.specularStrength=p.specularStrength,z.environmentStrength=p.environmentStrength,z.castShadows=p.castShadows,C=!0):p instanceof r.MainLight||p instanceof r.FillLight?h.push(p):p instanceof r.AmbientLight?v.push(p):p instanceof r.SphericalHarmonicsAmbientLight&&w.push(p);d(h,A);e(v,A);for(const p of w)l.add(A.r,p.r),l.add(A.g,p.g),l.add(A.b,p.b)};a.computeCoefficients=k;a.initSHCoefficients=f;a.numberOfCoefficients=n;
a.orderFromNumberOfCoefficients=g;a.projectAmbientLights=e;a.projectFillLights=d;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["exports"],function(a){a.add=function(b,c,m){m=m||b;m.length=b.length;for(let l=0;l<b.length;l++)m[l]=b[l]+c[l];return m};a.dotProduct=function(b,c){let m=0;for(let l=0;l<b.length;l++)m+=b[l]*c[l];return m};a.elementwiseProduct=function(b,c,m){m=m||b;m.length=b.length;
for(let l=0;l<b.length;l++)m[l]=b[l]*c[l];return m};a.scalarProduct=function(b,c,m){m=m||b;m.length=b.length;for(let l=0;l<b.length;l++)m[l]=b[l]*c;return m};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/Fog":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../geometry/projectionEllipsoid ./atmosphereUtils ./FogTechnique ./weather ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C){a.Fog=function(A){function p(D){var E=A.call(this,D)||this;E._fogColor=h.create();E._fogColorAtNight=h.create();E._cameraDirection=h.create();E._foggyFadeStart=.95;E._foggyFadeEnd=1;E._hazeFadeStart=.7;E._hazeFadeEnd=1;E._strength=4E-6;E._vao=u.createQuadVAO(D.context.renderContext.rctx,q.Pos2Tex);D=v.getReferenceEllipsoid(D.view.spatialReference);E._planetRadius=D.radius;E._atmosphereRadius=D.radius+w.atmosphereHeight;return E}b._inheritsLoose(p,
A);var y=p.prototype;y.destroy=function(){this._hazeFogTechnique=r.releaseMaybe(this._hazeFogTechnique);this._thickFogTechnique=r.releaseMaybe(this._thickFogTechnique);this._vao=r.disposeMaybe(this._vao)};y.when=function(){return Promise.resolve()};y.render=function(D,E,F){if(0!==this.view.basemapTerrain.baseOpacity||E)if(this._update(D,E,F),!(0>=this._fogAmount)){var G=E?this.thickFogTechnique:this.hazeFogTechnique;if(G.compiled){var P=D.offscreenRenderingHelper,K=D.rctx.bindTechnique(G,z,D.bindParameters);
P.renderDepthDetached(()=>{K.bindTexture("depthTex",P.depthTexture);this._renderFog(G.program,D)})}else this.context.requestRender()}};y._renderFog=function(D,E){if(r.isNone(this._vao))return!1;const F=E.rctx;D.setUniform3fv("cameraPosition",E.bindParameters.camera.eye);D.setUniform1f("atmosphereC",this._atmosphereC);D.setUniform1f("fogStrength",this._strength);D.setUniform1f("fogAmount",this._fogAmount);D.setUniform3fv("fogColor",this._fogColor);F.bindVAO(this._vao);D.assertCompatibleVertexAttributeLocations(this._vao);
F.drawArrays(C.PrimitiveType.TRIANGLE_STRIP,0,4);return!0};y._update=function(D,E,F){var G=D.bindParameters.camera;const P=E?.1:0;F?e.set(this._fogColor,.5,.5,.5):E?e.set(this._fogColor,1.5,1.5,1.5):e.set(this._fogColor,.24,.44,.8);e.scale(this._fogColorAtNight,this._fogColor,P);e.normalize(this._cameraDirection,G.eye);D=Math.max(0,e.dot(this._cameraDirection,D.bindParameters.lighting.lightingMainDirection));e.lerp(this._fogColor,this._fogColorAtNight,this._fogColor,D);G=e.length(G.eye);this._atmosphereC=
G*G-this._atmosphereRadius*this._atmosphereRadius;this._fogAmount=E?1-l.smoothstep(this._foggyFadeStart*x.weatherHeightLimit,this._foggyFadeEnd*x.weatherHeightLimit,Math.abs(G-this._planetRadius)):1-l.smoothstep(this._hazeFadeStart*x.weatherHeightLimit,this._hazeFadeEnd*x.weatherHeightLimit,Math.abs(G-this._planetRadius))};p.isSupported=function(D){return D.capabilities.depthTexture};b._createClass(p,[{key:"_shaderTechniqueRepository",get:function(){return this.context.shaderTechniqueRepository}},
{key:"strength",get:function(){return this._strength},set:function(D){this._strength=D}},{key:"thickFogTechnique",get:function(){if(r.isNone(this._thickFogTechnique)){const D=new t.FogTechniqueConfiguration;D.haze=!1;this._thickFogTechnique=this._shaderTechniqueRepository.acquire(t.FogTechnique,D)}return this._thickFogTechnique}},{key:"hazeFogTechnique",get:function(){if(r.isNone(this._hazeFogTechnique)){const D=new t.FogTechniqueConfiguration;D.haze=!0;this._hazeFogTechnique=this._shaderTechniqueRepository.acquire(t.FogTechnique,
D)}return this._hazeFogTechnique}}]);return p}(m);c.__decorate([n.property({constructOnly:!0})],a.Fog.prototype,"context",void 0);c.__decorate([n.property({constructOnly:!0})],a.Fog.prototype,"view",void 0);a.Fog=c.__decorate([d.subclass("esri.views.3d.environment.Fog")],a.Fog);const z=new B.NoParameters;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/FogTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/Fog.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e){n=function(h){function v(){return h.apply(this,arguments)||this}c._inheritsLoose(v,h);var w=v.prototype;w.initializeProgram=function(t){const x=v.shader.get().build(this.configuration);return new f.Program(t.rctx,x,k.Default3D)};w.initializePipeline=function(){return this.configuration.haze?e.makePipelineState({blending:e.separateBlendingParams(d.BlendFactor.ONE,d.BlendFactor.ZERO,d.BlendFactor.ONE_MINUS_SRC_COLOR,d.BlendFactor.ONE),colorWrite:e.defaultColorWriteParams}):
e.makePipelineState({blending:e.separateBlendingParams(d.BlendFactor.SRC_ALPHA,d.BlendFactor.ZERO,d.BlendFactor.ONE_MINUS_SRC_ALPHA,d.BlendFactor.ONE),colorWrite:e.defaultColorWriteParams})};return v}(n.ShaderTechnique);n.shader=new r.ReloadableShaderModule(l.Fog,()=>new Promise((h,v)=>a(["./Fog.glsl"],h,v)));l=function(h){function v(){var w=h.apply(this,arguments)||this;w.haze=!1;return w}c._inheritsLoose(v,h);return v}(g.ShaderTechniqueConfiguration);m.__decorate([g.parameter()],l.prototype,"haze",
void 0);b.FogTechnique=n;b.FogTechniqueConfiguration=l;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/Fog.glsl":function(){define("exports ./mat4 ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3Uniform ../views/3d/webgl-engine/core/shaderModules/FloatUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){function w(x){const B=new e.ShaderBuilder;B.attributes.add(v.VertexAttribute.POSITION,"vec2");B.include(m.TextureCoordinateAttribute,{textureCoordinateType:m.TextureCoordinateAttributeType.Default});B.varyings.add("worldRay","vec3");B.varyings.add("eyeDir","vec3");const {vertex:q,fragment:u}=B;q.uniforms.add([new d.Matrix4PassUniform("inverseProjectionMatrix",(C,z)=>z.camera.inverseProjectionMatrix),new d.Matrix4PassUniform("inverseViewMatrix",(C,z)=>b.invert(t,
z.camera.viewMatrix))]);q.code.add(f.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`);u.uniforms.add(new k.FloatUniform("atmosphereC"));u.uniforms.add(new g.Float3Uniform("cameraPosition"));u.uniforms.add(new n.Float2PassUniform("nearFar",(C,z)=>z.camera.nearFar));u.uniforms.add(new h.Texture2DUniform("depthTex"));u.uniforms.add(new k.FloatUniform("fogStrength"));u.uniforms.add(new k.FloatUniform("fogAmount"));u.uniforms.add(new g.Float3Uniform("fogColor"));B.include(r.Gamma);u.include(l.ReadLinearDepth);u.code.add(f.glsl`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`);u.code.add(f.glsl`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`);u.code.add(f.glsl`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${x.haze?f.glsl`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `);return B}const t=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:w},Symbol.toStringTag,{value:"Module"}));a.Fog=c;a.build=w})},"esri/views/3d/environment/PanoramicAtmosphere":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../support/requestImageUtils ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechnique ./SimpleAtmosphereTechniqueConfiguration ./resources/SimpleAtmosphereTexture ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z){const A=c.getLogger("esri.views.3d.environment.PanoramicAtmosphere");c=function(){function D(){this.type="panoramic";this._techniqueConfig=new d.SimpleAtmosphereTechniqueConfiguration;this._passParameters=new k.SimpleAtmospherePassParameters;this._readyResolver=l.createResolver();this._readyController=new AbortController}var E=D.prototype;E.destroy=function(){this._readyResolver.reject();this._passParameters.texture=m.disposeMaybe(this._passParameters.texture);
this._vao=m.disposeMaybe(this._vao);this._readyController=m.abortMaybe(this._readyController)};E.when=function(){return this._readyResolver.promise};E.initializeRenderContext=function(F){this._techniqueConfig.geometry=d.SimpleAtmosphereGeometry.Cylinder;this._technique=F.shaderTechniqueRepository.acquire(f.SimpleAtmosphereTechnique,this._techniqueConfig);const G=F.renderContext.rctx;this._vao=this._createVertexArrayObject(G);this._vaoCount=C.vertexCount(this._vao,"geometry");g.requestImage(e,{signal:this._readyController.signal}).then(P=>
{this._passParameters.texture=new u.Texture(G,{pixelFormat:q.PixelFormat.RGBA,dataType:q.PixelType.UNSIGNED_BYTE,wrapMode:q.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:q.TextureSamplingMode.LINEAR,flipped:!0},P);F.requestRender();this._readyController=null;this._readyResolver.resolve()}).catch(P=>{l.isAbortError(P)||A.error("Unable to initialize atmosphere: image request failed",P);this._readyResolver.reject()})};E.render=function(F){const G=F.rctx,P=G.bindTechnique(this._technique,this._passParameters,
F.bindParameters);var K=p;r.copy(K,F.bindParameters.camera.viewMatrix);K[12]=0;K[13]=0;K[14]=0;K[15]=1;P.setUniformMatrix4fv("view",p);G.bindVAO(this._vao);P.assertCompatibleVertexAttributeLocations(this._vao);G.drawArrays(q.PrimitiveType.TRIANGLES,0,this._vaoCount)};E.renderHaze=function(){return!1};E._createVertexArrayObject=function(F){var G=t.createPolySphereGeometry(1,2,!1);const P=G.indices.get(x.VertexAttribute.POSITION);for(var K=0;K<P.length;K+=3){var N=P[K];P[K]=P[K+2];P[K+2]=N}G=G.vertexAttributes.get(x.VertexAttribute.POSITION).data;
K=y.createBuffer(P.length);N=K.position;for(let M=0;M<P.length;++M){const L=3*P[M];N.set(M,0,G[L]);N.set(M,1,G[L+1]);N.set(M,2,G[L+2])}return new z.VertexArrayObject(F,w.Default3D,{geometry:h.glLayout(y)},{geometry:B.BufferObject.createVertex(F,q.Usage.STATIC_DRAW,K.buffer)})};b._createClass(D,[{key:"canRender",get:function(){return null!=this._passParameters.texture}}]);return D}();const p=n.create(),y=v.newLayout().vec3f(x.VertexAttribute.POSITION);a.PanoramicAtmosphere=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/support/requestImageUtils":function(){define(["exports","../chunks/_rollupPluginBabelHelpers","../request"],function(a,b,c){function m(){m=b._asyncToGenerator(function*(l,r){({data:l}=yield c(l,{responseType:"image",...r}));return l});return m.apply(this,arguments)}a.requestImage=function(l,r){return m.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/SimpleAtmosphere.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../views/3d/environment/SimpleAtmosphereTechniqueConfiguration ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderModules/Float2Uniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3Uniform ../views/3d/webgl-engine/core/shaderModules/FloatUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/Matrix4Uniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){function w(B){const q=new e.ShaderBuilder,{vertex:u,fragment:C}=q;B.geometry===c.SimpleAtmosphereGeometry.Underground?(q.attributes.add(v.VertexAttribute.POSITION,"vec2"),q.varyings.add("color","vec4"),u.uniforms.add([new r.Float3PassUniform("lightingMainDirection",(z,A)=>A.lighting.lightingMainDirection),new n.Float3Uniform("cameraPosition"),new g.FloatUniform("undergroundFadeAlpha")]),u.code.add(k.glsl`void main(void) {
float ndotl = dot(normalize(cameraPosition), lightingMainDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),C.code.add(k.glsl`void main() {
gl_FragColor = color;
}`)):(q.include(m.Transform),q.attributes.add(v.VertexAttribute.POSITION,"vec3"),q.varyings.add("vtc","vec2"),q.varyings.add("falloff","float"),B=B.geometry===c.SimpleAtmosphereGeometry.Cylinder,u.uniforms.add([new f.Matrix4PassUniform("proj",(z,A)=>A.camera.projectionMatrix),new d.Matrix4Uniform("view"),new r.Float3PassUniform("lightingMainDirection",(z,A)=>A.lighting.lightingMainDirection)]),B||(q.varyings.add("innerFactor","float"),u.uniforms.add(new n.Float3Uniform("silCircleCenter")),u.uniforms.add(new n.Float3Uniform("silCircleV1")),
u.uniforms.add(new n.Float3Uniform("silCircleV2")),u.uniforms.add(new l.Float2Uniform("texV")),u.uniforms.add(new g.FloatUniform("innerScale"))),u.code.add(k.glsl`
		void main(void) {
      ${B?k.glsl`
      vec3 pos = position;
      float ndotl = lightingMainDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:k.glsl`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${k.glsl.float(.04908738515625)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), lightingMainDirection);
      vtc.x = position.x  * ${k.glsl.float(.0078125)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),C.uniforms.add(new h.Texture2DPassUniform("tex",z=>z.texture)),B||C.uniforms.add(new g.FloatUniform("altitudeFade")),C.code.add(k.glsl`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${B?k.glsl`gl_FragColor = atmosphereColor;`:k.glsl`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`));return q}let t=function(B){function q(){return B.apply(this,arguments)||this}b._inheritsLoose(q,B);return q}(k.NoParameters);const x=Object.freeze(Object.defineProperty({__proto__:null,SimpleAtmospherePassParameters:t,build:w},Symbol.toStringTag,{value:"Module"}));a.SimpleAtmosphere=x;a.SimpleAtmospherePassParameters=t;a.build=w})},"esri/views/3d/environment/SimpleAtmosphereTechniqueConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6",
"../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,m){a.SimpleAtmosphereGeometry=void 0;(function(r){r[r.Cone=0]="Cone";r[r.Cylinder=1]="Cylinder";r[r.Underground=2]="Underground";r[r.COUNT=3]="COUNT"})(a.SimpleAtmosphereGeometry||(a.SimpleAtmosphereGeometry={}));let l=function(r){function n(){var g=r.apply(this,arguments)||this;g.geometry=a.SimpleAtmosphereGeometry.Cone;return g}b._inheritsLoose(n,r);return n}(m.ShaderTechniqueConfiguration);c.__decorate([m.parameter({count:a.SimpleAtmosphereGeometry.COUNT})],
l.prototype,"geometry",void 0);a.SimpleAtmosphereTechniqueConfiguration=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":function(){define(["exports","../shaderModules/interfaces"],function(a,b){a.Transform=function(c,m={hasModelTransformation:!1,linearDepth:!1}){m.hasModelTransformation?m.linearDepth?c.vertex.code.add(b.glsl`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):c.vertex.code.add(b.glsl`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`):m.linearDepth?c.vertex.code.add(b.glsl`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):c.vertex.code.add(b.glsl`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4Uniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform"],function(a,b,c){c=function(m){function l(r){return m.call(this,r,"mat4")||this}b._inheritsLoose(l,m);return l}(c.Uniform);a.Matrix4Uniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/SimpleAtmosphereTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechniqueConfiguration ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){n=function(e){function h(){return e.apply(this,arguments)||this}c._inheritsLoose(h,e);var v=h.prototype;v.initializeProgram=function(w){const t=h.shader.get().build(this.configuration);return new k.Program(w.rctx,t,g.Default3D)};v.initializePipeline=function(){return this.configuration.geometry===l.SimpleAtmosphereGeometry.Cylinder?d.makePipelineState({blending:d.separateBlendingParams(f.BlendFactor.SRC_ALPHA,f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA,f.BlendFactor.ONE_MINUS_SRC_ALPHA),
culling:d.backFaceCullingParams,depthTest:{func:f.CompareFunction.LEQUAL},colorWrite:d.defaultColorWriteParams}):d.makePipelineState({blending:d.separateBlendingParams(f.BlendFactor.SRC_ALPHA,f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA,f.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:f.CompareFunction.LEQUAL},colorWrite:d.defaultColorWriteParams})};return h}(n.ShaderTechnique);n.shader=new r.ReloadableShaderModule(m.SimpleAtmosphere,()=>new Promise((e,h)=>a(["./SimpleAtmosphere.glsl"],e,
h)));b.SimpleAtmosphereTechnique=n;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(function(){return"data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAACXBIWXMAAC4jAAAuIwF4pT92AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAXVJREFUeNq0k9GWhDAIQ3PjzP9/cuehFqhW19mz++IhkCZAq1prsqT+kSQS9g8Vnqp6VGVWkYVktR6tj3Gr968nLnfwlHzHYyHapkKS73bPd/39eI38AYWj24OGvqdwWjZ3l8IDgacXyl1Dj9tdLOzZiicj+P1YcGk0H2O2vN/VQpTveEHmPHQxZxYlqsQdhUeuCWREuDEvAjqlCqDIMYwIo2ijR1HdYUS58dQrKpgQ0EGeMocsTNXrxzyOhS9kfzlWjn82YuWLqwAnvfNEWJFjYXkJCT0s7AmS0NG4x7Lt6Cpy2MiVPBZmS668QT5AR1cevp7b6CpzQ/ZSNH0vmhy5CsNtdax0MBpXDBiFsrDiMSLKMc8b6hH93bNbEpRsIyHDUhNcfTyeKF16PC7c/2QdczvUnvOB1ylZHVFSMtd5s8C2IW/7w6hwM5GLavLCd1zkiFjB+BwH1DSgctQ7mPOimBLJrw35beSXkd8BM/cCqbXWPgMA+GQQ5sIgkfAAAAAASUVORK5CYII\x3d"})},
"esri/views/3d/support/buffer/glUtil":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,b,c){const m={u8:b.DataType.UNSIGNED_BYTE,u16:b.DataType.UNSIGNED_SHORT,u32:b.DataType.UNSIGNED_INT,i8:b.DataType.BYTE,i16:b.DataType.SHORT,i32:b.DataType.INT,f32:b.DataType.FLOAT};a.glLayout=function(l,r=0){const n=l.stride;return l.fieldNames.filter(g=>{g=l.fields.get(g).optional;return!(g&&g.glPadding)}).map(g=>{const k=l.fields.get(g),f=k.constructor.ElementCount;
var d=m[k.constructor.ElementType];if(!d)throw Error("BufferType not supported in WebGL");return new c.VertexElementDescriptor(g,f,d,k.offset,n,!(!k.optional||!k.optional.glNormalized),r)})};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../geometry/support/buffer/BufferView","../../../../geometry/support/buffer/types"],
function(a,b,c,m){let l=function(){function n(k,f){this.layout=k;this.buffer="number"===typeof f?new ArrayBuffer(f*k.stride):f;for(const d of k.fieldNames)f=k.fields.get(d),this[d]=new f.constructor(this.buffer,f.offset,this.stride)}var g=n.prototype;g.getField=function(k,f){return(k=this[k])&&k.elementCount===f.ElementCount&&k.elementType===f.ElementType?k:null};g.slice=function(k,f){return new n(this.layout,this.buffer.slice(k*this.stride,f*this.stride))};g.copyFrom=function(k,f,d,e){const h=this.stride;
0===h%4?(k=new Uint32Array(k.buffer,f*h,e*h/4),(new Uint32Array(this.buffer,d*h,e*h/4)).set(k)):(k=new Uint8Array(k.buffer,f*h,e*h),(new Uint8Array(this.buffer,d*h,e*h)).set(k))};b._createClass(n,[{key:"stride",get:function(){return this.layout.stride}},{key:"count",get:function(){return this.buffer.byteLength/this.stride}},{key:"byteLength",get:function(){return this.buffer.byteLength}}]);return n}(),r=function(){function n(){this.stride=0;this.fields=new Map;this.fieldNames=[]}var g=n.prototype;
g.vec2f=function(k,f){this._appendField(k,c.BufferViewVec2f,f);return this};g.vec2f64=function(k,f){this._appendField(k,c.BufferViewVec2f64,f);return this};g.vec3f=function(k,f){this._appendField(k,c.BufferViewVec3f,f);return this};g.vec3f64=function(k,f){this._appendField(k,c.BufferViewVec3f64,f);return this};g.vec4f=function(k,f){this._appendField(k,c.BufferViewVec4f,f);return this};g.vec4f64=function(k,f){this._appendField(k,c.BufferViewVec4f64,f);return this};g.mat3f=function(k,f){this._appendField(k,
c.BufferViewMat3f,f);return this};g.mat3f64=function(k,f){this._appendField(k,c.BufferViewMat3f64,f);return this};g.mat4f=function(k,f){this._appendField(k,c.BufferViewMat4f,f);return this};g.mat4f64=function(k,f){this._appendField(k,c.BufferViewMat4f64,f);return this};g.vec4u8=function(k,f){this._appendField(k,c.BufferViewVec4u8,f);return this};g.f32=function(k,f){this._appendField(k,c.BufferViewFloat,f);return this};g.f64=function(k,f){this._appendField(k,c.BufferViewFloat64,f);return this};g.u8=
function(k,f){this._appendField(k,c.BufferViewUint8,f);return this};g.u16=function(k,f){this._appendField(k,c.BufferViewUint16,f);return this};g.i8=function(k,f){this._appendField(k,c.BufferViewInt8,f);return this};g.vec2i8=function(k,f){this._appendField(k,c.BufferViewVec2i8,f);return this};g.vec2i16=function(k,f){this._appendField(k,c.BufferViewVec2i16,f);return this};g.vec2u8=function(k,f){this._appendField(k,c.BufferViewVec2u8,f);return this};g.vec4u16=function(k,f){this._appendField(k,c.BufferViewVec4u16,
f);return this};g.u32=function(k,f){this._appendField(k,c.BufferViewUint32,f);return this};g._appendField=function(k,f,d){const e=f.ElementCount*m.elementTypeSize(f.ElementType);this.fields.set(k,{size:e,constructor:f,offset:this.stride,optional:d});this.stride+=e;this.fieldNames.push(k)};g.alignTo=function(k){this.stride=Math.floor((this.stride+k-1)/k)*k;return this};g.hasField=function(k){return this.fieldNames.includes(k)};g.createBuffer=function(k){return new l(this,k)};g.createView=function(k){return new l(this,
k)};g.clone=function(){const k=new n;k.stride=this.stride;k.fields=new Map;this.fields.forEach((f,d)=>k.fields.set(d,f));k.fieldNames=this.fieldNames.slice();k.BufferType=this.BufferType;return k};return n}();a.InterleavedBuffer=l;a.InterleavedLayout=r;a.newLayout=function(){return new r};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/buffer/BufferView":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ./internals/Mat3 ./internals/Mat4 ./internals/Scalar ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),
function(a,b,c,m,l,r,n,g){let k=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Float32Array,T,U,aa,W)||this;T.elementType="f32";return T}b._inheritsLoose(S,Q);S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(l.BufferViewScalarImpl);k.ElementType="f32";let f=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Float32Array,T,U,aa,W)||this;T.elementType="f32";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,
T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(r.BufferViewVec2Impl);f.ElementType="f32";let d=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Float32Array,T,U,aa,W)||this;T.elementType="f32";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(n.BufferViewVec3Impl);d.ElementType="f32";
let e=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Float32Array,T,U,aa,W)||this;T.elementType="f32";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(g.BufferViewVec4Impl);e.ElementType="f32";let h=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Float32Array,T,U,aa,W)||this;T.elementType="f32";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,
U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(c.BufferViewMat3Impl);h.ElementType="f32";c=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Float64Array,T,U,aa,W)||this;T.elementType="f64";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(c.BufferViewMat3Impl);
c.ElementType="f64";let v=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Float32Array,T,U,aa,W)||this;T.elementType="f32";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(m.BufferViewMat4Impl);v.ElementType="f32";m=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Float64Array,T,U,aa,W)||this;T.elementType="f64";return T}b._inheritsLoose(S,Q);S.prototype.slice=
function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(m.BufferViewMat4Impl);m.ElementType="f64";let w=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Float64Array,T,U,aa,W)||this;T.elementType="f64";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(l.BufferViewScalarImpl);
w.ElementType="f64";let t=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Float64Array,T,U,aa,W)||this;T.elementType="f64";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(r.BufferViewVec2Impl);t.ElementType="f64";let x=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Float64Array,T,U,aa,W)||this;T.elementType="f64";return T}b._inheritsLoose(S,Q);
S.prototype.slice=function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(n.BufferViewVec3Impl);x.ElementType="f64";let B=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Float64Array,T,U,aa,W)||this;T.elementType="f64";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};
return S}(g.BufferViewVec4Impl);B.ElementType="f64";let q=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Uint8Array,T,U,aa,W)||this;T.elementType="u8";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(l.BufferViewScalarImpl);q.ElementType="u8";let u=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Uint8Array,T,U,aa,W)||this;T.elementType="u8";return T}
b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(r.BufferViewVec2Impl);u.ElementType="u8";let C=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Uint8Array,T,U,aa,W)||this;T.elementType="u8";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+
T.byteLength)};return S}(n.BufferViewVec3Impl);C.ElementType="u8";let z=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Uint8Array,T,U,aa,W)||this;T.elementType="u8";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(g.BufferViewVec4Impl);z.ElementType="u8";let A=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Uint16Array,T,U,aa,W)||this;T.elementType=
"u16";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(l.BufferViewScalarImpl);A.ElementType="u16";let p=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Uint16Array,T,U,aa,W)||this;T.elementType="u16";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,
T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(r.BufferViewVec2Impl);p.ElementType="u16";let y=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Uint16Array,T,U,aa,W)||this;T.elementType="u16";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(n.BufferViewVec3Impl);y.ElementType="u16";let D=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Uint16Array,
T,U,aa,W)||this;T.elementType="u16";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(g.BufferViewVec4Impl);D.ElementType="u16";let E=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Uint32Array,T,U,aa,W)||this;T.elementType="u32";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,
U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(l.BufferViewScalarImpl);E.ElementType="u32";let F=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Uint32Array,T,U,aa,W)||this;T.elementType="u32";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(r.BufferViewVec2Impl);F.ElementType="u32";let G=function(Q){function S(T,U=
0,aa,W){T=Q.call(this,Uint32Array,T,U,aa,W)||this;T.elementType="u32";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(n.BufferViewVec3Impl);G.ElementType="u32";let P=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Uint32Array,T,U,aa,W)||this;T.elementType="u32";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,
T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(g.BufferViewVec4Impl);P.ElementType="u32";let K=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Int8Array,T,U,aa,W)||this;T.elementType="i8";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(l.BufferViewScalarImpl);K.ElementType="i8";let N=
function(Q){function S(T,U=0,aa,W){T=Q.call(this,Int8Array,T,U,aa,W)||this;T.elementType="i8";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(r.BufferViewVec2Impl);N.ElementType="i8";let M=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Int8Array,T,U,aa,W)||this;T.elementType="i8";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,
T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(n.BufferViewVec3Impl);M.ElementType="i8";let L=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Int8Array,T,U,aa,W)||this;T.elementType="i8";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(g.BufferViewVec4Impl);L.ElementType="i8";let J=
function(Q){function S(T,U=0,aa,W){T=Q.call(this,Int16Array,T,U,aa,W)||this;T.elementType="i16";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(l.BufferViewScalarImpl);J.ElementType="i16";let H=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Int16Array,T,U,aa,W)||this;T.elementType="i16";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,
U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(r.BufferViewVec2Impl);H.ElementType="i16";let I=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Int16Array,T,U,aa,W)||this;T.elementType="i16";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(n.BufferViewVec3Impl);
I.ElementType="i16";let O=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Int16Array,T,U,aa,W)||this;T.elementType="i16";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(g.BufferViewVec4Impl);O.ElementType="i16";l=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Int32Array,T,U,aa,W)||this;T.elementType="i32";return T}b._inheritsLoose(S,Q);S.prototype.slice=
function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(l.BufferViewScalarImpl);l.ElementType="i32";r=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Int32Array,T,U,aa,W)||this;T.elementType="i32";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(r.BufferViewVec2Impl);
r.ElementType="i32";n=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Int32Array,T,U,aa,W)||this;T.elementType="i32";return T}b._inheritsLoose(S,Q);S.prototype.slice=function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(n.BufferViewVec3Impl);n.ElementType="i32";g=function(Q){function S(T,U=0,aa,W){T=Q.call(this,Int32Array,T,U,aa,W)||this;T.elementType="i32";return T}b._inheritsLoose(S,Q);S.prototype.slice=
function(T,U){return this.sliceBuffer(S,T,U)};S.fromTypedArray=function(T,U){return new S(T.buffer,T.byteOffset,U,T.byteOffset+T.byteLength)};return S}(g.BufferViewVec4Impl);g.ElementType="i32";a.BufferViewFloat=k;a.BufferViewFloat64=w;a.BufferViewInt16=J;a.BufferViewInt32=l;a.BufferViewInt8=K;a.BufferViewMat3f=h;a.BufferViewMat3f64=c;a.BufferViewMat4f=v;a.BufferViewMat4f64=m;a.BufferViewUint16=A;a.BufferViewUint32=E;a.BufferViewUint8=q;a.BufferViewVec2f=f;a.BufferViewVec2f64=t;a.BufferViewVec2i16=
H;a.BufferViewVec2i32=r;a.BufferViewVec2i8=N;a.BufferViewVec2u16=p;a.BufferViewVec2u32=F;a.BufferViewVec2u8=u;a.BufferViewVec3f=d;a.BufferViewVec3f64=x;a.BufferViewVec3i16=I;a.BufferViewVec3i32=n;a.BufferViewVec3i8=M;a.BufferViewVec3u16=y;a.BufferViewVec3u32=G;a.BufferViewVec3u8=C;a.BufferViewVec4f=e;a.BufferViewVec4f64=B;a.BufferViewVec4i16=O;a.BufferViewVec4i32=g;a.BufferViewVec4i8=L;a.BufferViewVec4u16=D;a.BufferViewVec4u32=P;a.BufferViewVec4u8=z;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/buffer/internals/Mat3":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function m(r,n,g=0,k,f){this.TypedArrayConstructor=r;this.elementCount=9;r=this.TypedArrayConstructor;void 0===k&&(k=9*r.BYTES_PER_ELEMENT);const d=0===n.byteLength?0:g;this.typedBuffer=null==f?new r(n,d):new r(n,d,(f-g)/r.BYTES_PER_ELEMENT);this.typedBufferStride=k/r.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/
this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var l=m.prototype;l.sliceBuffer=function(r,n,g=this.count-n){n=this.typedBuffer.byteOffset+n*this.stride;return new r(this.buffer,n,this.stride,n+g*this.stride)};l.getMat=function(r,n){r*=this.typedBufferStride;for(let g=0;9>g;g++)n[g]=this.typedBuffer[r++];return n};l.setMat=function(r,n){r*=this.typedBufferStride;for(let g=0;9>g;g++)this.typedBuffer[r++]=n[g]};l.get=function(r,n){return this.typedBuffer[r*
this.typedBufferStride+n]};l.set=function(r,n,g){this.typedBuffer[r*this.typedBufferStride+n]=g};l.copyFrom=function(r,n,g){const k=this.typedBuffer,f=n.typedBuffer;r*=this.typedBufferStride;n=g*n.typedBufferStride;for(g=0;9>g;++g)k[r++]=f[n++]};b._createClass(m,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return m}();c.ElementCount=9;a.BufferViewMat3Impl=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/buffer/internals/Mat4":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function m(r,n,g=0,k,f){this.TypedArrayConstructor=r;this.elementCount=16;r=this.TypedArrayConstructor;void 0===k&&(k=16*r.BYTES_PER_ELEMENT);const d=0===n.byteLength?0:g;this.typedBuffer=null==f?new r(n,d):new r(n,d,(f-g)/r.BYTES_PER_ELEMENT);this.typedBufferStride=k/r.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}
var l=m.prototype;l.sliceBuffer=function(r,n,g=this.count-n){n=this.typedBuffer.byteOffset+n*this.stride;return new r(this.buffer,n,this.stride,n+g*this.stride)};l.getMat=function(r,n){r*=this.typedBufferStride;for(let g=0;16>g;g++)n[g]=this.typedBuffer[r++];return n};l.setMat=function(r,n){r*=this.typedBufferStride;for(let g=0;16>g;g++)this.typedBuffer[r++]=n[g]};l.get=function(r,n){return this.typedBuffer[r*this.typedBufferStride+n]};l.set=function(r,n,g){this.typedBuffer[r*this.typedBufferStride+
n]=g};l.copyFrom=function(r,n,g){const k=this.typedBuffer,f=n.typedBuffer;r*=this.typedBufferStride;n=g*n.typedBufferStride;for(g=0;16>g;++g)k[r++]=f[n++]};b._createClass(m,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return m}();c.ElementCount=16;a.BufferViewMat4Impl=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/buffer/internals/Scalar":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],
function(a,b){let c=function(){function m(r,n,g=0,k,f){this.TypedArrayConstructor=r;this.elementCount=1;r=this.TypedArrayConstructor;void 0===k&&(k=r.BYTES_PER_ELEMENT);const d=0===n.byteLength?0:g;this.typedBuffer=null==f?new r(n,d):new r(n,d,(f-g)/r.BYTES_PER_ELEMENT);this.typedBufferStride=k/r.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var l=m.prototype;l.sliceBuffer=function(r,
n,g=this.count-n){n=this.typedBuffer.byteOffset+n*this.stride;return new r(this.buffer,n,this.stride,n+g*this.stride)};l.get=function(r){return this.typedBuffer[r*this.typedBufferStride]};l.set=function(r,n){this.typedBuffer[r*this.typedBufferStride]=n};b._createClass(m,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return m}();c.ElementCount=1;a.BufferViewScalarImpl=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/buffer/internals/Vec2":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec2"],function(a,b,c){let m=function(){function l(n,g,k=0,f,d){this.TypedArrayConstructor=n;this.elementCount=2;n=this.TypedArrayConstructor;void 0===f&&(f=2*n.BYTES_PER_ELEMENT);const e=0===g.byteLength?0:k;this.typedBuffer=null==d?new n(g,e):new n(g,e,(d-k)/n.BYTES_PER_ELEMENT);this.typedBufferStride=f/n.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}
var r=l.prototype;r.sliceBuffer=function(n,g,k=this.count-g){g=this.typedBuffer.byteOffset+g*this.stride;return new n(this.buffer,g,this.stride,g+k*this.stride)};r.getVec=function(n,g){n*=this.typedBufferStride;return c.set(g,this.typedBuffer[n],this.typedBuffer[n+1])};r.setVec=function(n,g){n*=this.typedBufferStride;this.typedBuffer[n++]=g[0];this.typedBuffer[n]=g[1]};r.get=function(n,g){return this.typedBuffer[n*this.typedBufferStride+g]};r.set=function(n,g,k){this.typedBuffer[n*this.typedBufferStride+
g]=k};r.setValues=function(n,g,k){n*=this.typedBufferStride;this.typedBuffer[n++]=g;this.typedBuffer[n]=k};r.copyFrom=function(n,g,k){const f=this.typedBuffer,d=g.typedBuffer;n*=this.typedBufferStride;g=k*g.typedBufferStride;f[n++]=d[g++];f[n]=d[g]};b._createClass(l,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return l}();m.ElementCount=2;a.BufferViewVec2Impl=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/buffer/internals/Vec3":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec3"],function(a,b,c){let m=function(){function l(n,g,k=0,f,d){this.TypedArrayConstructor=n;this.elementCount=3;n=this.TypedArrayConstructor;void 0===f&&(f=3*n.BYTES_PER_ELEMENT);const e=0===g.byteLength?0:k;this.typedBuffer=null==d?new n(g,e):new n(g,e,(d-k)/n.BYTES_PER_ELEMENT);this.typedBufferStride=f/n.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}
var r=l.prototype;r.sliceBuffer=function(n,g,k=this.count-g){g=this.typedBuffer.byteOffset+g*this.stride;return new n(this.buffer,g,this.stride,g+k*this.stride)};r.getVec=function(n,g){n*=this.typedBufferStride;return c.set(g,this.typedBuffer[n],this.typedBuffer[n+1],this.typedBuffer[n+2])};r.setVec=function(n,g){n*=this.typedBufferStride;this.typedBuffer[n++]=g[0];this.typedBuffer[n++]=g[1];this.typedBuffer[n]=g[2]};r.get=function(n,g){return this.typedBuffer[n*this.typedBufferStride+g]};r.set=function(n,
g,k){this.typedBuffer[n*this.typedBufferStride+g]=k};r.setValues=function(n,g,k,f){n*=this.typedBufferStride;this.typedBuffer[n++]=g;this.typedBuffer[n++]=k;this.typedBuffer[n]=f};r.copyFrom=function(n,g,k){const f=this.typedBuffer,d=g.typedBuffer;n*=this.typedBufferStride;g=k*g.typedBufferStride;f[n++]=d[g++];f[n++]=d[g++];f[n]=d[g]};b._createClass(l,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return l}();m.ElementCount=3;a.BufferViewVec3Impl=m;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/buffer/internals/Vec4":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec4"],function(a,b,c){let m=function(){function l(n,g,k=0,f,d){this.TypedArrayConstructor=n;this.elementCount=4;n=this.TypedArrayConstructor;void 0===f&&(f=4*n.BYTES_PER_ELEMENT);const e=0===g.byteLength?0:k;this.typedBuffer=null==d?new n(g,e):new n(g,e,(d-k)/n.BYTES_PER_ELEMENT);this.typedBufferStride=f/n.BYTES_PER_ELEMENT;
this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var r=l.prototype;r.sliceBuffer=function(n,g,k=this.count-g){g=this.typedBuffer.byteOffset+g*this.stride;return new n(this.buffer,g,this.stride,g+k*this.stride)};r.getVec=function(n,g){n*=this.typedBufferStride;return c.set(g,this.typedBuffer[n++],this.typedBuffer[n++],this.typedBuffer[n++],this.typedBuffer[n])};r.setVec=function(n,g){n*=this.typedBufferStride;
this.typedBuffer[n++]=g[0];this.typedBuffer[n++]=g[1];this.typedBuffer[n++]=g[2];this.typedBuffer[n]=g[3]};r.get=function(n,g){return this.typedBuffer[n*this.typedBufferStride+g]};r.set=function(n,g,k){this.typedBuffer[n*this.typedBufferStride+g]=k};r.setValues=function(n,g,k,f,d){n*=this.typedBufferStride;this.typedBuffer[n++]=g;this.typedBuffer[n++]=k;this.typedBuffer[n++]=f;this.typedBuffer[n]=d};r.copyFrom=function(n,g,k){const f=this.typedBuffer,d=g.typedBuffer;n*=this.typedBufferStride;g=k*
g.typedBufferStride;f[n++]=d[g++];f[n++]=d[g++];f[n++]=d[g++];f[n]=d[g]};b._createClass(l,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return l}();m.ElementCount=4;a.BufferViewVec4Impl=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/buffer/types":function(){define(["exports","../../../core/has"],function(a,b){a.elementTypeSize=function(c){switch(c){case "u8":return 1;case "u16":return 2;case "u32":return 4;case "i8":return 1;
case "i16":return 2;case "i32":return 4;case "f32":return 4;case "f64":return 8}};a.isInteger=function(c){switch(c){case "u8":case "u16":case "u32":case "i8":case "i16":case "i32":return!0;case "f32":case "f64":return!1}};a.isSigned=function(c){switch(c){case "u8":case "u16":case "u32":return!1;case "i8":case "i16":case "i32":case "f32":case "f64":return!0}};a.maximumValue=function(c){switch(c){case "u8":return 255;case "u16":return 65535;case "u32":return 4294967295;case "i8":return 127;case "i16":return 32767;
case "i32":return 2147483647;case "f32":return 3.402823E38;case "f64":return 1.79769E308}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../geometry/support/plane ../../../../geometry/support/ray ./basicInterfaces ./BufferVectorMath ./Geometry ./geometryDataUtils ./Util ./VertexAttribute".split(" "),function(a,
b,c,m,l,r,n,g,k,f,d){const e=n.Vec3Compact;var h;(function(B){const q=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],u=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],C=[0,0,1,0,1,1,0,1],z=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),A=new Uint16Array(36);for(var p=0;6>p;p++)for(let D=0;6>D;D++)A[6*p+D]=p;const y=new Uint16Array(36);for(p=0;6>p;p++)y[6*p]=0,y[6*p+1]=1,y[6*p+2]=2,y[6*p+3]=2,y[6*p+4]=3,y[6*
p+5]=0;B.createGeometry=function(D){Array.isArray(D)||(D=[D,D,D]);const E=Array(24);for(let F=0;8>F;F++)E[3*F]=q[F][0]*D[0],E[3*F+1]=q[F][1]*D[1],E[3*F+2]=q[F][2]*D[2];return new g.Geometry([[d.VertexAttribute.POSITION,{size:3,data:E,exclusive:!0}],[d.VertexAttribute.NORMAL,{size:3,data:u}],[d.VertexAttribute.UV0,{size:2,data:C}]],[[d.VertexAttribute.POSITION,z],[d.VertexAttribute.NORMAL,A],[d.VertexAttribute.UV0,y]])}})(h||(h={}));var v;(function(B){const q=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,
0,.5],[0,-.5,0],[0,.5,0]],u=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],C=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),z=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);B.createGeometry=function(A){Array.isArray(A)||(A=[A,A,A]);const p=Array(18);for(let y=0;6>y;y++)p[3*y]=q[y][0]*A[0],p[3*y+1]=q[y][1]*A[1],p[3*y+2]=q[y][2]*A[2];return new g.Geometry([[d.VertexAttribute.POSITION,{size:3,data:p,exclusive:!0}],[d.VertexAttribute.NORMAL,{size:3,data:u}]],
[[d.VertexAttribute.POSITION,C],[d.VertexAttribute.NORMAL,z]])}})(v||(v={}));var w;(function(B){const q=b.fromValues(-.5,0,-.5),u=b.fromValues(.5,0,-.5),C=b.fromValues(0,0,.5),z=b.fromValues(0,.5,0),A=b.create(),p=b.create(),y=b.create(),D=b.create(),E=b.create();a.subtract(A,q,z);a.subtract(p,q,u);a.cross(y,A,p);a.normalize(y,y);a.subtract(A,u,z);a.subtract(p,u,C);a.cross(D,A,p);a.normalize(D,D);a.subtract(A,C,z);a.subtract(p,C,q);a.cross(E,A,p);a.normalize(E,E);const F=[q,u,C,z],G=[0,-1,0,y[0],
y[1],y[2],D[0],D[1],D[2],E[0],E[1],E[2]],P=[0,1,2,3,1,0,3,2,1,3,0,2],K=[0,0,0,1,1,1,2,2,2,3,3,3];B.createGeometry=function(N){Array.isArray(N)||(N=[N,N,N]);const M=Array(12);for(let L=0;4>L;L++)M[3*L]=F[L][0]*N[0],M[3*L+1]=F[L][1]*N[1],M[3*L+2]=F[L][2]*N[2];return new g.Geometry([[d.VertexAttribute.POSITION,{size:3,data:M,exclusive:!0}],[d.VertexAttribute.NORMAL,{size:3,data:G}]],[[d.VertexAttribute.POSITION,new Uint16Array(P)],[d.VertexAttribute.NORMAL,new Uint16Array(K)]])}})(w||(w={}));var t;(function(B){function q(z,
A,p,y,D){if(Math.abs(a.dot(A,z))>D)return!1;a.cross(p,z,A);a.normalize(p,p);a.cross(y,p,z);a.normalize(y,y);return!0}function u(z,A,p,y,D,E,F){return q(z,A,D,E,F)||q(z,p,D,E,F)||q(z,y,D,E,F)}B.createBoxGeometry=h.createGeometry;B.createDiamondGeometry=v.createGeometry;B.createTetrahedronGeometry=w.createGeometry;B.createSphereGeometry=function(z,A,p,y={uv:!0}){var D=-Math.PI,E=2*Math.PI,F=-Math.PI/2,G=Math.PI;A=Math.max(3,Math.floor(A));const P=Math.max(2,Math.floor(p));var K=(A+1)*(P+1);p=new Float32Array(3*
K);const N=new Float32Array(3*K);K=new Float32Array(2*K);const M=[];let L=0;for(var J=0;J<=P;J++){var H=[];const O=J/P,Q=F+O*G,S=Math.cos(Q);for(let T=0;T<=A;T++){const U=T/A;var I=D+U*E;const aa=Math.cos(I)*S,W=Math.sin(Q);I=-Math.sin(I)*S;p[3*L]=aa*z;p[3*L+1]=W*z;p[3*L+2]=I*z;N[3*L]=aa;N[3*L+1]=W;N[3*L+2]=I;K[2*L]=U;K[2*L+1]=O;H.push(L);++L}M.push(H)}z=new Uint32Array(2*A*(P-1)*3);L=0;for(D=0;D<P;D++)for(E=0;E<A;E++)F=M[D][E],G=M[D][E+1],J=M[D+1][E+1],H=M[D+1][E],0===D?(z[L++]=F,z[L++]=J,z[L++]=
H):D===P-1?(z[L++]=F,z[L++]=G,z[L++]=J):(z[L++]=F,z[L++]=G,z[L++]=J,z[L++]=J,z[L++]=H,z[L++]=F);A=[[d.VertexAttribute.POSITION,z],[d.VertexAttribute.NORMAL,z]];p=[[d.VertexAttribute.POSITION,{size:3,data:p,exclusive:!0}],[d.VertexAttribute.NORMAL,{size:3,data:N,exclusive:!0}]];y.uv&&(p.push([d.VertexAttribute.UV0,{size:2,data:K,exclusive:!0}]),A.push([d.VertexAttribute.UV0,z]));y.offset&&(A[0][0]=d.VertexAttribute.OFFSET,p[0][0]=d.VertexAttribute.OFFSET,A.push([d.VertexAttribute.POSITION,new Uint32Array(z.length)]),
p.push([d.VertexAttribute.POSITION,{size:3,data:Float64Array.from(y.offset),exclusive:!0}]));return new g.Geometry(p,A)};B.createPolySphereGeometry=function(z,A,p){function y(G,P){G>P&&([G,P]=[P,G]);const K=G.toString()+"."+P.toString();if(F[K])return F[K];let N=D.length;D.length+=3;e.add(D,3*G,D,3*P,D,N);e.scale(D,N,z/e.length(D,N));N/=3;return F[K]=N}let D;p?(D=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],p=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1])):(p=z*(1+Math.sqrt(5))/2,
D=[-z,p,0,z,p,0,-z,-p,0,z,-p,0,0,-z,p,0,z,p,0,-z,-p,0,z,-p,p,0,-z,p,0,z,-p,0,-z,-p,0,z],p=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]));for(var E=0;E<D.length;E+=3)e.scale(D,E,z/e.length(D,E));let F={};for(E=0;E<A;E++){const G=p.length,P=new Uint32Array(4*G);for(let K=0;K<G;K+=3){const N=p[K],M=p[K+1],L=p[K+2],J=y(N,M),H=y(M,L),I=y(L,N),O=4*K;P[O]=N;P[O+1]=J;P[O+2]=I;P[O+3]=M;P[O+4]=H;P[O+5]=J;
P[O+6]=L;P[O+7]=I;P[O+8]=H;P[O+9]=J;P[O+10]=H;P[O+11]=I}p=P;F={}}A=new Float32Array(D);for(E=0;E<A.length;E+=3)e.normalize(A,E);p=[[d.VertexAttribute.POSITION,p],[d.VertexAttribute.NORMAL,p]];A=[[d.VertexAttribute.POSITION,{size:3,data:new Float32Array(D),exclusive:!0}],[d.VertexAttribute.NORMAL,{size:3,data:A,exclusive:!0}]];return new g.Geometry(A,p)};B.createPointGeometry=function(z,A,p,y,D,E,F){A=A?[A[0],A[1],A[2]]:[0,0,0];z=z?[z[0],z[1],z[2]]:[0,0,1];E=E||[0,0];p=[[d.VertexAttribute.POSITION,
{size:3,data:A,exclusive:!0}],[d.VertexAttribute.NORMAL,{size:3,data:z,exclusive:!0}],[d.VertexAttribute.UV0,{size:E.length,data:E}],[d.VertexAttribute.COLOR,{size:4,data:p?[255*p[0],255*p[1],255*p[2],3<p.length?255*p[3]:255]:[255,255,255,255],exclusive:!0}],[d.VertexAttribute.SIZE,{size:2,data:null!=y&&2===y.length?y:[1,1]}]];null!=D&&(D=new Float32Array([D[0],D[1],D[2],D[3]]),p.push([d.VertexAttribute.AUXPOS1,{size:4,data:D}]));null!=F&&(F=new Float32Array([F[0],F[1],F[2],F[3]]),p.push([d.VertexAttribute.AUXPOS2,
{size:4,data:F}]));return new g.Geometry(p,null,r.PrimitiveType.Point)};B.updatePointGeometry=function(z,A,p,y,D,E,F,G){if(null!=z){const {data:P}=G.getMutableAttribute(d.VertexAttribute.NORMAL);P[0]=z[0];P[1]=z[1];P[2]=z[2]}null!=A&&({data:z}=G.getMutableAttribute(d.VertexAttribute.POSITION),z[0]=A[0],z[1]=A[1],z[2]=A[2]);null!=p&&({data:A}=G.getMutableAttribute(d.VertexAttribute.COLOR),A[0]=p[0],A[1]=p[1],A[2]=p[2],A[3]=p[3]);null!=y&&({data:p}=G.getMutableAttribute(d.VertexAttribute.SIZE),p[0]=
y[0],p[1]=y[1]);null!=D&&({data:y}=G.getMutableAttribute(d.VertexAttribute.AUXPOS1),y[0]=D[0],y[1]=D[1],y[2]=D[2],y[3]=D[3]);null!=E&&({data:D}=G.getMutableAttribute(d.VertexAttribute.UV0),D[0]=E[0],D[1]=E[1]);null!=F&&({data:E}=G.getMutableAttribute(d.VertexAttribute.AUXPOS2),E[0]=F[0],E[1]=F[1],E[2]=F[2],E[3]=F[3])};B.createPointArrayGeometry=function(z,A){const p=new Float32Array(3*z.length),y=new Float32Array(A?3*z.length:3),D=new Uint32Array(z.length),E=new Uint32Array(z.length);for(let F=0;F<
z.length;F++)p[3*F]=z[F][0],p[3*F+1]=z[F][1],p[3*F+2]=z[F][2],A&&(y[3*F]=A[F][0],y[3*F+1]=A[F][1],y[3*F+2]=A[F][2]),D[F]=F,E[F]=0;A||(y[0]=0,y[1]=1,y[2]=0);return new g.Geometry([[d.VertexAttribute.POSITION,{size:3,data:p,exclusive:!0}],[d.VertexAttribute.NORMAL,{size:3,data:y,exclusive:!0}],[d.VertexAttribute.UV0,{size:2,data:[0,0],exclusive:!0}]],[[d.VertexAttribute.POSITION,D],[d.VertexAttribute.NORMAL,A?D:E],[d.VertexAttribute.UV0,E]],r.PrimitiveType.Point)};B.createTriangleGeometry=function(){const z=
new Uint16Array([0,1,2]),A=new Uint16Array([0,0,0]),p=new Uint16Array([0,0,0]);return new g.Geometry([[d.VertexAttribute.POSITION,{size:3,data:[0,0,0,0,0,100,100,0,0],exclusive:!0}],[d.VertexAttribute.NORMAL,{size:3,data:[0,1,0],exclusive:!0}],[d.VertexAttribute.UV0,{size:2,data:[0,0],exclusive:!0}]],[[d.VertexAttribute.POSITION,z],[d.VertexAttribute.NORMAL,A],[d.VertexAttribute.UV0,p]])};const C=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];B.createSquareGeometry=function(z=C){const A=Array(12);for(var p=
0;4>p;p++)for(let y=0;3>y;y++)A[3*p+y]=z[p][y];z=new Uint32Array([0,1,2,2,3,0]);p=new Uint32Array([0,0,0,0,0,0]);return new g.Geometry([[d.VertexAttribute.POSITION,{size:3,data:A,exclusive:!0}],[d.VertexAttribute.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[d.VertexAttribute.UV0,{size:2,data:[0,0,1,0,1,1,0,1],exclusive:!0}],[d.VertexAttribute.COLOR,{size:4,data:[255,255,255,255],exclusive:!0}]],[[d.VertexAttribute.POSITION,z],[d.VertexAttribute.NORMAL,p],[d.VertexAttribute.UV0,z],[d.VertexAttribute.COLOR,
p]])};B.createConeGeometry=function(z,A,p,y,D=!0,E=!0){var F=0,G=b.fromValues(0,F,0),P=b.fromValues(0,F+z,0),K=b.fromValues(0,-1,0),N=b.fromValues(0,1,0);y&&(F=z,P=b.fromValues(0,0,0),G=b.fromValues(0,F,0),K=b.fromValues(0,1,0),N=b.fromValues(0,-1,0));G=[P,G];K=[K,N];N=p+2;P=Math.sqrt(z*z+A*A);if(y)for(y=p-1;0<=y;y--){var M=2*Math.PI/p*y,L=b.fromValues(Math.cos(M)*A,F,Math.sin(M)*A);G.push(L);M=b.fromValues(z*Math.cos(M)/P,-A/P,z*Math.sin(M)/P);K.push(M)}else for(y=0;y<p;y++)M=2*Math.PI/p*y,L=b.fromValues(Math.cos(M)*
A,F,Math.sin(M)*A),G.push(L),M=b.fromValues(z*Math.cos(M)/P,A/P,z*Math.sin(M)/P),K.push(M);z=new Uint32Array(6*(p+2));p=new Uint32Array(6*(p+2));F=A=0;if(D){for(D=3;D<G.length;D++)z[A++]=1,z[A++]=D-1,z[A++]=D,p[F++]=0,p[F++]=0,p[F++]=0;z[A++]=G.length-1;z[A++]=2;z[A++]=1;p[F++]=0;p[F++]=0;p[F++]=0}if(E){for(E=3;E<G.length;E++)z[A++]=E,z[A++]=E-1,z[A++]=0,p[F++]=E,p[F++]=E-1,p[F++]=1;z[A++]=0;z[A++]=2;z[A++]=G.length-1;p[F++]=1;p[F++]=2;p[F++]=K.length-1}E=new Float32Array(3*N);for(D=0;D<N;D++)E[3*
D]=G[D][0],E[3*D+1]=G[D][1],E[3*D+2]=G[D][2];G=new Float32Array(3*N);for(D=0;D<N;D++)G[3*D]=K[D][0],G[3*D+1]=K[D][1],G[3*D+2]=K[D][2];return new g.Geometry([[d.VertexAttribute.POSITION,{size:3,data:E,exclusive:!0}],[d.VertexAttribute.NORMAL,{size:3,data:G,exclusive:!0}]],[[d.VertexAttribute.POSITION,z],[d.VertexAttribute.NORMAL,p]])};B.createCylinderGeometry=function(z,A,p,y,D,E){y=y?b.clone(y):b.fromValues(1,0,0);D=D?b.clone(D):b.fromValues(0,0,0);E=null==E?!0:E;var F=b.create();a.normalize(F,y);
var G=b.create();a.scale(G,F,Math.abs(z));var P=b.create();a.scale(P,G,-.5);a.add(P,P,D);const K=b.fromValues(0,1,0);.2>Math.abs(1-a.dot(F,K))&&a.set(K,0,0,1);const N=b.create();a.cross(N,F,K);a.normalize(N,N);a.cross(K,N,F);z=2*p+(E?2:0);D=p+(E?2:0);y=new Float32Array(3*z);const M=new Float32Array(3*D),L=new Float32Array(2*z),J=new Uint32Array(3*p*(E?4:2)),H=new Uint32Array(3*p*(E?4:2));E&&(y[3*(z-2)]=P[0],y[3*(z-2)+1]=P[1],y[3*(z-2)+2]=P[2],L[2*(z-2)]=0,L[2*(z-2)+1]=0,y[3*(z-1)]=y[3*(z-2)]+G[0],
y[3*(z-1)+1]=y[3*(z-2)+1]+G[1],y[3*(z-1)+2]=y[3*(z-2)+2]+G[2],L[2*(z-1)]=1,L[2*(z-1)+1]=1,M[3*(D-2)]=-F[0],M[3*(D-2)+1]=-F[1],M[3*(D-2)+2]=-F[2],M[3*(D-1)]=F[0],M[3*(D-1)+1]=F[1],M[3*(D-1)+2]=F[2]);F=0;const I=b.create(),O=b.create();for(let U=0;U<p;U++){var Q=2*Math.PI/p*U;a.scale(I,K,Math.sin(Q));a.scale(O,N,Math.cos(Q));a.add(I,I,O);M[3*U]=I[0];M[3*U+1]=I[1];M[3*U+2]=I[2];a.scale(I,I,A);a.add(I,I,P);y[3*U]=I[0];y[3*U+1]=I[1];y[3*U+2]=I[2];L[2*U]=U/p;L[2*U+1]=0;y[3*(U+p)]=y[3*U]+G[0];y[3*(U+p)+
1]=y[3*U+1]+G[1];y[3*(U+p)+2]=y[3*U+2]+G[2];L[2*(U+p)]=U/p;L[2*U+1]=1;Q=(U+1)%p;var S=F++,T=U;J[S]=U;H[S]=T;S=F++;T=U;J[S]=U+p;H[S]=T;S=F++;T=Q;J[S]=Q;H[S]=T;S=F++;T=Q;J[S]=Q;H[S]=T;S=F++;T=U;J[S]=U+p;H[S]=T;S=F++;T=Q;J[S]=Q+p;H[S]=T}if(E){for(A=0;A<p;A++)E=(A+1)%p,G=F++,P=D-2,J[G]=z-2,H[G]=P,G=F++,P=D-2,J[G]=A,H[G]=P,G=F++,P=D-2,J[G]=E,H[G]=P;for(A=0;A<p;A++)E=(A+1)%p,G=F++,P=D-1,J[G]=A+p,H[G]=P,G=F++,P=D-1,J[G]=z-1,H[G]=P,G=F++,P=D-1,J[G]=E+p,H[G]=P}return new g.Geometry([[d.VertexAttribute.POSITION,
{size:3,data:y,exclusive:!0}],[d.VertexAttribute.NORMAL,{size:3,data:M,exclusive:!0}],[d.VertexAttribute.UV0,{size:2,data:L,exclusive:!0}]],[[d.VertexAttribute.POSITION,J],[d.VertexAttribute.NORMAL,H],[d.VertexAttribute.UV0,J]])};B.createTubeGeometry=function(z,A,p,y,D){p=p||10;y=null!=y?y:!0;f.assert(1<z.length);const E=[],F=[];for(let G=0;G<p;G++){E.push([0,-G-1,-((G+1)%p)-1]);const P=G/p*2*Math.PI;F.push([Math.cos(P)*A,Math.sin(P)*A])}return B.createPathExtrusionGeometry(F,z,[[0,0,0]],E,y,D)};
B.createPathExtrusionGeometry=function(z,A,p,y,D,E=b.fromValues(0,0,0)){var F=z.length;const G=new Float32Array(A.length*F*3+(6*p.length||0)),P=new Float32Array(A.length*F*3+(p?6:0));var K=(A.length-1)*F*6+6*y.length;const N=new Uint32Array(K);K=new Uint32Array(K);let M=0;var L=0;let J=0,H=0;const I=b.create(),O=b.create(),Q=b.create(),S=b.create(),T=b.create(),U=b.create(),aa=b.create(),W=c.create(),R=b.create(),V=b.create(),da=b.create(),ca=b.create(),ha=b.create(),ia=m.create();a.set(R,0,1,0);
a.subtract(O,A[1],A[0]);a.normalize(O,O);D?(a.add(W,A[0],E),a.normalize(Q,W)):a.set(Q,0,0,1);u(O,Q,R,R,T,Q,.99619469809);a.copy(S,Q);a.copy(ca,T);for(var ka=0;ka<p.length;ka++)a.scale(U,T,p[ka][0]),a.scale(W,Q,p[ka][2]),a.add(U,U,W),a.add(U,U,A[0]),G[M++]=U[0],G[M++]=U[1],G[M++]=U[2];P[L++]=-O[0];P[L++]=-O[1];P[L++]=-O[2];for(ka=0;ka<y.length;ka++)N[J++]=0<y[ka][0]?y[ka][0]:-y[ka][0]-1+p.length,N[J++]=0<y[ka][1]?y[ka][1]:-y[ka][1]-1+p.length,N[J++]=0<y[ka][2]?y[ka][2]:-y[ka][2]-1+p.length,K[H++]=
0,K[H++]=0,K[H++]=0;ka=p.length;const la=p.length-1;for(let ea=0;ea<A.length;ea++){let ba=!1;0<ea&&(a.copy(I,O),ea<A.length-1?(a.subtract(O,A[ea+1],A[ea]),a.normalize(O,O)):ba=!0,a.add(V,I,O),a.normalize(V,V),a.add(da,A[ea-1],S),m.fromPositionAndNormal(A[ea],V,ia),m.intersectRay(ia,l.wrap(da,I),W)?(a.subtract(W,W,A[ea]),a.normalize(Q,W),a.cross(T,V,Q),a.normalize(T,T)):u(V,S,ca,R,T,Q,.99619469809),a.copy(S,Q),a.copy(ca,T));D&&(a.add(W,A[ea],E),a.normalize(ha,W));for(let Z=0;Z<F;Z++)if(a.scale(U,T,
z[Z][0]),a.scale(W,Q,z[Z][1]),a.add(U,U,W),a.normalize(aa,U),P[L++]=aa[0],P[L++]=aa[1],P[L++]=aa[2],a.add(U,U,A[ea]),G[M++]=U[0],G[M++]=U[1],G[M++]=U[2],!ba){var Y=(Z+1)%F;N[J++]=ka+Z;N[J++]=ka+F+Z;N[J++]=ka+Y;N[J++]=ka+Y;N[J++]=ka+F+Z;N[J++]=ka+F+Y;for(Y=0;6>Y;Y++)K[H++]=N[J-6+Y]-la}ka+=F}z=A[A.length-1];for(A=0;A<p.length;A++)a.scale(U,T,p[A][0]),a.scale(W,Q,p[A][1]),a.add(U,U,W),a.add(U,U,z),G[M++]=U[0],G[M++]=U[1],G[M++]=U[2];p=L/3;P[L++]=O[0];P[L++]=O[1];P[L++]=O[2];F=ka-F;for(L=0;L<y.length;L++)N[J++]=
0<=y[L][0]?ka+y[L][0]:-y[L][0]-1+F,N[J++]=0<=y[L][2]?ka+y[L][2]:-y[L][2]-1+F,N[J++]=0<=y[L][1]?ka+y[L][1]:-y[L][1]-1+F,K[H++]=p,K[H++]=p,K[H++]=p;return new g.Geometry([[d.VertexAttribute.POSITION,{size:3,data:G,exclusive:!0}],[d.VertexAttribute.NORMAL,{size:3,data:P,exclusive:!0}]],[[d.VertexAttribute.POSITION,N],[d.VertexAttribute.NORMAL,K]])};B.createPolylineGeometry=function(z,A,p){f.assert(1<z.length,"createPolylineGeometry(): polyline needs at least 2 points");f.assert(3===z[0].length,"createPolylineGeometry(): malformed vertex");
f.assert(null==A||A.length===z.length,"createPolylineGeometry: need same number of points and normals");f.assert(null==A||3===A[0].length,"createPolylineGeometry(): malformed normal");var y=new Float64Array(3*z.length);const D=new Uint32Array(2*(z.length-1));var E=0,F=0;for(var G=0;G<z.length;G++){for(var P=0;3>P;P++)y[E++]=z[G][P];0<G&&(D[F++]=G-1,D[F++]=G)}E=[];F=[];E.push([d.VertexAttribute.POSITION,D]);F.push([d.VertexAttribute.POSITION,{size:3,data:y,exclusive:!0}]);if(A){y=new Float32Array(3*
A.length);G=0;for(P=0;P<z.length;P++)for(let K=0;3>K;K++)y[G++]=A[P][K];E.push([d.VertexAttribute.NORMAL,D]);F.push([d.VertexAttribute.NORMAL,{size:3,data:y,exclusive:!0}])}p&&(F.push([d.VertexAttribute.COLOR,{size:4,data:p}]),E.push([d.VertexAttribute.COLOR,k.generateDefaultIndexArray(p.length/4)]));return new g.Geometry(F,E,r.PrimitiveType.Line)};B.createExtrudedTriangle=function(z,A,p,y,D=0){const E=Array(18);z=[[-A,D,y/2],[p,D,y/2],[0,z+D,y/2],[-A,D,-y/2],[p,D,-y/2],[0,z+D,-y/2]];A=new Uint16Array([0,
1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(p=0;6>p;p++)E[3*p]=z[p][0],E[3*p+1]=z[p][1],E[3*p+2]=z[p][2];return new g.Geometry([[d.VertexAttribute.POSITION,{size:3,data:E,exclusive:!0}]],[[d.VertexAttribute.POSITION,A]])};B.transformInPlace=function(z,A){z=z.getMutableAttribute(d.VertexAttribute.POSITION).data;for(let p=0;p<z.length;p+=3)a.set(x,z[p],z[p+1],z[p+2]),a.transformMat4(x,x,A),z[p]=x[0],z[p+1]=x[1],z[p+2]=x[2]};B.cgToGIS=function(z,A=z){var p=z.vertexAttributes;z=p.get(d.VertexAttribute.POSITION).data;
if(p=p.get(d.VertexAttribute.NORMAL).data){var y=A.getMutableAttribute(d.VertexAttribute.NORMAL).data;for(var D=0;D<p.length;D+=3){const E=p[D+1];y[D+1]=-p[D+2];y[D+2]=E}}if(z)for(p=A.getMutableAttribute(d.VertexAttribute.POSITION).data,y=0;y<z.length;y+=3)D=z[y+1],p[y+1]=-z[y+2],p[y+2]=D;return A};B.makeOrthoBasisDirUp=q;B.makeOrthoBasisDirUpFallback=u})(t||(t={}));const x=b.create();return t})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["exports"],function(a){a.Vec3Compact=
void 0;(function(b){b.length=function(c,m){const l=c[m],r=c[m+1];c=c[m+2];return Math.sqrt(l*l+r*r+c*c)};b.normalize=function(c,m){var l=c[m];const r=c[m+1],n=c[m+2];l=1/Math.sqrt(l*l+r*r+n*n);c[m]*=l;c[m+1]*=l;c[m+2]*=l};b.scale=function(c,m,l){c[m]*=l;c[m+1]*=l;c[m+2]*=l};b.add=function(c,m,l,r,n,g=m){n=n||c;n[g]=c[m]+l[r];n[g+1]=c[m+1]+l[r+1];n[g+2]=c[m+2]+l[r+2]};b.subtract=function(c,m,l,r,n,g=m){n=n||c;n[g]=c[m]-l[r];n[g+1]=c[m+1]-l[r+1];n[g+2]=c[m+2]-l[r+2]}})(a.Vec3Compact||(a.Vec3Compact=
{}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Geometry":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./basicInterfaces ./BoundingInfo ./ContentObject ./ContentObjectType ./geometryDataUtils ./Util ./VertexAttribute".split(" "),function(a,b,c,m,l,r,n,g,k,f){function d(e){if(e.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return e;for(const h of e)if(65536<=h)return e;
return new Uint16Array(e)}r=function(e){function h(w,t=[],x=m.PrimitiveType.Triangle,B=-1){var q=e.call(this)||this;q._primitiveType=x;q.edgeIndicesLength=B;q.type=n.ContentObjectType.Geometry;q._vertexAttributes=new Map;q._indices=new Map;q._boundingInfo=null;for(const [u,C]of w)C&&q._vertexAttributes.set(u,{...C});if(null==t||0===t.length){w=q._vertexAttributes.values().next().value;w=null==w?0:w.data.length/w.size;t=g.generateDefaultIndexArray(w);q.edgeIndicesLength=0>q.edgeIndicesLength?w:q.edgeIndicesLength;
for(const u of q._vertexAttributes.keys())q._indices.set(u,t)}else for(const [u,C]of t)C&&(q._indices.set(u,d(C)),u===f.VertexAttribute.POSITION&&(q.edgeIndicesLength=0>q.edgeIndicesLength?q._indices.get(u).length:q.edgeIndicesLength));return q}b._inheritsLoose(h,e);var v=h.prototype;v.cloneShallow=function(){const w=new h([],void 0,this._primitiveType,void 0),{_vertexAttributes:t,_indices:x}=w;this._vertexAttributes.forEach((B,q)=>{t.set(q,B)});this._indices.forEach((B,q)=>{x.set(q,B)});w.screenToWorldRatio=
this.screenToWorldRatio;w._boundingInfo=this._boundingInfo;return w};v.getMutableAttribute=function(w){(w=this._vertexAttributes.get(w))&&!w.exclusive&&(w.data=Array.from(w.data),w.exclusive=!0);return w};v.computeAttachmentOrigin=function(w){return this.primitiveType===m.PrimitiveType.Triangle?this._computeAttachmentOriginTriangles(w):this._computeAttachmentOriginPoints(w)};v._computeAttachmentOriginTriangles=function(w){const t=this.indices.get(f.VertexAttribute.POSITION),x=this.vertexAttributes.get(f.VertexAttribute.POSITION);
return g.computeAttachmentOriginTriangles(x,t,w)};v._computeAttachmentOriginPoints=function(w){const t=this.indices.get(f.VertexAttribute.POSITION),x=this.vertexAttributes.get(f.VertexAttribute.POSITION);return g.computeAttachmentOriginPoints(x,t,w)};v.invalidateBoundingInfo=function(){this._boundingInfo=null};v._calculateBoundingInfo=function(){const w=this.indices.get(f.VertexAttribute.POSITION);if(0===w.length)return null;const t=this.primitiveType===m.PrimitiveType.Triangle?3:1;k.assert(0===w.length%
t,"Indexing error: "+w.length+" not divisible by "+t);const x=g.generateDefaultIndexArray(w.length/t),B=this.vertexAttributes.get(f.VertexAttribute.POSITION);return new l.BoundingInfo(x,t,w,B)};b._createClass(h,[{key:"vertexAttributes",get:function(){return this._vertexAttributes}},{key:"indices",get:function(){return this._indices}},{key:"indexCount",get:function(){const w=this._indices.values().next().value;return w?w.length:0}},{key:"primitiveType",get:function(){return this._primitiveType}},{key:"faceCount",
get:function(){return this.indexCount/3}},{key:"boundingInfo",get:function(){c.isNone(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo());return this._boundingInfo}}]);return h}(r.ContentObject);a.Geometry=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define(["exports","../../../../core/PooledArray","../../../../chunks/vec3","../../../../chunks/vec3f64","./Util"],function(a,
b,c,m,l){let r=function(){function g(f,d,e,h){this.primitiveIndices=f;this._numIndexPerPrimitive=d;this.indices=e;this.position=h;this.center=m.create();l.assert(1<=f.length);l.assert(0===e.length%this._numIndexPerPrimitive);l.assert(e.length>=f.length*this._numIndexPerPrimitive);l.assert(3===h.size||4===h.size);const {data:v,size:w}=h;h=f.length;d=w*e[this._numIndexPerPrimitive*f[0]];n.clear();n.push(d);this.bbMin=m.fromValues(v[d],v[d+1],v[d+2]);this.bbMax=m.clone(this.bbMin);for(var t=0;t<h;++t){var x=
this._numIndexPerPrimitive*f[t];for(var B=0;B<this._numIndexPerPrimitive;++B){d=w*e[x+B];n.push(d);let q=v[d];this.bbMin[0]=Math.min(q,this.bbMin[0]);this.bbMax[0]=Math.max(q,this.bbMax[0]);q=v[d+1];this.bbMin[1]=Math.min(q,this.bbMin[1]);this.bbMax[1]=Math.max(q,this.bbMax[1]);q=v[d+2];this.bbMin[2]=Math.min(q,this.bbMin[2]);this.bbMax[2]=Math.max(q,this.bbMax[2])}}c.lerp(this.center,this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),
this.bbMax[2]-this.bbMin[2]);f=this.radius*this.radius;for(e=0;e<n.length;++e)d=n.getItemAt(e),h=v[d]-this.center[0],t=v[d+1]-this.center[1],d=v[d+2]-this.center[2],x=h*h+t*t+d*d,x<=f||(x=Math.sqrt(x),B=.5*(x-this.radius),this.radius+=B,f=this.radius*this.radius,x=B/x,this.center[0]+=h*x,this.center[1]+=t*x,this.center[2]+=d*x);n.clear()}var k=g.prototype;k.getCenter=function(){return this.center};k.getBSRadius=function(){return this.radius};k.getBBMin=function(){return this.bbMin};k.getBBMax=function(){return this.bbMax};
k.getChildren=function(){if(this._children)return this._children;if(1<c.squaredDistance(this.bbMin,this.bbMax)){var f=c.lerp(m.create(),this.bbMin,this.bbMax,.5),d=this.primitiveIndices.length;const w=new Uint8Array(d),t=Array(8);for(var e=0;8>e;++e)t[e]=0;const {data:x,size:B}=this.position;for(e=0;e<d;++e){var h=0;const q=this._numIndexPerPrimitive*this.primitiveIndices[e];var v=B*this.indices[q];let u=x[v],C=x[v+1],z=x[v+2];for(let A=1;A<this._numIndexPerPrimitive;++A){v=B*this.indices[q+A];const p=
x[v],y=x[v+1];v=x[v+2];p<u&&(u=p);y<C&&(C=y);v<z&&(z=v)}u<f[0]&&(h|=1);C<f[1]&&(h|=2);z<f[2]&&(h|=4);w[e]=h;++t[h]}f=0;for(e=0;8>e;++e)0<t[e]&&++f;if(2>f)return;f=Array(8);for(e=0;8>e;++e)f[e]=0<t[e]?new Uint32Array(t[e]):void 0;for(e=0;8>e;++e)t[e]=0;for(e=0;e<d;++e)h=w[e],f[h][t[h]++]=this.primitiveIndices[e];this._children=Array(8);for(d=0;8>d;++d)void 0!==f[d]&&(this._children[d]=new g(f[d],this._numIndexPerPrimitive,this.indices,this.position))}return this._children};g.prune=function(){n.prune()};
return g}();const n=new b({deallocator:null});a.BoundingInfo=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["exports","../../../../chunks/vec2f64","../../../../chunks/vec4","../../../../chunks/vec4f64"],function(a,b,c,m){function l(g,k){if(!g)throw k=k||"assert",console.log(Error(k).stack),new n(k);}const r=m.create();let n=function(){function g(k){this.message=k}g.prototype.toString=function(){return`AssertException: ${this.message}`};
return g}();a.assert=l;a.fovd2fovx=function(g,k,f){return 2*Math.atan(k*Math.tan(.5*g)/Math.sqrt(k*k+f*f))};a.fovd2fovy=function(g,k,f){return 2*Math.atan(f*Math.tan(.5*g)/Math.sqrt(k*k+f*f))};a.fovx2fovd=function(g,k,f){return 2*Math.atan(Math.sqrt(k*k+f*f)*Math.tan(.5*g)/k)};a.fovy2fovd=function(g,k,f){return 2*Math.atan(Math.sqrt(k*k+f*f)*Math.tan(.5*g)/f)};a.isTranslationMatrix=function(g){return 1===g[0]&&0===g[1]&&0===g[2]&&0===g[3]&&0===g[4]&&1===g[5]&&0===g[6]&&0===g[7]&&0===g[8]&&0===g[9]&&
1===g[10]&&0===g[11]&&1===g[15]};a.logWithBase=function(g,k){return Math.log(g)/Math.log(k)};a.project=function(g,k,f,d,e){e||(e=g);r[0]=g[0];r[1]=g[1];r[2]=g[2];r[3]=1;c.transformMat4(r,r,k);2<e.length&&(e[2]=-r[2]);c.transformMat4(r,r,f);l(0!==r[3]);e[0]=r[0]/r[3];e[1]=r[1]/r[3];e[2]=r[2]/r[3];e[0]=(.5*e[0]+.5)*d[2]+d[0];e[1]=(.5*e[1]+.5)*d[3]+d[1]};a.rayBoxTest=function(g,k,f,d){let e,h=(f[0]-g[0])/k[0],v=(d[0]-g[0])/k[0];h>v&&(e=h,h=v,v=e);let w=(f[1]-g[1])/k[1],t=(d[1]-g[1])/k[1];w>t&&(e=w,w=
t,t=e);if(h>t||w>v)return!1;w>h&&(h=w);t<v&&(v=t);f=(f[2]-g[2])/k[2];g=(d[2]-g[2])/k[2];f>g&&(e=f,f=g,g=e);if(h>g||f>v)return!1;g<v&&(v=g);return 0>v?!1:!0};a.rayRay2D=function(g,k,f,d,e,h=b.create()){const v=(d[e]-f[e])*(k[0]-g[0])-(d[0]-f[0])*(k[e]-g[e]);if(0===v)return!1;f=((d[0]-f[0])*(g[e]-f[e])-(d[e]-f[e])*(g[0]-f[0]))/v;h[0]=g[0]+f*(k[0]-g[0]);h[1]=g[e]+f*(k[e]-g[e]);return!0};a.setMatrixTranslation3=function(g,k,f,d){g[12]=k;g[13]=f;g[14]=d};a.verify=function(g,k){g||console.warn("Verify failed: "+
(k||"")+"\n"+Error("verify").stack)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/ContentObject":function(){define(["exports","../../../../core/uid"],function(a,b){let c=function(){function m(){this.id=b.generateUID()}m.prototype.unload=function(){};return m}();a.ContentObject=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/ContentObjectType":function(){define(["exports"],
function(a){a.ContentObjectType=void 0;var b=a.ContentObjectType||(a.ContentObjectType={});b[b.Layer=0]="Layer";b[b.Object=1]="Object";b[b.Geometry=2]="Geometry";b[b.Material=3]="Material";b[b.Texture=4]="Texture";b[b.COUNT=5]="COUNT";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["exports","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/support/triangle"],
function(a,b,c,m){let l=(()=>{const e=new Uint32Array(131072);for(let h=0;h<e.length;++h)e[h]=h;return e})();const r=new Uint16Array([0]),n=(()=>{const e=new Uint16Array(65536);for(let h=0;h<e.length;++h)e[h]=h;return e})(),g=c.create(),k=c.create(),f=c.create(),d=c.create();a.computeAttachmentOriginLines=function(e,h,v,w){if(!e)return!1;const {size:t,data:x}=e;b.set(w,0,0,0);b.set(d,0,0,0);let B=e=0;const q=h?h.length-1:x.length/t-1;v=q+(v?2:0);for(let z=0;z<v;z+=2){var u=z<q?z:q,C=z<q?z+1:0;u=(h?
h[u]:u)*t;C=(h?h[C]:C)*t;g[0]=x[u+0];g[1]=x[u+1];g[2]=x[u+2];k[0]=x[C+0];k[1]=x[C+1];k[2]=x[C+2];b.scale(g,b.add(g,g,k),.5);C=b.dist(g,k);0<C?(b.add(w,w,b.scale(g,g,C)),e+=C):(b.add(d,d,g),B++)}return 0!==e?(b.scale(w,w,1/e),!0):0!==B?(b.scale(w,d,1/B),!0):!1};a.computeAttachmentOriginPoints=function(e,h,v){if(!e||!h)return!1;const {size:w,data:t}=e;b.set(v,0,0,0);e=-1;let x=0;for(let B=0;B<h.length;B++){const q=h[B]*w;e!==q&&(v[0]+=t[q+0],v[1]+=t[q+1],v[2]+=t[q+2],x++);e=q}1<x&&b.scale(v,v,1/x);
return 0<x};a.computeAttachmentOriginTriangles=function(e,h,v){if(!e)return!1;const {size:w,data:t}=e;b.set(v,0,0,0);b.set(d,0,0,0);let x=e=0;for(let q=0;q<h.length-2;q+=3){var B=h[q+0]*w;const u=h[q+1]*w,C=h[q+2]*w;b.set(g,t[B+0],t[B+1],t[B+2]);b.set(k,t[u+0],t[u+1],t[u+2]);b.set(f,t[C+0],t[C+1],t[C+2]);(B=m.areaPoints3d(g,k,f))?(b.add(g,g,k),b.add(g,g,f),b.scale(g,g,1/3*B),b.add(v,v,g),e+=B):(b.add(d,d,g),b.add(d,d,k),b.add(d,d,f),x+=3)}return 0===x&&0===e?!1:0!==e?(b.scale(v,v,1/e),!0):0!==x?(b.scale(v,
d,1/x),!0):!1};a.generateDefaultIndexArray=function(e){if(1===e)return r;if(e<n.length)return new Uint16Array(n.buffer,0,e);if(e>l.length){l=new Uint32Array(Math.max(2*l.length,e));for(let h=0;h<l.length;h++)l[h]=h}return new Uint32Array(l.buffer,0,e)};a.generateIndexArray=function(e){if(1===e)return new Uint16Array(r);if(e<n.length)return new Uint16Array(n.slice(0,e));if(e>l.length){e=new Uint32Array(e);for(let h=0;h<e.length;h++)e[h]=h;return e}return new Uint32Array(l.slice(0,e))};Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/triangle":function(){define("exports ../../core/ObjectStack ../../chunks/vec3 ../../chunks/vec3f64 ./lineSegment ./vectorStacks".split(" "),function(a,b,c,m,l,r){function n(v){return v?{p0:m.clone(v.p0),p1:m.clone(v.p1),p2:m.clone(v.p2)}:{p0:m.create(),p1:m.create(),p2:m.create()}}function g(v,w,t,x=n()){c.copy(x.p0,v);c.copy(x.p1,w);c.copy(x.p2,t);return x}function k(v,w,t){return.5*Math.abs((w[0]-v[0])*(t[1]-
v[1])-(w[1]-v[1])*(t[0]-v[0]))}const f=new b.ObjectStack(l.create),d=new b.ObjectStack(()=>({p0:null,p1:null,p2:null})),e=m.create(),h=m.create();a.area2d=function(v){return k(v.p0,v.p1,v.p2)};a.areaPoints2d=k;a.areaPoints3d=function(v,w,t){c.subtract(e,w,v);c.subtract(h,t,v);return c.length(c.cross(e,e,h))/2};a.copy=function(v,w=n()){return g(v.p0,v.p1,v.p2,w)};a.create=n;a.distance2=function(v,w){var t=v.p0,x=v.p1;v=v.p2;const B=c.subtract(r.sv3d.get(),x,t),q=c.subtract(r.sv3d.get(),v,x),u=c.subtract(r.sv3d.get(),
t,v),C=c.subtract(r.sv3d.get(),w,t);var z=c.subtract(r.sv3d.get(),w,x),A=c.subtract(r.sv3d.get(),w,v);const p=c.cross(B,B,u),y=c.dot(c.cross(r.sv3d.get(),B,p),C);z=c.dot(c.cross(r.sv3d.get(),q,p),z);A=c.dot(c.cross(r.sv3d.get(),u,p),A);if(0<y&&0<z&&0<A)return w=c.dot(p,C),w*w/c.dot(p,p);t=l.distance2(l.fromValues(t,B,f.get()),w);x=l.distance2(l.fromValues(x,q,f.get()),w);w=l.distance2(l.fromValues(v,u,f.get()),w);return Math.min(t,x,w)};a.fromValues=g;a.intersectRay=function(v,w,t){const {direction:x,
origin:B}=w,{p0:q,p1:u,p2:C}=v;var z=u[0]-q[0],A=u[1]-q[1],p=u[2]-q[2];v=C[0]-q[0];w=C[1]-q[1];const y=C[2]-q[2];var D=x[1]*y-w*x[2],E=x[2]*v-y*x[0];const F=x[0]*w-v*x[1];var G=z*D+A*E+p*F;if(-1E-5<G&&1E-5>G)return!1;G=1/G;const P=B[0]-q[0],K=B[1]-q[1],N=B[2]-q[2];D=G*(P*D+K*E+N*F);if(0>D||1<D)return!1;E=K*p-A*N;p=N*z-p*P;z=P*A-z*K;A=G*(x[0]*E+x[1]*p+x[2]*z);if(0>A||1<D+A)return!1;t&&(c.scale(t,x,G*(v*E+w*p+y*z)),c.add(t,B,t));return!0};a.wrap=function(v,w,t){const x=d.get();x.p0=v;x.p1=w;x.p2=t;
return x};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/Precipitation":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/maybe ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../chunks/vec3f64 ../../../core/support/WatchUpdatingTracking ../../../geometry/projectionEllipsoid ./PrecipitationTechnique ./PrecipitationTechniqueConfiguration ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/AnimationTimer ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E){a.Precipitation=function(P){function K(M){var L=P.call(this,M)||this;L._numParticles=25E4;L._rainSpeed=.1;L._snowSpeed=.01;L._opacity=1;L._width=500;L._offset=w.create();L._tile=w.create();L._particleColor=v.create();L._particleColorAtNight=v.create();L._nightMultiplier=.7;L._cameraDirection=v.create();L._renderParameters=new B.PrecipitationPassParameters;L._animation=new z.AnimationTimer;L._updatingTracking=new t.WatchUpdatingTracking;
L._renderParameters.time=0;L._renderParameters.radius=x.getReferenceEllipsoid(M.view.spatialReference).radius;L._shaderTechniqueRepository=M.context.shaderTechniqueRepository;return L}b._inheritsLoose(K,P);var N=K.prototype;N.destroy=function(){this._updatingTracking.destroy();this._numParticles=0;this._snowTechnique=r.releaseMaybe(this._snowTechnique);this._rainTechnique=r.releaseMaybe(this._rainTechnique);this._vao=r.disposeMaybe(this._vao);this._instanceIdBuffer=r.disposeMaybe(this._instanceIdBuffer)};
N.update=function(M){return this._animation.advance(M)};N.render=function(M,L,J){const H="rainy"===J;var I=H?this.rainTechnique:this.snowTechnique;if(I.compiled){var O=M.rctx;this._ensureResources(O);r.isNone(I)||r.isNone(this._vao)||r.isNone(this._instanceIdBuffer)||(r.isSome(M.bindParameters.clouds.data)&&(this._opacity=1-M.bindParameters.clouds.fadeInOutHeight.factor),0>=this._opacity||(L=.5>L?l.lerp(0,.35,2*L):l.lerp(.35,1,2*(L-.5)),I=O.bindTechnique(I),this._renderParameters.camera=M.bindParameters.camera,
this._renderParameters.time=(H?this._rainSpeed:this._snowSpeed)*n.secondsFromMilliseconds(this._animation.time),this._renderParameters.time%=1E5,this._update(I,J,M),O.bindVAO(this._vao),M=B.PrecipitationTechnique.attributeLocation,I.assertCompatibleVertexAttributeLocations(this._vao),D.bindVertexBufferLayout(O,M,this._instanceIdBuffer,G,0),O.capabilities.instancing.drawArraysInstanced(y.PrimitiveType.TRIANGLES,0,3,this._numParticles*L),D.unbindVertexBufferLayout(O,M,this._instanceIdBuffer,G)))}else this.context.requestRender()};
N._update=function(M,L,J){const H=J.bindParameters.camera,I=H.eye;this._tile[0]=Math.floor((I[0]+.5*this._width)/this._width);this._tile[1]=Math.floor((I[1]+.5*this._width)/this._width);this._tile[2]=Math.floor((I[2]+.5*this._width)/this._width);this._offset[0]=I[0]-this._tile[0]*this._width;this._offset[1]=I[1]-this._tile[1]*this._width;this._offset[2]=I[2]-this._tile[2]*this._width;M.setUniform1f("width",this._width);M.setUniform3fv("offset",this._offset);M.setUniformMatrix4fv("view",H.viewMatrix);
M.setUniform3fv("cameraPosition",I);M.bindPass(null,J.bindParameters);M.setUniform1f("time",this._renderParameters.time);"rainy"===L?h.set(this._particleColor,.85,.85,.85):h.set(this._particleColor,1,1,1);h.scale(this._particleColorAtNight,this._particleColor,this._nightMultiplier);h.normalize(this._cameraDirection,I);L=Math.max(0,h.dot(this._cameraDirection,J.bindParameters.lighting.lightingMainDirection));h.lerp(this._particleColor,this._particleColorAtNight,this._particleColor,L);M.setUniform3fv("particleColor",
this._particleColor);M.setUniform1f("opacity",this._opacity)};N._ensureResources=function(M){r.isNone(this._vao)&&(this._vao=this._createVertexArrayObject(M));r.isNone(this._instanceIdBuffer)&&(this._instanceIdBuffer=this._createInstanceIndices(M))};N._createInstanceIndices=function(M){const L=[];for(let J=0;J<this._numParticles;J++)L.push(J);return p.BufferObject.createVertex(M,y.Usage.STATIC_DRAW,new Float32Array(L))};N._createVertexArrayObject=function(M){const L=new Float32Array([-1,0,1,1,0,-1,
1,0,1]);return new E.VertexArrayObject(M,B.PrecipitationTechnique.attributeLocation,{geometry:u.glLayout(F)},{geometry:p.BufferObject.createVertex(M,y.Usage.STATIC_DRAW,L)})};b._createClass(K,[{key:"updating",get:function(){return this._updatingTracking.updating}},{key:"rainTechnique",get:function(){if(r.isNone(this._rainTechnique)){const M=new q.PrecipitationTechniqueConfiguration;M.type=q.PrecipitationType.Rain;this._rainTechnique=this._shaderTechniqueRepository.acquire(B.PrecipitationTechnique,
M)}return this._rainTechnique}},{key:"snowTechnique",get:function(){if(r.isNone(this._snowTechnique)){const M=new q.PrecipitationTechniqueConfiguration;M.type=q.PrecipitationType.Snow;this._snowTechnique=this._shaderTechniqueRepository.acquire(B.PrecipitationTechnique,M)}return this._snowTechnique}}]);return K}(m);c.__decorate([g.property({constructOnly:!0})],a.Precipitation.prototype,"context",void 0);c.__decorate([g.property({constructOnly:!0})],a.Precipitation.prototype,"view",void 0);c.__decorate([g.property({readOnly:!0})],
a.Precipitation.prototype,"updating",null);c.__decorate([g.property()],a.Precipitation.prototype,"_updatingTracking",void 0);a.Precipitation=c.__decorate([e.subclass("esri.views.3d.environment.Precipitation")],a.Precipitation);const F=C.newLayout().vec3f(A.VertexAttribute.POSITION),G=u.glLayout(C.newLayout().f32(A.VertexAttribute.INSTANCEFEATUREATTRIBUTE),1);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/PrecipitationTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/Precipitation.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/Program ../webgl-engine/lib/VertexAttribute ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){l=function(e){function h(){var v=e.apply(this,arguments)||this;v.time=0;v.radius=1;return v}c._inheritsLoose(h,e);return h}(l.NoParameters);n=function(e){function h(){return e.apply(this,arguments)||this}c._inheritsLoose(h,e);var v=h.prototype;v.initializeProgram=function(w){const t=h.shader.get().build(this.configuration);return new g.Program(w.rctx,t,h.attributeLocation)};v.initializePipeline=function(){return d.makePipelineState({blending:d.separateBlendingParams(f.BlendFactor.ONE,
f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA,f.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:f.CompareFunction.LEQUAL},colorWrite:d.defaultColorWriteParams})};return h}(n.ShaderTechnique);n.shader=new r.ReloadableShaderModule(m.Precipitation,()=>new Promise((e,h)=>a(["./Precipitation.glsl"],e,h)));n.attributeLocation=new Map([[k.VertexAttribute.POSITION,0],[k.VertexAttribute.INSTANCEFEATUREATTRIBUTE,1]]);b.PrecipitationPassParameters=l;b.PrecipitationTechnique=n;Object.defineProperties(b,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/Precipitation.glsl":function(){define("exports ../views/3d/environment/PrecipitationTechniqueConfiguration ../views/3d/webgl-engine/core/shaderModules/Float3Uniform ../views/3d/webgl-engine/core/shaderModules/FloatUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/Matrix4Uniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,m,l,r,n,g,k){function f(e){const h=new g.ShaderBuilder;h.attributes.add(k.VertexAttribute.POSITION,"vec3");h.attributes.add(k.VertexAttribute.INSTANCEFEATUREATTRIBUTE,"float");h.vertex.uniforms.add(new c.Float3Uniform("cameraPosition"));h.vertex.uniforms.add(new c.Float3Uniform("offset"));h.vertex.uniforms.add(new m.FloatUniform("width"));h.vertex.uniforms.add(new r.Matrix4PassUniform("proj",(v,w)=>w.camera.projectionMatrix));h.vertex.uniforms.add(new n.Matrix4Uniform("view"));h.vertex.uniforms.add(new m.FloatUniform("time"));
h.varyings.add("vUv","vec2");h.vertex.code.add(l.glsl`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${e.type===b.PrecipitationType.Rain?l.glsl`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:l.glsl`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `);h.fragment.uniforms.add(new m.FloatUniform("opacity"));h.fragment.uniforms.add(new c.Float3Uniform("particleColor"));h.fragment.code.add(l.glsl`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${e.type===b.PrecipitationType.Rain?l.glsl`d = 0.35 * smoothstep(0.5, 0.0, d);`:l.glsl`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `);return h}const d=Object.freeze(Object.defineProperty({__proto__:null,build:f},Symbol.toStringTag,{value:"Module"}));a.Precipitation=d;a.build=f})},"esri/views/3d/environment/PrecipitationTechniqueConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,m){a.PrecipitationType=void 0;(function(r){r[r.Rain=0]="Rain";r[r.Snow=1]="Snow";r[r.COUNT=2]="COUNT"})(a.PrecipitationType||
(a.PrecipitationType={}));let l=function(r){function n(){var g=r.apply(this,arguments)||this;g.type=a.PrecipitationType.Rain;return g}b._inheritsLoose(n,r);return n}(m.ShaderTechniqueConfiguration);c.__decorate([m.parameter({count:a.PrecipitationType.COUNT})],l.prototype,"type",void 0);a.PrecipitationTechniqueConfiguration=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/AnimationTimer":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/maybe","../../../../core/time"],function(a,b,c,m){let l=function(){function r(){this.enabled=!0;this._time=0}r.prototype.advance=function(n){if(c.isSome(n.forcedTime)){if(this._time===n.forcedTime)return!1;this._time=n.forcedTime;return!0}return this.enabled&&0!==n.dt?(this._time+=n.dt,!0):!1};b._createClass(r,[{key:"time",get:function(){return m.Milliseconds(this._time)}}]);return r}();a.AnimationTimer=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/environment/SimpleAtmosphere":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../../geometry/support/spatialReferenceUtils ../../../support/requestImageUtils ./atmosphereUtils ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechnique ./SimpleAtmosphereTechniqueConfiguration ./resources/MarsAtmosphereTexture ./resources/SimpleAtmosphereTexture ../support/mathUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Util ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N,M){function L(U,aa,W,R,V){const da=d.length(U),ca=R*Math.sqrt(da*da-R*R)/da,ha=V.silCircleV1,ia=V.silCircleV2;d.scale(V.silCircleCenter,U,Math.sqrt(R*R-ca*ca)/da);d.cross(ha,U,aa);1>d.squaredLength(ha)&&d.cross(ha,U,W);d.scale(ha,ha,ca/d.length(ha));d.cross(ia,ha,U);d.scale(ia,ia,ca/d.length(ia));return ca}const J=b.getLogger("esri.views.3d.environment.SimpleAtmosphere"),H=-t.innerAtmosphereDepth,I=z.makePiecewiseLinearFunction([[50,
.1015625],[500,.21875],[5E3,.51171875],[5E4,.4140625]]);b=function(){function U(W){this.view=W;this.type="simple";this._renderData={texV:f.create(),silCircleCenter:e.create(),silCircleV1:e.create(),silCircleV2:e.create(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0};this._passParameters=new x.SimpleAtmospherePassParameters;this._fadeVaoCount=0;this._readyResolver=l.createResolver();this._readyController=new AbortController;this.texV1=1;this.canRender=!0;this.isOnMars=v.isMars(W.spatialReference);
W=h.getReferenceEllipsoid(W.spatialReference);this.planetRadius=W.radius;this.outerRimWidth=W.outerAtmosphereRimWidth;this.innerRimFactor=(this.planetRadius+H)/this.planetRadius;this.middleRimFactor=(this.planetRadius+0)/this.planetRadius;this.outerRimFactor=(this.planetRadius+this.outerRimWidth)/this.planetRadius;this.texV0=0/this.outerRimWidth;this.texVScale=this.texV1-this.texV0}var aa=U.prototype;aa.destroy=function(){this._readyResolver.reject();this._cameraChangeHandle=m.removeMaybe(this._cameraChangeHandle);
this._passParameters.texture=m.disposeMaybe(this._passParameters.texture);this._fadeVao=m.disposeMaybe(this._fadeVao);this._vao=m.disposeMaybe(this._vao);this._readyController=m.abortMaybe(this._readyController)};aa.when=function(){return this._readyResolver.promise};aa.initializeRenderContext=function(){var W=a._asyncToGenerator(function*(R){this._shaderTechniqueRepository=R.shaderTechniqueRepository;const V=R.renderContext.rctx;this._cameraChangeHandle=r.watch(()=>{var ha;return null==(ha=this.view.state)?
void 0:ha.camera},()=>R.requestRender(),r.syncAndInitial);this._vao=this._createRibbon(V);this._vaoCount=N.vertexCount(this._vao,"geometry");this._fadeVao=D.createQuadVAO(V);this._fadeVaoCount=N.vertexCount(this._fadeVao,"geometry");const da=this.isOnMars?u:C,ca=this._readyController.signal;try{const ha=yield w.requestImage(da,{signal:ca});l.throwIfAborted(ca);this._passParameters.texture=new K.Texture(V,{pixelFormat:P.PixelFormat.RGBA,dataType:P.PixelType.UNSIGNED_BYTE,wrapMode:P.TextureWrapMode.CLAMP_TO_EDGE,
samplingMode:P.TextureSamplingMode.LINEAR,flipped:!0},ha);R.requestRender();this._readyController=null;this._readyResolver.resolve()}catch(ha){l.isAbortError(ha)||J.error("Unable to initialize simple atmosphere: image request failed",ha),this._readyResolver.reject(ha)}});return function(R){return W.apply(this,arguments)}}();aa.render=function(W){const R=W.bindParameters.camera;this._update(R);const V=W.rctx;if(1>this._renderData.undergroundFadeAlpha){const da=V.bindTechnique(this.coneTechnique,this._passParameters,
W.bindParameters);da.setUniformMatrix4fv("proj",R.projectionMatrix);da.setUniformMatrix4fv("view",R.viewMatrix);da.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter);da.setUniform3fv("silCircleV1",this._renderData.silCircleV1);da.setUniform3fv("silCircleV2",this._renderData.silCircleV2);da.setUniform2fv("texV",this._renderData.texV);da.setUniform1f("altitudeFade",this._renderData.altitudeFade);da.setUniform1f("innerScale",this._renderData.innerScale);V.bindVAO(this._vao);V.drawArrays(P.PrimitiveType.TRIANGLES,
0,this._vaoCount)}0<this._renderData.undergroundFadeAlpha&&(W=V.bindTechnique(this.undergroundTechnique,this._passParameters,W.bindParameters),W.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),W.setUniform3fv("cameraPosition",R.eye),V.bindVAO(this._fadeVao),V.drawArrays(P.PrimitiveType.TRIANGLE_STRIP,0,this._fadeVaoCount))};aa.renderHaze=function(){return!1};aa._update=function(W){var R=e.create();const V=this.planetRadius;var da=d.length(W.eye);const ca=da-V;this._renderData.undergroundFadeAlpha=
0>ca?Math.min(-ca/5E3,1):0;var ha=V+H,ia=V+Math.max(50,ca);this._renderData.innerScale=ia*ia/(Math.sqrt(ia*ia-V*V)*Math.sqrt(ia*ia-ha*ha)+V*ha)-1;this._renderData.altitudeFade=t.computeInnerAltitudeFade(ca);d.scale(R,W.eye,(V+50)/da);L(R,W.center,W.up,V,this._renderData);R=this._computeScreenRimWidth(W,R,W.up,this._renderData);da=I(ca);ha=this.texV0+.001953125*this.texVScale;ia=this.texV0+R*da*this.texVScale;50<ca&&(L(W.eye,W.center,W.up,V,this._renderData),W=this._computeScreenRimWidth(W,W.eye,W.up,
this._renderData),W=c.clamp((W-1.5)/(R-1.5),0,1),ha=this.texV0+.001953125*W*this.texVScale,ia=this.texV0+c.lerp(this.texV1,R*da,W)*this.texVScale);k.set(this._renderData.texV,ha,ia)};aa._createRibbon=function(W){const R=new Float32Array(1155),V=new Uint32Array(1920);R[0]=0;R[1]=0;R[2]=-1;for(var da=0;128>da;da++){var ca=9*da+3;R[ca+0]=da;R[ca+1]=this.innerRimFactor;R[ca+2]=-1;R[ca+3]=da;R[ca+4]=this.middleRimFactor;R[ca+5]=0;R[ca+6]=da;R[ca+7]=this.outerRimFactor;R[ca+8]=1;ca=3*da+1;var ha=127===
da?1:ca+3,ia=15*da;V[ia+0]=ca;V[ia+1]=ca+1;V[ia+2]=ha+1;V[ia+3]=ha+1;V[ia+4]=ha;V[ia+5]=ca;V[ia+6]=ca+1;V[ia+7]=ca+2;V[ia+8]=ha+2;V[ia+9]=ha+2;V[ia+10]=ha+1;V[ia+11]=ca+1;V[ia+12]=ca;V[ia+13]=ha;V[ia+14]=0}da=T.createBuffer(V.length);ca=da.position;for(ha=0;ha<V.length;++ha)ia=3*V[ha],ca.set(ha,0,R[ia]),ca.set(ha,1,R[ia+1]),ca.set(ha,2,R[ia+2]);return new M.VertexArrayObject(W,y.Default3D,{geometry:A.glLayout(T)},{geometry:G.BufferObject.createVertex(W,P.Usage.STATIC_DRAW,da.buffer)})};aa._computeScreenRimWidth=
function(W,R,V,da){d.add(Q,da.silCircleCenter,da.silCircleV2);d.scale(S,Q,this.outerRimFactor);n.lookAt(O,R,Q,V);E.project(Q,O,W.projectionMatrix,W.viewport);E.project(S,O,W.projectionMatrix,W.viewport);return d.distance(Q,S)/W.height};a._createClass(U,[{key:"coneTechnique",get:function(){if(m.isNone(this._coneTechnique)){const W=new q.SimpleAtmosphereTechniqueConfiguration;W.geometry=q.SimpleAtmosphereGeometry.Cone;this._coneTechnique=this._shaderTechniqueRepository.acquire(B.SimpleAtmosphereTechnique,
W)}return this._coneTechnique}},{key:"undergroundTechnique",get:function(){if(m.isNone(this._undergroundTechnique)){const W=new q.SimpleAtmosphereTechniqueConfiguration;W.geometry=q.SimpleAtmosphereGeometry.Underground;this._undergroundTechnique=this._shaderTechniqueRepository.acquire(B.SimpleAtmosphereTechnique,W)}return this._undergroundTechnique}}]);return U}();const O=g.create(),Q=e.create(),S=e.create(),T=p.newLayout().vec3f(F.VertexAttribute.POSITION);return b})},"esri/views/3d/environment/resources/MarsAtmosphereTexture":function(){define(function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAAE00TaTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAp1JREFUSMd9lcmSEzEQRCtflnqxYZgIThBDAP//kXDQ0pJtuDhqycxWZ5fKERFCERARIAVEyCjCtSFFEjWVa9q7OdJE0oiidIhKhRBROlhloiGVhaYERQHJWFEwMpYKrjUlibI2cqSJIJEpKNmM2c3GkRTOJDnThTMpnMWu0VFszs3Jfbe5bza3w+a229yOIs6zmP3czfn1K2w/for8+EVU15pNmmyqkeJyclinXNJRu1xrUaJmjmdzJiejVNt7zZVBRAIq1RwrsrrWnez+SR7WmQQP/1itKz2q/pmzuJtYnNy2bth9x9z2NLfDcB7FHOcGx6ebOb9/iPzxG/ztg4iorglFiKjzF9HSNphCoRb1OY3RZQJrYgRdT68bmgXGDdBzrTG8qNS7QP/m19ef7tGlcoH7vESYkK70uoPuOLEetz0IqeGoWQW6MlB/j36EnipYGKPWwDRg/RkNhXCNJIzAhMk6PrDePJNII6JHqM5VWqYApCtNFPe0GFFGtOWopWCrEVBSoiQi06KkRRaD08IlxXa/ifz8Jvz2LvjyLnh7F/r8Rei8a8xfjNkIrpmMOQ1C02COrkTEHxGhh+6DQJfXc/eZprXxcIyVIf1LJVgWvKaHvwI/1aQxtv851SQ/nqGXL6MHFVY3nmhLyqKsWO/+qzWif+yS1TpNKq8NezjGPCV69ciZoQj1PwfN6QRpWyCGVMe1D/AAHt3/gefu1Ign3AVpjOiNXkN90JlpL6TUnzFEUU+Jvks0tkp/dY3Fy1TzI24BWwsYJPyg11Q0FqDwK72xIz2kLojbeuxS1FpgtfNWyMX1gFw0j3W7RNeSHTVEe3VaV7SdCzVywFaEt02w7QH7Eeg4AvZDNdJ+Cu1HENsutO+Byi6ilEBZ9BeCNBJceJIjHgAAAABJRU5ErkJggg\x3d\x3d"})},
"esri/views/3d/environment/Stars":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../assets ../../../core/Accessor ../../../core/Error ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../core/support/WatchUpdatingTracking ./StarsTechnique ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/VertexArrayObject".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D){const E=n.getLogger("esri.views.3d.environment.Stars");a.Stars=function(M){function L(H){H=M.call(this,H)||this;H._loadDataTask=null;H._numPoints=0;H._renderParameter=new q.StarPassParameters;H._updatingTracking=new B.WatchUpdatingTracking;return H}b._inheritsLoose(L,M);var J=L.prototype;J.initialize=function(){this._loadDataTask=this._createLoadDataTask()};J.destroy=function(){this._loadDataTask=g.abortMaybe(this._loadDataTask);this._updatingTracking.destroy();
this._numPoints=0;this._technique=g.releaseMaybe(this._technique);this._vao=g.disposeMaybe(this._vao)};J.render=function(H){const {rctx:I}=H;this._ensureResources(I);g.isNone(this._technique)||g.isNone(this._vao)||(this._technique.compiled?(H=I.bindTechnique(this._technique,this._renderParameter,H.bindParameters),I.bindVAO(this._vao),H.assertCompatibleVertexAttributeLocations(this._vao),I.drawArrays(y.PrimitiveType.POINTS,0,this._numPoints)):this.requestRender())};J._ensureResources=function(H){if(!g.isSome(this._technique)&&
!g.isNone(N)){this._technique=new q.StarsTechnique({rctx:H,viewingMode:this.view.state.viewingMode});this._numPoints=N.byteLength/9;var I=new Float32Array(N,0,2*this._numPoints),O=new Uint8Array(N,8*this._numPoints,this._numPoints);this._vao=this._createVertexArrayObject(H,I,O,this._numPoints);this._updatingTracking.add(()=>"sun"===this.view.environment.lighting.type?this.view.environment.lighting.date:null,Q=>this._update(Q),f.initial)}};J._computeDayDuration=function(H){const I=new Date(H.getFullYear(),
0,1,11,58,56),O=new Date(H.getFullYear()+1,0,1,11,58,55);return(+H-+I)/(+O-+I)};J._update=function(H){if(H){var I=H.getHours()/12,O=H.getMinutes()/60*(2/24),Q=H.getSeconds()/60*(2/1440);I=(I+O+Q-.9972222)%2;H=2*this._computeDayDuration(H);O=t.copy(this._renderParameter.modelMatrix,P);t.rotateZ(O,O,-H*Math.PI);t.multiply(O,G,O);t.rotateZ(O,O,-I*Math.PI);this.requestRender()}};J._hexToRGB=function(H){return[parseInt(H.substring(0,2),16),parseInt(H.substring(2,4),16),parseInt(H.substring(4,6),16)]};
J._unpackUint8Attributes=function(H){return 192<=H?[2.9,H-192]:160<=H?[2.5,H-160]:128<=H?[2,H-128]:96<=H?[1.5,H-96]:64<=H?[1,H-64]:32<=H?[.7,H-32]:[.4,H]};J._createVertexArrayObject=function(H,I,O,Q){const S=K.createBuffer(Q),T=S.position,U=S.color,aa=S.size;for(let V=0;V<Q;V++){var W=I[2*V],R=I[2*V+1];T.set(V,0,-Math.cos(W)*Math.sin(R));T.set(V,1,-Math.sin(W)*Math.sin(R));T.set(V,2,-Math.cos(R));W=this._unpackUint8Attributes(O[V]);R=this._hexToRGB(F[W[1]]);U.set(V,0,255*R[0]);U.set(V,1,255*R[1]);
U.set(V,2,255*R[2]);U.set(V,3,255);aa.set(V,W[0])}return new D.VertexArrayObject(H,z.Default3D,{geometry:u.glLayout(K)},{geometry:p.BufferObject.createVertex(H,y.Usage.STATIC_DRAW,S.buffer)})};J._createLoadDataTask=function(){var H=this;if(g.isSome(N))return null;const I=k.createTask(function(){var O=b._asyncToGenerator(function*(Q){({data:Q}=yield m.fetchAsset("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:Q}));H._verifyStarData(Q);N=Q});return function(Q){return O.apply(this,
arguments)}}());I.promise.catch(O=>{k.isAbortError(O)||E.error(O)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))});return I};J._verifyStarData=function(H){if(!H)throw new r("stars:no-data-received","Failed to create stars because star catalogue is missing");H=H.byteLength/9;if(0!==H%1||5E4<H||5E3>H)throw new r("stars:invalid-data","Failed to create stars because star catalogue data is invalid");};b._createClass(L,[{key:"updating",get:function(){return this._updatingTracking.updating||
this.loading}},{key:"loading",get:function(){return g.isSome(this._loadDataTask)&&!this._loadDataTask.finished}}]);return L}(l);c.__decorate([d.property({constructOnly:!0})],a.Stars.prototype,"view",void 0);c.__decorate([d.property({constructOnly:!0})],a.Stars.prototype,"requestRender",void 0);c.__decorate([d.property({readOnly:!0})],a.Stars.prototype,"updating",null);c.__decorate([d.property()],a.Stars.prototype,"_loadDataTask",void 0);c.__decorate([d.property()],a.Stars.prototype,"_updatingTracking",
void 0);a.Stars=c.__decorate([w.subclass("esri.views.3d.environment.Stars")],a.Stars);const F="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),G=x.fromValues(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),P=x.fromValues(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,
0,0,0,0,1),K=C.newLayout().vec3f(A.VertexAttribute.POSITION).vec4u8(A.VertexAttribute.COLOR).f32(A.VertexAttribute.SIZE);let N=null;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/StarsTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/mat4f64 ../../../chunks/Stars.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e){r=function(h){function v(){var w=h.apply(this,arguments)||this;w.modelMatrix=m.create();return w}c._inheritsLoose(v,h);return v}(r.NoParameters);g=function(h){function v(t){var x;return x=h.call(this,t,null,()=>x.destroy())||this}c._inheritsLoose(v,h);var w=v.prototype;w.initializeProgram=function(t){const x=v.shader.get().build();return new f.Program(t.rctx,x,k.Default3D)};w.initializePipeline=function(){return e.makePipelineState({blending:e.separateBlendingParams(d.BlendFactor.SRC_ALPHA,
d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA,d.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:d.CompareFunction.LEQUAL},colorWrite:e.defaultColorWriteParams})};return v}(g.ShaderTechnique);g.shader=new n.ReloadableShaderModule(l.Stars,()=>new Promise((h,v)=>a(["./Stars.glsl"],h,v)));b.StarPassParameters=r;b.StarsTechnique=g;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/Stars.glsl":function(){define("exports ./mat4 ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,m,l,r,n,g,k,f){function d(){const h=new k.ShaderBuilder;h.attributes.add(f.VertexAttribute.POSITION,"vec3");h.attributes.add(f.VertexAttribute.COLOR,"vec4");h.attributes.add(f.VertexAttribute.SIZE,"float");h.varyings.add("vcolor","vec4");h.varyings.add("vsize","float");h.vertex.uniforms.add([new g.Matrix4PassUniform("transform",(v,w)=>{b.copy(e,w.camera.projectionMatrix);e[10]=2.4E-7-1;e[11]=-1;e[14]=(2.4E-7-2)*w.camera.near;b.multiply(e,e,w.camera.viewMatrix);return b.multiply(e,e,
v.modelMatrix)}),new l.Float4PassUniform("viewport",(v,w)=>w.camera.fullViewport),new r.FloatPassUniform("pixelRatio",(v,w)=>w.camera.pixelRatio)]);h.include(m.AlignPixel);h.vertex.code.add(n.glsl`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`);h.fragment.code.add(n.glsl`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`);return h}const e=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:d},Symbol.toStringTag,{value:"Module"}));a.Stars=c;a.build=d})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.AlignPixel=function(c){const m=b.glsl`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,l=b.glsl`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;c.vertex.code.add(m);c.vertex.code.add(l);c.fragment.code.add(m);c.fragment.code.add(l)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/RenderPass":function(){define(["exports"],function(a){a.RenderPass=void 0;var b=a.RenderPass||(a.RenderPass={});b[b.MATERIAL=0]="MATERIAL";b[b.MATERIAL_ALPHA=1]="MATERIAL_ALPHA";b[b.MATERIAL_DEPTH=2]="MATERIAL_DEPTH";b[b.MATERIAL_NORMAL=3]="MATERIAL_NORMAL";b[b.MATERIAL_DEPTH_SHADOWMAP_ALL=
4]="MATERIAL_DEPTH_SHADOWMAP_ALL";b[b.MATERIAL_HIGHLIGHT=5]="MATERIAL_HIGHLIGHT";b[b.MATERIAL_DEPTH_SHADOWMAP_DEFAULT=6]="MATERIAL_DEPTH_SHADOWMAP_DEFAULT";b[b.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT=7]="MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/earthUtils":function(){define(["exports","../../../core/mathUtils","../../../geometry/Point","../../../geometry/projectionEllipsoid"],function(a,b,c,m){function l(g,
k,f){return r(g,k.longitude,k.latitude,f.longitude,f.latitude)}function r(g,k,f,d,e){f=b.deg2rad(f);e=b.deg2rad(e);k=b.deg2rad(k);const h=b.deg2rad(d);d=Math.sin((f-e)/2);k=Math.sin((k-h)/2);f=2*b.asinClamped(Math.sqrt(d*d+Math.cos(f)*Math.cos(e)*k*k));return Math.round(f*g*1E4)/1E4}function n(g,k){g/=15;k||(g=Math.round(g));return g}a.getGreatCircleDistance=r;a.getGreatCircleDistanceFromPoints=l;a.getGreatCircleSpanAt=function(g,k,f){const d=k.spatialReference,e=m.getReferenceEllipsoid(d),h=new c(k.x,
g.y,d),v=new c(f.x,g.y,d);k=new c(g.x,k.y,d);g=new c(g.x,f.y,d);return{lon:l(e.radius,h,v),lat:l(e.radius,k,g)}};a.getLatDeltaForDistance=function(g,k){return b.rad2deg(g/k)};a.getLonDeltaForDistance=function(g,k,f){k/=f;g=b.deg2rad(g);k=Math.sin(k/2);g=Math.cos(g);g=2*b.asinClamped(Math.sqrt(k*k/(g*g)));return b.rad2deg(g)};a.getMaxCameraAltitude=function(g,k){g=b.deg2rad(g/2);return(1-Math.sin(g))*k/Math.sin(g)};a.longitudeToTimezone=n;a.pointToTimezone=function(g,k){return n(g.longitude,k)};a.positionToTimezoneInfo=
function(g,k){k||(k={hours:0,minutes:0,seconds:0});k.hours=n(g[0],!0);g=k.hours%1;k.hours-=g;k.minutes=60*g;g=k.minutes%1;k.minutes-=g;k.seconds=Math.round(60*g);return k};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/sunUtils":function(){define("exports ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../ViewingMode ../../../chunks/SunCalc ./mathUtils".split(" "),
function(a,b,c,m,l,r,n,g,k){function f(A,p,y,D){const E=x,F=c.identity(t);if(y===n.ViewingMode.Global)g.SunCalc.getPosition(A,0,0,E),l.set(D,0,0,-1),c.rotateX(F,F,-E.azimuth),c.rotateY(F,F,-E.altitude);else{var G=v.planarDirection;y=G.globalAngles;G=(Math.abs(p[2])-G.localAltitude)/(G.globalAltitude-G.localAltitude);G=b.clamp(G,0,1);1>G?(g.SunCalc.getPosition(A,p[1],p[0],E),E.azimuth=(1-G)*E.azimuth+G*y.azimuth,E.altitude=(1-G)*E.altitude+G*y.altitude):(E.azimuth=y.azimuth,E.altitude=y.altitude);
l.set(D,0,-1,0);c.rotateZ(F,F,-E.azimuth);c.rotateX(F,F,-E.altitude)}l.transformMat4(D,D,F)}function d(A){switch(A){case "disabled":case "sunny":return{direct:1,ambient:1};case "cloudy":return{direct:1,ambient:1};case "rainy":return{direct:.4,ambient:1.2};case "snowy":return{direct:.5,ambient:1.3};case "foggy":return{direct:.2,ambient:1.6}}}function e(A,p){const y=(A[0]+A[1]+A[2])/3;for(let D=0;3>D;D++)A[D]+=(y-A[D])*p;return A}function h(A,p,y,D){const E=[];for(let F=0;F<y.length;F++)E[F]=(D[F]-
y[F])*A/p+y[F];return E}const v={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8E5,ambient:.015,direct:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}},w=r.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258),t=m.create(),x={azimuth:0,altitude:0},B=new Date(0),q=m.create(),u=r.create(),C=r.create(),z=r.create();a.ColorAndIntensity=
function(){this.ambient={color:r.fromValues(1,1,1),intensity:.55};this.direct={color:r.fromValues(1,1,1),intensity:.55,directionToLightSource:r.clone(w)};this.noonFactor=.5;this.globalFactor=0;this.environmentStrength=this.specularStrength=1};a.computeColorAndIntensity=function(A,p,y,D,E,F,G){l.set(G.ambient.color,1,1,1);G.ambient.intensity=v.global.ambient;l.set(G.direct.color,1,1,1);G.direct.intensity=v.global.direct;var P=b.clamp((Math.abs(p[2])-v.local.altitude)/(v.global.altitude-v.local.altitude),
0,1);G.globalFactor=P;var K;"sun"===F&&(K=g.SunCalc.getTimes(A,p[1],p[0]));if(1>P){if("sun"===F){{var N=K;var M=A.valueOf();if(N.polarException===g.SunCalc.PolarException.MIDNIGHT_SUN){var L=M-36E5*(A.getHours()+48)-6E4*A.getMinutes();var J=L+432E6}else N.polarException===g.SunCalc.PolarException.POLAR_NIGHT?(L=M-2,J=M-1):(L=N.sunrise.valueOf(),J=N.sunset.valueOf());var H=J-L;N=L+H/2;var I=H/4;var O=N-I;I=N+I;var Q=.06*H;H=L-Q/2;L+=Q/2;const T=J-Q/2,U=J+Q/2;J=v.local;Q=[.01,J.ambientAtNight];const aa=
[.8,.8,1],W=[.01,.01,.01],R=[J.directAtTwilight,J.ambientAtTwilight],V=[1,.6,.5],da=[.8,.8,1],ca=[.9*J.directAtNoon,J.ambientAtNoon],ha=[1,.98,.98],ia=[.98,.98,1],ka=[J.directAtNoon,J.ambientAtNoon],la=[1,1,1],Y=[1,1,1];J=[0,0];let ea=[0,0,0];var S=[0,0,0];M<H||M>U?(J=Q,ea=W,S=aa):M<L?(S=L-H,J=h(M-H,S,Q,R),ea=h(M-H,S,W,V),S=h(M-H,S,aa,da)):M<O?(S=O-L,J=h(M-L,S,R,ca),ea=h(M-L,S,V,ha),S=h(M-L,S,da,ia)):M<N?(S=N-O,J=h(M-O,S,ca,ka),ea=h(M-O,S,ha,la),S=h(M-O,S,ia,Y)):M<I?(S=I-N,J=h(M-N,S,ka,ca),ea=h(M-
N,S,la,ha),S=h(M-N,S,Y,ia)):M<T?(S=T-I,J=h(M-I,S,ca,R),ea=h(M-I,S,ha,V),S=h(M-I,S,ia,da)):M<U&&(S=U-T,J=h(M-T,S,R,Q),ea=h(M-T,S,V,W),S=h(M-T,S,da,aa));M=0;switch(D){case "rainy":case "foggy":M=.9;case "snowy":M=.5}0<M&&(ea=e(ea,M),S=e(S,M));N=r.fromValues(ea[0],ea[1],ea[2]);O=r.fromValues(S[0],S[1],S[2]);I=d(D);M=J[0]*I.direct;J=J[1]*I.ambient}}else O=d(D),M=v.local.directAtNoon*O.direct,N=r.fromValues(1,1,1),J=v.local.ambientAtNoon*O.ambient,O=r.fromValues(1,1,1);l.lerp(G.ambient.color,O,G.ambient.color,
P);G.ambient.intensity=b.lerp(J,G.ambient.intensity,P);l.lerp(G.direct.color,N,G.direct.color,P);G.direct.intensity=b.lerp(M,G.direct.intensity,P);G.specularStrength="rainy"===D||"snowy"===D||"foggy"===D?0:1;G.environmentStrength="rainy"===D?.7:"snowy"===D||"foggy"===D?.75:1}"sun"===F?(D=A.valueOf(),K.polarException===g.SunCalc.PolarException.MIDNIGHT_SUN?(P=D-36E5*(A.getHours()+48)-6E4*A.getMinutes(),K=P+432E6):K.polarException===g.SunCalc.PolarException.POLAR_NIGHT?(P=D-2,K=D-1):(P=K.sunrise.valueOf(),
K=K.sunset.valueOf()),D=1-b.clamp(Math.abs(D-(P+(K-P)/2))/432E5,0,1)):D=1;G.noonFactor=D;"sun"===F?f(A,p,y,G.direct.directionToLightSource):(A=G.direct.directionToLightSource,y===n.ViewingMode.Global?l.normalize(u,E.eye):l.set(u,0,0,1),l.scale(C,E.viewForward,-1),y=k.angle(C,u),p=Math.max(y-.5,0),c.fromRotation(q,-Math.max(.25,y-.25-.85*p/(p+1)),E.viewRight),l.transformMat4(A,C,q),l.add(A,A,l.scale(z,E.viewRight,.2)),l.normalize(A,A))};a.computeDirectionsOverTime=function(A,p,y,D,E){A=A.getTime();
p=p.getTime()-A;p=Math.floor(p/y)+1;const F=Array(p);for(let G=0;G<p;++G)B.setTime(A+y*G),F[G]=r.create(),f(B,D,E,F[G]);return F};a.computeShadowsEnabled=function(A,p){return p===n.ViewingMode.Global?!0:Math.abs(A)<v.planarDirection.localAltitude};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/SunCalc":function(){define(["exports"],function(a){var b={exports:{}};(function(c){(function(m){m=m();void 0!==m&&(c.exports=m)})(function(){function m(y){return new Date(864E5*
(y+.5-2440588))}function l(y,D){return B(v(y)*w(z)-t(D)*v(z),w(y))}function r(y,D){return x(v(D)*w(z)+w(D)*v(z)*v(y))}function n(y,D,E){return B(v(y),w(y)*v(D)-t(E)*w(D))}function g(y,D,E){return x(v(D)*v(E)+w(D)*w(E)*w(y))}function k(y){return u*(1.9148*v(y)+.02*v(2*y)+3E-4*v(3*y))}function f(y,D){y=u*(357.5291+.98560028*y);var E=k(y);y=y+E+102.9372*u+h;D||(D={dec:0,ra:0});D.dec=r(y,0);D.ra=l(y,0);return D}function d(y,D,E){return 2451545+y+.0053*v(D)-.0069*v(2*E)}function e(y){var D=u*(134.963+
13.064993*y),E=u*(93.272+13.22935*y);y=u*(218.316+13.176396*y)+6.289*u*v(D);E=5.128*u*v(E);D=385001-20905*w(D);return{ra:l(y,E),dec:r(y,E),dist:D}}var h=Math.PI,v=Math.sin,w=Math.cos,t=Math.tan,x=Math.asin,B=Math.atan2,q=Math.acos,u=h/180,C={dec:0,ra:0},z=23.4397*u,A={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(y,D,E,F){E=u*-E;D*=u;var G=y.valueOf()/864E5-.5+2440588-2451545;y=f(G,C);E=u*(280.16+360.9856235*G)-E-y.ra;F||(F={azimuth:0,altitude:0});F.azimuth=n(E,D,y.dec);
F.altitude=g(E,D,y.dec);return F}},p=[[-.83,"sunrise","sunset"]];A.addTime=function(y,D,E){p.push([y,D,E])};A.getTimes=function(y,D,E){function F(Q){var S=P,T=L;Q=q((v(Q)-v(S)*v(T))/(w(S)*w(T)));return d(9E-4+(Q+G)/(2*h)+K,N,M)}var G=u*-E,P=u*D,K=Math.round(y.valueOf()/864E5-.5+2440588-2451545-9E-4-G/(2*h));y=9E-4+(0+G)/(2*h)+K;var N=u*(357.5291+.98560028*y);D=k(N);var M=N+D+102.9372*u+h,L=r(M,0);y=d(y,N,M);D={solarNoon:m(y),nadir:m(y-.5),polarException:A.PolarException.NORMAL};var J;E=0;for(J=p.length;E<
J;E+=1){var H=p[E];var I=F(H[0]*u);var O=y-(I-y);D[H[1]]=m(O);D[H[2]]=m(I)}D.polarException=function(Q){Q=(v(Q)-v(P)*v(L))/(w(P)*w(L));return-1>Q?A.PolarException.MIDNIGHT_SUN:1<Q?A.PolarException.POLAR_NIGHT:A.PolarException.NORMAL}(p[0][0]*u);return D};A.getMoonPosition=function(y,D,E){E=u*-E;D*=u;var F=y.valueOf()/864E5-.5+2440588-2451545;y=e(F);E=u*(280.16+360.9856235*F)-E-y.ra;F=g(E,D,y.dec);F+=.017*u/t(F+10.26*u/(F+5.1*u));return{azimuth:n(E,D,y.dec),altitude:F,distance:y.dist}};A.getMoonFraction=
function(y){var D=y.valueOf()/864E5-.5+2440588-2451545;y=f(D);D=e(D);y=q(v(y.dec)*v(D.dec)+w(y.dec)*w(D.dec)*w(y.ra-D.ra));y=B(149598E3*v(y),D.dist-149598E3*w(y));return(1+w(y))/2};return A})})(b);a.SunCalc=b.exports})},"esri/views/3d/input/SceneInputManager":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyboardNavigation ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/handlers/PreventContextMenu ../../input/recognizers/Drag ../../input/recognizers/ImmediateDoubleClick ../../input/recognizers/PointerClickHoldAndDrag ../../input/recognizers/SingleAndDoubleClick ../../input/recognizers/VerticalTwoFingerDrag ../state/controllers/RotateController".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P){c=function(N){function M(){var J=N.apply(this,arguments)||this;J._handles=new m;return J}a._inheritsLoose(M,N);var L=M.prototype;L.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this.disconnect()};L.disconnect=function(){this.view.viewEvents.disconnect();this._inputManager&&(this._inputManager.destroy(),this._inputManager=null);this._source&&(this._source.destroy(),this._source=null)};L.connect=
function(){const J=this.view;this._source=new z.BrowserEventSource(this.view.surface,J.input);var H=[new D.ImmediateDoubleClick,new E.PointerClickHoldAndDrag,new F.SingleAndDoubleClick,new y.Drag(this.view.navigation),new G.VerticalTwoFingerDrag];this._inputManager=H=new A.InputManager({eventSource:this._source,recognizers:H});H.installHandlers("prevent-context-menu",[new p.PreventContextMenu],A.ViewEventPriorities.INTERNAL);this._modeDragPan=new x.PinchAndPanNavigation(J,"primary");this._modeDragRotate=
new e.DragRotate(J,"secondary",P.PivotPoint.CENTER);this._modeDragZoom=new h.DragZoom(J,"tertiary");H.installHandlers("navigation",[new B.PointerDownCancelAnimation(J),new d.DoubleClickZoom(J),new v.GamepadNavigation(J),new w.KeyboardNavigation(J,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"}),new t.MouseWheelZoom(J),new u.SingleKeyResetTilt(J,"p"),new q.SingleKeyResetHeading(J,
"n"),new e.DragRotate(J,"primary",P.PivotPoint.EYE,["b"]),new e.DragRotate(J,"secondary",P.PivotPoint.CENTER,["b"]),new x.PinchAndPanNavigation(J,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new C.TwoFingerTilt(J)],A.ViewEventPriorities.INTERNAL);this.view.viewEvents.connect(H);this._updateMode();this._handles.add(l.watch(()=>{var I;return null==(I=this.view.navigation)?void 0:I.browserTouchPanEnabled},I=>{this._source.browserTouchPanningEnabled=!I},l.initial))};L._updateMode=
function(){var J=this.primaryDragAction;J=K.get(this.mode).get(J);this._modeDragPan&&(this._modeDragPan.pointerAction=J.pan);this._modeDragRotate&&(this._modeDragRotate.pointerAction=J.rotate);this._modeDragZoom&&(this._modeDragZoom.pointerAction=J.zoom)};a._createClass(M,[{key:"primaryDragAction",get:function(){return this._get("primaryDragAction")},set:function(J){"pan"!==J&&"rotate"!==J||J===this._get("primaryDragAction")||(this._set("primaryDragAction",J),this._updateMode())}},{key:"mode",get:function(){return this._get("mode")},
set:function(J){"default"!==J&&"pro"!==J||J===this._get("mode")||(this._set("mode",J),this._updateMode())}},{key:"hasPendingInputs",get:function(){var J;return null==(J=this._inputManager)?void 0:J.hasPendingInputs}},{key:"latestPointerType",get:function(){var J;return null==(J=this._inputManager)?void 0:J.latestPointerType}},{key:"latestPointerLocation",get:function(){var J;return null==(J=this._inputManager)?void 0:J.latestPointerLocation}},{key:"test",get:function(){return{inputManager:this._inputManager,
modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}}]);return M}(c);b.__decorate([r.property()],c.prototype,"view",void 0);b.__decorate([r.property({value:"pan"})],c.prototype,"primaryDragAction",null);b.__decorate([r.property({value:"default"})],c.prototype,"mode",null);b.__decorate([r.property({readOnly:!0})],c.prototype,"hasPendingInputs",null);b.__decorate([r.property()],c.prototype,"latestPointerType",null);b.__decorate([r.property()],c.prototype,
"latestPointerLocation",null);b.__decorate([r.property()],c.prototype,"_inputManager",void 0);c=b.__decorate([f.subclass("esri.views.3d.input.SceneInputManager")],c);const K=new Map;b=new Map;r=new Map;b.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});b.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});r.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});r.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});K.set("default",b);K.set("pro",r);return c})},
"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(a,b,c,m,l,r,n){r=function(g){function k(f,d){var e=g.call(this,!0)||this;e.view=f;e.registerIncoming("double-click",d,h=>e._handleDoubleClick(h));return e}b._inheritsLoose(k,
g);k.prototype._handleDoubleClick=function(f){const d=f.data;if(n.eventMatchesPointerAction(d,"primary")){const e=this.view.state.isGlobal?new m.ZoomStepController({view:this.view,mode:"animation"}):new l.ZoomStepController({view:this.view,mode:"animation"});this.view.state.switchCameraController(e);e.zoomStep(Math.log(.5)/Math.log(.6),c.createScreenPointArray(d.x,d.y));f.stopPropagation()}};return k}(r.InputHandler);a.DoubleClickZoom=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/time ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/set ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/projectionEllipsoid ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../PointToPointAnimationController ../../utils/navigationUtils ../../../support/geometryUtils/ray ../../../support/geometryUtils/sphere ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../webgl-engine/lib/verticalOffsetUtils ../../../../animation/easing ../../../camera/constraintUtils/surfaceCollision".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y){a.ZoomStepController=function(G){function P(){var N=G.apply(this,arguments)||this;N.zoomLocation=e.create();N.tmpCamera=new C.Camera;N.tmpViewDir=e.create();N.tmpRayDir={origin:e.create(),direction:e.create()};N.targetOnSphere=e.create();N.tmpCenter=e.create();N.constraintOptions={selection:t.ConstraintTypes.ALL_EXCEPT_COLLISION,interactionType:t.InteractionType.ZOOM,interactionFactor:null,interactionStartCamera:new C.Camera,interactionDirection:null,
tiltMode:t.TiltMode.TUMBLE};N.sphere=v.create();return N}b._inheritsLoose(P,G);var K=P.prototype;K.initialize=function(){this.intersector=z.newIntersector(this.view.state.viewingMode)};K.zoomStep=function(N,M){if(this.active){var L=this.view.state,{interactionStartCamera:J}=this.constraintOptions;this.animation.finished?J.copyFrom(L.camera):this.animation.cameraAt(1,J);var H=J=!1;this.intersectionHelper.intersectScreen(M,this.zoomLocation,0===this.view.map.ground.opacity?F:{})&&(J=0<N?!0:!1,H=!0);
this.tmpCamera.copyFrom(L.camera);J?this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:d.copy(this.zoomLocation,this.tmpCamera.center);this._updateCamera(this.tmpCamera,N,this.zoomLocation,M,H);this.begin(this.tmpCamera)}};K.animationSettings=function(){return{apex:null,duration:m.Milliseconds(600),
easing:p.outExpo}};K._updateCamera=function(N,M,L,J,H){var I=h.getReferenceEllipsoid(this.view.spatialReference);I=B.decideNavigationMode(N,J,H,I);var O;this.view.camera.position.hasZ&&(O=Math.abs(this.view.camera.position.z));d.normalize(E,N.eye);d.scale(E,E,-1);q.fromScreenAtEye(N,J,this.tmpRayDir);d.normalize(this.tmpRayDir.direction,this.tmpRayDir.direction);const Q=Math.max(Math.min(12,1/Math.abs(d.dot(E,this.tmpRayDir.direction)))*O,200);if(I===B.NavigationMode.Horizontal){M=.6**M;this.sphere[3]=
d.length(L);d.subtract(this.tmpViewDir,N.center,N.eye);H=Math.min(d.length(this.tmpViewDir),Q);I=H*M;1>=M&&4>I&&(I=4,M=I/H);if(1E-6>Math.abs(H-I))return;H=d.length(N.center);this.sphere[3]!==H&&(N.center=d.scale(D,N.center,(this.sphere[3]+M*(H-this.sphere[3]))/H));d.scale(this.tmpViewDir,this.tmpViewDir,-M);N.eye=d.add(D,N.center,this.tmpViewDir);w.applyAll(this.view,N,this.constraintOptions);1E-12<d.squaredDistance(L,N.center)&&u.intersectScreen(this.sphere,N,J,this.targetOnSphere)&&B.panToPosition(this.sphere,
N,L,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{I=.6**Math.abs(M);O=0<M?1:-1;d.subtract(this.tmpViewDir,L,N.eye);const S=d.length(this.tmpViewDir);J=(J=this.view._stage.renderView.getMinimalDepthForArea(null,J[0],J[1],this.view.state.camera,60))?Math.min(Q,J):Q;J=H?Math.min(J,S):J;d.scale(this.tmpRayDir.direction,this.tmpRayDir.direction,J);d.add(L,this.tmpRayDir.origin,this.tmpRayDir.direction);L=J*I;H=Math.max(4,1.01*N.nearFar[0]);0<M&&L<H&&(L=H,I=L/J);if(1E-6>Math.abs(J-
L))return;d.scale(this.tmpRayDir.direction,this.tmpRayDir.direction,O*(1-I));N.eye=d.add(D,N.eye,this.tmpRayDir.direction);N.center=d.add(D,N.center,this.tmpRayDir.direction)}y.applySurfaceCollisionConstraint(this.view,N)};return P}(x.PointToPointAnimationController);a.ZoomStepController=c.__decorate([f.subclass("esri.views.3d.state.controllers.global.ZoomStepController")],a.ZoomStepController);const D=e.create(),E=e.create(),F={exclude:new Set([A.TERRAIN_ID])};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/camera/constraintUtils":function(){define("exports ../../../chunks/vec2 ./constraintUtils/altitude ./constraintUtils/common ./constraintUtils/distance ./constraintUtils/surfaceCollision ./constraintUtils/tilt ../../animation/easing".split(" "),function(a,b,c,m,l,r,n,g){const k=[{type:m.ConstraintTypes.TILT,error:function(d,e,h){return n.getTiltConstraintError(d,e,h)*e.distance},apply:n.applyTiltConstraint},{type:m.ConstraintTypes.ALTITUDE,
error:c.getAltitudeConstraintError,apply:c.applyAltitudeConstraint},{type:m.ConstraintTypes.DISTANCE,error:l.getDistanceConstraintError,apply:l.applyDistanceConstraint}],f={selection:m.ConstraintTypes.ALL,interactionType:m.InteractionType.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:m.TiltMode.TUMBLE};a.applyAltitudeConstraint=c.applyAltitudeConstraint;a.getAltitudeConstraintError=c.getAltitudeConstraintError;Object.defineProperty(a,"ConstraintTypes",{enumerable:!0,
get:()=>m.ConstraintTypes});Object.defineProperty(a,"InteractionType",{enumerable:!0,get:()=>m.InteractionType});a.applyDistanceConstraint=l.applyDistanceConstraint;a.getDistanceConstraintError=l.getDistanceConstraintError;Object.defineProperty(a,"ApplyCollisionMode",{enumerable:!0,get:()=>r.Mode});a.applySurfaceCollisionConstraint=r.applySurfaceCollisionConstraint;a.applyTiltConstraint=n.applyTiltConstraint;a.getTiltConstraintError=n.getTiltConstraintError;a.applyAll=function(d,e,h=f,v=e){let w=
!1;v!==e&&v.copyFrom(e);v.computeUp(d.state.viewingMode);for(e=0;5>e;e++){let x=0;for(var t of k)if(m.hasConstraintType(h.selection,t.type)){const B=Math.abs(t.error(d,v,h));t.apply(d,v,h)&&(w=!0,x+=B)}if(0===x)break}t=m.hasConstraintType(h.selection,m.ConstraintTypes.COLLISION);a:switch(h.interactionType){case m.InteractionType.PAN:h=r.Mode.EYE_AND_CENTER;break a;case m.InteractionType.ASCEND:h=d.state.isGlobal?r.Mode.EYE_AND_CENTER_SCALE:r.Mode.EYE_AND_CENTER;break a;default:h=r.Mode.EYE}t&&r.applySurfaceCollisionConstraint(d,
v,h)&&(w=!0);w&&v.computeUp(d.state.viewingMode);return w};a.pixelDistanceToInteractionFactor=function(d,e){d="number"===typeof d?d:b.distance(d,e);return g.inOutCubic(Math.min(1,d/150))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("exports ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ./common ../../support/intersectionUtils".split(" "),
function(a,b,c,m,l,r,n,g){function k(t,x,B=n.defaultApplyOptions){var q=t.state.constraints.altitude;q=t.state.isGlobal&&q?B.interactionType===n.InteractionType.TUMBLE&&n.hasConstraintType(B.selection,n.ConstraintTypes.TILT)?!1:!0:!1;if(!q)return 0;var u=t.state.constraints.altitude;q=d;q.min=u.min;q.max=u.max;u=B.interactionType;if(u!==n.InteractionType.NONE){var {min:C,max:z}=q,{interactionStartCamera:A,interactionFactor:p}=B;B=u===n.InteractionType.TUMBLE||u===n.InteractionType.ZOOM;u=k(t,A);var y=
0===u?0:t.renderCoordsHelper.getAltitude(A.eye);q.min=C;q.max=z;n.adjustRangeForInteraction(u,y,B,p,.05*y,q)}t=t.renderCoordsHelper.getAltitude(x.eye);t=b.clamp(t,q.min,q.max)-t;return 1E-6>=Math.abs(t)?0:t}function f(t,x,B,q){t.renderCoordsHelper.worldUpAtPosition(x.eye,q);m.scale(q,q,B);return q}const d={min:0,max:0},e=l.create(),h=l.create(),v=l.create(),w=l.create();a.applyAltitudeConstraint=function(t,x,B=n.defaultApplyOptions){const q=k(t,x,B);if(0===q)return!1;const u=t.renderCoordsHelper,
C=u.getAltitude(x.eye)+q;B=n.interactionDirectionTowardsConstraintMinimization(x,B.interactionDirection,f(t,x,Math.sign(q),h),e);t=m.copy(v,x.viewForward);B=u.intersectInfiniteManifold(r.wrap(x.eye,B),C,w);x.eye=c.isSome(B)?B:u.setAltitude(w,C,x.eye);x.center=g.closestPointOnRay(w,x.eye,t,x.center);return!0};a.getAltitudeConstraintError=k;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/camera/constraintUtils/common":function(){define(["exports",
"../../../../chunks/vec3"],function(a,b){a.InteractionType=void 0;(function(m){m[m.NONE=0]="NONE";m[m.ZOOM=1]="ZOOM";m[m.TUMBLE=2]="TUMBLE";m[m.LOOK_AROUND=3]="LOOK_AROUND";m[m.PAN=4]="PAN";m[m.ASCEND=5]="ASCEND"})(a.InteractionType||(a.InteractionType={}));a.ConstraintTypes=void 0;(function(m){m[m.NONE=0]="NONE";m[m.TILT=1]="TILT";m[m.ALTITUDE=2]="ALTITUDE";m[m.DISTANCE=4]="DISTANCE";m[m.COLLISION=8]="COLLISION";m[m.ALL=15]="ALL";m[m.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(a.ConstraintTypes||
(a.ConstraintTypes={}));a.TiltMode=void 0;(function(m){m[m.TUMBLE=0]="TUMBLE";m[m.LOOK_AROUND=1]="LOOK_AROUND"})(a.TiltMode||(a.TiltMode={}));const c={selection:a.ConstraintTypes.NONE,interactionType:a.InteractionType.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:a.TiltMode.TUMBLE};a.adjustRangeForInteraction=function(m,l,r,n,g,k){0!==m&&(r?(k.min=Math.min(k.min,l),k.max=Math.max(k.max,l)):null!=n?(k.min-=Math.max(0,(l-k.min)*(1-n)),k.max+=Math.max(0,(l-k.max)*
(1-n))):g&&(k.min-=Math.max(0,l-k.min-g),k.max+=Math.max(0,l-k.max-g)))};a.defaultApplyOptions=c;a.hasConstraintType=function(m,l){return 0!==(m&l)};a.interactionDirectionTowardsConstraintMinimization=function(m,l,r,n){l=l||m.viewForward;b.copy(n,l);b.scale(n,n,Math.sign(b.dot(l,r)));return n};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/intersectionUtils":function(){define(["exports","../../../chunks/vec2f64","../../../chunks/vec3",
"../../../chunks/vec3f64","../../../geometry/support/plane"],function(a,b,c,m,l){function r(k,f,d,e){const h=g;k?(d&&e&&(h.len=c.distance(f,d)),c.copy(h.dir,k)):e?(h.len=c.distance(f,d),c.subtract(h.dir,d,f),c.scale(h.dir,h.dir,1/h.len)):(c.subtract(h.dir,d,f),c.normalize(h.dir,h.dir));return h}function n(k,f,d,e){e.clip[0]=0;e.clip[1]=d?e.len:Number.MAX_VALUE;for(d=0;d<k.length;d++){{var h=k[d],v=f;var w=e;const t=c.dot(l.normal(h),w.dir);h=-l.signedDistance(h,v);0>h&&0<=t?w=!1:-1E-6<t&&1E-6>t?w=
0<h:!(0>h||0>t)||0>h&&0>t?(h/=t,0<t?h<w.clip[1]&&(w.clip[1]=h):h>w.clip[0]&&(w.clip[0]=h),w=w.clip[0]<=w.clip[1]):w=!0}if(!w)return!1}return!0}const g={dir:m.create(),len:0,clip:b.create()};a.closestPointOnRay=function(k,f,d,e){e=c.dot(d,c.subtract(k,e,f));return c.add(k,f,c.scale(k,d,e))};a.frustumLineSegment=function(k,f,d,e){e=r(e,f,d,!0);return n(k,f,d,e)};a.frustumPoint=function(k,f){for(let d=0;6>d;d++)if(0<l.signedDistance(k[d],f))return!1;return!0};a.frustumRay=function(k,f,d,e){d=r(e,f,d,
!1);return n(k,f,null,d)};a.frustumSphere=function(k,f,d){const e=f[0],h=f[1];f=f[2];return k[0][0]*e+k[0][1]*h+k[0][2]*f+k[0][3]>d||k[1][0]*e+k[1][1]*h+k[1][2]*f+k[1][3]>d||k[2][0]*e+k[2][1]*h+k[2][2]*f+k[2][3]>d||k[3][0]*e+k[3][1]*h+k[3][2]*f+k[3][3]>d||k[4][0]*e+k[4][1]*h+k[4][2]*f+k[4][3]>d||k[5][0]*e+k[5][1]*h+k[5][2]*f+k[5][3]>d?!1:!0};a.planeSphere=function(k,f,d){return k[0]*f[0]+k[1]*f[1]+k[2]*f[2]+k[3]<d};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/camera/constraintUtils/distance":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ../../../../chunks/sphere ./common".split(" "),function(a,b,c,m,l,r,n){function g(w,t,x=n.defaultApplyOptions){if(!w.state.isLocal)return 0;var B=w.state.constraints.distance;if(!w.pointsOfInterest.surfaceOrigin.renderLocation||Infinity===B)return 0;k.min=0;k.max=B;B=k;var q=x.interactionType;if(q!==n.InteractionType.NONE){var {min:u,
max:C}=B,{interactionStartCamera:z,interactionFactor:A}=x;x=q===n.InteractionType.ZOOM||q===n.InteractionType.PAN;q=g(w,z);var p=0===q?0:c.distance(z.eye,w.pointsOfInterest.surfaceOrigin.renderLocation);B.min=u;B.max=C;n.adjustRangeForInteraction(q,p,x,A,.05*p,B)}w=c.distance(t.eye,w.pointsOfInterest.surfaceOrigin.renderLocation);w=k.max-w;return-1E-6<=w?0:w}const k={min:0,max:0},f=m.create(),d=m.create(),e=m.create(),h=m.create(),v=m.create();a.applyDistanceConstraint=function(w,t,x=n.defaultApplyOptions){var B=
g(w,t,x);if(0===B)return!1;var q=w.pointsOfInterest.surfaceOrigin;B=c.distance(t.eye,w.pointsOfInterest.surfaceOrigin.renderLocation)+B;const u=c.copy(f,t.eye);x=n.interactionDirectionTowardsConstraintMinimization(t,x.interactionDirection,c.direction(h,t.eye,w.pointsOfInterest.surfaceOrigin.renderLocation),e);if(!r.intersectRay(r.fromCenterAndRadius(q.renderLocation,B),l.wrap(t.eye,x),v))return!1;t.eye=v;q=c.subtract(d,t.eye,u);t.center=c.add(v,t.center,q);q=w.renderCoordsHelper.getAltitude(t.center);
w=w.renderCoordsHelper.intersectInfiniteManifold(t.ray,q,v);b.isSome(w)&&(t.center=w);return!0};a.getDistanceConstraintError=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["exports","../../../../chunks/vec3","../../../../chunks/vec3f64","../intersectionUtils"],function(a,b,c,m){a.Mode=void 0;(function(n){n[n.EYE=0]="EYE";n[n.EYE_AND_CENTER=1]="EYE_AND_CENTER";n[n.EYE_AND_CENTER_SCALE=
2]="EYE_AND_CENTER_SCALE"})(a.Mode||(a.Mode={}));const l=c.create(),r=c.create();a.applySurfaceCollisionConstraint=function(n,g,k=a.Mode.EYE){var f=n.state.constraints;if(!f.collision.enabled)return!1;var d=m.surfaceElevationBelowRenderLocation(n,g.eye);const e=n.renderCoordsHelper.getAltitude(g.eye);f=d+f.collision.elevationMargin;if(e>=f)return!1;d=b.length(g.eye);b.subtract(l,g.center,g.eye);g.eye=n.renderCoordsHelper.setAltitude(r,f,g.eye);k===a.Mode.EYE_AND_CENTER?g.center=b.add(l,g.eye,l):k===
a.Mode.EYE_AND_CENTER_SCALE&&(g.center=b.scale(l,g.center,(d-e+f)/d));return!0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/camera/intersectionUtils":function(){define("exports ../../../core/maybe ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../webgl-engine/lib/Intersector".split(" "),function(a,b,c,m,l,r,n){function g(w,t){return w.elevationProvider?b.unwrapOr(w.elevationProvider.getElevation(t[0],
t[1],t[2],w.renderCoordsHelper.spatialReference,"ground"),0):0}function k(w,t,x){if(!w.state.isGlobal)return!1;const B=g(w,t);({far:w}=w.stateManager.constraintsManager.nearFarHeuristic.compute(t,x,w.renderDataExtent,B,v));w*=w;return c.squaredDistance(t,x)>w}const f={},d=m.create(),e=m.create(),h=m.create(),v={near:0,far:0};a.cameraOnContentAlongViewDirection=function(w,t,x,B){const q=w.state.camera.clone();t&&(q.eye=t,q.center=x,q.up=B);t=q.ray;x=f[w.viewingMode];x||(x=n.newIntersector(w.state.viewingMode),
x.options.backfacesTerrain=!w.state.isGlobal,x.options.invisibleTerrain=!0,f[w.viewingMode]=x);({isGlobal:B}=w.state);w.sceneIntersectionHelper.intersectRay(t,x,e)&&!k(w,t.origin,e)?t=!0:!w.renderCoordsHelper.intersectManifold(t,0,e)||k(w,t.origin,e)?B?(x=l.getReferenceEllipsoid(w.spatialReference).radius,x=c.dot(t.origin,t.origin)-x*x,c.scale(e,t.direction,(0<x?Math.sqrt(x)/3:1)/c.length(t.direction)),c.add(e,e,t.origin),t=!0):t=!1:t=!0;t||c.copy(e,q.center);x=w.state.constraints;B=x.minimumPoiDistance;
c.squaredDistance(q.eye,e)<B&&(t=x.collision.enabled,c.copy(h,q.viewForward),c.scale(h,h,B),t?q.eye=c.subtract(d,e,h):c.add(e,q.eye,h),w=w.renderCoordsHelper,B=w.getAltitude(q.eye),x=x.collision.elevationMargin,t&&B<x&&(c.subtract(h,e,q.eye),q.eye=w.setAltitude(d,x,q.eye),c.add(e,q.eye,h)));q.center=e;return q};a.eyeWithinExtent=function(w,t,x,B){return b.isSome(w.renderCoordsHelper.fromRenderCoords(t.eye,d,B))&&r.containsPoint(x,d)};a.surfaceElevationBelowRenderLocation=g;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Intersector":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/ray ../../../ViewingMode ./IntersectorInterfaces ./intersectorUtils ./verticalOffsetUtils ../materials/renderers/utils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w){let t=function(){function z(p){this.options=new e.IntersectorOptions;this._results=new x;this.transform=new v.IntersectorTransform;this.tolerance=1E-5;this.verticalOffset=null;this._ray=f.create();this._rayEnd=n.create();this._rayBeginTransformed=n.create();this._rayEndTransformed=n.create();this.viewingMode=null==p?d.ViewingMode.Global:p}var A=z.prototype;A.reset=function(p,y,D){this.resetWithRay(f.fromPoints(p,y,this._ray),D)};A.resetWithRay=function(p,y){this.camera=
y;p!==this._ray&&f.copy(p,this._ray);0!==this.options.verticalOffset?this.viewingMode===d.ViewingMode.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null;r.add(this._rayEnd,this._ray.origin,this._ray.direction);this._results.init(this._ray)};A.intersect=function(p=null,y,D,E,F){this.point=y;this.filterPredicate=E;this.tolerance=null==D?1E-5:D;y=v.getVerticalOffsetObject3D(this.verticalOffset);if(c.isSome(p)&&0<p.length){const G=
F?P=>{F(P)&&this.intersectObject(P)}:P=>{this.intersectObject(P)};for(const P of p)p=P.getSpatialQueryAccelerator&&P.getSpatialQueryAccelerator(),c.isSome(p)?(c.isSome(y)?p.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,G,y):p.forEachAlongRay(this._ray.origin,this._ray.direction,G),this.options.selectionMode&&this.options.hud&&p.forEachDegenerateObject(G)):P.objects.forAll(K=>G(K))}this.sortResults()};A.intersectObject=function(p){const y=p.geometryRecords;if(y){var D=p.transformation,
E=v.getVerticalOffsetObject3D(this.verticalOffset);for(const F of y){const {geometry:G,material:P,instanceParameters:K}=F;if(w.isInstanceHidden(K))continue;const N=G.id;this.transform.setAndInvalidateLazyTransforms(D,F.getShaderTransformation());r.transformMat4(this._rayBeginTransformed,this.rayBegin,this.transform.inverse);r.transformMat4(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const M=this.transform.transform;c.isSome(E)&&(E.objectTransform=this.transform);P.intersect(G,K,this.transform.transform,
this,this._rayBeginTransformed,this._rayEndTransformed,(L,J,H,I,O,Q)=>{if(0<=L&&(!c.isSome(this.filterPredicate)||this.filterPredicate(this._ray.origin,this._rayEnd,L))){var S=I?this._results.hud:this._results,T=I?U=>{const aa={object:p,geometryId:N,triangleNr:H,center:c.isSome(Q)?[Q[0],Q[1],Q[2]]:null};U.set(e.IntersectorType.HUD,aa,L,J,l.IDENTITY,O)}:U=>U.set(e.IntersectorType.OBJECT,{object:p,geometryId:N,triangleNr:H},L,J,M,O);(null==S.min.drapedLayerOrder||O>=S.min.drapedLayerOrder)&&(null==
S.min.dist||L<S.min.dist)&&T(S.min);this.options.store!==e.StoreResults.MIN&&(null==S.max.drapedLayerOrder||O<S.max.drapedLayerOrder)&&(null==S.max.dist||L>S.max.dist)&&T(S.max);this.options.store===e.StoreResults.ALL&&(I?(I=new q(this._ray),T(I),this._results.hud.all.push(I)):(I=new B(this._ray),T(I),this._results.all.push(I)))}},F.shaderTransformation)}}};A.sortResults=function(p=this._results.all){p.sort((y,D)=>y.dist!==D.dist?c.unwrapOr(y.dist,0)-c.unwrapOr(D.dist,0):y.drapedLayerOrder!==D.drapedLayerOrder?
c.unwrapOr(y.drapedLayerOrder,Number.MAX_VALUE)-c.unwrapOr(D.drapedLayerOrder,Number.MAX_VALUE):c.unwrapOr(D.drapedLayerGraphicOrder,Number.MIN_VALUE)-c.unwrapOr(y.drapedLayerGraphicOrder,Number.MIN_VALUE))};b._createClass(z,[{key:"results",get:function(){return this._results}},{key:"ray",get:function(){return this._ray}},{key:"rayBegin",get:function(){return this._ray.origin}},{key:"rayEnd",get:function(){return this._rayEnd}}]);return z}(),x=function(){function z(){this.min=new B(f.create());this.max=
new B(f.create());this.hud={min:new q(f.create()),max:new q(f.create()),all:[]};this.ground=new B(f.create());this.all=[]}z.prototype.init=function(A){this.min.init(A);this.max.init(A);this.ground.init(A);this.all.length=0;this.hud.min.init(A);this.hud.max.init(A);this.hud.all.length=0};return z}(),B=function(){function z(p){this.intersector=e.IntersectorType.OBJECT;this.normal=n.create();this.transformation=l.create();this._ray=f.create();this.init(p)}var A=z.prototype;A.getIntersectionPoint=function(p){if(!h.isValidIntersectorResult(this))return!1;
r.scale(u,this.ray.direction,this.dist);r.add(p,this.ray.origin,u);return!0};A.getTransformedNormal=function(p){r.copy(C,this.normal);C[3]=0;g.transformMat4(C,C,this.transformation);r.copy(p,C);return r.normalize(p,p)};A.init=function(p){this.drapedLayerGraphicOrder=this.drapedLayerOrder=this.target=this.dist=null;this.intersector=e.IntersectorType.OBJECT;f.copy(p,this._ray)};A.set=function(p,y,D,E,F,G,P){this.intersector=p;this.dist=D;r.copy(this.normal,c.unwrapOr(E,n.UNIT_Z));m.copy(this.transformation,
c.unwrapOr(F,l.IDENTITY));this.target=y;this.drapedLayerOrder=G;this.drapedLayerGraphicOrder=P};A.copy=function(p){f.copy(p.ray,this._ray);this.intersector=p.intersector;this.dist=p.dist;this.target=p.target;this.drapedLayerOrder=p.drapedLayerOrder;this.drapedLayerGraphicOrder=p.drapedLayerGraphicOrder;r.copy(this.normal,p.normal);m.copy(this.transformation,p.transformation)};b._createClass(z,[{key:"ray",get:function(){return this._ray}},{key:"distanceInRenderSpace",get:function(){return c.isSome(this.dist)?
(r.scale(u,this.ray.direction,this.dist),r.length(u)):null}}]);return z}(),q=function(z){function A(){var p=z.apply(this,arguments)||this;p.intersector=e.IntersectorType.HUD;return p}b._inheritsLoose(A,z);return A}(B);const u=n.create(),C=k.create();a.DEFAULT_TOLERANCE=1E-5;a.newIntersector=function(z){return new t(z)};a.newIntersectorResult=function(z){return new B(z)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/IntersectorInterfaces":function(){define(["exports"],
function(a){a.IntersectorType=void 0;(function(b){b[b.OBJECT=0]="OBJECT";b[b.HUD=1]="HUD";b[b.TERRAIN=2]="TERRAIN";b[b.OVERLAY=3]="OVERLAY";b[b.I3S=4]="I3S";b[b.PCL=5]="PCL";b[b.LOD=6]="LOD";b[b.VOXEL=7]="VOXEL"})(a.IntersectorType||(a.IntersectorType={}));a.StoreResults=void 0;(function(b){b[b.MIN=0]="MIN";b[b.MINMAX=1]="MINMAX";b[b.ALL=2]="ALL"})(a.StoreResults||(a.StoreResults={}));a.IntersectorOptions=function(){this.verticalOffset=0;this.selectionMode=!1;this.selectOpaqueTerrainOnly=this.hud=
!0;this.invisibleTerrain=!1;this.backfacesTerrain=!0;this.isFiltered=!1;this.store=a.StoreResults.ALL};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/intersectorUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/boundedPlane ./IntersectorInterfaces".split(" "),function(a,b,c,m,l,r){function n(k){return b.isSome(k)&&b.isSome(k.dist)}const g=m.create();
a.isHudIntersectorResult=function(k){return n(k)&&k.intersector===r.IntersectorType.HUD&&!!k.target&&b.isSome(k.target.center)};a.isObjectIntersectorResult=function(k){return n(k)&&k.intersector===r.IntersectorType.OBJECT&&!!k.target};a.isValidIntersectorResult=n;a.sliceFilterPredicate=function(k){return(f,d,e)=>{c.lerp(g,f,d,e);return!l.extrusionContainsPoint(k,g)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/verticalOffsetUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf64 ../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../chunks/sphere".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h){let v=function(){function D(){this._transform=n.create();this._transformInverse=new w({value:this._transform},r.invert,n.create);this._transformInverseTranspose=new w(this._transformInverse,r.transpose,n.create);this._transformTranspose=new w({value:this._transform},r.transpose,n.create);this._transformInverseRotation=new w({value:this._transform},m.normalFromMat4Legacy,l.create)}var E=D.prototype;E._invalidateLazyTransforms=function(){this._transformInverse.invalidate();
this._transformInverseTranspose.invalidate();this._transformTranspose.invalidate();this._transformInverseRotation.invalidate()};E.setTransformMatrix=function(F){r.copy(this._transform,F)};E.multiplyTransform=function(F){r.multiply(this._transform,this._transform,F)};E.set=function(F){r.copy(this._transform,F);this._invalidateLazyTransforms()};E.setAndInvalidateLazyTransforms=function(F,G){this.setTransformMatrix(F);this.multiplyTransform(G);this._invalidateLazyTransforms()};b._createClass(D,[{key:"transform",
get:function(){return this._transform}},{key:"inverse",get:function(){return this._transformInverse.value}},{key:"inverseTranspose",get:function(){return this._transformInverseTranspose.value}},{key:"inverseRotation",get:function(){return this._transformInverseRotation.value}},{key:"transpose",get:function(){return this._transformTranspose.value}}]);return D}(),w=function(){function D(E,F,G){this.original=E;this.update=F;this.dirty=!0;this.transform=G()}D.prototype.invalidate=function(){this.dirty=
!0};b._createClass(D,[{key:"value",get:function(){this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1);return this.transform}}]);return D}(),t=function(){function D(F=0){this.offset=F;this.tmpVertex=e.create()}var E=D.prototype;E.applyToVertex=function(F,G,P){const K=F+this.localOrigin[0],N=G+this.localOrigin[1],M=P+this.localOrigin[2],L=this.offset/Math.sqrt(K*K+N*N+M*M);this.tmpVertex[0]=F+K*L;this.tmpVertex[1]=G+N*L;this.tmpVertex[2]=P+M*L;return this.tmpVertex};E.applyToAabb=
function(F){for(var G=0;3>G;++G)x[G]=F[0+G]+this.localOrigin[G],B[G]=F[3+G]+this.localOrigin[G],q[G]=x[G];G=this.applyToVertex(x[0],x[1],x[2]);for(var P=0;3>P;++P)F[P]=G[P],F[P+3]=G[P];G=N=>{N=this.applyToVertex(N[0],N[1],N[2]);for(let M=0;3>M;++M)F[M+0]=Math.min(F[M+0],N[M]),F[M+3]=Math.max(F[M+3],N[M])};for(P=1;8>P;++P){for(var K=0;3>K;++K)q[K]=0===(P&1<<K)?x[K]:B[K];G(q)}P=0;for(K=0;3>K;++K)0>x[K]*B[K]&&(P|=1<<K);if(0!==P&&7!==P)for(K=0;8>K;++K)if(0===(P&K)){for(let N=0;3>N;++N)q[N]=P[N]?0:0!==
(K&1<<N)?x[N]:B[N];G(q)}for(G=0;3>G;++G)F[G+0]-=this.localOrigin[G],F[G+3]-=this.localOrigin[G];return F};return D}();const x=e.create(),B=e.create(),q=e.create();let u=function(){function D(F=0){this.componentLocalOriginLength=0;this._tmpVertex=e.create();this._mbs=h.create();this._obb={center:e.create(),halfSize:d.create(),quaternion:null};this._offset=this._totalOffset=0;this._resetOffset(F)}var E=D.prototype;E._resetOffset=function(F){this._totalOffset=this._offset=F};E.applyToVertex=function(F,
G,P){const K=P+this.componentLocalOriginLength,N=this._totalOffset/Math.sqrt(F*F+G*G+K*K);this._tmpVertex[0]=F+F*N;this._tmpVertex[1]=G+G*N;this._tmpVertex[2]=P+K*N;return this._tmpVertex};E.applyToAabb=function(F){const G=F[0],P=F[1],K=F[2]+this.componentLocalOriginLength,N=F[3],M=F[4],L=F[5]+this.componentLocalOriginLength;var J=0>G*N?0:Math.min(Math.abs(G),Math.abs(N)),H=0>P*M?0:Math.min(Math.abs(P),Math.abs(M)),I=0>K*L?0:Math.min(Math.abs(K),Math.abs(L));J=Math.sqrt(J*J+H*H+I*I);if(J<this._totalOffset)return F[0]-=
0>G?this._totalOffset:0,F[1]-=0>P?this._totalOffset:0,F[2]-=0>K?this._totalOffset:0,F[3]+=0<N?this._totalOffset:0,F[4]+=0<M?this._totalOffset:0,F[5]+=0<L?this._totalOffset:0,F;H=Math.max(Math.abs(G),Math.abs(N));I=Math.max(Math.abs(P),Math.abs(M));const O=Math.max(Math.abs(K),Math.abs(L));H=this._totalOffset/Math.sqrt(H*H+I*I+O*O);J=this._totalOffset/J;F[0]+=G*(0<G?H:J);F[1]+=P*(0<P?H:J);F[2]+=K*(0<K?H:J);F[3]+=N*(0>N?H:J);F[4]+=M*(0>M?H:J);F[5]+=L*(0>L?H:J);return F};E.applyToMbs=function(F){const G=
Math.sqrt(F[0]*F[0]+F[1]*F[1]+F[2]*F[2]),P=this._totalOffset/G;this._mbs[0]=F[0]+F[0]*P;this._mbs[1]=F[1]+F[1]*P;this._mbs[2]=F[2]+F[2]*P;this._mbs[3]=F[3]+F[3]*this._totalOffset/G;return this._mbs};E.applyToObb=function(F){var G=F.center;const P=this._totalOffset/Math.sqrt(G[0]*G[0]+G[1]*G[1]+G[2]*G[2]);this._obb.center[0]=G[0]+G[0]*P;this._obb.center[1]=G[1]+G[1]*P;this._obb.center[2]=G[2]+G[2]*P;f.transformQuat(this._obb.halfSize,F.halfSize,F.quaternion);f.add(this._obb.halfSize,this._obb.halfSize,
F.center);G=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);this._obb.halfSize[0]+=this._obb.halfSize[0]*G;this._obb.halfSize[1]+=this._obb.halfSize[1]*G;this._obb.halfSize[2]+=this._obb.halfSize[2]*G;f.subtract(this._obb.halfSize,this._obb.halfSize,F.center);g.conjugate(y,F.quaternion);f.transformQuat(this._obb.halfSize,this._obb.halfSize,y);this._obb.halfSize[0]*=0>this._obb.halfSize[0]?
-1:1;this._obb.halfSize[1]*=0>this._obb.halfSize[1]?-1:1;this._obb.halfSize[2]*=0>this._obb.halfSize[2]?-1:1;this._obb.quaternion=F.quaternion;return this._obb};b._createClass(D,[{key:"offset",get:function(){return this._offset},set:function(F){this._resetOffset(F)}},{key:"componentOffset",set:function(F){this._totalOffset=this._offset+F}},{key:"localOrigin",set:function(F){this.componentLocalOriginLength=Math.sqrt(F[0]*F[0]+F[1]*F[1]+F[2]*F[2])}}]);return D}(),C=function(){function D(F=0){this.offset=
F;this.sphere=h.create();this.tmpVertex=e.create()}var E=D.prototype;E.applyToVertex=function(F,G,P){const K=this.objectTransform.transform;let N=K[0]*F+K[4]*G+K[8]*P+K[12],M=K[1]*F+K[5]*G+K[9]*P+K[13];F=K[2]*F+K[6]*G+K[10]*P+K[14];G=this.offset/Math.sqrt(N*N+M*M+F*F);N+=N*G;M+=M*G;F+=F*G;G=this.objectTransform.inverse;this.tmpVertex[0]=G[0]*N+G[4]*M+G[8]*F+G[12];this.tmpVertex[1]=G[1]*N+G[5]*M+G[9]*F+G[13];this.tmpVertex[2]=G[2]*N+G[6]*M+G[10]*F+G[14];return this.tmpVertex};E.applyToMinMax=function(F,
G){const P=this.offset/Math.sqrt(F[0]*F[0]+F[1]*F[1]+F[2]*F[2]);F[0]+=F[0]*P;F[1]+=F[1]*P;F[2]+=F[2]*P;F=this.offset/Math.sqrt(G[0]*G[0]+G[1]*G[1]+G[2]*G[2]);G[0]+=G[0]*F;G[1]+=G[1]*F;G[2]+=G[2]*F};E.applyToAabb=function(F){var G=this.offset/Math.sqrt(F[0]*F[0]+F[1]*F[1]+F[2]*F[2]);F[0]+=F[0]*G;F[1]+=F[1]*G;F[2]+=F[2]*G;G=this.offset/Math.sqrt(F[3]*F[3]+F[4]*F[4]+F[5]*F[5]);F[3]+=F[3]*G;F[4]+=F[4]*G;F[5]+=F[5]*G;return F};E.applyToBoundingSphere=function(F){const G=Math.sqrt(F[0]*F[0]+F[1]*F[1]+F[2]*
F[2]),P=this.offset/G;this.sphere[0]=F[0]+F[0]*P;this.sphere[1]=F[1]+F[1]*P;this.sphere[2]=F[2]+F[2]*P;this.sphere[3]=F[3]+F[3]*this.offset/G;return this.sphere};return D}();const z=new C,A=new u,p=new t,y=k.create();a.I3SVerticalOffsetGlobalViewingMode=u;a.IntersectorTransform=v;a.Object3DVerticalOffsetGlobalViewingMode=C;a.TERRAIN_ID="terrain";a.TerrainVerticalOffsetGlobalViewingMode=t;a.getVerticalOffsetI3S=function(D){return c.isSome(D)?(A.offset=D,A):null};a.getVerticalOffsetObject3D=function(D){return c.isSome(D)?
(z.offset=D,z):null};a.getVerticalOffsetTerrain=function(D){return c.isSome(D)?(p.offset=D,p):null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/renderers/utils":function(){define("exports ../../../../../core/maybe ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../lib/Util ../../../../webgl/doublePrecisionUtils".split(" "),function(a,b,c,m,l,r){const n=new Float64Array(3),g=new Float32Array(6),k=m.create();
a.addObject3DStateID=function(f,d){b.isNone(f)&&(f=[]);f.push(d);return f};a.calculateTransformRelativeToOrigin=function(f,d,e){const h=f.origin.vec3;l.setMatrixTranslation3(k,-h[0],-h[1],-h[2]);b.isSome(f.transformation)?c.multiply(d,k,f.transformation):c.copy(d,k);e&&(c.invert(e,d),c.transpose(e,e))};a.encodeDoubleVec3=function(f,d,e,h,v){n[0]=f.get(d,0);n[1]=f.get(d,1);n[2]=f.get(d,2);r.encodeDoubleArray(n,g,3);e.set(v,0,g[0]);h.set(v,0,g[1]);e.set(v,1,g[2]);h.set(v,1,g[3]);e.set(v,2,g[4]);h.set(v,
2,g[5])};a.isInstanceHidden=function(f){return b.isSome(f)?!f.visible:!1};a.removeObject3DStateID=function(f,d){if(b.isNone(f))return null;f=f.filter(e=>e!==d);return 0===f.length?null:f};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/doublePrecisionUtils":function(){define(["exports"],function(a){const b=new Float32Array(2);a.decodeDoubleArray=function(c,m,l){for(let r=0;r<l;++r)m[r]=c[2*r]+c[2*r+1]};a.encodeDoubleArray=function(c,m,
l){for(let r=0;r<l;++r)m[2*r]=c[r],m[2*r+1]=c[r]-m[2*r]};a.encodeDoubleHi=function(c,m){const l=c.length;for(let r=0;r<l;++r)b[0]=c[r],m[r]=b[0];return m};a.encodeDoubleLo=function(c,m){const l=c.length;for(let r=0;r<l;++r)b[0]=c[r],b[1]=c[r]-b[0],m[r]=b[1];return m};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../../../chunks/sphere ./common ../../state/utils/viewUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e){function h(p,y,D=d.defaultApplyOptions,E=!0){A.eyeCenterDistance=0;A.requiresTwoSteps=!1;const F=v(p,y,D,void 0,A);if(0===F)return!1;l.fromRotation(B,-F,y.viewRight);switch(D.tiltMode){case d.TiltMode.LOOK_AROUND:n.transformMat4(x,y.viewForward,B);n.scale(x,x,A.eyeCenterDistance);y.center=n.add(q,y.eye,x);break;case d.TiltMode.TUMBLE:n.subtract(x,y.center,y.eye);n.transformMat4(x,x,B);y.eye=n.subtract(q,y.center,x);break;default:b.neverReached(D.tiltMode)}y.up=n.transformMat4(q,
y.up,B);return A.requiresTwoSteps&&E?h(p,y,D,!1):!0}function v(p,y,D=d.defaultApplyOptions,E=d.defaultApplyOptions,F){if(!p.state.constraints.tilt)return 0;var G=p.state.constraints.tilt(y.distance,C);if(D.interactionType!==d.InteractionType.NONE){var {interactionStartCamera:P,interactionFactor:K}=D,{min:N,max:M}=G,L=v(p,P,d.defaultApplyOptions,D),J=0===L?0:e.viewAngle(p.renderCoordsHelper,P.center,P.eye);G.min=N;G.max=M;D.interactionType===d.InteractionType.TUMBLE?(d.hasConstraintType(D.selection,
d.ConstraintTypes.ALTITUDE)&&t(p,P,G),d.adjustRangeForInteraction(L,J,!0,K,u,G)):d.adjustRangeForInteraction(L,J,!1,K,u,G)}E.interactionType===d.InteractionType.TUMBLE&&d.hasConstraintType(E.selection,d.ConstraintTypes.ALTITUDE)&&t(p,E.interactionStartCamera,G);if(D.tiltMode===d.TiltMode.LOOK_AROUND||E.tiltMode===d.TiltMode.LOOK_AROUND){a:switch(F&&(F.requiresTwoSteps=!1),p.viewingMode){case "global":D=z;L=p.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;E=L+k.getReferenceEllipsoid(p.spatialReference).radius;
L=p.renderCoordsHelper.intersectManifold(y.ray,L,q);D.eyeCenterDistance=y.distance;D.centerIsOnSurface=!1;m.isSome(L)?(D.eyeCenterDistance=n.distance(y.eye,L),D.tiltAtCenter=e.viewAngle(p.renderCoordsHelper,L,y.eye),D.centerIsOnSurface=!0):p.state.isLocal?D.tiltAtCenter=e.viewAngle(p.renderCoordsHelper,y.center,y.eye):(f.closestPointOnSilhouette(f.fromRadius(f.tmpSphere,E),y.ray,q),D.eyeCenterDistance=n.distance(y.eye,q),D.tiltAtCenter=c.acosClamped(-n.dot(y.viewForward,n.normalize(q,q))));D.radius=
E;D.eyeRadius=n.length(y.eye);D.constraints=p.state.constraints;y=c.clamp(D.tiltAtCenter,G.min,G.max);if(1E-9<Math.abs(D.tiltAtCenter-y)){if(D.centerIsOnSurface){{const {constraints:H,eyeCenterDistance:I,tiltAtCenter:O}=D;y=O;p=H.clampTilt(I,O);G=w(D,p);if(H.clampTilt(G,O)!==p)for(G=0;10>G&&1E-9<Math.abs(p-y);)E=(y+p)/2,L=w(D,E),L=H.clampTilt(L,E),1E-9<Math.abs(L-E)?y=E:p=E,G++;y=p}G=y;p=c.asinClamped(D.radius/D.eyeRadius*Math.sin(D.tiltAtCenter));G=c.asinClamped(D.radius/D.eyeRadius*Math.sin(G));
p=D.eyeRadius>D.radius?p-G:G-p}else y=D.constraints.clampTilt(D.eyeCenterDistance,D.tiltAtCenter),F&&y<Math.PI/2&&(F.requiresTwoSteps=!0,y=Math.PI/2-1E-5),p=D.tiltAtCenter-Math.PI/2-(y-Math.PI/2);F&&(F.eyeCenterDistance=w(D,y));F=p}else F=0;break a;case "local":E=e.viewAngle(p.renderCoordsHelper,y.center,y.eye);D=c.clamp(E,G.min,G.max);G=E-D;1E-9<Math.abs(G)?(F&&(E=p.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,p=p.renderCoordsHelper.getAltitude(y.eye)-E,D=Math.cos(D),F.eyeCenterDistance=
1E-4<Math.abs(D)?p/D:y.distance),F=G):F=0;break a;default:b.neverReached(p.viewingMode),F=void 0}return F}F=e.viewAngle(p.renderCoordsHelper,y.center,y.eye);D=c.clamp(F,G.min,G.max);F-=D;F=1E-9<Math.abs(F)?F:0;return F}function w(p,y){if(!p.centerIsOnSurface)return p.eyeCenterDistance;y=Math.PI-c.clamp(y,0,Math.PI);const D=c.asinClamped(p.radius/p.eyeRadius*Math.sin(y)),E=Math.sin(Math.PI-y-D)/Math.sin(y);return p.eyeRadius<p.radius&&1<E?Math.sin(Math.PI-y-(Math.PI-D))/Math.sin(y)*p.eyeRadius:E*p.eyeRadius}
function t(p,y,D){if(!p.state.isLocal){var E=p.state.constraints;if(E.altitude){var F=n.squaredLength(y.center),G=Math.sqrt(F);y=y.distance;var P=k.getReferenceEllipsoid(p.spatialReference).radius;p=E.altitude.min+P;E=E.altitude.max+P;p=(p*p-y*y-F)/(-2*G*y);D.min=Math.max(D.min,Math.min(Math.PI-c.acosClamped((E*E-y*y-F)/(-2*G*y)),D.max));D.max=Math.min(D.max,Math.PI-c.acosClamped(p))}}}const x=g.create(),B=r.create(),q=g.create(),u=c.deg2rad(5),C={min:0,max:0},z={constraints:null,radius:0,eyeRadius:0,
centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},A={eyeCenterDistance:0,requiresTwoSteps:!1};a.applyTiltConstraint=h;a.getTiltConstraintError=v;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/utils/viewUtils":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/vec3","../../../../chunks/vec3f64"],function(a,b,c,m){const l=m.create(),r=m.create();a.viewAngle=function(n,g,k){n.worldUpAtPosition(g,l);c.subtract(r,
k,g);n=c.length(r);return 0===n?0:b.acosClamped(c.dot(r,l)/n)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/animation/easing":function(){define(["exports"],function(a){function b(O){return O}function c(O){const Q=2*(O-Math.sqrt((O-1)*O)),S=Q/2/O;return T=>T<S?O*T*T:Q*T-Q+1}function m(O,Q){return(S,T)=>S<Q?Q*O(S/Q,T):1-O((1-S)/(1-Q),T)*(1-Q)}const l=O=>O*O,r=O=>1-l(1-O),n=O=>.5>O?l(2*O)/2:(1-l(1-2*(O-.5))+1)/2,g=O=>O*O*O,k=O=>1-g(1-O),f=O=>
.5>O?g(2*O)/2:(1-g(1-2*(O-.5))+1)/2,d=O=>O*O*O*O,e=O=>1-d(1-O),h=O=>.5>O?d(2*O)/2:(1-d(1-2*(O-.5))+1)/2,v=O=>O*O*O*O*O,w=O=>1-v(1-O),t=O=>.5>O?v(2*O)/2:(1-v(1-2*(O-.5))+1)/2,x=O=>-Math.cos(O*Math.PI/2)+1,B=O=>1-x(1-O),q=O=>.5>O?x(2*O)/2:(1-x(1-2*(O-.5))+1)/2,u=O=>2**(10*(O-1)),C=O=>1-2**(10*(1-O-1)),z=O=>.5>O?2**(10*(2*O-1))/2:(1-2**(10*(1-2*(O-.5)-1))+1)/2,A=O=>-(Math.sqrt(1-O*O)-1),p=O=>1-A(1-O),y=O=>.5>O?A(2*O)/2:(1-A(1-2*(O-.5))+1)/2,D=m(c(1),1),E=m(c(1),0),F=m(c(1),.5),G=m(c(2),1),P=m(c(2),0),
K=m(c(2),.5),N=m(c(3),1),M=m(c(3),0),L=m(c(3),.5),J=m(c(4),1),H=m(c(4),0),I=m(c(4),.5);a.EasingFunctions={linear:b,"in-quad":l,"out-quad":r,"in-out-quad":n,"in-coast-quad":D,"out-coast-quad":E,"in-out-coast-quad":F,"in-cubic":g,"out-cubic":k,"in-out-cubic":f,"in-coast-cubic":G,"out-coast-cubic":P,"in-out-coast-cubic":K,"in-quart":d,"out-quart":e,"in-out-quart":h,"in-coast-quart":N,"out-coast-quart":M,"in-out-coast-quart":L,"in-quint":v,"out-quint":w,"in-out-quint":t,"in-coast-quint":J,"out-coast-quint":H,
"in-out-coast-quint":I,"in-sine":x,"out-sine":B,"in-out-sine":q,"in-expo":u,"out-expo":C,"in-out-expo":z,"in-circ":A,"out-circ":p,"in-out-circ":y};a.inCirc=A;a.inCoastCubic=G;a.inCoastQuad=D;a.inCoastQuart=N;a.inCoastQuint=J;a.inCubic=g;a.inExpo=u;a.inOutCirc=y;a.inOutCoastCubic=K;a.inOutCoastQuad=F;a.inOutCoastQuart=L;a.inOutCoastQuint=I;a.inOutCubic=f;a.inOutExpo=z;a.inOutQuad=n;a.inOutQuart=h;a.inOutQuint=t;a.inOutSine=q;a.inQuad=l;a.inQuart=d;a.inQuint=v;a.inSine=x;a.linear=b;a.outCirc=p;a.outCoastCubic=
P;a.outCoastQuad=E;a.outCoastQuart=M;a.outCoastQuint=H;a.outCubic=k;a.outExpo=C;a.outQuad=r;a.outQuart=e;a.outQuint=w;a.outSine=B;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../ViewAnimation ../../animation/pointToPoint/Animation ./AnimationController ../../webgl-engine/lib/Camera ../../webgl-engine/lib/Intersector ../../../animation/easing".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w){a.PointToPointAnimationController=function(B){function q(C){C=B.call(this,C)||this;C.view=null;C.mode="interaction";C.hasTarget=!1;return C}b._inheritsLoose(q,B);var u=q.prototype;u.initialize=function(){this.animation=new d.Animation(this.view.state.viewingMode);this.viewAnimation="interaction"===this.mode?null:new f};u.begin=function(C,z){this.hasTarget=!0;z=this.animationSettings(z);t.copyFrom(this.view.state.camera);const A=v.newIntersector(this.view.state.viewingMode);
this.intersectionHelper.intersectRay(t.ray,A,x)&&(t.center=x);this.animation.update(t,C,z);this.animation.finished&&this.finish()};u.finish=function(){this.animation.currentTime=this.animation.time;B.prototype.finish.call(this)};u.stepController=function(C,z){this.hasTarget&&this.animation.step(C,z)};u.onControllerEnd=function(C){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,C),this.animation.currentTime=this.animation.time);B.prototype.onControllerEnd.call(this,
C)};u.animationSettings=function(C={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},...C,easing:"string"===typeof C.easing?w.EasingFunctions[C.easing]:C.easing}};b._createClass(q,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}},{key:"isInteractive",get:function(){return"interaction"===this.mode}},{key:"steppingFinished",get:function(){return this.hasTarget&&this.animation.finished}}]);
return q}(e.AnimationController);c.__decorate([m.property({constructOnly:!0})],a.PointToPointAnimationController.prototype,"view",void 0);c.__decorate([m.property({constructOnly:!0})],a.PointToPointAnimationController.prototype,"mode",void 0);a.PointToPointAnimationController=c.__decorate([g.subclass("esri.views.3d.state.controllers.PointToPointAnimationController")],a.PointToPointAnimationController);const t=new h.Camera,x=k.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/animation/pointToPoint/Animation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/time ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./Camera ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),function(a,b,c,m,l,r,n,g){const k=l.create();l=function(){function f(e){this.currentTime=c.Milliseconds(0);this._animation=new g.Animation(()=>new r(e));this._current=new r(e)}var d=f.prototype;d.update=function(e,
h,v){const w=this._animation.definition.source,t=this._animation.definition.target,x=m.subtract(k,h.center,e.center),B=m.length(x);1E-5<=B?(x[0]/=B,x[1]/=B,x[2]/=B):(x[0]=0,x[1]=1,x[0]=0);m.copy(w.lookAtDirection,x);m.copy(t.lookAtDirection,x);w.copyFromRenderCamera(e);t.copyFromRenderCamera(h);this._current.copyFrom(w);this._animation.update(w,t,v);this.currentTime=c.Milliseconds(0);e.almostEquals(h)&&(this.currentTime=this._animation.time)};d.cameraAt=function(e,h){this._animation.cameraAt(e,this._current);
h=h||new n.Camera;this._current.copyToRenderCamera(h);return h};d.step=function(e,h){this.finished||(this.currentTime=c.Milliseconds(this.currentTime+c.millisecondsFromSeconds(e)),this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,h)};b._createClass(f,[{key:"finished",get:function(){return this.currentTime>=this._animation.time}},{key:"time",get:function(){return this._animation.time}}]);return f}();a.Animation=l;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/animation/pointToPoint/Camera":function(){define("../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../../support/mathUtils".split(" "),function(a,b,c,m,l,r,n){const g=l.create(),k=l.create(),f=l.create(),d=l.create(),e=l.create(),h=l.create();var v=l.fromValues(0,0,1),w=l.fromValues(0,1,0),t=l.fromValues(1,0,0);const x=c.create();return function(){function B(u=
r.ViewingMode.Global){this.viewingMode=u;this.center=l.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=l.clone(w)}var q=B.prototype;q.pixelsPerPanAtZoom=function(u){return this.size/2/(this._zoomToPanScale*u)};q.zoomAtPixelsPerPan=function(u){return this.size/2/(this._zoomToPanScale*u)};q.pixelsPerRotateAtZoom=function(){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)};q.compareTo=function(u,C){C||(C={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if(this.viewingMode===
r.ViewingMode.Global){var z=m.length(this.center);const A=m.length(u.center);z=(z+A)/2;C.pan=n.angle(this.center,u.center)*z}else C.pan=m.distance(this.center,u.center);z=Math.abs(u.yaw-this.yaw);z>=Math.PI&&(z=2*Math.PI-z);C.rotate=Math.max(z,Math.abs(u.pitch-this.pitch));C.sourceZoom=this.distance;C.targetZoom=u.distance;return C};q.interpolate=function(u,C,z){this.viewingMode===r.ViewingMode.Global?n.slerp(u.center,C.center,z.pan,this.center):m.lerp(this.center,u.center,C.center,z.pan);this.distance=
a.lerp(u.distance,C.distance,z.zoom);this.pitch=a.lerp(u.pitch,C.pitch,z.rotate);u=u.yaw;C=C.yaw;Math.abs(C-u)>=Math.PI&&(u+=2*(u<C?1:-1)*Math.PI);this.yaw=a.lerp(u,C,z.rotate)};q.copyFrom=function(u){m.copy(this.center,u.center);this.pitch=u.pitch;this.yaw=u.yaw;this.distance=u.distance;m.copy(this.lookAtDirection,u.lookAtDirection);this.size=u.size;this.copyFromCommon(u);this.viewingMode=u.viewingMode};q.copyFromRenderCamera=function(u){const C=this._lookAtOrientation(u.center,x);m.copy(this.center,
u.center);m.subtract(d,u.center,u.eye);m.transformMat3(d,d,C);m.transformMat3(e,u.up,C);this.distance=m.length(d);d[0]/=this.distance;d[1]/=this.distance;d[2]/=this.distance;this.pitch=this._eyeUpToPitch(d);this.yaw=this._eyeUpToYaw(d,e);this.size=Math.sqrt(u.width*u.width+u.height*u.height);this.copyFromCommon(u)};q.copyFromCommon=function(u){this.fov=u.fov;this._zoomToPanScale=Math.atan(.5*this.fov)};q.copyToRenderCamera=function(u){const C=this._lookAtOrientation(this.center,x);b.transpose(C,C);
this._axisAngleVec3(t,this.pitch-Math.PI/2,w,d);this._axisAngleVec3(v,this.yaw,d);this._axisAngleVec3(t,this.pitch-Math.PI/2,v,e);this._axisAngleVec3(v,this.yaw,e);m.scale(d,d,this.distance);m.transformMat3(d,d,C);m.transformMat3(e,e,C);u.center=this.center;u.eye=m.subtract(d,this.center,d);u.up=e};q._axisAngleVec3=function(u,C,z,A=z){const p=Math.cos(C);C=Math.sin(C);m.scale(g,z,p);m.cross(k,u,z);m.scale(k,k,C);m.scale(f,u,(1-p)*m.dot(u,z));return m.add(A,m.add(A,g,k),f)};q._lookAtOrientation=function(u,
C=c.create()){this._upAtLookAt(u,f);m.cross(g,this.lookAtDirection,f);m.normalize(g,g);0===g[0]&&0===g[1]&&0===g[2]&&m.copy(g,t);m.cross(k,f,g);m.normalize(k,k);C[0]=g[0];C[1]=k[0];C[2]=f[0];C[3]=g[1];C[4]=k[1];C[5]=f[1];C[6]=g[2];C[7]=k[2];C[8]=f[2];return C};q._upAtLookAt=function(u,C){return this.viewingMode===r.ViewingMode.Local?m.copy(C,v):m.normalize(C,u)};q._eyeUpToPitch=function(u){return Math.PI-n.angle(v,u)};q._eyeUpToYaw=function(u,C){.5>Math.abs(C[2])?(m.copy(h,C),0<u[2]&&m.scale(h,h,
-1)):m.copy(h,u);m.cross(k,h,v);m.normalize(k,k);return n.angle(t,k,v)};return B}()})},"esri/views/3d/webgl-engine/lib/Camera":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../geometry/support/vector ../../../ViewingMode ./Util".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q){const u=c.getLogger("esri.views.3d.webgl-engine.lib.Camera");c=function(){function D(F=null,G=null,P=null){this._viewUp=e.create();this._viewForward=e.create();this._viewRight=e.create();this._ray=t.create();this._viewport=v.fromValues(0,0,1,1);this._padding=v.fromValues(0,0,0,0);this._fov=55/180*Math.PI;this._nearFar=f.fromValues(1,1E3);this._viewDirty=!0;this._viewMatrix=g.create();this._projectionDirty=!0;this._projectionMatrix=g.create();this._viewProjectionDirty=
!0;this._viewProjectionMatrix=g.create();this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=g.create();this._inverseProjectionDirty=!0;this._inverseProjectionMatrix=null;this._frustumDirty=!0;this._frustum=w.create();this._fullViewport=v.create();this._pixelRatio=1;this.relativeElevation=0;l.isSome(F)&&d.copy(this._ray.origin,F);this._center=l.isSome(G)?e.clone(G):e.create();this._up=l.isSome(P)?e.clone(P):e.fromValues(0,0,1)}var E=D.prototype;E.depthNDCToWorld=function(F){return 2*
this.near*this.far/(this.far+this.near-(2*F-1)*(this.far-this.near))};E.copyFrom=function(F){d.copy(this._ray.origin,F.eye);d.copy(this._center,F.center);d.copy(this._up,F.up);h.copy(this._viewport,F.viewport);h.copy(this._padding,F.padding);k.copy(this._nearFar,F.nearFar);this._fov=F.fov;this.relativeElevation=F.relativeElevation;this._viewDirty=F._viewDirty;this._viewDirty||(n.copy(this._viewMatrix,F.viewMatrix),d.copy(this._viewRight,F.viewRight),d.copy(this._viewUp,F.viewUp),d.copy(this._viewForward,
F.viewForward));F._projectionDirty?this._projectionDirty=!0:(n.copy(this._projectionMatrix,F.projectionMatrix),this._projectionDirty=!1);this._inverseProjectionDirty=this._viewProjectionDirty=!0;this._frustumDirty=F._frustumDirty;this._frustumDirty||(w.copy(this._frustum,F.frustum),this._frustumDirty=!1);F._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(n.copy(this._viewInverseTransposeMatrix,F.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1);h.copy(this._fullViewport,
F.fullViewport);this._pixelRatio=F.pixelRatio;return this};E.copyViewFrom=function(F){this.eye=F.eye;this.center=F.center;this.up=F.up};E.clone=function(){return(new D).copyFrom(this)};E.equals=function(F){return d.exactEquals(this.eye,F.eye)&&d.exactEquals(this._center,F.center)&&d.exactEquals(this._up,F.up)&&h.exactEquals(this._viewport,F.viewport)&&h.exactEquals(this._padding,F.padding)&&k.exactEquals(this._nearFar,F.nearFar)&&this._fov===F.fov&&this._pixelRatio===F.pixelRatio&&this.relativeElevation===
F.relativeElevation};E.almostEquals=function(F){if(this._pixelRatio!==F.pixelRatio||.001<=Math.abs(F.fov-this._fov))return!1;const G=1-1E-10;d.sub(A,F.eye,F.center);d.sub(p,this.eye,this._center);const P=d.dot(A,p),K=d.sqrLen(A),N=d.sqrLen(p);return P*P>=G*K*N&&d.sqrDist(F.eye,this.eye)<2.5E-7*Math.max(K,N)&&.5>h.squaredDistance(F.padding,this._padding)&&.5>h.squaredDistance(F.viewport,this._viewport)};E.computeRenderPixelSizeAt=function(F){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(F))};
E.computeRenderPixelSizeAtDist=function(F){return F*this.perRenderPixelRatio};E.computeScreenPixelSizeAt=function(F){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(F))};E._viewDirectionDistance=function(F){return Math.abs(x.projectPointSignedLength(this.viewForward,d.subtract(A,F,this.eye)))};E.computeScreenPixelSizeAtDist=function(F){return F*this.perScreenPixelRatio};E.computeDistanceFromRadius=function(F,G){return F/Math.tan(Math.min(this.fovX,this.fovY)/(2*(G||1)))};E.getScreenCenter=
function(F=r.createScreenPointArray()){F[0]=(this.padding[a.PaddingSide.LEFT]+this.width/2)/this._pixelRatio;F[1]=(this.padding[a.PaddingSide.TOP]+this.height/2)/this._pixelRatio;return F};E.getRenderCenter=function(F,G=.5,P=.5){F[0]=this.padding[a.PaddingSide.LEFT]+this.width*G;F[1]=this.padding[a.PaddingSide.BOTTOM]+this.height*P;F[2]=.5;return F};E.setGLViewport=function(F){const G=this.viewport,P=this.padding;F.setViewport(G[0]-P[3],G[1]-P[2],G[2]+P[1]+P[3],G[3]+P[0]+P[2])};E.applyProjection=
function(F,G){F!==C&&d.copy(C,F);C[3]=1;h.transformMat4(C,C,this.projectionMatrix);F=Math.abs(C[3]);d.scale(C,C,1/F);const P=this.fullViewport;G[0]=m.lerp(0,P[0]+P[2],.5+.5*C[0]);G[1]=m.lerp(0,P[1]+P[3],.5+.5*C[1]);G[2]=.5*(C[2]+1);G[3]=F};E.unapplyProjection=function(F,G){const P=this.fullViewport;C[0]=(F[0]/(P[0]+P[2])*2-1)*F[3];C[1]=(F[1]/(P[1]+P[3])*2-1)*F[3];C[2]=(2*F[2]-1)*F[3];C[3]=F[3];h.transformMat4(C,C,this.inverseProjectionMatrix);G[0]=C[0];G[1]=C[1];G[2]=C[2]};E.projectToScreen=function(F,
G){this.projectToRenderScreen(F,y);this.renderToScreen(y,G)};E.projectToRenderScreen=function(F,G){C[0]=F[0];C[1]=F[1];C[2]=F[2];C[3]=1;h.transformMat4(C,C,this.viewProjectionMatrix);if(0===C[3])return null;d.scale(C,C,1/Math.abs(C[3]));F=this.fullViewport;"x"in G?(G.x=m.lerp(0,F[0]+F[2],.5+.5*C[0]),G.y=m.lerp(0,F[1]+F[3],.5+.5*C[1])):(G[0]=m.lerp(0,F[0]+F[2],.5+.5*C[0]),G[1]=m.lerp(0,F[1]+F[3],.5+.5*C[1]),2<G.length&&(G[2]=.5*(C[2]+1)));return G};E.unprojectFromScreen=function(F,G){return this.unprojectFromRenderScreen(this.screenToRender(F,
y),G)};E.unprojectFromRenderScreen=function(F,G){n.multiply(z,this.projectionMatrix,this.viewMatrix);if(!n.invert(z,z))return null;const P=this.fullViewport;C[0]=2*(F[0]-P[0])/P[2]-1;C[1]=2*(F[1]-P[1])/P[3]-1;C[2]=2*F[2]-1;C[3]=1;h.transformMat4(C,C,z);if(0===C[3])return null;G[0]=C[0]/C[3];G[1]=C[1]/C[3];G[2]=C[2]/C[3];return G};E.constrainWindowSize=function(F,G,P,K=P){F*=this._pixelRatio;G*=this._pixelRatio;return[Math.max(F-P/2,0),Math.max(this.fullHeight-G-K/2,0),P- -Math.min(F-P/2,0)- -Math.min(this.fullWidth-
F-P/2,0),K- -Math.min(this.fullHeight-G-K/2,0)- -Math.min(G-K/2,0)]};E.computeUp=function(F){F===B.ViewingMode.Global?this._computeUpGlobal():this._computeUpLocal()};E.screenToRender=function(F,G){const P=this.fullHeight-F[1]*this._pixelRatio;G[0]=F[0]*this._pixelRatio;G[1]=P;return G};E.renderToScreen=function(F,G){const P=(this.fullHeight-F[1])/this._pixelRatio;G[0]=F[0]/this._pixelRatio;G[1]=P};E._computeUpGlobal=function(){d.subtract(A,this.center,this.eye);const F=d.length(this.center);1>F?(d.set(this._up,
0,0,1),this._markViewDirty()):Math.abs(d.dot(A,this.center))>.9999*d.length(A)*F||(d.cross(this._up,A,this.center),d.cross(this._up,this._up,A),d.normalize(this._up,this._up),this._markViewDirty())};E._computeUpLocal=function(){d.direction(A,this.eye,this.center);.9999>=Math.abs(A[2])&&(d.scale(A,A,A[2]),d.set(this._up,-A[0],-A[1],1-A[2]),d.normalize(this._up,this._up),this._markViewDirty())};E._compareAndSetView=function(F,G){"number"===typeof F[0]&&isFinite(F[0])&&"number"===typeof F[1]&&isFinite(F[1])&&
"number"===typeof F[2]&&isFinite(F[2])?d.exactEquals(F,G)||(d.copy(G,F),this._markViewDirty()):u.warn("Camera vector contains invalid number, ignoring value")};E._markViewDirty=function(){this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0};E._recomputeFrustum=function(){this._frustumDirty&&(w.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)};E._ensureViewClean=function(){this._viewDirty&&(n.lookAt(this._viewMatrix,this.eye,this._center,this._up),
d.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),d.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),d.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)};b._createClass(D,[{key:"pixelRatio",get:function(){return this._pixelRatio},set:function(F){this._pixelRatio=0<F?F:1}},{key:"eye",get:function(){return this._ray.origin},set:function(F){this._compareAndSetView(F,
this._ray.origin)}},{key:"center",get:function(){return this._center},set:function(F){this._compareAndSetView(F,this._center)}},{key:"ray",get:function(){d.subtract(this._ray.direction,this.center,this.eye);return this._ray}},{key:"up",get:function(){return this._up},set:function(F){this._compareAndSetView(F,this._up)}},{key:"viewMatrix",get:function(){this._ensureViewClean();return this._viewMatrix},set:function(F){n.copy(this._viewMatrix,F);this._viewDirty=!1;this._frustumDirty=this._viewProjectionDirty=
this._viewInverseTransposeMatrixDirty=!0}},{key:"viewForward",get:function(){this._ensureViewClean();return this._viewForward}},{key:"viewUp",get:function(){this._ensureViewClean();return this._viewUp}},{key:"viewRight",get:function(){this._ensureViewClean();return this._viewRight}},{key:"nearFar",get:function(){return this._nearFar}},{key:"near",get:function(){return this._nearFar[0]},set:function(F){this._nearFar[0]!==F&&(this._nearFar[0]=F,this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=
this._projectionDirty=!0)}},{key:"far",get:function(){return this._nearFar[1]},set:function(F){this._nearFar[1]!==F&&(this._nearFar[1]=F,this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0)}},{key:"viewport",get:function(){return this._viewport},set:function(F){this.x=F[0];this.y=F[1];this.width=F[2];this.height=F[3]}},{key:"x",get:function(){return this._viewport[0]},set:function(F){F+=this._padding[a.PaddingSide.LEFT];this._viewport[0]!==F&&(this._viewport[0]=
F,this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0)}},{key:"y",get:function(){return this._viewport[1]},set:function(F){F+=this._padding[a.PaddingSide.BOTTOM];this._viewport[1]!==F&&(this._viewport[1]=F,this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0)}},{key:"width",get:function(){return this._viewport[2]},set:function(F){this._viewport[2]!==F&&(this._viewport[2]=F,this._frustumDirty=this._viewProjectionDirty=
this._inverseProjectionDirty=this._projectionDirty=!0)}},{key:"height",get:function(){return this._viewport[3]},set:function(F){this._viewport[3]!==F&&(this._viewport[3]=F,this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0)}},{key:"fullWidth",get:function(){return this._viewport[2]+this._padding[a.PaddingSide.RIGHT]+this._padding[a.PaddingSide.LEFT]},set:function(F){this.width=F-(this._padding[a.PaddingSide.RIGHT]+this._padding[a.PaddingSide.LEFT])}},
{key:"fullHeight",get:function(){return this._viewport[3]+this._padding[a.PaddingSide.TOP]+this._padding[a.PaddingSide.BOTTOM]},set:function(F){this.height=F-(this._padding[a.PaddingSide.TOP]+this._padding[a.PaddingSide.BOTTOM])}},{key:"fullViewport",get:function(){this._fullViewport[0]=this._viewport[0]-this._padding[a.PaddingSide.LEFT];this._fullViewport[1]=this._viewport[1]-this._padding[a.PaddingSide.BOTTOM];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport}},
{key:"aspect",get:function(){return this.width/this.height}},{key:"padding",get:function(){return this._padding},set:function(F){if(this._padding[a.PaddingSide.TOP]!==F[a.PaddingSide.TOP]||this._padding[a.PaddingSide.RIGHT]!==F[a.PaddingSide.RIGHT]||this._padding[a.PaddingSide.BOTTOM]!==F[a.PaddingSide.BOTTOM]||this._padding[a.PaddingSide.LEFT]!==F[a.PaddingSide.LEFT])this._viewport[0]+=F[a.PaddingSide.LEFT]-this._padding[a.PaddingSide.LEFT],this._viewport[1]+=F[a.PaddingSide.BOTTOM]-this._padding[a.PaddingSide.BOTTOM],
this._viewport[2]-=F[a.PaddingSide.RIGHT]+F[a.PaddingSide.LEFT]-(this._padding[a.PaddingSide.RIGHT]+this._padding[a.PaddingSide.LEFT]),this._viewport[3]-=F[a.PaddingSide.TOP]+F[a.PaddingSide.BOTTOM]-(this._padding[a.PaddingSide.TOP]+this._padding[a.PaddingSide.BOTTOM]),h.copy(this._padding,F),this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0}},{key:"viewProjectionMatrix",get:function(){this._viewProjectionDirty&&(n.multiply(this._viewProjectionMatrix,
this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix}},{key:"projectionMatrix",get:function(){if(this._projectionDirty){const F=this.width,G=this.height,P=this.near*Math.tan(this.fovY/2),K=P*this.aspect;n.frustum(this._projectionMatrix,-K*(1+2*this._padding[a.PaddingSide.LEFT]/F),K*(1+2*this._padding[a.PaddingSide.RIGHT]/F),-P*(1+2*this._padding[a.PaddingSide.BOTTOM]/G),P*(1+2*this._padding[a.PaddingSide.TOP]/G),this.near,this.far);this._projectionDirty=
!1}return this._projectionMatrix},set:function(F){n.copy(this._projectionMatrix,F);this._projectionDirty=!1;this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=!0}},{key:"inverseProjectionMatrix",get:function(){l.isNone(this._inverseProjectionMatrix)&&(this._inverseProjectionMatrix=g.create());this._inverseProjectionDirty&&n.invert(this._inverseProjectionMatrix,this.projectionMatrix);return this._inverseProjectionMatrix}},{key:"fov",get:function(){return this._fov},set:function(F){this._fov=
F;this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0}},{key:"fovX",get:function(){return q.fovd2fovx(this._fov,this.width,this.height)},set:function(F){this._fov=q.fovx2fovd(F,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0}},{key:"fovY",get:function(){return q.fovd2fovy(this._fov,this.width,this.height)},set:function(F){this._fov=q.fovy2fovd(F,this.width,this.height);this._frustumDirty=
this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0}},{key:"distance",get:function(){return d.distance(this._center,this.eye)}},{key:"frustum",get:function(){this._recomputeFrustum();return this._frustum}},{key:"viewInverseTransposeMatrix",get:function(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)n.invert(this._viewInverseTransposeMatrix,this.viewMatrix),n.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=
!1;return this._viewInverseTransposeMatrix}},{key:"perRenderPixelRatio",get:function(){return Math.tan(this.fovX/2)/(this.width/2)}},{key:"perScreenPixelRatio",get:function(){return this.perRenderPixelRatio*this._pixelRatio}},{key:"aboveGround",get:function(){return this.relativeElevation&&0<=this.relativeElevation}}]);return D}();const C=v.create(),z=g.create(),A=e.create(),p=e.create(),y=r.createRenderScreenPointArray3();a.PaddingSide=void 0;(function(D){D[D.TOP=0]="TOP";D[D.RIGHT=1]="RIGHT";D[D.BOTTOM=
2]="BOTTOM";D[D.LEFT=3]="LEFT"})(a.PaddingSide||(a.PaddingSide={}));a.Camera=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/frustum":function(){define("exports ../../core/ObjectStack ../../chunks/mat4 ../../chunks/vec3 ../../chunks/vec3f64 ../../chunks/vec4 ../../chunks/vec4f64 ./clipRay ./plane ./vectorStacks".split(" "),function(a,b,c,m,l,r,n,g,k,f){function d(){return[l.create(),l.create(),l.create(),l.create(),l.create(),l.create(),
l.create(),l.create()]}function e(B,q){k.fromPoints(q[a.PointIndex.FAR_BOTTOM_LEFT],q[a.PointIndex.NEAR_BOTTOM_LEFT],q[a.PointIndex.NEAR_TOP_LEFT],B[a.PlaneIndex.LEFT]);k.fromPoints(q[a.PointIndex.NEAR_BOTTOM_RIGHT],q[a.PointIndex.FAR_BOTTOM_RIGHT],q[a.PointIndex.FAR_TOP_RIGHT],B[a.PlaneIndex.RIGHT]);k.fromPoints(q[a.PointIndex.FAR_BOTTOM_LEFT],q[a.PointIndex.FAR_BOTTOM_RIGHT],q[a.PointIndex.NEAR_BOTTOM_RIGHT],B[a.PlaneIndex.BOTTOM]);k.fromPoints(q[a.PointIndex.NEAR_TOP_LEFT],q[a.PointIndex.NEAR_TOP_RIGHT],
q[a.PointIndex.FAR_TOP_RIGHT],B[a.PlaneIndex.TOP]);k.fromPoints(q[a.PointIndex.NEAR_BOTTOM_LEFT],q[a.PointIndex.NEAR_BOTTOM_RIGHT],q[a.PointIndex.NEAR_TOP_RIGHT],B[a.PlaneIndex.NEAR]);k.fromPoints(q[a.PointIndex.FAR_BOTTOM_RIGHT],q[a.PointIndex.FAR_BOTTOM_LEFT],q[a.PointIndex.FAR_TOP_LEFT],B[a.PlaneIndex.FAR])}function h(B,q){for(let u=0;u<a.NumPlanes.NUM;u++)if(!k.clip(B[u],q))return!1;return!0}a.PlaneIndex=void 0;(function(B){B[B.LEFT=0]="LEFT";B[B.RIGHT=1]="RIGHT";B[B.BOTTOM=2]="BOTTOM";B[B.TOP=
3]="TOP";B[B.NEAR=4]="NEAR";B[B.FAR=5]="FAR"})(a.PlaneIndex||(a.PlaneIndex={}));a.PointIndex=void 0;(function(B){B[B.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT";B[B.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT";B[B.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT";B[B.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT";B[B.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT";B[B.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT";B[B.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT";B[B.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"})(a.PointIndex||(a.PointIndex={}));const v={bottom:[a.PointIndex.FAR_BOTTOM_RIGHT,
a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.FAR_BOTTOM_LEFT],near:[a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.NEAR_TOP_RIGHT,a.PointIndex.NEAR_TOP_LEFT],far:[a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.FAR_BOTTOM_LEFT,a.PointIndex.FAR_TOP_LEFT,a.PointIndex.FAR_TOP_RIGHT],right:[a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.FAR_TOP_RIGHT,a.PointIndex.NEAR_TOP_RIGHT],left:[a.PointIndex.FAR_BOTTOM_LEFT,a.PointIndex.NEAR_BOTTOM_LEFT,
a.PointIndex.NEAR_TOP_LEFT,a.PointIndex.FAR_TOP_LEFT],top:[a.PointIndex.FAR_TOP_LEFT,a.PointIndex.NEAR_TOP_LEFT,a.PointIndex.NEAR_TOP_RIGHT,a.PointIndex.FAR_TOP_RIGHT]};a.NumPlanes=void 0;(function(B){B[B.NUM=6]="NUM"})(a.NumPlanes||(a.NumPlanes={}));a.NumPoints=void 0;(function(B){B[B.NUM=8]="NUM"})(a.NumPoints||(a.NumPoints={}));const w=[n.fromValues(-1,-1,-1,1),n.fromValues(1,-1,-1,1),n.fromValues(1,1,-1,1),n.fromValues(-1,1,-1,1),n.fromValues(-1,-1,1,1),n.fromValues(1,-1,1,1),n.fromValues(1,1,
1,1),n.fromValues(-1,1,1,1)],t=new b.ObjectStack(g.create),x=d();a.computePlanes=e;a.copy=function(B,q){for(let u=0;u<a.NumPlanes.NUM;u++)k.copy(B[u],q[u])};a.create=function(B){return B?[k.create(B[0]),k.create(B[1]),k.create(B[2]),k.create(B[3]),k.create(B[4]),k.create(B[5])]:[k.create(),k.create(),k.create(),k.create(),k.create(),k.create()]};a.createPoints=d;a.fromMatrix=function(B,q,u,C=x){B=c.multiply(f.sm4d.get(),q,B);c.invert(B,B);for(q=0;q<a.NumPoints.NUM;++q){const z=r.transformMat4(f.sv4d.get(),
w[q],B);m.set(C[q],z[0]/z[3],z[1]/z[3],z[2]/z[3])}e(u,C)};a.intersectClipRay=function(B,q){for(let u=0;u<a.NumPlanes.NUM;u++)if(!k.clipInfinite(B[u],q))return!1;return!0};a.intersectsAABB=function(B,q){for(let u=0;u<a.NumPlanes.NUM;u++)if(k.isAABBFullyInside(B[u],q))return!1;return!0};a.intersectsLineSegment=function(B,q,u){return h(B,g.fromLineSegmentAndDirection(q,u,t.get()))};a.intersectsPoint=function(B,q){for(let u=0;u<a.NumPlanes.NUM;u++)if(0<k.signedDistance(B[u],q))return!1;return!0};a.intersectsRay=
function(B,q){return h(B,g.fromRay(q,t.get()))};a.intersectsSphere=function(B,q){for(let u=0;u<a.NumPlanes.NUM;u++){const C=B[u];if(C[0]*q[0]+C[1]*q[1]+C[2]*q[2]+C[3]>=q[3])return!1}return!0};a.planePointIndices=v;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/clipRay":function(){define(["exports","../../core/ObjectStack","../../chunks/vec3","./ray","./vectorStacks"],function(a,b,c,m,l){function r(d){return d?{ray:m.create(d.ray),
c0:d.c0,c1:d.c1}:{ray:m.create(),c0:0,c1:Number.MAX_VALUE}}function n(d,e,h,v=r()){m.copy(d,v.ray);v.c0=e;v.c1=h;return v}function g(d,e,h=r()){const v=c.length(d.vector);m.fromValues(d.origin,e,h.ray);h.c0=0;h.c1=v;return h}function k(d,e,h){return c.add(h,d.ray.origin,c.scale(h,d.ray.direction,e))}const f=new b.ObjectStack(()=>({c0:0,c1:0,ray:null}));a.copy=function(d,e=r()){return n(d.ray,d.c0,d.c1,e)};a.create=r;a.fromLineSegment=function(d,e=r()){const h=c.normalize(l.sv3d.get(),d.vector);return g(d,
h,e)};a.fromLineSegmentAndDirection=g;a.fromRay=function(d,e=r()){m.copy(d,e.ray);e.c0=0;e.c1=Number.MAX_VALUE;return e};a.fromValues=n;a.getAt=k;a.getEnd=function(d,e){return k(d,d.c1,e)};a.getStart=function(d,e){return k(d,d.c0,e)};a.wrap=function(d,e,h){const v=f.get();v.ray=d;v.c0=e;v.c1=h;return v};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/animation/pointToPoint/Animation":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/time ../easing ./Definition ./Settings ./apex/Path".split(" "),
function(a,b,c,m,l,r,n){const g={zoom:0,pan:0,rotate:0};let k=function(){function f(e){this.createCamera=e;this._time=c.Milliseconds(0);this.definition=new l.Definition(e);this.path=new n.Path}var d=f.prototype;d.update=function(e,h,v){this.definition.update(e,h,v);this.path.update(this.definition,v);this._time=this._applyTimeSettings(c.millisecondsFromSeconds(this.path.time),v);this._easing=v.easing?v.easing:1E3<=this._time?m.inOutCoastQuad:m.outExpo};d.cameraAt=function(e,h){h=h||this.createCamera();
e=Math.min(Math.max(0,e),1);e=this._normalizedEasing(e);e=this.path.interpolateComponentsAt(e,g);h.interpolate(this.definition.source,this.definition.target,e);return h};d._normalizedEasing=function(e){const h=this._easing(0,this._time),v=this._easing(1,this._time);return(this._easing(e,this._time)-h)/(v-h)};d._applyTimeSettings=function(e,h){const v=null!=h.speedFactor?h.speedFactor:1;null!=h.duration?e=h.duration:null!=h.speedFactor&&(e=c.Milliseconds(e/v));return c.Milliseconds(Math.min(Math.max(null!=
h.minDuration?h.minDuration:r.defaultSettings.minDuration/v,e),null!=h.maxDuration?h.maxDuration:r.defaultSettings.maxDuration/v))};b._createClass(f,[{key:"time",get:function(){return this._time}}]);return f}();a.Animation=k;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/animation/pointToPoint/Definition":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./Settings"],function(a,b,c){let m=function(){function l(n){this.createCamera=
n;this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:c.defaultSettings.desiredScreenFlow};this.source=n();this.target=n()}var r=l.prototype;r.clone=function(){const n=new l(this.createCamera);n.copyFrom(this);return n};r.copyFrom=function(n){this.update(n.source,n.target,n.settings)};r.update=function(n,g,k){this.source!==n&&this.source.copyFrom(n);this.target!==g&&this.target.copyFrom(g);this.compared=this.source.compareTo(this.target,this.compared);this.settings.desiredScreenFlow=
null!=k.desiredScreenFlow?k.desiredScreenFlow:c.defaultSettings.desiredScreenFlow;this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size;this.halfWindowSize=this.target.size/2};r.halfWindowPanAtZoom=function(n){n=this.target.pixelsPerPanAtZoom(n);return this.halfWindowSize/n};b._createClass(l,[{key:"hasZoom",get:function(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)}},{key:"hasPan",get:function(){return 1E-9<this.compared.pan}},{key:"hasRotate",get:function(){return 1E-9<
this.compared.rotate}}]);return l}();a.Definition=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/animation/pointToPoint/Settings":function(){define(["exports","../../../core/time"],function(a,b){b={desiredScreenFlow:2,minDuration:b.Milliseconds(500),maxDuration:b.Milliseconds(8E3)};a.defaultSettings=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/animation/pointToPoint/apex/Path":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../easing ../Path ../Segment ./planning".split(" "),
function(a,b,c,m,l,r){m=function(n){function g(f,d){var e=n.call(this)||this;e._preallocSegments=[new l.Segment,new l.Segment,new l.Segment];e.update(f,d);return e}b._inheritsLoose(g,n);var k=g.prototype;k.update=function(f,d){if(f){this.definition?this.definition.copyFrom(f):this.definition=f.clone();var e=null;d&&d.apex&&(e=r.optimalDistance(f,d.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==e?this._updateWithoutApex():this._updateWithApex(e,d.apex)}};k.segmentInterpolateComponentsAt=
function(f,d,e){e=f.interpolateComponentsAt(d,e);f===this._ascensionSegment?e.zoom=c.outQuad(e.zoom):f===this._descensionSegment&&(e.zoom=c.inQuad(e.zoom));return e};k._updateWithApex=function(f,d){const [e,h,v]=this._preallocSegments,w=null!=d.ascensionFactor?d.ascensionFactor:.5;d=Math.min(1-w,null!=d.ascensionFactor?d.descensionFactor:.5);const t=1-w-d;e.definition?e.definition.copyFrom(this.definition):e.definition=this.definition.clone();e.definition.compared.targetZoom=f;e.definition.compared.pan=
this.definition.compared.pan*w;e.definition.compared.rotate=this.definition.compared.rotate*w;e.update();this._ascensionSegment=e;this.segments.push(e);0<t&&(h.definition?h.definition.copyFrom(this.definition):h.definition=this.definition.clone(),h.definition.copyFrom(this.definition),h.definition.compared.sourceZoom=f,h.definition.compared.targetZoom=f,h.definition.compared.pan=this.definition.compared.pan*t,h.definition.compared.rotate=this.definition.compared.rotate*t,h.update(),this.segments.push(h));
v.definition?v.definition.copyFrom(this.definition):v.definition=this.definition.clone();v.definition.compared.sourceZoom=f;v.definition.compared.pan=this.definition.compared.pan*d;v.definition.compared.rotate=this.definition.compared.rotate*d;v.update();this._descensionSegment=v;this.segments.push(v)};k._updateWithoutApex=function(){const [f]=this._preallocSegments;f.update(this.definition);this.segments.push(f)};return g}(m.Path);a.Path=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/animation/pointToPoint/Path":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/time"],function(a,b,c){let m=function(){function l(){this.segments=[]}var r=l.prototype;r.interpolateComponentsAt=function(n,g){n=Math.min(Math.max(n,0),1);n*=this.time;var k=0,f=0;const d=this.definition;for(let e=0;e<this.segments.length;e++){const h=this.segments[e],v=h.definition;if(n<=h.time||e===this.segments.length-1)return g=this.segmentInterpolateComponentsAt(h,
n/h.time,g),g.pan=d.hasPan?(k+v.compared.pan*g.pan)/d.compared.pan:1,g.rotate=d.hasRotate?(f+v.compared.rotate*g.rotate)/d.compared.rotate:1,n=g.zoom*(v.compared.targetZoom-v.compared.sourceZoom)+v.compared.sourceZoom,k=this.segments[0].definition.compared.sourceZoom,f=this.segments[this.segments.length-1].definition.compared.targetZoom,g.zoom=d.hasZoom?(n-k)/(f-k):1,g;n-=h.time;k+=v.compared.pan;f+=v.compared.rotate}};r.segmentInterpolateComponentsAt=function(n,g,k){return n.interpolateComponentsAt(g,
k)};b._createClass(l,[{key:"time",get:function(){return this.segments.reduce((n,g)=>c.Seconds(n+g.time),c.Seconds(0))}}]);return l}();a.Path=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/animation/pointToPoint/Segment":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/time"],function(a,b,c){let m=function(){function l(n){n&&this.update(n)}var r=l.prototype;r.update=function(n){n&&(this.definition?this.definition.copyFrom(n):
this.definition=n.clone());this._updatePrecomputedVariables();this._updatePixelFlow()};r._updatePrecomputedVariables=function(){var n=this.definition;const g=n.compared,k=g.sourceZoom,f=g.targetZoom;this._zoomSign=k>f?1:-1;this._panPixelsAtSource=g.pan*n.source.pixelsPerPanAtZoom(k);n=(n.source.pixelsPerRotateAtZoom(k)+n.target.pixelsPerRotateAtZoom(f))/2;this._rotatePixels=g.rotate*n};r._updatePixelFlow=function(){var n=this.definition.compared.sourceZoom,g=this.definition.compared.targetZoom;const {hasZoom:k,
hasPan:f,hasRotate:d}=this.definition;var e=0,h=0;k&&(f&&(e=(g/n-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),d&&(h=Math.log(n/g)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._rotatePixels));this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;n=this.definition.desiredPixelFlow;k&&f&&d?(g=e+h+e*h,this._zoomPixelFlow=e*h/g*n,this._panPixelFlow=h/g*n,this._rotatePixelFlow=e/g*n):k&&f?(h=1+e,this._zoomPixelFlow=e/h*n,this._panPixelFlow=
1/h*n):k&&d?(e=1+h,this._zoomPixelFlow=h/e*n,this._rotatePixelFlow=1/e*n):f&&d?(e=this._panPixelsAtSource/this._rotatePixels,h=1+e,this._panPixelFlow=e/h*n,this._rotatePixelFlow=1/h*n):f?this._panPixelFlow=n:k?this._zoomPixelFlow=n:d&&(this._rotatePixelFlow=n);this._time=d?this.rotateTime:k?this.zoomTime:f?this.panTime:c.Seconds(0)};r._interpolateComponentsZoom=function(n){if(0===n||1===n)return n;if(this.definition.hasZoom){const g=this.definition.compared.sourceZoom,k=this.definition.compared.targetZoom;
return(g*(g/k)**-n-g)/(k-g)}return n};r._interpolateComponentsPan=function(n){if(0===n||1===n)return n;if(this.definition.hasPan&&this.definition.hasZoom){const g=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*this._panPixelFlow*(2**(g*n*this._time)-1)/(g*Math.LN2)}return n};r._interpolateComponentsRotate=function(n){return n};r.interpolateComponentsAt=function(n,g){n=Math.min(Math.max(n,0),1);const k=this._interpolateComponentsZoom(n),f=this._interpolateComponentsPan(n);
n=this._interpolateComponentsRotate(n);g?(g.zoom=k,g.pan=f,g.rotate=n):g={zoom:k,pan:f,rotate:n};return g};b._createClass(l,[{key:"time",get:function(){return this._time}},{key:"rotateTime",get:function(){return this.definition.hasRotate?c.Seconds(this._rotatePixels/this._rotatePixelFlow):c.Seconds(0)}},{key:"zoomTime",get:function(){return this.definition.hasZoom?c.Seconds(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/
this._zoomPixelFlow):c.Seconds(0)}},{key:"panTime",get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){const n=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return c.Seconds(Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*n+1)/(n*this._zoomPixelFlow))}return c.Seconds(this._panPixelsAtSource/this._panPixelFlow)}return c.Seconds(0)}}]);return l}();a.Segment=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/animation/pointToPoint/apex/planning":function(){define(["exports","./functions"],function(a,b){function c(m,l){const r=Math.max(m.compared.sourceZoom,m.compared.targetZoom);m=m.source.zoomAtPixelsPerPan(m.desiredPixelFlow/m.compared.pan)/2;return m<r?null!=l.maximumDistance?r+(l.maximumDistance-r)/2:1.5*r:l.maximumDistance?Math.min(l.maximumDistance,m):m}a.optimalDistance=function(m,l){let r=c(m,l);const n={ascensionFactor:null!=l.ascensionFactor?l.ascensionFactor:.5,descensionFactor:null!=
l.descensionFactor?l.descensionFactor:.5};var g=0===n.ascensionFactor,k=0===n.descensionFactor;const f=g?b.tAscensionZoomOnly:b.tAscensionZoomPan,d=g?b.dtAscensionZoomOnly:b.dtAscensionZoomPan,e=g?b.ddtAscensionZoomOnly:b.ddtAscensionZoomPan,h=k?b.tDescensionZoomOnly:b.tDescensionZoomPan,v=k?b.dtDescensionZoomOnly:b.dtDescensionZoomPan,w=k?b.ddtDescensionZoomOnly:b.ddtDescensionZoomPan;g=z=>f(m,z,n)+b.tPanion(m,z,n)+h(m,z,n);k=z=>d(m,z,n)+b.dtPanion(m,z,n)+v(m,z,n);const t=z=>e(m,z,n)+b.ddtPanion(m,
z,n)+w(m,z,n);let x=g(r);const B=b.tBaseLine(m),q=l.maximumIterations||20,u=null!=l.maximumDistance?l.maximumDistance:Infinity;for(l=0;l<q;l++){var C=(k(r)+1E-6)/t(r);if(isNaN(C)||r>=u&&0>C){if(!isFinite(u))return null;r=u;x=g(r);break}r-=C;if(r<m.compared.sourceZoom||r<m.compared.targetZoom)return null;C=g(r);if(.005>=Math.abs(C-x)/x)break;x=C}return x>.7*B||r<m.compared.sourceZoom||r<m.compared.targetZoom?null:r};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/animation/pointToPoint/apex/functions":function(){define(["exports"],function(a){a.ddtAscensionZoomOnly=function(b,c){return-b.halfWindowSize/(c*c*b.desiredPixelFlow*Math.LN2)};a.ddtAscensionZoomPan=function(b,c,m){const l=c-b.compared.sourceZoom,r=1/l,n=1/c,g=Math.log(b.compared.sourceZoom*n);m=(m.ascensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(l))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*r*(-2*r*n*m+2*r*g+2*n-2*g*m/(l*l)-m/(c*c))/(b.desiredPixelFlow*Math.LN2)};
a.ddtDescensionZoomOnly=function(b,c){return-b.halfWindowSize/(c*c*b.desiredPixelFlow*Math.LN2)};a.ddtDescensionZoomPan=function(b,c,m){const l=c-b.compared.targetZoom,r=1/l,n=1/c,g=Math.log(c/b.compared.targetZoom);m=(b.halfWindowPanAtZoom(c)+m.descensionFactor*Math.LN2*b.compared.pan-b.halfWindowPanAtZoom(b.compared.targetZoom))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*r*(-2*r*n*m-2*r*g+2*n+2*g*m/(l*l)-m/(c*c))/(b.desiredPixelFlow*Math.LN2)};a.ddtPanion=function(b,c,m){return-2*b.compared.pan*
b.halfWindowSize*(m.ascensionFactor+m.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(c*c*c))};a.dtAscensionZoomOnly=function(b,c){return b.halfWindowSize/(c*b.desiredPixelFlow*Math.LN2)};a.dtAscensionZoomPan=function(b,c,m){const l=1/c,r=Math.log(b.compared.sourceZoom*l),n=1/b.desiredPixelFlow,g=1/Math.LN2;c-=b.compared.sourceZoom;const k=1/c;m=(m.ascensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(c))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*l*n*g*k*m-b.halfWindowSize*
r*n*g*k+b.halfWindowSize*r*n*g*m/(c*c)};a.dtDescensionZoomOnly=function(b,c){return b.halfWindowSize/(c*b.desiredPixelFlow*Math.LN2)};a.dtDescensionZoomPan=function(b,c,m){const l=Math.log(c/b.compared.targetZoom),r=1/b.desiredPixelFlow,n=1/Math.LN2,g=-c+b.compared.targetZoom,k=1/g;m=(-b.halfWindowPanAtZoom(c)-m.descensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(b.compared.targetZoom))/b.halfWindowPanAtZoom(1);return-b.halfWindowSize*l*r*n*k+b.halfWindowSize*l*r*n*m/(g*g)+b.halfWindowSize*
r*n*k*m/c};a.dtPanion=function(b,c,m){return b.compared.pan*b.halfWindowSize*(m.ascensionFactor+m.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(c*c))};a.tAscensionZoomOnly=function(b,c){return-b.halfWindowSize*Math.log(b.compared.sourceZoom/c)/(b.desiredPixelFlow*Math.LN2)};a.tAscensionZoomPan=function(b,c,m){const l=b.halfWindowPanAtZoom(c-b.compared.sourceZoom);return-b.halfWindowSize*(m.ascensionFactor*Math.LN2*b.compared.pan+l)*Math.log(b.compared.sourceZoom/c)/(b.desiredPixelFlow*
Math.LN2*l)};a.tBaseLine=function(b){const c=Math.LN2*b.compared.pan,m=b.halfWindowPanAtZoom(b.compared.sourceZoom-b.compared.targetZoom),l=b.halfWindowSize*Math.log(b.compared.sourceZoom/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2*m);return b.compared.sourceZoom<=b.compared.targetZoom?l*(c-m):l*(c+m)};a.tDescensionZoomOnly=function(b,c){return b.halfWindowSize*Math.log(c/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2)};a.tDescensionZoomPan=function(b,c,m){return b.halfWindowSize*(-b.halfWindowPanAtZoom(c)-
m.descensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(b.compared.targetZoom))*Math.log(c/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2*b.halfWindowPanAtZoom(-c+b.compared.targetZoom))};a.tPanion=function(b,c,m){return-b.compared.pan*b.halfWindowSize*(m.ascensionFactor+m.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(c))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/AnimationController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/set ../../../../core/accessorSupport/decorators/subclass ../../../ViewAnimation ./CameraController".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h){a.AnimationController=function(v){function w(){return v.apply(this,arguments)||this}b._inheritsLoose(w,v);var t=w.prototype;t.onControllerStart=function(){this.state=h.State.Running;m.isSome(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())};t.updateStateFromViewAnimation=function(){!m.isSome(this.viewAnimation)||this.state!==h.State.Ready&&this.state!==h.State.Running||(this.viewAnimation.state===
e.State.FINISHED?this.finish():this.viewAnimation.state===e.State.STOPPED&&(this.state=h.State.Stopped))};t.onControllerEnd=function(){m.isSome(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===h.State.Finished?this.viewAnimation.finish():this.state===h.State.Stopped&&this.viewAnimation.stop());this._asyncResult&&(this.state===h.State.Finished?this._asyncResult.resolve():this._asyncResult.reject(l.createAbortError()))};t.finish=function(){this.finishController()};b._createClass(w,[{key:"canStop",
get:function(){return!0}},{key:"asyncResult",get:function(){return this._asyncResult},set:function(x){this._asyncResult&&(this._asyncResult.reject(l.createAbortError()),this._asyncResult=null);this.state===h.State.Finished||this.state===h.State.Stopped?this.state===h.State.Finished?x.resolve():x.reject(l.createAbortError()):this._asyncResult=x}}]);return w}(h.CameraController);a.AnimationController=c.__decorate([d.subclass("esri.views.3d.state.controllers.AnimationController")],a.AnimationController);
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/CameraController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,m,l,r,
n,g,k){a.State=void 0;(function(f){f.Ready="ready";f.Rejected="rejected";f.Running="running";f.Stopped="stopped";f.Finished="finished"})(a.State||(a.State={}));a.CameraController=function(f){function d(){var h=f.apply(this,arguments)||this;h.state=a.State.Ready;return h}b._inheritsLoose(d,f);var e=d.prototype;e.stopController=function(){return this.canStop?(this.state=a.State.Stopped,!0):!1};e.finishController=function(){this.state=a.State.Finished};b._createClass(d,[{key:"active",get:function(){return this.state===
a.State.Running}},{key:"isInteractive",get:function(){return!1}},{key:"canStop",get:function(){return!1}},{key:"steppingFinished",get:function(){return!1}}]);return d}(m);c.__decorate([l.property({readOnly:!0})],a.CameraController.prototype,"active",null);c.__decorate([l.property()],a.CameraController.prototype,"state",void 0);a.CameraController=c.__decorate([k.subclass("esri.views.3d.state.controllers.CameraController")],a.CameraController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/state/utils/navigationUtils":function(){define("exports ../../../../core/Cyclical ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/axisAngle ../../../../geometry/support/coordinateSystem ../../../../geometry/support/plane ../../../../chunks/sphere ../../../../geometry/support/vector ../../../../geometry/support/vectorStacks ../../support/geometryUtils/ray ../../support/geometryUtils/sphere ../../webgl-engine/lib/Camera".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u){function C(pa,Da,ra){ra=r.fromRotation(x.sm4d.get(),ra[3],e.axis(ra));m.isNone(ra)||(f.subtract(fa,pa.eye,Da),f.transformMat4(fa,fa,ra),pa.eye=f.add(fa,fa,Da),f.subtract(fa,pa.center,Da),f.transformMat4(fa,fa,ra),pa.center=f.add(fa,fa,Da),pa.up=f.transformMat4(fa,pa.up,ra))}function z(pa,Da){f.set(Da,0,0,0);for(const ra of pa)f.add(Da,Da,ra);f.scale(Da,Da,1/pa.length)}function A(pa,Da,ra,Ea){return Math.sin(pa/f.length(Da))*(ra+Ea.radius)}function p(pa,
Da,ra,Ea){ra=B.fromScreenAtEye(Da,ra,Ha);if(m.isNone(ra))return!1;w.closestPointOnSilhouette(pa,ra,Q);return w.intersectRay(pa,ra,Ea)?f.squaredDistance(Q,ra.origin)<f.squaredDistance(Ea,ra.origin)?(f.copy(Ea,Q),!1):!0:(f.subtract(S,Da.eye,Da.center),f.normalize(S,S),v.fromNormalAndOffset(S,-f.dot(f.normalize(S,S),Q),T),v.intersectRay(T,ra,Ea),!1)}function y(pa,Da,ra,Ea,Ia,Ma){f.cross(sa,pa,Da);f.subtract(ja,pa,Da);f.length(pa)<=Ia||!Ea.aboveGround?(f.cross(ra,ja,Ea.eye),pa=f.dot(pa,Da)/(f.length(pa)*
f.length(Da)),Ma=Math.cos(c.clamp(b.cyclicalPI.normalize(c.deg2rad(Ma)),0,I)),Da=-c.acosClamped(pa)-Math.max(0,f.length(Da)-Ia)/(Ma*Ia)):(f.subtract(U,Ea.eye,Ea.center),f.cross(ra,ja,U),Da=-f.length(ja)/Ia);f.normalize(ra,ra);f.scale(ra,ra,f.length(sa));return Da}function D(pa,Da,ra,Ea){Ea=Math.cos(c.clamp(b.cyclicalPI.normalize(c.deg2rad(Ea)),0,I));Da=Da>ra?-(Da-ra)/(Ea*ra):Da<-ra?Math.PI-(Da+ra)/(Ea*ra):c.acosClamped(Da/ra);return((pa>ra?-(pa-ra)/(Ea*ra):pa<-ra?Math.PI-(pa+ra)/(Ea*ra):c.acosClamped(pa/
ra))-Da)*ra}function E(pa,Da,ra,Ea,Ia,Ma,Qa,wa,Ja,Ta){Ja=D(pa[2],Da[2],Qa[3],Ja);Da=Ta?D(pa[0],Da[0],Qa[3],180):Da[0]-pa[0];pa=Math.sin(wa)*Da-Math.cos(wa)*Ja;wa=Math.cos(wa)*Da+Math.sin(wa)*Ja;f.normalize(fa,Ia);Ia=Ta?pa/Math.sqrt(Math.abs(Qa[3]**2-f.dot(ra,fa)**2)):pa/Qa[3];ra=wa/Math.sqrt(Math.abs(Qa[3]**2-f.dot(ra,Ea)**2));g.set(Ma,Ia,ra)}function F(pa,Da,ra,Ea,Ia,Ma,Qa,wa,Ja,Ta){f.cross(sa,pa,Da);h.coordinateSystemFromOneAxisAndNormalVector(Ma.up,Ma.eye,V,da,ca);h.coordinateSystemFromOneAxisAndNormalVector([0,
0,1],Ma.eye,aa,W,R);f.copy(ra,W);f.copy(Ea,aa);f.normalize(ra,ra);f.scale(ra,ra,f.length(sa));h.vectorCoordinates(pa,f.normalize(da,da),f.normalize(ca,ca),f.normalize(V,V),ha);h.vectorCoordinates(Da,da,ca,V,ia);E(ha,ia,pa,aa,W,Ia,Qa,wa,Ja,Ta)}function G(pa,Da,ra,Ea,Ia,Ma,Qa){r.fromRotation(Y,Ia,Ea);r.fromRotation(ea,Qa,Ma);r.multiply(ba,Y,ea);f.subtract(Da,pa,ra);f.transformMat4(Da,Da,ba);f.add(Da,Da,ra)}function P(pa,Da,ra,Ea,Ia,Ma){r.fromRotation(Y,Ea,ra);r.fromRotation(ea,Ma,Ia);r.multiply(ba,
Y,ea);f.subtract(fa,pa.eye,Da);f.transformMat4(fa,fa,ba);pa.eye=f.add(fa,fa,Da);f.subtract(fa,pa.center,Da);f.transformMat4(fa,fa,ba);pa.center=f.add(fa,fa,Da);f.subtract(fa,pa.up,Da);f.transformMat4(fa,fa,ba);pa.up=f.add(fa,fa,Da)}function K(pa,Da,ra,Ea,Ia,Ma,Qa=H.Pole,wa=H.Angle){pa=Math.abs(pa[2])<ra*Qa||Math.abs(Da)>ra;return(Math.abs(Ea)>Math.PI-wa||Math.abs(Ea)<wa)&&pa&&Ma.aboveGround&&Ia<H.Tilt?!0:!1}function N(pa,Da,ra,Ea,Ia,Ma){Ma?(e.fromPoints(ra,Ea,la),C(Da,pa,la)):(ra=y(ra,Ea,qa,Da,pa[3],
Ia),C(Da,pa,e.wrapAxisAngle(qa,ra)))}function M(pa,Da,ra,Ea,Ia,Ma,Qa){const wa=Qa?20:1;f.copy(Z,Ea);oa.copyFrom(Da);let Ja;for(let Ta=0;Ta<wa&&1E-12<f.squaredDistance(ra,Z);Ta++)if(Ea=f.squaredDistance(ra,Z),F(ra,Z,W,aa,ka,oa,pa,Ia,Ma,Qa),P(oa,pa,aa,ka[1],W,ka[0]),G(Z,Z,pa,aa,ka[1],W,ka[0]),Ja=f.squaredDistance(ra,Z),Ja<Ea||0===Ta)Da.copyFrom(oa);else break}a.SpherePickPointFallback=void 0;(function(pa){pa[pa.Ellipsoid=0]="Ellipsoid";pa[pa.Silhouette=1]="Silhouette"})(a.SpherePickPointFallback||(a.SpherePickPointFallback=
{}));const L=l.createScreenPointArray();a.NavigationMode=void 0;(function(pa){pa[pa.Vertical=0]="Vertical";pa[pa.Horizontal=1]="Horizontal"})(a.NavigationMode||(a.NavigationMode={}));const J={Elevation:3E4,Angle:c.deg2rad(6)},H={Pole:.95,Angle:c.deg2rad(18),Tilt:45},I=c.deg2rad(80),O=d.create(),Q=d.create(),S=d.create(),T=v.create(),U=d.create(),aa=d.create(),W=d.create(),R=d.create(),V=d.create(),da=d.create(),ca=d.create(),ha=d.create(),ia=d.create(),ka=k.create(),la=e.create(),Y=n.create(),ea=
n.create(),ba=n.create(),Z=d.create(),fa=d.create(),ja=d.create(),oa=new u.Camera,sa=d.create(),qa=d.create(),Ha={origin:d.create(),direction:d.create()},Ga={origin:d.create(),direction:d.create()};a.DISTANCE_CLAMP_VALUES=[1,3E8];a.PIVOT_DISTANCE_MODIFIER=30;a.PreservingHeadingThreshold=H;a.SCREEN_PIXEL_AREA=70;a.TiltThresholdPanningSpeed=I;a.VerticalPanTresholds=J;a.applyPanPlanar=function(pa,Da,ra){f.subtract(O,ra,Da);pa.eye=f.subtract(fa,pa.eye,O);pa.center=f.subtract(fa,pa.center,O)};a.applyPanSphericalDirectRotation=
N;a.applyPanSphericalPreserveHeading=M;a.applyRotation=C;a.applyRotationWithTwoAxes=P;a.applyZoomOnSphere=function(pa,Da,ra){Da.getScreenCenter(L);q.intersectScreen(pa,Da,L,fa)&&(Da.center=fa);pa=Da.distance;ra*=pa;1E-6>Math.abs(pa-ra)||(ra=f.scale(x.sv3d.get(),Da.viewForward,ra),Da.eye=f.subtract(fa,Da.center,ra))};a.applyZoomToPoint=function(pa,Da,ra,Ea){const Ia=x.sv3d.get();ra=1-ra;f.subtract(Ia,Da,pa.eye);const Ma=f.length(Ia);let Qa=Ma*(1-ra);0<=ra&&Qa<Ea&&(Qa=Ea,ra=-(Qa-Ma)/Ma);1E-6>Math.abs(Ma-
Qa)||(f.scale(Ia,Ia,ra),pa.eye=f.add(fa,pa.eye,Ia),pa.center=f.lerp(fa,pa.center,Da,ra))};a.centroid=z;a.centroidOnSphere=function(pa,Da,ra){z(Da,ra);f.normalize(ra,ra);f.scale(ra,ra,pa)};a.decideNavigationMode=function(pa,Da,ra,Ea){if(f.length(pa.eye)-Ea.radius>J.Elevation)return a.NavigationMode.Horizontal;if(!ra)return a.NavigationMode.Vertical;B.fromScreenAtEye(pa,Da,Ga);return-Math.sign(pa.relativeElevation)*(.5*Math.PI+t.angle(pa.eye,Ga.direction))<J.Angle?a.NavigationMode.Vertical:a.NavigationMode.Horizontal};
a.intersectPlaneFromScreenPoint=function(pa,Da,ra,Ea){return v.intersectRay(pa,B.fromScreen(Da,ra,Ha),Ea)};a.intersectPlaneFromScreenPointAtEye=function(pa,Da,ra,Ea){return v.intersectRay(pa,B.fromScreenAtEye(Da,ra,Ha),Ea)};a.lengthFromPoints=D;a.normalizeCoordinate=function(pa,Da,ra){ra[0]=Da[0]/(pa.fullWidth/pa.pixelRatio);ra[1]=Da[1]/(pa.fullHeight/pa.pixelRatio);return ra};a.normalizeRotationDelta=function(pa){for(;pa>Math.PI;)pa-=2*Math.PI;for(;pa<-Math.PI;)pa+=2*Math.PI;return pa};a.offSurfaceTiltToEyeTiltGlobal=
function(pa,Da,ra,Ea){return A(Math.PI/2,Da,ra,Ea)+(pa-Math.PI/2)};a.onSurfaceTiltToEyeTiltGlobal=A;a.panMotionToRotationMatrix=function(pa,Da,ra,Ea,Ia,Ma,Qa,wa,Ja){if(K(pa.center,f.dot(pa.up,pa.center),f.length(pa.center),-b.cyclicalPI.normalize(c.deg2rad(Ma)),Qa,Da))switch(pa=-b.cyclicalPI.normalize(c.deg2rad(Ia)),{eye:Ia}=Da,h.coordinateSystemFromOneAxisAndNormalVector([0,0,1],Ia,aa,W,R),Ia=ra.translation[0]*Ea.pan,Ma="zoom"===Ja.mode?0:ra.translation[1]*Ea.pan,Da=Math.max(Math.sqrt(Math.abs(1-
f.dot(Da.center,aa)**2/f.length(Da.center)**2)),.5),Qa=-Math.cos(pa)*Ma+Math.sin(pa)*Ia,r.rotate(wa.pan.matrix,wa.pan.matrix,(Math.sin(pa)*Ma+Math.cos(pa)*Ia)/Da,aa),wa.pan.enabled=!0,Ja.mode){case "pan":r.rotate(wa.pan.matrix,wa.pan.matrix,Qa,W);wa.pan.enabled=!0;break;case "zoom":wa.zoom=-ra.translation[1]*Ea.zoom}else{{const {eye:Ta,viewRight:Xa}=Da;Da=f.cross(x.sv3d.get(),Xa,Ta);pa=ra.translation[0]*Ea.pan;0!==pa&&(r.rotate(wa.pan.matrix,wa.pan.matrix,-pa,Da),wa.pan.enabled=!0);switch(Ja.mode){case "pan":ra=
ra.translation[1]*Ea.pan;0!==ra&&(r.rotate(wa.pan.matrix,wa.pan.matrix,ra,Xa),wa.pan.enabled=!0);break;case "zoom":wa.zoom=-ra.translation[1]*Ea.zoom}}}};a.panToPosition=function(pa,Da,ra,Ea,Ia,Ma,Qa){K(ra,f.dot(Da.up,ra),pa[3],-b.cyclicalPI.normalize(c.deg2rad(Ia)),Ma,Da,H.Pole,H.Angle)?M(pa,Da,ra,Ea,-b.cyclicalPI.normalize(c.deg2rad(Ia)),Ma,Qa):N(pa,Da,ra,Ea,Ma,Qa)};a.pickPointAndInitSphere=function(pa,Da,ra,Ea,Ia,Ma){const Qa=d.create(),wa=w.create();let Ja=!0,Ta=!0;pa.intersectScreen(ra,Qa,Ma)?
wa[3]=f.length(Qa):(Ta=!1,wa[3]=Da.aboveGround&&Ia!==a.SpherePickPointFallback.Ellipsoid?Math.max(f.length(Da.center),.9*Ea.radius):f.length(Da.eye)-Da.relativeElevation,Ia===a.SpherePickPointFallback.Silhouette?p(wa,Da,ra,Qa):Ja=q.intersectScreen(wa,Da,ra,Qa));return{sphere:wa,scenePickPoint:Ja?Qa:null,hasGeometryIntersection:Ta}};a.preserveHeadingThreshold=K;a.rotatePointAroundTwoAxes=G;a.rotationAngleAndAxisDirectRotation=y;a.rotationAnglesAndAxesHeadingPreserving=F;a.rotationAnglesHeadingPreserving=
E;a.rotationFromPointsAroundAxis=function(pa,Da,ra){const Ea=x.sv3d.get(),Ia=x.sv3d.get(),Ma=x.sv3d.get();f.copy(Ia,pa);f.copy(Ma,Da);pa=f.dot(Ia,ra);Da=f.dot(Ma,ra);f.scale(Ea,ra,pa);f.subtract(Ia,Ia,Ea);f.normalize(Ia,Ia);f.scale(Ea,ra,Da);f.subtract(Ma,Ma,Ea);f.normalize(Ma,Ma);pa=f.dot(Ia,Ma);f.cross(Ea,ra,Ia);ra=f.dot(Ma,Ea);return Math.atan2(ra,pa)};a.sphereOrPlanePointFromScreenPoint=p;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/geometryUtils/ray":function(){define("exports ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../geometry/support/vectorStacks".split(" "),
function(a,b,c,m,l,r){function n(k,f,d){const e=c.castRenderScreenPointArray3(m.copy(r.sv3d.get(),f));e[2]=0;if(!k.unprojectFromRenderScreen(e,d.origin))return null;f=c.castRenderScreenPointArray3(m.copy(r.sv3d.get(),f));f[2]=1;k=k.unprojectFromRenderScreen(f,r.sv3d.get());if(b.isNone(k))return null;l.subtract(d.direction,k,d.origin);return d}function g(k,f,d){l.copy(d.origin,k.eye);f=l.set(r.sv3d.get(),f[0],f[1],1);k=k.unprojectFromRenderScreen(f,r.sv3d.get());if(b.isNone(k))return null;l.subtract(d.direction,
k,d.origin);return d}a.fromRender=n;a.fromRenderAtEye=g;a.fromScreen=function(k,f,d){return n(k,k.screenToRender(f,c.castRenderScreenPointArray3(r.sv3d.get())),d)};a.fromScreenAtEye=function(k,f,d){return g(k,k.screenToRender(f,c.castRenderScreenPointArray3(r.sv3d.get())),d)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/geometryUtils/sphere":function(){define(["exports","../../../../geometry/support/ray","../../../../chunks/sphere",
"./ray"],function(a,b,c,m){const l=b.create();a.intersectScreen=function(r,n,g,k){n=m.fromScreenAtEye(n,g,l);return c.intersectRay(r,n,k)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/time ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/set ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../PointToPointAnimationController ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../webgl-engine/lib/verticalOffsetUtils ../../../../animation/easing".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q){a.ZoomStepController=function(p){function y(){var E=p.apply(this,arguments)||this;E.zoomLocation=e.create();E.tmpCamera=new t.Camera;E.tmpRayDir=e.create();E.tmpCenter=e.create();E.constraintOptions={selection:v.ConstraintTypes.ALL,interactionType:v.InteractionType.ZOOM,interactionFactor:null,interactionStartCamera:new t.Camera,interactionDirection:null,tiltMode:v.TiltMode.TUMBLE};return E}b._inheritsLoose(y,p);var D=y.prototype;D.zoomStep=function(E,
F){if(this.active){var G=this.view.state,{interactionStartCamera:P}=this.constraintOptions;this.animation.finished?P.copyFrom(G.camera):this.animation.cameraAt(1,P);this.tmpCamera.copyFrom(G.camera);G=x.newIntersector(this.view.state.viewingMode);0<E?(0===this.view.map.ground.opacity?this.intersectionHelper.intersectScreenFreePointFallback(F,this.zoomLocation,A):this.intersectionHelper.intersectScreenFreePointFallback(F,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,G,
this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,G,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:d.copy(this.zoomLocation,this.tmpCamera.center);E=.6**E;F=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,F[0],F[1],this.view.state.camera,60);d.subtract(z,this.tmpCamera.eye,this.zoomLocation);d.normalize(z,z);G=Math.max(Math.min(14,1/Math.abs(d.dot(C,z)))*Math.abs(this.view.camera.position.z),200);if(F=
F?Math.min(F,G):G)G=e.create(),d.subtract(G,this.zoomLocation,this.tmpCamera.eye),F<d.length(G)&&(d.normalize(G,G),d.add(this.zoomLocation,this.tmpCamera.eye,d.scale(G,G,F)));this._updateCamera(this.tmpCamera,E,this.zoomLocation);this.begin(this.tmpCamera)}};D.animationSettings=function(){return{apex:null,duration:m.Milliseconds(600),easing:q.outExpo}};D._updateCamera=function(E,F,G){d.subtract(this.tmpRayDir,G,E.eye);const P=d.length(this.tmpRayDir);let K=P*F;const N=Math.max(4,1.01*E.nearFar[0]);
1>=F&&K<N&&(K=N,F=K/P);1E-6>Math.abs(P-K)||(d.scale(this.tmpRayDir,this.tmpRayDir,F),E.eye=d.subtract(u,G,this.tmpRayDir),E.center=d.lerp(u,E.center,G,1-F),h.applyAll(this.view,E,this.constraintOptions))};return y}(w.PointToPointAnimationController);a.ZoomStepController=c.__decorate([f.subclass("esri.views.3d.state.controllers.local.ZoomStepController")],a.ZoomStepController);const u=e.create(),C=e.fromValues(0,0,1),z=e.create(),A={exclude:new Set([B.TERRAIN_ID])};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/handlers/support":function(){define(["exports"],function(a){a.eventMatchesMousePointerAction=function(b,c){if("touch"===b.pointerType)return!1;switch(c){case "primary":return 0===b.button;case "secondary":return 2===b.button;case "tertiary":return 1===b.button}};a.eventMatchesPointerAction=function(b,c){switch(c){case "primary":return"touch"===b.pointerType||0===b.button;case "secondary":return"touch"!==b.pointerType&&2===b.button;case "tertiary":return"touch"!==
b.pointerType&&1===b.button}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/DragRotate":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/RotateController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(a,b,c,m,l,r){l=function(n){function g(k,f,d,e){var h=n.call(this,!0)||this;h.view=k;h.pointerAction=f;h.pivot=d;h.registerIncoming("drag",
e,v=>h._handleDrag(v));return h}b._inheritsLoose(g,n);g.prototype._handleDrag=function(k){const f=k.data;if(!(1<f.pointers.size)&&r.eventMatchesMousePointerAction(k.data,this.pointerAction)){var d=c.createScreenPointArray(f.center.x,f.center.y);switch(f.action){case "start":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=new m.RotateController({view:this.view,pivot:this.pivot});this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(d);
break;case "update":this.cameraController&&this.cameraController.update(d);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}k.stopPropagation()}};return g}(l.InputHandler);Object.defineProperty(a,"PivotPoint",{enumerable:!0,get:()=>m.PivotPoint});a.DragRotate=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/RotateController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../camera/constraintUtils ../../camera/constraintUtils/common ../Constraints ./InteractiveController ../utils/navigationUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z){a.PivotPoint=void 0;(function(p){p[p.CENTER=0]="CENTER";p[p.EYE=1]="EYE"})(a.PivotPoint||(a.PivotPoint={}));a.RotateController=function(p){function y(E){E=p.call(this,E)||this;E.view=null;E.pivot=a.PivotPoint.CENTER;E.lastPoint=v.create();E.tmpWorldUp=t.create();E.tmpViewDir=t.create();E.tmpRotCurPoint=v.create();E.tmpTransf=e.create();E.tmpAxis=t.create();E.tmpPivotPoint=t.create();E.pivotPos=t.create();E.constraintOptions={selection:q.ConstraintTypes.ALL,
interactionType:q.InteractionType.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:q.TiltMode.TUMBLE};return E}b._inheritsLoose(y,p);var D=y.prototype;D.initialize=function(){this.rotScale=this.pivot===a.PivotPoint.CENTER?3:1.5};D.begin=function(E){if(this.active){switch(this.pivot){case a.PivotPoint.EYE:w.copy(this.pivotPos,this.startCamera.eye);this.constraintOptions.interactionType=q.InteractionType.LOOK_AROUND;this.constraintOptions.tiltMode=q.TiltMode.LOOK_AROUND;
this.constraintOptions.selection=q.ConstraintTypes.NONE;break;case a.PivotPoint.CENTER:{const F=this.intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this.pivotPos);F||w.copy(this.pivotPos,this.startCamera.center);this._constrainPivotPoint(E,F);this.startCamera.center=this.pivotPos;this.constraintOptions.interactionType=q.InteractionType.TUMBLE;this.constraintOptions.tiltMode=q.TiltMode.TUMBLE;this.constraintOptions.selection=q.ConstraintTypes.ALL&~q.ConstraintTypes.DISTANCE}}this.constraintOptions.interactionStartCamera=
this.startCamera;z.normalizeCoordinate(this.startCamera,E,this.lastPoint)}};D._constrainPivotPoint=function(E,F){const G=this.startCamera,P=t.create();w.subtract(P,this.pivotPos,G.eye);const K=w.length(P);let N=Math.min(K,7*Math.abs(this.view.camera.position.z));var M=x.getReferenceEllipsoid(this.view.spatialReference),L=l.createScreenPointArray(G.width/G.pixelRatio*.5,G.height/G.pixelRatio*.5);M=z.decideNavigationMode(this.startCamera,L,!0,M);L=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,
G.fullWidth/G.pixelRatio*.5,G.fullHeight/G.pixelRatio*.5,G,225,90);E=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,E[0],E[1],G,90);if(void 0!==L||void 0!==E)L=void 0===L?E:L,E=void 0===E||M===z.NavigationMode.Horizontal?L:E,N=L>E?E:L,N=F?Math.min(N,K):N;w.normalize(P,P);w.copy(this.pivotPos,w.add(this.tmpPivotPoint,G.eye,w.scale(this.tmpPivotPoint,P,N)))};D.update=function(E){if(this.active){switch(this.pivot){case a.PivotPoint.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,
E,this.currentCamera.center,this.pivotPos);break;case a.PivotPoint.CENTER:this.currentCamera.center=this.pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,E,this.currentCamera.eye,this.pivotPos)}B.applyAll(this.view,this.currentCamera,this.constraintOptions)}};D.end=function(){this.active&&this.finishController()};D._applyRotation=function(E,F,G,P){this.view.renderCoordsHelper.worldUpAtPosition(P,this.tmpWorldUp);z.normalizeCoordinate(E,F,this.tmpRotCurPoint);F=(this.lastPoint[1]-
this.tmpRotCurPoint[1])*this.rotScale;let K=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;w.subtract(this.tmpViewDir,G,P);G=w.length(this.tmpViewDir);G=m.acosClamped(w.dot(this.tmpViewDir,this.tmpWorldUp)/G);if(this.pivot===a.PivotPoint.EYE){const N=.5*Math.PI-G,M=.495*Math.PI;F=N-Math.max(-M,Math.min(M,N+-.5*F))}F=m.clamp(F+G,u.TiltDefault.min,u.TiltDefault.max)-G;w.cross(this.tmpAxis,E.up,this.tmpViewDir);this.pivot===a.PivotPoint.CENTER&&(K=-K);d.fromRotation(this.tmpTransf,K,this.tmpWorldUp);
d.rotate(this.tmpTransf,this.tmpTransf,F,this.tmpAxis);w.transformMat4(this.tmpViewDir,this.tmpViewDir,this.tmpTransf);E.up=w.transformMat4(A,E.up,this.tmpTransf);w.add(A,P,this.tmpViewDir);h.copy(this.lastPoint,this.tmpRotCurPoint);return A};b._createClass(y,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return y}(C.InteractiveController);c.__decorate([r.property({constructOnly:!0})],a.RotateController.prototype,"view",void 0);c.__decorate([r.property()],a.RotateController.prototype,
"pivot",void 0);a.RotateController=c.__decorate([f.subclass("esri.views.3d.state.controllers.RotateController")],a.RotateController);const A=t.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/InteractiveController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/set ../../../../core/accessorSupport/decorators/subclass ./CameraController ../../webgl-engine/lib/Camera".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){a.InteractiveController=function(e){function h(){var w=e.apply(this,arguments)||this;w.startCamera=new d.Camera;w.currentCamera=new d.Camera;return w}b._inheritsLoose(h,e);var v=h.prototype;v.stepController=function(w,t){t.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(t)};v.onControllerStart=function(w){this.state=f.State.Running;this.startCamera.copyFrom(w);this.currentCamera.copyFrom(w)};v.onControllerEnd=function(w){w.copyViewFrom(this.currentCamera)};
b._createClass(h,[{key:"isInteractive",get:function(){return!0}}]);return h}(f.CameraController);a.InteractiveController=c.__decorate([k.subclass("esri.views.3d.state.controllers.InteractiveController")],a.InteractiveController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/DragZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(a,b,c,m,l,r,n){r=function(g){function k(f,d,e){var h=g.call(this,!0)||this;h.view=f;h.pointerAction=d;h.registerIncoming("drag",e,v=>h._handleDrag(v));return h}b._inheritsLoose(k,g);k.prototype._handleDrag=function(f){const d=f.data;if(!(1<d.pointers.size)&&n.eventMatchesMousePointerAction(f.data,this.pointerAction)){var e=c.createScreenPointArray(d.center.x,d.center.y);switch(d.action){case "start":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=
this.view.state.isGlobal?new m.ZoomController({view:this.view}):new l.ZoomController({view:this.view});this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(e);break;case "update":this.cameraController&&this.cameraController.update(e);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}f.stopPropagation()}};return k}(r.InputHandler);a.DragZoom=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/state/controllers/global/ZoomController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/projectionEllipsoid ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils/ray ../../../webgl-engine/lib/verticalOffsetUtils ../../../camera/constraintUtils/surfaceCollision".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p){a.ZoomController=function(E){function F(P){P=E.call(this,P)||this;P.view=null;P.pickPoint=v.create();P.tmpP0=e.create();P.panAxisAngle=t.create();P.tmpRayDir=v.create();P.tmpRayDirPick=v.create();P.targetOnSphere=v.create();P.tmpRay={origin:v.create(),direction:v.create()};P.dragBeginPoint=l.createScreenPointArray();P.normalizedAnchorPoint=e.create();P.constraintOptions={selection:q.ConstraintTypes.ALL_EXCEPT_COLLISION,interactionType:q.InteractionType.ZOOM,
interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:q.TiltMode.TUMBLE};P.sphere=x.create();P.hasPickPoint=!1;return P}b._inheritsLoose(F,E);var G=F.prototype;G.begin=function(P){if(this.active){d.copy(this.dragBeginPoint,P);C.normalizeCoordinate(this.startCamera,P,this.normalizedAnchorPoint);var K=w.getReferenceEllipsoid(this.view.spatialReference),N=C.pickPointAndInitSphere(this.intersectionHelper,this.startCamera,P,K,C.SpherePickPointFallback.Ellipsoid,0===this.view.map.ground.opacity?
D:{});this.navMode=C.decideNavigationMode(this.startCamera,P,N.hasGeometryIntersection,K);if(this.navMode===C.NavigationMode.Horizontal)this.hasPickPoint=!!N.scenePickPoint,this.pickPoint=N.scenePickPoint,this.sphere=N.sphere;else{z.fromScreenAtEye(this.startCamera,P,this.tmpRay);h.normalize(this.tmpRay.direction,this.tmpRay.direction);let M,L;N.scenePickPoint&&(h.subtract(this.tmpRayDirPick,this.startCamera.eye,N.scenePickPoint),L=h.length(this.tmpRayDirPick));this.view.camera.position.hasZ&&(M=
Math.abs(this.view.camera.position.z));K=m.clamp(C.PIVOT_DISTANCE_MODIFIER*M,C.DISTANCE_CLAMP_VALUES[0],C.DISTANCE_CLAMP_VALUES[1]);K=(P=this.view._stage.renderView.getMinimalDepthForArea(null,P[0],P[1],this.view.state.camera,C.SCREEN_PIXEL_AREA))?Math.min(K,P):K;K=N.scenePickPoint?Math.min(K,L):K;this.hasPickPoint=!0;h.scale(this.tmpRay.direction,this.tmpRay.direction,K);h.add(this.pickPoint,this.tmpRay.origin,this.tmpRay.direction)}this.constraintOptions.interactionStartCamera=this.startCamera}};
G.update=function(P){if(this.active){this.currentCamera.eye=this.startCamera.eye;this.currentCamera.center=this.startCamera.center;this.currentCamera.up=this.startCamera.up;if(this.navMode===C.NavigationMode.Horizontal){h.subtract(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);var K=h.length(this.tmpRayDir);C.normalizeCoordinate(this.currentCamera,P,this.tmpP0);var N=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]),M=K*2**N;const L=this.view.state.constraints.minimumPoiDistance;
0>N&&M<L&&(M=L);if(1E-6>Math.abs(K-M))return;this.hasPickPoint&&M<K&&(N=1-(1-M/K)*(1-this.sphere[3]/h.length(this.currentCamera.center)),this.currentCamera.center=h.scale(y,this.currentCamera.center,N));h.scale(this.tmpRayDir,this.tmpRayDir,-M/K);this.currentCamera.eye=h.add(y,this.currentCamera.center,this.tmpRayDir);this.constraintOptions.interactionFactor=B.pixelDistanceToInteractionFactor(this.dragBeginPoint,P);B.applyAll(this.view,this.currentCamera,this.constraintOptions);this.hasPickPoint&&
(C.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),t.fromPoints(this.pickPoint,this.targetOnSphere,this.panAxisAngle),C.applyRotation(this.currentCamera,this.sphere,this.panAxisAngle))}else{K=h.length(this.tmpRay.direction);C.normalizeCoordinate(this.currentCamera,P,this.tmpP0);P=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);M=K*2**P;N=this.view.state.constraints.minimumPoiDistance;0>P&&M<N&&(M=N);if(1E-6>Math.abs(K-M))return;h.scale(this.tmpRayDir,
this.tmpRay.direction,1-M/K);this.currentCamera.eye=h.add(y,this.currentCamera.eye,this.tmpRayDir);this.currentCamera.center=h.add(y,this.currentCamera.center,this.tmpRayDir)}p.applySurfaceCollisionConstraint(this.view,this.currentCamera)}};G.end=function(){this.active&&this.finishController()};b._createClass(F,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return F}(u.InteractiveController);c.__decorate([r.property({constructOnly:!0})],a.ZoomController.prototype,
"view",void 0);a.ZoomController=c.__decorate([f.subclass("esri.views.3d.state.controllers.global.ZoomController")],a.ZoomController);const y=v.create(),D={exclude:new Set([A.TERRAIN_ID])};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/plane ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../InteractiveController ../../utils/navigationUtils ../../../webgl-engine/lib/verticalOffsetUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u){a.ZoomController=function(A){function p(D){D=A.call(this,D)||this;D.view=null;D.tmpP=v.create();D.tmpDir=v.create();D.tmpN=v.create();D.tmpP0=e.create();D.tmpPoi=v.create();D.tmpRayDir=v.create();D.dragBeginPoint=l.createScreenPointArray();D.normalizedAnchorPoint=e.create();D.constraintOptions={selection:x.ConstraintTypes.ALL,interactionType:x.InteractionType.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:v.create(),tiltMode:x.TiltMode.TUMBLE};
D.plane=w.create();return D}b._inheritsLoose(p,A);var y=p.prototype;y.begin=function(D){if(this.active){d.copy(this.dragBeginPoint,D);q.normalizeCoordinate(this.startCamera,D,this.normalizedAnchorPoint);var E=this.intersectionHelper.intersectScreenFreePointFallback(D,this.tmpP,0===this.view.map.ground.opacity?z:{});h.subtract(this.tmpDir,this.tmpP,this.startCamera.eye);var F=h.length(this.tmpDir);h.normalize(this.tmpDir,this.tmpDir);var G;this.view.camera.position.hasZ&&(G=Math.abs(this.view.camera.position.z));
G=m.clamp(q.PIVOT_DISTANCE_MODIFIER*G,q.DISTANCE_CLAMP_VALUES[0],q.DISTANCE_CLAMP_VALUES[1]);G=(D=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,D[0],D[1],this.view.state.camera,q.SCREEN_PIXEL_AREA))?Math.min(G,D):G;G=E?Math.min(G,F):G;h.scale(this.tmpDir,this.tmpDir,G);h.add(this.tmpP,this.startCamera.eye,this.tmpDir);h.subtract(this.tmpN,this.startCamera.eye,this.startCamera.center);h.normalize(this.tmpN,this.tmpN);0>this.tmpN[1]&&h.negate(this.tmpN,this.tmpN);w.fromPositionAndNormal(this.tmpP,
this.tmpN,this.plane);this.constraintOptions.interactionStartCamera=this.startCamera}};y.update=function(D){if(this.active){q.intersectPlaneFromScreenPoint(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||h.copy(this.tmpPoi,this.currentCamera.center);q.normalizeCoordinate(this.currentCamera,D,this.tmpP0);var E=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);d.copy(this.normalizedAnchorPoint,this.tmpP0);h.subtract(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);var F=h.length(this.tmpRayDir),
G=F*(1-E);h.copy(this.constraintOptions.interactionDirection,this.tmpRayDir);h.scale(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,Math.sign(E)/F);var P=this.view.state.constraints.minimumPoiDistance;0<=E&&G<P&&(G=P,E=-(G-F)/F);1E-6>Math.abs(F-G)||(h.scale(this.tmpRayDir,this.tmpRayDir,E),this.currentCamera.eye=h.add(C,this.currentCamera.eye,this.tmpRayDir),h.lerp(C,this.currentCamera.center,this.tmpPoi,E),C[2]=this.tmpPoi[2]>this.startCamera.center[2]?Math.max(this.startCamera.center[2],
C[2]):Math.min(this.startCamera.center[2],C[2]),this.currentCamera.center=C,this.constraintOptions.interactionFactor=t.pixelDistanceToInteractionFactor(this.dragBeginPoint,D),t.applyAll(this.view,this.currentCamera,this.constraintOptions))}};y.end=function(){this.active&&this.finishController()};b._createClass(p,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return p}(B.InteractiveController);c.__decorate([r.property({constructOnly:!0})],a.ZoomController.prototype,
"view",void 0);a.ZoomController=c.__decorate([f.subclass("esri.views.3d.state.controllers.local.ZoomController")],a.ZoomController);const C=v.create(),z={exclude:new Set([u.TERRAIN_ID])};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Handles ../../../../core/reactiveUtils ../../state/controllers/GamepadKeyboardController ../../../input/InputHandler".split(" "),
function(a,b,c,m,l,r){r=function(n){function g(f){var d=n.call(this,!0)||this;d.view=f;d.watchHandles=new c;d.handle=d.registerIncoming("gamepad",e=>d._handleEventGamepad(e));d.handle.pause();return d}b._inheritsLoose(g,n);var k=g.prototype;k.onInstall=function(f){n.prototype.onInstall.call(this,f);this.watchHandles.add([m.watch(()=>this.view.navigation.gamepad.enabled,d=>{d?this.handle.resume():(this.handle.pause(),this.cameraControllerGamepad&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=
null))},m.initial),m.watch(()=>this.view.navigation.gamepad.device,d=>{this.cameraControllerGamepad&&d&&this.cameraControllerGamepad.gamepadDevice!==d&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null)})])};k.onUninstall=function(){this.watchHandles.removeAll();n.prototype.onUninstall.call(this)};k._handleEventGamepad=function(f){var d=this.view.navigation.gamepad.device;if(!d||f.data.device===d)if((d=this.cameraControllerGamepad&&this.cameraControllerGamepad.active)||
l.GamepadKeyboardController.activatesFor(this.view,f.data))d||(d=new l.GamepadKeyboardController({view:this.view,gamepadDevice:f.data.device}),this.view.state.switchCameraController(d)&&(this.cameraControllerGamepad=d)),this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===f.data.device&&this.cameraControllerGamepad.handleEventGamepad(f.data)};return g}(r.InputHandler);a.GamepadNavigation=r;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/GamepadKeyboardController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../../../geometry/support/ray ../../../../chunks/sphere ../../../../geometry/support/vectorStacks ../../camera/constraintUtils ../../camera/constraintUtils/common ../Constraints ./InteractiveController ../utils/navigationUtils ../utils/viewUtils ../../support/cameraUtils ../../support/cameraUtilsInternal ../../webgl-engine/lib/Camera ../../../navigation/gamepadAndKeyboardUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G){a.GamepadKeyboardController=function(O){function Q(T){T=O.call(this,T)||this;T.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0};T.keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0];T.tmpCamera=new F.Camera;T.constraintOptions={selection:C.ConstraintTypes.ALL,interactionType:C.InteractionType.NONE,interactionStartCamera:new F.Camera,interactionFactor:0,interactionDirection:null,tiltMode:C.TiltMode.LOOK_AROUND};return T}b._inheritsLoose(Q,
O);var S=Q.prototype;S.handleEventGamepad=function(T){const U=G.extractTransformation(T,this.view.navigation.gamepad,this.transformation);("end"===T.action||G.isZeroTransformation(U))&&this.finishController()};S.activateDirection=function(T){this.keysButtonState[T]=1;G.extractTransformationKeyboard(this.keysButtonState,this.transformation)};S.deactivateDirection=function(T){this.keysButtonState[T]=0;T=G.extractTransformationKeyboard(this.keysButtonState,this.transformation);G.isZeroTransformation(T)&&
this.finishController()};S.onControllerStart=function(T){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z;this.headingStart=this.view.camera.heading;O.prototype.onControllerStart.call(this,T)};S._updateFilteredSurfaceElevation=function(T){this.filteredSurfaceElevation+=(this.view.pointsOfInterest.cameraOnSurface.location.z-this.filteredSurfaceElevation)*T};S.stepController=function(T,U){this._updateStartHeading();this._updateFilteredSurfaceElevation(T);this.currentCamera.copyViewFrom(U);
this._updateCameraCenter();this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera);this._calculateControlTransformation(T,this.currentCamera,L);this._applyDisabledMovementTypes(L);this._applyPan(L.pan);this._applyRotate(L.rotate);this._applyZoom(L.zoom);this._applyAscend(L.ascend);this.constraintOptions.interactionType=C.InteractionType.NONE;this.constraintOptions.selection=C.ConstraintTypes.COLLISION;u.applyAll(this.view,this.currentCamera,this.constraintOptions);O.prototype.stepController.call(this,
T,U)};S._updateStartHeading=function(){0!==this.transformation.heading&&(this.headingStart=this.view.camera.heading)};S._applyRotate=function(T){if(T.enabled){var U=this.currentCamera;v.subtract(J,U.center,U.eye);v.transformMat4(J,J,T.matrix);U.center=v.add(J,J,U.eye);U.up=v.transformMat4(J,U.up,T.matrix);this.constraintOptions.interactionType=C.InteractionType.LOOK_AROUND;this.constraintOptions.selection=C.ConstraintTypes.ALL_EXCEPT_COLLISION;u.applyAll(this.view,U,this.constraintOptions)}};S._applyPan=
function(T,U=this.currentCamera){T.enabled&&(U.eye=v.transformMat4(J,U.eye,T.matrix),U.center=v.transformMat4(J,U.center,T.matrix),this.view.state.isGlobal&&(U.up=v.transformMat4(J,U.up,T.matrix)),this.constraintOptions.interactionType=C.InteractionType.PAN,this.constraintOptions.selection=C.ConstraintTypes.ALL,u.applyAll(this.view,U,this.constraintOptions))};S._applyZoom=function(T){if(T){var U=this.currentCamera.viewForward;this.currentCamera.eye=v.add(J,this.currentCamera.eye,v.scale(q.sv3d.get(),
U,T));v.copy(H,U);v.negate(H,H);this.constraintOptions.interactionDirection=H;this.constraintOptions.interactionType=C.InteractionType.ZOOM;this.constraintOptions.selection=C.ConstraintTypes.ALL_EXCEPT_COLLISION;u.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};S._applyAscend=function(T){if(T){var U=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,q.sv3d.get());this.constraintOptions.interactionDirection=v.copy(H,
U);this.view.state.isGlobal?(U=v.length(this.currentCamera.eye),T=(U+T)/U,this.currentCamera.eye=v.scale(J,this.currentCamera.eye,T),this.currentCamera.center=v.scale(J,this.currentCamera.center,T)):(T=v.scale(q.sv3d.get(),U,T),this.currentCamera.eye=v.add(J,this.currentCamera.eye,T),this.currentCamera.center=v.add(J,this.currentCamera.center,T));this._updateCameraCenter();this.constraintOptions.interactionType=C.InteractionType.ASCEND;this.constraintOptions.selection=C.ConstraintTypes.COLLISION;
u.applyAll(this.view,this.currentCamera,this.constraintOptions)&&this._updateCameraCenter();this.constraintOptions.selection=C.ConstraintTypes.ALL_EXCEPT_COLLISION;u.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};S._calculateControlTransformation=function(T,U,aa){aa.zoom=0;aa.ascend=0;aa.pan.enabled=!1;e.identity(aa.pan.matrix);aa.rotate.enabled=!1;e.identity(aa.rotate.matrix);T=this._computeVelocities(T);this.view.state.isLocal?this._calculateControlTransformationLocal(T,
U,aa):this._calculateControlTransformationGlobal(T,U,aa)};S._updateCameraCenter=function(){this.currentCamera.center=this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(this.currentCamera.ray,this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,J)};S._calculateControlTransformationLocal=function(T,U,aa){const {viewRight:W,viewForward:R}=U,V=this.transformation;var da=this.view.navigation.gamepad,ca=v.set(q.sv3d.get(),R[0],R[1],0);v.normalize(ca,ca);var ha=V.translation[0]*
T.pan;0!==ha&&(ha=v.scale(q.sv3d.get(),W,ha),e.translate(aa.pan.matrix,aa.pan.matrix,ha),aa.pan.enabled=!0);switch(da.mode){case "pan":da=-V.translation[1]*T.pan;0!==da&&(ca=v.scale(q.sv3d.get(),ca,da),e.translate(aa.pan.matrix,aa.pan.matrix,ca),aa.pan.enabled=!0);aa.zoom=V.zoom*T.zoom;break;case "zoom":aa.zoom=(-V.translation[1]+V.zoom)*T.zoom;break;default:m.neverReached(da.mode)}aa.ascend=V.translation[2]*T.ascend;ca=-V.heading*T.rotate;0!==ca&&(e.rotate(aa.rotate.matrix,aa.rotate.matrix,ca,this.view.renderCoordsHelper.worldUpAtPosition(U.eye,
q.sv3d.get())),aa.rotate.enabled=!0);T=V.tilt*T.rotate;U=y.viewAngle(this.view.renderCoordsHelper,U.center,U.eye);if(U=l.clamp(U+T,z.TiltDefault.min,z.TiltDefault.max)-U)e.rotate(aa.rotate.matrix,aa.rotate.matrix,U,W),aa.rotate.enabled=!0};S._calculateControlTransformationGlobal=function(T,U,aa){const {eye:W,viewRight:R}=U,V=this.transformation;var da=this.view.navigation.gamepad,ca=v.cross(q.sv3d.get(),R,W);v.normalize(ca,ca);v.negate(ca,ca);p.panMotionToRotationMatrix(this.startCamera,U,V,T,this.view.camera.heading,
this.headingStart,this.view.camera.tilt,aa,da);this.tmpCamera.copyFrom(this.currentCamera);this._applyPan(L.pan,this.tmpCamera);da=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;aa.ascend=V.translation[2]*T.ascend;ca=-V.heading*T.rotate;0!==ca&&(e.rotate(aa.rotate.matrix,aa.rotate.matrix,ca,this.tmpCamera.eye),aa.rotate.enabled=!0);U=this._clampTiltDeltaGlobalToValidRange(V.tilt*T.rotate,U.ray,da);0!==U&&(e.rotate(aa.rotate.matrix,aa.rotate.matrix,U,this.tmpCamera.viewRight),
aa.rotate.enabled=!0);aa.zoom+=V.zoom*T.zoom};S._clampTiltDeltaGlobalToValidRange=function(T,U,aa){const W=t.getReferenceEllipsoid(this.view.spatialReference),R=p.onSurfaceTiltToEyeTiltGlobal(z.TiltDefault.min,U.origin,aa,W);var V=0;let da=0;V=q.sv3d.get();this.view.renderCoordsHelper.intersectManifold(U,aa,V)?(V=y.viewAngle(this.view.renderCoordsHelper,V,U.origin),V=p.onSurfaceTiltToEyeTiltGlobal(V,U.origin,aa,W),da=p.onSurfaceTiltToEyeTiltGlobal(z.TiltDefault.max,U.origin,aa,W)):(B.closestPointOnSilhouette(B.fromRadius(B.tmpSphere,
aa+W.radius),U,V),V=l.acosClamped(-v.dot(U.direction,v.normalize(V,V))),V=p.offSurfaceTiltToEyeTiltGlobal(V,U.origin,aa,W),da=p.offSurfaceTiltToEyeTiltGlobal(z.TiltDefault.max,U.origin,aa,W));return l.clamp(V+T,R,da)-V};S._getPointAbsoluteSurfaceElevation=function(T,U,aa){const {renderCoordsHelper:W}=this.view,R=W.getAltitude(T);U+=Math.abs(R-U);W.setAltitude(aa,U,T);return U};S._clampedDistanceToSurface=function(T,U){const {renderCoordsHelper:aa}=this.view,{camera:W}=this.view.state;var {direction:R}=
D.headingTiltToDirectionUp(this.view,U,0,80,I);R=aa.intersectManifoldClosestSilhouette(x.wrap(U,R),T,q.sv3d.get());R=v.distance(U,R);T=aa.intersectManifoldClosestSilhouette(x.wrap(U,v.direction(q.sv3d.get(),U,W.center)),T,q.sv3d.get());U=v.distance(U,T);return Math.min(R,U)};S._computeHeadingRotateRadius=function(T){const {renderCoordsHelper:U,state:aa}=this.view,{camera:W,isGlobal:R}=aa;var V=U.intersectManifoldClosestSilhouette(W.ray,this.filteredSurfaceElevation,q.sv3d.get());if(R){const da=v.subtract(q.sv3d.get(),
T,V);V=v.length(da);v.scale(da,da,1/V);T=v.normalize(q.sv3d.get(),T);T=l.acosClamped(v.dot(T,da));return V*Math.sin(Math.min(K,T))}T=v.copy(q.sv3d.get(),T);U.setAltitude(T,this.filteredSurfaceElevation);return v.distance(V,T)};S._minimumAscendVelocity=function(){return this.view.state.constraints.collision.enabled?0:5};S._computeVelocities=function(T){var U=this.filteredSurfaceElevation,aa=U+t.getReferenceEllipsoid(this.view.spatialReference).radius;const {camera:W,isGlobal:R}=this.view.state;var V=
q.sv3d.get();const da=this._getPointAbsoluteSurfaceElevation(W.eye,U,V);var ca=this._clampedDistanceToSurface(U,V);const ha=W.width/2,ia=.75*W.width,ka=.75*W.width;var la=ca*Math.tan(.5*W.fovX)/ha;aa=la/aa;V=la/this._computeHeadingRotateRadius(V);la=(R?aa:la)*ia*T;U=da-U;U=Math.max(this._minimumAscendVelocity()*T,2**(ia*T/ha)*U-U);ca=2**(ia*T/ha)*ca-ca;T*=l.clamp(V*ka,N,M);return{pan:la,ascend:U,zoom:ca,rotate:T}};S._applyDisabledMovementTypes=function(T){!r.isSome(this.disableMovements)||void 0!==
this.disableMovements.mode&&this.view.state.viewingMode!==this.disableMovements.mode||(T.zoom=this.disableMovements.zoom?0:T.zoom,T.ascend=this.disableMovements.ascend?0:T.ascend,T.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&e.identity(T.pan.matrix),T.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&e.identity(T.rotate.matrix))};Q.activatesFor=function(T,U){T=G.extractTransformation(U,T.navigation.gamepad,P);return!("end"===U.action||G.isZeroTransformation(T))};
return Q}(A.InteractiveController);c.__decorate([n.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"view",void 0);c.__decorate([n.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"gamepadDevice",void 0);c.__decorate([n.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"disableMovements",void 0);a.GamepadKeyboardController=c.__decorate([d.subclass("esri.views.3d.state.controllers.GamepadKeyboardController")],a.GamepadKeyboardController);const P=
{translation:[0,0,0],heading:0,tilt:0,zoom:0},K=l.deg2rad(80),N=l.deg2rad(30),M=l.deg2rad(80),L={zoom:0,ascend:0,pan:{enabled:!1,matrix:h.create()},rotate:{enabled:!1,matrix:h.create()}},J=w.create(),H=w.create(),I=E.createDirectionUp();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/cameraUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Camera ../../../core/Cyclical ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/promiseUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/Point ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/SpatialReference ../../../geometry/support/scaleUtils ../../ViewingMode ../camera/intersectionUtils ../../../chunks/cameraUtilsPlanar ../../../chunks/cameraUtilsSpherical ./earthUtils ./ElevationProvider ../../support/spatialReferenceSupport".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z){function A(ca){return"global"===ca.viewingMode?q.cameraUtilsSpherical:B.cameraUtilsPlanar}function p(ca,ha,ia){const ka=ca.state.camera,la=ka.width/2/ka.pixelRatio;ca.renderCoordsHelper.viewingMode===t.ViewingMode.Global&&null!=ia&&(ha*=Math.cos(r.deg2rad(ia)));ha/=ca.renderCoordsHelper.unitInMeters;return la/(96*39.37/ha)/Math.tan(ka.fovX/2)}function y(ca,ha,ia){const ka=ca.state.camera;ha=96*39.37/(ka.width/2/ka.pixelRatio/(ha*Math.tan(ka.fovX/
2)));ca.renderCoordsHelper.viewingMode===t.ViewingMode.Global&&(ha/=Math.cos(r.deg2rad(ia)));return ha*=ca.renderCoordsHelper.unitInMeters}function D(ca,ha,ia,ka,la,Y){if(O(Y)){const ea=new da(Y.signal);L(ca,ka.heading,ka.tilt,ha,ia,la,ea);ea.resolver.promise.then(ba=>{ba=I(ca,ba,ka.fov);if(n.isNone(ba))Y.resolver.reject();else return Y.resolver.resolve(ba)},ba=>Y.resolver.reject(ba))}else return ha=L(ca,ka.heading,ka.tilt,ha,ia,la),I(ca,ha,ka.fov,Y)}function E(ca,ha,ia,ka,la){return A(ca).directionToHeadingTilt(ha,
ia,ka,la)}function F(ca,ha){return!!(ca.basemapTerrain&&ca.renderCoordsHelper.fromRenderCoords(ha,aa,ca.spatialReference)&&n.unwrapOr(C.getElevationAtPoint(ca.elevationProvider,aa),0)>aa.z-1)}function G(ca,ha,ia){return P.apply(this,arguments)}function P(){P=b._asyncToGenerator(function*(ca,ha,ia){if(!ca.renderCoordsHelper.fromRenderCoords(ha,aa,ca.spatialReference))return!1;ca=yield ca.elevationProvider.queryElevation(aa.x,aa.y,aa.z,aa.spatialReference,"ground",ia);return n.unwrapOr(ca,0)>aa.z-1});
return P.apply(this,arguments)}function K(ca,ha,ia){return N.apply(this,arguments)}function N(){N=b._asyncToGenerator(function*(ca,ha,ia){const ka=f.create();ha?ha instanceof d?(e.projectPointToVector(ha,ka,ca.renderSpatialReference),null==ha.z&&null!=ca.basemapTerrain&&(ha=yield ca.elevationProvider.queryElevation(ha.x,ha.y,ha.z,ha.spatialReference,"ground",ia),n.isSome(ha)&&ca.renderCoordsHelper.setAltitude(ka,ha))):k.copy(ka,ha):k.copy(ka,ca.state.camera.center);return ka});return N.apply(this,
arguments)}function M(ca,ha){const ia=f.create();ha&&ha instanceof d?(e.projectPointToVector(ha,ia,ca.renderSpatialReference),null==ha.z&&null!=ca.basemapTerrain&&(ha=C.getElevationAtPoint(ca.elevationProvider,ha),n.isSome(ha)&&ca.renderCoordsHelper.setAltitude(ia,ha))):ha?k.copy(ia,ha):k.copy(ia,ca.state.camera.center);return ia}function L(ca,ha,ia,ka,la,Y,ea){const ba=ka&&ka instanceof d?ka:null;if(O(ea))return K(ca,ka,ea.signal).then(Z=>{J(ca,ha,ia,ba,Z,la,Y,ea)},Z=>ea.resolver.reject(Z)),null;
ka=M(ca,ka);return J(ca,ha,ia,ba,ka,la,Y,ea)}function J(ca,ha,ia,ka,la,Y,ea,ba){if(n.isNone(ka)&&(ka=e.projectVectorToPoint(la,ca.renderSpatialReference,ca.spatialReference||v.WGS84),n.isNone(ka)))return null;Y=Math.max(Y,ca.state.constraints.minimumPoiDistance);var Z=H(ca,ha,ia,la,Y,ea);const fa=A(ca).eyeForCenterWithHeadingTilt,ja=fa(la,Y,Z.heading,Z.tilt);if(ea===a.OrientationMode.ADJUST&&"global"===ca.viewingMode&&0<ia){const oa=()=>{var sa=Y,qa=Y;var Ha=ca.state.constraints.tilt(qa);qa=A(ca).eyeTiltToLookAtTilt(ia,
la,qa);qa=Math.min(qa,.5*Math.PI);Ha=Ha.min*(1-.7)+.7*qa;sa=A(ca).lookAtTiltToEyeTilt(Ha,la,sa);ea=1>ia-sa?a.OrientationMode.LOCKED:a.OrientationMode.ADJUST;return J(ca,ha,sa,ka,la,Y,ea,ba)};Z=ca.map.ground.navigationConstraint;if(!Z||"stay-above"===Z.type){if(F(ca,ja.eye))return oa();if(O(ba))return G(ca,ja.eye,ba.signal).then(sa=>{if(sa)return oa();ba.resolver.resolve({eye:ja.eye,up:ja.up,center:f.clone(la),heading:ja.heading,tilt:ja.tilt});return null}),null}}Z=!ba||O(ba)?{center:f.create(),eye:f.create(),
up:f.create(),tilt:0,heading:0}:ba;Z.eye=ja.eye;Z.up=ja.up;Z.center=f.clone(la);Z.heading=ja.heading;Z.tilt=ja.tilt;O(ba)&&ba.resolver.resolve(Z);return Z}function H(ca,ha,ia,ka,la,Y){var ea=0;if(Y=Y===a.OrientationMode.ADJUST)if(ea=ca.pointsOfInterest.centerOnSurfaceFrequent.distance,8<Math.log(la/ea)/Math.LN2)Y=!0;else{var ba=ca.renderSpatialReference,Z=ca.spatialReference||v.WGS84;Y=e.projectVectorToPoint(ka,ba,Z);ba=e.projectVectorToPoint(ca.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,
ba,Z);n.isNone(Y)||n.isNone(ba)?Y=!1:(ea*=Math.tan(.5*ca.state.camera.fov),Y=5<ba.distance(Y)/ea)}Y?(ha=0,Y=ca.state.constraints.tilt(la),Y.max=Math.min(Y.max,.5*Math.PI),Y=Y.min*(1-.7)+.7*Y.max,ia=A(ca).eyeTiltToLookAtTilt(ia,ka,la),ea=Math.min(ia,Y)):ea=A(ca).eyeTiltToLookAtTilt(ia,ka,la);ia=ea=ca.state.constraints.clampTilt(la,ea);ia=A(ca).lookAtTiltToEyeTilt(ia,ka,la);return{heading:ha,tilt:ia}}function I(ca,ha,ia,ka){if(n.isNone(ha))return null;ca=e.projectVectorToPoint(ha.eye,ca.renderSpatialReference,
ca.spatialReference||v.WGS84);return n.isNone(ca)?null:n.isSome(ka)?(ka.position=ca,ka.heading=ha.heading,ka.tilt=ha.tilt,ka.fov=ia,ka):new c(ca,ha.heading,ha.tilt,ia)}function O(ca){return ca&&"resolver"in ca}const Q=l.getLogger("esri.views.3d.support.cameraUtils"),S=f.create(),T=f.create(),U={heading:0,tilt:0},aa=new d,W=new m.Cyclical(-2.0037508342788905E7,2.0037508342788905E7),R=new m.Cyclical(-180,180);a.OrientationMode=void 0;(function(ca){ca[ca.LOCKED=0]="LOCKED";ca[ca.ADJUST=1]="ADJUST"})(a.OrientationMode||
(a.OrientationMode={}));const V=f.create();let da=function(ca){this.signal=ca;this.resolver=g.createResolver()};a.AsyncContext=da;a.computeScale=function(ca,ha,ia){const ka=ca.renderSpatialReference;ha||(ha=ca.state.camera);var la=v.WGS84;ha instanceof c?(la=ha.position.latitude,e.projectPointToVector(ha.position,S,ka),e.projectPointToVector(ia,T,ka),ha=k.distance(S,T)):(e.projectVectorToVector(ha.center,ka,T,la),la=T[1],ha=ha.distance);return y(ca,ha,la)};a.directionToHeadingTilt=E;a.distanceToScale=
y;a.externalToInternal=function(ca,ha){if(n.isNone(ha))return null;var ia=ca.renderSpatialReference;const ka=A(ca).headingTiltToDirectionUp,la=f.create();if(!e.projectPointToVector(ha.position,la,ia))return null;ia=ka(la,ha.heading,ha.tilt);k.scale(ia.direction,ia.direction,ca.state.camera.distance);k.add(ia.direction,ia.direction,la);ca=x.cameraOnContentAlongViewDirection(ca,la,ia.direction,ia.up);ca.fov=r.deg2rad(ha.fov);return ca};a.fromCenterDistance=D;a.fromCenterScale=function(ca,ha,ia,ka,la,
Y){ia=p(ca,ia,ha.latitude);return D(ca,ha,ia,ka,la,Y)};a.fromExtent=function(ca,ha,ia,ka,la,Y=null){var ea=null!=ha.zmax&&null!=ha.zmin;let ba;if(ca.state.isGlobal){if(!z.isSpatialReferenceSupported(ha.spatialReference,t.ViewingMode.Global))return O(Y)&&Y.resolver.reject(),null;var Z=new d(ha.xmin,ha.ymin,ha.spatialReference);const oa=new d(ha.xmax,ha.ymax,ha.spatialReference),sa=ha.spatialReference.isGeographic?R:W;var fa=new d({x:sa.center(Z.x,oa.x),y:(oa.y+Z.y)/2,z:ea?(ha.zmax+ha.zmin)/2:null,
spatialReference:ha.spatialReference});const qa=h.getReferenceEllipsoid(ha.spatialReference);var ja=u.getGreatCircleSpanAt(fa,Z,oa);ba=ja.lon;ja=ja.lat;sa.diff(Z.x,oa.x)>sa.range/2&&(ba+=qa.halfCircumference);ba=Math.min(ba,qa.halfCircumference);ja=Math.min(ja,qa.halfCircumference)}else fa=n.unwrapOr(ca.renderSpatialReference,ha.spatialReference),fa.equals(ha.spatialReference)||(ha=e.project(ha,fa)),ba=ha.xmax-ha.xmin,ja=ha.ymax-ha.ymin,fa=new d({x:ha.xmin+.5*ba,y:ha.ymin+.5*ja,z:ea?(ha.zmax+ha.zmin)/
2:null,spatialReference:fa});Z=ca.state.camera;ha=Math.max(1/Math.tan(Z.fovX/2)*ba*.5,1/Math.tan(Z.fovY/2)*ja*.5,1/Math.tan(Z.fov/2)*(ea?ha.zmax-ha.zmin:0)*.5)/1;if(O(Y))ea=new da(Y.signal),L(ca,ia,ka,fa,ha,la,ea),ea.resolver.promise.then(oa=>{oa=I(ca,oa,ca.camera.fov);if(n.isNone(oa))Y.resolver.reject();else return Y.resolver.resolve(oa)},oa=>Y.resolver.reject(oa));else return ia=L(ca,ia,ka,fa,ha,la),I(ca,ia,ca.camera.fov,Y)};a.getObserverForPointAtDistance=L;a.headingTiltToDirectionUp=function(ca,
ha,ia,ka,la){return A(ca).headingTiltToDirectionUp(ha,ia,ka,la)};a.internalToExternal=function(ca,ha,ia){const ka=ca.renderSpatialReference,la=E(ca,ha.eye,ha.viewForward,ha.up,U);ca=ca.spatialReference||v.WGS84;e.projectVectorToVector(ha.eye,ka,V,ca)||(ca=v.WGS84,e.projectVectorToVector(ha.eye,ka,V,ca));if(n.isNone(ia))return new c(new d(V,ca),la.heading,la.tilt,r.rad2deg(ha.fov));ia.position.x=V[0];ia.position.y=V[1];ia.position.z=V[2];ia.position.spatialReference=ca;ia.heading=la.heading;ia.tilt=
la.tilt;ia.fov=r.rad2deg(ha.fov);return ia};a.observerToCamera=I;a.scaleToDistance=p;a.scaleToResolution=function(ca,ha){return ca.spatialReference?w.getResolutionForScale(ha,ca.spatialReference):void 0};a.scaleToZoom=function(ca,ha){var ia;if(ca=null==(ia=ca.basemapTerrain)?void 0:ia.tilingScheme)return ca.levelAtScale(ha);Q.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")};a.toExtent=function(ca,ha,ia){const ka=e.projectVectorToPoint(ia,ca.renderSpatialReference,
ca.spatialReference||v.WGS84);if(n.isNone(ka))return null;var la=Math.tan(ha.fovX/2),Y=Math.tan(ha.fovY/2);ha=k.dist(ha.eye,ia);la*=2*ha;Y*=2*ha;return"global"===ca.viewingMode?q.toExtent(ca,ka,la,Y):B.toExtent(ca,ka,la,Y)};a.zoomToScale=function(ca,ha){var ia;if(ca=null==(ia=ca.basemapTerrain)?void 0:ia.tilingScheme)return ca.scaleAtLevel(ha);Q.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/chunks/cameraUtilsPlanar":function(){define("exports ../core/mathUtils ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/Extent ../geometry/projection ../views/3d/support/cameraUtilsInternal".split(" "),function(a,b,c,m,l,r,n,g,k){function f(C,z,A,p=k.createDirectionUp()){const {direction:y,up:D}=p;c.fromZRotation(B,-b.deg2rad(z));c.rotateX(B,B,b.deg2rad(A));l.transformMat4(y,x,B);l.scale(y,y,-1);l.transformMat4(D,t,B);return p}function d(C,z,A,p){return k.directionToHeadingTilt(z,A,p,x,t)}function e(C,
z,A,p){const y=f(C,A,p),D=r.create();l.scale(D,y.direction,-z);l.add(D,D,C);return{up:y.up,eye:D,heading:A,tilt:p}}function h(C){return b.rad2deg(C)}function v(C){return b.deg2rad(C)}function w(C,z,A,p,y){const D=C.renderSpatialReference;C=C.map&&C.spatialReference||z.spatialReference;g.projectPointToVector(z,q,D);g.projectPointToVector(z,u,D);q[0]-=A/2;u[0]+=A/2;q[1]-=p/2;u[1]+=p/2;g.projectVectorToVector(q,D,q,C);g.projectVectorToVector(u,D,u,C);y?(y.xmin=q[0],y.ymin=q[1],y.xmax=u[0],y.ymax=u[1],
y.spatialReference=C):y=new n(q[0],q[1],u[0],u[1],C);return y}const t=r.fromValues(0,1,0),x=r.fromValues(0,0,1),B=m.create(),q=r.create(),u=r.create();m=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:f,directionToHeadingTilt:d,eyeForCenterWithHeadingTilt:e,lookAtTiltToEyeTilt:h,eyeTiltToLookAtTilt:v,toExtent:w},Symbol.toStringTag,{value:"Module"}));a.cameraUtilsPlanar=m;a.directionToHeadingTilt=d;a.eyeForCenterWithHeadingTilt=e;a.eyeTiltToLookAtTilt=v;a.headingTiltToDirectionUp=
f;a.lookAtTiltToEyeTilt=h;a.toExtent=w})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["exports","../../../core/mathUtils","../../../chunks/vec3","../../../chunks/vec3f64"],function(a,b,c,m){const l=m.create(),r=m.create();a.createDirectionUp=function(){return{direction:m.create(),up:m.create()}};a.directionToHeadingTilt=function(n,g,k,f,d){let e=c.normalize(l,n),h=c.dot(e,f);const v=0<h;h=Math.abs(h);.99<h&&(h=Math.abs(c.dot(g,f)),.99>h?(c.copy(e,g),v&&c.scale(e,e,-1)):e=null);
g=0;e&&(c.scale(r,f,c.dot(f,e)),c.subtract(e,e,r),g=c.dot(e,d)/(c.length(e)*c.length(d)),c.cross(r,e,d),g=(0<c.dot(r,f)?1:-1)*b.rad2deg(b.acosClamped(g)));n=b.rad2deg(b.acosClamped(-c.dot(f,n)/c.length(n)));if(!k)return{heading:g,tilt:n};k.heading=g;k.tilt=n;return k};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/cameraUtilsSpherical":function(){define("exports ../core/Cyclical ../core/mathUtils ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/Extent ../geometry/projectionEllipsoid ../geometry/SpatialReference ../geometry/support/webMercatorUtils ../views/3d/support/cameraUtilsInternal ../views/3d/support/earthUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h){function v(F,G,P,K=e.createDirectionUp()){r.cross(D,F,z);0===r.dot(D,D)&&r.cross(D,F,A);m.fromRotation(y,-c.deg2rad(G),F);m.rotate(y,y,-c.deg2rad(P),D);const {up:N,direction:M}=K;r.cross(N,D,F);r.normalize(N,N);r.transformMat4(N,N,y);r.normalize(M,F);r.negate(M,M);r.transformMat4(M,M,y);return K}function w(F,G,P,K){const N=D,M=E;r.normalize(N,F);r.cross(E,N,z);0===r.dot(E,E)&&r.cross(E,N,A);r.cross(M,E,N);return e.directionToHeadingTilt(G,P,K,N,M)}function t(F,
G,P,K){const N={eye:n.create(),up:null,tilt:K,heading:P},M=D;M[0]=F[0];M[1]=F[2];M[2]=-F[1];P=c.deg2rad(P);var L=c.deg2rad(K);K=Math.sin(P);P=Math.cos(P);var J=Math.sin(L),H=Math.cos(L);const I=r.length(M);if(1E-8>Math.abs(L))L=G+I;else{var O=I/J,Q=c.asinClamped(G/O);L=O*Math.sin(Math.PI-L-Q)}H*=G;O=G*G*J*J;Q=P*P*O;const S=L-H,T=S*S;var U=Q*(Q+T-M[1]*M[1]);if(0>U)return r.scale(N.eye,M,L/I),N.tilt=0,N;var aa=Math.sqrt(U);const W=M[1]*S;U=Q+T;aa=0<P?-aa+W:aa+W;if(1E-8>Math.abs(U))return 1E-8>I?(N.eye[0]=
0,N.eye[1]=0,N.eye[2]=G):r.scale(N.eye,M,L/I),N.tilt=0,x(N.eye),B(N,F);N.eye[1]=aa/U;G*=J;aa=N.eye[1]*N.eye[1];J=1-aa;U=Math.sqrt(J);O=Q*aa+K*K*O-2*P*G*N.eye[1]*U*S+J*T;if(1E-8>Math.abs(O))return r.scale(N.eye,M,L/I),N.tilt=0,x(N.eye),B(N,F);N.eye[0]=(J*(L*M[0]-H*M[0])-G*U*(M[0]*N.eye[1]*P+M[2]*K))/O;N.eye[2]=(J*(L*M[2]-H*M[2])-G*U*(M[2]*N.eye[1]*P-M[0]*K))/O;r.scale(N.eye,N.eye,L);x(N.eye);return B(N,F)}function x(F){const G=F[1];F[1]=-F[2];F[2]=G}function B(F,G){G=v(G,F.heading,F.tilt);F.up=G.up;
return F}function q(F,G,P){G=r.length(G);P=c.asinClamped(P/(Math.sqrt(P*P+G*G-2*P*G*Math.cos(Math.PI-F))/Math.sin(F)));return c.rad2deg(F-P)}function u(F,G,P){F=c.deg2rad(F);G=r.length(G);return c.asinClamped(P/(G/Math.sin(F)))+F}function C(F,G,P,K,N){function M(I){const O=Math.PI/2;I=b.cyclical2PI.normalize(I,-O);I>O&&(I=Math.PI-I);return I}var L=G.latitude;var J=k.getReferenceEllipsoid(F.spatialReference).radius;G=G.longitude;var H=h.getLonDeltaForDistance(L,P,J)/2;P=G-H;G+=H;L=c.deg2rad(L);L=(1+
Math.sin(L))/(1-Math.sin(L));H=(L+1)*Math.tan(K/J/2);L=1.5*Math.PI-2*Math.atan(.5*(H+Math.sqrt(4*L+H*H)));K=L+K/J;L=M(L);K=M(K);K<L&&(J=K,K=L,L=J);L=Math.max(c.rad2deg(L),-90);K=Math.min(c.rad2deg(K),90);G=p.monotonic(P,G);180<G-P&&(J=(G-P-180)/2,P+=J,G-=J);J=F.spatialReference&&F.spatialReference.isGeographic?F.spatialReference:f.WGS84;N?(N.xmin=P,N.ymin=L,N.xmax=G,N.ymax=K,N.spatialReference=J):N=new g(P,L,G,K,J);F.spatialReference&&F.spatialReference.isWebMercator&&d.geographicToWebMercator(N,
!1,N);return N}const z=n.fromValues(0,0,1),A=r.normalize(n.create(),n.fromValues(1,1,1)),p=new b.Cyclical(-180,180),y=l.create(),D=n.create(),E=n.create();l=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:v,directionToHeadingTilt:w,eyeForCenterWithHeadingTilt:t,lookAtTiltToEyeTilt:q,eyeTiltToLookAtTilt:u,toExtent:C},Symbol.toStringTag,{value:"Module"}));a.cameraUtilsSpherical=l;a.directionToHeadingTilt=w;a.eyeForCenterWithHeadingTilt=t;a.eyeTiltToLookAtTilt=u;a.headingTiltToDirectionUp=
v;a.lookAtTiltToEyeTilt=q;a.toExtent=C})},"esri/views/3d/support/ElevationProvider":function(){define(["exports","../../../core/maybe","../../../layers/graphics/dehydratedFeatureUtils"],function(a,b,c){function m(l){return"array"in l}a.SamplePosition=function(l,r=null,n=0){this.array=l;this.spatialReference=r;this.offset=n};a.getElevationAtPoint=function(l,r,n="ground"){if(c.isDehydratedPoint(r))return l.getElevation(r.x,r.y,r.z||0,r.spatialReference,n);if(m(r)){let g=r.offset;return l.getElevation(r.array[g++],
r.array[g++],r.array[g]||0,b.unwrapOr(r.spatialReference,l.spatialReference),n)}return l.getElevation(r[0],r[1],r[2]||0,l.spatialReference,n)};a.isSamplePosition=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/dehydratedFeatureUtils":function(){define(["exports"],function(a){a.isDehydratedPoint=function(b){return"point"===b.type};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/support/spatialReferenceSupport":function(){define(["exports",
"../../geometry/support/SupportedGCSWkids","../ViewingMode"],function(a,b,c){a.isSpatialReferenceSupported=function(m,l){return null==m?!1:null==l?!0:l===c.ViewingMode.Local?m.isGeographic?m.isWGS84||m.wkid===b.SupportedGCSWkids.CGCS2000:!0:m.isWebMercator||m.isWGS84||m.wkid===b.SupportedGCSWkids.CGCS2000||m.wkid===b.SupportedGCSWkids.GCSMARS2000||m.wkid===b.SupportedGCSWkids.GCSMARS2000_SPHERE||m.wkid===b.SupportedGCSWkids.GCSMOON2000};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/navigation/gamepadAndKeyboardUtils":function(){define(["exports","../../chunks/vec3"],function(a,b){function c(m){let l=m*m;0>m&&(l*=-1);return l}a.extractTransformation=function(m,l,r){const n=m.state;m=m.device;l="forward-down"===l.tiltDirection?1:-1;"standard"===m.deviceType?(r.translation[0]=c(n.axes[0]),r.translation[1]=c(n.axes[1]),r.translation[2]=c(n.buttons[7])-c(n.buttons[6]),r.heading=c(n.axes[2]),r.tilt=c(n.axes[3])):"spacemouse"===m.deviceType&&(r.translation[0]=1.2*c(n.axes[0]),
r.translation[1]=1.2*c(n.axes[1]),r.translation[2]=2*-c(n.axes[2]),r.heading=1.2*c(n.axes[5]),r.tilt=1.2*c(n.axes[3]));r.tilt*=l;b.scale(r.translation,r.translation,1);return r};a.extractTransformationKeyboard=function(m,l){l.translation[0]=m[1]-m[0];l.translation[1]=m[3]-m[2];l.translation[2]=m[4]-m[5];l.heading=m[7]-m[6];l.tilt=m[8]-m[9];l.zoom=m[10]-m[11];return l};a.isZeroTransformation=function(m){return 0===m.translation[0]&&0===m.translation[1]&&0===m.translation[2]&&0===m.heading&&0===m.tilt&&
0===m.zoom};a.quadraticAccentuation=c;a.resetTransformation=function(m){m.translation[0]=0;m.translation[1]=0;m.translation[2]=0;m.heading=0;m.tilt=0;return m};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/KeyboardNavigation":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../ViewingMode","../../state/controllers/GamepadKeyboardController","../../../input/InputHandler"],function(a,b,c,m,
l){var r;(function(n){n[n.LEFT=0]="LEFT";n[n.RIGHT=1]="RIGHT";n[n.FORWARD=2]="FORWARD";n[n.BACKWARD=3]="BACKWARD";n[n.UP=4]="UP";n[n.DOWN=5]="DOWN";n[n.HEADINGLEFT=6]="HEADINGLEFT";n[n.HEADINGRIGHT=7]="HEADINGRIGHT";n[n.TILTUP=8]="TILTUP";n[n.TILTDOWN=9]="TILTDOWN";n[n.ZOOMIN=10]="ZOOMIN";n[n.ZOOMOUT=11]="ZOOMOUT"})(r||(r={}));l=function(n){function g(f,d){var e=n.call(this,!0)||this;e.view=f;e.disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:c.ViewingMode.Local};e.keyToNumber={[d.left]:r.LEFT,
[d.right]:r.RIGHT,[d.forward]:r.FORWARD,[d.backward]:r.BACKWARD,[d.up]:r.UP,[d.down]:r.DOWN,[d.headingLeft]:r.HEADINGLEFT,[d.headingRight]:r.HEADINGRIGHT,[d.tiltUp]:r.TILTUP,[d.tiltDown]:r.TILTDOWN,[d.zoomIn]:r.ZOOMIN,[d.zoomOut]:r.ZOOMOUT};e.registerIncoming("key-down",null,h=>e._handleKeyDown(h));e.registerIncoming("key-up",null,h=>e._handleKeyUp(h));e.registerIncoming("blur",null,()=>e._handleBlur());return e}b._inheritsLoose(g,n);var k=g.prototype;k._handleKeyDown=function(f){if(!f.data.native.ctrlKey&&
!f.data.native.metaKey){var d=this.keyToNumber[f.data.key];null!=d&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new m.GamepadKeyboardController({view:this.view,disableMovements:this.disableMovements}),this.view.state.switchCameraController(this.cameraControllerKeyboard)),this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(d),f.stopPropagation()))}};k._handleBlur=function(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&
(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null)};k._handleKeyUp=function(f){if(!f.data.native.ctrlKey&&!f.data.native.metaKey){var d=this.keyToNumber[f.data.key];null!=d&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(d),f.stopPropagation())}};return g}(l.InputHandler);a.KeyboardNavigation=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler".split(" "),
function(a,b,c,m,l,r){r=function(n){function g(k,f){var d=n.call(this,!0)||this;d.view=k;d.registerIncoming("mouse-wheel",f,e=>d._handleMouseWheel(e));return d}b._inheritsLoose(g,n);g.prototype._handleMouseWheel=function(k){if(this.view.navigation.mouseWheelZoomEnabled){var f=k.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new m.ZoomStepController({view:this.view,mode:"interaction"}):new l.ZoomStepController({view:this.view,mode:"interaction"}),
this.view.state.switchCameraController(this.cameraController));this.cameraController.zoomStep(-1/60*f.deltaY,c.createScreenPointArray(f.x,f.y));k.preventDefault();k.stopPropagation()}};return g}(r.InputHandler);a.MouseWheelZoom=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../state/controllers/global/PinchAndPanController ../../state/controllers/local/PinchAndPanController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(a,b,c,m,l,r){l=function(n){function g(f,d,e){var h=n.call(this,!0)||this;h.view=f;h.pointerAction=d;h.lastEndTimestamp=0;h.lastTimestamp=0;h.registerIncoming("drag",e,v=>h._handleDrag(v));return h}b._inheritsLoose(g,n);var k=g.prototype;k._handleDrag=function(f){if("mouse"!==f.data.pointerType||r.eventMatchesMousePointerAction(f.data,this.pointerAction)){var d=f.timestamp-this.lastEndTimestamp;d=this.momentum&&this.momentum.active&&40>d;switch(f.data.action){case "start":case "update":if(d)break;
this.controller&&this.controller.active?2<f.data.timestamp-this.lastTimestamp&&(this.controller.update(f.data),this.lastTimestamp=f.timestamp):this._startController(f);break;case "end":case "removed":this._endController(f,!0);break;case "added":this._endController(f,!1),this._startController(f)}f.stopPropagation()}};k._endController=function(f,d){this.controller&&this.controller.active&&(this.lastEndTimestamp=f.timestamp,f=this.controller.end(f.data),d&&f&&(this.momentum=f,this.view.state.switchCameraController(this.momentum)));
this.controller=null};k._startController=function(f){this.controller=this._createController();this.view.state.switchCameraController(this.controller);this.controller.begin(f.data);this.lastTimestamp=f.timestamp};k._createController=function(){return this.view.state.isGlobal?new c.PinchAndPanController({view:this.view}):new m.PinchAndPanController({view:this.view})};return g}(l.InputHandler);a.PinchAndPanNavigation=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Cyclical ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/projectionEllipsoid ../../../../../geometry/support/axisAngle ../../../../../geometry/support/plane ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N,M){a.PinchAndPanController=function(L){function J(I){I=L.call(this,I)||this;I.view=null;I.smoothRotation=new C.ExponentialFalloff(.05);I.rotationAxis=v.create();I.panningPlane=x.create();I.smoothScaling=new C.ExponentialFalloff(.05);I.zoomCenterScreen=r.createScreenPointArray();I.zoomMomentumEstimator=new M.ZoomMomentumEstimator;I.rotationMomentumEstimator=new N.RotationMomentumEstimator;I.panSphericalMomentumEstimator=new K.PanSphericalMomentumEstimator;
I.panPlanarMomentumEstimator=new P.PanPlanarMomentumEstimator;I.adjustedSphere=B.create();I.tmp3d=v.create();I.tmpScreenPointArray=r.createScreenPointArray();I.beginScreenPoint=r.createScreenPointArray();I.beginScenePoint=v.create();I.screenPickPoint=r.createScreenPointArray();I.navMode=F.NavigationMode.Horizontal;I.tmpInteractionDirection=v.create();I.constraintOptions={selection:u.ConstraintTypes.ALL,interactionType:u.InteractionType.NONE,interactionFactor:0,interactionStartCamera:new G.Camera,
interactionDirection:null,tiltMode:u.TiltMode.TUMBLE};return I}b._inheritsLoose(J,L);var H=J.prototype;H.begin=function(I){if(this.active){var O=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=O;this.rotationMomentumEstimator.enabled=O;this.panPlanarMomentumEstimator.enabled=O;this.panSphericalMomentumEstimator.enabled=O;this.beginHeading=-m.cyclicalPI.normalize(l.deg2rad(this.view.camera.heading));this.beginRadius=I.radius;this.pointerCount=I.pointers.size;this.beginAngle=
I.angle;this.smoothRotation.reset();r.screenPointObjectToArray(I.center,this.screenPickPoint);e.copy(this.beginScreenPoint,this.screenPickPoint);O=w.getReferenceEllipsoid(this.view.spatialReference);var Q=F.pickPointAndInitSphere(this.intersectionHelper,this.startCamera,this.screenPickPoint,O,F.SpherePickPointFallback.Silhouette);this.scenePickPoint=Q.scenePickPoint;this.sphere=Q.sphere;h.copy(this.beginScenePoint,this.scenePickPoint);this.navMode=F.decideNavigationMode(this.startCamera,this.screenPickPoint,
Q.hasGeometryIntersection,O);this.navMode===F.NavigationMode.Vertical&&this._preparePlanarPanMode(I);this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}};H._preparePlanarPanMode=function(I){var O=h.negate(this.tmp3d,this.startCamera.viewForward);x.fromPositionAndNormal(this.scenePickPoint,O,this.panningPlane);var Q=r.createScreenPointArray(this.screenPickPoint[0],0);O=v.create();var S=h.length(this.startCamera.eye);this.adjustedSphere[3]=S<this.sphere[3]?S-100:this.sphere[3];
F.sphereOrPlanePointFromScreenPoint(this.adjustedSphere,this.startCamera,Q,O);Q=r.createRenderScreenPointArray3();this.startCamera.projectToRenderScreen(O,Q);this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],.9*Q[1]);(O=this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint))&&x.fromPositionAndNormal(this.scenePickPoint,x.normal(this.panningPlane),this.panningPlane);Q=v.create();S=v.create();const T=v.create();h.subtract(Q,this.scenePickPoint,this.currentCamera.eye);
const U=h.length(Q);h.normalize(Q,Q);var aa=5*Math.max(Math.abs(this.view.camera.position.z),50);const W=this.view._stage.renderView.getMinimalDepthForArea(null,this.screenPickPoint[0],this.screenPickPoint[1],this.view.state.camera,80);aa=W?Math.min(W,aa):aa;aa=O?Math.min(aa,U):aa;h.copy(T,h.add(S,this.currentCamera.eye,h.scale(S,Q,aa)));this.panningPlane[3]=-h.dot(this.panningPlane,T);this.startCamera.center=h.add(S,this.startCamera.eye,h.scale(S,this.startCamera.viewForward,aa));I=r.screenPointObjectToArray(I.center,
this.tmpScreenPointArray);F.intersectPlaneFromScreenPointAtEye(this.panningPlane,this.startCamera,I,this.beginScenePoint)};H.update=function(I){if(this.active){this.currentCamera.copyFrom(this.startCamera);var O=1<I.pointers.size;this.navMode===F.NavigationMode.Horizontal?(O&&this._zoomSpherical(I),this._panningSpherical(I),O&&this._rotateSpherical(I)):(O&&this._zoomPlanar(I),this._panningPlanar(I),O&&this._rotatePlanar(I))}};H.end=function(I){I.pointers.size===this.pointerCount&&this.update(I);this.finishController();
if(I=this.zoomMomentumEstimator.evaluateMomentum())return this.navMode===F.NavigationMode.Horizontal?new E.ZoomSphericalMomentumController({view:this.view,momentum:I,screenCenter:this.zoomCenterScreen,sceneCenter:this.beginScenePoint,radius:this.sphere[3]}):new D.ZoomPlanarMomentumController({view:this.view,momentum:I,zoomCenter:this.beginScenePoint});if(I=this.rotationMomentumEstimator.evaluateMomentum())return new y.RotationMomentumController({view:this.view,momentum:I,center:this.sphere,axis:this.rotationAxis});
if(this.navMode===F.NavigationMode.Horizontal){if(I=this.panSphericalMomentumEstimator.evaluateMomentum())return new p.PanSphericalMomentumController({view:this.view,momentum:I})}else if(I=this.panPlanarMomentumEstimator.evaluateMomentum())return new A.PanPlanarMomentumController({view:this.view,momentum:I});return null};H._zoomSpherical=function(I){const O=this.beginRadius/I.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(I.radius,40),120);this.smoothScaling.update(O);F.applyZoomOnSphere(this.sphere,
this.currentCamera,this.smoothScaling.value);r.screenPointObjectToArray(I.center,this.zoomCenterScreen);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*I.timestamp);this.constraintOptions.interactionType=u.InteractionType.ZOOM;this.constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(I.radius-this.beginRadius);q.applyAll(this.view,this.currentCamera,this.constraintOptions)};H._panningSpherical=function(I){const O=r.screenPointObjectToArray(I.center,this.tmpScreenPointArray);
F.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,O,this.tmp3d);F.preserveHeadingThreshold(this.beginScenePoint,h.dot(this.currentCamera.up,this.beginScenePoint),this.sphere[3],this.beginHeading,this.view.camera.tilt,this.startCamera)?(F.applyPanSphericalPreserveHeading(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(O,this.tmp3d,.001*I.timestamp,this.startCamera,
this.sphere,this.beginHeading,this.view.camera.tilt)):(F.applyPanSphericalDirectRotation(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(O,this.tmp3d,.001*I.timestamp,this.startCamera,this.sphere[3],this.view.camera.tilt));this.constraintOptions.interactionType=u.InteractionType.PAN;this.constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(this.screenPickPoint,O);q.applyAll(this.view,
this.currentCamera,this.constraintOptions)};H._rotateSpherical=function(I){h.normalize(this.rotationAxis,this.scenePickPoint);this.currentCamera.aboveGround||h.negate(this.rotationAxis,this.rotationAxis);var O=this.smoothRotation.value,Q=F.normalizeRotationDelta(I.angle-O);O+=Q;this.smoothRotation.gain=.00125*Math.min(Math.max(I.radius,40),120);this.smoothRotation.update(O);Q=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(Q,.001*I.timestamp);F.applyRotation(this.currentCamera,
this.sphere,t.wrapAxisAngle(this.rotationAxis,Q));this.constraintOptions.interactionType=u.InteractionType.TUMBLE;this.constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(I.radius*O);q.applyAll(this.view,this.currentCamera,this.constraintOptions)};H._panningPlanar=function(I){const O=r.screenPointObjectToArray(I.center,this.tmpScreenPointArray);F.intersectPlaneFromScreenPointAtEye(this.panningPlane,this.currentCamera,O,this.tmp3d)&&(F.applyPanPlanar(this.currentCamera,this.beginScenePoint,
this.tmp3d),this.panPlanarMomentumEstimator.add(O,this.tmp3d,.001*I.timestamp),this.constraintOptions.interactionType=u.InteractionType.PAN,this.constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(this.beginScreenPoint,O),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),q.applyAll(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)};H._zoomPlanar=
function(I){const O=this.beginRadius/I.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(I.radius,40),120);this.smoothScaling.update(O);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*I.timestamp);F.applyZoomToPoint(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionType=u.InteractionType.ZOOM;this.constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(I.radius-this.beginRadius);
q.applyAll(this.view,this.currentCamera,this.constraintOptions)};H._rotatePlanar=function(I){h.copy(this.rotationAxis,this.beginScenePoint);this.currentCamera.aboveGround||h.negate(this.rotationAxis,this.rotationAxis);var O=this.smoothRotation.value;let Q=I.angle-O;Q=F.normalizeRotationDelta(Q);this.smoothRotation.gain=.00125*Math.min(Math.max(I.radius,40),120);this.smoothRotation.update(O+Q);O=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(O,.001*I.timestamp);F.applyRotation(this.currentCamera,
this.sphere,t.wrapAxisAngle(this.rotationAxis,O));this.constraintOptions.interactionType=u.InteractionType.TUMBLE;this.constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(I.radius*O);q.applyAll(this.view,this.currentCamera,this.constraintOptions)};b._createClass(J,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return J}(z.InteractiveController);c.__decorate([n.property({constructOnly:!0})],a.PinchAndPanController.prototype,"view",void 0);
a.PinchAndPanController=c.__decorate([d.subclass("esri.views.3d.state.controllers.global.PinchAndPanController")],a.PinchAndPanController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/util":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function m(r){this._gain=r}var l=m.prototype;l.reset=function(r){this._value=r};l.update=function(r){this._value=void 0===this._value?r:this._gain*
r+(1-this._gain)*this._value};b._createClass(m,[{key:"gain",set:function(r){this._gain=r}},{key:"value",get:function(){return void 0===this._value?0:this._value}}]);return m}();a.ExponentialFalloff=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ./MomentumController ../../../camera/constraintUtils/common".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e){a.PanPlanarMomentumController=function(v){function w(t){t=v.call(this,t)||this;t.interactionType=e.InteractionType.PAN;t.tmpPan=f.create();return t}b._inheritsLoose(w,v);w.prototype.momentumStep=function(t,x){t=this.momentum.value(t);k.scale(this.tmpPan,this.momentum.direction,t);x.eye=k.subtract(h,x.eye,this.tmpPan);x.center=k.subtract(h,x.center,this.tmpPan);this.constraintOptions.interactionDirection=this.tmpPan};return w}(d.MomentumController);c.__decorate([m.property({constructOnly:!0})],
a.PanPlanarMomentumController.prototype,"momentum",void 0);a.PanPlanarMomentumController=c.__decorate([g.subclass("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],a.PanPlanarMomentumController);const h=f.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../ViewAnimation ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../AnimationController ../../../webgl-engine/lib/Camera".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h){a.MomentumController=function(v){function w(x){x=v.call(this,x)||this;x.view=null;x.beginCamera=new h.Camera;x.elapsedTimeSec=0;x.constraintOptions={selection:d.ConstraintTypes.ALL,interactionType:d.InteractionType.PAN,interactionFactor:0,interactionStartCamera:new h.Camera,interactionDirection:null,tiltMode:d.TiltMode.TUMBLE};return x}b._inheritsLoose(w,v);var t=w.prototype;t.initialize=function(){this.constraintOptions.interactionType=this.interactionType;this.viewAnimation=
new k};t.onControllerStart=function(x){this.beginCamera.copyFrom(x);this.constraintOptions.interactionStartCamera=this.beginCamera;v.prototype.onControllerStart.call(this,x)};t.stepController=function(x,B){B.copyViewFrom(this.beginCamera);this.elapsedTimeSec+=x;this.momentumStep(this.elapsedTimeSec,B);f.applyAll(this.view,B,this.constraintOptions)};b._createClass(w,[{key:"steppingFinished",get:function(){return this.momentum.isFinished(this.elapsedTimeSec)}}]);return w}(e.AnimationController);c.__decorate([m.property({constructOnly:!0})],
a.MomentumController.prototype,"view",void 0);a.MomentumController=c.__decorate([g.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.MomentumController);Object.defineProperty(a,"InteractionType",{enumerable:!0,get:()=>d.InteractionType});Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ./MomentumController ../../utils/navigationUtils ../../../camera/constraintUtils/common".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h){const v=f.create(),w=f.create();a.PanSphericalMomentumController=function(t){function x(B){B=t.call(this,B)||this;B.interactionType=h.InteractionType.PAN;return B}b._inheritsLoose(x,t);x.prototype.momentumStep=function(B,q){const u=this.momentum.value1(B);B=this.momentum.value2(B);k.copy(w,q.eye);k.normalize(w,w);k.cross(this.momentum.axis2,w,this.momentum.axis1);e.applyRotationWithTwoAxes(q,v,this.momentum.axis1,u,this.momentum.axis2,B)};return x}(d.MomentumController);
c.__decorate([m.property({constructOnly:!0})],a.PanSphericalMomentumController.prototype,"momentum",void 0);a.PanSphericalMomentumController=c.__decorate([g.subclass("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],a.PanSphericalMomentumController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ./MomentumController ../../utils/navigationUtils ../../../camera/constraintUtils/common".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h){a.RotationMomentumController=function(v){function w(t){t=v.call(this,t)||this;t.interactionType=h.InteractionType.TUMBLE;return t}b._inheritsLoose(w,v);w.prototype.momentumStep=function(t,x){t=this.momentum.value(t);e.applyRotation(x,this.center,f.wrapAxisAngle(this.axis,t))};b._createClass(w,[{key:"center",set:function(t){this._set("center",k.clone(t))}},{key:"axis",set:function(t){this._set("axis",k.clone(t))}}]);return w}(d.MomentumController);c.__decorate([m.property({constructOnly:!0})],
a.RotationMomentumController.prototype,"momentum",void 0);c.__decorate([m.property({constructOnly:!0})],a.RotationMomentumController.prototype,"center",null);c.__decorate([m.property({constructOnly:!0})],a.RotationMomentumController.prototype,"axis",null);a.RotationMomentumController=c.__decorate([g.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.RotationMomentumController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ./MomentumController ../../utils/navigationUtils ../../../camera/constraintUtils/common".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h){a.ZoomPlanarMomentumController=function(v){function w(t){t=v.call(this,t)||this;t.interactionType=h.InteractionType.ZOOM;t.constraintOptions.interactionDirection=f.create();return t}b._inheritsLoose(w,v);w.prototype.momentumStep=function(t,x){k.copy(this.constraintOptions.interactionDirection,x.eye);t=this.momentum.valueDelta(0,t);e.applyZoomToPoint(x,this.zoomCenter,t,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionDirection=k.direction(this.constraintOptions.interactionDirection,
x.eye,this.constraintOptions.interactionDirection)};b._createClass(w,[{key:"zoomCenter",set:function(t){this._set("zoomCenter",f.clone(t))}}]);return w}(d.MomentumController);c.__decorate([m.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"momentum",void 0);c.__decorate([m.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"zoomCenter",null);a.ZoomPlanarMomentumController=c.__decorate([g.subclass("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],
a.ZoomPlanarMomentumController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ./MomentumController ../../utils/navigationUtils ../../../camera/constraintUtils/common".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t){a.ZoomSphericalMomentumController=function(x){function B(u){u=x.call(this,u)||this;u.interactionType=t.InteractionType.ZOOM;u.radius=0;u.tmpSceneCenter=f.create();u.tmpZoomAxisAngle=d.create();u.sphere=e.create();return u}b._inheritsLoose(B,x);var q=B.prototype;q.initialize=function(){this.sphere[3]=this.radius};q.momentumStep=function(u,C){u=this.momentum.valueDelta(0,u);w.applyZoomOnSphere(this.sphere,C,u);this.constraintOptions.interactionType=t.InteractionType.ZOOM;
h.applyAll(this.view,C,this.constraintOptions);w.sphereOrPlanePointFromScreenPoint(this.sphere,C,this.screenCenter,this.tmpSceneCenter);d.fromPoints(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle);w.applyRotation(C,this.sphere,this.tmpZoomAxisAngle);this.constraintOptions.interactionType=t.InteractionType.PAN};b._createClass(B,[{key:"screenCenter",set:function(u){this._set("screenCenter",m.createScreenPointArray(u[0],u[1]))}},{key:"sceneCenter",set:function(u){this._set("sceneCenter",
f.clone(u))}}]);return B}(v.MomentumController);c.__decorate([l.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"momentum",void 0);c.__decorate([l.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"screenCenter",null);c.__decorate([l.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"sceneCenter",null);c.__decorate([l.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"radius",void 0);a.ZoomSphericalMomentumController=
c.__decorate([k.subclass("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],a.ZoomSphericalMomentumController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/vec3 ../../chunks/vec3f64 ./FilteredFiniteDifference ./Momentum".split(" "),function(a,b,c,m,l,r){let n=function(g){function k(f,d,e,h,v){f=g.call(this,
f,d,e)||this;f.sceneVelocity=h;f.direction=v;return f}b._inheritsLoose(k,g);k.prototype.value=function(f){return g.prototype.valueFromInitialVelocity.call(this,this.sceneVelocity,f)};return k}(r.Momentum);r=function(){function g(f=300,d=12,e=.84){this.minimumInitialVelocity=f;this.stopVelocity=d;this.friction=e;this.enabled=!0;this.time=new l.FilteredFiniteDifference(.6);this.screen=[new l.FilteredFiniteDifference(.4),new l.FilteredFiniteDifference(.4)];this.scene=[new l.FilteredFiniteDifference(.6),
new l.FilteredFiniteDifference(.6),new l.FilteredFiniteDifference(.6)];this.tmpDirection=m.create()}var k=g.prototype;k.add=function(f,d,e){!this.enabled||this.time.hasLastValue&&.015>this.time.computeDelta(e)||(this.screen[0].update(f[0]),this.screen[1].update(f[1]),this.scene[0].update(d[0]),this.scene[1].update(d[1]),this.scene[2].update(d[2]),this.time.update(e))};k.reset=function(){this.screen[0].reset();this.screen[1].reset();this.scene[0].reset();this.scene[1].reset();this.scene[2].reset();
this.time.reset()};k.evaluateMomentum=function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var f=this.screen[0].filteredDelta;const d=this.screen[1].filteredDelta;f=Math.sqrt(f*f+d*d)/this.time.filteredDelta;return Math.abs(f)<this.minimumInitialVelocity?null:this.createMomentum(f,this.stopVelocity,this.friction)};k.createMomentum=function(f,d,e){c.set(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);const h=c.length(this.tmpDirection);
0<h&&c.scale(this.tmpDirection,this.tmpDirection,1/h);return new n(f,d,e,h/this.time.filteredDelta,this.tmpDirection)};return g}();a.PanPlanarMomentum=n;a.PanPlanarMomentumEstimator=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function m(r){this.gain=r}var l=m.prototype;l.update=function(r){if(this.hasLastValue){const n=
this.computeDelta(r);this._updateDelta(n)}this.lastValue=r};l.reset=function(){this.filteredDelta=this.lastValue=void 0};l.computeDelta=function(r){return r-this.lastValue};l._updateDelta=function(r){this.filteredDelta=this.hasFilteredDelta?(1-this.gain)*this.filteredDelta+this.gain*r:r};b._createClass(m,[{key:"hasLastValue",get:function(){return void 0!==this.lastValue}},{key:"hasFilteredDelta",get:function(){return void 0!==this.filteredDelta}}]);return m}();a.FilteredFiniteDifference=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/navigation/Momentum":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function m(r,n,g){this._initialVelocity=r;this._stopVelocity=n;this._friction=g;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}var l=m.prototype;l.isFinished=function(r){return r>this.duration};l.value=function(r){return this.valueFromInitialVelocity(this._initialVelocity,
r)};l.valueDelta=function(r,n){const g=this.value(r);return this.value(r+n)-g};l.valueFromInitialVelocity=function(r,n){n=Math.min(n,this.duration);const g=1-this.friction;return r*(g**n-1)/Math.log(g)};b._createClass(m,[{key:"duration",get:function(){return this._duration}},{key:"friction",get:function(){return this._friction}}]);return m}();a.Momentum=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/vec2f64 ../../chunks/vec3 ../../chunks/vec3f64 ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),
function(a,b,c,m,l,r,n,g,k){let f=function(d){function e(v,w,t,x,B,q=0,u){v=d.call(this,v,w,t)||this;v.angularVelocity1=x;v.axis1=B;v.angularVelocity2=q;v.axis2=u;return v}b._inheritsLoose(e,d);var h=e.prototype;h.value1=function(v){return d.prototype.valueFromInitialVelocity.call(this,this.angularVelocity1,v)};h.value2=function(v){return d.prototype.valueFromInitialVelocity.call(this,this.angularVelocity2,v)};return e}(k.Momentum);k=function(){function d(h=300,v=12,w=.84){this.minimumInitialVelocity=
h;this.stopVelocity=v;this.friction=w;this.enabled=!0;this.tmpAxis1=l.create();this.tmpAxis2=l.create();this.tmpAngles=c.create();this.time=new n.FilteredFiniteDifference(.3);this.screen=[new n.FilteredFiniteDifference(.4),new n.FilteredFiniteDifference(.4)];this.angle1=new g.FilteredValue(.6);this.angle2=new g.FilteredValue(.6);this.axis1=l.create();this.axis2=l.create();this.lastScene=l.create()}var e=d.prototype;e.addMomentumDirectRotation=function(h,v,w,t,x,B){if(this.enabled){if(this.time.hasLastValue){if(.01>
this.time.computeDelta(w))return;t=r.rotationAngleAndAxisDirectRotation(this.lastScene,v,this.tmpAxis2,t,x,B);this.angle2.update(0);1E-5>m.squaredLength(this.tmpAxis2)?t=0:m.normalize(this.axis1,this.tmpAxis2);this.angle1.update(t);m.copy(this.lastScene,v)}this.screen[0].update(h[0]);this.screen[1].update(h[1]);this.time.update(w)}};e.addMomentumPreserveHeading=function(h,v,w,t,x,B,q){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(w))return;r.rotationAnglesAndAxesHeadingPreserving(this.lastScene,
v,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,t,x,B,q,!1);1E-5>m.squaredLength(this.tmpAxis2)?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),m.normalize(this.axis1,this.tmpAxis1),m.normalize(this.axis2,this.tmpAxis2));m.copy(this.lastScene,v)}this.screen[0].update(h[0]);this.screen[1].update(h[1]);this.time.update(w)}};e.reset=function(){this.screen[0].reset();this.screen[1].reset();this.angle1.reset();this.angle2.reset();
this.time.reset()};e.evaluateMomentum=function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var h=this.screen[0].filteredDelta;const v=this.screen[1].filteredDelta;h=Math.sqrt(h*h+v*v)/this.time.filteredDelta;return Math.abs(h)<this.minimumInitialVelocity?null:this.createMomentum(h,this.stopVelocity,this.friction)};e.createMomentum=function(h,v,w){return new f(h,v,w,this.angle1.filteredValue/this.time.filteredDelta,this.axis1,this.angle2.filteredValue/this.time.filteredDelta,this.axis2)};
return d}();a.PanSphericalMomentum=f;a.PanSphericalMomentumEstimator=k;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/navigation/FilteredValue":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function m(r){this.gain=r}var l=m.prototype;l.update=function(r){this.filteredValue=this.hasFilteredValue?(1-this.gain)*this.filteredValue+this.gain*r:r};l.reset=function(){this.filteredValue=void 0};
b._createClass(m,[{key:"hasFilteredValue",get:function(){return void 0!==this.filteredValue}}]);return m}();a.FilteredValue=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./MomentumEstimator"],function(a,b,c){c=function(m){function l(r=3,n=.01,g=.95,k=12){return m.call(this,r,n,g,k)||this}b._inheritsLoose(l,m);l.prototype.add=function(r,
n){if(this.value.hasLastValue){const g=this.value.lastValue;for(r-=g;r>Math.PI;)r-=2*Math.PI;for(;r<-Math.PI;)r+=2*Math.PI;r=g+r}m.prototype.add.call(this,r,n)};return l}(c.MomentumEstimator);a.RotationMomentumEstimator=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/navigation/MomentumEstimator":function(){define(["exports","../../core/mathUtils","./FilteredFiniteDifference","./Momentum"],function(a,b,c,m){let l=function(){function r(g=2.5,
k=.01,f=.95,d=12){this.minimumInitialVelocity=g;this.stopVelocity=k;this.friction=f;this.maxVelocity=d;this.enabled=!0;this.value=new c.FilteredFiniteDifference(.8);this.time=new c.FilteredFiniteDifference(.3)}var n=r.prototype;n.add=function(g,k){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(k))return;if(this.value.hasFilteredDelta){const f=this.value.computeDelta(g);0>this.value.filteredDelta*f&&this.value.reset()}}this.time.update(k);this.value.update(g)}};n.reset=function(){this.value.reset();
this.time.reset()};n.evaluateMomentum=function(){if(!this.enabled||!this.value.hasFilteredDelta)return null;let g=this.value.filteredDelta/this.time.filteredDelta;g=b.clamp(g,-this.maxVelocity,this.maxVelocity);return Math.abs(g)<this.minimumInitialVelocity?null:this.createMomentum(g,this.stopVelocity,this.friction)};n.createMomentum=function(g,k,f){return new m.Momentum(g,k,f)};return r}();a.MomentumEstimator=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/navigation/ZoomMomentumEstimator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./Momentum","./MomentumEstimator"],function(a,b,c,m){let l=function(r){function n(k,f,d){return r.call(this,k,f,d)||this}b._inheritsLoose(n,r);var g=n.prototype;g.value=function(k){k=r.prototype.value.call(this,k);return Math.exp(k)};g.valueDelta=function(k,f){const d=r.prototype.value.call(this,k);k=r.prototype.value.call(this,k+f);return Math.exp(k-d)};return n}(c.Momentum);c=function(r){function n(k=
2.5,f=.01,d=.95,e=12){return r.call(this,k,f,d,e)||this}b._inheritsLoose(n,r);var g=n.prototype;g.add=function(k,f){r.prototype.add.call(this,Math.log(k),f)};g.createMomentum=function(k,f,d){return new l(k,f,d)};return n}(m.MomentumEstimator);a.ZoomMomentum=l;a.ZoomMomentumEstimator=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../geometry/support/plane ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D){const E=e.fromValues(0,0,1);var F=16/180*Math.PI;a.PinchAndPanController=function(G){function P(N){N=G.call(this,N)||this;N.view=null;N.rotationValueSmooth=new x.ExponentialFalloff(.05);N.scalingValueSmooth=new x.ExponentialFalloff(.05);N.planeHorizontal=v.create();N.planeVertical=v.create();N.rotationMomentumEstimator=new y.RotationMomentumEstimator;N.panMomentumEstimator=new p.PanPlanarMomentumEstimator(300,12,.9);N.zoomMomentumEstimator=
new D.ZoomMomentumEstimator;N.beginCenter=e.create();N.tmpPoints=[];N.beginCenterScreen=l.createScreenPointArray();N.tmpCentroid3d=e.create();N.tmpCentroid2d=l.createScreenPointArray();N.tmp2d=l.createScreenPointArray();N.constraintOptions={selection:t.ConstraintTypes.ALL,interactionType:t.InteractionType.NONE,interactionFactor:0,interactionStartCamera:new A.Camera,interactionDirection:null,tiltMode:t.TiltMode.TUMBLE};return N}b._inheritsLoose(P,G);var K=P.prototype;K.begin=function(N){if(this.active){var M=
this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=M;this.rotationMomentumEstimator.enabled=M;this.panMomentumEstimator.enabled=M;this.beginRadius=N.radius;this.pointerCount=N.pointers.size;this.beginAngle=N.angle;this.rotationValueSmooth.reset();this.scalingValueSmooth.reset();l.screenPointObjectToArray(N.center,this.beginCenterScreen);v.fromNormalAndOffset(E,0,this.planeHorizontal);var L=e.create();M=this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,
L);var J=e.create();d.negate(J,this.startCamera.viewForward);var H=e.create();d.copy(H,E);var I=d.dot(J,H);this.panMode=m.asinClamped(0>I?-I:I)>=F?z.NavigationMode.Horizontal:z.NavigationMode.Vertical;v.setOffsetFromPoint(this.planeHorizontal,this.planeHorizontal,L);this.startCamera.aboveGround||v.negate(this.planeHorizontal,this.planeHorizontal);if(this.panMode===z.NavigationMode.Vertical){d.scale(H,H,I);d.subtract(this.planeVertical,J,H);d.normalize(this.planeVertical,this.planeVertical);v.setOffsetFromPoint(this.planeVertical,
this.planeVertical,L);J=e.create();H=e.create();I=e.create();d.subtract(J,L,this.currentCamera.eye);L=d.length(J);d.normalize(J,J);var O=5*Math.max(Math.abs(this.view.camera.position.z),50);const Q=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this.beginCenterScreen[0],this.beginCenterScreen[1],this.view.state.camera,80);O=Q?Math.min(Q,O):O;O=M?Math.min(O,L):O;d.copy(I,d.add(H,this.currentCamera.eye,d.scale(H,J,O)));this.planeVertical[3]=-d.dot(this.planeVertical,I);this.computePlanePoints(N.pointers,
this.planeVertical,this.startCamera,this.tmpPoints)}else this.computePlanePoints(N.pointers,this.planeHorizontal,this.startCamera,this.tmpPoints);z.centroid(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}};K.update=function(N){if(this.active){this.currentCamera.copyFrom(this.startCamera);var M=1<N.pointers.size,L=this.panMode===z.NavigationMode.Horizontal?this.planeHorizontal:this.planeVertical,J=this.beginCenter;if(M){var H=this.beginRadius/
N.radius;this.scalingValueSmooth.gain=.001875*Math.min(Math.max(N.radius,40),120);this.scalingValueSmooth.update(H);z.applyZoomToPoint(this.currentCamera,J,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*N.timestamp);this.constraintOptions.interactionType=t.InteractionType.ZOOM;this.constraintOptions.interactionFactor=w.pixelDistanceToInteractionFactor(Math.abs(N.radius-this.beginRadius));w.applyAll(this.view,
this.currentCamera,this.constraintOptions)}this.computePlanePoints(N.pointers,L,this.currentCamera,this.tmpPoints);z.centroid(this.tmpPoints,this.tmpCentroid3d);l.screenPointObjectToArray(N.center,this.tmpCentroid2d);z.applyPanPlanar(this.currentCamera,J,this.tmpCentroid3d);this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*N.timestamp);this.constraintOptions.interactionType=t.InteractionType.PAN;this.constraintOptions.interactionFactor=w.pixelDistanceToInteractionFactor(this.beginCenterScreen,
this.tmpCentroid2d);w.applyAll(this.view,this.currentCamera,this.constraintOptions);M&&(M=this.planeHorizontal,L=this.rotationValueSmooth.value,H=z.normalizeRotationDelta(N.angle-L),L+=H,this.rotationValueSmooth.gain=.00125*Math.min(Math.max(N.radius,40),120),this.rotationValueSmooth.update(L),L=this.rotationValueSmooth.value-this.beginAngle,this.rotationMomentumEstimator.add(L,.001*N.timestamp),z.applyRotation(this.currentCamera,J,h.wrapAxisAngle(M,L)),this.constraintOptions.interactionType=t.InteractionType.TUMBLE,
this.constraintOptions.interactionFactor=w.pixelDistanceToInteractionFactor(Math.abs(N.radius*L)),w.applyAll(this.view,this.currentCamera,this.constraintOptions))}};K.end=function(N){N.pointers.size===this.pointerCount&&this.update(N);this.finishController();return(N=this.zoomMomentumEstimator.evaluateMomentum())?new C.ZoomPlanarMomentumController({view:this.view,momentum:N,zoomCenter:this.beginCenter}):(N=this.rotationMomentumEstimator.evaluateMomentum())?new u.RotationMomentumController({view:this.view,
momentum:N,center:this.beginCenter,axis:v.normal(this.planeHorizontal)}):(N=this.panMomentumEstimator.evaluateMomentum())?new q.PanPlanarMomentumController({view:this.view,momentum:N}):null};K.computePlanePoints=function(N,M,L,J){J.length=N.size;const H=this.tmp2d;let I=0;N.forEach(O=>{H[0]=O.x;H[1]=O.y;void 0===J[I]&&(J[I]=e.create());z.intersectPlaneFromScreenPointAtEye(M,L,H,J[I]);I+=1});return J};b._createClass(P,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);
return P}(B.InteractiveController);c.__decorate([r.property({constructOnly:!0})],a.PinchAndPanController.prototype,"view",void 0);a.PinchAndPanController=c.__decorate([f.subclass("esri.views.3d.state.controllers.local.PinchAndPanController")],a.PinchAndPanController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../input/InputHandler"],
function(a,b,c){c=function(m){function l(r,n){var g=m.call(this,!0)||this;g.view=r;g.registerIncoming("pointer-down",n,()=>g.view.state.stopActiveCameraController());return g}b._inheritsLoose(l,m);return l}(c.InputHandler);a.PointerDownCancelAnimation=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./SingleKey"],function(a,
b,c){c=function(m){function l(r,n,g){n=m.call(this,n,g)||this;n.view=r;return n}b._inheritsLoose(l,m);l.prototype.activate=function(){this.view.goTo({heading:0}).catch(()=>{})};return l}(c.SingleKey);a.SingleKeyResetHeading=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/SingleKey":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../input/InputHandler"],function(a,b,c){c=function(m){function l(r,
n){var g=m.call(this,!0)||this;g.key=r;g.registerIncoming("key-down",n,k=>g._handleKeyDown(k));return g}b._inheritsLoose(l,m);l.prototype._handleKeyDown=function(r){r.data.key===this.key&&(this.activate(),r.stopPropagation())};return l}(c.InputHandler);a.SingleKey=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./SingleKey"],function(a,
b,c){c=function(m){function l(r,n,g){n=m.call(this,n,g)||this;n.view=r;return n}b._inheritsLoose(l,m);l.prototype.activate=function(){this.view.goTo({tilt:0}).catch(()=>{})};return l}(c.SingleKey);a.SingleKeyResetTilt=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/screenUtils","../../state/controllers/RotateController",
"../../../input/InputHandler"],function(a,b,c,m,l){l=function(r){function n(g,k=!1){var f=r.call(this,!0)||this;f.view=g;f.invert=k;f.registerIncoming("vertical-two-finger-drag",d=>f._handleTwoFinger(d));return f}b._inheritsLoose(n,r);n.prototype._handleTwoFinger=function(g){var k,f,d;const e=c.createScreenPointArray(0,g.data.delta*(this.invert?-1:1));switch(g.data.action){case "begin":null==(k=this.cameraController)?void 0:k.end();this.cameraController=new m.RotateController({view:this.view,pivot:m.PivotPoint.CENTER});
this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(e);break;case "update":null==(f=this.cameraController)?void 0:f.update(e);break;case "end":null==(d=this.cameraController)?void 0:d.end(),this.cameraController=null}};return n}(l.InputHandler);a.TwoFingerTilt=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/BrowserEventSource":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ./keys ./gamepad/GamepadSource ../support/screenUtils".split(" "),
function(a,b,c,m,l,r){const n=c("trident"),g=c("edge"),k=c("chrome"),f=c("ff"),d=c("safari");c=function(){function h(w,t){this.input=t;this._active={};this._activePointerCaptures=new Set;this._keyDownState=new Set;this._eventId=1;this._browserTouchPanningEnabled=!1;this._element=w;w.getAttribute("tabindex")||w.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,
"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._updateTouchAction();this._element.addEventListener("keydown",this._preventAltKeyDefault);this._gamepadSource=new l.GamepadSource(w,this.input);this._gamepadSource.onEvent=x=>this._callback("gamepad",x)}var v=h.prototype;v.destroy=function(){this.activeEvents=this._callback=null;this._activePointerCaptures.forEach(w=>
{this._releasePointerCaptureSafe(w)});this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null);this._activePointerCaptures=null;this._removeTouchAction();this._element.removeEventListener("keydown",this._preventAltKeyDefault)};v.setPointerCapture=function(w,t){t?(this._element.setPointerCapture(w.pointerId),this._activePointerCaptures.add(w.pointerId)):(this._releasePointerCaptureSafe(w.pointerId),this._activePointerCaptures.delete(w.pointerId))};v._updateTouchAction=function(){this._element.classList.remove(this._browserTouchPanningEnabled?
"esri-view-surface--touch-none":"esri-view-surface--touch-pan");this._element.classList.add(this._browserTouchPanningEnabled?"esri-view-surface--touch-pan":"esri-view-surface--touch-none")};v._updateTouchEventHandling=function(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};v._removeTouchAction=function(){this._element.classList.remove("esri-view-surface--touch-none");
this._element.classList.remove("esri-view-surface--touch-pan");this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};v._releasePointerCaptureSafe=function(w){try{this._element.hasPointerCapture&&!this._element.hasPointerCapture(w)||this._element.releasePointerCapture(w)}catch(t){}};v._updateNormalizedPointerLikeEvent=function(w,t){w=r.createScreenPointFromNativeEvent(this._element,w);h.test.disableSubpixelCoordinates&&(w.x=Math.round(w.x),w.y=Math.round(w.y));t.x=w.x;t.y=
w.y;return t};v._handleKey=function(w,t){const x=m.eventKey(t);x&&"key-up"===w&&this._keyDownState.delete(x);t={native:t,key:x,repeat:x&&this._keyDownState.has(x)};x&&"key-down"===w&&this._keyDownState.add(t.key);this._callback(w,t)};v._handlePointer=function(w,t){t=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});this._callback(w,t)};v._handlePointerPreventDefault=function(w,t){const x=this._updateNormalizedPointerLikeEvent(t,
{native:t,x:0,y:0,pointerType:t.pointerType,button:t.button,buttons:t.buttons,eventId:this._eventId++});t.preventDefault();this._callback(w,x)};v._handleMouseWheel=function(w,t){let x=t.deltaY;switch(t.deltaMode){case 0:if(n||g)x=x/document.documentElement.clientHeight*600;break;case 1:x*=30;break;case 2:x*=900}n||g?x*=.7:k||d?x*=.6:f&&(x*=1.375);const B=Math.abs(x);100<B&&(x=x/B*200/(1+Math.exp(-.02*(B-100))));t=this._updateNormalizedPointerLikeEvent(t,{native:t,x:0,y:0,deltaY:x});this._callback(w,
t)};v._handlePointerCaptureLost=function(w,t){this._activePointerCaptures.delete(t.pointerId);this._handleDefault(w,t)};v._handleDefault=function(w,t){const x={native:t};t.preventDefault();this._callback(w,x)};v._preventAltKeyDefault=function(w){"Alt"===w.key&&w.preventDefault()};v._preventMultiTouchPanning=function(w){1<w.touches.length&&w.preventDefault()};b._createClass(h,[{key:"browserTouchPanningEnabled",get:function(){return this._browserTouchPanningEnabled},set:function(w){this._browserTouchPanningEnabled=
w;this._updateTouchAction();this._updateTouchEventHandling()}},{key:"onEventReceived",set:function(w){this._callback=w}},{key:"activeEvents",set:function(w){for(const t in this._active)w&&w.has(t)||(this._element.removeEventListener(e[t],this._active[t]),delete this._active[t]);w&&w.forEach(t=>{if(!this._active[t]&&e[t]){const x=(this._eventHandlers[t]||this._handleDefault).bind(this,t);this._element.addEventListener(e[t],x);this._active[t]=x}});this._gamepadSource.hasEventListeners=w&&w.has("gamepad")}}]);
return h}();c.test={disableSubpixelCoordinates:!1};const e={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};a.BrowserEventSource=c;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/gamepad/GamepadSource":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/scheduling","./GamepadInputDevice","./GamepadState"],function(a,b,c,m,l){let r=function(){function n(k,f){this.element=k;this.input=f;this._hasEventListeners=!1;this._onConnectGamepad=d=>{this._connectGamepad(d.gamepad)};this._onDisconnectGamepad=d=>{d=d.gamepad;const e=d.index,h=this.inputDevices[e];h&&(this._emitGamepadEvent(d,
l.extractState(h),!1),this.inputDevices.splice(e,1),this.latestUpdate.splice(e,1),this.input.gamepad.devices.remove(h),this.ensurePollingState())};this.frameTask=null;this.latestUpdate=[];this.inputDevices=[];this.callback=null;k=window.isSecureContext;if(this.supported="getGamepads"in window.navigator&&k)this._forEachGamepad(d=>this._connectGamepad(d)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState()}
var g=n.prototype;g.destroy=function(){this.hasEventListeners=!1;this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))};g._connectGamepad=function(k){const f=new m(k);"unknown"!==f.deviceType&&(this.inputDevices[k.index]=f,this.input.gamepad.devices.add(f));this.ensurePollingState()};g.ensurePollingState=function(){this.eventsEnabled?this._startPolling():this._stopPolling()};g._startPolling=
function(){null==this.frameTask&&(this.frameTask=c.addFrameTask({update:()=>this._readGamepadState()}))};g._stopPolling=function(){null!=this.frameTask&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=[])};g._readGamepadState=function(){const k=document.hasFocus(),f=this.element.contains(document.activeElement),d="document"===this.input.gamepad.enabledFocusMode&&!k||"view"===this.input.gamepad.enabledFocusMode&&!f;this._forEachGamepad(e=>{var h=this.inputDevices[e.index];if(h){var v=
this.latestUpdate[e.index];h=l.extractState(h);var w=d||l.stateIdle(h);v&&(v.timestamp===e.timestamp||!v.active&&w||l.stateEqual(v.state,h))||this._emitGamepadEvent(e,h,!w)}})};g._forEachGamepad=function(k){const f=window.navigator.getGamepads();for(let d=0;d<f.length;d++){const e=f[d];this._validate(e)&&k(e)}};g._emitGamepadEvent=function(k,f,d){var e=this.latestUpdate[k.index];if((e=e&&e.active)||d)this.latestUpdate[k.index]={timestamp:k.timestamp,state:f,active:d},this.callback&&this.callback({device:this.inputDevices[k.index],
state:f,action:!e&&d?"start":e&&d?"update":"end"})};g._validate=function(k){if(!k||!k.connected)return!1;for(let f=0;f<k.axes.length;f++)if(isNaN(k.axes[f]))return!1;return!0};b._createClass(n,[{key:"hasEventListeners",set:function(k){this._hasEventListeners!==k&&(this._hasEventListeners=k,this.ensurePollingState())}},{key:"eventsEnabled",get:function(){return this.supported&&0<this.inputDevices.length&&this._hasEventListeners}},{key:"onEvent",set:function(k){this.callback=k}}]);return n}();a.GamepadSource=
r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/gamepad/GamepadState":function(){define(["exports"],function(a){a.extractState=function(b){const c=b.native;return c?{buttons:c.buttons.map(m=>m.pressed?m.value?m.value:1:0),axes:c.axes.map(m=>{{var l=b.axisThreshold;const r=Math.abs(m);m=r<l?0:Math.sign(m)*(r-l)/(1-l)}return m})}:{buttons:[],axes:[]}};a.stateEqual=function(b,c){if(b.axes.length!==c.axes.length||b.buttons.length!==c.buttons.length)return!1;
for(var m=0;m<b.axes.length;m++)if(b.axes[m]!==c.axes[m])return!1;for(m=0;m<b.buttons.length;m++)if(b.buttons[m]!==c.buttons[m])return!1;return!0};a.stateIdle=function(b){for(var c=0;c<b.axes.length;c++)if(0!==b.axes[c])return!1;for(c=0;c<b.buttons.length;c++)if(0!==b.buttons[c])return!1;return!0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/handlers/PreventContextMenu":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../InputHandler"],function(a,b,c){c=function(m){function l(){var r=m.call(this,!0)||this;r.registerIncoming("context-menu",n=>{n.data.native.preventDefault()});return r}b._inheritsLoose(l,m);return l}(c.InputHandler);a.PreventContextMenu=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/recognizers/Drag":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/screenUtils ../../../core/time ../InputHandler ./support".split(" "),
function(a,b,c,m,l,r){function n(d){const e=[];d.forEach(h=>{e.push(c.createScreenPoint(h.event.x,h.event.y))});return r.fitCircleLSQ(e)}function g(d){const e=n(d);let h=0;d.forEach(v=>{var w=f(v,e);for(w-=v.lastAngle;w>Math.PI;)w-=2*Math.PI;for(;w<-Math.PI;)w+=2*Math.PI;w=v.lastAngle+w;v.lastAngle=w;h+=w-v.initialAngle});h/=d.size||1;return{angle:h,radius:e.radius,center:e.center}}function k(d){const e=new Map;d.forEach((h,v)=>e.set(v,h.event));return e}function f(d,e){d=d.event;return Math.atan2(d.y-
e.center.y,d.x-e.center.x)}l=function(d){function e(v){var w=d.call(this,!1)||this;w.navigationTouch=v;w.startStateModifiers=new Set;w.activePointerMap=new Map;w.isDragging=!1;w.isCurrentDragSuppressed=!1;w.drag=w.registerOutgoing("drag");w.registerIncoming("pointer-drag",w._handlePointerDrag.bind(b._assertThisInitialized(w)));w.registerIncoming("pointer-up",w._handlePointerUpAndPointerLost.bind(b._assertThisInitialized(w)));w.registerIncoming("pointer-capture-lost",w._handlePointerUpAndPointerLost.bind(b._assertThisInitialized(w)));
w.registerIncoming("pointer-cancel",w._handlePointerUpAndPointerLost.bind(b._assertThisInitialized(w)));return w}b._inheritsLoose(e,d);var h=e.prototype;h._createPayload=function(v,w,t,x){return{action:v,pointerType:this.pointerType,button:this.mouseButton,buttons:w.buttons,timestamp:x,pointers:k(this.activePointerMap),pointer:w,angle:t.angle,radius:t.radius,center:t.center}};h._addPointer=function(v){var w=v.native.pointerId;const t=g(this.activePointerMap).angle;v={event:v,initialAngle:0,lastAngle:0};
this.activePointerMap.set(w,v);w=f(v,n(this.activePointerMap));v.initialAngle=w;v.lastAngle=w;this._updatePointerAngles(t)};h._updatePointer=function(v){if(!v||null!=v.x||null!=v.y){var w=this.activePointerMap.get(v.native.pointerId);w?w.event=v:this._addPointer(v)}};h._removePointer=function(v){const w=g(this.activePointerMap).angle;this.activePointerMap.delete(v);this._updatePointerAngles(w)};h._updatePointerAngles=function(v){const w=g(this.activePointerMap);this.activePointerMap.forEach(t=>{t.initialAngle=
f(t,w)-v;t.lastAngle=f(t,w)-v})};h._emitEvent=function(v,w,t){const x=g(this.activePointerMap);this.drag.emit(this._createPayload(v,w,x,t),void 0,this.startStateModifiers)};h._handlePointerUpAndPointerLost=function(v){const w=v.data.native.pointerId,t=m.Milliseconds(v.timestamp);this.activePointerMap.get(w)&&(1===this.activePointerMap.size?(this._updatePointer(v.data),!this.isCurrentDragSuppressed&&this._emitEvent("end",v.data,t),this.isCurrentDragSuppressed=this.isDragging=!1,this._removePointer(w)):
(this._removePointer(w),this._emitEvent("removed",v.data,m.Milliseconds(v.timestamp))))};h._handlePointerDrag=function(v){const w=v.data,t=w.currentEvent,x=m.Milliseconds(v.timestamp);switch(w.action){case "start":case "update":this.isDragging?this.activePointerMap.has(t.native.pointerId)?(this._updatePointer(t),!this.isCurrentDragSuppressed&&this._emitEvent("update",t,x)):(this._addPointer(t),this._emitEvent("added",t,x),this.isCurrentDragSuppressed=this.isSuppressed):(this._updatePointer(t),this.pointerType=
v.data.startEvent.pointerType,this.mouseButton=v.data.startEvent.button,this.startStateModifiers=v.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this._emitEvent("start",t,x))}};b._createClass(e,[{key:"isSuppressed",get:function(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&"touch"===this.pointerType&&1===this.activePointerMap.size}}]);return e}(l.InputHandler);a.Button=void 0;(function(d){d[d.Left=0]="Left";
d[d.Middle=1]="Middle";d[d.Right=2]="Right";d[d.Back=3]="Back";d[d.Forward=4]="Forward";d[d.Undefined=-1]="Undefined"})(a.Button||(a.Button={}));a.Drag=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/recognizers/support":function(){define(["exports","../../../core/screenUtils"],function(a,b){a.euclideanDistance=function(c,m){const l=m.x-c.x;c=m.y-c.y;return Math.sqrt(l*l+c*c)};a.fitCircleLSQ=function(c,m){m?(m.radius=0,m.center.x=0,m.center.y=
0):m={radius:0,center:b.createScreenPoint()};if(0===c.length)return m;if(1===c.length)return m.center.x=c[0].x,m.center.y=c[0].y,m;if(2===c.length){const [t,x]=c,[B,q]=[x.x-t.x,x.y-t.y];m.radius=Math.sqrt(B*B+q*q)/2;m.center.x=(t.x+x.x)/2;m.center.y=(t.y+x.y)/2;return m}let l=0,r=0;for(m=0;m<c.length;m++)l+=c[m].x,r+=c[m].y;l/=c.length;r/=c.length;var n=c.map(t=>t.x-l),g=c.map(t=>t.y-r);let k=m=0;var f=0,d=0,e=0,h=0,v=0;for(var w=0;w<n.length;w++){const t=n[w],x=g[w],B=t*t,q=x*x;m+=B;k+=q;f+=t*x;
d+=B*t;e+=q*x;h+=t*q;v+=x*B}n=m;g=f;w=k;d=.5*(d+h);e=.5*(e+v);v=n*w-f*g;h=(d*w-e*g)/v;e=(n*e-f*d)/v;v=b.createScreenPoint(h+l,e+r);return{radius:Math.sqrt(h*h+e*e+(m+k)/c.length),center:v}};a.manhattanDistance=function(c,m){return Math.abs(m.x-c.x)+Math.abs(m.y-c.y)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/recognizers/ImmediateDoubleClick":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/clock ../InputHandler ./SingleAndDoubleClick ./support".split(" "),
function(a,b,c,m,l,r){m=function(n){function g(f=l.DefaultParameters.maximumDoubleClickDelay,d=l.DefaultParameters.maximumDoubleClickDistance,e=l.DefaultParameters.maximumDoubleTouchDelay,h=l.DefaultParameters.maximumDoubleTouchDistance,v=c.clock){var w=n.call(this,!1)||this;w.maximumDoubleClickDelay=f;w.maximumDoubleClickDistance=d;w.maximumDoubleTouchDelay=e;w.maximumDoubleTouchDistance=h;w._clock=v;w._pointerState=new Map;w._immediateDoubleClick=w.registerOutgoing("immediate-double-click");w.registerIncoming("pointer-down",
w._handlePointerDown.bind(b._assertThisInitialized(w)));w.registerIncoming("pointer-up",t=>{w._handlePointerLoss(t,"pointer-up")});w.registerIncoming("pointer-capture-lost",t=>{w._handlePointerLoss(t,"pointer-capture-lost")});w.registerIncoming("pointer-cancel",t=>{w._handlePointerLoss(t,"pointer-cancel")});return w}b._inheritsLoose(g,n);var k=g.prototype;k.onUninstall=function(){this._pointerState.forEach(f=>{f.immediateDoubleClick&&f.immediateDoubleClick.timeoutHandle.remove()});n.prototype.onUninstall.call(this)};
k._handlePointerDown=function(f){f=f.data;const d=this._pointerId(f);this._pointerState.has(d)||(this._pointerState.set(d,{downButton:f.native.button,immediateDoubleClick:null}),this.startCapturingPointer(f.native))};k._handlePointerLoss=function(f,d){const e=f.data;var h=this._pointerId(e);if((h=this._pointerState.get(h))&&"pointer-up"===d&&h.downButton===e.native.button)if(d=h.immediateDoubleClick){d.timeoutHandle.remove();const v="touch"===f.data.native.pointerType?this.maximumDoubleTouchDistance:
this.maximumDoubleClickDistance;r.manhattanDistance(d,f.data)>v?this._startImmediateDoubleClick(f,h):(this._immediateDoubleClick.emit(f.data,void 0,d.modifiers),this._removeState(e))}else this._startImmediateDoubleClick(f,h)};k._startImmediateDoubleClick=function(f,d){d.immediateDoubleClick={x:f.data.x,y:f.data.y,modifiers:f.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(f.data),"touch"===f.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)}};
k._pointerId=function(f){f=f.native;return"mouse"===f.pointerType?`${f.pointerId}:${f.button}`:`${f.pointerType}`};k._removeState=function(f){const d=this._pointerId(f);this._pointerState.delete(d);this.stopCapturingPointer(f.native);this.refreshHasPendingInputs()};return g}(m.InputHandler);a.ImmediateDoubleClick=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/clock ../../../core/MapUtils ../../../core/maybe ../InputHandler ./support".split(" "),
function(a,b,c,m,l,r,n){const g={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};r=function(k){function f(e=g.maximumDoubleClickDelay,h=g.maximumDoubleClickDistance,v=g.maximumDoubleTouchDelay,w=g.maximumDoubleTouchDistance,t=c.clock){var x=k.call(this,!1)||this;x.maximumDoubleClickDelay=e;x.maximumDoubleClickDistance=h;x.maximumDoubleTouchDelay=v;x.maximumDoubleTouchDistance=w;x._clock=t;x._pointerState=new Map;x._click=x.registerOutgoing("click");
x._doubleClick=x.registerOutgoing("double-click");x.registerIncoming("immediate-click",x._handleImmediateClick.bind(b._assertThisInitialized(x)));x.registerIncoming("pointer-drag",x._handlePointerDrag.bind(b._assertThisInitialized(x)));x.registerIncoming("drag",x._handleDrag.bind(b._assertThisInitialized(x)));return x}b._inheritsLoose(f,k);var d=f.prototype;d.onUninstall=function(){this._pointerState.forEach(e=>e.doubleClickTimeout=l.removeMaybe(e.doubleClickTimeout))};d._pointerId=function(e){e=
e.native;return"mouse"===e.pointerType?`${e.pointerId}:${e.button}`:`${e.pointerType}`};d._handleImmediateClick=function(e){const h=e.data,v=this._pointerId(h),w=this._pointerState.get(v);if(w){const t="touch"===h.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;n.manhattanDistance(w.event.data,h)>t?(this._clearDoubleClickTimeout(v,!0),this._startClick(e)):(this._clearDoubleClickTimeout(v,!1),this._doubleClick.emit(w.event.data,void 0,w.event.modifiers))}else this._startClick(e)};
d._startClick=function(e){const h=this._pointerId(e.data);this._pointerState.set(h,{event:e,doubleClickTimeout:this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(h),"touch"===e.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)});this.refreshHasPendingInputs()};d._handlePointerDrag=function(e){e=this._pointerId(e.data.currentEvent);this._clearDoubleClickTimeout(e,!0)};d._handleDrag=function(e){e=this._pointerId(e.data.pointer);this._clearDoubleClickTimeout(e,
!0)};d._clearDoubleClickTimeout=function(e,h){const v=this._pointerState.get(e);v&&(v.doubleClickTimeout.remove(),v.doubleClickTimeout=null,h&&this._doubleClickTimeoutExceeded(e),this._pointerState.delete(e),this.refreshHasPendingInputs())};d._doubleClickTimeoutExceeded=function(e){const h=this._pointerState.get(e);this._click.emit(h.event.data,void 0,h.event.modifiers);h.doubleClickTimeout=null;this._pointerState.delete(e);this.refreshHasPendingInputs()};b._createClass(f,[{key:"hasPendingInputs",
get:function(){return m.someMap(this._pointerState,e=>null!=e.doubleClickTimeout)}}]);return f}(r.InputHandler);a.DefaultParameters=g;a.SingleAndDoubleClick=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/clock","../InputHandler","./support"],function(a,b,c,m,l){const r={maximumClickDelay:300,movementUntilMouseDrag:1.5,
movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};m=function(n){function g(f=r.maximumClickDelay,d=r.movementUntilMouseDrag,e=r.movementUntilPenDrag,h=r.movementUntilTouchDrag,v=r.holdDelay,w=c.clock){var t=n.call(this,!1)||this;t.maximumClickDelay=f;t.movementUntilMouseDrag=d;t.movementUntilPenDrag=e;t.movementUntilTouchDrag=h;t.holdDelay=v;t._clock=w;t._pointerState=new Map;t._pointerDrag=t.registerOutgoing("pointer-drag");t._immediateClick=t.registerOutgoing("immediate-click");t._pointerHold=
t.registerOutgoing("hold");t.registerIncoming("pointer-down",t._handlePointerDown.bind(b._assertThisInitialized(t)));t.registerIncoming("pointer-up",x=>{t._handlePointerLoss(x,"pointer-up")});t.registerIncoming("pointer-capture-lost",x=>{t._handlePointerLoss(x,"pointer-capture-lost")});t.registerIncoming("pointer-cancel",x=>{t._handlePointerLoss(x,"pointer-cancel")});t._moveHandle=t.registerIncoming("pointer-move",t._handlePointerMove.bind(b._assertThisInitialized(t)));t._moveHandle.pause();return t}
b._inheritsLoose(g,n);var k=g.prototype;k.onUninstall=function(){this._pointerState.forEach(f=>{null!=f.holdTimeout&&(f.holdTimeout.remove(),f.holdTimeout=null)});n.prototype.onUninstall.call(this)};k._handlePointerDown=function(f){const d=f.data,e=d.native.pointerId;var h=null;0===this._pointerState.size&&(h=this._clock.setTimeout(()=>{const v=this._pointerState.get(e);v&&(v.isDragging||(this._pointerHold.emit(v.previousEvent,void 0,f.modifiers),v.holdEmitted=!0),v.holdTimeout=null)},this.holdDelay));
h={startEvent:d,previousEvent:d,startTimestamp:f.timestamp,isDragging:!1,downButton:d.native.button,holdTimeout:h,modifiers:new Set};this._pointerState.set(e,h);this.startCapturingPointer(d.native);this._moveHandle.resume();1<this._pointerState.size&&this._startDragging(f)};k._createPointerDragData=function(f,d,e){return{action:f,startEvent:d.startEvent,previousEvent:d.previousEvent,currentEvent:e}};k._handlePointerMove=function(f){const d=f.data,e=this._pointerState.get(d.native.pointerId);if(e){if(e.isDragging)this._pointerDrag.emit(this._createPointerDragData("update",
e,d),void 0,e.modifiers);else{const h=l.euclideanDistance(d,e.startEvent),v=this._getDragThreshold(d.native.pointerType);h>v&&this._startDragging(f)}e.previousEvent=d}};k._getDragThreshold=function(f){switch(f){case "touch":return this.movementUntilTouchDrag;case "pen":return this.movementUntilPenDrag;default:return this.movementUntilMouseDrag}};k._startDragging=function(f){const d=f.data,e=d.native.pointerId;this._pointerState.forEach(h=>{null!=h.holdTimeout&&(h.holdTimeout.remove(),h.holdTimeout=
null);h.isDragging||(h.modifiers=f.modifiers,h.isDragging=!0,e===h.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",h,d)):this._pointerDrag.emit(this._createPointerDragData("start",h,h.previousEvent),f.timestamp))})};k._handlePointerLoss=function(f,d){const e=f.data,h=e.native.pointerId,v=this._pointerState.get(h);v&&(null!=v.holdTimeout&&(v.holdTimeout.remove(),v.holdTimeout=null),v.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",v,"pointer-up"===
d?e:v.previousEvent),void 0,v.modifiers):"pointer-up"===d&&v.downButton===e.native.button&&f.timestamp-v.startTimestamp<=this.maximumClickDelay&&!v.holdEmitted&&this._immediateClick.emit(e),this._pointerState.delete(h),this.stopCapturingPointer(e.native),0===this._pointerState.size&&this._moveHandle.pause())};return g}(m.InputHandler);a.DefaultParameters=r;a.PointerClickHoldAndDrag=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../DragEventSeparator","../InputHandler"],function(a,b,c,m){m=function(l){function r(g=20,k=40){var f=l.call(this,!1)||this;f._threshold=g;f._maxDelta=k;f.state="ready";f.emittedArtificalEnd2=!1;f._vertical=f.registerOutgoing("vertical-two-finger-drag");f._artificalDrag=f.registerOutgoing("drag");f.dragEventSeparator=new c.DragEventSeparator({start:(d,e)=>f._observeStart(d,e),update:(d,e,h)=>f._observeUpdate(d,e,h),end:(d,e)=>f._observeEnd(e)});f.registerIncoming("drag",
d=>f.dragEventSeparator.handle(d));return f}b._inheritsLoose(r,l);var n=r.prototype;n._observeStart=function(g,k){1===g&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:k.data.button,buttons:k.data.buttons,pointerType:k.data.pointerType,timestamp:k.data.timestamp,pointers:k.data.pointers,pointer:k.data.pointer,angle:k.data.angle,radius:k.data.radius,center:k.data.center}),k.stopPropagation());this.state=2===g?"ready":"failed"};n._observeUpdate=
function(g,k,f){"failed"!==this.state&&2===g&&("active"===this.state?(this._vertical.emit({delta:k.data.center.y-this._thresholdReachedCenter.y,action:"update"}),k.stopPropagation()):this._checkMovementWithinLimits(k.data,f.data)?this._checkVerticalThresholdReached(k.data,f.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=k.data.center,this._artificalDrag.emit({action:"end",button:k.data.button,buttons:k.data.buttons,pointerType:k.data.pointerType,timestamp:k.data.timestamp,
pointers:k.data.pointers,pointer:k.data.pointer,angle:k.data.angle,radius:k.data.radius,center:k.data.center}),this._vertical.emit({delta:k.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),k.stopPropagation()):this.state="failed")};n._observeEnd=function(g){"active"===this.state&&(this._vertical.emit({delta:g.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",g.stopPropagation())};n._checkMovementWithinLimits=function(g,k){let f=-Infinity,d=Infinity,e=-Infinity,
h=Infinity;k.pointers.forEach(B=>{f=Math.max(f,B.x);d=Math.min(d,B.x);e=Math.max(e,B.y);h=Math.min(h,B.y)});let v=-Infinity,w=Infinity,t=-Infinity,x=Infinity;g.pointers.forEach(B=>{v=Math.max(v,B.x);w=Math.min(w,B.x);t=Math.max(t,B.y);x=Math.min(x,B.y)});return Math.abs(g.center.x-k.center.x)<this._threshold&&Math.abs(v-w-(f-d))<=this._maxDelta&&Math.abs(t-x-(e-h))<=this._maxDelta};n._checkVerticalThresholdReached=function(g,k){let f=Math.abs(g.center.y-k.center.y);g.pointers.forEach((d,e)=>{e=k.pointers.get(e);
f=Math.min(f,Math.abs(d.y-e.y))});return f>=this._threshold};b._createClass(r,[{key:"failed",get:function(){return"failed"===this.state}}]);return r}(m.InputHandler);a.VerticalTwoFingerDrag=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/DragEventSeparator":function(){define(["exports"],function(a){let b=function(){function c(l){this.callbacks=l;this.currentCount=0;this.callbacks.condition||(this.callbacks.condition=()=>!0)}var m=c.prototype;
m.handle=function(l){const r=l.data,n=r.pointers.size;switch(r.action){case "start":this.currentCount=n;this._emitStart(l);break;case "added":this._emitEnd(this.previousEvent);this.currentCount=n;this._emitStart(l);break;case "update":this._emitUpdate(l);break;case "removed":this.startEvent&&this._emitEnd(this.previousEvent);this.currentCount=n;this._emitStart(l);break;case "end":this._emitEnd(l),this.currentCount=0}this.previousEvent=l};m._emitStart=function(l){this.startEvent=l;this.callbacks.condition(this.currentCount,
l)&&this.callbacks.start(this.currentCount,l,this.startEvent)};m._emitUpdate=function(l){this.callbacks.condition(this.currentCount,l)&&this.callbacks.update(this.currentCount,l,this.startEvent)};m._emitEnd=function(l){this.callbacks.condition(this.currentCount,l)&&this.callbacks.end(this.currentCount,l,this.startEvent);this.startEvent=null};return c}();a.DragEventSeparator=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/GraphicsDeconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Handles ../../../../core/MapUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/set ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/boundedPlane ./Deconflictor ./enums ./LabelDeconflictor ../../../support/Scheduler".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B){function q(C){C=C.layer;return!(!C||!C.featureReduction||"selection"!==C.featureReduction.type)}function u(C){(C=C.graphics3DGraphics)&&C.forEach(z=>z.clearVisibilityFlag(t.VisibilityFlag.DECONFLICTION))}a.GraphicsDeconflictor=function(C){function z(){var p=C.apply(this,arguments)||this;p._handles=new m;p._contexts=new Map;p._viewState=new w.DeconflictorViewState;p.visibilityGroup=t.VisibilityGroup.GRAPHIC;p._iconMarginFactor=-.1;return p}b._inheritsLoose(z,
C);var A=z.prototype;A.initialize=function(){this._handles.add([n.watch(()=>{var p,y;return null==(p=this.view)?void 0:null==(y=p.state)?void 0:y.camera},()=>{this._updateViewState();this.setDirty()}),n.watch(()=>{var p,y,D;return null==(p=this.view)?void 0:null==(y=p.map)?void 0:null==(D=y.ground)?void 0:D.opacity},(p,y)=>{1!==p&&1!==y||this.setDirty()}),n.watch(()=>{var p;return null==(p=this.view)?void 0:p.slicePlane},()=>{this._updateSlicePlane();this._slicePlaneChanged()},n.initial)]);this._frameTask=
this.view.resourceController.scheduler.registerTask(B.TaskPriority.GRAPHICS_DECONFLICTOR,this);this._labels=new x.LabelDeconflictor({view:this.view,parent:this})};A.destroy=function(){this._labels.destroy();this._labels=null;this._handles.destroy();this._handles=null;this._frameTask&&(this._frameTask.remove(),this._frameTask=null)};A.setDirty=function(){0<this._contexts.size&&(C.prototype.setDirty.call(this),this._labels.setDirty())};A.runTask=function(p){C.prototype.runTask.call(this,p);this.running||
this._labels.setDirty()};A.setInitialIconVisibilityFlag=function(p,y){p=!(this._graphicSupportsDeconfliction(y)&&q(p));y.setVisibilityFlag(t.VisibilityFlag.DECONFLICTION,p,t.VisibilityGroup.GRAPHIC)};A._updateViewState=function(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())};A._updateSlicePlane=function(){const p=this.view?this.view.slicePlane:null;r.isSome(p)&&v.transform(p,this._viewState.camera.viewMatrix,this._viewState.slicePlane);
this._viewState.slicePlaneEnabled=r.isSome(p)};A._slicePlaneChanged=function(){l.someMap(this._contexts,(p,y)=>y.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()};A.addGraphicsOwner=function(p){let y=this._contexts.get(p);null==y&&(y=new Map,this._contexts.set(p,y),this.setDirty());return{addGraphic:D=>this._addGraphic(p,y,D),removeGraphic:D=>this._removeGraphic(y,D),labelingInfoChange:()=>this._labels.enabledChanged(p,y),featureReductionChange:()=>this.enabledChanged(p,y),slicePlaneEnabledChange:()=>
this._slicePlaneEnabledChanged(p,y),clear:()=>y.forEach(D=>this._removeGraphic(y,D.graphics3DGraphic))}};A.removeGraphicsOwner=function(p){const y=this._contexts.get(p);y&&(y.forEach(D=>this._removeGraphic(y,D.graphics3DGraphic)),this._contexts.delete(p),this.setDirty())};A._addGraphic=function(p,y,D){const E=D.graphic.uid;D=new w.DeconflictorGraphic(D,p.symbolCreationContext.slicePlaneEnabled);y.set(E,D);q(p)&&this.addToActiveGraphics(D);p.labelsEnabled&&this._labels.addToActiveGraphics(D)};A._removeGraphic=
function(p,y){y=y.graphic.uid;const D=p.get(y);D&&(this.removeFromActiveGraphics(D),this._labels.removeFromActiveGraphics(D),p.delete(y),this.setDirty())};A.enabledChanged=function(p,y){const D=q(p);D||u(p);this.modifyGraphics(y,D)};A._slicePlaneEnabledChanged=function(p,y){const D=p.symbolCreationContext.slicePlaneEnabled;y.forEach(E=>E.slicePlaneEnabled=D);this.setDirty()};A.getGraphicsLayers=function(p){return p.graphics};A._graphicSupportsDeconfliction=function(p){if(p.isDraped)return!1;p=p.graphics;
if(!p||!p.length)return!1;for(const y of p)if(this.layerSupportsDeconfliction(y))return!0;return!1};b._createClass(z,[{key:"labels",get:function(){return this._labels}},{key:"viewState",get:function(){return this._viewState}},{key:"iconMarginFactor",get:function(){return this._iconMarginFactor},set:function(p){this._iconMarginFactor=p;this.setDirty()}}]);return z}(w.Deconflictor);a.GraphicsDeconflictor=c.__decorate([h.subclass("esri.views.3d.layers.graphics.GraphicsDeconflictor")],a.GraphicsDeconflictor);
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/mathUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/projectionEllipsoid ../../../../geometry/support/aaBoundingRect ../../../../chunks/boundedPlane ../../../../geometry/support/ray ../../../../chunks/sphere ./deconflictorDebug ./enums ../../support/debugFlags ../../webgl-engine/lib/Camera ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K){function*N(ia){if(Map.prototype.entries){ia=ia.entries();for(let ka=ia.next();!ka.done;ka=ia.next())yield ka.value[1]}else yield*ia.values()}function*M(ia,ka,la){ka.clear();ia.forEach((ea,ba)=>{const Z=ka.pushNew();Z.id=ba;Z.prio=ea.info?-ea.info[la].distance:Number.MAX_VALUE});yield;const Y=ka.iterableSort((ea,ba)=>ba.prio-ea.prio);for(let ea=Y.next();!ea.done;ea=Y.next())yield;ka.forAll(ea=>{const ba=ia.get(ea.id);ba&&(ia.delete(ea.id),
ia.set(ea.id,ba))});ka.clear()}const L=x.create(),J=q.create(),H=q.create(),I=x.create(),O=v.create(),Q=p.create(),S=A.create(),T=x.create(),U=C.create();let aa=function(){this.aabr=C.create();this.distance=0;this.visible=this.culled=!1},W=function(){function ia(){this.active=new Map;this.visible=new Map}ia.prototype.clear=function(){this.active.clear();this.visible.clear()};return ia}(),R=function(){},V=function(){this.sortArray=new n({allocator:ia=>ia||new R})};a.State=void 0;(function(ia){ia[ia.Idle=
0]="Idle";ia[ia.Process=1]="Process";ia[ia.Sort=2]="Sort";ia[ia.Deconflict=3]="Deconflict";ia[ia.NumStates=4]="NumStates"})(a.State||(a.State={}));let da=function(){function ia(){this.camera=new F.Camera;this.slicePlane=z.create();this.slicePlaneEnabled=!1}ia.prototype.copyFrom=function(ka){this.camera.copyFrom(ka.camera);z.copy(ka.slicePlane,this.slicePlane);this.slicePlaneEnabled=ka.slicePlaneEnabled};return ia}();a.Deconflictor=function(ia){function ka(){var Y=ia.apply(this,arguments)||this;Y._dirty=
!1;Y._runningViewState=new da;Y._state=a.State.Idle;Y.graphics=new W;Y.iterators=new V;Y.accBinsNumX=15;Y.accBinsNumY=20;Y.accBinsSizeX=0;Y.accBinsSizeY=0;Y.accBins=null;Y.accNumTests=0;return Y}b._inheritsLoose(ka,ia);var la=ka.prototype;la.destroy=function(){this.graphics.clear();this.iterators=null};la.setDirty=function(){!this._dirty&&0<this.graphics.active.size&&(this._dirty=!0,this.notifyChange("updating"))};la.runTask=function(Y){switch(this._state){case a.State.Idle:this._startUpdate(),Y.madeProgress();
case a.State.Process:if(this._state=a.State.Process,!this._processActiveGraphics(Y))break;case a.State.Sort:if(this._state=a.State.Sort,!this._sortVisibleGraphics(Y))break;case a.State.Deconflict:if(this._state=a.State.Deconflict,!this._deconflictVisibleGraphics(Y))break;default:y.drawAccelerationStruct(this,this.graphics.visible),this._state=a.State.Idle,this.notifyChange("updating")}};la.modifyGraphics=function(Y,ea){ea?Y.forEach(ba=>this.addToActiveGraphics(ba)):Y.forEach(ba=>this.removeFromActiveGraphics(ba));
this.setDirty()};la.layerSupportsDeconfliction=function(Y){if(r.isNone(Y)||"object3d"!==Y.type)return!1;Y=Y.stageObject;return 1===(Y?Y.geometryRecords.length:0)&&Y.geometryRecords[0].material instanceof K.HUDMaterial?!0:!1};la._startUpdate=function(){y.prepare(this.view);this._dirty=!1;this._runningViewState.copyFrom(this.viewState);const {fullWidth:Y,fullHeight:ea}=this._runningViewState.camera;this._initBins(Y,ea);this._resetIterators()};la.addToActiveGraphics=function(Y){Y.info[this.visibilityGroup]=
new aa;this.graphics.active.set(Y.graphics3DGraphic.graphic.uid,Y);this.setDirty()};la.removeFromActiveGraphics=function(Y){this._removeFromVisibleGraphics(Y);{const ea=Y.graphics3DGraphic;ea.destroyed||ea.clearVisibilityFlag(D.VisibilityFlag.DECONFLICTION,this.visibilityGroup)}delete Y.info[this.visibilityGroup];this.graphics.active.delete(Y.graphics3DGraphic.graphic.uid);this.setDirty()};la._addToVisibleGraphics=function(Y){this.graphics.visible.set(Y.graphics3DGraphic.graphic.uid,Y)};la._removeFromVisibleGraphics=
function(Y){this.graphics.visible.delete(Y.graphics3DGraphic.graphic.uid)};la._processActiveGraphics=function(Y){const ea=this._ensureActiveGraphicsIterator(),ba=h.invert(O,this._runningViewState.camera.projectionMatrix),Z="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&0<this._runningViewState.camera.relativeElevation?Q:null;let fa=0;r.isSome(Z)&&(t.transformMat4(Z,x.ZEROS,this._runningViewState.camera.viewMatrix),Z[3]=u.getReferenceEllipsoid(this.view.spatialReference).radius,
fa=p.distanceToSilhouette(Z,x.ZEROS));for(;!Y.done;){Y.madeProgress();var ja=ea.next();if(!0===ja.done)return this._resetActiveGraphicsIterator(),!0;const oa=(ja=ja.value)&&ja.info[this.visibilityGroup];oa&&(this._collectGraphics3DGraphics(ja,ba,Z,fa),oa.culled?this._removeFromVisibleGraphics(ja):this._addToVisibleGraphics(ja))}return!1};la._sortVisibleGraphics=function(Y){const ea=this._ensureSortGraphicsIterator();for(;!Y.done;){const ba=ea.next();Y.madeProgress();if(!0===ba.done)return this._resetSortGraphicsIterator(),
!0}return!1};la._deconflictVisibleGraphics=function(Y){const ea=this._ensureVisibleGraphicsIterator(),ba=this.visibilityGroup===D.VisibilityGroup.LABEL;for(;!Y.done;){Y.madeProgress();var Z=ea.next();if(!0===Z.done)return this._resetVisibleGraphicsIterator(),!0;Z=Z.value;const ja=Z.info[this.visibilityGroup];if(ja&&!ja.culled){var fa=Z.graphics3DGraphic;(fa=(!ba||fa.isVisible())&&!this._isConflicted(Z))&&this._addToBins(Z);ja.visible=fa;this._setGraphicVisibility(Z,fa);y.drawPoly(ja,fa)}}return!1};
la._resetIterators=function(){this.iterators.active=null;this.iterators.visible=null;this.iterators.sort=null};la._ensureActiveGraphicsIterator=function(){this.iterators.active||(this.iterators.active=N(this.graphics.active));return this.iterators.active};la._resetActiveGraphicsIterator=function(){this.iterators.active=null};la._ensureVisibleGraphicsIterator=function(){this.iterators.visible||(this.iterators.visible=N(this.graphics.visible));return this.iterators.visible};la._resetVisibleGraphicsIterator=
function(){this.iterators.visible=null};la._ensureSortGraphicsIterator=function(){this.iterators.sort||(this.iterators.sort=M(this.graphics.visible,this.iterators.sortArray,this.visibilityGroup));return this.iterators.sort};la._resetSortGraphicsIterator=function(){this.iterators.sort=null};la._collectGraphics3DGraphics=function(Y,ea,ba,Z){var fa=Y.graphics3DGraphic;if(!fa.destroyed){var ja=Y.info[this.visibilityGroup];if(fa.isVisible(D.VisibilityGroup.GRAPHIC,D.VisibilityFlag.DECONFLICTION)){var oa=
this.getGraphicsLayers(fa);C.empty(ja.aabr);fa=null;for(const sa of oa)if(this.layerSupportsDeconfliction(sa)){oa=sa.stageObject.geometryRecords[0].material;if(r.isNone(fa)){fa=this._getProjectionInfo(sa,ea,ha);if(fa.isOutsideScreen||this._isCulledBySlice(Y,L)||r.isSome(ba)&&this._isCulledByHorizon(fa,ba,Z)){ja.culled=!0;return}!E.TESTS_DISABLE_OPTIMIZATIONS&&ja.visible&&(fa.distance*=.7)}this._expandBoundingRect(ja,sa,oa,fa)}r.isNone(fa)?ja.culled=!0:(ja.distance=fa.distance,ja.culled=!1)}else ja.culled=
!0}};la._getProjectionInfo=function(Y,ea,ba){const Z=this._runningViewState.camera;Y=Y.stageObject;var fa=Y.geometryRecords[0];const ja=fa.material;var oa=p.getCenter(Y.boundingVolumeWorldSpace.bounds);t.transformMat4(L,oa,Z.viewMatrix);oa=fa.geometry.vertexAttributes;fa=oa.get(P.VertexAttribute.NORMAL).data;oa=oa.get(P.VertexAttribute.AUXPOS1).data;ja.applyShaderOffsetsView(L,fa,Y.transformation,oa,Z,ba.scaleInfo,L);B.set(J,L[0],L[1],L[2],1);B.transformMat4(H,J,Z.projectionMatrix);t.scale(ba.positionNDC,
H,1/H[3]);ja.applyShaderOffsetsNDC(ba.positionNDC,oa,Z,ba.positionNDC,I);ba.distanceWithoutPolygonOffset=Z.depthNDCToWorld(I[2]);ba.distance=I[2]===ba.positionNDC[2]?ba.distanceWithoutPolygonOffset:Z.depthNDCToWorld(ba.positionNDC[2]);B.set(H,ba.positionNDC[0],ba.positionNDC[1],ba.positionNDC[2],1);B.transformMat4(J,H,ea);B.scale(J,J,1/J[3]);t.set(ba.positionView,L[0],L[1],L[2]);return ba};la._isCulledByHorizon=function(Y,ea,ba){t.copy(S.direction,Y.positionView);t.set(S.origin,0,0,0);return p.intersectRay(ea,
S,T)?Y.distanceWithoutPolygonOffset>ba:!1};la._isCulledBySlice=function(Y,ea){return Y.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&z.extrusionContainsPoint(this._runningViewState.slicePlane,ea)};la._expandBoundingRect=function(Y,ea,ba,{positionNDC:Z,scaleInfo:fa}){const ja=this._runningViewState.camera;ea=ea.getScreenSize(ca);G.applyPrecomputedScaleFactor(ea,fa.factor,ea);ea[0]*=ja.pixelRatio;ea[1]*=ja.pixelRatio;ba=C.offset(ba.calculateRelativeScreenBounds(ea,fa.factorAlignment.scale,
U),l.lerp(0,ja.fullWidth,.5+.5*Z[0]),l.lerp(0,ja.fullHeight,.5+.5*Z[1]));Z=this.iconMarginFactor;0!==Z&&(Z*=Math.min(C.width(ba),C.height(ba)),ba[0]-=Z,ba[1]-=Z,ba[2]+=Z,ba[3]+=Z);C.expand(Y.aabr,ba,Y.aabr)};la._isConflicted=function(Y){const ea=Y.graphics3DGraphic.graphic.uid;Y=Y.info[this.visibilityGroup];for(let ba=Math.floor(Y.aabr[0]/this.accBinsSizeX);ba<=Math.floor(Y.aabr[2]/this.accBinsSizeX);ba++)if(!(0>ba||ba>=this.accBinsNumX))for(let Z=Math.floor(Y.aabr[1]/this.accBinsSizeY);Z<=Math.floor(Y.aabr[3]/
this.accBinsSizeY);Z++){if(0>Z||Z>=this.accBinsNumY)continue;const fa=this.accBins[ba][Z];for(let ja=0;ja<fa.length;ja++){const oa=fa.data[ja],sa=oa.info[this.visibilityGroup];if(sa&&sa.visible&&oa.graphics3DGraphic.graphic.uid!==ea&&(this.accNumTests++,C.intersects(sa.aabr,Y.aabr)))return!0}}return!1};la._initBins=function(Y,ea){if(null==this.accBins){this.accBins=[];for(var ba=0;ba<this.accBinsNumX;ba++){this.accBins.push([]);var Z=this.accBins[this.accBins.length-1];for(let fa=0;fa<this.accBinsNumY;fa++)Z.push(new n)}}else for(ba=
0;ba<this.accBinsNumX;ba++)for(Z=0;Z<this.accBinsNumY;Z++)this.accBins[ba][Z].clear();this.accBinsSizeX=Y/this.accBinsNumX;this.accBinsSizeY=ea/this.accBinsNumY;this.accNumTests=0};la._addToBins=function(Y){var ea=Y.info[this.visibilityGroup],ba=Math.floor(ea.aabr[0]/this.accBinsSizeX);const Z=Math.floor(ea.aabr[2]/this.accBinsSizeX),fa=Math.floor(ea.aabr[1]/this.accBinsSizeY);for(ea=Math.floor(ea.aabr[3]/this.accBinsSizeY);ba<=Z;ba++)if(!(0>ba||ba>=this.accBinsNumX))for(let ja=fa;ja<=ea;ja++)0>ja||
ja>=this.accBinsNumY||this.accBins[ba][ja].push(Y)};la._setGraphicVisibility=function(Y,ea){Y=Y.graphics3DGraphic;Y.destroyed||(Y.setVisibilityFlag(D.VisibilityFlag.DECONFLICTION,ea,this.visibilityGroup),this.visibilityGroup===D.VisibilityGroup.LABEL&&this.view.labeler.setLabelGraphicVisibility(Y,ea))};b._createClass(ka,[{key:"dirty",get:function(){return this._dirty}},{key:"state",get:function(){return this._state}},{key:"updating",get:function(){return this._state!==a.State.Idle||this._dirty}},
{key:"updatingProgress",get:function(){if(!this.updating)return 1;const Y=this._state/a.State.NumStates;return this._dirty?.5*Y:Y}},{key:"running",get:function(){return this.view.ready&&null!=this.view.state&&this.updating}}]);return ka}(m);c.__decorate([g.property({constructOnly:!0})],a.Deconflictor.prototype,"view",void 0);c.__decorate([g.property({type:Boolean,readOnly:!0})],a.Deconflictor.prototype,"updating",null);a.Deconflictor=c.__decorate([e.subclass("esri.views.3d.layers.graphics.Deconflictor")],
a.Deconflictor);const ca=w.create(),ha=new (function(){function ia(){this.positionView=x.create();this.positionNDC=x.create();this.distanceWithoutPolygonOffset=this.distance=0;this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}}}b._createClass(ia,[{key:"isOutsideScreen",get:function(){const ka=this.positionNDC;return-1>ka[0]||-1>ka[1]||-1>ka[2]||1<=ka[0]||1<=ka[1]}}]);return ia}());a.DeconflictorGraphic=function(ia,
ka,la={}){this.graphics3DGraphic=ia;this.slicePlaneEnabled=ka;this.info=la};a.DeconflictorViewState=da;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["exports","../../support/debugFlags"],function(a,b){function c(d,e,h,v,w){g&&(g(),g=null);const t=k.height,x=f;x.beginPath();x.lineWidth=1;x.strokeStyle=w;x.moveTo(d,t-h);x.lineTo(e,t-h);x.stroke();x.lineTo(e,t-v);x.stroke();x.lineTo(e,t-
h);x.stroke();x.lineTo(d,t-h);x.stroke();x.lineTo(d,t-h);x.stroke();x.closePath()}let m=!1,l=!1,r=!1,n=!1,g=null,k,f;a.drawAccelerationStruct=function(d,e){if(l&&f){g&&(g(),g=null);var h=f,v=0;for(let w=0;w<d.accBinsNumX;w++)for(let t=0;t<d.accBinsNumY;t++){const x=d.accBins[w][d.accBinsNumY-1-t];v+=x.length;const B=w*d.accBinsSizeX,q=(w+1)*d.accBinsSizeX,u=t*d.accBinsSizeY,C=(t+1)*d.accBinsSizeY;h.fillText(x.length.toFixed(),B+5,u+15);c(B,q,u,C,"blue")}h.fillText("total totalShownLabels: "+v,70,
40);h.fillText("total visible labels: "+e.size,70,50);h.fillText("total numTests: "+d.accNumTests,70,30)}};a.drawPoly=function(d,e){m&&(e&&r||!e&&n)&&c(d.aabr[0],d.aabr[2],d.aabr[1],d.aabr[3],e?"green":"red")};a.prepare=function(d){r=b.DECONFLICTOR_SHOW_VISIBLE;n=b.DECONFLICTOR_SHOW_INVISIBLE;m=r||n;l=b.DECONFLICTOR_SHOW_GRID;g=null;m||l?g=()=>{{null==k&&(k=document.createElement("canvas"),k.setAttribute("id","canvas2d"),d.surface.parentElement.style.position="relative",d.surface.parentElement.appendChild(k));
var {state:e}=d;const {camera:h,pixelRatio:v}=e,{width:w,height:t}=h;e=t*v;k.setAttribute("width",`${w*v}px`);k.setAttribute("height",`${e}px`);k.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${w}px;height:${t}px`);f=k.getContext("2d");f.clearRect(0,0,w,t);f.font="12px Arial"}}:k&&(k.parentElement.removeChild(k),k=null)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/debugFlags":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,m,l,r,n,g){c=function(k){function f(){var d=k.apply(this,arguments)||this;d.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1;d.DECONFLICTOR_SHOW_VISIBLE=!1;d.DECONFLICTOR_SHOW_INVISIBLE=!1;d.DECONFLICTOR_SHOW_GRID=!1;d.LABELS_SHOW_BORDER=!1;d.TEXT_SHOW_BASELINE=!1;d.TEXT_SHOW_BORDER=!1;d.OVERLAY_DRAW_DEBUG_TEXTURE=!1;d.OVERLAY_SHOW_CENTER=!1;d.SHOW_POI=!1;d.TESTS_DISABLE_OPTIMIZATIONS=!1;d.TESTS_DISABLE_FAST_UPDATES=!1;d.DRAW_MESH_GEOMETRY_NORMALS=!1;d.FEATURE_TILE_FETCH_SHOW_TILES=!1;d.FEATURE_TILE_TREE_SHOW_TILES=
!1;d.TERRAIN_TILE_TREE_SHOW_TILES=!1;d.I3S_TREE_SHOW_TILES=!1;d.I3S_SHOW_MODIFICATIONS=!1;d.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1;d.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1;d.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1;d.LINE_WIREFRAMES=!1;return d}a._inheritsLoose(f,k);return f}(c);b.__decorate([m.property()],c.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0);b.__decorate([m.property()],c.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0);b.__decorate([m.property()],c.prototype,"DECONFLICTOR_SHOW_INVISIBLE",
void 0);b.__decorate([m.property()],c.prototype,"DECONFLICTOR_SHOW_GRID",void 0);b.__decorate([m.property()],c.prototype,"LABELS_SHOW_BORDER",void 0);b.__decorate([m.property()],c.prototype,"TEXT_SHOW_BASELINE",void 0);b.__decorate([m.property()],c.prototype,"TEXT_SHOW_BORDER",void 0);b.__decorate([m.property()],c.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0);b.__decorate([m.property()],c.prototype,"OVERLAY_SHOW_CENTER",void 0);b.__decorate([m.property()],c.prototype,"SHOW_POI",void 0);b.__decorate([m.property()],
c.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0);b.__decorate([m.property()],c.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0);b.__decorate([m.property()],c.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);b.__decorate([m.property()],c.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);b.__decorate([m.property()],c.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);b.__decorate([m.property()],c.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0);b.__decorate([m.property()],c.prototype,"I3S_TREE_SHOW_TILES",
void 0);b.__decorate([m.property()],c.prototype,"I3S_SHOW_MODIFICATIONS",void 0);b.__decorate([m.property()],c.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0);b.__decorate([m.property()],c.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0);b.__decorate([m.property()],c.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0);b.__decorate([m.property()],c.prototype,"LINE_WIREFRAMES",void 0);c=b.__decorate([g.subclass("esri.views.3d.support.DebugFlags")],c);return new c})},"esri/views/3d/layers/graphics/enums":function(){define(["exports"],
function(a){a.VisibilityGroup=void 0;(function(b){b[b.GRAPHIC=0]="GRAPHIC";b[b.LABEL=1]="LABEL";b[b._COUNT=2]="_COUNT"})(a.VisibilityGroup||(a.VisibilityGroup={}));a.VisibilityFlag=void 0;(function(b){b[b.USER_SETTING=0]="USER_SETTING";b[b.SCALE_RANGE=1]="SCALE_RANGE";b[b.FILTER=2]="FILTER";b[b.DECONFLICTION=3]="DECONFLICTION";b[b._COUNT=4]="_COUNT"})(a.VisibilityFlag||(a.VisibilityFlag={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils","../../../ViewingMode"],function(a,b,c,m){function l(e,h,v){const w=v.parameters;v=v.paddingPixelsOverride;f.scale=Math.min(w.divisor/(h-w.offset),1);f.factor=Math.abs(e*e*e);f.minPixelSize=w.minPixelSize;f.paddingPixels=v;return f}function r(e,h){return 0===e?h.minPixelSize:h.minPixelSize*(1+2*h.paddingPixels/e)}function n(e,h){return Math.max(c.lerp(e*h.scale,e,h.factor),r(e,h))}let g=function(){function e(v,w,t,x={camera:{distance:0,
fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0},B){this.viewingMode=v;this.description=w;this.ellipsoidRadius=t;this.parameters=x;this._paddingPixelsOverride=B;this.viewingMode===m.ViewingMode.Local?(this.coverageCompensation=this._surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this._surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}
var h=e.prototype;h.update=function(v){if(this.parameters&&this.parameters.camera.fovY===v.fovY&&this.parameters.camera.distance===v.distance)return!1;this._calculateParameters(v,this.ellipsoidRadius,this.parameters);return!0};h.overridePadding=function(v){return v!==this.paddingPixelsOverride?new e(this.viewingMode,this.description,this.ellipsoidRadius,this.parameters,v):this};h._calculateParameters=function(v,w,t){const {scaleStart:x,scaleFallOffRange:B,minPixelSize:q}=this.description,{fovY:u,
distance:C}=v;var z=this.calculateCurvatureDependentParameters(v,w);w=this.coverageCompensation(v,w,z);const {tiltAngle:A,scaleFallOffFactor:p}=z,y=Math.sin(A)*C,D=.5*Math.PI-A-u*(.5-x*w);z=y/Math.cos(D);w=(z-y/Math.cos(D+u*B*w)*p)/(1-p);t.camera.fovY=v.fovY;t.camera.distance=v.distance;t.offset=w;t.divisor=z-w;t.minPixelSize=q;return t};h._calculateCurvatureDependentParametersLocal=function(v,w,t=d){t.tiltAngle=this.description.curvatureDependent.min.tiltAngle;t.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor;
return t};h._calculateCurvatureDependentParametersGlobal=function(v,w,t=d){const x=this.description.curvatureDependent;v=1+v.distance/w;v=Math.sqrt(v*v-1);const [B,q]=[x.min.curvature,x.max.curvature];v=c.clamp((v-B)/(q-B),0,1);const [u,C]=[x.min,x.max];t.tiltAngle=c.lerp(u.tiltAngle,C.tiltAngle,v);t.scaleFallOffFactor=c.lerp(u.scaleFallOffFactor,C.scaleFallOffFactor,v);return t};h._surfaceCoverageCompensationLocal=function(v,w,t){return(v.fovY-t.tiltAngle)/v.fovY};h._surfaceCoverageCompensationGlobal=
function(v,w,t){const x=w*w;t=t.tiltAngle+.5*Math.PI;const {fovY:B,distance:q}=v;v=q*q+x-2*Math.cos(t)*q*w;const u=Math.sqrt(v);return(Math.acos(Math.sqrt(v-x)/u)-Math.asin(w/(u/Math.sin(t)))+.5*B)/B};b._createClass(e,[{key:"paddingPixelsOverride",get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels}}]);return e}();const k={curvatureDependent:{min:{curvature:c.deg2rad(10),tiltAngle:c.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:c.deg2rad(70),tiltAngle:c.deg2rad(40),
scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},f={scale:0,factor:0,minPixelSize:0,paddingPixels:0},d={tiltAngle:0,scaleFallOffFactor:0};a.applyPrecomputedScaleFactor=function(e,h,v=[0,0]){h=Math.min(Math.max(h.scale,r(e[1],h)/Math.max(1E-5,e[1])),1);v[0]=e[0]*h;v[1]=e[1]*h;return v};a.applyScaleFactor=n;a.getLabelSettings=function(e,h){const {curvatureDependent:v,scaleStart:w,scaleFallOffRange:t}=k;return new g(e,{curvatureDependent:{min:{curvature:v.min.curvature,tiltAngle:v.min.tiltAngle,
scaleFallOffFactor:.7},max:{curvature:v.max.curvature,tiltAngle:v.max.tiltAngle,scaleFallOffFactor:.95}},scaleStart:w,scaleFallOffRange:t,minPixelSize:14},h)};a.getSettings=function(e,h){return new g(e,k,h)};a.precomputeScaleFactor=function(e,h,v,w){e=l(e,h,v);e.minPixelSize=0;e.paddingPixels=0;e=n(1,e);w.scale=e;w.factor=0;w.minPixelSize=v.parameters.minPixelSize;w.paddingPixels=v.paddingPixelsOverride};a.scale=function(e,h,v,w){return n(e,l(h,v,w))};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../core/libs/gl-matrix-2/types/mat4 ../../../../geometry/support/aaBoundingRect ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/hud/HUD.glsl ../lib/geometryDataUtils ../lib/GLTextureMaterial ../lib/Material ../lib/RenderSlot ../lib/screenSizePerspectiveUtils ../lib/Util ../lib/VertexAttribute ./internal/bufferWriterUtils ./internal/MaterialUtil ./renderers/utils ../../../../chunks/HUDMaterial.glsl ../shaders/HUDMaterialTechnique ../shaders/HUDMaterialTechniqueConfiguration".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K){function N(ba,Z,fa,ja=O){k.copy(ja,ba.anchorPosition);ja[0]*=-Z[0];ja[1]*=-Z[1];ja[0]+=ba.screenOffset[0]*fa;ja[1]+=ba.screenOffset[1]*fa;return ja}function M(ba,Z,fa,ja,oa,sa,qa,Ha){Z=Z-oa-(0<Ha[0]?ja[0]*Ha[0]:0);let Ga=Z+ja[0]+2*oa;fa=fa-oa-(0<Ha[1]?ja[1]*Ha[1]:0);oa=fa+ja[1]+2*oa;Ha=qa.distanceFieldBoundingBox;qa.textureIsSignedDistanceField&&m.isSome(Ha)&&(Z+=ja[0]*Ha[0],fa+=ja[1]*Ha[1],Ga-=ja[0]*(1-Ha[2]),oa-=ja[1]*(1-Ha[3]),
Z-=sa,Ga+=sa,fa-=sa,oa+=sa);return ba[0]>Z&&ba[0]<Ga&&ba[1]>fa&&ba[1]<oa}let L=function(ba){function Z(ja){ja=ba.call(this,ja,new la)||this;ja.techniqueConfig=new K.HUDMaterialTechniqueConfiguration;return ja}b._inheritsLoose(Z,ba);var fa=Z.prototype;fa.getConfiguration=function(ja,oa){this.techniqueConfig.output=ja;this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane;this.techniqueConfig.hasVerticalOffset=!!this.parameters.verticalOffset;this.techniqueConfig.hasScreenSizePerspective=
!!this.parameters.screenSizePerspective;this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?B.HUDSpace.Screen:B.HUDSpace.World;this.techniqueConfig.hasPolygonOffset=this.parameters.polygonOffset;this.techniqueConfig.isDraped=this.parameters.isDraped;this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest;this.techniqueConfig.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled;this.techniqueConfig.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField;
this.techniqueConfig.vvSize=!!this.parameters.vvSizeEnabled;this.techniqueConfig.vvColor=!!this.parameters.vvColorEnabled;ja===x.ShaderOutput.Color&&(this.techniqueConfig.debugDrawLabelBorder=!!this.parameters.debugDrawLabelBorder);ja===x.ShaderOutput.Highlight&&(this.techniqueConfig.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion);this.techniqueConfig.depthEnabled=this.parameters.depthEnabled;this.techniqueConfig.transparencyPassType=oa.transparencyPassType;this.techniqueConfig.hasMultipassGeometry=
oa.multipassGeometry.enabled;this.techniqueConfig.hasMultipassTerrain=oa.multipassTerrain.enabled;this.techniqueConfig.cullAboveGround=oa.multipassTerrain.cullAboveGround;return this.techniqueConfig};fa.intersect=function(ja,oa,sa,qa,Ha,Ga,pa,Da,ra){m.isSome(ra)?this._intersectDrapedHudGeometry(ja,Ga,pa,Da,ra):this._intersectHudGeometry(ja,oa,sa,qa,pa,Da)};fa._intersectDrapedHudGeometry=function(ja,oa,sa,qa,Ha){const Ga=ja.vertexAttributes.get(y.VertexAttribute.POSITION),pa=ja.vertexAttributes.get(y.VertexAttribute.SIZE),
Da=this.parameters,ra=G.calculateAnchorPosForRendering(Da);let Ea=1;var Ia=1;m.isSome(qa)&&(Ia=qa(ha),Ea=Ia[0],Ia=Ia[5]);Ea*=ja.screenToWorldRatio;Ia*=ja.screenToWorldRatio;qa=2*ja.screenToWorldRatio;for(let Qa=0;Qa<Ga.data.length/Ga.size;Qa++){var Ma=Qa*Ga.size;const wa=Ga.data[Ma];Ma=Ga.data[Ma+1];const Ja=Qa*pa.size;ia[0]=pa.data[Ja]*Ea;ia[1]=pa.data[Ja+1]*Ia;let Ta;Da.textureIsSignedDistanceField&&(Ta=Da.outlineSize*ja.screenToWorldRatio/2);M(oa,wa,Ma,ia,qa,Ta,Da,ra)&&sa(Ha.dist,Ha.normal,-1,
!1)}};fa._intersectHudGeometry=function(ja,oa,sa,qa,Ha,Ga){if(qa.options.selectionMode&&qa.options.hud&&!F.isInstanceHidden(oa)){oa=this.parameters;var pa=1,Da=1;l.fromMat4(W,sa);if(m.isSome(Ga)){Da=Ga(ha);pa=Da[0];Da=Da[5];{Ga=W;var ra=Ga[0],Ea=Ga[1],Ia=Ga[2],Ma=Ga[3],Qa=Ga[4],wa=Ga[5],Ja=Ga[6],Ta=Ga[7],Xa=Ga[8],ma=1/Math.sqrt(ra*ra+Ea*Ea+Ia*Ia);const $a=1/Math.sqrt(Ma*Ma+Qa*Qa+wa*wa),xa=1/Math.sqrt(Ja*Ja+Ta*Ta+Xa*Xa);Ga[0]=ra*ma;Ga[1]=Ea*ma;Ga[2]=Ia*ma;Ga[3]=Ma*$a;Ga[4]=Qa*$a;Ga[5]=wa*$a;Ga[6]=
Ja*xa;Ga[7]=Ta*xa;Ga[8]=Xa*xa}}Ga=ja.vertexAttributes.get(y.VertexAttribute.POSITION);ra=ja.vertexAttributes.get(y.VertexAttribute.SIZE);Ea=ja.vertexAttributes.get(y.VertexAttribute.NORMAL);ja=ja.vertexAttributes.get(y.VertexAttribute.AUXPOS1);p.assert(3<=Ga.size);Ia=qa.point;Ma=qa.camera;Qa=G.calculateAnchorPosForRendering(oa);pa*=Ma.pixelRatio;Da*=Ma.pixelRatio;wa="screen"===this.parameters.centerOffsetUnits;for(Ja=0;Ja<Ga.data.length/Ga.size;Ja++)if(Ta=Ja*Ga.size,d.set(Q,Ga.data[Ta],Ga.data[Ta+
1],Ga.data[Ta+2]),d.transformMat4(Q,Q,sa),Ta=Ja*ra.size,ia[0]=ra.data[Ta]*pa,ia[1]=ra.data[Ta+1]*Da,d.transformMat4(Q,Q,Ma.viewMatrix),Ta=Ja*ja.size,d.set(da,ja.data[Ta+0],ja.data[Ta+1],ja.data[Ta+2]),wa||(Q[0]+=da[0],Q[1]+=da[1],0!==da[2]&&(Ta=da[2],d.normalize(da,Q),d.subtract(Q,Q,d.scale(da,da,Ta)))),Ta=Ja*Ea.size,d.set(S,Ea.data[Ta],Ea.data[Ta+1],Ea.data[Ta+2]),this._normalAndViewAngle(S,W,Ma,ca),this._applyVerticalOffsetTransformationView(Q,ca,Ma,I),Ma.applyProjection(Q,T),-1<T[0]){T[0]=Math.floor(T[0]);
T[1]=Math.floor(T[1]);wa&&(da[0]||da[1])&&(T[0]+=da[0],0!==da[1]&&(T[1]+=A.applyScaleFactor(da[1],I.factorAlignment)),Ma.unapplyProjection(T,Q));T[0]+=this.parameters.screenOffset[0];T[1]+=this.parameters.screenOffset[1];A.applyPrecomputedScaleFactor(ia,I.factor,ia);Ta=1*Ma.pixelRatio;let $a;oa.textureIsSignedDistanceField&&($a=oa.outlineSize*Ma.pixelRatio/2);M(Ia,T[0],T[1],ia,Ta,$a,oa,Qa)&&(Xa=qa.ray,d.transformMat4(aa,Q,n.invert(V,Ma.viewMatrix)),T[0]=Ia[0],T[1]=Ia[1],Ma.unprojectFromRenderScreen(T,
Q)&&(Ta=e.create(),d.copy(Ta,Xa.direction),ma=1/d.length(Ta),d.scale(Ta,Ta,ma),Xa=d.distance(Xa.origin,Q)*ma,Ha(Xa,Ta,-1,!0,1,aa)))}}};fa.computeAttachmentOrigin=function(ja,oa){var sa=ja.vertexAttributes;if(!sa)return!1;sa=sa.get(y.VertexAttribute.POSITION);ja=ja.indices.get(y.VertexAttribute.POSITION);return q.computeAttachmentOriginPoints(sa,ja,oa)};fa.createBufferWriter=function(){return new ea(this)};fa._normalAndViewAngle=function(ja,oa,sa,qa){v.isMat4(oa)&&(oa=l.fromMat4(R,oa));d.transformMat3(qa.normal,
ja,oa);d.transformMat4(qa.normal,qa.normal,sa.viewInverseTransposeMatrix);qa.cosAngle=d.dot(U,ka);return qa};fa._updateScaleInfo=function(ja,oa,sa){const qa=this.parameters;m.isSome(qa.screenSizePerspective)?A.precomputeScaleFactor(sa,oa,qa.screenSizePerspective,ja.factor):(ja.factor.scale=1,ja.factor.factor=0,ja.factor.minPixelSize=0,ja.factor.paddingPixels=0);m.isSome(qa.screenSizePerspectiveAlignment)?A.precomputeScaleFactor(sa,oa,qa.screenSizePerspectiveAlignment,ja.factorAlignment):(ja.factorAlignment.factor=
ja.factor.factor,ja.factorAlignment.scale=ja.factor.scale,ja.factorAlignment.minPixelSize=ja.factor.minPixelSize,ja.factorAlignment.paddingPixels=ja.factor.paddingPixels)};fa.applyShaderOffsetsView=function(ja,oa,sa,qa,Ha,Ga,pa){oa=this._normalAndViewAngle(oa,sa,Ha,ca);this._applyVerticalGroundOffsetView(ja,oa,Ha,pa);this._applyVerticalOffsetTransformationView(pa,oa,Ha,Ga);this._applyPolygonOffsetView(pa,oa,qa[3],Ha,pa);this._applyCenterOffsetView(pa,qa,pa);return pa};fa.applyShaderOffsetsNDC=function(ja,
oa,sa,qa,Ha){this._applyCenterOffsetNDC(ja,oa,sa,qa);m.isSome(Ha)&&d.copy(Ha,qa);this._applyPolygonOffsetNDC(qa,oa,sa,qa);return qa};fa._applyPolygonOffsetView=function(ja,oa,sa,qa,Ha){var Ga=qa.aboveGround?1:-1;sa=Math.sign(sa);0===sa&&(sa=Ga);Ga*=sa;if(0>=this.parameters.shaderPolygonOffset)return d.copy(Ha,ja);oa=c.clamp(Math.abs(oa.cosAngle),.01,1);qa=1-Math.sqrt(1-oa*oa)/oa/qa.viewport[2];0<Ga?d.scale(Ha,ja,qa):d.scale(Ha,ja,1/qa);return Ha};fa._applyVerticalGroundOffsetView=function(ja,oa,sa,
qa){const Ha=d.length(ja),Ga=sa.aboveGround?1:-1;sa=.5*sa.computeRenderPixelSizeAtDist(Ha);oa=d.scale(Q,oa.normal,Ga*sa);d.add(qa,ja,oa);return qa};fa._applyVerticalOffsetTransformationView=function(ja,oa,sa,qa){const Ha=this.parameters;if(!Ha.verticalOffset||!Ha.verticalOffset.screenLength){if(Ha.screenSizePerspective||Ha.screenSizePerspectiveAlignment){var Ga=d.length(ja);this._updateScaleInfo(qa,Ga,oa.cosAngle)}else qa.factor.scale=1,qa.factorAlignment.scale=1;return ja}Ga=d.length(ja);const pa=
m.unwrapOr(Ha.screenSizePerspectiveAlignment,Ha.screenSizePerspective);sa=E.verticalOffsetAtDistance(sa,Ga,Ha.verticalOffset,oa.cosAngle,pa);this._updateScaleInfo(qa,Ga,oa.cosAngle);d.scale(oa.normal,oa.normal,sa);return d.add(ja,ja,oa.normal)};fa._applyCenterOffsetView=function(ja,oa,sa){const qa="screen"!==this.parameters.centerOffsetUnits;sa!==ja&&d.copy(sa,ja);qa&&(sa[0]+=oa[0],sa[1]+=oa[1],oa[2]&&(d.normalize(S,sa),d.add(sa,sa,d.scale(S,S,oa[2]))));return sa};fa._applyCenterOffsetNDC=function(ja,
oa,sa,qa){const Ha="screen"!==this.parameters.centerOffsetUnits;qa!==ja&&d.copy(qa,ja);Ha||(qa[0]+=oa[0]/sa.fullWidth*2,qa[1]+=oa[1]/sa.fullHeight*2);return qa};fa._applyPolygonOffsetNDC=function(ja,oa,sa,qa){const Ha=this.parameters.shaderPolygonOffset;ja!==qa&&d.copy(qa,ja);Ha&&(ja=sa.aboveGround?1:-1,qa[2]-=(ja*Math.sign(oa[3])||ja)*Ha);return qa};fa.requiresSlot=function(ja){if(ja===z.RenderSlot.DRAPED_MATERIAL)return!0;const {drawInSecondSlot:oa,occlusionTest:sa}=this.parameters;return ja===
(oa?z.RenderSlot.LABEL_MATERIAL:z.RenderSlot.HUD_MATERIAL)||sa&&ja===z.RenderSlot.OCCLUSION_PIXELS};fa.createGLMaterial=function(ja){return ja.output===x.ShaderOutput.Color||ja.output===x.ShaderOutput.Alpha?new H(ja):ja.output===x.ShaderOutput.Highlight?new J(ja):null};fa.calculateRelativeScreenBounds=function(ja,oa,sa=w.create()){N(this.parameters,ja,oa,sa);sa[2]=sa[0]+ja[0];sa[3]=sa[1]+ja[1];return sa};return Z}(C.Material),J=function(ba){function Z(ja){return ba.call(this,{...ja,...ja.material.parameters})||
this}b._inheritsLoose(Z,ba);var fa=Z.prototype;fa.selectProgram=function(ja){return this.ensureTechnique(P.HUDMaterialTechnique,ja)};fa.beginSlot=function(ja){this.updateTexture(this._material.parameters.textureId);this._material.setParameters(this.textureBindParameters);return this.selectProgram(ja)};return Z}(u.GLTextureMaterial),H=function(ba){function Z(){return ba.apply(this,arguments)||this}b._inheritsLoose(Z,ba);var fa=Z.prototype;fa._isOcclusionSlot=function(ja){return ja.slot===z.RenderSlot.OCCLUSION_PIXELS&&
this._material.parameters.occlusionTest&&(this._output===x.ShaderOutput.Color||this._output===x.ShaderOutput.Alpha)};fa.selectProgram=function(ja){return this.ensureTechnique(P.HUDMaterialTechnique,ja,this._isOcclusionSlot(ja)?x.ShaderOutput.Occlusion:this._output)};return Z}(J);const I={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},O=f.create(),Q=e.create(),S=e.create(),T=h.create(),U=e.create(),aa=e.create(),W=r.create(),
R=r.create(),V=g.create(),da=e.create(),ca={normal:U,cosAngle:0},ha=g.create(),ia=[0,0],ka=e.fromValues(0,0,1);let la=function(ba){function Z(){var fa=ba.apply(this,arguments)||this;fa.renderOccluded=C.RenderOccludedFlag.Occlude;fa.color=[1,1,1,1];fa.texCoordScale=[1,1];fa.polygonOffset=!1;fa.anchorPosition=f.fromValues(.5,.5);fa.screenOffset=[0,0];fa.shaderPolygonOffset=1E-5;fa.textureIsSignedDistanceField=!1;fa.outlineColor=[1,1,1,1];fa.outlineSize=0;fa.vvSizeEnabled=!1;fa.vvSizeMinSize=[1,1,1];
fa.vvSizeMaxSize=[100,100,100];fa.vvSizeOffset=[0,0,0];fa.vvSizeFactor=[1,1,1];fa.vvColorEnabled=!1;fa.vvColorValues=[0,0,0,0,0,0,0,0];fa.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0];fa.hasSlicePlane=!1;fa.pixelSnappingEnabled=!0;fa.occlusionTest=!0;fa.binaryHighlightOcclusion=!0;fa.debugDrawLabelBorder=!1;fa.centerOffsetUnits="world";fa.drawInSecondSlot=!1;fa.depthEnabled=!0;fa.isDraped=!1;return fa}b._inheritsLoose(Z,ba);return Z}(u.GLTextureMaterialBindParameters);
const Y=t.newLayout().vec3f(y.VertexAttribute.POSITION).vec3f(y.VertexAttribute.NORMAL).vec2f(y.VertexAttribute.UV0).vec4u8(y.VertexAttribute.COLOR).vec2f(y.VertexAttribute.SIZE).vec4f(y.VertexAttribute.AUXPOS1).vec4f(y.VertexAttribute.AUXPOS2);let ea=function(){function ba(fa){this.material=fa;this.vertexBufferLayout=Y}var Z=ba.prototype;Z.allocate=function(fa){return this.vertexBufferLayout.createBuffer(fa)};Z.elementCount=function(fa){return 6*fa.indices.get(y.VertexAttribute.POSITION).length};
Z.write=function(fa,ja,oa,sa){D.writePosition(ja.indices.get(y.VertexAttribute.POSITION),ja.vertexAttributes.get(y.VertexAttribute.POSITION).data,fa.transformation,oa.position,sa,6);D.writeNormal(ja.indices.get(y.VertexAttribute.NORMAL),ja.vertexAttributes.get(y.VertexAttribute.NORMAL).data,fa.invTranspTransformation,oa.normal,sa,6);var qa=ja.vertexAttributes.get(y.VertexAttribute.UV0).data;if(null==qa||4>qa.length){qa=this.material.parameters;var Ha=fa=0;var Ga=qa.texCoordScale[0];qa=qa.texCoordScale[1]}else fa=
qa[0],Ha=qa[1],Ga=qa[2],qa=qa[3];Ga=Math.min(1.99999,Ga+1);qa=Math.min(1.99999,qa+1);var pa=ja.indices.get(y.VertexAttribute.POSITION).length,Da=oa.uv0,ra=sa;for(var Ea=0;Ea<pa;++Ea)Da.set(ra,0,fa),Da.set(ra,1,Ha),ra+=1,Da.set(ra,0,Ga),Da.set(ra,1,Ha),ra+=1,Da.set(ra,0,Ga),Da.set(ra,1,qa),ra+=1,Da.set(ra,0,Ga),Da.set(ra,1,qa),ra+=1,Da.set(ra,0,fa),Da.set(ra,1,qa),ra+=1,Da.set(ra,0,fa),Da.set(ra,1,Ha),ra+=1;D.writeColor(ja.indices.get(y.VertexAttribute.COLOR),ja.vertexAttributes.get(y.VertexAttribute.COLOR).data,
4,oa.color,sa,6);fa=ja.indices.get(y.VertexAttribute.SIZE);Ha=ja.vertexAttributes.get(y.VertexAttribute.SIZE).data;Ga=fa.length;qa=oa.size;pa=sa;for(Da=0;Da<Ga;++Da){ra=Ha[2*fa[Da]];Ea=Ha[2*fa[Da]+1];for(let Ia=0;6>Ia;++Ia)qa.set(pa,0,ra),qa.set(pa,1,Ea),pa+=1}ja.indices.get(y.VertexAttribute.AUXPOS1)&&ja.vertexAttributes.get(y.VertexAttribute.AUXPOS1)&&D.writeBufferVec4(ja.indices.get(y.VertexAttribute.AUXPOS1),ja.vertexAttributes.get(y.VertexAttribute.AUXPOS1).data,oa.auxpos1,sa,6);ja.indices.get(y.VertexAttribute.AUXPOS2)&&
ja.vertexAttributes.get(y.VertexAttribute.AUXPOS2)&&D.writeBufferVec4(ja.indices.get(y.VertexAttribute.AUXPOS2),ja.vertexAttributes.get(y.VertexAttribute.AUXPOS2).data,oa.auxpos2,sa,6)};return ba}();a.HUDMaterial=L;a.Parameters=la;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/libs/gl-matrix-2/types/mat4":function(){define(["exports"],function(a){function b(m){return m instanceof Float32Array&&16<=m.length}function c(m){return Array.isArray(m)&&
16<=m.length}a.isMat4=function(m){return b(m)||c(m)};a.isMat4f32=b;a.isMat4f64=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions":function(){define(["exports"],function(a){a.ShaderOutput=void 0;var b=a.ShaderOutput||(a.ShaderOutput={});b[b.Color=0]="Color";b[b.Depth=1]="Depth";b[b.Normal=2]="Normal";b[b.Shadow=3]="Shadow";b[b.Highlight=4]="Highlight";b[b.Draped=5]="Draped";b[b.Occlusion=
6]="Occlusion";b[b.Alpha=7]="Alpha";b[b.COUNT=8]="COUNT";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl":function(){define("exports ../attributes/VerticalOffset.glsl ./HUDUniforms ../util/ScreenSizePerspective.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/Texture2DPassUniform ../../../lib/VertexAttribute".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){a.HUDSpace=void 0;(function(e){e[e.World=0]="World";e[e.Screen=1]="Screen";e[e.COUNT=2]="COUNT"})(a.HUDSpace||(a.HUDSpace={}));a.HUD=function(e,h){e.include(m.ScreenSizePerspective);e.attributes.add(d.VertexAttribute.POSITION,"vec3");e.attributes.add(d.VertexAttribute.NORMAL,"vec3");e.attributes.add(d.VertexAttribute.AUXPOS1,"vec4");const v=e.vertex;l.addProjViewLocalOrigin(e,h);l.addCameraPosition(v,h);v.uniforms.add([new r.Float4PassUniform("viewport",(w,t)=>t.camera.fullViewport),
new n.FloatPassUniform("polygonOffset",w=>w.shaderPolygonOffset),new n.FloatPassUniform("cameraGroundRelative",(w,t)=>t.camera.aboveGround?1:-1),new n.FloatPassUniform("renderTransparentlyOccludedHUD",(w,t)=>t.renderTransparentlyOccludedHUD===c.HUDTransparentRenderStyle.Occluded?1:t.renderTransparentlyOccludedHUD===c.HUDTransparentRenderStyle.NotOccluded?0:.75),new f.Texture2DPassUniform("hudVisibilityTexture",(w,t)=>t.hudVisibilityTexture)]);h.hasVerticalOffset&&b.addVerticalOffset(v);v.constants.add("smallOffsetAngle",
"float",.984807753012208);v.code.add(g.glsl`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`);v.code.add(g.glsl`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`);h.isDraped&&!h.hasVerticalOffset||v.uniforms.add(new k.Matrix4PassUniform("viewNormal",(w,t)=>t.camera.viewInverseTransposeMatrix));h.isDraped||(v.uniforms.add(new n.FloatPassUniform("perDistancePixelRatio",(w,t)=>Math.tan(t.camera.fovY/2)/(t.camera.fullViewport[2]/2))),v.code.add(g.glsl`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`));h.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen&&v.uniforms.add(new n.FloatPassUniform("pixelRatio",(w,t)=>t.camera.pixelRatio));h.hasScreenSizePerspective&&m.addScreenSizePerspectiveAlignment(v);v.code.add(g.glsl`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${h.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${h.hasScreenSizePerspective?h.hasVerticalOffset||h.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen?"vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"":""}

      ${h.hasVerticalOffset?h.hasScreenSizePerspective?"float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight \x3d verticalOffset.x;":""}

      ${h.hasVerticalOffset?g.glsl`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${h.screenCenterOffsetUnitsEnabled!==a.HUDSpace.Screen?g.glsl`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${h.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen?h.hasScreenSizePerspective?"float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY \x3d centerOffset.y;":""}

      ${h.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen?"posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `);v.code.add(g.glsl`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":function(){define("exports ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ../util/ScreenSizePerspective.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),function(a,b,c,m,l,r,n){function g(f){f.uniforms.add(new r.Float4PassUniform("verticalOffset",(d,e)=>
{const {minWorldLength:h,maxWorldLength:v,screenLength:w}=d.verticalOffset;return b.set(k,w*(e.camera.pixelRatio||1),Math.tan(.5*e.camera.fovY)/(.5*e.camera.fullViewport[3]),h,v)}))}const k=c.create();a.VerticalOffset=function(f,d){const e=f.vertex;d.hasVerticalOffset?(g(e),d.hasScreenSizePerspective&&(f.include(m.ScreenSizePerspective),m.addScreenSizePerspectiveAlignment(e),l.addCameraPosition(f.vertex,d)),e.code.add(n.glsl`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${d.spherical?n.glsl`vec3 worldNormal = normalize(worldPos + localOrigin);`:n.glsl`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${d.hasScreenSizePerspective?n.glsl`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:n.glsl`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):e.code.add(n.glsl`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)};a.addVerticalOffset=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":function(){define(["exports","../../../../../../chunks/vec4","../../../../../../chunks/vec4f64","../../shaderModules/Float4PassUniform","../../shaderModules/interfaces"],function(a,b,c,m,l){function r(g){return b.set(n,
g.parameters.divisor,g.parameters.offset,g.parameters.minPixelSize,g.paddingPixelsOverride)}const n=c.create();a.ScreenSizePerspective=function(g){g.vertex.code.add(l.glsl`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`);g.vertex.code.add(l.glsl`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`);g.vertex.code.add(l.glsl`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`);g.vertex.code.add(l.glsl`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`);g.vertex.code.add(l.glsl`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`);g.vertex.code.add(l.glsl`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`);g.vertex.code.add(l.glsl`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)};a.addScreenSizePerspective=function(g){g.uniforms.add(new m.Float4PassUniform("screenSizePerspective",k=>r(k.screenSizePerspective)))};a.addScreenSizePerspectiveAlignment=function(g){g.uniforms.add(new m.Float4PassUniform("screenSizePerspectiveAlignment",k=>r(k.screenSizePerspectiveAlignment||k.screenSizePerspective)))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl":function(){define("exports ../../../../../../chunks/mat4 ../../../../../../chunks/mat4f32 ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f64 ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/Matrix4DrawUniform ../../shaderModules/Matrix4PassUniform".split(" "),
function(a,b,c,m,l,r,n,g,k){const f=c.create(),d=l.create();a.addCameraPosition=function(e,h){h.instancedDoublePrecision?e.constants.add("cameraPosition","vec3",l.ZEROS):e.uniforms.add(new r.Float3DrawUniform("cameraPosition",(v,w)=>m.set(d,w.camera.viewInverseTransposeMatrix[3]-v.origin[0],w.camera.viewInverseTransposeMatrix[7]-v.origin[1],w.camera.viewInverseTransposeMatrix[11]-v.origin[2])))};a.addProjViewLocalOrigin=function(e,h){e.vertex.uniforms.add(new k.Matrix4PassUniform("proj",(v,w)=>w.camera.projectionMatrix));
if(h.instancedDoublePrecision){const v=(w,t)=>m.set(d,t.camera.viewInverseTransposeMatrix[3],t.camera.viewInverseTransposeMatrix[7],t.camera.viewInverseTransposeMatrix[11]);e.vertex.uniforms.add(new k.Matrix4PassUniform("view",(w,t)=>b.translate(f,t.camera.viewMatrix,v(w,t))));h=new n.Float3PassUniform("localOrigin",v);e.vertex.uniforms.add(h);return h}e.vertex.uniforms.add(new g.Matrix4DrawUniform("view",(v,w)=>b.translate(f,w.camera.viewMatrix,v.origin)));h=new r.Float3DrawUniform("localOrigin",
v=>v.origin);e.vertex.uniforms.add(h);return h};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,m){c=function(l){function r(n,g){return l.call(this,n,"mat4",m.BindType.Draw,(k,f,d)=>k.setUniformMatrix4fv(n,g(f,d)))||this}b._inheritsLoose(r,l);return r}(c.Uniform);
a.Matrix4DrawUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDUniforms":function(){define(["exports"],function(a){a.HUDTransparentRenderStyle=void 0;var b=a.HUDTransparentRenderStyle||(a.HUDTransparentRenderStyle={});b[b.Occluded=0]="Occluded";b[b.NotOccluded=1]="NotOccluded";b[b.Both=2]="Both";b[b.COUNT=3]="COUNT";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/lib/Material":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../core/shaderModules/interfaces ./ContentObject ./ContentObjectType ./DefaultVertexAttributeLocations ../materials/internal/MaterialUtil".split(" "),function(a,b,c,m,l,r,n,g){l=function(k){function f(e,h){var v=k.call(this)||this;v.type=r.ContentObjectType.Material;v.supportsEdges=!1;v._visible=!0;v._renderPriority=0;v._insertOrder=0;v._vertexAttributeLocations=
n.Default3D;v._parameters=g.copyParameters(e,h);v.validateParameters(v._parameters);return v}b._inheritsLoose(f,k);var d=f.prototype;d.dispose=function(){};d.update=function(e){return!1};d.setParameters=function(e,h=!0){g.updateParameters(this._parameters,e)&&(this.validateParameters(this._parameters),h&&this.parametersChanged())};d.validateParameters=function(e){};d.shouldRender=function(e){return this.isVisible()&&this.isVisibleInPass(e.pass)&&0!==(this.renderOccluded&e.renderOccludedMask)};d.isVisibleInPass=
function(e){return!0};d.isVisible=function(){return this._visible};d.parametersChanged=function(){c.isSome(this.repository)&&this.repository.materialChanged(this)};b._createClass(f,[{key:"parameters",get:function(){return this._parameters}},{key:"visible",get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this.parametersChanged())}},{key:"renderOccluded",get:function(){return this.parameters.renderOccluded}},{key:"renderPriority",get:function(){return this._renderPriority},
set:function(e){e!==this._renderPriority&&(this._renderPriority=e,this.parametersChanged())}},{key:"insertOrder",get:function(){return this._insertOrder},set:function(e){e!==this._insertOrder&&(this._insertOrder=e,this.parametersChanged())}},{key:"vertexAttributeLocations",get:function(){return this._vertexAttributeLocations}}]);return f}(l.ContentObject);a.RenderOccludedFlag=void 0;(function(k){k[k.Occlude=1]="Occlude";k[k.Transparent=2]="Transparent";k[k.OccludeAndTransparent=4]="OccludeAndTransparent";
k[k.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil";k[k.Opaque=16]="Opaque"})(a.RenderOccludedFlag||(a.RenderOccludedFlag={}));m=function(k){function f(){var d=k.apply(this,arguments)||this;d.renderOccluded=a.RenderOccludedFlag.Occlude;return d}b._inheritsLoose(f,k);return f}(m.NoParameters);a.Material=l;a.MaterialParameters=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("exports ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../lib/basicInterfaces ../../lib/screenSizePerspectiveUtils ../../lib/Util ../../lib/VertexAttribute ../renderers/utils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e){function h(D,E,F,G,P,K){if(!m.isNone(D)){var N=t(E,F,z);n.setMin(C,D.getBBMin());n.setMax(C,D.getBBMax());m.isSome(P)&&P.applyToAabb(C);if(x(C,E,N,G)){const {primitiveIndices:M,indices:L,position:J}=D;N=M?M.length:L.length/3;if(1E3<N&&(D=D.getChildren(),void 0!==D)){for(N=0;8>N;++N)void 0!==D[N]&&h(D[N],E,F,G,P,K);return}v(E,F,0,N,L,J,M,P,K)}}}function v(D,E,F,G,P,K,N,M,L){if(N){var J=K.data;K=K.stride||K.size;var H=D[0],I=D[1];D=D[2];var O=E[0]-H,Q=E[1]-I;for(E=
E[2]-D;F<G;++F){var S=N[F],T=3*S,U=K*P[T++],aa=J[U++],W=J[U++],R=J[U];U=K*P[T++];var V=J[U++],da=J[U++],ca=J[U];U=K*P[T];T=J[U++];var ha=J[U++];U=J[U];m.isSome(M)&&([aa,W,R]=M.applyToVertex(aa,W,R,F),[V,da,ca]=M.applyToVertex(V,da,ca,F),[T,ha,U]=M.applyToVertex(T,ha,U,F));V-=aa;da-=W;ca-=R;T-=aa;ha-=W;U-=R;var ia=Q*U-ha*E,ka=E*T-U*O;const Y=O*ha-T*Q;var la=V*ia+da*ka+ca*Y;if(!(Math.abs(la)<=Number.EPSILON)){aa=H-aa;W=I-W;R=D-R;ia=aa*ia+W*ka+R*Y;if(0<la){if(0>ia||ia>la)continue}else if(0<ia||ia<la)continue;
ka=W*ca-da*R;R=R*V-ca*aa;W=aa*da-V*W;aa=O*ka+Q*R+E*W;if(0<la){if(0>aa||ia+aa>la)continue}else if(0<aa||ia+aa<la)continue;R=(T*ka+ha*R+U*W)/la;0<=R&&(V=w(V,da,ca,T,ha,U,A),L(R,V,S,!1))}}}else{N=K.data;J=K.stride||K.size;K=D[0];H=D[1];I=D[2];D=E[0]-K;O=E[1]-H;Q=E[2]-I;for(let Y=F,ea=3*F;Y<G;++Y)if(T=J*P[ea++],W=N[T++],R=N[T++],ca=N[T],T=J*P[ea++],E=N[T++],F=N[T++],S=N[T],T=J*P[ea++],V=N[T++],da=N[T++],T=N[T],m.isSome(M)&&([W,R,ca]=M.applyToVertex(W,R,ca,Y),[E,F,S]=M.applyToVertex(E,F,S,Y),[V,da,T]=
M.applyToVertex(V,da,T,Y)),E-=W,F-=R,S-=ca,V-=W,da-=R,T-=ca,U=O*T-da*Q,aa=Q*V-T*D,la=D*da-V*O,ha=E*U+F*aa+S*la,!(Math.abs(ha)<=Number.EPSILON)){W=K-W;R=H-R;ca=I-ca;U=W*U+R*aa+ca*la;if(0<ha){if(0>U||U>ha)continue}else if(0<U||U<ha)continue;aa=R*S-F*ca;ca=ca*E-S*W;R=W*F-E*R;W=D*aa+O*ca+Q*R;if(0<ha){if(0>W||U+W>ha)continue}else if(0<W||U+W<ha)continue;ca=(V*aa+da*ca+T*R)/ha;0<=ca&&(E=w(E,F,S,V,da,T,A),L(ca,E,Y,!1))}}}function w(D,E,F,G,P,K,N){l.set(p,D,E,F);l.set(y,G,P,K);l.cross(N,p,y);l.normalize(N,
N);return N}function t(D,E,F){return l.set(F,1/(E[0]-D[0]),1/(E[1]-D[1]),1/(E[2]-D[2]))}function x(D,E,F,G){return B(D,E,F,G,Infinity)}function B(D,E,F,G,P){var K=(D[0]-G-E[0])*F[0],N=(D[3]+G-E[0])*F[0];let M=Math.min(K,N);K=Math.max(K,N);N=(D[1]-G-E[1])*F[1];const L=(D[4]+G-E[1])*F[1];K=Math.min(K,Math.max(N,L));if(0>K)return!1;M=Math.max(M,Math.min(N,L));if(M>K)return!1;N=(D[2]-G-E[2])*F[2];D=(D[5]+G-E[2])*F[2];K=Math.min(K,Math.max(N,D));if(0>K)return!1;M=Math.max(M,Math.min(N,D));return M>K?!1:
M<P}function q(D,E){E=E?q(E):{};for(const F in D){let G=D[F];G&&G.forEach&&(G=u(G));null==G&&F in E||(E[F]=G)}return E}function u(D){const E=[];D.forEach(F=>E.push(F));return E}const C=n.create(),z=r.create(),A=r.create(),p=r.create(),y=r.create();a.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};a.computeInvDir=t;a.computeNormal=w;a.copyParameters=q;a.intersectAabbInvDir=x;a.intersectAabbInvDirBefore=B;a.intersectDrapedRenderLineGeometry=function(D,E,F,G,P,K){if(E.options.selectionMode){E=D.vertexAttributes.get(d.VertexAttribute.POSITION).data;
var N=D.vertexAttributes.get(d.VertexAttribute.SIZE),M=G[0];G=G[1];D=(((N&&N.data[0])+P)/2+4)*D.screenToWorldRatio;P=Number.MAX_VALUE;N=0;for(let O=0;O<E.length-5;O+=3){var L=E[O],J=E[O+1],H=M-L,I=G-J;L=E[O+3]-L;J=E[O+4]-J;const Q=c.clamp((L*H+J*I)/(L*L+J*J),0,1);H=L*Q-H;I=J*Q-I;I=H*H+I*I;I<P&&(P=I,N=O/3)}P<D*D&&K(F.dist,F.normal,N,!1)}};a.intersectTriangleGeometry=function(D,E,F,G,P,K,N){e.isInstanceHidden(E)||(D.boundingInfo?(f.assert(D.primitiveType===g.PrimitiveType.Triangle),h(D.boundingInfo,
G,P,F.tolerance,K,N)):(E=D.indices.get(d.VertexAttribute.POSITION),D=D.vertexAttributes.get(d.VertexAttribute.POSITION),v(G,P,0,E.length/3,E,D,void 0,K,N)))};a.intersectTriangles=v;a.updateParameters=function(D,E){let F=!1;for(const G in E){const P=E[G];void 0!==P&&(Array.isArray(P)?null===D[G]?(D[G]=P.slice(),F=!0):b.update(D[G],P)&&(F=!0):D[G]!==P&&(F=!0,D[G]=P))}return F};a.verticalOffsetAtDistance=function(D,E,F,G,P){let K=(F.screenLength||0)*D.pixelRatio;m.isSome(P)&&(K=k.scale(K,G,E,P));return c.clamp(K*
Math.tan(.5*D.fovY)/(.5*D.fullHeight)*E,F.minWorldLength||0,null!=F.maxWorldLength?F.maxWorldLength:Infinity)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/internal/bufferWriterUtils":function(){define(["exports","../../../../../chunks/mat4","../../../../../geometry/support/buffer/BufferView","../../lib/Util","../../lib/VertexAttribute"],function(a,b,c,m,l){function r(h,v,w,t){const x=w.typedBuffer;w=w.typedBufferStride;
const B=h.length;t*=w;for(let q=0;q<B;++q){const u=2*h[q];x[t]=v[u];x[t+1]=v[u+1];t+=w}}function n(h,v,w,t,x){const B=w.typedBuffer;w=w.typedBufferStride;const q=h.length;t*=w;if(null==x||1===x)for(x=0;x<q;++x){var u=3*h[x];B[t]=v[u];B[t+1]=v[u+1];B[t+2]=v[u+2];t+=w}else for(u=0;u<q;++u){const C=3*h[u];for(let z=0;z<x;++z)B[t]=v[C],B[t+1]=v[C+1],B[t+2]=v[C+2],t+=w}}function g(h,v,w,t,x=1){const B=w.typedBuffer;w=w.typedBufferStride;const q=h.length;t*=w;if(1===x)for(x=0;x<q;++x){var u=4*h[x];B[t]=
v[u];B[t+1]=v[u+1];B[t+2]=v[u+2];B[t+3]=v[u+3];t+=w}else for(u=0;u<q;++u){const C=4*h[u];for(let z=0;z<x;++z)B[t]=v[C],B[t+1]=v[C+1],B[t+2]=v[C+2],B[t+3]=v[C+3],t+=w}}function k(h,v,w,t,x,B=1){if(w){var q=t.typedBuffer;t=t.typedBufferStride;var u=h.length,C=w[0],z=w[1],A=w[2],p=w[4],y=w[5],D=w[6],E=w[8],F=w[9],G=w[10],P=w[12],K=w[13];w=w[14];x*=t;if(1===B)for(B=0;B<u;++B){var N=3*h[B],M=v[N],L=v[N+1];N=v[N+2];q[x]=C*M+p*L+E*N+P;q[x+1]=z*M+y*L+F*N+K;q[x+2]=A*M+D*L+G*N+w;x+=t}else for(M=0;M<u;++M){L=
3*h[M];var J=v[L],H=v[L+1];const I=v[L+2];L=C*J+p*H+E*I+P;N=z*J+y*H+F*I+K;J=A*J+D*H+G*I+w;for(H=0;H<B;++H)q[x]=L,q[x+1]=N,q[x+2]=J,x+=t}}else n(h,v,t,x,B)}function f(h,v,w,t,x,B=1){if(w){var q=t.typedBuffer;t=t.typedBufferStride;var u=h.length,C=w[0],z=w[1],A=w[2],p=w[4],y=w[5],D=w[6],E=w[8],F=w[9],G=w[10];w=!b.isOrthoNormal(w);x*=t;if(1===B)for(B=0;B<u;++B){var P=3*h[B],K=v[P],N=v[P+1],M=v[P+2];P=C*K+p*N+E*M;var L=z*K+y*N+F*M;K=A*K+D*N+G*M;w&&(N=P*P+L*L+K*K,.999999>N&&1E-6<N&&(N=1/Math.sqrt(N),P*=
N,L*=N,K*=N));q[x+0]=P;q[x+1]=L;q[x+2]=K;x+=t}else for(P=0;P<u;++P){L=3*h[P];N=v[L];M=v[L+1];const J=v[L+2];L=C*N+p*M+E*J;K=z*N+y*M+F*J;N=A*N+D*M+G*J;w&&(M=L*L+K*K+N*N,.999999>M&&1E-6<M&&(M=1/Math.sqrt(M),L*=M,K*=M,N*=M));for(M=0;M<B;++M)q[x+0]=L,q[x+1]=K,q[x+2]=N,x+=t}}else n(h,v,t,x,B)}function d(h,v,w,t,x,B=1){if(w){var q=t.typedBuffer;t=t.typedBufferStride;var u=h.length,C=w[0],z=w[1],A=w[2],p=w[4],y=w[5],D=w[6],E=w[8],F=w[9],G=w[10];w=!b.isOrthoNormal(w);x*=t;if(1===B)for(B=0;B<u;++B){var P=
4*h[B],K=v[P],N=v[P+1],M=v[P+2];P=v[P+3];var L=C*K+p*N+E*M,J=z*K+y*N+F*M;K=A*K+D*N+G*M;w&&(N=L*L+J*J+K*K,.999999>N&&1E-6<N&&(N=1/Math.sqrt(N),L*=N,J*=N,K*=N));q[x+0]=L;q[x+1]=J;q[x+2]=K;q[x+3]=P;x+=t}else for(P=0;P<u;++P){L=4*h[P];N=v[L];M=v[L+1];const H=v[L+2];L=v[L+3];J=C*N+p*M+E*H;K=z*N+y*M+F*H;N=A*N+D*M+G*H;w&&(M=J*J+K*K+N*N,.999999>M&&1E-6<M&&(M=1/Math.sqrt(M),J*=M,K*=M,N*=M));for(M=0;M<B;++M)q[x+0]=J,q[x+1]=K,q[x+2]=N,q[x+3]=L,x+=t}}else g(h,v,t,x,B)}function e(h,v,w,t,x,B=1){const q=t.typedBuffer;
t=t.typedBufferStride;const u=h.length;x*=t;if(1===B)if(4===w)for(B=0;B<u;++B)w=4*h[B],q[x]=v[w],q[x+1]=v[w+1],q[x+2]=v[w+2],q[x+3]=v[w+3],x+=t;else{if(3===w)for(B=0;B<u;++B)w=3*h[B],q[x]=v[w],q[x+1]=v[w+1],q[x+2]=v[w+2],q[x+3]=255,x+=t}else if(4===w)for(w=0;w<u;++w){var C=4*h[w];for(var z=0;z<B;++z)q[x]=v[C],q[x+1]=v[C+1],q[x+2]=v[C+2],q[x+3]=v[C+3],x+=t}else if(3===w)for(w=0;w<u;++w)for(C=3*h[w],z=0;z<B;++z)q[x]=v[C],q[x+1]=v[C+1],q[x+2]=v[C+2],q[x+3]=255,x+=t}a.writeBufferFloat=function(h,v,w,
t,x=1){const B=w.typedBuffer;w=w.typedBufferStride;const q=h.length;t*=w;if(1===x)for(x=0;x<q;++x)B[t]=v[h[x]],t+=w;else for(let u=0;u<q;++u){const C=v[h[u]];for(let z=0;z<x;z++)B[t]=C,t+=w}};a.writeBufferMat3f=function(h,v,w,t){const x=w.typedBuffer;w=w.typedBufferStride;const B=h.length;t*=w;for(let q=0;q<B;++q){const u=9*h[q];for(let C=0;9>C;++C)x[t+C]=v[u+C];t+=w}};a.writeBufferMat4f=function(h,v,w,t){const x=w.typedBuffer;w=w.typedBufferStride;const B=h.length;t*=w;for(let q=0;q<B;++q){const u=
16*h[q];for(let C=0;16>C;++C)x[t+C]=v[u+C];t+=w}};a.writeBufferVec2=r;a.writeBufferVec3=n;a.writeBufferVec4=g;a.writeColor=e;a.writeDefaultAttributes=function(h,v,w,t,x,B){for(const u of v.fieldNames){v=h.vertexAttributes.get(u);const C=h.indices.get(u);if(v&&C)switch(u){case l.VertexAttribute.POSITION:m.assert(3===v.size);var q=x.getField(u,c.BufferViewVec3f);q&&k(C,v.data,w,q,B);break;case l.VertexAttribute.NORMAL:m.assert(3===v.size);(q=x.getField(u,c.BufferViewVec3f))&&f(C,v.data,t,q,B);break;
case l.VertexAttribute.UV0:m.assert(2===v.size);(q=x.getField(u,c.BufferViewVec2f))&&r(C,v.data,q,B);break;case l.VertexAttribute.COLOR:m.assert(3===v.size||4===v.size);(q=x.getField(u,c.BufferViewVec4u8))&&e(C,v.data,v.size,q,B);break;case l.VertexAttribute.SYMBOLCOLOR:m.assert(3===v.size||4===v.size);(q=x.getField(u,c.BufferViewVec4u8))&&e(C,v.data,v.size,q,B);break;case l.VertexAttribute.TANGENT:m.assert(4===v.size),(q=x.getField(u,c.BufferViewVec4f))&&d(C,v.data,t,q,B)}}};a.writeNormal=f;a.writePosition=
k;a.writeTangent=d;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/HUDMaterial.glsl":function(){define("exports ../core/maybe ./vec2 ./vec2f64 ./vec4f64 ../views/3d/layers/graphics/sdfPrimitives ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4sPassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/FloatsPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/basicInterfaces ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/materials/VisualVariablePassParameters".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F){function G(M){const L=new p.ShaderBuilder;var J=M.signedDistanceFieldEnabled;L.include(k.AlignPixel);L.include(f.HUD,M);L.include(g.SliceDraw,M);if(M.output===n.ShaderOutput.Occlusion)return L.include(d.HUDOcclusionPass,M),L;const {vertex:H,fragment:I}=L;L.include(x.ScreenSizePerspective);I.include(t.RgbaFloatEncoding);I.include(w.ColorConversion);L.include(h.VisualVariables,M);L.varyings.add("vcolor","vec4");L.varyings.add("vtc","vec2");
L.varyings.add("vsize","vec2");M.binaryHighlightOcclusionEnabled&&L.varyings.add("voccluded","float");H.uniforms.add([new q.Float4PassUniform("viewport",(S,T)=>T.camera.fullViewport),new B.Float2PassUniform("screenOffset",(S,T)=>c.set(K,2*S.screenOffset[0]*T.camera.pixelRatio,2*S.screenOffset[1]*T.camera.pixelRatio)),new B.Float2PassUniform("anchorPosition",S=>P(S)),new q.Float4PassUniform("materialColor",S=>S.color),new C.FloatPassUniform("pixelRatio",(S,T)=>T.camera.pixelRatio)]);J&&(H.uniforms.add(new q.Float4PassUniform("outlineColor",
S=>S.outlineColor)),I.uniforms.add([new q.Float4PassUniform("outlineColor",S=>0<S.outlineColor[3]&&0<S.outlineSize?S.outlineColor:l.ZEROS),new C.FloatPassUniform("outlineSize",S=>0<S.outlineColor[3]&&0<S.outlineSize?S.outlineSize:0)]));M.hasScreenSizePerspective&&(x.addScreenSizePerspective(H),x.addScreenSizePerspectiveAlignment(H));(M.debugDrawLabelBorder||M.binaryHighlightOcclusionEnabled)&&L.varyings.add("debugBorderCoords","vec4");L.attributes.add(E.VertexAttribute.UV0,"vec2");L.attributes.add(E.VertexAttribute.COLOR,
"vec4");L.attributes.add(E.VertexAttribute.SIZE,"vec2");L.attributes.add(E.VertexAttribute.AUXPOS2,"vec4");H.code.add(A.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${M.hasScreenSizePerspective?A.glsl`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:A.glsl`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${M.vvSize?"inputSize *\x3d vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${M.occlusionTestEnabled||M.binaryHighlightOcclusionEnabled?"bool visible \x3d testVisibilityHUD(posProj);":""}

      ${M.binaryHighlightOcclusionEnabled?"voccluded \x3d visible ? 0.0 : 1.0;":""}
    `);var O=A.glsl`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`;const Q=M.pixelSnappingEnabled?J?A.glsl`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:A.glsl`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:A.glsl`posProj += quadOffset;`;M.vvColor&&H.uniforms.add([new u.Float4sPassUniform("vvColorColors",S=>S.vvColorColors,F.vvColorNumber),new z.FloatsPassUniform("vvColorValues",S=>S.vvColorValues,F.vvColorNumber)]);H.uniforms.add(new B.Float2PassUniform("textureCoordinateScaleFactor",S=>b.isSome(S.texture)&&b.isSome(S.texture.descriptor.textureCoordinateScaleFactor)?S.texture.descriptor.textureCoordinateScaleFactor:m.ONES));H.code.add(A.glsl`
    ${M.occlusionTestEnabled?"if (visible) {":""}
    ${O}
    ${M.vvColor?"vcolor \x3d vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor \x3d color / 255.0 * materialColor;"}

    bool alphaDiscard = vcolor.a < ${A.glsl.float(v.symbolAlphaCutoff)};
    ${J?`alphaDiscard = alphaDiscard && outlineColor.a < ${A.glsl.float(v.symbolAlphaCutoff)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${Q}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${M.debugDrawLabelBorder?"debugBorderCoords \x3d vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${M.occlusionTestEnabled?A.glsl`} else { vtc = vec2(0.0);
      ${M.debugDrawLabelBorder?"debugBorderCoords \x3d vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `);I.uniforms.add(new y.Texture2DPassUniform("tex",S=>S.texture));O=M.debugDrawLabelBorder?A.glsl`(isBorder > 0.0 ? 0.0 : ${A.glsl.float(v.defaultMaskAlphaCutoff)})`:A.glsl.float(v.defaultMaskAlphaCutoff);J=A.glsl`
    ${M.debugDrawLabelBorder?A.glsl`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${J?A.glsl`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${A.glsl.float(r.DEFAULT_TEX_SIZE)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${O} ||
          fillPixelColor.a + outlinePixelColor.a < ${A.glsl.float(v.symbolAlphaCutoff)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${O}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:A.glsl`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${O}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${M.debugDrawLabelBorder?A.glsl`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;M.output===n.ShaderOutput.Alpha&&I.code.add(A.glsl`
      void main() {
        ${J}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `);M.output===n.ShaderOutput.Color&&I.code.add(A.glsl`
    void main() {
      ${J}
      ${M.transparencyPassType===D.TransparencyPassType.FrontFace?"gl_FragColor.rgb /\x3d gl_FragColor.a;":""}
    }
    `);M.output===n.ShaderOutput.Highlight&&(L.include(e.OutputHighlight),I.code.add(A.glsl`
    void main() {
      ${J}
      ${M.binaryHighlightOcclusionEnabled?A.glsl`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `));return L}function P(M,L=K){if(M.textureIsSignedDistanceField){var J=M.anchorPosition;M=M.distanceFieldBoundingBox;b.isSome(M)?c.set(L,J[0]*(M[2]-M[0])+M[0],J[1]*(M[3]-M[1])+M[1]):c.set(L,0,0)}else c.copy(L,M.anchorPosition);return L}const K=m.create(),N=Object.freeze(Object.defineProperty({__proto__:null,build:G,calculateAnchorPosForRendering:P},Symbol.toStringTag,{value:"Module"}));a.HUDMaterial=N;a.build=G;a.calculateAnchorPosForRendering=P})},"esri/views/3d/layers/graphics/sdfPrimitives":function(){define(["exports",
"../../../../core/has","../../../../core/floatRGBA","../../webgl-engine/lib/Texture","../../../webgl/enums"],function(a,b,c,m,l){function r(q,u=128,C=.5*u,z=0){switch(q){case "circle":return n(u,C);case "square":return g(u,C);case "cross":return f(u,C,z);case "x":return d(u,C,z);case "kite":return k(u,C);case "triangle":return e(u,C);case "arrow":return h(u,C);default:return n(u,C)}}function n(q,u){const C=q/2-.5;return B(q,t(C,C,u/2))}function g(q,u){return v(q,u,!1)}function k(q,u){return v(q,u,
!0)}function f(q,u,C=0){return w(q,u,!1,C)}function d(q,u,C=0){return w(q,u,!0,C)}function e(q,u){return B(q,x(q/2,u,u/2))}function h(q,u){const C=u/2,z=q/2,A=.8*u,p=t(z,(q-u)/2-A,Math.sqrt(A*A+C*C)),y=x(z,u,C);return B(q,(D,E)=>Math.max(y(D,E),-p(D,E)))}function v(q,u,C){C&&(u/=Math.SQRT2);return B(q,(z,A)=>{z=z-.5*q+.25;A=-A+.5*q-.75;if(C){const p=(z+A)/Math.SQRT2;A=(A-z)/Math.SQRT2;z=p}return Math.max(Math.abs(z),Math.abs(A))-.5*u})}function w(q,u,C,z=0){u-=z;C&&(u*=Math.SQRT2);const A=.5*u;return B(q,
(p,y)=>{p-=.5*q;y=-y+.5*q-1;if(C){const D=(p+y)/Math.SQRT2;y=(y-p)/Math.SQRT2;p=D}p=Math.abs(p);y=Math.abs(y);p=p>y?p>A?Math.sqrt((p-A)*(p-A)+y*y):y:y>A?Math.sqrt(p*p+(y-A)*(y-A)):p;return p-=z/2})}function t(q,u,C){return(z,A)=>{z-=q;A-=u;return Math.sqrt(z*z+A*A)-C}}function x(q,u,C){const z=Math.sqrt(u*u+C*C);return(A,p)=>{p=p-q+u/2+.75;return Math.max((u*(Math.abs(A-q)-C)+C*p)/z,-p)}}function B(q,u){const C=new Uint8Array(4*q*q);for(let z=0;z<q;z++)for(let A=0;A<q;A++){const p=A+q*z;let y=u(A,
z);y=y/q+.5;c.packFloatRGBA(y,C,4*p)}return C}a.DEFAULT_SYMBOL_SIZE_RATIO=.5;a.DEFAULT_TEX_SIZE=128;a.createArrow=h;a.createCircle=n;a.createCross=f;a.createKite=k;a.createPrimitive=r;a.createSquare=g;a.createTexture=function(q,u=128,C=.5*u,z=0){q=r(q,u,C,z);return new m.Texture(q,{mipmap:!1,wrap:{s:l.TextureWrapMode.CLAMP_TO_EDGE,t:l.TextureWrapMode.CLAMP_TO_EDGE},width:u,height:u,components:4,noUnpackFlip:!0})};a.createTriangle=e;a.createX=d;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/core/floatRGBA":function(){define(["exports","./mathUtils"],function(a,b){function c(g,k=0){let f=0;for(let d=0;4>d;d++)f+=g[k+d]*r[d];return f}function m(g){return g-Math.floor(g)}const l=[1,256,65536,16777216],r=[1/256,1/65536,1/16777216,1/4294967296],n=c(new Uint8ClampedArray([255,255,255,255]));a.packFloatRGBA=function(g,k,f=0){g=b.clamp(g,0,n);for(let d=0;4>d;d++)k[f+d]=Math.floor(256*m(g*l[d]))};a.unpackFloatRGBA=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/lib/Texture":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/compilerUtils ../../../../core/Error ../../../../core/Evented ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../core/urlUtils ../../../../support/requestImageUtils ../../../../support/requestUtils ./basicInterfaces ./BasisUtil ./ContentObject ./ContentObjectType ./DDSUtil ./glUtil3D ./Util ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util ../../../webgl/capabilities/isWebGL2Context".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p){w=function(D){function E(G,P){var K=D.call(this)||this;K.data=G;K.type=t.ContentObjectType.Texture;K._glTexture=null;K._powerOfTwoStretchInfo=null;K._loadingPromise=null;K._loadingController=null;K.events=new l;K.params=P||{};K.params.mipmap=!1!==K.params.mipmap;K.params.noUnpackFlip=K.params.noUnpackFlip||!1;K.params.preMultiplyAlpha=K.params.preMultiplyAlpha||!1;K.params.wrap=K.params.wrap||{s:u.TextureWrapMode.REPEAT,t:u.TextureWrapMode.REPEAT};
K.params.powerOfTwoResizeMode=K.params.powerOfTwoResizeMode||h.PowerOfTwoResizeMode.STRETCH;K.estimatedTexMemRequired=E._estimateTexMemRequired(K.data,K.params);K._startPreload();return K}b._inheritsLoose(E,D);var F=E.prototype;F._startPreload=function(){const G=this.data;n.isNone(G)||(G instanceof HTMLVideoElement?this._startPreloadVideoElement(G):G instanceof HTMLImageElement&&this._startPreloadImageElement(G))};F._startPreloadVideoElement=function(G){if(!(f.isBlobProtocol(G.src)||"auto"===G.preload&&
G.crossOrigin)){G.preload="auto";G.crossOrigin="anonymous";const P=!G.paused;G.src=G.src;if(P&&G.autoplay){const K=()=>{G.removeEventListener("canplay",K);G.play()};G.addEventListener("canplay",K)}}};F._startPreloadImageElement=function(G){f.isDataProtocol(G.src)||f.isBlobProtocol(G.src)||G.crossOrigin||(G.crossOrigin="anonymous",G.src=G.src)};E._getDataDimensions=function(G){return G instanceof HTMLVideoElement?{width:G.videoWidth,height:G.videoHeight}:G};E._estimateTexMemRequired=function(G,P){if(n.isNone(G))return 0;
if(k.isArrayBuffer(G)||k.isUint8Array(G))return P.encoding===E.KTX2_ENCODING?v.estimateMemoryKTX2(G,P.mipmap):P.encoding===E.BASIS_ENCODING?v.estimateMemoryBasis(G,P.mipmap):G.byteLength;const {width:K,height:N}=G instanceof Image||G instanceof ImageData||G instanceof HTMLCanvasElement||G instanceof HTMLVideoElement?E._getDataDimensions(G):P;return(P.mipmap?4/3:1)*K*N*(P.components||4)||0};F.dispose=function(){this.data=void 0};F._createDescriptor=function(G){var P;return{target:u.TextureType.TEXTURE_2D,
pixelFormat:u.PixelFormat.RGBA,dataType:u.PixelType.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?u.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:u.TextureSamplingMode.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:null!=(P=this.params.maxAnisotropy)?P:this.params.mipmap?G.parameters.maxMaxAnisotropy:1}};F.load=function(G,P){if(n.isSome(this._glTexture))return this._glTexture;if(n.isSome(this._loadingPromise))return this._loadingPromise;
const K=this.data;return n.isNone(K)?this._glTexture=new z.Texture(G,this._createDescriptor(G),null):"string"===typeof K?this._loadFromURL(G,P,K):K instanceof Image?this._loadFromImageElement(G,P,K):K instanceof HTMLVideoElement?this._loadFromVideoElement(G,P,K):K instanceof ImageData||K instanceof HTMLCanvasElement?this._loadFromImage(G,K,P):(k.isArrayBuffer(K)||k.isUint8Array(K))&&this.params.encoding===E.DDS_ENCODING?(this.data=void 0,this._loadFromDDSData(G,K)):(k.isArrayBuffer(K)||k.isUint8Array(K))&&
this.params.encoding===E.KTX2_ENCODING?(this.data=void 0,this._loadFromKTX2(G,K)):(k.isArrayBuffer(K)||k.isUint8Array(K))&&this.params.encoding===E.BASIS_ENCODING?(this.data=void 0,this._loadFromBasis(G,K)):k.isUint8Array(K)?this._loadFromPixelData(G,K):k.isArrayBuffer(K)?this._loadFromPixelData(G,new Uint8Array(K)):null};F.frameUpdate=function(G,P,K){if(!(this.data instanceof HTMLVideoElement)||n.isNone(this._glTexture)||this.data.readyState<y.HAVE_CURRENT_DATA||K===this.data.currentTime)return K;
if(n.isSome(this._powerOfTwoStretchInfo)){const {framebuffer:N,vao:M,sourceTexture:L}=this._powerOfTwoStretchInfo;L.setData(this.data);this._drawStretchedTexture(G,P,N,M,L,this._glTexture)}else{const {videoWidth:N,videoHeight:M}=this.data,{width:L,height:J}=this._glTexture.descriptor;N!==L||M!==J?this._glTexture.updateData(0,0,0,Math.min(N,L),Math.min(M,J),this.data):this._glTexture.setData(this.data)}this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap();this.params.updateCallback&&
this.params.updateCallback();return this.data.currentTime};F._loadFromDDSData=function(G,P){return this._glTexture=x.createDDSTexture(G,this._createDescriptor(G),P)};F._loadFromKTX2=function(G,P){return this._loadAsync(()=>v.createTextureKTX2(G,this._createDescriptor(G),P).then(K=>this._glTexture=K))};F._loadFromBasis=function(G,P){return this._loadAsync(()=>v.createTextureBasis(G,this._createDescriptor(G),P).then(K=>this._glTexture=K))};F._loadFromPixelData=function(G,P){q.assert(0<this.params.width&&
0<this.params.height);const K=this._createDescriptor(G);K.pixelFormat=1===this.params.components?u.PixelFormat.LUMINANCE:3===this.params.components?u.PixelFormat.RGB:u.PixelFormat.RGBA;K.width=this.params.width;K.height=this.params.height;return this._glTexture=new z.Texture(G,K,P)};F._loadFromURL=function(G,P,K){var N=this;return this._loadAsync(function(){var M=b._asyncToGenerator(function*(L){const J=yield d.requestImage(K,{signal:L});g.throwIfAborted(L);return N._loadFromImage(G,J,P)});return function(L){return M.apply(this,
arguments)}}())};F._loadFromImageElement=function(G,P,K){var N=this;return K.complete?this._loadFromImage(G,K,P):this._loadAsync(function(){var M=b._asyncToGenerator(function*(L){const J=yield e.loadImageAsync(K,K.src,!1,L);g.throwIfAborted(L);return N._loadFromImage(G,J,P)});return function(L){return M.apply(this,arguments)}}())};F._loadFromVideoElement=function(G,P,K){return K.readyState>=y.HAVE_CURRENT_DATA?this._loadFromImage(G,K,P):this._loadFromVideoElementAsync(G,P,K)};F._loadFromVideoElementAsync=
function(G,P,K){return this._loadAsync(N=>new Promise((M,L)=>{const J=()=>{K.removeEventListener("loadeddata",H);K.removeEventListener("error",I);n.removeMaybe(O)},H=()=>{K.readyState>=y.HAVE_CURRENT_DATA&&(J(),M(this._loadFromImage(G,K,P)))},I=Q=>{J();L(Q||new m("Failed to load video"))};K.addEventListener("loadeddata",H);K.addEventListener("error",I);const O=g.onAbort(N,()=>I(g.createAbortError()))}))};F._loadFromImage=function(G,P,K){const N=E._getDataDimensions(P);this.params.width=N.width;this.params.height=
N.height;const M=this._createDescriptor(G);M.pixelFormat=3===this.params.components?u.PixelFormat.RGB:u.PixelFormat.RGBA;if(this._requiresPowerOfTwo(G,M)&&(!r.isPowerOfTwo(N.width)||!r.isPowerOfTwo(N.height)))return this._glTexture=this._makePowerOfTwoTexture(G,P,N,M,K);M.width=N.width;M.height=N.height;return this._glTexture=new z.Texture(G,M,P)};F._loadAsync=function(G){const P=new AbortController;this._loadingController=P;const K=G(P.signal);this._loadingPromise=K;G=()=>{this._loadingController===
P&&(this._loadingController=null);this._loadingPromise===K&&(this._loadingPromise=null)};K.then(G,G);return K};F._requiresPowerOfTwo=function(G,P){var K=u.TextureWrapMode.CLAMP_TO_EDGE;K="number"===typeof P.wrapMode?P.wrapMode===K:P.wrapMode.s===K&&P.wrapMode.t===K;return!p(G.gl)&&(P.hasMipmap||!K)};F._makePowerOfTwoTexture=function(G,P,K,N,M){const {width:L,height:J}=K;K=r.nextHighestPowerOfTwo(L);const H=r.nextHighestPowerOfTwo(J);N.width=K;N.height=H;let I;switch(this.params.powerOfTwoResizeMode){case h.PowerOfTwoResizeMode.PAD:N.textureCoordinateScaleFactor=
[L/K,J/H];I=new z.Texture(G,N);I.updateData(0,0,0,L,J,P);break;case h.PowerOfTwoResizeMode.STRETCH:case null:case void 0:I=this._stretchToPowerOfTwo(G,P,N,M());break;default:c.neverReached(this.params.powerOfTwoResizeMode)}N.hasMipmap&&I.generateMipmap();return I};F._stretchToPowerOfTwo=function(G,P,K,N){const M=new z.Texture(G,K),L=new C.FramebufferObject(G,{colorTarget:u.TargetType.TEXTURE,depthStencilTarget:u.DepthStencilTargetType.NONE},M);P=new z.Texture(G,{target:u.TextureType.TEXTURE_2D,pixelFormat:K.pixelFormat,
dataType:u.PixelType.UNSIGNED_BYTE,wrapMode:u.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:u.TextureSamplingMode.LINEAR,flipped:!!K.flipped,maxAnisotropy:8,preMultiplyAlpha:K.preMultiplyAlpha},P);K=B.createQuadVAO(G);const J=G.getBoundFramebufferObject();this._drawStretchedTexture(G,N,L,K,P,M);this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:K,sourceTexture:P,framebuffer:L}:(K.dispose(!0),P.dispose(),L.detachColorTexture(),L.dispose());G.bindFramebuffer(J);return M};F._drawStretchedTexture=
function(G,P,K,N,M,L){G.bindFramebuffer(K);K=G.getViewport();G.setViewport(0,0,L.descriptor.width,L.descriptor.height);P=G.bindTechnique(P);P.setUniform4f("uColor",1,1,1,1);P.bindTexture("tex",M);G.bindVAO(N);G.drawArrays(u.PrimitiveType.TRIANGLE_STRIP,0,A.vertexCount(N,"geometry"));G.bindFramebuffer(null);G.setViewport(K.x,K.y,K.width,K.height)};F.unload=function(){if(n.isSome(this._powerOfTwoStretchInfo)){const {framebuffer:G,vao:P,sourceTexture:K}=this._powerOfTwoStretchInfo;P.dispose(!0);K.dispose();
G.dispose();this._powerOfTwoStretchInfo=this._glTexture=null}n.isSome(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null);if(n.isSome(this._loadingController)){const G=this._loadingController;this._loadingPromise=this._loadingController=null;G.abort()}this.events.emit("unloaded")};b._createClass(E,[{key:"width",get:function(){return this.params.width}},{key:"height",get:function(){return this.params.height}},{key:"glTexture",get:function(){return this._glTexture}},{key:"requiresFrameUpdates",
get:function(){return this.data instanceof HTMLVideoElement}}]);return E}(w.ContentObject);w.DDS_ENCODING="image/vnd-ms.dds";w.KTX2_ENCODING="image/ktx2";w.BASIS_ENCODING="image/x.basis";var y;(function(D){D[D.HAVE_NOTHING=0]="HAVE_NOTHING";D[D.HAVE_METADATA=1]="HAVE_METADATA";D[D.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA";D[D.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA";D[D.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(y||(y={}));a.Texture=w;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/lib/BasisUtil":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../libs/basisu/BasisU ../../../../libs/basisu/TextureFormat ../../../webgl/enums ../../../webgl/Texture ../../../webgl/Util".split(" "),function(a,b,c,m,l,r,n,g){function k(){return f.apply(this,arguments)}function f(){f=b._asyncToGenerator(function*(){c.isNone(B)&&(B=m.getBasisTranscoder(),x=yield B);return B});return f.apply(this,arguments)}function d(q,
u,C,z,A){u=g.getBytesPerElementFormat(u?r.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:r.CompressedTextureFormat.COMPRESSED_RGB8_ETC2);return Math.ceil(C*z*u*(A&&1<q?(4**q-1)/(3*4**(q-1)):1))}function e(q){return 1<=q.getNumImages()&&!q.isUASTC()}function h(q){return 1<=q.getFaces()&&q.isETC1S()}function v(){v=b._asyncToGenerator(function*(q,u,C){c.isNone(x)&&(x=yield k());const z=new x.BasisFile(new Uint8Array(C));if(!e(z))return null;z.startTranscoding();q=t(q,u,z.getNumLevels(0),z.getHasAlpha(),
z.getImageWidth(0,0),z.getImageHeight(0,0),(A,p)=>z.getImageTranscodedSizeInBytes(0,A,p),(A,p,y)=>z.transcodeImage(y,0,A,p,0,0));z.close();z.delete();return q});return v.apply(this,arguments)}function w(){w=b._asyncToGenerator(function*(q,u,C){c.isNone(x)&&(x=yield k());const z=new x.KTX2File(new Uint8Array(C));if(!h(z))return null;z.startTranscoding();q=t(q,u,z.getLevels(),z.getHasAlpha(),z.getWidth(),z.getHeight(),(A,p)=>z.getImageTranscodedSizeInBytes(A,0,0,p),(A,p,y)=>z.transcodeImage(y,A,0,0,
p,0,-1,-1));z.close();z.delete();return q});return w.apply(this,arguments)}function t(q,u,C,z,A,p,y,D){const {compressedTextureETC:E,compressedTextureS3TC:F}=q.capabilities,[G,P]=E?z?[l.TextureFormat.ETC2_RGBA,r.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC]:[l.TextureFormat.ETC1_RGB,r.CompressedTextureFormat.COMPRESSED_RGB8_ETC2]:F?z?[l.TextureFormat.BC3_RGBA,r.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[l.TextureFormat.BC1_RGB,r.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT]:
[l.TextureFormat.RGBA32,r.PixelFormat.RGBA];z=u.hasMipmap?C:Math.min(1,C);C=[];for(let K=0;K<z;K++)C.push(new Uint8Array(y(K,G))),D(K,G,C[K]);y=1<C.length;return new n.Texture(q,{...u,samplingMode:y?r.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:r.TextureSamplingMode.LINEAR,hasMipmap:y,internalFormat:P,width:A,height:p},{type:"compressed",levels:C})}let x=null,B=null;a.createTextureBasis=function(q,u,C){return v.apply(this,arguments)};a.createTextureKTX2=function(q,u,C){return w.apply(this,arguments)};
a.estimateMemoryBasis=function(q,u){if(c.isNone(x))return q.byteLength;q=new x.BasisFile(new Uint8Array(q));u=e(q)?d(q.getNumLevels(0),q.getHasAlpha(),q.getImageWidth(0,0),q.getImageHeight(0,0),u):0;q.close();q.delete();return u};a.estimateMemoryKTX2=function(q,u){if(c.isNone(x))return q.byteLength;q=new x.KTX2File(new Uint8Array(q));u=h(q)?d(q.getLevels(),q.getHasAlpha(),q.getWidth(),q.getHeight(),u):0;q.close();q.delete();return u};a.loadBasis=k;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/libs/basisu/BasisU":function(){define(["require","exports","../../assets","../../core/maybe"],function(a,b,c,m){let l;b.getBasisTranscoder=function(){if(m.isNone(l)){const r=n=>c.getAssetUrl(`esri/libs/basisu/${n}`);l=(new Promise((n,g)=>a(["../../chunks/basis_transcoder"],n,g))).then(n=>n.basis_transcoder).then(({default:n})=>n({locateFile:r}).then(g=>{g.initializeBasis();delete g.then;return g}))}return l};Object.defineProperties(b,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/libs/basisu/TextureFormat":function(){define(["exports"],function(a){a.TextureFormat=void 0;var b=a.TextureFormat||(a.TextureFormat={});b[b.ETC1_RGB=0]="ETC1_RGB";b[b.ETC2_RGBA=1]="ETC2_RGBA";b[b.BC1_RGB=2]="BC1_RGB";b[b.BC3_RGBA=3]="BC3_RGBA";b[b.BC4_R=4]="BC4_R";b[b.BC5_RG=5]="BC5_RG";b[b.BC7_M6_RGB=6]="BC7_M6_RGB";b[b.BC7_M5_RGBA=7]="BC7_M5_RGBA";b[b.PVRTC1_4_RGB=8]="PVRTC1_4_RGB";b[b.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA";b[b.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA";
b[b.ATC_RGB=11]="ATC_RGB";b[b.ATC_RGBA=12]="ATC_RGBA";b[b.FXT1_RGB=17]="FXT1_RGB";b[b.PVRTC2_4_RGB=18]="PVRTC2_4_RGB";b[b.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA";b[b.ETC2_EAC_R11=20]="ETC2_EAC_R11";b[b.ETC2_EAC_RG11=21]="ETC2_EAC_RG11";b[b.RGBA32=13]="RGBA32";b[b.RGB565=14]="RGB565";b[b.BGR565=15]="BGR565";b[b.RGBA4444=16]="RGBA4444";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["exports","../../../../core/Logger",
"../../../../core/mathUtils","../../../webgl/enums","../../../webgl/Texture"],function(a,b,c,m,l){function r(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function n(e,h){var v=new Int32Array(e,0,31);if(542327876!==v[0])return g.error("Invalid magic number in DDS header"),null;if(!(v[20]&4))return g.error("Unsupported format, must contain a FourCC code"),null;var w=v[21];let t;switch(w){case k:w=8;t=m.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT;
break;case f:w=16;t=m.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case d:w=16;t=m.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return g.error("Unsupported FourCC code:",String.fromCharCode(w&255,w>>8&255,w>>16&255,w>>24&255)),null}let x=1,B=v[4],q=v[3];if(0!==(B&3)||0!==(q&3))g.warn("Rounding up compressed texture size to nearest multiple of 4."),B=B+3&-4,q=q+3&-4;const u=B,C=q;v[2]&131072&&!1!==h&&(x=Math.max(1,v[7]));1===x||c.isPowerOfTwo(B)&&c.isPowerOfTwo(q)||
(g.warn("Ignoring mipmaps of non power of two sized compressed texture."),x=1);let z=v[1]+4;const A=[];for(let p=0;p<x;++p)v=(B+3>>2)*(q+3>>2)*w,h=new Uint8Array(e,z,v),A.push(h),z+=v,B=Math.max(1,B>>1),q=Math.max(1,q>>1);return{textureData:{type:"compressed",levels:A},internalFormat:t,width:u,height:C}}const g=b.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),k=r("DXT1"),f=r("DXT3"),d=r("DXT5");a.createDDSTexture=function(e,h,v){const {textureData:w,internalFormat:t,width:x,height:B}=n(v,h.hasMipmap);
h.samplingMode=1<w.levels.length?m.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:m.TextureSamplingMode.LINEAR;h.hasMipmap=1<w.levels.length;h.internalFormat=t;h.width=x;h.height=B;return new l.Texture(e,h,w)};a.createDDSTextureData=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../shaderModules/Float3DrawUniform ../shaderModules/Float3PassUniform ../shaderModules/interfaces".split(" "),
function(a,b,c,m,l,r,n,g,k,f){function d(z,A,p){if(A.hasSlicePlane){z.extensions.add("GL_OES_standard_derivatives");A.hasSliceInVertexProgram&&z.vertex.uniforms.add(p);z.fragment.uniforms.add(p);p=f.glsl`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`;var y=f.glsl`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`;y=A.hasSliceHighlight?f.glsl`
        ${y}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:f.glsl`#define highlightSlice(_color_, _pos_) (_color_)`;A.hasSliceInVertexProgram&&z.vertex.code.add(p);z.fragment.code.add(p);z.fragment.code.add(y)}else p=f.glsl`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`,A.hasSliceInVertexProgram&&z.vertex.code.add(p),z.fragment.code.add(p)}function e(z,A,p){return z.instancedDoublePrecision?r.set(B,p.camera.viewInverseTransposeMatrix[3],p.camera.viewInverseTransposeMatrix[7],p.camera.viewInverseTransposeMatrix[11]):A.slicePlaneLocalOrigin}function h(z,A){return c.isSome(z)?r.subtract(q,A.origin,z):A.origin}function v(z,A,p){return z.hasSliceTranslatedView?c.isSome(A)?m.translate(C,p.camera.viewMatrix,A):p.camera.viewMatrix:
null}function w(z,A,p){if(c.isNone(p.slicePlane))return n.ZEROS;const y=e(z,A,p);A=h(y,p.slicePlane);z=v(z,y,p);return c.isSome(z)?r.transformMat4(q,A,z):A}function t(z,A,p,y){if(c.isNone(y)||c.isNone(p.slicePlane))return n.ZEROS;const D=e(z,A,p);A=h(D,p.slicePlane);z=v(z,D,p);return c.isSome(z)?(r.add(u,y,A),r.transformMat4(q,A,z),r.transformMat4(u,u,z),r.subtract(u,u,q)):y}let x=function(z){function A(p){var y=z.call(this)||this;y.slicePlaneLocalOrigin=p;return y}b._inheritsLoose(A,z);return A}(f.NoParameters);
const B=n.create(),q=n.create(),u=n.create(),C=l.create();a.SliceDraw=function(z,A){d(z,A,[new g.Float3DrawUniform("slicePlaneOrigin",(p,y)=>w(A,p,y)),new g.Float3DrawUniform("slicePlaneBasis1",(p,y)=>{var D;return t(A,p,y,null==(D=c.unwrap(y.slicePlane))?void 0:D.basis1)}),new g.Float3DrawUniform("slicePlaneBasis2",(p,y)=>{var D;return t(A,p,y,null==(D=c.unwrap(y.slicePlane))?void 0:D.basis2)})])};a.SlicePass=function(z,A){d(z,A,[new k.Float3PassUniform("slicePlaneOrigin",(p,y)=>w(A,p,y)),new k.Float3PassUniform("slicePlaneBasis1",
(p,y)=>{var D;return t(A,p,y,null==(D=c.unwrap(y.slicePlane))?void 0:D.basis1)}),new k.Float3PassUniform("slicePlaneBasis2",(p,y)=>{var D;return t(A,p,y,null==(D=c.unwrap(y.slicePlane))?void 0:D.basis2)})])};a.SlicePlaneParameters=x;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl":function(){define("exports ../output/ReadLinearDepth.glsl ../shading/MultipassGeometryTest.glsl ../util/RgbaFloatEncoding.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,m,l,r,n){a.HUDOcclusionPass=function(g,k){const {vertex:f,fragment:d}=g;k.hasMultipassGeometry&&f.include(c.multipassGeometryTest);k.hasMultipassTerrain&&g.varyings.add("depth","float");f.code.add(r.glsl`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${k.hasMultipassGeometry?r.glsl`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${k.hasMultipassTerrain?"depth \x3d projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `);k.hasMultipassTerrain&&d.include(b.ReadLinearDepth);k.hasMultipassTerrain&&d.uniforms.add([new n.Texture2DPassUniform("terrainDepthTexture",(e,h)=>h.multipassTerrain.linearDepthTexture),new l.Float2PassUniform("nearFar",(e,h)=>h.camera.nearFar),new l.Float2PassUniform("inverseViewport",(e,h)=>h.inverseViewport)]);d.include(m.RgbaFloatEncoding);d.code.add(r.glsl`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${k.hasMultipassTerrain?r.glsl`
          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec2f64 ../../../../../../chunks/vec4f64 ../../shaderModules/Float2PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,c,m,l,r,n){const g=m.fromValues(1,1,0,1),k=m.fromValues(1,
0,1,1);m=function(f){function d(){var e=f.apply(this,arguments)||this;e.inverseViewport=c.create();return e}b._inheritsLoose(d,f);return d}(r.NoParameters);a.OutputHighlight=function(f){f.fragment.uniforms.add(new n.Texture2DPassUniform("depthTex",(d,e)=>e.highlightDepthTexture));f.fragment.uniforms.add(new l.Float2PassUniform("highlightViewportPixelSz",(d,e)=>e.inverseViewport));f.fragment.constants.add("occludedHighlightFlag","vec4",g).add("unoccludedHighlightFlag","vec4",k);f.fragment.code.add(r.glsl`void outputHighlight() {
vec4 fragCoord = gl_FragCoord;
float sceneDepth = texture2D(depthTex, fragCoord.xy * highlightViewportPixelSz.xy).r;
if (fragCoord.z > sceneDepth + 5e-7) {
gl_FragColor = occludedHighlightFlag;
}
else {
gl_FragColor = unoccludedHighlightFlag;
}
}`)};a.OutputHighlightUniforms=m;a.occludedHighlightFlag=g;a.unoccludedHighlightFlag=k;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":function(){define("exports ../../shaderModules/Float3PassUniform ../../shaderModules/Float4sPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3PassUniform ../../../lib/VertexAttribute ../../../materials/VisualVariablePassParameters".split(" "),
function(a,b,c,m,l,r,n,g){a.VisualVariables=function(k,f){f.hasVvInstancing&&(f.vvSize||f.vvColor)&&k.attributes.add(n.VertexAttribute.INSTANCEFEATUREATTRIBUTE,"vec4");k=k.vertex;f.vvSize?(k.uniforms.add(new b.Float3PassUniform("vvSizeMinSize",d=>d.vvSizeMinSize)),k.uniforms.add(new b.Float3PassUniform("vvSizeMaxSize",d=>d.vvSizeMaxSize)),k.uniforms.add(new b.Float3PassUniform("vvSizeOffset",d=>d.vvSizeOffset)),k.uniforms.add(new b.Float3PassUniform("vvSizeFactor",d=>d.vvSizeFactor)),k.uniforms.add(new r.Matrix3PassUniform("vvSymbolRotationMatrix",
d=>d.vvSymbolRotationMatrix)),k.uniforms.add(new b.Float3PassUniform("vvSymbolAnchor",d=>d.vvSymbolAnchor)),k.code.add(l.glsl`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),k.code.add(l.glsl`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${f.hasVvInstancing?l.glsl`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):k.code.add(l.glsl`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`);f.vvColor?(k.constants.add("vvColorNumber","int",g.vvColorNumber),f.hasVvInstancing&&k.uniforms.add([new m.FloatsPassUniform("vvColorValues",d=>d.vvColorValues,g.vvColorNumber),new c.Float4sPassUniform("vvColorColors",d=>d.vvColorColors,g.vvColorNumber)]),k.code.add(l.glsl`
      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${f.hasVvInstancing?l.glsl`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):k.code.add(l.glsl`vec4 vvColor() { return vec4(1.0); }`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4sPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,m){c=function(l){function r(n,g,k){return l.call(this,n,"vec4",m.BindType.Pass,(f,d,e)=>f.setUniform4fv(n,g(d,e)),k)||this}b._inheritsLoose(r,
l);return r}(c.Uniform);a.Float4sPassUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatsPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,m){c=function(l){function r(n,g,k){return l.call(this,n,"float",m.BindType.Pass,(f,d,e)=>f.setUniform1fv(n,g(d,e)),k)||this}b._inheritsLoose(r,l);return r}(c.Uniform);
a.FloatsPassUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix3PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,m){c=function(l){function r(n,g){return l.call(this,n,"mat3",m.BindType.Pass,(k,f,d)=>k.setUniformMatrix3fv(n,g(f,d)))||this}b._inheritsLoose(r,l);return r}(c.Uniform);a.Matrix3PassUniform=
c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/VisualVariablePassParameters":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/mat3f64","../../../../chunks/vec3f64","../lib/Material"],function(a,b,c,m,l){l=function(r){function n(){var g=r.apply(this,arguments)||this;g.vvSizeEnabled=!1;g.vvSizeMinSize=m.fromValues(1,1,1);g.vvSizeMaxSize=m.fromValues(100,100,100);g.vvSizeOffset=
m.fromValues(0,0,0);g.vvSizeFactor=m.fromValues(1,1,1);g.vvSizeValue=m.fromValues(1,1,1);g.vvColorEnabled=!1;g.vvColorValues=[0,0,0,0,0,0,0,0];g.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0];g.vvOpacityEnabled=!1;g.vvOpacityValues=[0,0,0,0,0,0,0,0];g.vvOpacityOpacities=[1,1,1,1,1,1,1,1];g.vvSymbolAnchor=[0,0,0];g.vvSymbolRotationMatrix=c.create();return g}b._inheritsLoose(n,r);return n}(l.MaterialParameters);a.VisualVariablePassParameters=l;a.vvColorNumber=8;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff":function(){define(["exports"],function(a){a.defaultMaskAlphaCutoff=.1;a.symbolAlphaCutoff=.001;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../ViewingMode ../core/shaderLibrary/ShaderOutputOptions ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../../../../chunks/HUDMaterial.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){n=function(x){function B(){return x.apply(this,arguments)||this}c._inheritsLoose(B,x);var q=B.prototype;q.initializeConfiguration=function(u,C){C.spherical=u.viewingMode===m.ViewingMode.Global};q.initializeProgram=function(u){const C=B.shader.get().build(this.configuration);return new d.Program(u.rctx,C,k.Default3D)};q._setPipelineState=function(u){const C=this.configuration,z=u===g.TransparencyPassType.NONE;var A=u===g.TransparencyPassType.FrontFace;const p=
this.configuration.hasPolygonOffset&&w;A=(z||A)&&C.output!==l.ShaderOutput.Highlight?(C.depthEnabled||C.output===l.ShaderOutput.Occlusion)&&v.defaultDepthWriteParams:null;return v.makePipelineState({blending:C.output===l.ShaderOutput.Color||C.output===l.ShaderOutput.Alpha||C.output===l.ShaderOutput.Highlight?z?t:f.oitBlending(u):null,depthTest:{func:h.CompareFunction.LEQUAL},depthWrite:A,colorWrite:v.defaultColorWriteParams,polygonOffset:p})};q.initializePipeline=function(){return this._setPipelineState(this.configuration.transparencyPassType)};
c._createClass(B,[{key:"primitiveType",get:function(){return this.configuration.output===l.ShaderOutput.Occlusion?h.PrimitiveType.POINTS:h.PrimitiveType.TRIANGLES}}]);return B}(n.ShaderTechnique);n.shader=new r.ReloadableShaderModule(e.HUDMaterial,()=>new Promise((x,B)=>a(["./HUDMaterial.glsl"],x,B)));const w={factor:0,units:-4},t=v.simpleBlendingParams(h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA);b.HUDMaterialTechnique=n;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/lib/OrderIndependentTransparency":function(){define(["exports","./basicInterfaces","../../../webgl/enums","../../../webgl/renderState"],function(a,b,c,m){const l=m.separateBlendingParams(c.BlendFactor.SRC_ALPHA,c.BlendFactor.ONE,c.BlendFactor.ONE_MINUS_SRC_ALPHA,c.BlendFactor.ONE_MINUS_SRC_ALPHA),r=m.simpleBlendingParams(c.BlendFactor.ONE,c.BlendFactor.ONE),n=m.simpleBlendingParams(c.BlendFactor.ZERO,c.BlendFactor.ONE_MINUS_SRC_ALPHA),g={factor:-1,units:-2};a.OITPolygonOffset=
g;a.OITPolygonOffsetLimit=5E5;a.blendingAlpha=n;a.blendingColor=r;a.blendingDefault=l;a.getOITPolygonOffset=function(k){return k?g:null};a.oitBlending=function(k){return k===b.TransparencyPassType.FrontFace?null:k===b.TransparencyPassType.Alpha?n:r};a.oitDepthTest=function(k,f=c.CompareFunction.LESS){return k===b.TransparencyPassType.NONE||k===b.TransparencyPassType.FrontFace?f:c.CompareFunction.LEQUAL};a.oitDepthWrite=function(k){return k===b.TransparencyPassType.FrontFace?m.defaultDepthWriteParams:
null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/hud/HUD.glsl ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../materials/DefaultTechniqueConfiguration".split(" "),function(a,b,c,m,l,r,n,
g){g=function(k){function f(){var d=k.apply(this,arguments)||this;d.output=m.ShaderOutput.Color;d.screenCenterOffsetUnitsEnabled=l.HUDSpace.World;d.transparencyPassType=n.TransparencyPassType.NONE;d.spherical=!1;d.occlusionTestEnabled=!0;d.signedDistanceFieldEnabled=!1;d.vvSize=!1;d.vvColor=!1;d.hasVerticalOffset=!1;d.hasScreenSizePerspective=!1;d.debugDrawLabelBorder=!1;d.binaryHighlightOcclusionEnabled=!0;d.hasSlicePlane=!1;d.hasPolygonOffset=!1;d.depthEnabled=!0;d.pixelSnappingEnabled=!0;d.isDraped=
!1;d.hasMultipassGeometry=!1;d.hasMultipassTerrain=!1;d.cullAboveGround=!1;return d}b._inheritsLoose(f,k);return f}(g.DefaultTechniqueConfiguration);c.__decorate([r.parameter({count:m.ShaderOutput.COUNT})],g.prototype,"output",void 0);c.__decorate([r.parameter({count:l.HUDSpace.COUNT})],g.prototype,"screenCenterOffsetUnitsEnabled",void 0);c.__decorate([r.parameter({count:n.TransparencyPassType.COUNT})],g.prototype,"transparencyPassType",void 0);c.__decorate([r.parameter()],g.prototype,"spherical",
void 0);c.__decorate([r.parameter()],g.prototype,"occlusionTestEnabled",void 0);c.__decorate([r.parameter()],g.prototype,"signedDistanceFieldEnabled",void 0);c.__decorate([r.parameter()],g.prototype,"vvSize",void 0);c.__decorate([r.parameter()],g.prototype,"vvColor",void 0);c.__decorate([r.parameter()],g.prototype,"hasVerticalOffset",void 0);c.__decorate([r.parameter()],g.prototype,"hasScreenSizePerspective",void 0);c.__decorate([r.parameter()],g.prototype,"debugDrawLabelBorder",void 0);c.__decorate([r.parameter()],
g.prototype,"binaryHighlightOcclusionEnabled",void 0);c.__decorate([r.parameter()],g.prototype,"hasSlicePlane",void 0);c.__decorate([r.parameter()],g.prototype,"hasPolygonOffset",void 0);c.__decorate([r.parameter()],g.prototype,"depthEnabled",void 0);c.__decorate([r.parameter()],g.prototype,"pixelSnappingEnabled",void 0);c.__decorate([r.parameter()],g.prototype,"isDraped",void 0);c.__decorate([r.parameter()],g.prototype,"hasMultipassGeometry",void 0);c.__decorate([r.parameter()],g.prototype,"hasMultipassTerrain",
void 0);c.__decorate([r.parameter()],g.prototype,"cullAboveGround",void 0);c.__decorate([r.parameter({constValue:!0})],g.prototype,"hasSliceInVertexProgram",void 0);c.__decorate([r.parameter({constValue:!1})],g.prototype,"hasVvInstancing",void 0);a.HUDMaterialTechniqueConfiguration=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/DefaultTechniqueConfiguration":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../../chunks/tslib.es6","../core/shaderTechnique/BindType","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,m,l){let r=function(n){function g(){return n.apply(this,arguments)||this}b._inheritsLoose(g,n);return g}(l.ShaderTechniqueConfiguration);c.__decorate([l.parameter({constValue:!0})],r.prototype,"hasSliceHighlight",void 0);c.__decorate([l.parameter({constValue:!1})],r.prototype,"hasSliceInVertexProgram",void 0);c.__decorate([l.parameter({constValue:!1})],r.prototype,
"instancedDoublePrecision",void 0);c.__decorate([l.parameter({constValue:!1})],r.prototype,"isGround",void 0);c.__decorate([l.parameter({constValue:m.BindType.Pass})],r.prototype,"pbrTextureBindType",void 0);a.DefaultTechniqueConfiguration=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/LabelDeconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./Deconflictor ./enums ../../../support/Scheduler".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){a.LabelDeconflictor=function(e){function h(){var w=e.apply(this,arguments)||this;w.visibilityGroup=f.VisibilityGroup.LABEL;w.iconMarginFactor=0;w._lastDeconfliction=0;return w}b._inheritsLoose(h,e);var v=h.prototype;v.runTask=function(w){if(!this.parent.running){var t=performance.now();if(w.state===d.State.IDLE||2E3<t-this._lastDeconfliction)e.prototype.runTask.call(this,w),this.state===k.State.Idle&&(this._lastDeconfliction=t)}};v.enabledChanged=function(w,t){this.modifyGraphics(t,
w.labelsEnabled)};v.getGraphicsLayers=function(w){return w.labelGraphics};b._createClass(h,[{key:"viewState",get:function(){return this.parent.viewState}}]);return h}(k.Deconflictor);c.__decorate([m.property({constructOnly:!0})],a.LabelDeconflictor.prototype,"parent",void 0);a.LabelDeconflictor=c.__decorate([g.subclass("esri.views.3d.layers.graphics.LabelDeconflictor")],a.LabelDeconflictor);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Labeler":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Handles ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/hydratedFeatures ../../../../layers/support/labelFormatUtils ../../../../layers/support/layerUtils ../../../../symbols/callouts/calloutUtils ./enums ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DGraphicCreationContext ./graphicSymbolUtils ./labelPlacement ./placementUtils ../../support/debugFlags ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextRenderer ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureAtlas ../../webgl-engine/lib/WebGLLayer ../../../support/Scheduler".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N,M){const L=n.getLogger("esri.views.3d.layers.graphics.Labeler");a.Labeler=function(H){function I(){var Q=H.apply(this,arguments)||this;Q._dirty=!1;Q._labels=new Map;Q._labelsToAdd=new Map;Q._labelsToRemove=new Map;Q._labelingContexts=[];return Q}b._inheritsLoose(I,H);var O=I.prototype;O.setup=function(){this.dispose();this._handles=new r;this._handles.add([d.watch(()=>{var Q;return null==(Q=this.view.state)?void 0:Q.camera},
()=>this.setDirty()),d.watch(()=>{var Q;return null==(Q=this.view.state)?void 0:Q.pixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(M.TaskPriority.LABELER,this)]);this._textTextureAtlas=new K.TextTextureAtlas({view:this.view});this._hudMaterialCollection=new F.MaterialCollection(this.view._stage);this._calloutMaterialCollection=new F.MaterialCollection(this.view._stage)};O.dispose=function(){this._handles=k.destroyMaybe(this._handles);this._textTextureAtlas=
k.disposeMaybe(this._textTextureAtlas);this._hudMaterialCollection=k.disposeMaybe(this._hudMaterialCollection);this._calloutMaterialCollection=k.disposeMaybe(this._calloutMaterialCollection);this._labelingContexts.length=0;this._labels.clear();this._labelsToAdd.clear();this._labelsToRemove.clear()};O._activateLabelingContext=function(Q){Q.labels.forEach((S,T)=>{this._labels.set(T,S);S.graphics3DGraphic.setVisibilityFlag(C.VisibilityFlag.USER_SETTING,!0,C.VisibilityGroup.LABEL)});Q.active=!0};O._deactivateLabelingContext=
function(Q){Q.labels.forEach((S,T)=>{S.graphics3DGraphic.setVisibilityFlag(C.VisibilityFlag.USER_SETTING,!1,C.VisibilityGroup.LABEL);this.setLabelGraphicVisibility(S.graphics3DGraphic,!1);this._labels.delete(T)});Q.active=!1};O._addLabelTextureToAtlas=function(Q){for(const S of Q.graphics3DGraphic.labelGraphics){if(!S._labelClass)continue;const T=Q.textTextureResources.textRenderers[S._labelIndex];k.isSome(T)&&this._textTextureAtlas.addTextTexture(T,S.stageObject)}Q.rendered=!0};O._removeLabelTextureFromAtlas=
function(Q){for(const S of Q.graphics3DGraphic.labelGraphics){if(!S._labelClass)continue;const T=Q.textTextureResources.textRenderers[S._labelIndex];k.isSome(T)&&this._textTextureAtlas.removeTextTexture(T,S.stageObject)}Q.rendered=!1};O.runTask=function(Q){this._updateLabels(Q);!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(Q)};O._updateLabels=function(Q){if(this._dirty){this._dirty=!1;for(const S of this._labelingContexts)if(S.active&&q.areLabelsVisible(S.layer)){if(!S.labelClassContexts||
!S.labelClassContexts.length){if(null===S.labelClassContexts){this._deactivateLabelingContext(S);continue}this._createLabelClassContext(S);if(S.labelClassPromise&&S.labelClassAbortController){this._dirty=!0;continue}if(!S.labelClassContexts||!S.labelClassContexts.length)continue}g.someMap(S.labelsToInitialize,(T,U)=>{this._ensureGraphics3DResources(T)&&(this._labels.set(U,T),this.deconflictor.setDirty(),Q.madeProgress());if(T.visible&&T.textTextureResources.initialized||!T.visible&&T.hasGraphics3DResources)S.labelsToInitialize.delete(U),
Q.madeProgress();return Q.done})&&(this._dirty=!0)}this._labelsToRemove.forEach(S=>this._removeLabelTextureFromAtlas(S));this._labelsToAdd.forEach(S=>this._addLabelTextureToAtlas(S));this._labelsToRemove.clear();this._labelsToAdd.clear();this._dirty||this.notifyChange("updating")}};O._createLabelClassContextAsync=function(){var Q=b._asyncToGenerator(function*(S){var T=this;const U=S.labelClassAbortController.signal;yield S.layer.when();f.throwIfAborted(U);S.scaleVisibility&&S.scaleVisibility.updateScaleRangeActive();
const aa=S.graphics3DCore;var W=aa.layer;if((W=W.labelingInfo&&W.labelingInfo.filter(da=>!!da.symbol))&&0!==W.length){var R=Array(W.length),V=!1;yield l.forEach(W,function(){var da=b._asyncToGenerator(function*(ca,ha){var ia=ca.symbol;const ka=p.getGraphics3DSymbol(aa.getOrCreateGraphics3DSymbol(ia));if(k.isNone(ka))L.error("Failed to create Graphics3DSymbol for label");else{yield ka.load();f.throwIfAborted(U);var la=null;u.hasCalloutSupport(ia)&&ia.hasVisibleCallout()&&(la=z.make(ia,aa.symbolCreationContext),
yield la.load(),f.throwIfAborted(U));ia=yield l.result(B.createLabelFunction(ca,S.layer.fieldsIndex,T.view.spatialReference));f.throwIfAborted(U);if(!0===ia.ok){const Y=yield T._createTextRenderParameters(ka.symbol);f.throwIfAborted(U);R[ha]={labelClass:ca,labelFunction:ia.value,graphics3DSymbol:ka,graphics3DCalloutSymbolLayer:la,calloutSymbolLayerIndex:0,textRenderParameters:Y}}else L.error(`Label expression failed to evaluate: ${ia.error}`),V=!0}});return function(ca,ha){return da.apply(this,arguments)}}());
f.throwIfAborted(U);V||(S.labelClassContexts=R)}});return function(S){return Q.apply(this,arguments)}}();O._createLabelClassContext=function(){var Q=b._asyncToGenerator(function*(S){S.labelClassPromise||(S.labelClassPromise=this._createLabelClassContextAsync(S).catch(T=>{if(f.isAbortError(T))throw T;S.labelClassContexts=null}).then(()=>{S.labelClassAbortController=null;this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating"));return S.labelClassPromise});return function(S){return Q.apply(this,
arguments)}}();O._createTextRenderParameters=function(){var Q=b._asyncToGenerator(function*(S){return(S=S.symbolLayers.getItemAt(0))&&"text"===S.type?P.TextRenderParameters.fromSymbol(S,this.view.state.pixelRatio):null});return function(S){return Q.apply(this,arguments)}}();O._destroyLabelClassContext=function(Q){for(var S of Q.labelClassContexts)--S.graphics3DSymbol.referenced,S.graphics3DSymbol=null;S=Q.labelClassAbortController;Q.labelClassAbortController=new AbortController;S&&S.abort();Q.labelClassContexts=
[];Q.labelClassPromise=null;this.notifyChange("updating")};O._createTextSymbolGraphic=function(Q,S,T,U,aa){Q={text:Q.text,centerOffset:T.centerOffset,translation:T.translation,elevationOffset:T.elevationOffset,screenOffset:T.screenOffset,centerOffsetUnits:T.centerOffsetUnits,horizontalPlacement:D.horizontalPlacementFromAnchor(T.anchor),verticalPlacement:D.verticalPlacementFromAnchor(T.anchor),verticalOffset:T.verticalOffset,debugDrawLabelBorder:E.LABELS_SHOW_BORDER,displayWidth:Q.displayWidth,displayHeight:Q.displayHeight};
J.graphic=S;J.renderingInfo=null;J.layer=U;return aa.createLabel(J,Q,this._hudMaterialCollection,this._textTextureAtlas)};O._createLineCalloutGraphic=function(Q,S,T,U,aa){S={symbol:S,translation:U.translation,elevationOffset:U.elevationOffset,screenOffset:U.screenOffset,centerOffset:U.centerOffset,centerOffsetUnits:U.centerOffsetUnits,materialCollection:this._calloutMaterialCollection};J.graphic=Q;J.renderingInfo=S;J.layer=aa;return T.createGraphics3DGraphic(J)};O._ensureGraphics3DResources=function(Q){if(Q.hasGraphics3DResources)return!1;
const S=Q.graphics3DGraphic;if(S.destroyed)return!1;this._ensureTextTextureResources(Q);const {textTextureResources:T}=Q,U=Q.labelingContext,aa=U.labelClassContexts;if(!aa||0===aa.length||!U.emptySymbolLabelSupported&&0===S.graphics.length)return!1;var W=!1,R=S.graphic;const V=U.layer;var da=q.areLabelsVisible(U.layer);const ca=this.view._stage;for(let ia=0;ia<aa.length;ia++){const ka=T.textRenderers[ia],la=T.labelPlacements[ia];if(k.isNone(ka)||k.isNone(la))continue;const Y=aa[ia];var ha=Y.graphics3DSymbol;
const ea=ha.symbol&&"label-3d"===ha.symbol.type?ha.symbol:null;if(ha=ha.symbolLayers[0]){ha.setElevationInfoOverride(U.elevationInfoOverride);W=this._createTextSymbolGraphic(ka,R,la,V,ha);if(!W)return!1;W._labelClass=Y.labelClass;W._labelIndex=ia;S.addLabelGraphic(W,ca,U.stageLayer);S.setVisibilityFlag(C.VisibilityFlag.USER_SETTING,da,C.VisibilityGroup.LABEL);S.clearVisibilityFlag(C.VisibilityFlag.SCALE_RANGE,C.VisibilityGroup.LABEL);S.setVisibilityFlag(C.VisibilityFlag.DECONFLICTION,!1,C.VisibilityGroup.LABEL);
W=!0;(da=Y.graphics3DCalloutSymbolLayer)&&la.hasLabelVerticalOffset&&(da.setElevationInfoOverride(U.elevationInfoOverride),R=this._createLineCalloutGraphic(R,ea,da,la,V),k.isSome(R)&&(Y.calloutSymbolLayerIndex=S.labelGraphics.length,S.addLabelGraphic(R,ca,U.stageLayer)));break}}U.scaleVisibility&&W&&U.scaleVisibility.updateGraphicLabelScaleVisibility(S);return Q.hasGraphics3DResources=!0};O._destroyGraphics3DResources=function(Q){const S=Q.labelingContext.labelClassContexts;for(const T of Q.graphics3DGraphic.labelGraphics){if(null==
T._labelClass)continue;const U=S[T._labelIndex].graphics3DSymbol.symbolLayers[0];if(null!=U)U.onRemoveGraphic(T)}Q.graphics3DGraphic.clearLabelGraphics();Q.hasGraphics3DResources=!1};O._ensureTextTextureResources=function(Q){const {textTextureResources:S}=Q;if(!S.initialized){var T=Q.labelingContext,U=T.labelClassContexts;if(U&&0!==U.length){var aa=Q.graphics3DGraphic.graphic;for(let V=0;V<U.length;V++){const da=U[V];S.textRenderers[V]=null;S.labelPlacements[V]=null;if(!da.textRenderParameters)continue;
var W=da.labelFunction;let ca;if("arcade"===W.type)try{const ha=W.needsHydrationToEvaluate()?x.hydrateGraphic(aa,T.layer):aa;ca=W.evaluate(ha)}catch(ha){ca=null}else ca=W.evaluate(aa);if(!k.isNone(ca)&&""!==ca&&!/^\s+$/.test(ca)&&(W=da.graphics3DSymbol,W.symbolLayers[0]&&(W=y.get({graphics3DGraphic:Q.graphics3DGraphic,labelSymbol:W.symbol&&"label-3d"===W.symbol.type?W.symbol:null,labelClass:da.labelClass,disablePlacement:T.disablePlacement}),!k.isNone(W)))){var R=D.horizontalPlacementFromAnchor(W.anchor);
R=D.textRenderAlignmentFromHorizontalPlacement(R);S.textRenderers[V]=new G.TextRenderer(ca,R,da.textRenderParameters);S.labelPlacements[V]=W}}S.initialized=!0}}};O._destroyTextTextureResources=function(Q){({textTextureResources:Q}=Q);Q.initialized=!1;Q.textRenderers=[];Q.labelPlacements=[]};O._addGraphic=function(Q,S){const T={hasGraphics3DResources:!1,visible:!1,rendered:!1,labelingContext:Q,graphics3DGraphic:S,textTextureResources:{initialized:!1,textRenderers:[],labelPlacements:[]}};S=S.graphic.uid;
Q.labels.set(S,T);Q.labelsToInitialize.set(S,T);this.setDirty();this.deconflictor.setDirty()};O._removeGraphic=function(Q,S){S=S.graphic.uid;const T=Q.labels.get(S);T&&(this._destroyGraphic(T,S),Q.labels.delete(S),Q.labelsToInitialize.delete(S),this.setDirty(),this.deconflictor.setDirty())};O._destroyGraphic=function(Q,S){this._labels.has(S)&&(this._labels.delete(S),this._labelsToAdd.delete(S),this._labelsToRemove.delete(S));Q.textTextureResources.initialized&&(this._removeLabelTextureFromAtlas(Q),
this._destroyTextTextureResources(Q));Q.hasGraphics3DResources&&this._destroyGraphics3DResources(Q)};O._labelingInfoChange=function(){var Q=b._asyncToGenerator(function*(S,T){if(T)for(const U of T){if(T=S.labels.get(U))this._removeGraphic(S,T.graphics3DGraphic),this._addGraphic(S,T.graphics3DGraphic)}else return this._visibilityInfoChange(S),this._resetLabels(S),this._createLabelClassContext(S)});return function(S,T){return Q.apply(this,arguments)}}();O._globalPropertyChanged=function(Q,S){for(const T of S.labelClassContexts){const U=
new Map;S.labels.forEach(aa=>{aa=aa.graphics3DGraphic;U.set(aa.graphic.uid,aa)});k.unwrap(T.graphics3DSymbol.symbolLayers[0]).globalPropertyChanged(Q,U,aa=>aa.labelGraphics[0]);T.graphics3DCalloutSymbolLayer&&T.graphics3DCalloutSymbolLayer.globalPropertyChanged(Q,U,aa=>aa.labelGraphics[T.calloutSymbolLayerIndex])}};O._visibilityInfoChange=function(Q){const S=Q.layer.labelsVisible;S&&!Q.active&&this._activateLabelingContext(Q);!S&&Q.active&&this._deactivateLabelingContext(Q);this.setDirty()};O._resetAllLabels=
function(){for(const Q of this._labelingContexts)this._resetLabels(Q)};O._resetLabels=function(Q){Q.labels.forEach((S,T)=>{this._destroyGraphic(S,T);S.visible=!1;S.rendered=!1;Q.labelsToInitialize.set(T,S)});this._destroyLabelClassContext(Q);this.setDirty();this.deconflictor.setDirty()};O._findLabelingContext=function(Q){for(const S of this._labelingContexts)if(S.graphics3DCore===Q)return S;return null};O.addGraphicsOwner=function(Q,S,T){const U=T&&T.emptySymbolLabelSupported||!1,aa=T&&T.elevationInfoOverride||
null;T=T&&T.disablePlacement||null;if(!this._findLabelingContext(Q)){var W=Q.layer,R={graphics3DCore:Q,layer:W,scaleVisibility:S,emptySymbolLabelSupported:U,elevationInfoOverride:aa,disablePlacement:T,active:W.labelsVisible,labelClassPromise:null,labelClassAbortController:new AbortController,labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new N.WebGLLayer({isPickable:!0},W.uid)};this.view._stage.add(R.stageLayer);this._labelingContexts.push(R);this.setDirty();return{addGraphic:V=>
this._addGraphic(R,V),removeGraphic:V=>this._removeGraphic(R,V),featureReductionChange:()=>{},layerLabelsEnabled:()=>q.areLabelsVisible(R.layer),labelingInfoChange:V=>this._labelingInfoChange(R,V),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",R),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",R),visibilityInfoChange:()=>this._visibilityInfoChange(R),reset:()=>this._resetLabels(R),clear:()=>{}}}};O.removeGraphicsOwner=function(Q){const S=this._findLabelingContext(Q);
S&&(Q=this._labelingContexts.indexOf(S),this._labelingContexts.splice(Q,1),S.labels.forEach(T=>this._removeGraphic(S,T.graphics3DGraphic)),this.view._stage.remove(S.stageLayer),S.stageLayer=null,this.setDirty())};O.setLabelGraphicVisibility=function(Q,S){Q=Q.graphic.uid;const T=this._labels.get(Q);T&&T.visible!==S&&(S&&!T.rendered?(this._labelsToAdd.set(Q,T),this._labelsToRemove.delete(Q),T.textTextureResources.initialized||T.labelingContext.labelsToInitialize.set(Q,T)):!S&&T.rendered&&(this._labelsToRemove.set(Q,
T),this._labelsToAdd.delete(Q)),T.visible=S,this.setDirty())};O.setDirty=function(){!this._dirty&&0<this._labelingContexts.length&&(this._dirty=!0,this.notifyChange("updating"))};b._createClass(I,[{key:"running",get:function(){var Q;return this.view.ready&&(this._dirty||(null==(Q=this._textTextureAtlas)?void 0:Q.updating)||this.deconflictor.running)}},{key:"updating",get:function(){var Q;return this._dirty||(null==(Q=this._textTextureAtlas)?void 0:Q.updating)||this.deconflictor.updating||this._labelingContexts.some(S=>
S.labelClassPromise&&!!S.labelClassAbortController)}},{key:"updatingProgress",get:function(){if(!this.updating||!this._textTextureAtlas)return 1;const Q=0<this._labelingContexts.length?this._labelingContexts.reduce((S,T)=>S+(T.labelClassPromise&&T.labelClassAbortController?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*Q+.5*this.deconflictor.updatingProgress}},{key:"test",get:function(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>
this._resetAllLabels()}}}]);return I}(m);c.__decorate([e.property({constructOnly:!0})],a.Labeler.prototype,"view",void 0);c.__decorate([e.property({constructOnly:!0})],a.Labeler.prototype,"deconflictor",void 0);c.__decorate([e.property()],a.Labeler.prototype,"_textTextureAtlas",void 0);c.__decorate([e.property({type:Boolean,readOnly:!0})],a.Labeler.prototype,"updating",null);a.Labeler=c.__decorate([t.subclass("esri.views.3d.layers.graphics.Labeler")],a.Labeler);const J=new A(null,null,null);Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/hydratedFeatures":function(){define("exports ../../Graphic ../../core/has ../../core/lang ../../core/maybe ../../core/typedArrayUtil ../../geometry/support/jsonUtils ./dehydratedFeatures".split(" "),function(a,b,c,m,l,r,n,g){function k(B){return"declaredClass"in B}function f(B){return"declaredClass"in B}function d(B){return"declaredClass"in B}function e(B){return l.isNone(B)?null:k(B)?B:n.fromJSON(h(B))}function h(B){const q=
B.spatialReference.toJSON();switch(B.type){case "point":{const {x:u,y:C,z,m:A}=B;return{x:u,y:C,z,m:A,spatialReference:q}}case "polygon":{const {rings:u,hasZ:C,hasM:z}=B;return{rings:v(u),hasZ:C,hasM:z,spatialReference:q}}case "polyline":{const {paths:u,hasZ:C,hasM:z}=B;return{paths:v(u),hasZ:C,hasM:z,spatialReference:q}}case "extent":{const {xmin:u,xmax:C,ymin:z,ymax:A,zmin:p,zmax:y,mmin:D,mmax:E,hasZ:F,hasM:G}=B;return{xmin:u,xmax:C,ymin:z,ymax:A,zmin:p,zmax:y,mmin:D,mmax:E,hasZ:F,hasM:G,spatialReference:q}}case "multipoint":{const {points:u,
hasZ:C,hasM:z}=B;return{points:x(u)?w(u):u,hasZ:C,hasM:z,spatialReference:q}}}}function v(B){return t(B)?B.map(q=>w(q)):B}function w(B){return B.map(q=>r.toArray(q))}function t(B){for(const q of B)if(0!==q.length)return x(q);return!1}function x(B){return B.length&&(r.isFloat32Array(B[0])||r.isFloat64Array(B[0]))}a.clonePoint=function(B,q){if(!B)return null;if(f(B)){if(null==q)return B.clone();if(f(q))return q.copy(B)}null!=q?(q.x=B.x,q.y=B.y,q.spatialReference=B.spatialReference,B.hasZ?(q.z=B.z,q.hasZ=
B.hasZ):(q.z=null,q.hasZ=!1),B.hasM?(q.m=B.m,q.hasM=!0):(q.m=null,q.hasM=!1)):(q=g.makeDehydratedPoint(B.x,B.y,B.z,B.spatialReference),B.hasM&&(q.m=B.m,q.hasM=!0));return q};a.hydrateGeometry=e;a.hydrateGraphic=function(B,q){if(!B)return null;if(d(B))return B;q=new b({layer:q,sourceLayer:q});q.visible=B.visible;q.symbol=m.clone(B.symbol);q.attributes=m.clone(B.attributes);q.geometry=e(B.geometry);return q};a.isHydratedGeometry=k;a.isHydratedGraphic=d;a.isHydratedPoint=f;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/dehydratedFeatures":function(){define("exports ../../core/byteSizeEstimations ../../core/has ../../core/maybe ../../core/typedArrayUtil ../../core/uid ../../geometry/SpatialReference ../../geometry/support/aaBoundingBox ../../geometry/support/aaBoundingRect ../../geometry/support/quantizationUtils ../../geometry/support/typeUtils ../support/Field ./dehydratedFeatureComparison".split(" "),function(a,b,c,m,l,r,n,
g,k,f,d,e,h){function v(u,C,z){if(m.isNone(u))return null;switch(C){case "point":return{x:u.x,y:u.y,z:u.z,m:u.m,hasZ:null!=u.z,hasM:null!=u.m,type:"point",spatialReference:z};case "polyline":return{paths:u.paths,hasZ:!!u.hasZ,hasM:!!u.hasM,type:"polyline",spatialReference:z};case "polygon":return{rings:u.rings,hasZ:!!u.hasZ,hasM:!!u.hasM,type:"polygon",spatialReference:z};case "multipoint":return{points:u.points,hasZ:!!u.hasZ,hasM:!!u.hasM,type:"multipoint",spatialReference:z}}}function w(u){if(m.isNone(u))return 0;
let C=32;switch(u.type){case "point":C+=42;break;case "polyline":case "polygon":{var z=0;const A=2+(u.hasZ?1:0)+(u.hasM?1:0);u="polyline"===u.type?u.paths:u.rings;for(const p of u)z+=p.length;C+=8*z*A+64;C+=128*z;C=C+34+32*(u.length+1);break}case "multipoint":z=u.points.length;C+=8*z*(2+(u.hasZ?1:0)+(u.hasM?1:0))+64;C+=128*z;C=C+34+32;break;case "extent":C+=98;u.hasM&&(C+=32);u.hasZ&&(C+=32);break;case "mesh":C+=l.estimateSize(u.vertexAttributes.position),C+=l.estimateSize(u.vertexAttributes.normal),
C+=l.estimateSize(u.vertexAttributes.uv),C+=l.estimateSize(u.vertexAttributes.tangent)}return C}function t(u,C){g.empty(C);"mesh"===u.type&&(u=u.extent);switch(u.type){case "point":C[0]=C[3]=u.x;C[1]=C[4]=u.y;u.hasZ&&(C[2]=C[5]=u.z);break;case "polyline":for(var z=0;z<u.paths.length;z++)g.expandWithNestedArray(C,u.paths[z],u.hasZ);break;case "polygon":for(z=0;z<u.rings.length;z++)g.expandWithNestedArray(C,u.rings[z],u.hasZ);break;case "multipoint":g.expandWithNestedArray(C,u.points,u.hasZ);break;
case "extent":C[0]=u.xmin,C[1]=u.ymin,C[3]=u.xmax,C[4]=u.ymax,null!=u.zmin&&(C[2]=u.zmin),null!=u.zmax&&(C[5]=u.zmax)}}function x(u,C){k.empty(C);"mesh"===u.type&&(u=u.extent);switch(u.type){case "point":C[0]=C[2]=u.x;C[1]=C[3]=u.y;break;case "polyline":for(var z=0;z<u.paths.length;z++)k.expandWithNestedArray(C,u.paths[z]);break;case "polygon":for(z=0;z<u.rings.length;z++)k.expandWithNestedArray(C,u.rings[z]);break;case "multipoint":k.expandWithNestedArray(C,u.points);break;case "extent":C[0]=u.xmin,
C[1]=u.ymin,C[2]=u.xmax,C[3]=u.ymax}}const B=g.create(),q=k.create();a.equals=h.equals;a.DehydratedFeatureClass=function(u,C,z){this.uid=u;this.geometry=C;this.attributes=z;this.visible=!0;this.centroid=this.objectId=null};a.DehydratedFeatureSetClass=function(){this.exceededTransferLimit=!1;this.features=[];this.fields=[];this.hasZ=this.hasM=!1;this.transform=this.spatialReference=this.geohashFieldName=this.geometryProperties=this.globalIdFieldName=this.objectIdFieldName=this.geometryType=null};a.computeAABB=
t;a.computeAABR=x;a.estimateGeometryObjectSize=w;a.estimateSize=function(u){let C;C=32+b.estimateAttributesObjectSize(u.attributes);return C=C+3+(8+w(u.geometry))};a.expandAABB=function(u,C){t(u,B);g.expandWithAABB(C,B)};a.expandAABR=function(u,C){m.isSome(u)&&(x(u,q),k.expand(C,q,C))};a.fromFeatureSetJSON=function(u){const C=d.featureGeometryTypeKebabDictionary.fromJSON(u.geometryType),z=n.fromJSON(u.spatialReference),A=u.transform,p=u.features.map(y=>{var D=u.objectIdFieldName;y={uid:r.generateUID(),
objectId:D&&y.attributes?y.attributes[D]:null,attributes:y.attributes,geometry:v(y.geometry,C,z),visible:!0};D=y.geometry;if(m.isSome(D)&&A)switch(D.type){case "point":y.geometry=f.unquantizePoint(A,D,D,D.hasZ,D.hasM);break;case "multipoint":y.geometry=f.unquantizeMultipoint(A,D,D,D.hasZ,D.hasM);break;case "polygon":y.geometry=f.unquantizePolygon(A,D,D,D.hasZ,D.hasM);break;case "polyline":y.geometry=f.unquantizePolyline(A,D,D,D.hasZ,D.hasM);break;case "extent":y.geometry=D;break;case "mesh":y.geometry=
D}return y});return{geometryType:C,features:p,spatialReference:z,fields:u.fields?u.fields.map(y=>e.fromJSON(y)):null,objectIdFieldName:u.objectIdFieldName,globalIdFieldName:u.globalIdFieldName,geohashFieldName:u.geohashFieldName,geometryProperties:u.geometryProperties,hasZ:u.hasZ,hasM:u.hasM,exceededTransferLimit:u.exceededTransferLimit,transform:null}};a.fromJSONGeometry=v;a.getObjectId=function(u,C){return null!=u.objectId?u.objectId:u.attributes&&C?u.attributes[C]:null};a.hasGeometry=function(u){return m.isSome(u.geometry)};
a.hasVertices=function(u){if(m.isNone(u))return!1;switch(u.type){case "extent":case "point":return!0;case "polyline":for(const C of u.paths)if(0<C.length)return!0;return!1;case "polygon":for(const C of u.rings)if(0<C.length)return!0;return!1;case "multipoint":return 0<u.points.length;case "mesh":return!u.loaded||0<u.vertexAttributes.position.length}};a.isFeatureGeometry=function(u){return d.isFeatureGeometryType(u.type)};a.makeDehydratedPoint=function(u,C,z,A){return{x:u,y:C,z,hasZ:null!=z,hasM:!1,
spatialReference:A,type:"point"}};a.numVertices=function(u){if(m.isNone(u))return 0;switch(u.type){case "point":return 1;case "polyline":var C=0;for(var z of u.paths)C+=z.length;return C;case "polygon":z=0;for(C of u.rings)z+=C.length;return z;case "multipoint":return u.points.length;case "extent":return 2;case "mesh":return(u=u.vertexAttributes&&u.vertexAttributes.position)?u.length/3:0}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/quantizationUtils":function(){define(["exports",
"../../core/maybe","./jsonUtils"],function(a,b,c){function m({scale:E,translate:F},G){return Math.round((G-F[0])/E[0])}function l({scale:E,translate:F},G){return Math.round((F[1]-G)/E[1])}function r(E,F,G){const P=[];let K,N,M,L;for(let J=0;J<G.length;J++){const H=G[J];if(0<J){if(M=m(E,H[0]),L=l(E,H[1]),M!==K||L!==N)P.push(F(H,M-K,L-N)),K=M,N=L}else K=m(E,H[0]),N=l(E,H[1]),P.push(F(H,K,N))}return 0<P.length?P:null}function n(E,F,G,P){return r(E,G?P?D:y:P?y:p,F)}function g(E,F,G,P){const K=[];G=G?
P?D:y:P?y:p;for(P=0;P<F.length;P++){const N=r(E,G,F[P]);N&&3<=N.length&&K.push(N)}return K.length?K:null}function k(E,F,G,P){const K=[];G=G?P?D:y:P?y:p;for(P=0;P<F.length;P++){const N=r(E,G,F[P]);N&&2<=N.length&&K.push(N)}return K.length?K:null}function f({scale:E,translate:F},G){return G*E[0]+F[0]}function d({scale:E,translate:F},G){return F[1]-G*E[1]}function e(E,F,G){const P=Array(G.length);if(!G.length)return P;const [K,N]=E.scale;let M=f(E,G[0][0]);E=d(E,G[0][1]);P[0]=F(G[0],M,E);for(let L=1;L<
G.length;L++){const J=G[L];M+=J[0]*K;E-=J[1]*N;P[L]=F(J,M,E)}return P}function h(E,F,G){const P=Array(G.length);for(let K=0;K<G.length;K++)P[K]=e(E,F,G[K]);return P}function v(E,F,G,P){return e(E,G?P?D:y:P?y:p,F)}function w(E,F,G,P){return h(E,G?P?D:y:P?y:p,F)}function t(E,F,G,P){return h(E,G?P?D:y:P?y:p,F)}function x(E,F,G){let [P,K]=G[0],N=Math.min(P,F[0]),M=Math.min(K,F[1]),L=Math.max(P,F[2]);F=Math.max(K,F[3]);for(let J=1;J<G.length;J++){const [H,I]=G[J];P+=H;K+=I;0>H&&(N=Math.min(N,P));0<H&&
(L=Math.max(L,P));0>I?M=Math.min(M,K):0<I&&(F=Math.max(F,K))}E[0]=N;E[1]=M;E[2]=L;E[3]=F;return E}function B(E,F){if(!F.length)return null;E[0]=E[1]=Number.POSITIVE_INFINITY;E[2]=E[3]=Number.NEGATIVE_INFINITY;for(let G=0;G<F.length;G++)x(E,E,F[G]);return E}function q(E,F,G,P,K){F.xmin=m(E,G.xmin);F.ymin=l(E,G.ymin);F.xmax=m(E,G.xmax);F.ymax=l(E,G.ymax);F!==G&&(P&&(F.zmin=G.zmin,F.zmax=G.zmax),K&&(F.mmin=G.mmin,F.mmax=G.mmax));return F}function u(E,F,G,P,K){F.points=n(E,G.points,P,K);return F}function C(E,
F,G,P,K){F.x=m(E,G.x);F.y=l(E,G.y);F!==G&&(P&&(F.z=G.z),K&&(F.m=G.m));return F}function z(E,F,G,P,K){E=g(E,G.rings,P,K);if(!E)return null;F.rings=E;return F}function A(E,F,G,P,K){E=k(E,G.paths,P,K);if(!E)return null;F.paths=E;return F}const p=(E,F,G)=>[F,G],y=(E,F,G)=>[F,G,E[2]],D=(E,F,G)=>[F,G,E[2],E[3]];a.equals=function(E,F){if(E===F||null==E&&null==F)return!0;if(null==E||null==F)return!1;let G,P,K,N;E&&"upperLeft"===E.originPosition?(G=E.translate[0],P=E.translate[1],E=E.scale[0]):(G=b.isSome(E.extent)?
E.extent.xmin:0,P=b.isSome(E.extent)?E.extent.ymax:0,E=E.tolerance);F&&"upperLeft"===F.originPosition?(K=F.translate[0],N=F.translate[1],F=F.scale[0]):(K=b.isSome(F.extent)?F.extent.xmin:0,N=b.isSome(F.extent)?F.extent.ymax:0,F=F.tolerance);return G===K&&P===N&&E===F};a.getQuantizedBoundsCoordsArray=x;a.getQuantizedBoundsCoordsArrayArray=B;a.getQuantizedBoundsPaths=function(E){return B([0,0,0,0],E)};a.getQuantizedBoundsPoints=function(E){const F=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,
Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return x(F,F,E)};a.getQuantizedBoundsRings=function(E){return B([0,0,0,0],E)};a.quantizeBounds=function(E,F,G){F[0]=m(E,G[0]);F[3]=l(E,G[1]);F[2]=m(E,G[2]);F[1]=l(E,G[3]);return F};a.quantizeExtent=q;a.quantizeGeometry=function(E,F){return E&&F?c.isPoint(F)?C(E,{},F,!1,!1):c.isPolyline(F)?A(E,{},F,!1,!1):c.isPolygon(F)?z(E,{},F,!1,!1):c.isMultipoint(F)?u(E,{},F,!1,!1):c.isExtent(F)?q(E,{},F,!1,!1):null:null};a.quantizeMultipoint=u;a.quantizePaths=
k;a.quantizePoint=C;a.quantizePoints=n;a.quantizePolygon=z;a.quantizePolyline=A;a.quantizeRings=g;a.quantizeX=m;a.quantizeY=l;a.toQuantizationTransform=function(E){return E?{originPosition:"upper-left"===E.originPosition?"upperLeft":"lower-left"===E.originPosition?"lowerLeft":E.originPosition,scale:E.tolerance?[E.tolerance,E.tolerance]:[1,1],translate:b.isSome(E.extent)?[E.extent.xmin,E.extent.ymax]:[0,0]}:null};a.unquantizeBounds=function(E,F,G){return G?(F[0]=f(E,G[0]),F[1]=d(E,G[3]),F[2]=f(E,G[2]),
F[3]=d(E,G[1]),F):[f(E,F[0]),d(E,F[3]),f(E,F[2]),d(E,F[1])]};a.unquantizeCoordsArray=e;a.unquantizeCoordsArrayArray=h;a.unquantizeExtent=function(E,F,G,P,K){F.xmin=f(E,G.xmin);F.ymin=d(E,G.ymin);F.xmax=f(E,G.xmax);F.ymax=d(E,G.ymax);F!==G&&(P&&(F.zmin=G.zmin,F.zmax=G.zmax),K&&(F.mmin=G.mmin,F.mmax=G.mmax));return F};a.unquantizeMultipoint=function(E,F,G,P,K){b.isSome(G)&&(F.points=v(E,G.points,P,K));return F};a.unquantizePaths=w;a.unquantizePoint=function(E,F,G,P,K){if(b.isNone(G))return F;F.x=f(E,
G.x);F.y=d(E,G.y);F!==G&&(P&&(F.z=G.z),K&&(F.m=G.m));return F};a.unquantizePoints=v;a.unquantizePolygon=function(E,F,G,P,K){b.isSome(G)&&(F.rings=t(E,G.rings,P,K));return F};a.unquantizePolyline=function(E,F,G,P,K){b.isSome(G)&&(F.paths=w(E,G.paths,P,K));return F};a.unquantizeRings=t;a.unquantizeX=f;a.unquantizeY=d;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/dehydratedFeatureComparison":function(){define(["exports","../../core/has",
"../../core/maybe"],function(a,b,c){function m(f,d){if(f===d)return!0;if(null==f||null==d||f.length!==d.length)return!1;for(let e=0;e<f.length;e++){const h=f[e],v=d[e];if(h.length!==v.length)return!1;for(let w=0;w<h.length;w++)if(h[w]!==v[w])return!1}return!0}function l(f,d){if(f===d)return!0;if(null==f||null==d||f.length!==d.length)return!1;for(let e=0;e<f.length;e++)if(!m(f[e],d[e]))return!1;return!0}function r(f,d){return n(f.spatialReference,d.spatialReference)?f.x===d.x&&f.y===d.y&&f.z===d.z&&
f.m===d.m:!1}function n(f,d){return f===d||f&&d&&f.equals(d)}function g(f,d){if(f===d)return!0;if(c.isNone(f)||c.isNone(d)||f.type!==d.type)return!1;switch(f.type){case "point":return r(f,d);case "extent":return f=f.hasZ!==d.hasZ||f.hasM!==d.hasM?!1:n(f.spatialReference,d.spatialReference)?f.xmin===d.xmin&&f.ymin===d.ymin&&f.zmin===d.zmin&&f.xmax===d.xmax&&f.ymax===d.ymax&&f.zmax===d.zmax:!1,f;case "polyline":return f=f.hasZ!==d.hasZ||f.hasM!==d.hasM?!1:n(f.spatialReference,d.spatialReference)?l(f.paths,
d.paths):!1,f;case "polygon":return f=f.hasZ!==d.hasZ||f.hasM!==d.hasM?!1:n(f.spatialReference,d.spatialReference)?l(f.rings,d.rings):!1,f;case "multipoint":return f=f.hasZ!==d.hasZ||f.hasM!==d.hasM?!1:n(f.spatialReference,d.spatialReference)?m(f.points,d.points):!1,f;case "mesh":return!1}}function k(f,d){if(f===d)return!0;if(!f||!d)return!1;const e=Object.keys(f),h=Object.keys(d);if(e.length!==h.length)return!1;for(const v of e)if(f[v]!==d[v])return!1;return!0}a.equals=function(f,d){return f===d?
!0:null!=f&&null!=d&&f.objectId===d.objectId&&g(f.geometry,d.geometry)&&k(f.attributes,d.attributes)?!0:!1};a.pointEquals=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/labelFormatUtils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../core/Error ../../core/Logger ../../intl/date ../../intl/number ./fieldUtils ./labelUtils ../../support/arcadeOnDemand".split(" "),function(a,b,c,m,l,r,n,g,k,f){function d(){d=
c._asyncToGenerator(function*(t,x,B){if(!t||!t.symbol)return v;const q=t.where,u=k.getLabelExpression(t);t=q?yield new Promise((C,z)=>a(["../../core/sql/WhereClause"],C,z)):null;if("arcade"===u.type){const C=yield f.createLabelExpression(u.expression,B,x);B={type:"arcade",evaluate(z){try{const A=C.evaluate({$feature:"attributes"in z?C.repurposeFeature(z):z});if(null!=A)return A.toString()}catch(A){h.error(new m("arcade-expression-error","Encountered an error when evaluating label expression for feature",
{feature:z,expression:u}))}return null},needsHydrationToEvaluate(){return null==k.getSingleFieldArcadeExpression(u.expression)}}}else B={type:"simple",evaluate(C){return u.expression.replace(/{[^}]*}/g,z=>{var A=z.slice(1,-1);A=x.get(A);if(!A)return z;z=null;"attributes"in C?C&&C.attributes&&(z=C.attributes[A.name]):z=C.field(A.name);return null==z?"":e(z,A)})}};if(q){let C;try{C=t.WhereClause.create(q,x)}catch(A){return h.error(new m("bad-where-clause","Encountered an error when evaluating where clause, ignoring",
{where:q,error:A})),v}const z=B.evaluate;B.evaluate=A=>{const p="attributes"in A?void 0:w;try{if(C.testFeature(A,p))return z(A)}catch(y){h.error(new m("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:q,feature:A,error:y}))}return null}}return B});return d.apply(this,arguments)}function e(t,x){if(null==t)return"";const B=x.domain;if(B)if("codedValue"===B.type||"coded-value"===B.type)for(var q of B.codedValues){if(q.code===t)return q.name}else if("range"===B.type){q=
+t;const u="range"in B?B.range[1]:B.maxValue;if(("range"in B?B.range[0]:B.minValue)<=q&&q<=u)return B.name}"date"===x.type||"esriFieldTypeDate"===x.type?t=r.formatDate(t,r.convertDateFormatToIntlOptions("short-date")):g.isNumericField(x)&&(t=n.formatNumber(+t));return t?t:""}const h=l.getLogger("esri.layers.support.labelFormatUtils"),v={type:"simple",evaluate(){return null}},w={getAttribute(t,x){return t.field(x)}};b.createLabelFunction=function(t,x,B){return d.apply(this,arguments)};b.formatField=
e;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["exports","../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(a,b,c,m){const l=b.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory"),r={line:m.Graphics3DLineCalloutSymbolLayer};a.make=function(n,g){if(!c.hasCalloutSupport(n))return l.error("Graphics3DCalloutSymbolLayerFactory#make",
`symbol of type '${n.type}' does not support callouts`),null;if(!n.callout)return null;const k=r[n.callout.type];return k?new k(n,g):(l.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${n.callout.type}`),null)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./symbolComplexity ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Material ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u){e=function(y){function D(F,G){F=y.call(this,F,null,G,p)||this;F._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};F.ensureDrapedStatus(!1);return F}b._inheritsLoose(D,y);var E=D.prototype;E.doLoad=function(){var F=b._asyncToGenerator(function*(){this._material=new u.LineCalloutMaterial(this.materialParameters);this._context.stage.add(this._material)});return function(){return F.apply(this,arguments)}}();E.destroy=function(){y.prototype.destroy.call(this);
this._context.stage.remove(this._material);this._material=null};E._perInstanceMaterialParameters=function(F){const G=this.materialParameters;G.screenOffset=F.screenOffset||r.ZEROS;G.centerOffsetUnits=F.centerOffsetUnits||"world";return G};E._defaultElevationInfoNoZ=function(){return A};E.createGraphics3DGraphic=function(F){const G=F.renderingInfo;F=F.graphic;const P=this.setGraphicElevationContext(F,new f.ElevationContext,G.elevationOffset||0);var K=G.symbol;const N="on-the-ground"===this._elevationContext.mode&&
("cim"===K.type||!K.symbolLayers.some(M=>"object"===M.type||"text"===M.type));if("label-3d"!==K.type&&N||"point-3d"===K.type&&K.symbolLayers.every(M=>"text"===M.type&&!n.textSymbolLayerSupportsVerticalOffset(M)))return null;K=h.computeCentroid(F.geometry);return m.isNone(K)?null:this._createAs3DShape(K,P,G,F.uid)};E.layerOpacityChanged=function(){if(m.isNone(this._material))return!0;this._material.setParameters(this.materialParameters);return!0};E.layerElevationInfoChanged=function(F,G,P){P=k.elevationModeChangeUpdateType(D.elevationModeChangeTypes,
P,this._elevationContext.mode);if(P!==k.SymbolUpdateType.UPDATE)return P;F.forEach(K=>{const N=G(K);m.isSome(N)&&this.updateGraphicElevationContext(K.graphic,N)});return P};E.slicePlaneEnabledChanged=function(){if(m.isNone(this._material))return!0;this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};E.physicalBasedRenderingChanged=function(){return!0};E.pixelRatioChanged=function(){return!0};E.setGraphicElevationContext=function(F,G,P=0){F=y.prototype.setGraphicElevationContext.call(this,
F,G);F.addOffsetRenderUnits(P);return F};E.updateGraphicElevationContext=function(F,G){this.setGraphicElevationContext(F,G.elevationContext,G.metadata.elevationOffset);G.needsElevationUpdates=k.needsElevationUpdates2D(G.elevationContext.mode)};E.computeComplexity=function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:w.emptySymbolComplexity.memory}};E._createVertexData=function(F){const {translation:G,centerOffset:P}=F;return[[q.VertexAttribute.POSITION,
G?{size:3,data:[G[0],G[1],G[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0}],[q.VertexAttribute.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[q.VertexAttribute.AUXPOS1,P?{size:4,data:[P[0],P[1],P[2],P[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0}]]};E._getOrCreateMaterial=function(F){const G=this._perInstanceMaterialParameters(F),P=u.LineCalloutMaterial.uniqueMaterialIdentifier(G);if(m.isSome(this._material)&&P===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};
if(F.materialCollection){let K=F.materialCollection.get(P);m.isNone(K)&&(K=new u.LineCalloutMaterial(G),F.materialCollection.add(P,K));return{material:K,isUnique:!1}}return{material:new u.LineCalloutMaterial(G),isUnique:!0}};E._createAs3DShape=function(F,G,P,K){var N=[new x.Geometry(this._createVertexData(P),z,t.PrimitiveType.Point)];const M=this._getOrCreateMaterial(P);K=v.createStageObjectForHUD(this._context,F,N,[M.material],G,this._context.layer.uid,K);if(null===K)return null;N=new d.Graphics3DObject3DGraphicLayer(this,
K.object,N,M.isUnique?[M.material]:null,null,g.perObjectElevationAligner,G);N.metadata={elevationOffset:P.elevationOffset||0};N.alignedSampledElevation=K.sampledElevation;N.needsElevationUpdates=k.needsElevationUpdates2D(G.mode);v.extendPointGraphicElevationContext(N,F,this._context.elevationProvider);return N};b._createClass(D,[{key:"materialParameters",get:function(){const F=this.symbol;var G=F.callout;const P=m.isSome(G.color)?c.toUnitRGBA(G.color):[0,0,0,0];P[3]*=this._getLayerOpacity();const K=
l.pt2px(G.size||0);let N=null;if(F.verticalOffset){const {screenLength:L,minWorldLength:J,maxWorldLength:H}=F.verticalOffset;N={screenLength:l.pt2px(L),minWorldLength:J||0,maxWorldLength:null!=H?H:Infinity}}G=m.isSome(G.border)&&m.isSome(G.border.color)?c.toUnitRGBA(G.border.color):null;const M="object"===F.symbolLayers.getItemAt(0).type;return{color:P,size:K,verticalOffset:N,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:
null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:G,occlusionTest:!M,shaderPolygonOffset:M?0:void 0,depthHUDAlignStart:"label-3d"===F.type,hasSlicePlane:this._context.slicePlaneEnabled,renderOccluded:B.RenderOccludedFlag.Occlude,__tagStrict:"NoParameters"}}}]);return D}(e.Graphics3DSymbolLayer);e.elevationModeChangeTypes={definedChanged:k.SymbolUpdateType.UPDATE,staysOnTheGround:k.SymbolUpdateType.UPDATE,onTheGroundChanged:k.SymbolUpdateType.RECREATE};const C=new Uint16Array([0]),z=[[q.VertexAttribute.POSITION,
C],[q.VertexAttribute.NORMAL,C],[q.VertexAttribute.AUXPOS1,C]],A={mode:"relative-to-ground",offset:0},p={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};a.Graphics3DLineCalloutSymbolLayer=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ./elevationAlignmentUtils ./graphicUtils ../../support/debugFlags ../../support/ElevationProvider ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e){function h(C,z,A,p){let y=!1;const D=A.spatialReference;var E=C.geometry,F=C.getShaderTransformation();C=z.requiresSampledElevationInfo;t[0]=F[12];t[1]=F[13];t[2]=F[14];E.invalidateBoundingInfo();var G=E.getMutableAttribute(e.VertexAttribute.POSITION);F=G.data;var P=E.vertexAttributes.get(e.VertexAttribute.MAPPOS).data;E=G.size;G=F.length/E;P=new d.SamplePosition(P,D);let K=0,N=0;for(let M=0;M<G;M++){x[0]=F[K];x[1]=F[K+1];x[2]=F[K+2];g.evaluateElevationInfoAtPoint(P,
A,z,p,u);C&&(N+=u.sampledElevation);if(f.TESTS_DISABLE_OPTIMIZATIONS)F[K]=P.array[P.offset],F[K+1]=P.array[P.offset+1],F[K+2]=u.z,n.projectBuffer(F,D,K,F,p.spatialReference,K,1),F[K]-=t[0],F[K+1]-=t[1],F[K+2]-=t[2],y=!0;else{w[0]=F[K]+t[0];w[1]=F[K+1]+t[1];w[2]=F[K+2]+t[2];p.setAltitude(w,u.z);F[K]=w[0]-t[0];F[K+1]=w[1]-t[1];F[K+2]=w[2]-t[2];const L=.01/p.unitInMeters;if(Math.abs(x[0]-F[K])>=L||Math.abs(x[1]-F[K+1])>=L||Math.abs(x[2]-F[K+2])>=L)y=!0}K+=E;P.offset+=3}return{update:y,averageGeometrySampledElevation:N/
G}}const v=m.create(),w=r.create(),t=r.create(),x=r.create(),B=m.create(),q=r.create(),u=new g.SampleElevationInfo;a.perLodInstanceElevationAligner=function(C,z,A,p){var y=C.graphics3DSymbolLayer.lodRenderer;if(b.isNone(y))return 0;const D=z.centerPointInElevationSR;g.evaluateElevationInfoAtPoint(D,A,z,p,u);z="absolute-height"!==z.mode?u.sampledElevation:0;y=y.instanceData;C=C.instanceIndex;y.getGlobalTransform(C,B);A=l.set(q,B[12],B[13],B[14]);f.TESTS_DISABLE_OPTIMIZATIONS?(w[0]=D.x,w[1]=D.y,w[2]=
u.z,n.computeTranslationToOriginAndRotation(D.spatialReference,w,B,p.spatialReference)&&y.setGlobalTransform(C,B)):p.setAltitudeOfTransformation(u.z,B);p=.01/p.unitInMeters;(f.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(B[12]-A[0])>=p||Math.abs(B[13]-A[1])>=p||Math.abs(B[14]-A[2])>=p)&&y.setGlobalTransform(C,B);return z};a.perObjectElevationAligner=function(C,z,A,p){C=C.stageObject;const y=z.centerPointInElevationSR;let D=0;C.metadata.usesVerticalDistanceToGround?(g.evaluateElevationInfoAtPoint(y,A,z,p,
u),k.updateVertexAttributeAuxpos1w(C,u.verticalDistanceToGround),D=u.sampledElevation):(g.evaluateElevationInfoAtPoint(y,A,z,p,u),"absolute-height"!==z.mode&&(D=u.sampledElevation));z=c.copy(v,C.transformation);A=l.set(q,z[12],z[13],z[14]);f.TESTS_DISABLE_OPTIMIZATIONS?(w[0]=y.x,w[1]=y.y,w[2]=u.z,n.computeTranslationToOriginAndRotation(y.spatialReference,w,z,p.spatialReference)&&(C.transformation=z)):p.setAltitudeOfTransformation(u.z,z);p=.01/p.unitInMeters;if(Math.abs(z[12]-A[0])>=p||Math.abs(z[13]-
A[1])>=p||Math.abs(z[14]-A[2])>=p)C.transformation=z;return D};a.perVertexElevationAligner=function(C,z,A,p){C=C.stageObject;const y=C.geometryRecords;let D=0;for(const E of y){const {update:F,averageGeometrySampledElevation:G}=h(E,z,A,p);D+=G;F&&C.geometryVertexAttrsUpdated(E)}return D/y.length};a.sharedGeometryElevationAligner=function(C,z,A,p){C=C.stageObject;const y=C.geometryRecords;if(0===y.length)return 0;let D=0,E=null,F=0,G=!1;for(const P of y){const K=P.geometry.vertexAttributes.get(e.VertexAttribute.POSITION);
if(K!==E){const {update:N,averageGeometrySampledElevation:M}=h(P,z,A,p);F=M;E=K;G=N}G&&C.geometryVertexAttrsUpdated(P);D+=F}return D/y.length};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/elevationAlignmentUtils":function(){define("exports ../../../../core/compilerUtils ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../layers/graphics/dehydratedFeatureUtils ./graphicUtils ../../support/ElevationProvider".split(" "),
function(a,b,c,m,l,r,n,g,k,f){function d(x,B,q,u,C){const z=(g.isDehydratedPoint(x)?x.z:f.isSamplePosition(x)?x.array[x.offset+2]:x[2])||0;switch(q.mode){case "on-the-ground":q=c.unwrapOr(f.getElevationAtPoint(B,x,"ground"),0);C.verticalDistanceToGround=0;C.sampledElevation=q;C.z=q;break;case "relative-to-ground":x=c.unwrapOr(f.getElevationAtPoint(B,x,"ground"),0);q=q.geometryZWithOffset(z,u);C.verticalDistanceToGround=q;C.sampledElevation=x;C.z=q+x;break;case "relative-to-scene":x=c.unwrapOr(f.getElevationAtPoint(B,
x,"scene"),0);q=q.geometryZWithOffset(z,u);C.verticalDistanceToGround=q;C.sampledElevation=x;C.z=q+x;break;case "absolute-height":q=q.geometryZWithOffset(z,u);u=c.unwrapOr(f.getElevationAtPoint(B,x,"ground"),0);C.verticalDistanceToGround=q-u;C.sampledElevation=u;C.z=q;break;default:b.neverReached(q.mode),C.z=0}}let e=function(){this.z=this.sampledElevation=this.verticalDistanceToGround=0};a.SymbolUpdateType=void 0;(function(x){x[x.NONE=0]="NONE";x[x.UPDATE=1]="UPDATE";x[x.RECREATE=2]="RECREATE"})(a.SymbolUpdateType||
(a.SymbolUpdateType={}));const h={"absolute-height":{applyElevationAlignmentBuffer:function(x,B,q,u,C,z,A,p){z=p.calculateOffsetRenderUnits(A);p=p.featureExpressionInfoContext;B*=3;u*=3;for(A=0;A<C;++A){const y=x[B+1],D=x[B+2];q[u+0]=x[B+0];q[u+1]=y;q[u+2]=null==p?D+z:z;B+=3;u+=3}return 0},requiresAlignment:function(x){const B=x.featureExpressionInfoContext;return 0!==x.meterUnitOffset||null!=B}},"on-the-ground":{applyElevationAlignmentBuffer:function(x,B,q,u,C,z){let A=0;const p=z.spatialReference;
B*=3;u*=3;for(let y=0;y<C;++y){const D=x[B+0],E=x[B+1],F=c.unwrapOr(z.getElevation(D,E,x[B+2],p,"ground"),0);A+=F;q[u+0]=D;q[u+1]=E;q[u+2]=F;B+=3;u+=3}return A/C},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(x,B,q,u,C,z,A,p){let y=0;A=p.calculateOffsetRenderUnits(A);p=p.featureExpressionInfoContext;const D=z.spatialReference;B*=3;u*=3;for(let E=0;E<C;++E){const F=x[B+0],G=x[B+1],P=x[B+2],K=c.unwrapOr(z.getElevation(F,G,P,D,"ground"),0);y+=K;q[u+0]=F;q[u+1]=
G;q[u+2]=null==p?P+K+A:K+A;B+=3;u+=3}return y/C},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(x,B,q,u,C,z,A,p){let y=0;A=p.calculateOffsetRenderUnits(A);p=p.featureExpressionInfoContext;const D=z.spatialReference;B*=3;u*=3;for(let E=0;E<C;++E){const F=x[B+0],G=x[B+1],P=x[B+2],K=c.unwrapOr(z.getElevation(F,G,P,D,"scene"),0);y+=K;q[u+0]=F;q[u+1]=G;q[u+2]=null==p?P+K+A:K+A;B+=3;u+=3}return y/C},requiresAlignment:()=>!0}},v=l.create(),w=new e,t=r.create();a.SampleElevationInfo=
e;a.applyElevationAlignmentForHUD=function(x,B,q,u,C){d(B,q,C,u,w);k.updateVertexAttributeAuxpos1w(x,w.verticalDistanceToGround);q=w.sampledElevation;C=m.copy(v,x.transformation);t[0]=B.x;t[1]=B.y;t[2]=w.z;n.computeTranslationToOriginAndRotation(B.spatialReference,t,C,u.spatialReference)?x.transformation=C:console.warn("Could not locate symbol object properly, it might be misplaced");return q};a.applyPerVertexElevationAlignment=function(x,B,q,u,C,z,A,p,y,D,E){const F=h[E.mode];let G=0;if(n.projectBuffer(x,
B,q,u,y.spatialReference,C,p)&&(F.requiresAlignment(E)?(G=F.applyElevationAlignmentBuffer(u,C,z,A,p,y,D,E),x=z,C=A):x=u,n.projectBuffer(x,y.spatialReference,C,z,D.spatialReference,A,p)))return G};a.elevationModeChangeUpdateType=function(x,B,q){return null==B||null==q?x.definedChanged:"on-the-ground"===B&&"on-the-ground"===q?x.staysOnTheGround:B===q||"on-the-ground"!==B&&"on-the-ground"!==q?a.SymbolUpdateType.UPDATE:x.onTheGroundChanged};a.evaluateElevationAlignmentAtPoint=function(x,B,q,u){d(x,B,
q,u,w);return w.z};a.evaluateElevationInfoAtPoint=d;a.needsElevationUpdates2D=function(x){return"relative-to-ground"===x||"relative-to-scene"===x};a.needsElevationUpdates3D=function(x){return"absolute-height"!==x};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w){function t(q){var u=q.paths[0];if(!u||0===u.length)return null;u=e.getPointOnPath(u,e.getPathLength(u)/2);return h.makeDehydratedPoint(u[0],u[1],u[2],q.spatialReference)}function x(q,u,C){C=C?q:v.clonePoint(q);return u&&q?g.projectPoint(q,C,u)?C:null:C}function B(q){if(Array.isArray(q)){for(const u of q)if(!B(u))return!1;return!0}return null==q||0<=q}a.computeCentroid=function(q,u){if("point"===q.type)return x(q,u,!1);if(v.isHydratedGeometry(q))switch(q.type){case "extent":return x(q.center,
u,!1);case "polygon":return x(q.centroid,u,!1);case "polyline":return x(t(q),u,!0);case "mesh":return x(q.origin,u,!1)}else switch(q.type){case "extent":var C=isFinite(q.zmin);q=h.makeDehydratedPoint(.5*(q.xmax+q.xmin),.5*(q.ymax+q.ymin),C?.5*(q.zmax+q.zmin):void 0,q.spatialReference);return x(q,u,!0);case "polygon":return(C=q.rings[0])&&0!==C.length?(C=d.ringsCentroid(q.rings,q.hasZ),q=h.makeDehydratedPoint(C[0],C[1],C[2],q.spatialReference)):q=null,x(q,u,!0);case "polyline":return x(t(q),u,!0)}};
a.computeObjectRotation=function(q,u,C,z=m.create()){q=q||0;u=u||0;C=C||0;0!==q&&c.rotateZ(z,z,-q/180*Math.PI);0!==u&&c.rotateX(z,z,u/180*Math.PI);0!==C&&c.rotateY(z,z,C/180*Math.PI);return z};a.computeObjectScale=function(q=l.ONES,u,C,z=1){const A=Array(3);if(b.isNone(u)||b.isNone(C))A[0]=1,A[1]=1,A[2]=1;else{let y=0;for(let D=2;0<=D;D--){const E=q[D];let F;const G=null!=E,P=0===D&&!p&&!G,K=C[D];"symbol-value"===E||P?F=0!==K?u[D]/K:1:G&&"proportional"!==E&&isFinite(E)&&(F=0!==K?E/K:1);if(null!=F){var p=
A[D]=F;y=Math.max(y,Math.abs(F))}}for(q=2;0<=q;q--)null==A[q]?A[q]=p:0===A[q]&&(A[q]=.001*y)}for(p=2;0<=p;p--)A[p]/=z;return l.fromArray(A)};a.demResolutionForBoundingBox=function(q,u){return null!=u.minDemResolution?u.minDemResolution:k.isPoint(q)?u.minDemResolutionForPoints:.01*k.maximumDimension(q)};a.enlargeExtent=function(q,u,C,z=0){if(q){u||(u=f.create());let A=.5*q.width*(C-1);C=.5*q.height*(C-1);q.width<1E-7*q.height?A+=C/20:q.height<1E-7*q.width&&(C+=A/20);r.set(u,q.xmin-A-z,q.ymin-C-z,q.xmax+
A+z,q.ymax+C+z);return u}return null};a.isValidSize=B;a.mixinColorAndOpacity=function(q,u){const C=n.clone(n.ONES);b.isSome(q)&&(C[0]=q[0],C[1]=q[1],C[2]=q[2]);b.isSome(u)?C[3]=u:b.isSome(q)&&3<q.length&&(C[3]=q[3]);return C};a.overrideColor=function(q,u,C,z,A,p=[0,0,0,0]){for(let y=0;3>y;++y)b.isSome(q)&&null!=q[y]?p[y]=q[y]:b.isSome(C)&&null!=C[y]?p[y]=C[y]:p[y]=A[y];b.isSome(u)?p[3]=u:b.isSome(z)?p[3]=z:p[3]=A[3];return p};a.updateVertexAttributeAuxpos1w=function(q,u){for(let C=0;C<q.geometries.length;++C){const z=
q.geometries[C].getMutableAttribute(w.VertexAttribute.AUXPOS1);z&&z.data[3]!==u&&(z.data[3]=u,q.geometryVertexAttrsUpdated(q.geometryRecords[C]))}};a.validateSymbolLayerSize=function(q){null!=q.isPrimitive&&(q=[q.width,q.depth,q.height]);return B(q)?null:"Symbol sizes may not be negative values"};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/maybe","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(a,b,c,m,l){let r=function(){function n(){this._renderUnitOffset=this._meterUnitOffset=0;this._unit="meters";this._metersPerElevationInfoUnit=1;this.mode=this.centerPointInElevationSR=this._featureExpressionInfoContext=null}var g=n.prototype;g.reset=function(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=0;this._featureExpressionInfoContext=null;this.unit="meters"};g.addOffsetRenderUnits=
function(k){this._renderUnitOffset+=k};g.geometryZWithOffset=function(k,f){f=this.calculateOffsetRenderUnits(f);return null!=this.featureExpressionInfoContext?f:k+f};g.calculateOffsetRenderUnits=function(k){let f=this._meterUnitOffset;const d=this.featureExpressionInfoContext;null!=d&&(f+=l.execute(d)*this._metersPerElevationInfoUnit);return f/k.unitInMeters+this._renderUnitOffset};g.setFromElevationInfo=function(k){this.mode=k.mode;this.unit=m.supportsUnit(k.unit)?k.unit:"meters";this.offsetElevationInfoUnits=
c.unwrapOr(k.offset,0)};g.updateFeatureExpressionInfoContext=function(k,f,d){if(c.isNone(k))this._featureExpressionInfoContext=null;else{var e=k&&k.arcade;e&&c.isSome(f)&&c.isSome(d)?(this._featureExpressionInfoContext=l.clone(k),l.setContextFeature(this._featureExpressionInfoContext,l.createFeature(e.modules,f,d))):this._featureExpressionInfoContext=k}};n.fromElevationInfo=function(k){const f=new n;c.isSome(k)&&f.setFromElevationInfo(k);return f};b._createClass(n,[{key:"featureExpressionInfoContext",
get:function(){return this._featureExpressionInfoContext}},{key:"meterUnitOffset",get:function(){return this._meterUnitOffset}},{key:"unit",get:function(){return this._unit},set:function(k){this._unit=k;this._metersPerElevationInfoUnit=m.getMetersPerUnit(k)}},{key:"requiresSampledElevationInfo",get:function(){return"absolute-height"!==this.mode}},{key:"offsetMeters",set:function(k){this._meterUnitOffset=k;this._renderUnitOffset=0}},{key:"offsetElevationInfoUnits",set:function(k){this._meterUnitOffset=
k*this._metersPerElevationInfoUnit;this._renderUnitOffset=0}}]);return n}();a.ElevationContext=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Logger","../../../../layers/graphics/hydratedFeatures","../../../../support/arcadeOnDemand"],function(a,b,c,m,l){function r(){r=b._asyncToGenerator(function*(g,
k,f){g=g&&g.expression;if("string"!==typeof g)return null;var d="0"===g?0:null;if(null!=d)return{cachedResult:d};d=yield l.loadArcade();const e=d.arcadeUtils;g=e.createSyntaxTree(g);return e.dependsOnView(g)?(null!=f&&f.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:e.createFunction(g),context:e.createExecContext(null,{sr:k}),modules:d}}});return r.apply(this,arguments)}const n=c.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");
a.clone=function(g){return{cachedResult:g.cachedResult,arcade:g.arcade?{func:g.arcade.func,context:g.arcade.modules.arcadeUtils.createExecContext(null,{sr:g.arcade.context.spatialReference}),modules:g.arcade.modules}:null}};a.createContext=function(g,k,f){return r.apply(this,arguments)};a.createContextWithoutExpressionSupport=function(g){g=g&&g.expression;return"string"===typeof g&&(g="0"===g?0:null,null!=g)?{cachedResult:g}:null};a.createFeature=function(g,k,f){return g.arcadeUtils.createFeature(k.attributes,
k.geometry,f)};a.execute=function(g){if(null!=g){if(null!=g.cachedResult)return g.cachedResult;var k=g.arcade;k=g.arcade.modules.arcadeUtils.executeFunction(k.func,k.context);"number"!==typeof k&&(k=g.cachedResult=0);return k}return 0};a.extractExpressionInfo=function(g,k=!1){const f=(g=g&&g.featureExpressionInfo)&&g.expression;k||"0"===f||(g=null);return g};a.setContextFeature=function(g,k){null!=g&&null==g.cachedResult&&(k&&g.arcade?(k._geometry&&(k._geometry=m.hydrateGeometry(k._geometry)),g.arcade.modules.arcadeUtils.updateExecContext(g.arcade.context,
k)):n.errorOncePerTick("Arcade support required but not provided"))};a.zeroContext={cachedResult:0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){function e(B){return B.isVisible?B.parameters.transparent?d.Transparency.TRANSPARENT:d.Transparency.OPAQUE:d.Transparency.INVISIBLE}let h=function(){function B(u,C,z,A,p,y,D,E=null){this.graphics3DSymbolLayer=u;this.stageObject=C;this._uniqueGeometries=z;this._uniqueMaterials=A;this._sharedResource=p;this.elevationAligner=y;this.elevationContext=D;this._edgeState=E;this.type="object3d";this._stage=this._stageLayer=null;this._addedToStage=this._visible=!1;this.alignedSampledElevation=
0;this.useObjectOriginAsAttachmentOrigin=this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=u;this.stageObject=C}var q=B.prototype;q.initialize=function(u,C){this._stageLayer=C;this._stage=u;u.addMany(this._uniqueMaterials);u.addMany(this._uniqueGeometries);u.add(this.stageObject)};q.destroy=function(){var u=this._stage;this._stageLayer&&(u.removeMany(this._uniqueMaterials),u.removeMany(this._uniqueGeometries));u.remove(this.stageObject);this._addedToStage&&(this._stageLayer.remove(this.stageObject),
this._addedToStage=!1);u=this._stage.renderView.ensureEdgeView();u.hasObject(this.stageObject)&&u.removeObject(this.stageObject);this.stageObject.dispose();c.isSome(this._sharedResource)&&this._sharedResource.release();this._visible=!1;this._stage=this._stageLayer=null};q.layerOpacityChanged=function(u,C){if(!c.isNone(this._edgeState)){var z=e(this._edgeState.baseMaterial),A=!1;for(const p of this._edgeState.edgeMaterials)p.objectTransparency!==z&&(p.objectTransparency=z,A=!0);A&&this._resetEdgeObject(C);
this._stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[u])}};q.slicePlaneEnabledChanged=function(u,C){c.isNone(this._edgeState)||(this._stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:u},!C),this._edgeState.properties.hasSlicePlane=u)};q.setVisibility=function(u){if(null!=this._stage&&this._visible!==u&&((this._visible=u)?this._addedToStage?this.stageObject.setVisible(!0):(this._stageLayer.add(this.stageObject),
this._addedToStage=!0):this.stageObject.setVisible(!1),c.isSome(this._edgeState))){const C=this._stage.renderView.ensureEdgeView();C.hasObject(this.stageObject)?C.updateObjectVisibility(this.stageObject,u):u&&this._addOrUpdateEdgeObject(C,!1)}};q.alignWithElevation=function(u,C,z,A){null!=this.elevationAligner&&(c.isSome(z)&&g.setContextFeature(this.elevationContext.featureExpressionInfoContext,z),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,u,C),this._resetEdgeObject(A))};
q.getCenterObjectSpace=function(u=l.create()){return m.copy(u,n.getCenter(this.stageObject.boundingVolumeObjectSpace.bounds))};q.getBoundingBoxObjectSpace=function(u=r.create()){const C=this.stageObject.boundingVolumeObjectSpace;r.setMin(u,C.min);r.setMax(u,C.max);return u};q.computeAttachmentOrigin=function(u){if(this.useObjectOriginAsAttachmentOrigin){var C=this.stageObject.transformation;u.render.origin[0]+=C[12];u.render.origin[1]+=C[13];u.render.origin[2]+=C[14];u.render.num++}else for(C of this.stageObject.geometryRecords)C.computeAttachmentOrigin(t)&&
(m.transformMat4(t,t,this.stageObject.transformation),m.add(u.render.origin,u.render.origin,t),u.render.num++)};q.getProjectedBoundingBox=function(){var u=b._asyncToGenerator(function*(C,z,A,p,y){y=this.getBoundingBoxObjectSpace(y);var D=x,E=r.isPoint(y)?1:D.length;for(var F=0;F<E;F++){const G=D[F];w[0]=y[G[0]];w[1]=y[G[1]];w[2]=y[G[2]];m.transformMat4(w,w,this.stageObject.transformation);v[3*F]=w[0];v[3*F+1]=w[1];v[3*F+2]=w[2]}if(!C(v,0,E))return null;r.empty(y);C=null;this.calculateRelativeScreenBounds&&
(C=this.calculateRelativeScreenBounds());for(D=0;D<3*E;D+=3){for(F=0;3>F;F++)y[F]=Math.min(y[F],v[D+F]),y[F+3]=Math.max(y[F+3],v[D+F]);C&&A.push({location:v.slice(D,D+3),screenSpaceBoundingRect:C})}if(z&&z.service&&"absolute-height"!==this.elevationContext.mode){r.center(y,t);A="relative-to-scene"===this.elevationContext.mode?"scene":"ground";E=0;if(z.useViewElevation)E=c.unwrapOr(z.service.getElevation(t[0],t[1],A),0);else try{const G=k.demResolutionForBoundingBox(y,z);E=c.unwrapOr(yield z.service.queryElevation(t[0],
t[1],p,G,A),0)}catch(G){}r.offset(y,0,0,-this.alignedSampledElevation+E)}return y});return function(C,z,A,p,y){return u.apply(this,arguments)}}();q.addObjectState=function(u,C){u===f.Object3DState.Highlight&&C.addObject(this.stageObject,this.stageObject.highlight());u===f.Object3DState.MaskOccludee&&C.addObject(this.stageObject,this.stageObject.maskOccludee())};q.removeObjectState=function(u){u.removeObject(this.stageObject)};q._resetEdgeObject=function(u){if(!c.isNone(this._edgeState)){var C=this._stage.renderView.ensureEdgeView();
this._visible?this._addOrUpdateEdgeObject(C,u):C.removeObject(this.stageObject)}};q._addOrUpdateEdgeObject=function(u,C){const z=this._edgeState;if(!c.isNone(z)){var A=e(z.baseMaterial);for(const p of z.edgeMaterials)p.objectTransparency=A;u.addOrUpdateObject3D(this.stageObject,z.edgeMaterials,z.properties,!C).then(()=>{var p;return null==(p=this._stageLayer)?void 0:p.sync()})}};b._createClass(B,[{key:"isElevationSource",get:function(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}},
{key:"visible",get:function(){return this._visible}}]);return B}();const v=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],w=l.create(),t=l.create(),x=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];a.Graphics3DObject3DGraphicLayer=h;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/interfaces":function(){define(["exports"],function(a){a.Transparency=void 0;var b=a.Transparency||(a.Transparency=
{});b[b.INVISIBLE=0]="INVISIBLE";b[b.TRANSPARENT=1]="TRANSPARENT";b[b.OPAQUE=2]="OPAQUE";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ./graphicUtils ./interfaces ./Loadable ./symbolComplexity".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w){function t(z,A){z=null!=z?A.attributes[z]:0;return null!=z&&isFinite(z)?z:0}function x(z){const A={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};z&&"visualVariables"in z&&z.visualVariables&&z.visualVariables.forEach(p=>{switch(p.type){case "color":A.color=!0;if(p.stops)for(let y=0;y<p.stops.length;y++){const D=p.stops[y].color;D&&(A.opacity=!0,1>D.a&&(A.opacityAlwaysOpaque=!1))}break;case "opacity":A.opacity=!0;A.opacityAlwaysOpaque=!1;break;case "size":A.size=
!0}});return A}const B=l.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");m=function(z){function A(y,D,E,F){var G=z.call(this,E.schedule)||this;G._context=E;G._elevationInfoOverride=null;G._ignoreDrivers=!1;G._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};G.complexity=null;G.logger=B;G._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};G.symbol=y;G.symbolLayer=D;G._renderPriority=F.renderPriority;G._renderPriorityStep=F.renderPriorityStep;
G._elevationContext=new f.ElevationContext;G.complexity=G.computeComplexity();G._ignoreDrivers=F.ignoreDrivers;G._ignoreDrivers||(G._drivenProperties=x(G._context.renderer));G._updateElevationContext();return G}b._inheritsLoose(A,z);var p=A.prototype;p.getCachedSize=function(){return null};p._drivenPropertiesChanged=function(y){if(this._ignoreDrivers)return!1;const D=this._drivenProperties;y=x(y);return y.color!==D.color||y.opacity!==D.opacity||y.opacityAlwaysOpaque!==D.opacityAlwaysOpaque||y.size!==
D.size};p._logGeometryCreationWarnings=function(y,D,E,F){const G="polygons"in y?y.polygons:null;F=`${F} geometry failed to be created`;let P=null;y.projectionSuccess?!D.length||1===D.length&&!D[0].length?P=`${F} (no ${E} were defined)`:Array.isArray(D)&&Array.isArray(D[0])?G&&0===G.length&&"rings"===E&&0<D.length&&2<D[0].length&&(P=`${F} (filled rings should use clockwise winding - try reversing the order of vertices)`):P=`${F} (${E} should be defined as a 2D array)`:P=`${F} (failed to project geometry to view spatial reference)`;
P&&B.warnOncePerTick(P)};p._validateGeometry=function(y,D=null,E=null){return r.isSome(D)&&!D.includes(y.type)?(this.logger.warn("unsupported geometry type for "+E+` symbol: ${y.type}`),!1):"point"!==y.type||isFinite(y.x)&&isFinite(y.y)?!0:(B.warn("point coordinate is not a valid number, graphic skipped"),!1)};p._defaultElevationInfoNoZ=function(){return q};p._defaultElevationInfoZ=function(){return u};p._updateElevationContext=function(){r.isSome(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),
this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()};p.getDefaultElevationInfo=function(y){return y.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()};p.getGeometryElevationMode=function(y,D=this.getDefaultElevationInfo(y)){return this._elevationContext.mode||
D.mode};p.setElevationInfoOverride=function(y){this._elevationInfoOverride=y;this._updateElevationContext()};p.setGraphicElevationContext=function(y,D){var E=r.unwrap(y.geometry);const F=this.getDefaultElevationInfo(E);D.unit=null!=this._elevationContext.unit?this._elevationContext.unit:F.unit;D.mode=this.getGeometryElevationMode(E,F);D.offsetMeters=r.unwrapOr(this._elevationContext.meterUnitOffset,r.unwrapOr(F.offset,0));if(E=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===D.mode)D.mode=
"relative-to-ground",D.offsetMeters=0;D.updateFeatureExpressionInfoContext(E?d.zeroContext:this._elevationContext.featureExpressionInfoContext,y,this._context.layer);return D};p.prepareSymbolLayerPatch=function(y){};p.updateGeometry=function(y,D){return!1};p.onRemoveGraphic=function(y){};p._getLayerOpacity=function(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity;const y=this._context.layer.opacity;return null==
y?1:y};p._getCombinedOpacity=function(y,D=C){let E=1;this.draped||(E*=this._getLayerOpacity());if(this._drivenProperties.opacity)return E;r.isSome(y)?E*=y.a:D.hasIntrinsicColor||(E=0);return E};p._getCombinedOpacityAndColor=function(y,D=C){D=this._getCombinedOpacity(y,D);if(this._drivenProperties.color)return e.mixinColorAndOpacity(null,D);y=r.isSome(y)?c.toUnitRGB(y):n.ONES;return e.mixinColorAndOpacity(y,D)};p._getVertexOpacityAndColor=function(y,D=null){y=e.mixinColorAndOpacity(this._drivenProperties.color?
y.color:null,this._drivenProperties.opacity?y.opacity:null);r.isSome(D)&&(y[0]*=D,y[1]*=D,y[2]*=D,y[3]*=D);return y};p.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};p.computeComplexity=function(){return w.defaultSymbolLayerComplexity(this.symbol,this.symbolLayer)};p.globalPropertyChanged=function(y,D,E){switch(y){case "opacity":return this.layerOpacityChanged(D,E);case "elevationInfo":return y=this._elevationContext.mode,this._updateElevationContext(),this.layerElevationInfoChanged(D,
E,y)===k.SymbolUpdateType.RECREATE?!1:!0;case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(D,E);case "physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case "pixelRatio":return this.pixelRatioChanged();default:return!1}};p.updateGraphics3DGraphicElevationInfo=function(y,D,E){let F=k.SymbolUpdateType.UPDATE;y.forEach(G=>{const P=D(G);r.isSome(P)?(this.setGraphicElevationContext(G.graphic,P.elevationContext),P.needsElevationUpdates=E(P.elevationContext.mode)):F=
k.SymbolUpdateType.RECREATE});return F};p.applyRendererDiff=function(y,D){return h.ApplyRendererDiffResult.Recreate_Symbol};p.getFastUpdateAttrValues=function(y){if(!this._fastUpdates.enabled)return null;const D=this._fastUpdates.visualVariables,E=D.size?t(D.size.field,y):0,F=D.color?t(D.color.field,y):0;y=D.opacity?t(D.opacity.field,y):0;return g.fromValues(E,F,y,0)};p.ensureDrapedStatus=function(y){if(null==this._draped)return this._draped=y,!0;y!==this.draped&&B.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.");
return!1};p.test=function(){return{drivenProperties:this._drivenProperties,getVisVarFields:()=>{var y,D,E,F,G,P,K,N,M,L,J,H,I,O,Q,S;return{size:null!=(y=null==(D=this._fastUpdates)?void 0:null==(E=D.visualVariables)?void 0:null==(F=E.size)?void 0:F.field)?y:null,color:null!=(G=null==(P=this._fastUpdates)?void 0:null==(K=P.visualVariables)?void 0:null==(N=K.color)?void 0:N.field)?G:null,opacity:null!=(M=null==(L=this._fastUpdates)?void 0:null==(J=L.visualVariables)?void 0:null==(H=J.opacity)?void 0:
H.field)?M:null,rotation:null!=(I=null==(O=this._fastUpdates)?void 0:null==(Q=O.visualVariables)?void 0:null==(S=Q.rotation)?void 0:S.field)?I:null}}}};b._createClass(A,[{key:"extentPadding",get:function(){return 0}},{key:"needsDrivenTransparentPass",get:function(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}},{key:"draped",get:function(){return this._draped}}]);return A}(v.Loadable);const q={mode:"on-the-ground",offset:0,unit:"meters"},u={mode:"absolute-height",
offset:0,unit:"meters"},C={hasIntrinsicColor:!1};a.Graphics3DSymbolLayer=m;a.getAttributeValue=t;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/interfaces":function(){define(["exports"],function(a){a.ApplyRendererDiffResult=void 0;var b=a.ApplyRendererDiffResult||(a.ApplyRendererDiffResult={});b[b.Recreate_Symbol=0]="Recreate_Symbol";b[b.Recreate_Graphics=1]="Recreate_Graphics";b[b.Fast_Update=2]="Fast_Update";Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Loadable":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/promiseUtils"],function(a,b,c,m){let l=function(){function r(g){this.schedule=g;this._loadStatus=a.LoadStatus.LOADING;this.logger=null}var n=r.prototype;n.destroy=function(){this.abortLoad()};n.load=function(g,k){if(this._loadStatus===a.LoadStatus.LOADED)return g&&g(),c.unwrap(this._loader);
if(this._loadStatus===a.LoadStatus.FAILED)return k&&k(this._loadError),c.unwrap(this._loader);c.isNone(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null;this._loadStatus=a.LoadStatus.LOADED},f=>{this._loadError=f;this._abortController=null;this._loadStatus=a.LoadStatus.FAILED;!m.isAbortError(f)&&this.logger&&f.message&&this.logger.warn(f.message);throw f;}));this._loader.then(g,k).catch(()=>{});return this._loader};
n.abortLoad=function(){c.isSome(this._abortController)?this._abortController=c.abortMaybe(this._abortController):this._loadStatus===a.LoadStatus.LOADING&&(this._loadStatus=a.LoadStatus.FAILED);this._loader=null};b._createClass(r,[{key:"loadStatus",get:function(){return this._loadStatus}}]);return r}();a.LoadStatus=void 0;(function(r){r[r.LOADING=0]="LOADING";r[r.LOADED=1]="LOADED";r[r.FAILED=2]="FAILED"})(a.LoadStatus||(a.LoadStatus={}));a.Loadable=l;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/symbolComplexity":function(){define("exports ../../../../core/compilerUtils ../../../../core/maybe ../../../../symbols/support/ObjectSymbol3DLayerResource ./primitiveObjectSymbolUtils ../support/edgeUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/lib/lodRendering/LodResources".split(" "),function(a,b,c,m,l,r,n,g){function k(t){let x=0,B=0,q=0,u=!1,C=0;const z={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,
draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const A of t)c.isNone(A)||(x+=A.primitivesPerFeature,B+=A.primitivesPerCoordinate,q+=A.drawCallsPerFeature,z.bytesPerFeature+=A.memory.bytesPerFeature,z.bytesPerFeatureLabel+=A.memory.bytesPerFeatureLabel,z.bytesPerCoordinate+=A.memory.bytesPerCoordinate,z.draped.bytesPerFeature+=A.memory.bytesPerFeature,z.draped.bytesPerFeatureLabel+=A.memory.bytesPerFeatureLabel,z.draped.bytesPerCoordinate+=A.memory.bytesPerCoordinate,u=
u||A.estimated,++C);return{primitivesPerFeature:x,primitivesPerCoordinate:B,drawCallsPerFeature:q,estimated:u,memory:z,numComplexities:C}}function f(t,x){const B=d(t,x);var q=r.hasEdges(x)?2:0;switch(x.type){case "extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:q,estimated:!1,memory:B};case "fill":return"mesh-3d"===t.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:q,estimated:!1,memory:B}:c.isSome(x.outline)&&0<x.outline.size?{primitivesPerFeature:-4,
primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:B}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:B};case "water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:B};case "line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:B};case "object":return x.resource&&x.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,
estimated:!0,memory:B}:{...e(x.resource&&x.resource.primitive||m.defaultPrimitive),memory:B};case "path":{var u=t=0;switch(x.profile){case "circle":t=10;break;case "quad":t=4;break;default:b.neverReached(x.profile);return}switch(x.join){case "round":u=3;break;case "miter":case "bevel":u=1;break;default:b.neverReached(x.join);return}q=2*t;u=t*u*2;let C=-2*u-q;switch(x.cap){case "none":break;case "butt":case "square":C+=2*(t-1);break;case "round":C+=2*(4*t+t);break;default:return}return{primitivesPerFeature:C,
primitivesPerCoordinate:u+q,drawCallsPerFeature:0,estimated:!1,memory:B}}case "text":case "icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:B}}}function d(t,x){t="point-3d"===t.type;switch(x.type){case "extrude":return x.edges&&0<x.edges.size?w.EXTRUDE_EDGES:w.EXTRUDE;case "fill":return c.isSome(x.outline)&&0<x.outline.size?w.FILL_OUTLINE:w.FILL;case "water":return w.FILL;case "line":return"round"===x.join?w.LINE_ROUND:w.LINE_MITER;case "path":switch(x.join){case "round":switch(x.profile){case "circle":return w.PATH_ROUND_CIRCLE;
case "quad":return w.PATH_ROUND_QUAD;default:b.neverReached(x.profile);return}case "miter":case "bevel":switch(x.profile){case "circle":return w.PATH_MITER_CIRCLE;case "quad":return w.PATH_MITER_QUAD;default:b.neverReached(x.profile);return}default:b.neverReached(x.join);return}case "object":return t?w.OBJECT_POINT:w.OBJECT_POLYGON;case "icon":case "text":return t?w.ICON_POINT:w.ICON_POLYGON}}function e(t){var x=v[t];if(x)return x;x=l.primitiveLodResources(t,null);x={primitivesPerFeature:g.geometriesFromLodLevelResources(x.levels[0]).reduce((B,
q)=>B+q.indices.get(n.VertexAttribute.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1};return v[t]=x}const h={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}},v={},w={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,
bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,
bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},
LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,
bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,
draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,
bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,
bytesPerCoordinate:374.3725221561312}}};a.averageSymbolComplexities=function(t){t=k(t);0<t.numComplexities&&(t.primitivesPerFeature/=t.numComplexities,t.primitivesPerCoordinate/=t.numComplexities,t.drawCallsPerFeature/=t.numComplexities,t.memory.bytesPerFeature/=t.numComplexities,t.memory.bytesPerFeatureLabel/=t.numComplexities,t.memory.bytesPerCoordinate/=t.numComplexities,t.memory.draped.bytesPerFeature/=t.numComplexities,t.memory.draped.bytesPerFeatureLabel/=t.numComplexities,t.memory.draped.bytesPerCoordinate/=
t.numComplexities);return t};a.defaultSymbolComplexity=function(t){if("web-style"===t.type)return h;const x=t.symbolLayers.toArray().map(B=>f(t,B));return k(x)};a.defaultSymbolLayerComplexity=f;a.defaultSymbolLayerMemoryComplexity=d;a.emptySymbolComplexity=h;a.memoryEstimators=w;a.totalSymbolComplexities=k;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define(["exports","../../../../core/has",
"../../webgl-engine/lib/GeometryUtil"],function(a,b,c){const m=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];a.isValidPrimitive=function(l){switch(l){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};a.primitiveLodResources=function(l,r){const n=(g,k,f=!1)=>({levels:g.map(d=>{const e=k(d.tesselation);f&&c.cgToGIS(e);return{components:[{geometry:e,
material:r}],faceCount:e.indexCount/3,minScreenSpaceRadius:d.minScreenSpaceRadius}})});switch(l){case "sphere":return n([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],g=>c.createPolySphereGeometry(.5,g,!0));case "cube":return n([{tesselation:0,minScreenSpaceRadius:0}],()=>c.createBoxGeometry(1));case "cone":return n(m,g=>c.createConeGeometry(1,.5,
g,!1),!0);case "inverted-cone":return n(m,g=>c.createConeGeometry(1,.5,g,!0),!0);case "cylinder":return n(m,g=>c.createCylinderGeometry(1,.5,g,[0,0,1],[0,0,.5]));case "tetrahedron":return n([{tesselation:0,minScreenSpaceRadius:0}],()=>c.createTetrahedronGeometry(1),!0);case "diamond":return n([{tesselation:0,minScreenSpaceRadius:0}],()=>c.createDiamondGeometry(1),!0)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/edgeUtils":function(){define("exports ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec4f64 ./layerUtils ../../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(a,b,c,m,l,r,n,g){function k(h,v){if(m.isNone(h))return null;const w=m.isSome(h.color)?r.fromArray(b.toUnitRGBA(h.color)):r.fromValues(0,0,0,0),t=l.pt2px(h.size),x=l.pt2px(h.extensionLength);switch(h.type){case "solid":return f({color:w,size:t,extensionLength:x,...v});case "sketch":return{...e,color:w,size:t,extensionLength:x,...v,type:"sketch"}}}function f(h){return{...d,...h,type:"solid"}}const d={color:r.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:g.Transparency.OPAQUE,
hasSlicePlane:!1},e={color:r.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:g.Transparency.OPAQUE,hasSlicePlane:!1};a.createMaterial=function(h,v){return k(h&&h.enabled&&h.edges||null,v)};a.createMaterialFromEdges=k;a.createSolidEdgeMaterial=f;a.hasEdges=function(h){return h&&h.enabled&&(n.isExtrudeSymbol3DLayer(h)||n.isFillSymbol3DLayer(h))&&m.isSome(h.edges)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/layerUtils":function(){define(["exports"],
function(a){a.isExtrudeSymbol3DLayer=function(b){return"extrude"===b.type};a.isFillSymbol3DLayer=function(b){return"fill"===b.type};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["exports","../../../../../core/arrayUtils"],function(a,b){function c(m){const l=[];m.components.forEach(r=>{l.push(r.geometry)});return b.unique(l)}a.computeFaceCount=function(m){return c(m).reduce((l,
r)=>l+r.indexCount/3,0)};a.geometriesFromLodLevelResources=c;a.geometriesFromLodResources=function(m){const l=[];m.levels.forEach(r=>{r.components.forEach(n=>{l.push(n.geometry)})});return b.unique(l)};a.materialsFromLodResources=function(m){const l=[];m.levels.forEach(r=>{r.components.forEach(n=>{l.push(n.material)})});return b.unique(l)};a.texturesFromLodResources=function(m){const l=[];m.levels.forEach(r=>{r.components.forEach(n=>{n.textures&&l.push(...n.textures)})});return b.unique(l)};Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/pointUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ./elevationAlignmentUtils ./graphicUtils ../../webgl-engine/lib/Object3D".split(" "),function(a,b,c,m,l,r,n,g,k,f,d){const e=
m.create();a.createStageObjectForHUD=function(h,v,w,t,x,B,q,u){const C=w?w.length:0;var z=h.clippingExtent;l.projectPointToVector(v,e,h.elevationProvider.spatialReference);if(b.isSome(z)&&!r.containsPoint(z,e))return null;l.projectPointToVector(v,e,h.renderCoordsHelper.spatialReference);z=h.localOriginFactory.getOrigin(e);B=new d.Object3D({castShadow:!1,metadata:{layerUid:B,graphicUid:q,usesVerticalDistanceToGround:!0}});for(q=0;q<C;q++)B.addGeometry(w[q],t[q],c.IDENTITY,z,u);h=k.applyElevationAlignmentForHUD(B,
v,h.elevationProvider,h.renderCoordsHelper,x);return{object:B,sampledElevation:h}};a.extendPointGraphicElevationContext=function(h,v,w){h=h.elevationContext;w=w.spatialReference;l.projectPointToVector(v,e,w);h.centerPointInElevationSR=g.makeDehydratedPoint(e[0],e[1],v.hasZ?e[2]:0,w)};a.geometryToRenderInfo=function(h,v,w,t,x){const B=new Float64Array(3*h.length),q=new Float64Array(B.length);h.forEach((u,C)=>{B[3*C]=u[0];B[3*C+1]=u[1];B[3*C+2]=2<u.length?u[2]:0});v=k.applyPerVertexElevationAlignment(B,
v,0,q,0,B,0,B.length/3,w,t,x);return{numVertices:h.length,position:B,mapPosition:q,projectionSuccess:null!=v,sampledElevation:v}};a.placePointOnGeometry=function(h){switch(h.type){case "point":return h;case "polygon":case "extent":return f.computeCentroid(h);case "polyline":var v=h.paths[0];if(!v||0===v.length)break;v=n.getPointOnPath(v,n.getPathLength(v)/2);return g.makeDehydratedPoint(v[0],v[1],v[2],h.spatialReference);case "mesh":return h.origin}return null};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/sphere ../../support/mathUtils ./basicInterfaces ./ContentObject ./ContentObjectType ./GeometryRecord ./Object3DStateID ./Util ../materials/renderers/utils".split(" "),function(a,b,c,m,l,r,n,g,k,f,d,e,
h,v,w,t){d=function(q){function u(z={}){var A=q.call(this)||this;A.type=e.ContentObjectType.Object;A._geometryRecords=[];A._geometries=[];A._objectTransformation=l.create();A._bvObjectSpace=new B;A._bvWorldSpace=new B;A._bvDirty=!0;A._hasVolatileTransformation=!1;A._visible=!0;A.castShadow=null!=z.castShadow?z.castShadow:!0;A.metadata=z.metadata;A.metadata&&A.metadata.isElevationSource&&(A.metadata.lastValidElevationBB=new x);A.transformation=l.create();const {geometries:p,materials:y,transformations:D,
origins:E}=z;if(!Array.isArray(p))return b._assertThisInitialized(A);w.assert(y.length===p.length,"Object3D: materials don't match geometries");w.assert(D.length===p.length,"Object3D: transformations don't match geometries");A._geometryRecords.length=p.length;A._geometries.length=p.length;for(z=0;z<p.length;z++)A._geometries[z]=p[z],A._geometryRecords[z]=h.GeometryRecord.pool.acquire(p[z],y[z],l.clone(D[z]),{highlights:null,occludees:null,visible:A._visible},E&&E[z]);return A}b._inheritsLoose(u,q);
var C=u.prototype;C.dispose=function(){this._geometryRecords.length=0;this._geometries.length=0};C.addGeometry=function(z,A,p,y,D){p=p?p:l.IDENTITY;this._geometries.push(z);z=h.GeometryRecord.pool.acquire(z,A,p,{highlights:null,occludees:null,visible:this._visible},y,D);this._geometryRecords.push(z);this._hasVolatileTransformation=this._hasVolatileTransformation||c.isSome(z.shaderTransformation);this._emit("objectGeometryAdded",{object:this,record:z});this._invalidateBoundingVolume();return z};C.removeGeometry=
function(z){const A=this._geometryRecords.splice(z,1)[0];this._hasVolatileTransformation=c.isSome(A.shaderTransformation)?this._geometryRecords.some(p=>c.isSome(p.shaderTransformation)):this._hasVolatileTransformation;A.dispose();this._geometries.splice(z,1);this._emit("objectGeometryRemoved",{object:this,record:A});this._invalidateBoundingVolume();return A};C.removeAllGeometries=function(){for(;0<this.geometryRecords.length;)this.removeGeometry(0)};C.geometryVertexAttrsUpdated=function(z){this._emit("vertexAttrsUpdated",
{object:this,record:z});this._invalidateBoundingVolume()};C.setVisible=function(z){if(this._visible!==z){this._visible=z;for(const A of this._geometryRecords)A.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}};C.maskOccludee=function(){const z=new v.Object3DStateID(f.Object3DState.MaskOccludee);for(const A of this._geometryRecords)A.instanceParameters.occludees=t.addObject3DStateID(A.instanceParameters.occludees,z);this._emit("occlusionChanged",this);return z};C.removeOcclude=
function(z){for(const A of this._geometryRecords)A.instanceParameters.occludees=t.removeObject3DStateID(A.instanceParameters.occludees,z);this._emit("occlusionChanged",this)};C.highlight=function(){const z=new v.Object3DStateID(f.Object3DState.Highlight);for(const A of this._geometryRecords)A.instanceParameters.highlights=t.addObject3DStateID(A.instanceParameters.highlights,z);this._emit("highlightChanged",this);return z};C.removeHighlight=function(z){for(const A of this._geometryRecords)A.instanceParameters.highlights=
t.removeObject3DStateID(A.instanceParameters.highlights,z);this._emit("highlightChanged",this)};C.getCombinedStaticTransformation=function(z,A){return m.multiply(c.unwrapOr(A,l.create()),this.transformation,z.getStaticTransformation())};C._getCombinedShaderTransformation=function(z,A){A=A||l.create();m.multiply(A,this.transformation,z.getShaderTransformation());return A};C.hasVolativeTransformation=function(){return this._hasVolatileTransformation};C._validateBoundingVolume=function(){if(this._bvDirty||
this._hasVolatileTransformation){this._bvObjectSpace.init();this._bvWorldSpace.init();for(var z=0;z<this._geometryRecords.length;++z){var A=this._geometryRecords[z],p=this._geometries[z].boundingInfo;c.isSome(p)&&(this._calculateTransformedBoundingVolume(p,this._bvObjectSpace,A.getShaderTransformation()),this._calculateTransformedBoundingVolume(p,this._bvWorldSpace,this._getCombinedShaderTransformation(A)))}r.lerp(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5);r.lerp(this._bvWorldSpace.bounds,
this._bvWorldSpace.min,this._bvWorldSpace.max,.5);z=n.create();A=n.create();p=k.maxScale(this.transformation);for(let F=0;F<this._geometryRecords.length;++F){var y=this._geometries[F].boundingInfo;if(!c.isNone(y)){var D=this._geometryRecords[F].getShaderTransformation(),E=k.maxScale(D);r.transformMat4(z,y.getCenter(),D);D=r.distance(z,this._bvObjectSpace.bounds);y=y.getBSRadius()*E;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],D+y);r.transformMat4(A,z,this.transformation);E=
r.distance(A,this._bvWorldSpace.bounds);this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],E+y*p)}}this._bvDirty=!1}};C._calculateTransformedBoundingVolume=function(z,A,p){const y=z.getBBMin();z=z.getBBMax();const D=n.clone(y),E=n.clone(z);r.transformMat4(D,D,p);r.transformMat4(E,E,p);for(var F=0;3>F;++F)A.min[F]=Math.min(A.min[F],D[F],E[F]),A.max[F]=Math.max(A.max[F],D[F],E[F]);for(F=0;3>F;++F){r.copy(D,y);r.copy(E,z);D[F]=z[F];E[F]=y[F];r.transformMat4(D,D,p);r.transformMat4(E,E,
p);for(let G=0;3>G;++G)A.min[G]=Math.min(A.min[G],D[G],E[G]),A.max[G]=Math.max(A.max[G],D[G],E[G])}};C._invalidateBoundingVolume=function(){this._bvDirty=!0;c.isSome(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)};C._emit=function(z,A){c.isSome(this._parentLayer)&&this._parentLayer.events.emit(z,A)};b._createClass(u,[{key:"geometryRecords",get:function(){return this._geometryRecords}},{key:"geometries",get:function(){return this._geometries}},{key:"transformation",
get:function(){return this._objectTransformation},set:function(z){m.copy(this._objectTransformation,z);this._invalidateBoundingVolume();this._emit("objectTransformation",this)}},{key:"parentLayer",get:function(){return this._parentLayer},set:function(z){w.assert(null==this._parentLayer||null==z,"Object3D can only be added to a single Layer");this._parentLayer=z}},{key:"isVisible",get:function(){return this._visible}},{key:"boundingVolumeWorldSpace",get:function(){this._validateBoundingVolume();return this._bvWorldSpace}},
{key:"boundingVolumeObjectSpace",get:function(){this._validateBoundingVolume();return this._bvObjectSpace}},{key:"test",get:function(){const z=this;return{hasGeometry:A=>z._geometries.includes(A),getGeometryIndex:A=>z._geometries.indexOf(A)}}}]);return u}(d.ContentObject);let x=function(){function q(){this.min=n.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.max=n.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}q.prototype.isEmpty=function(){return this.max[0]<
this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]};return q}(),B=function(q){function u(){var C=q.apply(this,arguments)||this;C.bounds=g.create();return C}b._inheritsLoose(u,q);u.prototype.init=function(){r.set(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);r.set(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);g.clear(this.bounds)};return u}(x);a.Object3D=d;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/GeometryRecord":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/uid ../../../../chunks/vec3".split(" "),
function(a,b,c,m,l,r){let n=function(){function g(){this._disposed=!1}var k=g.prototype;k.acquire=function(f,d,e,h,v,w){this.id=l.generateUID();this.geometry=f;this.material=d;this.transformation=e;this.instanceParameters=h;this.origin=v;this._shaderTransformation=w;this._disposed=!1};k.release=function(){this._disposed=!1};k.dispose=function(){this._disposed=!0};k.getStaticTransformation=function(){return this.transformation};k.getShaderTransformation=function(){return c.isSome(this._shaderTransformation)?
this._shaderTransformation(this.transformation):this.transformation};k.computeAttachmentOrigin=function(f){return(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,f):this.geometry.computeAttachmentOrigin(f))?(r.transformMat4(f,f,this.getStaticTransformation()),!0):!1};b._createClass(g,[{key:"disposed",get:function(){return this._disposed}},{key:"shaderTransformation",get:function(){return this._shaderTransformation}}]);return g}();n.pool=new m(n);a.GeometryRecord=
n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Object3DStateID":function(){define(["exports","../../../../core/uid"],function(a,b){a.Object3DStateID=function(c){this.channel=c;this.id=b.generateUID()};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec2f32 ../../../../chunks/vec2f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/hud/HUD.glsl ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./internal/bufferWriterUtils ../shaders/LineCalloutTechnique ../shaders/LineCalloutTechniqueConfiguration".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w){let t=function(z){function A(y){y=z.call(this,y,new B)||this;y.techniqueConfig=new w.LineCalloutTechniqueConfiguration;y._uniqueMaterialIdentifier=A.uniqueMaterialIdentifier(y.parameters);return y}b._inheritsLoose(A,z);var p=A.prototype;p.getPassParameters=function(){return this.parameters};p.getConfiguration=function(y,D){y=(null==D?void 0:D.slot)!==d.RenderSlot.LINE_CALLOUTS;this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest;this.techniqueConfig.hasVerticalOffset=
c.isSome(this.parameters.verticalOffset);this.techniqueConfig.hasScreenSizePerspective=c.isSome(this.parameters.screenSizePerspective);this.techniqueConfig.depthHudEnabled=y;this.techniqueConfig.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart;this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?g.HUDSpace.Screen:g.HUDSpace.World;this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane;this.techniqueConfig.hasMultipassGeometry=D?D.multipassGeometry.enabled:
!1;return this.techniqueConfig};p.intersect=function(){};p.requiresSlot=function(y){switch(y){case d.RenderSlot.LINE_CALLOUTS:case d.RenderSlot.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1};p.createGLMaterial=function(y){return y.output===n.ShaderOutput.Color?new x(y):null};p.createBufferWriter=function(){return new C};p.validateParameters=function(y){y=A.uniqueMaterialIdentifier(y);y!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=y)};A.uniqueMaterialIdentifier=function(y){return JSON.stringify({screenOffset:y.screenOffset||
[0,0],centerOffsetUnits:y.centerOffsetUnits||"world"})};b._createClass(A,[{key:"uniqueMaterialIdentifier",get:function(){return this._uniqueMaterialIdentifier}}]);return A}(f.Material),x=function(z){function A(){return z.apply(this,arguments)||this}b._inheritsLoose(A,z);A.prototype.beginSlot=function(p){return this.ensureTechnique(v.LineCalloutTechnique,p)};return A}(k),B=function(z){function A(){var p=z.apply(this,arguments)||this;p.screenOffset=l.ZEROS;p.color=[0,0,0,1];p.size=1;p.occlusionTest=
!1;p.shaderPolygonOffset=1E-5;p.depthHUDAlignStart=!1;p.centerOffsetUnits="world";p.hasSlicePlane=!1;return p}b._inheritsLoose(A,z);return A}(f.MaterialParameters);const q=r.newLayout().vec3f(e.VertexAttribute.POSITION).vec3f(e.VertexAttribute.NORMAL).vec2f(e.VertexAttribute.UV0).vec4f(e.VertexAttribute.AUXPOS1),u=[m.fromValues(0,0),m.fromValues(1,0),m.fromValues(0,1),m.fromValues(1,0),m.fromValues(1,1),m.fromValues(0,1)];let C=function(){function z(){this.vertexBufferLayout=q}var A=z.prototype;A.allocate=
function(p){return this.vertexBufferLayout.createBuffer(p)};A.elementCount=function(p){return 6*p.indices.get(e.VertexAttribute.POSITION).length};A.write=function(p,y,D,E){h.writePosition(y.indices.get(e.VertexAttribute.POSITION),y.vertexAttributes.get(e.VertexAttribute.POSITION).data,p.transformation,D.position,E,6);h.writeNormal(y.indices.get(e.VertexAttribute.NORMAL),y.vertexAttributes.get(e.VertexAttribute.NORMAL).data,p.invTranspTransformation,D.normal,E,6);h.writeBufferVec4(y.indices.get(e.VertexAttribute.AUXPOS1),
y.vertexAttributes.get(e.VertexAttribute.AUXPOS1).data,D.auxpos1,E,6);for(p=0;p<u.length;++p)D.uv0.setVec(E+p,u[p])};return z}();a.LineCalloutMaterial=t;a.Parameters=B;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../ViewingMode ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/LineCallout.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){r=function(e){function h(){return e.apply(this,arguments)||this}c._inheritsLoose(h,e);var v=h.prototype;v.initializeConfiguration=function(w,t){t.spherical=w.viewingMode===m.ViewingMode.Global};v.initializeProgram=function(w){const t=h.shader.get().build(this.configuration);return new g.Program(w.rctx,t,n.Default3D)};v.setPipelineState=function(w){w=w?f.CompareFunction.ALWAYS:f.CompareFunction.LESS;return this.configuration.depthHudEnabled?d.makePipelineState({depthTest:{func:w},
depthWrite:d.defaultDepthWriteParams}):d.makePipelineState({blending:d.separateBlendingParams(f.BlendFactor.ONE,f.BlendFactor.SRC_ALPHA,f.BlendFactor.ONE_MINUS_SRC_ALPHA,f.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:w},colorWrite:d.defaultColorWriteParams})};v.initializePipeline=function(){return this.setPipelineState(this.configuration.hasMultipassGeometry)};return h}(r.ShaderTechnique);r.shader=new l.ReloadableShaderModule(k.LineCallout,()=>new Promise((e,h)=>a(["./LineCallout.glsl"],e,h)));
b.LineCalloutTechnique=r;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/LineCallout.glsl":function(){define("exports ../core/maybe ./vec2 ./vec2f64 ./vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t){function x(u){const C=new w.ShaderBuilder;C.include(n.AlignPixel);C.include(g.HUD,u);C.include(r.SliceDraw,u);C.attributes.add(t.VertexAttribute.UV0,"vec2");const {vertex:z,fragment:A}=C;z.uniforms.add([new e.Float4PassUniform("viewport",(p,y)=>y.camera.fullViewport),new h.FloatPassUniform("lineSize",(p,y)=>Math.ceil(p.size)*y.camera.pixelRatio),new d.Float2PassUniform("pixelToNDC",(p,y)=>c.set(q,2/y.camera.fullViewport[2],2/y.camera.fullViewport[3])),new h.FloatPassUniform("borderSize",
(p,y)=>b.isSome(p.borderColor)?y.camera.pixelRatio:0),new d.Float2PassUniform("screenOffset",(p,y)=>c.set(q,p.screenOffset[0]*y.camera.pixelRatio,p.screenOffset[1]*y.camera.pixelRatio))]);C.varyings.add("coverageSampling","vec4");C.varyings.add("lineSizes","vec2");u.hasMultipassGeometry&&C.varyings.add("depth","float");u.hasScreenSizePerspective&&f.addScreenSizePerspectiveAlignment(z);z.code.add(v.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${u.occlusionTestEnabled?v.glsl`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${u.hasScreenSizePerspective?v.glsl`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:v.glsl`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${u.hasMultipassGeometry?"depth \x3d posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${u.depthHudEnabled?u.depthHudAlignStartEnabled?v.glsl`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:v.glsl`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${u.hasScreenSizePerspective?v.glsl`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:v.glsl`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `);A.uniforms.add([new e.Float4PassUniform("uColor",p=>B(p.color)),new e.Float4PassUniform("borderColor",p=>B(p.borderColor))]);u.hasMultipassGeometry&&(A.include(k.multipassGeometryTest,u),A.uniforms.add(new d.Float2PassUniform("inverseViewport",(p,y)=>y.inverseViewport)));A.code.add(v.glsl`
    void main() {
      ${u.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${u.depthHudEnabled?v.glsl`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:v.glsl`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `);return C}function B(u){return b.isSome(u)?u:l.ZEROS}const q=m.create();m=Object.freeze(Object.defineProperty({__proto__:null,build:x},Symbol.toStringTag,{value:"Module"}));a.LineCallout=m;a.build=x})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/hud/HUD.glsl ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,c,m,l,r){r=function(n){function g(){var k=n.apply(this,arguments)||this;k.screenCenterOffsetUnitsEnabled=m.HUDSpace.World;k.spherical=!1;k.occlusionTestEnabled=!0;k.hasVerticalOffset=!1;k.hasScreenSizePerspective=!1;k.depthHudEnabled=!1;k.depthHudAlignStartEnabled=!1;k.hasSlicePlane=!1;k.hasMultipassGeometry=!1;return k}b._inheritsLoose(g,n);return g}(r.DefaultTechniqueConfiguration);c.__decorate([l.parameter({count:m.HUDSpace.COUNT})],r.prototype,"screenCenterOffsetUnitsEnabled",void 0);
c.__decorate([l.parameter()],r.prototype,"spherical",void 0);c.__decorate([l.parameter()],r.prototype,"occlusionTestEnabled",void 0);c.__decorate([l.parameter()],r.prototype,"hasVerticalOffset",void 0);c.__decorate([l.parameter()],r.prototype,"hasScreenSizePerspective",void 0);c.__decorate([l.parameter()],r.prototype,"depthHudEnabled",void 0);c.__decorate([l.parameter()],r.prototype,"depthHudAlignStartEnabled",void 0);c.__decorate([l.parameter()],r.prototype,"hasSlicePlane",void 0);c.__decorate([l.parameter()],
r.prototype,"hasMultipassGeometry",void 0);c.__decorate([l.parameter({constValue:!0})],r.prototype,"hasSliceInVertexProgram",void 0);c.__decorate([l.parameter({constValue:!1})],r.prototype,"isDraped",void 0);a.LineCalloutTechniqueConfiguration=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DGraphicCreationContext":function(){define(function(){return function(a,b,c){this.graphic=a;this.renderingInfo=b;this.layer=
c}})},"esri/views/3d/layers/graphics/graphicSymbolUtils":function(){define(["exports","./Graphics3DSymbol","./Graphics3DWebStyleSymbol"],function(a,b,c){a.getGraphics3DSymbol=function(m){return m instanceof c?m.graphics3DSymbol:m instanceof b?m:null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ./Graphics3DGraphic ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayerFactory ./interfaces ./Loadable ./symbolComplexity".split(" "),
function(a,b,c,m,l,r,n,g,k,f){const d={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};return function(e){function h(w,t,x){var B=e.call(this,t.schedule)||this;B._symbol=w;B._context=t;B._backgroundLayers=x;B._destroyed=!1;B.symbolLayers=[];B.referenced=0;B._extentPadding=0;return B}a._inheritsLoose(h,e);var v=h.prototype;v.doLoad=function(){var w=a._asyncToGenerator(function*(t){var x=this;let B=this._symbol.symbolLayers;this._extentPadding=0;this._backgroundLayers&&(B=this._backgroundLayers.concat(B));
const q=B.length;for(;this.symbolLayers.length<B.length;)this.symbolLayers.push(null);this.symbolLayers.length=B.length;const u=[];for(let C=0;C<q;C++){const z=B.getItemAt(C);if(!1===z.enabled)continue;d.renderPriority=1-(1+C)/q;d.renderPriorityStep=1/q;d.ignoreDrivers=z._ignoreDrivers;const A=n.make(this.symbol,z,this._context,d);u.push(m.onAbortOrThrow(t,()=>{this.symbolLayers[C]=null;A.destroy()}));this.symbolLayers[C]=A}yield b.forEach(this.symbolLayers,function(){var C=a._asyncToGenerator(function*(z,
A){if(c.isSome(z))try{yield z.load(),x._extentPadding+=Math.max(x._extentPadding,z.extentPadding)}catch{x.symbolLayers[A]=null}});return function(z,A){return C.apply(this,arguments)}}());for(const C of u)null==C?void 0:C.remove();u.length=0;m.throwIfAborted(t);if(this.symbolLayers.length&&!this.symbolLayers.some(C=>!!C))throw Error();});return function(t){return w.apply(this,arguments)}}();v.getSymbolLayerSize=function(w){w=this.symbolLayers[w];return c.isSome(w)?w.getCachedSize():null};v.createGraphics3DGraphic=
function(w,t){const x=w.graphic,B=Array(this.symbolLayers.length);for(let q=0;q<this.symbolLayers.length;q++){const u=this.symbolLayers[q];B[q]=c.isSome(u)?u.createGraphics3DGraphic(w):null}return new l(x,t||this,B,w.layer,this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null)};v.globalPropertyChanged=function(w,t){const x=this.symbolLayers.length;for(let B=0;B<x;B++){const q=
this.symbolLayers[B],u=C=>{C=C.graphics[B];return C instanceof r.Graphics3DObject3DGraphicLayer?C:null};if(c.isSome(q)&&!q.globalPropertyChanged(w,t,u))return!1}return!0};v.applyRendererDiff=function(w,t){return this.loadStatus!==k.LoadStatus.LOADED?g.ApplyRendererDiffResult.Recreate_Symbol:this.symbolLayers.reduce((x,B)=>x!==g.ApplyRendererDiffResult.Recreate_Symbol&&c.isSome(B)?Math.min(x,B.applyRendererDiff(w,t)):x,g.ApplyRendererDiffResult.Fast_Update)};v.prepareSymbolPatch=function(w){if(this.loadStatus!==
k.LoadStatus.FAILED&&"partial"===w.diff.type){var t=w.diff.diff;if(t.symbolLayers&&"partial"===t.symbolLayers.type){var x=t.symbolLayers.diff;this.symbolLayers.forEach((B,q)=>{if(!c.isNone(B)){var u=x[q];if(u){const C={diff:u,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};B.prepareSymbolLayerPatch(C);w.symbolStatePatches.push(...C.symbolLayerStatePatches);C.graphics3DGraphicPatches.length&&w.graphics3DGraphicPatches.push((z,A)=>{const p=z.graphics[q];c.isSome(p)&&C.graphics3DGraphicPatches.forEach(y=>
y(p,A))})}}})}}};v.updateGeometry=function(w,t){for(let x=0;x<this.symbolLayers.length;x++){const B=this.symbolLayers[x];if(c.isNone(B))continue;const q=w.graphics[x];if(c.isNone(q)||!B.updateGeometry(q,t))return!1}return!0};v.onRemoveGraphic=function(w){for(let t=0;t<this.symbolLayers.length;t++){const x=this.symbolLayers[t];if(c.isNone(x))continue;const B=w.graphics[t];if(c.isSome(B))x.onRemoveGraphic(B)}};v.getFastUpdateStatus=function(){let w=0,t=0,x=0;this.symbolLayers.forEach(B=>{c.isNone(B)||
(B.loadStatus===k.LoadStatus.LOADING?w++:B.isFastUpdatesEnabled()?x++:t++)});return{loading:w,slow:t,fast:x}};v.destroy=function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{e.prototype.destroy.call(this);for(const w of this.symbolLayers)c.isSome(w)&&w.destroy();this.symbolLayers.length=0;this._destroyed=!0}};a._createClass(h,[{key:"symbol",get:function(){return this._symbol},set:function(w){this._symbol=w;for(let t=0;t<w.symbolLayers.length;t++){const x=
this.symbolLayers[t];c.isNone(x)||(x.symbol=w,x.symbolLayer=w.symbolLayers.items[t])}}},{key:"extentPadding",get:function(){return this._extentPadding}},{key:"complexity",get:function(){return f.totalSymbolComplexities(this.symbolLayers.map(w=>c.get(w,"complexity")))}},{key:"destroyed",get:function(){return this._destroyed}}]);return h}(k.Loadable)})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/maybe ../../../../core/ObjectPool ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Polygon ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ./enums ./featureExpressionInfoUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x){const B=new l(Array,u=>e.set(u,e.ZERO),null,10,5),q=h.create();return function(){function u(z,A,p,y,D){this.graphic=z;this.graphics3DSymbol=A;this.graphics=p;this._labelGraphics=[];this._auxiliaryGraphics=[];{var E=t.VisibilityFlag._COUNT;const F=Array(t.VisibilityGroup._COUNT);for(let G=0;G<F.length;G++)F[G]=Array(E);E=F}this._visibilityFlags=E;this._featureExpressionFeature=null;this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1};this._extent=null;
this.isElevationSource=!1;++A.referenced;this._featureExpressionFeature=D?x.createFeature(D,z,y):null;for(const F of p)m.isSome(F)&&(this.isElevationSource=this.isElevationSource||F.isElevationSource)}var C=u.prototype;C.initialize=function(z,A){this._layer=A;this._stage=z;this._forEachSymbolLayerGraphic(p=>{p.initialize(z,A);p.setVisibility(this.isVisible())})};C.destroy=function(){this._forEachSymbolLayerGraphic(z=>z.destroy());this._auxiliaryGraphics=this.graphics=null;--this.graphics3DSymbol.referenced;
this.graphics3DSymbol=null};C.clearLabelGraphics=function(){this._forEachLabelGraphic(z=>z.destroy());this._labelGraphics.length=0};C.addLabelGraphic=function(z,A,p){this._labelGraphics.push(z);z.initialize(A,p);z.setVisibility(this.isVisible(t.VisibilityGroup.LABEL))};C.addAuxiliaryGraphic=function(z){this._auxiliaryGraphics.push(z);this._layer&&(z.initialize(this._stage,this._layer),z.setVisibility(this.isVisible()))};C.isVisible=function(z=t.VisibilityGroup.GRAPHIC,A){for(let p=0;p<=z;p++){const y=
this._visibilityFlags[p];for(let D=0;D<y.length;++D)if(!1===y[D]&&D!==A)return!1}return!0};C.hasVisibilityFlag=function(z,A){return null!=this._visibilityFlags[A][z]};C.setVisibilityFlag=function(z,A,p){const y=this.isVisible(p);this._visibilityFlags[p][z]=A;const D=this.isVisible(p);if(y===D)return!1;if(p===t.VisibilityGroup.LABEL)this._forEachLabelGraphic(E=>E.setVisibility(D));else{this._forEachSymbolLayerGraphic(F=>F.setVisibility(D));const E=this.isVisible(t.VisibilityGroup.LABEL);this._forEachLabelGraphic(F=>
F.setVisibility(E))}return!0};C.clearVisibilityFlag=function(z,A=t.VisibilityGroup.GRAPHIC){return this.setVisibilityFlag(z,void 0,A)};C.computeExtent=function(z){if(!this._extent){var A=this.graphic.geometry;if(m.isNone(A))return!1;this._extent=h.create();v.computeAABR(A,this._extent);A=A.spatialReference;if(!A.equals(z)&&!d.projectBoundingRect(this._extent,A,this._extent,z))return this._extent=null,!1}return!0};C.getAsOptimizedGeometry=function(z,A){if(m.isSome(this._optimizedGeometry.geometry)&&
this._optimizedGeometry.hasZ===z&&this._optimizedGeometry.hasM===A)return this._optimizedGeometry.geometry;this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,z,A);this._optimizedGeometry.hasZ=z;this._optimizedGeometry.hasM=A;return this._optimizedGeometry.geometry};C._convertGraphicToOptimizedGeometry=function(z,A,p){z=z.geometry;if("mesh"===z.type||"extent"===z.type)z=f.fromExtent("mesh"===z.type?z.extent:z);return w.convertFromGeometry(z,A,p)};C.computeAttachmentOrigin=
function(){const z={render:{origin:k.create(),num:0},draped:{origin:n.create(),num:0}};for(const A of this.graphics)m.isNone(A)||A.computeAttachmentOrigin(z);z.render.num&&g.scale(z.render.origin,z.render.origin,1/z.render.num);z.draped.num&&r.scale(z.draped.origin,z.draped.origin,1/z.draped.num);return z};C.getProjectedBoundingBox=function(){var z=a._asyncToGenerator(function*(A,p,y,D,E){E||(E={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]});E.boundingBox?e.empty(E.boundingBox):
E.boundingBox=e.empty();E.requiresDrapedElevation=!1;yield b.forEach(this.graphics,function(){var F=a._asyncToGenerator(function*(G){if(!m.isNone(G)){var P="draped"===G.type?p:A,K=B.acquire();G=yield G.getProjectedBoundingBox(P,y,E.screenSpaceObjects,D,K);isFinite(G[2])&&isFinite(G[5])||(E.requiresDrapedElevation=!0);G&&e.expandWithAABB(E.boundingBox,K);B.release(K)}});return function(G){return F.apply(this,arguments)}}());return e.allFinite(E.boundingBox)||h.allFinite(e.toRect(E.boundingBox,q))?
E:null});return function(A,p,y,D,E){return z.apply(this,arguments)}}();C.needsElevationUpdates=function(){for(const z of this.graphics)if(m.isSome(z)&&("object3d"===z.type||"lod-instance"===z.type)&&z.needsElevationUpdates)return!0;for(const z of this._labelGraphics)if(z&&z.needsElevationUpdates)return!0;return!1};C.alignWithElevation=function(z,A,p){this._forEachRenderedGraphic(y=>{"object3d"!==y.type&&"lod-instance"!==y.type||y.alignWithElevation(z,A,this._featureExpressionFeature,p)})};C.addObjectStateSet=
function(z,A){this._forEachSymbolLayerGraphic(p=>p.addObjectState(z,A))};C.removeObjectState=function(z){this._forEachSymbolLayerGraphic(A=>A.removeObjectState(z))};C._forEachGraphicList=function(z,A){z.forEach(p=>p&&A(p))};C._forEachSymbolLayerGraphic=function(z){this._forEachGraphicList(this.graphics,z);this._forEachGraphicList(this._auxiliaryGraphics,z)};C._forEachLabelGraphic=function(z){this._forEachGraphicList(this._labelGraphics,z)};C._forEachRenderedGraphic=function(z){this._forEachSymbolLayerGraphic(z);
this._forEachLabelGraphic(z)};a._createClass(u,[{key:"labelGraphics",get:function(){return this._labelGraphics}},{key:"extent",get:function(){return this._extent}},{key:"destroyed",get:function(){return null==this.graphics}},{key:"isDraped",get:function(){let z=!1;this._forEachSymbolLayerGraphic(A=>{"draped"===A.type&&(z=!0)});return z}},{key:"usedMemory",get:function(){let z=c.estimateAttributesObjectSize(this.graphic.attributes);this._forEachSymbolLayerGraphic(A=>{const p=A.graphics3DSymbolLayer.complexity;
m.isNone(p)||(A="draped"===A.type?p.memory.draped:p.memory,z+=A.bytesPerFeature,A.bytesPerCoordinate&&(z+=v.numVertices(this.graphic.geometry)*A.bytesPerCoordinate))});return z}}]);return u}()})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("exports ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer ./Graphics3DWaterSymbolLayer".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){const e=b.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory"),h={icon:m.Graphics3DIconSymbolLayer,object:n.Graphics3DObjectSymbolLayer,line:l.Graphics3DLineSymbolLayer,path:g.Graphics3DPathSymbolLayer,fill:k.Graphics3DPolygonFillSymbolLayer,extrude:c.Graphics3DExtrudeSymbolLayer,text:f.Graphics3DTextSymbolLayer,water:d.Graphics3DWaterSymbolLayer},v={"mesh-3d":{fill:r.Graphics3DMeshFillSymbolLayer}};a.make=function(w,t,x,B){const q=v[w.type]&&v[w.type][t.type]||
h[t.type];return q?new q(w,t,x,B):(e.error("GraphicsLayerFactory#make",`unknown symbol type ${t.type}`),null)};a.setSymbolClass=function(w,t){h[w]=t};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/maybe ../../../../chunks/earcut ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec32 ../../../../renderers/support/renderingInfoUtils ../../../ViewingMode ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./polygonUtils ../support/edgeUtils ../../support/debugFlags ../../support/ElevationProvider ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N){function M(ka,la,Y,ea){var ba=new Uint32Array(ka.length);ea=[[K.VertexAttribute.POSITION,{size:3,data:Y.positions,exclusive:!0}],[K.VertexAttribute.NORMAL,{size:3,data:Y.normals,exclusive:!0}],[K.VertexAttribute.COLOR,{size:4,data:ea,exclusive:!0}],[K.VertexAttribute.SIZE,{size:1,data:Y.heights,exclusive:!0}]];ba=[[K.VertexAttribute.POSITION,ka],[K.VertexAttribute.NORMAL,ka],[K.VertexAttribute.COLOR,ba]];Y.elevation&&(ea.push([K.VertexAttribute.MAPPOS,
{size:3,data:Y.elevation}]),ba.push([K.VertexAttribute.MAPPOS,ka]));return new G.Geometry(ea,ba,F.PrimitiveType.Triangle,la)}function L(ka,la,Y,ea,ba,Z,fa,ja,oa,sa,qa,Ha,Ga,pa){let Da=0;var ra=2*ea.count;{var Ea=ea.index,Ia=ea.count,Ma=Y.length/3,Qa=oa;f.copy(da,Ga);const wa=0<Ha?1:-1;Ea*=3;let Ja=Qa;Ga=3*Ja;let Ta=Qa+Ia;Qa=3*Ta;for(let Xa=0;Xa<Ia;++Xa)pa&&(da[0]=ka[Ea+0],da[1]=ka[Ea+1],da[2]=ka[Ea+2],f.normalize(da,da)),ba[Ga+0]=ka[Ea+0],ba[Ga+1]=ka[Ea+1],ba[Ga+2]=ka[Ea+2],Z[Ga+0]=la[Ea+0],Z[Ga+
1]=la[Ea+1],Z[Ga+2]=la[Ea+2],fa[Ga+0]=-wa*da[0],fa[Ga+1]=-wa*da[1],fa[Ga+2]=-wa*da[2],ja[Ja]=0,ba[Qa+0]=ka[Ea+0]+Ha*da[0],ba[Qa+1]=ka[Ea+1]+Ha*da[1],ba[Qa+2]=ka[Ea+2]+Ha*da[2],Z[Qa+0]=la[Ea+0],Z[Qa+1]=la[Ea+1],Z[Qa+2]=la[Ea+2],fa[Qa+0]=wa*da[0],fa[Qa+1]=wa*da[1],fa[Qa+2]=wa*da[2],ja[Ta]=Ha,Ga+=3,Qa+=3,Ea+=3,Ja+=1,Ta+=1;Ga=Ea=0;Qa=3*ra;ka=0>Ha?ia:ha;la=0>Ha?ha:ia;for(pa=0;pa<Ma;++pa)qa[Ga+0]=Y[Ea+ka[0]],qa[Ga+1]=Y[Ea+ka[1]],qa[Ga+2]=Y[Ea+ka[2]],sa[Qa+0]=Y[Ea+la[0]]+Ia,sa[Qa+1]=Y[Ea+la[1]]+Ia,sa[Qa+
2]=Y[Ea+la[2]]+Ia,Ga+=3,Qa+=3,Ea+=3}oa+=2*ea.count;ra=0;H(ba,Z,ja,fa,Da,ea.pathLengths[0],ea.count,oa,sa,ra,Ha);oa+=4*ea.pathLengths[0];ra+=2*ea.pathLengths[0];Da+=ea.pathLengths[0];for(Y=1;Y<ea.pathLengths.length;++Y)H(ba,Z,ja,fa,Da,ea.pathLengths[Y],ea.count,oa,sa,ra,Ha),oa+=4*ea.pathLengths[Y],ra+=2*ea.pathLengths[Y],Da+=ea.pathLengths[Y]}function J(ka,la,Y,ea,ba,Z,fa){ea[Z]=ea[fa];fa*=3;Z*=3;ka[Z+0]=ka[fa+0];ka[Z+1]=ka[fa+1];ka[Z+2]=ka[fa+2];la[Z+0]=la[fa+0];la[Z+1]=la[fa+1];la[Z+2]=la[fa+2];
Y[Z+0]=ba[0];Y[Z+1]=ba[1];Y[Z+2]=ba[2]}function H(ka,la,Y,ea,ba,Z,fa,ja,oa,sa,qa){let Ha=ba,Ga=ba+1,pa=ba+fa,Da=ba+fa+1,ra=ja,Ea=ja+1,Ia=ja+2*Z;ja=ja+2*Z+1;0>qa&&(Ha=ba+fa+1,Da=ba);sa*=3;for(let Xa=0;Xa<Z;++Xa){Xa===Z-1&&(0<qa?(Ga=ba,Da=ba+fa):(Ga=ba,Ha=ba+fa));var Ma=ka,Qa=Ha,wa=Ga,Ja=pa,Ta=Q;Qa*=3;wa*=3;Ja*=3;f.set(S,Ma[Qa++],Ma[Qa++],Ma[Qa++]);f.set(T,Ma[wa++],Ma[wa++],Ma[wa++]);f.set(U,Ma[Ja++],Ma[Ja++],Ma[Ja++]);f.subtract(aa,T,S);f.subtract(W,U,S);f.cross(Ta,W,aa);f.normalize(Ta,Ta);J(ka,la,
ea,Y,Q,ra,Ha);J(ka,la,ea,Y,Q,Ea,Ga);J(ka,la,ea,Y,Q,Ia,pa);J(ka,la,ea,Y,Q,ja,Da);oa[sa++]=ra;oa[sa++]=Ia;oa[sa++]=ja;oa[sa++]=ra;oa[sa++]=ja;oa[sa++]=Ea;Ha++;Ga++;pa++;Da++;ra+=2;Ea+=2;Ia+=2;ja+=2}}function I(ka,la,Y,ea){ka=ka.stageObject;const ba=ka.geometryRecords,Z=ba.length,fa="absolute-height"!==la.mode;let ja=0;const oa=ka.transformation,sa=g.invert(k.create(),oa);for(let Ha=0;Ha<Z;Ha+=2){const Ga=ba[Ha].geometry,pa=Ga.getMutableAttribute(K.VertexAttribute.POSITION).data,Da=Ga.vertexAttributes.get(K.VertexAttribute.SIZE).data;
var qa=Ga.vertexAttributes.get(K.VertexAttribute.MAPPOS).data;qa=new E.SamplePosition(qa);const ra=pa.length/3;let Ea=0,Ia=!1,Ma=0;const Qa=Y.spatialReference;for(let wa=0;wa<ra;wa++){R[0]=pa[Ea];R[1]=pa[Ea+1];R[2]=pa[Ea+2];B.evaluateElevationInfoAtPoint(qa,Y,la,ea,ca);fa&&(Ma+=ca.sampledElevation);D.TESTS_DISABLE_OPTIMIZATIONS?(f.set(V,qa.array[qa.offset+0],qa.array[qa.offset+1],ca.z+Da[Ea/3]),ea.toRenderCoords(V,Qa,V)):(f.set(V,pa[Ea+0],pa[Ea+1],pa[Ea+2]),f.transformMat4(V,V,oa),ea.setAltitude(V,
ca.z+Da[Ea/3]));f.transformMat4(V,V,sa);pa[Ea]=V[0];pa[Ea+1]=V[1];pa[Ea+2]=V[2];const Ja=.01/ea.unitInMeters;if(Math.abs(R[0]-pa[Ea])>=Ja||Math.abs(R[1]-pa[Ea+1])>=Ja||Math.abs(R[2]-pa[Ea+2])>=Ja)Ia=!0;qa.offset+=3;Ea+=3}Ia&&(Ga.invalidateBoundingInfo(),ka.geometryVertexAttrsUpdated(ba[Ha]),ba[Ha+1].geometry.invalidateBoundingInfo(),ka.geometryVertexAttrsUpdated(ba[Ha+1]));ja+=Ma/ra}return ja/Z}const O=["polygon","extent"];C=function(ka){function la(ea,ba,Z,fa){ea=ka.call(this,ea,ba,Z,fa)||this;ea.ensureDrapedStatus(!1);
return ea}b._inheritsLoose(la,ka);var Y=la.prototype;Y.doLoad=function(){var ea=b._asyncToGenerator(function*(){if(!this._drivenProperties.size){var ba=z.validateSymbolLayerSize(this._getSymbolSize());if(ba)throw new c("graphics3dextrudesymbollayer:invalid-size",ba);}ba=m.get(this.symbolLayer,"material","color");var Z=this._getCombinedOpacityAndColor(ba);ba=d.fromArray(Z);Z=Z[3];const fa=1>Z||this.needsDrivenTransparentPass;ba={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:ba,
ambient:ba,opacity:Z,transparent:fa,cullFace:fa?F.CullFaceOptions.None:F.CullFaceOptions.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new N.DefaultMaterial(ba);this._bottomMaterial=new N.DefaultMaterial({...ba,cullFace:F.CullFaceOptions.Back});this._context.stage.add(this._material);this._context.stage.add(this._bottomMaterial)});return function(){return ea.apply(this,arguments)}}();Y.destroy=
function(){ka.prototype.destroy.call(this);this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))};Y.createGraphics3DGraphic=function(ea){const ba=ea.graphic;if(!this._validateGeometry(ba.geometry,O,this.symbolLayer.type))return null;const Z=this._getVertexOpacityAndColor(ea.renderingInfo,255),fa=this.setGraphicElevationContext(ba,new q.ElevationContext);return this._createAs3DShape(ba,ea.renderingInfo,Z,fa,ba.uid)};Y.layerOpacityChanged=function(ea,
ba){var Z=m.get(this.symbolLayer,"material","color");Z=this._getCombinedOpacity(Z);const fa=1>Z||this.needsDrivenTransparentPass;this._material.setParameters({opacity:Z,transparent:fa});this._bottomMaterial.setParameters({opacity:Z,transparent:fa});const ja=this._getLayerOpacity();ea.forEach(oa=>{oa=ba(oa);m.isSome(oa)&&oa.layerOpacityChanged(ja,this._context.isAsync)});return!0};Y.layerElevationInfoChanged=function(ea,ba){return this.updateGraphics3DGraphicElevationInfo(ea,ba,B.needsElevationUpdates3D)};
Y.slicePlaneEnabledChanged=function(ea,ba){this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});ea.forEach(Z=>{Z=ba(Z);m.isSome(Z)&&Z.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)});return!0};Y.physicalBasedRenderingChanged=function(){this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,
isSchematic:!0});return!0};Y.pixelRatioChanged=function(){return!0};Y._getExtrusionSize=function(ea){if(ea.size&&this._drivenProperties.size){var ba;ea=null!=(ba=t.getDriverAxisSizeValue(ea.size,2))?ba:0}else ea=this._getSymbolSize();return ea/=this._context.renderCoordsHelper.unitInMeters};Y.applyRendererDiff=function(ea,ba){return this._drivenPropertiesChanged(ba)?A.ApplyRendererDiffResult.Recreate_Symbol:A.ApplyRendererDiffResult.Recreate_Graphics};Y._getSymbolSize=function(){var ea;return null!=
(ea=this.symbolLayer.size)?ea:1};Y._createAs3DShape=function(ea,ba,Z,fa,ja){var oa=p.geometryAsPolygon(ea.geometry);if(m.isNone(oa))return null;ea=p.geometryToRenderInfo(oa,this._context.elevationProvider,this._context.renderCoordsHelper,fa);this._logGeometryCreationWarnings(ea,oa.rings,"rings","ExtrudeSymbol3DLayer");if(0===oa.rings.length||!oa.rings.some(Ra=>0<Ra.length))return null;var sa=z.computeCentroid(oa);if(m.isNone(sa))return null;var qa=[];const Ha=[],Ga=[],pa=h.create(),Da=k.create(),
ra=d.create(),Ea=this._context.renderCoordsHelper.viewingMode===x.ViewingMode.Global;Ea||this._context.renderCoordsHelper.worldUpAtPosition(null,ra);e.computeTranslationToOriginAndRotation(oa.spatialReference,[sa.x,sa.y,0],Da,this._context.renderCoordsHelper.spatialReference);oa=k.create();g.invert(oa,Da);sa=n.create();r.normalFromMat4(sa,oa);const {polygons:Ia,mapPosition:Ma,position:Qa}=ea;var wa=Qa.length/3;const Ja=new Float64Array(18*wa),Ta=new Float64Array(18*wa),Xa=new Float64Array(18*wa);
wa=new Float64Array(6*wa);let ma=0;for(let Ra=0;Ra<Ia.length;++Ra){var $a=Ia[Ra];const za=$a.count;if(this._context.clippingExtent&&(h.empty(pa),h.expandWithBuffer(pa,$a.mapPosition),!h.intersectsClippingArea(pa,this._context.clippingExtent)))continue;const ya=l.earcut($a.mapPosition,$a.holeIndices,3);if(0===ya.length)continue;const Na=new Uint32Array(6*za+ya.length);var xa=new Uint32Array(ya.length),Ka=6*za,Oa=3*Ja.BYTES_PER_ELEMENT;Oa=new v.BufferViewVec3f64(Ja.buffer,ma*Oa,Oa,(ma+Ka)*Oa);var Va=
3*Ta.BYTES_PER_ELEMENT;Va=new v.BufferViewVec3f64(Ta.buffer,ma*Va,Va,(ma+Ka)*Va);const Wa=new Float64Array(Xa.buffer,3*ma*Xa.BYTES_PER_ELEMENT,3*Ka);Ka=new Float64Array(wa.buffer,1*ma*wa.BYTES_PER_ELEMENT,1*Ka);const bb=this._getExtrusionSize(ba);L(Qa,Ma,ya,$a,Oa.typedBuffer,Wa,Va.typedBuffer,Ka,0,Na,xa,bb,ra,Ea);w.transformMat4(Oa,Oa,oa);w.transformMat3(Va,Va,sa);ma+=6*za;$a=M(Na,Na.length-xa.length,{positions:Oa.typedBuffer,elevation:Wa,normals:Va.typedBuffer,heights:Ka},Z);qa.push($a);Ha.push(this._material);
Ga.push(k.IDENTITY);xa=M(xa,0,{positions:Oa.typedBuffer,elevation:Wa,normals:Va.typedBuffer,heights:Ka},Z);qa.push(xa);Ha.push(this._bottomMaterial);Ga.push(k.IDENTITY)}if(0===qa.length)return null;ba=new P.Object3D({geometries:qa,materials:Ha,transformations:Ga,metadata:{layerUid:this._context.layer.uid,graphicUid:ja,isElevationSource:!0}});ba.transformation=Da;Z=y.createMaterial(this.symbolLayer,{opacity:this._getLayerOpacity()});Z=m.isSome(Z)?{baseMaterial:this._material,edgeMaterials:[Z],properties:{mergeGeometries:!0,
hasSlicePlane:this._context.slicePlaneEnabled}}:null;qa=new u.Graphics3DObject3DGraphicLayer(this,ba,qa,null,null,I,fa,Z);qa.alignedSampledElevation=ea.sampledElevation;qa.needsElevationUpdates=B.needsElevationUpdates3D(fa.mode);return qa};return la}(C.Graphics3DSymbolLayer);const Q=d.create(),S=d.create(),T=d.create(),U=d.create(),aa=d.create(),W=d.create(),R=d.create(),V=d.create(),da=d.create(),ca=new B.SampleElevationInfo,ha=[0,2,1],ia=[0,1,2];a.Graphics3DExtrudeSymbolLayer=C;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/earcut":function(){define(["exports"],function(a){var b={exports:{}};(function(c){(function(m){m=m();void 0!==m&&(c.exports=m)})(function(){function m(D,E,F){F=F||2;var G=E&&E.length,P=G?E[0]*F:D.length,K=l(D,0,P,F,!0),N=[];if(!K||K.next===K.prev)return N;var M;if(G){var L=K;var J=F;K=[];var H;G=0;for(H=E.length;G<H;G++){var I=E[G]*J;var O=G<H-1?E[G+1]*J:D.length;I=l(D,I,O,J,!1);I===I.next&&(I.steiner=!0);K.push(h(I))}K.sort(k);
for(G=0;G<K.length;G++)J=K[G],E=L,(L=d(J,E))?(H=C(L,J),J=r(L,L.next),H=f(H),r(H,H.next),J=f(J),L=f(E===L?J:E)):L=E,L=r(L,L.next);K=L}if(D.length>80*F){var Q=M=D[0];var S=G=D[1];for(J=F;J<P;J+=F)E=D[J],L=D[J+1],E<Q&&(Q=E),L<S&&(S=L),E>M&&(M=E),L>G&&(G=L);M=Math.max(M-Q,G-S);M=0!==M?1/M:0}n(K,N,F,Q,S,M);return N}function l(D,E,F,G,P){if(P===0<y(D,E,F,G))for(P=E;P<F;P+=G)var K=z(P,D[P],D[P+1],K);else for(P=F-G;P>=E;P-=G)K=z(P,D[P],D[P+1],K);K&&t(K,K.next)&&(D=K.next,A(K),K=D);return K}function r(D,E){if(!D)return D;
E||(E=D);do{var F=!1;if(D.steiner||!t(D,D.next)&&0!==w(D.prev,D,D.next))D=D.next;else{E=D.prev;A(D);D=E;if(D===D.next)break;F=!0}}while(F||D!==E);return E}function n(D,E,F,G,P,K,N){if(D){if(!N&&K){var M=D,L=M;do null===L.z&&(L.z=e(L.x,L.y,G,P,K)),L.prevZ=L.prev,L=L.nextZ=L.next;while(L!==M);L.prevZ.nextZ=null;L.prevZ=null;M=L;var J,H,I,O,Q=1;do{L=M;var S=M=null;for(H=0;L;){H++;var T=L;for(J=I=0;J<Q&&(I++,T=T.nextZ,T);J++);for(O=Q;0<I||0<O&&T;)0!==I&&(0===O||!T||L.z<=T.z)?(J=L,L=L.nextZ,I--):(J=T,
T=T.nextZ,O--),S?S.nextZ=J:M=J,J.prevZ=S,S=J;L=T}S.nextZ=null;Q*=2}while(1<H)}for(M=D;D.prev!==D.next;){L=D.prev;T=D.next;if(K)S=g(D,G,P,K);else a:if(S=D,H=S.prev,I=S,Q=S.next,0<=w(H,I,Q))S=!1;else{for(J=S.next.next;J!==S.prev;){if(v(H.x,H.y,I.x,I.y,Q.x,Q.y,J.x,J.y)&&0<=w(J.prev,J,J.next)){S=!1;break a}J=J.next}S=!0}if(S)E.push(L.i/F),E.push(D.i/F),E.push(T.i/F),A(D),M=D=T.next;else if(D=T,D===M){if(!N)n(r(D),E,F,G,P,K,1);else if(1===N){D=r(D);N=E;M=F;L=D;do T=L.prev,S=L.next.next,!t(T,S)&&x(T,L,
L.next,S)&&u(T,S)&&u(S,T)&&(N.push(T.i/M),N.push(L.i/M),N.push(S.i/M),A(L),A(L.next),L=D=S),L=L.next;while(L!==D);D=r(L);n(D,E,F,G,P,K,2)}else if(2===N)a:{N=D;do{for(M=N.next.next;M!==N.prev;){if(L=N.i!==M.i){S=S=S=S=void 0;L=N;T=M;if(S=L.next.i!==T.i&&L.prev.i!==T.i){b:{S=L;do{if(S.i!==L.i&&S.next.i!==L.i&&S.i!==T.i&&S.next.i!==T.i&&x(S,S.next,L,T)){S=!0;break b}S=S.next}while(S!==L);S=!1}S=!S}if(S){if(S=u(L,T)&&u(T,L)){S=L;H=!1;I=(L.x+T.x)/2;Q=(L.y+T.y)/2;do S.y>Q!==S.next.y>Q&&S.next.y!==S.y&&
I<(S.next.x-S.x)*(Q-S.y)/(S.next.y-S.y)+S.x&&(H=!H),S=S.next;while(S!==L);S=H}S=S&&(w(L.prev,L,T.prev)||w(L,T.prev,T))||t(L,T)&&0<w(L.prev,L,L.next)&&0<w(T.prev,T,T.next)}L=S}if(L){D=C(N,M);N=r(N,N.next);D=r(D,D.next);n(N,E,F,G,P,K);n(D,E,F,G,P,K);break a}M=M.next}N=N.next}while(N!==D)}break}}}}function g(D,E,F,G){var P=D.prev,K=D.next;if(0<=w(P,D,K))return!1;var N=P.x>D.x?P.x>K.x?P.x:K.x:D.x>K.x?D.x:K.x,M=P.y>D.y?P.y>K.y?P.y:K.y:D.y>K.y?D.y:K.y,L=e(P.x<D.x?P.x<K.x?P.x:K.x:D.x<K.x?D.x:K.x,P.y<D.y?
P.y<K.y?P.y:K.y:D.y<K.y?D.y:K.y,E,F,G);E=e(N,M,E,F,G);F=D.prevZ;for(G=D.nextZ;F&&F.z>=L&&G&&G.z<=E;){if(F!==D.prev&&F!==D.next&&v(P.x,P.y,D.x,D.y,K.x,K.y,F.x,F.y)&&0<=w(F.prev,F,F.next))return!1;F=F.prevZ;if(G!==D.prev&&G!==D.next&&v(P.x,P.y,D.x,D.y,K.x,K.y,G.x,G.y)&&0<=w(G.prev,G,G.next))return!1;G=G.nextZ}for(;F&&F.z>=L;){if(F!==D.prev&&F!==D.next&&v(P.x,P.y,D.x,D.y,K.x,K.y,F.x,F.y)&&0<=w(F.prev,F,F.next))return!1;F=F.prevZ}for(;G&&G.z<=E;){if(G!==D.prev&&G!==D.next&&v(P.x,P.y,D.x,D.y,K.x,K.y,G.x,
G.y)&&0<=w(G.prev,G,G.next))return!1;G=G.nextZ}return!0}function k(D,E){return D.x-E.x}function f(D){if(D.next.prev===D)return D;let E=D;do{const F=E.next;if(F.prev===E||F===E||F===D)break;E=F}while(1);return E}function d(D,E){var F=E,G=D.x,P=D.y,K=-Infinity;do{if(P<=F.y&&P>=F.next.y&&F.next.y!==F.y){var N=F.x+(P-F.y)*(F.next.x-F.x)/(F.next.y-F.y);if(N<=G&&N>K){K=N;if(N===G){if(P===F.y)return F;if(P===F.next.y)return F.next}var M=F.x<F.next.x?F:F.next}}F=F.next}while(F!==E);if(!M)return null;if(G===
K)return M;E=M;N=M.x;var L=M.y,J=Infinity;F=M;do{if(G>=F.x&&F.x>=N&&G!==F.x&&v(P<L?G:K,P,N,L,P<L?K:G,P,F.x,F.y)){var H=Math.abs(P-F.y)/(G-F.x);var I;if((I=u(F,D))&&!(I=H<J)&&(I=H===J)&&!(I=F.x>M.x)&&(I=F.x===M.x)){I=M;var O=F;I=0>w(I.prev,I,O.prev)&&0>w(O.next,I,I.next)}I&&(M=F,J=H)}F=F.next}while(F!==E);return M}function e(D,E,F,G,P){D=32767*(D-F)*P;E=32767*(E-G)*P;D=(D|D<<8)&16711935;D=(D|D<<4)&252645135;D=(D|D<<2)&858993459;E=(E|E<<8)&16711935;E=(E|E<<4)&252645135;E=(E|E<<2)&858993459;return(D|
D<<1)&1431655765|((E|E<<1)&1431655765)<<1}function h(D){var E=D,F=D;do{if(E.x<F.x||E.x===F.x&&E.y<F.y)F=E;E=E.next}while(E!==D);return F}function v(D,E,F,G,P,K,N,M){return 0<=(P-N)*(E-M)-(D-N)*(K-M)&&0<=(D-N)*(G-M)-(F-N)*(E-M)&&0<=(F-N)*(K-M)-(P-N)*(G-M)}function w(D,E,F){return(E.y-D.y)*(F.x-E.x)-(E.x-D.x)*(F.y-E.y)}function t(D,E){return D.x===E.x&&D.y===E.y}function x(D,E,F,G){var P=q(w(D,E,F)),K=q(w(D,E,G)),N=q(w(F,G,D)),M=q(w(F,G,E));return P!==K&&N!==M||0===P&&B(D,F,E)||0===K&&B(D,G,E)||0===
N&&B(F,D,G)||0===M&&B(F,E,G)?!0:!1}function B(D,E,F){return E.x<=Math.max(D.x,F.x)&&E.x>=Math.min(D.x,F.x)&&E.y<=Math.max(D.y,F.y)&&E.y>=Math.min(D.y,F.y)}function q(D){return 0<D?1:0>D?-1:0}function u(D,E){return 0>w(D.prev,D,D.next)?0<=w(D,E,D.next)&&0<=w(D,D.prev,E):0>w(D,E,D.prev)||0>w(D,D.next,E)}function C(D,E){var F=new p(D.i,D.x,D.y),G=new p(E.i,E.x,E.y),P=D.next,K=E.prev;D.next=E;E.prev=D;F.next=P;P.prev=F;G.next=F;F.prev=G;K.next=G;G.prev=K;return G}function z(D,E,F,G){D=new p(D,E,F);G?
(D.next=G.next,D.prev=G,G.next.prev=D,G.next=D):(D.prev=D,D.next=D);return D}function A(D){D.next.prev=D.prev;D.prev.next=D.next;D.prevZ&&(D.prevZ.nextZ=D.nextZ);D.nextZ&&(D.nextZ.prevZ=D.prevZ)}function p(D,E,F){this.i=D;this.x=E;this.y=F;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function y(D,E,F,G){for(var P=0,K=F-G;E<F;E+=G)P+=(D[K]-D[E])*(D[E+1]+D[K+1]),K=E;return P}m.deviation=function(D,E,F,G){var P=E&&E.length,K=Math.abs(y(D,0,P?E[0]*F:D.length,F));if(P){P=0;for(var N=
E.length;P<N;P++)K-=Math.abs(y(D,E[P]*F,P<N-1?E[P+1]*F:D.length,F))}for(P=E=0;P<G.length;P+=3){N=G[P]*F;var M=G[P+1]*F,L=G[P+2]*F;E+=Math.abs((D[N]-D[L])*(D[M+1]-D[N+1])-(D[N]-D[M])*(D[L+1]-D[N+1]))}return 0===K&&0===E?0:Math.abs((E-K)/K)};m.flatten=function(D){for(var E=D[0][0].length,F={vertices:[],holes:[],dimensions:E},G=0,P=0;P<D.length;P++){for(var K=0;K<D[P].length;K++)for(var N=0;N<E;N++)F.vertices.push(D[P][K][N]);0<P&&(G+=D[P-1].length,F.holes.push(G))}return F};return m})})(b);a.earcut=
b.exports})},"esri/chunks/vec32":function(){define(["exports","../geometry/support/buffer/math/common"],function(a,b){function c(k,f,d){if(k.count!==f.count)b.mathLogger.error("source and destination buffers need to have the same number of elements");else{var e=k.count,h=d[0],v=d[1],w=d[2],t=d[4],x=d[5],B=d[6],q=d[8],u=d[9],C=d[10],z=d[12],A=d[13];d=d[14];var p=k.typedBuffer;k=k.typedBufferStride;var y=f.typedBuffer;f=f.typedBufferStride;for(let E=0;E<e;E++){const F=E*k;var D=E*f;const G=y[D],P=y[D+
1];D=y[D+2];p[F]=h*G+t*P+q*D+z;p[F+1]=v*G+x*P+u*D+A;p[F+2]=w*G+B*P+C*D+d}}}function m(k,f,d){if(k.count!==f.count)b.mathLogger.error("source and destination buffers need to have the same number of elements");else{var e=k.count,h=d[0],v=d[1],w=d[2],t=d[3],x=d[4],B=d[5],q=d[6],u=d[7];d=d[8];var C=k.typedBuffer;k=k.typedBufferStride;var z=f.typedBuffer;f=f.typedBufferStride;for(let p=0;p<e;p++){const y=p*k;var A=p*f;const D=z[A],E=z[A+1];A=z[A+2];C[y]=h*D+t*E+q*A;C[y+1]=v*D+x*E+u*A;C[y+2]=w*D+B*E+d*
A}}}function l(k,f,d){const e=Math.min(k.count,f.count),h=k.typedBuffer;k=k.typedBufferStride;const v=f.typedBuffer;f=f.typedBufferStride;for(let w=0;w<e;w++){const t=w*k,x=w*f;h[t]=d*v[x];h[t+1]=d*v[x+1];h[t+2]=d*v[x+2]}}function r(k,f){const d=Math.min(k.count,f.count),e=k.typedBuffer;k=k.typedBufferStride;const h=f.typedBuffer;f=f.typedBufferStride;for(let t=0;t<d;t++){const x=t*k;var v=t*f;const B=h[v],q=h[v+1];v=h[v+2];var w=B*B+q*q+v*v;0<w&&(w=1/Math.sqrt(w),e[x]=w*B,e[x+1]=w*q,e[x+2]=w*v)}}
function n(k,f,d){const e=Math.min(k.count,f.count),h=k.typedBuffer;k=k.typedBufferStride;const v=f.typedBuffer;f=f.typedBufferStride;for(let w=0;w<e;w++){const t=w*k,x=w*f;h[t]=v[x]>>d;h[t+1]=v[x+1]>>d;h[t+2]=v[x+2]>>d}}const g=Object.freeze(Object.defineProperty({__proto__:null,transformMat4:c,transformMat3:m,scale:l,normalize:r,shiftRight:n},Symbol.toStringTag,{value:"Module"}));a.normalize=r;a.scale=l;a.shiftRight=n;a.transformMat3=m;a.transformMat4=c;a.vec3=g})},"esri/geometry/support/buffer/math/common":function(){define(["exports",
"../../../../core/Logger"],function(a,b){b=b.getLogger("esri.views.3d.support.buffer.math");a.mathLogger=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/renderers/support/renderingInfoUtils":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../Color","../../core/maybe","../visualVariables/support/visualVariableUtils"],function(a,b,c,m,l){function r(f,d){if(!f||f.symbol)return null;d=d&&d.renderer;return f&&m.isSome(d)&&d.getObservationRenderer?
d.getObservationRenderer(f):d}function n(f,d){return g.apply(this,arguments)}function g(){g=b._asyncToGenerator(function*(f,d){if(m.isSome(f.symbol))return f.symbol;const e=r(f,d);return m.isSome(e)&&e.getSymbolAsync(f,d)});return g.apply(this,arguments)}function k(){k=b._asyncToGenerator(function*(f,d){var e=r(f,d),h=yield n(f,d);if(!h)return null;h={renderer:e,symbol:h};if(!(e&&"visualVariables"in e&&e.visualVariables))return h;d=l.getVisualVariableValues(e,f,d);f=["proportional","proportional",
"proportional"];for(const {variable:v,value:w}of d)"color"===v.type?h.color=c.toUnitRGBA(w):"size"===v.type?"outline"===v.target?h.outlineSize=w:(d=v.axis,e=v.useSymbolValue?"symbol-value":w,"width"===d?f[0]=e:"depth"===d?f[1]=e:"height"===d?f[2]=e:f[0]="width-and-depth"===d?f[1]=e:f[1]=f[2]=e):"opacity"===v.type?h.opacity=w:"rotation"===v.type&&"tilt"===v.axis?h.tilt=w:"rotation"===v.type&&"roll"===v.axis?h.roll=w:"rotation"===v.type&&(h.heading=w);if(isFinite(f[0])||isFinite(f[1])||isFinite(f[2]))h.size=
f;return h});return k.apply(this,arguments)}a.getDriverAxisSizeValue=function(f,d=0){f=f[d];return"number"===typeof f&&isFinite(f)?f:null};a.getDriverAxisSizeValueAny=function(f){for(let d=0;3>d;d++){const e=f[d];if("number"===typeof e)return isFinite(e)?e:0}return 0};a.getRenderer=r;a.getRenderingInfo=function(f,d){const e=r(f,d);if(m.isSome(f.symbol))var h=f.symbol;else h=r(f,d),h=m.isSome(h)&&"dot-density"!==h.type?h.getSymbol(f,d):null;if(m.isNone(h))return null;h={renderer:e,symbol:h};if(m.isNone(e)||
!("visualVariables"in e)||!e.visualVariables)return h;d=l.getVisualVariableValues(e,f,d);f=["proportional","proportional","proportional"];for(const {variable:v,value:w}of d)switch(v.type){case "color":h.color=w.toRgba();break;case "size":if("outline"===v.target)h.outlineSize=w;else switch(d=v.useSymbolValue?"symbol-value":w,v.axis){case "width":f[0]=d;break;case "depth":f[1]=d;break;case "height":f[2]=d;break;case "width-and-depth":f[0]=f[1]=d;break;default:f[0]=f[1]=f[2]=d}break;case "opacity":h.opacity=
w;break;case "rotation":switch(v.axis){case "tilt":h.tilt=w;break;case "roll":h.roll=w;break;default:h.heading=w}}if("proportional"!==f[0]||"proportional"!==f[1]||"proportional"!==f[2])h.size=f;return h};a.getRenderingInfoAsync=function(f,d){return k.apply(this,arguments)};a.getSymbolAsync=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/polygonUtils":function(){define("exports ../../../../geometry ../../../../core/maybe ../../../../geometry/projection ../../../../geometry/support/triangulationUtils ./elevationAlignmentUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute ../../../../geometry/Extent ../../../../geometry/Polygon".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){function e(v,w,t){const x=[];for(const {index:B,count:q}of v){if(1>=q)continue;v=3*B;const u=v+3*q;x.push({index:B,count:q,position:w.subarray(v,u),mapPosition:t?t.subarray(v,u):void 0})}return x}function h(v,w,t){const x=[];for(const {index:B,count:q,holeIndices:u,pathLengths:C}of v){if(1>=q)continue;v=3*B;const z=v+3*q,A=u.map(p=>p-B);x.push({index:B,count:q,holeIndices:A,pathLengths:C,position:w.subarray(v,z),mapPosition:t?t.subarray(v,z):void 0})}return x}a.createColorGeometry=
function(v){const w=[[k.VertexAttribute.POSITION,v.indices]],t=[[k.VertexAttribute.POSITION,{size:3,data:v.attributeData.position,exclusive:!0}]];c.isSome(v.attributeData.color)&&(t.push([k.VertexAttribute.COLOR,{size:4,data:v.attributeData.color,exclusive:!0}]),w.push([k.VertexAttribute.COLOR,new Uint32Array(v.indices.length)]));c.isSome(v.attributeData.uvMapSpace)&&(t.push([k.VertexAttribute.UVMAPSPACE,{size:4,data:v.attributeData.uvMapSpace,exclusive:!0}]),w.push([k.VertexAttribute.UVMAPSPACE,
v.indices]));c.isSome(v.attributeData.boundingRect)&&(t.push([k.VertexAttribute.BOUNDINGRECT,{size:9,data:v.attributeData.boundingRect,exclusive:!0}]),w.push([k.VertexAttribute.BOUNDINGRECT,v.indices]));c.isSome(v.attributeData.mapPosition)&&(t.push([k.VertexAttribute.MAPPOS,{size:3,data:v.attributeData.mapPosition,exclusive:!0}]),w.push([k.VertexAttribute.MAPPOS,v.indices]));return new g.Geometry(t,w)};a.createWaterGeometry=function(v){const w=[[k.VertexAttribute.POSITION,v.indices],[k.VertexAttribute.UV0,
v.indices]],t=[[k.VertexAttribute.POSITION,{size:3,data:v.attributeData.position,exclusive:!0}],[k.VertexAttribute.UV0,{size:2,data:v.attributeData.uv0,exclusive:!0}]];c.isSome(v.attributeData.mapPosition)&&(t.push([k.VertexAttribute.MAPPOS,{size:3,data:v.attributeData.mapPosition,exclusive:!0}]),w.push([k.VertexAttribute.MAPPOS,v.indices]));return new g.Geometry(t,w)};a.geometryAsPolygon=function(v){switch(v.type){case "extent":if(v instanceof f)return d.fromExtent(v);break;case "polygon":return v}return null};
a.geometryToRenderInfo=function(v,w,t,x){const B=l.pathsToTriangulationInfo(v.rings,v.hasZ,l.CounterClockwiseMode.CCW_IS_HOLE),q=new Float64Array(B.position.length);v=r.applyPerVertexElevationAlignment(B.position,v.spatialReference,0,q,0,B.position,0,B.position.length/3,w,t,x);w=null!=v;return{position:B.position,mapPosition:q,polygons:h(B.polygons,B.position,q),outlines:e(B.outlines,B.position,q),projectionSuccess:w,sampledElevation:v}};a.geometryToRenderInfoDraped=function(v,w){const t=l.pathsToTriangulationInfo(v.rings,
!1,l.CounterClockwiseMode.CCW_IS_HOLE);v=m.projectBuffer(t.position,v.spatialReference,0,t.position,w,0,t.position.length/3);for(w=2;w<t.position.length;w+=3)t.position[w]=n.DRAPED_Z;return{position:t.position,polygons:h(t.polygons,t.position),outlines:e(t.outlines,t.position),projectionSuccess:v}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/triangulationUtils":function(){define(["exports","../../chunks/earcut","./coordsUtils",
"./meshUtils/deduplicate"],function(a,b,c,m){function l(g,k,f){if(1===g.length)return g[0];k=new Float64Array(k);f=new Uint32Array(f);let d=0,e=0,h=0;for(const v of g){for(g=0;g<v.position.length;g++)k[d++]=v.position[g];for(g=0;g<v.faces.length;g++)f[e++]=v.faces[g]+h;h=d/3}return{position:k,faces:f}}function r(g,k,f){const d=g.length,e=Array(d),h=Array(d),v=Array(d);let w=0,t=0,x=0;var B=0;for(var q=0;q<d;++q)B+=g[q].length;B=new Float64Array(3*B);q=0;for(let A=d-1;0<=A;A--){var u=g[A],C=f===a.CounterClockwiseMode.CCW_IS_HOLE?
!c.isClockwise(u,!1,!1):!1;if(C&&1!==d)e[w++]=u;else{var z=u.length;for(let p=0;p<w;++p)z+=e[p].length;z={index:q,pathLengths:Array(w+1),count:z,holeIndices:Array(w)};z.pathLengths[0]=u.length;0<u.length&&(v[x++]={index:q,count:u.length});q=C?n(u,u.length-1,-1,B,q,u.length,k):n(u,0,1,B,q,u.length,k);for(u=0;u<w;++u)C=e[u],z.holeIndices[u]=q,z.pathLengths[u+1]=C.length,0<C.length&&(v[x++]={index:q,count:C.length}),q=n(C,0,1,B,q,C.length,k);w=0;0<z.count&&(h[t++]=z)}}for(g=0;g<w;++g)f=e[g],0<f.length&&
(v[x++]={index:q,count:f.length}),q=n(f,0,1,B,q,f.length,k);t<d&&(h.length=t);x<d&&(v.length=x);return{position:B,polygons:h,outlines:v}}function n(g,k,f,d,e,h,v){e*=3;for(let w=0;w<h;++w){const t=g[k];d[e++]=t[0];d[e++]=t[1];d[e++]=v?t[2]:0;k+=f}return e/3}a.CounterClockwiseMode=void 0;(function(g){g[g.NONE=0]="NONE";g[g.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(a.CounterClockwiseMode||(a.CounterClockwiseMode={}));a.pathsToTriangulationInfo=r;a.triangulate=function(g){g=r(g.rings,g.hasZ,a.CounterClockwiseMode.CCW_IS_HOLE);
const k=[];let f=0,d=0;for(var e of g.polygons){const v=e.index,w=new Float64Array(g.position.buffer,3*v*g.position.BYTES_PER_ELEMENT,3*e.count);var h=e.holeIndices.map(t=>t-v);h=new Uint32Array(b.earcut(w,h,3));k.push({position:w,faces:h});f+=w.length;d+=h.length}e=l(k,f,d);g=m.deduplicate(e.position.buffer,6,{originalIndices:e.faces});e.position=new Float64Array(g.buffer);e.faces=g.indices;return e};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/meshUtils/deduplicate":function(){define(["exports",
"../../../core/mathUtils"],function(a,b){let c=null;a.deduplicate=function(m,l,r){var n,g=m.byteLength/(4*l),k=new Uint32Array(m,0,g*l);m=new Uint32Array(g);var f=null!=(n=null==r?void 0:r.minReduction)?n:0;const d=(n=(null==r?void 0:r.originalIndices)||null)?n.length:0;var e=(null==r?void 0:r.componentOffsets)||null;r=0;if(e)for(var h=0;h<e.length-1;h++){var v=e[h+1]-e[h];v>r&&(r=v)}else r=g;var w=Math.floor(1.1*r)+1;if(null==c||c.length<2*w)c=new Uint32Array(b.nextHighestPowerOfTwo(2*w));for(r=
0;r<2*w;r++)c[r]=0;r=0;v=(h=!!e&&!!n)?d:g;var t=h?new Uint32Array(d):null,x=0!==f?Math.ceil(7.84*1.96/(f*f)*f*(1-f)):v,B=1,q=e?e[1]:v;for(var u=0;u<v;u++){if(u===x){var C=1-r/u;if(C+1.96*Math.sqrt(C*(1-C)/u)<f)return null;x*=2}if(u===q){for(q=0;q<2*w;q++)c[q]=0;if(n)for(q=e[B-1];q<e[B];q++)t[q]=m[n[q]];q=e[++B]}C=h?n[u]:u;const y=C*l;var z=0;for(var A=0;A<l;A++)z=k[y+A]+z|0,z=z+(z<<11)+(z>>>2)|0;z>>>=0;A=z%w;let D=r;for(;0!==c[2*A+1];){if(c[2*A]===z){const E=c[2*A+1]-1;var p=E*l;a:{for(let F=0;F<
l;F++)if(k[y+F]!==k[p+F]){p=!1;break a}p=!0}if(p){D=m[E];break}}A++;A>=w&&(A-=w)}D===r&&(c[2*A]=z,c[2*A+1]=C+1,r++);m[C]=D}if(0!==f&&1-r/g<f)return null;if(h){for(g=e[B-1];g<t.length;g++)t[g]=m[n[g]];m=t}g=new Uint32Array(l*r);r=0;for(B=0;B<v;B++)if(m[B]===r){f=k;e=(h?n[B]:B)*l;w=g;t=r*l;x=l;for(u=0;u<x;u++)w[t+u]=f[e+u];r++}if(n&&!h){l=new Uint32Array(d);for(k=0;k<l.length;k++)l[k]=m[n[k]];m=l}return{buffer:g.buffer,indices:m,uniqueCount:r}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/terrain/OverlayRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/Handles ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/reactiveUtils ../../../core/SetUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/vec3f64 ../../ViewingMode ../layers/interfaces ../support/debugFlags ./interfaces ./Overlay ./OverlayFramebufferObject ./OverlayRenderTarget ../webgl-engine/core/shaderTechnique/ShaderTechniqueRepository ../webgl-engine/lib/AutoDisposable ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/Camera ../webgl-engine/lib/GLMaterialRepository ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/GridLocalOriginFactory ../webgl-engine/lib/Material ../webgl-engine/lib/RenderContext ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/ShadowMap ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/lib/SSAOHelper ../webgl-engine/lib/TextureTechnique ../webgl-engine/lib/TextureTechniqueConfiguration ../webgl-engine/lighting/Lightsources ../webgl-engine/materials/StippleTextureRepository ../webgl-engine/shaders/CompositingTechniqueConfiguration ../../support/Scheduler ../../webgl/enums ../../webgl/Texture ../../webgl/Util".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N,M,L,J,H,I,O,Q,S,T,U,aa,W,R,V,da,ca){a.OverlayRenderer=function(Y){function ea(Z){Z=Y.call(this,Z)||this;Z._overlays=null;Z._overlayRenderTarget=null;Z._hasHighlights=!1;Z._rendersOccluded=!1;Z._hasWater=!1;Z._handles=new r;Z._frameTask=R.ImmediateTask;Z._drapeSourceRenderers=new Map;Z._sortedDrapeSourceRenderersDirty=!1;Z._sortedDrapeSourceRenderers=new k;Z._rctx=null;Z._materialRepository=null;Z._screenToWorldRatio=1;Z._localOriginFactory=
null;Z.worldToPCSRatio=1;Z.events=new l;Z.longitudeCyclical=null;return Z}b._inheritsLoose(ea,Y);var ba=ea.prototype;ba.initialize=function(){const Z=this.view._stage.renderView;this._rctx=Z.renderingContext;const fa=Z.waterTextureRepository;this._stippleTextureRepository=new aa.StippleTextureRepository(Z.renderingContext);this._shaderTechniqueRepository=new D.ShaderTechniqueRepository({rctx:this._rctx,viewingMode:q.ViewingMode.Local,stippleTextureRepository:this._stippleTextureRepository,waterTextureRepository:fa});
this._renderContext=new L.OverlayRenderContext(this._rctx,new I.ShadowMap(this._rctx,this.view.state.viewingMode),new Q.SSAOHelper(this._shaderTechniqueRepository,this._rctx,()=>{}));this._handles.add([f.watch(()=>fa.updating,()=>this.events.emit("content-changed"),f.syncAndInitial),f.watch(()=>this.spatialReference,ja=>this._localOriginFactory=new N.GridLocalOriginFactory(ja),f.syncAndInitial),f.on(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=!0)]);this._materialRepository=
new P.GLMaterialRepository(Z.textureRepository,this._shaderTechniqueRepository,ja=>{0<(ja.renderOccluded&la)!==this._rendersOccluded&&this._updateRendersOccluded();this.events.emit("content-changed");this.notifyChange("updating")},()=>this.events.emit("content-changed"));this._bindParameters.slot=H.RenderSlot.DRAPED_MATERIAL;this._bindParameters.highlightDepthTexture=K.createEmptyDepthTexture(this._rctx);this._bindParameters.camera=ka;this._bindParameters.transparencyPassType=F.TransparencyPassType.NONE;
this._bindParameters.lighting.groundLightingFactor=1;this._bindParameters.lighting.globalFactor=0;this._bindParameters.lighting.set([new U.AmbientLight(B.fromValues(1,1,1))]);this._frameTask=this.view.resourceController.scheduler.registerTask(R.TaskPriority.STAGE,this);this._handles.add(this._frameTask)};ba.dispose=function(){this._handles.destroy();this._drapeSourceRenderers.forEach(Z=>Z.destroy());this._drapeSourceRenderers.clear();this._debugTextureTechnique=g.releaseMaybe(this._debugTextureTechnique);
this._debugPatternTexture=g.disposeMaybe(this._debugPatternTexture);this._bindParameters.highlightDepthTexture=g.disposeMaybe(this._bindParameters.highlightDepthTexture);this._shaderTechniqueRepository=g.disposeMaybe(this._shaderTechniqueRepository);this._temporaryFBO=g.disposeMaybe(this._temporaryFBO);this._quadVAO=g.disposeMaybe(this._quadVAO);this.disposeOverlays()};ba.createGeometryDrapeSourceRenderer=function(Z){return this.createDrapeSourceRenderer(Z,O.SortedRenderGeometryRenderer)};ba.createDrapeSourceRenderer=
function(Z,fa,ja){const oa=this._drapeSourceRenderers.get(Z);g.isSome(oa)&&oa.destroy();fa=new fa({...ja,rendererContext:this,drapeSource:Z});this._drapeSourceRenderers.set(Z,fa);this._sortedDrapeSourceRenderersDirty=!0;"fullOpacity"in Z&&this._handles.add(f.watch(()=>Z.fullOpacity,()=>this.events.emit("content-changed")),Z);return fa};ba.removeDrapeSourceRenderer=function(Z){if(!g.isNone(Z)){var fa=this._drapeSourceRenderers.get(Z);g.isNone(fa)||(this._sortedDrapeSourceRenderersDirty=!0,this._drapeSourceRenderers.delete(Z),
this._handles.remove(Z),fa.destroy())}};ba.collectUnusedRenderTargetMemory=function(Z){let fa=!1;if(g.isSome(this._overlayRenderTarget))for(const ja of this._overlayRenderTarget.renderTargets)fa=this._overlayRenderTarget.validateUsageForTarget(this.overlays[0].validTargets[ja.type]||!this.overlays[1].validTargets[ja.type],ja,Z)||fa;return fa};ba.ensureDrapeTargets=function(Z){g.isSome(this._overlays)&&this._overlays.forEach(fa=>{fa.hasTargetWithoutRasterImage=d.someSet(Z,ja=>ja.drapeTargetType===
u.DrapeTargetType.WithoutRasterImage)})};ba.ensureDrapeSources=function(Z){g.isSome(this._overlays)&&this._overlays.forEach(fa=>{fa.hasDrapedFeatureSource=d.someSet(Z,ja=>ja.drapeSourceType===u.DrapeSourceType.Features);fa.hasDrapedRasterSource=d.someSet(Z,ja=>ja.drapeSourceType===u.DrapeSourceType.RasterImage)})};ba.ensureOverlays=function(Z,fa){g.isNone(this._overlays)&&(this._overlayRenderTarget=new y.OverlayRenderTarget(this._rctx),this._overlays=[new A.Overlay(z.OverlayIndex.INNER,this._overlayRenderTarget),
new A.Overlay(z.OverlayIndex.OUTER,this._overlayRenderTarget)]);this.ensureDrapeTargets(Z);this.ensureDrapeSources(fa)};ba.disposeOverlays=function(){this._overlays=null;this._overlayRenderTarget=g.disposeMaybe(this._overlayRenderTarget);this.events.emit("textures-disposed")};ba.runTask=function(Z,fa=()=>!0){this._frameTask.processQueue(Z);Z.done||this._processDrapeSources(Z,fa)};ba._processDrapeSources=function(Z,fa){let ja=!1;for(const [oa,sa]of this._drapeSourceRenderers){if(Z.done)break;(oa.destroyed||
fa(oa))&&sa.commitChanges()&&(ja=!0,Z.madeProgress())}this._updateSortedDrapeSourceRenderers();ja&&(g.isSome(this._overlays)&&0===this._drapeSourceRenderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())};ba.processSyncDrapeSources=function(){this._processDrapeSources(R.noBudget,Z=>Z.updatePolicy===F.UpdatePolicy.SYNC)};ba.isEmpty=function(){if(C.OVERLAY_DRAW_DEBUG_TEXTURE)return!1;
for(const Z of this._drapeSourceRenderers.values())if(!Z.isEmpty)return!1;return!0};ba.updateAnimation=function(Z){let fa=!1;this._drapeSourceRenderers.forEach(ja=>fa=ja.updateAnimation(Z)||fa);return fa};ba.updateDrapeSourceOrder=function(){this._sortedDrapeSourceRenderersDirty=!0};ba.drawTarget=function(Z,fa,ja){const oa=Z.canvasGeometries;if(0===oa.numViews)return!1;this._screenToWorldRatio=ja*Z.mapUnitsPerPixel;const sa=fa.renderPass;if(this.isEmpty()||sa===J.RenderPass.MATERIAL_HIGHLIGHT&&!this.hasHighlights||
sa===J.RenderPass.MATERIAL_NORMAL&&!this.hasWater||!Z.hasSomeSizedView())return!1;const qa=fa.fbo;if(!qa.isValid())return!1;const Ha=2*Z.resolution,Ga=Z.resolution;qa.resize(Ha,Ga);const pa=this._rctx;ka.pixelRatio=Z.pixelRatio*ja;this._renderContext.pass=sa;this._bindParameters.screenToWorldRatio=this._screenToWorldRatio;this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio;this._bindParameters.slot=sa===J.RenderPass.MATERIAL_NORMAL?H.RenderSlot.DRAPED_WATER:H.RenderSlot.DRAPED_MATERIAL;
Z.applyViewport(this._rctx);qa.bind(pa);Z.index===z.OverlayIndex.INNER&&(pa.setClearColor(0,0,0,0),pa.clearSafe(V.ClearBufferBit.COLOR_BUFFER_BIT));const Da=fa.type===z.RenderTargetType.ColorNoRasterImage?a.DrawPassOption.ExcludeRasterImage:fa.type===z.RenderTargetType.Occluded?a.DrawPassOption.OccludedOnly:a.DrawPassOption.Normal;Da===a.DrawPassOption.OccludedOnly&&(this._renderContext.renderOccludedMask=la);if(C.OVERLAY_DRAW_DEBUG_TEXTURE&&Da!==a.DrawPassOption.OccludedOnly)for(fa=0;fa<oa.numViews;fa++)this._setViewParameters(oa.extents[fa],
Z,ka),this._drawDebugTexture(Z.resolution,ia[Z.index]);0<this._drapeSourceRenderers.size&&this._sortedDrapeSourceRenderers.forAll(({drapeSource:ra,renderer:Ea})=>{if(Da!==a.DrawPassOption.ExcludeRasterImage||ra.drapeSourceType!==u.DrapeSourceType.RasterImage){({fullOpacity:ra}=ra);var Ia=g.isSome(ra)&&1>ra&&sa===J.RenderPass.MATERIAL;Ia&&(this.bindTemporaryFramebuffer(this._rctx,Ha,Ga),pa.clearSafe(V.ClearBufferBit.COLOR_BUFFER_BIT));for(let Ma=0;Ma<oa.numViews;Ma++)this._setViewParameters(oa.extents[Ma],
Z,ka),Ea.render(this._renderContext,this._bindParameters);Ia&&g.isSome(this._temporaryFBO)&&(qa.bind(pa),this.view._stage.renderView.compositingHelper.composite(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),W.AlphaMode.PremultipliedAlpha,ra,W.CompositingFunction.OverlayWithTransparency,Z.index))}});pa.bindFramebuffer(null);qa.generateMipMap();this._renderContext.resetRenderOccludedMask();return!0};ba.bindTemporaryFramebuffer=function(Z,fa,ja){g.isNone(this._temporaryFBO)&&(this._temporaryFBO=
new p.OverlayFramebufferObject(Z,!1));this._temporaryFBO.resize(fa,ja);this._temporaryFBO.bind(Z)};ba.reloadShaders=function(){var Z=b._asyncToGenerator(function*(){yield this._shaderTechniqueRepository.reloadAll()});return function(){return Z.apply(this,arguments)}}();ba.notifyContentChanged=function(){this.events.emit("content-changed")};ba.intersect=function(Z,fa,ja,oa){let sa=0;for(const Ha of this._drapeSourceRenderers.values()){var qa;sa=null!=(qa=null==Ha.intersect?void 0:Ha.intersect(Z,fa,
ja,oa,sa))?qa:sa}};ba._updateSortedDrapeSourceRenderers=function(){if(this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers.clear(),0!==this._drapeSourceRenderers.size)){var Z=this.view.map.allLayers;this._drapeSourceRenderers.forEach((fa,ja)=>{const oa=Z.indexOf(ja.layer);this._sortedDrapeSourceRenderers.push(new ha(ja,fa,0>oa?Infinity:oa))});this._sortedDrapeSourceRenderers.sort((fa,ja)=>fa.index-ja.index)}};ba._setViewParameters=function(Z,
fa,ja){ja.viewport[0]=ja.viewport[1]=0;ja.viewport[2]=ja.viewport[3]=fa.resolution;x.ortho(ja.projectionMatrix,0,Z[2]-Z[0],0,Z[3]-Z[1],ja.near,ja.far);x.fromTranslation(ja.viewMatrix,[-Z[0],-Z[1],0]);this._bindParameters.camera=ja};ba._updateHasWater=function(){const Z=n.someMap(this._drapeSourceRenderers,fa=>fa.hasWater);Z!==this._hasWater&&(this._hasWater=Z,this.events.emit("has-water",Z))};ba._updateHasHighlights=function(){const Z=n.someMap(this._drapeSourceRenderers,fa=>fa.hasHighlights);Z!==
this._hasHighlights&&(this._hasHighlights=Z,this.events.emit("has-highlights",Z))};ba._updateRendersOccluded=function(){const Z=n.someMap(this._drapeSourceRenderers,fa=>fa.rendersOccluded);Z!==this._rendersOccluded&&(this._rendersOccluded=Z,this.events.emit("renders-occluded",Z))};ba._drawDebugTexture=function(Z,fa){this._ensureDebugPatternResources(Z,Z);Z=this._rctx;const ja=Z.bindTechnique(this._debugTextureTechnique);ja.setUniform4f("uColor",fa[0],fa[1],fa[2],1);ja.bindTexture("tex",this._debugPatternTexture);
Z.bindVAO(this._quadVAO);Z.drawArrays(V.PrimitiveType.TRIANGLE_STRIP,0,ca.vertexCount(this._quadVAO,"geometry"))};ba._ensureDebugPatternResources=function(Z,fa){if(!this._debugPatternTexture){var ja=new Uint8Array(Z*fa*4),oa=0;for(let sa=0;sa<fa;sa++)for(let qa=0;qa<Z;qa++){const Ha=Math.floor(qa/10),Ga=Math.floor(sa/10);2>Ha||2>Ga||10*Ha>Z-20||10*Ga>fa-20?(ja[oa++]=255,ja[oa++]=255,ja[oa++]=255,ja[oa++]=255):(ja[oa++]=255,ja[oa++]=255,ja[oa++]=255,Ha&1&&Ga&1?ja[oa++]=qa&1^sa&1?0:255:ja[oa++]=Ha&
1^Ga&1?0:128)}this._debugPatternTexture=new da.Texture(this._rctx,{target:V.TextureType.TEXTURE_2D,pixelFormat:V.PixelFormat.RGBA,dataType:V.PixelType.UNSIGNED_BYTE,samplingMode:V.TextureSamplingMode.NEAREST,width:Z,height:fa},ja);Z=new T.TextureTechniqueConfiguration;Z.hasAlpha=!0;this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(S.TextureTechnique,Z);this._quadVAO=K.createQuadVAO(this._rctx)}};b._createClass(ea,[{key:"_bindParameters",get:function(){return this._renderContext.bindParameters}},
{key:"rctx",get:function(){return this._rctx}},{key:"materialRepository",get:function(){return this._materialRepository}},{key:"screenToWorldRatio",get:function(){return this._screenToWorldRatio}},{key:"localOriginFactory",get:function(){return this._localOriginFactory}},{key:"updating",get:function(){return this._sortedDrapeSourceRenderersDirty||this._frameTask.updating||n.someMap(this._drapeSourceRenderers,Z=>Z.updating)}},{key:"hasOverlays",get:function(){return g.isSome(this._overlays)&&g.isSome(this._overlayRenderTarget)}},
{key:"gpuMemoryUsage",get:function(){return g.isSome(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}},{key:"overlays",get:function(){return g.unwrapOr(this._overlays,[])}},{key:"running",get:function(){return this.updating}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return this._rendersOccluded}},{key:"test",get:function(){return{drapeSourceRenderers:this._drapeSourceRenderers,
getDrapeSourceRenderer:Z=>this._drapeSourceRenderers.get(Z)}}}]);return ea}(E.AutoDisposableMixin(m));c.__decorate([e.property()],a.OverlayRenderer.prototype,"_frameTask",void 0);c.__decorate([e.property()],a.OverlayRenderer.prototype,"_sortedDrapeSourceRenderersDirty",void 0);c.__decorate([E.autoDispose()],a.OverlayRenderer.prototype,"_shaderTechniqueRepository",void 0);c.__decorate([E.autoDispose()],a.OverlayRenderer.prototype,"_stippleTextureRepository",void 0);c.__decorate([e.property({constructOnly:!0})],
a.OverlayRenderer.prototype,"view",void 0);c.__decorate([e.property()],a.OverlayRenderer.prototype,"worldToPCSRatio",void 0);c.__decorate([e.property()],a.OverlayRenderer.prototype,"spatialReference",void 0);c.__decorate([e.property({type:Boolean,readOnly:!0})],a.OverlayRenderer.prototype,"updating",null);a.OverlayRenderer=c.__decorate([t.subclass("esri.views.3d.terrain.OverlayRenderer")],a.OverlayRenderer);a.DrawPassOption=void 0;(function(Y){Y[Y.Normal=0]="Normal";Y[Y.OccludedOnly=1]="OccludedOnly";
Y[Y.ExcludeRasterImage=2]="ExcludeRasterImage"})(a.DrawPassOption||(a.DrawPassOption={}));let ha=function(Y,ea,ba){this.drapeSource=Y;this.renderer=ea;this.index=ba};const ia=[[1,.5,.5],[.5,.5,1]],ka=new G.Camera;ka.near=1;ka.far=1E4;ka.relativeElevation=null;const la=M.RenderOccludedFlag.OccludeAndTransparent;a.DRAPED_Z=-2;a.overlayRenderOccludedFlag=la;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/interfaces":function(){define(["exports"],
function(a){a.DrapeSourceType=void 0;(function(b){b[b.RasterImage=0]="RasterImage";b[b.Features=1]="Features"})(a.DrapeSourceType||(a.DrapeSourceType={}));a.DrapeTargetType=void 0;(function(b){b[b.WithRasterImage=0]="WithRasterImage";b[b.WithoutRasterImage=1]="WithoutRasterImage"})(a.DrapeTargetType||(a.DrapeTargetType={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/interfaces":function(){define(["exports"],function(a){a.OverlayIndex=
void 0;(function(b){b[b.INNER=0]="INNER";b[b.OUTER=1]="OUTER"})(a.OverlayIndex||(a.OverlayIndex={}));a.PatchType=void 0;(function(b){b[b.REGULAR=0]="REGULAR";b[b.HAS_NORTH_POLE=1]="HAS_NORTH_POLE";b[b.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE";b[b.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"})(a.PatchType||(a.PatchType={}));a.NeighborIndex=void 0;(function(b){b[b.NORTH=0]="NORTH";b[b.NORTH_EAST=1]="NORTH_EAST";b[b.EAST=2]="EAST";b[b.SOUTH_EAST=3]="SOUTH_EAST";b[b.SOUTH=4]="SOUTH";b[b.SOUTH_WEST=5]="SOUTH_WEST";b[b.WEST=
6]="WEST";b[b.NORTH_WEST=7]="NORTH_WEST"})(a.NeighborIndex||(a.NeighborIndex={}));a.LODSnapping=void 0;(function(b){b[b.OFF=0]="OFF";b[b.ON=1]="ON"})(a.LODSnapping||(a.LODSnapping={}));a.RenderTargetType=void 0;(function(b){b[b.Color=0]="Color";b[b.ColorNoRasterImage=1]="ColorNoRasterImage";b[b.Highlight=2]="Highlight";b[b.Water=3]="Water";b[b.Occluded=4]="Occluded"})(a.RenderTargetType||(a.RenderTargetType={}));a.TextureUpdate=void 0;(function(b){b[b.FADING=0]="FADING";b[b.IMMEDIATE=1]="IMMEDIATE";
b[b.UNFADED=2]="UNFADED"})(a.TextureUpdate||(a.TextureUpdate={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/Overlay":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../geometry/support/aaBoundingRect ./interfaces ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/LocalOriginFactory".split(" "),function(a,b,c,m,l,r,n){a.OverlaySource=void 0;(function(f){f[f.None=0]="None";
f[f.ColorAndWater=1]="ColorAndWater";f[f.Highlight=2]="Highlight";f[f.Occluded=3]="Occluded"})(a.OverlaySource||(a.OverlaySource={}));let g=function(){function f(e,h){this.index=e;this.renderTargets=h;this._extent=m.create();this.resolution=0;this.renderLocalOrigin=n.fromValues(0,0,0,"O");this.mapUnitsPerPixel=this.pixelRatio=1;this.canvasGeometries=new k;this.validTargets=null;this.hasTargetWithoutRasterImage=this.hasDrapedRasterSource=this.hasDrapedFeatureSource=!1;this.index=e;this.validTargets=
Array(h.renderTargets.length).fill(!1)}var d=f.prototype;d.getValidTexture=function(e){return this.validTargets[e]?this.renderTargets.getTarget(e).getTexture():null};d.getColorTexture=function(e){return(e=e===a.OverlaySource.ColorAndWater?this.renderTargets.getTarget(l.RenderTargetType.Color):e===a.OverlaySource.Highlight?this.renderTargets.getTarget(l.RenderTargetType.Highlight):this.renderTargets.getTarget(l.RenderTargetType.Occluded))?e.getTexture():null};d.getColorTextureNoRasterImage=function(){return this._needsColorWithoutRasterImage?
this.getValidTexture(l.RenderTargetType.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(l.RenderTargetType.Color):null};d.getNormalTexture=function(e){return(e=e===a.OverlaySource.ColorAndWater?this.renderTargets.getTarget(l.RenderTargetType.Water):null)?e.getTexture():null};d.draw=function(e,h){const v=this.computeRenderTargetValidityBitfield();for(const w of this.renderTargets.renderTargets)this.validTargets[w.type]=w.type!==l.RenderTargetType.ColorNoRasterImage||this._needsColorWithoutRasterImage?
e.drawTarget(this,w,h):!1;e=this.computeRenderTargetValidityBitfield();return v^e?r.ValidationState.CHANGED:r.ValidationState.UNCHANGED};d.computeRenderTargetValidityBitfield=function(){const e=this.validTargets;return+e[l.RenderTargetType.Color]|+e[l.RenderTargetType.ColorNoRasterImage]<<1|+e[l.RenderTargetType.Highlight]<<2|+e[l.RenderTargetType.Water]<<3|+e[l.RenderTargetType.Occluded]<<4};d.setupGeometryViewsCyclical=function(e){this.setupGeometryViewsDirect();var h=.001*e.range;if(this._extent[0]-
h<=e.min){const v=this.canvasGeometries.extents[this.canvasGeometries.numViews++];m.offset(this._extent,e.range,0,v)}this._extent[2]+h>=e.max&&(h=this.canvasGeometries.extents[this.canvasGeometries.numViews++],m.offset(this._extent,-e.range,0,h))};d.setupGeometryViewsDirect=function(){this.canvasGeometries.numViews=1;m.copy(this.canvasGeometries.extents[0],this._extent)};d.hasSomeSizedView=function(){for(let e=0;e<this.canvasGeometries.numViews;e++){const h=this.canvasGeometries.extents[e];if(h[0]!==
h[2]&&h[1]!==h[3])return!0}return!1};d.applyViewport=function(e){e.setViewport(this.index===l.OverlayIndex.INNER?0:this.resolution,0,this.resolution,this.resolution)};b._createClass(f,[{key:"extent",get:function(){return this._extent}},{key:"_needsColorWithoutRasterImage",get:function(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}}]);return f}(),k=function(){this.extents=[m.create(),m.create(),m.create()];this.numViews=0};a.Overlay=g;a.computeOverlayResolution=
function(f,d,e){return Math.min(c.nextHighestPowerOfTwo(Math.max(f,d)+256),e)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/LocalOriginFactory":function(){define(["exports","../../../../chunks/vec3f64"],function(a,b){let c=function(m,l){this.vec3=m;this.id=l};a.LocalOrigin=c;a.fromValues=function(m,l,r,n){return new c(b.fromValues(m,l,r),n)};a.fromVector=function(m,l){return new c(b.clone(m),l)};Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/OverlayFramebufferObject":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/vec2f32 ../../webgl/enums ../../webgl/FramebufferObject".split(" "),function(a,b,c,m,l,r){let n=function(){function g(f,d){this.size=m.create();this._fbo=null;this._fbo=new r.FramebufferObject(f,{colorTarget:l.TargetType.TEXTURE,depthStencilTarget:l.DepthStencilTargetType.NONE},{target:l.TextureType.TEXTURE_2D,
pixelFormat:l.PixelFormat.RGBA,dataType:l.PixelType.UNSIGNED_BYTE,wrapMode:l.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:l.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,hasMipmap:d,maxAnisotropy:8,width:0,height:0})}var k=g.prototype;k.dispose=function(){this._fbo=c.disposeMaybe(this._fbo)};k.getTexture=function(){return this._fbo?this._fbo.colorTexture:null};k.isValid=function(){return null!==this._fbo};k.resize=function(f,d){this.size[0]=f;this.size[1]=d;this._fbo.resize(this.size[0],this.size[1])};k.bind=
function(f){f.bindFramebuffer(this._fbo)};k.generateMipMap=function(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()};k.disposeRenderTargetMemory=function(){var f;null==(f=this._fbo)?void 0:f.resize(0,0)};b._createClass(g,[{key:"gpuMemoryUsage",get:function(){var f,d;return null!=(f=null==(d=this._fbo)?void 0:d.gpuMemoryUsage)?f:0}}]);return g}();a.OverlayFramebufferObject=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/terrain/OverlayRenderTarget":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./interfaces","./OverlayFramebufferObject","../webgl-engine/lib/RenderPass"],function(a,b,c,m,l){let r=function(){function n(k){const f=(d,e,h=!0)=>({type:e,fbo:new m.OverlayFramebufferObject(k,h),renderPass:d,valid:!1,lastUsed:Infinity});this.renderTargets=[f(l.RenderPass.MATERIAL,c.RenderTargetType.Color),f(l.RenderPass.MATERIAL,c.RenderTargetType.ColorNoRasterImage),f(l.RenderPass.MATERIAL_HIGHLIGHT,
c.RenderTargetType.Highlight,!1),f(l.RenderPass.MATERIAL_NORMAL,c.RenderTargetType.Water),f(l.RenderPass.MATERIAL,c.RenderTargetType.Occluded)]}var g=n.prototype;g.getTarget=function(k){return this.renderTargets[k].fbo};g.dispose=function(){for(const k of this.renderTargets)k.fbo.dispose()};g.disposeRenderTargetMemory=function(){for(const k of this.renderTargets)k.fbo.disposeRenderTargetMemory()};g.validateUsageForTarget=function(k,f,d){if(k)f.lastUsed=d;else if(1E3<d-f.lastUsed)f.fbo.disposeRenderTargetMemory(),
f.lastUsed=Infinity;else if(Infinity>f.lastUsed)return!0;return!1};b._createClass(n,[{key:"gpuMemoryUsage",get:function(){return this.renderTargets.reduce((k,f)=>k+f.fbo.gpuMemoryUsage,0)}}]);return n}();a.OverlayRenderTarget=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueRepository":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe",
"../../../../../core/NestedMap"],function(a,b,c,m){let l=function(){function n(k){this._context=k;this._perConstructorInstances=new m.NestedMap;this._frameCounter=0;this._keepAliveFrameCount=-1}var g=n.prototype;g.dispose=function(){this._perConstructorInstances.forEach(k=>k.forEach(f=>f.technique.destroy()));this._perConstructorInstances.clear()};g.acquire=function(k,f){const d=f.key;let e=this._perConstructorInstances.get(k,d);if(c.isNone(e)){const h=new k(this._context,f,()=>this.release(h));e=
new r(h);this._perConstructorInstances.set(k,d,e)}++e.refCount;return e.technique};g.releaseAndAcquire=function(k,f,d){if(c.isSome(d)){if(f.key===d.key)return d;this.release(d)}return this.acquire(k,f)};g.release=function(k){c.isNone(k)||this._perConstructorInstances.empty||(k=this._perConstructorInstances.get(k.constructor,k.key),c.isNone(k)||(--k.refCount,0===k.refCount&&(k.refZeroFrame=this._frameCounter)))};g.frameUpdate=function(){this._frameCounter++;-1!==this._keepAliveFrameCount&&this._perConstructorInstances.forEach((k,
f)=>{k.forEach((d,e)=>{0===d.refCount&&d.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(d.technique.destroy(),this._perConstructorInstances.delete(f,e))})})};g.reloadAll=function(){var k=b._asyncToGenerator(function*(){var f=this;const d=[];this._perConstructorInstances.forEach((e,h)=>{const v=function(){var w=b._asyncToGenerator(function*(t,x){if(x=x.shader)yield x.reload(),t.forEach(B=>{B.technique.reload(f._context)})});return function(t,x){return w.apply(this,arguments)}}();d.push(v(e,
h))});yield Promise.all(d)});return function(){return k.apply(this,arguments)}}();b._createClass(n,[{key:"viewingMode",get:function(){return this._context.viewingMode}},{key:"constructionContext",get:function(){return this._context}}]);return n}(),r=function(n){this.technique=n;this.refZeroFrame=this.refCount=0};a.ShaderTechniqueRepository=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/NestedMap":function(){define(["exports","../chunks/_rollupPluginBabelHelpers"],
function(a,b){let c=function(){function m(){this._outer=new Map}var l=m.prototype;l.clear=function(){this._outer.clear()};l.get=function(r,n){var g;return null==(g=this._outer.get(r))?void 0:g.get(n)};l.set=function(r,n,g){const k=this._outer.get(r);k?k.set(n,g):this._outer.set(r,new Map([[n,g]]))};l.delete=function(r,n){const g=this._outer.get(r);g&&(g.delete(n),0===g.size&&this._outer.delete(r))};l.forEach=function(r){this._outer.forEach((n,g)=>r(n,g))};b._createClass(m,[{key:"empty",get:function(){return 0===
this._outer.size}}]);return m}();a.NestedMap=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/AutoDisposable":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){const c=l=>function(r){function n(){var g=r.apply(this,arguments)||this;g._isDisposed=!1;return g}b._inheritsLoose(n,r);n.prototype.dispose=function(){for(const k of null!=(g=this._managedDisposables)?g:[]){var g;g=this[k];
this[k]=null;g&&"function"===typeof g.dispose&&g.dispose()}this._isDisposed=!0};b._createClass(n,[{key:"isDisposed",get:function(){return this._isDisposed}}]);return n}(l);let m=function(l){function r(){return l.apply(this,arguments)||this}b._inheritsLoose(r,l);return r}(c(function(){return function(){}}()));a.AutoDisposable=m;a.AutoDisposableMixin=c;a.autoDispose=function(){return(l,r)=>{if(!l.hasOwnProperty("_managedDisposables")){var n,g;l._managedDisposables=null!=(n=null==(g=l._managedDisposables)?
void 0:g.slice())?n:[]}l._managedDisposables.unshift(r)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/GLMaterialRepository":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/maybe ../../../../core/NestedMap ./Util".split(" "),function(a,b,c,m,l,r){const n=c.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository");c=function(){function k(d,e,h,v){this._textureRepository=
d;this._techniqueRepository=e;this.materialChanged=h;this.requestRender=v;this._id2glMaterialRef=new l.NestedMap}var f=k.prototype;f.dispose=function(){this._textureRepository.dispose()};f.acquire=function(d,e){this._ownMaterial(d);var h=this._id2glMaterialRef.get(e,d.id);m.isNone(h)&&(h=d.createGLMaterial({material:d,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:e}),h=new g(h),this._id2glMaterialRef.set(e,d.id,h));h.ref();return h.glMaterial};f.release=function(d,
e){const h=this._id2glMaterialRef.get(e,d.id);m.isSome(h)&&(h.unref(),h.referenced||(m.disposeMaybe(h.glMaterial),this._id2glMaterialRef.delete(e,d.id)))};f._ownMaterial=function(d){m.isSome(d.repository)&&d.repository!==this&&n.error("Material is already owned by a different material repository");d.repository=this};return k}();let g=function(){function k(d){this.glMaterial=d;this.refCnt=0}var f=k.prototype;f.ref=function(){++this.refCnt};f.unref=function(){--this.refCnt;r.assert(0<=this.refCnt)};
b._createClass(k,[{key:"referenced",get:function(){return 0<this.refCnt}}]);return k}();a.GLMaterialRepository=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":function(){define("exports ../../../../core/maybe ../../../../core/uid ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ./basicInterfaces ./Geometry ./LocalOriginFactory ./Object3D ./testUtils ./VertexAttribute ./WebGLLayer ../materials/RibbonLineMaterial".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t){let x=function(){function q(C,z=125E4){this._originSR=C;this._gridSize=z;this._origins=new Map;this._objects=new Map;this._rootOriginId="root/"+c.generateUID()}var u=q.prototype;u.getOrigin=function(C){var z=this._origins.get(this._rootOriginId);if(null==z){z=h.gridLocalOriginFactory.rootOrigin;if(b.isSome(z))return this._origins.set(this._rootOriginId,d.fromValues(z[0],z[1],z[2],this._rootOriginId)),this.getOrigin(C);C=d.fromValues(C[0]+Math.random()-.5,
C[1]+Math.random()-.5,C[2]+Math.random()-.5,this._rootOriginId);this._origins.set(this._rootOriginId,C);return C}var A=this._gridSize;const p=Math.round(C[0]/A),y=Math.round(C[1]/A),D=Math.round(C[2]/A),E=`${p}/${y}/${D}`;let F=this._origins.get(E);const G=.5*A;l.subtract(B,C,z.vec3);B[0]=Math.abs(B[0]);B[1]=Math.abs(B[1]);B[2]=Math.abs(B[2]);if(B[0]<G&&B[1]<G&&B[2]<G)return F&&(A=Math.max(...B),l.subtract(B,C,F.vec3),B[0]=Math.abs(B[0]),B[1]=Math.abs(B[1]),B[2]=Math.abs(B[2]),Math.max(...B)<A)?F:
z;F||(F=d.fromValues(p*A,y*A,D*A,E),this._origins.set(E,F));return F};u._drawOriginBox=function(C,z=n.fromValues(1,1,0,1)){const A=window.view,p=A._stage;var y=z.toString();if(!this._objects.has(y)){this._material=new t.RibbonLineMaterial({width:2,color:z});p.add(this._material);z=new w.WebGLLayer({isPickable:!1});var D=new e.Object3D({castShadow:!1});p.add(D);z.add(D);p.add(z);this._objects.set(y,D)}y=this._objects.get(y);z=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0];D=z.length;const E=Array(3*D),F=
new Uint16Array(2*(D-1)),G=.5*this._gridSize;for(let P=0;P<D;P++)E[3*P]=C[0]+(z[P]&1?G:-G),E[3*P+1]=C[1]+(z[P]&2?G:-G),E[3*P+2]=C[2]+(z[P]&4?G:-G),0<P&&(F[2*P]=P-1,F[2*P+1]=P);g.projectBuffer(E,this._originSR,0,E,A.renderSpatialReference,0,D);C=new f.Geometry([[v.VertexAttribute.POSITION,{size:3,data:E,exclusive:!0}]],[[v.VertexAttribute.POSITION,F]],k.PrimitiveType.Line);p.add(C);y.addGeometry(C,this._material,m.IDENTITY)};return q}();const B=r.create();a.GridLocalOriginFactory=x;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/testUtils":function(){define(["exports"],function(a){a.gridLocalOriginFactory={rootOrigin:null};a.textTextureAtlas={orderedRepackingEnabled:!1};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/WebGLLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/PooledArray ./basicInterfaces ./ContentObject ./ContentObjectType ./DirtyEvents ./Octree".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){g=function(e){function h(w,t=""){var x,B,q;var u=e.call(this)||this;u.apiLayerUid=t;u.type=k.ContentObjectType.Layer;u.events=new c;u.isSliceable=!1;u._objects=new r;u._stageHandles=new m;u.apiLayerUid=t;u.isVisible=null!=(x=null==w?void 0:w.isVisible)?x:!0;u.isPickable=null!=(B=null==w?void 0:w.isPickable)?B:!0;u.updatePolicy=null!=(q=null==w?void 0:w.updatePolicy)?q:n.UpdatePolicy.ASYNC;return u}b._inheritsLoose(h,e);var v=h.prototype;v.destroy=function(){this.detachStage();
this._stage=null};v.attachStage=function(w){this.detachStage();this._stage=w;for(const t of f.DirtyEventNames)this._stageHandles.add(this.events.on(t,x=>w.handleEvent(t,x)))};v.detachStage=function(){this._stageHandles.removeAll();this.invalidateSpatialQueryAccelerator()};v.add=function(w){this._objects.push(w);w.parentLayer=this;this.events.emit("layerObjectAdded",{layer:this,object:w});l.isSome(this._octree)&&this._octree.add([w])};v.remove=function(w){this._objects.removeUnordered(w)&&(w.parentLayer=
null,this.events.emit("layerObjectRemoved",{layer:this,object:w}),l.isSome(this._octree)&&this._octree.remove([w]))};v.addMany=function(w){this._objects.pushArray(w);for(const t of w)t.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:w});l.isSome(this._octree)&&this._octree.add(w)};v.removeMany=function(w){const t=[];this._objects.removeUnorderedMany(w,w.length,t);if(0!==t.length){for(const x of t)x.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:t});
l.isSome(this._octree)&&this._octree.remove(t)}};v.sync=function(){l.isSome(this._stage)&&this.updatePolicy!==n.UpdatePolicy.SYNC&&this._stage.syncLayer(this.id)};v.notifyObjectBBChanged=function(w,t){l.isSome(this._octree)&&this._octree.update(w,t)};v.getSpatialQueryAccelerator=function(){l.isNone(this._octree)&&50<this._objects.length&&this._createOctree();return this._octree};v.shaderTransformationChanged=function(){this.invalidateSpatialQueryAccelerator();this.events.emit("shaderTransformationChanged",
this)};v.invalidateSpatialQueryAccelerator=function(){this._octree=l.destroyMaybe(this._octree)};v._createOctree=function(){this._octree=new d(w=>w.boundingVolumeWorldSpace.bounds);this._octree.add(this._objects.data,this._objects.length)};b._createClass(h,[{key:"objects",get:function(){return this._objects}}]);return h}(g.ContentObject);a.WebGLLayer=g;a.isWebGLLayer=function(e){return l.isSome(e)&&e.type===k.ContentObjectType.Layer};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/lib/DirtyEvents":function(){define(["exports"],function(a){a.DirtyEventNames="layerObjectAdded layerObjectRemoved layerObjectsAdded layerObjectsRemoved shaderTransformationChanged objectTransformation visibilityChanged occlusionChanged highlightChanged objectGeometryAdded objectGeometryRemoved vertexAttrsUpdated".split(" ");Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../chunks/sphere ./Util".split(" "),
function(a,b,c,m,l,r,n,g,k,f){function d(J,H,I){I[0]=J[0]+H;I[1]=J[1]+H;I[2]=J[2]+H}function e(J,H,I,O){if(1===H)J=I(J[0]),k.copy(J,O);else{y[0]=Infinity;y[1]=Infinity;y[2]=Infinity;D[0]=-Infinity;D[1]=-Infinity;D[2]=-Infinity;for(let U=0;U<H;U++){var Q=I(J[U]);if(t(Q[3])){var S=y,T=Q;S[0]=Math.min(S[0],T[0]-T[3]);S[1]=Math.min(S[1],T[1]-T[3]);S[2]=Math.min(S[2],T[2]-T[3]);S=D;S[0]=Math.max(S[0],Q[0]+Q[3]);S[1]=Math.max(S[1],Q[1]+Q[3]);S[2]=Math.max(S[2],Q[2]+Q[3])}}l.lerp(O,y,D,.5);O[3]=Math.max(D[0]-
y[0],D[1]-y[1],D[2]-y[2])/2}}function h(J,H,I){if(!M.length)for(var O=0;8>O;++O)M.push({index:0,distance:0});for(O=0;8>O;++O){const Q=q[O];M.data[O].index=O;M.data[O].distance=w(J,H,Q)}M.sort((Q,S)=>Q.distance-S.distance);for(J=0;8>J;++J)I[J]=M.data[J].index}function v(J,H){let I=Infinity,O=null;for(let Q=0;8>Q;++Q){const S=w(J,H,u[Q]);S<I&&(I=S,O=u[Q])}return O}function w(J,H,I){return H*(J[0]*I[0]+J[1]*I[1]+J[2]*I[2])}function t(J){return!isNaN(J)&&-Infinity!==J&&Infinity!==J&&0<J}let x=function(){function J(I,
O){this._objectToBoundingSphere=I;this._maximumObjectsPerNode=10;this._maximumDepth=20;this._degenerateObjects=new Set;this._root=new B;this._objectCount=0;O&&(void 0!==O.maximumObjectsPerNode&&(this._maximumObjectsPerNode=O.maximumObjectsPerNode),void 0!==O.maximumDepth&&(this._maximumDepth=O.maximumDepth))}var H=J.prototype;H.destroy=function(){this._degenerateObjects.clear();B.clearPool();z[0]=null;E.prune();M.prune()};H.add=function(I,O=I.length){this._objectCount+=O;this._grow(I,O);const Q=B.acquire();
for(let S=0;S<O;S++){const T=I[S];this._isDegenerate(T)?this._degenerateObjects.add(T):(Q.init(this._root),this._add(T,Q))}B.release(Q)};H.remove=function(I,O=null){this._objectCount-=I.length;const Q=B.acquire();for(const S of I)I=b.isSome(O)?O:k.copy(this._objectToBoundingSphere(S),F),t(I[3])?(Q.init(this._root),this._remove(S,I,Q)):this._degenerateObjects.delete(S);B.release(Q);this._shrink()};H.update=function(I,O){if(t(O[3])||!this._isDegenerate(I))z[0]=I,I=z,this.remove(I,O),this.add(I)};H.forEachAlongRay=
function(I,O,Q){const S=g.wrap(I,O);this._forEachNode(this._root,T=>{if(!this._intersectsNode(S,T))return!1;T=T.node;T.terminals.forAll(U=>{this._intersectsObject(S,U)&&Q(U)});null!==T.residents&&T.residents.forAll(U=>{this._intersectsObject(S,U)&&Q(U)});return!0})};H.forEachAlongRayWithVerticalOffset=function(I,O,Q,S){const T=g.wrap(I,O);this._forEachNode(this._root,U=>{if(!this._intersectsNodeWithOffset(T,U,S))return!1;U=U.node;U.terminals.forAll(aa=>{this._intersectsObjectWithOffset(T,aa,S)&&Q(aa)});
null!==U.residents&&U.residents.forAll(aa=>{this._intersectsObjectWithOffset(T,aa,S)&&Q(aa)});return!0})};H.forEach=function(I){this._forEachNode(this._root,O=>{O=O.node;O.terminals.forAll(I);null!==O.residents&&O.residents.forAll(I);return!0});this._degenerateObjects.forEach(I)};H.forEachDegenerateObject=function(I){this._degenerateObjects.forEach(I)};H.findClosest=function(I,O,Q,S=()=>!0,T=Infinity){let U=Infinity,aa=Infinity,W=null;const R=v(I,O),V=da=>{--T;if(S(da)){var ca=this._objectToBoundingSphere(da);
if(n.intersectsSphere(Q,ca)){var ha=w(I,O,k.getCenter(ca)),ia=ha-ca[3];ca=ha+ca[3];ia<U&&(U=ia,aa=ca,W=da)}}};this._forEachNodeDepthOrdered(this._root,da=>{if(0>=T||!n.intersectsSphere(Q,da.bounds))return!1;l.scale(p,R,da.halfSize);l.add(p,p,da.bounds);if(w(I,O,p)>aa)return!1;da=da.node;da.terminals.forAll(ca=>V(ca));null!==da.residents&&da.residents.forAll(ca=>V(ca));return!0},I,O);return W};H.forEachInDepthRange=function(I,O,Q,S,T,U,aa){let W=-Infinity,R=Infinity;const V={setRange:ka=>{Q===J.DepthOrder.FRONT_TO_BACK?
(W=Math.max(W,ka.near),R=Math.min(R,ka.far)):(W=Math.max(W,-ka.far),R=Math.min(R,-ka.near))}};V.setRange(S);const da=w(O,Q,I),ca=v(O,Q),ha=v(O,-Q),ia=ka=>{if(aa(ka)){var la=this._objectToBoundingSphere(ka),Y=k.getCenter(la);Y=w(O,Q,Y)-da;var ea=Y+la[3];Y-la[3]>R||ea<W||!n.intersectsSphere(U,la)||T(ka,V)}};this._forEachNodeDepthOrdered(this._root,ka=>{if(!n.intersectsSphere(U,ka.bounds))return!1;l.scale(p,ca,ka.halfSize);l.add(p,p,ka.bounds);if(w(O,Q,p)-da>R)return!1;l.scale(p,ha,ka.halfSize);l.add(p,
p,ka.bounds);if(w(O,Q,p)-da<W)return!1;ka=ka.node;ka.terminals.forAll(la=>ia(la));null!==ka.residents&&ka.residents.forAll(la=>ia(la));return!0},O,Q)};H.forEachNode=function(I){this._forEachNode(this._root,O=>I(O.node,O.bounds,O.halfSize))};H.forEachNeighbor=function(I,O){const Q=k.getRadius(O),S=k.getCenter(O),T=U=>{const aa=this._objectToBoundingSphere(U);var W=k.getRadius(aa);W=Q+W;0>=l.squaredDistance(k.getCenter(aa),S)-W*W&&I(U)};this._forEachNode(this._root,U=>{var aa=k.getRadius(U.bounds);
aa=Q+aa;if(0<l.squaredDistance(k.getCenter(U.bounds),S)-aa*aa)return!1;U=U.node;U.terminals.forAll(W=>T(W));null!==U.residents&&U.residents.forAll(W=>T(W));return!0});this.forEachDegenerateObject(T)};H._intersectsNode=function(I,O){d(O.bounds,2*-O.halfSize,y);d(O.bounds,2*O.halfSize,D);return f.rayBoxTest(I.origin,I.direction,y,D)};H._intersectsNodeWithOffset=function(I,O,Q){d(O.bounds,2*-O.halfSize,y);d(O.bounds,2*O.halfSize,D);Q.applyToMinMax(y,D);return f.rayBoxTest(I.origin,I.direction,y,D)};
H._intersectsObject=function(I,O){O=this._objectToBoundingSphere(O);return 0<O[3]?k.intersectsRay(O,I):!0};H._intersectsObjectWithOffset=function(I,O,Q){O=this._objectToBoundingSphere(O);return 0<O[3]?k.intersectsRay(Q.applyToBoundingSphere(O),I):!0};H._forEachNode=function(I,O){I=B.acquire().init(I);const Q=[I];for(;0!==Q.length;){I=Q.pop();if(O(I)&&!I.isLeaf())for(let S=0;S<I.node.children.length;S++)I.node.children[S]&&Q.push(B.acquire().init(I).advance(S));B.release(I)}};H._forEachNodeDepthOrdered=
function(I,O,Q,S=J.DepthOrder.FRONT_TO_BACK){I=B.acquire().init(I);const T=[I];for(h(Q,S,L);0!==T.length;){I=T.pop();if(O(I)&&!I.isLeaf())for(Q=7;0<=Q;--Q)S=L[Q],I.node.children[S]&&T.push(B.acquire().init(I).advance(S));B.release(I)}};H._remove=function(I,O,Q){E.clear();O=Q.advanceTo(O,(S,T)=>{E.push(S.node);E.push(T)})?Q.node.terminals:Q.node.residents;O.removeUnordered(I);if(0===O.length)for(I=E.length-2;0<=I&&this._purge(E.data[I],E.data[I+1]);I-=2);};H._nodeIsEmpty=function(I){if(0!==I.terminals.length)return!1;
if(null!==I.residents)return 0===I.residents.length;for(let O=0;O<I.children.length;O++)if(I.children[O])return!1;return!0};H._purge=function(I,O){0<=O&&(I.children[O]=null);return this._nodeIsEmpty(I)?(null===I.residents&&(I.residents=new m({shrink:!0})),!0):!1};H._add=function(I,O){O.advanceTo(this._objectToBoundingSphere(I))?O.node.terminals.push(I):(O.node.residents.push(I),O.node.residents.length>this._maximumObjectsPerNode&&O.depth<this._maximumDepth&&this._split(O))};H._split=function(I){const O=
I.node.residents;I.node.residents=null;for(let Q=0;Q<O.length;Q++){const S=B.acquire().init(I);this._add(O.getItemAt(Q),S);B.release(S)}};H._grow=function(I,O){0!==O&&(e(I,O,Q=>this._objectToBoundingSphere(Q),G),t(G[3])&&!this._fitsInsideTree(G)&&(this._nodeIsEmpty(this._root.node)?(k.copy(G,this._root.bounds),this._root.halfSize=1.25*G[3]):(I=this._rootBoundsForRootAsSubNode(G),this._placingRootViolatesMaxDepth(I)?this._rebuildTree(G,I):this._growRootAsSubNode(I),B.release(I))))};H._rebuildTree=
function(I,O){l.copy(P,O.bounds);P[3]=O.halfSize;e([I,P],2,Q=>Q,K);I=B.acquire().init(this._root);this._root.initFrom(null,K,1.25*K[3]);this._forEachNode(I,Q=>{this.add(Q.node.terminals.data,Q.node.terminals.length);null!==Q.node.residents&&this.add(Q.node.residents.data,Q.node.residents.length);return!0});B.release(I)};H._placingRootViolatesMaxDepth=function(I){const O=Math.log(I.halfSize/this._root.halfSize)*Math.LOG2E;let Q=0;this._forEachNode(this._root,S=>{Q=Math.max(Q,S.depth);return Q+O<=this._maximumDepth});
return Q+O>this._maximumDepth};H._rootBoundsForRootAsSubNode=function(I){var O=I[3];let Q=-Infinity;const S=this._root.bounds,T=this._root.halfSize;for(var U=0;3>U;U++){var aa=Math.max(0,Math.ceil((S[U]-T-(I[U]-O))/(2*T)));const W=Math.max(0,Math.ceil((I[U]+O-(S[U]+T))/(2*T)))+1;Q=Math.max(Q,2**Math.ceil(Math.log(aa+W)*Math.LOG2E));N[U].min=aa;N[U].max=W}for(I=0;3>I;I++)O=N[I].min,U=N[I].max,aa=(Q-(O+U))/2,O+=Math.ceil(aa),U+=Math.floor(aa),A[I]=S[I]-T-O*T*2+(U+O)*T;A[3]=Q*T*C;return B.acquire().initFrom(null,
A,Q*T,0)};H._growRootAsSubNode=function(I){const O=this._root.node;l.copy(G,this._root.bounds);G[3]=this._root.halfSize;this._root.init(I);I.advanceTo(G,null,!0);I.node.children=O.children;I.node.residents=O.residents;I.node.terminals=O.terminals};H._shrink=function(){for(;;){const I=this._findShrinkIndex();if(-1===I)break;this._root.advance(I);this._root.depth=0}};H._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let I=null;const O=this._root.node.children;
let Q=0,S=0;for(;S<O.length&&null==I;)Q=S++,I=O[Q];for(;S<O.length;)if(O[S++])return-1;return Q};H._isDegenerate=function(I){I=this._objectToBoundingSphere(I)[3];return!t(I)};H._fitsInsideTree=function(I){const O=this._root.bounds,Q=this._root.halfSize;return I[3]<=Q&&I[0]>=O[0]-Q&&I[0]<=O[0]+Q&&I[1]>=O[1]-Q&&I[1]<=O[1]+Q&&I[2]>=O[2]-Q&&I[2]<=O[2]+Q};a._createClass(J,[{key:"bounds",get:function(){return this._root.bounds}},{key:"halfSize",get:function(){return this._root.halfSize}},{key:"root",get:function(){return this._root.node}},
{key:"maximumObjectsPerNode",get:function(){return this._maximumObjectsPerNode}},{key:"maximumDepth",get:function(){return this._maximumDepth}},{key:"objectCount",get:function(){return this._objectCount}}]);return J}(),B=function(){function J(){this.bounds=k.create();this.halfSize=0;this.initFrom(null,null,0,0)}var H=J.prototype;H.init=function(I){return this.initFrom(I.node,I.bounds,I.halfSize,I.depth)};H.initFrom=function(I,O,Q,S=this.depth){this.node=b.isSome(I)?I:J.createEmptyNode();b.isSome(O)&&
k.copy(O,this.bounds);this.halfSize=Q;this.depth=S;return this};H.advance=function(I){let O=this.node.children[I];O||(O=J.createEmptyNode(),this.node.children[I]=O);this.node=O;this.halfSize/=2;this.depth++;I=q[I];this.bounds[0]+=I[0]*this.halfSize;this.bounds[1]+=I[1]*this.halfSize;this.bounds[2]+=I[2]*this.halfSize;this.bounds[3]=this.halfSize*C;return this};H.advanceTo=function(I,O,Q=!1){for(;;){if(this.isTerminalFor(I))return O&&O(this,-1),!0;if(this.isLeaf()){if(!Q)return O&&O(this,-1),!1;this.node.residents=
null}const S=this._childIndex(I);O&&O(this,S);this.advance(S)}};H.isLeaf=function(){return null!=this.node.residents};H.isTerminalFor=function(I){return I[3]>this.halfSize/2};H._childIndex=function(I){const O=this.bounds;return(O[0]<I[0]?1:0)+(O[1]<I[1]?2:0)+(O[2]<I[2]?4:0)};J.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new m({shrink:!0}),residents:new m({shrink:!0})}};J.acquire=function(){return J._pool.acquire()};J.release=function(I){J._pool.release(I)};
J.clearPool=function(){J._pool.prune()};return J}();B._pool=new c(B);(function(J){J=J.DepthOrder||(J.DepthOrder={});J[J.FRONT_TO_BACK=1]="FRONT_TO_BACK";J[J.BACK_TO_FRONT=-1]="BACK_TO_FRONT"})(x||(x={}));const q=[r.fromValues(-1,-1,-1),r.fromValues(1,-1,-1),r.fromValues(-1,1,-1),r.fromValues(1,1,-1),r.fromValues(-1,-1,1),r.fromValues(1,-1,1),r.fromValues(-1,1,1),r.fromValues(1,1,1)],u=[r.fromValues(-1,-1,-1),r.fromValues(-1,-1,1),r.fromValues(-1,1,-1),r.fromValues(-1,1,1),r.fromValues(1,-1,-1),r.fromValues(1,
-1,1),r.fromValues(1,1,-1),r.fromValues(1,1,1)],C=Math.sqrt(3),z=[null],A=k.create(),p=r.create(),y=r.create(),D=r.create(),E=new m,F=k.create(),G=k.create(),P=k.create(),K=k.create(),N=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],M=new m,L=[0,0,0,0,0,0,0,0];return x})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../lib/geometryDataUtils ../lib/GLMaterial ../lib/GLMaterials ../lib/Material ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./VisualVariablePassParameters ./renderers/utils ../../../../chunks/RibbonLine.glsl ../shaders/RibbonLineTechnique ../shaders/RibbonLineTechniqueConfiguration".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E){function F(ba,Z,fa,ja,oa){for(let sa=0;sa<oa;sa++)fa[ja++]=ba[Z++];return ja}function G(ba,Z,fa){Z=Z.get(z.VertexAttribute.POSITION).data;fa=fa?fa.get(z.VertexAttribute.POSITION):null;return ba.isClosed?fa?2<fa.length:6<Z.length:!1}const P=c.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");var K;(function(ba){ba[ba.LEFT_JOIN_START=-2]="LEFT_JOIN_START";ba[ba.LEFT_JOIN_END=-1]="LEFT_JOIN_END";ba[ba.LEFT_CAP_START=-4]=
"LEFT_CAP_START";ba[ba.LEFT_CAP_END=-5]="LEFT_CAP_END";ba[ba.RIGHT_JOIN_START=2]="RIGHT_JOIN_START";ba[ba.RIGHT_JOIN_END=1]="RIGHT_JOIN_END";ba[ba.RIGHT_CAP_START=4]="RIGHT_CAP_START";ba[ba.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(K||(K={}));c=function(ba){function Z(ja){ja=ba.call(this,ja,new M)||this;ja._vertexAttributeLocations=D.ribbonVertexAttributeLocations;ja.techniqueConfig=new E.RibbonLineTechniqueConfiguration;ja.layout=ja.createLayout();return ja}b._inheritsLoose(Z,ba);var fa=Z.prototype;fa.isClosed=
function(ja,oa){return this.parameters.isClosed?oa?2<oa.length:6<ja.length:!1};fa.getConfiguration=function(ja,oa){this.techniqueConfig.output=ja;this.techniqueConfig.draped=oa.slot===u.RenderSlot.DRAPED_MATERIAL;ja=l.isSome(this.parameters.stipplePattern)&&ja!==w.ShaderOutput.Highlight;this.techniqueConfig.stippleEnabled=ja;this.techniqueConfig.stippleOffColorEnabled=ja&&l.isSome(this.parameters.stippleOffColor);this.techniqueConfig.stippleScaleWithLineWidth=ja&&this.parameters.stippleScaleWithLineWidth;
this.techniqueConfig.stipplePreferContinuous=ja&&this.parameters.stipplePreferContinuous;this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane;this.techniqueConfig.hasOccludees=this.parameters.hasOccludees;this.techniqueConfig.roundJoins="round"===this.parameters.join;this.techniqueConfig.capType=this.parameters.cap;this.techniqueConfig.hasPolygonOffset=this.parameters.hasPolygonOffset;this.techniqueConfig.writeDepth=this.parameters.writeDepth;this.techniqueConfig.vvColor=this.parameters.vvColorEnabled;
this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled;this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled;this.techniqueConfig.innerColorEnabled=0<this.parameters.innerWidth&&l.isSome(this.parameters.innerColor);this.techniqueConfig.falloffEnabled=0<this.parameters.falloff;this.techniqueConfig.occluder=this.parameters.renderOccluded===q.RenderOccludedFlag.OccludeAndTransparentStencil;this.techniqueConfig.transparencyPassType=oa.transparencyPassType;this.techniqueConfig.hasMultipassTerrain=
oa.multipassTerrain.enabled;this.techniqueConfig.cullAboveGround=oa.multipassTerrain.cullAboveGround;this.techniqueConfig.wireframe=this.parameters.wireframe;return this.techniqueConfig};fa.intersect=function(ja,oa,sa,qa,Ha,Ga,pa,Da,ra){l.isSome(ra)?this._intersectDrapedLineGeometry(ja,qa,ra,Ga,pa):this._intersectLineGeometry(ja,oa,sa,qa,pa)};fa._intersectDrapedLineGeometry=function(ja,oa,sa,qa,Ha){if(oa.options.selectionMode){oa=ja.vertexAttributes.get(z.VertexAttribute.POSITION).data;var Ga=ja.vertexAttributes.get(z.VertexAttribute.SIZE),
pa=this.parameters.width;this.parameters.vvSizeEnabled?(Ga=ja.vertexAttributes.get(z.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0],pa*=m.clamp(this.parameters.vvSizeOffset[0]+Ga*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])):Ga&&(pa*=Ga.data[0]);Ga=qa[0];qa=qa[1];ja=(pa/2+4)*ja.screenToWorldRatio;pa=Number.MAX_VALUE;var Da=0;for(let Qa=0;Qa<oa.length-5;Qa+=3){var ra=oa[Qa],Ea=oa[Qa+1],Ia=Ga-ra,Ma=qa-Ea;ra=oa[Qa+3]-ra;Ea=oa[Qa+4]-Ea;const wa=m.clamp((ra*
Ia+Ea*Ma)/(ra*ra+Ea*Ea),0,1);Ia=ra*wa-Ia;Ma=Ea*wa-Ma;Ma=Ia*Ia+Ma*Ma;Ma<pa&&(pa=Ma,Da=Qa/3)}pa<ja*ja&&Ha(sa.dist,sa.normal,Da,!1)}};fa._intersectLineGeometry=function(ja,oa,sa,qa,Ha){if(qa.options.selectionMode&&!p.isInstanceHidden(oa))if(C.isTranslationMatrix(sa)){var Ga=ja.vertexAttributes,pa=Ga.get(z.VertexAttribute.POSITION).data;oa=this.parameters.width;if(this.parameters.vvSizeEnabled){var Da=Ga.get(z.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0];oa*=m.clamp(this.parameters.vvSizeOffset[0]+Da*
this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else Ga.has(z.VertexAttribute.SIZE)&&(oa*=Ga.get(z.VertexAttribute.SIZE).data[0]);var ra=qa.camera,Ea=Q;n.copy(Ea,qa.point);Da=oa*ra.pixelRatio/2+4*ra.pixelRatio;g.set(ha[0],Ea[0]-Da,Ea[1]+Da,0);g.set(ha[1],Ea[0]+Da,Ea[1]+Da,0);g.set(ha[2],Ea[0]+Da,Ea[1]-Da,0);g.set(ha[3],Ea[0]-Da,Ea[1]-Da,0);for(oa=0;4>oa;oa++)if(!ra.unprojectFromRenderScreen(ha[oa],ia[oa]))return;h.fromPoints(ra.eye,ia[0],ia[1],ka);
h.fromPoints(ra.eye,ia[1],ia[2],la);h.fromPoints(ra.eye,ia[2],ia[3],Y);h.fromPoints(ra.eye,ia[3],ia[0],ea);var Ia=Number.MAX_VALUE;oa=0;ja=G(this.parameters,Ga,ja.indices)?pa.length-2:pa.length-5;for(Ga=0;Ga<ja;Ga+=3){J[0]=pa[Ga]+sa[12];J[1]=pa[Ga+1]+sa[13];J[2]=pa[Ga+2]+sa[14];var Ma=(Ga+3)%pa.length;H[0]=pa[Ma]+sa[12];H[1]=pa[Ma+1]+sa[13];H[2]=pa[Ma+2]+sa[14];if(!(0>h.signedDistance(ka,J)&&0>h.signedDistance(ka,H)||0>h.signedDistance(la,J)&&0>h.signedDistance(la,H)||0>h.signedDistance(Y,J)&&0>h.signedDistance(Y,
H)||0>h.signedDistance(ea,J)&&0>h.signedDistance(ea,H))){ra.projectToRenderScreen(J,S);ra.projectToRenderScreen(H,T);if(0>S[2]&&0<T[2])g.subtract(I,J,H),Ma=ra.frustum,Ma=-h.signedDistance(Ma[d.PlaneIndex.NEAR],J)/g.dot(I,h.normal(Ma[d.PlaneIndex.NEAR])),g.scale(I,I,Ma),g.add(J,J,I),ra.projectToRenderScreen(J,S);else if(0<S[2]&&0>T[2])g.subtract(I,H,J),Ma=ra.frustum,Ma=-h.signedDistance(Ma[d.PlaneIndex.NEAR],H)/g.dot(I,h.normal(Ma[d.PlaneIndex.NEAR])),g.scale(I,I,Ma),g.add(H,H,I),ra.projectToRenderScreen(H,
T);else if(0>S[2]&&0>T[2])continue;S[2]=0;T[2]=0;Ma=e.distance2(e.fromPoints(S,T,W),Ea);Ma<Ia&&(Ia=Ma,g.copy(U,J),g.copy(aa,H),oa=Ga/3)}}sa=qa.rayBegin;qa=qa.rayEnd;Ia<Da*Da&&(pa=Number.MAX_VALUE,e.closestLineSegmentPoint(e.fromPoints(U,aa,W),e.fromPoints(sa,qa,R),O)&&(g.subtract(O,O,sa),pa=g.length(O),g.scale(O,O,1/pa),pa/=g.distance(sa,qa)),Ha(pa,O,oa,!1))}else P.error("intersection assumes a translation-only matrix")};fa.computeAttachmentOrigin=function(ja,oa){const sa=ja.vertexAttributes;if(!sa)return null;
ja=ja.indices;const qa=sa.get(z.VertexAttribute.POSITION);return t.computeAttachmentOriginLines(qa,ja?ja.get(z.VertexAttribute.POSITION):null,ja&&G(this.parameters,sa,ja),oa)};fa.createLayout=function(){const ja=v.newLayout().vec3f(z.VertexAttribute.POSITION).f32(z.VertexAttribute.SUBDIVISIONFACTOR).vec2f(z.VertexAttribute.UV0).vec3f(z.VertexAttribute.AUXPOS1).vec3f(z.VertexAttribute.AUXPOS2);this.parameters.vvSizeEnabled?ja.f32(z.VertexAttribute.SIZEFEATUREATTRIBUTE):ja.f32(z.VertexAttribute.SIZE);
this.parameters.vvColorEnabled?ja.f32(z.VertexAttribute.COLORFEATUREATTRIBUTE):ja.vec4f(z.VertexAttribute.COLOR);this.parameters.vvOpacityEnabled&&ja.f32(z.VertexAttribute.OPACITYFEATUREATTRIBUTE);return ja};fa.createBufferWriter=function(){return new L(this.layout,this.parameters)};fa.requiresSlot=function(ja,oa){if(ja===u.RenderSlot.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===q.RenderOccludedFlag.OccludeAndTransparentStencil)return ja===u.RenderSlot.OPAQUE_MATERIAL||ja===u.RenderSlot.OCCLUDER_MATERIAL||
ja===u.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL;oa=B.outputFromPass(oa);return oa===w.ShaderOutput.Color||oa===w.ShaderOutput.Alpha?ja===(this.parameters.writeDepth?u.RenderSlot.TRANSPARENT_MATERIAL:u.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):ja===u.RenderSlot.OPAQUE_MATERIAL};fa.createGLMaterial=function(ja){return ja.output===w.ShaderOutput.Color||ja.output===w.ShaderOutput.Alpha||ja.output===w.ShaderOutput.Highlight||ja.output===w.ShaderOutput.Depth?new N(ja):null};fa.validateParameters=
function(ja){"miter"!==ja.join&&(ja.miterLimit=0)};return Z}(q.Material);let N=function(ba){function Z(){return ba.apply(this,arguments)||this}b._inheritsLoose(Z,ba);var fa=Z.prototype;fa._updateOccludeeState=function(ja){ja.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:ja.hasOccludees})};fa.beginSlot=function(ja){this._output!==w.ShaderOutput.Color&&this._output!==w.ShaderOutput.Alpha||this._updateOccludeeState(ja);return this.ensureTechnique(D.RibbonLineTechnique,
ja)};return Z}(x),M=function(ba){function Z(){var fa=ba.apply(this,arguments)||this;fa.width=0;fa.color=f.ONES;fa.join="miter";fa.cap=E.CapType.BUTT;fa.miterLimit=5;fa.writeDepth=!0;fa.hasPolygonOffset=!1;fa.stippleScaleWithLineWidth=!1;fa.stipplePreferContinuous=!0;fa.hasSlicePlane=!1;fa.vvFastUpdate=!1;fa.isClosed=!1;fa.falloff=0;fa.innerWidth=0;fa.hasOccludees=!1;fa.wireframe=!1;return fa}b._inheritsLoose(Z,ba);return Z}(A.VisualVariablePassParameters),L=function(){function ba(fa,ja){this.parameters=
ja;this.numJoinSubdivisions=0;this.vertexBufferLayout=fa;fa=ja.stipplePattern?1:0;switch(this.parameters.join){case "miter":case "bevel":this.numJoinSubdivisions=fa;break;case "round":this.numJoinSubdivisions=y.NUM_ROUND_JOIN_SUBDIVISIONS+fa}}var Z=ba.prototype;Z._isClosed=function(fa){return G(this.parameters,fa.vertexAttributes,fa.indices)};Z.allocate=function(fa){return this.vertexBufferLayout.createBuffer(fa)};Z.elementCount=function(fa){var ja=fa.indices.get(z.VertexAttribute.POSITION).length/
2+1;fa=this._isClosed(fa);ja=(fa?2:4)+((fa?ja:ja-1)-(fa?0:1))*(2*this.numJoinSubdivisions+4);ja+=2;this.parameters.wireframe&&(ja=2+4*(ja-2));return ja};Z.write=function(fa,ja,oa,sa){var qa;const Ha=V,Ga=da,pa=ca,Da=ja.vertexAttributes.get(z.VertexAttribute.POSITION).data;var ra=ja.indices&&ja.indices.get(z.VertexAttribute.POSITION);const Ea=null==(qa=ja.vertexAttributes.get(z.VertexAttribute.DISTANCETOSTART))?void 0:qa.data;ra&&ra.length!==2*(Da.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");
let Ia=1,Ma=0;this.parameters.vvSizeEnabled?Ma=ja.vertexAttributes.get(z.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0]:ja.vertexAttributes.has(z.VertexAttribute.SIZE)&&(Ia=ja.vertexAttributes.get(z.VertexAttribute.SIZE).data[0]);let Qa=[1,1,1,1],wa=0;this.parameters.vvColorEnabled?wa=ja.vertexAttributes.get(z.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:ja.vertexAttributes.has(z.VertexAttribute.COLOR)&&(Qa=ja.vertexAttributes.get(z.VertexAttribute.COLOR).data);let Ja=0;this.parameters.vvOpacityEnabled&&
(Ja=ja.vertexAttributes.get(z.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]);qa=Da.length/3;fa=fa.transformation;const Ta=new Float32Array(oa.buffer);ra=this.vertexBufferLayout.stride/4;let Xa=sa*ra;sa=Xa;let ma=0;const $a=Ea?(Ra,za,ya)=>ma=Ea[ya]:(Ra,za,ya)=>ma+=g.distance(Ra,za),xa=(Ra,za,ya,Na,Wa,bb,Aa)=>{Ta[Xa++]=za[0];Ta[Xa++]=za[1];Ta[Xa++]=za[2];Ta[Xa++]=Na;Ta[Xa++]=Aa;Ta[Xa++]=Wa;Ta[Xa++]=Ra[0];Ta[Xa++]=Ra[1];Ta[Xa++]=Ra[2];Ta[Xa++]=ya[0];Ta[Xa++]=ya[1];Ta[Xa++]=ya[2];this.parameters.vvSizeEnabled?
Ta[Xa++]=Ma:Ta[Xa++]=Ia;this.parameters.vvColorEnabled?Ta[Xa++]=wa:(Ra=Math.min(4*bb,Qa.length-4),Ta[Xa++]=Qa[Ra+0],Ta[Xa++]=Qa[Ra+1],Ta[Xa++]=Qa[Ra+2],Ta[Xa++]=Qa[Ra+3]);this.parameters.vvOpacityEnabled&&(Ta[Xa++]=Ja)};Xa+=ra;g.set(Ga,Da[0],Da[1],Da[2]);fa&&g.transformMat4(Ga,Ga,fa);if(ja=this._isClosed(ja)){var Ka=Da.length-3;g.set(Ha,Da[Ka],Da[Ka+1],Da[Ka+2]);fa&&g.transformMat4(Ha,Ha,fa)}else g.set(pa,Da[3],Da[4],Da[5]),fa&&g.transformMat4(pa,pa,fa),xa(Ga,Ga,pa,1,K.LEFT_CAP_START,0,0),xa(Ga,Ga,
pa,1,K.RIGHT_CAP_START,0,0),g.copy(Ha,Ga),g.copy(Ga,pa);Ka=ja?0:1;const Oa=ja?qa:qa-1;for(let Ra=Ka;Ra<Oa;Ra++){var Va=(Ra+1)%qa*3;g.set(pa,Da[Va+0],Da[Va+1],Da[Va+2]);fa&&g.transformMat4(pa,pa,fa);$a(Ha,Ga,Ra);xa(Ha,Ga,pa,0,K.LEFT_JOIN_END,Ra,ma);xa(Ha,Ga,pa,0,K.RIGHT_JOIN_END,Ra,ma);Va=this.numJoinSubdivisions;for(let za=0;za<Va;++za){const ya=(za+1)/(Va+1);xa(Ha,Ga,pa,ya,K.LEFT_JOIN_END,Ra,ma);xa(Ha,Ga,pa,ya,K.RIGHT_JOIN_END,Ra,ma)}xa(Ha,Ga,pa,1,K.LEFT_JOIN_START,Ra,ma);xa(Ha,Ga,pa,1,K.RIGHT_JOIN_START,
Ra,ma);g.copy(Ha,Ga);g.copy(Ga,pa)}ja?(g.set(pa,Da[3],Da[4],Da[5]),fa&&g.transformMat4(pa,pa,fa),ma=$a(Ha,Ga,Oa),xa(Ha,Ga,pa,0,K.LEFT_JOIN_END,Ka,ma),xa(Ha,Ga,pa,0,K.RIGHT_JOIN_END,Ka,ma)):(ma=$a(Ha,Ga,Oa),xa(Ha,Ga,Ga,0,K.LEFT_CAP_END,Oa,ma),xa(Ha,Ga,Ga,0,K.RIGHT_CAP_END,Oa,ma));F(Ta,sa+ra,Ta,sa,ra);Xa=F(Ta,Xa-ra,Ta,Xa,ra);this.parameters.wireframe&&this._addWireframeVertices(oa,sa,Xa,ra)};Z._addWireframeVertices=function(fa,ja,oa,sa){const qa=new Float32Array(fa.buffer,oa*Float32Array.BYTES_PER_ELEMENT);
fa=new Float32Array(fa.buffer,ja*Float32Array.BYTES_PER_ELEMENT,oa-ja);ja=0;for(oa=0;oa<fa.length-1;oa+=2*sa)ja=F(fa,oa,qa,ja,sa),ja=F(fa,oa+2*sa,qa,ja,sa),ja=F(fa,oa+1*sa,qa,ja,sa),ja=F(fa,oa+2*sa,qa,ja,sa),ja=F(fa,oa+1*sa,qa,ja,sa),ja=F(fa,oa+3*sa,qa,ja,sa)};return ba}();const J=k.create(),H=k.create(),I=k.create(),O=k.create(),Q=k.create(),S=r.createRenderScreenPointArray3(),T=r.createRenderScreenPointArray3(),U=k.create(),aa=k.create(),W=e.create(),R=e.create(),V=k.create(),da=k.create(),ca=k.create(),
ha=[r.createRenderScreenPointArray3(),r.createRenderScreenPointArray3(),r.createRenderScreenPointArray3(),r.createRenderScreenPointArray3()],ia=[k.create(),k.create(),k.create(),k.create()],ka=h.create(),la=h.create(),Y=h.create(),ea=h.create();a.Parameters=M;a.RibbonLineMaterial=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/GLMaterials":function(){define(["exports","../../../../core/maybe","../core/shaderLibrary/ShaderOutputOptions",
"./basicInterfaces","./RenderPass"],function(a,b,c,m,l){function r(g){switch(g){case l.RenderPass.MATERIAL:return c.ShaderOutput.Color;case l.RenderPass.MATERIAL_ALPHA:return c.ShaderOutput.Alpha;case l.RenderPass.MATERIAL_DEPTH:return c.ShaderOutput.Depth;case l.RenderPass.MATERIAL_NORMAL:return c.ShaderOutput.Normal;case l.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL:return c.ShaderOutput.Shadow;case l.RenderPass.MATERIAL_HIGHLIGHT:return c.ShaderOutput.Highlight;case l.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:return c.ShaderOutput.Shadow;
case l.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return c.ShaderOutput.Shadow}}let n=function(){function g(f,d){this._material=f;this._repository=d;this._map=new Map}var k=g.prototype;k.destroy=function(){this._map.forEach((f,d)=>{b.isSome(f)&&this._repository.release(this._material,r(d))})};k.load=function(f,d){this._map.has(d)||this._map.set(d,this._repository.acquire(this._material,r(d)));d=this._map.get(d);if(b.isSome(d)){if(d.ensureResources(f)===m.ResourceState.LOADED)return d;this._repository.requestRender()}return null};
return g}();a.GLMaterials=n;a.outputFromPass=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/RibbonLine.glsl":function(){define("exports ../core/maybe ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/basicInterfaces ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/RibbonLineTechniqueConfiguration".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C){function z(p){const y=new B.ShaderBuilder,D=p.hasMultipassTerrain&&(p.output===c.ShaderOutput.Color||p.output===c.ShaderOutput.Alpha);y.include(k.PiUtils);y.include(l.RibbonVertexPosition,p);y.include(n.LineStipple,p);p.output===c.ShaderOutput.Depth&&y.include(r.OutputDepth,p);e.addProjViewLocalOrigin(y,p);const {vertex:E,fragment:F}=y;E.uniforms.add([new x.Matrix4PassUniform("inverseProjectionMatrix",(J,H)=>H.camera.inverseProjectionMatrix),new h.Float2PassUniform("nearFar",
(J,H)=>H.camera.nearFar),new w.FloatPassUniform("miterLimit",J=>"miter"!==J.join?0:J.miterLimit),new v.Float4PassUniform("viewport",(J,H)=>H.camera.fullViewport)]);E.constants.add("LARGE_HALF_FLOAT","float",65500);y.attributes.add(u.VertexAttribute.POSITION,"vec3");y.attributes.add(u.VertexAttribute.SUBDIVISIONFACTOR,"float");y.attributes.add(u.VertexAttribute.UV0,"vec2");y.attributes.add(u.VertexAttribute.AUXPOS1,"vec3");y.attributes.add(u.VertexAttribute.AUXPOS2,"vec3");y.varyings.add("vColor",
"vec4");y.varyings.add("vpos","vec3");y.varyings.add("linearDepth","float");D&&y.varyings.add("depth","float");const G=p.capType===C.CapType.ROUND,P=p.stippleEnabled&&p.stippleScaleWithLineWidth||G;P&&y.varyings.add("vLineWidth","float");const K=p.stippleEnabled&&p.stippleScaleWithLineWidth;K&&y.varyings.add("vLineSizeInv","float");const N=p.innerColorEnabled||G;N&&y.varyings.add("vLineDistance","float");const M=p.stippleEnabled&&G,L=p.falloffEnabled||M;L&&y.varyings.add("vLineDistanceNorm","float");
G&&(y.varyings.add("vSegmentSDF","float"),y.varyings.add("vReverseSegmentSDF","float"));E.code.add(t.glsl`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`);E.code.add(t.glsl`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`);E.code.add(t.glsl`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${D?"depth \x3d pos.z;":""}
      linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `);E.uniforms.add(new w.FloatPassUniform("pixelRatio",(J,H)=>H.camera.pixelRatio));E.code.add(t.glsl`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${P?t.glsl`vLineWidth = lineWidth;`:""}
      ${K?t.glsl`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);

      clipAndTransform(pos, prev, next, isStartVertex);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);
  `);(p.stippleEnabled||G)&&E.code.add(t.glsl`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${G?t.glsl`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `);E.code.add(t.glsl`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`);p.roundJoins?E.code.add(t.glsl`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${p.stippleEnabled?t.glsl`min(1.0, subdivisionFactor * ${t.glsl.float(1.5)})`:t.glsl`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):E.code.add(t.glsl`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);E.code.add(t.glsl`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${p.capType!==C.CapType.BUTT?t.glsl`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `);E.code.add(t.glsl`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${L||N?t.glsl`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${N?t.glsl`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${L?t.glsl`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `);G&&E.code.add(t.glsl`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`);p.stippleEnabled&&(p.draped?E.uniforms.add(new w.FloatPassUniform("worldToScreenRatio",(J,H)=>1/H.screenToPCSRatio)):E.code.add(t.glsl`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),E.code.add(t.glsl`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),p.draped?E.code.add(t.glsl`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):E.code.add(t.glsl`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),E.code.add(t.glsl`
      float patternLength = ${p.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `));E.code.add(t.glsl`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${p.wireframe&&!p.draped?"pos.z -\x3d 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
    }
  }
  `);D&&y.include(g.multipassTerrainTest,p);y.include(m.SliceDraw,p);F.include(d.ColorConversion);F.code.add(t.glsl`
  void main() {
    discardBySlice(vpos);
    ${D?"terrainDepthTest(gl_FragCoord, depth);":""}
  `);p.wireframe?F.code.add(t.glsl`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(G&&F.code.add(t.glsl`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${t.glsl.float(f.symbolAlphaCutoff)}) {
        discard;
      }
    `),M?F.code.add(t.glsl`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${t.glsl.float(f.symbolAlphaCutoff)}, stippleCoverage);
      `):F.code.add(t.glsl`float stippleAlpha = getStippleAlpha();`),F.uniforms.add(new v.Float4PassUniform("intrinsicColor",J=>J.color)),F.code.add(t.glsl`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`),p.innerColorEnabled&&(F.uniforms.add(new v.Float4PassUniform("innerColor",J=>b.unwrapOr(J.innerColor,J.color))),F.uniforms.add(new w.FloatPassUniform("innerWidth",(J,H)=>J.innerWidth*H.camera.pixelRatio)),F.code.add(t.glsl`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),F.code.add(t.glsl`vec4 finalColor = blendStipple(color, stippleAlpha);`),p.falloffEnabled&&(F.uniforms.add(new w.FloatPassUniform("falloff",J=>J.falloff)),F.code.add(t.glsl`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)));F.code.add(t.glsl`
    if (finalColor.a < ${t.glsl.float(f.symbolAlphaCutoff)}) {
      discard;
    }

    ${p.output===c.ShaderOutput.Alpha?t.glsl`gl_FragColor = vec4(finalColor.a);`:""}
    ${p.output===c.ShaderOutput.Color?t.glsl`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${p.output===c.ShaderOutput.Color&&p.transparencyPassType===q.TransparencyPassType.Color?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
    ${p.output===c.ShaderOutput.Highlight?t.glsl`gl_FragColor = vec4(1.0);`:""}
    ${p.output===c.ShaderOutput.Depth?t.glsl`outputDepth(linearDepth);`:""}
  }
  `);return y}const A=Object.freeze(Object.defineProperty({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:1,build:z},Symbol.toStringTag,{value:"Module"}));a.NUM_ROUND_JOIN_SUBDIVISIONS=1;a.RibbonLine=A;a.build=z})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl":function(){define("exports ../../shaderModules/Float3PassUniform ../../shaderModules/Float4sPassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute ../../../materials/VisualVariablePassParameters".split(" "),
function(a,b,c,m,l,r,n,g){a.RibbonVertexPosition=function(k,f){const d=k.vertex;d.uniforms.add(new m.FloatPassUniform("intrinsicWidth",e=>e.width));f.vvSize?(k.attributes.add(n.VertexAttribute.SIZEFEATUREATTRIBUTE,"float"),d.uniforms.add(new b.Float3PassUniform("vvSizeMinSize",e=>e.vvSizeMinSize)),d.uniforms.add(new b.Float3PassUniform("vvSizeMaxSize",e=>e.vvSizeMaxSize)),d.uniforms.add(new b.Float3PassUniform("vvSizeOffset",e=>e.vvSizeOffset)),d.uniforms.add(new b.Float3PassUniform("vvSizeFactor",
e=>e.vvSizeFactor)),d.code.add(r.glsl`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(k.attributes.add(n.VertexAttribute.SIZE,"float"),d.code.add(r.glsl`float getSize(){
return intrinsicWidth * size;
}`));f.vvOpacity?(k.attributes.add(n.VertexAttribute.OPACITYFEATUREATTRIBUTE,"float"),d.constants.add("vvOpacityNumber","int",8),d.uniforms.add([new l.FloatsPassUniform("vvOpacityValues",e=>e.vvOpacityValues,8),new l.FloatsPassUniform("vvOpacityOpacities",e=>e.vvOpacityOpacities,8)]),d.code.add(r.glsl`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):d.code.add(r.glsl`vec4 applyOpacity( vec4 color ){
return color;
}`);f.vvColor?(k.attributes.add(n.VertexAttribute.COLORFEATUREATTRIBUTE,"float"),d.constants.add("vvColorNumber","int",g.vvColorNumber),d.uniforms.add(new l.FloatsPassUniform("vvColorValues",e=>e.vvColorValues,g.vvColorNumber)),d.uniforms.add(new c.Float4sPassUniform("vvColorColors",e=>e.vvColorColors,g.vvColorNumber)),d.code.add(r.glsl`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(k.attributes.add(n.VertexAttribute.COLOR,"vec4"),d.code.add(r.glsl`vec4 getColor(){
return applyOpacity(color);
}`))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl":function(){define(["exports","../ShaderOutputOptions","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,b,c,m){a.OutputDepth=function(l,r){l.fragment.include(c.RgbaFloatEncoding);r.output===b.ShaderOutput.Shadow?(l.extensions.add("GL_OES_standard_derivatives"),l.fragment.code.add(m.glsl`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 2.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`)):r.output===b.ShaderOutput.Depth&&l.fragment.code.add(m.glsl`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl":function(){define("exports ../util/RgbaFloatEncoding.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/FloatUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DUniform ../../../shaders/ensureColor4".split(" "),function(a,b,c,m,l,r,n,g,k){function f(e,
h){const v=!(h.draped&&h.stipplePreferContinuous),{vertex:w,fragment:t}=e;t.include(b.RgbaFloatEncoding);w.uniforms.add(new r.FloatUniform("stipplePatternPixelSize"));h.draped||(c.addCameraPosition(w,h),w.uniforms.add(new l.FloatPassUniform("worldToScreenPerDistanceRatio",(x,B)=>1/B.camera.perScreenPixelRatio)),w.code.add(n.glsl`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`));e.varyings.add("vStippleDistance","float");h.stippleRequiresClamp&&e.varyings.add("vStippleDistanceLimits","vec2");h.stippleRequiresStretchMeasure&&e.varyings.add("vStipplePatternStretch","float");w.code.add(n.glsl`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${d};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `);w.code.add(n.glsl`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`);w.code.add(n.glsl`
    if (segmentLengthPseudoScreen >= ${v?"patternLength":"1e4"}) {
  `);w.uniforms.add(new l.FloatPassUniform("pixelRatio",(x,B)=>B.camera.pixelRatio));w.code.add(n.glsl`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${h.stippleRequiresStretchMeasure?n.glsl`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `);t.uniforms.add(new g.Texture2DUniform("stipplePatternTexture"));t.uniforms.add(new r.FloatUniform("stipplePatternSDFNormalizer"));t.uniforms.add(new r.FloatUniform("stipplePatternTextureSize"));t.uniforms.add(new r.FloatUniform("stipplePatternPixelSizeInv"));t.code.add(n.glsl`float padTexture(float u) {
return (u * stipplePatternTextureSize + 1.0)/(stipplePatternTextureSize + 2.0);
}`);t.code.add(n.glsl`
    float getStippleSDF(out bool isClamped) {
      ${h.stippleRequiresClamp?n.glsl`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:n.glsl`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${h.stippleScaleWithLineWidth?n.glsl`u *= vLineSizeInv;`:""}
      u = padTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${h.stippleRequiresStretchMeasure?n.glsl`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:n.glsl`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${h.stippleScaleWithLineWidth?n.glsl`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:n.glsl`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `);h.stippleOffColorEnabled?(t.uniforms.add(new m.Float4PassUniform("stippleOffColor",x=>k.ensureColor4(x.stippleOffColor))),t.code.add(n.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):t.code.add(n.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}const d=n.glsl.float(.4);a.LineStipple=function(e,h){e.constants.add("stippleAlphaColorDiscard","float",.001);e.constants.add("stippleAlphaHighlightDiscard","float",.5);h.stippleEnabled?f(e,h):e.fragment.code.add(n.glsl`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/ensureColor4":function(){define(["exports","../../../../core/maybe","../../../../chunks/vec4","../../../../chunks/vec4f64"],function(a,b,c,m){const l=m.create();a.ensureColor4=function(r){return b.isNone(r)?m.ZEROS:4===r.length?r:c.set(l,r[0],r[1],r[2],1)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/shaders/RibbonLineTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../materials/DefaultTechniqueConfiguration".split(" "),function(a,b,c,m,l,r,n){a.CapType=void 0;(function(g){g[g.BUTT=0]="BUTT";g[g.SQUARE=1]="SQUARE";g[g.ROUND=2]="ROUND";g[g.COUNT=3]="COUNT"})(a.CapType||(a.CapType=
{}));n=function(g){function k(){var f=g.apply(this,arguments)||this;f.output=m.ShaderOutput.Color;f.capType=a.CapType.BUTT;f.transparencyPassType=r.TransparencyPassType.NONE;f.occluder=!1;f.hasSlicePlane=!1;f.hasPolygonOffset=!1;f.writeDepth=!1;f.draped=!1;f.stippleEnabled=!1;f.stippleOffColorEnabled=!1;f.stippleScaleWithLineWidth=!1;f.stipplePreferContinuous=!0;f.roundJoins=!1;f.vvSize=!1;f.vvColor=!1;f.vvOpacity=!1;f.falloffEnabled=!1;f.innerColorEnabled=!1;f.hasOccludees=!1;f.hasMultipassTerrain=
!1;f.cullAboveGround=!1;f.wireframe=!1;return f}b._inheritsLoose(k,g);return k}(n.DefaultTechniqueConfiguration);c.__decorate([l.parameter({count:m.ShaderOutput.COUNT})],n.prototype,"output",void 0);c.__decorate([l.parameter({count:a.CapType.COUNT})],n.prototype,"capType",void 0);c.__decorate([l.parameter({count:r.TransparencyPassType.COUNT})],n.prototype,"transparencyPassType",void 0);c.__decorate([l.parameter()],n.prototype,"occluder",void 0);c.__decorate([l.parameter()],n.prototype,"hasSlicePlane",
void 0);c.__decorate([l.parameter()],n.prototype,"hasPolygonOffset",void 0);c.__decorate([l.parameter()],n.prototype,"writeDepth",void 0);c.__decorate([l.parameter()],n.prototype,"draped",void 0);c.__decorate([l.parameter()],n.prototype,"stippleEnabled",void 0);c.__decorate([l.parameter()],n.prototype,"stippleOffColorEnabled",void 0);c.__decorate([l.parameter()],n.prototype,"stippleScaleWithLineWidth",void 0);c.__decorate([l.parameter()],n.prototype,"stipplePreferContinuous",void 0);c.__decorate([l.parameter()],
n.prototype,"roundJoins",void 0);c.__decorate([l.parameter()],n.prototype,"vvSize",void 0);c.__decorate([l.parameter()],n.prototype,"vvColor",void 0);c.__decorate([l.parameter()],n.prototype,"vvOpacity",void 0);c.__decorate([l.parameter()],n.prototype,"falloffEnabled",void 0);c.__decorate([l.parameter()],n.prototype,"innerColorEnabled",void 0);c.__decorate([l.parameter()],n.prototype,"hasOccludees",void 0);c.__decorate([l.parameter()],n.prototype,"hasMultipassTerrain",void 0);c.__decorate([l.parameter()],
n.prototype,"cullAboveGround",void 0);c.__decorate([l.parameter()],n.prototype,"wireframe",void 0);c.__decorate([l.parameter({constValue:!0})],n.prototype,"stippleRequiresClamp",void 0);c.__decorate([l.parameter({constValue:!0})],n.prototype,"stippleRequiresStretchMeasure",void 0);c.__decorate([l.parameter({constValue:!0})],n.prototype,"hasVvInstancing",void 0);c.__decorate([l.parameter({constValue:!0})],n.prototype,"hasSliceTranslatedView",void 0);a.RibbonLineTechniqueConfiguration=n;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../core/shaderLibrary/ShaderOutputOptions ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/OrderIndependentTransparency ../lib/Program ../lib/RenderSlot ../lib/StencilUtils ../lib/VertexAttribute ../../../../chunks/RibbonLine.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t){const x=new Map([[h.VertexAttribute.POSITION,0],[h.VertexAttribute.SUBDIVISIONFACTOR,1],[h.VertexAttribute.UV0,2],[h.VertexAttribute.AUXPOS1,3],[h.VertexAttribute.AUXPOS2,4],[h.VertexAttribute.COLOR,5],[h.VertexAttribute.COLORFEATUREATTRIBUTE,5],[h.VertexAttribute.SIZE,6],[h.VertexAttribute.SIZEFEATUREATTRIBUTE,6],[h.VertexAttribute.OPACITYFEATUREATTRIBUTE,7]]);n=function(q){function u(z,A,p){A=q.call(this,z,A,p)||this;A.stippleTextureRepository=z.stippleTextureRepository;
return A}c._inheritsLoose(u,q);var C=u.prototype;C.initializeProgram=function(z){const A=u.shader.get().build(this.configuration);return new f.Program(z.rctx,A,x)};C.destroy=function(){q.prototype.destroy.call(this);this.stippleTextureRepository.release(this.stipplePattern);this.stippleTextureBind=this.stipplePattern=null};C.bindPass=function(z,A){this.program.bindPass(z,A);this.stipplePattern!==z.stipplePattern&&(z=z.stipplePattern,this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,
z),this.stipplePattern=z);if(this.configuration.stippleEnabled){const {pixelSize:p,sdfNormalizer:y,pixels:D}=m.isSome(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",y);this.program.setUniform1f("stipplePatternTextureSize",D);this.program.setUniform1f("stipplePatternPixelSize",p);this.program.setUniform1f("stipplePatternPixelSizeInv",1/p)}};C._makePipelineState=function(z,A){const p=this.configuration,
y=z===g.TransparencyPassType.NONE,D=z===g.TransparencyPassType.FrontFace;return t.makePipelineState({blending:p.output===l.ShaderOutput.Color||p.output===l.ShaderOutput.Alpha?y?k.blendingDefault:k.oitBlending(z):null,depthTest:{func:k.oitDepthTest(z)},depthWrite:y?p.writeDepth&&t.defaultDepthWriteParams:k.oitDepthWrite(z),colorWrite:t.defaultColorWriteParams,stencilWrite:p.hasOccludees?e.stencilWriteMaskOn:null,stencilTest:p.hasOccludees?A?e.stencilToolMaskBaseParams:e.stencilBaseAllZerosParams:null,
polygonOffset:y||D?p.hasPolygonOffset&&B:k.OITPolygonOffset})};C.initializePipeline=function(){var z=this.configuration;z.occluder&&(z=z.hasPolygonOffset&&B,this._occluderPipelineTransparent=t.makePipelineState({blending:k.blendingDefault,polygonOffset:z,depthTest:e.depthCompareAlways,depthWrite:null,colorWrite:t.defaultColorWriteParams,stencilWrite:null,stencilTest:e.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=t.makePipelineState({blending:k.blendingDefault,polygonOffset:z,
depthTest:e.depthCompareAlways,depthWrite:null,colorWrite:t.defaultColorWriteParams,stencilWrite:e.stencilWriteMaskOff,stencilTest:e.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=t.makePipelineState({blending:null,polygonOffset:z,depthTest:e.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:e.stencilWriteMaskOn,stencilTest:e.stencilToolMaskBaseParams}));this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0);return this._makePipelineState(this.configuration.transparencyPassType,
!1)};C.getPipelineState=function(z,A){return A?this._occludeePipelineState:this.configuration.occluder?z===d.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:z===d.RenderSlot.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:q.prototype.getPipelineState.call(this,z,A)};c._createClass(u,[{key:"primitiveType",get:function(){return this.configuration.wireframe?w.PrimitiveType.LINES:w.PrimitiveType.TRIANGLE_STRIP}}]);return u}(n.ShaderTechnique);
n.shader=new r.ReloadableShaderModule(v.RibbonLine,()=>new Promise((q,u)=>a(["./RibbonLine.glsl"],q,u)));const B={factor:0,units:-4};b.RibbonLineTechnique=n;b.ribbonVertexAttributeLocations=x;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/StencilUtils":function(){define(["exports","./basicInterfaces","../../../webgl/enums"],function(a,b,c){const m={func:c.CompareFunction.LESS},l={function:{func:c.CompareFunction.ALWAYS,ref:b.StencilBits.OutlineVisualElementMask,
mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.ZERO}},r={function:{func:c.CompareFunction.ALWAYS,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.REPLACE}},n={function:{func:c.CompareFunction.EQUAL,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},
operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.KEEP}};b={function:{func:c.CompareFunction.NOTEQUAL,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.KEEP}};a.depthCompareAlways={func:c.CompareFunction.ALWAYS};a.depthCompareLess=m;a.renderWhenBitIsNotSet=g=>({function:{func:c.CompareFunction.NOTEQUAL,ref:g,mask:g},operation:{fail:c.StencilOperation.KEEP,
zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.KEEP}});a.replaceBitWhenDepthTestPasses=g=>({function:{func:c.CompareFunction.ALWAYS,ref:g,mask:g},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.REPLACE}});a.stencilBaseAllZerosParams=l;a.stencilToolMaskBaseParams=r;a.stencilToolMaskOccluderParams=n;a.stencilToolTransparentOccluderParams=b;a.stencilWriteMaskOff={mask:0};a.stencilWriteMaskOn={mask:255};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./BindParameters ./Camera ./Material ./RenderPass".split(" "),function(a,b,c,m,l,r,n){let g=function(){function d(e,h,v,w=null){this.rctx=e;this.sliceHelper=w;this.lastFrameCamera=new l.Camera;this.pass=n.RenderPass.MATERIAL;this.renderOccludedMask=f;this.bindParameters=new m.BindParameters(h,v,c.isSome(w)?w.plane:
null)}d.prototype.resetRenderOccludedMask=function(){this.renderOccludedMask=f};b._createClass(d,[{key:"isHighlightPass",get:function(){return this.pass===n.RenderPass.MATERIAL_HIGHLIGHT}}]);return d}(),k=function(d){function e(h,v,w,t,x){h=d.call(this,h,w,t,x)||this;h.offscreenRenderingHelper=v;h.sliceHelper=x;return h}b._inheritsLoose(e,d);return e}(g);const f=r.RenderOccludedFlag.Occlude|r.RenderOccludedFlag.OccludeAndTransparent|r.RenderOccludedFlag.OccludeAndTransparentStencil;a.OverlayRenderContext=
g;a.RenderContext=k;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../ViewingMode ./Camera ./Util ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u){function C(ea,ba){g.set(ka,ea[ba],ea[ba+3]);return ka}a.SnapshotSlot=void 0;(function(ea){ea[ea.Highlight=0]="Highlight";ea[ea.Default=1]="Default"})(a.SnapshotSlot||(a.SnapshotSlot={}));let z=function(){this.camera=new w.Camera;this.lightMat=n.create()},A=function(){function ea(Z,fa,ja=0){this.rctx=Z;this.viewingMode=fa;this._enabled=!1;this._snapshots=[];this.maxTextureSize=this._textureSize=0;this.numCascades=1;this.maxNumCascades=4;this.splitSchemeLambda=
0;this.warp=!0;this._cascadeDistances=[0,0,0,0,0];this._usedCascadeDistances=h.create();this._cascades=[new z,new z,new z,new z];this.maxTextureSize=this.rctx.parameters.maxTextureSize;this.snapshotCount=ja}var ba=ea.prototype;ba.dispose=function(){this._discardDepthTexture();this._discardAllSnapshots()};ba.getSnapshot=function(Z){return this.enabled?this._snapshots[Z]:null};ba.getCascades=function(){for(let Z=0;Z<this.numCascades;++Z)O[Z]=this._cascades[Z];O.length=this.numCascades;return O};ba.start=
function(Z,fa,ja){t.assert(this.enabled);this._textureSize=this._computeTextureSize(Z.fullWidth,Z.fullHeight);this._ensureDepthTexture();const {near:oa,far:sa}=this._clampNearFar(ja);this._computeCascadeDistances(sa,oa);this._setupMatrices(Z,fa);ja=Z.viewMatrix;Z=Z.projectionMatrix;for(let qa=0;qa<this.numCascades;++qa)this._constructCascade(qa,Z,ja,fa);this.lastOrigin=null;this.clear()};ba.finish=function(Z){t.assert(this.enabled);this.rctx.bindFramebuffer(Z)};ba.getShadowMapMatrices=function(Z){if(!this.lastOrigin||
!f.exactEquals(Z,this.lastOrigin)){this.lastOrigin=this.lastOrigin||d.create();f.copy(this.lastOrigin,Z);for(let fa=0;fa<this.numCascades;++fa){r.translate(Q,this._cascades[fa].lightMat,Z);for(let ja=0;16>ja;++ja)S[16*fa+ja]=Q[ja]}}return S};ba.takeCascadeSnapshotTo=function(Z,fa){t.assert(this.enabled);var ja=this._ensureSnapshot(fa);this._bindFbo();fa=this.rctx;ja=fa.bindTexture(ja,q.Texture.TEXTURE_UNIT_FOR_UPDATES);fa.gl.copyTexSubImage2D(x.TextureType.TEXTURE_2D,0,Z.camera.viewport[0],Z.camera.viewport[1],
Z.camera.viewport[0],Z.camera.viewport[1],Z.camera.viewport[2],Z.camera.viewport[3]);fa.bindTexture(ja,q.Texture.TEXTURE_UNIT_FOR_UPDATES)};ba.clear=function(){const Z=this.rctx;this._bindFbo();Z.setClearColor(1,1,1,1);Z.clearSafe(x.ClearBufferBit.COLOR_BUFFER_BIT|x.ClearBufferBit.DEPTH_BUFFER_BIT)};ba._computeTextureSize=function(Z,fa){return Math.min(this.maxTextureSize,2*2**Math.round(.5*Math.log(Z*Z+fa*fa)*Math.LOG2E+.35))};ba._ensureDepthTexture=function(){m.isSome(this._depthTexture)&&this._depthTexture.descriptor.width===
this._textureSize||(this._discardDepthTexture(),this._depthTexture=new q.Texture(this.rctx,{target:x.TextureType.TEXTURE_2D,pixelFormat:x.PixelFormat.RGBA,dataType:x.PixelType.UNSIGNED_BYTE,wrapMode:x.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:x.TextureSamplingMode.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize}),this._fbo=new B.FramebufferObject(this.rctx,{colorTarget:x.TargetType.TEXTURE,depthStencilTarget:x.DepthStencilTargetType.DEPTH_RENDER_BUFFER,width:this._textureSize,
height:this._textureSize},this._depthTexture))};ba._ensureSnapshot=function(Z){let fa=this._snapshots[Z];if(m.isSome(fa)&&fa.descriptor.width===this._textureSize)return fa;this._discardSnapshot(Z);fa=new q.Texture(this.rctx,{target:x.TextureType.TEXTURE_2D,pixelFormat:x.PixelFormat.RGBA,dataType:x.PixelType.UNSIGNED_BYTE,wrapMode:x.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:x.TextureSamplingMode.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize});return this._snapshots[Z]=fa};ba._discardDepthTexture=
function(){this._fbo=m.disposeMaybe(this._fbo);this._depthTexture=m.disposeMaybe(this._depthTexture)};ba._discardSnapshot=function(Z){this._snapshots[Z]=m.disposeMaybe(this._snapshots[Z])};ba._discardAllSnapshots=function(){for(let Z=0;Z<this.snapshotCount;++Z)this._discardSnapshot(Z)};ba._bindFbo=function(){const Z=this.rctx;Z.unbindTexture(this._depthTexture);Z.bindFramebuffer(this._fbo)};ba._constructCascade=function(Z,fa,ja,oa){const sa=this._cascades[Z];var qa=-this._cascadeDistances[Z],Ha=-this._cascadeDistances[Z+
1];qa=(fa[10]*qa+fa[14])/Math.abs(fa[11]*qa+fa[15]);fa=(fa[10]*Ha+fa[14])/Math.abs(fa[11]*Ha+fa[15]);t.assert(qa<fa);for(Ha=0;8>Ha;++Ha){e.set(E,0===Ha%4||3===Ha%4?-1:1,0===Ha%4||1===Ha%4?-1:1,4>Ha?qa:fa,1);e.transformMat4(F[Ha],E,D);for(let Ga=0;3>Ga;++Ga)F[Ha][Ga]/=F[Ha][3]}f.negate(I,F[0]);r.translate(p,H,I);sa.camera.viewMatrix=p;for(qa=0;8>qa;++qa)f.transformMat4(F[qa],F[qa],sa.camera.viewMatrix);f.copy(G,F[0]);f.copy(P,F[0]);for(qa=1;8>qa;++qa)for(fa=0;3>fa;++fa)G[fa]=Math.min(G[fa],F[qa][fa]),
P[fa]=Math.max(P[fa],F[qa][fa]);G[2]-=200;P[2]+=200;sa.camera.near=-P[2];sa.camera.far=-G[2];this.warp?this._constructTrapezoidalProjection(ja,oa,sa):this._constructOrthogonalProjection(sa);r.multiply(sa.lightMat,sa.camera.projectionMatrix,sa.camera.viewMatrix);ja=this._textureSize/2;sa.camera.viewport[0]=0===Z%2?0:ja;sa.camera.viewport[1]=0===Math.floor(Z/2)?0:ja;sa.camera.viewport[2]=ja;sa.camera.viewport[3]=ja};ba._constructOrthogonalProjection=function(Z){r.ortho(Z.camera.projectionMatrix,G[0],
P[0],G[1],P[1],Z.camera.near,Z.camera.far)};ba._constructTrapezoidalProjection=function(Z,fa,ja){var oa=1/F[0][3],sa=1/F[4][3];t.assert(oa<sa);oa+=Math.sqrt(oa*sa);var qa=Math.sin(c.acosClamped(Z[2]*fa[0]+Z[6]*fa[1]+Z[10]*fa[2]));Z=F;var Ha=oa/qa;fa=K;var Ga=N,pa=M;sa=L;oa=J;g.set(T,0,0);for(var Da=0;4>Da;++Da)g.add(T,T,Z[Da]);g.scale(T,T,.25);g.set(U,0,0);for(Da=4;8>Da;++Da)g.add(U,U,Z[Da]);g.scale(U,U,.25);g.lerp(aa[0],Z[4],Z[5],.5);g.lerp(aa[1],Z[5],Z[6],.5);g.lerp(aa[2],Z[6],Z[7],.5);g.lerp(aa[3],
Z[7],Z[4],.5);Da=0;var ra=g.squaredDistance(aa[0],T);for(var Ea=1;4>Ea;++Ea){var Ia=g.squaredDistance(aa[Ea],T);Ia<ra&&(ra=Ia,Da=Ea)}g.subtract(W,aa[Da],Z[Da+4]);Da=W[0];W[0]=-W[1];W[1]=Da;g.subtract(R,U,T);0>g.dot(R,W)&&g.negate(W,W);g.lerp(W,W,R,qa);g.normalize(W,W);qa=Da=g.dot(g.subtract(V,Z[0],T),W);for(ra=1;8>ra;++ra)Ea=g.dot(g.subtract(V,Z[ra],T),W),Ea<qa?qa=Ea:Ea>Da&&(Da=Ea);g.copy(fa,T);g.scale(V,W,qa-Ha);g.add(fa,fa,V);Ea=-1;Ia=1;Ha=ra=0;for(let Ma=0;8>Ma;++Ma){g.subtract(da,Z[Ma],fa);g.normalize(da,
da);const Qa=W[0]*da[1]-W[1]*da[0];0<Qa?Qa>Ea&&(Ea=Qa,ra=Ma):Qa<Ia&&(Ia=Qa,Ha=Ma)}t.verify(0<Ea,"leftArea");t.verify(0>Ia,"rightArea");g.scale(ca,W,qa);g.add(ca,ca,T);g.scale(ha,W,Da);g.add(ha,ha,T);ia[0]=-W[1];ia[1]=W[0];Ga=t.rayRay2D(fa,Z[Ha],ha,g.add(V,ha,ia),1,Ga);pa=t.rayRay2D(fa,Z[ra],ha,V,1,pa);sa=t.rayRay2D(fa,Z[ra],ca,g.add(V,ca,ia),1,sa);Z=t.rayRay2D(fa,Z[Ha],ca,V,1,oa);t.verify(Ga,"rayRay");t.verify(pa,"rayRay");t.verify(sa,"rayRay");t.verify(Z,"rayRay");pa=K;Z=N;fa=L;sa=J;oa=ja.camera.projectionMatrix;
g.subtract(la,fa,sa);g.scale(la,la,.5);Y[0]=la[0];Y[1]=la[1];Y[2]=0;Y[3]=la[1];Y[4]=-la[0];Y[5]=0;Y[6]=la[0]*la[0]+la[1]*la[1];Y[7]=la[0]*la[1]-la[1]*la[0];Y[8]=1;Y[6]=-g.dot(C(Y,0),pa);Y[7]=-g.dot(C(Y,1),pa);pa=g.dot(C(Y,0),fa)+Y[6];Ga=g.dot(C(Y,1),fa)+Y[7];Ha=g.dot(C(Y,0),sa)+Y[6];sa=g.dot(C(Y,1),sa)+Y[7];pa=-(pa+Ha)/(Ga+sa);Y[0]+=Y[1]*pa;Y[3]+=Y[4]*pa;Y[6]+=Y[7]*pa;pa=1/(g.dot(C(Y,0),fa)+Y[6]);Ga=1/(g.dot(C(Y,1),fa)+Y[7]);Y[0]*=pa;Y[3]*=pa;Y[6]*=pa;Y[1]*=Ga;Y[4]*=Ga;Y[7]*=Ga;Y[2]=Y[1];Y[5]=Y[4];
Y[8]=Y[7];Y[7]+=1;pa=g.dot(C(Y,1),Z)+Y[7];Ga=g.dot(C(Y,2),Z)+Y[8];Ha=g.dot(C(Y,1),fa)+Y[7];sa=g.dot(C(Y,2),fa)+Y[8];pa=-.5*(pa/Ga+Ha/sa);Y[1]+=Y[2]*pa;Y[4]+=Y[5]*pa;Y[7]+=Y[8]*pa;pa=g.dot(C(Y,1),Z)+Y[7];Ga=g.dot(C(Y,2),Z)+Y[8];Ha=-Ga/pa;Y[1]*=Ha;Y[4]*=Ha;Y[7]*=Ha;oa[0]=Y[0];oa[1]=Y[1];oa[2]=0;oa[3]=Y[2];oa[4]=Y[3];oa[5]=Y[4];oa[6]=0;oa[7]=Y[5];oa[8]=0;oa[9]=0;oa[10]=1;oa[11]=0;oa[12]=Y[6];oa[13]=Y[7];oa[14]=0;oa[15]=Y[8];ja.camera.projectionMatrix[10]=2/(G[2]-P[2]);ja.camera.projectionMatrix[14]=
-(G[2]+P[2])/(G[2]-P[2])};ba._setupMatrices=function(Z,fa){r.multiply(y,Z.projectionMatrix,Z.viewMatrix);r.invert(D,y);Z=this.viewingMode===v.ViewingMode.Global?Z.eye:f.set(I,0,0,1);r.lookAt(H,[0,0,0],[-fa[0],-fa[1],-fa[2]],Z)};ba._clampNearFar=function(Z){let {near:fa,far:ja}=Z;2>fa&&(fa=2);2>ja&&(ja=2);fa>=ja&&(fa=2,ja=4);return{near:fa,far:ja}};ba._computeCascadeDistances=function(Z,fa){this.numCascades=Math.min(1+Math.floor(t.logWithBase(Z/fa,4)),this.maxNumCascades);const ja=(Z-fa)/this.numCascades;
Z=(Z/fa)**(1/this.numCascades);let oa=fa;for(let sa=0;sa<this.numCascades+1;++sa)this._cascadeDistances[sa]=c.lerp(oa,fa,this.splitSchemeLambda),oa*=Z,fa+=ja};b._createClass(ea,[{key:"depthTexture",get:function(){return this._depthTexture}},{key:"textureSize",get:function(){return this._textureSize}},{key:"cascadeDistances",get:function(){return e.set(this._usedCascadeDistances,this._cascadeDistances[0],1<this.numCascades?this._cascadeDistances[1]:Infinity,2<this.numCascades?this._cascadeDistances[2]:
Infinity,3<this.numCascades?this._cascadeDistances[3]:Infinity)}},{key:"maxCascades",get:function(){return this.maxNumCascades},set:function(Z){this.maxNumCascades=c.clamp(Math.floor(Z),1,4)}},{key:"enabled",get:function(){return this._enabled},set:function(Z){this._enabled=Z;Z||(this._discardDepthTexture(),this._discardAllSnapshots())}},{key:"ready",get:function(){return this._enabled&&m.isSome(this._depthTexture)}},{key:"snapshotCount",get:function(){return this._snapshots.length},set:function(Z){var fa=
this._snapshots.length;if(Z>fa){var ja=Z-fa;this._snapshots.length=Z;for(Z=0;Z<ja;++Z)this._snapshots[fa+Z]=null}else if(Z<this.snapshotCount){fa-=Z;for(ja=0;ja<fa;++ja)this._discardSnapshot(Z+ja);this._snapshots.length=Z}}},{key:"gpuMemoryUsage",get:function(){var Z,fa;return this._snapshots.reduce((ja,oa)=>ja+u.getGpuMemoryUsage(oa),null!=(Z=null==(fa=this._fbo)?void 0:fa.gpuMemoryUsage)?Z:0)}},{key:"test",get:function(){const Z=this;return{maxNumCascades:this.maxNumCascades,cascades:this._cascades,
textureSize:this._textureSize,set splitSchemeLambda(fa){Z.splitSchemeLambda=fa},get splitSchemeLambda(){return Z.splitSchemeLambda},set warp(fa){Z.warp=fa},get warp(){return Z.warp}}}}]);return ea}();const p=n.create(),y=n.create(),D=n.create(),E=h.create(),F=[];for(let ea=0;8>ea;++ea)F.push(h.create());const G=d.create(),P=d.create(),K=k.create(),N=k.create(),M=k.create(),L=k.create(),J=k.create(),H=n.create(),I=d.create(),O=[],Q=n.create(),S=new Float32Array(64),T=k.create(),U=k.create(),aa=[k.create(),
k.create(),k.create(),k.create()],W=k.create(),R=k.create(),V=k.create(),da=k.create(),ca=k.create(),ha=k.create(),ia=k.create(),ka=k.create(),la=k.create(),Y=l.create();a.ShadowMap=A;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/SortedRenderGeometryRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ./ChangeSet ./Intersector ./IntersectorInterfaces ./ModelDirtyTypes ./rendererUtils ../materials/renderers/MergedRenderer".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q){function u(p,y,D,E,F,G,P){const K={layerUid:G,graphicUid:P,triangleNr:y};y=N=>{N.set(t.IntersectorType.OVERLAY,K,p.dist,p.normal,p.transformation,D,E)};(null==F.results.min.drapedLayerOrder||D>=F.results.min.drapedLayerOrder)&&(null==F.results.min.dist||F.results.ground.dist<=F.results.min.dist)&&y(F.results.min);F.options.store!==t.StoreResults.MIN&&(null==F.results.max.drapedLayerOrder||D<F.results.max.drapedLayerOrder)&&(null==F.results.max.dist||
F.results.ground.dist>F.results.max.dist)&&y(F.results.max);F.options.store===t.StoreResults.ALL&&(G=w.newIntersectorResult(F.ray),y(G),F.results.all.push(G))}a.SortedRenderGeometryRenderer=function(p){function y(E){E=p.call(this,E)||this;E._pending=new C;E._changes=new v.ChangeSet;E._materialRenderers=new Map;E._sortedMaterialRenderers=new n;E._geometries=new Map;E._hasHighlights=!1;E._hasWater=!1;return E}b._inheritsLoose(y,p);var D=y.prototype;D.destroy=function(){this._changes.prune();this._materialRenderers.forEach(E=>
E.dispose());this._materialRenderers.clear();this._sortedMaterialRenderers.clear();this._geometries.clear()};D.commitChanges=function(){if(!this.updating)return!1;this._processAddsRemoves();let E=!1,F=!1,G=!1;B.splitRenderGeometryChangeSetByMaterial(this._changes).forEach((P,K)=>{let N=this._materialRenderers.get(K);!N&&0<P.adds.length&&(N=new q.MergedRenderer(this.rctx,this._materialRepository,K),this._materialRenderers.set(K,N),G=F=E=!0);if(N){var M=F||N.hasHighlights,L=G||N.hasWater;N.modify(P);
F=F||M!==N.hasHighlights;G=G||L!==N.hasWater;N.isEmpty&&(this._materialRenderers.delete(K),N.dispose(),E=!0)}});this._changes.clear();E&&this._updateSortedMaterialRenderers();F&&(this._hasHighlights=l.someMap(this._materialRenderers,P=>P.hasHighlights));G&&(this._hasWater=l.someMap(this._materialRenderers,P=>P.hasWater));this.notifyChange("updating");return!0};D.addGeometries=function(E,F){if(0!==E.length){var G=this._validateRenderGeometries(E);for(var P of G)this._geometries.set(P.id,P);P=this._pending.empty;
for(const K of G)this._pending.adds.add(K);P&&this.notifyChange("updating");F===x.ModelDirty.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(E)}};D.removeGeometries=function(E,F){const G=this._pending.empty,P=this._pending.adds;for(const K of E)P.has(K)?(this._pending.removed.add(K),P.delete(K)):this._pending.removed.has(K)||this._pending.removes.add(K),this._geometries.delete(r.unwrap(K.id));G&&!this._pending.empty&&this.notifyChange("updating");F===x.ModelDirty.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(E)};
D.modifyGeometries=function(E,F){const G=0===this._changes.updates.length;for(const P of E){const K=this._changes.updates.pushNew();K.renderGeometry=this._validateRenderGeometry(P);K.updateType=F}G&&0<this._changes.updates.length&&this.notifyChange("updating");switch(F){case x.ModelDirty.State.TRANSFORMATION:case x.ModelDirty.State.VERTEXATTRS:return this._notifyGraphicGeometryChanged(E);case x.ModelDirty.State.VISIBILITIES:return this._notifyGraphicVisibilityChanged(E)}};D.updateAnimation=function(E){let F=
!1;this._sortedMaterialRenderers.forAll(({materialRenderer:G})=>F=G.updateAnimation(E)||F);return F};D.render=function(E,F){for(let G=0;G<this._sortedMaterialRenderers.length;G++){const P=this._sortedMaterialRenderers.data[G];P.material.shouldRender(E)&&P.materialRenderer.render(E.pass,F)}};D.intersect=function(E,F,G,P,K){this._geometries.forEach(N=>{if(!P||P(N)){this._intersectRenderGeometry(N,G,F,0,E,K);var M=this.rendererContext.longitudeCyclical;M&&(N.boundingSphere[0]-N.boundingSphere[3]<M.min&&
this._intersectRenderGeometry(N,G,F,M.range,E,K),N.boundingSphere[0]+N.boundingSphere[3]>M.max&&this._intersectRenderGeometry(N,G,F,-M.range,E,K));K++}});return K};D._updateSortedMaterialRenderers=function(){this._sortedMaterialRenderers.clear();let E=0;this._materialRenderers.forEach((F,G)=>{G.insertOrder=E++;this._sortedMaterialRenderers.push({material:G,materialRenderer:F})});this._sortedMaterialRenderers.sort((F,G)=>{const P=G.material.renderPriority-F.material.renderPriority;return 0!==P?P:F.material.insertOrder-
G.material.insertOrder})};D._processAddsRemoves=function(){this._changes.adds.clear();this._changes.removes.clear();this._changes.adds.pushArray(Array.from(this._pending.adds));this._changes.removes.pushArray(Array.from(this._pending.removes));for(let E=0;E<this._changes.updates.length;)this._pending.has(this._changes.updates.data[E].renderGeometry)?this._changes.updates.removeUnorderedIndex(E):E++;this._pending.clear()};D._intersectRenderGeometry=function(E,F,G,P,K,N){if(E.instanceParameters.visible){var M=
0;r.isSome(E.transformation)&&(P+=E.transformation[12],M=E.transformation[13]);z[0]=G[0]-P;z[1]=G[1]-M;z[2]=1;A[0]=G[0]-P;A[1]=G[1]-M;A[2]=0;E.screenToWorldRatio=this.rendererContext.screenToWorldRatio;E.material.intersect(E,null,E.getShaderTransformation(),K,z,A,(L,J,H)=>{u(F,H,E.material.renderPriority,N,K,E.layerUid,E.graphicUid)},E.calculateShaderTransformation,F)}};D._notifyGraphicGeometryChanged=function(E){if(!r.isNone(this.drapeSource.notifyGraphicGeometryChanged))for(const G of E)if(E=G.graphicUid,
r.isSome(E)&&E!==F){this.drapeSource.notifyGraphicGeometryChanged(E);var F=E}};D._notifyGraphicVisibilityChanged=function(E){if(!r.isNone(this.drapeSource.notifyGraphicVisibilityChanged))for(const G of E)if(E=G.graphicUid,r.isSome(E)&&E!==F){this.drapeSource.notifyGraphicVisibilityChanged(E);var F=E}};D._validateRenderGeometries=function(E){for(const F of E)this._validateRenderGeometry(F);return E};D._validateRenderGeometry=function(E){r.isNone(E.origin)&&(E.origin=this._localOriginFactory.getOrigin(E.boundingSphere));
return E};b._createClass(y,[{key:"updating",get:function(){return!this._pending.empty||0<this._changes.updates.length}},{key:"rctx",get:function(){return this.rendererContext.rctx}},{key:"_materialRepository",get:function(){return this.rendererContext.materialRepository}},{key:"_localOriginFactory",get:function(){return this.rendererContext.localOriginFactory}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",
get:function(){return l.someMap(this._materialRenderers,E=>E.rendersOccluded)}},{key:"isEmpty",get:function(){return!this.updating&&0===this._materialRenderers.size&&0===this._geometries.size}},{key:"test",get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}}]);return y}(m);c.__decorate([g.property()],a.SortedRenderGeometryRenderer.prototype,"drapeSource",void 0);c.__decorate([g.property()],a.SortedRenderGeometryRenderer.prototype,"updating",null);c.__decorate([g.property()],
a.SortedRenderGeometryRenderer.prototype,"rctx",null);c.__decorate([g.property()],a.SortedRenderGeometryRenderer.prototype,"rendererContext",void 0);c.__decorate([g.property()],a.SortedRenderGeometryRenderer.prototype,"_materialRepository",null);c.__decorate([g.property()],a.SortedRenderGeometryRenderer.prototype,"_localOriginFactory",null);a.SortedRenderGeometryRenderer=c.__decorate([e.subclass("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],a.SortedRenderGeometryRenderer);let C=
function(){function p(){this.adds=new Set;this.removes=new Set;this.removed=new Set}var y=p.prototype;y.has=function(D){return this.adds.has(D)||this.removes.has(D)||this.removed.has(D)};y.clear=function(){this.adds.clear();this.removes.clear();this.removed.clear()};b._createClass(p,[{key:"empty",get:function(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}}]);return p}();const z=h.create(),A=h.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/lib/ChangeSet":function(){define(["exports","../../../../core/PooledArray"],function(a,b){let c=function(){function l(){this.adds=new b;this.removes=new b;this.updates=new b({allocator:n=>n||new m,deallocator:n=>{n.renderGeometry=null;return n}})}var r=l.prototype;r.clear=function(){this.adds.clear();this.removes.clear();this.updates.clear()};r.prune=function(){this.adds.prune();this.removes.prune();this.updates.prune()};return l}(),m=function(){};a.ChangeSet=c;a.MaterialChangeSet=
function(){this.adds=[];this.removes=[];this.updates=[]};a.RenderGeometryUpdate=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/ModelDirtyTypes":function(){define(["exports"],function(a){a.ModelDirty=void 0;(function(b){(function(c){c[c.ADD=1]="ADD";c[c.UPDATE=2]="UPDATE";c[c.REMOVE=4]="REMOVE"})(b.Geometry||(b.Geometry={}));(function(c){c[c.VISIBILITIES=1]="VISIBILITIES";c[c.VERTEXATTRS=2]="VERTEXATTRS";c[c.TRANSFORMATION=
4]="TRANSFORMATION";c[c.HIGHLIGHTS=8]="HIGHLIGHTS";c[c.OCCLUDEES=16]="OCCLUDEES"})(b.State||(b.State={}))})(a.ModelDirty||(a.ModelDirty={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/rendererUtils":function(){define(["exports","./ChangeSet"],function(a,b){a.splitRenderGeometryChangeSetByMaterial=function(c){const m=new Map,l=r=>{let n=m.get(r);n||(n=new b.MaterialChangeSet,m.set(r,n));return n};c.removes.forAll(r=>{1<=
r.data.indexCount&&l(r.material).removes.push(r)});c.adds.forAll(r=>{1<=r.data.indexCount&&l(r.material).adds.push(r)});c.updates.forAll(r=>{1<=r.renderGeometry.data.indexCount&&l(r.renderGeometry.material).updates.push(r)});return m};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/renderers/MergedRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/MapUtils ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../support/buffer/glUtil ../../lib/GLMaterials ../../lib/Material ../../lib/ModelDirtyTypes ../../lib/RenderPass ../../lib/Util ../DrawParameters ../WaterMaterial ./Instance ./MergedGeometryBuffer ./MergedGeometryBufferPool ./utils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q){function u(N,M){const L=new Map;for(const J of N)C(L,J,!0);for(const J of M)C(L,J,!1);return L}function C(N,M,L){const J=M.origin;if(!m.isNone(J)){var H=N.get(J.id);null==H&&(H=new y(J.vec3),N.set(J.id,H));L?H.toAdd.push(M):H.toRemove.push(M)}}function z(N,M){let L;if(!N.some(H=>{if(H.to-H.from<M)return!1;L=H;return!0}))return null;const J=L.from;L.from+=M;L.from>=L.to&&N.removeUnordered(L);return J}function A(N){const M=new Map;N.forAll(J=>M.set(J.from,
J));let L=!0;for(;L;)L=!1,N.forEach(J=>{const H=M.get(J.to);H&&(J.to=H.to,M.delete(H.from),N.removeUnordered(H),L=!0)})}let p=function(){function N(L,J,H){this._rctx=L;this._materialRepository=J;this._material=H;this.type="MergedRenderer";this._dataByOrigin=new Map;this._renderCommandData=new l;this._hasOccludees=this._hasHighlights=!1;this._glMaterials=new k.GLMaterials(this._material,this._materialRepository);this._bufferWriter=H.createBufferWriter();this._bufferPool=new B.MergedGeometryBufferPool(L,
H.vertexAttributeLocations,g.glLayout(this._bufferWriter.vertexBufferLayout))}var M=N.prototype;M.dispose=function(){this._glMaterials.destroy();this._dataByOrigin.forEach(L=>L.buffer.dispose());this._dataByOrigin.clear();this._bufferPool.dispose()};M.modify=function(L){this._updateGeometries(L.updates);this._addAndRemoveGeometries(L.adds,L.removes);this._updateRenderCommands()};M._addAndRemoveGeometries=function(L,J){const H=this._bufferWriter,I=H.vertexBufferLayout.stride/4,O=this._dataByOrigin,
Q=u(L,J);Q.forEach((S,T)=>{Q.delete(T);var U=S.toAdd.reduce((V,da)=>V+H.elementCount(da.data),0);let aa=O.get(T);if(null==aa)h.assert(0===S.toRemove.length),aa=new D(S.origin,new x.MergedGeometryBuffer(this._bufferPool,U*I)),O.set(T,aa);else if(0===S.toAdd.length&&aa.instances.size===S.toRemove.length){aa.buffer.dispose();O.delete(T);return}let W=0;aa.instances.forEach(V=>W+=V.to-V.from);T=S.toRemove.reduce((V,da)=>V+H.elementCount(da.data),0);T=(W+U-T)*I;U=F;T<aa.buffer.size/2?this._removeAndRebuild(aa,
S.toRemove,I,T,U):0<S.toRemove.length&&this._remove(aa,S.toRemove,I,U);0<S.toAdd.length&&(T=G,h.setMatrixTranslation3(T,-S.origin[0],-S.origin[1],-S.origin[2]),this._add(aa,S.toAdd,I,T,U));const R=aa.buffer.vao.vertexBuffers.geometry;A(U);U.forAll(({from:V,to:da})=>{V<da&&(V*=4,R.setSubData(aa.buffer.array,V,V,4*da))});U.clear();aa.drawCommandsDirty=!0})};M._updateGeometries=function(L){const J=this._bufferWriter,H=J.vertexBufferLayout.stride/4;for(const I of L){L=I.renderGeometry;const O=this._dataByOrigin.get(L.origin.id),
Q=O&&O.instances.get(L.id);if(!Q)break;const S=I.updateType;S&d.ModelDirty.State.VISIBILITIES&&(Q.isVisible=L.instanceParameters.visible);if(S&(d.ModelDirty.State.HIGHLIGHTS|d.ModelDirty.State.VISIBILITIES)){const T=L.instanceParameters.visible;Q.hasHighlights=!!L.instanceParameters.highlights&&T}S&d.ModelDirty.State.OCCLUDEES&&(Q.hasOccludees=!!L.instanceParameters.occludees);if(S&(d.ModelDirty.State.VERTEXATTRS|d.ModelDirty.State.TRANSFORMATION)){const {array:T,vao:U}=O.buffer;q.calculateTransformRelativeToOrigin(L,
P,K);J.write({transformation:P,invTranspTransformation:K},L.data,J.vertexBufferLayout.createView(T.buffer),Q.from);h.assert(Q.from+J.elementCount(L.data)===Q.to,"material VBO layout has changed");U.vertexBuffers.geometry.setSubData(T,Q.from*H*4,Q.from*H*4,Q.to*H*4)}O.drawCommandsDirty=!0}};M._updateRenderCommands=function(){this._hasOccludees=this._hasHighlights=!1;this._dataByOrigin.forEach(J=>{J.hasHiddenInstances=!1;J.hasHighlights=!1;J.hasOccludees=!1;c.someMap(J.instances,H=>{H.isVisible?(H.hasHighlights&&
(this._hasHighlights=!0,J.hasHighlights=!0),H.hasOccludees&&(this._hasOccludees=!0,J.hasOccludees=!0)):J.hasHiddenInstances=!0;return J.hasHiddenInstances&&J.hasHighlights&&J.hasOccludees})});const L=J=>{J.drawCommandsDefault=null;J.drawCommandsHighlight=null;J.drawCommandsOccludees=null;J.drawCommandsShadowHighlightRest=null;if(0!==J.instances.size)if(J.hasOccludees||J.hasHighlights||J.hasHiddenInstances){var H=t.sortInstancesByRange(J.instances);J.drawCommandsDefault=[];J.drawCommandsHighlight=
[];J.drawCommandsOccludees=[];J.drawCommandsShadowHighlightRest=[];for(const I of H)I.isVisible&&(I.hasOccludees?t.addOrMerge(J.drawCommandsOccludees,I):t.addOrMerge(J.drawCommandsDefault,I),I.hasHighlights?t.addOrMerge(J.drawCommandsHighlight,I):t.addOrMerge(J.drawCommandsShadowHighlightRest,I))}else J.drawCommandsDefault=[{first:0,count:4*J.buffer.size/this._bufferWriter.vertexBufferLayout.stride}]};this._dataByOrigin.forEach(J=>{J.drawCommandsDirty&&(L(J),J.drawCommandsDirty=!1)})};M.updateAnimation=
function(L){return this._material.update(L)};M.requiresSlot=function(L,J){return null==L||this._material.requiresSlot(L,J)};M.render=function(L,J){if(!this.requiresSlot(J.slot,L))return!1;const H=L===e.RenderPass.MATERIAL_HIGHLIGHT||L===e.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT;if(H&&!this._hasHighlights)return!1;const I=L===e.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,O=!(H||I);this._dataByOrigin.forEach(T=>{if(!H||T.hasHighlights){var U=(H?T.drawCommandsHighlight:I&&(T.hasOccludees||T.hasHighlights||
T.hasHiddenInstances)?T.drawCommandsShadowHighlightRest:T.drawCommandsDefault)||null,aa=O&&T.drawCommandsOccludees||null;(m.isSome(U)||m.isSome(aa))&&this._renderCommandData.push(new E(T.origin,T.buffer,U,aa))}});if(0===this._renderCommandData.length)return!1;const Q=this._rctx;L=this._glMaterials.load(Q,L);if(m.isNone(L))return this._renderCommandData.clear(),!1;const S=L.beginSlot(J);Q.bindTechnique(S,this._material.parameters,J,!1);this._renderCommandData.forAll(T=>{S.bindDraw(T,J);const {buffer:U,
renderCommands:aa,occludeeCommands:W}=T;S.ensureAttributeLocations(U.vao);Q.bindVAO(U.vao);T=S.primitiveType;m.isSome(aa)&&this._renderCommands(Q,T,aa);m.isSome(W)&&(S.bindPipelineState(Q,J.slot,!0),this._renderCommands(Q,T,W),S.bindPipelineState(Q,J.slot,!1))});this._renderCommandData.clear();return!0};M._renderCommands=function(L,J,H){for(let I=0;I<H.length;I++)L.drawArrays(J,H[I].first,H[I].count)};M._removeAndRebuild=function(L,J,H,I,O){for(var Q of J)L.instances.delete(Q.id);var S=t.sortInstancesByRange(L.instances);
L.instances.clear();J=L.buffer.size;I=L.buffer.alloc(I);Q=0;for(const T of S){S=T.from*H;const U=T.to*H;I.copy(Q,S,U);T.from=Q/H;Q+=U-S;T.to=Q/H;L.instances.set(T.id,T)}O.push(new t.BufferRange(0,I.hasNewBuffer?L.buffer.array.length:J));I.dispose();L.buffer.erase(Q,O.back().to);L.holes.clear()};M._remove=function(L,J,H,I){for(const O of J){J=O.id;const Q=L.instances.get(J),S=Q.from*H,T=Q.to*H;L.buffer.erase(S,T);L.holes.push(new t.BufferRange(Q.from,Q.to));L.instances.delete(J);I.push(new t.BufferRange(S,
T))}A(L.holes)};M._add=function(L,J,H,I,O){if(0!==J.length){var Q=this._bufferWriter,S=Q.vertexBufferLayout.createView(L.buffer.array.buffer),T=0<L.holes.length,U=Number.MAX_SAFE_INTEGER,aa=Number.MIN_SAFE_INTEGER;for(const R of J){var W=m.isSome(R.transformation)?r.multiply(P,I,R.transformation):I;r.invert(K,W);const V=r.transpose(K,K);J=Q.elementCount(R.data);const da=J*H;let ca=z(L.holes,J);m.isNone(ca)&&(ca=L.buffer.size/H,L.buffer.grow(da),S=Q.vertexBufferLayout.createView(L.buffer.array.buffer));
Q.write({transformation:W,invTranspTransformation:V},R.data,S,ca);W=R.instanceParameters.visible;J=new t.Instance(R.id,ca,ca+J,W,!!R.instanceParameters.highlights&&W,!!R.instanceParameters.occludees);h.assert(null==L.instances.get(R.id));L.instances.set(R.id,J);T?O.push(new t.BufferRange(J.from*H,J.to*H)):(U=Math.min(J.from,U),aa=Math.max(J.to,aa))}T||O.push(new t.BufferRange(U*H,aa*H))}};b._createClass(N,[{key:"isEmpty",get:function(){return 0===this._dataByOrigin.size}},{key:"hasHighlights",get:function(){return this._hasHighlights}},
{key:"hasOccludees",get:function(){return this._hasOccludees}},{key:"hasWater",get:function(){return!this.isEmpty&&this._material instanceof w.WaterMaterial}},{key:"rendersOccluded",get:function(){return!this.isEmpty&&this._material.renderOccluded!==f.RenderOccludedFlag.Occlude}},{key:"test",get:function(){return{material:this._material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}]);return N}(),y=function(N){this.origin=N;this.toAdd=[];this.toRemove=[]},D=function(N,M){this.origin=
N;this.buffer=M;this.instances=new Map;this.holes=new l({deallocator:null});this.drawCommandsDirty=this.hasOccludees=this.hasHighlights=this.hasHiddenInstances=!1},E=function(N){function M(L,J,H,I){L=N.call(this,L)||this;L.buffer=J;L.renderCommands=H;L.occludeeCommands=I;return L}b._inheritsLoose(M,N);return M}(v.DrawParameters);const F=new l({deallocator:null}),G=n.create(),P=n.create(),K=n.create();a.MergedRenderer=p;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/materials/DrawParameters":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec3f64","../core/shaderLibrary/attributes/VertexNormal.glsl"],function(a,b,c,m){m=function(l){function r(n=c.create()){var g=l.call(this)||this;g.origin=n;g.slicePlaneLocalOrigin=g.origin;return g}b._inheritsLoose(r,l);return r}(m.VertexNormalDrawParameters);a.DrawParameters=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/mat3f64 ../../../../../../chunks/vec4f64 ./NormalAttribute.glsl ./VertexPosition.glsl ../../shaderModules/interfaces ../../shaderModules/Matrix3DrawUniform ../../shaderModules/Matrix3PassUniform".split(" "),function(a,b,c,m,l,r,n,g,k){let f=function(e){function h(){var v=e.apply(this,arguments)||this;v.transformNormalViewFromGlobal=
c.create();return v}b._inheritsLoose(h,e);return h}(r.VertexPositionPassParameters),d=function(e){function h(){var v=e.apply(this,arguments)||this;v.transformNormalGlobalFromModel=c.create();v.toMapSpace=m.create();return v}b._inheritsLoose(h,e);return h}(r.VertexPositionDrawParameters);a.VertexNormal=function(e,h){h.normalType===l.NormalAttributeType.Attribute||h.normalType===l.NormalAttributeType.CompressedAttribute?(e.include(l.NormalAttribute,h),e.varyings.add("vNormalWorld","vec3"),e.varyings.add("vNormalView",
"vec3"),e.vertex.uniforms.add([new g.Matrix3DrawUniform("transformNormalGlobalFromModel",v=>v.transformNormalGlobalFromModel),new k.Matrix3PassUniform("transformNormalViewFromGlobal",v=>v.transformNormalViewFromGlobal)]),e.vertex.code.add(n.glsl`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`)):h.normalType===l.NormalAttributeType.Ground?(e.include(r.VertexPosition,h),e.varyings.add("vNormalWorld","vec3"),e.vertex.code.add(n.glsl`
    void forwardNormal() {
      vNormalWorld = ${h.spherical?n.glsl`normalize(vPositionWorldCameraRelative);`:n.glsl`vec3(0.0, 0.0, 1.0);`}
    }
    `)):e.vertex.code.add(n.glsl`void forwardNormal() {}`)};a.VertexNormalDrawParameters=d;a.VertexNormalPassParameters=f;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl":function(){define(["exports","../util/DecodeNormal.glsl","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c,m){a.NormalAttributeType=void 0;(function(l){l[l.Attribute=0]="Attribute";
l[l.CompressedAttribute=1]="CompressedAttribute";l[l.Ground=2]="Ground";l[l.ScreenDerivative=3]="ScreenDerivative";l[l.COUNT=4]="COUNT"})(a.NormalAttributeType||(a.NormalAttributeType={}));a.NormalAttribute=function(l,r){r.normalType===a.NormalAttributeType.Attribute&&(l.attributes.add(m.VertexAttribute.NORMAL,"vec3"),l.vertex.code.add(c.glsl`vec3 normalModel() {
return normal;
}`));r.normalType===a.NormalAttributeType.CompressedAttribute&&(l.include(b.DecodeNormal),l.attributes.add(m.VertexAttribute.NORMALCOMPRESSED,"vec2"),l.vertex.code.add(c.glsl`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`));r.normalType===a.NormalAttributeType.ScreenDerivative&&(l.extensions.add("GL_OES_standard_derivatives"),l.fragment.code.add(c.glsl`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DecodeNormal.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.DecodeNormal=function(c){const m=b.glsl`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;c.fragment.code.add(m);c.vertex.code.add(m)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/mat3f64 ../../../../../../chunks/mat4f64 ../../../../../../chunks/vec3f32 ../../../../../../chunks/vec3f64 ./PositionAttribute.glsl ../util/DoublePrecision.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3DrawUniform ../../shaderModules/Matrix3PassUniform ../../shaderModules/Matrix4PassUniform".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){let w=function(x){function B(){var q=x.apply(this,arguments)||this;q.transformWorldFromViewTH=r.create();q.transformWorldFromViewTL=r.create();q.transformViewFromCameraRelativeRS=c.create();q.transformProjFromView=m.create();return q}b._inheritsLoose(B,x);return B}(d.NoParameters),t=function(x){function B(){var q=x.apply(this,arguments)||this;q.transformWorldFromModelRS=c.create();q.transformWorldFromModelTH=l.create();q.transformWorldFromModelTL=l.create();return q}
b._inheritsLoose(B,x);return B}(d.NoParameters);a.VertexPosition=function(x,B){x.include(n.PositionAttribute);const q=x.vertex;q.include(g.DoublePrecision,B);x.varyings.add("vPositionWorldCameraRelative","vec3");x.varyings.add("vPosition_view","vec3");q.uniforms.add([new f.Float3PassUniform("transformWorldFromViewTH",u=>u.transformWorldFromViewTH),new f.Float3PassUniform("transformWorldFromViewTL",u=>u.transformWorldFromViewTL),new h.Matrix3PassUniform("transformViewFromCameraRelativeRS",u=>u.transformViewFromCameraRelativeRS),
new v.Matrix4PassUniform("transformProjFromView",u=>u.transformProjFromView),new e.Matrix3DrawUniform("transformWorldFromModelRS",u=>u.transformWorldFromModelRS),new k.Float3DrawUniform("transformWorldFromModelTH",u=>u.transformWorldFromModelTH),new k.Float3DrawUniform("transformWorldFromModelTL",u=>u.transformWorldFromModelTL)]);q.code.add(d.glsl`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`);q.code.add(d.glsl`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${B.spherical?d.glsl`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:d.glsl`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `);x.fragment.uniforms.add(new f.Float3PassUniform("transformWorldFromViewTL",u=>u.transformWorldFromViewTL));q.code.add(d.glsl`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`);x.fragment.code.add(d.glsl`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)};a.VertexPositionDrawParameters=t;a.VertexPositionPassParameters=w;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c){a.PositionAttribute=function(m){m.attributes.add(c.VertexAttribute.POSITION,"vec3");m.vertex.code.add(b.glsl`vec3 positionModel() { return position; }`)};
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DoublePrecision.glsl":function(){define(["exports","../../../../../../core/has","../../shaderModules/interfaces"],function(a,b,c){a.DoublePrecision=function({code:m},l){l.doublePrecisionRequiresObfuscation?m.add(c.glsl`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):m.add(c.glsl`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)};a.doublePrecisionRequiresObfuscation=function(m){return b("force-double-precision-obfuscation")?!0:m.driverTest.doublePrecisionRequiresObfuscation};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/WaterMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/time ../../../../chunks/vec2f64 ../../../../chunks/vec4f64 ../core/shaderLibrary/ShaderOutputOptions ../lib/AnimationTimer ../lib/GLMaterials ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ./WaterGLMaterial ./WaterTechnique ./internal/DefaultBufferWriter ./internal/MaterialUtil".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w){let t=function(B){function q(C){C=B.call(this,C,new x)||this;C._techniqueConfig=new h.WaterTechniqueConfiguration;C.animation=new n.AnimationTimer;return C}b._inheritsLoose(q,B);var u=q.prototype;u.getConfiguration=function(C,z){this._techniqueConfig.output=C;this._techniqueConfig.writeDepth=this.parameters.writeDepth;this._techniqueConfig.receiveShadows=this.parameters.receiveShadows;this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane;this._techniqueConfig.transparent=
this.parameters.transparent;this._techniqueConfig.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections;this._techniqueConfig.hasCloudsReflections=this.parameters.hasCloudsReflections;this._techniqueConfig.isDraped=this.parameters.isDraped;this._techniqueConfig.transparencyPassType=z.transparencyPassType;this._techniqueConfig.enableOffset=z.camera.relativeElevation<f.OITPolygonOffsetLimit;this._techniqueConfig.hasMultipassTerrain=z.multipassTerrain.enabled;this._techniqueConfig.cullAboveGround=
z.multipassTerrain.cullAboveGround;return this._techniqueConfig};u.update=function(C){this.animation.enabled=35E3>Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*Math.min(C.camera.relativeElevation,C.camera.distance);C=this.animation.advance(C);this.setParameters({timeElapsed:c.secondsFromMilliseconds(this.animation.time)*this.parameters.animationSpeed},!1);return this.animation.enabled&&C};u.intersect=function(C,z,A,p,y,D,E){w.intersectTriangleGeometry(C,z,p,y,D,void 0,
E)};u.requiresSlot=function(C,z){switch(g.outputFromPass(z)){case r.ShaderOutput.Normal:return C===d.RenderSlot.DRAPED_WATER;case r.ShaderOutput.Color:if(this.parameters.isDraped)return C===d.RenderSlot.DRAPED_MATERIAL;break;case r.ShaderOutput.Highlight:return C===d.RenderSlot.OPAQUE_MATERIAL||C===d.RenderSlot.DRAPED_MATERIAL}z=d.RenderSlot.OPAQUE_MATERIAL;this.parameters.transparent&&(z=this.parameters.writeDepth?d.RenderSlot.TRANSPARENT_MATERIAL:d.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);
return C===z};u.createGLMaterial=function(C){if(C.output===r.ShaderOutput.Color&&this.parameters.isDraped)return C.output=r.ShaderOutput.Draped,new e.WaterGLMaterial(C);switch(C.output){case r.ShaderOutput.Color:case r.ShaderOutput.Normal:case r.ShaderOutput.Highlight:case r.ShaderOutput.Alpha:return new e.WaterGLMaterial(C)}return null};u.createBufferWriter=function(){return new v.DefaultBufferWriter(v.PositionUVLayout)};return q}(k.Material),x=function(B){function q(){var u=B.apply(this,arguments)||
this;u.waveStrength=.06;u.waveTextureRepeat=32;u.waveDirection=m.fromValues(1,0);u.waveVelocity=.05;u.flowStrength=.015;u.flowOffset=-.5;u.animationSpeed=.35;u.timeElapsed=0;u.color=l.fromValues(0,0,0,0);u.transparent=!0;u.writeDepth=!0;u.hasSlicePlane=!1;u.isDraped=!1;u.receiveShadows=!0;u.hasScreenSpaceReflections=!1;u.hasCloudsReflections=!1;return u}b._inheritsLoose(q,B);return q}(k.MaterialParameters);a.WaterMaterial=t;a.WaterMaterialParameters=x;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/WaterGLMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../core/shaderLibrary/ShaderOutputOptions ../lib/basicInterfaces ../lib/GLMaterial ./WaterTechnique".split(" "),function(a,b,c,m,l,r,n){r=function(g){function k(){return g.apply(this,arguments)||this}b._inheritsLoose(k,g);var f=k.prototype;f._updateShadowState=function(d){d.shadowMap.enabled!==this._material.parameters.receiveShadows&&
this._material.setParameters({receiveShadows:d.shadowMap.enabled})};f._updateSSRState=function(d){d.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:d.ssr.enabled})};f._updateCloudsReflectionState=function(d){d=c.isSome(d.clouds.data);d!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:d})};f.ensureResources=function(d){const e=this._techniqueRepository.constructionContext.waterTextureRepository;
e.resourceState===l.ResourceState.NOT_LOADED&&e.loadTextures(d);return e.resourceState};f.beginSlot=function(d){this._output===m.ShaderOutput.Color&&(this._updateShadowState(d),this._updateSSRState(d),this._updateCloudsReflectionState(d));return this.ensureTechnique(n.WaterTechnique,d)};return k}(r);a.WaterGLMaterial=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/WaterTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../ViewingMode ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/util/DoublePrecision.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ./DefaultTechniqueConfiguration ../../../../chunks/WaterSurface.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B){f=function(q){function u(z,A,p){A=q.call(this,z,A,p)||this;A._textureRepository=z.waterTextureRepository;return A}c._inheritsLoose(u,q);var C=u.prototype;C.initializeConfiguration=function(z,A){A.spherical=z.viewingMode===l.ViewingMode.Global;A.doublePrecisionRequiresObfuscation=g.doublePrecisionRequiresObfuscation(z.rctx)};C.initializeProgram=function(z){const A=u.shader.get().build(this.configuration);return new w.Program(z.rctx,A,h.Default3D)};C.bindPass=
function(z,A){this.program.bindPass(z,A);this.configuration.output!==r.ShaderOutput.Color&&this.configuration.output!==r.ShaderOutput.Normal||this._textureRepository.bind(this.program)};C._setPipelineState=function(z){const A=this.configuration,p=z===e.TransparencyPassType.NONE,y=z===e.TransparencyPassType.FrontFace;return B.makePipelineState({blending:A.output!==r.ShaderOutput.Normal&&A.output!==r.ShaderOutput.Highlight&&A.transparent?p?v.blendingDefault:v.oitBlending(z):null,depthTest:{func:v.oitDepthTest(z)},
depthWrite:p?A.writeDepth&&B.defaultDepthWriteParams:v.oitDepthWrite(z),colorWrite:B.defaultColorWriteParams,polygonOffset:p||y?null:v.getOITPolygonOffset(A.enableOffset)})};C.initializePipeline=function(){return this._setPipelineState(this.configuration.transparencyPassType)};return u}(f.ShaderTechnique);f.shader=new k.ReloadableShaderModule(x.WaterSurface,()=>new Promise((q,u)=>a(["../shaders/WaterSurface.glsl"],q,u)));k=function(q){function u(){var C=q.apply(this,arguments)||this;C.output=r.ShaderOutput.Color;
C.transparencyPassType=e.TransparencyPassType.NONE;C.spherical=!1;C.receiveShadows=!1;C.hasSlicePlane=!1;C.transparent=!1;C.enableOffset=!0;C.writeDepth=!1;C.hasScreenSpaceReflections=!1;C.doublePrecisionRequiresObfuscation=!1;C.hasCloudsReflections=!1;C.isDraped=!1;C.hasMultipassTerrain=!1;C.cullAboveGround=!1;return C}c._inheritsLoose(u,q);return u}(t.DefaultTechniqueConfiguration);m.__decorate([d.parameter({count:r.ShaderOutput.COUNT})],k.prototype,"output",void 0);m.__decorate([d.parameter({count:e.TransparencyPassType.COUNT})],
k.prototype,"transparencyPassType",void 0);m.__decorate([d.parameter()],k.prototype,"spherical",void 0);m.__decorate([d.parameter()],k.prototype,"receiveShadows",void 0);m.__decorate([d.parameter()],k.prototype,"hasSlicePlane",void 0);m.__decorate([d.parameter()],k.prototype,"transparent",void 0);m.__decorate([d.parameter()],k.prototype,"enableOffset",void 0);m.__decorate([d.parameter()],k.prototype,"writeDepth",void 0);m.__decorate([d.parameter()],k.prototype,"hasScreenSpaceReflections",void 0);
m.__decorate([d.parameter()],k.prototype,"doublePrecisionRequiresObfuscation",void 0);m.__decorate([d.parameter()],k.prototype,"hasCloudsReflections",void 0);m.__decorate([d.parameter()],k.prototype,"isDraped",void 0);m.__decorate([d.parameter()],k.prototype,"hasMultipassTerrain",void 0);m.__decorate([d.parameter()],k.prototype,"cullAboveGround",void 0);m.__decorate([d.parameter({constValue:n.PBRMode.Water})],k.prototype,"pbrMode",void 0);m.__decorate([d.parameter({constValue:!0})],k.prototype,"useCustomDTRExponentForWater",
void 0);m.__decorate([d.parameter({constValue:!0})],k.prototype,"highStepCount",void 0);m.__decorate([d.parameter({constValue:!1})],k.prototype,"useFillLights",void 0);b.WaterTechnique=f;b.WaterTechniqueConfiguration=k;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/WaterSurface.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4Uniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4Uniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/basicInterfaces ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D){function E(G){const P=new p.ShaderBuilder,{vertex:K,fragment:N}=P,M=x.addProjViewLocalOrigin(P,G);P.include(l.Transform);P.attributes.add(D.VertexAttribute.POSITION,"vec3");P.attributes.add(D.VertexAttribute.UV0,"vec2");K.uniforms.add(new q.Float4PassUniform("waterColor",L=>L.color));if(G.output===c.ShaderOutput.Color||G.output===c.ShaderOutput.Alpha)P.include(f.NormalUtils,G),P.include(b.ForwardLinearDepth,G),P.varyings.add("vuv","vec2"),
P.varyings.add("vpos","vec3"),P.varyings.add("vnormal","vec3"),P.varyings.add("vtbnMatrix","mat3"),N.uniforms.add(M),G.hasMultipassTerrain&&P.varyings.add("depth","float"),K.code.add(z.glsl`
      void main(void) {
        if (waterColor.a < ${z.glsl.float(w.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${G.hasMultipassTerrain?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${G.output===c.ShaderOutput.Color?"forwardLinearDepth();":""}
      }
    `);P.include(k.multipassTerrainTest,G);G.output===c.ShaderOutput.Alpha&&(P.include(m.SliceDraw,G),N.uniforms.add(new u.Float4Uniform("waterColor")),N.code.add(z.glsl`
        void main() {
          discardBySlice(vpos);
          ${G.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `));G.output===c.ShaderOutput.Color&&(P.include(g.MainLighting,{isGround:!1}),P.include(n.EvaluateAmbientLighting,{pbrMode:d.PBRMode.Disabled,lightingSphericalHarmonicsOrder:2}),P.include(v.WaterDistortion),P.include(m.SliceDraw,G),P.include(e.ReadShadowMapDraw,G),P.include(h.Water,G),N.uniforms.add([new u.Float4Uniform("waterColor"),new B.Float3PassUniform("lightingMainDirection",(L,J)=>J.lighting.lightingMainDirection),new B.Float3PassUniform("lightingMainIntensity",(L,J)=>J.lighting.mainLight.intensity),
new C.FloatPassUniform("timeElapsed",L=>L.timeElapsed),new A.Matrix4Uniform("view")]),x.addCameraPosition(N,G),N.include(t.ColorConversion),N.code.add(z.glsl`
      void main() {
        discardBySlice(vpos);
        ${G.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${G.receiveShadows?z.glsl`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${G.transparencyPassType===y.TransparencyPassType.Color?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));G.output===c.ShaderOutput.Normal&&(P.include(f.NormalUtils,G),P.include(v.WaterDistortion,G),P.include(m.SliceDraw,G),P.varyings.add("vpos","vec3"),P.varyings.add("vuv","vec2"),K.code.add(z.glsl`
        void main(void) {
          if (waterColor.a < ${z.glsl.float(w.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),N.uniforms.add(new C.FloatPassUniform("timeElapsed",L=>L.timeElapsed)),N.code.add(z.glsl`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`));G.output===c.ShaderOutput.Draped&&(P.varyings.add("vpos","vec3"),K.code.add(z.glsl`
        void main(void) {
          if (waterColor.a < ${z.glsl.float(w.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),N.uniforms.add(new u.Float4Uniform("waterColor")),N.code.add(z.glsl`void main() {
gl_FragColor = waterColor;
}`));G.output===c.ShaderOutput.Highlight&&(P.include(r.OutputHighlight),P.varyings.add("vpos","vec3"),K.code.add(z.glsl`
      void main(void) {
        if (waterColor.a < ${z.glsl.float(w.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),P.include(m.SliceDraw,G),N.code.add(z.glsl`void main() {
discardBySlice(vpos);
outputHighlight();
}`));return P}const F=Object.freeze(Object.defineProperty({__proto__:null,build:E},Symbol.toStringTag,{value:"Module"}));a.WaterSurface=F;a.build=E})},"esri/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":function(){define(["exports","./ShaderOutputOptions","./attributes/VertexPosition.glsl","../shaderModules/Float2PassUniform","../shaderModules/interfaces"],function(a,b,c,m,l){a.ForwardLinearDepth=function(r,n){n.output===b.ShaderOutput.Color&&n.receiveShadows?(r.varyings.add("linearDepth",
"float"),r.vertex.code.add(l.glsl`void forwardLinearDepth() { linearDepth = gl_Position.w; }`)):n.output===b.ShaderOutput.Depth||n.output===b.ShaderOutput.Shadow?(r.include(c.VertexPosition,n),r.varyings.add("linearDepth","float"),r.vertex.uniforms.add(new m.Float2PassUniform("nearFar",(g,k)=>k.camera.nearFar)),r.vertex.code.add(l.glsl`void forwardLinearDepth() {
linearDepth = (-vPosition_view.z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)):r.vertex.code.add(l.glsl`void forwardLinearDepth() {}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.NormalUtils=function(c,m){m.spherical?c.vertex.code.add(b.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):c.vertex.code.add(b.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`);m.spherical?c.vertex.code.add(b.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):c.vertex.code.add(b.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec3f64 ../util/RgbaFloatEncoding.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/IntegerPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4sUniform ../../shaderModules/Texture2DPassUniform ../../shaderTechnique/BindType".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){function e(v){v=v.fragment;v.include(m.RgbaFloatEncoding);v.uniforms.add([new f.Texture2DPassUniform("shadowMapTex",(w,t)=>t.shadowMap.depthTexture),new n.IntegerPassUniform("numCascades",(w,t)=>t.shadowMap.numCascades),new l.Float4PassUniform("cascadeDistances",(w,t)=>t.shadowMap.cascadeDistances),new r.FloatPassUniform("depthHalfPixelSz",(w,t)=>.5/t.shadowMap.textureSize)]);v.code.add(g.glsl`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture2D(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {
float texSize = 0.5 / halfPixelSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, depthHalfPixelSz, shadowMapTex);
}`)}let h=function(v){function w(){var t=v.apply(this,arguments)||this;t.origin=c.create();return t}b._inheritsLoose(w,v);return w}(g.NoParameters);a.ReadShadowMapBindParameters=h;a.ReadShadowMapDraw=function(v,w){w.receiveShadows&&(v.fragment.uniforms.add(new k.Matrix4sUniform("shadowMapMatrix",d.BindType.Draw,(t,x)=>x.shadowMap.getShadowMapMatrices(t.origin),4)),e(v))};a.ReadShadowMapPass=function(v,w){w.receiveShadows&&(v.fragment.uniforms.add(new k.Matrix4sUniform("shadowMapMatrix",d.BindType.Pass,
(t,x)=>x.shadowMap.getShadowMapMatrices(t.origin),4)),e(v))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/IntegerPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,m){c=function(l){function r(n,g){return l.call(this,n,"int",m.BindType.Pass,(k,f,d)=>k.setUniform1i(n,g(f,d)))||this}b._inheritsLoose(r,l);return r}(c.Uniform);
a.IntegerPassUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4sUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,m){c=function(l){function r(n,g,k,f){switch(g){case m.BindType.Pass:var d=l.call(this,n,"mat4",g,(e,h,v)=>e.setUniformMatrix4fv(n,k(h,v)),f)||this;return b._assertThisInitialized(d);case m.BindType.Draw:return d=
l.call(this,n,"mat4",g,(e,h,v)=>e.setUniformMatrix4fv(n,k(h,v)),f)||this,b._assertThisInitialized(d)}return d}b._inheritsLoose(r,l);return r}(c.Uniform);a.Matrix4sUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl":function(){define("exports ./FoamRendering.glsl ./Gamma.glsl ./PhysicallyBasedRendering.glsl ./ScreenSpaceReflections.glsl ../util/CloudsParallaxShading.glsl ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces".split(" "),
function(a,b,c,m,l,r,n,g){a.Water=function(k,f){k.include(m.PhysicallyBasedRendering,f);k.include(c.Gamma);k.include(b.FoamColor);f.hasCloudsReflections&&k.include(r.CloudsParallaxShading,f);f.hasScreenSpaceReflections&&k.include(l.ScreenSpaceReflections,f);k=k.fragment;k.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3E5).add("ssrHeightFadeEnd",
"float",5E5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]);k.code.add(g.glsl`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`);k.uniforms.add([new n.FloatPassUniform("lightingSpecularStrength",(d,e)=>e.lighting.mainLight.specularStrength),new n.FloatPassUniform("lightingEnvironmentStrength",(d,e)=>e.lighting.mainLight.environmentStrength)]);k.code.add(g.glsl`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`);f.hasCloudsReflections&&k.code.add(g.glsl`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`);f.hasScreenSpaceReflections?k.code.add(g.glsl`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view *vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod*0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor + reflSea * seaColorMod + specular  + foam);`):k.code.add(g.glsl`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`);f.hasCloudsReflections?f.hasScreenSpaceReflections?k.code.add(g.glsl`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):k.code.add(g.glsl`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):k.code.add(g.glsl`return waterRenderedColor;
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/FoamRendering.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.FoamColor=function(c){c.fragment.code.add(b.glsl`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)};a.FoamIntensity=function(c){c.fragment.code.add(b.glsl`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":function(){define(["exports","./AnalyticalSkyModel.glsl","./PhysicallyBasedRenderingParameters.glsl","./PiUtils.glsl","../../shaderModules/interfaces"],function(a,b,c,m,l){a.PhysicallyBasedRendering=function(r,n){const g=r.fragment.code;r.include(m.PiUtils);if(n.pbrMode===c.PBRMode.Water||n.pbrMode===c.PBRMode.WaterOnIntegratedMesh)g.add(l.glsl`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${n.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),g.add(l.glsl`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),g.add(l.glsl`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),g.add(l.glsl`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),g.add(l.glsl`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`);else if(n.pbrMode===c.PBRMode.Normal||n.pbrMode===c.PBRMode.Schematic)r.include(b.AnalyticalSkyModel),g.add(l.glsl`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),g.add(l.glsl`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),g.add(l.glsl`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),g.add(l.glsl`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),g.add(l.glsl`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),g.add(l.glsl`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.AnalyticalSkyModel=function(c){c=c.fragment.code;c.add(b.glsl`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`);c.add(b.glsl`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`);c.add(b.glsl`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl":function(){define("exports ../../../../../../chunks/vec2 ../../../../../../chunks/vec2f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ./FoamRendering.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DUniform".split(" "),
function(a,b,c,m,l,r,n,g,k,f){const d=l.create(),e=c.create();a.WaterDistortion=function(h){h.fragment.uniforms.add(new f.Texture2DUniform("texWaveNormal"));h.fragment.uniforms.add(new f.Texture2DUniform("texWavePerturbation"));h.fragment.uniforms.add([new g.Float4PassUniform("waveParams",v=>m.set(d,v.waveStrength,v.waveTextureRepeat,v.flowStrength,v.flowOffset)),new n.Float2PassUniform("waveDirection",v=>b.set(e,v.waveDirection[0]*v.waveVelocity,v.waveDirection[1]*v.waveVelocity))]);h.include(r.FoamIntensity);
h.fragment.code.add(k.glsl`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/internal/DefaultBufferWriter":function(){define(["exports","../../../support/buffer/InterleavedLayout","../../lib/VertexAttribute","./bufferWriterUtils"],function(a,b,c,m){const l=b.newLayout().vec3f(c.VertexAttribute.POSITION),r=b.newLayout().vec3f(c.VertexAttribute.POSITION).vec2f(c.VertexAttribute.UV0);b=b.newLayout().vec3f(c.VertexAttribute.POSITION).vec4u8(c.VertexAttribute.COLOR);
let n=function(){function g(f){this.vertexBufferLayout=f}var k=g.prototype;k.allocate=function(f){return this.vertexBufferLayout.createBuffer(f)};k.elementCount=function(f){return f.indices.get(c.VertexAttribute.POSITION).length};k.write=function(f,d,e,h){m.writeDefaultAttributes(d,this.vertexBufferLayout,f.transformation,f.invTranspTransformation,e,h)};return g}();a.DefaultBufferWriter=n;a.PositionColorLayout=b;a.PositionLayout=l;a.PositionUVLayout=r;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/renderers/Instance":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){function c(n,g){return n.from===g.from?n.to-g.to:n.from-g.from}let m=function(n){this.first=n.from;this.count=n.to-n.from},l=function(n=0,g=0){this.from=n;this.to=g},r=function(n){function g(k,f,d,e,h,v){f=n.call(this,f,d)||this;f.id=k;f.isVisible=e;f.hasHighlights=h;f.hasOccludees=v;return f}b._inheritsLoose(g,
n);return g}(l);a.BufferRange=l;a.DrawCommand=m;a.Instance=r;a.addOrMerge=function(n,g){if(0===n.length)n.push(new m(g));else{var k=n[n.length-1];k.first+k.count>=g.from?k.count=g.from-k.first+g.to-g.from:n.push(new m(g))}};a.sortInstancesByRange=function(n){return Array.from(n.values()).sort(c)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/renderers/MergedGeometryBuffer":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],
function(a,b){function c(l,r,n){return r<=n?l>=n?l:65536*Math.ceil(Math.max(2*l,n)/65536):l<=2*n?l:65536*Math.ceil(n/65536)}let m=function(){function l(n,g){this._pool=n;this._size=0;this._buffer=n.newBuffer(65536*Math.ceil(g/65536))}var r=l.prototype;r.dispose=function(){this._buffer=this._pool.deleteBuffer(this._buffer);this._size=0};r.release=function(){this.erase(0,this._size);this.dispose()};r.grow=function(n){this._resize(this._size+n,!0).dispose()};r.alloc=function(n){return this._resize(n,
!1)};r._resize=function(n,g){let k;const f=c(this._buffer.length,this._size,n);if(this._buffer.length!==f){const e=this._pool.newBuffer(f);g&&(e.array.set(this._buffer.array.subarray(0,Math.min(this._size,f))),e.vao.vertexBuffers.geometry.setSubData(e.array,0,0,e.array.byteLength));k=this._buffer;this._buffer=e}const d=this._size;this._size=n;return k?{dispose:()=>{k.array.fill(0,0,d);this._pool.deleteBuffer(k)},copy:(e,h,v)=>this._buffer.array.set(k.array.subarray(h,v),e),hasNewBuffer:!0}:{dispose:()=>
{},copy:(e,h,v)=>{e!==h&&this._buffer.array.copyWithin(e,h,v)},hasNewBuffer:!1}};r.erase=function(n,g){this._buffer.array.fill(0,n,g)};b._createClass(l,[{key:"vao",get:function(){return this._buffer.vao}},{key:"array",get:function(){return this._buffer.array}},{key:"size",get:function(){return this._size}}]);return l}();a.MergedGeometryBuffer=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/renderers/MergedGeometryBufferPool":function(){define(["exports",
"../../../../../core/maybe","../../../../../core/MemCache","../../../../../core/uid","../../lib/StaticFloat32ArrayObject"],function(a,b,c,m,l){function r(k,f){if(f===c.RemoveMode.ALL)k.forEach(d=>d.dispose());else return f=k.pop(),k=k.length*f.array.byteLength,f.dispose(),k}const n=c.MIN_PRIORITY+1;let g=function(){function k(d,e,h){this._rctx=d;this._locations=e;this._layout=h;this._cache=d.newCache(`MergedRenderer pool ${m.generateUID()}`,r)}var f=k.prototype;f.dispose=function(){this._cache.destroy()};
f.newBuffer=function(d){const e=d.toString(),h=this._cache.pop(e);return b.isSome(h)?(d=h.pop(),0<h.length&&this._cache.put(e,h,d.array.byteLength*h.length,n),d):new l.StaticFloat32ArrayObject(this._rctx,this._locations,this._layout,d)};f.deleteBuffer=function(d){const e=d.array.byteLength,h=d.array.length.toString(),v=this._cache.pop(h);b.isSome(v)?(v.push(d),this._cache.put(h,v,e*v.length,-1)):this._cache.put(h,[d],e,-1);return null};return k}();a.MergedGeometryBufferPool=g;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/StaticFloat32ArrayObject":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../webgl/BufferObject","../../../webgl/enums","../../../webgl/VertexArrayObject"],function(a,b,c,m,l){let r=function(){function n(g,k,f,d){this.vao=new l.VertexArrayObject(g,k,{geometry:f},{geometry:c.BufferObject.createVertex(g,m.Usage.STATIC_DRAW)});this.array=new Float32Array(d);this.vao.vertexBuffers.geometry.setSize(this.array.byteLength)}
n.prototype.dispose=function(){this.vao.dispose(!0)};b._createClass(n,[{key:"length",get:function(){return this.array.length}}]);return n}();a.StaticFloat32ArrayObject=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/SSAOHelper":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../support/requestImageUtils ../core/shaderModules/interfaces ./glUtil3D ./SSAOTechnique ./SSAOTechniqueConfiguration ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){let w=function(){function x(q,u,C){this._techniqueRep=q;this._rctx=u;this._requestRender=C;this._enabled=!1;this._ssaoTechniqueConfig=new f.SSAOTechniqueConfiguration;this.quadVAO=null;this._blurSizePx=2;this._attenuation=.5}var B=x.prototype;B.dispose=function(){this.quadVAO=m.disposeMaybe(this.quadVAO)};B.disposeOffscreenBuffers=function(){m.applySome(this._ssaoFBO,q=>q.resize(0,0));m.applySome(this._blur0FBO,q=>q.resize(0,0));m.applySome(this._blur1FBO,q=>
q.resize(0,0))};B.computeSSAO=function(q,u,C){if(!(!this.enabled||m.isNone(u)||m.isNone(C)||m.isNone(this._noiseTexture)||m.isNone(this._ssaoFBO)||m.isNone(this._blur0FBO)||m.isNone(this._blur1FBO))){var z=this._rctx,A=q.camera,p=A.fullViewport,y=p[2],D=p[3],E=y/this._blurSizePx,F=D/this._blurSizePx;this._ssaoFBO.resize(y,D);this._blur0FBO.resize(E,F);this._blur1FBO.resize(E,F);E=1*y;F=1*D;z.bindFramebuffer(this._ssaoFBO);z.setViewport(0,0,y,D);var G=z.bindTechnique(this._ssaoTechnique,t,q);G.setUniform2f("rnmScale",
y/this._noiseTexture.descriptor.width,D/this._noiseTexture.descriptor.height);y=1/A.computeRenderPixelSizeAtDist(1);G.setUniform1f("projScale",1*y);G.setUniform2f("screenSize",E,F);D=l.distance(A.eye,A.center);A=20*A.computeRenderPixelSizeAtDist(D);A=Math.max(.1,A);G.setUniform1f("radius",A);G.setUniform1f("intensity",4*this._attenuation/A**6);G.bindTexture("rnm",this._noiseTexture);G.bindTexture("normalMap",C);G.bindTexture("depthMap",u);m.isNone(this.quadVAO)&&(this.quadVAO=g.createQuadVAO(this._rctx));
z.bindVAO(this.quadVAO);z.drawArrays(d.PrimitiveType.TRIANGLE_STRIP,0,v.vertexCount(this.quadVAO,"geometry"));q=z.bindTechnique(this._blurTechnique,t,q);q.bindTexture("tex",this._ssaoFBO.colorTexture);q.bindTexture("normalMap",C);q.bindTexture("depthMap",u);z.setViewport(0,0,E/this._blurSizePx,F/this._blurSizePx);z.bindFramebuffer(this._blur0FBO);q.setUniform2f("screenSize",E,F);q.setUniform2f("blurSize",0,1*this._blurSizePx/F);5E4<D&&(y=Math.max(0,y-(D-5E4)));q.setUniform1f("projScale",y);z.drawArrays(d.PrimitiveType.TRIANGLE_STRIP,
0,v.vertexCount(this.quadVAO,"geometry"));q.setUniform2f("blurSize",1*this._blurSizePx/E,0);z.bindFramebuffer(this._blur1FBO);q.bindTexture("tex",this._blur0FBO.colorTexture);z.drawArrays(d.PrimitiveType.TRIANGLE_STRIP,0,v.vertexCount(this.quadVAO,"geometry"));z.setViewport(p[0],p[1],p[2],p[3])}};B._selectPrograms=function(){this._ssaoTechniqueConfig.output=f.SSAOOutput.SSAO;this._ssaoTechnique=this._techniqueRep.releaseAndAcquire(k.SSAOTechnique,this._ssaoTechniqueConfig,this._ssaoTechnique);this._ssaoTechniqueConfig.output=
f.SSAOOutput.Blur;this._blurTechnique=this._techniqueRep.releaseAndAcquire(k.SSAOTechnique,this._ssaoTechniqueConfig,this._blurTechnique)};B._enable=function(){this.enabled||(this._enabled=!0,this._loadResources(()=>{this._enabled&&this._initialize()}))};B._loadResources=function(q){this._data?q():(new Promise((u,C)=>a(["./SSAOHelperData"],u,C))).then(u=>{this._data=u;q()})};B._initialize=function(){const q={target:d.TextureType.TEXTURE_2D,pixelFormat:d.PixelFormat.RGBA,dataType:d.PixelType.UNSIGNED_BYTE,
samplingMode:d.TextureSamplingMode.LINEAR,wrapMode:d.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0},u={colorTarget:d.TargetType.TEXTURE,depthStencilTarget:d.DepthStencilTargetType.NONE};r.requestImage(this._data.noiseTexture).then(C=>{this._enabled&&(this._ssaoFBO=new e.FramebufferObject(this._rctx,u,q),this._blur0FBO=new e.FramebufferObject(this._rctx,u,q),this._blur1FBO=new e.FramebufferObject(this._rctx,u,q),this._noiseTexture=new h.Texture(this._rctx,{target:d.TextureType.TEXTURE_2D,pixelFormat:d.PixelFormat.RGBA,
dataType:d.PixelType.UNSIGNED_BYTE,hasMipmap:!0,width:C.width,height:C.height},C),this._requestRender())});this._selectPrograms()};B._disable=function(){this._enabled=!1;this._noiseTexture=m.disposeMaybe(this._noiseTexture);this._blur1FBO=m.disposeMaybe(this._blur1FBO);this._blur0FBO=m.disposeMaybe(this._blur0FBO);this._ssaoFBO=m.disposeMaybe(this._ssaoFBO)};c._createClass(x,[{key:"enabled",get:function(){return this._enabled},set:function(q){q?this._enable():this._disable()}},{key:"ready",get:function(){return this.enabled&&
m.isSome(this._noiseTexture)&&m.isSome(this._ssaoFBO)&&m.isSome(this._blur0FBO)&&m.isSome(this._blur1FBO)}},{key:"colorTexture",get:function(){return m.isSome(this._blur1FBO)?this._blur1FBO.colorTexture:null}},{key:"width",get:function(){return m.isSome(this._ssaoFBO)?this._ssaoFBO.width:-1}},{key:"height",get:function(){return m.isSome(this._ssaoFBO)?this._ssaoFBO.height:-1}},{key:"gpuMemoryUsage",get:function(){return(m.isSome(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(m.isSome(this._blur1FBO)?
this._blur1FBO.gpuMemoryUsage:0)+(m.isSome(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}},{key:"test",get:function(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}]);return x}();const t=new n.NoParameters;b.SSAOHelper=w;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/SSAOTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../../chunks/SSAO.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k){l=function(f){function d(){return f.apply(this,arguments)||this}c._inheritsLoose(d,f);var e=d.prototype;e.initializeProgram=function(h){const v=d.shader.get().build(this.configuration);return new n.Program(h.rctx,v,r.Default3D)};e.initializePipeline=function(){return k.makePipelineState({colorWrite:k.defaultColorWriteParams})};return d}(l.ShaderTechnique);l.shader=new m.ReloadableShaderModule(g.SSAO,()=>new Promise((f,d)=>a(["../shaders/SSAO.glsl"],f,d)));b.SSAOTechnique=
l;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/SSAO.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float2Uniform ../views/3d/webgl-engine/core/shaderModules/FloatUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DUniform ../views/3d/webgl-engine/lib/SSAOTechniqueConfiguration".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){function e(w){const t=new k.ShaderBuilder,x=t.fragment;t.include(b.ScreenSpacePass);if(w.output===d.SSAOOutput.Blur){var B=(h.filterRadius+1)/2;B=1/(2*B*B);x.include(c.ReadLinearDepth);x.uniforms.add([new f.Texture2DUniform("normalMap"),new f.Texture2DUniform("depthMap"),new f.Texture2DUniform("tex"),new r.Float2Uniform("blurSize"),new n.FloatUniform("projScale"),new l.Float2PassUniform("nearFar",(q,u)=>u.camera.nearFar)]);x.code.add(g.glsl`
      void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
        float c = texture2D(tex, uv).r;
        float d = linearDepthFromTexture(depthMap, uv, nearFar);

        float ddiff = d - center_d;

        float w = exp(-r * r * ${g.glsl.float(B)} - ddiff * ddiff * sharpness);
        wTotal += w;
        bTotal += w * c;
      }
    `);x.code.add(g.glsl`
      void main(void) {
        float b = 0.0;
        float w_total = 0.0;

        float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

        float sharpness = -0.05 * projScale/center_d;
        for (int r = -${g.glsl.int(h.filterRadius)}; r <= ${g.glsl.int(h.filterRadius)}; ++r) {
          float rf = float(r);
          vec2 uvOffset = uv + rf * blurSize;
          blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
        }

        gl_FragColor = vec4(b / w_total);
      }
    `)}w.output===d.SSAOOutput.SSAO&&(x.include(c.ReadLinearDepth),t.include(m.CameraSpace),x.uniforms.add(new f.Texture2DUniform("normalMap")),x.uniforms.add(new f.Texture2DUniform("depthMap")),x.uniforms.add(new f.Texture2DUniform("rnm")),x.uniforms.add(new n.FloatUniform("intensity")),x.uniforms.add(new n.FloatUniform("projScale")),x.uniforms.add(new n.FloatUniform("radius")),x.uniforms.add(new l.Float2PassUniform("nearFar",(q,u)=>u.camera.nearFar)),x.uniforms.add(new r.Float2Uniform("screenSize")),
x.uniforms.add(new r.Float2Uniform("rnmScale")),x.code.add(g.glsl`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),x.code.add(g.glsl`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),t.fragment.uniforms.add(new l.Float2PassUniform("zScale",(q,u)=>m.getZScale(u))),x.code.add(g.glsl`
      void main(void) {
        fillSphere();
        vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
        float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

        if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
          gl_FragColor = vec4(0.0);
          return;
        }

        vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

        // get the normal of current fragment
        vec4 norm4 = texture2D(normalMap, uv);
        vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
        bool isTerrain = norm4.w<0.5;

        float sum = .0;
        vec3 tapPixelPos;

        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
        // bug or deviation from CE somewhere else?
        float ps = projScale/(2.0 * currentPixelPos.z * zScale.x + zScale.y);

        for(int i = 0; i < ${g.glsl.int(h.samples)}; ++i) {
          vec2 unitOffset = reflect(sphere[i], fres).xy;
          vec2 offset = vec2(-unitOffset * radius * ps);

          //don't use current or very nearby samples
          if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

          vec2 tc = vec2(gl_FragCoord.xy + offset);
          if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
          vec2 tcTap = tc / screenSize;
          float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

          if (isTerrain) {
            bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
            if (isTerrainTap) {
              continue;
            }
          }

          tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

          sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
        }

        // output the result
        float A = max(1.0-sum*intensity/float(${g.glsl.int(h.samples)}),0.0);

        // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
        gl_FragColor = vec4(A);
      }
    `));return t}const h={samples:16,filterRadius:4},v=Object.freeze(Object.defineProperty({__proto__:null,build:e},Symbol.toStringTag,{value:"Module"}));a.SSAO=v;a.build=e})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl":function(){define("exports ../../../../../../chunks/vec2 ../../../../../../chunks/vec2f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ../../shaderModules/Float2PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),
function(a,b,c,m,l,r,n,g){function k(e){return 0===e.camera.projectionMatrix[11]?b.set(d,0,1):b.set(d,1,0)}const f=l.create(),d=c.create();a.CameraSpace=function(e){e.fragment.uniforms.add(new n.Float4PassUniform("projInfo",(h,v)=>{h=v.camera.projectionMatrix;v=0===h[11]?m.set(f,2/(v.camera.fullWidth*h[0]),2/(v.camera.fullHeight*h[5]),(1+h[12])/h[0],(1+h[13])/h[5]):m.set(f,-2/(v.camera.fullWidth*h[0]),-2/(v.camera.fullHeight*h[5]),(1-h[8])/h[0],(1-h[9])/h[5]);return v}));e.fragment.uniforms.add(new r.Float2PassUniform("zScale",
(h,v)=>k(v)));e.fragment.code.add(g.glsl`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)};a.getZScale=k;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/SSAOTechniqueConfiguration":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,m){a.SSAOOutput=void 0;(function(r){r[r.SSAO=0]="SSAO";r[r.Blur=1]="Blur";r[r.COUNT=2]="COUNT"})(a.SSAOOutput||(a.SSAOOutput={}));let l=function(r){function n(){var g=
r.apply(this,arguments)||this;g.output=a.SSAOOutput.SSAO;return g}b._inheritsLoose(n,r);return n}(m.ShaderTechniqueConfiguration);c.__decorate([m.parameter({count:a.SSAOOutput.COUNT})],l.prototype,"output",void 0);a.SSAOTechniqueConfiguration=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextureTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/TextureOnly.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f){r=function(d){function e(){return d.apply(this,arguments)||this}c._inheritsLoose(e,d);var h=e.prototype;h.initializeProgram=function(v){const w=e.shader.get().build();return new g.Program(v.rctx,w,n.Default3D)};h.initializePipeline=function(){return this.configuration.hasAlpha?f.makePipelineState({blending:f.separateBlendingParams(k.BlendFactor.SRC_ALPHA,k.BlendFactor.ONE,k.BlendFactor.ONE_MINUS_SRC_ALPHA,k.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:f.defaultColorWriteParams}):
f.makePipelineState({colorWrite:f.defaultColorWriteParams})};return e}(r.ShaderTechnique);r.shader=new l.ReloadableShaderModule(m.TextureOnlyShader,()=>new Promise((d,e)=>a(["../core/shaderLibrary/util/TextureOnly.glsl"],d,e)));b.TextureTechnique=r;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/TextureOnly.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderModules/Float4Uniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DUniform".split(" "),
function(a,b,c,m,l,r){function n(){const k=new l.ShaderBuilder;k.include(b.ScreenSpacePass);k.fragment.uniforms.add([new r.Texture2DUniform("tex"),new c.Float4Uniform("uColor")]);k.fragment.code.add(m.glsl`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`);return k}const g=Object.freeze(Object.defineProperty({__proto__:null,build:n},Symbol.toStringTag,{value:"Module"}));a.TextureOnlyShader=g;a.build=n})},"esri/views/3d/webgl-engine/lib/TextureTechniqueConfiguration":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,m){let l=function(r){function n(){var g=r.apply(this,arguments)||this;g.hasAlpha=!1;return g}b._inheritsLoose(n,
r);return n}(m.ShaderTechniqueConfiguration);c.__decorate([m.parameter()],l.prototype,"hasAlpha",void 0);a.TextureTechniqueConfiguration=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/StippleTextureRepository":function(){define(["exports","../../../../core/floatRGBA","../../../../core/maybe","../../../webgl/enums","../../../webgl/Texture"],function(a,b,c,m,l){function r(g,k){var f=g.map(t=>Math.round(t*k)),d=1/k;
g=Math.floor(f.reduce((t,x)=>t+x));var e=f.reduce((t,x)=>Math.max(t,x));e=(Math.floor(.5*(e-1))+.5)*d;var h=[];let v=1;for(var w of f){for(let t=0;t<w;t++)h.push(v*(Math.min(t,w-1-t)+.5)*d/e*.5+.5);v=-v}w=Math.round(f[0]/2);w=[...h.slice(w),...h.slice(0,w)];f=g+2;d=new Uint8Array(4*f);h=4;for(const t of w)b.packFloatRGBA(t,d,h),h+=4;d.copyWithin(0,h-4,h);d.copyWithin(h,4,8);return{encodedData:d,sdfNormalizer:e,paddedPixels:f,pixels:g}}let n=function(){function g(f){this._rctx=f;this.cache=new Map}
var k=g.prototype;k.dispose=function(){this.cache.forEach(f=>f.texture=c.disposeMaybe(f.texture));this.cache.clear()};k._acquire=function(f){if(c.isNone(f))return null;const d=this._patternId(f);var e=this.cache.get(d);if(e)return e.refCount++,e.bind;e=f.pixelRatio;const {encodedData:h,sdfNormalizer:v,pixels:w,paddedPixels:t}=r(f.pattern,e),x=w/e,B={refCount:1,texture:null,bind:q=>{c.isNone(B.texture)&&(B.texture=new l.Texture(this._rctx,{width:t,height:1,internalFormat:m.PixelFormat.RGBA,pixelFormat:m.PixelFormat.RGBA,
dataType:m.PixelType.UNSIGNED_BYTE,wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE},h));q.bindTexture("stipplePatternTexture",B.texture);return{pixelSize:x,sdfNormalizer:v,pixels:w}}};this.cache.set(d,B);return B.bind};k.release=function(f){if(!c.isNone(f)){f=this._patternId(f);var d=this.cache.get(f);d&&(d.refCount--,0===d.refCount&&(c.isSome(d.texture)&&d.texture.dispose(),this.cache.delete(f)))}};k.swap=function(f,d){d=this._acquire(d);this.release(f);return d};k._patternId=function(f){return`${f.pattern.join(",")}-r${f.pixelRatio}`};
return g}();a.StippleTextureRepository=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/CompositingTechniqueConfiguration":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,m){a.CompositingFunction=void 0;(function(r){r[r.Standard=0]="Standard";r[r.TransparentToHUDVisibility=1]="TransparentToHUDVisibility";
r[r.Transparency=2]="Transparency";r[r.OverlayWithTransparency=3]="OverlayWithTransparency";r[r.COUNT=4]="COUNT"})(a.CompositingFunction||(a.CompositingFunction={}));a.AlphaMode=void 0;(function(r){r[r.None=0]="None";r[r.Alpha=1]="Alpha";r[r.PremultipliedAlpha=2]="PremultipliedAlpha";r[r.COUNT=3]="COUNT"})(a.AlphaMode||(a.AlphaMode={}));let l=function(r){function n(){var g=r.apply(this,arguments)||this;g.function=a.CompositingFunction.Standard;g.alphaMode=a.AlphaMode.None;g.hasOpacityFactor=!1;return g}
b._inheritsLoose(n,r);return n}(m.ShaderTechniqueConfiguration);c.__decorate([m.parameter({count:a.CompositingFunction.COUNT})],l.prototype,"function",void 0);c.__decorate([m.parameter({count:a.AlphaMode.COUNT})],l.prototype,"alphaMode",void 0);c.__decorate([m.parameter()],l.prototype,"hasOpacityFactor",void 0);a.CompositingTechniqueConfiguration=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../lib/basicInterfaces ../lib/GLTextureMaterial ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderPass ../lib/RenderSlot ../lib/VertexAttribute ../lib/verticalOffsetUtils ./internal/bufferWriterUtils ./internal/MaterialUtil ../shaders/DefaultMaterialTechnique ../shaders/DefaultMaterialTechniqueConfiguration ../shaders/RealisticTreeTechnique".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p){function y(H){let I=n.newLayout();I=H.instancedDoublePrecision?I.vec3f(B.VertexAttribute.MODELORIGINHI).vec3f(B.VertexAttribute.MODELORIGINLO).mat3f(B.VertexAttribute.MODEL).mat3f(B.VertexAttribute.MODELNORMAL):I.mat4f(B.VertexAttribute.MODEL).mat4f(B.VertexAttribute.MODELNORMAL);c.isSome(H.instanced)&&H.instanced.includes("color")&&(I=I.vec4f(B.VertexAttribute.INSTANCECOLOR));c.isSome(H.instanced)&&H.instanced.includes("featureAttribute")&&
(I=I.vec4f(B.VertexAttribute.INSTANCEFEATUREATTRIBUTE));return I}v=function(H){function I(Q){var S=H.call(this,Q,E)||this;S.supportsEdges=!0;S.techniqueConfig=new A.DefaultMaterialTechniqueConfiguration;{var T=S.parameters;const U=T.textureId||T.normalTextureId||T.metallicRoughnessTextureId||T.emissiveTextureId||T.occlusionTextureId,aa=n.newLayout().vec3f(B.VertexAttribute.POSITION).vec3f(B.VertexAttribute.NORMAL);T.hasVertexTangents&&aa.vec4f(B.VertexAttribute.TANGENT);U&&aa.vec2f(B.VertexAttribute.UV0);
T.hasVertexColors&&aa.vec4u8(B.VertexAttribute.COLOR);T.hasSymbolColors&&aa.vec4u8(B.VertexAttribute.SYMBOLCOLOR);T=aa}S.vertexBufferLayout=T;S.instanceBufferLayout=Q.instanced?y(S.parameters):null;return S}b._inheritsLoose(I,H);var O=I.prototype;O.isVisibleInPass=function(Q){return Q===t.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL||Q===t.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT||Q===t.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT?this.parameters.castShadows:!0};O.isVisible=function(){var Q=this.parameters;
if(!H.prototype.isVisible.call(this)||0===Q.layerOpacity)return!1;const {instanced:S,hasVertexColors:T,hasSymbolColors:U,vvColorEnabled:aa}=Q,W=c.isSome(S)&&S.includes("color"),R="replace"===Q.colorMixMode,V=0<Q.opacity;Q=Q.externalColor&&0<Q.externalColor[3];return T&&(W||aa||U)?R?!0:V:T?R?Q:V:W||aa||U?R?!0:V:R?Q:V};O.getConfiguration=function(Q,S){this.techniqueConfig.output=Q;this.techniqueConfig.hasNormalTexture=!!this.parameters.normalTextureId;this.techniqueConfig.hasColorTexture=!!this.parameters.textureId;
this.techniqueConfig.hasVertexTangents=this.parameters.hasVertexTangents;this.techniqueConfig.instanced=!!this.parameters.instanced;this.techniqueConfig.instancedDoublePrecision=this.parameters.instancedDoublePrecision;this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled;this.techniqueConfig.hasVerticalOffset=c.isSome(this.parameters.verticalOffset);this.techniqueConfig.hasScreenSizePerspective=c.isSome(this.parameters.screenSizePerspective);this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane;
this.techniqueConfig.hasSliceHighlight=this.parameters.hasSliceHighlight;this.techniqueConfig.alphaDiscardMode=this.parameters.textureAlphaMode;this.techniqueConfig.normalType="screenDerivative"===this.parameters.normals?k.NormalAttributeType.ScreenDerivative:k.NormalAttributeType.Attribute;this.techniqueConfig.transparent=this.parameters.transparent;this.techniqueConfig.writeDepth=this.parameters.writeDepth;c.isSome(this.parameters.customDepthTest)&&(this.techniqueConfig.customDepthTest=this.parameters.customDepthTest);
this.techniqueConfig.hasOccludees=this.parameters.hasOccludees;this.techniqueConfig.cullFace=this.parameters.hasSlicePlane?e.CullFaceOptions.None:this.parameters.cullFace;this.techniqueConfig.hasMultipassTerrain=S.multipassTerrain.enabled;this.techniqueConfig.cullAboveGround=S.multipassTerrain.cullAboveGround;this.techniqueConfig.hasModelTransformation=c.isSome(this.parameters.modelTransformation);if(Q===g.ShaderOutput.Color||Q===g.ShaderOutput.Alpha)this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,
this.techniqueConfig.hasSymbolColors=this.parameters.hasSymbolColors,this.techniqueConfig.doubleSidedMode=this.parameters.treeRendering?f.NormalsDoubleSidedMode.WindingOrder:this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?f.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?f.NormalsDoubleSidedMode.WindingOrder:f.NormalsDoubleSidedMode.None,this.techniqueConfig.instancedColor=c.isSome(this.parameters.instanced)&&this.parameters.instanced.includes("color"),
this.techniqueConfig.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=S.ssaoHelper.ready?this.parameters.receiveSSAO:!1,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this.techniqueConfig.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?d.PBRMode.Schematic:d.PBRMode.Normal:d.PBRMode.Disabled,this.techniqueConfig.hasMetalnessAndRoughnessTexture=
!!this.parameters.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.parameters.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this.techniqueConfig.transparencyPassType=S.transparencyPassType,this.techniqueConfig.enableOffset=S.camera.relativeElevation<w.OITPolygonOffsetLimit,this.techniqueConfig.snowCover=this.hasSnowCover(S);
return this.techniqueConfig};O.hasSnowCover=function(Q){return c.isSome(Q.weather)&&Q.weatherVisible&&"snowy"===Q.weather.type&&"enabled"===Q.weather.snowCover};O.intersect=function(Q,S,T,U,aa,W,R){if(c.isSome(this.parameters.verticalOffset)){const da=U.camera;m.set(L,T[12],T[13],T[14]);T=null;switch(U.viewingMode){case r.ViewingMode.Global:T=m.normalize(N,L);break;case r.ViewingMode.Local:T=m.copy(N,K)}let ca=0;var V=m.subtract(J,L,da.eye);const ha=m.length(V);V=m.scale(V,V,1/ha);let ia=null;this.parameters.screenSizePerspective&&
(ia=m.dot(T,V));ca+=C.verticalOffsetAtDistance(da,ha,this.parameters.verticalOffset,ia,this.parameters.screenSizePerspective);m.scale(T,T,ca);m.transformMat3(M,T,U.transform.inverseRotation);aa=m.subtract(G,aa,M);W=m.subtract(P,W,M)}C.intersectTriangleGeometry(Q,S,U,aa,W,q.getVerticalOffsetObject3D(U.verticalOffset),R)};O.requiresSlot=function(Q){return Q===(this.parameters.transparent?this.parameters.writeDepth?x.RenderSlot.TRANSPARENT_MATERIAL:x.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:
x.RenderSlot.OPAQUE_MATERIAL)||Q===x.RenderSlot.DRAPED_MATERIAL};O.createGLMaterial=function(Q){return Q.output===g.ShaderOutput.Color||Q.output===g.ShaderOutput.Alpha||Q.output===g.ShaderOutput.Depth||Q.output===g.ShaderOutput.Normal||Q.output===g.ShaderOutput.Shadow||Q.output===g.ShaderOutput.Highlight?new D(Q):null};O.createBufferWriter=function(){return new F(this.vertexBufferLayout,this.instanceBufferLayout)};return I}(v.Material);let D=function(H){function I(Q){return H.call(this,{...Q,...Q.material.parameters})||
this}b._inheritsLoose(I,H);var O=I.prototype;O._updateParameters=function(Q){const S=this._material.parameters;this.updateTexture(S.textureId);const T=Q.camera.viewInverseTransposeMatrix;m.set(S.origin,T[3],T[7],T[11]);this._material.setParameters(this.textureBindParameters);return this.ensureTechnique(S.treeRendering?p.RealisticTreeTechnique:z.DefaultMaterialTechnique,Q)};O._updateShadowState=function(Q){Q.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:Q.shadowMap.enabled})};
O._updateOccludeeState=function(Q){Q.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:Q.hasOccludees})};O.beginSlot=function(Q){if(this._output===g.ShaderOutput.Color||this._output===g.ShaderOutput.Alpha)this._updateShadowState(Q),this._updateOccludeeState(Q);return this._updateParameters(Q)};return I}(h.GLTextureMaterial);h=function(H){function I(){var O=H.apply(this,arguments)||this;O.initTextureTransparent=!1;O.treeRendering=!1;O.hasVertexTangents=
!1;return O}b._inheritsLoose(I,H);return I}(z.DefaultMaterialPassParameters);const E=new h;let F=function(){function H(O,Q){this.vertexBufferLayout=O;this.instanceBufferLayout=Q}var I=H.prototype;I.allocate=function(O){return this.vertexBufferLayout.createBuffer(O)};I.elementCount=function(O){return O.indices.get(B.VertexAttribute.POSITION).length};I.write=function(O,Q,S,T){u.writeDefaultAttributes(Q,this.vertexBufferLayout,O.transformation,O.invTranspTransformation,S,T)};return H}();const G=l.create(),
P=l.create(),K=l.fromValues(0,0,1),N=l.create(),M=l.create(),L=l.create(),J=l.create();a.DefaultGLMaterial=D;a.DefaultMaterial=v;a.DefaultMaterialParameters=h;a.getInstanceBufferLayout=y;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/interfaces"],function(a,b,c){a.NormalsDoubleSidedMode=void 0;(function(m){m[m.None=
0]="None";m[m.View=1]="View";m[m.WindingOrder=2]="WindingOrder";m[m.COUNT=3]="COUNT"})(a.NormalsDoubleSidedMode||(a.NormalsDoubleSidedMode={}));a.Normals=function(m,l){m=m.fragment;m.code.add(c.glsl`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`);switch(l.doubleSidedMode){case a.NormalsDoubleSidedMode.None:m.code.add(c.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case a.NormalsDoubleSidedMode.View:m.code.add(c.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case a.NormalsDoubleSidedMode.WindingOrder:m.code.add(c.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:b.neverReached(l.doubleSidedMode);case a.NormalsDoubleSidedMode.COUNT:}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/mat3f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../ViewingMode ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/attributes/VertexNormal.glsl ../core/shaderLibrary/util/AlphaCutoff ../core/shaderLibrary/util/DoublePrecision.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/Material ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../../../../chunks/DefaultMaterial.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A){let p=function(y){function D(){var E=y.apply(this,arguments)||this;E.isSchematic=!1;E.usePBR=!1;E.mrrFactors=l.fromValues(0,1,.5);E.hasVertexColors=!1;E.hasSymbolColors=!1;E.doubleSided=!1;E.doubleSidedType="normal";E.cullFace=w.CullFaceOptions.Back;E.emissiveFactor=l.fromValues(0,0,0);E.instancedDoublePrecision=!1;E.normals="default";E.receiveSSAO=!0;E.receiveShadows=!0;E.castShadows=!0;E.shadowMappingEnabled=!1;E.ambient=l.fromValues(.2,.2,
.2);E.diffuse=l.fromValues(.8,.8,.8);E.externalColor=r.fromValues(1,1,1,1);E.colorMixMode="multiply";E.opacity=1;E.layerOpacity=1;E.origin=l.create();E.hasSlicePlane=!1;E.hasSliceHighlight=!0;E.offsetTransparentBackfaces=!1;E.vvSizeEnabled=!1;E.vvSizeMinSize=[1,1,1];E.vvSizeMaxSize=[100,100,100];E.vvSizeOffset=[0,0,0];E.vvSizeFactor=[1,1,1];E.vvSizeValue=[1,1,1];E.vvColorEnabled=!1;E.vvColorValues=[0,0,0,0,0,0,0,0];E.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0];
E.vvSymbolAnchor=[0,0,0];E.vvSymbolRotationMatrix=m.create();E.vvOpacityEnabled=!1;E.vvOpacityValues=[];E.vvOpacityOpacities=[];E.transparent=!1;E.writeDepth=!0;E.customDepthTest=w.DepthTestFunction.Less;E.textureAlphaMode=w.AlphaDiscardMode.Blend;E.textureAlphaCutoff=d.defaultMaskAlphaCutoff;E.textureAlphaPremultiplied=!1;E.hasOccludees=!1;E.renderOccluded=x.RenderOccludedFlag.Occlude;return E}c._inheritsLoose(D,y);return D}(f.VertexNormalPassParameters);f=function(y){function D(){var E=y.apply(this,
arguments)||this;E.origin=l.create();E.slicePlaneLocalOrigin=E.origin;return E}c._inheritsLoose(D,y);return D}(f.VertexNormalDrawParameters);v=function(y){function D(){return y.apply(this,arguments)||this}c._inheritsLoose(D,y);var E=D.prototype;E.initializeConfiguration=function(F,G){G.spherical=F.viewingMode===n.ViewingMode.Global;G.doublePrecisionRequiresObfuscation=e.doublePrecisionRequiresObfuscation(F.rctx);G.textureCoordinateType=G.hasColorTexture||G.hasMetalnessAndRoughnessTexture||G.hasEmissionTexture||
G.hasOcclusionTexture||G.hasNormalTexture?k.TextureCoordinateAttributeType.Default:k.TextureCoordinateAttributeType.None};E.initializeProgram=function(F){return this._initializeProgram(F,D.shader)};E._initializeProgram=function(F,G){G=G.get().build(this.configuration);return new q.Program(F.rctx,G,t.Default3D)};E._convertDepthTestFunction=function(F){return F===w.DepthTestFunction.Lequal?z.CompareFunction.LEQUAL:z.CompareFunction.LESS};E._setPipeline=function(F,G){const P=this.configuration,K=F===
w.TransparencyPassType.NONE,N=F===w.TransparencyPassType.FrontFace;return A.makePipelineState({blending:P.output!==g.ShaderOutput.Color&&P.output!==g.ShaderOutput.Alpha||!P.transparent?null:K?B.blendingDefault:B.oitBlending(F),culling:(P.cullFace!==w.CullFaceOptions.None?!0:P.hasSlicePlane?!1:!P.transparent&&!P.doubleSidedMode)&&A.cullingParams(P.cullFace),depthTest:{func:B.oitDepthTest(F,this._convertDepthTestFunction(P.customDepthTest))},depthWrite:K||N?P.writeDepth&&A.defaultDepthWriteParams:null,
colorWrite:A.defaultColorWriteParams,stencilWrite:P.hasOccludees?u.stencilWriteMaskOn:null,stencilTest:P.hasOccludees?G?u.stencilToolMaskBaseParams:u.stencilBaseAllZerosParams:null,polygonOffset:K||N?null:B.getOITPolygonOffset(P.enableOffset)})};E.initializePipeline=function(){this._occludeePipelineState=this._setPipeline(this.configuration.transparencyPassType,!0);return this._setPipeline(this.configuration.transparencyPassType,!1)};E.getPipelineState=function(F,G){return G?this._occludeePipelineState:
y.prototype.getPipelineState.call(this,F,G)};return D}(v.ShaderTechnique);v.shader=new h.ReloadableShaderModule(C.DefaultMaterial,()=>new Promise((y,D)=>a(["./DefaultMaterial.glsl"],y,D)));b.DefaultMaterialDrawParameters=f;b.DefaultMaterialPassParameters=p;b.DefaultMaterialTechnique=v;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/DefaultMaterial.glsl":function(){define("exports ../core/maybe ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/HeaderComment.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/basicInterfaces ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/lighting/SceneLighting".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N,M,L,J,H,I,O,Q,S,T){function U(W){const R=new I.ShaderBuilder,V=R.vertex.code,da=R.fragment.code;R.include(G.HeaderComment,{name:"Default Material Shader",output:W.output});const ca=K.addProjViewLocalOrigin(R,W);R.include(d.PositionAttribute);R.varyings.add("vpos","vec3");R.include(D.VisualVariables,W);R.include(k.InstancedDoublePrecision,W);R.include(t.VerticalOffset,W);if(W.output===r.ShaderOutput.Color||W.output===r.ShaderOutput.Alpha)K.addCameraPosition(R.vertex,
W),R.include(f.NormalAttribute,W),R.include(g.Transform,{linearDepth:!1,hasModelTransformation:W.hasModelTransformation}),W.normalType===f.NormalAttributeType.Attribute&&W.offsetBackfaces&&R.include(l.Offset),R.include(B.ComputeNormalTexture,W),R.include(w.VertexNormal,W),W.instancedColor&&R.attributes.add(S.VertexAttribute.INSTANCECOLOR,"vec4"),R.varyings.add("localvpos","vec3"),R.include(h.TextureCoordinateAttribute,W),R.include(m.ForwardLinearDepth,W),R.include(e.SymbolColor,W),R.include(v.VertexColor,
W),R.vertex.uniforms.add(new M.Float4PassUniform("externalColor",ha=>ha.externalColor)),R.varyings.add("vcolorExt","vec4"),W.hasMultipassTerrain&&R.varyings.add("depth","float"),W.hasModelTransformation&&R.vertex.uniforms.add(new H.Matrix4PassUniform("model",ha=>b.isSome(ha.modelTransformation)?ha.modelTransformation:c.IDENTITY)),V.add(J.glsl`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${W.instancedColor?"vcolorExt *\x3d instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${J.glsl.float(E.symbolAlphaCutoff)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${W.normalType===f.NormalAttributeType.Attribute?J.glsl`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${W.hasVertexTangents?"vTangent \x3d dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${W.hasModelTransformation?"model,":""} vpos);
          ${W.normalType===f.NormalAttributeType.Attribute&&W.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${W.hasMultipassTerrain?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
      }
    `);W.output===r.ShaderOutput.Alpha&&(R.include(n.SliceDraw,W),R.include(F.DiscardOrAdjustAlphaPass,W),R.include(C.multipassTerrainTest,W),R.fragment.uniforms.add([new L.FloatPassUniform("opacity",ha=>ha.opacity),new L.FloatPassUniform("layerOpacity",ha=>ha.layerOpacity)]),W.hasColorTexture&&R.fragment.uniforms.add(new O.Texture2DPassUniform("tex",ha=>ha.texture)),R.fragment.include(P.MixExternalColor),da.add(J.glsl`
      void main() {
        discardBySlice(vpos);
        ${W.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${W.hasColorTexture?J.glsl`
                vec4 texColor = texture2D(tex, vuv0);
                ${W.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:J.glsl`vec4 texColor = vec4(1.0);`}
        ${W.hasVertexColors?J.glsl`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:J.glsl`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        gl_FragColor = vec4(opacity_);
      }
    `));W.output===r.ShaderOutput.Color&&(R.include(n.SliceDraw,W),R.include(u.EvaluateSceneLighting,W),R.include(q.EvaluateAmbientOcclusion,W),R.include(F.DiscardOrAdjustAlphaPass,W),R.include(W.instancedDoublePrecision?y.ReadShadowMapPass:y.ReadShadowMapDraw,W),R.include(C.multipassTerrainTest,W),K.addCameraPosition(R.fragment,W),R.fragment.uniforms.add([ca,new N.Float3PassUniform("ambient",ha=>ha.ambient),new N.Float3PassUniform("diffuse",ha=>ha.diffuse),new L.FloatPassUniform("opacity",ha=>ha.opacity),
new L.FloatPassUniform("layerOpacity",ha=>ha.layerOpacity),new L.FloatPassUniform("lightingGlobalFactor",(ha,ia)=>ia.lighting.globalFactor),new N.Float3PassUniform("lightingMainIntensity",(ha,ia)=>ia.lighting.mainLight.intensity)]),R.fragment.constants.add("ambientBoostFactor","float",T.ambientBoost),W.hasColorTexture&&R.fragment.uniforms.add(new O.Texture2DPassUniform("tex",ha=>ha.texture)),R.include(p.PhysicallyBasedRenderingParameters,W),R.include(A.PhysicallyBasedRendering,W),R.fragment.include(P.MixExternalColor),
R.include(z.Normals,W),da.add(J.glsl`
      void main() {
        discardBySlice(vpos);
        ${W.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${W.hasColorTexture?J.glsl`
                vec4 texColor = texture2D(tex, vuv0);
                ${W.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:J.glsl`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${W.normalType===f.NormalAttributeType.ScreenDerivative?J.glsl`
                vec3 normal = screenDerivativeNormal(localvpos);`:J.glsl`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${W.pbrMode===p.PBRMode.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        ${W.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":W.spherical?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${W.hasVertexColors?J.glsl`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:J.glsl`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${W.hasNormalTexture?J.glsl`
                mat3 tangentSpace = ${W.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`:J.glsl`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${W.spherical?J.glsl`normalize(vpos + localOrigin);`:J.glsl`vec3(0.0, 0.0, 1.0);`}

        ${W.snowCover?J.glsl`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${W.pbrMode===p.PBRMode.Normal||W.pbrMode===p.PBRMode.Schematic?J.glsl`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
                ${W.snowCover?J.glsl`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:J.glsl`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${W.transparencyPassType===Q.TransparencyPassType.Color?J.glsl`gl_FragColor = premultiplyAlpha(gl_FragColor);`:""}
      }
    `));R.include(x.DefaultMaterialAuxiliaryPasses,W);return R}const aa=Object.freeze(Object.defineProperty({__proto__:null,build:U},Symbol.toStringTag,{value:"Module"}));a.DefaultMaterial=aa;a.build=U})},"esri/views/3d/webgl-engine/core/shaderLibrary/Offset.glsl":function(){define(["exports","../shaderModules/interfaces"],function(a,b){a.Offset=function(c){c.vertex.code.add(b.glsl`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl":function(){define("exports ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f64 ../ShaderOutputOptions ../util/DoublePrecision.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../../lib/VertexAttribute ../../../../../webgl/doublePrecisionUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f){const d=c.create();a.InstancedDoublePrecision=function(e,h){h.instanced&&h.instancedDoublePrecision&&(e.attributes.add(k.VertexAttribute.MODELORIGINHI,"vec3"),e.attributes.add(k.VertexAttribute.MODELORIGINLO,"vec3"),e.attributes.add(k.VertexAttribute.MODEL,"mat3"),e.attributes.add(k.VertexAttribute.MODELNORMAL,"mat3"));e=e.vertex;h.instancedDoublePrecision&&(e.include(l.DoublePrecision,h),e.uniforms.add(new r.Float3DrawUniform("viewOriginHi",(v,w)=>f.encodeDoubleHi(b.set(d,
w.camera.viewInverseTransposeMatrix[3],w.camera.viewInverseTransposeMatrix[7],w.camera.viewInverseTransposeMatrix[11]),d))),e.uniforms.add(new r.Float3DrawUniform("viewOriginLo",(v,w)=>f.encodeDoubleLo(b.set(d,w.camera.viewInverseTransposeMatrix[3],w.camera.viewInverseTransposeMatrix[7],w.camera.viewInverseTransposeMatrix[11]),d))));e.code.add(n.glsl`
    vec3 calculateVPos() {
      ${h.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `);e.code.add(n.glsl`
    vec3 subtractOrigin(vec3 _pos) {
      ${h.instancedDoublePrecision?n.glsl`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `);e.code.add(n.glsl`
    vec3 dpNormal(vec4 _normal) {
      ${h.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `);h.output===m.ShaderOutput.Normal&&(e.uniforms.add(new g.Matrix4PassUniform("viewNormal",(v,w)=>w.camera.viewInverseTransposeMatrix)),e.code.add(n.glsl`
    vec3 dpNormalView(vec4 _normal) {
      ${h.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `));h.hasVertexTangents&&e.code.add(n.glsl`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${h.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl":function(){define("exports ../../../collections/Component/Material/shader/DecodeSymbolColor.glsl ../../shaderModules/IntegerPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute ../../../materials/internal/MaterialUtil".split(" "),function(a,b,c,m,l,r){a.SymbolColor=function(n,g){g.hasSymbolColors?(n.include(b.DecodeSymbolColor),
n.attributes.add(l.VertexAttribute.SYMBOLCOLOR,"vec4"),n.varyings.add("colorMixMode","mediump float"),n.vertex.code.add(m.glsl`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(n.fragment.uniforms.add(new c.IntegerPassUniform("colorMixMode",k=>r.colorMixModes[k.colorMixMode])),n.vertex.code.add(m.glsl`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/DecodeSymbolColor.glsl":function(){define(["exports","../../../../../layers/support/symbolColorUtils","../../../../core/shaderModules/interfaces"],function(a,b,c){a.DecodeSymbolColor=function(m){m.vertex.code.add(c.glsl`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${c.glsl.int(b.ColorMixModeEnum.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${c.glsl.int(b.ColorMixModeEnum.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${c.glsl.int(b.ColorMixModeEnum.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${c.glsl.int(b.ColorMixModeEnum.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["exports","../../../../core/mathUtils","../../../../core/maybe"],function(a,b,c){a.ColorMixModeEnum=void 0;(function(m){m[m.Multiply=1]="Multiply";m[m.Ignore=2]="Ignore";m[m.Replace=3]="Replace";m[m.Tint=4]="Tint"})(a.ColorMixModeEnum||(a.ColorMixModeEnum={}));a.encodeSymbolColor=function(m,l,r){if(c.isNone(m)||l===a.ColorMixModeEnum.Ignore)r[0]=
255,r[1]=255,r[2]=255,r[3]=255;else{var n=b.clamp(Math.round(85*m[3]),0,85);l=0===n||l===a.ColorMixModeEnum.Tint?0:l===a.ColorMixModeEnum.Replace?85:170;r[0]=b.clamp(Math.round(255*m[0]),0,255);r[1]=b.clamp(Math.round(255*m[1]),0,255);r[2]=b.clamp(Math.round(255*m[2]),0,255);r[3]=n+l}};a.parseColorMixMode=function(m){switch(m){case "multiply":return a.ColorMixModeEnum.Multiply;case "ignore":return a.ColorMixModeEnum.Ignore;case "replace":return a.ColorMixModeEnum.Replace;case "tint":return a.ColorMixModeEnum.Tint;
default:return a.ColorMixModeEnum.Multiply}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c){a.VertexColor=function(m,l){l.hasVertexColors?(m.attributes.add(c.VertexAttribute.COLOR,"vec4"),m.varyings.add("vColor","vec4"),m.vertex.code.add(b.glsl`void forwardVertexColor() { vColor = color; }`),
m.vertex.code.add(b.glsl`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):m.vertex.code.add(b.glsl`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl":function(){define("exports ../ShaderOutputOptions ../Slice.glsl ../Transform.glsl ../attributes/NormalAttribute.glsl ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexNormal.glsl ../output/OutputDepth.glsl ../output/OutputHighlight.glsl ../shading/VisualVariables.glsl ../util/AlphaDiscard.glsl ../util/View.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w){a.DefaultMaterialAuxiliaryPasses=function(t,x){const B=t.vertex.code,q=t.fragment.code,u=x.hasModelTransformation;if(x.output===b.ShaderOutput.Depth||x.output===b.ShaderOutput.Shadow)e.addProjViewLocalOrigin(t,x),t.include(m.Transform,{linearDepth:!0,hasModelTransformation:u}),t.include(r.TextureCoordinateAttribute,x),t.include(f.VisualVariables,x),t.include(g.OutputDepth,x),t.include(c.SliceDraw,x),t.vertex.uniforms.add(new h.Float2PassUniform("nearFar",(C,
z)=>z.camera.nearFar)),t.varyings.add("depth","float"),x.hasColorTexture&&t.fragment.uniforms.add(new w.Texture2DPassUniform("tex",C=>C.texture)),B.add(v.glsl`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPositionWithDepth(proj, view, ${u?"model,":""} vpos, nearFar, depth);
        forwardTextureCoordinates();
      }
    `),t.include(d.DiscardOrAdjustAlphaPass,x),q.add(v.glsl`
      void main(void) {
        discardBySlice(vpos);
        ${x.hasColorTexture?v.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputDepth(depth);
      }
    `);x.output===b.ShaderOutput.Normal&&(e.addProjViewLocalOrigin(t,x),t.include(m.Transform,{linearDepth:!1,hasModelTransformation:u}),t.include(l.NormalAttribute,x),t.include(n.VertexNormal,x),t.include(r.TextureCoordinateAttribute,x),t.include(f.VisualVariables,x),x.hasColorTexture&&t.fragment.uniforms.add(new w.Texture2DPassUniform("tex",C=>C.texture)),t.varyings.add("vPositionView","vec3"),B.add(v.glsl`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        ${x.normalType===l.NormalAttributeType.Attribute?v.glsl`
        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${u?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),t.include(c.SliceDraw,x),t.include(d.DiscardOrAdjustAlphaPass,x),q.add(v.glsl`
      void main() {
        discardBySlice(vpos);
        ${x.hasColorTexture?v.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}

        ${x.normalType===l.NormalAttributeType.ScreenDerivative?v.glsl`
            vec3 normal = screenDerivativeNormal(vPositionView);`:v.glsl`
            vec3 normal = normalize(vNormalWorld);
            if (gl_FrontFacing == false) normal = -normal;`}
        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
      }
    `));x.output===b.ShaderOutput.Highlight&&(e.addProjViewLocalOrigin(t,x),t.include(m.Transform,{linearDepth:!1,hasModelTransformation:u}),t.include(r.TextureCoordinateAttribute,x),t.include(f.VisualVariables,x),x.hasColorTexture&&t.fragment.uniforms.add(new w.Texture2DPassUniform("tex",C=>C.texture)),B.add(v.glsl`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${u?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),t.include(c.SliceDraw,x),t.include(d.DiscardOrAdjustAlphaPass,x),t.include(k.OutputHighlight),q.add(v.glsl`
      void main() {
        discardBySlice(vpos);
        ${x.hasColorTexture?v.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputHighlight();
      }
    `))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl":function(){define("exports ./DiscardOrAdjustAlphaBlend.glsl ../../shaderModules/FloatDrawUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lib/basicInterfaces".split(" "),function(a,b,c,m,l,r){function n(g,k,f){const d=g.fragment;k.alphaDiscardMode!==r.AlphaDiscardMode.Mask&&k.alphaDiscardMode!==
r.AlphaDiscardMode.MaskBlend||d.uniforms.add(f);switch(k.alphaDiscardMode){case r.AlphaDiscardMode.Blend:return g.include(b.DiscardOrAdjustAlphaBlend);case r.AlphaDiscardMode.Opaque:d.code.add(l.glsl`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case r.AlphaDiscardMode.Mask:d.code.add(l.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case r.AlphaDiscardMode.MaskBlend:g.fragment.code.add(l.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}a.DiscardOrAdjustAlphaDraw=function(g,k){n(g,k,new c.FloatDrawUniform("textureAlphaCutoff",f=>f.textureAlphaCutoff))};a.DiscardOrAdjustAlphaPass=function(g,k){n(g,k,new m.FloatPassUniform("textureAlphaCutoff",
f=>f.textureAlphaCutoff))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DiscardOrAdjustAlphaBlend.glsl":function(){define(["exports","./AlphaCutoff","../../shaderModules/interfaces"],function(a,b,c){a.DiscardOrAdjustAlphaBlend=function(m){m.fragment.code.add(c.glsl`
    #define discardOrAdjustAlpha(color) { if (color.a < ${c.glsl.float(b.symbolAlphaCutoff)}) { discard; } }
  `)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatDrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,m){c=function(l){function r(n,g){return l.call(this,n,"float",m.BindType.Draw,(k,f,d)=>k.setUniform1f(n,g(f,d)))||this}b._inheritsLoose(r,l);return r}(c.Uniform);a.FloatDrawUniform=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl":function(){define("exports ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexTextureCoordinates.glsl ./Normals.glsl ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../shaderModules/Texture2DPassUniform ../../shaderTechnique/BindType ../../../lib/VertexAttribute".split(" "),function(a,b,c,m,l,r,n,g,k){a.ComputeNormalTexture=
function(f,d){const e=f.fragment;d.hasVertexTangents?(f.attributes.add(k.VertexAttribute.TANGENT,"vec4"),f.varyings.add("vTangent","vec4"),d.doubleSidedMode===m.NormalsDoubleSidedMode.WindingOrder?e.code.add(l.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):e.code.add(l.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(f.extensions.add("GL_OES_standard_derivatives"),e.code.add(l.glsl`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`));d.textureCoordinateType!==b.TextureCoordinateAttributeType.None&&(f.include(c.VertexTextureCoordinates,d),f=d.supportsTextureAtlas,e.uniforms.add(d.pbrTextureBindType===g.BindType.Pass?n.createTexture2DPassSizeUniforms("normalTexture",h=>h.textureNormal,f):r.createTexture2DDrawSizeUniforms("normalTexture",h=>h.textureNormal,f)),e.code.add(l.glsl`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${d.supportsTextureAtlas?"vtc.size \x3d normalTextureSize;":""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl":function(){define("exports ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,c,m,l,r){const n=c.create();a.EvaluateAmbientOcclusion=function(g,k){g=g.fragment;k.receiveAmbientOcclusion?
(g.uniforms.add([new r.Texture2DPassUniform("ssaoTex",(f,d)=>d.ssaoHelper.colorTexture),new m.Float4PassUniform("viewportPixelSz",(f,d)=>b.set(n,d.camera.fullViewport[0],d.camera.fullViewport[1],1/d.ssaoHelper.width,1/d.ssaoHelper.height))]),g.code.add(l.glsl`float evaluateAmbientOcclusion() {
return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}
float evaluateAmbientOcclusionInverse() {
return texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}`)):g.code.add(l.glsl`float evaluateAmbientOcclusion() { return 0.0; }
float evaluateAmbientOcclusionInverse() { return 1.0; }`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl":function(){define("exports ./EvaluateAmbientLighting.glsl ./EvaluateAmbientOcclusion.glsl ./MainLighting.glsl ./PhysicallyBasedRendering.glsl ./PhysicallyBasedRenderingParameters.glsl ./PiUtils.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lighting/SceneLighting".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e){a.EvaluateSceneLighting=function(h,v){const w=h.fragment;h.include(c.EvaluateAmbientOcclusion,v);v.pbrMode!==r.PBRMode.Disabled&&h.include(l.PhysicallyBasedRendering,v);h.include(b.EvaluateAmbientLighting,v);w.constants.add("ambientBoostFactor","float",e.ambientBoost);h.include(n.PiUtils);w.code.add(d.glsl`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${v.pbrMode===r.PBRMode.Disabled?"":"const vec3 GROUND_REFLECTANCE \x3d vec3(0.2);"}
  `);w.uniforms.add(new k.Float3PassUniform("lightingMainDirection",(t,x)=>x.lighting.lightingMainDirection));w.code.add(d.glsl`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${v.spherical?d.glsl`normalize(vPosWorld)`:d.glsl`vec3(0.0, 0.0, 1.0)`}, lightingMainDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `);w.uniforms.add([new f.FloatPassUniform("lightingGlobalFactor",(t,x)=>x.lighting.globalFactor),new k.Float3PassUniform("lightingMainIntensity",(t,x)=>x.lighting.mainLight.intensity)]);w.code.add(d.glsl`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;
}`);if(v.pbrMode===r.PBRMode.Disabled||v.pbrMode===r.PBRMode.WaterOnIntegratedMesh)h.include(m.MainLighting,v),w.code.add(d.glsl`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);else if(v.pbrMode===r.PBRMode.Normal||v.pbrMode===r.PBRMode.Schematic)w.code.add(d.glsl`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 mainLightDirection = lightingMainDirection;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),w.code.add(d.glsl`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),v.useFillLights?w.uniforms.add(new g.BooleanPassUniform("hasFillLights",(t,x)=>x.enableFillLights)):w.constants.add("hasFillLights","bool",!1),w.code.add(d.glsl`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),w.uniforms.add([new f.FloatPassUniform("lightingSpecularStrength",(t,x)=>x.lighting.mainLight.specularStrength),new f.FloatPassUniform("lightingEnvironmentStrength",(t,x)=>x.lighting.mainLight.environmentStrength)]),w.code.add(d.glsl`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),w.code.add(d.glsl`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${v.pbrMode===r.PBRMode.Schematic?d.glsl`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:d.glsl`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/HeaderComment.glsl":function(){define(["exports","../ShaderOutputOptions","../../shaderModules/interfaces","../../../../../webgl/checkWebGLError"],function(a,b,c,m){a.HeaderComment=function(l,r){r=c.glsl`
  /*
  *  ${r.name}
  *  ${r.output===b.ShaderOutput.Color?"RenderOutput: Color":r.output===b.ShaderOutput.Depth?"RenderOutput: Depth":r.output===b.ShaderOutput.Shadow?"RenderOutput: Shadow":r.output===b.ShaderOutput.Normal?"RenderOutput: Normal":r.output===b.ShaderOutput.Highlight?"RenderOutput: Highlight":""}
  */
  `;m.webglValidateShadersEnabled()&&(l.fragment.code.add(r),l.vertex.code.add(r))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl":function(){define(["exports","../../../../layers/support/symbolColorUtils","./ColorConversion.glsl","../../shaderModules/interfaces"],function(a,b,c,m){a.MixExternalColor=function(l){l.include(c.ColorConversion);l.code.add(m.glsl`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${m.glsl.int(b.ColorMixModeEnum.Multiply)}) {
        return allMixed;
      }
      if (mode == ${m.glsl.int(b.ColorMixModeEnum.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${m.glsl.int(b.ColorMixModeEnum.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${m.glsl.int(b.ColorMixModeEnum.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${m.glsl.int(b.ColorMixModeEnum.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){d=function(e){function h(){var v=e.apply(this,arguments)||this;v.output=m.ShaderOutput.Color;v.alphaDiscardMode=f.AlphaDiscardMode.Opaque;v.doubleSidedMode=n.NormalsDoubleSidedMode.None;v.pbrMode=g.PBRMode.Disabled;v.cullFace=f.CullFaceOptions.None;v.transparencyPassType=f.TransparencyPassType.NONE;v.normalType=l.NormalAttributeType.Attribute;v.textureCoordinateType=r.TextureCoordinateAttributeType.None;v.customDepthTest=f.DepthTestFunction.Less;v.spherical=!1;v.hasVertexColors=
!1;v.hasSymbolColors=!1;v.hasVerticalOffset=!1;v.hasSlicePlane=!1;v.hasSliceHighlight=!0;v.hasColorTexture=!1;v.hasMetalnessAndRoughnessTexture=!1;v.hasEmissionTexture=!1;v.hasOcclusionTexture=!1;v.hasNormalTexture=!1;v.hasScreenSizePerspective=!1;v.hasVertexTangents=!1;v.hasOccludees=!1;v.hasMultipassTerrain=!1;v.hasModelTransformation=!1;v.offsetBackfaces=!1;v.vvSize=!1;v.vvColor=!1;v.receiveShadows=!1;v.receiveAmbientOcclusion=!1;v.textureAlphaPremultiplied=!1;v.instanced=!1;v.instancedColor=!1;
v.instancedDoublePrecision=!1;v.doublePrecisionRequiresObfuscation=!1;v.writeDepth=!0;v.transparent=!1;v.enableOffset=!0;v.cullAboveGround=!1;v.snowCover=!1;return v}b._inheritsLoose(h,e);return h}(d.DefaultTechniqueConfiguration);c.__decorate([k.parameter({count:m.ShaderOutput.COUNT})],d.prototype,"output",void 0);c.__decorate([k.parameter({count:f.AlphaDiscardMode.COUNT})],d.prototype,"alphaDiscardMode",void 0);c.__decorate([k.parameter({count:n.NormalsDoubleSidedMode.COUNT})],d.prototype,"doubleSidedMode",
void 0);c.__decorate([k.parameter({count:g.PBRMode.COUNT})],d.prototype,"pbrMode",void 0);c.__decorate([k.parameter({count:f.CullFaceOptions.COUNT})],d.prototype,"cullFace",void 0);c.__decorate([k.parameter({count:f.TransparencyPassType.COUNT})],d.prototype,"transparencyPassType",void 0);c.__decorate([k.parameter({count:l.NormalAttributeType.COUNT})],d.prototype,"normalType",void 0);c.__decorate([k.parameter({count:r.TextureCoordinateAttributeType.COUNT})],d.prototype,"textureCoordinateType",void 0);
c.__decorate([k.parameter({count:f.DepthTestFunction.COUNT})],d.prototype,"customDepthTest",void 0);c.__decorate([k.parameter()],d.prototype,"spherical",void 0);c.__decorate([k.parameter()],d.prototype,"hasVertexColors",void 0);c.__decorate([k.parameter()],d.prototype,"hasSymbolColors",void 0);c.__decorate([k.parameter()],d.prototype,"hasVerticalOffset",void 0);c.__decorate([k.parameter()],d.prototype,"hasSlicePlane",void 0);c.__decorate([k.parameter()],d.prototype,"hasSliceHighlight",void 0);c.__decorate([k.parameter()],
d.prototype,"hasColorTexture",void 0);c.__decorate([k.parameter()],d.prototype,"hasMetalnessAndRoughnessTexture",void 0);c.__decorate([k.parameter()],d.prototype,"hasEmissionTexture",void 0);c.__decorate([k.parameter()],d.prototype,"hasOcclusionTexture",void 0);c.__decorate([k.parameter()],d.prototype,"hasNormalTexture",void 0);c.__decorate([k.parameter()],d.prototype,"hasScreenSizePerspective",void 0);c.__decorate([k.parameter()],d.prototype,"hasVertexTangents",void 0);c.__decorate([k.parameter()],
d.prototype,"hasOccludees",void 0);c.__decorate([k.parameter()],d.prototype,"hasMultipassTerrain",void 0);c.__decorate([k.parameter()],d.prototype,"hasModelTransformation",void 0);c.__decorate([k.parameter()],d.prototype,"offsetBackfaces",void 0);c.__decorate([k.parameter()],d.prototype,"vvSize",void 0);c.__decorate([k.parameter()],d.prototype,"vvColor",void 0);c.__decorate([k.parameter()],d.prototype,"receiveShadows",void 0);c.__decorate([k.parameter()],d.prototype,"receiveAmbientOcclusion",void 0);
c.__decorate([k.parameter()],d.prototype,"textureAlphaPremultiplied",void 0);c.__decorate([k.parameter()],d.prototype,"instanced",void 0);c.__decorate([k.parameter()],d.prototype,"instancedColor",void 0);c.__decorate([k.parameter()],d.prototype,"instancedDoublePrecision",void 0);c.__decorate([k.parameter()],d.prototype,"doublePrecisionRequiresObfuscation",void 0);c.__decorate([k.parameter()],d.prototype,"writeDepth",void 0);c.__decorate([k.parameter()],d.prototype,"transparent",void 0);c.__decorate([k.parameter()],
d.prototype,"enableOffset",void 0);c.__decorate([k.parameter()],d.prototype,"cullAboveGround",void 0);c.__decorate([k.parameter()],d.prototype,"snowCover",void 0);c.__decorate([k.parameter({constValue:!0})],d.prototype,"hasVvInstancing",void 0);c.__decorate([k.parameter({constValue:!1})],d.prototype,"useCustomDTRExponentForWater",void 0);c.__decorate([k.parameter({constValue:!1})],d.prototype,"supportsTextureAtlas",void 0);c.__decorate([k.parameter({constValue:!0})],d.prototype,"useFillLights",void 0);
a.DefaultMaterialTechniqueConfiguration=d;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/RealisticTreeTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderTechnique/ReloadableShaderModule ./DefaultMaterialTechnique ../../../../chunks/RealisticTree.glsl".split(" "),function(a,
b,c,m,l,r,n,g){n=function(k){function f(){return k.apply(this,arguments)||this}c._inheritsLoose(f,k);var d=f.prototype;d.initializeConfiguration=function(e,h){k.prototype.initializeConfiguration.call(this,e,h);h.hasMetalnessAndRoughnessTexture=!1;h.hasEmissionTexture=!1;h.hasOcclusionTexture=!1;h.hasNormalTexture=!1;h.hasModelTransformation=!1;h.normalType=m.NormalAttributeType.Attribute;h.doubleSidedMode=l.NormalsDoubleSidedMode.WindingOrder;h.hasVertexTangents=!1};d.initializeProgram=function(e){return this._initializeProgram(e,
f.shader)};return f}(n.DefaultMaterialTechnique);n.shader=new r.ReloadableShaderModule(g.RealisticTree,()=>new Promise((k,f)=>a(["./RealisticTree.glsl"],k,f)));b.RealisticTreeTechnique=n;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/RealisticTree.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4Uniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/basicInterfaces ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/lighting/SceneLighting".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N,M,L,J){function H(O){const Q=new K.ShaderBuilder,S=Q.vertex.code,T=Q.fragment.code,U=y.addProjViewLocalOrigin(Q,O);Q.include(k.PositionAttribute);Q.varyings.add("vpos","vec3");Q.include(C.VisualVariables,O);Q.include(n.InstancedDoublePrecision,O);Q.include(h.VerticalOffset,O);if(O.output===m.ShaderOutput.Color||O.output===m.ShaderOutput.Alpha)y.addCameraPosition(Q.vertex,O),Q.include(g.NormalAttribute,O),Q.include(r.Transform),
O.offsetBackfaces&&Q.include(c.Offset),O.instancedColor&&Q.attributes.add(L.VertexAttribute.INSTANCECOLOR,"vec4"),Q.varyings.add("vNormalWorld","vec3"),Q.varyings.add("localvpos","vec3"),O.hasMultipassTerrain&&Q.varyings.add("depth","float"),Q.include(d.TextureCoordinateAttribute,O),Q.include(b.ForwardLinearDepth,O),Q.include(f.SymbolColor,O),Q.include(e.VertexColor,O),Q.vertex.uniforms.add(new E.Float4PassUniform("externalColor",aa=>aa.externalColor)),Q.varyings.add("vcolorExt","vec4"),S.add(G.glsl`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${O.instancedColor?"vcolorExt *\x3d instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${G.glsl.float(z.symbolAlphaCutoff)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${O.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${O.hasMultipassTerrain?G.glsl`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `);O.output===m.ShaderOutput.Alpha&&(Q.include(l.SliceDraw,O),Q.include(A.DiscardOrAdjustAlphaPass,O),Q.include(x.multipassTerrainTest,O),Q.fragment.uniforms.add([new F.FloatPassUniform("opacity",aa=>aa.opacity),new F.FloatPassUniform("layerOpacity",aa=>aa.layerOpacity),new P.Matrix4Uniform("view")]),O.hasColorTexture&&Q.fragment.uniforms.add(new N.Texture2DPassUniform("tex",aa=>aa.texture)),Q.fragment.include(p.MixExternalColor),T.add(G.glsl`
      void main() {
        discardBySlice(vpos);
        ${O.hasMultipassTerrain?G.glsl`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${O.hasColorTexture?G.glsl`
                vec4 texColor = texture2D(tex, vuv0);
                ${O.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:G.glsl`vec4 texColor = vec4(1.0);`}
        ${O.hasVertexColors?G.glsl`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:G.glsl`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        gl_FragColor = vec4(opacity_);
      }
    `));O.output===m.ShaderOutput.Color&&(Q.include(l.SliceDraw,O),Q.include(t.EvaluateSceneLighting,O),Q.include(w.EvaluateAmbientOcclusion,O),Q.include(A.DiscardOrAdjustAlphaPass,O),Q.include(O.instancedDoublePrecision?u.ReadShadowMapPass:u.ReadShadowMapDraw,O),Q.include(x.multipassTerrainTest,O),y.addCameraPosition(Q.fragment,O),Q.fragment.uniforms.add([U,new D.Float3PassUniform("ambient",aa=>aa.ambient),new D.Float3PassUniform("diffuse",aa=>aa.diffuse),new F.FloatPassUniform("opacity",aa=>aa.opacity),
new F.FloatPassUniform("layerOpacity",aa=>aa.layerOpacity),new P.Matrix4Uniform("view"),new F.FloatPassUniform("lightingGlobalFactor",(aa,W)=>W.lighting.globalFactor),new D.Float3PassUniform("lightingMainIntensity",(aa,W)=>W.lighting.mainLight.intensity)]),Q.fragment.constants.add("ambientBoostFactor","float",J.ambientBoost),O.hasColorTexture&&Q.fragment.uniforms.add(new N.Texture2DPassUniform("tex",aa=>aa.texture)),Q.include(q.PhysicallyBasedRenderingParameters,O),Q.include(B.PhysicallyBasedRendering,
O),Q.fragment.include(p.MixExternalColor),Q.extensions.add("GL_OES_standard_derivatives"),T.add(G.glsl`
      void main() {
        discardBySlice(vpos);
        ${O.hasMultipassTerrain?G.glsl`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${O.hasColorTexture?G.glsl`
                vec4 texColor = texture2D(tex, vuv0);
                ${O.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:G.glsl`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${O.pbrMode===q.PBRMode.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${O.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":O.spherical?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${O.hasVertexColors?G.glsl`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:G.glsl`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${O.snowCover?G.glsl`albedo = mix(albedo, vec3(1), 0.9);`:G.glsl``}
        ${G.glsl`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -lightingMainDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * lightingMainIntensity;`}
        ${O.pbrMode===q.PBRMode.Normal||O.pbrMode===q.PBRMode.Schematic?O.spherical?G.glsl`vec3 normalGround = normalize(vpos + localOrigin);`:G.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:G.glsl``}
        ${O.pbrMode===q.PBRMode.Normal||O.pbrMode===q.PBRMode.Schematic?G.glsl`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
                ${O.snowCover?G.glsl`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:G.glsl`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${O.transparencyPassType===M.TransparencyPassType.Color?G.glsl`gl_FragColor = premultiplyAlpha(gl_FragColor);`:G.glsl``}
      }
    `));Q.include(v.DefaultMaterialAuxiliaryPasses,O);return Q}const I=Object.freeze(Object.defineProperty({__proto__:null,build:H},Symbol.toStringTag,{value:"Module"}));a.RealisticTree=I;a.build=H})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../symbols ../../../../core/asyncUtils ../../../../core/Error ../../../../core/has ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../support/arcadeOnDemand ../../../../symbols/support/IconSymbol3DLayerResource ../../../../symbols/support/utils ../../../2d/arcade/callExpressionWithFeature ./constants ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./placementUtils ./pointUtils ./sdfPrimitives ../support/FastSymbolUpdates ../../terrain/OverlayRenderer ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial ../../../../symbols/CIMSymbol".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N,M,L,J,H,I,O,Q,S,T,U,aa){function W(ka){return k.isNone(ka)?!1:"cross"===ka||"x"===ka}const R=h.create(),V=w.fromValues(0,0,1);l=J.DEFAULT_TEX_SIZE;const da=J.DEFAULT_SYMBOL_SIZE_RATIO,ca=[da/2,da/2,1-da/2,1-da/2];l=[l*da,l*da];P=function(ka){function la(ea,ba,Z,fa){ea=ka.call(this,ea,ba,Z,fa)||this;ea._cimLayers=null;ea._cimSymbolMaterials=new Map;ea._cimSymbolTextures=new Map;ea._cimMaterialParametersInfo=null;ea._cimRequiredFields=
null;ea._cimScaleFactorOrFunction=null;ea._size=null;ea._symbolTextureRatio=1;ea._outlineSize=0;ea._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0};return ea}c._inheritsLoose(la,ka);var Y=la.prototype;Y.getCachedSize=function(){return{size:this._getIconSize()}};Y.doLoad=function(){var ea=c._asyncToGenerator(function*(ba){this._validateOrThrow();const Z=this._prepareMaterialParameters();var fa=this._getPrimitive();if(k.isSome(fa))this._prepareResourcesPrimitive(Z,fa);else{fa=
z.getIconHref(this.symbol,this.symbolLayer);const ja=e.dataComponents(fa);ja&&"application/json"===ja.mediaType?yield this._prepareResourcesCIM(Z,JSON.parse(ja.data),ba):yield this._prepareResourcesHref(Z,fa,ba)}});return function(ba){return ea.apply(this,arguments)}}();Y._validateOrThrow=function(){if(!this._drivenProperties.size){var ea=K.validateSymbolLayerSize(this._getIconSize());if(ea)throw new n("graphics3diconsymbollayer:invalid-size",ea);}};Y._getIconSize=function(){var ea=this.symbolLayer;
ea=Math.round(null!=ea.size?d.pt2px(ea.size):16);return this._drivenProperties.size?Math.max(ea,64):ea};Y._generateTextureCIM=function(ea){const ba=this._getGraphicHash(ea);let Z=""===ba?null:this._cimSymbolTextures.get(ba);Z||(ea=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,ea,"esriGeometryPoint",{scaleFactor:this._cimScaleFactorOrFunction},null,null),this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",ea.anchorPosition),Z=new T.Texture(ea.imageData,
{width:ea.imageData.width,height:ea.imageData.height,powerOfTwoResizeMode:O.PowerOfTwoResizeMode.PAD}),this._cimSymbolTextures.set(ba,Z),this._context.stage.add(Z));return Z};Y._computeSize=function(ea,ba){ea=ea.width/ea.height;return 1<ea?[ba,Math.round(ba/ea)]:[Math.round(ba*ea),ba]};Y._prepareMaterialParameters=function(){const ea={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},ba=this.symbol;if(ba&&"point-3d"===ba.type&&ba.hasVisibleVerticalOffset()){const {screenLength:Z,
minWorldLength:fa,maxWorldLength:ja}=ba.verticalOffset;ea.verticalOffset={screenLength:d.pt2px(Z),minWorldLength:fa||0,maxWorldLength:null!=ja?ja:Infinity}}this._context.screenSizePerspectiveEnabled&&(ea.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);ea.occlusionTest=!0;ea.hasSlicePlane=this._context.slicePlaneEnabled;return ea};Y._prepareResourcesPrimitive=function(ea,ba){var Z=this._getOutlineSize();if(W(ba)&&0===Z)throw Error("Nothing to render");this._outlineSize=
Z;ea.color=this._getFillColor();ea.outlineColor=this._getOutlineColor();ea.outlineSize=this._outlineSize;Z=this._context.sharedResources.textures.fromData(ba,()=>J.createTexture(ba));this._texture=Z.texture;this._releaseTexture=Z;ea.textureIsSignedDistanceField=!0;ea.distanceFieldBoundingBox=ca;ea.textureId=this._texture.id;Z=this._getIconSize();this._size=[Z,Z];this._symbolTextureRatio=1/da;this._createMaterialAndAddToStage(ea,this._context.stage)};Y._prepareResourcesHref=function(){var ea=c._asyncToGenerator(function*(ba,
Z,fa){if(!g("esri-canvas-svg-support")&&e.isSVG(Z))throw new n("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");this._outlineSize=this._getOutlineSize();ba.color=this._getFillColor();ba.outlineColor=this._getOutlineColor();ba.outlineSize=this._outlineSize;ba.textureIsSignedDistanceField=!1;const ja=this._getIconSize();fa=yield r.result(this._context.sharedResources.textures.fromUrl(Z,ja*this._context.graphicsCoreOwner.view.state.pixelRatio,
{signal:fa}));if(!1===fa.ok)throw f.throwIfAbortError(fa.error),new n("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${Z})`);this._releaseTexture=fa.value;Z=fa.value.texture;this._size=this._computeSize(Z.params,ja);ba.textureId=Z.id;this._createMaterialAndAddToStage(ba,this._context.stage)});return function(ba,Z,fa){return ea.apply(this,arguments)}}();Y._prepareResourcesCIM=function(){var ea=c._asyncToGenerator(function*(ba,Z,fa){Z=new aa({data:Z});
if(!this._context.sharedResources.cimSymbolRasterizer){var ja=(yield new Promise((Ha,Ga)=>a(["../../../../symbols/cim/CIMSymbolRasterizer"],Ha,Ga))).CIMSymbolRasterizer;f.throwIfAborted(fa);this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new ja(this._context.renderCoordsHelper.spatialReference,!0))}ja=this._context.layer.fields?this._context.layer.fields.map(Ha=>Ha.toJSON()):null;this._cimLayers=yield this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(Z,
ja,this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:fa});let oa;if(this._context.renderer&&"dictionary"===this._context.renderer.type&&this._context.renderer.scaleExpression)if(Z=this._context.renderer,isNaN(Z.scaleExpression)){const Ha=yield u.createRendererExpression(Z.scaleExpression,this._context.layer.spatialReference,ja);oa=(Ga,pa,Da)=>{Ga=A(Ha,Ga,{$view:Da},"esriGeometryPoint",pa);return null!==Ga?Ga:1}}else var sa=
Number(Z.scaleExpression);this._cimScaleFactorOrFunction=sa||oa||1;sa=this._context.renderer?yield this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];f.throwIfAborted(fa);const qa=this._context.layer.fieldsIndex;this._cimRequiredFields=sa.map(Ha=>qa.get(Ha).name);this._cimMaterialParametersInfo=ba;this._cimMaterialParametersInfo.color=this._getFillColor();this._cimMaterialParametersInfo.outlineColor=[0,0,0,0];this._cimMaterialParametersInfo.outlineSize=0;this._cimMaterialParametersInfo.textureIsSignedDistanceField=
!1});return function(ba,Z,fa){return ea.apply(this,arguments)}}();Y._getPrimitive=function(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||C.defaultPrimitive};Y._getOutlineSize=function(){var ea=0;ea=this.symbolLayer;if(k.isSome(ea.outline)&&null!=ea.outline.size)return Math.max(d.pt2px(ea.outline.size),0);ea=this._getPrimitive();ea=W(ea)?1.5:0;return Math.max(ea,0)};Y._getOutlineColor=function(){const ea=this._getLayerOpacity(),
ba=k.get(this.symbolLayer,"outline","color");if(k.isSome(ba)){const Z=m.toUnitRGB(ba);return[Z[0],Z[1],Z[2],ba.a*ea]}return[0,0,0,0]};Y._getFillColor=function(){if(W(this._getPrimitive()))return p.TRANSPARENT_UNIT;const ea=k.isNone(this._getPrimitive()),ba=k.get(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(ba,{hasIntrinsicColor:ea})};Y._getAnchorPos=function(ea,ba){return"relative"===ea?v.fromValues((ba.x||0)+.5,-(ba.y||0)+.5):ea in M.namedAnchorToHUDMaterialAnchorPos?
M.namedAnchorToHUDMaterialAnchorPos[ea]:M.namedAnchorToHUDMaterialAnchorPos.center};Y._createMaterialAndAddToStage=function(ea,ba){this._fastUpdates=this._cimLayers?{enabled:!1}:H.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled&&Object.assign(ea,this._fastUpdates.materialParameters);if(this._cimLayers){let Z=k.isSome(ea.textureId)?this._cimSymbolMaterials.get(ea.textureId):null;Z||(Z=new U.HUDMaterial(ea),this._cimSymbolMaterials.set(k.unwrapOr(ea.textureId,
0),Z),ba.add(Z));return Z}this._material=new U.HUDMaterial(ea);ba.add(this._material);return this._material};Y._setDrapingDependentMaterialParameters=function(){this.draped&&(this._forEachMaterial(ea=>{ea.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())};Y.destroy=function(){ka.prototype.destroy.call(this);this._forEachMaterial(ea=>this._context.stage.remove(ea));this._material=
null;this._cimSymbolMaterials.clear();this._cimSymbolTextures.forEach(ea=>this._context.stage.remove(ea));this._cimSymbolTextures.clear();this._releaseTexture=k.releaseMaybe(this._releaseTexture)};Y._getScaleFactor=function(ea,ba){if(this._drivenProperties.size&&ea.size){for(let Z=0;3>Z;Z++){const fa=ea.size[Z];fa&&"symbol-value"!==fa&&"proportional"!==fa&&(ea.size[Z]=d.pt2px(fa))}if("symbol-value"===ea.size[0])return 1;if(isFinite(+ea.size[0]))return+ea.size[0]/ba;if(isFinite(+ea.size[2]))return+ea.size[2]/
ba}return 1};Y.createGraphics3DGraphic=function(ea){const ba=ea.graphic;if(!this._validateGeometry(ba.geometry))return null;let Z;if(this._cimLayers){if(!this._cimLayers.length)return null;var fa=this._generateTextureCIM(ba);Z=this._createMaterialAndAddToStage({textureId:fa.id,...this._cimMaterialParametersInfo},this._context.stage);var ja=[fa.params.width,fa.params.height]}else ja=this._size,Z=k.unwrap(this._material);fa=L.placePointOnGeometry(ba.geometry);if(k.isNone(fa))return this.logger.warn(`unsupported geometry type for icon symbol: ${ba.geometry.type}`),
null;var oa=ea.renderingInfo;const sa=this._getVertexOpacityAndColor(oa);let qa=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(qa=this._getScaleFactor(oa,ja[0]>ja[1]?ja[0]:ja[1]));qa*=this._symbolTextureRatio;ja=[ja[0]*qa,ja[1]*qa];oa=this.setGraphicElevationContext(ba,new E.ElevationContext);this.ensureDrapedStatus("on-the-ground"===oa.mode)&&this._setDrapingDependentMaterialParameters();return this.draped?this._createAsOverlay(ba,fa,Z,sa,ja,ea.layer.uid):this._createAs3DShape(ba,
fa,Z,sa,ja,oa,ba.uid)};Y.layerOpacityChanged=function(){const ea=this._getFillColor(),ba=this._getOutlineColor();this._forEachMaterial(Z=>{Z.setParameters({color:ea});Z.setParameters({outlineColor:ba})});return!0};Y.layerElevationInfoChanged=function(ea,ba,Z){const fa=this._elevationContext.mode;Z=D.elevationModeChangeUpdateType(la.elevationModeChangeTypes,Z,fa);if(Z!==D.SymbolUpdateType.UPDATE)return Z;const ja=D.needsElevationUpdates2D(fa)||"absolute-height"===fa;return this.updateGraphics3DGraphicElevationInfo(ea,
ba,()=>ja)};Y.slicePlaneEnabledChanged=function(){this.draped||this._forEachMaterial(ea=>{ea.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});return!0};Y.physicalBasedRenderingChanged=function(){return!0};Y.pixelRatioChanged=function(){return this._getPrimitive()?!0:!1};Y.applyRendererDiff=function(ea,ba){for(const Z in ea.diff)switch(Z){case "visualVariables":if(H.updateFastSymbolUpdatesState(this._fastUpdates,ba,this._fastVisualVariableConvertOptions()))k.isSome(this._material)&&
this._material.setParameters(this._fastUpdates.materialParameters);else return N.ApplyRendererDiffResult.Recreate_Symbol;break;default:return N.ApplyRendererDiffResult.Recreate_Symbol}return N.ApplyRendererDiffResult.Fast_Update};Y._defaultElevationInfoNoZ=function(){return ha};Y._createAs3DShape=function(ea,ba,Z,fa,ja,oa,sa){const qa=this.getFastUpdateAttrValues(ea);ea=qa?Ga=>H.evaluateModelTransform(this._fastUpdates.materialParameters,qa,Ga):null;fa=[Q.createPointGeometry(V,null,fa,ja,ia,null,
qa)];sa=L.createStageObjectForHUD(this._context,ba,fa,[Z],oa,this._context.layer.uid,sa,ea);if(null===sa)return null;const Ha=new G.Graphics3DObject3DGraphicLayer(this,sa.object,fa,null,null,y.perObjectElevationAligner,oa);Ha.alignedSampledElevation=sa.sampledElevation;Ha.needsElevationUpdates=D.needsElevationUpdates2D(oa.mode)||"absolute-height"===oa.mode;Ha.getScreenSize=this._createScreenSizeGetter(ja,ea);Ha.calculateRelativeScreenBounds=Ga=>Z.calculateRelativeScreenBounds(Ha.getScreenSize(),1,
Ga);L.extendPointGraphicElevationContext(Ha,ba,this._context.elevationProvider);return Ha};Y._createAsOverlay=function(ea,ba,Z,fa,ja,oa){Z.renderPriority=this._renderPriority;const sa=x.create();B.projectPointToVector(ba,sa,this._context.overlaySR);sa[2]=I.DRAPED_Z;ba=this._context.clippingExtent;if(k.isSome(ba)&&!q.containsPoint(ba,sa))return null;const qa=this.getFastUpdateAttrValues(ea);ba=qa?Ga=>H.evaluateModelTransform(this._fastUpdates.materialParameters,qa,Ga):null;fa=Q.createPointGeometry(V,
sa,fa,ja,null,null,qa);ea=new S.RenderGeometry(fa,Z,{layerUid:oa,graphicUid:ea.uid,calculateShaderTransformation:ba});sa[3]=0;t.copy(ea.boundingSphere,sa);const Ha=new F(this,[ea],null,this._context.drapeSourceRenderer);Ha.getScreenSize=this._createScreenSizeGetter(ja,ba);Ha.calculateRelativeScreenBounds=Ga=>Z.calculateRelativeScreenBounds(Ha.getScreenSize(),1,Ga);return Ha};Y._createScreenSizeGetter=function(ea,ba){const Z=this._outlineSize+2;if(this._fastUpdates.enabled){const fa=ea[0]/this._symbolTextureRatio,
ja=ea[1]/this._symbolTextureRatio;return(oa=v.create())=>{const sa=ba(R);oa[0]=sa[0]*fa+Z;oa[1]=sa[5]*ja+Z;return oa}}{const fa=ea[0]/this._symbolTextureRatio+Z,ja=ea[1]/this._symbolTextureRatio+Z;return(oa=v.create())=>{oa[0]=fa;oa[1]=ja;return oa}}};Y._fastVisualVariableConvertOptions=function(){var ea=this._size[0]>this._size[1]?this._size[0]:this._size[1];const ba=w.fromValues(ea,ea,ea),Z=d.px2pt(1);ea*=Z;ea=w.fromValues(ea,ea,ea);return{modelSize:ba,symbolSize:ea,unitInMeters:Z,transformation:{anchor:w.ZEROS,
scale:w.ONES,rotation:w.ZEROS}}};Y._getGraphicHash=function(ea){let ba="";for(const Z of this._cimRequiredFields)ba+=Z+ea.attributes[Z];return ba};Y._forEachMaterial=function(ea){k.isSome(this._material)&&ea(this._material);this._cimSymbolMaterials.forEach(ea)};Y.test=function(){return{...ka.prototype.test.call(this),material:this._material}};return la}(P.Graphics3DSymbolLayer);P.PRIMITIVE_SIZE=l;P.elevationModeChangeTypes={definedChanged:D.SymbolUpdateType.UPDATE,staysOnTheGround:D.SymbolUpdateType.NONE,
onTheGroundChanged:D.SymbolUpdateType.RECREATE};const ha={mode:"relative-to-ground",offset:0},ia=x.fromValues(0,0,0,1);b.Graphics3DIconSymbolLayer=P;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/arcade/callExpressionWithFeature":function(){define(["../../../core/Error","../../../core/Logger","../../../geometry/support/quantizationUtils"],function(a,b,c){function m(r){const n={};switch(r){case "esriGeometryPoint":return(g,k,f,d)=>c.unquantizePoint(k,
n,g,f,d);case "esriGeometryPolygon":return(g,k,f,d)=>c.unquantizePolygon(k,n,g,f,d);case "esriGeometryPolyline":return(g,k,f,d)=>c.unquantizePolyline(k,n,g,f,d);case "esriGeometryMultipoint":return(g,k,f,d)=>c.unquantizeMultipoint(k,n,g,f,d);default:return b.getLogger("esri.views.2d.support.arcadeOnDemand").error(new a("mapview-arcade",`Unable to handle geometryType: ${r}`)),g=>g}}const l=new Map;return function(r,n,g,k,f){if(r.referencesGeometry()&&f){{const {transform:d,hasZ:e,hasM:h}=f;l.has(k)||
l.set(k,m(k));k=l.get(k)(n.geometry,d,e,h);n={...n,geometry:k}}}n=r.repurposeFeature(n);try{return r.evaluate({...g,$feature:n})}catch(d){return b.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",d),null}}})},"esri/views/3d/layers/graphics/constants":function(){define(["exports","../../../../chunks/vec4f64"],function(a,b){const c=b.ZEROS;b=b.ONES;a.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2;a.TRANSPARENT_UNIT=c;a.WHITE_UNIT=b;a.defaultIconElevationOffset=1;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ModelDirtyTypes".split(" "),function(a,b,c,m,l,r,n,g,k){let f=function(){function v(t,
x,B,q){this.graphics3DSymbolLayer=t;this.renderGeometries=x;this.boundingBox=B;this._drapeSourceRenderer=q;this.type="draped";this.stage=null;this.isElevationSource=this._addedToStage=this._visible=!1}var w=v.prototype;w.initialize=function(t){this.stage=t};w.setVisibility=function(t){if(null!=this.stage&&this._visible!==t)if((this._visible=t)&&!this._addedToStage)this._addedToStage=!0,this._drapeSourceRenderer.addGeometries(this.renderGeometries,k.ModelDirty.Geometry.ADD);else if(t||this._addedToStage){for(const x of this.renderGeometries)x.instanceParameters.visible=
this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,k.ModelDirty.State.VISIBILITIES)}};w.destroy=function(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,k.ModelDirty.Geometry.REMOVE);this._visible=this._addedToStage=!1;this.stage=null};w.getCenterObjectSpace=function(t=m.create()){return c.set(t,0,0,0)};w.getBoundingBoxObjectSpace=function(t=l.create()){return l.empty(t)};w.addObjectState=function(t,x){t===g.Object3DState.Highlight&&
(this.renderGeometries.forEach(B=>{const q=B.addHighlight();x.addRenderGeometry(B,q,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,k.ModelDirty.State.HIGHLIGHTS))};w.removeObjectState=function(t){this.renderGeometries.forEach(x=>{t.removeRenderGeometry(x)})};w.removeRenderGeometryObjectState=function(t,x){t.removeHighlight(x);this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,k.ModelDirty.State.HIGHLIGHTS)};w.computeAttachmentOrigin=
function(t){for(const x of this.renderGeometries)x.computeAttachmentOrigin(h)&&(t.draped.origin[0]+=h[0],t.draped.origin[1]+=h[1],t.draped.num++)};w.getProjectedBoundingBox=function(){var t=a._asyncToGenerator(function*(x,B,q,u,C){l.empty(C);for(let z=0;z<this.renderGeometries.length;z++)this._getRenderGeometryProjectedBoundingRect(this.renderGeometries[z],x,d,q),l.expandWithRect(C,d);if(B){l.center(C,h);let z;x=n.demResolutionForBoundingBox(C,B);try{z=yield B.service.queryElevation(h[0],h[1],u,x,
"ground")}catch(A){}b.isSome(z)&&(C[2]=Math.min(C[2],z),C[5]=Math.max(C[5],z))}return C});return function(x,B,q,u,C){return t.apply(this,arguments)}}();w._getRenderGeometryProjectedBoundingRect=function(t,x,B,q){if(this.boundingBox)l.set(e,this.boundingBox);else{t=t.boundingSphere;const u=t[3];e[0]=t[0]-u;e[1]=t[1]-u;e[2]=t[2]-u;e[3]=t[0]+u;e[4]=t[1]+u;e[5]=t[2]+u}x(e,0,2);this.calculateRelativeScreenBounds&&q.push({location:l.center(e),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});
return l.toRect(e,B)};return v}();const d=r.create(),e=l.create(),h=m.create();return f})},"esri/views/3d/layers/graphics/placementUtils":function(){define(["exports","../../../../chunks/vec2f64","../../webgl-engine/lib/TextRenderer"],function(a,b,c){b={"bottom-left":b.fromValues(0,0),bottom:b.fromValues(.5,0),"bottom-right":b.fromValues(1,0),left:b.fromValues(0,.5),center:b.fromValues(.5,.5),right:b.fromValues(1,.5),"top-left":b.fromValues(0,1),top:b.fromValues(.5,1),"top-right":b.fromValues(1,1)};
a.anchorFromPlacements=function(m,l){switch(l){case "bottom":return"left"===m?"bottom-left":"right"===m?"bottom-right":"bottom";case "center":return m;case "top":return"left"===m?"top-left":"right"===m?"top-right":"top"}};a.horizontalPlacementFromAnchor=function(m){switch(m){case "bottom-left":case "left":case "top-left":return"left";case "bottom":case "center":case "top":return"center";case "bottom-right":case "right":case "top-right":return"right"}};a.horizontalPlacementToAnchorX={left:0,center:.5,
right:1};a.namedAnchorToHUDMaterialAnchorPos=b;a.textRenderAlignmentFromHorizontalPlacement=function(m){switch(m){case "left":return c.TextRenderAlignment.Left;case "right":return c.TextRenderAlignment.Right;default:return c.TextRenderAlignment.Center}};a.verticalPlacementFromAlignment=function(m){return"middle"===m?"center":m};a.verticalPlacementFromAnchor=function(m){switch(m){case "bottom-left":case "bottom":case "bottom-right":return"bottom";case "left":case "center":case "right":return"center";
case "top-left":case "top":case "top-right":return"top"}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextRenderer":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils","../../../../core/maybe","../../support/debugFlags"],function(a,b,c,m,l){function r(d,e,h){d.canvas||(d.canvas=document.createElement("canvas"));d.canvas.width=e;d.canvas.height=h;return d.canvas}let n=
function(){function d(h,v,w,t=2048){this.text=h;this._alignment=v;this._parameters=w;this.maxSize=t;this._textWidths=[];this._lineWidths=[];this._heightMetrics=this._displayWidth=this._renderPixelRatio=null;this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${h}`;this._lines=h.split(/\r?\n/)}var e=d.prototype;e._getLineXOffset=function(h){switch(this._alignment){case a.TextRenderAlignment.Left:return this.backgroundHorizontalPadding;case a.TextRenderAlignment.Center:return(this.displayWidth-
this._lineWidths[h])/2;case a.TextRenderAlignment.Right:return this.displayWidth-this.backgroundHorizontalPadding-this._lineWidths[h]}};e.render=function(h,v=0,w=0){h.save();v/=this.renderPixelRatio;w/=this.renderPixelRatio;const t=v,x=w;var B=this.haloSize,q=this.firstLineYOffset;v+=B;w+=q+this.baselinePosition;const u=0<this.haloSize;u&&this._renderHalo(h,t,x,B,q);this._setFontProperties(h,this.renderedFontSize);for(B=0;B<this._lines.length;++B){const C=this._lines[B],z=this._getLineXOffset(B);
u&&(h.globalCompositeOperation="destination-out",h.fillStyle="rgb(0, 0, 0)",this._fillText(h,C,v+z,w),this._renderLineDecoration(h,v+z,w,this._textWidths[B]));h.globalCompositeOperation="source-over";h.fillStyle=this._parameters.textStyle;this._fillText(h,C,v+this._getLineXOffset(B),w);this._renderLineDecoration(h,v+z,w,this._textWidths[B]);w+=this.lineSpacing}if(l.TEXT_SHOW_BASELINE)for(h.strokeStyle="rgb(255, 0, 255, 0.5)",h.setLineDash([2,2]),h.lineWidth=1,v=x+q,w=0;w<this._lines.length;++w)q=
v+this.baselinePosition,this._drawLine(h,[t,q],[t+this.displayWidth,q]),v+=this.lineSpacing;l.TEXT_SHOW_BORDER&&(h.strokeStyle="rgb(255, 0, 255, 0.5)",h.setLineDash([]),h.lineWidth=1,this._drawBox(h,[t,x],[this.displayWidth,this.displayHeight]));this.hasBackground&&(this._roundedRect(h,t,x,this._parameters.definition.background.borderRadius*this.renderPixelRatio),h.globalCompositeOperation="destination-over",h.fillStyle=this._parameters.backgroundStyle,h.fill());h.restore()};e._renderLineDecoration=
function(h,v,w,t,x=!1){if("none"!==this._parameters.definition.font.decoration&&0!==t){var B=Math.max(this._parameters.definition.size/16,1);switch(this._parameters.definition.font.decoration){case "underline":w+=2*B;break;case "line-through":w-=.33*this.baselinePosition}var q=x?this.haloSize:0;h.strokeStyle=x?this._parameters.haloStyle:this._parameters.textStyle;h.lineWidth=this._toRenderUnit(B+2*q);h.beginPath();h.moveTo(this._toRenderUnit(v-q),this._toRenderUnit(w));h.lineTo(this._toRenderUnit(v+
t+q),this._toRenderUnit(w));h.stroke()}};e._roundedRect=function(h,v,w,t){v=this._toRenderUnit(v);w=this._toRenderUnit(w);const x=this.renderedWidth,B=this.renderedHeight;0===t?h.rect(v,w,x,B):(t=c.clamp(t,0,Math.floor(B/2)),h.beginPath(),h.moveTo(v,w+t),h.arcTo(v,w,v+t,w,t),h.lineTo(v+x-t,w),h.arcTo(v+x,w,v+x,w+t,t),h.lineTo(v+x,w+B-t),h.arcTo(v+x,w+B,v+x-t,w+B,t),h.lineTo(v+t,w+B),h.arcTo(v,w+B,v,w+B-t,t),h.closePath())};e._renderHalo=function(h,v,w,t,x){const B=this.renderedWidth,q=this.renderedHeight,
u=r(k,Math.max(B,512),Math.max(q,512)),C=u.getContext("2d");C.clearRect(0,0,B,q);this._setFontProperties(C,this.renderedFontSize);C.fillStyle=this._parameters.haloStyle;C.strokeStyle=this._parameters.haloStyle;var z=3>this.renderedHaloSize;C.lineJoin=z?"miter":"round";z?this._renderHaloEmulated(C,t,x):this._renderHaloNative(C,t,x);x+=this.baselinePosition;for(z=0;z<this._lines.length;++z){const A=this._getLineXOffset(z);this._renderLineDecoration(C,t+A,x,this._textWidths[z],!0);x+=this.lineSpacing}h.globalAlpha=
this._parameters.definition.halo.color[3];h.drawImage(u,0,0,B,q,this._toRenderUnit(v),this._toRenderUnit(w),B,q);h.globalAlpha=1};e._renderHaloEmulated=function(h,v,w){w+=this.baselinePosition;for(let t=0;t<this._lines.length;++t){const x=this._lines[t],B=this._getLineXOffset(t);for(const [q,u]of g)this._fillText(h,x,v+B+this.haloSize*q,w+this.haloSize*u);w+=this.lineSpacing}};e._renderHaloNative=function(h,v,w){const t=2*this.haloSize;w+=this.baselinePosition;for(let x=0;x<this._lines.length;++x){const B=
this._lines[x],q=this._getLineXOffset(x);for(let u=0;5>u;u++)h.lineWidth=this._toRenderUnit((.6+.1*u)*t),this._strokeText(h,B,v+q,w);w+=this.lineSpacing}};e._setFontProperties=function(h,v){h.font=this._parameters.fontString(v);h.textAlign="left";h.textBaseline="alphabetic"};e._ensureTextWidth=function(){if(m.isSome(this._displayWidth))return this._displayWidth;const h=r(k,512,512).getContext("2d");this._setFontProperties(h,this.fontSize);let v=2*this.haloSize;var w=this._parameters.definition.font;
if("italic"===w.style||"oblique"===w.style||"bold"===w.weight||"bolder"===w.weight)v+=.3*h.measureText("A").width;this._textWidths.length=0;w=this._lineWidths.length=0;for(const t of this._lines){const x=h.measureText(t).width,B=x+v;this._textWidths.push(x);this._lineWidths.push(B);w=Math.max(w,B)}return this._displayWidth=w};e._ensureHeightMetrics=function(){if(m.isNone(this._heightMetrics)){var h=r(k,512,512).getContext("2d");this._setFontProperties(h,this.fontSize);const v=h.measureText(this.text+
f),w=this.hasBackground?h.measureText(this._lines[0]):v;h=1===this._lines.length?w:this.hasBackground?h.measureText(this._lines[this._lines.length-1]):v;this._heightMetrics={paddingTop:v.actualBoundingBoxAscent-w.actualBoundingBoxAscent,paddingBottom:v.actualBoundingBoxDescent-h.actualBoundingBoxDescent,lineHeight:v.actualBoundingBoxAscent+v.actualBoundingBoxDescent,baselinePosition:v.actualBoundingBoxAscent}}return this._heightMetrics};e._toRenderUnit=function(h){return h*this.renderPixelRatio};
e._toRoundedRenderUnit=function(h){return Math.round(h*this.renderPixelRatio)};e._fillText=function(h,v,w,t){h.fillText(v,this._toRenderUnit(w),this._toRenderUnit(t))};e._strokeText=function(h,v,w,t){h.strokeText(v,this._toRenderUnit(w),this._toRenderUnit(t))};e._drawLine=function(h,v,w){h.beginPath();h.moveTo(this._toRoundedRenderUnit(v[0])+.5,this._toRoundedRenderUnit(v[1])+.5);h.lineTo(this._toRoundedRenderUnit(w[0])+.5,this._toRoundedRenderUnit(w[1])+.5);h.stroke()};e._drawBox=function(h,v,w){var t=
this._toRenderUnit(v[0]);v=this._toRenderUnit(v[1]);var x=this._toRenderUnit(w[0]);const B=this._toRenderUnit(w[1]);w=Math.floor(t)+.5;t=Math.ceil(t+x)-.5;x=Math.floor(v)+.5;v=Math.ceil(v+B)-.5;h.beginPath();h.moveTo(w,x);h.lineTo(t,x);h.lineTo(t,v);h.lineTo(w,v);h.lineTo(w,x);h.stroke()};b._createClass(d,[{key:"displayWidth",get:function(){return Math.ceil(this._ensureTextWidth()+2*this.backgroundHorizontalPadding)}},{key:"displayHeight",get:function(){return Math.ceil(this.lineSpacing*(this._lines.length-
1)+this.lineHeight+2*this.haloSize+this.backgroundTopPadding+this.backgroundBottomPadding)}},{key:"renderedWidth",get:function(){return Math.ceil(this._toRenderUnit(this.displayWidth))}},{key:"renderedHeight",get:function(){return Math.ceil(this._toRenderUnit(this.displayHeight))}},{key:"firstRenderedBaselinePosition",get:function(){return this._toRenderUnit(this.firstLineYOffset+this.baselinePosition)}},{key:"firstLineYOffset",get:function(){return this.backgroundTopPadding+this.haloSize}},{key:"heightMetrics",
get:function(){return this._ensureHeightMetrics()}},{key:"lineSpacing",get:function(){return(this.lineHeight+this.linePadding)*this._parameters.definition.lineSpacingFactor}},{key:"lineHeight",get:function(){return this.heightMetrics.lineHeight}},{key:"linePadding",get:function(){return.2*this.lineHeight}},{key:"baselinePosition",get:function(){return this.heightMetrics.baselinePosition}},{key:"renderedFontSize",get:function(){return this._toRenderUnit(this.fontSize)}},{key:"fontSize",get:function(){return this._parameters.definition.size}},
{key:"renderedHaloSize",get:function(){return this._toRenderUnit(this.haloSize)}},{key:"haloSize",get:function(){return this._parameters.haloSize}},{key:"backgroundHorizontalPadding",get:function(){return this.hasBackground?this._parameters.definition.background.padding[0]:0}},{key:"backgroundVerticalPadding",get:function(){return this.hasBackground?this._parameters.definition.background.padding[1]:0}},{key:"backgroundTopPadding",get:function(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingTop)}},
{key:"backgroundBottomPadding",get:function(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingBottom)}},{key:"hasBackground",get:function(){return!!this._parameters.backgroundStyle}},{key:"renderPixelRatio",get:function(){if(m.isNone(this._renderPixelRatio)){const h=this._parameters.definition.pixelRatio;this._renderPixelRatio=0<this.maxSize?Math.min(h,Math.min(this.maxSize/this.displayWidth,this.maxSize/this.displayHeight)):h}return this._renderPixelRatio}}]);return d}();
const g=[];for(let d=0;360>d;d+=22.5)g.push([Math.cos(Math.PI*d/180),Math.sin(Math.PI*d/180)]);a.TextRenderAlignment=void 0;(function(d){d[d.Left=0]="Left";d[d.Center=1]="Center";d[d.Right=2]="Right"})(a.TextRenderAlignment||(a.TextRenderAlignment={}));const k={canvas:null},f=(()=>{let d="";for(let e=32;127>e;e++)d+=String.fromCharCode(e);return d})();a.TextRenderer=n;a.getTextHelperCanvas=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../renderers/support/lengthUtils ../../support/debugFlags".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){function e(K){return null!==K&&void 0!==K}function h(K){return"number"===typeof K}function v(K){return"string"===typeof K}function w(K,N){K&&K.push(N)}function t(K,N,M,L=n.create()){K=K||0;N=N||0;M=M||0;0!==K&&r.rotateZ(L,L,-K/180*Math.PI);0!==N&&r.rotateX(L,L,N/180*Math.PI);0!==M&&r.rotateY(L,L,M/180*Math.PI);return L}function x(K,N,M,L,J){const H=K.minSize,I=K.maxSize;if(K.expression)return w(J,"Could not convert size info: expression not supported"),!1;if(K.useSymbolValue)return K=
L.symbolSize[M],N.minSize[M]=K,N.maxSize[M]=K,N.offset[M]=N.minSize[M],N.factor[M]=0,N.type[M]=a.FastSizeType.DefinedSize,!0;if(e(K.field)){if(e(K.stops)){if(2===K.stops.length&&h(K.stops[0].size)&&h(K.stops[1].size))return B(K.stops[0].size,K.stops[1].size,K.stops[0].value,K.stops[1].value,N,M),N.type[M]=a.FastSizeType.DefinedSize,!0;w(J,"Could not convert size info: stops only supported with 2 elements");return!1}if(h(H)&&h(I)&&e(K.minDataValue)&&e(K.maxDataValue))return B(H,I,K.minDataValue,K.maxDataValue,
N,M),N.type[M]=a.FastSizeType.DefinedSize,!0;if(null!=f.meterIn[K.valueUnit])return N.minSize[M]=-Infinity,N.maxSize[M]=Infinity,N.offset[M]=0,N.factor[M]=1/f.meterIn[K.valueUnit],N.type[M]=a.FastSizeType.DefinedSize,!0;if("unknown"===K.valueUnit)return w(J,"Could not convert size info: proportional size not supported"),!1;w(J,"Could not convert size info: scale-dependent size not supported");return!1}if(!e(K.field)){if(K.stops&&K.stops[0]&&h(K.stops[0].size))return N.minSize[M]=K.stops[0].size,N.maxSize[M]=
K.stops[0].size,N.offset[M]=N.minSize[M],N.factor[M]=0,N.type[M]=a.FastSizeType.DefinedSize,!0;if(h(H))return N.minSize[M]=H,N.maxSize[M]=H,N.offset[M]=H,N.factor[M]=0,N.type[M]=a.FastSizeType.DefinedSize,!0}w(J,"Could not convert size info: unsupported variant of sizeInfo");return!1}function B(K,N,M,L,J,H){L=0<Math.abs(L-M)?(N-K)/(L-M):0;J.minSize[H]=0<L?K:N;J.maxSize[H]=0<L?N:K;J.offset[H]=K-M*L;J.factor[H]=L}function q(K,N,M,L){if(K.normalizationField||K.valueRepresentation)return w(L,"Could not convert size info: unsupported property"),
null;var J=K.field;if(null!=J&&!v(J))return w(L,"Could not convert size info: field is not a string"),null;if(!N.size)N.size={field:K.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[a.FastSizeType.Undefined,a.FastSizeType.Undefined,a.FastSizeType.Undefined]};else if(K.field)if(!N.size.field)N.size.field=K.field;else if(K.field!==N.size.field)return w(L,"Could not convert size info: multiple fields in use"),null;switch(K.axis){case "width":return(J=x(K,N.size,0,M,L))?N:null;
case "height":return(J=x(K,N.size,2,M,L))?N:null;case "depth":return(J=x(K,N.size,1,M,L))?N:null;case "width-and-depth":return(J=x(K,N.size,0,M,L))&&x(K,N.size,1,M,L),J?N:null;case null:case void 0:case "all":return(J=(J=(J=x(K,N.size,0,M,L))&&x(K,N.size,1,M,L))&&x(K,N.size,2,M,L))?N:null;default:return w(L,`Could not convert size info: unknown axis "${K.axis}""`),null}}function u(K,N,M){for(let L=0;3>L;++L){let J=N.unitInMeters;K.type[L]===a.FastSizeType.DefinedSize&&(J*=N.modelSize[L],K.type[L]=
a.FastSizeType.DefinedScale);K.minSize[L]/=J;K.maxSize[L]/=J;K.offset[L]/=J;K.factor[L]/=J}if(K.type[0]!==a.FastSizeType.Undefined)N=0;else if(K.type[1]!==a.FastSizeType.Undefined)N=1;else if(K.type[2]!==a.FastSizeType.Undefined)N=2;else return w(M,"No size axis contains a valid size or scale"),!1;for(M=0;3>M;++M)K.type[M]===a.FastSizeType.Undefined&&(K.minSize[M]=K.minSize[N],K.maxSize[M]=K.maxSize[N],K.offset[M]=K.offset[N],K.factor[M]=K.factor[N],K.type[M]=K.type[N]);return!0}function C(K,N,M){K[4*
N]=M.r/255;K[4*N+1]=M.g/255;K[4*N+2]=M.b/255;K[4*N+3]=M.a}function z(K,N,M){if(K.normalizationField)return w(M,"Could not convert color info: unsupported property"),null;if(v(K.field))if(K.stops){if(8<K.stops.length)return w(M,"Could not convert color info: too many color stops"),null;N.color={field:K.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};K=K.stops;for(M=0;8>M;++M){const L=K[Math.min(M,K.length-1)];N.color.values[M]=L.value;C(N.color.colors,
M,L.color)}}else return w(M,"Could not convert color info: missing stops or colors"),null;else if(K.stops&&0<=K.stops.length)for(K=K.stops&&0<=K.stops.length&&K.stops[0].color,N.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},M=0;8>M;M++)N.color.values[M]=Infinity,C(N.color.colors,M,K);else return w(M,"Could not convert color info: no field and no colors/stops"),null;return N}function A(K,N,M){if(K.normalizationField)return w(M,
"Could not convert opacity info: unsupported property"),null;if(v(K.field))if(K.stops){if(8<K.stops.length)return w(M,"Could not convert opacity info: too many opacity stops"),null;N.opacity={field:K.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};K=K.stops;for(M=0;8>M;++M){const L=K[Math.min(M,K.length-1)];N.opacity.values[M]=L.value;N.opacity.opacityValues[M]=L.opacity}}else return w(M,"Could not convert opacity info: missing stops or opacities"),null;else if(K.stops&&0<=K.stops.length)for(K=
K.stops&&0<=K.stops.length&&K.stops[0].opacity,N.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},M=0;8>M;M++)N.opacity.values[M]=Infinity,N.opacity.opacityValues[M]=K;else return w(M,"Could not convert opacity info: no field and no opacities/stops"),null;return N}function p(K,N,M){K=2===M&&"arithmetic"===K.rotationType;N.offset[M]=K?90:0;N.factor[M]=K?-1:1;N.type[M]=1}function y(K,N,M){if(!v(K.field))return w(M,"Could not convert rotation info: field is not a string"),
null;if(!N.rotation)N.rotation={field:K.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(K.field)if(!N.rotation.field)N.rotation.field=K.field;else if(K.field!==N.rotation.field)return w(M,"Could not convert rotation info: multiple fields in use"),null;switch(K.axis){case "tilt":return p(K,N.rotation,0),N;case "roll":return p(K,N.rotation,1),N;case null:case void 0:case "heading":return p(K,N.rotation,2),N;default:return w(M,`Could not convert rotation info: unknown axis "${K.axis}""`),null}}
function D(K,N,M){if(!K)return null;const L=!N.supportedTypes||!!N.supportedTypes.size,J=!N.supportedTypes||!!N.supportedTypes.color,H=!N.supportedTypes||!!N.supportedTypes.rotation,I=!!N.supportedTypes&&!!N.supportedTypes.opacity,O=K.reduce((Q,S)=>{if(!Q)return Q;if(S.valueExpression)return w(M,"Could not convert visual variables: arcade expressions not supported"),null;switch(S.type){case "size":return L?q(S,Q,N,M):Q;case "color":return J?z(S,Q,M):Q;case "opacity":return I?A(S,Q,M):null;case "rotation":return H?
y(S,Q,M):Q;default:return null}},{size:null,color:null,opacity:null,rotation:null});return 0<K.length&&O&&!O.size&&!O.color&&!O.opacity&&!O.rotation||O&&O.size&&!u(O.size,N,M)?null:O}function E(K,N,M){if(!!K!==!!N||K&&K.field!==N.field)return!1;if(K&&"rotation"===M)for(M=0;3>M;M++)if(K.type[M]!==N.type[M]||K.offset[M]!==N.offset[M]||K.factor[M]!==N.factor[M])return!1;return!0}function F(K,N){const M={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,
vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},L=K&&null!=K.size;K&&K.size?(M.vvSizeEnabled=!0,M.vvSizeMinSize=K.size.minSize,M.vvSizeMaxSize=K.size.maxSize,M.vvSizeOffset=K.size.offset,M.vvSizeFactor=K.size.factor):K&&L&&(M.vvSizeValue=N.transformation.scale);K&&L&&(M.vvSymbolAnchor=N.transformation.anchor,M.vvSymbolRotationMatrix=l.create(),r.identity(P),t(N.transformation.rotation[2],
N.transformation.rotation[0],N.transformation.rotation[1],P),m.fromMat4(M.vvSymbolRotationMatrix,P));K&&K.color&&(M.vvColorEnabled=!0,M.vvColorValues=K.color.values,M.vvColorColors=K.color.colors);K&&K.opacity&&(M.vvOpacityEnabled=!0,M.vvOpacityValues=K.opacity.values,M.vvOpacityOpacities=K.opacity.opacityValues);return M}a.FastSizeType=void 0;(function(K){K[K.Undefined=0]="Undefined";K[K.DefinedSize=1]="DefinedSize";K[K.DefinedScale=2]="DefinedScale"})(a.FastSizeType||(a.FastSizeType={}));a.FastRotationType=
void 0;(function(K){K[K.Undefined=0]="Undefined";K[K.DefinedAngle=1]="DefinedAngle"})(a.FastRotationType||(a.FastRotationType={}));var G;(function(K){const N=n.create(),M=k.create();K.evaluateModelTransform=function(L,J,H){if(!L.vvSizeEnabled)return H;r.copy(N,H);H=L.vvSymbolRotationMatrix;r.set(P,H[0],H[1],H[2],0,H[3],H[4],H[5],0,H[6],H[7],H[8],0,0,0,0,1);r.multiply(N,N,P);for(H=0;3>H;++H)M[H]=c.clamp(L.vvSizeOffset[H]+J[0]*L.vvSizeFactor[H],L.vvSizeMinSize[H],L.vvSizeMaxSize[H]);r.scale(N,N,M);
r.translate(N,N,L.vvSymbolAnchor);return N};K.evaluateModelTransformScale=function(L,J,H){if(!J.vvSizeEnabled)return g.set(L,1,1,1);for(let I=0;3>I;++I)L[I]=c.clamp(J.vvSizeOffset[I]+H[0]*J.vvSizeFactor[I],J.vvSizeMinSize[I],J.vvSizeMaxSize[I]);return L}})(G||(G={}));const P=n.create();b=G.evaluateModelTransform;G=G.evaluateModelTransformScale;a.convertVisualVariables=D;a.evaluateModelTransform=b;a.evaluateModelTransformScale=G;a.getMaterialParams=F;a.initFastSymbolUpdatesState=function(K,N){return!K||
d.TESTS_DISABLE_FAST_UPDATES?{enabled:!1}:(K=D(K.visualVariables,N))?{enabled:!0,visualVariables:K,materialParameters:F(K,N),requiresShaderTransformation:K&&null!=K.size}:{enabled:!1}};a.updateFastSymbolUpdatesState=function(K,N,M){if(!N||!K.enabled)return!1;const L=K.visualVariables;N=D(N.visualVariables,M);if(!(N&&E(L.size,N.size,"size")&&E(L.color,N.color,"color")&&E(L.rotation,N.rotation,"rotation")&&E(L.opacity,N.opacity,"opacity")))return!1;K.visualVariables=N;K.materialParameters=F(N,M);K.requiresShaderTransformation=
N&&null!=N.size;return!0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/uid ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec4f64 ../../support/mathUtils ./basicInterfaces ./geometryDataUtils ./InstanceParameters ./Object3DStateID ./VertexAttribute ../materials/renderers/utils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w){let t=function(){function B(u,C,z={}){this.data=u;this.material=C;this.boundingSphere=g.create();this.instanceParameters=new e.InstanceParameters;this._transformation=r.create();this._shaderTransformationDirty=!0;this.layerUid=c.unwrapOr(z.layerUid,null);this.graphicUid=c.unwrapOr(z.graphicUid,null);this.id=z.id?z.id:m.generateUID();this.boundingInfo=c.unwrapOr(z.boundingInfo,null);this.calculateShaderTransformation=c.unwrapOr(z.calculateShaderTransformation,
null);this.castShadow=z.castShadow?z.castShadow:!1}var q=B.prototype;q.updateTransformation=function(u){u(this._transformation);this._shaderTransformationDirty=!0;this.computeBoundingSphere(this._transformation,this.boundingSphere)};q.shaderTransformationChanged=function(){this._shaderTransformationDirty=!0};q.computeBoundingSphere=function(u,C,z=k.maxScale(u)){c.isNone(this.boundingInfo)||(n.transformMat4(C,this.boundingInfo.getCenter(),u),C[3]=this.boundingInfo.getBSRadius()*z)};q.getShaderTransformation=
function(){if(c.isNone(this.calculateShaderTransformation))return c.unwrapOr(this.transformation,r.IDENTITY);this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=r.create()),l.copy(this._shaderTransformation,this.calculateShaderTransformation(c.unwrapOr(this.transformation,r.IDENTITY))),this._shaderTransformationDirty=!1);return this._shaderTransformation};q.computeAttachmentOrigin=function(u){if(this.material.computeAttachmentOrigin)return this.material.computeAttachmentOrigin(this,
u)?(c.isSome(this._transformation)&&n.transformMat4(u,u,this._transformation),!0):!1;const C=this.indices.get(v.VertexAttribute.POSITION),z=this.vertexAttributes.get(v.VertexAttribute.POSITION);return d.computeAttachmentOriginTriangles(z,C,u)?(c.isSome(this._transformation)&&n.transformMat4(u,u,this._transformation),!0):!1};q.addHighlight=function(){const u=new h.Object3DStateID(f.Object3DState.Highlight),C=this.instanceParameters;C.highlights=w.addObject3DStateID(C.highlights,u);return u};q.removeHighlight=
function(u){const C=this.instanceParameters;C.highlights=w.removeObject3DStateID(C.highlights,u)};b._createClass(B,[{key:"transformation",get:function(){return this._transformation}},{key:"hasShaderTransformation",get:function(){return c.isSome(this.calculateShaderTransformation)}},{key:"primitiveType",get:function(){return this.data.primitiveType}},{key:"indices",get:function(){return this.data.indices}},{key:"vertexAttributes",get:function(){return this.data.vertexAttributes}}]);return B}(),x=function(B){function q(){return B.apply(this,
arguments)||this}b._inheritsLoose(q,B);return q}(t);a.RenderGeometry=t;a.ValidatedRenderGeometry=x;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/InstanceParameters":function(){define(["exports"],function(a){a.InstanceParameters=function(){this.visible=!0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/Error ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../renderers/support/renderingInfoUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./interfaces ./lineUtils ../support/FastSymbolUpdates ../support/markerUtils ../../support/debugFlags ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/LineMarkerMaterial ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/RibbonLineMaterial ../../../../geometry/Extent ../../../../geometry/Polygon".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G){const P=["polyline","polygon","extent"];c=function(N){function M(J,H,I,O){J=N.call(this,J,H,I,O)||this;J._uniformSize=1;return J}b._inheritsLoose(M,N);var L=M.prototype;L.doLoad=function(){var J=b._asyncToGenerator(function*(){this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}};this._fastUpdates=
this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?u.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};if(!this._drivenProperties.size){const H=null!=this.symbolLayer.size?this.symbolLayer.size:r.px2pt(1);if(0>H)throw new m("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=H}this._markerTexture=C.prepareMarkerResources(this._context.sharedResources.textures,
this.symbolLayer.marker)});return function(){return J.apply(this,arguments)}}();L._getMaterialParameters=function(J,H=!1){var I;const O=this._getCombinedOpacityAndColor(H&&this._markerColor||this._materialColor);this._patternHidesLine&&!H&&(O[3]=0);J={width:this._computeMaterialWidth(null==(I=this.symbolLayer)?void 0:I.size),color:O,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:q.parseCapType(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:J,stipplePattern:D.getStipplePatternForLinePattern(this.symbolLayer.pattern),
stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?{...J,...this._fastUpdates.materialParameters}:J};L.destroy=function(){N.prototype.destroy.call(this);this._forEachMaterial(J=>this._context.stage.remove(J));this._markerMaterial=this._wireframeRingMaterial=this._wireframeLineMaterial=this._ringMaterial=this._lineMaterial=null;this._markerTexture=l.releaseMaybe(this._markerTexture)};L._getDrivenSize=function(J){return this._drivenProperties.size&&J.size?r.pt2px(d.getDriverAxisSizeValueAny(J.size)):
1};L._getSizeFeatureAttributeData=function(J){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?x.getAttributeValue(this._fastUpdates.visualVariables.size.field,J):null};L._getDrivenColor=function(J){const H=k.fromValues(1,1,1,1);this._drivenProperties.color&&J.color&&(H[0]=J.color[0],H[1]=J.color[1],H[2]=J.color[2],0<J.color.length&&(H[3]=J.color[3]));this._drivenProperties.opacity&&J.opacity&&(H[3]=J.opacity);return H};L._getColorFeatureAttributeData=function(J){return this._fastUpdates.enabled&&
this._fastUpdates.visualVariables.color?x.getAttributeValue(this._fastUpdates.visualVariables.color.field,J):null};L._getOpacityFeatureAttributeData=function(J){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?x.getAttributeValue(this._fastUpdates.visualVariables.opacity.field,J):null};L.createGraphics3DGraphic=function(J){const H=J.graphic;if(!this._validateGeometry(H.geometry,P,this.symbolLayer.type))return null;const I=this.setGraphicElevationContext(H,new v.ElevationContext);
this.ensureDrapedStatus("on-the-ground"===I.mode);return this.draped?this._createAsOverlay(J,this._context.layer.uid):this._createAs3DShape(J,I,H.uid)};L.applyRendererDiff=function(J,H){for(const I in J.diff)switch(I){case "visualVariables":if(u.updateFastSymbolUpdatesState(this._fastUpdates,H,this._vvConvertOptions))this._forEachMaterial(O=>O.setParameters(this._fastUpdates.materialParameters));else return B.ApplyRendererDiffResult.Recreate_Symbol;break;default:return B.ApplyRendererDiffResult.Recreate_Symbol}return B.ApplyRendererDiffResult.Fast_Update};
L.prepareSymbolLayerPatch=function(J){var H,I;if("partial"===J.diff.type){var O=J.diff.diff,Q={};"complete"===(null==(H=O.size)?void 0:H.type)&&(Q.width=this._computeMaterialWidth(O.size.newValue),delete O.size);"complete"===(null==(I=O.cap)?void 0:I.type)&&(Q.cap=q.parseCapType(l.unwrapOr(O.cap.newValue,"butt")),delete O.cap);H=this._prepareMarkerPatch(J,O);this._prepareMaterialPatch(J,O,H);J.symbolLayerStatePatches.push(()=>this._forEachMaterial(S=>S.setParameters(Q)))}};L.layerOpacityChanged=function(){this._forEachMaterial((J,
H)=>this._updateMaterialLayerOpacity(J,H));return!0};L._forEachMaterial=function(J){l.isSome(this._lineMaterial)&&J(this._lineMaterial);l.isSome(this._ringMaterial)&&J(this._ringMaterial);l.isSome(this._wireframeLineMaterial)&&J(this._wireframeLineMaterial);l.isSome(this._wireframeRingMaterial)&&J(this._wireframeRingMaterial);l.isSome(this._markerMaterial)&&J(this._markerMaterial,!0)};L._updateMaterialLayerOpacity=function(J,H=!1){var I=J.parameters.color;const O=l.get(this.symbolLayer,"material",
"color");H=this._patternHidesLine&&!H?0:this._getCombinedOpacity(O);I=k.fromValues(I[0],I[1],I[2],H);J.setParameters({color:I})};L.layerElevationInfoChanged=function(J,H,I){const O=this._elevationContext.mode;I=h.elevationModeChangeUpdateType(M.elevationModeChangeTypes,I,O);if(I!==h.SymbolUpdateType.UPDATE)return I;const Q=h.needsElevationUpdates2D(O);return this.updateGraphics3DGraphicElevationInfo(J,H,()=>Q)};L.slicePlaneEnabledChanged=function(){const J={hasSlicePlane:this._context.slicePlaneEnabled};
this._forEachMaterial(H=>H.setParameters(J));return!0};L.physicalBasedRenderingChanged=function(){return!0};L.pixelRatioChanged=function(){return!0};L._getGeometryAsPolygonOrPolyline=function(J){switch(J.type){case "extent":if(J instanceof F)return G.fromExtent(J);break;case "polygon":case "polyline":return J}return null};L._createAs3DShape=function(J,H,I){const O=this._getGeometryAsPolygonOrPolyline(J.graphic.geometry);var Q="polygon"===O.type?O.rings:O.paths,S=[];const T=[],U=[],aa=f.create(),W=
q.geometryToRenderInfo(O,this._context.elevationProvider,this._context.renderCoordsHelper,H);this._logGeometryCreationWarnings(W,Q,"polygon"===O.type?"rings":"paths","LineSymbol3DLayer");for(Q=0;Q<W.lines.length;Q++){const {position:R,mapPosition:V}=W.lines[Q];if(l.isSome(this._context.clippingExtent)&&(f.empty(aa),f.expandWithBuffer(aa,V),!f.intersectsClippingArea(aa,this._context.clippingExtent)))continue;const da=this._createGeometry(J,R,V,O.type,K.ELEVATED);S.push(da);T.push("polygon"===O.type?
this.ringMaterial:this.lineMaterial);U.push(n.IDENTITY);z.LINE_WIREFRAMES&&(S.push(da.cloneShallow()),T.push("polygon"===O.type?this.wireframeRingMaterial:this.wireframeLineMaterial),U.push(n.IDENTITY));const ca=this.markerMaterial;l.isSome(ca)&&(S.push(da.cloneShallow()),T.push(ca),U.push(n.IDENTITY))}if(0===S.length)return null;J=new A.Object3D({geometries:S,materials:T,transformations:U,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:I}});S=new t.Graphics3DObject3DGraphicLayer(this,
J,S,null,null,e.sharedGeometryElevationAligner,H);S.alignedSampledElevation=W.sampledElevation;S.needsElevationUpdates=h.needsElevationUpdates2D(H.mode);return S};L._createGeometry=function(J,H,I,O,Q){const S=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color;return q.createGeometry({overlayInfo:Q===K.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:"polygon"===O?q.RemoveDuplicateStartEnd.REMOVE:q.RemoveDuplicateStartEnd.KEEP,
uniformSize:this._uniformSize,attributeData:{position:H,mapPosition:I,size:this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?null:this._getDrivenSize(J.renderingInfo),color:S?null:this._getDrivenColor(J.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(J.graphic),colorFeature:this._getColorFeatureAttributeData(J.graphic),opacityFeature:this._getOpacityFeatureAttributeData(J.graphic)}})};L._createAsOverlay=function(J,H){const I=J.graphic,O=this._getGeometryAsPolygonOrPolyline(I.geometry);
var Q="polygon"===O.type?O.rings:O.paths;const S="polygon"===O.type?this.ringMaterial:this.lineMaterial;S.renderPriority=this._renderPriority;const T=z.LINE_WIREFRAMES?"polygon"===O.type?this.wireframeRingMaterial:this.wireframeLineMaterial:null,U=this.markerMaterial;l.isSome(T)&&(T.renderPriority=this._renderPriority-.001);l.isSome(U)&&(U.renderPriority=this._renderPriority-.002);const aa=[],W=f.create(),R=f.empty();var V=q.geometryToRenderInfoDraped(O,this._context.overlaySR);this._logGeometryCreationWarnings(V,
Q,"polygon"===O.type?"rings":"paths","LineSymbol3DLayer");for(const da of V.lines){f.empty(W);f.expandWithBuffer(W,da.position);if(!f.intersectsClippingArea(W,this._context.clippingExtent))continue;f.expandWithAABB(R,W);const ca=this._createGeometry(J,da.position,null,O.type,K.DRAPED);Q=ha=>{ha=new p.RenderGeometry(ca,ha,{layerUid:H,graphicUid:I.uid});aa.push(ha);return ha};if(l.isSome(U)){V=Q(U);const ha=l.unwrap(this.symbolLayer.marker).placement;"begin"!==ha&&"begin-end"!==ha||f.expandWithBuffer(W,
da.position,0,1);"end"!==ha&&"begin-end"!==ha||f.expandWithBuffer(W,da.position,da.position.length-3,1);this._updateBoundingSphere(V,W)}V=Q(S);this._updateBoundingSphere(V,W);z.LINE_WIREFRAMES&&(Q=Q(T),this._updateBoundingSphere(Q,W))}return new w(this,aa,R,this._context.drapeSourceRenderer)};L._updateBoundingSphere=function(J,H){g.set(J.boundingSphere,.5*(H[0]+H[3]),.5*(H[1]+H[4]),0,.5*Math.sqrt((H[3]-H[0])*(H[3]-H[0])+(H[4]-H[1])*(H[4]-H[1])))};L._computeMaterialWidth=function(J){J=l.unwrapOr(J,
r.px2pt(1));return this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?r.pt2px(1):1:r.pt2px(J)};L._prepareMaterialPatch=function(J,H,I){var O=H.material;l.isNone(O)?I.changed&&I.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterial,J):"collection"!==O.type&&(O="complete"===O.type?l.applySome(O.newValue,Q=>Q.color):"complete"===O.diff.color.type?O.diff.color.newValue:null,O=this._getCombinedOpacityAndColor(O),
I.useMaterialColor&&this._patchMaterialColor(k.clone(O),this._markerMaterial,J),this._patternHidesLine&&(O[3]=0),this._patchMaterialColor(O,this._lineMaterial,J),delete H.material)};L._prepareMarkerPatch=function(J,H){var I=H.marker;if(l.isNone(I)||"partial"!==I.type||l.isSome(I.diff.style)||l.isSome(I.diff.placement)||l.isSome(I.diff.color)&&"complete"!==I.diff.color.type)return{changed:!1,useMaterialColor:l.isNone(this._markerColor)};I=I.diff.color;if(l.isNone(I))return delete H.marker,{changed:!1,
useMaterialColor:l.isNone(this._markerColor)};I=l.unwrap(I.newValue);if(l.isNone(I))return delete H.marker,{changed:!0,useMaterialColor:!0};this._patchMaterialColor(this._getCombinedOpacityAndColor(I),this._markerMaterial,J);delete H.marker;return{changed:!0,useMaterialColor:!1}};L._patchMaterialColor=function(J,H,I){l.isNone(H)||I.symbolLayerStatePatches.push(()=>H.setParameters({color:J}))};b._createClass(M,[{key:"_materialColor",get:function(){return l.applySome(this.symbolLayer.material,J=>J.color)}},
{key:"_markerColor",get:function(){return l.applySome(this.symbolLayer.marker,J=>J.color)}},{key:"lineMaterial",get:function(){l.isNone(this._lineMaterial)&&(this._lineMaterial=new E.RibbonLineMaterial(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterial));return this._lineMaterial}},{key:"ringMaterial",get:function(){l.isNone(this._ringMaterial)&&(this._ringMaterial=new E.RibbonLineMaterial(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterial));return this._ringMaterial}},
{key:"wireframeLineMaterial",get:function(){l.isNone(this._wireframeLineMaterial)&&(this._wireframeLineMaterial=new E.RibbonLineMaterial({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterial));return this._wireframeLineMaterial}},{key:"wireframeRingMaterial",get:function(){l.isNone(this._wireframeRingMaterial)&&(this._wireframeRingMaterial=new E.RibbonLineMaterial({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterial));
return this._wireframeRingMaterial}},{key:"markerMaterial",get:function(){l.isNone(this._markerMaterial)&&l.isSome(this.symbolLayer.marker)&&l.isSome(this._markerTexture)&&(this._markerMaterial=new y.LineMarkerMaterial({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id}),this._context.stage.add(this._markerMaterial));return this._markerMaterial}},{key:"_patternHidesLine",get:function(){const J=this.symbolLayer.pattern;return l.isSome(J)&&
"style"===J.type&&"none"===J.style}}]);return M}(x.Graphics3DSymbolLayer);c.elevationModeChangeTypes={definedChanged:h.SymbolUpdateType.RECREATE,staysOnTheGround:h.SymbolUpdateType.NONE,onTheGroundChanged:h.SymbolUpdateType.RECREATE};var K;(function(N){N[N.DRAPED=0]="DRAPED";N[N.ELEVATED=1]="ELEVATED"})(K||(K={}));a.Graphics3DLineSymbolLayer=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/lineUtils":function(){define("exports ../../../../core/has ../../../../core/maybe ../../../../core/typedArrayUtil ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/support/triangulationUtils ../../../ViewingMode ./constants ./elevationAlignmentUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/shaders/RibbonLineTechniqueConfiguration".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B){function q(z,A,p){const y=[];for(const {index:D,count:E}of z){if(1>=E)continue;z=3*D;const F=z+3*E;y.push({position:A.subarray(z,F),mapPosition:p?p.subarray(z,F):void 0})}return y}a.RemoveDuplicateStartEnd=void 0;(function(z){z[z.KEEP=0]="KEEP";z[z.REMOVE=1]="REMOVE"})(a.RemoveDuplicateStartEnd||(a.RemoveDuplicateStartEnd={}));const u=n.create(),C=n.create();a.createGeometry=function(z){const A=[],p=[];{const {attributeData:{position:K},removeDuplicateStartEnd:N}=
z;var y=K.length;y=(y=K[0]===K[y-3]&&K[1]===K[y-2]&&K[2]===K[y-1])&&N===a.RemoveDuplicateStartEnd.REMOVE;var D=K.length/3-(y?1:0),E=new Uint32Array(2*(D-1)),F=y?m.slice(K,0,K.length-3):K,G=0;for(var P=0;P<D-1;P++)E[G++]=P,E[G++]=P+1;p.push([x.VertexAttribute.POSITION,{size:3,data:F,exclusive:y}]);A.push([x.VertexAttribute.POSITION,E])}D=p[0][1].data;y=new Uint16Array(A[0][1].length);E=z.attributeData.mapPosition;c.isNone(E)||(A.push([x.VertexAttribute.MAPPOS,A[0][1]]),p.push([x.VertexAttribute.MAPPOS,
{size:3,data:E}]));c.isSome(z.attributeData.colorFeature)||(p.push([x.VertexAttribute.COLOR,{size:4,data:c.unwrapOr(z.attributeData.color,e.WHITE_UNIT)}]),A.push([x.VertexAttribute.COLOR,y]));c.isSome(z.attributeData.sizeFeature)||(p.push([x.VertexAttribute.SIZE,{size:1,data:[c.unwrapOr(z.attributeData.size,1)]}]),A.push([x.VertexAttribute.SIZE,y]));E=z.attributeData.colorFeature;c.isNone(E)||(p.push([x.VertexAttribute.COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([E])}]),A.push([x.VertexAttribute.COLOR,
y]));E=z.attributeData.sizeFeature;c.isNone(E)||(p.push([x.VertexAttribute.SIZEFEATUREATTRIBUTE,{size:1,data:new Float32Array([E])}]),A.push([x.VertexAttribute.SIZEFEATUREATTRIBUTE,y]));E=z.attributeData.opacityFeature;c.isNone(E)||(p.push([x.VertexAttribute.OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([E])}]),A.push([x.VertexAttribute.OPACITYFEATUREATTRIBUTE,y]));if(!c.isNone(z.overlayInfo)&&z.overlayInfo.renderCoordsHelper.viewingMode===d.ViewingMode.Global&&z.overlayInfo.spatialReference.isGeographic){y=
new Float64Array(D.length);z=k.getReferenceEllipsoid(z.overlayInfo.spatialReference);for(E=0;E<y.length;E+=3)g.lonLatToWebMercatorComparable(D,E,y,E,z);z=D.length/3;D=new Float32Array(z+1);E=u;F=C;P=G=0;r.set(E,y[P++],y[P++],y[P++]);D[0]=0;for(let K=1;K<z+1;++K)K===z&&(P=0),r.set(F,y[P++],y[P++],y[P++]),G+=l.dist(E,F),D[K]=G,[E,F]=[F,E];p.push([x.VertexAttribute.DISTANCETOSTART,{size:1,data:D}]);A.push([x.VertexAttribute.DISTANCETOSTART,A[0][1]])}return new t.Geometry(p,A,w.PrimitiveType.Line)};a.geometryToRenderInfo=
function(z,A,p,y){const {position:D,outlines:E}=f.pathsToTriangulationInfo("polygon"===z.type?z.rings:z.paths,z.hasZ,"polygon"===z.type?f.CounterClockwiseMode.CCW_IS_HOLE:f.CounterClockwiseMode.NONE),F=new Float64Array(D.length);z=h.applyPerVertexElevationAlignment(D,z.spatialReference,0,F,0,D,0,D.length/3,A,p,y);A=null!=z;return{lines:A?q(E,D,F):[],projectionSuccess:A,sampledElevation:z}};a.geometryToRenderInfoDraped=function(z,A){const {position:p,outlines:y}=f.pathsToTriangulationInfo("polygon"===
z.type?z.rings:z.paths,!1,"polygon"===z.type?f.CounterClockwiseMode.CCW_IS_HOLE:f.CounterClockwiseMode.NONE);z=g.projectBuffer(p,z.spatialReference,0,p,A,0,p.length/3);for(A=2;A<p.length;A+=3)p[A]=v.DRAPED_Z;return{lines:z?q(y,p):[],projectionSuccess:z}};a.parseCapType=function(z){switch(z){case "butt":return B.CapType.BUTT;case "square":return B.CapType.SQUARE;case "round":return B.CapType.ROUND;default:return null}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/layers/support/markerUtils":function(){define(["exports","../../../../core/maybe","../graphics/sdfPrimitives"],function(a,b,c){function m(r,n){return r.fromData(n,()=>c.createTexture(n,64,32,6.4))}function l(r){return"diamond"===r?"kite":r}a.MARKER_SYMBOL_SIZE=32;a.MARKER_TEXTURE_SIZE=64;a.MARKER_THICKNESS=6.4;a.parseLineMarkerStyle=l;a.prepareMarkerResources=function(r,n){return b.isSome(n)?m(r,l(n.style)):null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/materials/LineMarkerMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../lib/GLMaterials ../lib/GLTextureMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./VisualVariablePassParameters ../shaders/LineMarkerTechnique ../shaders/LineMarkerTechniqueConfiguration ../shaders/RibbonLineTechniqueConfiguration".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w){let t=function(z){function A(y){y=z.call(this,y,new B)||this;y._vertexAttributeLocations=h.markerVertexAttributeLocations;y.techniqueConfig=new v.LineMarkerTechniqueConfiguration;y.layout=y.createLayout();return y}b._inheritsLoose(A,z);var p=A.prototype;p.dispose=function(){};p.getConfiguration=function(y,D){this.techniqueConfig.output=y;this.techniqueConfig.draped=D.slot===f.RenderSlot.DRAPED_MATERIAL;this.techniqueConfig.hasCap=this.parameters.cap!==w.CapType.BUTT;
this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane;this.techniqueConfig.hasOccludees=this.parameters.hasOccludees;this.techniqueConfig.writeDepth=this.parameters.writeDepth;this.techniqueConfig.vvColor=this.parameters.vvColorEnabled;this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled;this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled;this.techniqueConfig.occluder=this.parameters.renderOccluded===k.RenderOccludedFlag.OccludeAndTransparentStencil;this.techniqueConfig.transparencyPassType=
D.transparencyPassType;this.techniqueConfig.hasMultipassTerrain=D.multipassTerrain.enabled;this.techniqueConfig.cullAboveGround=D.multipassTerrain.cullAboveGround;return this.techniqueConfig};p.intersect=function(){};p.createLayout=function(){const y=l.newLayout().vec3f(d.VertexAttribute.POSITION).vec2f(d.VertexAttribute.UV0).vec3f(d.VertexAttribute.AUXPOS1);this.parameters.vvSizeEnabled?y.f32(d.VertexAttribute.SIZEFEATUREATTRIBUTE):y.f32(d.VertexAttribute.SIZE);this.parameters.vvColorEnabled?y.f32(d.VertexAttribute.COLORFEATUREATTRIBUTE):
y.vec4f(d.VertexAttribute.COLOR);this.parameters.vvOpacityEnabled&&y.f32(d.VertexAttribute.OPACITYFEATUREATTRIBUTE);return y};p.createBufferWriter=function(){return new q(this.layout,this.parameters)};p.requiresSlot=function(y,D){if(y===f.RenderSlot.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===k.RenderOccludedFlag.OccludeAndTransparentStencil)return y===f.RenderSlot.OPAQUE_MATERIAL||y===f.RenderSlot.OCCLUDER_MATERIAL||y===f.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL;D=n.outputFromPass(D);
return D===r.ShaderOutput.Color||D===r.ShaderOutput.Alpha?y===(this.parameters.writeDepth?f.RenderSlot.TRANSPARENT_MATERIAL:f.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):y===f.RenderSlot.OPAQUE_MATERIAL};p.createGLMaterial=function(y){return y.output===r.ShaderOutput.Color||y.output===r.ShaderOutput.Alpha||y.output===r.ShaderOutput.Highlight||y.output===r.ShaderOutput.Depth?new x(y):null};return A}(k.Material),x=function(z){function A(){return z.apply(this,arguments)||this}b._inheritsLoose(A,
z);var p=A.prototype;p._updateParameters=function(y){this.updateTexture(this._material.parameters.textureId);this._material.setParameters(this.textureBindParameters);return this.ensureTechnique(h.LineMarkerTechnique,y)};p._updateOccludeeState=function(y){y.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:y.hasOccludees})};p.beginSlot=function(y){this._output!==r.ShaderOutput.Color&&this._output!==r.ShaderOutput.Alpha||this._updateOccludeeState(y);return this._updateParameters(y)};
return A}(g.GLTextureMaterial),B=function(z){function A(){var p=z.apply(this,arguments)||this;p.width=0;p.color=[1,1,1,1];p.placement="end";p.cap=w.CapType.BUTT;p.writeDepth=!0;p.hasSlicePlane=!1;p.vvFastUpdate=!1;p.hasOccludees=!1;return p}b._inheritsLoose(A,z);return A}(e.VisualVariablePassParameters),q=function(){function z(p,y){this.vertexBufferLayout=p;this.parameters=y}var A=z.prototype;A.allocate=function(p){return this.vertexBufferLayout.createBuffer(p)};A.elementCount=function(){return"begin-end"===
this.parameters.placement?12:6};A.write=function(p,y,D,E){const F=y.vertexAttributes.get(d.VertexAttribute.POSITION).data,G=F.length/3;let P=1,K=0;this.parameters.vvSizeEnabled?K=y.vertexAttributes.get(d.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0]:y.vertexAttributes.has(d.VertexAttribute.SIZE)&&(P=y.vertexAttributes.get(d.VertexAttribute.SIZE).data[0]);let N=[1,1,1,1],M=0;this.parameters.vvColorEnabled?M=y.vertexAttributes.get(d.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:y.vertexAttributes.has(d.VertexAttribute.COLOR)&&
(N=y.vertexAttributes.get(d.VertexAttribute.COLOR).data);let L=0;this.parameters.vvOpacityEnabled&&(L=y.vertexAttributes.get(d.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]);const J=p.transformation,H=new Float32Array(D.buffer);let I=this.vertexBufferLayout.stride/4*E;const O=(S,T,U,aa)=>{H[I++]=S[0];H[I++]=S[1];H[I++]=S[2];H[I++]=U[0];H[I++]=U[1];H[I++]=T[0];H[I++]=T[1];H[I++]=T[2];this.parameters.vvSizeEnabled?H[I++]=K:H[I++]=P;this.parameters.vvColorEnabled?H[I++]=M:(S=Math.min(4*aa,N.length-
4),H[I++]=N[S+0],H[I++]=N[S+1],H[I++]=N[S+2],H[I++]=N[S+3]);this.parameters.vvOpacityEnabled&&(H[I++]=L)};let Q;(function(S){S[S.ASCENDING=1]="ASCENDING";S[S.DESCENDING=-1]="DESCENDING"})(Q||(Q={}));p=(S,T)=>{const U=c.set(u,F[3*S],F[3*S+1],F[3*S+2]),aa=C;let W=S+T;do c.set(aa,F[3*W],F[3*W+1],F[3*W+2]),W+=T;while(c.equals(U,aa)&&0<=W&&W<G);J&&(c.transformMat4(U,U,J),c.transformMat4(aa,aa,J));O(U,aa,[-1,-1],S);O(U,aa,[1,-1],S);O(U,aa,[1,1],S);O(U,aa,[-1,-1],S);O(U,aa,[1,1],S);O(U,aa,[-1,1],S)};y=this.parameters.placement;
"begin"!==y&&"begin-end"!==y||p(0,Q.ASCENDING);"end"!==y&&"begin-end"!==y||p(G-1,Q.DESCENDING)};return z}();const u=m.create(),C=m.create();a.LineMarkerMaterial=t;a.Parameters=B;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/LineMarkerTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/ShaderOutputOptions ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/OrderIndependentTransparency ../lib/Program ../lib/RenderSlot ../lib/StencilUtils ../lib/VertexAttribute ../../../../chunks/LineMarker.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){const w=new Map([[e.VertexAttribute.POSITION,0],[e.VertexAttribute.UV0,2],[e.VertexAttribute.AUXPOS1,3],[e.VertexAttribute.SIZE,6],[e.VertexAttribute.SIZEFEATUREATTRIBUTE,6],[e.VertexAttribute.COLOR,5],[e.VertexAttribute.COLORFEATUREATTRIBUTE,5],[e.VertexAttribute.OPACITYFEATUREATTRIBUTE,7]]);r=function(t){function x(){return t.apply(this,arguments)||this}c._inheritsLoose(x,t);var B=x.prototype;B.initializeProgram=function(q){const u=x.shader.get().build(this.configuration);
return new k.Program(q.rctx,u,w)};B._makePipelineState=function(q,u){const C=this.configuration,z=q===n.TransparencyPassType.NONE;return v.makePipelineState({blending:C.output===m.ShaderOutput.Color||C.output===m.ShaderOutput.Alpha?z?g.blendingDefault:g.oitBlending(q):null,depthTest:{func:g.oitDepthTest(q)},depthWrite:z?C.writeDepth&&v.defaultDepthWriteParams:g.oitDepthWrite(q),colorWrite:v.defaultColorWriteParams,stencilWrite:C.hasOccludees?d.stencilWriteMaskOn:null,stencilTest:C.hasOccludees?u?
d.stencilToolMaskBaseParams:d.stencilBaseAllZerosParams:null,polygonOffset:{factor:0,units:-10}})};B.initializePipeline=function(){this.configuration.occluder&&(this._occluderPipelineTransparent=v.makePipelineState({blending:g.blendingDefault,depthTest:d.depthCompareAlways,depthWrite:null,colorWrite:v.defaultColorWriteParams,stencilWrite:null,stencilTest:d.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=v.makePipelineState({blending:g.blendingDefault,depthTest:d.depthCompareAlways,
depthWrite:null,colorWrite:v.defaultColorWriteParams,stencilWrite:d.stencilWriteMaskOff,stencilTest:d.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=v.makePipelineState({blending:null,depthTest:d.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:d.stencilWriteMaskOn,stencilTest:d.stencilToolMaskBaseParams}));this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0);return this._makePipelineState(this.configuration.transparencyPassType,
!1)};B.getPipelineState=function(q,u){return u?this._occludeePipelineState:this.configuration.occluder?q===f.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:q===f.RenderSlot.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:t.prototype.getPipelineState.call(this,q,u)};return x}(r.ShaderTechnique);r.shader=new l.ReloadableShaderModule(h.LineMarker,()=>new Promise((t,x)=>a(["./LineMarker.glsl"],t,x)));b.LineMarkerTechnique=r;b.markerVertexAttributeLocations=
w;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/LineMarker.glsl":function(){define("exports ../views/3d/layers/support/markerUtils ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/basicInterfaces ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u){function C(A){const p=new x.ShaderBuilder,y=A.hasMultipassTerrain&&(A.output===c.ShaderOutput.Color||A.output===c.ShaderOutput.Alpha);p.include(l.RibbonVertexPosition,A);A.output===c.ShaderOutput.Depth&&p.include(r.OutputDepth,A);const {vertex:D,fragment:E}=p;E.include(f.RgbaFloatEncoding);d.addProjViewLocalOrigin(p,A);p.attributes.add(u.VertexAttribute.POSITION,"vec3");p.attributes.add(u.VertexAttribute.UV0,"vec2");p.attributes.add(u.VertexAttribute.AUXPOS1,
"vec3");p.varyings.add("vColor","vec4");p.varyings.add("vpos","vec3");p.varyings.add("vUV","vec2");p.varyings.add("vSize","float");p.varyings.add("linearDepth","float");y&&p.varyings.add("depth","float");D.code.add(w.glsl`#define PERPENDICULAR(v) vec2(v.y, -v.x)
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}`);D.uniforms.add([new e.Float2PassUniform("nearFar",(F,G)=>G.camera.nearFar),new h.Float4PassUniform("viewport",(F,G)=>G.camera.fullViewport)]);D.code.add(w.glsl`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`);D.code.add(w.glsl`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
prev = mix(pos, prev, interp(vnp, pos, prev));
}
}`);A.draped||(D.uniforms.add(new t.Matrix4PassUniform("inverseProjectionMatrix",(F,G)=>G.camera.inverseProjectionMatrix)),D.code.add(w.glsl`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),D.code.add(w.glsl`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),D.uniforms.add(new v.FloatPassUniform("perScreenPixelRatio",(F,G)=>G.camera.perScreenPixelRatio)),D.code.add(w.glsl`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${A.hasCap?"\n                if(prev.z \x3e posLeft.z) {\n                  vec2 diff \x3d posLeft.xy - posRight.xy;\n                  planeOrigin.xy +\x3d PERPENDICULAR(diff) / 2.0;\n                }\n              ":""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `));D.uniforms.add(new v.FloatPassUniform("pixelRatio",(F,G)=>G.camera.pixelRatio));D.code.add(w.glsl`
    void main(void) {
      float coverage = 1.0;

      // Check for special value of uv0.y which is used by the Renderer when graphics
      // are removed before the VBO is recompacted. If this is the case, then we just
      // project outside of clip space.
      if (uv0.y == 0.0) {
        // Project out of clip space
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
      }
      else {
        float lineSize = getSize();
        float lineWidth = max(lineSize, 1.0) * pixelRatio;

        vec4 pos  = view * vec4(position.xyz, 1.0);
        vec4 prev = view * vec4(auxpos1.xyz, 1.0);
        clip(pos, prev);

        vec4 posScreen = projectAndScale(pos);
        vec4 prevScreen = projectAndScale(prev);

        vec2 segment = posScreen.xy - prevScreen.xy;

        // normalize vector along line segment
        float segmentLen = length(segment);
        segment = (segmentLen > 0.001) ? segment / segmentLen : vec2(0.0, 0.0);

        // displace according to position in the texture
        vec2 displacementDirU = PERPENDICULAR(segment);
        vec2 displacementDirV = segment;

        float displacementLen = ${w.glsl.float(b.MARKER_TEXTURE_SIZE/b.MARKER_THICKNESS)} * lineWidth;

        vec4 displacedPosScreen = posScreen;
        displacedPosScreen.xy += uv0.x * displacementDirU * displacementLen + uv0.y * displacementDirV * displacementLen;
  `);A.draped||D.code.add(w.glsl`vec3 posRight = inverseProject(posScreen + vec4(displacementDirU.xy, 0.0, 0.0) * lineWidth);
vec3 posLeft = pos.xyz + (pos.xyz - posRight);
pos = toFront(displacedPosScreen, posLeft, posRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`);D.code.add(w.glsl`
        ${y?"depth \x3d pos.z;":""}
        linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1] and cancel out perspective correct interpolation
        vUV = (uv0 + 1.0) / 2.0;
        vUV *= displacedPosScreen.w;

        vSize = displacementLen;

        vColor = getColor();
        vColor.a *= coverage;

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `);y&&p.include(n.multipassTerrainTest,A);p.include(m.SliceDraw,A);E.uniforms.add([new h.Float4PassUniform("intrinsicColor",F=>F.color),new B.Texture2DPassUniform("tex",F=>F.texture)]);E.include(k.ColorConversion);E.code.add(w.glsl`
  void main() {
    discardBySlice(vpos);
    ${y?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    // Offset texture coordinate s.t. we sample texel centers
    float texelSize = ${w.glsl.float(1/b.MARKER_TEXTURE_SIZE)};
    vec2 samplePos = vUV * gl_FragCoord.w + vec2(0.5, -0.5) * texelSize;

    // Evaluate sdf
    float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
    float distance = sdf * vSize;

    // Grow by a halfpixel to make sure the line is fully covered by the cross marker
    // (otherwise there will be a halo if they are different colours)
    distance -= 0.5;

    finalColor.a *= clamp(0.5 - distance, 0.0, 1.0);

    if (finalColor.a < ${w.glsl.float(g.symbolAlphaCutoff)}) {
      discard;
    }

    ${A.output===c.ShaderOutput.Alpha?w.glsl`gl_FragColor = vec4(finalColor.a);`:""}
    ${A.output===c.ShaderOutput.Color?w.glsl`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${A.output===c.ShaderOutput.Color&&A.transparencyPassType===q.TransparencyPassType.Color?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
    ${A.output===c.ShaderOutput.Highlight?w.glsl`gl_FragColor = vec4(1.0);`:""}
    ${A.output===c.ShaderOutput.Depth?w.glsl`outputDepth(linearDepth);`:""}
  }
  `);return p}const z=Object.freeze(Object.defineProperty({__proto__:null,build:C},Symbol.toStringTag,{value:"Module"}));a.LineMarker=z;a.build=C})},"esri/views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../materials/DefaultTechniqueConfiguration".split(" "),function(a,
b,c,m,l,r,n){n=function(g){function k(){var f=g.apply(this,arguments)||this;f.output=m.ShaderOutput.Color;f.transparencyPassType=r.TransparencyPassType.NONE;f.occluder=!1;f.hasSlicePlane=!1;f.writeDepth=!1;f.draped=!1;f.hasCap=!1;f.vvSize=!1;f.vvColor=!1;f.vvOpacity=!1;f.hasOccludees=!1;f.hasMultipassTerrain=!1;f.cullAboveGround=!1;return f}b._inheritsLoose(k,g);return k}(n.DefaultTechniqueConfiguration);c.__decorate([l.parameter({count:m.ShaderOutput.COUNT})],n.prototype,"output",void 0);c.__decorate([l.parameter({count:r.TransparencyPassType.COUNT})],
n.prototype,"transparencyPassType",void 0);c.__decorate([l.parameter()],n.prototype,"occluder",void 0);c.__decorate([l.parameter()],n.prototype,"hasSlicePlane",void 0);c.__decorate([l.parameter()],n.prototype,"writeDepth",void 0);c.__decorate([l.parameter()],n.prototype,"draped",void 0);c.__decorate([l.parameter()],n.prototype,"hasCap",void 0);c.__decorate([l.parameter()],n.prototype,"vvSize",void 0);c.__decorate([l.parameter()],n.prototype,"vvColor",void 0);c.__decorate([l.parameter()],n.prototype,
"vvOpacity",void 0);c.__decorate([l.parameter()],n.prototype,"hasOccludees",void 0);c.__decorate([l.parameter()],n.prototype,"hasMultipassTerrain",void 0);c.__decorate([l.parameter()],n.prototype,"cullAboveGround",void 0);c.__decorate([l.parameter({constValue:!0})],n.prototype,"hasVvInstancing",void 0);c.__decorate([l.parameter({constValue:!0})],n.prototype,"hasSliceTranslatedView",void 0);a.LineMarkerTechniqueConfiguration=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/materials/lineStippleUtils":function(){define(["exports","../../../../core/maybe"],function(a,b){function c(n,g=2){return b.isNone(n)?n:{pattern:n.slice(),pixelRatio:g}}function m(n){return b.isSome(n)?c(r[n],8):null}const l={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},r={dash:l.dash,"dash-dot":[...l.dash,...l.dot],dot:l.dot,"long-dash":l["long-dash"],"long-dash-dot":[...l["long-dash"],...l.dot],"long-dash-dot-dot":[...l["long-dash"],...l.dot,
...l.dot],none:null,"short-dash":l["short-dash"],"short-dash-dot":[...l["short-dash"],...l["short-dot"]],"short-dash-dot-dot":[...l["short-dash"],...l["short-dot"],...l["short-dot"]],"short-dot":l["short-dot"],solid:null};a.createStipplePattern=c;a.createStipplePatternSimple=function(n,g=2){return{pattern:[n,n],pixelRatio:g}};a.getStipplePatternForLinePattern=function(n){return b.isSome(n)&&"style"===n.type?m(n.style):null};a.getStipplePatternForPatternStyle=m;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/MeshComponent ../../../../geometry/support/MeshMaterialMetallicRoughness ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec32 ../../../../geometry/support/meshUtils/projection ../../../../layers/graphics/dehydratedFeatures ../../../ViewingMode ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ../support/edgeUtils ../support/symbolColorUtils ../../support/debugFlags ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/geometryDataUtils ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial ../../../webgl/enums".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N,M,L,J,H,I,O){const Q=["mesh"];m=function(ia){function ka(Y,ea,ba,Z){Y=ia.call(this,Y,ea,ba,Z)||this;Y._materials=new Map;Y._textures=new Map;Y.ensureDrapedStatus(!1);return Y}b._inheritsLoose(ka,ia);var la=ka.prototype;la.doLoad=function(){var Y=b._asyncToGenerator(function*(){G.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new I.NativeLineMaterial({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new I.NativeLineMaterial({color:[0,
1,1,1]}))});return function(){return Y.apply(this,arguments)}}();la.destroy=function(){ia.prototype.destroy.call(this);this._context.stage.removeMany(Array.from(this._materials.values(),Y=>Y.material));this._context.stage.removeMany(Array.from(this._textures.values()));this._materials.clear();this._textures.clear()};la.createGraphics3DGraphic=function(Y){const ea=Y.graphic;if(!this._validateGeometry(ea.geometry,Q,"fill on mesh-3d"))return null;const ba=this.setGraphicElevationContext(ea,new p.ElevationContext);
return this._createAs3DShape(ea,Y.renderingInfo,ba,ea.uid)};la.layerOpacityChanged=function(Y,ea){const ba=this._getLayerOpacity();this._materials.forEach(Z=>{Z.material.setParameters({layerOpacity:ba});const fa=Z.material.parameters;this._setMaterialTransparentParameter(fa,Z);Z.material.setParameters({transparent:fa.transparent})});Y.forEach(Z=>{Z=ea(Z);l.isSome(Z)&&Z.layerOpacityChanged(ba,this._context.isAsync)});return!0};la.layerElevationInfoChanged=function(Y,ea){return this.updateGraphics3DGraphicElevationInfo(Y,
ea,A.needsElevationUpdates3D)};la.slicePlaneEnabledChanged=function(Y,ea){this._materials.forEach(ba=>{ba.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});Y.forEach(ba=>{ba=ea(ba);l.isSome(ba)&&ba.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)});return!0};la.physicalBasedRenderingChanged=function(){const Y=this._usePBR();this._materials.forEach(ea=>ea.material.setParameters({usePBR:Y}));return!0};la.pixelRatioChanged=function(){return!0};la._requiresSymbolVertexColors=
function(){return this._drivenProperties.color||this._drivenProperties.opacity};la._colorOrTextureUid=function(Y){return l.isNone(Y)?"-":Y instanceof c?Y.toHex():Y.contentHash};la._materialPropertiesDefault=function(Y,ea){const ba=this._requiresSymbolVertexColors(),Z=!!Y.vertexAttributes.color;Y=!!Y.vertexAttributes.tangent;return{hasSymbolVertexColors:ba,hasVertexColors:Z,hasVertexTangents:Y,uid:`vc:${Z},vt:${Y},vct${ea},svc:${ba}`}};la._materialProperties=function(Y,ea,ba){Y=this._materialPropertiesDefault(Y,
ba);if(!ea.material)return Y;const {color:Z,colorTexture:fa,normalTexture:ja,doubleSided:oa,alphaCutoff:sa,alphaMode:qa}=ea.material;ba=this._colorOrTextureUid(Z);var Ha=this._colorOrTextureUid(fa),Ga=this._colorOrTextureUid(ja);Y.color=Z;Y.colorTexture=fa;Y.normalTexture=ja;Y.uid=`${Y.uid},cmuid:${ba},ctmuid:${Ha},ntmuid:${Ga},ds:${oa},ac:${sa},am:${qa}`;if(ea.material instanceof t){const {metallic:pa,roughness:Da,metallicRoughnessTexture:ra,emissiveColor:Ea,emissiveTexture:Ia,occlusionTexture:Ma}=
ea.material;ea=this._colorOrTextureUid(ra);ba=this._colorOrTextureUid(Ea);Ha=this._colorOrTextureUid(Ia);Ga=this._colorOrTextureUid(Ma);Y.metallic=pa;Y.roughness=Da;Y.metallicRoughnessTexture=ra;Y.emissiveColor=Ea;Y.emissiveTexture=Ia;Y.occlusionTexture=Ma;Y.uid=`${Y.uid},mrm:${pa},mrr:${Da},mrt:${ea},emuid:${ba},etmuid:${Ha},otmuid:${Ga}`}return Y};la._setInternalColorValueParameters=function(Y,ea){ea.diffuse=c.toUnitRGB(Y);ea.opacity=Y.a};la._getLoadableTextureResource=function(Y){return Y.data?
Y.data:Y.url};la._getInternalTextureId=function(Y){Y=this._getInternalTexture(Y,P.AlphaDiscardMode.Opaque);return l.isSome(Y)?Y.id:null};la._getInternalTexture=function(Y,ea){const ba=this._getLoadableTextureResource(Y);if(!ba)return null;const Z=`${Y.contentHash}/${ea}`;let fa=this._textures.get(Z);fa||(fa=new L.Texture(ba,{mipmap:!0,wrap:this._castTextureWrap(Y.wrap),noUnpackFlip:!0,preMultiplyAlpha:ea!==P.AlphaDiscardMode.Opaque}),this._textures.set(Z,fa),this._context.stage.add(fa),this._context.stage.loadImmediate(fa));
return fa};la._castTextureWrap=function(Y="repeat"){return"string"===typeof Y?(Y=this._castTextureWrapIndividual(Y),{s:Y,t:Y}):{s:this._castTextureWrapIndividual(Y.horizontal),t:this._castTextureWrapIndividual(Y.vertical)}};la._castTextureWrapIndividual=function(Y){switch(Y){case "clamp":return O.TextureWrapMode.CLAMP_TO_EDGE;case "mirror":return O.TextureWrapMode.MIRRORED_REPEAT;default:return O.TextureWrapMode.REPEAT}};la._setInternalMaterialParameters=function(Y,ea){l.isSome(Y.color)&&this._setInternalColorValueParameters(Y.color,
ea);if(l.isSome(Y.colorTexture)){const ba=this._getInternalTexture(Y.colorTexture,ea.textureAlphaMode);l.isSome(ba)?(ea.textureId=ba.id,ea.textureAlphaPremultiplied=!!ba.params.preMultiplyAlpha):ea.textureId=void 0}l.isSome(Y.normalTexture)&&(ea.normalTextureId=this._getInternalTextureId(Y.normalTexture));l.isSome(Y.emissiveColor)&&(ea.emissiveFactor=c.toUnitRGB(Y.emissiveColor));l.isSome(Y.emissiveTexture)&&(ea.emissiveTextureId=this._getInternalTextureId(Y.emissiveTexture));l.isSome(Y.occlusionTexture)&&
(ea.occlusionTextureId=this._getInternalTextureId(Y.occlusionTexture));l.isSome(Y.metallicRoughnessTexture)&&(ea.metallicRoughnessTextureId=this._getInternalTextureId(Y.metallicRoughnessTexture))};la._setExternalMaterialParameters=function(Y){var ea=this._drivenProperties.color;let ba=l.isSome(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;ea?Y.externalColor=e.ONES:(ea=l.isSome(this.symbolLayer.material)?this.symbolLayer.material.color:null,l.isSome(ea)?Y.externalColor=c.toUnitRGBA(ea):
(ba=null,Y.externalColor=e.ONES));ba&&(Y.colorMixMode=ba);Y.castShadows=!!this.symbolLayer.castShadows};la._hasTransparentVertexColors=function(Y){Y=Y.vertexAttributes.color;if(l.isNone(Y))return!1;for(let ea=3;ea<Y.length;ea+=4)if(255!==Y[ea])return!0;return!1};la._getOrCreateMaterial=function(Y,ea){var ba,Z,fa,ja=null==(ba=ea.material)?void 0:ba.color;ba=null==(Z=ea.material)?void 0:Z.colorTexture;Z=null==(fa=ea.material)?void 0:fa.alphaMode;fa="blend"===Z;ja="opaque"!==Z&&(this._hasTransparentVertexColors(Y)||
l.isSome(ja)&&1>ja.a||l.isSome(ba)&&ba.transparent||fa);Y=this._materialProperties(Y,ea,ja);if(fa=this._materials.get(Y.uid))return fa.material;ja={material:null,isComponentTransparent:ja,alphaMode:ea.material?ea.material.alphaMode:"opaque"};fa=null==Y.metallicRoughnessTexture&&null==Y.metallic&&null==Y.roughness;ba={usePBR:this._usePBR(),isSchematic:fa,hasVertexColors:Y.hasVertexColors,hasSymbolColors:Y.hasSymbolVertexColors,hasVertexTangents:Y.hasVertexTangents,ambient:d.ZEROS,diffuse:d.ONES,opacity:1,
doubleSided:!0,doubleSidedType:"winding-order",cullFace:P.CullFaceOptions.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};fa||(ba.mrrFactors=[null!=Y.metallic?Y.metallic:1,null!=Y.roughness?Y.roughness:1,.5]);ea.material&&(ba.doubleSided=ea.material.doubleSided,ba.cullFace=ea.material.doubleSided?P.CullFaceOptions.None:P.CullFaceOptions.Back,ba.textureAlphaCutoff=ea.material.alphaCutoff);this._setExternalMaterialParameters(ba);this._setMaterialTransparentParameter(ba,
ja);this._setInternalMaterialParameters(Y,ba);ea=new H.DefaultMaterial(ba);ja.material=ea;this._materials.set(Y.uid,ja);this._context.stage.add(ea);return ea};la._usePBR=function(){return this._context.physicalBasedRenderingEnabled};la._setMaterialTransparentParameter=function(Y,ea){Y.transparent=this.needsDrivenTransparentPass||ea.isComponentTransparent||1>Y.layerOpacity||1>Y.opacity||Y.externalColor&&1>Y.externalColor[3];Y.textureAlphaMode="auto"===ea.alphaMode?Y.transparent?P.AlphaDiscardMode.MaskBlend:
P.AlphaDiscardMode.Opaque:"opaque"===ea.alphaMode?P.AlphaDiscardMode.Opaque:"mask"===ea.alphaMode?P.AlphaDiscardMode.Mask:P.AlphaDiscardMode.Blend};la._addDebugNormals=function(Y,ea,ba,Z){var fa=ea.length,ja=Y.spatialReference.isGeographic?20015077/180:1;const oa=.1*Math.max(Y.extent.width*ja,Y.extent.height*ja,Y.extent.zmax-Y.extent.zmin),sa=[],qa=[];Y=[];ja=[];for(let Ea=0;Ea<fa;Ea++){var Ha=ea[Ea],Ga=Ha.vertexAttributes.get(J.VertexAttribute.POSITION),pa=Ha.vertexAttributes.get(J.VertexAttribute.NORMAL);
const Ia=Ha.indices.get(J.VertexAttribute.POSITION);Ha=Ha.indices.get(J.VertexAttribute.NORMAL);Ga=Ga.data;pa=pa.data;for(let Ma=0;Ma<Ia.length;Ma++){var Da=3*Ia[Ma];const Qa=3*Ha[Ma];for(var ra=0;3>ra;ra++)sa.push(Ga[Da+ra]);for(ra=0;3>ra;ra++)sa.push(Ga[Da+ra]+pa[Qa+ra]*oa);qa.push(qa.length);qa.push(qa.length);if(0===Ma%3){this._calculateFaceNormal(Ga,Ia,Ma,W);this._getFaceVertices(Ga,Ia,Ma,T,U,aa);f.add(T,T,U);f.add(T,T,aa);f.scale(T,T,1/3);for(Da=0;3>Da;Da++)Y.push(T[Da]);for(Da=0;3>Da;Da++)Y.push(T[Da]+
W[Da]*oa);ja.push(ja.length);ja.push(ja.length)}}}fa=new K.Geometry([[J.VertexAttribute.POSITION,{data:sa,size:3,exclusive:!0}]],[[J.VertexAttribute.POSITION,new Uint32Array(qa)]],P.PrimitiveType.Line);ea.push(fa);ba.push(this._debugVertexNormalMaterial);Z.push(k.clone(Z[0]));fa=new K.Geometry([[J.VertexAttribute.POSITION,{data:Y,size:3,exclusive:!0}]],[[J.VertexAttribute.POSITION,new Uint32Array(ja)]],P.PrimitiveType.Line);ea.push(fa);ba.push(this._debugFaceNormalMaterial);Z.push(k.clone(Z[0]))};
la._createAs3DShape=function(Y,ea,ba,Z){Y=Y.geometry;if("mesh"!==Y.type)return null;ea=this._createGeometryInfo(Y,ea);if(!ea)return null;const {geometries:fa,materials:ja,transformations:oa,objectTransformation:sa}=ea;G.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(Y,fa,ja,oa);Z=new M.Object3D({geometries:fa,materials:ja,transformations:oa,metadata:{layerUid:this._context.layer.uid,graphicUid:Z}});Z.transformation=sa;ea=this._createEdgeMaterial();ea=l.isSome(ea)?{baseMaterial:ja[0],edgeMaterials:[ea],
properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null;ea=new y.Graphics3DObject3DGraphicLayer(this,Z,fa,null,null,z.perObjectElevationAligner,ba,ea);ea.needsElevationUpdates=A.needsElevationUpdates3D(ba.mode);ea.useObjectOriginAsAttachmentOrigin=!0;ea.elevationContext.centerPointInElevationSR=this._getCenterPointInElevationSR(Z);ea.alignedSampledElevation=z.perObjectElevationAligner(ea,ea.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper);
return ea};la._getCenterPointInElevationSR=function(Y){const ea=u.makeDehydratedPoint(0,0,0,this._context.elevationProvider.spatialReference);h.projectVectorToDehydratedPoint([Y.transformation[12],Y.transformation[13],Y.transformation[14]],this._context.renderCoordsHelper.spatialReference,ea);return ea};la._createComponentNormals=function(Y,ea,ba,Z){switch(ba.shading||"flat"){case "source":return this._createComponentNormalsSource(Y,ea,ba,Z);case "flat":return this._createComponentNormalsFlat(Y,Z);
case "smooth":return this._createComponentNormalsSmooth(Y,Z)}};la._createComponentNormalsSource=function(Y,ea,ba,Z){if(l.isNone(ea))return this._createComponentNormalsFlat(Y,Z);let fa=!1;if(!ba.trustSourceNormals)for(ba=0;ba<Z.length;ba+=3){this._calculateFaceNormal(Y,Z,ba,W);for(let ja=0;3>ja;ja++){const oa=3*Z[ba+ja];T[0]=ea[oa+0];T[1]=ea[oa+1];T[2]=ea[oa+2];0>f.dot(W,T)&&(ea[oa+0]=-ea[oa+0],ea[oa+1]=-ea[oa+1],ea[oa+2]=-ea[oa+2],fa=!0)}}return{normals:ea,indices:Z,didFlipNormals:fa}};la._createComponentNormalsFlat=
function(Y,ea){const ba=new Float32Array(ea.length),Z=new Uint32Array(3*ea.length);for(let fa=0;fa<ea.length;fa+=3){const ja=this._calculateFaceNormal(Y,ea,fa,W);for(let oa=0;3>oa;oa++)ba[fa+oa]=ja[oa],Z[fa+oa]=fa/3}return{normals:ba,indices:Z,didFlipNormals:!1}};la._createComponentNormalsSmooth=function(Y,ea){const ba={};for(var Z=0;Z<ea.length;Z+=3){var fa=this._calculateFaceNormal(Y,ea,Z,W);for(var ja=0;3>ja;ja++){var oa=ea[Z+ja];let sa=ba[oa];sa||(sa={normal:d.create(),count:0},ba[oa]=sa);f.add(sa.normal,
sa.normal,fa);sa.count++}}Y=new Float32Array(3*ea.length);Z=new Uint32Array(3*ea.length);for(fa=0;fa<ea.length;fa++){ja=ba[ea[fa]];1!==ja.count&&(f.normalize(ja.normal,ja.normal),ja.count=1);for(oa=0;3>oa;oa++)Y[3*fa+oa]=ja.normal[oa];Z[fa]=fa}return{normals:Y,indices:Z,didFlipNormals:!1}};la._getFaceVertices=function(Y,ea,ba,Z,fa,ja){const oa=3*ea[ba+0],sa=3*ea[ba+1];ea=3*ea[ba+2];Z[0]=Y[oa+0];Z[1]=Y[oa+1];Z[2]=Y[oa+2];fa[0]=Y[sa+0];fa[1]=Y[sa+1];fa[2]=Y[sa+2];ja[0]=Y[ea+0];ja[1]=Y[ea+1];ja[2]=Y[ea+
2]};la._calculateFaceNormal=function(Y,ea,ba,Z){this._getFaceVertices(Y,ea,ba,T,U,aa);f.subtract(U,U,T);f.subtract(aa,aa,T);f.cross(T,U,aa);f.normalize(Z,T);return Z};la._getOrCreateComponents=function(Y){return l.unwrapOr(Y.components,ca)};la._createPositionBuffer=function(Y,ea){let ba=Y.vertexAttributes.position;const Z=ea.reprojection===ha.ECEF?ea.transformBeforeProject:null;l.isSome(Z)&&(ba=q.transformPosition(ba,new Float64Array(ba.length),Z));if(ea.reprojection===ha.NONE)return ea.needsBufferCopy?
new Float64Array(ba):ba;ea=l.isSome(Z)?ba:new Float64Array(ba.length);h.projectBuffer(ba,Y.spatialReference,0,ea,this._context.renderCoordsHelper.spatialReference,0,ba.length/3);return ea};la._createNormalBuffer=function(Y,ea,ba){let Z=Y.vertexAttributes.normal;if(l.isNone(Z))return null;var fa=ba.reprojection===ha.ECEF?ba.transformBeforeProject:null;l.isSome(fa)&&(Z=q.transformNormal(Z,new Float32Array(Z.length),fa));if("local"===this._context.graphicsCoreOwner.view.viewingMode||ba.reprojection===
ha.NONE)return ba.needsBufferCopy&&Y.vertexAttributes.normal===Z?new Float32Array(Z):Z;ba=Y.vertexAttributes.position;fa=l.isSome(fa)?Z:new Float32Array(Z.length);return q.projectNormalToPCPF(Z,ba,ea,Y.spatialReference,fa)};la._createTangentBuffer=function(Y,ea,ba){let Z=Y.vertexAttributes.tangent;if(l.isNone(Z))return null;var fa=ba.reprojection===ha.ECEF?ba.transformBeforeProject:null;l.isSome(fa)&&(Z=q.transformTangent(Z,new Float32Array(Z.length),fa));if("local"===this._context.graphicsCoreOwner.view.viewingMode||
ba.reprojection===ha.NONE)return ba.needsBufferCopy&&Y.vertexAttributes.normal===Z?new Float32Array(Z):Z;ba=Y.vertexAttributes.position;fa=l.isSome(fa)?Z:new Float32Array(Z.length);return q.projectTangentToPCPF(Z,ba,ea,Y.spatialReference,fa)};la._createColorBuffer=function(Y){return Y.vertexAttributes.color};la._createSymbolColorBuffer=function(Y){if(this._requiresSymbolVertexColors()){Y=this._getVertexOpacityAndColor(Y);const ea=F.parseColorMixMode(l.get(this.symbolLayer,"material","colorMixMode")),
ba=new Uint8Array(4);F.encodeSymbolColor(Y,ea,ba);return ba}return null};la._createBuffers=function(Y,ea){var ba=Y.vertexAttributes&&Y.vertexAttributes.position;if(!ba)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;var Z=Y.vertexAttributes.normal;const fa=Y.vertexAttributes.uv;var ja=Y.vertexAttributes.tangent;if(l.isSome(Z)&&Z.length!==ba.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),
null;if(l.isSome(ja)&&ja.length/4!==ba.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(l.isSome(fa)&&fa.length/2!==ba.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;ja=this._computeReprojectionInfo(Y);ba=this._createPositionBuffer(Y,ja);Z=this._createColorBuffer(Y);ea=this._createSymbolColorBuffer(ea);const oa=this._createNormalBuffer(Y,
ba,ja),sa=this._createTangentBuffer(Y,ba,ja);Y=ja.reprojection===ha.NONE&&l.isSome(ja.objectTransformation)?ja.objectTransformation:this._transformOriginLocal(Y,ba,oa,sa);ja=ja.reprojection===ha.NONE&&l.isSome(ja.geometryTransformation)?ja.geometryTransformation:k.create();return{positionBuffer:ba,normalBuffer:oa,tangentBuffer:sa,uvBuffer:fa,colorBuffer:Z,symbolColorBuffer:ea,objectTransformation:Y,geometryTransformation:ja}};la._computeReprojectionInfo=function(Y){var ea=l.isSome(Y.transform);const ba=
ea&&Y.transform.geographic?ha.NONE:this._context.renderCoordsHelper.viewingMode===C.ViewingMode.Local?ha.NONE:ha.ECEF;if(ea){if(ba===ha.NONE)return ea=k.create(),h.computeTranslationToOriginAndRotation(Y.spatialReference,Y.transform.origin,ea,this._context.renderCoordsHelper.spatialReference),Y=k.clone(Y.transform.localMatrix),{reprojection:ba,objectTransformation:ea,geometryTransformation:Y,needsBufferCopy:!1};ea=g.fromTranslation(k.create(),Y.transform.origin);g.multiply(ea,ea,Y.transform.localMatrix);
return{reprojection:ba,transformBeforeProject:ea,needsBufferCopy:!0}}return{reprojection:ba,needsBufferCopy:!0}};la._transformOriginLocal=function(Y,ea,ba,Z){const fa=this._context.renderCoordsHelper.spatialReference;var ja=Y.anchor;S[0]=ja.x;S[1]=ja.y;S[2]=ja.z;ja=k.create();h.computeTranslationToOriginAndRotation(Y.spatialReference,S,ja,fa);Y=x.BufferViewVec3f64.fromTypedArray(ea);g.invert(R,ja);B.transformMat4(Y,Y,R);if(l.isSome(ba)||l.isSome(Z))r.fromMat4(V,ja),r.transpose(V,V),l.isSome(ba)&&
(ba=x.BufferViewVec3f.fromTypedArray(ba),B.transformMat3(ba,ba,V)),l.isSome(Z)&&(Z=x.BufferViewVec3f.fromTypedArray(Z,4*Z.BYTES_PER_ELEMENT),B.transformMat3(Z,Z,V));return ja};la._validateFaces=function(Y,ea){Y=Y.vertexAttributes.position.length/3;if(ea=ea.faces){let ba=-1;for(let Z=0;Z<ea.length;Z++){const fa=ea[Z];fa>ba&&(ba=fa)}if(Y<=ba)return this.logger.warn(`Vertex index ${ba} is out of bounds of the mesh position buffer`),!1}else if(0!==Y%3)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),
!1;return!0};la._getOrCreateFaces=function(Y,ea){return ea.faces?ea.faces:N.generateDefaultIndexArray(Y.vertexAttributes.position.length/3)};la._isOutsideClippingArea=function(Y){if(!this._context.clippingExtent)return!1;var ea=Y.vertexAttributes&&Y.vertexAttributes.position;if(!ea)return!1;const ba=this._context.elevationProvider.spatialReference,Z=ea.length/3;Y.spatialReference.equals(ba)||(ea=new Float64Array(ea.length),h.projectBuffer(Y.vertexAttributes.position,Y.spatialReference,0,ea,ba,0,Z));
v.empty(da);v.expandWithBuffer(da,ea,0,Z);return!v.intersectsClippingArea(da,this._context.clippingExtent)};la._createGeometryInfo=function(Y,ea){if(!h.canProjectWithoutEngine(Y.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(Y))return null;ea=this._createBuffers(Y,ea);if(l.isNone(ea))return null;const {positionBuffer:ba,uvBuffer:Z,colorBuffer:fa,symbolColorBuffer:ja,
normalBuffer:oa,tangentBuffer:sa,objectTransformation:qa,geometryTransformation:Ha}=ea;var Ga=this._getOrCreateComponents(Y);ea=[];const pa=[],Da=[];let ra=!1;for(const Ia of Ga){if(!this._validateFaces(Y,Ia))return null;Ga=this._getOrCreateFaces(Y,Ia);if(0===Ga.length)continue;var Ea=this._createComponentNormals(ba,oa,Ia,Ga);Ea.didFlipNormals&&(ra=!0);const Ma=[[J.VertexAttribute.POSITION,{size:3,data:ba,exclusive:!0}],[J.VertexAttribute.NORMAL,{size:3,data:Ea.normals,exclusive:!0}]];Ea=[[J.VertexAttribute.POSITION,
Ga],[J.VertexAttribute.NORMAL,Ea.indices]];l.isSome(fa)&&(Ma.push([J.VertexAttribute.COLOR,{size:4,data:fa,exclusive:!0}]),Ea.push([J.VertexAttribute.COLOR,Ga]));l.isSome(ja)&&(Ma.push([J.VertexAttribute.SYMBOLCOLOR,{size:4,data:ja,exclusive:!0}]),Ea.push([J.VertexAttribute.SYMBOLCOLOR,new Uint16Array(Ga.length)]));l.isSome(Z)&&(Ma.push([J.VertexAttribute.UV0,{size:2,data:Z,exclusive:!0}]),Ea.push([J.VertexAttribute.UV0,Ga]));l.isSome(sa)&&(Ma.push([J.VertexAttribute.TANGENT,{size:4,data:sa,exclusive:!0}]),
Ea.push([J.VertexAttribute.TANGENT,Ga]));Ga=new K.Geometry(Ma,Ea);ea.push(Ga);pa.push(Ha);Da.push(this._getOrCreateMaterial(Y,Ia))}ra&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");return{geometries:ea,transformations:pa,materials:Da,objectTransformation:qa}};la._createEdgeMaterial=function(){const Y={opacity:this._getLayerOpacity()};return E.createMaterial(this.symbolLayer,
Y)};return ka}(D.Graphics3DSymbolLayer);const S=d.create(),T=d.create(),U=d.create(),aa=d.create(),W=d.create(),R=k.create(),V=n.create(),da=v.create(),ca=[new w];var ha;(function(ia){ia[ia.NONE=0]="NONE";ia[ia.ECEF=1]="ECEF"})(ha||(ha={}));a.Graphics3DMeshFillSymbolLayer=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/MeshComponent":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/ensureType ./MeshMaterial ./MeshMaterialMetallicRoughness ./MeshVertexAttributes".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e){var h;const v=l.getLogger("esri.geometry.support.MeshComponent");c=h=function(w){function t(B){B=w.call(this,B)||this;B.faces=null;B.material=null;B.shading="source";B.trustSourceNormals=!1;return B}a._inheritsLoose(t,w);t.from=function(B){return k.ensureClass(h,B)};var x=t.prototype;x.castFaces=function(B){return e.castArray(B,Uint32Array,[Uint16Array],{loggerTag:".faces\x3d",stride:3},v)};x.castMaterial=function(B){return B&&"object"===typeof B&&("metallic"in B||
"roughness"in B||"metallicRoughnessTexture"in B)?k.ensureClass(d,B):k.ensureClass(f,B)};x.clone=function(){return new h({faces:m.clone(this.faces),shading:this.shading,material:m.clone(this.material),trustSourceNormals:this.trustSourceNormals})};x.cloneWithDeduplication=function(B,q){B={faces:m.clone(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(B,q):null,trustSourceNormals:this.trustSourceNormals};return new h(B)};return t}(c.JSONSupport);b.__decorate([r.property({json:{write:!0}})],
c.prototype,"faces",void 0);b.__decorate([n.cast("faces")],c.prototype,"castFaces",null);b.__decorate([r.property({type:f,json:{write:!0}})],c.prototype,"material",void 0);b.__decorate([n.cast("material")],c.prototype,"castMaterial",null);b.__decorate([r.property({type:String,json:{write:!0}})],c.prototype,"shading",void 0);b.__decorate([r.property({type:Boolean})],c.prototype,"trustSourceNormals",void 0);return c=h=b.__decorate([g.subclass("esri.geometry.support.MeshComponent")],c)})},"esri/geometry/support/MeshMaterial":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/JSONSupport ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./MeshTexture".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){var e;m=e=function(h){function v(t){t=h.call(this,t)||this;t.color=null;t.colorTexture=null;t.normalTexture=null;t.alphaMode="auto";t.alphaCutoff=.5;t.doubleSided=!0;return t}a._inheritsLoose(v,h);var w=v.prototype;w.clone=function(){return this.cloneWithDeduplication(null,new Map)};w.cloneWithDeduplication=function(t,x){const B=l.isSome(t)?t.get(this):null;if(B)return B;x=new e(this.clonePropertiesWithDeduplication(x));l.isSome(t)&&t.set(this,x);return x};w.clonePropertiesWithDeduplication=
function(t){return{color:l.isSome(this.color)?this.color.clone():null,colorTexture:l.isSome(this.colorTexture)?this.colorTexture.cloneWithDeduplication(t):null,normalTexture:l.isSome(this.normalTexture)?this.normalTexture.cloneWithDeduplication(t):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}};return v}(m.JSONSupport);b.__decorate([r.property({type:c,json:{write:!0}})],m.prototype,"color",void 0);b.__decorate([r.property({type:d,json:{write:!0}})],m.prototype,
"colorTexture",void 0);b.__decorate([r.property({type:d,json:{write:!0}})],m.prototype,"normalTexture",void 0);b.__decorate([r.property({nonNullable:!0,json:{write:!0}})],m.prototype,"alphaMode",void 0);b.__decorate([r.property({nonNullable:!0,json:{write:!0}})],m.prototype,"alphaCutoff",void 0);b.__decorate([r.property({nonNullable:!0,json:{write:!0}})],m.prototype,"doubleSided",void 0);return m=e=b.__decorate([f.subclass("esri.geometry.support.MeshMaterial")],m)})},"esri/geometry/support/MeshTexture":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../chunks/persistableUrlUtils ../../views/support/screenshotUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e){var h;const v=new WeakMap;let w=0;c=h=function(t){function x(q){q=t.call(this,q)||this;q.wrap="repeat";return q}a._inheritsLoose(x,t);var B=x.prototype;B.writeData=function(q,u,C,z){q instanceof HTMLImageElement?(q={type:"image-element",src:d.toJSON(q.src,z),crossOrigin:q.crossOrigin},u[C]=q):q instanceof HTMLCanvasElement?(q=q.getContext("2d").getImageData(0,0,q.width,q.height),q={type:"canvas-element",imageData:this._encodeImageData(q)},u[C]=q):q instanceof HTMLVideoElement?
(q={type:"video-element",src:d.toJSON(q.src,z),autoplay:q.autoplay,loop:q.loop,muted:q.muted,crossOrigin:q.crossOrigin,preload:q.preload},u[C]=q):(q={type:"image-data",imageData:this._encodeImageData(q)},u[C]=q)};B.readData=function(q){switch(q.type){case "image-element":var u=new Image;u.src=q.src;u.crossOrigin=q.crossOrigin;return u;case "canvas-element":return q=this._decodeImageData(q.imageData),u=document.createElement("canvas"),u.width=q.width,u.height=q.height,u.getContext("2d").putImageData(q,
0,0),u;case "image-data":return this._decodeImageData(q.imageData);case "video-element":return u=document.createElement("video"),u.src=q.src,u.crossOrigin=q.crossOrigin,u.autoplay=q.autoplay,u.loop=q.loop,u.muted=q.muted,u.preload=q.preload,u}};B.clone=function(){const q={url:this.url,data:this.data,wrap:this._cloneWrap()};return new h(q)};B.cloneWithDeduplication=function(q){var u=q.get(this);if(u)return u;u=this.clone();q.set(this,u);return u};B._cloneWrap=function(){return"string"===typeof this.wrap?
this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}};B._encodeImageData=function(q){let u="";for(let C=0;C<q.data.length;C++)u+=String.fromCharCode(q.data[C]);return{data:btoa(u),width:q.width,height:q.height}};B._decodeImageData=function(q){const u=atob(q.data),C=new Uint8ClampedArray(u.length);for(let z=0;z<u.length;z++)C[z]=u.charCodeAt(z);return e.wrapImageData(C,q.width,q.height)};B._imageDataContainsTransparent=function(q){for(let u=3;u<q.data.length;u+=4)if(255!==q.data[u])return!0;
return!1};x.from=function(q){return"string"===typeof q?new h({url:q}):q instanceof HTMLImageElement||q instanceof HTMLCanvasElement||q instanceof ImageData||q instanceof HTMLVideoElement?new h({data:q}):n.ensureClass(h,q)};a._createClass(x,[{key:"url",get:function(){return this._get("url")||null},set:function(q){this._set("url",q);q&&this._set("data",null)}},{key:"data",get:function(){return this._get("data")||null},set:function(q){this._set("data",q);q&&this._set("url",null)}},{key:"transparent",
get:function(){var q=this.data,u=this.url;return q instanceof HTMLCanvasElement?this._imageDataContainsTransparent(q.getContext("2d").getImageData(0,0,q.width,q.height)):q instanceof ImageData?this._imageDataContainsTransparent(q):u&&(q=u.substr(u.length-4,4).toLowerCase(),u=u.substr(0,15).toLocaleLowerCase(),".png"===q||"data:image/png;"===u)?!0:!1},set:function(q){null!=q?this._override("transparent",q):this._clearOverride("transparent")}},{key:"contentHash",get:function(){const q="string"===typeof this.wrap?
this.wrap:"object"===typeof this.wrap?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",u=(C="")=>`d:${C},t:${this.transparent},w:${q}`;if(null!=this.url)return u(this.url);if(null!=this.data){if(this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement)return u(this.data.src);v.has(this.data)||v.set(this.data,++w);return u(v.get(this.data))}return u()}}]);return x}(m.JSONSupport);b.__decorate([l.property({type:String,json:{write:d.write}})],c.prototype,"url",null);b.__decorate([l.property({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),
l.property()],c.prototype,"data",null);b.__decorate([f.writer("data")],c.prototype,"writeData",null);b.__decorate([g.reader("data")],c.prototype,"readData",null);b.__decorate([l.property({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],c.prototype,"transparent",null);b.__decorate([l.property({json:{write:!0}})],c.prototype,"wrap",void 0);b.__decorate([l.property({readOnly:!0})],c.prototype,"contentHash",null);return c=h=b.__decorate([k.subclass("esri.geometry.support.MeshTexture")],
c)})},"esri/views/support/screenshotUtils":function(){define(["exports","../../core/has","../../core/mathUtils","../../core/maybe"],function(a,b,c,m){function l(q,u){const {format:C,quality:z,rotation:A,disableDecorations:p}=q||{};var y=d(q,u.padding);var D=u.width-y.left-y.right;u=u.height-y.top-y.bottom;y={x:0,y:0,width:D,height:u};if(q&&q.area){null!=q.area.x&&(y.x=Math.floor(q.area.x));null!=q.area.y&&(y.y=Math.floor(q.area.y));var E=null!=q.area.width?Math.floor(q.area.width):null,F=null!=q.area.height?
Math.floor(q.area.height):null;y.width=D-y.x;y.height=u-y.y;null!=E&&null!=F?(y.width=Math.min(y.width,E),y.height=Math.min(y.height,F)):null==E&&null!=F?(E=Math.min(y.width,E),y.height*=E/y.width,y.width=E):null!=E&&null==F&&(E=Math.min(y.height,F),y.width*=E/y.height,y.height=E)}y=f(y,q);E=Math.floor(Math.max(y.x,0));F=Math.floor(Math.max(y.y,0));D={x:E,y:F,width:Math.floor(Math.min(y.width,D-E)),height:Math.floor(Math.min(y.height,u-F))};u=D.width/D.height;y=y.width/y.height;y!==u&&(y>u?(u=Math.floor(D.width/
y),D={x:D.x,y:Math.floor(D.y+(D.height-u)/2),width:D.width,height:u}):(u=Math.floor(D.height*y),D={x:Math.floor(D.x+(D.width-u)/2),y:D.y,width:u,height:D.height}));const {width:G,height:P}=k(q,D);u=e(C);y=x[u];y=c.clamp(null!=z?z:y,0,100);return{format:u,quality:y,area:D,width:G,height:P,rotation:A,disableDecorations:!!p,ignoreBackground:!(!q||!q.ignoreBackground),ignorePadding:!(!q||!q.ignorePadding)}}function r(q,u){m.isNone(h)&&(h=document.createElement("canvas"));var C=h;if(u.premultipliedAlpha){{var z=
q.data;const p=z.length;for(let y=0;y<p;y+=4){var A=z[y+3];255!==A&&0<A&&(A=255/A,z[y+0]*=A,z[y+1]*=A,z[y+2]*=A)}}}C.width=q.width;C.height=q.height;z=C.getContext("2d");z.putImageData(q,0,0);u.flipY&&(z.save(),z.globalCompositeOperation="copy",z.scale(1,-1),z.translate(0,-z.canvas.height),z.drawImage(z.canvas,0,0),z.restore());return{ctx:z,canvas:C}}function n(q,u){return q.toDataURL(t[u.format],u.quality/100)}function g(q,u,C){C||(v||(v=document.createElement("canvas"),v.width=1,v.height=1),C=v);
return C.getContext("2d").createImageData(q,u)}function k(q,u){if(!q)return u;const C=q.width;q=q.height;if(null!=C&&null!=q)return{width:Math.floor(C),height:Math.floor(q)};if(null==C&&null==q)return u;u=u.width/u.height;return null==q?{width:Math.floor(C),height:Math.floor(C/u)}:{width:Math.floor(q*u),height:Math.floor(q)}}function f(q,u){if(!u||null==u.width||null==u.height)return q;u=u.width/u.height;const C=q.width/q.height;if(C===u)return q;if(C<u)return u=Math.floor(q.height*u),q.x-=(u-q.width)/
2,q.width=u,q;u=Math.floor(q.width/u);q.y-=(u-q.height)/2;q.height=u;return q}function d(q,u){return!u||q&&q.ignorePadding?B:u}function e(q){switch(q){case "png":case "jpg":case "jpeg":return q;case null:case void 0:return"png";default:return"png"}}let h=null,v=null,w=!0;const t={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},x={png:100,jpg:98,jpeg:98},B={top:0,right:0,bottom:0,left:0};a.completeUserSettings=l;a.createEmptyImageData=function(q,u,C){if(!q||!u)throw Error("Cannot construct image data without dimensions");
if(w)try{return new ImageData(q,u)}catch(z){w=!1}return g(q,u,C)};a.encode=function(q,u,C){const {ctx:z,canvas:A}=r(q,C);q=z.getImageData(0,0,q.width,q.height);u=n(A,u);A.width=0;A.height=0;return{dataUrl:u,data:q}};a.encodeData=function(q,u){const {ctx:C,canvas:z}=r(q,u);q=C.getImageData(0,0,q.width,q.height);z.width=0;z.height=0;return q};a.getFormatAndQuality=function(q,u){q=e(q);const C=x[q];u=c.clamp(null!=u?u:C,0,100);return{format:q,quality:u}};a.getMaximumResolutionScale=function(q,u){return u/
Math.max(q[0],q[1])};a.resampleHermite=function(q,u,C,z=0,A=0,p=q.width-z,y=q.height-A,D=!1){const {data:E}=q,{width:F,height:G,data:P}=u;p/=F;y/=G;const K=Math.ceil(p/2),N=Math.ceil(y/2);q=q.width;for(let J=0;J<G;J++)for(let H=0;H<F;H++){const I=4*(H+(D?G-J-1:J)*F);let O=0,Q=0,S=0,T=0,U=0,aa=0;const W=(J+.5)*y;for(let R=Math.floor(J*y);R<(J+1)*y;R++){var M=Math.abs(W-(R+.5))/N;const V=(H+.5)*p;M*=M;for(let da=Math.floor(H*p);da<(H+1)*p;da++){var L=Math.abs(V-(da+.5))/K;L=Math.sqrt(M+L*L);if(1<=L)continue;
L=2*L*L*L-3*L*L+1;const ca=4*(z+da+(A+R)*q);aa+=L*E[ca+3];Q+=L;!C&&255>E[ca+3]&&(L=L*E[ca+3]/255);S+=L*E[ca];T+=L*E[ca+1];U+=L*E[ca+2];O+=L}}P[I]=S/O;P[I+1]=T/O;P[I+2]=U/O;P[I+3]=aa/Q}return u};a.screenshotSuperSampleSettings=function(q,u,C){if(!u)return q;const {framebufferWidth:z,framebufferHeight:A,pixelRatio:p,region:y}=q;u=d(q,C);C=u.left+u.right;const D=u.top+u.bottom,E=z-C,F=A-D,G=Math.min(8,Math.min((2048-C)/E,(2048-D)/F));return 1.5>G?q:{...q,framebufferWidth:Math.round(E*G)+C,framebufferHeight:Math.round(F*
G)+D,pixelRatio:p*G,resample:{region:{x:Math.round((y.x-u.left)*G)+u.left,y:Math.round((y.y-u.top)*G)+u.top,width:Math.round(y.width*G),height:Math.round(y.height*G)},width:z,height:A}}};a.toDataUrl=n;a.toRenderSettings=function(q,u){const C=l(q,u),z=C.area,A=C.width/z.width,p=d(C,u.padding),y=p.left+p.right,D=p.top+p.bottom;return{framebufferWidth:Math.floor((u.width-y)*A+y),framebufferHeight:Math.floor((u.height-D)*A+D),region:{x:Math.floor(z.x*A)+p.left,y:Math.floor(z.y*A)+p.top,width:C.width,
height:C.height},format:C.format,quality:C.quality,rotation:C.rotation,pixelRatio:A,layers:q&&q.layers?q.layers:[],disableDecorations:C.disableDecorations,ignoreBackground:C.ignoreBackground,ignorePadding:C.ignorePadding}};a.wrapImageData=function(q,u,C,z){if(!u||!C)throw Error("Cannot construct image data without dimensions");if(w)try{return new ImageData(q,u,C)}catch(A){w=!1}u=g(u,C,z);u.data.set(q,0);return u};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/geometry/support/MeshMaterialMetallicRoughness":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./MeshMaterial ./MeshTexture".split(" "),function(a,b,c,m,l,r,n,g,k,f,d){var e;r=e=function(h){function v(t){t=h.call(this,t)||this;t.emissiveColor=null;t.emissiveTexture=
null;t.occlusionTexture=null;t.metallic=1;t.roughness=1;t.metallicRoughnessTexture=null;return t}a._inheritsLoose(v,h);var w=v.prototype;w.clone=function(){return this.cloneWithDeduplication(null,new Map)};w.cloneWithDeduplication=function(t,x){const B=m.isSome(t)?t.get(this):null;if(B)return B;x=new e(this.clonePropertiesWithDeduplication(x));m.isSome(t)&&t.set(this,x);return x};w.clonePropertiesWithDeduplication=function(t){return{...h.prototype.clonePropertiesWithDeduplication.call(this,t),emissiveColor:m.isSome(this.emissiveColor)?
this.emissiveColor.clone():null,emissiveTexture:m.isSome(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(t):null,occlusionTexture:m.isSome(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(t):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:m.isSome(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(t):null}};return v}(f);b.__decorate([l.property({type:c,json:{write:!0}})],r.prototype,"emissiveColor",
void 0);b.__decorate([l.property({type:d,json:{write:!0}})],r.prototype,"emissiveTexture",void 0);b.__decorate([l.property({type:d,json:{write:!0}})],r.prototype,"occlusionTexture",void 0);b.__decorate([l.property({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],r.prototype,"metallic",void 0);b.__decorate([l.property({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],r.prototype,"roughness",void 0);b.__decorate([l.property({type:d,json:{write:!0}})],r.prototype,"metallicRoughnessTexture",
void 0);return r=e=b.__decorate([k.subclass("esri.geometry.support.MeshMaterialMetallicRoughness")],r)})},"esri/geometry/support/MeshVertexAttributes":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,m,l,r,n,g,k){function f(w,t,x,B){const {loggerTag:q,
stride:u}=t;return 0!==w.length%u?(B.error(q,`Invalid array length, expected a multiple of ${u}`),new x([])):w}function d(w,t,x,B,q){if(!w)return w;if(w instanceof t)return f(w,B,t,q);for(const u of x)if(w instanceof u)return f(new t(w),B,t,q);if(Array.isArray(w))return f(new t(w),B,t,q);x=x.map(u=>`'${u.name}'`);q.error(`Failed to set property, expected one of ${x}, but got ${w.constructor.name}`);return new t([])}function e(w,t,x){{const B=Array(w.length);for(let q=0;q<w.length;q++)B[q]=w[q];w=
B}t[x]=w}var h;const v=r.getLogger("esri.geometry.support.MeshVertexAttributes");a.MeshVertexAttributes=h=function(w){function t(B){B=w.call(this,B)||this;B.color=null;B.position=new Float64Array(0);B.uv=null;B.normal=null;B.tangent=null;return B}b._inheritsLoose(t,w);var x=t.prototype;x.castColor=function(B){return d(B,Uint8Array,[Uint8ClampedArray],{loggerTag:".color\x3d",stride:4},v)};x.castPosition=function(B){B&&B instanceof Float32Array&&v.warn(".position\x3d","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array");
return d(B,Float64Array,[Float32Array],{loggerTag:".position\x3d",stride:3},v)};x.castUv=function(B){return d(B,Float32Array,[Float64Array],{loggerTag:".uv\x3d",stride:2},v)};x.castNormal=function(B){return d(B,Float32Array,[Float64Array],{loggerTag:".normal\x3d",stride:3},v)};x.castTangent=function(B){return d(B,Float32Array,[Float64Array],{loggerTag:".tangent\x3d",stride:4},v)};x.clone=function(){const B={position:l.clone(this.position),uv:l.clone(this.uv),normal:l.clone(this.normal),tangent:l.clone(this.tangent),
color:l.clone(this.color)};return new h(B)};x.clonePositional=function(){const B={position:l.clone(this.position),normal:l.clone(this.normal),tangent:l.clone(this.tangent),uv:this.uv,color:this.color};return new h(B)};return t}(m.JSONSupport);c.__decorate([n.property({json:{write:e}})],a.MeshVertexAttributes.prototype,"color",void 0);c.__decorate([g.cast("color")],a.MeshVertexAttributes.prototype,"castColor",null);c.__decorate([n.property({nonNullable:!0,json:{write:e}})],a.MeshVertexAttributes.prototype,
"position",void 0);c.__decorate([g.cast("position")],a.MeshVertexAttributes.prototype,"castPosition",null);c.__decorate([n.property({json:{write:e}})],a.MeshVertexAttributes.prototype,"uv",void 0);c.__decorate([g.cast("uv")],a.MeshVertexAttributes.prototype,"castUv",null);c.__decorate([n.property({json:{write:e}})],a.MeshVertexAttributes.prototype,"normal",void 0);c.__decorate([g.cast("normal")],a.MeshVertexAttributes.prototype,"castNormal",null);c.__decorate([n.property({json:{write:e}})],a.MeshVertexAttributes.prototype,
"tangent",void 0);c.__decorate([g.cast("tangent")],a.MeshVertexAttributes.prototype,"castTangent",null);a.MeshVertexAttributes=h=c.__decorate([k.subclass("esri.geometry.support.MeshVertexAttributes")],a.MeshVertexAttributes);a.castArray=d;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/meshUtils/projection":function(){define("exports ../../../core/Logger ../../../core/maybe ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../projection ../../projectionEllipsoid ../spatialReferenceUtils ../webMercatorUtils ../buffer/BufferView ../../../chunks/vec32".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){function w(p,y,D,E,F,G){if(y){var P=D.count,K=f.getSphericalPCPF(F);if(x(F))for(D=0;D<P;D++)E.getVec(D,u),y.getVec(D,C),k.computeTranslationToOriginAndRotation(K,u,z,K),m.fromMat4(A,z),p===q.FROM_PCPF&&m.transpose(A,A),n.transformMat3(C,C,A),G.setVec(D,C);else for(F=0;F<P;F++){E.getVec(F,u);y.getVec(F,C);k.computeTranslationToOriginAndRotation(K,u,z,K);m.fromMat4(A,z);var N=e.y2lat(D.get(F,1));N=Math.cos(N);p===q.TO_PCPF&&(N=1/N);A[0]*=N;A[1]*=N;A[2]*=N;A[3]*=
N;A[4]*=N;A[5]*=N;p===q.FROM_PCPF&&m.transpose(A,A);n.transformMat3(C,C,A);n.normalize(C,C);G.setVec(F,C)}return G}}function t(p){return x(p)||p.isWebMercator}function x(p){return p.isWGS84||d.isCGCS2000(p)||d.isMars(p)||d.isMoon(p)}const B=b.getLogger("esri.geometry.support.meshUtils.normalProjection");var q;(function(p){p[p.TO_PCPF=0]="TO_PCPF";p[p.FROM_PCPF=1]="FROM_PCPF"})(q||(q={}));const u=g.create(),C=g.create(),z=r.create(),A=l.create();a.projectFromPCPF=function(p,y,D){k.projectBuffer(p,
f.getSphericalPCPF(D),0,y,D,0,p.length/3);return y};a.projectNormalFromPCPF=function(p,y,D,E,F){if(!t(E))return B.error("Cannot convert to spatial reference from PCPF"),F;w(q.FROM_PCPF,h.BufferViewVec3f.fromTypedArray(p),h.BufferViewVec3f64.fromTypedArray(y),h.BufferViewVec3f64.fromTypedArray(D),E,h.BufferViewVec3f.fromTypedArray(F));return F};a.projectNormalToPCPF=function(p,y,D,E,F){if(!t(E))return B.error("Cannot convert spatial reference to PCPF"),F;w(q.TO_PCPF,h.BufferViewVec3f.fromTypedArray(p),
h.BufferViewVec3f64.fromTypedArray(y),h.BufferViewVec3f64.fromTypedArray(D),E,h.BufferViewVec3f.fromTypedArray(F));return F};a.projectTangentFromPCPF=function(p,y,D,E,F){if(!t(E))return B.error("Cannot convert to spatial reference from PCPF"),F;w(q.FROM_PCPF,h.BufferViewVec3f.fromTypedArray(p,16),h.BufferViewVec3f64.fromTypedArray(y),h.BufferViewVec3f64.fromTypedArray(D),E,h.BufferViewVec3f.fromTypedArray(F,16));for(y=3;y<p.length;y+=4)F[y]=p[y];return F};a.projectTangentToPCPF=function(p,y,D,E,F){if(!t(E))return B.error("Cannot convert spatial reference to PCPF"),
F;w(q.TO_PCPF,h.BufferViewVec3f.fromTypedArray(p,4*Float32Array.BYTES_PER_ELEMENT),h.BufferViewVec3f64.fromTypedArray(y),h.BufferViewVec3f64.fromTypedArray(D),E,h.BufferViewVec3f.fromTypedArray(F,4*Float32Array.BYTES_PER_ELEMENT));for(y=3;y<p.length;y+=4)F[y]=p[y];return F};a.projectToPCPF=function(p,y,D){k.projectBuffer(p,y,0,D,f.getSphericalPCPF(y),0,p.length/3);return D};a.transformNormal=function(p,y,D){if(c.isNone(p))return y;m.normalFromMat4(A,D);p=h.BufferViewVec3f.fromTypedArray(p);D=h.BufferViewVec3f.fromTypedArray(y);
v.transformMat3(D,p,A);m.isOrthoNormal(A)||v.normalize(D,D);return y};a.transformPosition=function(p,y,D){if(c.isNone(p))return y;p=h.BufferViewVec3f64.fromTypedArray(p);const E=h.BufferViewVec3f64.fromTypedArray(y);v.transformMat4(E,p,D);return y};a.transformTangent=function(p,y,D){if(c.isNone(p))return y;m.normalFromMat4(A,D);D=h.BufferViewVec3f.fromTypedArray(p,4*Float32Array.BYTES_PER_ELEMENT);const E=h.BufferViewVec3f.fromTypedArray(y,4*Float32Array.BYTES_PER_ELEMENT);v.transformMat3(E,D,A);
m.isOrthoNormal(A)||v.normalize(E,E);if(p!==y)for(D=3;D<p.length;D+=4)y[D]=p[D];return y};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../../../../geometry/support/buffer/BufferView ../core/shaderLibrary/ShaderOutputOptions ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./internal/bufferWriterUtils ./internal/DefaultBufferWriter ./internal/MaterialUtil ./renderers/utils ../shaders/NativeLineTechnique ../shaders/NativeLineTechniqueConfiguration".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D){const E=c.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");var F;(function(ha){ha[ha.START=0]="START";ha[ha.END=1]="END"})(F||(F={}));c=function(ha){function ia(la){la=ha.call(this,la,new K)||this;la._techniqueConfig=new D.NativeLineTechniqueConfiguration;return la}b._inheritsLoose(ia,ha);var ka=ia.prototype;ka.getConfiguration=function(la,Y){this._techniqueConfig.output=la;this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane;
this._techniqueConfig.hasVertexColors=this.parameters.hasVertexColors;this._techniqueConfig.transparent=1>this.parameters.color[3]||1>this.parameters.width;this._techniqueConfig.draped=Y.slot===B.RenderSlot.DRAPED_MATERIAL;la=m.isSome(this.parameters.stipplePattern);this._techniqueConfig.stippleEnabled=la;this._techniqueConfig.stippleOffColorEnabled=la&&m.isSome(this.parameters.stippleOffColor);this._techniqueConfig.hasOccludees=this.parameters.hasOccludees;this._techniqueConfig.stipplePreferContinuous=
this.parameters.stipplePreferContinuous;return this._techniqueConfig};ka.intersect=function(la,Y,ea,ba,Z,fa,ja,oa,sa){m.isSome(sa)?A.intersectDrapedRenderLineGeometry(la,ba,sa,fa,1,ja):this._intersectLineGeometry(la,Y,ea,ba,ja)};ka._intersectLineGeometry=function(la,Y,ea,ba,Z){if(ba.options.selectionMode&&!p.isInstanceHidden(Y))if(q.isTranslationMatrix(ea)){var fa=la.vertexAttributes.get(u.VertexAttribute.POSITION).data,ja=ba.camera,oa=U;r.copy(oa,ba.point);n.set(aa[0],oa[0]-2,oa[1]+2,0);n.set(aa[1],
oa[0]+2,oa[1]+2,0);n.set(aa[2],oa[0]+2,oa[1]-2,0);n.set(aa[3],oa[0]-2,oa[1]-2,0);for(la=0;4>la;la++)if(!ja.unprojectFromRenderScreen(aa[la],W[la]))return;e.fromPoints(ja.eye,W[0],W[1],R);e.fromPoints(ja.eye,W[1],W[2],V);e.fromPoints(ja.eye,W[2],W[3],da);e.fromPoints(ja.eye,W[3],W[0],ca);Y=Number.MAX_VALUE;la=0;for(let qa=0;qa<fa.length-5;qa+=3)if(N[0]=fa[qa]+ea[12],N[1]=fa[qa+1]+ea[13],N[2]=fa[qa+2]+ea[14],M[0]=fa[qa+3]+ea[12],M[1]=fa[qa+4]+ea[13],M[2]=fa[qa+5]+ea[14],!(0>e.signedDistance(R,N)&&0>
e.signedDistance(R,M)||0>e.signedDistance(V,N)&&0>e.signedDistance(V,M)||0>e.signedDistance(da,N)&&0>e.signedDistance(da,M)||0>e.signedDistance(ca,N)&&0>e.signedDistance(ca,M))){ja.projectToRenderScreen(N,H);ja.projectToRenderScreen(M,I);if(0>H[2]&&0<I[2]){n.subtract(L,N,M);var sa=ja.frustum;sa=-e.signedDistance(sa[f.PlaneIndex.NEAR],N)/n.dot(L,e.normal(sa[f.PlaneIndex.NEAR]));n.scale(L,L,sa);n.add(N,N,L);ja.projectToRenderScreen(N,H)}else if(0<H[2]&&0>I[2])n.subtract(L,M,N),sa=ja.frustum,sa=-e.signedDistance(sa[f.PlaneIndex.NEAR],
M)/n.dot(L,e.normal(sa[f.PlaneIndex.NEAR])),n.scale(L,L,sa),n.add(M,M,L),ja.projectToRenderScreen(M,I);else if(0>H[2]&&0>I[2])continue;H[2]=0;I[2]=0;sa=d.distance2(d.fromPoints(H,I,S),oa);sa<Y&&(Y=sa,n.copy(O,N),n.copy(Q,M),la=qa/3)}ea=ba.rayBegin;ba=ba.rayEnd;4>Y&&(Y=Number.MAX_VALUE,d.closestLineSegmentPoint(d.fromPoints(O,Q,S),d.fromPoints(ea,ba,T),J)&&(n.subtract(J,J,ea),Y=n.length(J),n.scale(J,J,1/Y),Y/=n.distance(ea,ba)),Z(Y,J,la,!1))}else E.error("intersection assumes a translation-only matrix")};
ka.computeAttachmentOrigin=function(la,Y){la=la.vertexAttributes;if(!la)return!1;la=la.get(u.VertexAttribute.POSITION);return w.computeAttachmentOriginLines(la,null,!1,Y)};ka.requiresSlot=function(la){return la===B.RenderSlot.OPAQUE_MATERIAL||la===B.RenderSlot.DRAPED_MATERIAL};ka.createGLMaterial=function(la){return la.output===v.ShaderOutput.Color||la.output===v.ShaderOutput.Highlight?new G(la):null};ka.createBufferWriter=function(){const la=this.parameters.hasVertexColors?z.PositionColorLayout:
z.PositionLayout;return m.isNone(this.parameters.stipplePattern)?new z.DefaultBufferWriter(la):new P(la.clone().vec3f(u.VertexAttribute.AUXPOS1).vec2f(u.VertexAttribute.UV0))};return ia}(x.Material);let G=function(ha){function ia(){return ha.apply(this,arguments)||this}b._inheritsLoose(ia,ha);var ka=ia.prototype;ka._updateOccludeeState=function(la){la.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:la.hasOccludees})};ka.beginSlot=function(la){this._output===
v.ShaderOutput.Color&&this._updateOccludeeState(la);return this.ensureTechnique(y.NativeLineTechnique,la)};return ia}(t),P=function(){function ha(ka){this.vertexBufferLayout=ka}var ia=ha.prototype;ia.allocate=function(ka){return this.vertexBufferLayout.createBuffer(ka)};ia.elementCount=function(ka){return ka.indices.get(u.VertexAttribute.POSITION).length};ia.write=function(ka,la,Y,ea){C.writeDefaultAttributes(la,this.vertexBufferLayout,ka.transformation,ka.invTranspTransformation,Y,ea);this._writeAuxpos1(ka,
la,Y,ea);this._writeUV0(ka,la,Y,ea)};ia._writeAuxpos1=function(ka,la,Y,ea){var ba=Y.getField(u.VertexAttribute.AUXPOS1,h.BufferViewVec3f);Y=la.indices.get(u.VertexAttribute.POSITION);la=la.vertexAttributes.get(u.VertexAttribute.POSITION).data;ka=ka.transformation;const Z=ba.typedBufferStride;ba=ba.typedBuffer;ea*=Z;for(let ja=0;ja<Y.length-1;ja+=2)for(const oa of[1,0]){var fa=3*Y[ja+oa];const sa=la[fa],qa=la[fa+1];fa=la[fa+2];const Ha=ka[1]*sa+ka[5]*qa+ka[9]*fa+ka[13],Ga=ka[2]*sa+ka[6]*qa+ka[10]*
fa+ka[14];ba[ea]=ka[0]*sa+ka[4]*qa+ka[8]*fa+ka[12];ba[ea+1]=Ha;ba[ea+2]=Ga;ea+=Z}};ia._writeUV0=function(ka,la,Y,ea){var ba,Z=Y.getField(u.VertexAttribute.UV0,h.BufferViewVec2f),fa=la.indices.get(u.VertexAttribute.POSITION);Y=la.vertexAttributes.get(u.VertexAttribute.POSITION).data;const ja=null==(ba=la.vertexAttributes.get(u.VertexAttribute.DISTANCETOSTART))?void 0:ba.data;ka=ka.transformation;la=Z.typedBufferStride;Z=Z.typedBuffer;ea*=la;let oa=0;Z[ea]=F.START;Z[ea+1]=oa;ea+=la;ba=3*fa[0];ba=n.set(N,
Y[ba],Y[ba+1],Y[ba+2]);ka&&n.transformMat4(ba,ba,ka);const sa=M,qa=fa.length-1;let Ha=1;const Ga=ja?(Da,ra,Ea)=>oa=ja[Ea]:(Da,ra,Ea)=>oa+=n.distance(Da,ra);for(let Da=1;Da<qa;Da+=2){var pa=3*fa[Da];n.set(sa,Y[pa],Y[pa+1],Y[pa+2]);ka&&n.transformMat4(sa,sa,ka);Ga(ba,sa,Ha++);for(pa=0;2>pa;++pa)Z[ea]=1-pa,Z[ea+1]=oa,ea+=la;n.copy(ba,sa)}fa=3*fa[qa];n.set(sa,Y[fa],Y[fa+1],Y[fa+2]);ka&&n.transformMat4(sa,sa,ka);Ga(ba,sa,Ha);Z[ea]=F.END;Z[ea+1]=oa};return ha}(),K=function(ha){function ia(){var ka=ha.apply(this,
arguments)||this;ka.color=k.ONES;ka.hasVertexColors=!1;ka.hasSlicePlane=!1;ka.width=1;ka.stipplePreferContinuous=!0;ka.hasOccludees=!1;return ka}b._inheritsLoose(ia,ha);return ia}(x.MaterialParameters);const N=g.create(),M=g.create(),L=g.create(),J=g.create(),H=l.createRenderScreenPointArray3(),I=l.createRenderScreenPointArray3(),O=g.create(),Q=g.create(),S=d.create(),T=d.create(),U=g.create(),aa=[l.createRenderScreenPointArray3(),l.createRenderScreenPointArray3(),l.createRenderScreenPointArray3(),
l.createRenderScreenPointArray3()],W=[g.create(),g.create(),g.create(),g.create()],R=e.create(),V=e.create(),da=e.create(),ca=e.create();a.NativeLineMaterial=c;a.Parameters=K;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/NativeLineTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../core/shaderLibrary/ShaderOutputOptions ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../../chunks/NativeLine.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h){n=function(v){function w(x,B,q){B=v.call(this,x,B,q)||this;B.stipplePattern=null;B.stippleTextureBind=null;B.stippleTextureRepository=x.stippleTextureRepository;return B}c._inheritsLoose(w,v);var t=w.prototype;t.initializeProgram=function(x){const B=w.shader.get().build(this.configuration);return new k.Program(x.rctx,B,g.Default3D)};t.destroy=function(){v.prototype.destroy.call(this);this.stippleTextureRepository.release(this.stipplePattern);this.stippleTextureBind=
this.stipplePattern=null};t.bindPass=function(x,B){this.program.bindPass(x,B);this.stipplePattern!==x.stipplePattern&&(x=x.stipplePattern,this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,x),this.stipplePattern=x);if(this.stippleEnabled){const {pixelSize:q,sdfNormalizer:u,pixels:C}=m.isSome(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",u);this.program.setUniform1f("stipplePatternTextureSize",
C);this.program.setUniform1f("stipplePatternPixelSize",q);this.program.setUniform1f("stipplePatternPixelSizeInv",1/q)}};t.initializePipeline=function(){const x=this.configuration,B=h.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),q=(u,C=null,z=null)=>h.makePipelineState({blending:C,depthTest:f.depthCompareLess,depthWrite:z,colorWrite:h.defaultColorWriteParams,stencilWrite:x.hasOccludees?f.stencilWriteMaskOn:null,
stencilTest:x.hasOccludees?u?f.stencilToolMaskBaseParams:f.stencilBaseAllZerosParams:null});return x.output===l.ShaderOutput.Color?(this._occludeePipelineState=q(!0,x.transparent||this.stippleEnabled?B:null,h.defaultDepthWriteParams),q(!1,x.transparent||this.stippleEnabled?B:null,h.defaultDepthWriteParams)):q(!1)};t.getPipelineState=function(x,B){return B?this._occludeePipelineState:v.prototype.getPipelineState.call(this,x,B)};c._createClass(w,[{key:"stippleEnabled",get:function(){return this.configuration.stippleEnabled&&
this.configuration.output!==l.ShaderOutput.Highlight}},{key:"primitiveType",get:function(){return e.PrimitiveType.LINES}}]);return w}(n.ShaderTechnique);n.shader=new r.ReloadableShaderModule(d.NativeLine,()=>new Promise((v,w)=>a(["./NativeLine.glsl"],v,w)));b.NativeLineTechnique=n;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/NativeLine.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){function w(x){const B=new h.ShaderBuilder;B.include(m.Transform);B.include(l.VertexColor,x);B.include(n.LineStipple,x);k.addProjViewLocalOrigin(B,x);const {vertex:q,fragment:u}=B;x.stippleEnabled&&(B.attributes.add(v.VertexAttribute.UV0,"vec2"),B.attributes.add(v.VertexAttribute.AUXPOS1,"vec3"),q.uniforms.add(new f.Float4PassUniform("viewport",(C,z)=>z.camera.fullViewport)));B.attributes.add(v.VertexAttribute.POSITION,"vec3");B.varyings.add("vpos","vec3");q.code.add(e.glsl`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`);x.stippleEnabled&&(q.code.add(e.glsl`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),x.draped?q.uniforms.add(new d.FloatPassUniform("worldToScreenRatio",(C,z)=>1/z.screenToPCSRatio)):q.code.add(e.glsl`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),q.code.add(e.glsl`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),x.draped?q.code.add(e.glsl`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):q.code.add(e.glsl`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),q.code.add(e.glsl`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`));q.code.add(e.glsl`}`);x.output===b.ShaderOutput.Highlight&&B.include(r.OutputHighlight);B.include(c.SliceDraw,x);u.uniforms.add(new d.FloatPassUniform("alphaCoverage",(C,z)=>Math.min(1,C.width*z.camera.pixelRatio)));x.hasVertexColors||u.uniforms.add(new f.Float4PassUniform("constantColor",C=>C.color));u.code.add(e.glsl`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${x.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${e.glsl.float(g.symbolAlphaCutoff)}) {
      discard;
    }

    ${x.output===b.ShaderOutput.Color?e.glsl`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${x.output===b.ShaderOutput.Highlight?e.glsl`outputHighlight();`:""}
  }
  `);return B}const t=Object.freeze(Object.defineProperty({__proto__:null,build:w},Symbol.toStringTag,{value:"Module"}));a.NativeLine=t;a.build=w})},"esri/views/3d/webgl-engine/shaders/NativeLineTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),function(a,b,c,m,l,r){r=function(n){function g(){var k=
n.apply(this,arguments)||this;k.output=m.ShaderOutput.Color;k.hasSlicePlane=!1;k.hasVertexColors=!1;k.transparent=!1;k.draped=!1;k.stippleEnabled=!1;k.stippleOffColorEnabled=!1;k.stipplePreferContinuous=!0;k.hasOccludees=!1;return k}b._inheritsLoose(g,n);return g}(r.DefaultTechniqueConfiguration);c.__decorate([l.parameter({count:m.ShaderOutput.COUNT})],r.prototype,"output",void 0);c.__decorate([l.parameter()],r.prototype,"hasSlicePlane",void 0);c.__decorate([l.parameter()],r.prototype,"hasVertexColors",
void 0);c.__decorate([l.parameter()],r.prototype,"transparent",void 0);c.__decorate([l.parameter()],r.prototype,"draped",void 0);c.__decorate([l.parameter()],r.prototype,"stippleEnabled",void 0);c.__decorate([l.parameter()],r.prototype,"stippleOffColorEnabled",void 0);c.__decorate([l.parameter()],r.prototype,"stipplePreferContinuous",void 0);c.__decorate([l.parameter()],r.prototype,"hasOccludees",void 0);c.__decorate([l.parameter({constValue:!1})],r.prototype,"stippleRequiresClamp",void 0);c.__decorate([l.parameter({constValue:!1})],
r.prototype,"stippleScaleWithLineWidth",void 0);c.__decorate([l.parameter({constValue:!1})],r.prototype,"stippleRequiresStretchMeasure",void 0);a.NativeLineTechniqueConfiguration=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../symbols/support/ObjectSymbol3DLayerResource ../../../../symbols/support/symbolLayerUtils3D ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DLodInstanceGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./Loadable ./lodResourceUtils ./objectResourceUtils ./pointUtils ./primitiveObjectSymbolUtils ./symbolComplexity ../support/FastSymbolUpdates ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/lib/lodRendering/LodRenderer ../../webgl-engine/lib/lodRendering/LodResources ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N,M){q=function(Q){function S(U,aa,W,R){U=Q.call(this,U,aa,W,R)||this;U._resources=null;U._optionalFields=[];U._instanceIndexToGraphicUid=new Map;U.hasLoadedPBRTextures=!1;U._disposeResourceHandles=[];U.ensureDrapedStatus(!1);U.hasLoadedPBRTextures=W.physicalBasedRenderingEnabled;return U}b._inheritsLoose(S,Q);var T=S.prototype;T.getCachedSize=function(){const [U,aa,W]=m.isSome(this._resources)?this._resources.symbolSize:[1,1,
1];return{width:U,depth:aa,height:W}};T.doLoad=function(){var U=b._asyncToGenerator(function*(aa){if(!this._drivenProperties.size&&u.validateSymbolLayerSize(this.symbolLayer))throw Error();const W=this.symbolLayer;this._resources=this.isPrimitive?yield this._createResourcesForPrimitive(W.resource?W.resource.primitive:h.defaultPrimitive,aa):yield this._createResourcesForUrl(W.resource.href,aa);this.layerOpacityChanged();this.slicePlaneEnabledChanged();this.physicalBasedRenderingChanged();this.complexity=
this.computeComplexity()});return function(aa){return U.apply(this,arguments)}}();T._setMaterialTransparencyParams=function(U,aa=m.get(this.symbolLayer,"material","color")){aa=this._getCombinedOpacity(aa);const W=1>aa||this.needsDrivenTransparentPass;U.transparent=W;U.opacity=aa;U.cullFace=W?G.CullFaceOptions.None:G.CullFaceOptions.Back;return U};T._createResourcesForPrimitive=function(){var U=b._asyncToGenerator(function*(aa,W){if(!D.isValidPrimitive(aa))throw Error(`Unknown object symbol primitive: ${aa}`);
var R=this.symbolLayer;const V=e.create(v.objectSymbolLayerPrimitiveBoundingBox(aa)),da=k.fromArray(e.size(V)),ca=k.fromArray(v.objectSymbolLayerSizeWithResourceSize(da,R)),ha=g.length(ca);var ia={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:k.ONES,diffuse:k.ONES,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive};const ka=ia.usePBR;this._setMaterialTransparencyParams(ia);
const la=this.symbol;if("point-3d"===la.type&&la.verticalOffset){const {screenLength:Y,minWorldLength:ea,maxWorldLength:ba}=la.verticalOffset;ia.verticalOffset={screenLength:l.pt2px(Y),minWorldLength:ea||0,maxWorldLength:null!=ba?ba:Infinity};ia.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(ia.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);this._drivenProperties.color?ia.externalColor=f.ONES:(R=m.isSome(R.material)&&R.material.color,R=m.isSome(R)?
c.toUnitRGBA(R):f.ONES,ia.externalColor=R);this._fastUpdates=F.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(V,ca,da,m.none));ia.instanced=["transformation"];this._fastUpdates.enabled?(Object.assign(ia,this._fastUpdates.materialParameters),ia.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(ia.instanced.push("color"),this._optionalFields.push("color"));ia=new M.DefaultMaterial(ia);ia=D.primitiveLodResources(aa,
ia);if(!ia)throw Error(`Unknown object symbol primitive: ${aa}`);aa=N.materialsFromLodResources(ia).map(Y=>({opacity:1,transparent:Y.parameters.transparent}));R=yield this._createStageResources(ia,ka);W=yield this._createLodRenderer(ia,W);return{lodResources:ia,lodRenderer:W,stageResources:R,symbolSize:ca,extentPadding:ha,isEsriSymbolResource:!1,isWosr:!1,originalMaterialParameters:aa,physicalBasedRenderingEnabled:ka,resourceBoundingBox:V,resourceSize:da,pivotOffset:m.none}});return function(aa,W){return U.apply(this,
arguments)}}();T._createResourcesForUrl=function(){var U=b._asyncToGenerator(function*(aa,W){var R=["transformation"],V={materialParamsMixin:{instanced:R,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=F.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(m.none,m.none,m.none,m.none));this._fastUpdates.enabled?
(Object.assign(V.materialParamsMixin,this._fastUpdates.materialParameters),R.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(R.push("color"),this._optionalFields.push("color"));R=this.symbol;if("point-3d"===R.type&&R.verticalOffset){const {screenLength:sa,minWorldLength:qa,maxWorldLength:Ha}=R.verticalOffset;V.materialParamsMixin.verticalOffset={screenLength:l.pt2px(sa),minWorldLength:qa||0,maxWorldLength:null!=Ha?Ha:Infinity};V.materialParamsMixin.castShadows=
!1}V.signal=W;V.usePBR=this._context.physicalBasedRenderingEnabled;R=V.usePBR;const da=yield p.fetch(aa,V);aa=da.isEsriSymbolResource;V=da.isWosr;this._addDisposeResource(()=>da.remove());const ca=A.makeLodResources(da.lods);A.fillEstimatedMinScreenSpaceRadius(ca);ca.levels.sort((sa,qa)=>sa.minScreenSpaceRadius-qa.minScreenSpaceRadius);ca.levels[0].minScreenSpaceRadius=Math.min(2,ca.levels[0].minScreenSpaceRadius);const ha=this._context,ia=this._getExternalColorParameters(this.symbolLayer.material);
var ka=m.get(this.symbolLayer,"material","color");const la=this._getCombinedOpacity(ka,{hasIntrinsicColor:!0}),Y=this.needsDrivenTransparentPass;var ea=N.materialsFromLodResources(ca);ka=N.materialsFromLodResources(ca).map(sa=>({opacity:sa.parameters.opacity||1,transparent:sa.parameters.transparent}));ea.forEach(sa=>{const qa=sa.parameters;sa.setParameters(ia);const Ha=qa.opacity*la;sa.setParameters({opacity:Ha,transparent:1>Ha||Y||qa.transparent});ha.screenSizePerspectiveEnabled&&sa.setParameters({screenSizePerspective:ha.sharedResources.screenSizePerspectiveSettings})});
const ba=da.referenceBoundingBox,Z=k.fromArray(e.size(ba)),fa=k.fromArray(ca.levels[0].pivotOffset),ja=k.fromArray(v.objectSymbolLayerSizeWithResourceSize(Z,this.symbolLayer)),oa=g.length(ja);F.updateFastSymbolUpdatesState(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(ba,ja,Z,fa))&&ea.forEach(sa=>sa.setParameters(this._fastUpdates.materialParameters));ea=yield this._createStageResources(ca,R);W=yield this._createLodRenderer(ca,W);return{lodResources:ca,lodRenderer:W,
stageResources:ea,symbolSize:ja,extentPadding:oa,isEsriSymbolResource:aa,isWosr:V,originalMaterialParameters:ka,physicalBasedRenderingEnabled:R,resourceBoundingBox:ba,resourceSize:Z,pivotOffset:fa}});return function(aa,W){return U.apply(this,arguments)}}();T._addDisposeResource=function(U){this._disposeResourceHandles.push(U)};T._createStageResources=function(){var U=b._asyncToGenerator(function*(aa,W){const R=this._context.stage,V=N.materialsFromLodResources(aa);W!==this._context.physicalBasedRenderingEnabled&&
this.physicalBasedRenderingChanged();R.addMany(V);this._addDisposeResource(()=>R.removeMany(V));const da=N.texturesFromLodResources(aa);R.addMany(da);this._addDisposeResource(()=>R.removeMany(da));yield R.load(da);const ca=N.geometriesFromLodResources(aa);R.addMany(ca);this._addDisposeResource(()=>R.removeMany(ca));return{materials:V,textures:da,geometries:ca}});return function(aa,W){return U.apply(this,arguments)}}();T._createLodRenderer=function(){var U=b._asyncToGenerator(function*(aa,W){const R=
this._context.stage,V=new K.LodRenderer(aa,this._optionalFields,{layerUid:this._context.layer.uid,graphicUid:da=>this._instanceIndexToGraphicUid.get(da),notifyGraphicGeometryChanged:da=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(da)),notifyGraphicVisibilityChanged:da=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(da))},this._fastUpdates.enabled?{applyTransform:(da,ca,ha)=>{da.getFeatureAttribute(ca,I);r.copy(ha,F.evaluateModelTransform(this._fastUpdates.materialParameters,
I,ha))},scaleFactor:(da,ca,ha)=>{ca.getFeatureAttribute(ha,I);return F.evaluateModelTransformScale(da,this._fastUpdates.materialParameters,I)}}:null);V.slicePlaneEnabled=this._context.slicePlaneEnabled;this._addDisposeResource(()=>{R.removeRenderPlugin(V)});yield R.addRenderPlugin(V.slots,V,W);return V});return function(aa,W){return U.apply(this,arguments)}}();T._getExternalColorParameters=function(U){const aa={};this._drivenProperties.color?aa.externalColor=f.ONES:m.isSome(U)&&m.isSome(U.color)?
aa.externalColor=c.toUnitRGBA(U.color):(aa.externalColor=f.ONES,aa.colorMixMode="ignore");return aa};T.destroy=function(){Q.prototype.destroy.call(this);this._cleanupResources()};T._cleanupResources=function(){this._disposeResourceHandles.forEach(U=>U());this._disposeResourceHandles.length=0;this._resources=null};T.createGraphics3DGraphic=function(U){const aa=U.graphic;if(!this._validateGeometry(aa.geometry))return null;const W=y.placePointOnGeometry(aa.geometry);if(m.isNone(W))return this.logger.warn(`unsupported geometry type for icon symbol: ${aa.geometry.type}`),
null;const R=this.setGraphicElevationContext(aa,new x.ElevationContext);return this._createAs3DShape(aa,W,U.renderingInfo,R,aa.uid)};T.notifyDestroyGraphicLayer=function(U){this._instanceIndexToGraphicUid.delete(U.instanceIndex)};T.graphicLayerToGraphicId=function(){return 0};T.layerOpacityChanged=function(){if(m.isNone(this._resources))return!0;const U=this._drivenProperties.opacity,aa=!this.isPrimitive,W=this._resources.stageResources.materials,R=this._resources.originalMaterialParameters;for(let ca=
0;ca<W.length;ca++){const ha=W[ca];var V=m.get(this.symbolLayer,"material","color"),da=R[ca];V=this._getCombinedOpacity(V,{hasIntrinsicColor:aa})*da.opacity;da=1>V||U||da.transparent;ha.setParameters({opacity:V,transparent:da});this.isPrimitive&&ha.setParameters({cullFace:da?G.CullFaceOptions.None:G.CullFaceOptions.Back})}return!0};T.layerElevationInfoChanged=function(U,aa){return this.updateGraphics3DGraphicElevationInfo(U,aa,t.needsElevationUpdates3D)};T.slicePlaneEnabledChanged=function(){if(m.isNone(this._resources))return!0;
this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const U of this._resources.stageResources.materials)U.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};T.physicalBasedRenderingChanged=function(){if(m.isNone(this._resources))return!0;const {stageResources:U,isWosr:aa}=this._resources;for(const W of U.materials)this.isPrimitive?W.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):aa||W.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,
isSchematic:!1});return!1===this.hasLoadedPBRTextures&&!0===this._context.physicalBasedRenderingEnabled?(this.hasLoadedPBRTextures=!0,!1):!0};T.pixelRatioChanged=function(){return!0};T.applyRendererDiff=function(U,aa){if(m.isNone(this._resources))return C.ApplyRendererDiffResult.Recreate_Symbol;const {stageResources:{materials:W},lodRenderer:R,resourceBoundingBox:V,symbolSize:da,resourceSize:ca,pivotOffset:ha}=this._resources;for(const ia in U.diff)switch(ia){case "visualVariables":if(F.updateFastSymbolUpdatesState(this._fastUpdates,
aa,this._fastVisualVariableConvertOptions(V,da,ca,ha))){for(const ka of W)ka.setParameters(this._fastUpdates.materialParameters);R.notifyShaderTransformationChanged()}else return C.ApplyRendererDiffResult.Recreate_Symbol;break;default:return C.ApplyRendererDiffResult.Recreate_Symbol}return C.ApplyRendererDiffResult.Fast_Update};T.computeComplexity=function(){if(m.isNone(this._resources))return Q.prototype.computeComplexity.call(this);const U=N.geometriesFromLodLevelResources(this._resources.lodResources.levels[0]).reduce((W,
R)=>W+R.indices.get(P.VertexAttribute.POSITION).length,0)/3,aa=E.defaultSymbolLayerMemoryComplexity(this.symbol,this.symbolLayer);return{primitivesPerFeature:U,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:aa}};T._hasLodRenderer=function(){return m.isSome(this._resources)};T._createAs3DShape=function(U,aa,W,R,V){if(!this._hasLodRenderer()||m.isNone(this._resources))return null;U=this.getFastUpdateAttrValues(U);const da=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?
u.mixinColorAndOpacity(W.color,W.opacity):null;var ca=this._context.clippingExtent;d.projectPointToVector(aa,L,this._context.elevationProvider.spatialReference);if(m.isSome(ca)&&!e.containsPoint(ca,L))return null;ca=this._requiresTerrainElevation(R);const ha=this._computeGlobalTransform(aa,R,H,O);W=this._computeLocalTransform(this._resources,this.symbolLayer,W,J);const ia=this._resources.lodRenderer.instanceData,ka=ia.addInstance();this._instanceIndexToGraphicUid.set(ka,V);ia.setLocalTransform(ka,
W,!1);ia.setGlobalTransform(ka,ha);U&&ia.setFeatureAttribute(ka,U);da&&ia.setColor(ka,da);V=new B(this,ka,w.perLodInstanceElevationAligner,R);ca&&(V.alignedSampledElevation=O.sampledElevation);V.needsElevationUpdates=t.needsElevationUpdates3D(R.mode);y.extendPointGraphicElevationContext(V,aa,this._context.elevationProvider);return V};T._computeGlobalTransform=function(U,aa,W,R){t.evaluateElevationInfoAtPoint(U,this._context.elevationProvider,aa,this._context.renderCoordsHelper,R);L[0]=U.x;L[1]=U.y;
L[2]=R.z;d.computeTranslationToOriginAndRotation(U.spatialReference,L,W,this._context.renderCoordsHelper.spatialReference);return W};T._computeLocalTransform=function(U,aa,W,R){r.identity(R);this._applyObjectRotation(W,!1,R);this._applyObjectRotation(aa,!0,R);this._applyObjectScale(U,W,R);this._applyAnchor(U,aa,R);return R};T._applyObjectScale=function(U,aa,W){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(U=u.computeObjectScale(this._drivenProperties.size&&aa.size?aa.size:
U.symbolSize,U.symbolSize,U.resourceSize,this._context.renderCoordsHelper.unitInMeters),1===U[0]&&1===U[1]&&1===U[2]||r.scale(W,W,U))};T.prepareSymbolLayerPatch=function(U){if("partial"===U.diff.type){var aa=U.diff.diff;this._preparePatchTransform(U,aa);this._preparePatchColor(U,aa)}};T.updateGeometry=function(U,aa){if(m.isNone(this._resources))return!0;const W=aa&&y.placePointOnGeometry(aa);if(m.isNone(W))return!1;aa=this.getGeometryElevationMode(aa);if(U.elevationContext.mode!==aa)return!1;this._computeGlobalTransform(W,
U.elevationContext,H,O);this._requiresTerrainElevation(U.elevationContext)&&(U.alignedSampledElevation=O.sampledElevation);this._resources.lodRenderer.instanceData.setGlobalTransform(U.instanceIndex,H,!0);y.extendPointGraphicElevationContext(U,W,this._context.elevationProvider);return!0};T._preparePatchTransform=function(U,aa){if((aa.heading||aa.tilt||aa.roll||aa.width||aa.height||aa.depth||aa.anchor||aa.anchorPosition)&&!m.isNone(this._resources)){var W=(ea,ba,Z)=>m.unwrapOr(null!=ea&&"complete"===
ea.type?ea.newValue:ba,Z),R=W(aa.heading,this.symbolLayer.heading,0),V=W(aa.tilt,this.symbolLayer.tilt,0),da=W(aa.roll,this.symbolLayer.roll,0),ca=W(aa.width,this.symbolLayer.width,void 0),ha=W(aa.height,this.symbolLayer.height,void 0),ia=W(aa.depth,this.symbolLayer.depth,void 0),ka=W(aa.anchor,this.symbolLayer.anchor,void 0);W=W(aa.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete aa.heading;delete aa.tilt;delete aa.roll;delete aa.width;delete aa.height;delete aa.depth;delete aa.anchor;
delete aa.anchorPosition;var la={heading:R,tilt:V,roll:da,anchor:ka,anchorPosition:W},Y=this._resources;this.loadStatus===z.LoadStatus.LOADED&&U.symbolLayerStatePatches.push(()=>{Y.symbolSize=k.fromArray(v.objectSymbolLayerSizeWithResourceSize(Y.resourceSize,{width:ca,height:ha,depth:ia,isPrimitive:this.symbolLayer.isPrimitive}))});U.graphics3DGraphicPatches.push((ea,ba)=>{ba=this._computeLocalTransform(Y,la,ba,J);Y.lodRenderer.instanceData.setLocalTransform(ea.instanceIndex,ba,!0)})}};T._preparePatchColor=
function(U,aa){if(aa.material&&"partial"===aa.material.type&&(aa=aa.material.diff,aa.color&&"complete"===aa.color.type&&null!=aa.color.newValue&&null!=aa.color.oldValue)){var W=aa.color.newValue,R=m.isSome(W)?c.toUnitRGBA(W):f.ONES;delete aa.color;var V=this._resources;m.isNone(V)||U.graphics3DGraphicPatches.push(da=>{this._hasPerInstanceColor()?(V.lodRenderer.instanceData.setColor(da.instanceIndex,R),da=this._setMaterialTransparencyParams({},W)):da=this._setMaterialTransparencyParams({externalColor:R},
W);for(const ca of V.stageResources.materials)ca.setParameters(da)})}};T._requiresTerrainElevation=function(U){return"absolute-height"!==U.mode};T._applyObjectRotation=function(U,aa,W){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&aa))return u.computeObjectRotation(U.heading,U.tilt,U.roll,W)};T._computeAnchor=function(U,aa,W){const R=k.create();switch(W.anchor){case "center":g.copy(R,e.center(U));g.negate(R,R);break;case "top":aa=e.center(U);g.set(R,-aa[0],-aa[1],
-U[5]);break;case "bottom":aa=e.center(U);g.set(R,-aa[0],-aa[1],-U[2]);break;case "relative":aa=e.center(U);U=e.size(U);W=(W=W.anchorPosition)?k.fromValues(W.x,W.y,W.z):k.ZEROS;g.multiply(R,U,W);g.add(R,R,aa);g.negate(R,R);break;default:m.isSome(aa)?g.negate(R,aa):g.copy(R,k.ZEROS)}return R};T._applyAnchor=function(U,aa,W){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(U=this._computeAnchor(U.resourceBoundingBox,U.pivotOffset,aa))&&r.translate(W,W,U)};T._hasPerInstanceColor=
function(){return this._drivenProperties.color||this._drivenProperties.opacity};T._fastVisualVariableConvertOptions=function(U,aa,W,R){const V=m.isSome(U)?k.fromArray(e.size(U)):k.ONES;U=m.isSome(U)?this._computeAnchor(U,R,this.symbolLayer):k.ZEROS;R=this._context.renderCoordsHelper.unitInMeters;W=u.computeObjectScale(m.isSome(aa)?aa:void 0,aa,W,R);const da=k.fromValues(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:V,symbolSize:m.isSome(aa)?aa:k.ONES,
unitInMeters:R,transformation:{anchor:U,scale:W,rotation:da}}};b._createClass(S,[{key:"extentPadding",get:function(){return m.isSome(this._resources)?this._resources.extentPadding:0}},{key:"isPrimitive",get:function(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}},{key:"lodRenderer",get:function(){return m.get(this._resources,"lodRenderer")}}]);return S}(q.Graphics3DSymbolLayer);const L=k.create(),J=n.create(),H=n.create(),I=f.create(),O=new t.SampleElevationInfo;a.Graphics3DObjectSymbolLayer=
q;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Object3DStateID".split(" "),
function(a,b,c,m,l,r,n,g,k,f){let d=function(){function x(q,u,C,z){this.graphics3DSymbolLayer=q;this.instanceIndex=u;this.elevationAligner=C;this.elevationContext=z;this.type="lod-instance";this._highlights=new Set;this.alignedSampledElevation=0;this.needsElevationUpdates=this.isElevationSource=!1}var B=x.prototype;B.initialize=function(){};B.setVisibility=function(q){const u=this.lodRenderer.instanceData;q!==u.getVisible(this.instanceIndex)&&u.setVisible(this.instanceIndex,q)};B.destroy=function(){null!=
this.instanceIndex&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))};B.alignWithElevation=function(q,u,C){this.elevationAligner&&(n.setContextFeature(this.elevationContext.featureExpressionInfoContext,C),q=this.elevationAligner(this,this.elevationContext,q,u),b.isSome(q)&&(this.alignedSampledElevation=q))};B.getCenterObjectSpace=function(q=l.create()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,
t);return m.transformMat4(q,this.lodRenderer.baseBoundingSphere.center,t)};B.getBoundingBoxObjectSpace=function(q=r.create()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,t);const u=this.lodRenderer.baseBoundingBox;r.empty(q);for(let C=0;8>C;++C)m.set(h,0===(C&1)?u[0]:u[3],0===(C&2)?u[1]:u[4],0===(C&4)?u[2]:u[5]),m.transformMat4(h,h,t),r.expandWithVec3(q,h);return q};B.computeAttachmentOrigin=function(q){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,
t);q.render.origin[0]+=t[12];q.render.origin[1]+=t[13];q.render.origin[2]+=t[14];q.render.num++};B.getProjectedBoundingBox=function(){var q=a._asyncToGenerator(function*(u,C,z,A,p){p=this.getBoundingBoxObjectSpace(p);var y=w;const D=r.isPoint(p)?1:y.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,t);for(var E=0;E<D;E++){const F=y[E];h[0]=p[F[0]];h[1]=p[F[1]];h[2]=p[F[2]];m.transformMat4(h,h,t);e[3*E]=h[0];e[3*E+1]=h[1];e[3*E+2]=h[2]}if(!u(e,0,D))return null;r.empty(p);u=
null;this.calculateRelativeScreenBounds&&(u=this.calculateRelativeScreenBounds());for(y=0;y<3*D;y+=3){for(E=0;3>E;E++)p[E]=Math.min(p[E],e[y+E]),p[E+3]=Math.max(p[E+3],e[y+E]);u&&z.push({location:e.slice(y,y+3),screenSpaceBoundingRect:u})}if(C&&(r.center(p,v),"absolute-height"!==this.elevationContext.mode)){let F;z=g.demResolutionForBoundingBox(p,C);try{F=yield C.service.queryElevation(v[0],v[1],A,z,"ground")}catch(G){}b.isSome(F)&&r.offset(p,0,0,-this.alignedSampledElevation+F)}return p});return function(u,
C,z,A,p){return q.apply(this,arguments)}}();B.addObjectState=function(q,u){q===k.Object3DState.Highlight&&(q=new f.Object3DStateID(q),this._addHighlightId(q),u.addExternal(C=>{this._removeHighlightId(C)},q))};B.removeObjectState=function(q){this._highlights.forEach(u=>q.remove(u))};B._addHighlightId=function(q){this._highlights.add(q);this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)};B._removeHighlightId=function(q){this._highlights.delete(q);this.lodRenderer.instanceData.setHighlight(this.instanceIndex,
0<this._highlights.size)};a._createClass(x,[{key:"lodRenderer",get:function(){return this.graphics3DSymbolLayer.lodRenderer}}]);return x}();const e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],h=l.create(),v=l.create(),w=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],t=c.create();return d})},"esri/views/3d/layers/graphics/lodResourceUtils":function(){define(["exports","../../webgl-engine/lib/lodRendering/LodResources"],function(a,b){function c(l){const r=[];l.stageResources.geometries.forEach((n,
g)=>{r.push({material:l.stageResources.materials[g],geometry:n,textures:l.stageResources.textures})});return{components:r,minScreenSpaceRadius:l.lodThreshold,pivotOffset:l.pivotOffset}}function m(l,r=.05){l=b.computeFaceCount(l);return Math.sqrt(l/(r*Math.PI))}a.estimateMinScreenSpaceRadius=m;a.fillEstimatedMinScreenSpaceRadius=function(l){l.levels.forEach(r=>{r.minScreenSpaceRadius||(r.minScreenSpaceRadius=m(r))})};a.makeLodLevelResources=c;a.makeLodResources=function(l){return{levels:l.map(r=>c(r))}};
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/devEnvironmentUtils ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec32 ../../../../chunks/vec42 ../../../../geometry/support/buffer/utils ../../glTF/DefaultLoadingContext ../../glTF/loader ../../glTF/internal/indexUtils ./wosrLoader ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/DefaultMaterial_COLOR_GAMMA ../../../webgl/enums ../../../../chunks/vec22 ../../../../chunks/vec43 ../../../../chunks/vec33".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G){function P(){P=b._asyncToGenerator(function*(M,L){var J=K(c.adjustStaticAGOUrl(M));if("wosr"===J.fileType)return M=yield L.cache?L.cache.loadWOSR(J.url,L):q.load(J.url,L),J=q.processLoadResult(M,L),{lods:[J],referenceBoundingBox:J.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:M.remove};M=yield L.cache?L.cache.loadGLTF(J.url,L,L.usePBR):x.load(new t.DefaultLoadingContext(L.streamDataRequester),J.url,L,L.usePBR);var H=m.get(M.model.meta,
"ESRI_proxyEllipsoid");if(M.meta.isEsriSymbolResource&&m.isSome(H)&&M.meta.uri.includes("/RealisticTrees/"))a:for(var I=0;I<M.model.lods.length;++I){var O=M.model.lods[I];M.customMeta.esriTreeRendering=!0;for(var Q of O.parts){O=Q.attributes.normal;if(m.isNone(O))break a;const T=Q.attributes.position,U=T.count,aa=f.create(),W=f.create(),R=f.create(),V=w.createBuffer(e.BufferViewVec4u8,U),da=w.createBuffer(e.BufferViewVec3f,U),ca=n.invert(g.create(),Q.transform);for(let ha=0;ha<U;ha++){T.getVec(ha,
W);O.getVec(ha,aa);k.transformMat4(W,W,Q.transform);k.subtract(R,W,H.center);k.divide(R,R,H.radius);const ia=R[2];var S=k.length(R);S=Math.min(.45+.55*S*S,1);k.divide(R,R,H.radius);k.transformMat4(R,R,ca);k.normalize(R,R);I+1!==M.model.lods.length&&1<M.model.lods.length&&(-1<ia?k.lerp(R,R,aa,.2):k.lerp(R,R,aa,Math.min(-4*ia-3.8,1)));da.setVec(ha,R);V.set(ha,0,255*S);V.set(ha,1,255*S);V.set(ha,2,255*S);V.set(ha,3,255)}Q.attributes.normal=da;Q.attributes.color=V}}Q=M.meta.isEsriSymbolResource?{usePBR:L.usePBR,
isSchematic:!1,treeRendering:!!M.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:L.usePBR,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]};L={...L.materialParamsMixin,treeRendering:!!M.customMeta.esriTreeRendering};if(null!=J.specifiedLodIndex)return H=N(M,Q,L,J.specifiedLodIndex),I=H[0].boundingBox,0!==J.specifiedLodIndex&&(I=N(M,Q,L,0)[0].boundingBox),{lods:H,referenceBoundingBox:I,isEsriSymbolResource:M.meta.isEsriSymbolResource,isWosr:!1,remove:M.remove};J=N(M,Q,L);return{lods:J,
referenceBoundingBox:J[0].boundingBox,isEsriSymbolResource:M.meta.isEsriSymbolResource,isWosr:!1,remove:M.remove}});return P.apply(this,arguments)}function K(M){const L=M.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return L?{fileType:"gltf",url:L[1],specifiedLodIndex:null!=L[4]?Number(L[4]):null}:M.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:M,specifiedLodIndex:null}:{fileType:"unknown",url:M,specifiedLodIndex:null}}function N(M,L,J,H){const I=M.model,O=r.create(),Q=[],S=new Map,T=new Map;
I.lods.forEach((U,aa)=>{if(void 0===H||aa===H){var W={name:U.name,stageResources:{textures:[],materials:[],geometries:[]},lodThreshold:m.isSome(U.lodThreshold)?U.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:d.empty()};Q.push(W);U.parts.forEach(R=>{var V=R.material+(R.attributes.normal?"_normal":"")+(R.attributes.color?"_color":"")+(R.attributes.texCoord0?"_texCoord0":"")+(R.attributes.tangent?"_tangent":"");const da=I.materials.get(R.material),ca=m.isSome(R.attributes.texCoord0);
var ha=m.isSome(R.attributes.normal);a:{switch(da.alphaMode){case "BLEND":var ia=u.AlphaDiscardMode.Blend;break a;case "MASK":ia=u.AlphaDiscardMode.Mask;break a;case "OPAQUE":case null:case void 0:ia=u.AlphaDiscardMode.Opaque;break a}ia=void 0}if(!S.has(V)){if(ca){if(m.isSome(da.textureColor)&&!T.has(da.textureColor)){var ka=I.textures.get(da.textureColor);T.set(da.textureColor,new z.Texture(ka.data,{...ka.parameters,preMultiplyAlpha:ia!==u.AlphaDiscardMode.Opaque}))}m.isSome(da.textureNormal)&&!T.has(da.textureNormal)&&
(ka=I.textures.get(da.textureNormal),T.set(da.textureNormal,new z.Texture(ka.data,ka.parameters)));m.isSome(da.textureOcclusion)&&!T.has(da.textureOcclusion)&&(ka=I.textures.get(da.textureOcclusion),T.set(da.textureOcclusion,new z.Texture(ka.data,ka.parameters)));m.isSome(da.textureEmissive)&&!T.has(da.textureEmissive)&&(ka=I.textures.get(da.textureEmissive),T.set(da.textureEmissive,new z.Texture(ka.data,ka.parameters)));m.isSome(da.textureMetallicRoughness)&&!T.has(da.textureMetallicRoughness)&&
(ka=I.textures.get(da.textureMetallicRoughness),T.set(da.textureMetallicRoughness,new z.Texture(ka.data,ka.parameters)))}ka=da.color[0]**(1/y.COLOR_GAMMA);var la=da.color[1]**(1/y.COLOR_GAMMA),Y=da.color[2]**(1/y.COLOR_GAMMA),ea=da.emissiveFactor[0]**(1/y.COLOR_GAMMA);const ba=da.emissiveFactor[1]**(1/y.COLOR_GAMMA),Z=da.emissiveFactor[2]**(1/y.COLOR_GAMMA),fa=m.isSome(da.textureColor)&&ca?T.get(da.textureColor):null;S.set(V,new p.DefaultMaterial({...L,transparent:ia===u.AlphaDiscardMode.Blend,customDepthTest:u.DepthTestFunction.Lequal,
textureAlphaMode:ia,textureAlphaCutoff:da.alphaCutoff,diffuse:[ka,la,Y],ambient:[ka,la,Y],opacity:da.opacity,doubleSided:da.doubleSided,doubleSidedType:"winding-order",cullFace:da.doubleSided?u.CullFaceOptions.None:u.CullFaceOptions.Back,hasVertexColors:!!R.attributes.color,hasVertexTangents:!!R.attributes.tangent,normals:ha?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:m.isSome(fa)?fa.id:void 0,colorMixMode:da.colorMixMode,normalTextureId:m.isSome(da.textureNormal)&&ca?T.get(da.textureNormal).id:
void 0,textureAlphaPremultiplied:m.isSome(fa)&&!!fa.params.preMultiplyAlpha,occlusionTextureId:m.isSome(da.textureOcclusion)&&ca?T.get(da.textureOcclusion).id:void 0,emissiveTextureId:m.isSome(da.textureEmissive)&&ca?T.get(da.textureEmissive).id:void 0,metallicRoughnessTextureId:m.isSome(da.textureMetallicRoughness)&&ca?T.get(da.textureMetallicRoughness).id:void 0,emissiveFactor:[ea,ba,Z],mrrFactors:[da.metallicFactor,da.roughnessFactor,L.mrrFactors[2]],isSchematic:!1,...J}))}a:{ha=R.indices||R.attributes.position.count;
switch(R.primitiveType){case D.PrimitiveType.TRIANGLES:ha=B.trianglesToTriangles(ha);break a;case D.PrimitiveType.TRIANGLE_STRIP:ha=B.triangleStripToTriangles(ha);break a;case D.PrimitiveType.TRIANGLE_FAN:ha=B.triangleFanToTriangles(ha);break a}ha=void 0}ia=ha;ha=R.attributes.position.count;ka=w.createBuffer(e.BufferViewVec3f,ha);h.transformMat4(ka,R.attributes.position,R.transform);ka=[[A.VertexAttribute.POSITION,{data:ka.typedBuffer,size:ka.elementCount,exclusive:!0}]];la=[[A.VertexAttribute.POSITION,
ia]];m.isSome(R.attributes.normal)&&(Y=w.createBuffer(e.BufferViewVec3f,ha),l.normalFromMat4(O,R.transform),h.transformMat3(Y,R.attributes.normal,O),ka.push([A.VertexAttribute.NORMAL,{data:Y.typedBuffer,size:Y.elementCount,exclusive:!0}]),la.push([A.VertexAttribute.NORMAL,ia]));m.isSome(R.attributes.tangent)&&(Y=w.createBuffer(e.BufferViewVec4f,ha),l.normalFromMat4(O,R.transform),v.transformMat3(Y,R.attributes.tangent,O),ka.push([A.VertexAttribute.TANGENT,{data:Y.typedBuffer,size:Y.elementCount,exclusive:!0}]),
la.push([A.VertexAttribute.TANGENT,ia]));m.isSome(R.attributes.texCoord0)&&(Y=w.createBuffer(e.BufferViewVec2f,ha),E.normalizeIntegerBuffer(Y,R.attributes.texCoord0),ka.push([A.VertexAttribute.UV0,{data:Y.typedBuffer,size:Y.elementCount,exclusive:!0}]),la.push([A.VertexAttribute.UV0,ia]));m.isSome(R.attributes.color)&&(Y=w.createBuffer(e.BufferViewVec4u8,ha),4===R.attributes.color.elementCount?R.attributes.color instanceof e.BufferViewVec4f?v.scale(Y,R.attributes.color,255):R.attributes.color instanceof
e.BufferViewVec4u8?F.copy(Y,R.attributes.color):R.attributes.color instanceof e.BufferViewVec4u16&&v.scale(Y,R.attributes.color,1/256):(F.fill(Y,255,255,255,255),ea=new e.BufferViewVec3u8(Y.buffer,0,4),R.attributes.color instanceof e.BufferViewVec3f?h.scale(ea,R.attributes.color,255):R.attributes.color instanceof e.BufferViewVec3u8?G.copy(ea,R.attributes.color):R.attributes.color instanceof e.BufferViewVec3u16&&h.scale(ea,R.attributes.color,1/256)),ka.push([A.VertexAttribute.COLOR,{data:Y.typedBuffer,
size:Y.elementCount,exclusive:!0}]),la.push([A.VertexAttribute.COLOR,ia]));R=new C.Geometry(ka,la);W.stageResources.geometries.push(R);W.stageResources.materials.push(S.get(V));ca&&(m.isSome(da.textureColor)&&W.stageResources.textures.push(T.get(da.textureColor)),m.isSome(da.textureNormal)&&W.stageResources.textures.push(T.get(da.textureNormal)),m.isSome(da.textureOcclusion)&&W.stageResources.textures.push(T.get(da.textureOcclusion)),m.isSome(da.textureEmissive)&&W.stageResources.textures.push(T.get(da.textureEmissive)),
m.isSome(da.textureMetallicRoughness)&&W.stageResources.textures.push(T.get(da.textureMetallicRoughness)));W.numberOfVertices+=ha;V=R.boundingInfo;m.isSome(V)&&(d.expandWithVec3(W.boundingBox,V.getBBMin()),d.expandWithVec3(W.boundingBox,V.getBBMax()))})}});return Q}a.fetch=function(M,L){return P.apply(this,arguments)};a.gltfToEngineResources=N;a.parseUrl=K;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/devEnvironmentUtils":function(){define(["exports"],
function(a){const b=/^devext.arcgis.com$/,c=/^qaext.arcgis.com$/,m=/^[\w-]*\.mapsdevext.arcgis.com$/,l=/^[\w-]*\.mapsqa.arcgis.com$/,r=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,b,c,/^jsapps.esri.com$/,m,l];a.adjustStaticAGOUrl=function(n,g){return n?(g=g||globalThis.location.hostname)?null!=g.match(b)||null!=g.match(m)?n.replace("static.arcgis.com","staticdev.arcgis.com"):null!=g.match(c)||null!=g.match(l)?n.replace("static.arcgis.com","staticqa.arcgis.com"):n:n:n};a.isDevEnvironment=function(n){n=
n||globalThis.location.hostname;return r.some(g=>{var k;return null!=(null==(k=n)?void 0:k.match(g))})};a.isTelemetryDevEnvironment=function(n){n=n||globalThis.location.hostname;return[/^zrh-.+?\.esri\.com$/].concat(r).some(g=>{var k;return null!=(null==(k=n)?void 0:k.match(g))})};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/vec42":function(){define(["exports","../geometry/support/buffer/math/common"],function(a,b){function c(k,f,d){if(k.count!==
f.count)b.mathLogger.error("source and destination buffers need to have the same number of elements");else{var e=k.count,h=d[0],v=d[1],w=d[2],t=d[3],x=d[4],B=d[5],q=d[6],u=d[7],C=d[8],z=d[9],A=d[10],p=d[11],y=d[12],D=d[13],E=d[14];d=d[15];var F=k.typedBuffer;k=k.typedBufferStride;var G=f.typedBuffer;f=f.typedBufferStride;for(let K=0;K<e;K++){const N=K*k;var P=K*f;const M=G[P],L=G[P+1],J=G[P+2];P=G[P+3];F[N]=h*M+x*L+C*J+y*P;F[N+1]=v*M+B*L+z*J+D*P;F[N+2]=w*M+q*L+A*J+E*P;F[N+3]=t*M+u*L+p*J+d*P}}}function m(k,
f,d){if(k.count!==f.count)b.mathLogger.error("source and destination buffers need to have the same number of elements");else{var e=k.count,h=d[0],v=d[1],w=d[2],t=d[3],x=d[4],B=d[5],q=d[6],u=d[7];d=d[8];var C=k.typedBuffer;k=k.typedBufferStride;var z=f.typedBuffer;f=f.typedBufferStride;for(let p=0;p<e;p++){const y=p*k;var A=p*f;const D=z[A],E=z[A+1],F=z[A+2];A=z[A+3];C[y]=h*D+t*E+q*F;C[y+1]=v*D+x*E+u*F;C[y+2]=w*D+B*E+d*F;C[y+3]=A}}}function l(k,f){const d=Math.min(k.count,f.count),e=k.typedBuffer;
k=k.typedBufferStride;const h=f.typedBuffer;f=f.typedBufferStride;for(let t=0;t<d;t++){const x=t*k;var v=t*f;const B=h[v],q=h[v+1];v=h[v+2];var w=B*B+q*q+v*v;0<w&&(w=1/Math.sqrt(w),e[x]=w*B,e[x+1]=w*q,e[x+2]=w*v)}}function r(k,f,d){const e=Math.min(k.count,f.count),h=k.typedBuffer;k=k.typedBufferStride;const v=f.typedBuffer;f=f.typedBufferStride;for(let w=0;w<e;w++){const t=w*k,x=w*f;h[t]=d*v[x];h[t+1]=d*v[x+1];h[t+2]=d*v[x+2];h[t+3]=d*v[x+3]}}function n(k,f,d){const e=Math.min(k.count,f.count),h=
k.typedBuffer;k=k.typedBufferStride;const v=f.typedBuffer;f=f.typedBufferStride;for(let w=0;w<e;w++){const t=w*k,x=w*f;h[t]=v[x]>>d;h[t+1]=v[x+1]>>d;h[t+2]=v[x+2]>>d;h[t+3]=v[x+3]>>d}}const g=Object.freeze(Object.defineProperty({__proto__:null,transformMat4:c,transformMat3:m,normalize:l,scale:r,shiftRight:n},Symbol.toStringTag,{value:"Module"}));a.normalize=l;a.scale=r;a.shiftRight=n;a.transformMat3=m;a.transformMat4=c;a.vec4=g})},"esri/geometry/support/buffer/utils":function(){define("exports ./types ../../../chunks/mat32 ../../../chunks/mat42 ../../../chunks/scalar ../../../chunks/vec22 ../../../chunks/vec33 ../../../chunks/vec43".split(" "),
function(a,b,c,m,l,r,n,g){a.mat3=c.mat3;a.mat4=m.mat4;a.scalar=l.scalar;a.vec2=r.vec2;a.vec3=n.vec3;a.vec4=g.vec4;a.createBuffer=function(k,f){return new k(new ArrayBuffer(f*k.ElementCount*b.elementTypeSize(k.ElementType)))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/mat32":function(){define(["exports"],function(a){function b(m,l,r){const n=m.typedBuffer;m=m.typedBufferStride;const g=l.typedBuffer,k=l.typedBufferStride;l=r?r.count:l.count;
let f=(r&&r.dstIndex?r.dstIndex:0)*m;r=(r&&r.srcIndex?r.srcIndex:0)*k;for(let d=0;d<l;++d){for(let e=0;9>e;++e)n[f+e]=g[r+e];f+=m;r+=k}}const c=Object.freeze(Object.defineProperty({__proto__:null,copy:b},Symbol.toStringTag,{value:"Module"}));a.copy=b;a.mat3=c})},"esri/chunks/mat42":function(){define(["exports"],function(a){function b(m,l,r){const n=m.typedBuffer;m=m.typedBufferStride;const g=l.typedBuffer,k=l.typedBufferStride;l=r?r.count:l.count;let f=(r&&r.dstIndex?r.dstIndex:0)*m;r=(r&&r.srcIndex?
r.srcIndex:0)*k;for(let d=0;d<l;++d){for(let e=0;16>e;++e)n[f+e]=g[r+e];f+=m;r+=k}}const c=Object.freeze(Object.defineProperty({__proto__:null,copy:b},Symbol.toStringTag,{value:"Module"}));a.copy=b;a.mat4=c})},"esri/chunks/scalar":function(){define(["exports"],function(a){function b(l,r,n){const g=l.typedBuffer;l=l.typedBufferStride;const k=r.typedBuffer,f=r.typedBufferStride;r=n?n.count:r.count;let d=(n&&n.dstIndex?n.dstIndex:0)*l;n=(n&&n.srcIndex?n.srcIndex:0)*f;for(let e=0;e<r;++e)g[d]=k[n],d+=
l,n+=f}function c(l,r){const n=l.count;r||(r=new l.TypedArrayConstructor(n));for(let g=0;g<n;g++)r[g]=l.get(g);return r}const m=Object.freeze(Object.defineProperty({__proto__:null,copy:b,makeDense:c},Symbol.toStringTag,{value:"Module"}));a.copy=b;a.makeDense=c;a.scalar=m})},"esri/chunks/vec22":function(){define(["exports","../geometry/support/buffer/types"],function(a,b){function c(n,g,k){const f=n.typedBuffer;n=n.typedBufferStride;const d=g.typedBuffer,e=g.typedBufferStride;g=k?k.count:g.count;let h=
(k&&k.dstIndex?k.dstIndex:0)*n;k=(k&&k.srcIndex?k.srcIndex:0)*e;for(let v=0;v<g;++v)f[h]=d[k],f[h+1]=d[k+1],h+=n,k+=e}function m(n,g,k){const f=n.typedBuffer,d=n.typedBufferStride,e=g.typedBuffer,h=g.typedBufferStride,v=k?k.count:g.count;let w=(k&&k.dstIndex?k.dstIndex:0)*d,t=(k&&k.srcIndex?k.srcIndex:0)*h;if(b.isInteger(g.elementType))if(k=b.maximumValue(g.elementType),b.isSigned(g.elementType))for(g=0;g<v;++g)f[w]=Math.max(e[t]/k,-1),f[w+1]=Math.max(e[t+1]/k,-1),w+=d,t+=h;else for(g=0;g<v;++g)f[w]=
e[t]/k,f[w+1]=e[t+1]/k,w+=d,t+=h;else c(n,g,k);return n}function l(n,g,k,f){var d,e;const h=n.typedBuffer,v=n.typedBufferStride;n=null!=(d=null==f?void 0:f.count)?d:n.count;f=(null!=(e=null==f?void 0:f.dstIndex)?e:0)*v;for(e=0;e<n;++e)h[f]=g,h[f+1]=k,f+=v}const r=Object.freeze(Object.defineProperty({__proto__:null,copy:c,normalizeIntegerBuffer:m,fill:l},Symbol.toStringTag,{value:"Module"}));a.copy=c;a.fill=l;a.normalizeIntegerBuffer=m;a.vec2=r})},"esri/chunks/vec33":function(){define(["exports"],
function(a){function b(l,r,n){const g=l.typedBuffer;l=l.typedBufferStride;const k=r.typedBuffer,f=r.typedBufferStride;r=n?n.count:r.count;let d=(n&&n.dstIndex?n.dstIndex:0)*l;n=(n&&n.srcIndex?n.srcIndex:0)*f;for(let e=0;e<r;++e)g[d]=k[n],g[d+1]=k[n+1],g[d+2]=k[n+2],d+=l,n+=f}function c(l,r,n,g,k){var f,d;const e=l.typedBuffer,h=l.typedBufferStride;l=null!=(f=null==k?void 0:k.count)?f:l.count;k=(null!=(d=null==k?void 0:k.dstIndex)?d:0)*h;for(d=0;d<l;++d)e[k]=r,e[k+1]=n,e[k+2]=g,k+=h}const m=Object.freeze(Object.defineProperty({__proto__:null,
copy:b,fill:c},Symbol.toStringTag,{value:"Module"}));a.copy=b;a.fill=c;a.vec3=m})},"esri/chunks/vec43":function(){define(["exports"],function(a){function b(l,r,n){const g=l.typedBuffer;l=l.typedBufferStride;const k=r.typedBuffer,f=r.typedBufferStride;r=n?n.count:r.count;let d=(n&&n.dstIndex?n.dstIndex:0)*l;n=(n&&n.srcIndex?n.srcIndex:0)*f;for(let e=0;e<r;++e)g[d]=k[n],g[d+1]=k[n+1],g[d+2]=k[n+2],g[d+3]=k[n+3],d+=l,n+=f}function c(l,r,n,g,k,f){var d,e;const h=l.typedBuffer,v=l.typedBufferStride;l=
null!=(d=null==f?void 0:f.count)?d:l.count;f=(null!=(e=null==f?void 0:f.dstIndex)?e:0)*v;for(e=0;e<l;++e)h[f]=r,h[f+1]=n,h[f+2]=g,h[f+3]=k,f+=v}const m=Object.freeze(Object.defineProperty({__proto__:null,copy:b,fill:c},Symbol.toStringTag,{value:"Module"}));a.copy=b;a.fill=c;a.vec4=m})},"esri/views/3d/glTF/DefaultLoadingContext":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../request ../../../core/asyncUtils ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils".split(" "),
function(a,b,c,m,l,r,n,g){let k=function(){function d(h){this.streamDataRequester=h}var e=d.prototype;e.loadJSON=function(){var h=b._asyncToGenerator(function*(v,w){return this._load("json",v,w)});return function(v,w){return h.apply(this,arguments)}}();e.loadBinary=function(){var h=b._asyncToGenerator(function*(v,w){return g.isDataProtocol(v)?(n.throwIfAborted(w),g.dataToArrayBuffer(v)):this._load("binary",v,w)});return function(v,w){return h.apply(this,arguments)}}();e.loadImage=function(){var h=
b._asyncToGenerator(function*(v,w){return this._load("image",v,w)});return function(v,w){return h.apply(this,arguments)}}();e._load=function(){var h=b._asyncToGenerator(function*(v,w,t){if(r.isNone(this.streamDataRequester))return(yield c(w,{responseType:f[v]})).data;v=yield m.result(this.streamDataRequester.request(w,v,t));if(!0===v.ok)return v.value;n.throwIfAbortError(v.error);throw new l("",`Request for resource failed: ${v.error}`);});return function(v,w,t){return h.apply(this,arguments)}}();
return d}();const f={image:"image",binary:"array-buffer",json:"json"};a.DefaultLoadingContext=k;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/glTF/loader":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/mat4f64 ./DefaultErrorContext ./LoaderResult ./internal/Resource ../../webgl/enums".split(" "),function(a,b,c,m,l,r,n,g){function k(){k=b._asyncToGenerator(function*(B,q,u={},C=!0){const z=
yield n.Resource.load(B,w,q,u),A=`gltf_${v++}`,p={lods:[],materials:new Map,textures:new Map,meta:f(z)};B=!(!z.json.asset.extras||"symbolResource"!==z.json.asset.extras.ESRI_type);const y=new Map;yield d(z,function(){var D=b._asyncToGenerator(function*(E,F,G,P){var K;const N=null!=(K=y.get(G))?K:0;y.set(G,N+1);var M=void 0!==E.mode?E.mode:g.PrimitiveType.TRIANGLES;K=M===g.PrimitiveType.TRIANGLES||M===g.PrimitiveType.TRIANGLE_STRIP||M===g.PrimitiveType.TRIANGLE_FAN?M:null;if(c.isNone(K))w.warnUnsupported("Unsupported primitive mode ("+
x[M]+"). Skipping primitive.");else if(z.hasPositions(E)){M=z.getPositionData(E,u);var L=z.getMaterial(E,u,C),J=z.hasNormals(E)?z.getNormalData(E,u):null,H=z.hasTangents(E)?z.getTangentData(E,u):null,I=z.hasTextureCoordinates(E)?z.getTextureCoordinates(E,u):null,O=z.hasVertexColors(E)?z.getVertexColors(E,u):null;E=z.getIndexData(E,u);F={transform:m.clone(F),attributes:{position:yield M,normal:J?yield J:null,texCoord0:I?yield I:null,color:O?yield O:null,tangent:H?yield H:null},indices:yield E,primitiveType:K,
material:h(p,yield L,A)};E=null;c.isSome(p.meta)&&c.isSome(p.meta.ESRI_lod)&&"screenSpaceRadius"===p.meta.ESRI_lod.metric&&(E=p.meta.ESRI_lod.thresholds[G]);p.lods[G]=p.lods[G]||{parts:[],name:P,lodThreshold:E};p.lods[G].parts[N]=F}else w.warn("Skipping primitive without POSITION vertex attribute.")});return function(E,F,G,P){return D.apply(this,arguments)}}());for(const D of p.lods)D.parts=D.parts.filter(E=>!!E);return{model:p,meta:{isEsriSymbolResource:B,uri:z.uri},customMeta:{}}});return k.apply(this,
arguments)}function f(B){let q=null;B.json.nodes.forEach(u=>{u=u.extras;c.isSome(u)&&(u.ESRI_proxyEllipsoid||u.ESRI_lod)&&(q=u)});return q}function d(B,q){return e.apply(this,arguments)}function e(){e=b._asyncToGenerator(function*(B,q){function u(D,E){return C.apply(this,arguments)}function C(){C=b._asyncToGenerator(function*(D,E){const F=z.nodes[D];D=B.getNodeTransform(D);w.warnUnsupportedIf(null!=F.weights,"Morph targets are not supported.");if(null!=F.mesh){const G=z.meshes[F.mesh];for(const P of G.primitives)y.push(q(P,
D,E,G.name))}for(const G of F.children||[])y.push(u(G,E))});return C.apply(this,arguments)}const z=B.json;var A=z.scenes[z.scene||0].nodes;const p=1<A.length,y=[];for(const D of A)A=z.nodes[D],y.push(u(D,0)),A.extensions&&A.extensions.MSFT_lod&&Array.isArray(A.extensions.MSFT_lod.ids)&&!p&&A.extensions.MSFT_lod.ids.forEach((E,F)=>u(E,F+1));yield Promise.all(y)});return e.apply(this,arguments)}function h(B,q,u){const C=A=>{const p=`${u}_tex_${A&&A.id}${A&&A.name?"_"+A.name:""}`;A&&!B.textures.has(p)&&
(A=r.makeTextureSource(A.data,{wrap:{s:A.wrapS,t:A.wrapT},mipmap:t.includes(A.minFilter),noUnpackFlip:!0}),B.textures.set(p,A));return p},z=`${u}_mat_${q.id}_${q.name}`;B.materials.has(z)||(q=r.makeMaterialParameters({color:[q.color[0],q.color[1],q.color[2]],opacity:q.color[3],alphaMode:q.alphaMode,alphaCutoff:q.alphaCutoff,doubleSided:q.doubleSided,colorMixMode:q.ESRI_externalColorMixMode,textureColor:q.colorTexture?C(q.colorTexture):void 0,textureNormal:q.normalTexture?C(q.normalTexture):void 0,
textureOcclusion:q.occlusionTexture?C(q.occlusionTexture):void 0,textureEmissive:q.emissiveTexture?C(q.emissiveTexture):void 0,textureMetallicRoughness:q.metallicRoughnessTexture?C(q.metallicRoughnessTexture):void 0,emissiveFactor:[q.emissiveFactor[0],q.emissiveFactor[1],q.emissiveFactor[2]],metallicFactor:q.metallicFactor,roughnessFactor:q.roughnessFactor}),B.materials.set(z,q));return z}let v=0;const w=new l.DefaultErrorContext,t=[g.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,g.TextureSamplingMode.LINEAR_MIPMAP_NEAREST],
x="POINTS LINES LINE_LOOP LINE_STRIP TRIANGLES TRIANGLE_STRIP TRIANGLE_FAN".split(" ");a.load=function(B,q){return k.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/glTF/DefaultErrorContext":function(){define(["exports","../../../core/Error","../../../core/Logger"],function(a,b,c){const m=c.getLogger("esri.views.3d.glTF");c=function(){function l(){}var r=l.prototype;r.error=function(n){throw new b("gltf-loader-error",
n);};r.errorUnsupported=function(n){throw new b("gltf-loader-unsupported-feature",n);};r.errorUnsupportedIf=function(n,g){n&&this.errorUnsupported(g)};r.assert=function(n,g){n||this.error(g)};r.warn=function(n){m.warn(n)};r.warnUnsupported=function(n){this.warn("[Unsupported Feature] "+n)};r.warnUnsupportedIf=function(n,g){n&&this.warnUnsupported(g)};return l}();a.DefaultErrorContext=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/glTF/LoaderResult":function(){define(["exports",
"../../webgl/enums"],function(a,b){a.makeMaterialParameters=function(c={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...c}};a.makeTextureSource=function(c,m={}){return{data:c,parameters:{wrap:{s:b.TextureWrapMode.REPEAT,
t:b.TextureWrapMode.REPEAT,...m.wrap},noUnpackFlip:!0,mipmap:!1,...m}}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/glTF/internal/Resource":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/compilerUtils ../../../../core/MapUtils ../../../../core/urlUtils ../../../../core/Version ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf64 ../../../../geometry/support/buffer/BufferView ../../../../chunks/scalar ./BinaryStreamReader ./enums ./fillDefaults ./pathUtils ../../../webgl/enums".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x){function B(P){switch(P.componentType){case x.DataType.BYTE:return new d.BufferViewVec2i8(P.raw,P.byteOffset,P.byteStride,P.byteOffset+P.byteStride*P.entryCount);case x.DataType.UNSIGNED_BYTE:return new d.BufferViewVec2u8(P.raw,P.byteOffset,P.byteStride,P.byteOffset+P.byteStride*P.entryCount);case x.DataType.SHORT:return new d.BufferViewVec2i16(P.raw,P.byteOffset,P.byteStride,P.byteOffset+P.byteStride*P.entryCount);case x.DataType.UNSIGNED_SHORT:return new d.BufferViewVec2u16(P.raw,
P.byteOffset,P.byteStride,P.byteOffset+P.byteStride*P.entryCount);case x.DataType.UNSIGNED_INT:return new d.BufferViewVec2u32(P.raw,P.byteOffset,P.byteStride,P.byteOffset+P.byteStride*P.entryCount);case x.DataType.FLOAT:return new d.BufferViewVec2f(P.raw,P.byteOffset,P.byteStride,P.byteOffset+P.byteStride*P.entryCount);default:c.neverReached(P.componentType)}}function q(P){return u.apply(this,arguments)}function u(){u=b._asyncToGenerator(function*(P){return new Promise((K,N)=>{const M=new Blob([P]),
L=new FileReader;L.onload=()=>{K(JSON.parse(L.result))};L.onerror=J=>{N(J)};L.readAsText(M)})});return u.apply(this,arguments)}function C(P,K){return z.apply(this,arguments)}function z(){z=b._asyncToGenerator(function*(P,K){return new Promise((N,M)=>{const L=new Blob([P],{type:K}),J=URL.createObjectURL(L),H=new Image;H.addEventListener("load",()=>{URL.revokeObjectURL(J);"decode"in H?H.decode().then(()=>N(H),()=>N(H)):N(H)});H.addEventListener("error",I=>{URL.revokeObjectURL(J);M(I)});H.src=J})});
return z.apply(this,arguments)}let A=function(){function P(N,M,L,J,H){this.context=N;this.errorContext=M;this.uri=L;this.json=J;this.glbBuffer=H;this.bufferLoaders=new Map;this.textureLoaders=new Map;this.textureCache=new Map;this.materialCache=new Map;this.nodeParentMap=new Map;this.nodeTransformCache=new Map;this.baseUri=t.splitURI(this.uri).dirPart;this._checkVersionSupported();this._checkRequiredExtensionsSupported();M.errorUnsupportedIf(null==J.scenes,"Scenes must be defined.");M.errorUnsupportedIf(null==
J.meshes,"Meshes must be defined");M.errorUnsupportedIf(null==J.nodes,"Nodes must be defined.");this._computeNodeParents()}P.load=function(){var N=b._asyncToGenerator(function*(M,L,J,H){if(l.isDataProtocol(J)){var I=l.dataComponents(J);if("model/gltf-binary"!==I.mediaType)try{const O=JSON.parse(I.isBase64?atob(I.data):I.data);return new P(M,L,J,O)}catch{}I=l.dataToArrayBuffer(J);if(P._isGLBData(I))return this._fromGLBData(M,L,J,I)}if(J.endsWith(".gltf"))return H=yield M.loadJSON(J,H),new P(M,L,J,
H);I=yield M.loadBinary(J,H);if(P._isGLBData(I))return this._fromGLBData(M,L,J,I);H=yield M.loadJSON(J,H);return new P(M,L,J,H)});return function(M,L,J,H){return N.apply(this,arguments)}}();P._isGLBData=function(N){N=new h.BinaryStreamReader(N);return 4<=N.remainingBytes()&&1179937895===N.readUint32()};P._fromGLBData=function(){var N=b._asyncToGenerator(function*(M,L,J,H){H=yield P._parseGLBData(L,H);return new P(M,L,J,H.json,H.binaryData)});return function(M,L,J,H){return N.apply(this,arguments)}}();
P._parseGLBData=function(){var N=b._asyncToGenerator(function*(M,L){const J=new h.BinaryStreamReader(L);M.assert(12<=J.remainingBytes(),"GLB binary data is insufficiently large.");var H=J.readUint32(),I=J.readUint32();const O=J.readUint32();M.assert(1179937895===H,"Magic first 4 bytes do not fit to expected GLB value.");M.assert(L.byteLength>=O,"GLB binary data is smaller than header specifies.");M.errorUnsupportedIf(2!==I,"An unsupported GLB container version was detected. Only version 2 is supported.");
L=0;let Q,S;for(;8<=J.remainingBytes();)H=J.readUint32(),I=J.readUint32(),0===L?(M.assert(1313821514===I,"First GLB chunk must be JSON."),M.assert(0<=H,"No JSON data found."),Q=yield q(J.readUint8Array(H))):1===L?(M.errorUnsupportedIf(5130562!==I,"Second GLB chunk expected to be BIN."),S=J.readUint8Array(H)):M.warnUnsupported("More than 2 GLB chunks detected. Skipping."),L+=1;Q||M.error("No GLB JSON chunk detected.");return{json:Q,binaryData:S}});return function(M,L){return N.apply(this,arguments)}}();
var K=P.prototype;K.getBuffer=function(){var N=b._asyncToGenerator(function*(M,L){const J=this.json.buffers[M],H=this.errorContext;if(null==J.uri)return H.assert(null!=this.glbBuffer,"GLB buffer not present"),this.glbBuffer;M=yield this._getBufferLoader(M,L);H.assert(M.byteLength===J.byteLength,"Buffer byte lengths should match.");return M});return function(M,L){return N.apply(this,arguments)}}();K._getBufferLoader=function(){var N=b._asyncToGenerator(function*(M,L){const J=this.bufferLoaders.get(M);
if(J)return J;L=this.context.loadBinary(this._resolveUri(this.json.buffers[M].uri),L).then(H=>new Uint8Array(H));this.bufferLoaders.set(M,L);return L});return function(M,L){return N.apply(this,arguments)}}();K.getAccessor=function(){var N=b._asyncToGenerator(function*(M,L){var J=this.errorContext;J.errorUnsupportedIf(!this.json.accessors,"Accessors missing.");M=this.json.accessors[M];J.errorUnsupportedIf(null==(null==M?void 0:M.bufferView),"Some accessor does not specify a bufferView.");J.errorUnsupportedIf(M.type in
[v.AttributeType.MAT2,v.AttributeType.MAT3,v.AttributeType.MAT4],`AttributeType ${M.type} is not supported`);J=this.json.bufferViews[M.bufferView];L=yield this.getBuffer(J.buffer,L);const H=E[M.type],I=F[M.componentType],O=H*I,Q=J.byteStride||O;return{raw:L.buffer,byteStride:Q,byteOffset:L.byteOffset+(J.byteOffset||0)+(M.byteOffset||0),entryCount:M.count,isDenselyPacked:Q===O,componentCount:H,componentByteSize:I,componentType:M.componentType,min:M.min,max:M.max,normalized:!!M.normalized}});return function(M,
L){return N.apply(this,arguments)}}();K.getIndexData=function(){var N=b._asyncToGenerator(function*(M,L){if(null==M.indices)return null;M=yield this.getAccessor(M.indices,L);if(M.isDenselyPacked)switch(M.componentType){case x.DataType.UNSIGNED_BYTE:return new Uint8Array(M.raw,M.byteOffset,M.entryCount);case x.DataType.UNSIGNED_SHORT:return new Uint16Array(M.raw,M.byteOffset,M.entryCount);case x.DataType.UNSIGNED_INT:return new Uint32Array(M.raw,M.byteOffset,M.entryCount)}else switch(M.componentType){case x.DataType.UNSIGNED_BYTE:return e.makeDense(this._wrapAccessor(d.BufferViewUint8,
M));case x.DataType.UNSIGNED_SHORT:return e.makeDense(this._wrapAccessor(d.BufferViewUint16,M));case x.DataType.UNSIGNED_INT:return e.makeDense(this._wrapAccessor(d.BufferViewUint32,M))}});return function(M,L){return N.apply(this,arguments)}}();K.getPositionData=function(){var N=b._asyncToGenerator(function*(M,L){const J=this.errorContext;J.errorUnsupportedIf(null==M.attributes.POSITION,"No POSITION vertex data found.");M=yield this.getAccessor(M.attributes.POSITION,L);J.errorUnsupportedIf(M.componentType!==
x.DataType.FLOAT,"Expected type FLOAT for POSITION vertex attribute, but found "+G[M.componentType]);J.errorUnsupportedIf(3!==M.componentCount,"POSITION vertex attribute must have 3 components, but found "+M.componentCount.toFixed());return this._wrapAccessor(d.BufferViewVec3f,M)});return function(M,L){return N.apply(this,arguments)}}();K.getNormalData=function(){var N=b._asyncToGenerator(function*(M,L){const J=this.errorContext;J.assert(null!=M.attributes.NORMAL,"No NORMAL vertex data found.");M=
yield this.getAccessor(M.attributes.NORMAL,L);J.errorUnsupportedIf(M.componentType!==x.DataType.FLOAT,"Expected type FLOAT for NORMAL vertex attribute, but found "+G[M.componentType]);J.errorUnsupportedIf(3!==M.componentCount,"NORMAL vertex attribute must have 3 components, but found "+M.componentCount.toFixed());return this._wrapAccessor(d.BufferViewVec3f,M)});return function(M,L){return N.apply(this,arguments)}}();K.getTangentData=function(){var N=b._asyncToGenerator(function*(M,L){const J=this.errorContext;
J.assert(null!=M.attributes.TANGENT,"No TANGENT vertex data found.");M=yield this.getAccessor(M.attributes.TANGENT,L);J.errorUnsupportedIf(M.componentType!==x.DataType.FLOAT,"Expected type FLOAT for TANGENT vertex attribute, but found "+G[M.componentType]);J.errorUnsupportedIf(4!==M.componentCount,"TANGENT vertex attribute must have 4 components, but found "+M.componentCount.toFixed());return new d.BufferViewVec4f(M.raw,M.byteOffset,M.byteStride,M.byteOffset+M.byteStride*M.entryCount)});return function(M,
L){return N.apply(this,arguments)}}();K.getTextureCoordinates=function(){var N=b._asyncToGenerator(function*(M,L){const J=this.errorContext;J.assert(null!=M.attributes.TEXCOORD_0,"No TEXCOORD_0 vertex data found.");M=yield this.getAccessor(M.attributes.TEXCOORD_0,L);J.errorUnsupportedIf(2!==M.componentCount,"TEXCOORD_0 vertex attribute must have 2 components, but found "+M.componentCount.toFixed());if(M.componentType===x.DataType.FLOAT)return this._wrapAccessor(d.BufferViewVec2f,M);J.errorUnsupportedIf(!M.normalized,
"Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return B(M)});return function(M,L){return N.apply(this,arguments)}}();K.getVertexColors=function(){var N=b._asyncToGenerator(function*(M,L){const J=this.errorContext;J.assert(null!=M.attributes.COLOR_0,"No COLOR_0 vertex data found.");M=yield this.getAccessor(M.attributes.COLOR_0,L);J.errorUnsupportedIf(4!==M.componentCount&&3!==M.componentCount,"COLOR_0 attribute must have 3 or 4 components, but found "+M.componentCount.toFixed());
if(4===M.componentCount){if(M.componentType===x.DataType.FLOAT)return this._wrapAccessor(d.BufferViewVec4f,M);if(M.componentType===x.DataType.UNSIGNED_BYTE)return this._wrapAccessor(d.BufferViewVec4u8,M);if(M.componentType===x.DataType.UNSIGNED_SHORT)return this._wrapAccessor(d.BufferViewVec4u16,M)}else if(3===M.componentCount){if(M.componentType===x.DataType.FLOAT)return this._wrapAccessor(d.BufferViewVec3f,M);if(M.componentType===x.DataType.UNSIGNED_BYTE)return this._wrapAccessor(d.BufferViewVec3u8,
M);if(M.componentType===x.DataType.UNSIGNED_SHORT)return this._wrapAccessor(d.BufferViewVec3u16,M)}J.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+G[M.componentType])});return function(M,L){return N.apply(this,arguments)}}();K.hasPositions=function(N){return void 0!==N.attributes.POSITION};K.hasNormals=function(N){return void 0!==N.attributes.NORMAL};K.hasVertexColors=function(N){return void 0!==N.attributes.COLOR_0};K.hasTextureCoordinates=function(N){return void 0!==N.attributes.TEXCOORD_0};
K.hasTangents=function(N){return void 0!==N.attributes.TANGENT};K.getMaterial=function(){var N=b._asyncToGenerator(function*(M,L,J){var H=this.materialCache.get(M.material);if(!H){H=null!=M.material?w.material(this.json.materials[M.material]):w.material();const I=H.pbrMetallicRoughness,O=this.hasVertexColors(M),Q=this.getTexture(I.baseColorTexture,L),S=this.getTexture(H.normalTexture,L),T=J?this.getTexture(H.occlusionTexture,L):null,U=J?this.getTexture(H.emissiveTexture,L):null;L=J?this.getTexture(I.metallicRoughnessTexture,
L):null;M=null!=M.material?M.material:-1;H={alphaMode:H.alphaMode,alphaCutoff:H.alphaCutoff,color:I.baseColorFactor,doubleSided:!!H.doubleSided,colorTexture:yield Q,normalTexture:yield S,name:H.name,id:M,occlusionTexture:yield T,emissiveTexture:yield U,emissiveFactor:H.emissiveFactor,metallicFactor:I.metallicFactor,roughnessFactor:I.roughnessFactor,metallicRoughnessTexture:yield L,hasVertexColors:O,ESRI_externalColorMixMode:H.extras.ESRI_externalColorMixMode}}return H});return function(M,L,J){return N.apply(this,
arguments)}}();K.getTexture=function(){var N=b._asyncToGenerator(function*(M,L){if(!M)return null;this.errorContext.errorUnsupportedIf(0!==(M.texCoord||0),"Only TEXCOORD with index 0 is supported.");const J=M.index,H=this.errorContext;M=this.json.textures[J];const I=w.textureSampler(null!=M.sampler?this.json.samplers[M.sampler]:{});H.errorUnsupportedIf(null==M.source,"Source is expected to be defined for a texture.");const O=this.json.images[M.source],Q=yield this._loadTextureImageData(J,M,L);return m.getOrCreateMapValue(this.textureCache,
J,()=>{const S=U=>33071===U||33648===U||10497===U,T=U=>{H.error(`Unexpected TextureSampler WrapMode: ${U}. Using default REPEAT(10497).`);return 10497};return{data:Q,wrapS:S(I.wrapS)?I.wrapS:T(I.wrapS),wrapT:S(I.wrapT)?I.wrapT:T(I.wrapT),minFilter:I.minFilter,name:O.name,id:J}})});return function(M,L){return N.apply(this,arguments)}}();K.getNodeTransform=function(N){if(void 0===N)return y;var M=this.nodeTransformCache.get(N);if(!M){M=this.getNodeTransform(this._getNodeParent(N));const L=this.json.nodes[N];
if(L.matrix)M=n.multiply(g.create(),M,L.matrix);else if(L.translation||L.rotation||L.scale)M=g.clone(M),L.translation&&n.translate(M,M,L.translation),L.rotation&&(D[3]=k.getAxisAngle(D,L.rotation),n.rotate(M,M,D[3],D)),L.scale&&n.scale(M,M,L.scale);this.nodeTransformCache.set(N,M)}return M};K._wrapAccessor=function(N,M){return new N(M.raw,M.byteOffset,M.byteStride,M.byteOffset+M.byteStride*(M.entryCount-1)+M.componentByteSize*M.componentCount)};K._resolveUri=function(N){return l.makeAbsolute(N,this.baseUri)};
K._getNodeParent=function(N){return this.nodeParentMap.get(N)};K._checkVersionSupported=function(){const N=r.Version.parse(this.json.asset.version,"glTF");p.validate(N)};K._checkRequiredExtensionsSupported=function(){const N=this.json,M=this.errorContext;N.extensionsRequired&&0!==N.extensionsRequired.length&&M.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+N.extensionsRequired.join(", "))};K._computeNodeParents=function(){this.json.nodes.forEach((N,
M)=>{N.children&&N.children.forEach(L=>{this.nodeParentMap.set(L,M)})})};K._loadTextureImageData=function(){var N=b._asyncToGenerator(function*(M,L,J){const H=this.textureLoaders.get(M);if(H)return H;L=this._createTextureLoader(L,J);this.textureLoaders.set(M,L);return L});return function(M,L,J){return N.apply(this,arguments)}}();K._createTextureLoader=function(){var N=b._asyncToGenerator(function*(M,L){M=this.json.images[M.source];if(M.uri)return this.context.loadImage(this._resolveUri(M.uri),L);
const J=this.errorContext;J.errorUnsupportedIf(null==M.bufferView,"Image bufferView must be defined.");J.errorUnsupportedIf(null==M.mimeType,"Image mimeType must be defined.");const H=this.json.bufferViews[M.bufferView];L=yield this.getBuffer(H.buffer,L);J.errorUnsupportedIf(null!=H.byteStride,"byteStride not supported for image buffer");return C(new Uint8Array(L.buffer,L.byteOffset+(H.byteOffset||0),H.byteLength),M.mimeType)});return function(M,L){return N.apply(this,arguments)}}();return P}();const p=
new r.Version(2,0,"glTF"),y=n.fromXRotation(g.create(),Math.PI/2),D=f.create(),E={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},F={[x.DataType.BYTE]:1,[x.DataType.UNSIGNED_BYTE]:1,[x.DataType.SHORT]:2,[x.DataType.UNSIGNED_SHORT]:2,[x.DataType.FLOAT]:4,[x.DataType.UNSIGNED_INT]:4},G={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"};a.Resource=A;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/Version":function(){define(["exports",
"./Error"],function(a,b){let c=function(){function m(r,n,g=""){this.major=r;this.minor=n;this._context=g}var l=m.prototype;l.lessThan=function(r,n){return this.major<r||r===this.major&&this.minor<n};l.since=function(r,n){return!this.lessThan(r,n)};l.validate=function(r){if(this.major!==r.major)throw new b((this._context&&this._context+":")+"unsupported-version",`Required major ${this._context&&this._context+" "}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:r});
};l.clone=function(){return new m(this.major,this.minor,this._context)};m.parse=function(r,n=""){const [g,k]=r.split(".");var f=/^\s*\d+\s*$/;if(!g||!g.match||!g.match(f))throw new b((n&&n+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:r});if(!k||!k.match||!k.match(f))throw new b((n&&n+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:r});r=parseInt(g,10);f=parseInt(k,10);return new m(r,f,n)};return m}();a.Version=
c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/glTF/internal/BinaryStreamReader":function(){define(["exports"],function(a){let b=function(){function c(l){this.data=l;this.offset4=0;this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}var m=c.prototype;m.readUint32=function(){const l=this.offset4;this.offset4+=1;return this.dataUint32[l]};m.readUint8Array=function(l){const r=4*this.offset4;this.offset4+=l/4;return new Uint8Array(this.data,
r,l)};m.remainingBytes=function(){return this.data.byteLength-4*this.offset4};return c}();a.BinaryStreamReader=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/glTF/internal/enums":function(){define(["exports"],function(a){a.AttributeType=void 0;(function(b){b.SCALAR="SCALAR";b.VEC2="VEC2";b.VEC3="VEC3";b.VEC4="VEC4";b.MAT2="MAT2";b.MAT3="MAT3";b.MAT4="MAT4"})(a.AttributeType||(a.AttributeType={}));a.BufferViewTarget=void 0;(function(b){b[b.ARRAY_BUFFER=
34962]="ARRAY_BUFFER";b[b.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(a.BufferViewTarget||(a.BufferViewTarget={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/glTF/internal/fillDefaults":function(){define(["exports","../../../../core/compilerUtils","../../../webgl/enums"],function(a,b,c){const m={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},l={pbrMetallicRoughness:m,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,
doubleSided:!1},r={ESRI_externalColorMixMode:"tint"},n={magFilter:c.TextureSamplingMode.LINEAR,minFilter:c.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,wrapS:c.TextureWrapMode.REPEAT,wrapT:c.TextureWrapMode.REPEAT};a.material=(g={})=>{const k={...m,...g.pbrMetallicRoughness};var f={...r,...g.extras};switch(f.ESRI_externalColorMixMode){case "multiply":case "tint":case "ignore":case "replace":break;default:b.neverReached(f.ESRI_externalColorMixMode),f.ESRI_externalColorMixMode="tint"}return{...l,...g,pbrMetallicRoughness:k,
extras:f}};a.textureSampler=g=>({...n,...g});Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/glTF/internal/pathUtils":function(){define(["exports"],function(a){a.splitURI=function(b){let c,m;b.replace(/^(.*\/)?([^/]*)$/,(l,r,n)=>{c=r||"";m=n||"";return""});return{dirPart:c,filePart:m}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/glTF/internal/indexUtils":function(){define(["exports",
"../../../../core/typedArrayUtil","../../webgl-engine/lib/geometryDataUtils"],function(a,b,c){a.triangleFanToTriangles=function(m){var l="number"===typeof m?m:m.length;if(3>l)return new Uint16Array(0);l-=2;const r=65536>=l?new Uint16Array(3*l):new Uint32Array(3*l);if("number"===typeof m){m=0;for(var n=0;n<l;++n)r[m++]=0,r[m++]=n+1,r[m++]=n+2;return r}{n=m[0];let g=m[1],k=0;for(let f=0;f<l;++f){const d=m[f+2];r[k++]=n;r[k++]=g;g=r[k++]=d}return r}};a.triangleStripToTriangles=function(m){var l="number"===
typeof m?m:m.length;if(3>l)return new Uint16Array(0);l-=2;const r=65536>=l?new Uint16Array(3*l):new Uint32Array(3*l);if("number"===typeof m){m=0;for(var n=0;n<l;n+=1)0===n%2?(r[m++]=n,r[m++]=n+1):(r[m++]=n+1,r[m++]=n),r[m++]=n+2}else{n=0;for(let d=0;d<l;d+=1)if(0===d%2){var g=m[d],k=m[d+1],f=m[d+2];r[n++]=g;r[n++]=k;r[n++]=f}else g=m[d+1],k=m[d],f=m[d+2],r[n++]=g,r[n++]=k,r[n++]=f}return r};a.trianglesToTriangles=function(m,l=c.generateDefaultIndexArray){return"number"===typeof m?l(m):b.isUint16Array(m)||
b.isUint8Array(m)?new Uint32Array(m):m};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/wosrLoader":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../request ../../../../core/asyncUtils ../../../../core/Error ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/Version ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../support/requestImageUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial ../../../webgl/enums".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x){function B(){B=b._asyncToGenerator(function*(P,K){P=yield q(P,K);K=yield y(P.textureDefinitions,K);return{resource:P,textures:K}});return B.apply(this,arguments)}function q(P,K){return u.apply(this,arguments)}function u(){u=b._asyncToGenerator(function*(P,K){const N=n.isSome(K)&&K.streamDataRequester;if(N)return C(P,N,K);P=yield m.result(c(P,n.unwrap(K)));if(!0===P.ok)return P.value.data;g.throwIfAbortError(P.error);A(P.error)});return u.apply(this,arguments)}
function C(P,K,N){return z.apply(this,arguments)}function z(){z=b._asyncToGenerator(function*(P,K,N){P=yield m.result(K.request(P,"json",N));if(!0===P.ok)return P.value;g.throwIfAbortError(P.error);A(P.error.details.url)});return z.apply(this,arguments)}function A(P){throw new l("",`Request for object resource failed: ${P}`);}function p(P){const K=d.empty();P.forEach(N=>{N=N.boundingInfo;n.isSome(N)&&(d.expandWithVec3(K,N.getBBMin()),d.expandWithVec3(K,N.getBBMax()))});return K}function y(P,K){return D.apply(this,
arguments)}function D(){D=b._asyncToGenerator(function*(P,K){const N=[];for(const J in P){var M=P[J],L=M.images[0].data;if(!L){F.warn("Externally referenced texture data is not yet supported");continue}L=M.encoding+";base64,"+L;const H="/textureDefinitions/"+J,I="rgba"===M.channels?M.alphaChannelUsage||"transparency":"none",O={noUnpackFlip:!0,wrap:{s:x.TextureWrapMode.REPEAT,t:x.TextureWrapMode.REPEAT},preMultiplyAlpha:E(I)!==h.AlphaDiscardMode.Opaque};M=n.isSome(K)&&K.disableTextures?Promise.resolve(null):
e.requestImage(L,K);N.push(M.then(Q=>({refId:H,image:Q,params:O,alphaChannelUsage:I})))}P=yield Promise.all(N);K={};for(const J of P)K[J.refId]=J;return K});return D.apply(this,arguments)}function E(P){switch(P){case "mask":return h.AlphaDiscardMode.Mask;case "maskAndTransparency":return h.AlphaDiscardMode.MaskBlend;case "none":return h.AlphaDiscardMode.Opaque;case "transparency":return h.AlphaDiscardMode.Blend;default:return h.AlphaDiscardMode.Blend}}const F=r.getLogger("esri.views.3d.layers.graphics.objectResourceUtils"),
G=new k.Version(1,2,"wosr");a.createTextureResources=y;a.load=function(P,K){return B.apply(this,arguments)};a.processLoadResult=function(P,K){const N=[],M=[],L=[],J=[],H=P.resource;var I=k.Version.parse(H.version||"1.0","wosr");G.validate(I);I=H.model.name;const O=H.model.geometries,Q=H.materialDefinitions;P=P.textures;let S=0;const T=new Map;for(let ha=0;ha<O.length;ha++){var U=O[ha],aa=U,W=aa.params,R=W.topology;var V=!0;W.vertexAttributes||(F.warn("Geometry must specify vertex attributes"),V=!1);
switch(W.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:R=W.faces;if(!R)F.warn("Indexed geometries must specify faces"),V=!1;else if(W.vertexAttributes)for(const ia in W.vertexAttributes)(W=R[ia])&&W.values?(null!=W.valueType&&"UInt32"!==W.valueType&&(F.warn(`Unsupported indexed geometry indices type '${W.valueType}', only UInt32 is currently supported`),V=!1),null!=W.valuesPerElement&&1!==W.valuesPerElement&&(F.warn(`Unsupported indexed geometry values per element '${W.valuesPerElement}', only 1 is currently supported`),
V=!1)):(F.warn(`Indexed geometry does not specify face indices for '${ia}' attribute`),V=!1);break;default:F.warn(`Unsupported topology '${R}'`),V=!1}aa.params.material||(F.warn("Geometry requires material"),V=!1);aa=aa.params.vertexAttributes;for(const ia in aa)aa[ia].values||(F.warn("Geometries with externally defined attributes are not yet supported"),V=!1);if(V){V=U.params;V={id:1,material:V.material,texture:V.texture,region:V.texture};W=U.params.vertexAttributes;aa=[];for(const ia in W)R=W[ia],
aa.push([ia,{data:R.values,size:R.valuesPerElement,exclusive:!0}]);W=[];if("PerAttributeArray"!==U.params.topology){U=U.params.faces;for(const ia in U)W.push([ia,new Uint32Array(U[ia].values)])}if((U=P&&P[V.texture])&&!T.has(V.texture)){const {image:ia,params:ka}=U;R=new w.Texture(ia,ka);J.push(R);T.set(V.texture,R)}R=(R=T.get(V.texture))?R.id:void 0;var da=L[V.material]?L[V.material][V.texture]:null;if(!da){da=V.material.substring(V.material.lastIndexOf("/")+1);da=Q[da].params;1===da.transparency&&
(da.transparency=0);var ca=U&&U.alphaChannelUsage;ca=0<da.transparency||"transparency"===ca||"maskAndTransparency"===ca;const ia=U?E(U.alphaChannelUsage):void 0;U={ambient:f.fromArray(da.diffuse),diffuse:f.fromArray(da.diffuse),opacity:1-(da.transparency||0),transparent:ca,textureAlphaMode:ia,textureAlphaCutoff:.33,textureId:R,initTextureTransparent:!0,doubleSided:!0,cullFace:h.CullFaceOptions.None,colorMixMode:da.externalColorMixMode||"tint",textureAlphaPremultiplied:U?!!U.params.preMultiplyAlpha:
!1};n.isSome(K)&&K.materialParamsMixin&&Object.assign(U,K.materialParamsMixin);da=new t.DefaultMaterial(U);L[V.material]||(L[V.material]={});L[V.material][V.texture]=da}M.push(da);V=new v.Geometry(aa,W);S+=W.position?W.position.length:0;N.push(V)}}return{name:I,stageResources:{textures:J,materials:M,geometries:N},pivotOffset:H.model.pivotOffset,boundingBox:p(N),numberOfVertices:S,lodThreshold:null}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial_COLOR_GAMMA":function(){define(["exports"],
function(a){a.COLOR_GAMMA=2.1;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/vec4f64 ../../../support/debugFlags ../../../support/buffer/glUtil ../Camera ../DefaultVertexAttributeLocations ../IntersectorInterfaces ../Octree ../RenderPass ../RenderSlot ../Util ./InstanceData ./InstanceOctree ./LevelSelector ./LodLevel ./RenderInstanceData ../../materials/DefaultMaterial ../../materials/internal/MaterialUtil ../../materials/renderers/utils ../../shaders/DefaultMaterialTechnique ../../../../webgl/Util".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E){function F(O,Q,S){const T=O.allocateHead();O=O.view;y.encodeDoubleVec3(Q.modelOrigin,S,O.modelOriginHi,O.modelOriginLo,T);O.model.copyFrom(T,Q.model,S);O.modelNormal.copyFrom(T,Q.modelNormal,S);Q.color&&O.color&&O.color.copyFrom(T,Q.color,S);Q.featureAttribute&&O.featureAttribute&&O.featureAttribute.copyFrom(T,Q.featureAttribute,S)}let G=O=>{const Q=O.baseBoundingSphere.radius;O=O.levels.map(S=>S.minScreenSpaceRadius);return new u.LevelSelector(Q,
O)},P=function(){function O(S,T,U,aa){this.type=h.IntersectorType.LOD;this.isGround=!1;this._levels=[];this._defaultRenderInstanceData=[];this._highlightRenderInstanceData=[];this._instanceIndex=0;this._slicePlane=!1;this._enableLevelSelection=!0;this._lastCamera=new d.Camera;this._updateCyclesWithStaticCamera=-1;this._needFullCycle=!1;this.slots=[t.RenderSlot.OPAQUE_MATERIAL,t.RenderSlot.TRANSPARENT_MATERIAL];this.canRender=!0;this._symbol=S;this._optionalFields=T;this._metadata=U;this._instanceBufferLayout=
A.getInstanceBufferLayout({instancedDoublePrecision:!0,instanced:T});this._glInstanceBufferLayout=f.glLayout(this._instanceBufferLayout,1);this._instanceData=new B.InstanceData(this._optionalFields,aa);this._instanceData.on("instance-added",()=>this._requestUpdateCycle());this._instanceData.on("instance-removed",()=>this._requestUpdateCycle());this._instanceData.on("instance-transform-changed",W=>{this._requestUpdateCycle();this._metadata.notifyGraphicGeometryChanged(W.index)});this._instanceData.on("instance-visibility-changed",
W=>{this._requestUpdateCycle(!0);this._metadata.notifyGraphicVisibilityChanged(W.index)});this._instanceData.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0));this._enableLevelSelection=1<this._symbol.levels.length}var Q=O.prototype;Q.initializeRenderContext=function(){var S=b._asyncToGenerator(function*(T,U){this._context=T;const aa=T.renderContext.rctx,W=yield Promise.allSettled(this._symbol.levels.map(V=>{this._defaultRenderInstanceData.push(new z.RenderInstanceData(aa,this._instanceBufferLayout));
this._highlightRenderInstanceData.push(new z.RenderInstanceData(aa,this._instanceBufferLayout));return C.LodLevel.create(T,V,U)})),R=W.map(V=>"fulfilled"===V.status?V.value:null).filter(V=>V);if(m.isAborted(U)||R.length!==W.length){R.forEach(V=>V.destroy());m.throwIfAborted(U);for(const V of W)if("rejected"===V.status)throw V.reason;}this._levels=R;this._levelSelector=G(this)});return function(T,U){return S.apply(this,arguments)}}();Q.uninitializeRenderContext=function(){this._invalidateOctree();
this._levels.forEach(S=>S.destroy());this._defaultRenderInstanceData.forEach(S=>S.destroy());this._highlightRenderInstanceData.forEach(S=>S.destroy())};Q.prepareRender=function(S){if(!k.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){var T=S.bindParameters.contentCamera.equals(this._lastCamera);this._lastCamera.copyFrom(S.bindParameters.contentCamera);T||this._requestUpdateCycle()}T=this._needFullCycle?this._instanceData.size:2E3;this._needFullCycle=!1;this._updateInstances(S.bindParameters.contentCamera,
T);this.needsUpdates&&this._context.requestRender()}};Q.render=function(S){if(this.baseMaterial.isVisible()&&this.baseMaterial.isVisibleInPass(S.pass)){S.rctx.bindVAO();var T=S.pass!==w.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT;S.pass!==w.RenderPass.MATERIAL_HIGHLIGHT&&S.pass!==w.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT&&this._renderComponents(S,this._defaultRenderInstanceData);T&&this._renderComponents(S,this._highlightRenderInstanceData)}};Q.intersect=function(S,T,U,aa){if(this.baseMaterial.isVisible()){var W=
n.create();r.subtract(W,aa,U);var R=V=>{this._instanceData.getCombinedModelTransform(V,M);S.transform.set(M);r.transformMat4(L,U,S.transform.inverse);r.transformMat4(J,aa,S.transform.inverse);const da=this._instanceData.getState(V),ca=this._instanceData.getLodLevel(V),ha=this._levels.length;x.assert(da&B.StateFlags.ACTIVE,"invalid instance state");x.assert(0<=ca&&ca<ha,"invaid lod level");this._levels[ca].intersect(S,T,L,J,V,this._metadata,ha)};this.baseMaterial.parameters.verticalOffset?this.octree.forEach(R):
this.octree.forEachAlongRay(U,W,R)}};Q.queryDepthRange=function(S){return this._queryDepthRangeOctree(S)};Q.notifyShaderTransformationChanged=function(){this._invalidateOctree()};Q._requestUpdateCycle=function(S=!1){this._updateCyclesWithStaticCamera=-1;S&&(this._needFullCycle=!0);this.needsUpdates&&this._context.requestRender()};Q._invalidateOctree=function(){this._octree&&(this._octree.destroy(),this._octree=null)};Q._buildOctree=function(){const S=new q.InstanceOctree(this._instanceData,this.baseBoundingSphere);
var T=this._instanceData;T=T.view?T.view.state:null;for(let U=0;U<this._instanceData.capacity;++U)T.get(U)&B.StateFlags.ACTIVE&&S.addInstance(U);return S};Q._queryDepthRangeOctree=function(S){var T=S.eye;const U=S.viewForward;var aa=this.octree.findClosest(U,v.DepthOrder.FRONT_TO_BACK,S.frustum);const W=this.octree.findClosest(U,v.DepthOrder.BACK_TO_FRONT,S.frustum);return null!=aa&&null!=W?(this._instanceData.view.boundingSphere.getVec(aa,N),r.subtract(N,N,T),aa=r.dot(N,U)-N[3],this._instanceData.view.boundingSphere.getVec(W,
N),r.subtract(N,N,T),T=r.dot(N,U)+N[3],{near:Math.max(S.near,aa),far:Math.min(S.far,T)}):{near:Infinity,far:-Infinity}};Q._startUpdateCycle=function(){this._updateCyclesWithStaticCamera++;this._defaultRenderInstanceData.forEach(S=>{S.startUpdateCylce()});this._highlightRenderInstanceData.forEach(S=>{S.startUpdateCylce()});this.needsUpdates&&this._context.requestRender()};Q._updateInstances=function(S,T){const U=this._enableLevelSelection,aa=this._levelSelector;aa.updateCamera(S);this._defaultRenderInstanceData.forEach(ha=>
{ha.beginUpdate()});this._highlightRenderInstanceData.forEach(ha=>{ha.beginUpdate()});S=this._instanceData;const W=this._instanceData.view,R=S.capacity;let V=this._instanceIndex;T=Math.min(S.size,T);for(let ha=0;ha<T;++ha){0===V&&this._startUpdateCycle();const ia=W.state.get(V);var da=0;if(ia&B.StateFlags.ALLOCATED){var ca=W.lodLevel.get(V);ia&B.StateFlags.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[ca].freeTail();ia&B.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[ca].freeTail();
ia&B.StateFlags.REMOVE?S.freeInstance(V):ia&B.StateFlags.VISIBLE?(ca=0,U&&(W.modelOrigin.getVec(V,K),ca=aa.selectLevel(K,S.getCombinedMedianScaleFactor(V))),da=ia&~(B.StateFlags.ACTIVE|B.StateFlags.TRANSFORM_CHANGED),0<=ca&&(ia&B.StateFlags.HIGHLIGHT?(F(this._highlightRenderInstanceData[ca],W,V),da|=B.StateFlags.HIGHLIGHT_ACTIVE):(F(this._defaultRenderInstanceData[ca],W,V),da|=B.StateFlags.DEFAULT_ACTIVE)),W.state.set(V,da),W.lodLevel.set(V,ca)):(da=ia&~(B.StateFlags.ACTIVE|B.StateFlags.TRANSFORM_CHANGED),
W.state.set(V,da));this._octree&&(ca=!!(ia&B.StateFlags.ACTIVE),da=!!(da&B.StateFlags.ACTIVE),!ca&&da?this._octree.addInstance(V):ca&&!da?this._octree.removeInstance(V):ca&&da&&ia&B.StateFlags.TRANSFORM_CHANGED&&(this._octree.removeInstance(V),this._octree.addInstance(V)));V=(V+1)%R}else V=(V+1)%R,T++}this._instanceIndex=V;this._defaultRenderInstanceData.forEach(ha=>{ha.endUpdate()});this._highlightRenderInstanceData.forEach(ha=>{ha.endUpdate()})};Q._renderComponents=function(S,T){this.levels.forEach((U,
aa)=>{U.components.forEach(W=>{this._renderComponent(S,T[aa],W,aa)})})};Q._renderComponent=function(S,T,U,aa){var W=S.bindParameters;if(0!==T.size&&U.material.requiresSlot(W.slot)){var {rctx:R,pass:V}=S,da=U.glMaterials.load(R,V);if(!c.isNone(da)){var ca=da.beginSlot(W);da=R.bindTechnique(ca,U.material.parameters,W);R.bindVAO(U.vao);ca.ensureAttributeLocations(U.vao);ca.bindDraw(I,W);k.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&S.pass===w.RenderPass.MATERIAL&&(da.setUniform4fv("externalColor",H[Math.min(aa,
H.length-1)]),da.setUniform1i("colorMixMode",p.colorMixModes.replace));var ha=R.capabilities.instancing;S=T.capacity;aa=T.headIndex;W=T.tailIndex;da=T.firstIndex;var ia=this._glInstanceBufferLayout,ka=(la,Y)=>{E.bindVertexBufferLayout(R,e.Default3D,T.buffer,ia,la);ha.drawArraysInstanced(ca.primitiveType,0,U.vertexCount,Y-la);E.unbindVertexBufferLayout(R,e.Default3D,T.buffer,ia)};U.material.parameters.transparent&&null!=da?aa>W?(x.assert(da>=W&&da<=aa,"invalid firstIndex"),ka(da,aa),ka(W,da)):aa<W&&
(da<=aa?(x.assert(0<=da&&da<=aa,"invalid firstIndex"),ka(da,aa),ka(W,S),ka(0,da)):(x.assert(da>=W&&da<=S,"invalid firstIndex"),ka(da,S),ka(0,aa),ka(W,da))):aa>W?ka(W,aa):aa<W&&(ka(0,aa),ka(W,S));R.bindVAO(null)}}};b._createClass(O,[{key:"levels",get:function(){return this._levels}},{key:"baseBoundingBox",get:function(){return this._levels[this._levels.length-1].boundingBox}},{key:"baseBoundingSphere",get:function(){return this._levels[this._levels.length-1].boundingSphere}},{key:"baseMaterial",get:function(){return this._levels[this._levels.length-
1].components[0].material}},{key:"slicePlaneEnabled",get:function(){return this._slicePlane},set:function(S){this._slicePlane=S}},{key:"layerUid",get:function(){return this._metadata.layerUid}},{key:"instanceData",get:function(){return this._instanceData}},{key:"memoryUsage",get:function(){const S={cpu:0,gpu:0};this._defaultRenderInstanceData.forEach(T=>{T=T.memoryUsage;S.cpu+=T.cpu;S.gpu+=T.gpu});this._highlightRenderInstanceData.forEach(T=>{T=T.memoryUsage;S.cpu+=T.cpu;S.gpu+=T.gpu});return S}},
{key:"renderStats",get:function(){const S=this._instanceData.size,T=[];this._levels.forEach((U,aa)=>{aa=this._defaultRenderInstanceData[aa].size+this._highlightRenderInstanceData[aa].size;U=U.triangleCount;T.push({renderedInstances:aa,renderedTriangles:aa*U,trianglesPerInstance:U})});return{totalInstances:S,renderedInstances:T.reduce((U,aa)=>U+aa.renderedInstances,0),renderedTriangles:T.reduce((U,aa)=>U+aa.renderedTriangles,0),levels:T}}},{key:"needsTransparentPass",get:function(){return this._levels.some(S=>
S.components.some(T=>T.material.requiresSlot(t.RenderSlot.TRANSPARENT_MATERIAL)))}},{key:"needsHighlight",get:function(){return this._highlightRenderInstanceData.some(S=>0<S.size)}},{key:"needsUpdates",get:function(){return 0<this._instanceData.size&&1>this._updateCyclesWithStaticCamera}},{key:"octree",get:function(){this._octree||(this._octree=this._buildOctree());return this._octree}}]);return O}();const K=n.create(),N=g.create(),M=l.create(),L=n.create(),J=n.create(),H=[[1,0,1,1],[0,0,1,1],[0,
1,0,1],[1,1,0,1],[1,0,0,1]],I=new D.DefaultMaterialDrawParameters;a.LodRenderer=P;a.setLevelSelectorFactory=function(O){G=O};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Evented ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/buffer/BufferView ../../../support/mathUtils ../../../support/buffer/InterleavedLayout ../Util ../VertexAttribute".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){a.StateFlags=void 0;(function(u){u[u.ALLOCATED=1]="ALLOCATED";u[u.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE";u[u.VISIBLE=4]="VISIBLE";u[u.HIGHLIGHT=8]="HIGHLIGHT";u[u.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";u[u.REMOVE=32]="REMOVE";u[u.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED";u[u.ACTIVE=18]="ACTIVE"})(a.StateFlags||(a.StateFlags={}));let w=function(u){this.localTransform=u.getField(v.VertexAttribute.LOCALTRANSFORM,f.BufferViewMat4f64);this.globalTransform=u.getField(v.VertexAttribute.GLOBALTRANSFORM,
f.BufferViewMat4f64);this.modelOrigin=u.getField(v.VertexAttribute.MODELORIGIN,f.BufferViewVec3f64);this.model=u.getField(v.VertexAttribute.MODEL,f.BufferViewMat3f);this.modelNormal=u.getField(v.VertexAttribute.MODELNORMAL,f.BufferViewMat3f);this.modelScaleFactors=u.getField(v.VertexAttribute.MODELSCALEFACTORS,f.BufferViewVec2f);this.boundingSphere=u.getField(v.VertexAttribute.BOUNDINGSPHERE,f.BufferViewVec4f64);this.color=u.getField(v.VertexAttribute.COLOR,f.BufferViewVec4f);this.featureAttribute=
u.getField(v.VertexAttribute.FEATUREATTRIBUTE,f.BufferViewVec4f);this.state=u.getField(v.VertexAttribute.STATE,f.BufferViewUint8);this.lodLevel=u.getField(v.VertexAttribute.LODLEVEL,f.BufferViewUint8)};c=function(u){function C(A,p){var y=u.call(this)||this;y._capacity=0;y._size=0;y._next=0;{let D=e.newLayout().mat4f64(v.VertexAttribute.LOCALTRANSFORM).mat4f64(v.VertexAttribute.GLOBALTRANSFORM).vec4f64(v.VertexAttribute.BOUNDINGSPHERE).vec3f64(v.VertexAttribute.MODELORIGIN).mat3f(v.VertexAttribute.MODEL).mat3f(v.VertexAttribute.MODELNORMAL).vec2f(v.VertexAttribute.MODELSCALEFACTORS);
A.includes("color")&&(D=D.vec4f(v.VertexAttribute.COLOR));A.includes("featureAttribute")&&(D=D.vec4f(v.VertexAttribute.FEATUREATTRIBUTE));A=D=D.u8(v.VertexAttribute.STATE).u8(v.VertexAttribute.LODLEVEL).alignTo(8)}y._layout=A;y._shaderTransformation=p;return y}b._inheritsLoose(C,u);var z=C.prototype;z.addInstance=function(){this._size+1>this._capacity&&this._grow();const A=this._findSlot();this._view.state.set(A,a.StateFlags.ALLOCATED);this._size++;this.emit("instance-added",{index:A});return A};
z.removeInstance=function(A){const p=this._view.state;h.assert(0<=A&&A<this._capacity&&p.get(A)&a.StateFlags.ALLOCATED,"invalid instance handle");this._getStateFlag(A,a.StateFlags.ACTIVE)?this._setStateFlags(A,a.StateFlags.REMOVE):this.freeInstance(A);this.emit("instance-removed",{index:A})};z.freeInstance=function(A){const p=this._view.state;h.assert(0<=A&&A<this._capacity&&p.get(A)&a.StateFlags.ALLOCATED,"invalid instance handle");p.set(A,0);this._size--};z.setLocalTransform=function(A,p,y=!0){this._view.localTransform.setMat(A,
p);y&&this.updateModelTransform(A)};z.getLocalTransform=function(A,p){this._view.localTransform.getMat(A,p)};z.setGlobalTransform=function(A,p,y=!0){this._view.globalTransform.setMat(A,p);y&&this.updateModelTransform(A)};z.getGlobalTransform=function(A,p){this._view.globalTransform.getMat(A,p)};z.updateModelTransform=function(A){const p=this._view;var y=t;const D=x;p.localTransform.getMat(A,B);p.globalTransform.getMat(A,q);const E=r.multiply(q,q,B);g.set(y,E[12],E[13],E[14]);p.modelOrigin.setVec(A,
y);m.fromMat4(D,E);p.model.setMat(A,D);y=d.scaleFromMatrix(t,E);y.sort();p.modelScaleFactors.set(A,0,y[1]);p.modelScaleFactors.set(A,1,y[2]);m.invert(D,D);m.transpose(D,D);p.modelNormal.setMat(A,D);this._setStateFlags(A,a.StateFlags.TRANSFORM_CHANGED);this.emit("instance-transform-changed",{index:A})};z.getModelTransform=function(A,p){const y=this._view;y.model.getMat(A,x);y.modelOrigin.getVec(A,t);p[0]=x[0];p[1]=x[1];p[2]=x[2];p[3]=0;p[4]=x[3];p[5]=x[4];p[6]=x[5];p[7]=0;p[8]=x[6];p[9]=x[7];p[10]=
x[8];p[11]=0;p[12]=t[0];p[13]=t[1];p[14]=t[2];p[15]=1};z.applyShaderTransformation=function(A,p){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,A,p)};z.getCombinedModelTransform=function(A,p){this.getModelTransform(A,p);this._shaderTransformation&&this._shaderTransformation.applyTransform(this,A,p);return p};z.getCombinedLocalTransform=function(A,p){this._view.localTransform.getMat(A,p);this._shaderTransformation&&this._shaderTransformation.applyTransform(this,A,p);return p};
z.getCombinedMaxScaleFactor=function(A){let p=this._view.modelScaleFactors.get(A,1);this._shaderTransformation&&(A=this._shaderTransformation.scaleFactor(t,this,A),p*=Math.max(A[0],A[1],A[2]));return p};z.getCombinedMedianScaleFactor=function(A){let p=this._view.modelScaleFactors.get(A,0);this._shaderTransformation&&(A=this._shaderTransformation.scaleFactor(t,this,A),A.sort(),p*=A[1]);return p};z.getModel=function(A,p){this._view.model.getMat(A,p)};z.setFeatureAttribute=function(A,p){this._view.featureAttribute.setVec(A,
p)};z.getFeatureAttribute=function(A,p){this._view.featureAttribute.getVec(A,p)};z.setColor=function(A,p){this._view.color.setVec(A,p)};z.getColor=function(A,p){this._view.color.getVec(A,p)};z.setVisible=function(A,p){p!==this.getVisible(A)&&(this._setStateFlag(A,a.StateFlags.VISIBLE,p),this.emit("instance-visibility-changed",{index:A}))};z.getVisible=function(A){return this._getStateFlag(A,a.StateFlags.VISIBLE)};z.setHighlight=function(A,p){p!==this.getHighlight(A)&&(this._setStateFlag(A,a.StateFlags.HIGHLIGHT,
p),this.emit("instance-highlight-changed",{index:A}))};z.getHighlight=function(A){return this._getStateFlag(A,a.StateFlags.HIGHLIGHT)};z.getState=function(A){return this._view.state.get(A)};z.getLodLevel=function(A){return this._view.lodLevel.get(A)};z.countFlags=function(A){let p=0;for(let y=0;y<this._capacity;++y)this.getState(y)&A&&++p;return p};z._setStateFlags=function(A,p){const y=this._view.state;p|=y.get(A);y.set(A,p)};z._clearStateFlags=function(A,p){const y=this._view.state;p=y.get(A)&~p;
y.set(A,p)};z._setStateFlag=function(A,p,y){y?this._setStateFlags(A,p):this._clearStateFlags(A,p)};z._getStateFlag=function(A,p){return!!(this._view.state.get(A)&p)};z._grow=function(){const A=Math.max(1024,Math.floor(2*this._capacity)),p=this._layout.createBuffer(A);if(this._buffer){const y=new Uint8Array(this._buffer.buffer);(new Uint8Array(p.buffer)).set(y)}this._capacity=A;this._buffer=p;this._view=new w(this._buffer)};z._findSlot=function(){const A=this._view.state;let p=this._next;for(;A.get(p)&
a.StateFlags.ALLOCATED;)p=(p+1)%this._capacity;this._next=(p+1)%this._capacity;return p};b._createClass(C,[{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){return this._size}},{key:"buffer",get:function(){return this._buffer.buffer}},{key:"view",get:function(){return this._view}}]);return C}(c);const t=k.create(),x=l.create(),B=n.create(),q=n.create();a.InstanceData=c;a.InstanceDataView=w;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/sphere ../../../support/mathUtils ../Octree".split(" "),function(a,b,c,m,l,r,n){n=function(g){function k(d,e){var h=g.call(this,v=>l.wrap(h._instanceData.view.boundingSphere.getVec(v,h._tmpSphere)),{maximumDepth:25})||this;h._tmpSphere=l.create();h._tmpMat4=c.create();h._instanceData=d;
h._boundingSphere=e;return h}b._inheritsLoose(k,g);var f=k.prototype;f.addInstance=function(d){const e=this._instanceData.view.boundingSphere,h=this._instanceData.getCombinedModelTransform(d,this._tmpMat4);m.transformMat4(this._tmpSphere,this._boundingSphere.center,h);this._tmpSphere[3]=this._boundingSphere.radius*r.maxScale(h);e.setVec(d,this._tmpSphere);this.add([d])};f.removeInstance=function(d){this.remove([d])};return k}(n);a.InstanceOctree=n;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["exports","../Camera"],function(a,b){let c=function(){function m(r,n){this.thresholdScale=1;this._camera=new b.Camera;this._worldSpaceRadius=r;this._thresholds=n.map(g=>g)}var l=m.prototype;l.updateCamera=function(r){this._camera.copyFrom(r)};l.selectLevel=function(r,n){r=this._camera.computeScreenPixelSizeAt(r);n=this._worldSpaceRadius*n/r;r=this._thresholds;let g=-1;for(let k=
0;k<r.length;++k)n>=r[k]*this.thresholdScale&&(g=k);return g};return m}();a.LevelSelector=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodLevel":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ./LodComponentData".split(" "),function(a,b,c,m,l,r,
n){let g=function(){function k(d,e){this.minScreenSpaceRadius=d;this.components=e}k.create=function(){var d=b._asyncToGenerator(function*(e,h,v){const w=yield Promise.allSettled(h.components.map(x=>e.schedule(()=>new n.LodComponentData(e,x),v))),t=w.map(x=>"fulfilled"===x.status?x.value:null).filter(x=>x);if(m.isAborted(v)||t.length!==w.length){t.forEach(x=>x.destroy());m.throwIfAborted(v);for(const x of w)if("rejected"===x.status)throw x.reason;}return new k(h.minScreenSpaceRadius,t)});return function(e,
h,v){return d.apply(this,arguments)}}();var f=k.prototype;f.destroy=function(){this.components.forEach(d=>d.destroy())};f.intersect=function(d,e,h,v,w,t,x){this.components.forEach(B=>B.intersect(d,e,h,v,w,t,this.boundingSphere,x))};b._createClass(k,[{key:"boundingBox",get:function(){if(c.isNone(this._boundingBox)){const d=r.empty();this.components.forEach(e=>{c.isSome(e.boundingInfo)&&(r.expandWithVec3(d,e.boundingInfo.bbMin),r.expandWithVec3(d,e.boundingInfo.bbMax))});this._boundingBox=d}return this._boundingBox}},
{key:"boundingSphere",get:function(){if(c.isNone(this._boundingSphere)){const d=this.boundingBox,e=l.create();r.center(d,e);this._boundingSphere={center:e,radius:.5*r.diameter(d)}}return this._boundingSphere}},{key:"triangleCount",get:function(){return this.components.reduce((d,e)=>d+e.triangleCount,0)}}]);return k}();a.LodLevel=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodComponentData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../support/buffer/glUtil ../DefaultVertexAttributeLocations ../GLMaterials ../Intersector ../IntersectorInterfaces ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(a,b,c,m,l,r,n,g,k,f){let d=function(){function e(v,w){const t=v.renderContext.rctx,{geometry:x,material:B}=w;this._materialRepository=v.materialRep;B.setParameters({instancedDoublePrecision:!0});v=B.createBufferWriter();w=v.vertexBufferLayout;const q=v.elementCount(x),u=v.allocate(q);v.write({},x,u,0);this.geometry=x;this.material=B;this.glMaterials=new l.GLMaterials(B,this._materialRepository);this.vertexBufferLayout=w;this.vbo=g.BufferObject.createVertex(t,k.Usage.STATIC_DRAW,u.buffer);
this.vao=new f.VertexArrayObject(t,m.Default3D,{geometry:c.glLayout(w)},{geometry:this.vbo});this.vertexCount=q}var h=e.prototype;h.destroy=function(){this.glMaterials.destroy();this.vbo.dispose();this.vao.dispose()};h.intersect=function(v,w,t,x,B,q,u,C){const z=this.geometry.id;this.material.intersect(this.geometry,null,v.transform.transform,v,t,x,(A,p,y,D,E)=>{0<=A&&(null==w||w(v.rayBegin,v.rayEnd,A))&&(y={layerUid:q.layerUid,graphicUid:q.graphicUid(B),geometryId:z,triangleNr:y,baseBoundingSphere:u,
numLodLevels:C},(null==v.results.min.drapedLayerOrder||E>=v.results.min.drapedLayerOrder)&&(null==v.results.min.dist||A<v.results.min.dist)&&v.results.min.set(n.IntersectorType.LOD,y,A,p,v.transform.transform,E),v.options.store!==n.StoreResults.MIN&&(null==v.results.max.drapedLayerOrder||E>=v.results.max.drapedLayerOrder)&&(null==v.results.max.dist||A>v.results.max.dist)&&v.results.max.set(n.IntersectorType.LOD,y,A,p,v.transform.transform,E),v.options.store===n.StoreResults.ALL&&(D=r.newIntersectorResult(v.results.min.ray),
D.set(n.IntersectorType.LOD,y,A,p,v.transform.transform,E),v.results.all.push(D)))})};b._createClass(e,[{key:"boundingInfo",get:function(){return this.geometry.boundingInfo}},{key:"triangleCount",get:function(){return this.vertexCount/3}}]);return e}();a.LodComponentData=d;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../geometry/support/buffer/BufferView ../Util ../VertexAttribute ./BackedBufferObject".split(" "),
function(a,b,c,m,l,r){let n=function(k){this.modelOriginHi=k.getField(l.VertexAttribute.MODELORIGINHI,c.BufferViewVec3f);this.modelOriginLo=k.getField(l.VertexAttribute.MODELORIGINLO,c.BufferViewVec3f);this.model=k.getField(l.VertexAttribute.MODEL,c.BufferViewMat3f);this.modelNormal=k.getField(l.VertexAttribute.MODELNORMAL,c.BufferViewMat3f);this.color=k.getField(l.VertexAttribute.INSTANCECOLOR,c.BufferViewVec4f);this.featureAttribute=k.getField(l.VertexAttribute.INSTANCEFEATUREATTRIBUTE,c.BufferViewVec4f)},
g=function(){function k(d,e){this._tailIndex=this._headIndex=0;this._captureFirstIndex=!0;this._updating=!1;this._prevHeadIndex=0;this._resized=!1;this._rctx=d;this._instanceBufferLayout=e;this._elementSize=e.stride;this._capacity=1}var f=k.prototype;f.destroy=function(){this._buffer&&this._buffer.destroy()};f.reset=function(){this._tailIndex=this._headIndex=0;this._firstIndex=null};f.startUpdateCylce=function(){this._captureFirstIndex=!0};f.beginUpdate=function(){m.assert(!this._updating,"already updating");
this._updating=!0;this._prevHeadIndex=this._headIndex};f.endUpdate=function(){m.assert(this._updating,"not updating");this.size<.3*this.capacity&&this._shrink();this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1};f.allocateHead=function(){m.assert(this._updating,"not updating");this.isFull&&this._grow();const d=this.headIndex;this._captureFirstIndex&&(this._firstIndex=d,this._captureFirstIndex=!1);this._incrementHead();
m.assert(this._headIndex!==this._tailIndex,"invalid pointers");return d};f.freeTail=function(){m.assert(this._updating,"not updating");m.assert(0<this.size,"invalid size");const d=this._tailIndex===this._firstIndex;this._incrementTail();d&&(this._firstIndex=this._tailIndex)};f._grow=function(){this._resize(Math.max(1024,Math.floor(2*this._capacity)))};f._shrink=function(){this._resize(Math.max(1024,Math.floor(.5*this._capacity)))};f._resize=function(d){m.assert(this._updating,"not updating");if(d!==
this._capacity){var e=new r(this._rctx,this._elementSize,d);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const h=this.size,v=this._compactInstances(e);m.assert(v===h,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=v;this._prevHeadIndex=0}this._resized=!0;this._capacity=d;this._buffer=e;this._view=new n(this._instanceBufferLayout.createView(this._buffer.array))}};f._compactInstances=function(d){const e=
this._headIndex,h=this._tailIndex;return h<e?(this._buffer.copyRange(h,e,d),e-h):h>e?(this._buffer.copyRange(h,this._capacity,d),0<e&&this._buffer.copyRange(0,e,d,this._capacity-h),e+(this._capacity-h)):0};f._incrementHead=function(d=1){this._headIndex=(this._headIndex+d)%this._capacity};f._incrementTail=function(d=1){this._tailIndex=(this._tailIndex+d)%this._capacity};f._transferRange=function(d,e){d<e?this._buffer.transferRange(d,e):d>e&&(0<e&&this._buffer.transferRange(0,e),this._buffer.transferRange(d,
this._capacity))};b._createClass(k,[{key:"buffer",get:function(){return this._buffer.buffer}},{key:"view",get:function(){return this._view}},{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){const d=this._headIndex,e=this._tailIndex;return d>=e?d-e:d+this._capacity-e}},{key:"isEmpty",get:function(){return this._headIndex===this._tailIndex}},{key:"isFull",get:function(){return this._tailIndex===(this._headIndex+1)%this._capacity}},{key:"headIndex",get:function(){return this._headIndex}},
{key:"tailIndex",get:function(){return this._tailIndex}},{key:"firstIndex",get:function(){return this._firstIndex}},{key:"memoryUsage",get:function(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}}]);return k}();a.RenderInstanceData=g;a.RenderInstanceDataView=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers",
"../../../../webgl/BufferObject","../../../../webgl/enums"],function(a,b,c){return function(){function m(r,n,g){this._elementSize=n;this._buffer=b.BufferObject.createVertex(r,c.Usage.STATIC_DRAW);this.resize(g)}var l=m.prototype;l.destroy=function(){this._buffer.dispose()};l.copyRange=function(r,n,g,k=0){r=new Uint8Array(this.array,r*this.elementSize,(n-r)*this.elementSize);(new Uint8Array(g.array,k*this.elementSize)).set(r)};l.transferAll=function(){this._buffer.setData(this._array)};l.transferRange=
function(r,n){r*=this._elementSize;this._buffer.setSubData(this._array,r,r,n*this._elementSize)};l.resize=function(r){const n=r*this._elementSize,g=new ArrayBuffer(n);this._array&&(r>=this._capacity?(new Uint8Array(g)).set(new Uint8Array(this._array)):(new Uint8Array(g)).set((new Uint8Array(this._array)).subarray(0,r*this._elementSize)));this._array=g;this._buffer.setSize(n);this._capacity=r};a._createClass(m,[{key:"elementSize",get:function(){return this._elementSize}},{key:"capacity",get:function(){return this._capacity}},
{key:"array",get:function(){return this._array}},{key:"buffer",get:function(){return this._buffer}},{key:"memoryUsage",get:function(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}}]);return m}()})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat2 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ../support/FastSymbolUpdates ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/PathGeometry ../../webgl-engine/lib/pathGeometryUtils ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/PathMaterial".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E){function F(Q,S,T){switch(S){case "world":for(const U of Q.vertices)k.add(H,U.pos,Q.offset),T.worldUpAtPosition(H,J),U.setFrameFromUpVector(J),U.computeRotationAxisAndAngleFromUpVector();break;case "path":k.add(H,Q.vertices[0].pos,Q.offset);T.worldUpAtPosition(H,J);y.computeMinimumRotationTangentFrame(Q,J);for(const U of Q.vertices)Q=Math.sign(k.dot(U.frame.right,U.vRight)),k.cross(U.rotationFrame.up,U.vRight,U.vLeft),k.scale(U.rotationFrame.up,
U.rotationFrame.up,Q),k.normalize(U.rotationFrame.up,U.rotationFrame.up),S=k.dot(U.rotationFrame.up,U.frame.up),T=k.dot(U.rotationFrame.up,U.frame.right),k.scale(H,U.frame.up,-T),k.scale(I,U.frame.right,S),k.add(H,H,I),k.normalize(U.rotationFrame.right,H),y.vertexSpaceToProfileSpace(U.rotationRight,U.frame,U.rotationFrame.right),k.negate(H,U.vLeft),U.rotationAngle=-Q*(Math.PI-m.acosClamped(k.dot(H,U.vRight))),0<Math.abs(U.rotationAngle)&&(Q=m.reciprocalClamped(Math.cos(.5*U.rotationAngle)),r.set(U.miterStretch,
1+(Q-1)*U.rotationRight[0]*U.rotationRight[0],(Q-1)*U.rotationRight[0]*U.rotationRight[1],(Q-1)*U.rotationRight[0]*U.rotationRight[1],1+(Q-1)*U.rotationRight[1]*U.rotationRight[1])),U.maxStretchDistance=Math.abs(Math.min(U.vLeftLength,U.vRightLength)*m.reciprocalClamped(Math.cos(.5*(Math.PI-U.rotationAngle))))}}function G(Q,S,T){switch(Q){case "symbol-value":return T;case "proportional":return S;default:return Q}}function P(Q,S,T,U){Q=Q.stageObject;const aa=Q.geometryRecords;var W=0;M.spatialReference=
U.spatialReference;for(const ha of aa){const ia=ha.geometry;if(!p.isPathGeometry(ia))continue;const ka=ia.path,la=ka.builder.path;L.spatialReference=ia.geometrySR;{var R=la;var V=S,da=T,ca=U;let Y=0;for(const ea of R.vertices)w.evaluateElevationInfoAtPoint(ea.posES,da,V,ca,O),Y+=O.sampledElevation,k.add(J,ea.pos,R.offset),ca.setAltitude(J,O.z),k.subtract(ea.pos,J,R.offset);R.updatePathVertexInformation();R=Y/R.vertices.length}W+=R;"world"!==ia.upVectorAlignment&&F(la,ia.upVectorAlignment,U);ka.onPathChanged();
ia.invalidateBoundingInfo();Q.geometryVertexAttrsUpdated(ha)}return W/aa.length}const K=["polyline"];let N=function(Q){function S(U,aa,W,R){U=Q.call(this,U,aa,W,R)||this;U._intrinsicSize=g.fromValues(1,1);U.upVectorAlignment="path";U.stencilWidth=.1;U.ensureDrapedStatus(!1);return U}b._inheritsLoose(S,Q);var T=S.prototype;T.doLoad=function(){var U=b._asyncToGenerator(function*(){var aa=l.isSome(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height;const W=l.isSome(this.symbolLayer.height)?
this.symbolLayer.height:aa;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[aa,1,W],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}};this._fastUpdates=this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?C.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};var R=this.symbolLayer.anchor||
"center";this.upVectorAlignment="path";"heading"===this.symbolLayer.profileRotation&&(this.upVectorAlignment="world");var V=this.symbolLayer.profile||"circle";switch(V){default:this._profile=y.Profile.circle(10);break;case "quad":this._profile=y.Profile.rect()}var da=[0,0];"center"!==R&&(da={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[R],this._profile.translate(da[0],da[1]));switch(this.symbolLayer.join||"simple"){case "round":this._extruder=new y.MiterExtruder(0,3);break;case "bevel":this._extruder=
new y.MiterExtruder(0,1);break;case "miter":this._extruder=new y.MiterExtruder(.8*Math.PI,1);break;default:this._extruder=new y.SimpleExtruder}R=this.symbolLayer.cap||"butt";switch(R){case "none":this._startCap=new y.NoCapBuilder;this._endCap=new y.NoCapBuilder;break;default:this._startCap=new y.TriangulationCapBuilder(this._profile,0);this._endCap=new y.TriangulationCapBuilder(this._profile,0,!0);break;case "square":this._startCap=new y.TriangulationCapBuilder(this._profile,-.5);this._endCap=new y.TriangulationCapBuilder(this._profile,
.5,!0);break;case "round":V="quad"===V?!0:!1,this._startCap=new y.RoundCapBuilder({profile:this._profile,flip:!1,breakNormals:V,subdivisions:3}),this._endCap=new y.RoundCapBuilder({profile:this._profile,flip:!0,breakNormals:V,subdivisions:3})}V=l.get(this.symbolLayer,"material","color");da=this._getCombinedOpacityAndColor(V);V=d.fromArray(da);da=da[3];const ca=1>da||this.needsDrivenTransparentPass;R={diffuse:V,ambient:V,opacity:da,transparent:ca,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,
castShadows:this.symbolLayer.castShadows,cullFace:ca||"none"===R?z.CullFaceOptions.None:z.CullFaceOptions.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(n.set(this._intrinsicSize,aa,W),!q.isValidSize(this._intrinsicSize[0])||!q.isValidSize(this._intrinsicSize[1])))throw new c("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||n.scale(this._intrinsicSize,this._intrinsicSize,1/
this._context.renderCoordsHelper.unitInMeters);this._fastUpdates.enabled?(aa={...R,...this._fastUpdates.materialParameters,size:g.fromArray(this._intrinsicSize)},this._material=new E.PathMaterial(aa)):(R.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new D.DefaultMaterial(R));this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});this._context.stage.add(this._material)});return function(){return U.apply(this,arguments)}}();
T.destroy=function(){Q.prototype.destroy.call(this);this._context.stage.remove(this._material);this._material=null};T.createGraphics3DGraphic=function(U){const aa=U.graphic;if(!this._validateGeometry(aa.geometry,K,this.symbolLayer.type))return null;const W=this.setGraphicElevationContext(aa,new t.ElevationContext);return this._createAs3DShape(aa,U.renderingInfo,W,aa.uid)};T.layerOpacityChanged=function(){var U=l.get(this.symbolLayer,"material","color");U=this._getCombinedOpacity(U);this._material.setParameters({opacity:U,
transparent:1>U||this.needsDrivenTransparentPass});return!0};T.layerElevationInfoChanged=function(U,aa){return this.updateGraphics3DGraphicElevationInfo(U,aa,w.needsElevationUpdates3D)};T.slicePlaneEnabledChanged=function(){this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};T.physicalBasedRenderingChanged=function(){this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});return!0};T.pixelRatioChanged=function(){return!0};
T.applyRendererDiff=function(U,aa){for(const W in U.diff)switch(W){case "visualVariables":if(C.updateFastSymbolUpdatesState(this._fastUpdates,aa,this._vvConvertOptions))this._material.setParameters(this._fastUpdates.materialParameters);else return u.ApplyRendererDiffResult.Recreate_Symbol;break;default:return u.ApplyRendererDiffResult.Recreate_Symbol}return u.ApplyRendererDiffResult.Fast_Update};T.getVertexData=function(U){let aa=0;const W=U.paths,R=[],V=U.spatialReference,da=this._context.elevationProvider.spatialReference,
ca=this._context.renderCoordsHelper.spatialReference;for(var ha of W)aa+=ha.length;ha=new Float64Array(3*aa);const ia=new Float64Array(3*aa),ka=new Float64Array(3*aa);let la=0;for(const Y of W){R.push({index:la,numVertices:Y.length});for(const ea of Y)ha[la++]=ea[0],ha[la++]=ea[1],ha[la++]=U.hasZ?ea[2]:0}U=!0;V.equals(da)?this._copyVertices(ha,0,ia,0,aa):U=e.projectBuffer(ha,V,0,ia,da,0,aa);da.equals(ca)?this._copyVertices(ia,0,ka,0,aa):e.projectBuffer(ia,da,0,ka,ca,0,aa);return{pathVertexDataInfos:R,
vertexDataGS:ha,vertexDataES:ia,vertexDataRS:ka,projectionSuccess:U,terrainElevation:0}};T._copyVertices=function(U,aa,W,R,V){aa*=3;R*=3;for(let da=0;da<V;++da)W[R++]=U[aa++],W[R++]=U[aa++],W[R++]=U[aa++]};T._createAs3DShape=function(U,aa,W,R){var V=U.geometry,da=[];const ca=[],ha=[],ia=V.spatialReference,ka=h.create(),la=this._context.renderCoordsHelper;L.spatialReference=ia;const Y=this.getVertexData(V);if(!Y.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),
null;if(0<Y.pathVertexDataInfos.length){for(V=0;V<Y.pathVertexDataInfos.length;++V){var ea=Y.pathVertexDataInfos[V],ba=ea.index;ea=ea.numVertices;if(2>ea)continue;if(l.isSome(this._context.clippingExtent)&&(h.empty(ka),h.expandWithBuffer(ka,Y.vertexDataES,3*ba,ea),!h.intersectsClippingArea(ka,this._context.clippingExtent)))continue;var Z=[];for(var fa=ba;fa<ba+3*ea;){const sa=fa++,qa=fa++,Ha=fa++,Ga=new y.PathVertex;k.set(Ga.posGS,Y.vertexDataGS[sa],Y.vertexDataGS[qa],Y.vertexDataGS[Ha]);k.set(Ga.posES,
Y.vertexDataES[sa],Y.vertexDataES[qa],Y.vertexDataES[Ha]);const pa=w.evaluateElevationAlignmentAtPoint(Ga.posES,this._context.elevationProvider,W,la);k.set(J,Y.vertexDataRS[sa],Y.vertexDataRS[qa],Y.vertexDataRS[Ha]);la.setAltitude(J,pa);k.set(Ga.pos,J[0],J[1],J[2]);Z.push(Ga)}ba=new y.Path(Z);F(ba,this.upVectorAlignment,this._context.renderCoordsHelper);ba=new y.Builder(ba,this._profile,this._extruder,this._startCap,this._endCap);ea=null;this._fastUpdates.enabled?(fa=this._fastUpdates.visualVariables,
ea=fa.size?B.getAttributeValue(fa.size.field,U):0,Z=fa.color?B.getAttributeValue(fa.color.field,U):0,fa=fa.opacity?B.getAttributeValue(fa.opacity.field,U):0,ea=new y.FastUpdatePathGeometry(ba,ea,Z,fa)):(ea=[this._intrinsicSize[0],this._intrinsicSize[1]],this._drivenProperties.size&&(ea[0]*=G(aa.size[0],"symbol-value"===aa.size[2]?this.symbolLayer.height||0:aa.size[2],this.symbolLayer.width||0),ea[1]*=G(aa.size[2],"symbol-value"===aa.size[0]?this.symbolLayer.width||0:aa.size[0],this.symbolLayer.height||
0)),Z=null,this._drivenProperties.color&&(Z=aa.color),this._drivenProperties.opacity&&null!=aa.opacity&&(Z=Z?[Z[0],Z[1],Z[2],aa.opacity]:[1,1,1,aa.opacity]),ba=new y.StaticPathGeometry(ba),ba.bake(ea),Z&&ba.bakeVertexColors(Z),ea=ba);const {vertexAttributes:ja,indices:oa}=ea.createGeometryData();ba=new p.PathGeometry(ja,oa,ea,ia,this.upVectorAlignment,this.stencilWidth);da.push(ba);ca.push(this._material);ha.push(ea.xform)}if(0<da.length)return U=new A.Object3D({geometries:da,materials:ca,transformations:ha,
metadata:{layerUid:this._context.layer.uid,graphicUid:R}}),da=new x.Graphics3DObject3DGraphicLayer(this,U,da,null,null,P,W),da.alignedSampledElevation=Y.terrainElevation,da.needsElevationUpdates=w.needsElevationUpdates3D(W.mode),da}else 0!==V.paths.length&&V.paths.some(ja=>0<ja.length)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null};return S}(B.Graphics3DSymbolLayer);const M=v.makeDehydratedPoint(0,0,0,null),L=v.makeDehydratedPoint(0,0,0,null),
J=d.create(),H=f.create(),I=f.create(),O=new w.SampleElevationInfo;a.Graphics3DPathSymbolLayer=N;a.NUM_CIRCLE_PROFILE_SUBDIVISIONS=10;a.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS=3;a.NUM_ROUND_JOIN_SUBDIVISIONS=3;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/mat2":function(){define(["exports","./common"],function(a,b){function c(y,D){y[0]=D[0];y[1]=D[1];y[2]=D[2];y[3]=D[3];return y}function m(y){y[0]=1;y[1]=0;y[2]=0;y[3]=1;return y}function l(y,
D,E,F,G){y[0]=D;y[1]=E;y[2]=F;y[3]=G;return y}function r(y,D){if(y===D){const E=D[1];y[1]=D[2];y[2]=E}else y[0]=D[0],y[1]=D[2],y[2]=D[1],y[3]=D[3];return y}function n(y,D){const E=D[0],F=D[1],G=D[2];D=D[3];let P=E*D-G*F;if(!P)return null;P=1/P;y[0]=D*P;y[1]=-F*P;y[2]=-G*P;y[3]=E*P;return y}function g(y,D){const E=D[0];y[0]=D[3];y[1]=-D[1];y[2]=-D[2];y[3]=E;return y}function k(y){return y[0]*y[3]-y[2]*y[1]}function f(y,D,E){const F=D[0],G=D[1],P=D[2];D=D[3];const K=E[0],N=E[1],M=E[2];E=E[3];y[0]=F*
K+P*N;y[1]=G*K+D*N;y[2]=F*M+P*E;y[3]=G*M+D*E;return y}function d(y,D,E){const F=D[0],G=D[1],P=D[2];D=D[3];const K=Math.sin(E);E=Math.cos(E);y[0]=F*E+P*K;y[1]=G*E+D*K;y[2]=F*-K+P*E;y[3]=G*-K+D*E;return y}function e(y,D,E){const F=D[1],G=D[2],P=D[3],K=E[0];E=E[1];y[0]=D[0]*K;y[1]=F*K;y[2]=G*E;y[3]=P*E;return y}function h(y,D){const E=Math.sin(D);D=Math.cos(D);y[0]=D;y[1]=E;y[2]=-E;y[3]=D;return y}function v(y,D){y[0]=D[0];y[1]=0;y[2]=0;y[3]=D[1];return y}function w(y){return"mat2("+y[0]+", "+y[1]+", "+
y[2]+", "+y[3]+")"}function t(y){return Math.sqrt(y[0]**2+y[1]**2+y[2]**2+y[3]**2)}function x(y,D,E,F){y[2]=F[2]/F[0];E[0]=F[0];E[1]=F[1];E[3]=F[3]-y[2]*E[1];return[y,D,E]}function B(y,D,E){y[0]=D[0]+E[0];y[1]=D[1]+E[1];y[2]=D[2]+E[2];y[3]=D[3]+E[3];return y}function q(y,D,E){y[0]=D[0]-E[0];y[1]=D[1]-E[1];y[2]=D[2]-E[2];y[3]=D[3]-E[3];return y}function u(y,D){return y[0]===D[0]&&y[1]===D[1]&&y[2]===D[2]&&y[3]===D[3]}function C(y,D){const E=y[0],F=y[1],G=y[2];y=y[3];const P=D[0],K=D[1],N=D[2];D=D[3];
return Math.abs(E-P)<=b.EPSILON*Math.max(1,Math.abs(E),Math.abs(P))&&Math.abs(F-K)<=b.EPSILON*Math.max(1,Math.abs(F),Math.abs(K))&&Math.abs(G-N)<=b.EPSILON*Math.max(1,Math.abs(G),Math.abs(N))&&Math.abs(y-D)<=b.EPSILON*Math.max(1,Math.abs(y),Math.abs(D))}function z(y,D,E){y[0]=D[0]*E;y[1]=D[1]*E;y[2]=D[2]*E;y[3]=D[3]*E;return y}function A(y,D,E,F){y[0]=D[0]+E[0]*F;y[1]=D[1]+E[1]*F;y[2]=D[2]+E[2]*F;y[3]=D[3]+E[3]*F;return y}const p=Object.freeze(Object.defineProperty({__proto__:null,copy:c,identity:m,
set:l,transpose:r,invert:n,adjoint:g,determinant:k,multiply:f,rotate:d,scale:e,fromRotation:h,fromScaling:v,str:w,frob:t,LDU:x,add:B,subtract:q,exactEquals:u,equals:C,multiplyScalar:z,multiplyScalarAndAdd:A,mul:f,sub:q},Symbol.toStringTag,{value:"Module"}));a.LDU=x;a.add=B;a.adjoint=g;a.copy=c;a.determinant=k;a.equals=C;a.exactEquals=u;a.frob=t;a.fromRotation=h;a.fromScaling=v;a.identity=m;a.invert=n;a.mat2=p;a.mul=f;a.multiply=f;a.multiplyScalar=z;a.multiplyScalarAndAdd=A;a.rotate=d;a.scale=e;a.set=
l;a.str=w;a.sub=q;a.subtract=q;a.transpose=r})},"esri/views/3d/webgl-engine/lib/PathGeometry":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./Geometry"],function(a,b,c){c=function(m){function l(r,n,g,k,f,d){r=m.call(this,r,n)||this;r.path=g;r.geometrySR=k;r.upVectorAlignment=f;r.stencilWidth=d;return r}b._inheritsLoose(l,m);return l}(c.Geometry);a.PathGeometry=c;a.isPathGeometry=function(m){return"upVectorAlignment"in m};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/pathGeometryUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../chunks/mat2 ../../../../chunks/mat2f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/plane ../../../../geometry/support/ray ./GeometryUtil ./VertexAttribute ../materials/internal/MaterialUtil".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t){function x(){return{up:d.create(),right:d.create()}}let B=function(){function aa(){this.pos=d.create();this.posES=d.create();this.posGS=d.create();this.vRight=d.create();this.vLeft=d.create();this.frame=x();this.rotationFrame=x();this.rotationRight=k.create();this.rotationAngle=0;this.miterStretch=l.create()}var W=aa.prototype;W.setFrameFromUpVector=function(R){f.copy(this.frame.up,R);f.add(I,this.vLeft,this.vRight);f.normalize(I,I);f.scale(H,this.frame.up,
f.dot(I,this.frame.up));f.subtract(S,I,H);f.normalize(S,S);f.cross(this.frame.right,S,this.frame.up)};W.computeRotationAxisAndAngleFromUpVector=function(){f.copy(this.rotationFrame.up,this.frame.up);f.copy(this.rotationFrame.right,this.frame.right);g.set(this.rotationRight,1,0);f.scale(H,this.frame.up,f.dot(this.frame.up,this.vLeft));f.subtract(H,this.vLeft,H);f.negate(H,H);f.normalize(H,H);f.scale(I,this.frame.up,f.dot(this.frame.up,this.vRight));f.subtract(I,this.vRight,I);f.normalize(I,I);f.cross(O,
this.rotationFrame.up,this.vLeft);this.rotationAngle=Math.sign(f.dot(O,this.vRight))*(Math.PI-c.acosClamped(f.dot(H,I)));if(0<Math.abs(this.rotationAngle)){const R=c.reciprocalClamped(Math.cos(.5*this.rotationAngle));m.set(this.miterStretch,1+(R-1),0,0,1)}this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*(Math.PI-this.rotationAngle)))};return aa}(),q=function(){function aa(){this.vertices=[];this.vertexIndices=[];this.vertexNormals=[];this.poles=[];this.poleIndices=
[];this.uvIndices=this.uvs=null}var W=aa.prototype;W.addVertex=function(R,V){this.vertices.push(k.clone(R));this.vertexNormals.push(k.clone(V));return this.vertices.length-1};W.addUV=function(R){this.uvs||(this.uvs=[],this.uvIndices=[]);this.uvs.push(R);return this.uvs.length-1};W.addPole=function(R,V=null){this.poles.push({position:k.clone(R),normal:V?k.clone(V):null});return this.poles.length-1};W.addSegment=function(R,V=null,da=null){this.vertexIndices.push(R.v0);this.vertexIndices.push(R.v1);
V&&(this.uvIndices.push(V.v0),this.uvIndices.push(V.v1));da&&(this.poleIndices.push(da.v0),this.poleIndices.push(da.v1))};W.hasUV=function(){return null!=this.uvs};W.translate=function(R,V){for(const da of this.vertices)da[0]+=R,da[1]+=V;for(const da of this.poles)da.position[0]+=R,da.position[1]+=V};aa.circle=function(R=20){const V=new aa,da={v0:0,v1:0};V.addPole(k.fromValues(0,0));for(var ca=0;ca<R;++ca){var ha=2*ca*Math.PI/R,ia=Math.cos(ha);const ka=Math.sin(ha);ha=k.fromValues(.5*ia,.5*ka);ia=
k.fromValues(ia,ka);V.addVertex(ha,ia);V.addUV(ca/R)}V.addUV(1);for(ca=0;ca<R-1;++ca)ia={v0:ca,v1:ca+1},V.addSegment(ia,ia,da);V.addSegment({v0:R-1,v1:0},{v0:R-1,v1:R},da);return V};aa.rect=function(){const R=new aa,V=k.fromValues(-.5,-.5),da=k.fromValues(.5,-.5),ca=k.fromValues(.5,.5),ha=k.fromValues(-.5,.5),ia=k.fromValues(0,-1),ka=k.fromValues(1,0),la=k.fromValues(0,1),Y=k.fromValues(-1,0);R.addUV(0);R.addUV(1);R.addPole(k.fromValues(0,.5),la);R.addPole(k.fromValues(0,.5));R.addPole(k.fromValues(0,
-.5));R.addPole(k.fromValues(0,-.5),ia);const ea={v0:0,v1:1};R.addVertex(V,ia);R.addVertex(da,ia);R.addSegment({v0:0,v1:1},ea,{v0:3,v1:3});R.addVertex(da,ka);R.addVertex(ca,ka);R.addSegment({v0:2,v1:3},ea,{v0:2,v1:1});R.addVertex(ca,la);R.addVertex(ha,la);R.addSegment({v0:4,v1:5},ea,{v0:0,v1:0});R.addVertex(ha,Y);R.addVertex(V,Y);R.addSegment({v0:6,v1:7},ea,{v0:1,v1:2});return R};b._createClass(aa,[{key:"numSegments",get:function(){return this.vertexIndices.length/2}}]);return aa}(),u=function(){function aa(W){this.vertices=
[];this.offset=d.create();this.xform=n.create();this.vertices=W;f.copy(this.offset,this.vertices[Math.floor((W.length-1)/2)].pos);for(const R of this.vertices)f.subtract(R.pos,R.pos,this.offset);r.translate(this.xform,this.xform,this.offset);this.updatePathVertexInformation()}aa.prototype.updatePathVertexInformation=function(){const W=this.vertices.length;let R=this.vertices[0];R.index=0;f.set(R.vLeft,0,0,0);R.vLeftLength=0;f.subtract(R.vRight,this.vertices[1].pos,R.pos);R.vRightLength=f.length(R.vRight);
f.normalize(R.vRight,R.vRight);let V=R;for(let da=1;da<W;++da)R=this.vertices[da],R.index=da,f.copy(R.vLeft,V.vRight),R.vLeftLength=V.vRightLength,da<W-1?(f.subtract(R.vRight,this.vertices[da+1].pos,R.pos),R.vRightLength=f.length(R.vRight),f.normalize(R.vRight,R.vRight)):(f.copy(R.vRight,R.vLeft),R.vRightLength=R.vLeftLength),V=R};return aa}(),C=function(){function aa(){}var W=aa.prototype;W.numProfilesPerJoin=function(){return 1};W.extrude=function(R,V,da){for(let ca=0;ca<V.vertices.length;++ca)da(R.index,
R.frame,V.vertices[ca],V.vertexNormals[ca],!1)};return aa}(),z=function(){function aa(R=.8*Math.PI,V=1){this.cutoffAngle=R;this.numBendSubdivisions=V}var W=aa.prototype;W.numProfilesPerJoin=function(){return this.numBendSubdivisions+1};W.extrude=function(R,V,da){var ca=T;if(Math.abs(R.rotationAngle)>=this.cutoffAngle)for(var ha=0;ha<this.numBendSubdivisions+1;++ha){r.fromRotation(U,.5*-R.rotationAngle+ha*R.rotationAngle/this.numBendSubdivisions,R.rotationFrame.up);var ia=ca,ka=R.frame,la=U;f.transformMat4(ia.up,
ka.up,la);f.transformMat4(ia.right,ka.right,la);for(ia=0;ia<V.vertices.length;++ia)0<=g.dot(V.vertices[ia],R.rotationRight)*R.rotationAngle?da(R.index,ca,V.vertices[ia],V.vertexNormals[ia],!1):(g.transformMat2(M,V.vertices[ia],R.miterStretch),da(R.index,R.frame,M,V.vertexNormals[ia],!0))}else for(ca=0;ca<this.numBendSubdivisions+1;++ca)for(ha=0;ha<V.vertices.length;++ha)ia=0<=g.dot(V.vertices[ha],R.rotationRight)*R.rotationAngle,g.transformMat2(M,V.vertices[ha],R.miterStretch),da(R.index,R.frame,
M,V.vertexNormals[ha],ia?!1:!0)};return aa}();const A={generateUV:!1};let p=function(){function aa(){}aa.prototype.rebuildConnectingProfileGeometry=function(W,R,V){for(let da=0;da<R.vertices.length;++da)V(W.index,W.frame,R.vertices[da],R.vertexNormals[da],0,0)};return aa}(),y=function(aa){function W(){return aa.call(this)||this}b._inheritsLoose(W,aa);var R=W.prototype;R.getNumVertices=function(){return 0};R.getNumIndices=function(){return 0};R.rebuildCapGeometry=function(){};R.buildTopology=function(){};
return W}(p),D=function(aa){function W(V,da=0,ca=!1){var ha=aa.call(this)||this;ha.profile=V;ha.profilePlaneOffset=da;ha.flip=ca;return ha}b._inheritsLoose(W,aa);var R=W.prototype;R.getNumVertices=function(){return this.profile.vertices.length};R.getNumIndices=function(){return 3*this.profile.numSegments};R.rebuildConnectingProfileGeometry=function(V,da,ca){for(let ha=0;ha<da.vertices.length;++ha)ca(V.index,V.frame,da.vertices[ha],da.vertexNormals[ha],this.profilePlaneOffset,0)};R.rebuildCapGeometry=
function(V,da){const ca=L;g.set(ca,0,0);const ha=this.flip?1:-1;for(let ia=0;ia<this.profile.vertices.length;++ia)da(V.index,V.frame,this.profile.vertices[ia],ca,this.profilePlaneOffset,ha)};R.buildTopology=function(V,da){V=this.vertexBufferStart+this.profile.vertexIndices[0];for(let ca=1;ca<this.profile.numSegments;++ca){const ha=this.vertexBufferStart+this.profile.vertexIndices[2*ca],ia=this.vertexBufferStart+this.profile.vertexIndices[2*ca+1];this.flip?da(ia,ha,V):da(V,ha,ia)}};return W}(p),E=
function(aa){function W(V){var da=aa.call(this)||this;da.flip=!1;da.sign=0;da.breakNormals=!1;da.numSegments=3;da.profile=V.profile;da.flip=V.flip;da.sign=da.flip?1:-1;da.breakNormals=V.breakNormals;da.numSegments=V.subdivisions;return da}b._inheritsLoose(W,aa);var R=W.prototype;R.getNumVertices=function(){let V=0;V=this.profile.vertices.length*(this.numSegments-1);this.breakNormals&&(V+=this.profile.vertices.length);return V+=this.profile.poles.length};R.getNumIndices=function(){let V;V=2*this.profile.numSegments*
(this.numSegments-1);for(let da=0;da<this.profile.numSegments;++da)V=this.profile.poleIndices[this.profile.vertexIndices[2*da]]===this.profile.poleIndices[this.profile.vertexIndices[2*da+1]]?V+1:V+2;return 3*V};R.rebuildCapGeometry=function(V,da){const ca=V.frame,ha=.5*this.sign,ia=M,ka=L;g.set(ka,0,0);for(var la=0;la<this.profile.poles.length;++la){var Y=this.profile.poles[la];Y.normal?da(V.index,ca,Y.position,Y.normal,ha,0):da(V.index,ca,Y.position,ka,ha,this.sign)}if(this.breakNormals)for(la=0;la<
this.profile.vertices.length;++la)da(V.index,ca,this.profile.vertices[la],this.profile.vertexNormals[la],0,0);for(la=0;la<this.numSegments-1;++la){var ea=(1-(la+1)/this.numSegments)*Math.PI*.5;Y=Math.sin(ea);ea=Math.cos(ea);for(let ba=0;ba<this.profile.vertices.length;++ba){const Z=this.profile.poles[this.profile.poleIndices[ba]];g.subtract(ia,this.profile.vertices[ba],Z.position);g.scale(ia,ia,Y);Z.normal?(g.add(ia,ia,Z.position),da(V.index,ca,ia,Z.normal,ha*ea,0)):(g.normalize(ka,ia),g.scale(ka,
ka,Y),g.add(ia,ia,Z.position),da(V.index,ca,ia,ka,ha*ea,this.sign*ea))}}};R.buildTopology=function(V,da){V=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex;const ca=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let ha=0;ha<this.profile.numSegments;++ha){const ia=this.profile.vertexIndices[2*ha],ka=this.profile.vertexIndices[2*ha+1],la=this.vertexBufferStart+
this.profile.poleIndices[ia],Y=this.vertexBufferStart+this.profile.poleIndices[ka];let ea=V+ia,ba=V+ka;for(let Z=0;Z<this.numSegments-1;++Z){const fa=ca+Z*this.profile.vertices.length+ia,ja=ca+Z*this.profile.vertices.length+ka;this.flip?(da(fa,ba,ea),da(ba,fa,ja)):(da(ea,ba,fa),da(ja,fa,ba));ea=fa;ba=ja}this.flip?(da(la,ba,ea),la!==Y&&da(la,Y,ba)):(da(ea,ba,la),la!==Y&&da(ba,Y,la))}};return W}(p),F=function(){function aa(R,V,da,ca,ha,ia=A){this.options=ia;this.numUVTotal=this.numNormalsTotal=this.numVerticesTotal=
this.numExtrusionProfiles=this._triangleCount=this._extrusionVertexCount=0;this.profile=V;this.path=R;this.extruder=da;this.startCap=ca;this.endCap=ha;R=this.path.vertices.length-2;this.numExtrusionProfiles=da.numProfilesPerJoin()*R+2;this.numNormalsTotal=this.numVerticesTotal=V.vertices.length*this.numExtrusionProfiles;this.startCap.vertexBufferStart=this.numVerticesTotal;V=this.startCap.getNumVertices();this.numVerticesTotal+=V;this.numNormalsTotal+=V;this.endCap.vertexBufferStart=this.numVerticesTotal;
V=this.endCap.getNumVertices();this.numVerticesTotal+=V;this.numNormalsTotal+=V;this.pathVertexData=new Float32Array(1*this.numVerticesTotal);this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal);this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal);this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal);this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal));this.originData=
new Float32Array(3*this.path.vertices.length);this._rebuildGeometry();this.buildTopology()}var W=aa.prototype;W.emitVertex=function(R,V,da,ca,ha){this.profileRightAxisData[4*this._extrusionVertexCount]=V.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=V.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+2]=V.right[2];this.profileUpAxisData[4*this._extrusionVertexCount]=V.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=V.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+
2]=V.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount]=da[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=da[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=ca[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=ca[1];this.pathVertexData[this._extrusionVertexCount]=R;ha?(R=this.path.vertices[R],this.profileRightAxisData[4*this._extrusionVertexCount+3]=R.rotationRight[0]*R.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+
3]=R.rotationRight[1]*R.maxStretchDistance):(this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0);++this._extrusionVertexCount};W.emitCapVertex=function(R,V,da,ca,ha,ia){this.profileRightAxisData[4*this._extrusionVertexCount]=V.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=V.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+2]=V.right[2];this.profileUpAxisData[4*this._extrusionVertexCount]=V.up[0];
this.profileUpAxisData[4*this._extrusionVertexCount+1]=V.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=V.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount]=da[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=da[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=ca[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=ca[1];this.pathVertexData[this._extrusionVertexCount]=R;this.profileRightAxisData[4*this._extrusionVertexCount+
3]=ha;this.profileUpAxisData[4*this._extrusionVertexCount+3]=ia;++this._extrusionVertexCount};W.emitTriangle=function(R,V,da){this.vertexIndices[3*this._triangleCount]=R;this.vertexIndices[3*this._triangleCount+1]=V;this.vertexIndices[3*this._triangleCount+2]=da;this.pathVertexIndices[3*this._triangleCount]=this.pathVertexData[R];this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[V];this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[da];this.normalIndices[3*this._triangleCount]=
R;this.normalIndices[3*this._triangleCount+1]=V;this.normalIndices[3*this._triangleCount+2]=da;++this._triangleCount};W._rebuildGeometry=function(){var R=(ca,ha,ia,ka,la)=>this.emitVertex(ca,ha,ia,ka,la);const V=(ca,ha,ia,ka,la,Y)=>this.emitCapVertex(ca,ha,ia,ka,la,Y);this._extrusionVertexCount=0;for(var da of this.path.vertices)this.originData[3*da.index]=da.pos[0],this.originData[3*da.index+1]=da.pos[1],this.originData[3*da.index+2]=da.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],
this.profile,V);for(da=1;da<this.path.vertices.length-1;++da)this.extruder.extrude(this.path.vertices[da],this.profile,R);this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,V);this.startCap.rebuildCapGeometry(this.path.vertices[0],V);this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],V);if(this.profile.hasUV()&&this.options.generateUV)for(R=0;R<this.profile.uvs.length;++R)this.uvData[2*R]=this.profile.uvs[R],this.uvData[2*
R+1]=0};W.buildTopology=function(){const R=(ia,ka,la)=>this.emitTriangle(ia,ka,la);this._triangleCount=0;const V=this.profile.vertices.length,da=this.profile.numSegments,ca=this.numExtrusionProfiles-1;var ha=da*ca*6;this.startCap.indexBufferStart=ha;this.startCap.firstProfileVertexIndex=0;ha+=this.startCap.getNumIndices();this.endCap.indexBufferStart=ha;this.endCap.firstProfileVertexIndex=V*(this.numExtrusionProfiles-1);ha+=this.endCap.getNumIndices();this.vertexIndices=new Uint32Array(ha);this.normalIndices=
new Uint32Array(ha);this.pathVertexIndices=new Uint32Array(ha);this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(ha));for(ha=0;ha<da;++ha){const ia=this.profile.vertexIndices[2*ha],ka=this.profile.vertexIndices[2*ha+1];for(let la=0;la<ca;++la){const Y=la*V+ia,ea=(la+1)*V+ka,ba=la*V+ka;R(Y,(la+1)*V+ia,ea);R(Y,ea,ba)}}this.startCap.buildTopology(this.path.vertices[0],R);this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],R)};W.onPathChanged=function(){this._rebuildGeometry()};
return aa}(),G=function(){function aa(W){this.builder=W}aa.prototype.onPathChanged=function(){this.builder.onPathChanged()};b._createClass(aa,[{key:"xform",get:function(){return this.builder.path.xform}}]);return aa}(),P=function(aa){function W(V){V=aa.call(this,V)||this;V.vertexAttributePosition=null;V.vertexAttributeNormal=null;V.vertexAttributeColor=null;V.vertexAttributePosition=new Float32Array(3*V.builder.numVerticesTotal);V.vertexAttributeNormal=new Float32Array(3*V.builder.numNormalsTotal);
V.vertexAttributeColor=new Uint8Array(4);V.vertexAttributeColor[0]=255;V.vertexAttributeColor[1]=255;V.vertexAttributeColor[2]=255;V.vertexAttributeColor[3]=255;return V}b._inheritsLoose(W,aa);var R=W.prototype;R.bakeVertexColors=function(V){this.vertexAttributeColor[0]=255*V[0];this.vertexAttributeColor[1]=255*V[1];this.vertexAttributeColor[2]=255*V[2];this.vertexAttributeColor[3]=255*(3<V.length?V[3]:1)};R.bake=function(V){this.size=V;for(let ia=0;ia<this.builder.numVerticesTotal;++ia){var da=this.builder.pathVertexData[ia],
ca=0===da||da===this.builder.path.vertices.length-1;da*=3;var ha=N;f.set(ha,this.builder.originData[da++],this.builder.originData[da++],this.builder.originData[da]);da=4*ia;const ka=H,la=M,Y=I,ea=O,ba=Q;let Z=0,fa=0;f.set(ea,this.builder.profileRightAxisData[da],this.builder.profileRightAxisData[da+1],this.builder.profileRightAxisData[da+2]);f.set(ba,this.builder.profileUpAxisData[da],this.builder.profileUpAxisData[da+1],this.builder.profileUpAxisData[da+2]);g.set(la,this.builder.profileVertexAndNormalData[da]*
V[0],this.builder.profileVertexAndNormalData[da+1]*V[1]);if(ca)f.cross(Y,ba,ea),Z=this.builder.profileRightAxisData[da+3]*V[0],fa=this.builder.profileUpAxisData[da+3];else{ca=L;const ja=J;g.set(ca,this.builder.profileRightAxisData[da+3],this.builder.profileUpAxisData[da+3]);const oa=g.length(ca);g.normalize(ca,ca);const sa=g.dot(la,ca);if(Math.abs(sa)>oa){g.set(ja,-ca[1],ca[0]);const qa=g.dot(la,ja);g.scale(ca,ca,oa*Math.sign(sa));g.scale(ja,ja,qa);g.add(la,ca,ja)}f.set(Y,0,0,0)}f.set(ka,ea[0]*la[0]+
ba[0]*la[1],ea[1]*la[0]+ba[1]*la[1],ea[2]*la[0]+ba[2]*la[1]);this.vertexAttributePosition[3*ia]=ha[0]+ka[0]+Y[0]*Z;this.vertexAttributePosition[3*ia+1]=ha[1]+ka[1]+Y[1]*Z;this.vertexAttributePosition[3*ia+2]=ha[2]+ka[2]+Y[2]*Z;ha=M;g.set(ha,this.builder.profileVertexAndNormalData[da+2],this.builder.profileVertexAndNormalData[da+3]);this.vertexAttributeNormal[3*ia]=ea[0]*ha[0]+ba[0]*ha[1]+Y[0]*fa;this.vertexAttributeNormal[3*ia+1]=ea[1]*ha[0]+ba[1]*ha[1]+Y[1]*fa;this.vertexAttributeNormal[3*ia+2]=
ea[2]*ha[0]+ba[2]*ha[1]+Y[2]*fa}};R.createGeometryData=function(){const V=[[w.VertexAttribute.POSITION,this.builder.vertexIndices],[w.VertexAttribute.NORMAL,this.builder.normalIndices]],da=[[w.VertexAttribute.POSITION,{size:3,data:this.vertexAttributePosition,exclusive:!0}],[w.VertexAttribute.NORMAL,{size:3,data:this.vertexAttributeNormal,exclusive:!0}]];this.vertexAttributeColor&&(V.push([w.VertexAttribute.COLOR,new Uint32Array(this.builder.vertexIndices.length)]),da.push([w.VertexAttribute.COLOR,
{size:4,data:this.vertexAttributeColor}]));return{vertexAttributes:da,indices:V}};R.onPathChanged=function(){aa.prototype.onPathChanged.call(this);this.bake(this.size)};R.intersect=function(V,da,ca){const ha=this.builder.vertexIndices;t.intersectTriangles(V,da,0,ha.length/3,ha,{size:3,data:this.vertexAttributePosition},void 0,void 0,ca)};return W}(G),K=function(aa){function W(R,V,da,ca){var ha=aa.call(this,R)||this;ha.sizeAttributeValue=V;ha.colorAttributeValue=da;ha.opacityAttributeValue=ca;ha.vvData=
null;ha.baked=new P(R);ha.vvData=new Float32Array(4*ha.builder.path.vertices.length);for(R=0;R<ha.builder.path.vertices.length;++R)ha.vvData[4*R]=V,ha.vvData[4*R+1]=da,ha.vvData[4*R+2]=ca,ha.vvData[4*R+3]=0===R||R===ha.builder.path.vertices.length-1?1:0;return ha}b._inheritsLoose(W,aa);W.prototype.createGeometryData=function(){return{vertexAttributes:[[w.VertexAttribute.POSITION,{size:3,data:this.builder.originData,exclusive:!0}],[w.VertexAttribute.PROFILERIGHT,{size:4,data:this.builder.profileRightAxisData,
exclusive:!0}],[w.VertexAttribute.PROFILEUP,{size:4,data:this.builder.profileUpAxisData,exclusive:!0}],[w.VertexAttribute.PROFILEVERTEXANDNORMAL,{size:4,data:this.builder.profileVertexAndNormalData,exclusive:!0}],[w.VertexAttribute.FEATUREVALUE,{size:4,data:this.vvData,exclusive:!0}]],indices:[[w.VertexAttribute.POSITION,this.builder.pathVertexIndices],[w.VertexAttribute.PROFILERIGHT,this.builder.vertexIndices],[w.VertexAttribute.PROFILEUP,this.builder.vertexIndices],[w.VertexAttribute.PROFILEVERTEXANDNORMAL,
this.builder.vertexIndices],[w.VertexAttribute.FEATUREVALUE,this.builder.pathVertexIndices]]}};return W}(G);const N=d.create(),M=k.create(),L=k.create(),J=k.create(),H=d.create(),I=d.create(),O=d.create(),Q=d.create(),S=d.create(),T=x(),U=n.create();a.Builder=F;a.CapBuilder=p;a.Extruder=function(){};a.FastUpdatePathGeometry=K;a.MiterExtruder=z;a.NoCapBuilder=y;a.Path=u;a.PathGeometryData=G;a.PathVertex=B;a.Profile=q;a.RoundCapBuilder=E;a.SimpleExtruder=C;a.StaticPathGeometry=P;a.TriangulationCapBuilder=
D;a.computeMinimumRotationTangentFrame=function(aa,W){let R=null;const V=aa.vertices.length,da=d.create(),ca=d.create(),ha=d.create(),ia=d.create(),ka=d.create(),la=d.create(),Y=e.create();let ea=aa.vertices[0];f.copy(ca,W);f.set(da,0,1,0);v.makeOrthoBasisDirUpFallback(ea.vRight,ca,da,da,ha,ca,.99619469809);f.copy(ea.frame.up,ca);f.copy(ea.frame.right,ha);R=ea;for(W=1;W<V;++W){ea=aa.vertices[W];f.add(ka,ea.vLeft,ea.vRight);let ba=f.length(ka);0<ba?(ba=1/Math.sqrt(ba),ka[0]*=ba,ka[1]*=ba,ka[2]*=ba):
(ka[0]=ea.vRight[0],ka[1]=ea.vRight[1],ka[2]=ea.vRight[2]);f.add(la,R.pos,R.frame.up);e.fromPositionAndNormal(ea.pos,ka,Y);e.intersectRay(Y,h.wrap(la,ea.vLeft),ia)?(f.subtract(ia,ia,ea.pos),f.normalize(ca,ia),f.cross(ha,ka,ca),f.normalize(ha,ha)):v.makeOrthoBasisDirUpFallback(ka,R.frame.up,R.frame.right,da,ha,ca,.99619469809);f.copy(ea.frame.up,ca);f.copy(ea.frame.right,ha);R=ea}};a.makeFrame=x;a.profileSpaceToVertexSpace=function(aa,W,R){aa[0]=R[0]*W.right[0]+R[1]*W.up[0];aa[1]=R[0]*W.right[1]+R[1]*
W.up[1];aa[2]=R[0]*W.right[2]+R[1]*W.up[2]};a.vertexSpaceToProfileSpace=function(aa,W,R){g.set(aa,f.dot(R,W.right),f.dot(R,W.up))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/mat2f64":function(){define(["exports"],function(a){function b(){return[1,0,0,1]}function c(n){return[n[0],n[1],n[2],n[3]]}function m(n,g,k,f){return[n,g,k,f]}function l(n,g){return new Float64Array(n,g,4)}const r=Object.freeze(Object.defineProperty({__proto__:null,
create:b,clone:c,fromValues:m,createView:l},Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;a.createView=l;a.fromValues=m;a.mat2f64=r})},"esri/views/3d/webgl-engine/materials/PathMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/shading/Normals.glsl ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/PathGeometry ../lib/RenderPass ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./PathTechnique ./internal/bufferWriterUtils ./internal/MaterialUtil".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u){e=function(p){function y(E){E=p.call(this,E,new z)||this;E.supportsEdges=!0;E._vertexAttributeLocations=B.pathVertexAttributeLocations;E._configuration=new B.PathTechniqueConfiguration;E.vertexBufferLayout=y.getVertexBufferLayout(E.parameters);return E}b._inheritsLoose(y,p);var D=y.prototype;D.getConfiguration=function(E,F){this._configuration.output=E;this._configuration.vvSize=this.parameters.vvSizeEnabled;this._configuration.vvColor=this.parameters.vvColorEnabled;
this._configuration.vvOpacity=this.parameters.vvOpacityEnabled;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=this.parameters.transparent;this._configuration.hasOccludees=this.parameters.hasOccludees;if(E===g.ShaderOutput.Color||E===g.ShaderOutput.Alpha)this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?k.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?
k.NormalsDoubleSidedMode.WindingOrder:k.NormalsDoubleSidedMode.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=F.ssaoHelper.ready?this.parameters.receiveSSAO:!1;this._configuration.transparencyPassType=F.transparencyPassType;this._configuration.hasMultipassTerrain=F.multipassTerrain.enabled;this._configuration.cullAboveGround=F.multipassTerrain.cullAboveGround;return this._configuration};D.isVisibleInPass=function(E){return E===v.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL||
E===v.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT||E===v.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT?this.parameters.castShadows:!0};D.isVisible=function(){const E=this.parameters;return p.prototype.isVisible.call(this)?0<E.opacity:!1};D.intersect=function(E,F,G,P,K,N,M){if(h.isPathGeometry(E)){F=E.path;G=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){var L=this.parameters.vvSizeOffset,J=this.parameters.vvSizeFactor;const H=this.parameters.vvSizeMinSize,I=this.parameters.vvSizeMaxSize,
O=F.sizeAttributeValue;G[0]*=c.clamp(L[0]+O*J[0],H[0],I[0]);G[1]*=c.clamp(L[2]+O*J[2],H[2],I[2])}L=Math.max(G[0],G[1]);E=E.boundingInfo;m.isNone(E)?this._intersectTriangles(F,G,K,N,M):(E=l.fromValues(E.bbMin[0]-L,E.bbMin[1]-L,E.bbMin[2]-L,E.bbMax[0]+L,E.bbMax[1]+L,E.bbMax[2]+L),L=[N[0]-K[0],N[1]-K[1],N[2]-K[2]],J=Math.sqrt(L[0]*L[0]+L[1]*L[1]+L[2]*L[2]),u.intersectAabbInvDir(E,K,[J/L[0],J/L[1],J/L[2]],P.tolerance)&&this._intersectTriangles(F,G,K,N,M))}};D._intersectTriangles=function(E,F,G,P,K){E.baked.size&&
E.baked.size[0]===F[0]&&E.baked.size[1]===F[1]||E.baked.bake(F);E.baked.intersect(G,P,K)};D.computeAttachmentOrigin=function(E,F){E=E.vertexAttributes;if(!E)return null;E=E.get(x.VertexAttribute.POSITION);return f.computeAttachmentOriginLines(E,null,!1,F)};D.createBufferWriter=function(){return new A(this.vertexBufferLayout)};D.requiresSlot=function(E){return E===(this.parameters.transparent?w.RenderSlot.TRANSPARENT_MATERIAL:w.RenderSlot.OPAQUE_MATERIAL)||E===w.RenderSlot.DRAPED_MATERIAL};D.createGLMaterial=
function(E){return E.output===g.ShaderOutput.Color||E.output===g.ShaderOutput.Alpha||E.output===g.ShaderOutput.Depth||E.output===g.ShaderOutput.Normal||E.output===g.ShaderOutput.Highlight||E.output===g.ShaderOutput.Shadow&&this.parameters.castShadows?new C(E):null};y.getVertexBufferLayout=function(E){let F=n.newLayout().vec3f(x.VertexAttribute.POSITION).vec4f(x.VertexAttribute.PROFILERIGHT).vec4f(x.VertexAttribute.PROFILEUP).vec4f(x.VertexAttribute.PROFILEVERTEXANDNORMAL);if(E.vvColorEnabled||E.vvSizeEnabled||
E.vvOpacityEnabled)F=F.vec4f(x.VertexAttribute.FEATUREVALUE);return F};return y}(e.Material);let C=function(p){function y(){return p.apply(this,arguments)||this}b._inheritsLoose(y,p);var D=y.prototype;D._updateOccludeeState=function(E){E.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:E.hasOccludees})};D._updateShadowState=function(E){(m.isNone(this.technique)||E.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:E.shadowMap.enabled})};
D.beginSlot=function(E){if(this._output===g.ShaderOutput.Color||this._output===g.ShaderOutput.Alpha)this._updateShadowState(E),this._updateOccludeeState(E);return this.ensureTechnique(B.PathTechnique,E)};return y}(d),z=function(p){function y(){var D=p.apply(this,arguments)||this;D.doubleSided=!1;D.doubleSidedType="normal";D.receiveSSAO=!0;D.receiveShadows=!1;D.castShadows=!0;D.hasSlicePlane=!1;D.transparent=!1;D.hasOccludees=!1;return D}b._inheritsLoose(y,p);return y}(B.PathPassParameters),A=function(){function p(D){this.vertexBufferLayout=
D}var y=p.prototype;y.allocate=function(D){return this.vertexBufferLayout.createBuffer(D)};y.elementCount=function(D){return D.indices.get(x.VertexAttribute.POSITION).length};y.write=function(D,E,F,G){const P=K=>{if(E.vertexAttributes.has(K)){const N=E.vertexAttributes.get(K),M=E.indices.get(K);t.assert(4===N.size);const L=F.getField(K,r.BufferViewVec4f);if(L)q.writeBufferVec4(M,N.data,L,G);else throw Error("unable to acquire view for "+K);}};P(x.VertexAttribute.PROFILERIGHT);P(x.VertexAttribute.PROFILEUP);
P(x.VertexAttribute.PROFILEVERTEXANDNORMAL);this.vertexBufferLayout.hasField(x.VertexAttribute.FEATUREVALUE)&&P(x.VertexAttribute.FEATUREVALUE);q.writeDefaultAttributes(E,this.vertexBufferLayout,D.transformation,D.invTranspTransformation,F,G)};return p}();a.PathMaterial=e;a.PathMaterialParameters=z;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/PathTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../chunks/vec3f64 ../../../ViewingMode ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/attributes/PathVertexPosition.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/util/DoublePrecision.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/VertexAttribute ./DefaultTechniqueConfiguration ../../../../chunks/Path.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z){const A=new Map([[q.VertexAttribute.POSITION,0],[q.VertexAttribute.PROFILERIGHT,1],[q.VertexAttribute.PROFILEUP,2],[q.VertexAttribute.PROFILEVERTEXANDNORMAL,3],[q.VertexAttribute.FEATUREVALUE,4]]);g=function(p){function y(){var D=p.apply(this,arguments)||this;D.ambient=l.fromValues(.2,.2,.2);D.diffuse=l.fromValues(.8,.8,.8);D.specular=l.fromValues(0,0,0);D.opacity=1;return D}c._inheritsLoose(y,p);return y}(g.PathVertexPositionPassParameters);h=
function(p){function y(){return p.apply(this,arguments)||this}c._inheritsLoose(y,p);var D=y.prototype;D.initializeConfiguration=function(E,F){F.spherical=E.viewingMode===r.ViewingMode.Global;F.doublePrecisionRequiresObfuscation=d.doublePrecisionRequiresObfuscation(E.rctx)};D.initializeProgram=function(E){const F=y.shader.get().build(this.configuration);return new x.Program(E.rctx,F,A)};D._setPipelineState=function(E){const F=this.configuration,G=E===w.TransparencyPassType.NONE,P=E===w.TransparencyPassType.FrontFace;
return z.makePipelineState({blending:F.output!==n.ShaderOutput.Color&&F.output!==n.ShaderOutput.Alpha||!F.transparent?null:G?t.blendingDefault:t.oitBlending(E),culling:(F.hasSlicePlane?!1:!F.transparent&&F.doubleSidedMode!==k.NormalsDoubleSidedMode.None)&&z.frontFaceCullingParams,depthTest:{func:t.oitDepthTest(E)},depthWrite:G||P?z.defaultDepthWriteParams:null,colorWrite:z.defaultColorWriteParams,stencilWrite:F.hasOccludees?B.stencilWriteMaskOn:null,stencilTest:F.hasOccludees?B.stencilBaseAllZerosParams:
null,polygonOffset:G||P?null:t.OITPolygonOffset})};D.initializePipeline=function(){return this._setPipelineState(this.configuration.transparencyPassType)};return y}(h.ShaderTechnique);h.shader=new e.ReloadableShaderModule(C.Path,()=>new Promise((p,y)=>a(["../shaders/Path.glsl"],p,y)));e=function(p){function y(){var D=p.apply(this,arguments)||this;D.output=n.ShaderOutput.Color;D.doubleSidedMode=k.NormalsDoubleSidedMode.None;D.transparencyPassType=w.TransparencyPassType.NONE;D.spherical=!1;D.receiveShadows=
!1;D.receiveAmbientOcclusion=!1;D.vvSize=!1;D.vvColor=!1;D.vvOpacity=!1;D.hasSlicePlane=!1;D.transparent=!1;D.hasOccludees=!1;D.hasMultipassTerrain=!1;D.cullAboveGround=!1;D.doublePrecisionRequiresObfuscation=!1;return D}c._inheritsLoose(y,p);return y}(u.DefaultTechniqueConfiguration);m.__decorate([v.parameter({count:n.ShaderOutput.COUNT})],e.prototype,"output",void 0);m.__decorate([v.parameter({count:k.NormalsDoubleSidedMode.COUNT})],e.prototype,"doubleSidedMode",void 0);m.__decorate([v.parameter({count:w.TransparencyPassType.COUNT})],
e.prototype,"transparencyPassType",void 0);m.__decorate([v.parameter()],e.prototype,"spherical",void 0);m.__decorate([v.parameter()],e.prototype,"receiveShadows",void 0);m.__decorate([v.parameter()],e.prototype,"receiveAmbientOcclusion",void 0);m.__decorate([v.parameter()],e.prototype,"vvSize",void 0);m.__decorate([v.parameter()],e.prototype,"vvColor",void 0);m.__decorate([v.parameter()],e.prototype,"vvOpacity",void 0);m.__decorate([v.parameter()],e.prototype,"hasSlicePlane",void 0);m.__decorate([v.parameter()],
e.prototype,"transparent",void 0);m.__decorate([v.parameter()],e.prototype,"hasOccludees",void 0);m.__decorate([v.parameter()],e.prototype,"hasMultipassTerrain",void 0);m.__decorate([v.parameter()],e.prototype,"cullAboveGround",void 0);m.__decorate([v.parameter()],e.prototype,"doublePrecisionRequiresObfuscation",void 0);m.__decorate([v.parameter({constValue:f.PBRMode.Disabled})],e.prototype,"pbrMode",void 0);m.__decorate([v.parameter({constValue:!0})],e.prototype,"hasVvInstancing",void 0);m.__decorate([v.parameter({constValue:!1})],
e.prototype,"useCustomDTRExponentForWater",void 0);m.__decorate([v.parameter({constValue:!1})],e.prototype,"useFillLights",void 0);b.PathPassParameters=g;b.PathTechnique=h;b.PathTechniqueConfiguration=e;b.pathVertexAttributeLocations=A;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec2f64 ./PositionAttribute.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/Float3PassUniform ../../shaderModules/Float4sPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute ../../../materials/VisualVariablePassParameters".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){let e=function(h){function v(){var w=h.apply(this,arguments)||this;w.size=c.fromValues(1,1);return w}b._inheritsLoose(v,h);return v}(d.VisualVariablePassParameters);a.PathVertexPosition=function(h,v){h.attributes.add(f.VertexAttribute.FEATUREVALUE,"vec4");const w=h.vertex;w.code.add(k.glsl`bool isCapVertex() {
return featureValue.w == 1.0;
}`);w.uniforms.add(new l.Float2PassUniform("size",t=>t.size));v.vvSize?(w.uniforms.add(new r.Float3PassUniform("vvSizeMinSize",t=>t.vvSizeMinSize)),w.uniforms.add(new r.Float3PassUniform("vvSizeMaxSize",t=>t.vvSizeMaxSize)),w.uniforms.add(new r.Float3PassUniform("vvSizeOffset",t=>t.vvSizeOffset)),w.uniforms.add(new r.Float3PassUniform("vvSizeFactor",t=>t.vvSizeFactor)),w.code.add(k.glsl`vec2 getSize() {
return size * clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
}`)):w.code.add(k.glsl`vec2 getSize(){
return size;
}`);v.vvOpacity?(w.constants.add("vvOpacityNumber","int",8),w.uniforms.add([new g.FloatsPassUniform("vvOpacityValues",t=>t.vvOpacityValues,8),new g.FloatsPassUniform("vvOpacityOpacities",t=>t.vvOpacityOpacities,8)]),w.code.add(k.glsl`vec4 applyOpacity(vec4 color) {
float value = featureValue.z;
if (value <= vvOpacityValues[0]) {
return vec4( color.xyz, vvOpacityOpacities[0]);
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
}
}
return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
}`)):w.code.add(k.glsl`vec4 applyOpacity(vec4 color){
return color;
}`);v.vvColor?(w.constants.add("vvColorNumber","int",d.vvColorNumber),w.uniforms.add([new g.FloatsPassUniform("vvColorValues",t=>t.vvColorValues,d.vvColorNumber),new n.Float4sPassUniform("vvColorColors",t=>t.vvColorColors,d.vvColorNumber)]),w.code.add(k.glsl`vec4 getColor() {
float value = featureValue.y;
if (value <= vvColorValues[0]) {
return applyOpacity(vvColorColors[0]);
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
}
}
return applyOpacity(vvColorColors[vvColorNumber - 1]);
}`)):w.code.add(k.glsl`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`);h.include(m.PositionAttribute);h.attributes.add(f.VertexAttribute.PROFILERIGHT,"vec4");h.attributes.add(f.VertexAttribute.PROFILEUP,"vec4");h.attributes.add(f.VertexAttribute.PROFILEVERTEXANDNORMAL,"vec4");w.code.add(k.glsl`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`);w.code.add(k.glsl`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`);w.code.add(k.glsl`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`);w.code.add(k.glsl`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)};a.PathVertexPositionPassParameters=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/Path.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4Uniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/basicInterfaces ../views/3d/webgl-engine/lighting/SceneLighting".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y){function D(F){const G=new A.ShaderBuilder,P=t.addProjViewLocalOrigin(G,F),{vertex:K,fragment:N}=G;G.varyings.add("vpos","vec3");G.include(r.PathVertexPosition,F);if(F.output===c.ShaderOutput.Color||F.output===c.ShaderOutput.Alpha)G.include(l.Transform),G.include(v.ReadShadowMapDraw,F),G.include(b.ForwardLinearDepth,F),G.varyings.add("vnormal","vec3"),G.varyings.add("vcolor","vec4"),F.hasMultipassTerrain&&G.varyings.add("depth","float"),K.code.add(C.glsl`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${F.hasMultipassTerrain?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${F.output===c.ShaderOutput.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `);G.include(d.multipassTerrainTest,F);F.output===c.ShaderOutput.Alpha&&(G.include(m.SliceDraw,F),N.uniforms.add(new u.FloatPassUniform("opacity",M=>M.opacity)),N.code.add(C.glsl`
      void main() {
        discardBySlice(vpos);
        ${F.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `));F.output===c.ShaderOutput.Color&&(G.include(m.SliceDraw,F),G.include(f.EvaluateSceneLighting,F),G.include(k.EvaluateAmbientOcclusion,F),G.include(v.ReadShadowMapDraw,F),G.include(e.Normals,F),t.addCameraPosition(N,F),N.uniforms.add([P,new B.Float3PassUniform("ambient",M=>M.ambient),new B.Float3PassUniform("diffuse",M=>M.diffuse),new B.Float3PassUniform("specular",M=>M.specular),new u.FloatPassUniform("opacity",M=>M.opacity),new u.FloatPassUniform("lightingGlobalFactor",(M,L)=>L.lighting.globalFactor),
new B.Float3PassUniform("lightingMainIntensity",(M,L)=>L.lighting.mainLight.intensity)]),N.constants.add("ambientBoostFactor","float",y.ambientBoost),N.include(w.ColorConversion),N.code.add(C.glsl`
      void main() {
        discardBySlice(vpos);
        ${F.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        shadingParams.normalView = vnormal;
        vec3 normal = shadingNormal(shadingParams);
        float ssao = evaluateAmbientOcclusionInverse();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${F.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":F.spherical?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
        float combinedOpacity = vcolor.a * opacity;
        albedo += 0.25 * specular; // don't completely ignore specular for now

        vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
        gl_FragColor = vec4(shadedColor, combinedOpacity);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${F.transparencyPassType===p.TransparencyPassType.Color?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));if(F.output===c.ShaderOutput.Depth||F.output===c.ShaderOutput.Shadow)G.include(l.Transform,{hasModelTransformation:!1,linearDepth:!0}),K.uniforms.add(new x.Float2PassUniform("nearFar",(M,L)=>L.camera.nearFar)),G.varyings.add("depth","float"),K.code.add(C.glsl`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),G.include(m.SliceDraw,F),G.include(n.OutputDepth,F),N.code.add(C.glsl`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);F.output===c.ShaderOutput.Normal&&(G.include(l.Transform),G.include(h.NormalUtils,F),K.uniforms.add(new z.Matrix4PassUniform("viewNormal",(M,L)=>L.camera.viewInverseTransposeMatrix)),G.varyings.add("vnormal","vec3"),K.code.add(C.glsl`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),G.include(m.SliceDraw,F),N.uniforms.add(new q.Float4Uniform("waterColor")),N.code.add(C.glsl`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`));F.output===c.ShaderOutput.Highlight&&(G.include(l.Transform),G.include(h.NormalUtils,F),G.varyings.add("vnormal","vec3"),K.code.add(C.glsl`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),G.include(m.SliceDraw,F),G.include(g.OutputHighlight),N.code.add(C.glsl`void main() {
discardBySlice(vpos);
outputHighlight();
}`));return G}const E=Object.freeze(Object.defineProperty({__proto__:null,build:D},Symbol.toStringTag,{value:"Module"}));a.Path=E;a.build=D})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/earcut ../../../../chunks/mat4f64 ../../../../chunks/vec4 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ./polygonUtils ../support/patternUtils ../support/uvUtils ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D){const E=["polyline","polygon","extent"];w=function(K){function N(L,J,H,I){L=K.call(this,L,J,H,I)||this;L._needsUV=!1;L._hasOutline=!1;return L}b._inheritsLoose(N,K);var M=N.prototype;M.doLoad=function(){var L=b._asyncToGenerator(function*(){});return function(){return L.apply(this,arguments)}}();M._ensureMaterials=function(){this._ensureFillMaterial();this._ensureOutlineMaterial()};M._ensureFillMaterial=function(){if(!m.isSome(this._material)){var L=
m.get(this.symbolLayer,"material","color");L=this._getCombinedOpacityAndColor(L);this._material=q.createMaterial(this.symbolLayer,{color:L,transparent:1>L[3]||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped});this._needsUV=this._material instanceof y.PatternMaterial;this._context.stage.add(this._material)}};M._ensureOutlineMaterial=function(){const L=this.symbolLayer.outline;!m.isSome(this._outlineMaterial)&&
this._isValidOutline(L)&&(this._hasOutline=!0,this._outlineMaterial=(J=>{const H=p.getStipplePatternForLinePattern(L.pattern);return new D.RibbonLineMaterial({width:J,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:H,stippleScaleWithLineWidth:!0,cap:x.parseCapType(L.patternCap||"butt")})})(l.pt2px(L.size)),this._context.stage.add(this._outlineMaterial))};M._isValidOutline=function(L){return m.isSome(L)&&L.size&&0<L.size&&m.isSome(L.color)&&
(m.isNone(L.pattern)||"style"!==L.pattern.type||"none"!==L.pattern.style)};M.destroy=function(){K.prototype.destroy.call(this);this._context.stage.remove(this._material);this._material=null;this._context.stage.remove(this._outlineMaterial);this._outlineMaterial=null};M.createGraphics3DGraphic=function(L){const J=L.graphic;if(!this._validateGeometry(J.geometry,E,this.symbolLayer.type))return null;L=this._getVertexOpacityAndColor(L.renderingInfo,255);const H=this.setGraphicElevationContext(J,new e.ElevationContext);
this.ensureDrapedStatus("on-the-ground"===H.mode);this._ensureMaterials();return this.draped?this._createAsOverlay(J,L):this._createAs3DShape(J,L,H)};M.layerOpacityChanged=function(){if(m.isSome(this._material)){var L=this._material.parameters.color,J=m.get(this.symbolLayer,"material","color");J=this._getCombinedOpacity(J);this._material.setParameters({color:[L[0],L[1],L[2],J],transparent:1>J||this.needsDrivenTransparentPass})}m.isSome(this._outlineMaterial)&&(L=this._outlineMaterial.parameters.color,
this._outlineMaterial.setParameters({color:[L[0],L[1],L[2],this._getOutlineOpacity()]}));return!0};M.layerElevationInfoChanged=function(L,J,H){const I=this._elevationContext.mode;H=d.elevationModeChangeUpdateType(N.elevationModeChangeTypes,H,I);if(H!==d.SymbolUpdateType.UPDATE)return H;const O=d.needsElevationUpdates2D(I);return this.updateGraphics3DGraphicElevationInfo(L,J,()=>O)};M.slicePlaneEnabledChanged=function(){m.isSome(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});
m.isSome(this._outlineMaterial)&&this._outlineMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};M.physicalBasedRenderingChanged=function(){return!0};M.pixelRatioChanged=function(){return!0};M._createAs3DShape=function(L,J,H){const I=B.geometryAsPolygon(L.geometry);if(m.isNone(I))return null;G.renderData=B.geometryToRenderInfo(I,this._context.elevationProvider,this._context.renderCoordsHelper,H);G.color=J;J=G.renderData.position.length/3;this._needsUV&&(G.uvMapSpace=
new Float32Array(4*J),G.boundingRect=new Float64Array(9*J));G.outNum=0;G.outGeometries=[];G.outTransforms=[];G.outMaterials=[];this._createAs3DShapeFill(G);this._hasOutline&&this._createAs3DShapeOutline(G);this._logGeometryCreationWarnings(G.renderData,I.rings,"rings","FillSymbol3DLayer");if(0===G.outNum)return null;this._needsUV&&u.createMapSpaceUVCoords(f.BufferViewVec4f.fromTypedArray(G.uvMapSpace),f.BufferViewVec3f64.fromTypedArray(G.renderData.position),this._context.renderCoordsHelper,f.BufferViewMat3f64.fromTypedArray(G.boundingRect));
L=new C.Object3D({geometries:G.outGeometries,materials:G.outMaterials,transformations:G.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:L.uid}});L=new v.Graphics3DObject3DGraphicLayer(this,L,G.outGeometries,null,null,q.uvElevationAligner,H);L.alignedSampledElevation=G.renderData.sampledElevation;L.needsElevationUpdates=d.needsElevationUpdates2D(H.mode);return L};M._createAs3DShapeFill=function(L){var J=L.renderData.polygons;for(const {position:H,mapPosition:I,holeIndices:O,
index:Q,count:S}of J){if(m.isSome(this._context.clippingExtent)&&(k.empty(F),k.expandWithBuffer(F,I),!k.intersectsClippingArea(F,this._context.clippingExtent)))continue;J=r.earcut(I,O,3);0!==J.length&&(J=new Uint32Array(J),J=B.createColorGeometry({indices:J,attributeData:{position:H,color:L.color,mapPosition:I,uvMapSpace:this._needsUV?new Float32Array(L.uvMapSpace.buffer,4*Q*L.uvMapSpace.BYTES_PER_ELEMENT,4*S):null,boundingRect:this._needsUV?new Float64Array(L.boundingRect.buffer,9*Q*L.boundingRect.BYTES_PER_ELEMENT,
9*S):null}}),L.outGeometries.push(J),L.outMaterials.push(m.unwrap(this._material)),L.outTransforms.push(n.IDENTITY),L.outNum++)}};M._createAs3DShapeOutline=function(L){if(this._hasOutline){var J=L.renderData.outlines;for(let H=0;H<J.length;++H){const {mapPosition:I,position:O}=J[H];if(m.isSome(this._context.clippingExtent)&&(k.empty(F),k.expandWithBuffer(F,I),!k.intersectsClippingArea(F,this._context.clippingExtent)))continue;const Q=x.createGeometry({overlayInfo:null,removeDuplicateStartEnd:x.RemoveDuplicateStartEnd.REMOVE,
attributeData:{position:O,mapPosition:I}}),S=Q.vertexAttributes.get(A.VertexAttribute.POSITION);S.data===O&&(S.data=new Float64Array(O));L.outGeometries.push(Q);L.outMaterials.push(m.unwrap(this._outlineMaterial));L.outTransforms.push(n.IDENTITY);L.outNum++}}};M._createAsOverlay=function(L,J){const H=B.geometryAsPolygon(L.geometry);if(m.isNone(H))return null;m.unwrap(this._material).renderPriority=this._renderPriority+this._renderPriorityStep/2;m.isSome(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=
this._renderPriority);P.renderData=B.geometryToRenderInfoDraped(H,this._context.overlaySR);P.color=J;J=P.renderData.position.length/3;this._needsUV&&(P.uvMapSpace=new Float32Array(4*J));P.outNum=0;P.outGeometries=[];P.outBoundingBox=k.empty();P.layerUid=this._context.layer.uid;P.graphicsUid=L.uid;this._createAsOverlayFill(P);this._hasOutline&&this._createAsOverlayOutline(P);this._logGeometryCreationWarnings(P.renderData,H.rings,"rings","FillSymbol3DLayer");if(0===P.outNum)return null;this._needsUV&&
u.createMapSpaceUVCoordsDraped(f.BufferViewVec4f.fromTypedArray(P.uvMapSpace),f.BufferViewVec3f64.fromTypedArray(P.renderData.position),this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode);return 0<P.outNum?new h(this,P.outGeometries,P.outBoundingBox,this._context.drapeSourceRenderer):null};M._createAsOverlayFill=function(L){var J=L.renderData.polygons;for(const {position:H,holeIndices:I,index:O,count:Q}of J){k.empty(F);k.expandWithBuffer(F,H);if(!k.intersectsClippingArea(F,
this._context.clippingExtent))continue;J=r.earcut(H,I,3);if(0===J.length)continue;k.expandWithAABB(L.outBoundingBox,F);J=new Uint32Array(J);J=B.createColorGeometry({indices:J,attributeData:{position:H,color:L.color,uvMapSpace:this._needsUV?new Float32Array(L.uvMapSpace.buffer,4*O*L.uvMapSpace.BYTES_PER_ELEMENT,4*Q):null}});J=new z.RenderGeometry(J,m.unwrap(this._material),{layerUid:L.layerUid,graphicUid:L.graphicsUid});const S=F;g.set(J.boundingSphere,.5*(S[0]+S[3]),.5*(S[1]+S[4]),0,.5*Math.sqrt((S[3]-
S[0])*(S[3]-S[0])+(S[4]-S[1])*(S[4]-S[1])));L.outGeometries.push(J);L.outNum++}};M._createAsOverlayOutline=function(L){if(this._hasOutline){var J=L.renderData.outlines;for(let I=0;I<J.length;++I){var {position:H}=J[I];k.empty(F);k.expandWithBuffer(F,H);if(!k.intersectsClippingArea(F,this._context.clippingExtent))continue;k.expandWithAABB(L.outBoundingBox,F);H=x.createGeometry({overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:x.RemoveDuplicateStartEnd.REMOVE,
attributeData:{position:H}});H=new z.RenderGeometry(H,m.unwrap(this._outlineMaterial),{layerUid:L.layerUid,graphicUid:L.graphicsUid});const O=F;g.set(H.boundingSphere,.5*(O[0]+O[3]),.5*(O[1]+O[4]),0,.5*Math.sqrt((O[3]-O[0])*(O[3]-O[0])+(O[4]-O[1])*(O[4]-O[1])));L.outGeometries.push(H);L.outNum++}}};M._getOutlineOpacity=function(){const L=m.get(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(m.isSome(L)?L.a:0)};M._getOutlineColor=function(){const L=m.get(this.symbolLayer,
"outline","color"),J=this._getOutlineOpacity();return t.mixinColorAndOpacity(m.isSome(L)?c.toUnitRGB(L):null,J)};M.test=function(){return{...K.prototype.test.call(this),createAsOverlay:(L,J)=>this._createAsOverlay(L,J),createAs3DShape:(L,J,H)=>this._createAs3DShape(L,J,H)}};return N}(w.Graphics3DSymbolLayer);w.elevationModeChangeTypes={definedChanged:d.SymbolUpdateType.RECREATE,staysOnTheGround:d.SymbolUpdateType.NONE,onTheGroundChanged:d.SymbolUpdateType.RECREATE};const F=k.create(),G={renderData:null,
color:null,uvMapSpace:null,boundingRect:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},P={renderData:null,color:null,uvMapSpace:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};a.Graphics3DPolygonFillSymbolLayer=w;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/patternUtils":function(){define("exports ../../../../core/has ../../../../core/maybe ../../../../chunks/vec4f64 ../../../../geometry/support/buffer/BufferView ../graphics/ElevationAligners ./uvUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/ColorMaterial ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/PatternStyle".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){function e(t,x,B){if(c.isSome(t)){if("none"===t.style||"solid"===t.style)return"none"===t.style&&(x.color=m.fromValues(0,0,0,0),x.transparent=!0),new k.ColorMaterial(x);x.style=h(t.style);x.draped=B.isDraped;return new f.PatternMaterial(x)}return new k.ColorMaterial(x)}function h(t){switch(t){case "horizontal":return d.Style.Horizontal;case "vertical":return d.Style.Vertical;case "cross":return d.Style.Cross;case "forward-diagonal":return d.Style.ForwardDiagonal;case "backward-diagonal":return d.Style.BackwardDiagonal;
case "diagonal-cross":return d.Style.DiagonalCross}}function v(t){return t.material instanceof f.PatternMaterial&&!t.material.parameters.draped}function w(t,x){if(v(t)){var B=t.geometry.vertexAttributes;t=B.get(g.VertexAttribute.POSITION).data;const q=B.get(g.VertexAttribute.UVMAPSPACE).data;B=B.get(g.VertexAttribute.BOUNDINGRECT).data;n.createMapSpaceUVCoords(l.BufferViewVec4f.fromTypedArray(q),l.BufferViewVec3f64.fromTypedArray(t),x,l.BufferViewMat3f64.fromTypedArray(B))}}a.createMaterial=function(t,
x,B){return e(t&&t.pattern||null,x,B)};a.createMaterialFromPattern=e;a.parsePatternStyle=h;a.requiresUVUpdates=v;a.updateMapSpaceUVCoords=w;a.uvElevationAligner=function(t,x,B,q){x=r.perVertexElevationAligner(t,x,B,q);t=t.stageObject.geometryRecords;for(B=0;B<t.length;B++)w(t[B],q);return x};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/uvUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/support/plane ../../../../geometry/support/buffer/BufferView ../../../ViewingMode".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e){function h(K,N,M,L,J,H,I){r.set(K,N*J[0]+M*H[0]+L*I[0],N*J[1]+M*H[1]+L*I[1],N*J[2]+M*H[2]+L*I[2])}const v=n.create(),w=n.create(),t=f.create(),x=n.create(),B=n.create(),q=n.create(),u=l.create(),C=l.create(),z=l.create(),A=n.create(),p=n.create(),y=n.create(),D=c.create(),E=n.create(),F=n.create(),G=n.create(),P=n.create();a.createMapSpaceUVCoords=function(K,N,M,L,J=1){r.set(x,1,0,0);r.set(B,0,1,0);r.set(q,0,0,1);r.set(P,0,0,0);for(var H=0;H<N.count-1;H++)N.getVec(H,
w),r.add(P,P,w);r.scale(v,P,1/(N.count-1));H=N.count-1;if(H=f.fromManyPointsSampleAt(N,t,0,Math.floor(H/3),Math.floor(2/3*H))){b.isSome(M)?(M.basisMatrixAtPosition(v,D),r.set(E,D[0],D[1],D[2]),r.set(F,D[4],D[5],D[6]),r.set(G,D[8],D[9],D[10])):(r.set(E,1,0,0),r.set(F,0,1,0),r.set(G,0,0,1));M=f.normal(t);0>r.dot(M,G)&&r.scale(M,M,-1);r.copy(q,M);H=r.dot(M,F);var I=r.dot(M,E);Math.abs(H)<Math.abs(I)?(r.scaleAndAdd(x,E,M,-I),r.normalize(x,x),r.cross(B,x,M),r.normalize(B,B),r.scale(B,B,-1)):(r.scaleAndAdd(B,
F,M,-H),r.normalize(B,B),r.cross(x,B,M),r.normalize(x,x))}m.set(u,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);m.set(C,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(M=0;M<N.count;M++)N.getVec(M,w),H=r.dot(x,w),I=r.dot(B,w),u[0]=Math.min(u[0],H),u[1]=Math.min(u[1],I),C[0]=Math.max(C[0],H),C[1]=Math.max(C[1],I);M=r.dot(q,v);h(A,u[0],u[1],M,x,B,q);h(p,C[0],u[1],M,x,B,q);h(y,u[0],C[1],M,x,B,q);r.subtract(p,p,A);r.scale(p,p,.5);r.subtract(y,y,A);r.scale(y,y,.5);r.add(A,A,p);r.add(A,A,y);
M=u[1]%J;z[0]=u[0]-u[0]%J;z[1]=u[1]-M;for(M=0;M<N.count;M++)for(N.getVec(M,w),K.setValues(M,(r.dot(x,w)-z[0])/J,(r.dot(B,w)-z[1])/J,z[0]/J,z[1]/J),H=0;3>H;H++)L.set(M,H,A[H]),L.set(M,H+3,p[H]),L.set(M,H+6,y[H])};a.createMapSpaceUVCoordsDraped=function(K,N,M,L,J=1){if(M.isGeographic&&L===e.ViewingMode.Global){L=new Float64Array(N.typedBuffer.length);const H=3*N.count;M=k.getReferenceEllipsoid(M);for(let I=0;I<H;I+=3)g.lonLatToWebMercatorComparable(N.typedBuffer,I,L,I,M);N=d.BufferViewVec3f64.fromTypedArray(L)}m.set(u,
Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(L=0;L<N.count;L++)N.getVec(L,w),u[0]=Math.min(u[0],w[0]),u[1]=Math.min(u[1],w[1]);L=u[1]%J;z[0]=u[0]-u[0]%J;z[1]=u[1]-L;for(L=0;L<N.count;L++)N.getVec(L,w),K.setValues(L,(w[0]-z[0])/J,(w[1]-z[1])/J,z[0]/J,z[1]/J)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec4f64 ../core/shaderLibrary/ShaderOutputOptions ../lib/basicInterfaces ../lib/GLMaterial ../lib/GLMaterials ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ./internal/DefaultBufferWriter ./internal/MaterialUtil ../shaders/ColorMaterialTechnique ../shaders/ColorMaterialTechniqueConfiguration".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){let w=function(B){function q(C){C=B.call(this,C,new x)||this;C.supportsEdges=!0;C._configuration=new v.ColorMaterialTechniqueConfiguration;return C}b._inheritsLoose(q,B);var u=q.prototype;u.getConfiguration=function(C,z){this._configuration.output=C;this._configuration.cullFace=this.parameters.cullFace;this._configuration.hasVertexColors=this.parameters.hasVertexColors;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=
this.parameters.transparent;this._configuration.polygonOffset=this.parameters.polygonOffset;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.transparencyPassType=z.transparencyPassType;this._configuration.enableOffset=z.camera.relativeElevation<k.OITPolygonOffsetLimit;this._configuration.hasMultipassTerrain=z.multipassTerrain.enabled;this._configuration.cullAboveGround=z.multipassTerrain.cullAboveGround;return this._configuration};
u.intersect=function(C,z,A,p,y,D,E){e.intersectTriangleGeometry(C,z,p,y,D,void 0,E)};u.requiresSlot=function(C,z){return C===f.RenderSlot.DRAPED_MATERIAL?!0:n.outputFromPass(z)===m.ShaderOutput.Highlight?C===f.RenderSlot.OPAQUE_MATERIAL:C===(this.parameters.transparent?this.parameters.writeDepth?f.RenderSlot.TRANSPARENT_MATERIAL:f.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:f.RenderSlot.OPAQUE_MATERIAL)};u.createGLMaterial=function(C){return C.output===m.ShaderOutput.Color||C.output===m.ShaderOutput.Alpha||
C.output===m.ShaderOutput.Highlight||C.output===m.ShaderOutput.Depth&&this.parameters.writeLinearDepth?new t(C):null};u.createBufferWriter=function(){return new d.DefaultBufferWriter(d.PositionColorLayout)};return q}(g.Material),t=function(B){function q(){return B.apply(this,arguments)||this}b._inheritsLoose(q,B);var u=q.prototype;u._updateOccludeeState=function(C){C.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:C.hasOccludees})};u.beginSlot=function(C){this._output!==
m.ShaderOutput.Color&&this._output!==m.ShaderOutput.Alpha||this._updateOccludeeState(C);return this.ensureTechnique(h.ColorMaterialTechnique,C)};return q}(r),x=function(B){function q(){var u=B.apply(this,arguments)||this;u.color=c.ZEROS;u.transparent=!1;u.writeDepth=!0;u.writeLinearDepth=!1;u.hasVertexColors=!1;u.polygonOffset=!1;u.hasSlicePlane=!1;u.cullFace=l.CullFaceOptions.None;u.hasOccludees=!1;return u}b._inheritsLoose(q,B);return q}(g.MaterialParameters);a.ColorMaterial=w;a.Parameters=x;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/ShaderOutputOptions ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../../../../chunks/ColorMaterial.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h){r=function(w){function t(){return w.apply(this,arguments)||this}c._inheritsLoose(t,w);var x=t.prototype;x.initializeProgram=function(B){const q=t.shader.get().build(this.configuration);return new f.Program(B.rctx,q,g.Default3D)};x._createPipeline=function(B,q){const u=this.configuration,C=B===n.TransparencyPassType.NONE,z=B===n.TransparencyPassType.FrontFace;return h.makePipelineState({blending:u.output!==m.ShaderOutput.Color&&u.output!==m.ShaderOutput.Alpha||!u.transparent?
null:C?k.blendingDefault:k.oitBlending(B),culling:h.cullingParams(u.cullFace),depthTest:{func:k.oitDepthTest(B)},depthWrite:C||z?u.writeDepth&&h.defaultDepthWriteParams:null,colorWrite:h.defaultColorWriteParams,stencilWrite:u.hasOccludees?d.stencilWriteMaskOn:null,stencilTest:u.hasOccludees?q?d.stencilToolMaskBaseParams:d.stencilBaseAllZerosParams:null,polygonOffset:C||z?u.polygonOffset&&v:k.getOITPolygonOffset(u.enableOffset)})};x.initializePipeline=function(){this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,
!0);return this._createPipeline(this.configuration.transparencyPassType,!1)};x.getPipelineState=function(B,q){return q?this._occludeePipelineState:w.prototype.getPipelineState.call(this,B,q)};return t}(r.ShaderTechnique);r.shader=new l.ReloadableShaderModule(e.ColorMaterial,()=>new Promise((w,t)=>a(["./ColorMaterial.glsl"],w,t)));const v={factor:1,units:1};b.ColorMaterialTechnique=r;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/ColorMaterial.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/basicInterfaces ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x){function B(u){const C=new w.ShaderBuilder,z=u.output===b.ShaderOutput.Depth,A=u.hasMultipassTerrain&&(u.output===b.ShaderOutput.Color||u.output===b.ShaderOutput.Alpha);d.addProjViewLocalOrigin(C,u);C.include(m.Transform,{hasModelTransformation:!1,linearDepth:z});C.include(l.VertexColor,u);C.attributes.add(x.VertexAttribute.POSITION,"vec3");C.varyings.add("vpos","vec3");A&&C.varyings.add("depth","float");const {vertex:p,fragment:y}=C;z&&(C.include(r.OutputDepth,
u),p.uniforms.add(new e.Float2PassUniform("nearFar",(D,E)=>E.camera.nearFar)),C.varyings.add("linearDepth","float"));p.code.add(v.glsl`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${A?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${z?v.glsl`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:v.glsl`transformPosition(proj, view, vpos);`}
    }
  `);C.include(c.SliceDraw,u);A&&C.include(g.multipassTerrainTest,u);y.include(f.ColorConversion);y.uniforms.add(new h.Float4PassUniform("eColor",D=>D.color));u.output===b.ShaderOutput.Highlight&&C.include(n.OutputHighlight);y.code.add(v.glsl`
  void main() {
    discardBySlice(vpos);
    ${A?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${u.hasVertexColors?"vColor * eColor;":"eColor;"}

    if (fColor.a < ${v.glsl.float(k.symbolAlphaCutoff)}) {
      discard;
    }

    ${u.output===b.ShaderOutput.Alpha?v.glsl`gl_FragColor = vec4(fColor.a);`:""}

    ${u.output===b.ShaderOutput.Color?v.glsl`gl_FragColor = highlightSlice(fColor, vpos); ${u.transparencyPassType===t.TransparencyPassType.Color?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}`:""}
    ${u.output===b.ShaderOutput.Highlight?v.glsl`outputHighlight();`:""};
    ${u.output===b.ShaderOutput.Depth?v.glsl`outputDepth(linearDepth);`:""};
  }
  `);return C}const q=Object.freeze(Object.defineProperty({__proto__:null,build:B},Symbol.toStringTag,{value:"Module"}));a.ColorMaterial=q;a.build=B})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../materials/DefaultTechniqueConfiguration".split(" "),function(a,
b,c,m,l,r,n){n=function(g){function k(){var f=g.apply(this,arguments)||this;f.output=m.ShaderOutput.Color;f.cullFace=r.CullFaceOptions.None;f.hasSlicePlane=!1;f.hasVertexColors=!1;f.transparent=!1;f.polygonOffset=!1;f.enableOffset=!0;f.writeDepth=!0;f.hasOccludees=!1;f.transparencyPassType=r.TransparencyPassType.NONE;f.hasMultipassTerrain=!1;f.cullAboveGround=!1;return f}b._inheritsLoose(k,g);return k}(n.DefaultTechniqueConfiguration);c.__decorate([l.parameter({count:m.ShaderOutput.COUNT})],n.prototype,
"output",void 0);c.__decorate([l.parameter({count:r.CullFaceOptions.COUNT})],n.prototype,"cullFace",void 0);c.__decorate([l.parameter()],n.prototype,"hasSlicePlane",void 0);c.__decorate([l.parameter()],n.prototype,"hasVertexColors",void 0);c.__decorate([l.parameter()],n.prototype,"transparent",void 0);c.__decorate([l.parameter()],n.prototype,"polygonOffset",void 0);c.__decorate([l.parameter()],n.prototype,"enableOffset",void 0);c.__decorate([l.parameter()],n.prototype,"writeDepth",void 0);c.__decorate([l.parameter()],
n.prototype,"hasOccludees",void 0);c.__decorate([l.parameter({count:r.TransparencyPassType.COUNT})],n.prototype,"transparencyPassType",void 0);c.__decorate([l.parameter()],n.prototype,"hasMultipassTerrain",void 0);c.__decorate([l.parameter()],n.prototype,"cullAboveGround",void 0);a.ColorMaterialTechniqueConfiguration=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/PatternMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec4f64 ../../../../geometry/support/buffer/BufferView ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../lib/basicInterfaces ../lib/GLMaterial ../lib/GLMaterials ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./PatternStyle ./internal/bufferWriterUtils ./internal/DefaultBufferWriter ./internal/MaterialUtil ../shaders/PatternTechnique".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q){let u=function(p){function y(E){E=p.call(this,E,new A)||this;E.supportsEdges=!0;E._vertexAttributeLocations=q.patternVertexAttributeLocations;E.techniqueConfig=new q.PatternTechniqueConfiguration;return E}b._inheritsLoose(y,p);var D=y.prototype;D.getConfiguration=function(E,F){this.techniqueConfig.output=E;this.techniqueConfig.cullFace=this.parameters.cullFace;this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors;this.techniqueConfig.hasSlicePlane=
this.parameters.hasSlicePlane;this.techniqueConfig.polygonOffset=this.parameters.polygonOffset;this.techniqueConfig.writeDepth=this.parameters.writeDepth;this.techniqueConfig.style=this.parameters.style;this.techniqueConfig.patternSpacing=this.parameters.patternSpacing;this.techniqueConfig.lineWidth=this.parameters.lineWidth;this.techniqueConfig.draped=this.parameters.draped;this.techniqueConfig.transparencyPassType=F.transparencyPassType;this.techniqueConfig.enableOffset=F.camera.relativeElevation<
d.OITPolygonOffsetLimit;this.techniqueConfig.hasMultipassTerrain=F.multipassTerrain.enabled;this.techniqueConfig.cullAboveGround=F.multipassTerrain.cullAboveGround;return this.techniqueConfig};D.intersect=function(E,F,G,P,K,N,M){B.intersectTriangleGeometry(E,F,P,K,N,void 0,M)};D.requiresSlot=function(E,F){return E===e.RenderSlot.DRAPED_MATERIAL?!0:k.outputFromPass(F)===r.ShaderOutput.Highlight?E===e.RenderSlot.OPAQUE_MATERIAL:E===(this.parameters.writeDepth?e.RenderSlot.TRANSPARENT_MATERIAL:e.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL)};
D.createGLMaterial=function(E){return E.output===r.ShaderOutput.Color||E.output===r.ShaderOutput.Alpha||E.output===r.ShaderOutput.Highlight||E.output===r.ShaderOutput.Depth&&this.parameters.writeLinearDepth?new C(E):null};D.createBufferWriter=function(){const E=l.newLayout().vec3f(v.VertexAttribute.POSITION).vec4u8(v.VertexAttribute.COLOR).vec4f(v.VertexAttribute.UVMAPSPACE);this.parameters.draped||E.mat3f(v.VertexAttribute.BOUNDINGRECT);return new z(E)};return y}(f.Material),C=function(p){function y(){return p.apply(this,
arguments)||this}b._inheritsLoose(y,p);var D=y.prototype;D._updateParameters=function(E){return this.ensureTechnique(q.PatternTechnique,E)};D._updateOccludeeState=function(E){E.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:E.hasOccludees})};D.beginSlot=function(E){this._output!==r.ShaderOutput.Color&&this._output!==r.ShaderOutput.Alpha||this._updateOccludeeState(E);return this._updateParameters(E)};return y}(g),z=function(p){function y(){return p.apply(this,
arguments)||this}b._inheritsLoose(y,p);var D=y.prototype;D.write=function(E,F,G,P){for(const N of this.vertexBufferLayout.fieldNames){const M=F.vertexAttributes.get(N),L=F.indices.get(N);if(M&&L)switch(N){case v.VertexAttribute.POSITION:h.assert(3===M.size);var K=G.getField(N,m.BufferViewVec3f);K&&t.writePosition(L,M.data,E.transformation,K,P);break;case v.VertexAttribute.COLOR:h.assert(3===M.size||4===M.size);(K=G.getField(N,m.BufferViewVec4u8))&&t.writeColor(L,M.data,M.size,K,P);break;case v.VertexAttribute.UVMAPSPACE:h.assert(4===
M.size);(K=G.getField(N,m.BufferViewVec4f))&&t.writeBufferVec4(L,M.data,K,P);break;case v.VertexAttribute.BOUNDINGRECT:h.assert(9===M.size),(K=G.getField(N,m.BufferViewMat3f))&&this.writeBoundingRect(L,M.data,E.transformation,K,P)}}};D.writeBoundingRect=function(E,F,G,P,K){const N=P.typedBuffer;P=P.typedBufferStride;const M=E.length;K*=P;for(let J=0;J<M;++J){const H=9*E[J];var L=F[H];const I=F[H+1],O=F[H+2];N[K]=G[0]*L+G[4]*I+G[8]*O+G[12];N[K+1]=G[1]*L+G[5]*I+G[9]*O+G[13];N[K+2]=G[2]*L+G[6]*I+G[10]*
O+G[14];for(L=3;9>L;++L)N[K+L]=F[H+L];K+=P}};return y}(x.DefaultBufferWriter),A=function(p){function y(){var D=p.apply(this,arguments)||this;D.color=c.fromValues(1,1,1,1);D.writeDepth=!0;D.writeLinearDepth=!1;D.hasVertexColors=!1;D.polygonOffset=!1;D.hasSlicePlane=!1;D.cullFace=n.CullFaceOptions.None;D.hasOccludees=!1;D.style=w.Style.Cross;D.patternSpacing=10;D.lineWidth=1;D.draped=!0;return D}b._inheritsLoose(y,p);return y}(f.MaterialParameters);a.Parameters=A;a.PatternMaterial=u;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/PatternStyle":function(){define(["exports"],function(a){a.Style=void 0;var b=a.Style||(a.Style={});b[b.Horizontal=0]="Horizontal";b[b.Vertical=1]="Vertical";b[b.Cross=2]="Cross";b[b.ForwardDiagonal=3]="ForwardDiagonal";b[b.BackwardDiagonal=4]="BackwardDiagonal";b[b.DiagonalCross=5]="DiagonalCross";b[b.COUNT=6]="COUNT";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/shaders/PatternTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/VertexAttribute ../materials/DefaultTechniqueConfiguration ../materials/PatternStyle ../../../../chunks/Pattern.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x){n=function(u){function C(){return u.apply(this,arguments)||this}c._inheritsLoose(C,u);var z=C.prototype;z.initializeProgram=function(A){const p=C.shader.get().build(this.configuration);return new d.Program(A.rctx,p,q)};z._setPipelineState=function(A,p){const y=this.configuration,D=A===k.TransparencyPassType.NONE,E=A===k.TransparencyPassType.FrontFace;return x.makePipelineState({blending:y.output===l.ShaderOutput.Color||y.output===l.ShaderOutput.Alpha?D?
f.blendingDefault:f.oitBlending(A):null,culling:x.cullingParams(y.cullFace),depthTest:{func:f.oitDepthTest(A)},depthWrite:D?y.writeDepth&&x.defaultDepthWriteParams:f.oitDepthWrite(A),colorWrite:x.defaultColorWriteParams,stencilWrite:y.hasOccludees?e.stencilWriteMaskOn:null,stencilTest:y.hasOccludees?p?e.stencilToolMaskBaseParams:e.stencilBaseAllZerosParams:null,polygonOffset:D||E?y.polygonOffset&&B:f.getOITPolygonOffset(y.enableOffset)})};z.initializePipeline=function(){this._occludeePipelineState=
this._setPipelineState(this.configuration.transparencyPassType,!0);return this._setPipelineState(this.configuration.transparencyPassType,!1)};z.getPipelineState=function(A,p){return p?this._occludeePipelineState:u.prototype.getPipelineState.call(this,A,p)};return C}(n.ShaderTechnique);n.shader=new r.ReloadableShaderModule(t.Pattern,()=>new Promise((u,C)=>a(["./Pattern.glsl"],u,C)));const B={factor:1,units:1};r=function(u){function C(){var z=u.apply(this,arguments)||this;z.output=l.ShaderOutput.Color;
z.cullFace=k.CullFaceOptions.None;z.transparencyPassType=k.TransparencyPassType.NONE;z.hasSlicePlane=!1;z.hasVertexColors=!1;z.polygonOffset=!1;z.writeDepth=!0;z.hasOccludees=!1;z.enableOffset=!0;z.hasMultipassTerrain=!1;z.cullAboveGround=!1;return z}c._inheritsLoose(C,u);return C}(v.DefaultTechniqueConfiguration);m.__decorate([g.parameter({count:l.ShaderOutput.COUNT})],r.prototype,"output",void 0);m.__decorate([g.parameter({count:k.CullFaceOptions.COUNT})],r.prototype,"cullFace",void 0);m.__decorate([g.parameter({count:w.Style.COUNT})],
r.prototype,"style",void 0);m.__decorate([g.parameter({count:k.TransparencyPassType.COUNT})],r.prototype,"transparencyPassType",void 0);m.__decorate([g.parameter()],r.prototype,"hasSlicePlane",void 0);m.__decorate([g.parameter()],r.prototype,"hasVertexColors",void 0);m.__decorate([g.parameter()],r.prototype,"polygonOffset",void 0);m.__decorate([g.parameter()],r.prototype,"writeDepth",void 0);m.__decorate([g.parameter()],r.prototype,"hasOccludees",void 0);m.__decorate([g.parameter()],r.prototype,"patternSpacing",
void 0);m.__decorate([g.parameter()],r.prototype,"lineWidth",void 0);m.__decorate([g.parameter()],r.prototype,"enableOffset",void 0);m.__decorate([g.parameter()],r.prototype,"draped",void 0);m.__decorate([g.parameter()],r.prototype,"hasMultipassTerrain",void 0);m.__decorate([g.parameter()],r.prototype,"cullAboveGround",void 0);const q=new Map([[h.VertexAttribute.POSITION,0],[h.VertexAttribute.COLOR,3],[h.VertexAttribute.UVMAPSPACE,4],[h.VertexAttribute.BOUNDINGRECT,5]]);b.PatternTechnique=n;b.PatternTechniqueConfiguration=
r;b.patternVertexAttributeLocations=q;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/Pattern.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/basicInterfaces ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/materials/PatternStyle".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q){function u(A){const p=new t.ShaderBuilder,y=A.hasMultipassTerrain&&(A.output===b.ShaderOutput.Color||A.output===b.ShaderOutput.Alpha);A.draped||p.extensions.add("GL_OES_standard_derivatives");const D=A.output===b.ShaderOutput.Depth,{vertex:E,fragment:F}=p;d.addProjViewLocalOrigin(p,A);p.include(m.Transform,{hasModelTransformation:!1,linearDepth:D});p.include(l.VertexColor,A);D&&(p.include(r.OutputDepth,A),E.uniforms.add(new e.Float2PassUniform("nearFar",
(P,K)=>K.camera.nearFar)),p.varyings.add("linearDepth","float"));A.draped?E.uniforms.add(new v.FloatPassUniform("worldToScreenRatio",(P,K)=>1/K.screenToPCSRatio)):p.attributes.add(B.VertexAttribute.BOUNDINGRECT,"mat3");p.attributes.add(B.VertexAttribute.POSITION,"vec3");p.attributes.add(B.VertexAttribute.UVMAPSPACE,"vec4");p.varyings.add("vpos","vec3");p.varyings.add("vuv","vec2");y&&p.varyings.add("depth","float");const G=A.style===q.Style.ForwardDiagonal||A.style===q.Style.BackwardDiagonal||A.style===
q.Style.DiagonalCross;G&&E.code.add(w.glsl`
      const mat2 rotate45 = mat2(${w.glsl.float(.70710678118)}, ${w.glsl.float(-.70710678118)},
                                 ${w.glsl.float(.70710678118)}, ${w.glsl.float(.70710678118)});
    `);A.draped||(d.addCameraPosition(E,A),E.uniforms.add(new v.FloatPassUniform("worldToScreenPerDistanceRatio",(P,K)=>1/K.camera.perScreenPixelRatio)),E.code.add(w.glsl`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),E.code.add(w.glsl`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),E.code.add(w.glsl`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${w.glsl.float(.08715574274)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `));E.code.add(w.glsl`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${G?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${G?" * rotate45":""};

      ${A.draped?"":w.glsl`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${w.glsl.float(A.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);E.code.add(w.glsl`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${y?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${D?w.glsl`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:w.glsl`transformPosition(proj, view, vpos);`}
    }
  `);p.include(c.SliceDraw,A);F.include(f.ColorConversion);A.draped&&F.uniforms.add(new v.FloatPassUniform("texelSize",(P,K)=>1/K.camera.pixelRatio));A.output===b.ShaderOutput.Highlight&&p.include(n.OutputHighlight);y&&p.include(g.multipassTerrainTest,A);A.output!==b.ShaderOutput.Highlight&&(F.code.add(w.glsl`
      const float lineWidth = ${w.glsl.float(A.lineWidth)};
      const float spacing = ${w.glsl.float(A.patternSpacing)};
      const float spacingINV = ${w.glsl.float(1/A.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),A.draped||F.code.add(w.glsl`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`));F.uniforms.add(new h.Float4PassUniform("uColor",P=>P.color));F.code.add(w.glsl`
    void main() {
      discardBySlice(vpos);
      ${y?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${A.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${A.output!==b.ShaderOutput.Highlight?w.glsl`color.a *= ${C(A)};`:""}

      if (color.a < ${w.glsl.float(k.symbolAlphaCutoff)}) {
        discard;
      }

      ${A.output===b.ShaderOutput.Alpha?w.glsl`gl_FragColor = vec4(color.a);`:""}

      ${A.output===b.ShaderOutput.Color?w.glsl`gl_FragColor = color; ${A.transparencyPassType===x.TransparencyPassType.Color?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}`:""}
      ${A.output===b.ShaderOutput.Highlight?w.glsl`outputHighlight();`:""}
      ${A.output===b.ShaderOutput.Depth?w.glsl`outputDepth(linearDepth);`:""};
    }
  `);return p}function C(A){function p(y){return A.draped?w.glsl`coverage(vuv.${y}, texelSize)`:w.glsl`sample(vuv.${y})`}switch(A.style){case q.Style.ForwardDiagonal:case q.Style.Horizontal:return p("y");case q.Style.BackwardDiagonal:case q.Style.Vertical:return p("x");case q.Style.DiagonalCross:case q.Style.Cross:return w.glsl`
        1.0 - (1.0 - ${p("x")}) * (1.0 - ${p("y")})
      `;default:return"0.0"}}const z=Object.freeze(Object.defineProperty({__proto__:null,build:u},Symbol.toStringTag,{value:"Module"}));a.Pattern=z;a.build=u})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../chunks/vec2f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./placementUtils ./pointUtils ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureFactory ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u){function C(D,E,F){D&&D.forEach(G=>{const P=E(G);m.isSome(P)&&F(P,G.graphic)})}function z(D,E){if("baseline"===E.verticalPlacement)return E=w.horizontalPlacementToAnchorX[E.horizontalPlacement],D=m.isSome(D)?D.baselineAnchorY:0,n.fromValues(E,D);D=w.anchorFromPlacements(E.horizontalPlacement,E.verticalPlacement);return w.namedAnchorToHUDMaterialAnchorPos[D]}const A=[0,0,1];h=function(D){function E(G,P,K,N){G=D.call(this,G,P,K,N)||this;G._elevationOptions=
{supportsOffsetAdjustment:!0,supportsOnTheGround:!1};G.ensureDrapedStatus(!1);return G}b._inheritsLoose(E,D);var F=E.prototype;F.doLoad=function(){var G=b._asyncToGenerator(function*(){if(!this._drivenProperties.size){const P=v.validateSymbolLayerSize(this.symbolLayer.size);if(P)throw new c("graphics3dtextsymbollayer:invalid-size",P);}yield this._createTextRenderParameters()});return function(){return G.apply(this,arguments)}}();F._createTextRenderParameters=function(){var G=b._asyncToGenerator(function*(){this._textRenderParameters=
yield B.TextRenderParameters.fromSymbol(this.symbolLayer,this._context.graphicsCoreOwner.view.state.pixelRatio)});return function(){return G.apply(this,arguments)}}();F.destroy=function(){D.prototype.destroy.call(this)};F.createGraphics3DGraphic=function(G){G=G.graphic;const P=t.placePointOnGeometry(G.geometry);if(m.isNone(P))return this.logger.warn(`unsupported geometry type for text symbol: ${G.geometry.type}`),null;const K=this.symbolLayer.text;if(m.isNone(K)||""===K)return null;var N=g.hasCalloutSupport(this.symbol)&&
this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(m.isSome(N)&&!g.textSymbolLayerSupportsVerticalOffset(this.symbolLayer))return this.logger.errorOncePerTick("Callouts and vertical offset on text symbols are currently only supported with 'center' "+`horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;N={...y,verticalOffset:N,horizontalPlacement:this.symbolLayer.horizontalAlignment,verticalPlacement:w.verticalPlacementFromAlignment(this.symbolLayer.verticalAlignment)};
return this._createAs3DShape(G,P,K,N)};F.createLabel=function(G,P,K,N){G=G.graphic;const M=t.placePointOnGeometry(G.geometry);if(m.isNone(M))return this.logger.warn(`unsupported geometry type for label: ${G.geometry.type}`),null;const L=P.text;return!L||/^\s+$/.test(L)?null:this._createAs3DShape(G,M,L,P,K,N)};F.setGraphicElevationContext=function(G,P,K=0){G=D.prototype.setGraphicElevationContext.call(this,G,P);G.addOffsetRenderUnits(K);return G};F.layerOpacityChanged=function(){this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");
return!1};F.layerElevationInfoChanged=function(G,P){C(G,P,(K,N)=>{this.updateGraphicElevationContext(N,K)});return f.SymbolUpdateType.UPDATE};F.slicePlaneEnabledChanged=function(G,P){C(G,P,K=>{for(const N of K.stageObject.geometryRecords)N.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});return!0};F.physicalBasedRenderingChanged=function(){return!0};F.pixelRatioChanged=function(){return!1};F.updateGraphicElevationContext=function(G,P){this.setGraphicElevationContext(G,P.elevationContext,
P.metadata.elevationOffset);P.needsElevationUpdates=f.needsElevationUpdates2D(P.elevationContext.mode)||"absolute-height"===P.elevationContext.mode};F._defaultElevationInfoNoZ=function(){return p};F._createAs3DShape=function(G,P,K,N,M,L){const J=this.setGraphicElevationContext(G,new d.ElevationContext,N.elevationOffset);var H="polyline"===m.get(G.geometry,"type");G=G.uid;let I=null;var O=null;if(m.isNone(L)){O=w.textRenderAlignmentFromHorizontalPlacement(N.horizontalPlacement);I=new q(K,O,this._textRenderParameters);
let U=null;O=this._context.sharedResources.textures.fromData(I.key,()=>m.unwrap(I).create(),()=>{m.isSome(U)&&U.release()});var Q=this._context.stage.renderView.textureRepository.acquire(O.texture.id);if(m.isNone(Q)||l.isPromiseLike(Q))return O.release(),null;U=Q}Q=z(I,N);Q={occlusionTest:!0,screenOffset:N.screenOffset,anchorPosition:Q,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:N.centerOffsetUnits,debugDrawLabelBorder:N.debugDrawLabelBorder,drawInSecondSlot:!0};m.isSome(O)&&(Q.textureId=O.texture.id);
m.isSome(L)&&(Q.textureId=L.id);if(m.isSome(N.verticalOffset)){const {screenLength:U,minWorldLength:aa,maxWorldLength:W}=N.verticalOffset;Q.verticalOffset={screenLength:r.pt2px(U),minWorldLength:aa||0,maxWorldLength:null!=W?W:Infinity}}if(this._context.screenSizePerspectiveEnabled){const {screenSizePerspectiveSettings:U,screenSizePerspectiveSettingsLabels:aa}=this._context.sharedResources;Q.screenSizePerspective=aa.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]);
Q.screenSizePerspectiveAlignment=U}H&&(Q.shaderPolygonOffset=1E-4);Q.hasSlicePlane=this._context.slicePlaneEnabled;m.isSome(M)?(H=JSON.stringify(Q),L=M.get(H),m.isNone(L)&&(L=new u.HUDMaterial(Q),M.add(H,L))):L=new u.HUDMaterial(Q);L=[L];H=N.translation;Q=m.isSome(I)?[I.displayWidth,I.displayHeight]:[0,0];H=[x.createPointGeometry(A,H,null,Q,N.centerOffset,[0,0],null)];G=t.createStageObjectForHUD(this._context,P,H,L,J,this._context.layer.uid,G);if(null===G)return null;M=new e.Graphics3DObject3DGraphicLayer(this,
G.object,H,m.isNone(M)?L:null,O,k.perObjectElevationAligner,J);M.alignedSampledElevation=G.sampledElevation;M.needsElevationUpdates=f.needsElevationUpdates2D(J.mode)||"absolute-height"===J.mode;const {displayWidth:S,displayHeight:T}=m.isSome(I)?I:N;M.getScreenSize=(U=n.create())=>{U[0]=S;U[1]=T;return U};M.metadata={labelText:K,elevationOffset:N.elevationOffset};t.extendPointGraphicElevationContext(M,P,this._context.elevationProvider);return M};return E}(h.Graphics3DSymbolLayer);const p={mode:"relative-to-ground",
offset:0},y={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],horizontalPlacement:"center",verticalPlacement:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawLabelBorder:!1,displayWidth:0,displayHeight:0};a.Graphics3DTextSymbolLayer=h;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextRenderParameters":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/Logger ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec4f64".split(" "),
function(a,b,c,m,l,r,n){const g=m.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters");m=function(){function k(d){this.definition=d;this.key=JSON.stringify(d);this.haloSize=Math.round(d.halo.size);this.textStyle=this._colorToRGBA(d.color);this.haloStyle=this._colorToRGB(d.halo.color);this.backgroundStyle=0!==d.background.color[3]?this._colorToRGBA(d.background.color):null}var f=k.prototype;f.fontString=function(d){const e=this.definition.font;return`${e.style} ${e.weight} ${d}px ${e.family}, sans-serif`};
f._colorToRGB=function(d){return`rgb(${d.slice(0,3).map(e=>Math.floor(255*e)).toString()})`};f._colorToRGBA=function(d){return`rgba(${d.slice(0,3).map(e=>Math.floor(255*e)).toString()},${d[3]})`};k.fromSymbol=function(){var d=b._asyncToGenerator(function*(e,h=1){var v=l.get(e,"material","color");const w=l.mapOr(v,n.ZEROS,c.toUnitRGBA);v=l.mapOr(e.size,12,r.pt2px);const t=e.lineHeight,x=l.isSome(e.background)?c.toUnitRGBA(e.background.color):n.ZEROS,B={family:l.mapOr(e.font,"sans-serif",u=>u.family),
decoration:l.mapOr(e.font,"none",u=>u.decoration),weight:l.mapOr(e.font,"normal",u=>u.weight),style:l.mapOr(e.font,"normal",u=>u.style)};var q=e.halo;q=l.isSome(q)&&l.isSome(q.color)&&0<q.size?{size:r.pt2px(q.size),color:c.toUnitRGBA(q.color)}:{size:0,color:n.ZEROS};e=new k({color:w,size:v,background:{color:x,padding:l.isSome(e.background)?[.65*v,.5*v]:[0,0],borderRadius:l.isSome(e.background)?.375*v:0},lineSpacingFactor:t,font:B,halo:q,pixelRatio:h});h=e.fontString(v);try{yield document.fonts.load(h)}catch(u){g.warnOnce(`Failed to preload font '${h}'. Some text symbology may be rendered using the default browser font.`)}return e});
return function(e){return d.apply(this,arguments)}}();return k}();a.TextRenderParameters=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextTextureFactory":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./basicInterfaces","./TextRenderer","./Texture","../../../webgl/enums"],function(a,b,c,m,l){const r={canvas:null};return function(){function n(g,k,f){this._renderer=new c.TextRenderer(g,k,f)}n.prototype.create=
function(){const g=c.getTextHelperCanvas(r,this._renderer.renderedWidth,this._renderer.renderedHeight),k=g.getContext("2d");k.save();this._renderer.render(k,0,0);k.restore();return new m.Texture(g,{wrap:{s:l.TextureWrapMode.CLAMP_TO_EDGE,t:l.TextureWrapMode.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:b.PowerOfTwoResizeMode.PAD})};a._createClass(n,[{key:"key",get:function(){return this._renderer.key}},{key:"baselineAnchorY",get:function(){return 1-this._renderer.firstRenderedBaselinePosition/
this._renderer.renderedHeight}},{key:"displayWidth",get:function(){return this._renderer.displayWidth}},{key:"displayHeight",get:function(){return this._renderer.displayHeight}}]);return n}()})},"esri/views/3d/layers/graphics/Graphics3DWaterSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/unitUtils ../../../../chunks/earcut ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec4 ../../../../chunks/common ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./polygonUtils ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/WaterMaterial ../../webgl-engine/materials/internal/waterMaterialUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p){const y=["polyline","polygon","extent"];q=function(N){function M(J,H,I,O){return N.call(this,J,H,I,O)||this}b._inheritsLoose(M,N);var L=M.prototype;L.doLoad=function(){var J=b._asyncToGenerator(function*(){});return function(){return J.apply(this,arguments)}}();L.destroy=function(){N.prototype.destroy.call(this);this._context.stage.remove(this._material);this._material=null};L.createGraphics3DGraphic=function(J){J=J.graphic;if(!this._validateGeometry(J.geometry,
y,this.symbolLayer.type))return null;const H=this.setGraphicElevationContext(J,new t.ElevationContext);this.ensureDrapedStatus("on-the-ground"===H.mode);this.ensureMaterial();return this.draped?this._createAsOverlay(J):this._createAs3DShape(J,H,J.uid)};L.ensureMaterial=function(){if(!m.isSome(this._material)){var J=new A.WaterMaterialParameters,H=this.symbolLayer.color;m.isSome(H)&&(J.color=c.toUnitRGBA(H));H=this._getCombinedOpacity(H,{hasIntrinsicColor:!0});J.color=[J.color[0],J.color[1],J.color[2],
H];J.transparent=1>H||this.needsDrivenTransparentPass;J.waveDirection=m.isSome(this.symbolLayer.waveDirection)?M.headingVectorFromAngle(this.symbolLayer.waveDirection):k.fromValues(0,0);H=p.wavePresets[this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize];J.waveStrength=H.waveStrength;J.waveTextureRepeat=H.textureRepeat;J.waveVelocity=H.waveVelocity;J.flowStrength=H.perturbationStrength;J.hasSlicePlane=this._context.slicePlaneEnabled;J.isDraped=this.draped;this._material=new A.WaterMaterial(J);
this._context.stage.add(this._material)}};L.layerOpacityChanged=function(){if(m.isNone(this._material))return!0;const J=this._material.parameters.color,H=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0});this._material.setParameters({color:[J[0],J[1],J[2],H],transparent:1>H||this.needsDrivenTransparentPass});return!0};L.layerElevationInfoChanged=function(J,H,I){const O=this._elevationContext.mode;I=w.elevationModeChangeUpdateType(M.elevationModeChangeTypes,I,O);if(I!==w.SymbolUpdateType.UPDATE)return I;
const Q=w.needsElevationUpdates2D(O);return this.updateGraphics3DGraphicElevationInfo(J,H,()=>Q)};L.slicePlaneEnabledChanged=function(){m.isSome(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};L.physicalBasedRenderingChanged=function(){return!0};L.pixelRatioChanged=function(){return!0};L._createAs3DShape=function(J,H,I){J=u.geometryAsPolygon(J.geometry);if(m.isNone(J))return null;P.renderData=u.geometryToRenderInfo(J,this._context.elevationProvider,
this._context.renderCoordsHelper,H);const O=P.renderData.position.length/3;P.uvCoords=new Float64Array(2*O);P.outNum=0;P.outGeometries=[];P.outTransforms=[];P.outMaterials=[];this._create3DShapeGeometries(P);this._logGeometryCreationWarnings(P.renderData,J.rings,"rings","WaterSymbol3DLayer");if(0===P.outNum)return null;this._createUVCoordsFromVertices(P.uvCoords,P.renderData.mapPosition,O,this._context.elevationProvider.spatialReference);I=new C.Object3D({geometries:P.outGeometries,materials:P.outMaterials,
transformations:P.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:I}});I=new B.Graphics3DObject3DGraphicLayer(this,I,P.outGeometries,null,null,v.perVertexElevationAligner,H);I.alignedSampledElevation=P.renderData.sampledElevation;I.needsElevationUpdates=w.needsElevationUpdates2D(H.mode);return I};L._createUVCoordsFromVertices=function(J,H,I,O){O=l.getMetersPerUnitForSR(O);h.empty(E);for(var Q=0;Q<I;Q++)g.set(F,H[3*Q],H[3*Q+1]),h.expandPointInPlace(E,F);f.scale(E,
E,O);Q=E[1]%M.unitSizeOfTexture;D[0]=E[0]-E[0]%M.unitSizeOfTexture;D[1]=E[1]-Q;for(Q=0;Q<I;Q++)J[2*Q]=(H[3*Q]*O-D[0])/M.unitSizeOfTexture,J[2*Q+1]=(H[3*Q+1]*O-D[1])/M.unitSizeOfTexture};L._create3DShapeGeometries=function(J){var H=J.renderData.polygons;const I=J.uvCoords;for(const {count:O,index:Q,position:S,mapPosition:T,holeIndices:U}of H){if(m.isSome(this._context.clippingExtent)&&(e.empty(G),e.expandWithBuffer(G,T),!e.intersectsClippingArea(G,this._context.clippingExtent)))continue;H=r.earcut(T,
U,3);if(0===H.length)continue;H=new Uint32Array(H);const aa=new Float64Array(I.buffer,2*Q*I.BYTES_PER_ELEMENT,2*O);H=u.createWaterGeometry({indices:H,attributeData:{position:S,uv0:aa,mapPosition:T}});J.outGeometries.push(H);J.outMaterials.push(m.unwrap(this._material));J.outTransforms.push(n.IDENTITY);J.outNum++}};L._createAsOverlay=function(J){const H=u.geometryAsPolygon(J.geometry);if(m.isNone(H))return null;m.unwrap(this._material).renderPriority=this._renderPriority;K.renderData=u.geometryToRenderInfoDraped(H,
this._context.overlaySR);const I=K.renderData.position.length/3;K.uvCoords=new Float64Array(2*I);K.outNum=0;K.outGeometries=[];K.outBoundingBox=e.empty();K.layerUid=this._context.layer.uid;K.graphicsUid=J.uid;this._createAsOverlayWater(K);this._logGeometryCreationWarnings(K.renderData,H.rings,"rings","WaterSymbol3DLayer");if(0===K.outNum)return null;this._createUVCoordsFromVertices(K.uvCoords,K.renderData.position,I,this._context.overlaySR);return 0<K.outNum?new x(this,K.outGeometries,K.outBoundingBox,
this._context.drapeSourceRenderer):null};L._createAsOverlayWater=function(J){const H=J.uvCoords;var I=J.renderData.polygons;for(const {position:Q,holeIndices:S,index:T,count:U}of I)if(e.empty(G),e.expandWithBuffer(G,Q),e.intersectsClippingArea(G,this._context.clippingExtent)&&(e.expandWithAABB(J.outBoundingBox,G),I=r.earcut(Q,S,3),0!==I.length)){I=new Uint32Array(I);var O=new Float64Array(H.buffer,2*T*H.BYTES_PER_ELEMENT,2*U);I=u.createWaterGeometry({indices:I,attributeData:{position:Q,uv0:O}});I=
new z.RenderGeometry(I,m.unwrap(this._material),{layerUid:J.layerUid,graphicUid:J.graphicsUid});O=G;f.set(I.boundingSphere,.5*(O[0]+O[3]),.5*(O[1]+O[4]),0,.5*Math.sqrt((O[3]-O[0])*(O[3]-O[0])+(O[4]-O[1])*(O[4]-O[1])));J.outGeometries.push(I);J.outNum++}};M.headingVectorFromAngle=function(J){const H=k.create();J=d.toRadian(J);H[0]=Math.sin(J);H[1]=Math.cos(J);return H};L.test=function(){return{...N.prototype.test.call(this),create3DShape:J=>this._createAs3DShape(J.graphic,J.elevationContext,J.graphicUid),
ensureMaterial:()=>this.ensureMaterial()}};return M}(q.Graphics3DSymbolLayer);q.unitSizeOfTexture=100;q.elevationModeChangeTypes={definedChanged:w.SymbolUpdateType.RECREATE,staysOnTheGround:w.SymbolUpdateType.NONE,onTheGroundChanged:w.SymbolUpdateType.RECREATE};const D=k.create(),E=h.create(),F=k.create(),G=e.create(),P={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},K={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,
outGeometries:null,outMaterials:null,outTransforms:null};a.Graphics3DWaterSymbolLayer=q;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/internal/waterMaterialUtils":function(){define(["exports"],function(a){a.wavePresets={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,
perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,
textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/maybe","./interfaces","./Loadable","./symbolComplexity"],function(a,b,c,m,l){return function(r){function n(k,f,d){f=r.call(this,f)||this;f.symbol=k;f.convert=d;f.graphics3DSymbol=null;f.referenced=0;return f}a._inheritsLoose(n,r);var g=n.prototype;g.getSymbolLayerSize=function(k){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(k):null};g.doLoad=function(){var k=a._asyncToGenerator(function*(f){f=yield this.symbol.fetchSymbol({signal:f});f.id=this.symbol.id;
this.graphics3DSymbol=this.convert(f);b.isSome(this.graphics3DSymbol)&&(yield this.graphics3DSymbol.load())});return function(f){return k.apply(this,arguments)}}();g.createGraphics3DGraphic=function(k){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(k,this):null};g.globalPropertyChanged=function(k,f){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.globalPropertyChanged(k,f):!1};g.applyRendererDiff=function(k,f){return b.isSome(this.graphics3DSymbol)?
this.graphics3DSymbol.applyRendererDiff(k,f):c.ApplyRendererDiffResult.Recreate_Symbol};g.prepareSymbolPatch=function(k){b.isSome(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(k)};g.updateGeometry=function(k,f){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.updateGeometry(k,f):!1};g.onRemoveGraphic=function(){};g.getFastUpdateStatus=function(){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}};g.destroy=function(){b.isSome(this.graphics3DSymbol)&&
this.graphics3DSymbol.destroy();this.graphics3DSymbol=void 0;r.prototype.destroy.call(this)};a._createClass(n,[{key:"symbolLayers",get:function(){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}},{key:"extentPadding",get:function(){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}},{key:"complexity",get:function(){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:l.emptySymbolComplexity}},{key:"destroyed",get:function(){return void 0===
this.graphics3DSymbol}}]);return n}(m.Loadable)})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("exports ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox ./graphicSymbolUtils ../../webgl-engine/materials/HUDMaterial".split(" "),function(a,b,c,m,l,r,n,g,k,f,d){function e(y){y=f.getGraphics3DSymbol(y.graphics3DGraphic.graphics3DSymbol);
return m.isSome(y)?y.symbol.symbolLayers.getItemAt(0):null}function h(y,D){var E=D.graphics3DGraphic.graphic.geometry;if(m.isNone(E))return null;if(m.isSome(D.disablePlacement))return D.labelClass.labelPlacement?(u.warnOncePerTick(v(y.placement,D.disablePlacement.logEntityDescription)),w(D)):y;E=E.type;switch(E){case "polyline":case "polygon":case "extent":case "multipoint":if(D.labelClass.labelPlacement)return u.warnOncePerTick(v(y.placement,`'${E}' geometries`)),w(D)}return y}function v(y,D){return`the requested label placement '${y}' is currently unsupported for ${D} in SceneView.`}
function w(y){const D=y.graphics3DGraphic.graphic.geometry;if(m.isNone(D))return null;switch(D.type){case "polyline":case "extent":case "multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case "polygon":return y=e(y),m.isSome(y)&&"extrude"===y.type?C["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"};case "point":return C["above-center"];case "mesh":return C["above-center"]}}function t(y,D=A){({graphics3DGraphic:y}=y);y=y.graphics[0];
(y=m.isSome(y)?y.stageObject.geometryRecords[0].material:null)&&y instanceof d.HUDMaterial?(y=y.parameters.anchorPosition,D[0]=2*(y[0]-.5),D[1]=2*(y[1]-.5)):(D[0]=0,D[1]=0);return D}function x(y,D,E){E=m.isSome(E)?E.getBoundingBoxObjectSpace(p):p;E=n.fromValues(E[3]-E[0],E[4]-E[1],E[5]-E[2]);y.centerOffset[0]=Math.sqrt(E[0]*E[0]+E[1]*E[1])/2*D.normalizedOffset[0];const F=y.translation[2],G=E[2]/2*D.normalizedOffset[1];y.translation[2]=0;y.elevationOffset=F+G;E=r.length(E);y.centerOffset[2]=E/2*D.normalizedOffset[2]}
function B(y){const D=y.labelClass.labelPlacement,{labelSymbol:E,graphics3DGraphic:F}=y;var G=f.getGraphics3DSymbol(F.graphics3DSymbol);G=m.applySome(G,P=>"point-3d"===P.symbol.type?P.symbol:null);y=C[D]||w(y);if(m.isSome(G)&&G.supportsCallout()&&G.hasVisibleVerticalOffset()&&!F.isDraped)return{placement:null,hasLabelVerticalOffset:!1,verticalOffset:q(G.verticalOffset),anchor:null,normalizedOffset:null};if(E&&E.hasVisibleVerticalOffset()&&(m.isNone(G)||!G.supportsCallout()||!G.verticalOffset||F.isDraped)){a:switch(y.placement){case "above-center":G=
!0;break a;default:G=!1}return G?{placement:"above-center",verticalOffset:q(E.verticalOffset),anchor:"bottom",normalizedOffset:[0,y.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(u.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+D+" placement)"),null)}return{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function q(y){const {screenLength:D,minWorldLength:E,maxWorldLength:F}=
y;return{screenLength:D,minWorldLength:E,maxWorldLength:F}}const u=c.getLogger("esri.views.3d.layers.graphics.labelPlacement"),C={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",
normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}};b={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],
"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const y in b){const D=C[y];b[y].forEach(E=>{C[E]=D})}Object.freeze&&(Object.freeze(C),
Object.keys(C).forEach(y=>{Object.freeze(C[y]);Object.freeze(C[y].normalizedOffset)}));const z=[0,0],A=[0,0],p=k.create();a.get=function(y){var D=B(y);if(m.isNone(D))return null;if(D.anchor)var E=D;else{E=y.labelClass.labelPlacement;var F=C[E],G=F||w(y);E&&!F&&u.warnOncePerTick(`the requested label placement '${E}' is currently unsupported in SceneView.`);E=h(G,y)}if(m.isNone(E))return null;F=!!D.hasLabelVerticalOffset;D={anchor:E.anchor,verticalOffset:D.verticalOffset,screenOffset:l.create(),centerOffset:g.fromValues(0,
0,0,-1),centerOffsetUnits:"world",translation:n.create(),elevationOffset:0,hasLabelVerticalOffset:F};F=y.graphics3DGraphic.graphic.geometry;if(m.isNone(F))y=null;else{switch(F.type){case "point":G=e(y);if(!m.isNone(G))switch(F=y.graphics3DGraphic.graphics[0],m.isSome(F)?F.getCenterObjectSpace(D.translation):r.set(D.translation,0,0,0),G.type){case "icon":case "text":({graphics3DGraphic:G}=y);F=m.isSome(F)?F.getScreenSize():null;!G.isDraped&&m.isSome(F)?(y=t(y),z[0]=F[0]/2*(E.normalizedOffset[0]-y[0]),
z[1]=F[1]/2*(E.normalizedOffset[1]-y[1]),D.screenOffset[0]=z[0],D.hasLabelVerticalOffset?(D.centerOffset[1]=z[1],D.centerOffsetUnits="screen"):D.screenOffset[1]=z[1]):D.hasLabelVerticalOffset||"center"===D.anchor||(C[y.labelClass.labelPlacement]&&u.warnOncePerTick(`the requested placement '${E.placement}' is currently unsupported for draped graphics`),D.anchor="center");break;case "object":x(D,E,F)}break;case "polygon":F=e(y);if(!m.isNone(F))switch(F.type){case "extrude":y=y.graphics3DGraphic.graphics[0],
m.isSome(y)?(y.getBoundingBoxObjectSpace(p),k.center(p,D.translation),D.translation[2]=k.height(p)/2):r.set(D.translation,0,0,0),x(D,E,y)}break;case "mesh":x(D,E,y.graphics3DGraphic.graphics[0])}y=D}return y};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["exports"],function(a){let b=function(){function c(l){this._stage=l;this._materials=new Map}var m=c.prototype;m.get=function(l){return this._materials.get(l)};
m.add=function(l,r){this._materials.set(l,r);this._stage.add(r)};m.dispose=function(){this._stage.removeMany(Array.from(this._materials.values()));this._materials.clear()};return c}();a.MaterialCollection=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/MapUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./ContentObjectType ./testUtils ./VertexAttribute ../../../support/Scheduler ../../../webgl/enums ../../../webgl/Texture".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u){a.TextTextureAtlas=function(z){function A(y){y=z.call(this,y)||this;y.type=w.ContentObjectType.Texture;y.id=k.generateUID();y.events=new l;y._glTexture=null;y.needsClear=!1;y.elementsToAddOrUpdate=new Map;y.elementsToRemove=new Map;y.elementsToRender=new Map;y.elements=new Map;y.stageObjects=new Map;y.updating=!1;return y}b._inheritsLoose(A,z);var p=A.prototype;p.initialize=function(){this.stage=this.view._stage;this.canvas=this._create2DCanvas();
this.ctx=this.canvas.getContext("2d");this.stage.add(this);const y=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(y);this._update2DCanvasSize();this._resetAtlasCursor()};p.unload=function(){this._glTexture=g.disposeMaybe(this._glTexture);this.updating=!1;this.events.emit("unloaded")};p._createDescriptor=function(y){return{target:q.TextureType.TEXTURE_2D,pixelFormat:q.PixelFormat.RGBA,dataType:q.PixelType.UNSIGNED_BYTE,wrapMode:q.TextureWrapMode.CLAMP_TO_EDGE,
flipped:!0,samplingMode:q.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:y.parameters.maxMaxAnisotropy}};p.load=function(y){if(g.isSome(this._glTexture))return this._glTexture;this._glTexture=new u.Texture(y,this._createDescriptor(y),this.canvas);this.frameWorker=this.view.resourceController.scheduler.registerTask(B.TaskPriority.TEXT_TEXTURE_ATLAS,this);this.setDirty();return this._glTexture};p.dispose=function(){this.elementsToRender=this.elementsToRemove=
this.elementsToAddOrUpdate=this.elements=null;this.frameWorker=g.removeMaybe(this.frameWorker);this._glTexture&&(this.stage.remove(this),this._glTexture=g.disposeMaybe(this._glTexture));this.canvas.width=0;this.canvas.height=0;this.ctx=this.canvas=null};p._create2DCanvas=function(){const y=document.createElement("canvas");y.setAttribute("id","canvas2d");y.setAttribute("style","display:none");y.setAttribute("width",(512).toString());y.setAttribute("height",(512).toString());return y};p._update2DCanvasSize=
function(){this.canvas.setAttribute("width",this.atlas.size.width.toString());this.canvas.setAttribute("height",this.atlas.size.height.toString())};p._createAtlasRegion=function(y=512){this.atlas={size:{width:y,height:y},cursor:{x:0,y:0},lineHeight:0}};p._computeAtlasResolution=function(y,D){y=Math.max(y,D);y=n.nextHighestPowerOfTwo(y+256);return y=Math.min(y,4096)};p._resizeAtlas=function(y,D){D=D||y;const E=this.atlas;E.size.width=y;E.size.height=D;g.isSome(this._glTexture)&&this._glTexture.resize(y,
D);this._update2DCanvasSize()};p._resetAtlasCursor=function(){const y=this.atlas;y.cursor.x=2;y.cursor.y=4;y.lineHeight=0;this.needsClear=!0};p._getAtlasUsage=function(){const y=this.atlas;return(y.cursor.x+y.cursor.y*y.size.width)/(y.size.width*y.size.height)};p._getExpectedAtlasUsage=function(){const y=this.elementsToRemove.size,D=this.elementsToAddOrUpdate.size,E=this.elements.size;return this._getAtlasUsage()/E*(E+D-y)};p._addAtlasElement=function(y,D,E,F){const G=this.atlas,{renderedWidth:P,
renderedHeight:K,displayWidth:N,displayHeight:M}=y.textRenderer;y.placement.offset.x=G.cursor.x;y.placement.offset.y=G.cursor.y;y.placement.size.width=P;y.placement.size.height=K;y.placement.size.displayWidth=N;y.placement.size.displayHeight=M;y.placement.uvMinMax=[y.placement.offset.x/G.size.width,1-(y.placement.offset.y+K)/G.size.height,(y.placement.offset.x+P)/G.size.width,1-y.placement.offset.y/G.size.height];G.cursor.x+=E;G.lineHeight=Math.max(G.lineHeight,F);this.elements.set(D,y)};p._removeAtlasElement=
function(y){if(y&&this.elements.has(y.textId)){const D=y.placement.offset,E=y.placement.size;this.ctx.clearRect(D.x,D.y,E.width,E.height);this.elements.delete(y.textId)}};p._ensureStageObjects=function(y){var D=this.stageObjects.get(y);if(D)return D;D=new Set;this.stageObjects.set(y,D);return D};p._addStageObject=function(y,D){this._ensureStageObjects(y).add(D)};p._removeStageObject=function(y,D){(y=this.stageObjects.get(y))&&y.delete(D)&&(D.geometries[0].vertexAttributes.get(x.VertexAttribute.SIZE).data=
[0,0],D.geometryVertexAttrsUpdated(D.geometryRecords[0]))};p._processAddition=function(y,D){const E=this.atlas;var F=y.textId;const G=y.textRenderer.renderedWidth+2,P=y.textRenderer.renderedHeight+2+2;if(E.cursor.x+G<E.size.width&&E.cursor.y+P<E.size.height)this._addAtlasElement(y,F,G,P),this.elementsToRender.set(F,y),this.elementsToAddOrUpdate.delete(F);else if(E.cursor.y+P+E.lineHeight<E.size.height)E.cursor.x=2,E.cursor.y+=E.lineHeight,E.lineHeight=0,this._addAtlasElement(y,F,G,P),this.elementsToRender.set(F,
y),this.elementsToAddOrUpdate.delete(F);else{y=this._getExpectedAtlasUsage();(F=.85<y&&4096>E.size.width)&&this._resizeAtlas(2*E.size.width,2*E.size.height);if(!D||!F&&.95<y&&4096===E.size.width)return this._processRemovals(),C.OK;this._repack();return C.REPACK}return C.OK};p._processRemovals=function(){this.elementsToRemove.forEach((y,D)=>{const E=this.stageObjects.get(D);E&&0!==E.size||this._removeAtlasElement(y);E&&0===E.size&&this.stageObjects.delete(D)});this.elementsToRemove.clear()};p._repack=
function(){this._processRemovals();this.elements.forEach((y,D)=>{y.rendered=!1;this.elementsToAddOrUpdate.set(D,y)});this.elements.clear();this._resetAtlasCursor();this.elementsToRender.clear()};p._processRenderingRequest=function(y){this.ctx.clearRect(y.placement.offset.x,y.placement.offset.y,y.placement.size.width,y.placement.size.height);y.textRenderer.render(this.ctx,y.placement.offset.x,y.placement.offset.y);const D=this.stageObjects.get(y.textId);D&&D.forEach(E=>{E.geometries[0].vertexAttributes.get(x.VertexAttribute.UV0).data=
new Float32Array(y.placement.uvMinMax);E.geometries[0].vertexAttributes.get(x.VertexAttribute.SIZE).data=[y.placement.size.displayWidth,y.placement.size.displayHeight];E.geometryVertexAttrsUpdated(E.geometryRecords[0])});y.rendered=!0};p.runTask=function(y,D=!0){if(this._glTexture){var E=!1;r.someMap(this.elementsToAddOrUpdate,(G,P)=>(G=this.elements.get(P))&&G.rendered?((G=this.stageObjects.get(P))&&G.forEach(K=>{const N=K.geometries[0].vertexAttributes,M=this.elements.get(P);N.get(x.VertexAttribute.UV0).data=
new Float32Array(M.placement.uvMinMax);N.get(x.VertexAttribute.SIZE).data=new Float32Array([M.placement.size.displayWidth,M.placement.size.displayHeight]);K.geometryVertexAttrsUpdated(K.geometryRecords[0])}),this.elementsToAddOrUpdate.delete(P),!1):this._processAddition(this.elementsToAddOrUpdate.get(P),D)===C.REPACK?E=!0:!1);if(E)this.runTask(B.noBudget,!1);else{var F=!1;0<this.elementsToRender.size&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1);
r.someMap(this.elementsToRender,(G,P)=>{this._processRenderingRequest(G);this.elementsToRender.delete(P);F=!0;y.madeProgress();return y.done});F&&g.isSome(this._glTexture)&&this._glTexture.setData(this.canvas);this.updating=0<this.elementsToRender.size;!this.updating&&t.textTextureAtlas.orderedRepackingEnabled&&this.repackOrdered()}}};p.addTextTexture=function(y,D){const E=y.key;this.elementsToAddOrUpdate.has(E)||this.elementsToAddOrUpdate.set(E,{textId:E,placement:{offset:{x:0,y:0},size:{width:0,
height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:y,rendered:!1});this._addStageObject(E,D);this.elementsToRemove.delete(E);this.setDirty()};p.removeTextTexture=function(y,D){y=y.key;this.elementsToRemove.set(y,this.elements.get(y));this._removeStageObject(y,D)};p.setDirty=function(){this._glTexture&&(this.updating=!0)};p.repackOrdered=function(){if(0!==this.elements.size){var y=[];this.elements.forEach((E,F)=>y.push({element:E,key:F}));var D=!0;for(let E=0;E<y.length-1;E++)if(0<
y[E].key.localeCompare(y[E+1].key)){D=!1;break}if(!D||this.elementsToRemove.size){y.sort((E,F)=>E.key.localeCompare(F.key));this.elements.clear();for(const {element:E,key:F}of y)this.elements.set(F,E);this._repack();this.setDirty()}}};b._createClass(A,[{key:"width",get:function(){return this.atlas.size.width}},{key:"height",get:function(){return this.atlas.size.height}},{key:"requiresFrameUpdates",get:function(){return!1}},{key:"glTexture",get:function(){return this._glTexture}},{key:"running",get:function(){return this.updating}},
{key:"test",get:function(){const {elements:y,stageObjects:D,elementsToRemove:E,atlas:F}=this,G=this;return{elements:y,stageObjects:D,elementsToRemove:E,atlas:F,_resizeAtlas:(P,K)=>G._resizeAtlas(P,K),run:(P,K)=>G.runTask(P,K)}}}]);return A}(m);c.__decorate([f.property({constructOnly:!0})],a.TextTextureAtlas.prototype,"view",void 0);c.__decorate([f.property({type:Boolean})],a.TextTextureAtlas.prototype,"updating",void 0);a.TextTextureAtlas=c.__decorate([v.subclass("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],
a.TextTextureAtlas);var C;(function(z){z[z.OK=0]="OK";z[z.REPACK=1]="REPACK"})(C||(C={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/ObjectResourceCache":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Handles ../../../../core/handleUtils ../../../../core/maybe ../../../../core/promiseUtils ../../glTF/DefaultLoadingContext ../../glTF/loader ./wosrLoader".split(" "),function(a,b,
c,m,l,r,n,g,k){let f=function(){function e(){this.gltfCache=new Map;this.wosrCache=new Map;this.evictHandles=new c}var h=e.prototype;h.loadGLTF=function(v,w,t){return this._fromCache(this.gltfCache,t?`gltfPBR:${v}`:`gltf:${v}`,x=>g.load(new n.DefaultLoadingContext(x.streamDataRequester),v,x,t),w)};h.loadWOSR=function(v,w){return this._fromCache(this.wosrCache,`wosr:${v}:${w.disableTextures}`,t=>k.load(v,t),w)};h.destroy=function(){this.evictHandles.destroy();this.gltfCache.clear();this.wosrCache.clear()};
h._fromCache=function(v,w,t,x){return new Promise((B,q)=>{if(r.isAborted(x))q(r.createAbortError());else{var u=r.onAbort(x,()=>{this._remove(v,w);q(r.createAbortError())}),C=v.get(w);if(C)this.evictHandles.remove(w),C.refCount++,C.item.then(B,q);else{C=new AbortController;var z={refCount:1,abortController:C,item:t({...x,signal:C.signal}).then(A=>{z.abortController=null;A.remove=()=>this._remove(v,w);return A})};v.set(w,z);z.item.then(A=>{l.isSome(u)&&u.remove();B(A)},A=>{l.isSome(u)&&u.remove();q(A)})}}})};
h._remove=function(v,w){const t=v.get(w);t&&(t.refCount--,0===t.refCount&&this.evictHandles.add(m.timeoutHandle(()=>{v.delete(w);l.isSome(t.abortController)&&t.abortController.abort()},d),w))};b._createClass(e,[{key:"size",get:function(){return this.wosrCache.size+this.gltfCache.size}}]);return e}(),d=1E4;a.ObjectResourceCache=f;a.test={overrideEvictDelay(e){d=e;return{remove(){d=1E4}}}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Collection ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/PooledArray ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D ../../support/extentUtils ../../../support/Scheduler".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u){const C=n.getLogger("esri.views.3d.layers.support.FeatureTileTree3D");a.FeatureTileTree3D=function(p){function y(E){E=p.call(this,E)||this;E.tiles=new l;E.tileSize=512;E._idToTile=new Map;E._handles=new r;E._clients=new Set;E._dirty=!1;E._newTiles=new k;return E}b._inheritsLoose(y,p);var D=y.prototype;D.initialize=function(){this._handles.add([f.watch(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),f.sync),f.watch(()=>{var E,F,G;return[this.tileSize,
null==(E=this.cameraOnSurface)?void 0:E.location,this.tilingScheme,null==(F=this.viewState)?void 0:F.contentCamera,null==(G=this.focus)?void 0:G.location]},()=>this._setDirty(),f.syncAndInitial)]);this.scheduler&&(this._frameWorker=this.scheduler.registerTask(u.TaskPriority.FEATURE_TILE_TREE,this))};D.destroy=function(){this._frameWorker=g.removeMaybe(this._frameWorker);this._handles=g.destroyMaybe(this._handles)};D.addClient=function(){const E=z++;this._clients.add(E);1===this._clients.size&&this._setDirty();
return{remove:()=>this._removeClient(E)}};D._removeClient=function(E){this._clients.delete(E);this._hasClients||this._clear()};D._setDirty=function(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(u.noBudget))};D._clear=function(){this.tiles.removeAll();this._idToTile.clear();this._reset();this._dirty=!1;this.notifyChange("updating")};D.runTask=function(E){this._dirty=!1;this._pendingTiles||(this._startUpdate(),g.isSome(this._frameWorker)&&
(this._frameWorker.priority=u.TaskPriority.FEATURE_TILE_TREE_ACTIVE));this._subdivideTilesForView(E);!this._pendingTiles&&g.isSome(this._frameWorker)&&(this._frameWorker.priority=u.TaskPriority.FEATURE_TILE_TREE);this.notifyChange("updating")};D._startUpdate=function(){this.suspended||(this.tilingScheme?(this._tileMeasurements||(this._tileMeasurements=new B.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize})),this._tileMeasurements.begin(this.viewState.contentCamera,
this.focus.location,this.cameraOnSurface.location.z),this._pendingTiles=this._getRootTiles()):this._clear())};D._reset=function(){this._newTiles.clear();this._pendingTiles=this._tileMeasurements=null;this._setDirty()};D._getRootTiles=function(){return this.rootTileIds.map(E=>new x.FeatureTileDescriptor3D(E[0],E[1],E[2],this.tilingScheme))};D._purgeHorizonTiles=function(E){E.sort((F,G)=>{F=F.measures.screenRect;G=G.measures.screenRect;return F[1]+F[3]-(G[1]+G[3])});t.empty(A);for(let F=0;F<E.length;F++)if(t.expand(A,
E.data[F].measures.screenRect,A),10<t.height(A))return E.data.slice(F,E.length);return[]};D._subdivideTilesForView=function(E){if(this._pendingTiles){for(;0<this._pendingTiles.length&&!E.done;){const F=this._pendingTiles.pop();E.madeProgress();if(!this.filterExtentRect||t.intersects(this.filterExtentRect,F.extent))this._tileMeasurements.updateTile(F),F.measures.visibility!==x.Visibility.INVISIBLE&&(F.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(F.lij[0]+1),this._pendingTiles.push(...F.getChildren())):
this._newTiles.push(F))}0===this._pendingTiles.length&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}};D._updateTiles=function(E){for(var F of this.tiles.items)F.used=!1;E=E.filter(G=>{const P=this._idToTile.get(G.id);P?(P.copyMeasurementsFrom(G),P.used=!0):this._idToTile.set(G.id,G);return!P});F=this.tiles.items.filter(G=>G.used?!1:(this._idToTile.delete(G.id),!0));this.tiles.removeMany(F);this.tiles.addMany(E);
this._sortTiles()};D._sortTiles=function(){this.viewState.fixedContentCamera||this.tiles.sort((E,F)=>E.measures.visibility!==F.measures.visibility?E.measures.visibility===x.Visibility.VISIBLE_ON_SURFACE?-1:1:E.measures.distance-F.measures.distance);this.tiles.forEach((E,F)=>E.loadPriority=F)};b._createClass(y,[{key:"tilingScheme",get:function(){const E=this.tilingSchemeOwner.tilingScheme;return E?E.clone():null}},{key:"filterExtent",set:function(E){if(g.isSome(E)&&!E.spatialReference.equals(this.viewState.spatialReference))C.error("#extent",
"extent spatial reference needs to be in the same spatial reference as the view");else{var F=this._get("filterExtent");F===E||g.isSome(F)&&E&&F.equals(E)||(E=g.isSome(E)?E.clone():null,this._set("filterExtent",E),this._setDirty())}}},{key:"filterExtentRect",get:function(){if(g.isNone(this.filterExtent)||!this.tilingScheme)return null;const E=t.create();q.toBoundingRect(this.filterExtent,E,this.tilingScheme.spatialReference);return E}},{key:"rootTileIds",get:function(){return this.filterExtentRect?
this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]}},{key:"suspended",set:function(E){E!==this._get("suspended")&&(this._set("suspended",E),this._setDirty())}},{key:"updating",get:function(){return this._dirty||!!this._pendingTiles}},{key:"_hasClients",get:function(){return 0<this._clients.size}},{key:"running",get:function(){return this.updating}}]);return y}(m);c.__decorate([d.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"scheduler",void 0);c.__decorate([d.property({constructOnly:!0})],
a.FeatureTileTree3D.prototype,"renderCoordsHelper",void 0);c.__decorate([d.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"tilingSchemeOwner",void 0);c.__decorate([d.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"cameraOnSurface",void 0);c.__decorate([d.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"focus",void 0);c.__decorate([d.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"viewState",void 0);c.__decorate([d.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,
"terrain",void 0);c.__decorate([d.property()],a.FeatureTileTree3D.prototype,"tiles",void 0);c.__decorate([d.property()],a.FeatureTileTree3D.prototype,"tileSize",void 0);c.__decorate([d.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"tilingScheme",null);c.__decorate([d.property()],a.FeatureTileTree3D.prototype,"filterExtent",null);c.__decorate([d.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"filterExtentRect",null);c.__decorate([d.property({readOnly:!0})],a.FeatureTileTree3D.prototype,
"rootTileIds",null);c.__decorate([d.property({value:!1})],a.FeatureTileTree3D.prototype,"suspended",null);c.__decorate([d.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"updating",null);a.FeatureTileTree3D=c.__decorate([w.subclass("esri.views.3d.layers.support.FeatureTileTree3D")],a.FeatureTileTree3D);let z=0;const A=t.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["exports",
"../../../../geometry/support/aaBoundingRect"],function(a,b){let c=function(){function m(r,n,g,k=null){this.lij=[0,0,0];this.extent=b.create();this.loadPriority=this.resolution=0;this.measures={visibility:a.Visibility.VISIBLE_ON_SURFACE,screenRect:b.create(),distance:0,shouldSplit:!1};this.used=!1;k&&this.acquire(r,n,g,k)}var l=m.prototype;l.acquire=function(r,n,g,k){this.tilingScheme=k;this.id=m.id(r,n,g);this.lij[0]=r;this.lij[1]=n;this.lij[2]=g;k.getExtent(r,n,g,this.extent);this.resolution=k.resolutionAtLevel(r)};
l.release=function(){this.tilingScheme=null};l.getChildren=function(r){const n=this.lij[0]+1,g=2*this.lij[1],k=2*this.lij[2];if(!r)return[new m(n,g,k,this.tilingScheme),new m(n,g+1,k,this.tilingScheme),new m(n,g,k+1,this.tilingScheme),new m(n,g+1,k+1,this.tilingScheme)];r[0].acquire(n,g,k,this.tilingScheme);r[1].acquire(n,g+1,k,this.tilingScheme);r[2].acquire(n,g,k+1,this.tilingScheme);r[3].acquire(n,g+1,k+1,this.tilingScheme);return r};l.copyMeasurementsFrom=function(r){this.measures.visibility=
r.measures.visibility;this.measures.shouldSplit=r.measures.shouldSplit;this.measures.distance=r.measures.distance;b.copy(r.measures.screenRect,this.measures.screenRect)};m.id=function(r,n,g){return`${r}/${n}/${g}`};return m}();a.Visibility=void 0;(function(m){m[m.INVISIBLE=0]="INVISIBLE";m[m.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED";m[m.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(a.Visibility||(a.Visibility={}));a.FeatureTileDescriptor3D=c;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("exports ../../../../core/screenUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/frustum ../../../../geometry/support/plane ../../../../geometry/support/triangle ./FeatureTileDescriptor3D ./FeatureTileVisibility3D ../../webgl-engine/lib/Camera".split(" "),function(a,b,c,m,l,r,n,g,k,f,d){let e=function(){function u(z){this.camera=
new d.Camera;this.focusOnMap=[0,0];this.screenRect=l.create();this.tileSize=z.tileSize;this.renderCoordsHelper=z.renderCoordsHelper;this.tilingScheme=z.tilingScheme;this.visibility=new f.FeatureTileVisibility3D(z.renderCoordsHelper)}var C=u.prototype;C.begin=function(z,A,p){this.camera.copyFrom(z);this.surfaceElevation=p;this.focusOnMap[0]=A.x;this.focusOnMap[1]=A.y;l.fromValues(0,0,z.fullWidth,z.fullHeight,this.screenRect);this.visibility.begin(this.camera,p)};C.end=function(){this.visibility.end()};
C.updateTile=function(z){z.measures.visibility=this.visibility.calculate(z);z.measures.distance=l.distance(z.extent,this.focusOnMap);z.measures.visibility!==k.Visibility.INVISIBLE&&this._updateScreenMeasure(z)};C._updateScreenMeasure=function(z){const A=z.measures.screenRect;l.empty(A);let p=0;const y=z.lij[0]+2,D=z.lij[1]<<2,E=z.lij[2]<<2;var F=this._tileSizeWithBias(z);F*=F;for(let G=0;4>G;G++)for(let P=0;4>P;P++)if(p+=this._computeScreenArea(z,y,D+G,E+P,A),p>F){z.measures.shouldSplit=!0;return}z.measures.shouldSplit=
!1};C._tileSizeWithBias=function(z){return z.measures.visibility===k.Visibility.VISIBLE_WHEN_EXTENDED?5*this.tileSize:this.tileSize};C._computeScreenArea=function(z,A,p,y,D){this._projectToScreen(A,p,y,z.measures.visibility===k.Visibility.VISIBLE_WHEN_EXTENDED,v);l.empty(h);for(z=0;4>z;z++)l.expandPointInPlace(h,v[z]);l.expand(D,h,D);return g.areaPoints2d(v[0],v[1],v[2])+g.areaPoints2d(v[0],v[2],v[3])};C._projectToScreen=function(z,A,p,y,D){this.tilingScheme.ensureMaxLod(z);this.tilingScheme.getExtent(z,
A,p,w);this._toRenderCoords(w,0,3,x[0]);this._toRenderCoords(w,2,3,x[1]);this._toRenderCoords(w,2,1,x[2]);this._toRenderCoords(w,0,1,x[3]);y&&(this._projectToPlane(x,this.camera.frustum[r.PlaneIndex.NEAR]),this._projectToPlane(x,this.camera.frustum[r.PlaneIndex.TOP]),this._projectToPlane(x,this.camera.frustum[r.PlaneIndex.BOTTOM]));for(z=0;4>z;z++)this.camera.projectToRenderScreen(x[z],q),this.camera.renderToScreen(q,D[z])};C._projectToPlane=function(z,A){for(var p=0;4>p;p++)B[p]=n.signedDistance(A,
z[p]);p=Math.max(B[0],B[1],B[2],B[3]);if(0<p)for(A=c.scale(t,n.normal(A),-p),p=0;4>p;p++)c.add(z[p],z[p],A)};C._toRenderCoords=function(z,A,p,y){t[0]=z[A];t[1]=z[p];t[2]=this.surfaceElevation;this.renderCoordsHelper.toRenderCoords(t,this.tilingScheme.spatialReference,y);return y};return u}();const h=l.create(),v=[b.createScreenPointArray(),b.createScreenPointArray(),b.createScreenPointArray(),b.createScreenPointArray()],w=l.create(),t=m.create(),x=[m.create(),m.create(),m.create(),m.create()],B=[0,
0,0,0],q=b.createRenderScreenPointArray3();a.FeatureTileMeasurements3D=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("exports ../../../../core/mathUtils ../../../../core/ObjectPool ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../../../geometry/support/frustum ../../../../geometry/support/plane ../../../../geometry/support/ray ../../../ViewingMode ./FeatureTileDescriptor3D ../../state/Frustum ../../support/FrustumExtentIntersection".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h){let v=function(){function q(C){this.renderCoordsHelper=C;this.surfaceElevation=0;this.cache=new Map;this.frustum=new e.Frustum(C);this.extendedFrustum=new e.Frustum(C);this.intersector=new h.FrustumExtentIntersection({renderCoordsHelper:C});this.renderCoordsHelper=C}var u=q.prototype;u.begin=function(C,z){this.surfaceElevation=z;this.aboveGround=this.renderCoordsHelper.getAltitude(C.eye)>z;this.frustum.update(C);this._shortenFrustumFarPlane(this.frustum);this._updateExtendedFrustum(C)};
u.end=function(){this.cache.clear()};u.calculate=function(C){if(this.allTilesInvisible)return d.Visibility.INVISIBLE;const z=this.renderCoordsHelper.viewingMode===f.ViewingMode.Global&&2<=C.lij[0]&&6>C.lij[0],A=this._getOrCalculateSingleTileVisibility(C,!z);return A!==d.Visibility.INVISIBLE&&z?this._calculateAggregatedChildrenVisibility(C):A};u._shortenFrustumFarPlane=function(C){var z=e.Frustum.nearFarLineIndices;const A=C.mutablePoints;for(const p of z){const [y,D]=p;z=A[y];m.subtract(w,A[D],z);
m.scale(w,w,.95);m.add(A[D],z,w)}C.updatePoints(A)};u._calculateAggregatedChildrenVisibility=function(C){let z=d.Visibility.INVISIBLE;var A=this.cache.get(C.id);if(null!=A)return A;A=B.acquire();C.getChildren(A);for(const p of A){const y=this.calculate(p);if(y!==d.Visibility.INVISIBLE&&(z=y,y===d.Visibility.VISIBLE_ON_SURFACE))break}B.release(A);this.cache.set(C.id,z);return z};u._getOrCalculateSingleTileVisibility=function(C,z){var A=this.cache.get(C.id);if(null!=A)return A;A=this._calculateSingleTileVisibility(C);
z&&this.cache.set(C.id,A);return A};u._calculateSingleTileVisibility=function(C){if(!this.aboveGround&&this.renderCoordsHelper.viewingMode===f.ViewingMode.Global&&12>C.lij[0]){if(this._calculateSingleTileVisibilitySided(C,!1)===d.Visibility.INVISIBLE)return this._calculateSingleTileVisibilitySided(C,!0)}else return this._calculateSingleTileVisibilitySided(C,this.aboveGround)};u._calculateSingleTileVisibilitySided=function(C,z){this.intersector.update(C.extent,C.tilingScheme.spatialReference,this.surfaceElevation,
z);C=r.getReferenceEllipsoid(C.tilingScheme.spatialReference).radius;return this.intersector.isVisibleInFrustum(this.extendedFrustum,C)?this.intersector.isVisibleInFrustum(this.frustum,C,!0)?d.Visibility.VISIBLE_ON_SURFACE:d.Visibility.VISIBLE_WHEN_EXTENDED:d.Visibility.INVISIBLE};u._updateExtendedFrustum=function(C){this.extendedFrustum.update(C);this._shortenFrustumFarPlane(this.extendedFrustum);var z=this.renderCoordsHelper.worldUpAtPosition(C.eye,w);this.aboveGround||m.negate(z,z);z=b.acosClamped(-m.dot(z,
C.viewForward));this.allTilesInvisible=z>(Math.PI+C.fovY)/2;if(!this.allTilesInvisible&&(this.hasExtendedFrustum=z>C.fovY/2)){C=this._extendedFrustumParameters();z=this.extendedFrustum.mutablePoints;for(let A=0;4>A;A++){const p=C.pointIndices[A],y=z[p],D=this.renderCoordsHelper.getAltitude(y);if(C.needsAltitudeAdjustment(D)){this.renderCoordsHelper.worldUpAtPosition(y,w);switch(p){case n.PointIndex.FAR_BOTTOM_LEFT:case n.PointIndex.FAR_TOP_LEFT:case n.PointIndex.NEAR_BOTTOM_LEFT:case n.PointIndex.NEAR_TOP_LEFT:g.projectVector(this.extendedFrustum.planes[n.PlaneIndex.LEFT],
w,w);break;case n.PointIndex.FAR_BOTTOM_RIGHT:case n.PointIndex.FAR_TOP_RIGHT:case n.PointIndex.NEAR_BOTTOM_RIGHT:case n.PointIndex.NEAR_TOP_RIGHT:g.projectVector(this.extendedFrustum.planes[n.PlaneIndex.RIGHT],w,w)}m.scale(w,w,C.direction);this.renderCoordsHelper.intersectInfiniteManifold(k.wrap(y,w),C.zWithMargin,y)}}this.extendedFrustum.updatePoints(z);g.fromPoints(z[n.PointIndex.NEAR_BOTTOM_LEFT],z[n.PointIndex.NEAR_BOTTOM_RIGHT],z[n.PointIndex.NEAR_TOP_RIGHT],t);g.fromPoints(z[n.PointIndex.NEAR_BOTTOM_RIGHT],
z[n.PointIndex.NEAR_TOP_RIGHT],z[n.PointIndex.NEAR_TOP_LEFT],x);0>m.dot(g.normal(t),g.normal(x))&&(C=this.extendedFrustum.mutablePoints,this.aboveGround?[C[n.PointIndex.NEAR_BOTTOM_LEFT],C[n.PointIndex.NEAR_BOTTOM_RIGHT]]=[C[n.PointIndex.NEAR_BOTTOM_RIGHT],C[n.PointIndex.NEAR_BOTTOM_LEFT]]:[C[n.PointIndex.NEAR_TOP_LEFT],C[n.PointIndex.NEAR_TOP_RIGHT]]=[C[n.PointIndex.NEAR_TOP_RIGHT],C[n.PointIndex.NEAR_TOP_LEFT]],this.extendedFrustum.updatePoints(C))}};u._extendedFrustumParameters=function(){return this.aboveGround?
this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()};u._extendedFrustumParametersAboveSurface=function(){const C=this.surfaceElevation-1;return{zWithMargin:C,pointIndices:e.Frustum.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment(z){return z>C}}};u._extendedFrustumParametersBelowSurface=function(){const C=this.surfaceElevation+1;return{zWithMargin:C,pointIndices:e.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment(z){return z<C}}};
return q}();const w=l.create(),t=g.create(),x=g.create(),B=new c(Array,q=>{4!==q.length&&(q[0]=new d.FeatureTileDescriptor3D,q[1]=new d.FeatureTileDescriptor3D,q[2]=new d.FeatureTileDescriptor3D,q[3]=new d.FeatureTileDescriptor3D)},q=>{q[0].release();q[1].release();q[2].release();q[3].release()});a.FeatureTileVisibility3D=v;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/Frustum":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../../../chunks/vec3","../../../chunks/vec3f64","../../../geometry/support/frustum"],function(a,b,c,m,l){function r(g,k,f){g.origin=k;g.endpoint=f;c.direction(g.direction,k,f)}let n=function(){function g(f){this.renderCoordsHelper=f;this.frustum=l.create();this._points=l.createPoints();this.lines=Array(12);this._origin=m.create();this._direction=m.create();this._altitude=null;for(f=0;12>f;f++)this.lines[f]={origin:null,direction:m.create(),endpoint:null}}var k=g.prototype;k.update=function(f){l.fromMatrix(f.viewMatrix,
f.projectionMatrix,this.frustum,this._points);c.copy(this._origin,f.eye);c.copy(this._direction,f.viewForward);this._altitude=this.renderCoordsHelper.getAltitude(this._origin);this._updateLines()};k.updatePoints=function(f){for(let d=0;d<this._points.length;d++)c.copy(this._points[d],f[d]);l.computePlanes(this.frustum,this._points);this._updateLines()};k.intersectsSphere=function(f){return l.intersectsSphere(this.frustum,f)};k.intersectsRay=function(f){return l.intersectsRay(this.frustum,f)};k.intersectsLineSegment=
function(f,d){return l.intersectsLineSegment(this.frustum,f,d)};k.intersectsPoint=function(f){return l.intersectsPoint(this.frustum,f)};k._updateLines=function(){const f=this._points;for(let d=0;4>d;d++){const e=d+4;r(this.lines[d],f[d],f[e]);r(this.lines[d+4],f[d],3===d?f[0]:f[d+1]);r(this.lines[d+8],f[e],3===d?f[4]:f[e+1])}};b._createClass(g,[{key:"planes",get:function(){return this.frustum}},{key:"points",get:function(){return this._points}},{key:"mutablePoints",get:function(){return this._points}},
{key:"direction",get:function(){return this._direction}},{key:"altitude",get:function(){return this._altitude}}]);return g}();n.planePointIndices=l.planePointIndices;n.nearFarLineIndices=[[l.PointIndex.NEAR_BOTTOM_LEFT,l.PointIndex.FAR_BOTTOM_LEFT],[l.PointIndex.NEAR_BOTTOM_RIGHT,l.PointIndex.FAR_BOTTOM_RIGHT],[l.PointIndex.NEAR_TOP_RIGHT,l.PointIndex.FAR_TOP_RIGHT],[l.PointIndex.NEAR_TOP_LEFT,l.PointIndex.FAR_TOP_LEFT]];a.Frustum=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/support/FrustumExtentIntersection":function(){define("exports ../../../core/compilerUtils ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/lineSegment ../../../geometry/support/plane ../../../geometry/support/ray ../../ViewingMode ./intersectionUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x){const B=.5*Math.PI,q=B/Math.PI*180;let u=function(){function F(P){this.renderCoordsHelper=P.renderCoordsHelper;this.extent=Array(4);this.planes=Array(6);this.maxSpan=0;this.center={origin:n.create(),direction:n.create()};for(P=0;4>P;P++)this.extent[P]={origin:n.create(),direction:n.create(),cap:{next:null,direction:n.create()}},this.planes[P]=v.create();this.planes[e.PlaneIndex.NEAR]=v.create();this.planes[e.PlaneIndex.FAR]=v.create();this.planesWithoutFar=
this.planes.slice(0,5)}var G=F.prototype;G.update=function(P,K,N,M=!0){const L=this.extent;this._toRenderBoundingExtent(P,K,N);r.add(this.center.origin,L[0].origin,L[2].origin);r.scale(this.center.origin,this.center.origin,.5);this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction);M||r.scale(this.center.direction,this.center.direction,-1);for(N=0;4>N;N++){const J=L[N];this.renderCoordsHelper.worldUpAtPosition(J.origin,J.direction);const H=L[3===N?0:N+1];J.cap.next=H.origin;
r.direction(J.cap.direction,J.origin,H.origin);v.fromVectorsAndPoint(J.direction,J.cap.direction,J.origin,this.planes[N]);M||r.scale(J.direction,J.direction,-1)}v.fromVectorsAndPoint(L[0].cap.direction,L[1].cap.direction,L[0].origin,this.planes[e.PlaneIndex.NEAR]);M?v.negate(this.planes[e.PlaneIndex.NEAR],this.planes[e.PlaneIndex.FAR]):(v.copy(this.planes[e.PlaneIndex.FAR],this.planes[e.PlaneIndex.NEAR]),v.negate(this.planes[e.PlaneIndex.NEAR],this.planes[e.PlaneIndex.NEAR]));this.maxSpan=Math.max(Math.abs(P[0]-
P[2]),Math.abs(P[1]-P[3]));this.maxSpanSpatialReference=K;this.minGlobalAltitude=.9*k.getReferenceEllipsoid(this.maxSpanSpatialReference).radius};G.isVisibleInFrustum=function(P,K,N=!1){if(null==P)return!1;if(this.renderCoordsHelper.viewingMode===t.ViewingMode.Global){if(this.maxSpan>(this.maxSpanSpatialReference.isGeographic?q:B*K))return!0;if(P.altitude>=this.minGlobalAltitude)return this._isVisibleInFrustumGlobal(P)}if(0===this.maxSpan)return K=this.extent[0],!N&&P.intersectsRay(w.wrap(K.origin,
K.direction))?!0:!1;for(K=0;K<this.extent.length;K++){var M=this.extent[K];if(!N&&P.intersectsRay(w.wrap(M.origin,M.direction))||P.intersectsLineSegment(h.fromPoints(M.origin,M.cap.next,E),M.cap.direction))return!0}N=N?this.planes:this.planesWithoutFar;for(K=0;K<P.lines.length;K++)if(M=P.lines[K],x.frustumLineSegment(N,M.origin,M.endpoint,M.direction))return!0;return!1};G._toRenderBoundingExtentGlobal=function(P,K,N){d.center(P,z);z[2]=N;g.computeTranslationToOriginAndRotation(K,z,A,this.renderCoordsHelper.spatialReference);
m.invert(p,A);f.empty(y);for(const {x0:M,x1:L,y0:J,y1:H}of C)for(let I=0;5>I;I++){const O=I/4;z[0]=c.lerp(P[M],P[L],O);z[1]=c.lerp(P[J],P[H],O);z[2]=N;g.projectVectorToVector(z,K,z,this.renderCoordsHelper.spatialReference);r.transformMat4(z,z,p);f.expandWithVec3(y,z)}r.set(this.extent[0].origin,y[0],y[1],y[2]);r.set(this.extent[1].origin,y[3],y[1],y[2]);r.set(this.extent[2].origin,y[3],y[4],y[2]);r.set(this.extent[3].origin,y[0],y[4],y[2]);for(P=0;4>P;++P)r.transformMat4(this.extent[P].origin,this.extent[P].origin,
A)};G._toRenderBoundingExtentLocal=function(P,K,N){g.projectBoundingRect(P,K,D,this.renderCoordsHelper.spatialReference);r.set(this.extent[0].origin,D[0],D[1],N);r.set(this.extent[1].origin,D[2],D[1],N);r.set(this.extent[2].origin,D[2],D[3],N);r.set(this.extent[3].origin,D[0],D[3],N)};G._toRenderBoundingExtent=function(P,K,N){switch(this.renderCoordsHelper.viewingMode){case t.ViewingMode.Global:this._toRenderBoundingExtentGlobal(P,K,N);break;case t.ViewingMode.Local:this._toRenderBoundingExtentLocal(P,
K,N);break;default:b.neverReached(this.renderCoordsHelper.viewingMode)}};G._isVisibleInFrustumGlobal=function(P){if(0>v.signedDistance(P.planes[e.PlaneIndex.NEAR],this.center.origin)&&0>r.dot(this.center.direction,P.direction))return!0;for(let K=0;4>K;K++){const N=this.extent[K];if(0>v.signedDistance(P.planes[e.PlaneIndex.NEAR],N.origin)&&0>r.dot(N.direction,P.direction))return!0}return!1};return F}();const C=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],
z=n.create(),A=l.create(),p=l.create(),y=f.create(),D=d.create(),E=h.create();a.FrustumExtentIntersection=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/extentUtils":function(){define(["exports","../../../core/maybe","../../../chunks/vec3f64","../../../geometry/projection"],function(a,b,c,m){const l=c.create();a.projectToBoundingBox=function(r,n,g){if(b.isNone(r)||b.isNone(g))return!1;let k;l[0]=null!=r.xmin?r.xmin:0;l[1]=null!=
r.ymin?r.ymin:0;l[2]=null!=r.zmin?r.zmin:0;k=m.projectBuffer(l,r.spatialReference,0,n,g,0,1);l[0]=null!=r.xmax?r.xmax:0;l[1]=null!=r.ymax?r.ymax:0;l[2]=null!=r.zmax?r.zmax:0;k=k&&m.projectBuffer(l,r.spatialReference,0,n,g,3,1);null==r.xmin&&(n[0]=-Infinity);null==r.ymin&&(n[1]=-Infinity);null==r.zmin&&(n[2]=-Infinity);null==r.xmax&&(n[3]=Infinity);null==r.ymax&&(n[4]=Infinity);null==r.zmax&&(n[5]=Infinity);return k};a.toBoundingRect=function(r,n,g){if(b.isNone(r)||b.isNone(g))return!1;let k;l[0]=
null!=r.xmin?r.xmin:0;l[1]=null!=r.ymin?r.ymin:0;l[2]=null!=r.zmin?r.zmin:0;k=m.projectBuffer(l,r.spatialReference,0,l,g,0,1);n[0]=l[0];n[1]=l[1];l[0]=null!=r.xmax?r.xmax:0;l[1]=null!=r.ymax?r.ymax:0;l[2]=null!=r.zmax?r.zmax:0;k=k&&m.projectBuffer(l,r.spatialReference,0,l,g,0,1);n[2]=l[0];n[3]=l[1];null==r.xmin&&(n[0]=-Infinity);null==r.ymin&&(n[1]=-Infinity);null==r.xmax&&(n[2]=Infinity);null==r.ymax&&(n[3]=Infinity);return k};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/state/ViewState":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/watch ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../ViewAnimation ../../ViewingMode ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/PropertiesPool ../webgl-engine/lib/Camera".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C){c=function(y){function D(){var F=y.apply(this,arguments)||this;F._propertiesPool=new u.PropertiesPool({camera:C.Camera},a._assertThisInitialized(F));F._lastSeenCameraProjectionValues=new C.Camera;F.events=new m;F.viewingMode=t.ViewingMode.Global;F._cameraChanged=!1;F.updateQueue=[];F.processingUpdates=!1;return F}a._inheritsLoose(D,y);var E=D.prototype;E.init=function(F,G){this._set("viewingMode",F);this._set("spatialReference",G);this._set("constraints",
new x.Constraints({mode:this.viewingMode}))};E.exit=function(){this.cameraController=null;this._propertiesPool.destroy();this._propertiesPool=new u.PropertiesPool({camera:C.Camera},this)};E.createInitialCamera=function(){if(this.viewingMode===t.ViewingMode.Global){const F=v.getReferenceEllipsoid(this.spatialReference).radius;this.camera=new C.Camera(h.fromValues(4*F,0,0),h.fromValues(F,0,0),h.fromValues(0,0,1))}else this.camera=new C.Camera(h.fromValues(0,0,100),h.fromValues(0,0,0),h.fromValues(0,
1,0))};E.switchCameraController=function(F){this.cameraController=F;return F.state!==q.State.Rejected};E.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?!1:!0};E.updateCamera=function(F){this.updateQueue.push(F);this._processUpdateQueue()};E._processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=!0;var F=this.updateQueue.shift();z.copyFrom(this._get("camera"));F(z);this.camera=z;this.processingUpdates=
!1;this._processUpdateQueue()}};E._cameraProjectionChanged=function(F,G){return F.fov!==G.fov||F.fullViewport[0]!==G.fullViewport[0]||F.fullViewport[1]!==G.fullViewport[1]||F.fullViewport[2]!==G.fullViewport[2]||F.fullViewport[3]!==G.fullViewport[3]||F.padding[C.PaddingSide.TOP]!==G.padding[C.PaddingSide.TOP]||F.padding[C.PaddingSide.RIGHT]!==G.padding[C.PaddingSide.RIGHT]||F.padding[C.PaddingSide.BOTTOM]!==G.padding[C.PaddingSide.BOTTOM]||F.padding[C.PaddingSide.LEFT]!==G.padding[C.PaddingSide.LEFT]?
!0:!1};a._createClass(D,[{key:"animation",get:function(){return this.cameraController instanceof B.AnimationController&&l.isSome(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}},{key:"camera",get:function(){return this._get("camera")},set:function(F){F!==z&&z.copyFrom(F);z.computeUp(this.viewingMode);A.camera=z;this.events.emit("before-camera-change",A);F=this._get("camera");this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,z)&&(this._lastSeenCameraProjectionValues.copyFrom(z),
p.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",p));if(!F||!F.equals(z))if(this._set("camera",this._propertiesPool.get("camera").copyFrom(z)),this._cameraChanged=!F||!F.almostEquals(z)){const G=e.afterDispatch(()=>{this._cameraChanged=!1;G.remove()})}}},{key:"pixelRatio",get:function(){return this.camera.pixelRatio}},{key:"contentCamera",get:function(){return l.isSome(this._contentCamera)?this._contentCamera:this.camera},set:function(F){this._contentCamera=
l.isSome(F)?F.clone():null}},{key:"fixedContentCamera",get:function(){return l.isSome(this._contentCamera)}},{key:"isGlobal",get:function(){return this.viewingMode===t.ViewingMode.Global}},{key:"isLocal",get:function(){return this.viewingMode===t.ViewingMode.Local}},{key:"navigating",get:function(){return!(!this.cameraController||!this.cameraController.isInteractive)}},{key:"stationary",get:function(){return!this._cameraChanged&&!this.navigating}},{key:"cameraController",get:function(){return this._get("cameraController")},
set:function(F){this.stopActiveCameraController()?(F&&(this.own(r.watch(()=>F.state,G=>{if(G===q.State.Finished||G===q.State.Stopped)this._set("cameraController",null),this.updateCamera(P=>F.onControllerEnd(P))},r.sync)),F.onControllerStart(this.camera)),this._set("cameraController",F)):F&&(F.state=q.State.Rejected)}}]);return D}(c);b.__decorate([n.property({readOnly:!0,type:w})],c.prototype,"animation",null);b.__decorate([n.property({type:C.Camera})],c.prototype,"camera",null);b.__decorate([n.property()],
c.prototype,"pixelRatio",null);b.__decorate([n.property({})],c.prototype,"_contentCamera",void 0);b.__decorate([n.property({type:C.Camera})],c.prototype,"contentCamera",null);b.__decorate([n.property({readOnly:!0})],c.prototype,"fixedContentCamera",null);b.__decorate([n.property({readOnly:!0})],c.prototype,"constraints",void 0);b.__decorate([n.property({readOnly:!0})],c.prototype,"events",void 0);b.__decorate([n.property({readOnly:!0})],c.prototype,"isGlobal",null);b.__decorate([n.property({readOnly:!0})],
c.prototype,"isLocal",null);b.__decorate([n.property({readOnly:!0})],c.prototype,"viewingMode",void 0);b.__decorate([n.property({readOnly:!0})],c.prototype,"spatialReference",void 0);b.__decorate([n.property({readOnly:!0})],c.prototype,"navigating",null);b.__decorate([n.property({readOnly:!0})],c.prototype,"stationary",null);b.__decorate([n.property()],c.prototype,"_cameraChanged",void 0);b.__decorate([n.property()],c.prototype,"cameraController",null);b=c=b.__decorate([d.subclass("esri.views.3d.state.ViewState")],
c);const z=new C.Camera,A={camera:null},p={camera:null};return b})},"esri/views/3d/state/ViewStateManager":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Camera ../../../Viewpoint ../../../core/Accessor ../../../core/Handles ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/scheduling ../../../core/screenUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/Extent ../../../geometry/Point ../../../geometry/support/webMercatorUtils ../../ViewingMode ../camera/constraintUtils ../camera/intersectionUtils ./ConstraintsManager ./Frustum ./GoToOperation ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/PropertiesPool ../support/viewpointUtils ../webgl-engine/lib/Camera".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N,M,L){const J=n.getLogger("esri.views.3d.state.ViewStateManager");l=function(U){function aa(R){var V=U.call(this,R)||this;V.propertiesPool=new N.PropertiesPool({frustum:F.Frustum},a._assertThisInitialized(V));V.handles=new r;V.cameraSetByUser=!1;V.gotoOperation=null;V.ready=!1;V._windowDevicePixelRatio=1;V._devicePixelRatioOverride=null;V._maximumPixelRatioOverride=null;V.test={contentCameraResetState:new Map,setDevicePixelRatio:da=>
V._devicePixelRatioOverride=da,setMaximumPixelRatio:da=>V._maximumPixelRatioOverride=da};return V}a._inheritsLoose(aa,U);var W=aa.prototype;W.installContentCameraReset=function(R){this.handles.remove("contentCameraReset");this.test.contentCameraResetState.clear();if(!this.view.state.fixedContentCamera)return!1;const V=this.zoom,da=this.view.state.camera.distance**2,ca=B.fromArray(this.view.state.camera.center),ha=R.sticky?this.contentCamera.clone():null;this.handles.add([k.watch(()=>this.contentCamera,
()=>{R.sticky||(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear())}),k.watch(()=>this.zoom,ia=>{this.test.contentCameraResetState.set("view.zoom",Math.abs(ia-V)/2);2<Math.abs(ia-V)?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=ha)}),k.watch(()=>this.view.state.camera,ia=>{ia=x.squaredDistance(ca,ia.center);this.test.contentCameraResetState.set("camera.center",ia/da);ia>da?this.contentCamera=null:this.view.state.fixedContentCamera||
(this.contentCamera=ha)})],"contentCameraReset");return!0};W._paddingToArray=function(R,V,da){R?q.set(da,R.top||0,R.right||0,R.bottom||0,R.left||0):q.set(da,0,0,0,0);for(R=0;4>R;R++)da[R]=Math.round(da[R]*V)};W.initialize=function(){this.handles.add([k.on(()=>this.view.state.events,"before-camera-change",R=>this._updateElevation(R.camera))]);k.watch(()=>this.view.state.camera,R=>this._updateElevation(R),{once:!0,sync:!0});this.handles.add(f.addFrameTask({prepare:()=>this._prepareFrame()}));this.handles.add(k.watch(()=>
this.view.state.cameraController,()=>{this.cameraSetByUser=!0;this.handles.remove("pending-initial-view")}));this.handles.add(k.on(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale")))};W.destroy=function(){this.deinit();this.handles&&(this.handles.destroy(),this.handles=null);this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};W.init=function(){this.constraintsManager=new E.ConstraintsManager({view:this.view});this._prepareFrame();var R=
this._getInitialProperties();this.cameraSetByUser=!1;this._set("ready",!0);for(const V of R)this.set(V.name,V.value);this.cameraSetByUser||((R=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent)&&this.isCompatible(R)?this._setInitialView(R):this.view.state.viewingMode===p.ViewingMode.Local&&this.handles.add(k.when(()=>this.view.basemapTerrain.ready,()=>{this.handles.remove("pending-initial-view");this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),"pending-initial-view"))};
W.deinit=function(){this._cancelGoToOperation();this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this.cameraSetByUser=!1,this.handles.remove("pending-initial-view"),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))};W.goTo=function(){var R=a._asyncToGenerator(function*(V,da){da={animate:!0,...da};g.isSome(this.gotoOperation)&&this.gotoOperation.abort(da.animate);this.gotoOperation=new G.GoToOperation(V,
da,this.view);this.view.resourceController.scheduler.stopFrame();return this.gotoOperation});return function(V,da){return R.apply(this,arguments)}}();W.debugSetCameraOnContent=function(){this.setStateCamera(D.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})};W.step=function(R){const V=this.view.state,da=V&&this.view.state.cameraController;da&&(V.updateCamera(ca=>{da.stepController(R,ca)}),da.steppingFinished&&da.finishController())};W._cancelGoToOperation=function(){g.isSome(this.gotoOperation)&&
(this.gotoOperation.abort(),this.gotoOperation=null)};W._getInitialProperties=function(){const R=new Set,V=[];for(const {propertyName:da,overrides:ca}of I){const ha=R.has(da),ia=this._isOverridden(da);!ha&&ia&&V.push({name:da,value:this._get(da)});this._clearOverride(da);(ha||ia)&&ca.forEach(ka=>R.add(ka))}return V};W._setInitialView=function(R){if(!g.isNone(R)&&!this.cameraSetByUser)if(R instanceof c)this.setStateCamera(K.externalToInternal(this.view,R),{applyConstraints:!1});else if(R instanceof
m)if(R.targetGeometry instanceof C){var V=K.fromExtent(this.view,R.targetGeometry,0,.5,K.OrientationMode.LOCKED);g.isSome(V)&&this.setStateCamera(K.externalToInternal(this.view,V),{applyConstraints:!0})}else V={applyConstraints:!R.camera},R=this._viewpointToCamera(R),this.setStateCamera(R,V);else V=K.fromExtent(this.view,R,0,.5,K.OrientationMode.LOCKED),g.isSome(V)&&this.setStateCamera(K.externalToInternal(this.view,V),{applyConstraints:!0})};W._updatePropertyBeforeReady=function(R,V){if(this.ready)return!1;
this._override(R,V);V&&H.includes(R)&&this._override("hasInitialView",!0);return!0};W.isCompatible=function(R){return g.isNone(R)?!1:R instanceof m?R.camera?this.isCompatible(R.camera):this.isCompatible(R.targetGeometry):R instanceof c?this.isCompatible(R.position):R.spatialReference&&A.canProject(R.spatialReference,this.view.spatialReference)};W._getPreservingHeadingTilt=function(R=O){this.cameraSetByUser?(R.heading=this.camera.heading,R.tilt=this.camera.tilt):(R.heading=0,R.tilt=.5);return R};W._centerPointAtDistanceToCamera=
function(R,V,da=S){const {heading:ca,tilt:ha}=this._getPreservingHeadingTilt();R=K.getObserverForPointAtDistance(this.view,ca,ha,R,V,K.OrientationMode.ADJUST);if(g.isNone(R))return null;da.copyFrom(this.view.state.camera);da.eye=R.eye;da.center=R.center;da.up=R.up;return da};W._centerToCamera=function(R){const V=this.view.pointsOfInterest.centerOnContent;V.runTask();return this._centerPointAtDistanceToCamera(R,V.distance)};W._extentToCamera=function(R){const {heading:V,tilt:da}=this._getPreservingHeadingTilt();
R=K.fromExtent(this.view,R,V,da,K.OrientationMode.ADJUST,Q);return g.isSome(R)?K.externalToInternal(this.view,R):null};W._scaleToCamera=function(R){if(null==R)return null;const V=this.view.pointsOfInterest.centerOnContent;V.runTask();const da=V.renderLocation;R=K.scaleToDistance(this.view,R,V.location.latitude);return this._centerPointAtDistanceToCamera(da,R)};W._zoomToCamera=function(R){return this._scaleToCamera(K.zoomToScale(this.view,R))};W._viewpointToCamera=function(R){return K.externalToInternal(this.view,
M.toCamera(this.view,R))};W.setStateCamera=function(R,V){if(g.isNone(R)||!this.view.state.stopActiveCameraController())return!1;this.cameraSetByUser=!0;V.doNotCancelGoToOperation||this._cancelGoToOperation();this.view.state.updateCamera(da=>{V.positionAndOrientationOnly?(da.eye=R.eye,da.center=R.center,da.up=R.up):da.copyFrom(R);V.applyConstraints&&y.applyAll(this.view,da)});V.applyConstraints||(this.view.state.cameraController=new P.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:R}));
return!0};W._prepareFrame=function(){const {surface:R,canvas:V}=this.view;if(R&&V){this._windowDevicePixelRatio=window.devicePixelRatio;var da=this._devicePixelRatio,ca=Math.round(R.clientWidth*da),ha=Math.round(R.clientHeight*da);if(0!==ca&&0!==ha){if(V.width!==ca||V.height!==ha)V.width=ca,V.height=ha;if(this.view.state){const ia=this.view.state.camera;if(ia.fullWidth!==ca||ia.fullHeight!==ha||ia.pixelRatio!==da)S.copyFrom(ia),S.pixelRatio!==da&&(this._paddingToArray(this.padding,da,T),S.padding=
T),S.fullWidth=ca,S.fullHeight=ha,S.pixelRatio=da,this.view.state.camera=S}}}};W._updateElevation=function(R){var V=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference;const da=this.view.renderCoordsHelper.getAltitude(R.eye);V=V?D.surfaceElevationBelowRenderLocation(this.view,R.eye):0;R.relativeElevation=da-V};a._createClass(aa,[{key:"camera",get:function(){const R=this._get("camera");if(!this.ready)return R;const V=K.internalToExternal(this.view,this.view.state.camera);return V&&
R&&V.equals(R)?R:V},set:function(R){this._updatePropertyBeforeReady("camera",R)||(this.view.elevationProvider.enableElevationCache(!0),this.setStateCamera(K.externalToInternal(this.view,R),{applyConstraints:!1})||J.error("#camera\x3d","Invalid camera",R),this.view.elevationProvider.enableElevationCache(!1))}},{key:"contentCamera",get:function(){const R=this._get("contentCamera");if(!this.ready)return R;const V=K.internalToExternal(this.view,this.view.state.contentCamera);return V&&R&&V.equals(R)?
R:V},set:function(R){this._updatePropertyBeforeReady("contentCamera",R)||(R=K.externalToInternal(this.view,R),g.isNone(R)?this.view.state.contentCamera=null:(this._updateElevation(R),this.view.state.contentCamera=R))}},{key:"center",get:function(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")},set:function(R){this._updatePropertyBeforeReady("center",R)||(R?this.isCompatible(R)?this.setStateCamera(this._centerToCamera(R),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():
J.error("#center\x3d","Invalid center",R):J.error("#center\x3d","Center has an incompatible spatial reference (center: "+(R.spatialReference?R.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",R):J.error("#center\x3d","Center may not be null or undefined"))}},{key:"extent",get:function(){if(!this.ready)return this._get("extent");var R=this.view;R=K.toExtent(R,R.state.camera,R.pointsOfInterest.centerOnContent.renderLocation);return g.isSome(R)?R:this._get("extent")},set:function(R){this._updatePropertyBeforeReady("extent",
R)||(R?this.isCompatible(R)?this.setStateCamera(this._extentToCamera(R),{applyConstraints:!0})||J.error("#extent\x3d","Invalid extent",R):J.error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+(R.spatialReference?R.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",R):J.error("#extent\x3d","Extent may not be null or undefined"))}},{key:"frustum",get:function(){const R=this.propertiesPool.get("frustum");R.renderCoordsHelper=this.view.renderCoordsHelper;
R.update(this.view.state.camera);return R}},{key:"hasInitialView",get:function(){return!!this.view.get("map.initialViewProperties.viewpoint")}},{key:"scale",get:function(){if(this.ready){const R=this.view.pointsOfInterest.centerOnContent;return K.distanceToScale(this.view,R.distance,R.location.latitude)}return this._get("scale")},set:function(R){this._updatePropertyBeforeReady("scale",R)||this.setStateCamera(this._scaleToCamera(R),{applyConstraints:!0})||J.error("#scale\x3d","Invalid scale",R)}},
{key:"padding",get:function(){if(!this.ready)return this._get("padding");var R=this.view.state.camera,V=R.padding;const da=R.pixelRatio;R=this._get("padding");const ca=Math.round(V[L.PaddingSide.TOP]/da),ha=Math.round(V[L.PaddingSide.RIGHT]/da),ia=Math.round(V[L.PaddingSide.BOTTOM]/da);V=Math.round(V[L.PaddingSide.LEFT]/da);return null!=R&&R.top===ca&&R.right===ha&&R.bottom===ia&&R.left===V?R:{top:ca,right:ha,bottom:ia,left:V}},set:function(R){this._updatePropertyBeforeReady("padding",R)||(this._paddingToArray(R,
this.view.state.camera.pixelRatio,T),this.view.state.updateCamera(V=>V.padding=T))}},{key:"screenCenter",get:function(){const R=this.padding;return d.createScreenPoint((this.view.width-(R.left+R.right))/2+R.left,(this.view.height-(R.top+R.bottom))/2+R.top)}},{key:"viewpoint",get:function(){return this.ready?M.fromCamera(this.view,this.camera):this._get("viewpoint")},set:function(R){if(!this._updatePropertyBeforeReady("viewpoint",R))if(R)if(this.isCompatible(R))this.setStateCamera(this._viewpointToCamera(R),
{applyConstraints:!R.camera})||J.error("#viewpoint\x3d","Invalid viewpoint",R);else{var V=g.isSome(R.camera)?R.camera.position:R.targetGeometry;V=g.isSome(V)&&V.spatialReference;J.error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+(V?V.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",R)}else J.error("#viewpoint\x3d","Viewpoint may not be null or undefined")}},{key:"zoom",get:function(){return this.ready?K.scaleToZoom(this.view,this.scale):this._get("zoom")},
set:function(R){this._updatePropertyBeforeReady("zoom",R)||this.setStateCamera(this._zoomToCamera(R),{applyConstraints:!0})||J.error("#zoom\x3d","Invalid zoom",R)}},{key:"maximumPixelRatio",get:function(){if(g.isSome(this._maximumPixelRatioOverride))return this._maximumPixelRatioOverride;let R=Infinity;const {maximumPixelRatio:V,maximumRenderResolution:da}=this.view.qualitySettings;null!=V&&(R=Math.min(R,V));null!=da&&(R=Math.min(R,da/Math.max(this.view.width,this.view.height)));return R}},{key:"_devicePixelRatio",
get:function(){return g.isNone(this._devicePixelRatioOverride)?Math.min(this._windowDevicePixelRatio,this.maximumPixelRatio):this._devicePixelRatioOverride}}]);return aa}(l);b.__decorate([e.property({type:c,dependsOn:["view.state.camera","ready"]})],l.prototype,"camera",null);b.__decorate([e.property({type:c,dependsOn:["view.state.contentCamera","ready"]})],l.prototype,"contentCamera",null);b.__decorate([e.property({type:z})],l.prototype,"center",null);b.__decorate([e.property({type:C})],l.prototype,
"extent",null);b.__decorate([e.property({readOnly:!0})],l.prototype,"frustum",null);b.__decorate([e.property({readOnly:!0})],l.prototype,"hasInitialView",null);b.__decorate([e.property({readOnly:!0,type:Boolean})],l.prototype,"ready",void 0);b.__decorate([e.property({type:Number})],l.prototype,"scale",null);b.__decorate([e.property()],l.prototype,"padding",null);b.__decorate([e.property({readOnly:!0})],l.prototype,"screenCenter",null);b.__decorate([e.property({constructOnly:!0})],l.prototype,"view",
void 0);b.__decorate([e.property({type:m})],l.prototype,"viewpoint",null);b.__decorate([e.property({type:Number})],l.prototype,"zoom",null);b.__decorate([e.property()],l.prototype,"maximumPixelRatio",null);b.__decorate([e.property()],l.prototype,"_devicePixelRatio",null);b.__decorate([e.property()],l.prototype,"_windowDevicePixelRatio",void 0);b.__decorate([e.property()],l.prototype,"_devicePixelRatioOverride",void 0);b.__decorate([e.property()],l.prototype,"_maximumPixelRatioOverride",void 0);b=
l=b.__decorate([t.subclass("esri.views.3d.state.ViewStateManager")],l);const H="camera viewpoint extent scale center zoom".split(" "),I=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],O={heading:0,tilt:0},Q=new c,S=new L.Camera,T=u.create();return b})},
"esri/views/3d/state/ConstraintsManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../ViewingMode ../camera/constraintUtils ../camera/intersectionUtils ../camera/constraintUtils/common ./NearFarHeuristic ./SurfaceCollisionConstraint".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q){a.ConstraintsManager=function(u){function C(A){var p=u.call(this,A)||this;p._handles=new l;p.nearFarHeuristic=B.createNearFarHeuristic(A.view.state.viewingMode,A.view.basemapTerrain,A.view.renderCoordsHelper.spatialReference);return p}b._inheritsLoose(C,u);var z=C.prototype;z.initialize=function(){this._handles.add([g.watch(()=>{var A,p,y,D;return[null==(A=this.view.constraints)?void 0:null==(p=A.clipDistance)?void 0:p.near,null==(y=this.view.constraints)?
void 0:null==(D=y.clipDistance)?void 0:D.far]},()=>this._clipDistanceNearFarChanged()),g.watch(()=>{var A,p;return null==(A=this.view.constraints)?void 0:null==(p=A.clipDistance)?void 0:p.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",A=>this._updateCameraNearFar(A.camera)),g.watch(()=>this.view.renderDataExtent,()=>this._updateNearFar(),g.sync),g.watch(()=>{var A,p,y,D;return[null==(A=this.view.constraints)?void 0:null==(p=A.altitude)?void 0:p.min,null==(y=this.view.constraints)?
void 0:null==(D=y.altitude)?void 0:D.max]},()=>this._updateAltitude(),g.sync),g.watch(()=>{var A,p;return null==(A=this.view.constraints)?void 0:null==(p=A.tilt)?void 0:p.max},()=>this._updateTiltMax(),g.sync),g.watch(()=>{var A,p;return null==(A=this.view.constraints)?void 0:null==(p=A.tilt)?void 0:p.mode},()=>this._updateTilt(),g.sync),g.watch(()=>{var A;return null==(A=this.view.state)?void 0:A.camera},()=>this._updateTiltAutoMax(),g.sync),g.watch(()=>{var A,p,y,D,E,F;return[null==(A=this.view.map)?
void 0:null==(p=A.ground)?void 0:null==(y=p.navigationConstraint)?void 0:y.type,null==(D=this.view.state)?void 0:null==(E=D.constraints)?void 0:null==(F=E.collision)?void 0:F.enabled]},()=>this._updateCollision(),g.sync)]);this.view.state.isLocal&&this._handles.add(g.watch(()=>this.view.renderDataExtent,A=>this._updateLocalSurfaceDistance(A),g.initial));this._updateNearFar();this.view.state.viewingMode!==v.ViewingMode.Local&&this._updateAltitude();this._updateTilt();this._updateCollision();this._set("surfaceCollisionConstraint",
new q.SurfaceCollisionConstraint({view:this.view}))};z.destroy=function(){this._handles=n.destroyMaybe(this._handles);this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))};z._clipDistanceNearFarChanged=function(){var A;const p=null==(A=this.view.constraints)?void 0:A.clipDistance;p&&"auto"!==p.mode&&this.view.state.updateCamera(y=>{this._updateCameraNearFarManual(y,p);return!0})};z._updateNearFar=function(){this.view.state.updateCamera(A=>
{this._updateCameraNearFar(A);return!0})};z._updateCameraNearFar=function(A){const p=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(p?p.mode:"auto")?this._updateCameraNearFarManual(A,p):this._updateCameraNearFarAuto(A,p)};z._updateCameraNearFarAuto=function(A,p){this.nearFarHeuristic.compute(A.eye,A.center,this.view.renderDataExtent,t.surfaceElevationBelowRenderLocation(this.view,A.eye),A);p&&p.autoUpdate(A.near,A.far)};z._updateCameraNearFarManual=function(A,p){p&&(A.near=
p.near,A.far=p.far)};z._updateCollision=function(){var A,p,y;const D=null==(A=this.view.map)?void 0:null==(p=A.ground)?void 0:null==(y=p.navigationConstraint)?void 0:y.type;A=D?"stay-above"===D:!0;p=this.view.state.constraints.collision;A!==p.enabled&&((p.enabled=A)&&this._reapplyConstraints(x.ConstraintTypes.COLLISION),(A=this.view.constraints&&this.view.constraints.tilt)&&"auto"!==A.mode||this._updateTiltAuto())};z._updateAltitude=function(){const A=this.view.constraints&&this.view.constraints.altitude;
this.view.state.constraints.altitude=A&&this.view.state.viewingMode!==v.ViewingMode.Local?{min:A.min,max:A.max}:null;this._reapplyConstraints()};z._updateTiltMax=function(){const A=this.view.constraints&&this.view.constraints.tilt;A&&"auto"!==A.mode&&(this._updateTiltManual(A),this._reapplyConstraints())};z._updateTilt=function(){const A=this.view.constraints&&this.view.constraints.tilt;"manual"===(A?A.mode:"auto")?this._updateTiltManual(A):this._updateTiltAuto();this._reapplyConstraints()};z._updateTiltManual=
function(A){const p=this.view.state.constraints;p.tilt=p.createConstantMaxTilt(r.deg2rad(A.max))};z._updateTiltAuto=function(){const A=this.view.state.constraints;A.tilt=A.createDefaultTilt();this._updateTiltAutoMax()};z._updateTiltAutoMax=function(){const A=this.view.constraints&&this.view.constraints.tilt;if(A&&"auto"===A.mode){var p=this.view.state.constraints;p.tilt&&(p=p.tilt(this.view.state.camera.distance).max,A.autoUpdate(r.rad2deg(p)))}};z._updateLocalSurfaceDistance=function(A){if(!n.isNone(A)){var p=
Math.max(A.width,A.height);0>=p||(A.hasZ&&(p=Math.max(p,A.zmax-A.zmin)),A=this.view.state,p=3*p/Math.atan(A.camera.fov/2),p!==A.constraints.distance&&(A.constraints.distance=p))}};z._reapplyConstraints=function(A=x.ConstraintTypes.ALL){this.view.state.updateCamera(p=>w.applyAll(this.view,p,{selection:A,interactionType:x.InteractionType.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:x.TiltMode.TUMBLE}))};return C}(m);c.__decorate([k.property({constructOnly:!0})],
a.ConstraintsManager.prototype,"view",void 0);c.__decorate([k.property({readOnly:!0})],a.ConstraintsManager.prototype,"surfaceCollisionConstraint",void 0);a.ConstraintsManager=c.__decorate([h.subclass("esri.views.3d.state.ConstraintsManager")],a.ConstraintsManager);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/NearFarHeuristic":function(){define("exports ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/Extent ../../../geometry/projectionEllipsoid ../../ViewingMode".split(" "),
function(a,b,c,m,l,r,n,g,k){function f(w,t,x,B){x=2/x;w/t>x?(B.far=w,B.near=B.far/t):(B.near=x,B.far=B.near*t);return B}let d=function(){function w(t,x){this.elevationProvider=t;this._referenceEllipsoid=g.getReferenceEllipsoid(x);this.unitInMeters=m.getMetersPerUnitForSR(x,this._referenceEllipsoid.metersPerDegree)}w.prototype.compute=function(t,x,B,q,u){u||(u={near:0,far:0});var C=t[2]*this.unitInMeters,z=C;q=C-q;var A=this.elevationProvider?this.elevationProvider.elevationBounds:null;A&&(C=0<=q?
z-this.unitInMeters*A.min:this.unitInMeters*A.max-z);B=c.isSome(B)?B:new n({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0});z=Math.max(B.xmax-B.xmin,B.ymax-B.ymin,4*Math.max(B.xmax-B.xmin,B.ymax-B.ymin));l.subtract(v,x,t);h[0]=0<v[0]?B.xmax:B.xmin;h[1]=0<v[1]?B.ymax:B.ymin;h[2]=0<v[2]?z/2:-z/2;l.subtract(h,h,t);l.normalize(v,v);t=1.1*l.dot(h,v)*this.unitInMeters;x=Math.sqrt(C*(C+2*this._referenceEllipsoid.radius));B=Math.max(B.xmax-B.xmin,B.ymax-B.ymin);A=1E-4*B*this.unitInMeters;C=b.clamp((C-A)/(.001*
B*this.unitInMeters-A),0,1);C=b.lerp(x,t,C*C*C);C*=Math.max(Math.log(Math.abs(q)),1);C=Math.min(C,Math.max(34064E4,z));C/=this.unitInMeters;return f(C,2E4,this.unitInMeters,u)};return w}(),e=function(){function w(t){this._referenceEllipsoid=g.getReferenceEllipsoid(t)}w.prototype.compute=function(t,x,B,q,u){u||(u={near:0,far:0});t=l.length(t)-this._referenceEllipsoid.radius;t=Math.max(Math.abs(t-q),Math.abs(t));q=Math.sqrt(t*(t+2*(this._referenceEllipsoid.radius+Math.min(0,q))));t=b.clamp(2E4-(Math.log(t)-
7.983)/9.011*19E3,1E3,2E4);return f(1.2*q,t,1,u)};return w}();const h=r.create(),v=r.create();a.createNearFarHeuristic=function(w,t,x){return w===k.ViewingMode.Global?new e(x):new d(t,x)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../camera/constraintUtils ../camera/intersectionUtils ../camera/constraintUtils/surfaceCollision".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h){a.SurfaceCollisionConstraint=function(v){function w(x){x=v.call(this,x)||this;x.handles=new l;return x}b._inheritsLoose(w,v);var t=w.prototype;t.initialize=function(){this.handles.add(this.view.basemapTerrain.on("elevation-change",x=>this._handleElevationChangeEvent(x)))};t.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};t._handleElevationChangeEvent=function(x){this.view.state.cameraController||e.eyeWithinExtent(this.view,this.view.state.camera,
x.extent,x.spatialReference)&&this._applyToCurrentCamera()};t._applyToCurrentCamera=function(){this.view.state.updateCamera(x=>{h.applySurfaceCollisionConstraint(this.view,x,h.Mode.EYE_AND_CENTER)})};return w}(m);c.__decorate([r.property({constructOnly:!0})],a.SurfaceCollisionConstraint.prototype,"view",void 0);a.SurfaceCollisionConstraint=c.__decorate([f.subclass("esri.views.3d.state.ElevationCollisionConstraint")],a.SurfaceCollisionConstraint);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/state/GoToOperation":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Camera ../../../Viewpoint ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../camera/constraintUtils ./controllers/CameraController ./controllers/PointToPointAnimationController ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/viewpointUtils ../camera/constraintUtils/surfaceCollision".split(" "),function(a,
b,c,m,l,r,n,g,k,f,d,e,h,v,w){let t=function(){function x(q,u,C){this.target=q;this.options=u;this.view=C;this.state="pending";this.animationController=this.abortController=null;this.promise=new Promise((z,A)=>{this.resolveCallback=z;this.rejectCallback=A;z=new AbortController;if(r.isSome(this.options.signal))n.onAbort(this.options.signal,()=>{this.abort()});this.abortController=z;this.waitForReady()})}var B=x.prototype;B.then=function(q,u){return this.promise.then(q,u)};B.catch=function(q){return this.promise.catch(q)};
B.resolve=function(q){this.state="finished";return this.resolveCallback(q)};B.reject=function(q){this.state="finished";return this.rejectCallback(q)};B.abort=function(q=!1){switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":this.reject(n.createAbortError());break;case "wait-for-animation-finish":!q&&r.isSome(this.animationController)&&this.view.state.cameraController===this.animationController&&this.animationController.active&&this.animationController.stopController(),
this.reject(n.createAbortError())}};B.waitForReady=function(){var q=b._asyncToGenerator(function*(){this.state="wait-for-ready";if(!this.view.ready)try{yield g.whenOnce(()=>this.view.ready,this.abortController.signal)}catch(u){return this.reject(u)}this.createViewPoint()});return function(){return q.apply(this,arguments)}}();B.createViewPoint=function(){"finished"!==this.state&&(this.state="wait-for-viewpoint",this.animationController=this.options.animate?this._getAnimationController():null,v.create(this.view,
this.target,this.abortController.signal).then(q=>{"finished"!==this.state&&(q=this._getCameraFromViewpoint(q),r.isNone(q)||(this.options.animate?r.isNone(this.animationController)||this.startAnimation(q,this.animationController):(this.view.stateManager.setStateCamera(q.camera,{applyConstraints:!q.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve())))},q=>{this.reject(q)}))};B._getCameraFromViewpoint=function(q){const u=!!(this.target instanceof m&&this.target.camera||
this.target instanceof c);var C=q.camera;if(r.isNone(C))return null;if(!this.view.stateManager.isCompatible(C))return q=(q=C.position)&&q.spatialReference,this.reject(new l("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${q?q.wkid:"none"}, view: ${this.view.spatialReference.wkid})`,{camera:C})),null;C=h.externalToInternal(this.view,C);return r.isNone(C)?(this.reject(new l("GotoAnimation:invalid-camera","Resulting camera is invalid")),
null):{viewpoint:q,camera:C,isFullySpecified:u}};B.startAnimation=function(q,u){this.state="wait-for-animation-finish";const C=u.viewAnimation;if(r.isNone(C))this.reject(new l("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));else{C.update(q.viewpoint,"running");if(!u.active||r.isNone(u.viewAnimation)||u.viewAnimation.target!==q.viewpoint||this.view.state.cameraController!==u)return this.abort();if(q.isFullySpecified){var z=new e.SurfaceCollisionCorrectionController({view:this.view,
desiredCamera:q.camera});w.applySurfaceCollisionConstraint(this.view,q.camera,w.Mode.EYE_AND_CENTER)}else k.applyAll(this.view,q.camera);u.begin(q.camera,this.options);var A=p=>{if(!r.isNone(this.view.state))switch(u.state){case f.State.Finished:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.resolve()}break;case f.State.Ready:case f.State.Rejected:case f.State.Running:case f.State.Stopped:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.reject(p)}}};
C.when(()=>{const p=this.view.state.cameraController;z&&(p&&p.active?p instanceof d.PointToPointAnimationController&&r.isSome(p.viewAnimation)&&p.viewAnimation.target===q.viewpoint&&(this.view.state.cameraController=z):r.isSome(u.viewAnimation)&&u.viewAnimation.target===q.viewpoint&&"finished"===u.state&&(this.view.state.cameraController=z))},p=>A(p));u.asyncResult={resolve:()=>A(),reject:p=>A(p)}}};B._getAnimationController=function(){let q;var u=null;u=this.view.state.cameraController;u instanceof
d.PointToPointAnimationController&&(u.updateStateFromViewAnimation(),u.active&&(q=u,u=q.viewAnimation));return null!=q||(q=new d.PointToPointAnimationController({view:this.view,mode:"animation"}),u=q.viewAnimation,this.view.state.switchCameraController(q))?q:(r.isSome(u)&&u.stop(),this.reject(new l("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)};return x}();a.GoToOperation=t;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Handles ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../camera/constraintUtils ../../camera/intersectionUtils ./CameraController ../../camera/constraintUtils/surfaceCollision".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h){a.SurfaceCollisionCorrectionController=function(v){function w(x){x=v.call(this,x)||this;x.handles=new m;return x}b._inheritsLoose(w,v);var t=w.prototype;t.onControllerStart=function(){this.state=e.State.Running;this.handles.add(this.view.basemapTerrain.on("elevation-change",x=>this._handleElevationChangeEvent(x)));this._applyCorrection()};t.onControllerEnd=function(){this.handles.removeAll()};t.stepController=function(){};t._handleElevationChangeEvent=function(x){d.eyeWithinExtent(this.view,
this.desiredCamera,x.extent,x.spatialReference)&&this._applyCorrection()};t._applyCorrection=function(){this.view.state.updateCamera(x=>{x.copyViewFrom(this.desiredCamera);h.applySurfaceCollisionConstraint(this.view,x,h.Mode.EYE_AND_CENTER)||this.constraintEnabled||(this.state=e.State.Stopped)})};b._createClass(w,[{key:"desiredCamera",set:function(x){this._set("desiredCamera",x.clone())}},{key:"canStop",get:function(){return!0}},{key:"constraintEnabled",get:function(){return this.view.state.constraints.collision.enabled}}]);
return w}(e.CameraController);c.__decorate([l.property({constructOnly:!0})],a.SurfaceCollisionCorrectionController.prototype,"view",void 0);c.__decorate([l.property({constructOnly:!0})],a.SurfaceCollisionCorrectionController.prototype,"desiredCamera",null);a.SurfaceCollisionCorrectionController=c.__decorate([k.subclass("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],a.SurfaceCollisionCorrectionController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/support/viewpointUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Camera ../../../geometry ../../../Graphic ../../../Viewpoint ../../../core/asyncUtils ../../../core/has ../../../core/Cyclical ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ./cameraUtils ./ElevationProvider ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/Extent ../../../geometry/Geometry".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G){function P(ra){return 360-k.cyclicalDegrees.normalize(ra)}function K(ra){return k.cyclicalDegrees.normalize(360-ra)}function N(ra){d.isSome(ra)&&ra.resolver&&ra.resolver.reject();return null}function M(ra,Ea,Ia,Ma=null){if(!Ea)return N(Ma);var Qa=ra.spatialReference||E.WGS84;if(d.isSome(Ea.camera)){ra=z.project(Ea.camera.position,Qa);if(d.isNone(ra))return N(Ma);Ea=Ea.camera.clone();Ea.position=ra;ra=Ea;d.isSome(Ma)&&Ma.resolver&&
Ma.resolver.resolve(ra);return ra}if(d.isNone(Ea.targetGeometry))return N(Ma);var wa=Ea.get("targetGeometry.spatialReference");if(wa&&!z.canProject(wa,Qa))return N(Ma);Qa=p.internalToExternal(ra,ra.state.camera);wa=p.OrientationMode.ADJUST;null!=Ea.rotation&&(Qa.heading=P(Ea.rotation),wa=p.OrientationMode.LOCKED);null!=Ia&&(Qa.tilt=Ia);if("point"===Ea.targetGeometry.type){const Ja=Ea.targetGeometry;Ia=Ea.targetGeometry.clone();Ea=null!=Ea.scale?p.scaleToDistance(ra,Ea.scale,Ja.latitude):ra.state.camera.distance;
return p.fromCenterDistance(ra,Ia,Ea,Qa,wa,Ma)}return p.fromExtent(ra,Ea.targetGeometry.extent,Qa.heading,Qa.tilt,wa,Ma)}function L(){L=b._asyncToGenerator(function*(ra,Ea,Ia){if(Ea&&ra.spatialReference){var Ma={target:null};if("declaredClass"in Ea||Array.isArray(Ea))Ma.target=Ea;else{for(var Qa in Ea)Ma[Qa]=Ea[Qa];Ea.center&&!Ma.target&&(Ma.target=Ea.center)}Ea=Ma}else Ea=null;if(!Ea)throw new f("viewpointutils-create:no-target","Missing target for creating viewpoint");Ma=new c({fov:ra.camera.fov});
Qa=new r({camera:Ma});if(Ea.target instanceof r)return ra=yield aa(ra,Ea.target,Ea,Ia,Qa),ea(ra);if(Ea.target instanceof c)return ea(R(ra,Ea.target,Qa));var wa=null!=Ea.scale||null!=Ea.zoom;if(Ea.target instanceof F){var Ja=Ea.target.xmin===Ea.target.xmax||Ea.target.ymin===Ea.target.ymax;return wa||Ja?ea(yield V(ra,Ea,Ea.target.center,Ma,Ia,Qa)):ea(yield ia(ra,Ea,Ea.target,Ma,Ia,Qa))}Ja={boundingBox:q.empty(),hasZ:!1,screenSpaceObjects:[]};var Ta=wa?p.scaleToResolution(ra,J(ra,Ea)):void 0;yield T(ra,
Ea.target,Ta,Ja);if(isFinite(Ja.boundingBox[0])){q.center(Ja.boundingBox,ba);pa.x=ba[0];pa.y=ba[1];pa.z=ba[2];pa.spatialReference=ra.spatialReference;isFinite(pa.z)&&Ja.hasZ?Ta=q.isPoint(Ja.boundingBox):(pa.z=void 0,Ta=u.isPoint(q.toRect(Ja.boundingBox,oa)));if(wa||Ta)return ea(yield V(ra,Ea,pa,Ma,Ia,Qa));wa=Ja.screenSpaceObjects;if(wa.length){Ta=Number.NEGATIVE_INFINITY;for(let Xa=0;Xa<wa.length;Xa++){const ma=wa[Xa].screenSpaceBoundingRect;Ta=Math.max(Ta,Math.abs(ma[0]),Math.abs(ma[1]),Math.abs(ma[2]),
Math.abs(ma[3]))}wa=.66-Ta/Math.min(ra.width,ra.height)*2}else wa=.66;return ea(yield la(ra,Ea,pa,Ja.boundingBox,wa,Ma,Ia,Qa))}return Ea.position?(Ia=A.cameraOnContentAlongViewDirection(ra),t.copy(sa,Ia.viewForward),p.directionToHeadingTilt(ra,Ia.eye,sa,Ia.up,Ga),Ma.position=new D(Ea.position),Ma.heading=null!=Ea.heading?Ea.heading:Ga.heading,Ma.tilt=null!=Ea.tilt?Ea.tilt:Ga.tilt,ra=I(ra,null,Ma,Qa),ea(ra)):ea(yield ca(ra,Ea,Ma,Ia,Qa))});return L.apply(this,arguments)}function J(ra,Ea){return null==
Ea.scale&&null!=Ea.zoom?p.zoomToScale(ra,Ea.zoom):Ea.scale}function H(ra,Ea){let Ia=!1;null!=Ea.heading?(ra.heading=Ea.heading,Ia=!0):null!=Ea.rotation&&(ra.heading=P(Ea.rotation),Ia=!0);null!=Ea.tilt&&(ra.tilt=Ea.tilt,Ia=!0);null!=Ea.fov&&(ra.fov=Ea.fov);return Ia}function I(ra,Ea,Ia,Ma){const Qa=ra.spatialReference||E.WGS84;Ea=d.isSome(Ea)?Ea:p.externalToInternal(ra,Ia);if(d.isNone(Ea))return Ma;Ma.targetGeometry=B.projectVectorToPoint(Ea.center,ra.renderSpatialReference,Qa);Ma.scale=p.computeScale(ra,
Ea);Ma.rotation=K(Ia.heading);Ma.camera=Ia;return Ma}function O(ra,Ea,Ia){if(Ea){if(!z.canProject(Ea.spatialReference,ra.spatialReference))throw new f("viewpointutils:incompatible-spatialreference",`Spatial reference (${Ea.spatialReference?Ea.spatialReference.wkid:"unknown"}) is incompatible with the view (${ra.spatialReference.wkid})`,{geometry:Ea});var Ma=[];if(!Ea.hasZ&&ra.basemapTerrain){switch(Ea.type){case "point":var Qa=Ea;break;case "multipoint":case "polyline":Qa=Ea.extent.center;break;case "mesh":Qa=
Ea.origin;break;case "extent":Qa=Ea.center;break;case "polygon":Qa=Ea.centroid}Qa&&z.canProject(Qa,ra.basemapTerrain.spatialReference)?ba[2]=d.unwrapOr(y.getElevationAtPoint(ra.elevationProvider,Qa),0):ba[2]=0}(0,Da[Ea.type])(Ea,Ja=>{Ma.push(Ja[0],Ja[1],Ja[2])},ba);var wa=Ma.length/3;if(0!==wa&&(Qa=Array(Ma.length),B.projectBuffer(Ma,Ea.spatialReference,0,Qa,ra.spatialReference,0,wa)))for(Ea.hasZ&&(Ia.hasZ=!0),ra=0;ra<Qa.length;ra+=3)Ea.hasZ?(ba[0]=Qa[ra+0],ba[1]=Qa[ra+1],ba[2]=Qa[ra+2]):(ba[0]=Qa[ra+
0],ba[1]=Qa[ra+1]),q.expandWithVec3(Ia.boundingBox,ba)}}function Q(ra,Ea,Ia,Ma){return S.apply(this,arguments)}function S(){S=b._asyncToGenerator(function*(ra,Ea,Ia,Ma){const Qa=yield n.result(ra.whenViewForGraphic(Ea));if(!1!==Qa.ok&&!d.isNone(Qa.value)&&"whenGraphicBounds"in Qa.value)if(Ia=yield n.result(Qa.value.whenGraphicBounds(Ea,{minDemResolution:Ia})),!1===Ia.ok)O(ra,Ea.geometry,Ma);else{var {screenSpaceObjects:wa,boundingBox:Ja}=Ia.value;q.expandWithAABB(Ma.boundingBox,Ja);wa&&wa.forEach(Ta=>
{Ma.screenSpaceObjects.push(Ta)});isFinite(Ja[2])&&(Ma.hasZ=!0)}else O(ra,Ea.geometry,Ma)});return S.apply(this,arguments)}function T(ra,Ea,Ia,Ma){return U.apply(this,arguments)}function U(){U=b._asyncToGenerator(function*(ra,Ea,Ia,Ma){if(Array.isArray(Ea)&&2===Ea.length){const Qa=Ea[0],wa=Ea[1];if("number"===typeof Qa&&"number"===typeof wa){pa.x=Qa;pa.y=wa;pa.z=void 0;pa.spatialReference=ra.spatialReference.isGeographic?ra.spatialReference:E.WGS84;O(ra,pa,Ma);return}}Ea&&"function"===typeof Ea.map?
yield e.eachAlways(Ea.map(Qa=>T(ra,Qa,Ia,Ma))):Ea instanceof G?O(ra,Ea,Ma):Ea instanceof l&&(yield Q(ra,Ea,Ia,Ma))});return U.apply(this,arguments)}function aa(ra,Ea,Ia,Ma,Qa){return W.apply(this,arguments)}function W(){W=b._asyncToGenerator(function*(ra,Ea,Ia,Ma,Qa){if(d.isSome(Ea.camera))return R(ra,Ea.camera,Qa);Qa.scale=Ea.scale;Qa.rotation=Ea.rotation;Qa.targetGeometry=d.isSome(Ea.targetGeometry)?Ea.targetGeometry.clone():null;Qa.camera=null;null!=Ia.heading?Qa.rotation=K(Ia.heading):null!=Ia.rotation&&
(Qa.rotation=Ia.rotation);Ea=J(ra,Ia);null!=Ea&&(Qa.scale=Ea);Ma=new p.AsyncContext(Ma);M(ra,Qa,Ia.tilt,Ma);Qa.camera=yield Ma.resolver.promise;return Qa});return W.apply(this,arguments)}function R(ra,Ea,Ia){const Ma=z.project(Ea.position,ra.spatialReference);if(d.isNone(Ma))return null;Ea=Ea.clone();Ea.fov=ra.camera.fov;Ea.position=Ma;return I(ra,null,Ea,Ia)}function V(ra,Ea,Ia,Ma,Qa,wa){return da.apply(this,arguments)}function da(){da=b._asyncToGenerator(function*(ra,Ea,Ia,Ma,Qa,wa){if(d.isNone(Ia))throw new f("createfromcenter",
"invalid point");wa.targetGeometry=Ia.clone();const Ja=A.cameraOnContentAlongViewDirection(ra);if(Ea.position)return Ia=wa.targetGeometry,Qa=ra.renderSpatialReference,B.projectPointToVector(Ea.position,qa,Qa),B.projectPointToVector(Ia,Ha,Qa),wa.targetGeometry=new D(Ia),Ma.position=new D(Ea.position),t.subtract(sa,Ha,qa),p.directionToHeadingTilt(ra,qa,sa,Ja.up,Ma),wa.scale=p.distanceToScale(ra,t.distance(qa,Ha),wa.targetGeometry.latitude),wa.rotation=K(Ma.heading),wa.camera=Ma,wa;if(Ea.zoomFactor){var Ta=
Ja.distance/Ea.zoomFactor;const Xa=t.scale(ba,Ja.viewForward,-Ta);Ja.eye=t.add(ba,Ja.center,Xa);wa.scale=p.distanceToScale(ra,Ta,Ia.latitude)}p.internalToExternal(ra,Ja,Ma);Ta=H(Ma,Ea)?p.OrientationMode.LOCKED:p.OrientationMode.ADJUST;Ea.zoomFactor||(wa.scale=J(ra,Ea),null==wa.scale&&(B.projectPointToVector(Ia,ba,ra.renderSpatialReference),C.intersectsPoint(Ja.frustum,ba)?wa.scale=p.distanceToScale(ra,t.distance(Ja.eye,ba),Ia.latitude):wa.scale=p.computeScale(ra,Ja)),Ea=new p.AsyncContext(Qa),p.fromCenterScale(ra,
wa.targetGeometry,wa.scale,Ma,Ta,Ea),wa.camera=yield Ea.resolver.promise);return wa});return da.apply(this,arguments)}function ca(ra,Ea,Ia,Ma,Qa){return ha.apply(this,arguments)}function ha(){ha=b._asyncToGenerator(function*(ra,Ea,Ia,Ma,Qa){var wa=A.cameraOnContentAlongViewDirection(ra);wa=B.projectVectorToPoint(wa.center,ra.renderSpatialReference,ra.spatialReference);return V(ra,Ea,wa,Ia,Ma,Qa)});return ha.apply(this,arguments)}function ia(ra,Ea,Ia,Ma,Qa,wa){return ka.apply(this,arguments)}function ka(){ka=
b._asyncToGenerator(function*(ra,Ea,Ia,Ma,Qa,wa){wa.targetGeometry=Ia.clone();const Ja=A.cameraOnContentAlongViewDirection(ra);p.internalToExternal(ra,Ja,Ma);Ea=H(Ma,Ea)?p.OrientationMode.LOCKED:p.OrientationMode.ADJUST;Qa=new p.AsyncContext(Qa);p.fromExtent(ra,Ia,Ma.heading,Ma.tilt,Ea,Qa);wa.camera=yield Qa.resolver.promise;return wa});return ka.apply(this,arguments)}function la(ra,Ea,Ia,Ma,Qa,wa,Ja,Ta){return Y.apply(this,arguments)}function Y(){Y=b._asyncToGenerator(function*(ra,Ea,Ia,Ma,Qa,wa,
Ja,Ta){Ta.targetGeometry=Ia.clone();const Xa=A.cameraOnContentAlongViewDirection(ra);var ma=0;Ia.hasZ?ma=Ia.z:ra.basemapTerrain&&(ma=d.unwrap(y.getElevationAtPoint(ra.elevationProvider,Ia)));t.set(ba,Ia.x,Ia.y,ma);B.computeTranslationToOriginAndRotation(ra.spatialReference,ba,Z,ra.renderSpatialReference);h.fromMat4(fa,Z);h.transpose(fa,fa);q.empty(ja);Ia=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(var $a=0;$a<Ia.length;$a++){const xa=Ia[$a];let Ka=Ma[xa[2]];isFinite(Ka)||
(Ka=ma);t.set(ba,Ma[xa[0]],Ma[xa[1]],Ka);B.projectVectorToVector(ba,ra.spatialReference,ba,ra.renderSpatialReference);q.expandWithVec3(ja,t.transformMat3(ba,ba,fa))}Ma=q.width(ja);ma=q.height(ja);Ia=q.depth(ja);$a=1/Math.tan(Xa.fovY/2);Qa=Math.max(.5*Math.sqrt(Ma*Ma+Ia*Ia)*Math.max($a,1/Math.tan(Xa.fovX/2))+.5*ma,.5*ma*$a+.5*Math.max(Ma,Ia))/Qa;p.internalToExternal(ra,Xa,wa);Ea=H(wa,Ea)?p.OrientationMode.LOCKED:p.OrientationMode.ADJUST;Ta.scale=p.distanceToScale(ra,Qa,Ta.targetGeometry.latitude);
Ja=new p.AsyncContext(Ja);p.fromCenterScale(ra,Ta.targetGeometry,Ta.scale,wa,Ea,Ja);Ta.camera=yield Ja.resolver.promise;return Ta});return Y.apply(this,arguments)}function ea(ra){ra&&d.isSome(ra.camera)&&(ra.rotation=K(ra.camera.heading));return ra}const ba=x.create(),Z=w.create(),fa=v.create(),ja=q.create(),oa=u.create(),sa=x.create(),qa=x.create(),Ha=x.create(),Ga={heading:0,tilt:0},pa=new D,Da={point(ra,Ea,Ia){Ia[0]=ra.x;Ia[1]=ra.y;ra.hasZ&&(Ia[2]=ra.z);Ea(Ia)},polygon(ra,Ea,Ia){const Ma=ra.hasZ;
for(let Qa=0;Qa<ra.rings.length;Qa++){const wa=ra.rings[Qa];for(let Ja=0;Ja<wa.length;Ja++)Ia[0]=wa[Ja][0],Ia[1]=wa[Ja][1],Ma&&(Ia[2]=wa[Ja][2]),Ea(Ia)}},polyline(ra,Ea,Ia){const Ma=ra.hasZ;for(let Qa=0;Qa<ra.paths.length;Qa++){const wa=ra.paths[Qa];for(let Ja=0;Ja<wa.length;Ja++)Ia[0]=wa[Ja][0],Ia[1]=wa[Ja][1],Ma&&(Ia[2]=wa[Ja][2]),Ea(Ia)}},multipoint(ra,Ea,Ia){const Ma=ra.points;ra=ra.hasZ;for(let Qa=0;Qa<Ma.length;Qa++)Ia[0]=Ma[Qa][0],Ia[1]=Ma[Qa][1],ra&&(Ia[2]=Ma[Qa][2]),Ea(Ia)},extent(ra,Ea,
Ia){ra.hasZ?(Ea(t.set(Ia,ra.xmin,ra.ymin,ra.zmin)),Ea(t.set(Ia,ra.xmax,ra.ymin,ra.zmin)),Ea(t.set(Ia,ra.xmin,ra.ymax,ra.zmin)),Ea(t.set(Ia,ra.xmax,ra.ymax,ra.zmin)),Ea(t.set(Ia,ra.xmin,ra.ymin,ra.zmax)),Ea(t.set(Ia,ra.xmax,ra.ymin,ra.zmax)),Ea(t.set(Ia,ra.xmin,ra.ymax,ra.zmax)),Ea(t.set(Ia,ra.xmax,ra.ymax,ra.zmax))):(Ea(t.set(Ia,ra.xmin,ra.ymin,Ia[2])),Ea(t.set(Ia,ra.xmax,ra.ymin,Ia[2])),Ea(t.set(Ia,ra.xmin,ra.ymax,Ia[2])),Ea(t.set(Ia,ra.xmax,ra.ymax,Ia[2])))},mesh(ra,Ea,Ia){if(ra=ra.vertexAttributes&&
ra.vertexAttributes.position)for(let Ma=0;Ma<ra.length;Ma+=3)Ea(t.set(Ia,ra[Ma+0],ra[Ma+1],ra[Ma+2]))}};a.create=function(ra,Ea,Ia){return L.apply(this,arguments)};a.fromCamera=function(ra,Ea,Ia=null){d.isNone(Ia)&&(Ia=new r);return I(ra,null,Ea.clone(),Ia)};a.headingToRotation=K;a.rotationToHeading=P;a.toCamera=M;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/helpers/SceneIntersectionHelper":function(){define("exports ../../../../core/maybe ../../../../core/PooledArray ../../../../core/screenUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/ray ../../../../geometry/support/vectorStacks ../../../ViewingMode ../../support/geometryUtils/ray ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/intersectorUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){function w(A){q&&q.viewingMode===A||(q=e.newIntersector(A));return q}let t=function(){function A(y,D,E){this.viewingMode=y;this._forEachLayer=D;this.view=E;this.externalIntersectionHandlers=new c;this.tolerance=e.DEFAULT_TOLERANCE;this.tmpRay=g.create();this.tmpRegion=n.create();this.validateHUDIntersector=e.newIntersector(this.viewingMode);this.validateHUDIntersector.options.hud=!1}var p=A.prototype;p.intersectScreen=function(y,D,E){return this.intersectRay(this._getPickRay(y,
this.tmpRay),w(this.viewingMode),D,E)};p.intersectScreenFreePointFallback=function(y,D,E){return this.intersectRayFreePointFallback(this._getPickRay(y,this.tmpRay),D,E)};p.intersectRayFreePointFallback=function(y,D,E){return this.intersectRay(y,w(this.viewingMode),D,E)||this._intersectRayFreePointLocal(y,D)};p.intersectRay=function(y,D,E,F){D.options.selectionMode=!1;D.options.store=h.StoreResults.MIN;this.computeIntersection(y,D,F);return D.results.min?D.results.min.getIntersectionPoint(E):!1};p.getCenterRayWithSubpixelOffset=
function(y,D,E=.5,F=.5){y.getRenderCenter(z,E,F);z[0]+=.0466;z[1]-=.0123;return d.fromRenderAtEye(y,z,D)};p.intersectIntersectorScreen=function(y,D,E){this.computeIntersection(this._getPickRay(y,this.tmpRay),D,E)};p.intersectToolIntersectorScreen=function(y,D,E){y=this._getPickRay(y,this.tmpRay);this.intersectToolIntersectorRay(y,D,E)};p.intersectToolIntersectorRay=function(y,D,E){D.options.selectionMode=!0;this.computeIntersection(y,D,E);const F=D.results.min;this.view.basemapTerrain&&this.view.basemapTerrain.opaque||
v.isValidIntersectorResult(F)&&F.intersector!==h.IntersectorType.TERRAIN||(D.options.selectionMode=!1,this.computeIntersection(y,D,E))};p.setTolerance=function(y=e.DEFAULT_TOLERANCE){this.tolerance=y};p.addIntersectionHandler=function(y){this.externalIntersectionHandlers.push(y);this.externalIntersectionHandlers.sort((D,E)=>D.type===h.IntersectorType.TERRAIN?1:E.type===h.IntersectorType.TERRAIN?-1:0)};p.removeIntersectionHandler=function(y){null!=this.externalIntersectionHandlers.removeUnordered(y)&&
this.externalIntersectionHandlers.sort((D,E)=>D.type===h.IntersectorType.TERRAIN?1:E.type===h.IntersectorType.TERRAIN?-1:0)};p._getPickRay=function(y,D){return d.fromScreen(this.view.state.camera,y,D)};p._intersectRayFreePointLocal=function(y,D){if(this.viewingMode!==f.ViewingMode.Local||b.isNone(y))return!1;var E=this.view.renderDataExtent;if(b.isNone(E))return l.add(D,y.origin,l.normalize(k.sv3d.get(),y.direction)),!0;var F=Math.max(E.xmax-E.xmin,E.ymax-E.ymin,8*Math.max(E.xmax-E.xmin,E.ymax-E.ymin));
if(0===F)return l.add(D,y.origin,l.normalize(k.sv3d.get(),y.direction)),!0;var G=this.view.state.camera;const P=Math.max(0,E.xmin-G.eye[0],G.eye[0]-E.xmax);E=Math.max(0,E.ymin-G.eye[1],G.eye[1]-E.ymax);G=F/Math.max(1,Math.max(0,Math.log(F/(Math.abs(G.relativeElevation)+Number.MIN_VALUE)))**2);G=Math.max(G,Math.min(Math.sqrt(P*P+E*E),F));F=l.scale(k.sv3d.get(),y.direction,G/l.length(y.direction));l.add(D,y.origin,F);return!0};p.intersectElevationFromScreen=function(y,D,E=0,F=null){return this._intersectElevation(this._getPickRay(y,
this.tmpRay),D,E,F)};p._intersectElevation=function(y,D,E=0,F=null){if(b.isNone(y))return null;var G=b.isSome(D)?D.mode:"absolute-height",P=b.isSome(D)?b.unwrapOr(D.offset,0):0,K="on-the-ground"!==G?P+E:0;D=K/this.view.renderCoordsHelper.unitInMeters;if("absolute-height"===G)return this.view.renderCoordsHelper.intersectInfiniteManifold(y,K,C)?(E=this.view.computeMapPointFromVec3d(C),E.z-=P,E):null;P=this.view.state.camera;const N=m.castRenderScreenPointArray3(k.sv3d.get());P.projectToRenderScreen(y.origin,
N);K=new u(null,this._forEachLayer);const M=this.view.slicePlane,L=b.isSome(M)?v.sliceFilterPredicate(M):null,J=e.newIntersector(this.viewingMode);J.options.store=h.StoreResults.MIN;J.options.verticalOffset=D;D=y.origin;y=l.add(k.sv3d.get(),D,y.direction);J.reset(D,y,P);J.point=N;const H=b.isSome(F)?"type"in F&&"graphics"===F.type?I=>I.metadata.layerUid!==F.uid:I=>I.metadata.graphicUid!==F.uid:null;switch(G){case "relative-to-scene":J.intersect(K.layers,N,this.tolerance,null,I=>(b.isNone(H)||H(I))&&
I.metadata&&I.metadata.isElevationSource);this.externalIntersectionHandlers.forAll(I=>{I.type!==h.IntersectorType.I3S&&I.type!==h.IntersectorType.TERRAIN||I.intersect(J,I.slicePlaneEnabled?L:null,J.rayBegin,J.rayEnd,N)});break;case "on-the-ground":case "relative-to-ground":this.externalIntersectionHandlers.forAll(I=>{I.isGround&&I.intersect(J,I.slicePlaneEnabled?L:null,J.rayBegin,J.rayEnd,N)})}return J.results.min.getIntersectionPoint(C)?(G=this.view.computeMapPointFromVec3d(C),G.z=E,G):null};p.computeIntersection=
function(y,D,E){if(!b.isNone(y)){var F=this.view.state.camera,G=m.castRenderScreenPointArray3(k.sv3d.get());F.projectToRenderScreen(y.origin,G);var P=new u(E,this._forEachLayer);D.options.selectOpaqueTerrainOnly=!E||!("include"in E||"exclude"in E);var K=y.origin,N=l.add(k.sv3d.get(),y.origin,y.direction);D.reset(K,N,F);D.intersect(P.layers,G,this.tolerance);y=this.view.slicePlane;var M=b.isSome(y)?v.sliceFilterPredicate(y):null;D.intersect(P.sliceableLayers,G,this.tolerance,M);var L=E&&(E.requiresGroundFeedback||
E.enableDraped);this.externalIntersectionHandlers.forAll(J=>{D.options.isFiltered=!P.filterLayerUid(J.layerUid);(J.isGround&&L||!D.options.isFiltered)&&J.intersect(D,J.slicePlaneEnabled?M:null,K,N,G)});y=k.sv3d.get();if(E&&E.enableDraped&&D.results.ground.getIntersectionPoint(y)){E=this.view.basemapTerrain;F=E.overlayManager.renderer;const J=this.view.renderCoordsHelper.spatialReference,H=k.sv3d.get();this.view.renderCoordsHelper.fromRenderCoords(y,H,E.spatialReference);H[2]=b.unwrapOr(this.view.elevationProvider.getElevation(y[0],
y[1],y[2],J,"ground"),0);F.intersect(D,H,D.results.ground,I=>P.filterRenderGeometry(I))}D.sortResults();this._processHUDResults(D)}};p._processHUDResults=function(y){var D=y.results.hud;n.copy(this.tmpRegion,n.NEGATIVE_INFINITY);const E=this.view.state.camera,F=[],G=this.tmpRegion;var P=H=>{const I=new B(H);E.projectToRenderScreen(H.target.center,I.screenPoint);I.screenPoint[0]=Math.floor(I.screenPoint[0]);I.screenPoint[1]=Math.floor(I.screenPoint[1]);F.push(I);n.expandPointInPlace(G,I.screenPoint)};
y.sortResults(D.all);b.isSome(D.min.dist)&&P(D.min);for(var K of D.all)D.min.target.object!==K.target.object&&D.max.target.object!==K.target.object&&P(K);b.isSome(D.max.dist)&&D.max.target.object!==D.min.target.object&&P(D.max);if(F.length){G[0]===G[2]&&(G[2]+=1);G[1]===G[3]&&(G[3]+=1);D=E.fullWidth;P=E.fullHeight;var N=Math.max(0,G[0]-1),M=Math.max(0,G[1]-1);K=Math.min(n.width(G)+2,D-N);var L=Math.min(n.height(G)+2,P-M),J=new Uint8Array(K*L*4);this.view._stage.renderView.readHUDVisibility(N,M,K,
L,J);N=!0;M=b.isNone(y.results.max.dist);L=0;for(const H of F)for(const I of x)if(J[4*(Math.min(H.screenPoint[0]+I[0],D)-G[0]+(Math.min(H.screenPoint[1]+I[1],P)-G[1])*K)]){N&&(y.results.min.copy(H.result),N=!1);M&&y.results.max.copy(H.result);y.options.store===h.StoreResults.ALL&&y.results.all.splice(L++,0,H.result);break}}};return A}();const x=(()=>{const A=[];for(let p=-1;1>=p;p++)for(let y=-1;1>=y;y++)A.push([y+1,p+1]);return A})();let B=function(A){this.result=A;this.screenPoint=m.createRenderScreenPointArray3()},
q,u=function(){function A(y,D){this.layers=[];this.sliceableLayers=[];this.include=null==y?void 0:y.include;this.exclude=null==y?void 0:y.exclude;D(E=>{E.isPickable&&this.filterLayerUid(E.apiLayerUid)&&(E.isSliceable?this.sliceableLayers:this.layers).push(E)})}var p=A.prototype;p.filterLayerUid=function(y){const {include:D,exclude:E}=this;return b.isNone(y)?null==D&&null==E:(null==D||D.has(y))&&(null==E||!E.has(y))};p.filterRenderGeometry=function(y){return this.filterLayerUid(y.layerUid)};return A}();
const C=r.create(),z=m.createRenderScreenPointArray3();a.SceneIntersectionHelper=t;a.isIntersectionHandler=function(A){return"object"===typeof A&&"intersect"in A};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/CombinedElevationProvider":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../layers/graphics/ElevationQuery".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h){function v(w,t,x,B,q,u,C){for(const z of t)t=z.getElevation(x,B,q,u,C),r.isSome(t)&&(w=r.isSome(w)?Math.max(t,w):t);return w}a.CombinedElevationProvider=function(w){function t(B){B=w.call(this,B)||this;B.im=[];B.ground=[];B.scene=[];B.handles=new Map;B.lastElevationQuery=null;B.elevationCacheEnabled=!1;return B}b._inheritsLoose(t,w);var x=t.prototype;x.destroy=function(){this._elevationQuery=r.destroyMaybe(this._elevationQuery)};x.enableElevationCache=function(B){B||
(this.lastElevationQuery=null);this.elevationCacheEnabled=B};x.getElevation=function(B,q,u,C,z){if(this.elevationCacheEnabled&&null!=this.lastElevationQuery){var A=this.lastElevationQuery;if(B===A.x&&q===A.y&&u===A.z&&C.equals(A.spatialReference)&&z===A.queryContext)return A.result}A=v(null,this.im,B,q,u,C,z);r.isNone(A)&&(A=v(A,this.ground,B,q,u,C,z));"scene"===z&&(A=v(A,this.scene,B,q,u,C,z));this.elevationCacheEnabled&&(this.lastElevationQuery={x:B,y:q,z:u,spatialReference:C,queryContext:z,result:A});
return A};x.queryElevation=function(B,q,u,C,z,A=null,p=0){const y=n.createResolver();this.elevationQuery.queryElevation(B,q,A,p).then(D=>{"scene"===z&&(D=v(D,this.scene,B,q,u,C,z));y.resolve(D)}).catch(D=>{n.isAbortError(D)?y.reject(D):y.resolve(this.getElevation(B,q,u,C,z))});return y.promise};x.register=function(B,q){this.handles.set(q,q.on("elevation-change",u=>this.emit("elevation-change",u)));this[B].push(q)};x.unregister=function(B){this.handles.has(B)&&(this.handles.get(B).remove(),this.handles.delete(B));
for(const q of[this.im,this.ground,this.scene]){const u=q.indexOf(B);-1<u&&q.splice(u,1)}};b._createClass(t,[{key:"elevationQuery",get:function(){r.isNone(this._elevationQuery)&&(this._elevationQuery=new h.ElevationQuery(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4}));return this._elevationQuery}}]);return t}(l.EventedMixin(m));c.__decorate([g.property({constructOnly:!0})],a.CombinedElevationProvider.prototype,
"view",void 0);c.__decorate([g.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],a.CombinedElevationProvider.prototype,"spatialReference",void 0);a.CombinedElevationProvider=c.__decorate([e.subclass("esri.views.3d.support.CombinedElevationProvider")],a.CombinedElevationProvider);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/arrayUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../support/Scheduler ../../../../geometry/Multipoint".split(" "),
function(a,b,c,m,l,r,n,g){c=function(){function f(e,h){this.spatialReference=e;this.view=h}var d=f.prototype;d.getElevation=function(e,h,v){return this.view.elevationProvider.getElevation(e,h,0,this.spatialReference,v)};d.queryElevation=function(){var e=b._asyncToGenerator(function*(h,v,w,t,x){return this.view.elevationProvider.queryElevation(h,v,0,this.spatialReference,x,w,t)});return function(h,v,w,t,x){return e.apply(this,arguments)}}();return f}();let k=function(){function f(e,h,v,w){this.spatialReference=
h;this._getElevationQueryProvider=v;this._queries=[];this._queryOptions={...w,ignoreInvisibleLayers:!0};this._frameTask=e.registerTask(n.TaskPriority.ELEVATION_QUERY,this)}var d=f.prototype;d.destroy=function(){this._frameTask.remove()};d.queryElevation=function(e,h,v,w=0){return new Promise((t,x)=>{const B={x:e,y:h,minDemResolution:w,result:{resolve:t,reject:x},signal:v};this._queries.push(B);r.onAbort(v,()=>{m.remove(this._queries,B);x(r.createAbortError())})})};d.runTask=function(){const e=this._queries;
this._queries=[];const h=this._getElevationQueryProvider();if(h){var v=e.map(B=>[B.x,B.y]),w=e.reduce((B,q)=>Math.min(B,q.minDemResolution),Infinity);v=new g({points:v,spatialReference:this.spatialReference});var t=1<e.length&&e.some(B=>!!B.signal)?new AbortController:null,x=l.isSome(t)?t.signal:e[0].signal;if(l.isSome(t)){let B=0;e.forEach(q=>r.onAbort(q.signal,()=>{B++;q.result.reject(r.createAbortError());B===e.length&&t.abort()}))}h.queryElevation(v,{...this._queryOptions,minDemResolution:w,signal:x}).then(B=>
{e.forEach((q,u)=>{l.isSome(q.signal)&&q.signal.aborted?q.result.reject(r.createAbortError()):q.result.resolve(B.geometry.points[u][2])})}).catch(B=>{e.forEach(q=>q.result.reject(B))})}else e.forEach(B=>B.result.reject())};b._createClass(f,[{key:"running",get:function(){return 0<this._queries.length}},{key:"test",get:function(){const e=this;return{update:()=>0<e._queries.length&&e.runTask()}}}]);return f}();a.ElevationQuery=k;a.ViewElevationProvider=c;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["../../../core/has"],function(a){function b(){const m=!!a("esri-mobile"),l=!!a("ios");return{low:{graphics3D:{maxTotalNumberOfFeatures:25E3,maxTotalNumberOfPrimitives:85E4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25E3},sceneService:{"3dObject":{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},
point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5,polygonLodFactor:m?
.8:1,polylineLodFactor:m?1.2:1.5,snapshotAvailable:!l},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5E4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:m},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!a("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,
physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:m?600:750,additionalCacheMemory:m?0:150,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5,polygonLodFactor:m?1.2:2,polylineLodFactor:m?1.2:2,snapshotAvailable:!l},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5E4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},
point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!a("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:m?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:m?null:4096,maximumPixelRatio:m?1:null}}}let c=function(){function m(){}m.isValidProfile=
function(l){return l in m.profiles};m.getDefaultProfile=function(){return a("trident")||a("esri-iPhone")?"low":"medium"};m.apply=function(l,r){l=m.profiles[l];r.graphics3D.maxTotalNumberOfFeatures=l.graphics3D.maxTotalNumberOfFeatures;r.graphics3D.maxTotalNumberOfPrimitives=l.graphics3D.maxTotalNumberOfPrimitives;r.graphics3D.polygonLodFactor=l.graphics3D.polygonLodFactor;r.graphics3D.polylineLodFactor=l.graphics3D.polylineLodFactor;r.graphics3D.snapshotAvailable=l.graphics3D.snapshotAvailable;{const n=
r.sceneService["3dObject"],g=l.sceneService["3dObject"];n.lodFactor=g.lodFactor;n.lodCrossfadeinDuration=g.lodCrossfadeinDuration;n.lodCrossfadeoutDuration=g.lodCrossfadeoutDuration;n.lodCrossfadeUncoveredDuration=g.lodCrossfadeUncoveredDuration}r.sceneService.point.lodFactor=l.sceneService.point.lodFactor;r.sceneService.integratedMesh.lodFactor=l.sceneService.integratedMesh.lodFactor;r.sceneService.pointCloud.lodFactor=l.sceneService.pointCloud.lodFactor;r.sceneService.uncompressedTextureDownsamplingEnabled=
l.sceneService.uncompressedTextureDownsamplingEnabled;r.tiledSurface.lodBias=l.tiledSurface.lodBias;r.tiledSurface.angledSplitBias=l.tiledSurface.angledSplitBias;r.tiledSurface.reduceTileLevelDifferences=l.tiledSurface.reduceTileLevelDifferences;r.tiledSurface.textureFadeDuration=l.tiledSurface.textureFadeDuration;r.heatmap.pixelRatio=l.heatmap.pixelRatio;r.heatmap.maxTotalNumberOfFeatures=l.heatmap.maxTotalNumberOfFeatures;r.antialiasingEnabled=l.antialiasingEnabled;r.physicallyBasedRenderingEnabled=
l.physicalBasedRenderingEnabled;r.highQualityTransparency=l.highQualityTransparency;r.memoryLimit=l.memoryLimit;r.additionalCacheMemory=l.additionalCacheMemory;r.frameRate=l.frameRate;r.maximumRenderResolution=l.maximumRenderResolution;r.maximumPixelRatio=l.maximumPixelRatio};return m}();c.debug={reset(){const m=b();for(const l in m)c.profiles[l]=m[l]}};(c||(c={})).profiles=b();return c})},"esri/views/3d/support/HighlightOptions":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec4f32 ../../../chunks/vec4f64".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e){m=function(h){function v(){var w=h.apply(this,arguments)||this;w.color=new c([0,255,255]);w.haloColor=null;w.haloOpacity=1;w.fillOpacity=.25;w.shadowOpacity=.4;w.shadowColor=new c([0,0,0]);w.shadowDifference=.2;return w}a._inheritsLoose(v,h);v.toEngineOptions=function(w){const t=c.toUnitRGBA(w.color),x=l.isSome(w.haloColor)?c.toUnitRGBA(w.haloColor):t,B=c.toUnitRGBA(w.shadowColor);return{color:d.fromValues(t[0],t[1],t[2],t[3]),haloColor:d.fromValues(x[0],x[1],x[2],
x[3]),haloOpacity:w.haloOpacity,haloOpacityOccluded:.25*w.haloOpacity,fillOpacity:w.fillOpacity,fillOpacityOccluded:.25*w.fillOpacity,shadowOpacity:w.shadowOpacity,shadowColor:e.fromValues(B[0],B[1],B[2],B[3]),occludedShadowOpacity:w.shadowOpacity*(1-w.shadowDifference)}};return v}(m);b.__decorate([r.property({type:c})],m.prototype,"color",void 0);b.__decorate([r.property({type:c})],m.prototype,"haloColor",void 0);b.__decorate([r.property()],m.prototype,"haloOpacity",void 0);b.__decorate([r.property()],
m.prototype,"fillOpacity",void 0);b.__decorate([r.property()],m.prototype,"shadowOpacity",void 0);b.__decorate([r.property({type:c})],m.prototype,"shadowColor",void 0);b.__decorate([r.property()],m.prototype,"shadowDifference",void 0);return m=b.__decorate([f.subclass("esri.views.3d.support.HighlightOptions")],m)})},"esri/chunks/vec4f32":function(){define(["exports"],function(a){function b(){return new Float32Array(4)}function c(q){const u=new Float32Array(4);u[0]=q[0];u[1]=q[1];u[2]=q[2];u[3]=q[3];
return u}function m(q,u,C,z){const A=new Float32Array(4);A[0]=q;A[1]=u;A[2]=C;A[3]=z;return A}function l(q,u){return new Float32Array(q,u,4)}function r(){return b()}function n(){return m(1,1,1,1)}function g(){return m(1,0,0,0)}function k(){return m(0,1,0,0)}function f(){return m(0,0,1,0)}function d(){return m(0,0,0,1)}const e=b(),h=n(),v=g(),w=k(),t=f(),x=d(),B=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:m,createView:l,zeros:r,ones:n,unitX:g,unitY:k,unitZ:f,unitW:d,
ZEROS:e,ONES:h,UNIT_X:v,UNIT_Y:w,UNIT_Z:t,UNIT_W:x},Symbol.toStringTag,{value:"Module"}));a.ONES=h;a.UNIT_W=x;a.UNIT_X=v;a.UNIT_Y=w;a.UNIT_Z=t;a.ZEROS=e;a.clone=c;a.create=b;a.createView=l;a.fromValues=m;a.ones=n;a.unitW=d;a.unitX=g;a.unitY=k;a.unitZ=f;a.vec4f32=B;a.zeros=r})},"esri/views/3d/support/MapCoordsHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../core/Error ../../../core/unitUtils ../../../geometry/projectionEllipsoid ../../../portal/support/geometryServiceUtils ../../../rest/geometryService/project ../../../rest/support/ProjectParameters ../../../geometry/Point ../../../geometry/SpatialReference".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){c=function(){function e(h,v){this.spatialReference=v;this.unitInMeters=l.getMetersPerUnitForSR(this.spatialReference,r.getReferenceEllipsoid(this.spatialReference).metersPerDegree);this._geometryServiceURLPromise=n.getGeometryServiceURL(h&&h.get("portalItem")).catch(()=>{throw new m("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config");})}e.prototype.toGeographic=function(){var h=b._asyncToGenerator(function*(v){var w=yield this._geometryServiceURLPromise;
let t=!0;Array.isArray(v[0])&&"number"!==typeof v[0]||(v=[v],t=!1);v=v.map(x=>x instanceof f?x:new f(x,this.spatialReference));v=new k({geometries:v,outSpatialReference:d.WGS84});w=(yield g.project(w,v)).map(x=>"point"===x.type?[x.x,x.y]:void 0);return t?w:w[0]});return function(v){return h.apply(this,arguments)}}();return e}();a.MapCoordsHelper=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/portal/support/geometryServiceUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../config ../../core/Error ../Portal ../../rest/geometryService/project ../../rest/support/ProjectParameters".split(" "),
function(a,b,c,m,l,r,n){function g(){return k.apply(this,arguments)}function k(){k=b._asyncToGenerator(function*(d=null,e){var h,v;if(c.geometryServiceUrl)return c.geometryServiceUrl;if(!d)throw new m("internal:geometry-service-url-not-configured");d="portal"in d?d.portal||l.getDefault():d;yield d.load({signal:e});e=null==(h=d.helperServices)?void 0:null==(v=h.geometry)?void 0:v.url;if(!e)throw new m("internal:geometry-service-url-not-configured");return e});return k.apply(this,arguments)}function f(){f=
b._asyncToGenerator(function*(d,e,h=null,v){h=yield g(h,v);const w=new n;w.geometries=[d];w.outSpatialReference=e;if((d=yield r.project(h,w,{signal:v}))&&Array.isArray(d)&&1===d.length)return d[0];throw new m("internal:geometry-service-projection-failed");});return f.apply(this,arguments)}a.getGeometryServiceURL=g;a.projectGeometry=function(d,e){return f.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/geometryService/project":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils ../utils ./utils ../support/ProjectParameters".split(" "),
function(a,b,c,m,l,r,n,g){function k(){k=b._asyncToGenerator(function*(d,e,h){e=f(e);d=r.parseUrl(d);const v={...d.query,f:"json",...e.toJSON()},w=e.outSpatialReference,t=l.getJsonType(e.geometries[0]);e=r.asValidOptions(v,h);return c(d.path+"/project",e).then(({data:{geometries:x}})=>n.decodeGeometries(x,t,w))});return k.apply(this,arguments)}const f=m.ensureType(g);a.project=function(d,e,h){return k.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/rest/geometryService/utils":function(){define(["exports","../../geometry/support/jsonUtils"],function(a,b){a.decodeGeometries=function(c,m,l){const r=b.getGeometryType(m);return c.map(n=>{n=r.fromJSON(n);n.spatialReference=l;return n})};a.encodeGeometries=function(c){return{geometryType:b.getJsonType(c[0]),geometries:c.map(m=>m.toJSON())}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/support/ProjectParameters":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils".split(" "),
function(a,b,c,m,l,r,n,g,k){c=function(f){function d(e){e=f.call(this,e)||this;e.geometries=null;e.outSpatialReference=null;e.transformation=null;e.transformForward=null;return e}a._inheritsLoose(d,f);d.prototype.toJSON=function(){const e=this.geometries.map(w=>w.toJSON()),h=this.geometries[0],v={};v.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON());v.inSR=h.spatialReference.wkid||JSON.stringify(h.spatialReference.toJSON());v.geometries=JSON.stringify({geometryType:k.getJsonType(h),
geometries:e});this.transformation&&(v.transformation=this.transformation.wkid||JSON.stringify(this.transformation));null!=this.transformForward&&(v.transformForward=this.transformForward);return v};return d}(c.JSONSupport);b.__decorate([m.property()],c.prototype,"geometries",void 0);b.__decorate([m.property({json:{read:{source:"outSR"}}})],c.prototype,"outSpatialReference",void 0);b.__decorate([m.property()],c.prototype,"transformation",void 0);b.__decorate([m.property()],c.prototype,"transformForward",
void 0);return c=b.__decorate([g.subclass("esri.rest.support.ProjectParameters")],c)})},"esri/views/3d/support/QualitySettings":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,m,l,r,n,g){let k=function(w){function t(){var x=w.apply(this,
arguments)||this;x.minTotalNumberOfFeatures=2E3;x.maxTotalNumberOfFeatures=5E4;x.maxTotalNumberOfPrimitives=17E5;x.snapshotAvailable=!0;x.polygonLodFactor=1;x.polylineLodFactor=1;return x}a._inheritsLoose(t,w);return t}(c);b.__decorate([m.property()],k.prototype,"minTotalNumberOfFeatures",void 0);b.__decorate([m.property()],k.prototype,"maxTotalNumberOfFeatures",void 0);b.__decorate([m.property()],k.prototype,"maxTotalNumberOfPrimitives",void 0);b.__decorate([m.property()],k.prototype,"snapshotAvailable",
void 0);b.__decorate([m.property()],k.prototype,"polygonLodFactor",void 0);b.__decorate([m.property()],k.prototype,"polylineLodFactor",void 0);k=b.__decorate([g.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],k);let f=function(w){function t(){var x=w.apply(this,arguments)||this;x.lodFactor=1;return x}a._inheritsLoose(t,w);return t}(c);b.__decorate([m.property()],f.prototype,"lodFactor",void 0);f=b.__decorate([g.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],
f);let d=function(w){function t(){var x=w.apply(this,arguments)||this;x.lodCrossfadeinDuration=0;x.lodCrossfadeoutDuration=0;x.lodCrossfadeUncoveredDuration=0;return x}a._inheritsLoose(t,w);return t}(f);d=b.__decorate([g.subclass("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],d);let e=function(w){function t(){var x=w.apply(this,arguments)||this;x["3dObject"]=new d;x.point=new f;x.integratedMesh=new f;x.pointCloud=new f;x.uncompressedTextureDownsamplingEnabled=!1;return x}a._inheritsLoose(t,
w);return t}(c);b.__decorate([m.property({type:d})],e.prototype,"3dObject",void 0);b.__decorate([m.property({type:f})],e.prototype,"point",void 0);b.__decorate([m.property({type:f})],e.prototype,"integratedMesh",void 0);b.__decorate([m.property({type:f})],e.prototype,"pointCloud",void 0);b.__decorate([m.property()],e.prototype,"uncompressedTextureDownsamplingEnabled",void 0);e=b.__decorate([g.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],e);let h=function(w){function t(){var x=
w.apply(this,arguments)||this;x.lodBias=0;x.angledSplitBias=1;x.reduceTileLevelDifferences=!0;x.textureFadeDuration=500;return x}a._inheritsLoose(t,w);return t}(c);b.__decorate([m.property()],h.prototype,"lodBias",void 0);b.__decorate([m.property()],h.prototype,"angledSplitBias",void 0);b.__decorate([m.property()],h.prototype,"reduceTileLevelDifferences",void 0);b.__decorate([m.property()],h.prototype,"textureFadeDuration",void 0);h=b.__decorate([g.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],
h);let v=function(w){function t(){var x=w.apply(this,arguments)||this;x.pixelRatio=1;x.maxTotalNumberOfFeatures=5E4;return x}a._inheritsLoose(t,w);return t}(c);b.__decorate([m.property()],v.prototype,"pixelRatio",void 0);b.__decorate([m.property()],v.prototype,"maxTotalNumberOfFeatures",void 0);v=b.__decorate([g.subclass("esri.views.3d.support.QualitySettings.HeatmapSettings")],v);c=function(w){function t(){var x=w.apply(this,arguments)||this;x.graphics3D=new k;x.sceneService=new e;x.tiledSurface=
new h;x.heatmap=new v;x.antialiasingEnabled=!0;x.physicallyBasedRenderingEnabled=!1;x.highQualityTransparency=!0;return x}a._inheritsLoose(t,w);return t}(c);b.__decorate([m.property({type:k})],c.prototype,"graphics3D",void 0);b.__decorate([m.property({type:e})],c.prototype,"sceneService",void 0);b.__decorate([m.property({type:h})],c.prototype,"tiledSurface",void 0);b.__decorate([m.property({type:v})],c.prototype,"heatmap",void 0);b.__decorate([m.property()],c.prototype,"antialiasingEnabled",void 0);
b.__decorate([m.property()],c.prototype,"physicallyBasedRenderingEnabled",void 0);b.__decorate([m.property()],c.prototype,"highQualityTransparency",void 0);b.__decorate([m.property()],c.prototype,"memoryLimit",void 0);b.__decorate([m.property()],c.prototype,"additionalCacheMemory",void 0);b.__decorate([m.property()],c.prototype,"frameRate",void 0);b.__decorate([m.property()],c.prototype,"maximumRenderResolution",void 0);b.__decorate([m.property()],c.prototype,"maximumPixelRatio",void 0);return c=
b.__decorate([g.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],c)})},"esri/views/3d/support/RenderCoordsHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/unitUtils ../../../chunks/mat4 ../../../chunks/vec3 ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/Axis ../../../geometry/support/coordinateSystem ../../../geometry/support/plane ../../../geometry/support/vectorStacks ../../../layers/graphics/dehydratedFeatureUtils ../../ViewingMode ../../support/spatialReferenceSupport".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w){function t(B){if(w.isSpatialReferenceSupported(B,v.ViewingMode.Global))return 1;B=f.renderSRFromViewSR(!1,B);return m.getMetersPerUnitForSR(B)}let x=function(){function B(u,C,z,A){this.viewingMode=u;this.spatialReference=C;this.unitInMeters=z;this.coordinateSystem=A;this._coordinateSystem=f.create(A)}var q=B.prototype;q.getAltitude=function(u){return f.altitudeAt(this.coordinateSystem,u)};q.setAltitude=function(u,C,z=u){return f.setAltitudeAt(this.coordinateSystem,
z,C,u)};q.setAltitudeOfTransformation=function(u,C){f.setAltitudeOfTransformation(this.coordinateSystem,C,u,C)};q.worldUpAtPosition=function(u,C){return f.normalAt(this.coordinateSystem,u,C)};q.worldBasisAtPosition=function(u,C,z){return f.axisAt(this.coordinateSystem,u,C,z)};q.basisMatrixAtPosition=function(u,C){const z=this.worldBasisAtPosition(u,k.Axis.X,e.sv3d.get()),A=this.worldBasisAtPosition(u,k.Axis.Y,e.sv3d.get());u=this.worldBasisAtPosition(u,k.Axis.Z,e.sv3d.get());l.set(C,z[0],z[1],z[2],
0,A[0],A[1],A[2],0,u[0],u[1],u[2],0,0,0,0,1);return C};q.intersectManifoldClosestSilhouette=function(u,C,z){f.elevate(this.coordinateSystem,C,this._coordinateSystem);f.intersectRayClosestSilhouette(this._coordinateSystem,u,z);return z};q.intersectManifold=function(u,C,z){f.elevate(this.coordinateSystem,C,this._coordinateSystem);C=e.sv3d.get();return f.intersectRay(this._coordinateSystem,u,C)?r.copy(z,C):null};q.intersectInfiniteManifold=function(u,C,z){if(this.viewingMode===v.ViewingMode.Global)return this.intersectManifold(u,
C,z);f.elevate(this.coordinateSystem,C,this._coordinateSystem);C=this._coordinateSystem.value;const A=e.sv3d.get();return d.intersectRay(C.plane,u,A)?r.copy(z,A):null};q.toRenderCoords=function(u,C,z){return h.isDehydratedPoint(u)?n.projectPointToVector(u,C,this.spatialReference):n.projectVectorToVector(u,C,z,this.spatialReference)};q.fromRenderCoords=function(u,C,z=null){return h.isDehydratedPoint(C)?(c.isSome(z)&&(C.spatialReference=z),n.projectVectorToDehydratedPoint(u,this.spatialReference,C)):
C instanceof g?n.projectVectorToPoint(u,this.spatialReference,C):n.projectVectorToVector(u,this.spatialReference,C,z)?C:null};B.create=function(u,C){switch(u){case v.ViewingMode.Local:return new B(v.ViewingMode.Local,C,m.getMetersPerUnitForSR(C),f.createLocal());case v.ViewingMode.Global:return new B(v.ViewingMode.Global,C,1,f.createGlobal(C))}};B.renderUnitScaleFactor=function(u,C){return t(u)/t(C)};b._createClass(B,[{key:"extent",set:function(u){u&&f.setExtent(this.coordinateSystem,u,this.coordinateSystem)}}]);
return B}();a.RenderCoordsHelper=x;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/ResourceController":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/reactiveUtils ../../../core/scheduling ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./index ./MemoryController ./StreamDataLoader ../../support/Scheduler".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B){a.ResourceControllerMain=function(u){function C(){var z=u.apply(this,arguments)||this;z.updating=!1;return z}b._inheritsLoose(C,u);return C}(m);c.__decorate([f.property({readOnly:!0})],a.ResourceControllerMain.prototype,"updating",void 0);a.ResourceControllerMain=c.__decorate([v.subclass("esri.views.3d.support.ResourceController")],a.ResourceControllerMain);var q;(function(u){let C=function(z){function A(){var y=z.apply(this,arguments)||this;y._scheduler=
null;y._memoryController=null;y._streamDataLoader=null;y._scheduleTask=B.ImmediateTask;y._cameraChangeTime=0;y._handles=new l;y._frameTask=null;y._state=B.State.IDLE;return y}b._inheritsLoose(A,z);var p=A.prototype;p.initialize=function(){this._cameraChangeTime=performance.now();this._scheduler=B.newScheduler();this._memoryController=t.newMemoryController(this.view);this._streamDataLoader=new x.StreamDataLoader;this._streamDataLoader.setup(w.maxDownloadSlots,w.downloadSlotsPerClient,this._scheduler);
this._handles.add([n.watch(()=>{var y;return null==(y=this.view.state)?void 0:y.camera},(y,D)=>this._cameraChangedHandler(y,D),n.sync),n.watch(()=>this.view.stationary,()=>this._stationaryChangedHandler())]);this._frameTask=g.addFrameTask({update:y=>this._frame(y)});this._scheduleTask=this._scheduler.registerTask(B.TaskPriority.RESOURCE_CONTROLLER)};p.destroy=function(){this._handles=r.destroyMaybe(this._handles);this._scheduleTask.remove();this._frameTask=r.removeMaybe(this._frameTask);this._streamDataLoader=
r.destroyMaybe(this._streamDataLoader);this._memoryController=r.destroyMaybe(this._memoryController);this._scheduler=r.destroyMaybe(this._scheduler)};p.schedule=function(y,D,E){return this._scheduleTask.schedule(y,D,E)};p.createStreamDataRequester=function(y){const D=this._streamDataLoader;return{request(E,F,G){return D.request(E,F,y,G)},get busy(){return!D.hasDownloadSlots(y)}}};p._frame=function(y){if(!this.view.suspended){if(this.view.stateManager&&(this.view.stateManager.step(k.secondsFromMilliseconds(y.deltaTime)),
!this._scheduler))return;this._updateState();this._scheduler.state=this._state;this._scheduler.updateBudget(y)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update()}};p._cameraChangedHandler=function(y,D){y&&D&&y.almostEquals(D)||(this._cameraChangeTime=performance.now(),this._updateState(),this._scheduler.state=this._state)};p._stationaryChangedHandler=function(){this.memoryController.resetStableQuality()};p._updateState=function(){this.view.animation?
this._state=B.State.ANIMATING:this.view.interacting?this._state=B.State.INTERACTING:(this._state===B.State.ANIMATING&&(this._cameraChangeTime=0),300>=performance.now()-this._cameraChangeTime?this._state=B.State.INTERACTING:this._state=B.State.IDLE)};b._createClass(A,[{key:"updating",get:function(){var y,D,E;return!!(null!=(y=this._memoryController)&&y.updating||null!=(D=this._streamDataLoader)&&D.updating||null!=(E=this._scheduleTask)&&E.updating)}},{key:"scheduler",get:function(){return this._scheduler}},
{key:"memoryController",get:function(){return this._memoryController}},{key:"test",get:function(){return{getQueueStats:y=>this._streamDataLoader.test.loadQueue.getStatsForType(y),state:this._state}}}]);return A}(a.ResourceControllerMain);c.__decorate([f.property({constructOnly:!0})],C.prototype,"view",void 0);c.__decorate([f.property()],C.prototype,"_scheduler",void 0);c.__decorate([f.property()],C.prototype,"_memoryController",void 0);c.__decorate([f.property()],C.prototype,"_streamDataLoader",void 0);
c.__decorate([f.property()],C.prototype,"_scheduleTask",void 0);c.__decorate([f.property({readOnly:!0})],C.prototype,"updating",null);C=c.__decorate([v.subclass("esri.views.3d.support.ResourceController")],C);u.ResourceController=C})(q||(q={}));a.newResourceController=function(u){return new q.ResourceController({view:u})};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/index":function(){define(["exports"],function(a){a.ClientType=
void 0;(function(c){c[c.ELEVATION=0]="ELEVATION";c[c.BASEMAP=1]="BASEMAP";c[c.I3S_INDEX=2]="I3S_INDEX";c[c.I3S_DATA=3]="I3S_DATA";c[c.SYMBOLOGY=4]="SYMBOLOGY"})(a.ClientType||(a.ClientType={}));const b=(()=>{const c=[];c[a.ClientType.ELEVATION]=10;c[a.ClientType.BASEMAP]=10;c[a.ClientType.I3S_INDEX]=10;c[a.ClientType.I3S_DATA]=10;c[a.ClientType.SYMBOLOGY]=5;return c})();a.downloadSlotsPerClient=b;a.maxDownloadSlots=30;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/support/MemoryController":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Logger ../../../core/maybe ../../../core/MemCache ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../layers/support/MemoryManagedLayerView".split(" "),function(a,b,c,m,l,r,n,g,k,f,d,e,h){const v=
l.getLogger("esri.views.3d.support.MemoryController");let w=function(t){function x(q){q=t.call(this,q)||this;q._quality=1;q._memoryUsed=0;q._updating=!1;q.minQuality=.1;q._stableQuality=0;q._downscaleMemoryUsed=0;q._canFastRecover=!1;q._memoryPredicted=0;q._cacheStorage=new n.MemCacheStorage;q._numQualityChanges=0;q._maxMemory=500;q._additionalCacheMemory=100;return q}b._inheritsLoose(x,t);var B=x.prototype;B.destroy=function(){this._cacheStorage.destroy()};B.newCache=function(q,u){return new n.MemCache(q,
this._cacheStorage,u)};B.resetStableQuality=function(){this._stableQuality=0};B.disableMemCache=function(){this.additionalCacheMemory=-4096};B.update=function(){this._updateMemory();if(!(0>=this._memoryPredicted)||this._updating){var q=this._layersUpdating();if(.6>this._memoryPredicted&&this._canFastRecover)this._stableQuality=this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._updateQuality(1);else if(q){if(1.1<this._memoryPredicted||1<this._memoryUsed)0<this._stableQuality?(this._downscaleMemoryUsed=
0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1)}else this._downscaleMemoryUsed=0,1<this._memoryUsed?(this._stableQuality=0,this._canFastRecover=!1,q=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(.75>this._memoryUsed&&1>this._quality?(this._stableQuality=
this._quality,q=this._updateQuality(this._quality+.05)):1>this._quality&&(this._canFastRecover=!0));this._updating=q}};B._updateQuality=function(q){q=Math.min(Math.max(q,this.minQuality),1);if(q===this._quality)return!1;this._quality=q;++this._numQualityChanges;return!0};B._layersUpdating=function(){return this.view.allLayerViews.some(q=>!!q.updating)};B._updateMemory=function(){let q=0,u=0;this.view.basemapTerrain&&this.view.basemapTerrain.getUsedMemory&&(q+=this.view.basemapTerrain.getUsedMemory());
var C=this.view._stage&&this.view._stage.renderView&&this.view._stage.renderView.edgeView;r.isSome(C)&&(q+=C.usedMemory);this.view.allLayerViews&&this.view.allLayerViews.forEach(A=>{if(h.isMemoryManagedLayerView(A)){const p=A.ignoresMemoryFactor()?this._quality:1;q+=A.getUsedMemory()*p;u+=A.getUnloadedMemory()*p}});var z=null==this._warnMemoryUsage||Math.round(10*q)!==Math.round(10*this._warnMemoryUsage);C=1048576*this.maxMemory;if(q>C&&z){this._warnMemoryUsage=q;z=p=>(p/1048576).toLocaleString(void 0,
{maximumFractionDigits:1})+" MB";const A=Math.round(100*this._quality);v.warn(`Memory Limit exceeded! Limit: ${z(C)} Current: ${z(q)} Projected: ${z(q+u)} Quality: ${A}%`)}this._memoryUsed=q/C;this._memoryPredicted=(q+u)/C;this._cacheStorage.maxSize=Math.max(0,C-q+1048576*this.additionalCacheMemory)};b._createClass(x,[{key:"maxMemory",get:function(){return this._maxMemory},set:function(q){null==q||0>=q||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<q&&this._updateQuality(1),this._maxMemory=
q)}},{key:"additionalCacheMemory",get:function(){return this._additionalCacheMemory},set:function(q){null!=q&&0<=q&&(this._additionalCacheMemory=q)}},{key:"memoryFactor",get:function(){return this._quality}},{key:"updating",get:function(){return this._updating}},{key:"usedMemory",get:function(){return this._memoryUsed}},{key:"test",get:function(){const q=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const u=q._numQualityChanges;q._numQualityChanges=0;return u}}}}]);return x}(m);
c.__decorate([g.property({constructOnly:!0})],w.prototype,"view",void 0);c.__decorate([g.property()],w.prototype,"maxMemory",null);c.__decorate([g.property()],w.prototype,"additionalCacheMemory",null);c.__decorate([g.property()],w.prototype,"memoryFactor",null);c.__decorate([g.property()],w.prototype,"updating",null);c.__decorate([g.property()],w.prototype,"usedMemory",null);c.__decorate([g.property()],w.prototype,"_quality",void 0);c.__decorate([g.property()],w.prototype,"_memoryUsed",void 0);c.__decorate([g.property()],
w.prototype,"_updating",void 0);c.__decorate([g.property()],w.prototype,"_stableQuality",void 0);c.__decorate([g.property()],w.prototype,"_maxMemory",void 0);c.__decorate([g.property()],w.prototype,"_additionalCacheMemory",void 0);w=c.__decorate([e.subclass("esri.views.3d.support.MemoryController")],w);a.newMemoryController=function(t){return new w({view:t})};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/MemoryManagedLayerView":function(){define(["exports"],
function(a){a.isMemoryManagedLayerView=function(b){return"function"===typeof b.getUsedMemory};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/StreamDataLoader":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../request ../../../core/Accessor ../../../core/arrayUtils ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./AsyncWorkerQueue ../webgl-engine/lib/Util ../../support/Scheduler".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t){function x(C){if(2>C.byteLength)return"unknown";C=new Uint8Array(C,0,C.byteLength);return 137===C[0]&&80===C[1]?"image/png":71===C[0]&&73===C[1]?"image/gif":66===C[0]&&77===C[1]?"image/bmp":255===C[0]&&216===C[1]?"image/jpeg":"unknown"}a.StreamDataLoader=function(C){function z(){var p=C.apply(this,arguments)||this;p._tasks=new Map;p._onLoadQueue=[];p._doneQueue=[];p.updating=!1;return p}b._inheritsLoose(z,C);var A=z.prototype;A.setup=function(p,y,D){this._loadQueue=
new v.AsyncWorkerQueue((E,F)=>this._startLoading(E,F),(E,F)=>this._doneLoadingCB(E,F),p,y);D&&(this._frameTask=D.registerTask(t.TaskPriority.STREAM_DATA_LOADER,this))};A.destroy=function(){this._frameTask=k.removeMaybe(this._frameTask);this._tasks.forEach(p=>k.abortMaybe(p.abortController));this._loadQueue=k.destroyMaybe(this._loadQueue);this._tasks=this._doneQueue=this._onLoadQueue=null};A.hasDownloadSlots=function(p){return this._loadQueue.hasQuota(p)};A.request=function(p,y,D,E={}){const F=f.createResolver();
F.__signal=k.isSome(E)?E.signal:null;const G=this._createOrUpdateTask(p,y,D,E,F);f.onAbort(E,()=>this._cancelRequest(G,F));return F.promise};A._createTask=function(p,y,D,E,F,G){p=new u(p,y,D,E,F);this._updateTask(p,G);this._tasks.set(F,p);1===this._tasks.size&&this._set("updating",!0);this._loadQueue.push(p);return p};A._cancelRequest=function(p,y){r.removeUnordered(p.resolvers,y);y.reject(f.createAbortError());0===p.resolvers.length&&(p.status===a.TaskStatus.DOWNLOADING&&(p.status=a.TaskStatus.CANCELLED,
this._loadQueue.cancel(p),p.abortController.abort(),p.request=null,p.abortController=null),p.status=a.TaskStatus.CANCELLED,this._tasks.delete(p.key),0===this._tasks.size&&this._set("updating",!1))};A._updateTask=function(p,y){p.resolvers.push(y)};A._createOrUpdateTask=function(p,y,D,E,F){const G=`${k.isSome(E)&&E.uid||p}:${y}:${D}`,P=this._tasks.get(G);return P?(this._updateTask(P,F),P):this._createTask(p,E,y,D,G,F)};A._doneLoadingCB=function(p,y){this._loadQueue&&(w.assert(p.status===a.TaskStatus.DOWNLOADING),
p.status=a.TaskStatus.DOWNLOADED,this._frameTask?this._doneQueue.push({task:p,err:y}):this._doneLoading(p,y))};A.runTask=function(p){for(;!p.done&&0<this._onLoadQueue.length;){var y=this._onLoadQueue.shift();f.throwIfAborted(y.task.abortController);y.task.abortController=null;y.callback(y.task);p.madeProgress()}for(;!p.done&&0<this._doneQueue.length;)y=this._doneQueue.shift(),y.task.status!==a.TaskStatus.DOWNLOADED&&(y.err=y.err||f.createAbortError()),this._doneLoading(y.task,y.err),p.madeProgress()};
A._doneLoading=function(p,y){if(y&&!f.isAbortError(y)&&0<p.numRetries)--p.numRetries,this._loadQueue.push(p);else{var D=p.result instanceof HTMLImageElement?0:p.resolvers.length;for(const E of p.resolvers)if(y)f.isAbortError(y)?E.reject(y):E.reject(new n("stream-data-loader:request-error",`Failed to request resource at '${p.url}'. ${y}`,{url:p.url,error:y}));else{--D;const F=0>=D?p.result:g.clone(p.result);E.resolve(F)}this._tasks.delete(p.key);0===this._tasks.size&&this._set("updating",!1)}};A._startLoading=
function(p,y){if(p.status===a.TaskStatus.CANCELLED)return!1;p.startTime=performance.now();p.status=a.TaskStatus.DOWNLOADING;let D,E;switch(p.docType){case "binary":E="array-buffer";D=0;break;case "image":E="image";break;case "image+type":E="array-buffer";break;default:E="json"}p.abortController=new AbortController;const F=p.abortController.signal;p.request=m(p.url,{...p.options,responseType:E,timeout:D,signal:F});let G=()=>{};const P=N=>{p.duration=performance.now()-p.startTime;p.size=N instanceof
ArrayBuffer?N.byteLength:p.size||0;p.result=N;this._frameTask?this._onLoadQueue.push({callback:y,task:p}):(p.abortController=null,y(p))},K=N=>{p.status===a.TaskStatus.DOWNLOADING&&y(p,N);G()};if("image+type"!==p.docType)return p.request.then(N=>P(N.data),K),!0;p.request.then(N=>{N=N.data;const M=x(N);E="image";p.size=N.byteLength;if("unknown"===M)p.request=m(p.url,{responseType:E,timeout:D,signal:F}),p.request.then(J=>P(J.data),K);else{N=new Blob([N],{type:M});var L=window.URL.createObjectURL(N);
G=()=>window.URL.revokeObjectURL(L);p.request=m(L,{responseType:E,timeout:D,signal:F});p.request.then(J=>P(new q(J.data,M,G)),K)}},K);return!0};b._createClass(z,[{key:"running",get:function(){return 0<this._doneQueue.length||0<this._onLoadQueue.length}},{key:"test",get:function(){return{loadQueue:this._loadQueue}}}]);return z}(l);c.__decorate([d.property({readOnly:!0})],a.StreamDataLoader.prototype,"updating",void 0);a.StreamDataLoader=c.__decorate([h.subclass("esri.views.3d.support.StreamDataLoader")],
a.StreamDataLoader);const B={numRetries:0};let q=function(){function C(z,A,p){this.image=z;this.type=A;this.release=p}b._createClass(C,[{key:"isOpaque",get:function(){return"image/jpeg"===this.type}}]);return C}(),u=function(C){function z(A,p,y,D,E){D=C.call(this,D)||this;D.url=A;D.options=p;D.docType=y;D.key=E;D.result=null;D.status=a.TaskStatus.QUEUED;D.request=null;D.abortController=null;D.resolvers=[];D.startTime=0;D.numRetries=B.numRetries;return D}b._inheritsLoose(z,C);return z}(v.BaseTask);
a.TaskStatus=void 0;(function(C){C[C.QUEUED=1]="QUEUED";C[C.DOWNLOADING=2]="DOWNLOADING";C[C.DOWNLOADED=3]="DOWNLOADED";C[C.CANCELLED=4]="CANCELLED"})(a.TaskStatus||(a.TaskStatus={}));a.ImageWithType=q;a.test=B;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/AsyncWorkerQueue":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../webgl-engine/lib/Util"],function(a,b,c){let m=function(n){this.typeWorkerQuota=n;
this.tasks=[];this.numWorkers=0;this.statistics=new l},l=function(){this.speed=this.duration=this.size=this.requests=0},r=function(){function n(k,f,d,e){this._workerFunc=k;this._callbackFunc=f;this._maxTotalNumWorkers=d;this._totalNumWorkers=0;this._clients=e.map(h=>new m(h))}var g=n.prototype;g.hasQuota=function(k){return(k=this._clients[k])?this._totalNumWorkers<this._maxTotalNumWorkers||k.numWorkers+k.tasks.length<k.typeWorkerQuota:!1};g.push=function(k){const f=this._clients[k.client];f&&(this._totalNumWorkers<
this._maxTotalNumWorkers?(f.numWorkers++,this._totalNumWorkers++,this._workerFunc(k,(d,e)=>this._taskCallback(d,e))):f.tasks.push(k))};g.cancel=function(k){this._taskFinished(k);k._cancelled=!0};g.destroy=function(){this._clients.length=0};g._taskFinished=function(k){const f=this._clients[k.client];this._totalNumWorkers--;f.numWorkers--;f.statistics.requests++;f.statistics.size+=k.size||0;f.statistics.duration+=k.duration||0;f.statistics.speed=0<f.statistics.duration?f.statistics.size/f.statistics.duration:
0;c.assert(0<=f.numWorkers);this._next()};g._next=function(){for(const k of this._clients)if(k&&k.numWorkers<k.typeWorkerQuota&&this._processQueue(k))return;for(const k of this._clients)if(k&&this._processQueue(k))break};g._processQueue=function(k){for(;0<k.tasks.length;)if(this._workerFunc(k.tasks.shift(),(f,d)=>this._taskCallback(f,d)))return k.numWorkers++,this._totalNumWorkers++,!0;return!1};g._taskCallback=function(k,f){k._cancelled||(this._callbackFunc(k,f),this._taskFinished(k))};g.getStatsForType=
function(k){return(k=this._clients[k])?{quota:k.typeWorkerQuota,workers:k.numWorkers,queueSize:k.tasks.length,requestStats:k.statistics}:null};b._createClass(n,[{key:"test",get:function(){const k=this;return{set workerFunc(f){k._workerFunc=f}}}}]);return n}();a.AsyncWorkerQueue=r;a.BaseTask=function(n){this.client=n;this._cancelled=!1;this.duration=this.size=0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/SceneViewPerformanceInfo":function(){define(["../../../core/byteSizeEstimations",
"../../../core/maybe","../layers/support/MemoryManagedLayerView","./LayerPerformanceInfo","../terrain/terrainUtils"],function(a,b,c,m,l){return function(r){this.usedMemory=this.totalMemory=0;this.quality=1;this.edgesMemory=this.terrainMemory=this.load=0;this.layerPerformanceInfos=[];var n=r.resourceController.memoryController;this.totalMemory=n.maxMemory*a.ByteSizeUnit.MEGABYTES;this.usedMemory=Math.round(n.usedMemory*this.totalMemory);this.quality=n.memoryFactor;this.load=r.resourceController.scheduler.load;
this.terrainMemory=r.basemapTerrain?r.basemapTerrain.getUsedMemory():0;n=r._stage&&r._stage.renderView&&r._stage.renderView.edgeView;this.edgesMemory=b.isSome(n)?n.usedMemory:0;r.allLayerViews.items.forEach(g=>{(c.isMemoryManagedLayerView(g)||l.isSurfaceLayerView(g))&&this.layerPerformanceInfos.push(new m(g,r))});this.layerPerformanceInfos.sort((g,k)=>k.memory-g.memory)}})},"esri/views/3d/support/LayerPerformanceInfo":function(){define(["../layers/support/PerformanceInfoLayerView","../terrain/terrainUtils"],
function(a,b){return function(c,m){this.layer=null;this.displayedNumberOfFeatures=this.memory=0;this.totalNumberOfFeatures=this.maximumNumberOfFeatures=null;this.layer=c.layer;this.memory=b.isSurfaceLayerView(c)?m.basemapTerrain.getUsedMemoryForLayerView(c):c.getUsedMemory();a.isPerformanceInfoLayerView(c)&&(c=c.performanceInfo,this.displayedNumberOfFeatures=c.displayedNumberOfFeatures,this.maximumNumberOfFeatures=c.maximumNumberOfFeatures,this.totalNumberOfFeatures=c.totalNumberOfFeatures)}})},"esri/views/3d/layers/support/PerformanceInfoLayerView":function(){define(["exports"],
function(a){a.isPerformanceInfoLayerView=function(b){return"performanceInfo"in b};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/terrainUtils":function(){define("exports ../../../core/Collection ../../../core/compilerUtils ../../../core/maybe ../../../geometry/support/spatialReferenceUtils ../../../layers/support/layerUtils ../../ViewingMode ../support/StreamDataLoader ./interfaces ../../../chunks/terrainUtilsPlanar ../../../chunks/terrainUtilsSpherical".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){function e(p){return"imagery-tile"===(null==p?void 0:p.type)||"wcs"===(null==p?void 0:p.type)}function h(p){return"imagery-tile-3d"===(null==p?void 0:p.type)}function v(p){return"tile-3d"===(null==p?void 0:p.type)}function w(p){return"vector-tile-3d"===(null==p?void 0:p.type)}function t(p){return"wmts-3d"===(null==p?void 0:p.type)}function x(p){return"elevation-3d"===(null==p?void 0:p.type)}function B(p){return p&&(v(p)||h(p)||w(p)||t(p))}function q(p,y,D,E){return z[E].checkIfTileInfoSupportedForViewSR(p,
D,y)}function u(p,y,D){p=r.getTileMaxtrixSetFromActiveLayer(p);if(m.isSome(p))if(b.isCollection(p)){if(p=p.find(E=>null==q(E.tileInfo,E.fullExtent,y,D)))return{tileInfo:p.tileInfo,fullExtent:p.fullExtent}}else return{tileInfo:p.tileInfo,fullExtent:p.fullExtent};return{tileInfo:null,fullExtent:null}}function C(p){return p.isWGS84||p.isWebMercator||l.isCGCS2000(p)||!l.isEarth(p)}const z={[n.ViewingMode.Global]:d.terrainUtilsSpherical,[n.ViewingMode.Local]:f.terrainUtilsPlanar};a.ENABLE_WATERPROOFNESS_TESTS=
!1;const A={force512VTL:!1};f=[k.NeighborIndex.NORTH,k.NeighborIndex.EAST,k.NeighborIndex.SOUTH,k.NeighborIndex.WEST];d=[k.NeighborIndex.NORTH_EAST,k.NeighborIndex.SOUTH_EAST,k.NeighborIndex.SOUTH_WEST,k.NeighborIndex.NORTH_WEST];a.ENABLE_TERRAIN_INTERNAL_CHECKS=!1;a.almostEquals=function(p,y,D=1E-5){return Math.abs(p-y)<D};a.checkIfTileInfoSupportedForView=q;a.enableWaterproofnessTests=function(p){a.ENABLE_WATERPROOFNESS_TESTS=p};a.eps=1E-5;a.getLayerWithExtentRange=function(p){return h(p)?{fullExtent:p.fullExtent,
minScale:p.layer.minScale,maxScale:p.layer.maxScale,tilemapCache:null}:p.layer};a.getTileInfoAndExtentFromWMTSLayer=u;a.getTiledLayerInfo=function(p,y,D){var E=null;let F=null;if("wmts"===(null==p?void 0:p.type))p=u(p,y,D),E=p.tileInfo,F=p.fullExtent;else if(F=e(p)?p.getCompatibleFullExtent(y):p.fullExtent,E=D===n.ViewingMode.Local,e(p))E=p.getCompatibleTileInfo(y,F,E);else if("vector-tile"===(null==p?void 0:p.type)){E=E&&!C(y)||A.force512VTL;const G=p.tileInfo.spatialReference.isGeographic;E=E?p.tileInfo:
p.tileInfo.getOrCreateCompatible(256,G?1:2)}else E=p.tileInfo;return m.isSome(E)&&m.isSome(F)&&null==q(E,F,y,D)?{tileInfo:E,fullExtent:F}:null};a.internalAssert=function(p,y){};a.isBlendableLayerView=function(p){return p&&(v(p)||t(p)||h(p)||w(p))};a.isEast=function(p){return p===k.NeighborIndex.NORTH_EAST||p===k.NeighborIndex.EAST||p===k.NeighborIndex.SOUTH_EAST};a.isElevationLayerView=x;a.isGroupLayer=function(p){return"group"===(null==p?void 0:p.type)};a.isImageryTileLayerView=h;a.isImageryTileRenderInfo=
function(p){var y;p=null==p?void 0:null==(y=p.sourceLayerInfo)?void 0:y.data;return m.isSome(p)&&"type"in p&&"raster-tile"===p.type};a.isMapTileLayerView=B;a.isNorth=function(p){return p===k.NeighborIndex.NORTH_EAST||p===k.NeighborIndex.NORTH||p===k.NeighborIndex.NORTH_WEST};a.isNorthCorner=function(p){return p===k.NeighborIndex.NORTH_WEST||p===k.NeighborIndex.NORTH_EAST};a.isProjectableRasterLayer=e;a.isRasterTileRenderInfo=function(p){var y;p=null==p?void 0:null==(y=p.sourceLayerInfo)?void 0:y.data;
return p instanceof HTMLImageElement||p instanceof g.ImageWithType||p instanceof HTMLCanvasElement||p instanceof ImageData};a.isSouth=function(p){return p===k.NeighborIndex.SOUTH_EAST||p===k.NeighborIndex.SOUTH||p===k.NeighborIndex.SOUTH_WEST};a.isSurfaceLayerView=function(p){return B(p)||x(p)};a.isTerrainSurfaceLayer=function(p){switch(p.type){case "building-scene":case "csv":case "feature":case "geo-rss":case "geojson":case "graphics":case "group":case "integrated-mesh":case "kml":case "line-of-sight":case "map-notes":case "ogc-feature":case "point-cloud":case "route":case "scene":case "stream":case "voxel":case "subtype-group":case "unknown":case "unsupported":case "wfs":case null:return!1;
case "base-dynamic":case "base-elevation":case "base-tile":case "bing-maps":case "elevation":case "imagery":case "imagery-tile":case "map-image":case "media":case "open-street-map":case "tile":case "vector-tile":case "wcs":case "web-tile":case "wms":case "wmts":return!0;default:return c.neverReached(p.type),!1}};a.isTextureTileRenderInfo=function(p){var y;p=null==p?void 0:null==(y=p.sourceLayerInfo)?void 0:y.data;return m.isSome(p)&&"type"in p&&"tile-texture"===p.type};a.isTileLayerView=v;a.isVectorTileLayerView=
w;a.isVectorTileRenderInfo=function(p){var y;p=null==p?void 0:null==(y=p.sourceLayerInfo)?void 0:y.data;return m.isSome(p)&&"type"in p&&"vector-tile"===p.type};a.isWMTSLayerView=t;a.isWest=function(p){return p===k.NeighborIndex.NORTH_WEST||p===k.NeighborIndex.WEST||p===k.NeighborIndex.SOUTH_WEST};a.isWestCorner=function(p){return p===k.NeighborIndex.NORTH_WEST||p===k.NeighborIndex.SOUTH_WEST};a.lij2s=function(p){return"["+p[0]+","+p[1]+","+p[2]+"]"};a.neighborCornerIndices=d;a.neighborEdgeIndices=
f;a.oppositeCorner=function(p){return p===k.NeighborIndex.NORTH_EAST?k.NeighborIndex.SOUTH_WEST:p===k.NeighborIndex.NORTH_WEST?k.NeighborIndex.SOUTH_EAST:p===k.NeighborIndex.SOUTH_WEST?k.NeighborIndex.NORTH_EAST:k.NeighborIndex.NORTH_WEST};a.oppositeEdge=function(p){return p===k.NeighborIndex.NORTH?k.NeighborIndex.SOUTH:p===k.NeighborIndex.EAST?k.NeighborIndex.WEST:p===k.NeighborIndex.SOUTH?k.NeighborIndex.NORTH:k.NeighborIndex.EAST};a.releaseTileData=function(p){m.isSome(p)&&"release"in p&&p.release();
return null};a.test=A;a.useFetchTileForLayer=function(p){return p.fetchTile&&!1!==p.hasOverriddenFetchTile};a.v32s=function(p){return"("+p[0]+","+p[1]+","+p[2]+")"};a.vtlAssumes256PixelSizeAsDefault=C;a.weakAssert=function(p,y){p||console.warn("Terrain: "+y)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/terrainUtilsPlanar":function(){define("exports ../core/Error ../core/maybe ./vec3 ./vec3f64 ../geometry/projection ../geometry/support/aaBoundingRect ../views/3d/terrain/TerrainConst ../views/3d/terrain/TilingScheme".split(" "),
function(a,b,c,m,l,r,n,g,k){function f(B,q,u=0){B=B.extent;return c.isNone(B)?!1:0===u?n.containsPoint(B,q):n.containsPointWithMargin(B,q,u*Math.min(B[2]-B[0],B[3]-B[1]))}function d(B,q,u,C){m.copy(v,u);v[C]=q[C];C=m.subtract(v,v,q);var z=m.subtract(w,B,q);z=m.dot(z,C);const A=m.dot(C,C);q=0>=z?q:A<=z?u:m.add(v,q,m.scale(C,C,z/A));B=m.subtract(v,B,q);return Math.PI/2-Math.atan(B[2]/Math.sqrt(B[0]*B[0]+B[1]*B[1]))}function e(B,q,u){B=B.extent;if(c.isNone(B))return 0;t[0]=B[0];t[1]=B[1];t[2]=u;x[0]=
B[2];x[1]=B[3];x[2]=u;B=u=Infinity;q[0]<t[0]?u=d(q,t,x,0):q[0]>x[0]&&(u=d(q,x,t,0));q[1]<t[1]?B=d(q,t,x,1):q[1]>x[1]&&(B=d(q,x,t,1));return Math.min(u,B)}function h(B,q,u){if(c.isNone(B))return k.getMissingTileInfoError();if(B.spatialReference.isGeographic&&!r.canProjectToWGS84ComparableLonLat(B.spatialReference))return new b("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");var C=k.TilingScheme.checkUnsupported(B);if(c.isSome(C))return C;
if(c.isNone(u))return new b("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");{var z=B.lods;C=z[0].resolution*2**z[0].level;var A=[C*B.size[0],C*B.size[1]];const p=[B.origin.x,B.origin.y];u=n.fromExtent(u);const y=n.create();k.TilingScheme.computeRowColExtent(u,A,p,y);A=(y[2]-y[0])*(y[3]-y[1]);A>g.MAX_ROOT_TILES?(z=z[0].scale*2**z[0].level,C=Math.max((u[3]-u[1])/B.size[1],(u[2]-u[0])/B.size[0])*z/C,u=Math.floor(Math.log(C)/Math.log(10)),C=Math.ceil(C/10**u)*10**u,C=new b("tilingscheme:too-many-root-tiles",
"Scale of level 0 of the tiling scheme (1:"+Math.floor(z).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+C.toLocaleString()+".",{level0Scale:z,suggestedLevel0Scale:C,requiredNumRootTiles:A,allowedNumRootTiles:g.MAX_ROOT_TILES})):C=null}if(C)return C;B=B.spatialReference;return!c.isSome(q)||B.equals(q)||q.isWGS84&&B.isWebMercator?null:new b("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}const v=l.create(),
w=l.create(),t=l.create(),x=l.create();l=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:f,tiltToExtentEdge:e,checkIfTileInfoSupportedForViewSR:h},Symbol.toStringTag,{value:"Module"}));a.checkIfTileInfoSupportedForViewSR=h;a.isInsideExtent=f;a.terrainUtilsPlanar=l;a.tiltToExtentEdge=e})},"esri/chunks/terrainUtilsSpherical":function(){define("exports ../core/Error ../core/maybe ../geometry/projection ../geometry/support/spatialReferenceUtils ../views/3d/terrain/TilingScheme".split(" "),
function(a,b,c,m,l,r){function n(){return!0}function g(){return 0}function k(d,e){if(c.isNone(d))return r.getMissingTileInfoError();const h=d.lods.length-1,v=d.spatialReference,w=m.canProjectToWGS84ComparableLonLat(v)||l.isMars(v)||l.isMoon(v);if(v.isWebMercator){if(!r.TilingScheme.makeWebMercatorAuxiliarySphere(h).compatibleWith(d))return new b("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(w){if(!r.TilingScheme.makeGCSWithTileSize(d.spatialReference,
d.size[0],h).compatibleWith(d))return d.spatialReference.isWGS84?new b("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new b("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}else return new b("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(c.isSome(e)&&!d.spatialReference.equals(e))return new b("tilingscheme:spatial-reference-mismatch",
"The tiling scheme does not match the spatial reference of the global scene")}const f=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:n,tiltToExtentEdge:g,checkIfTileInfoSupportedForViewSR:k},Symbol.toStringTag,{value:"Module"}));a.checkIfTileInfoSupportedForViewSR=k;a.isInsideExtent=n;a.terrainUtilsSpherical=f;a.tiltToExtentEdge=g})},"esri/views/3d/support/SharedSymbolResources":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/arrayUtils ../../../core/Handles ../../../core/handleUtils ../../../core/reactiveUtils ../../../geometry/projectionEllipsoid ./index ./StreamTextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl/enums".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){let e=function(){function v(t){this.streamDataRequester=this.textures=null;this.graphicsOwners=[];this.cimSymbolRasterizer=this.screenSizePerspectiveHandles=null;this.viewState=t.viewState;this.view=t.view;this.pointsOfInterest=t.pointsOfInterest;this.objectResourceCache=t.objectResourceCache;this.streamDataRequester=t.resourceController.createStreamDataRequester(g.ClientType.SYMBOLOGY);this.textures=new k.StreamTextureCollection(this.streamDataRequester,t.view._stage,
{preMultiplyAlpha:!0,wrap:{s:d.TextureWrapMode.CLAMP_TO_EDGE,t:d.TextureWrapMode.CLAMP_TO_EDGE}},t.resourceController.scheduler);const x=n.getReferenceEllipsoid(this.view.spatialReference).radius;this.screenSizePerspectiveSettings=f.getSettings(t.viewingMode,x);this.screenSizePerspectiveSettingsLabels=f.getLabelSettings(t.viewingMode,x)}var w=v.prototype;w.destroy=function(){this.textures.destroy();this.streamDataRequester=this.textures=null};w.addGraphicsOwner=function(t){if(!t)return l.makeHandle();
this.graphicsOwners.push(t);const x=r.watch(()=>{var B;return null==(B=t.layer)?void 0:B.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());this._updateScreenSizePerspectiveEnabled();return l.makeHandle(()=>{x.remove();c.removeUnordered(this.graphicsOwners,t);this._updateScreenSizePerspectiveEnabled()})};w._updateScreenSizePerspectiveEnabled=function(){var t=this.graphicsOwners.some(x=>{var B;return!0===(null==(B=x.layer)?void 0:B.screenSizePerspectiveEnabled)});t&&!this.screenSizePerspectiveHandles?
(this.screenSizePerspectiveHandles=new m,t=()=>this._updateScreenSizePerspectiveSettings(),this.screenSizePerspectiveHandles.add([r.watch(()=>this.pointsOfInterest.centerOnSurfaceInfrequent.distance,t,r.sync),this.viewState.events.on("camera-projection-changed",t)]),this._updateScreenSizePerspectiveSettings()):!t&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)};w._updateScreenSizePerspectiveSettings=function(){h.distance=this.pointsOfInterest.centerOnSurfaceInfrequent.distance;
h.fovY=this.viewState.camera.fovY;this.screenSizePerspectiveSettings.update(h);this.screenSizePerspectiveSettingsLabels.update(h);this.view._stage.renderView.requestRender()};b._createClass(v,[{key:"test",get:function(){return{screenSizePerspectiveHandles:this.screenSizePerspectiveHandles}}}]);return v}();const h={distance:0,fovY:0};a.SharedSymbolResources=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/StreamTextureCollection":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils ./TextureCollection ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/Texture".split(" "),
function(a,b,c,m,l,r,n,g){r=function(k){function f(e,h,v,w){h=k.call(this,h,w)||this;h._streamDataRequester=e;h._parameters=v;return h}b._inheritsLoose(f,k);var d=f.prototype;d.fromUrl=function(){var e=b._asyncToGenerator(function*(h,v,w){var t=this;m.throwIfAborted(w);const x=c.isSome(w)&&w.signal,B=this.makeUid(h,v);let q=this._textureRequests.get(B);if(!q){w=new AbortController;const u=this._streamDataRequester.request(h,"image",{uid:B,signal:w.signal});q={referenceCount:0,texture:null,textureAsync:null,
abortController:w};this._textureRequests.set(B,q);q.textureAsync=u.then(function(){var C=b._asyncToGenerator(function*(z){z=t._createTexture(h,z,v);q.texture=z;q.abortController=null;t._stage.add(z);yield t._stage.load(z);return{uid:B,texture:z,release:()=>t._release(B)}});return function(z){return C.apply(this,arguments)}}(),C=>{q.abortController=null;throw C;})}q.referenceCount++;return(new Promise((u,C)=>{m.onAbort(x,()=>{C(m.createAbortError())});q.textureAsync.then(u,C)})).catch(u=>{this._release(B);
throw u;})});return function(h,v,w){return e.apply(this,arguments)}}();d._createTexture=function(e,h,v){const w={...this._parameters,powerOfTwoResizeMode:n.PowerOfTwoResizeMode.PAD};if(l.isSVG(e)){if(v||0===h.width&&0===h.height)e=h.width?h.height/h.width:1,v=v||64,1<e?(h.width=Math.round(v/e),h.height=v):(h.width=v,h.height=Math.round(v*e));this._stage.renderView&&this._stage.renderView.renderingContext.driverTest.svgAlwaysPremultipliesAlpha&&(w.preMultiplyAlpha=!1)}w.width=h.width;w.height=h.height;
return new g.Texture(h,w)};return f}(r.TextureCollection);a.StreamTextureCollection=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ../debugFlags ../debugUtils ../PropertiesPool ../geometryUtils/ray ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/verticalOffsetUtils ../../../support/Scheduler".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G){a.PointsOfInterest=function(L){function J(I){I=L.call(this,I)||this;I._handles=new l;I._tmpRay=w.create();I._centerRayDirty=!0;I._surfaceAltitudeAtCenter=0;I._surfaceAltitudeAtCenterDirty=!0;I._contentAltitudeAtCenter=0;I._contentAltitudeAtCenterDirty=!0;I._propertiesPool=new B.PropertiesPool({renderPointOfView:P},b._assertThisInitialized(I));I.renderPointOfView=v.create();I._pois=[];I._debugCenters=new Map;return I}b._inheritsLoose(J,
L);var H=J.prototype;H.initialize=function(){var I;const {state:O,basemapTerrain:Q,renderCoordsHelper:S,map:T}=this.view;this._surfaceIntersector=D.newIntersector(O.viewingMode);this._surfaceIntersector.options.backfacesTerrain=O.isGlobal?!1:!0;this._surfaceIntersector.options.invisibleTerrain=!1;this._surfaceIntersector.options.store=E.StoreResults.MIN;this._contentIntersector=D.newIntersector(O.viewingMode);var U=()=>this._estimateSurfaceAltitudeAtCenter();const aa=this.view.resourceController.scheduler,
W=r.unwrap(null==(I=this.view.basemapTerrain)?void 0:I.elevationQueryCache);I={state:O,scheduler:aa,surface:Q,renderCoordsHelper:S};this._set("centerOnSurfaceInfrequent",new C.CenterOnSurface({...I,task:G.TaskPriority.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:U}));this._set("centerOnSurfaceFrequent",new C.CenterOnSurface({...I,task:G.TaskPriority.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:U}));this._set("contentCenterOnSurface",new C.CenterOnSurface({...I,task:G.TaskPriority.POINT_OF_INTEREST_INFREQUENT,
estimateSurfaceAltitudeAtCenter:U,cameraName:"contentCamera"}));this._set("centerOnContent",new C.CenterOnSurface({...I,task:G.TaskPriority.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()}));this._set("cameraOnSurface",new u.CameraOnSurface({...I,cache:W,task:G.TaskPriority.POINT_OF_INTEREST_INFREQUENT,map:T}));this._set("contentCameraOnSurface",new u.CameraOnSurface({...I,cache:W,task:G.TaskPriority.POINT_OF_INTEREST_INFREQUENT,map:T,cameraName:"contentCamera"}));
this._set("surfaceGeometryUpdates",new y.SurfaceGeometryUpdates({...I,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}));this._set("contentGeometryUpdates",new z.ContentGeometryUpdates({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:S}));this._set("surfaceOrigin",new p.StableSurfaceCenter({cache:W,view:this.view}));this._set("focus",new A.Focus({state:O,scheduler:aa,surface:Q,renderCoordsHelper:S,centerOnSurface:this.contentCenterOnSurface,
estimateSurfaceIntersectionAtRenderPoint:(R,V)=>this._estimateSurfaceIntersectionAtRenderPoint(R,this.view.state.contentCamera,V)}));this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.contentCenterOnSurface,this.cameraOnSurface,this.contentCameraOnSurface,this.focus);U=this.view.graphics;this._debugCenters.set(this.centerOnContent,new x.PointGraphics(U,"red","CenterOnContent"));this._debugCenters.set(this.centerOnSurfaceFrequent,new x.PointGraphics(U,
"red","CenterOnSurface"));this._debugCenters.set(this.centerOnSurfaceInfrequent,new x.PointGraphics(U,"red","CenterOnSurface"));this._debugCenters.set(this.contentCenterOnSurface,new x.PointGraphics(U,"red","ContentCenterOnSurface"));this._debugCenters.set(this.cameraOnSurface,new x.PointGraphics(U,"blue","CameraOnSurface"));this._debugCenters.set(this.contentCameraOnSurface,new x.PointGraphics(U,"blue","ContentCameraOnSurface"));this._debugCenters.set(this.focus,new x.PointGraphics(U,"green","Focus"));
this._handles.add([n.watch(()=>O.camera,R=>this._cameraChanged(R),n.sync),n.watch(()=>Q.extent,()=>this._updateCenterPointsOfInterest()),n.when(()=>!Q.updating,()=>this._updateCenterPointsOfInterest(),n.sync),n.on(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),n.on(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),n.when(()=>t.SHOW_POI,R=>this._setDebug(R),n.initial)]);this._cameraChanged(this.view.state.camera);
for(const R of this._pois)R.runTask()};H.destroy=function(){this._setDebug(!1);this._handles.destroy();this._propertiesPool.destroy();for(const I of this._pois)I.destroy();this.surfaceOrigin.destroy()};H._estimateContentAltitudeAtCenter=function(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const I=this.centerRay;if(r.isNone(I))return this._contentAltitudeAtCenter;this.view.sceneIntersectionHelper.intersectRay(I,this._contentIntersector,
K,M)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(K):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter();return this._contentAltitudeAtCenter};H._estimateSurfaceAltitudeAtCenter=function(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const I=this.centerRay;if(r.isNone(I))return this._surfaceAltitudeAtCenter;const O=I.origin,Q=h.add(K,I.origin,I.direction);
this._surfaceIntersector.resetWithRay(I,this.view.state.camera);this.view.basemapTerrain.intersect(this._surfaceIntersector,null,O,Q);this._surfaceIntersector.results.min.getIntersectionPoint(K)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(K));return this._surfaceAltitudeAtCenter};H._estimateSurfaceIntersectionAtRenderPoint=function(I,O,Q){I=q.fromRenderAtEye(O,I,N);if(r.isNone(I))return null;const S=I.origin,T=h.add(K,I.origin,I.direction);this._surfaceIntersector.resetWithRay(I,
O);this.view.basemapTerrain.intersect(this._surfaceIntersector,null,S,T);return this._surfaceIntersector.results.min.getIntersectionPoint(Q)?Q:null};H._cameraChanged=function(I){this._updateCenterPointsOfInterest();I=I.eye;h.exactEquals(this.renderPointOfView,I)||this._set("renderPointOfView",h.copy(this._propertiesPool.get("renderPointOfView"),I))};H._updateCenterPointsOfInterest=function(){this._contentAltitudeAtCenterDirty=this._surfaceAltitudeAtCenterDirty=this._centerRayDirty=!0;for(const I of this._pois)I.updateRenderLocation()};
H._updateCenterOnContent=function(){this._contentAltitudeAtCenterDirty=!0;this.centerOnContent.updateRenderLocation()};H._setDebug=function(I){if(I)for(const O of this._pois)this._handles.add(n.watch(()=>O.renderLocation,Q=>this._debugCenters.get(O).show(Q,O.renderCoordsHelper.spatialReference),n.initial),"debug");else this._debugCenters.forEach(O=>O.hide()),this._handles.remove("debug")};b._createClass(J,[{key:"updating",get:function(){var I;return!!(null!=(I=this.surfaceGeometryUpdates)&&I.updating||
this._pois.some(O=>O.updating))}},{key:"centerRay",get:function(){this._centerRayDirty&&(this._centerRay=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,this._tmpRay),this._centerRayDirty=!1);return this._centerRay}},{key:"test",get:function(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const I of this._pois)I.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}}]);return J}(m);c.__decorate([g.property({readOnly:!0})],a.PointsOfInterest.prototype,
"centerOnContent",void 0);c.__decorate([g.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnSurfaceFrequent",void 0);c.__decorate([g.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnSurfaceInfrequent",void 0);c.__decorate([g.property({readOnly:!0})],a.PointsOfInterest.prototype,"contentCenterOnSurface",void 0);c.__decorate([g.property({readOnly:!0})],a.PointsOfInterest.prototype,"cameraOnSurface",void 0);c.__decorate([g.property({readOnly:!0})],a.PointsOfInterest.prototype,
"contentCameraOnSurface",void 0);c.__decorate([g.property({readOnly:!0})],a.PointsOfInterest.prototype,"focus",void 0);c.__decorate([g.property({readOnly:!0})],a.PointsOfInterest.prototype,"renderPointOfView",void 0);c.__decorate([g.property({readOnly:!0})],a.PointsOfInterest.prototype,"surfaceOrigin",void 0);c.__decorate([g.property({readOnly:!0})],a.PointsOfInterest.prototype,"contentGeometryUpdates",void 0);c.__decorate([g.property({readOnly:!0})],a.PointsOfInterest.prototype,"surfaceGeometryUpdates",
void 0);c.__decorate([g.property({constructOnly:!0})],a.PointsOfInterest.prototype,"view",void 0);c.__decorate([g.property({readOnly:!0})],a.PointsOfInterest.prototype,"updating",null);a.PointsOfInterest=c.__decorate([e.subclass("esri.views.3d.support.PointsOfInterest")],a.PointsOfInterest);const P=Array,K=v.create(),N=w.create(),M={exclude:new Set([F.TERRAIN_ID])};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/debugUtils":function(){define("exports ../../../geometry ../../../Graphic ../../../symbols ../../../core/maybe ../../../geometry/Polygon ../../../symbols/FillSymbol3DLayer ../../../symbols/PolygonSymbol3D ../../../geometry/Point ../../../symbols/PointSymbol3D ../../../symbols/IconSymbol3DLayer ../../../symbols/TextSymbol3DLayer".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e){b=function(){function h(w,t,x=""){this.graphics=w;this._symbol=new f({symbolLayers:[new d({material:{color:t},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new e({text:x,halo:{color:"white",size:1/.75},material:{color:t},size:12})]})}var v=h.prototype;v.show=function(w,t){l.isNone(t)||(this.hide(),w=new k({x:w[0],y:w[1],z:w[2],spatialReference:t}),this._graphic=new c({geometry:w,symbol:this._symbol}),this.graphics.add(this._graphic))};v.hide=
function(){l.isSome(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)};return h}();m=function(){function h(w,t,x=""){this.graphics=w;this._graphics=[];this._outline=new g({symbolLayers:[new n({material:{color:[0,0,0,0]},outline:{color:t,size:2}})]});this._text=new f({symbolLayers:[new e({text:x,halo:{color:"white",size:1/.75},material:{color:t},size:12})]})}var v=h.prototype;v.show=function(w){this.hide();const t=new k({x:w.xmin,y:w.ymin,z:w.zmax,spatialReference:w.spatialReference});
this._graphics.push(new c({geometry:r.fromExtent(w),symbol:this._outline}));this._graphics.push(new c({geometry:t,symbol:this._text}));this.graphics.addMany(this._graphics)};v.hide=function(){this.graphics.removeMany(this._graphics);this._graphics.length=0};return h}();a.ExtentGraphics=m;a.PointGraphics=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../cameraUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t){const x=Array;a.CameraOnSurface=function(q){function u(z){z=q.call(this,z)||this;z._dirty=!1;z._propertiesPool=new w.PropertiesPool({location:h,renderLocation:x},b._assertThisInitialized(z));z._estimatedSurfaceAltitude=0;z._pendingElevationQueryController=null;z.cameraName="camera";z.renderLocation=e.create();z.tmpPoint=new h;return z}b._inheritsLoose(u,q);var C=u.prototype;C.initialize=function(){this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,
this));this.runTask();if(this.map){const z=()=>this._setDirty();this.handles.add(l.on(()=>{var A,p;return null==(A=this.map)?void 0:null==(p=A.ground)?void 0:p.layers},"change",z,{onListenerAdd:z,onListenerRemove:z}))}this._updateRenderLocation()};C.destroy=function(){this._cancelPendingRequest();this._propertiesPool.destroy();this._propertiesPool=null};C.updateRenderLocation=function(){this._setDirty();this._updateRenderLocation()};C._setDirty=function(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))};
C._cancelPendingRequest=function(){const z=this._pendingElevationQueryController;z&&(this._pendingElevationQueryController=null,z.abort(),this.notifyChange("updating"))};C.runTask=function(){this._cancelPendingRequest();this._dirty=!1;this.notifyChange("updating");if(this.map&&this.map.ground){this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this.tmpPoint,this.state.spatialReference);var z=new AbortController;this.map.ground.queryElevation(this.tmpPoint,{signal:z.signal,cache:this.cache}).then(A=>
this._updateSurfaceAltitude(A.geometry.z)).catch(A=>{m.isAbortError(A)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===z&&(this._pendingElevationQueryController=null,this.notifyChange("updating"));z=null});this._pendingElevationQueryController=z}else this._updateSurfaceAltitude(0)};C._updateSurfaceAltitude=function(z){this._estimatedSurfaceAltitude!==z&&(this._estimatedSurfaceAltitude=z,this._updateRenderLocation())};C._updateRenderLocation=function(){this.renderCoordsHelper.setAltitude(B,
this._estimatedSurfaceAltitude,this._camera.eye);d.exactEquals(this._get("renderLocation"),B)||this._set("renderLocation",d.copy(this._propertiesPool.get("renderLocation"),B))};b._createClass(u,[{key:"_camera",get:function(){return this.state[this.cameraName]}},{key:"location",get:function(){const z=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,z,this.state.spatialReference);return z}},{key:"scale",get:function(){const z=this._camera,A=d.distance(z.eye,
this.renderLocation);return v.distanceToScale({renderCoordsHelper:this.renderCoordsHelper,state:{camera:z}},A,0)}},{key:"updating",get:function(){return this._dirty||null!=this._pendingElevationQueryController}},{key:"running",get:function(){return!this._pendingElevationQueryController&&this._dirty}}]);return u}(t.PointOfInterest);c.__decorate([r.property({constructOnly:!0})],a.CameraOnSurface.prototype,"scheduler",void 0);c.__decorate([r.property({constructOnly:!0})],a.CameraOnSurface.prototype,
"cache",void 0);c.__decorate([r.property({constructOnly:!0})],a.CameraOnSurface.prototype,"task",void 0);c.__decorate([r.property({constructOnly:!0})],a.CameraOnSurface.prototype,"cameraName",void 0);c.__decorate([r.property({readOnly:!0})],a.CameraOnSurface.prototype,"location",null);c.__decorate([r.property({constructOnly:!0})],a.CameraOnSurface.prototype,"map",void 0);c.__decorate([r.property({readOnly:!0})],a.CameraOnSurface.prototype,"renderLocation",void 0);c.__decorate([r.property({readOnly:!0})],
a.CameraOnSurface.prototype,"scale",null);c.__decorate([r.property({readOnly:!0})],a.CameraOnSurface.prototype,"updating",null);a.CameraOnSurface=c.__decorate([f.subclass("esri.views.3d.support.CameraOnSurface")],a.CameraOnSurface);const B=e.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,m,l,r,n,g,k,f){a.PointOfInterest=function(d){function e(h){h=d.call(this,h)||this;h.handles=new l;return h}b._inheritsLoose(e,d);e.prototype.destroy=function(){this.handles.destroy()};return e}(m);c.__decorate([r.property({constructOnly:!0})],a.PointOfInterest.prototype,"renderCoordsHelper",void 0);c.__decorate([r.property({constructOnly:!0})],a.PointOfInterest.prototype,"surface",void 0);c.__decorate([r.property({constructOnly:!0})],a.PointOfInterest.prototype,"state",void 0);a.PointOfInterest=
c.__decorate([f.subclass("esri.views.3d.support.PointOfInterest")],a.PointOfInterest);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/support/aaBoundingRect ../debugFlags ../PropertiesPool ./PointOfInterest".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q){const u=Array;a.CenterOnSurface=function(p){function y(E){E=p.call(this,E)||this;E._propertiesPool=new B.PropertiesPool({location:h,renderLocation:u},b._assertThisInitialized(E));E._currentSurfaceAltitude=0;E._latestSurfaceAltitude=0;E.cameraName="camera";E.distance=0;E.renderLocation=e.create();E.updating=!1;return E}b._inheritsLoose(y,p);var D=y.prototype;D.initialize=function(){this._frameWorker=this.scheduler.registerTask(this.task,this);this.runTask()};
D.destroy=function(){this._frameWorker=l.removeMaybe(this._frameWorker);this._propertiesPool=l.destroyMaybe(this._propertiesPool)};D.updateRenderLocation=function(){this.updating=!0;this._updateRenderLocation()};D.runTask=function(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this._updateRenderLocation();this.updating=!1};D._updateRenderLocation=function(){const E=C;let F=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,E);var G=this._currentSurfaceAltitude!==
this._latestSurfaceAltitude;!F&&G&&(F=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,E))&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude);G=z;F&&this._latestSurfaceAltitudeChangesDistanceSignificantly(E,G)&&(d.copy(E,G),this._currentSurfaceAltitude=this._latestSurfaceAltitude);F?this.distance=d.distance(this._camera.eye,E):(d.scale(E,this._camera.viewForward,this._get("distance")),d.add(E,E,this._camera.eye));d.exactEquals(this._get("renderLocation"),E)||this._set("renderLocation",
d.copy(this._propertiesPool.get("renderLocation"),E))};D._calculateSurfaceIntersection=function(E,F){var G=this._camera;if(!this.renderCoordsHelper.intersectManifold(G.ray,E,F))return!1;if(this.state.isGlobal){const P=w.getReferenceEllipsoid(this.renderCoordsHelper.spatialReference).radius;E=P+E;const K=d.squaredLength(G.eye),N=K<E*E,M=d.distance(G.eye,F);N&&M>P/4&&(d.scale(F,G.viewForward,E-Math.sqrt(K)),d.add(F,F,G.eye))}else G=this.surface.ready?this.surface.extent:null,l.isSome(G)&&v.projectBoundingRect(G,
this.surface.spatialReference,A,this.renderCoordsHelper.spatialReference)&&(F[0]=m.clamp(F[0],A[0],A[2]),F[1]=m.clamp(F[1],A[1],A[3]));return!0};D._latestSurfaceAltitudeChangesDistanceSignificantly=function(E,F){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||null==E)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,F)){if(x.TESTS_DISABLE_OPTIMIZATIONS)return!0;const G=this._camera.eye;E=d.distance(G,E);F=d.distance(G,F);if(.05<Math.abs(F-E)/E)return!0}return!1};
b._createClass(y,[{key:"_camera",get:function(){return this.state[this.cameraName]}},{key:"location",get:function(){const E=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,E,this.state.spatialReference);return E}},{key:"estimatedSurfaceAltitude",get:function(){return this._latestSurfaceAltitude}},{key:"running",get:function(){return this.updating}}]);return y}(q.PointOfInterest);c.__decorate([r.property({constructOnly:!0})],a.CenterOnSurface.prototype,
"scheduler",void 0);c.__decorate([r.property({constructOnly:!0})],a.CenterOnSurface.prototype,"task",void 0);c.__decorate([r.property({constructOnly:!0})],a.CenterOnSurface.prototype,"cameraName",void 0);c.__decorate([r.property()],a.CenterOnSurface.prototype,"distance",void 0);c.__decorate([r.property({constructOnly:!0})],a.CenterOnSurface.prototype,"estimateSurfaceAltitudeAtCenter",void 0);c.__decorate([r.property({readOnly:!0})],a.CenterOnSurface.prototype,"location",null);c.__decorate([r.property({readOnly:!0})],
a.CenterOnSurface.prototype,"renderLocation",void 0);c.__decorate([r.property()],a.CenterOnSurface.prototype,"updating",void 0);a.CenterOnSurface=c.__decorate([f.subclass("esri.views.3d.support.CenterOnSurface")],a.CenterOnSurface);const C=e.create(),z=e.create(),A=t.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["exports","../../../../core/Evented","../../../../core/Handles"],
function(a,b,c){let m=function(){function r(g){this.handles=new c;this.events=new b;this.contentLayerViews=g.contentLayerViews;this.handles.add(this.contentLayerViews.on("change",k=>this._layerViewsChanged(k)));this._layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}var n=r.prototype;n.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};n._layerViewsChanged=function(g){g.added.forEach(k=>{"esri.views.3d.layers.SceneLayerView3D"===
k.declaredClass&&this.handles.add(k.on("visible-geometry-changed",()=>this._contentChanged()),k.uid)});g.removed.forEach(k=>this.handles.remove(k.uid))};n._contentChanged=function(){this.events.emit("request-update",l)};return r}();const l={};a.ContentGeometryUpdates=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/support/ray ../PropertiesPool ./PointOfInterest ../../webgl-engine/lib/Camera ../../../support/Scheduler".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q){const u=Array;a.Focus=function(p){function y(E){E=p.call(this,E)||this;E._propertiesPool=new t.PropertiesPool({location:v,renderLocation:u},b._assertThisInitialized(E));E._dirty=!0;E.renderLocation=E._propertiesPool.get("renderLocation");return E}b._inheritsLoose(y,p);var D=y.prototype;D.initialize=function(){this.handles.add([l.watch(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),l.watch(()=>this.state.contentCamera,()=>this.updateRenderLocation())]);
this.scheduler&&this.handles.add(this.scheduler.registerTask(q.TaskPriority.POINT_OF_INTEREST_FREQUENT,this))};D.destroy=function(){this._propertiesPool.destroy();this._propertiesPool=null};D.runTask=function(){var E=this._get("renderLocation");const F=this.centerOnSurface.renderLocation;var G=this.renderCoordsHelper,P=this.state.contentCamera;this._dirty=!1;G.worldUpAtPosition(F,C);G=Math.max(0,(Math.acos(e.dot(C,P.viewForward))-.5*Math.PI)*(P.aboveGround?1:-1));Number.isNaN(G)?E&&e.equals(E,F)||
(E=this._propertiesPool.get("renderLocation"),e.copy(E,F),this._set("renderLocation",E)):(G=1-m.clamp(G/(.5*Math.PI),0,1),G*=G*G,this._calculateScreenHorizontalEdgeOnSurface(A),P=this._propertiesPool.get("renderLocation"),e.lerp(P,F,A,G),E&&e.equals(E,P)||this._set("renderLocation",P))};D._calculateScreenHorizontalEdgeOnSurface=function(E){const F=this.state.contentCamera;var G=F.getRenderCenter(r.createRenderScreenPointArray3());G[1]=F.aboveGround?F.padding[B.PaddingSide.BOTTOM]:F.fullHeight-F.padding[B.PaddingSide.TOP];
if(this.estimateSurfaceIntersectionAtRenderPoint(G,E))return E;const P=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);return F.unprojectFromRenderScreen(G,z)&&(e.subtract(z,z,F.eye),G=e.normalize(z,z),this.renderCoordsHelper.intersectManifold(w.wrap(F.eye,G),P,E))?E:this.renderCoordsHelper.setAltitude(E,P,F.eye)};D.updateRenderLocation=function(){this._dirty=!0};b._createClass(y,[{key:"updating",get:function(){return this._dirty||this.centerOnSurface.updating}},{key:"location",
get:function(){const E=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,E,this.state.spatialReference);return E}},{key:"running",get:function(){return this._dirty}}]);return y}(x.PointOfInterest);c.__decorate([n.property()],a.Focus.prototype,"_dirty",void 0);c.__decorate([n.property({constructOnly:!0})],a.Focus.prototype,"scheduler",void 0);c.__decorate([n.property({constructOnly:!0})],a.Focus.prototype,"centerOnSurface",void 0);c.__decorate([n.property({constructOnly:!0})],
a.Focus.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0);c.__decorate([n.property({readOnly:!0})],a.Focus.prototype,"updating",null);c.__decorate([n.property({readOnly:!0})],a.Focus.prototype,"location",null);c.__decorate([n.property({readOnly:!0})],a.Focus.prototype,"renderLocation",void 0);a.Focus=c.__decorate([d.subclass("esri.views.3d.support.CenterOnSurface")],a.Focus);const C=h.create(),z=h.create(),A=h.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t){a.StableSurfaceCenter=function(x){function B(u){u=x.call(this,u)||this;u.location=null;u._updateController=null;u._handles=new l;return u}b._inheritsLoose(B,x);var q=B.prototype;q.initialize=function(){this.view.state.isLocal&&(this._handles.add([g.watch(()=>{var u,C;return[null==(u=this.surfaceView)?void 0:u.spatialReference,null==(C=this.surfaceView)?void 0:C.extent]},()=>this._update()),g.on(()=>{var u;return null==(u=this.surface)?void 0:u.layers},"change",
()=>this._update())]),this._update())};q.destroy=function(){this._handles.destroy()};q._update=function(){this._updateController&&(this._updateController.abort(),this._updateController=null);if(this.surfaceView&&!r.isNone(this.surfaceView.extent)&&this.surfaceView.spatialReference){var u=t.center(this.surfaceView.extent);u=new w({x:u[0],y:u[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updateController=new AbortController,
this.surface.queryElevation(u,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(C=>{this._updateController=null;this._set("location",C.geometry)}).catch(C=>{n.isAbortError(C)||C&&"elevation-query:invalid-layer"===C.name||console.error("StableSurfaceCenter failed to update: ",C)})):this._set("location",u)}else this._set("location",null)};b._createClass(B,[{key:"renderLocation",get:function(){if(!this.location)return null;const u=v.create();this.view.renderCoordsHelper.toRenderCoords(this.location,
u);return u}}]);return B}(m);c.__decorate([k.property({constructOnly:!0})],a.StableSurfaceCenter.prototype,"view",void 0);c.__decorate([k.property({constructOnly:!0})],a.StableSurfaceCenter.prototype,"cache",void 0);c.__decorate([k.property({readOnly:!0,aliasOf:"view.map.ground"})],a.StableSurfaceCenter.prototype,"surface",void 0);c.__decorate([k.property({readOnly:!0,aliasOf:"view.basemapTerrain"})],a.StableSurfaceCenter.prototype,"surfaceView",void 0);c.__decorate([k.property({readOnly:!0})],a.StableSurfaceCenter.prototype,
"location",void 0);c.__decorate([k.property({readOnly:!0})],a.StableSurfaceCenter.prototype,"renderLocation",null);a.StableSurfaceCenter=c.__decorate([h.subclass("esri.views.3d.terrain.StableSurfaceCenter")],a.StableSurfaceCenter);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../support/Scheduler".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w){a.SurfaceGeometryUpdates=function(u){function C(){var A=u.apply(this,arguments)||this;A.handles=new r;A._tileGeometryUpdateExtent=v.empty();A._tileGeometryUpdateSpatialReference=null;A.events=new l;A.updating=!1;return A}b._inheritsLoose(C,u);var z=C.prototype;z.initialize=function(){this.handles.add([this.surface.on("elevation-change",A=>this._tileGeometryChanged(A)),this.scheduler.registerTask(w.TaskPriority.SURFACE_GEOMETRY_UPDATES,this)])};z.destroy=function(){this.handles=
n.destroyMaybe(this.handles)};z.runTask=function(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",t),v.empty(this._tileGeometryUpdateExtent),this._set("updating",!1))};z._tileGeometryChanged=function(A){this._tileGeometryUpdateSpatialReference=A.spatialReference;v.expand(this._tileGeometryUpdateExtent,A.tile.extent,this._tileGeometryUpdateExtent);this._set("updating",!0)};z._furthestCenterOnSurface=
function(){let A=this.centerOnSurfaces[0];for(let p=1;p<this.centerOnSurfaces.length;p++){const y=this.centerOnSurfaces[p];y.distance>A.distance&&(A=y)}return A};z._centerIntersectsExtent=function(A,p){const y=this.state.camera.eye,D=q,E=this._furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(y,x,p);this.renderCoordsHelper.fromRenderCoords(E.renderLocation,B,p);x[0]<B[0]?(D[0]=x[0],D[2]=B[0]):(D[0]=B[0],D[2]=x[0]);x[1]<B[1]?(D[1]=x[1],D[3]=B[1]):(D[1]=B[1],D[3]=x[1]);return v.intersects(D,
A)};b._createClass(C,[{key:"running",get:function(){return this.updating}}]);return C}(m);c.__decorate([g.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"state",void 0);c.__decorate([g.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"centerOnSurfaces",void 0);c.__decorate([g.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"renderCoordsHelper",void 0);c.__decorate([g.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"scheduler",void 0);
c.__decorate([g.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"surface",void 0);c.__decorate([g.property({readOnly:!0})],a.SurfaceGeometryUpdates.prototype,"updating",void 0);a.SurfaceGeometryUpdates=c.__decorate([e.subclass("esri.views.3d.support.SurfaceGeometryUpdates")],a.SurfaceGeometryUpdates);const t={},x=h.create(),B=h.create(),q=v.empty();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TerrainSurface":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/Evented ../../../core/Handles ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/aliasOf ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../core/support/WatchUpdatingTracking ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/spatialReferenceUtils ../../../layers/mixins/RefreshableLayer ../../../layers/support/ElevationQueryTileCache ../../../layers/support/layerUtils ../../../layers/support/LercDecoder ../../2d/engine/vectorTiles/VectorTile ../support/cameraUtils ../support/debugFlags ../support/extentUtils ../support/index ../support/updatingProperties ./ElevationBounds ./ElevationData ./ExtentHelper ./interfaces ./LayerClass ./OverlayManager ./PlanarPatch ./RenderOrder ./SphericalPatch ./TerrainConst ./TerrainRenderer ./TerrainSurfacePerformanceInfo ./terrainUtils ./Tile ./TilePerLayerInfo ./TileUpdate ./tileUtils ./TilingSchemeLogic ./UpsampleInfo ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/lib/basicInterfaces ../../support/Scheduler".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N,M,L,J,H,I,O,Q,S,T,U,aa,W,R,V,da,ca,ha,ia,ka,la,Y,ea,ba,Z,fa,ja,oa,sa,qa,Ha,Ga,pa){function Da(Xa,ma){return Xa[0]===ma[0]&&Xa[1]===ma[1]&&Xa[2]===ma[2]}function ra(Xa){return Xa.isLeaf?!1:Xa.children.some(ma=>ma.shouldLoad)||Xa.children.some(ma=>ra(ma))}const Ea=f.getLogger("esri.views.3d.terrain.TerrainSurface");l=function(Xa){function ma(xa){var Ka,Oa;var Va=Xa.call(this,xa)||this;Va._elevationBounds=new aa.ElevationBounds;
Va._iteratorPool=new h(oa.IteratorPreorder,Ra=>Ra.remove=()=>Va._iteratorPool.release(Ra));Va._postorderIterator=new oa.IteratorPostorder;Va._hasPendingUpdates=!1;Va._pendingUpdates=0;Va._asyncWorkItems=0;Va._allTilesDirty=!0;Va._allTilesSorted=!0;Va._visible=!1;Va._usedMemory=null;Va._performanceInfo=new ea;Va._viewChanged=!1;Va._inFrameTask=!1;Va._viewChangeUpdateDirty=!1;Va._eyePosRenderSR=y.create();Va._eyePosSurfaceSR=y.create();Va._splitLimits=new Z.SplitLimits;Va._snapLevel=Infinity;Va._frustum=
K.create();Va._viewProjectionMatrix=A.create();Va._layerViews=[[],[]];Va._layerIndexByUid=[new Map,new Map];Va._basemapLayerViewHandles=new Map;Va._handles=new k;Va._watchUpdatingTracking=new E.WatchUpdatingTracking;Va._frameTask=pa.ImmediateTask;Va._allTiles=new v;Va._upsampleInfoPool=new h(qa.UpsampleInfo);Va._rootTilesExtent=P.create();Va._maxNumUpdating=1;Va.maxTextureScale=1.2;Va.backgroundColor=null;Va._updatingRootTiles=!1;Va.deferTileNeighborUpdate=!1;Va.neighborTilesToUpdate=new Set;Va.totalGeometryUpdates=
0;Va.totalTileUpdates=0;Va._layerViewsDirty=!1;Va._isGlobal=!(null!=(Ka=xa.view)&&null!=(Oa=Ka.state)&&Oa.isLocal);return Va}b._inheritsLoose(ma,Xa);var $a=ma.prototype;$a.initialize=function(){this._lercDecoder=H.acquireDecoder(this.view.resourceController);this._tilePool=this.view.state.isLocal?new h(ha.PlanarPatch):new h(ka.SphericalPatch);var xa=this.view.resourceController.memoryController;this._upsampleMapCache=xa.newCache("esri.views.3d.terrain.upsample",Ka=>Ka.unloadMapData());this._elevationQueryCache=
new L.ElevationQueryTileCache(xa.newCache("elevation-query"));this._set("overlayManager",new ca.OverlayManager({surface:this}));this._handles.add([t.watch(()=>this.overlayManager.hasHighlights,Ka=>this._renderer.setNeedsHighlight(Ka)),t.watch(()=>this.overlayManager.rendersOccluded,Ka=>this._renderer.setRenderOccludedOverlay(Ka))],"overlayManager");this._renderer=new Y({overlayRenderer:this.overlayManager.renderer,ellipsoidRadius:G.getReferenceEllipsoid(this.view.spatialReference).radius,stage:this.view._stage,
allTiles:this._allTiles});this._handles.add([t.watch(()=>this.baseOpacity,Ka=>{this._handleLayerViewChanges();this._updateBaseOpacity(Ka)},t.syncAndInitial),t.watch(()=>this.hasCompositeBlendMode,()=>{this._updateBaseOpacity(this.baseOpacity)},t.syncAndInitial),t.watch(()=>this.renderingDisabled,()=>this._updateTransparentTerrain(),t.sync),t.watch(()=>this.backgroundColor,Ka=>{this._handleLayerViewChanges();this._renderer.updateTileBackground(Ka)},t.syncAndInitial),t.watch(()=>this.view.pointsOfInterest,
Ka=>{this._renderer.pointsOfInterest=Ka;this._watchUpdatingTracking.removeAll();Ka&&this._watchUpdatingTracking.add(()=>Ka.focus.renderLocation,()=>()=>this._allTilesSorted=!1)}),t.watch(()=>Q.TERRAIN_TILE_TREE_SHOW_TILES,Ka=>{Ka&&!this._treeDebugger?(new Promise((Oa,Va)=>a(["../layers/support/TerrainTileTree3DDebugger"],Oa,Va))).then(({TerrainTileTree3DDebugger:Oa})=>{!this._treeDebugger&&Q.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new Oa({view:this.view}))}):Ka||(this._treeDebugger=e.destroyMaybe(this._treeDebugger))},
t.initial)]);this._extentHelper=R.create(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:this.view.spatialReference});xa=this.view.defaultsFromMap?new n({getCollections:()=>{var Ka,Oa,Va;return null==(Ka=this.view)?void 0:null==(Oa=Ka.defaultsFromMap)?void 0:null==(Va=Oa.mapCollections)?void 0:Va.map(({layers:Ra})=>Ra)},getChildrenFunction:Ka=>Ka&&"layers"in Ka?Ka.layers:null}):this.view.map.allLayers;xa=new sa.TilingSchemeLogic({layers:xa,
extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",xa);this._updateTilingScheme();this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(T.ClientType.ELEVATION);this._mapDataRequester=this.view.resourceController.createStreamDataRequester(T.ClientType.BASEMAP);this._frameTask=this.view.resourceController.scheduler.registerTask(pa.TaskPriority.TERRAIN_SURFACE,this);this._handles.add([t.watch(()=>
this._extentHelper.stencilEnabledExtents,Ka=>this._renderer.setStencilEnabledLayerExtents(Ka),t.initial),t.watch(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),t.sync),t.watch(()=>this.extent,()=>this._updateRootTiles(),t.initial),this.view.on("resize",()=>this._viewChangeUpdate()),t.watch(()=>{var Ka,Oa;const Va=this.view,Ra=Va.state;return[this.lodBias,this.lodSnapping,null==(Ka=Va.resourceController)?void 0:null==(Oa=Ka.memoryController)?void 0:Oa.memoryFactor,Ra.camera,
Ra.contentCamera,Ra.fixedContentCamera]},()=>this._viewChangeUpdate(),t.syncAndInitial),t.watch(()=>{var Ka,Oa;return null==(Ka=this.view.qualitySettings)?void 0:null==(Oa=Ka.tiledSurface)?void 0:Oa.textureFadeDuration},Ka=>this._renderer.textureFadingEnabled=0<Ka,t.initial),t.watch(()=>this._userClippingExtent,()=>this._updateClippingExtent(),t.sync)]);this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0));this._layerViewsDirty=!0;this._handleLayerViewChanges()};
$a.destroy=function(){this._frameTask.remove();this._handles.destroy();this._watchUpdatingTracking.destroy();this._lercDecoder=e.releaseMaybe(this._lercDecoder);this._removeAllTiles();this._upsampleMapCache=e.destroyMaybe(this._upsampleMapCache);this._elevationQueryCache=e.destroyMaybe(this._elevationQueryCache);this._set("tilingSchemeLogic",e.destroyMaybe(this.tilingSchemeLogic));this._extentHelper=e.destroyMaybe(this._extentHelper);this._basemapLayerViewHandles.forEach((xa,Ka)=>this._unregisterTiledLayerView(Ka));
this._mapDataRequester=this._elevationDataRequester=null;this._set("overlayManager",e.destroyMaybe(this.overlayManager));this._tilePool=e.destroyMaybe(this._tilePool);Z.Tile.prune();this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null);this._renderer=e.destroyMaybe(this._renderer);this._iteratorPool=e.destroyMaybe(this._iteratorPool);this._set("view",null);this._upsampleInfoPool=e.destroyMaybe(this._upsampleInfoPool);I.printAllocations();fa.printAllocations()};$a._updateTransparentTerrain=
function(){var xa,Ka;const Oa=!this.renderingDisabled&&!this.opaque;null==(xa=this.view)?void 0:null==(Ka=xa._stage)?void 0:Ka.renderView.setRenderParameters({transparentTerrain:Oa})};$a.intersect=function(xa,Ka,Oa,Va){this._renderer.intersect(xa,Ka,Oa,Va)};$a.getElevation=function(xa,Ka,Oa,Va){xa=this.getTileWithElevation(xa,Ka,Oa,Va,Ia);return e.isNone(xa)?null:W.sampleElevation(Ia[0],Ia[1],xa.renderData.geometryState.samplerData)};$a.getTileWithElevation=function(xa,Ka,Oa,Va,Ra=Ia){var za;const ya=
this.rootTiles;if(e.isNone(ya)||!ya.length||0===ya[0].layerInfo[da.LayerClass.ELEVATION].length)return null;Ra[0]=xa;Ra[1]=Ka;Ra[2]=Oa;if(!F.projectVectorToVector(Ra,Va,Ra,null==(za=this.tilingScheme)?void 0:za.spatialReference))return Ea.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(let Na of ya)if(Na.containsPoint(Ra)){for(;Na&&!Na.rendered&&!Na.isLeaf;)xa=0,Ra[0]>.5*(Na.extent[0]+Na.extent[2])&&(xa+=1),Ra[1]<.5*(Na.extent[1]+Na.extent[3])&&
(xa+=2),Na=Na.children[xa];if((Ra=Na.renderData)&&Ra.geometryState.samplerData)return Na;break}return null};$a.getScale=function(xa){if(this.tilingScheme){if(!F.projectPointToVector(xa,Ia,this.spatialReference))return Ea.error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;xa=this.rootTiles;if(e.isSome(xa))for(let Oa of xa){var Ka;if(null!=(Ka=Oa)&&Ka.containsPoint(Ia)){for(;!Oa.isLeaf&&!Oa.rendered;)Ka=0,Ia[0]>Oa.children[0].extent[2]&&(Ka+=1),
Ia[1]<Oa.children[0].extent[1]&&(Ka+=2),Oa=Oa.children[Ka];return this._getLodBiasCorrectedScale(Oa.level)}}}return 1E100};$a.getSphereElevationBounds=function(xa,Ka,Oa,Va,Ra){var za;Ia[0]=xa;Ia[1]=Ka;Ia[2]=Oa;Ia[3]=Va;if(!F.projectVectorToVector(Ia,Ra,Ia,null==(za=this.tilingScheme)?void 0:za.spatialReference))return Ea.error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let ya=Infinity,Na=-Infinity;const Wa=bb=>{if(bb&&P.intersectsSphere(bb.extent,
Ia))if(bb.isLeaf||bb.rendered)ya=Math.min(ya,bb.elevationBounds[0]),Na=Math.max(Na,bb.elevationBounds[1]);else for(const Aa of bb.children)Wa(Aa)};xa=this.rootTiles;if(e.isSome(xa))for(const bb of xa)Wa(bb);return{min:ya,max:Na}};$a.getSphereScale=function(xa,Ka){if(!this.tilingScheme)return null;if(!F.projectPointToVector(xa,Ia,this.spatialReference))return Ea.error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;Ia[3]=Ka;let Oa=null;const Va=
Ra=>{if(Ra&&P.intersectsSphere(Ra.extent,Ia))if(Ra.isLeaf||Ra.rendered)Ra=this._getLodBiasCorrectedScale(Ra.level),Oa=null==Oa?Ra:Math.min(Oa,Ra);else for(const za of Ra.children)Va(za)};xa=this.rootTiles;if(e.isSome(xa))for(const Ra of xa)Va(Ra);return Oa};$a.queryVisibleScaleRange=function(xa,Ka,Oa,Va){Ka=Ka?this.tilingScheme.levelAtScale(Ka):0;Oa=Oa?this.tilingScheme.levelAtScale(Oa):Infinity;const Ra=this.lodBias;this._renderer.queryVisibleLevelRange(xa,Ka+Ra,Oa+Ra,Va)};$a._updateBaseOpacity=
function(xa){const Ka=this._renderer.opaque;this._renderer.opaque=1<=xa&&!this.hasCompositeBlendMode;this._renderer.isTransparent=this._allSurfaceLayersTransparent();(xa=Ka!==this._renderer.opaque)&&this._updateTransparentTerrain();this._updateTileTextures(xa?V.TextureUpdate.UNFADED:V.TextureUpdate.IMMEDIATE)};$a._updateTilingScheme=function(){var xa,Ka;const Oa=this.tilingSchemeLogic.tilingScheme;Oa!==this.tilingScheme&&(ba.weakAssert(!!Oa,"tiling scheme cannot be reset to undefined"),this._isGlobal=
!(null!=(xa=this.view)&&null!=(Ka=xa.state)&&Ka.isLocal),this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",Oa),this._updateClippingExtent(),Oa&&(this._updateTiledLayers(),this._renderer.setTileSize(Oa.pixelSize),this.overlayManager.setSpatialReference(Oa.spatialReference),this._updateRootTiles()))};$a._acquireTile=function(xa,Ka,Oa,Va){const Ra=this._tilePool.acquire();Qa[0]=xa;Qa[1]=Ka;Qa[2]=Oa;Ra.init(Qa,Va,this);return Ra};$a._updateRootTiles=function(){const {extent:xa,tilingScheme:Ka}=
this;if(Ka){var Oa=Ma,Va=Ka.rootTilesInExtent(xa,Oa,5*la.MAX_ROOT_TILES);if(e.isSome(this.rootTiles)){if(Va.length>la.MAX_ROOT_TILES){Ea.warn(la.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);return}const Ra=this.rootTiles.map(ya=>ya.lij),za=r.difference(Ra,Va,Da);this._updatingRootTiles=!0;if(0<za.removed.length||0<za.added.length){const ya=this.rootTiles.filter(Na=>-1<za.removed.findIndex(Wa=>Da(Wa,Na.lij))?(this._purgeTile(Na,!0),!1):!0);za.added.forEach(Na=>ya.push(this._newRootTile(Na)));this._setRootTiles(ya)}}else this._updatingRootTiles=
!0,Va.length>la.MAX_ROOT_TILES&&(Ea.warn(la.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),Va=Ka.rootTilesInExtent(xa,Oa,la.MAX_ROOT_TILES)),this._setRootTiles(Va.map(Ra=>this._newRootTile(Ra)));P.equals(Oa,this._rootTilesExtent)||(this._rootTilesExtent=P.create(Oa));this.visible=!0;this._viewChangeUpdate();this.overlayManager.setPlacementDirty();this.notifyChange("ready");this._allTiles.forEach(Ra=>{Ra.isLoaded&&this._prepareToLoadTile(Ra)});this._allTiles.forAll(Ra=>{Ra.isLoaded&&(this._updateTileGeometry(Ra),
this._updateTileNeighborsAfterGeometryChange(Ra))});this._updatingRootTiles=!1;this.checkAllTileWaterproofness()}};$a._newRootTile=function(xa){xa=this._acquireTile(0,xa[1],xa[2],null);xa.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===ja.TileUpdate.SPLIT&&xa.setPendingUpdate(ja.TileUpdate.SPLIT);this._loadTile(xa);this.deferTileNeighborUpdate||xa.checkGeometryWaterproofness();return xa};$a._setRootTiles=function(xa){this._set("rootTiles",xa);this._allTiles.clear();if(e.isSome(xa)){const Ka=
this._iteratorPool.acquire();for(Ka.reset(xa);!Ka.done;)this._allTiles.push(Ka.next());Ka.remove()}this._renderer.setRootTiles(this.rootTiles);this._updateTilesVisibility(xa)};$a._runViewChangeUpdateIfDirty=function(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())};$a._viewChangeUpdate=function(){this.view&&!this.suspended&&this.tilingScheme&&this._visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),
this._updateTilesVisibility(this.rootTiles)))};$a._updateClippingStatus=function(xa){xa.updateClippingStatus(this.extent)&&xa.resetPendingUpdate(ja.TileUpdate.GEOMETRY)&&this._updateTileGeometry(xa)};$a._updateTilesVisibility=function(xa){if(!e.isNone(xa)){var Ka=oa.hasLoadableSiblings(xa),Oa=Ka?this._elevationBounds.min:Infinity;Ka=Ka?this._elevationBounds.max:-Infinity;var Va=this.view.state.fixedContentCamera,Ra=this.extent,za=this._viewProjectionMatrix;this.setTileTreeDirty();var ya=this._iteratorPool.acquire();
for(ya.reset(xa);!ya.done;){xa=ya.next();xa.updateClippingStatus(Ra)&&xa.resetPendingUpdate(ja.TileUpdate.GEOMETRY)&&this._updateTileGeometry(xa);xa.setPendingUpdate(ja.TileUpdate.RENDERDATA);const Na=xa.computeVisibility();Va||Na?(xa.updateScreenDepth(za),xa.renderData&&(Oa=Math.min(xa.elevationBounds[0],Oa),Ka=Math.max(xa.elevationBounds[1],Ka))):ya.skipSubtree()}ya.remove();this._allTilesDirty=this._viewChanged=!0;isFinite(Oa)&&isFinite(Ka)&&(this._elevationBounds.min!==Oa||this._elevationBounds.max!==
Ka)&&(this._elevationBounds.min=Oa,this._elevationBounds.max=Ka,this.emit("elevation-bounds-change",null))}};$a._updateViewDependentParameters=function(){const xa=this.view.state.camera,Ka=this.view.state.contentCamera,Oa=Math.tan(.5*Ka.fovX),Va=Math.tan(.5*Ka.fovY),Ra=this.tilingScheme.pixelSize,za=2**-this.lodBias*xa.pixelRatio;this._splitLimits.aboveGround=xa.aboveGround;this._splitLimits.fovX=Oa;this._splitLimits.fovY=Va;this._splitLimits.relativeWidthLimit=Ra/xa.width*this.maxTextureScale*za;
this._splitLimits.relativeHeightLimit=Ra/xa.height*this.maxTextureScale*za;this._splitLimits.maxLod=this.tilingScheme.getMaxLod();this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias;this.view.state.fixedContentCamera?(e.isNone(this._splitLimits.frustum)&&(this._splitLimits.frustum=K.create()),K.copy(this._splitLimits.frustum,Ka.frustum)):this._splitLimits.frustum=null;K.copy(this._frustum,xa.frustum);z.multiply(this._viewProjectionMatrix,Ka.projectionMatrix,Ka.viewMatrix);
p.copy(this._eyePosRenderSR,Ka.eye);F.projectVectorToVector(xa.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)};$a._updateRenderData=function(xa){xa.rendered&&!xa.shouldLoad&&(ra(xa)?(this._loadChildren(xa),this.deferTileNeighborUpdate||(this._checkTileNeighborsWaterproofness(xa),xa.children.forEach(Ka=>Ka.checkGeometryWaterproofness()))):xa.isLeaf&&xa.parent&&xa.parent.shouldLoad&&this._loadParent(xa))};$a._updateTileGeometry=function(xa){xa.updateVisibility();this._renderer.updateTileGeometry(xa);
this._updateTileNeighborsAfterGeometryChange(xa);this._elevationUpdate(xa);this._usedMemory=null;this.deferTileNeighborUpdate&&this.neighborTilesToUpdate.delete(xa)};$a._updateTileNeighborsAfterGeometryChange=function(xa,Ka){if(this.deferTileNeighborUpdate){const Oa=this.neighborTilesToUpdate;xa.forEachLoadedNeighbor(Va=>{Oa.add(Va)})}else xa.updateNeighborsAfterGeometryChange(Ka)};$a._updateTileTexture=function(xa,Ka){const Oa=xa.resetPendingUpdate(ja.TileUpdate.TEXTURE_FADING)?ja.TileUpdate.TEXTURE_FADING:
xa.resetPendingUpdate(ja.TileUpdate.TEXTURE_NOFADING)?ja.TileUpdate.TEXTURE_NOFADING:!1;Oa&&(this._renderer.updateTileTexture(xa,Oa),this._usedMemory=null,Ka.madeProgress())};$a._elevationUpdate=function(xa){Ja.spatialReference=this.spatialReference;Ja.tile=xa;Ja.extent=xa.extent;this.emit("elevation-change",Ja)};$a.runTask=function(xa){this._handleLayerViewChanges(xa);this._frameTask.processQueue(xa);this._inFrameTask=!0;this._pendingUpdates=0;this._hasPendingUpdates=!1;this._updateTileStatus(xa);
this._sortTiles(xa);const Ka=!this.view.state.fixedContentCamera;this._mergeAndSplit(xa,Ka);xa.run(()=>this._updateElevation(xa));xa.run(()=>this._updateTextures(xa));Ka||this._mergeAndSplit(xa,!0);this._inFrameTask=!1;this._runViewChangeUpdateIfDirty();xa.done?this.requestUpdate():this._usedMemory=this._recalculateUsedMemory();this.notifyChange("updatingProgressValue")};$a._updateTileStatus=function(xa){if(this._viewChanged&&this.rootTiles&&!xa.done){this._viewChanged=!1;var Ka=this._iteratorPool.acquire();
for(Ka.reset(this.rootTiles);!Ka.done;){var Oa=Ka.next();if(Oa.loadable){var Va=Oa.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping);if(Va===ja.TileUpdate.SPLIT){Oa.resetPendingUpdate(ja.TileUpdate.MERGE);Oa.isLeaf&&(Oa.setPendingUpdate(ja.TileUpdate.SPLIT),Ka.skipSubtree());continue}Oa.resetPendingUpdate(ja.TileUpdate.SPLIT)&&Oa.updateAgentSuspension();Va===ja.TileUpdate.VSPLITMERGE&&Oa.updateAgents(da.LayerClass.ELEVATION)}Ka.skipSubtree();if(!Oa.isLeaf){Oa.setPendingUpdate(ja.TileUpdate.MERGE);
Oa.resetPendingUpdate(ja.TileUpdate.SPLIT);Va=this._iteratorPool.acquire();Va.resetOne(Oa);for(Oa=Va.next();!Va.done;Oa=Va.next())this._updateClippingStatus(Oa),Oa.updateVisibility(),Oa.loadable&&Oa.updateScreenDepth(this._viewProjectionMatrix);Va.remove()}}Ka.remove();this.requestUpdate();xa.madeProgress()}};$a._sortTiles=function(xa){xa.done||this._allTilesSorted||(oa.sortTilesByPOI(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),
xa.madeProgress())};$a._prepareBatchTileGeometryUpdate=function(){ba.internalAssert(0===this.neighborTilesToUpdate.size);this.deferTileNeighborUpdate=!0};$a._batchUpdateUpdatedTileNeighbors=function(){this.deferTileNeighborUpdate=!1;const xa=this.neighborTilesToUpdate;(()=>{(()=>{for(const Ka of xa)Ka.updateNeighborDataAndGeometryIfNeeded()})();(()=>{for(const Ka of xa)Ka.updateNeighborsWithChangedEdgeResolution()})();xa.clear()})()};$a._mergeAndSplit=function(xa,Ka){if(!this.suspended&&!xa.done&&
this._allTilesDirty){this._allTilesDirty=!1;this.requestUpdate();this._prepareBatchTileGeometryUpdate();for(var Oa=!1;!xa.done;){Oa=!0;let Va=!1;const Ra=!this._allTiles.some(za=>{if(za.resetPendingUpdate(ja.TileUpdate.MERGE)){if(!Ka)return za.setPendingUpdate(ja.TileUpdate.MERGE),xa.done;this._mergeTile(za);Va=!0;xa.madeProgress()}else za.resetPendingUpdate(ja.TileUpdate.SPLIT)&&(this._splitTile(za),Va=!0,xa.madeProgress());!xa.done&&za.resetPendingUpdate(ja.TileUpdate.RENDERDATA)&&(this._updateRenderData(za),
xa.madeProgress());return xa.done});Va&&(this._allTilesSorted=!1,this._allTilesDirty=!0);if(Ra){if(!Va)break;this._updateTilesVisibility(this.rootTiles)}else this._allTilesDirty=!0}Oa||(this._allTilesDirty=!0);this._batchUpdateUpdatedTileNeighbors();this._sortTiles(xa)}};$a._updateElevation=function(xa){this._prepareBatchTileGeometryUpdate();this._allTiles.some(Ka=>{Ka.resetPendingUpdate(ja.TileUpdate.GEOMETRY)&&(this._updateTileGeometry(Ka),this._updateTileTexture(Ka,xa),xa.madeProgress());return xa.done});
this._batchUpdateUpdatedTileNeighbors();return xa.hasProgressed};$a._updateTextures=function(xa){this._allTiles.some(Ka=>{this._updateTileTexture(Ka,xa);return xa.done});return xa.hasProgressed};$a._updateClippingExtent=function(){this.spatialReference&&(this.updateTileOverlayParams(Ga.RenderRequestType.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())};$a._getLodBiasCorrectedScale=function(xa){const Ka=this.tilingScheme.levels;xa=d.clamp(xa-this.lodBias,0,Ka.length-1);const Oa=
xa-Math.floor(xa);return Ka[Math.floor(xa)].scale*(1-Oa)+Ka[Math.ceil(xa)].scale*Oa};$a._removeAllTiles=function(){e.isSome(this.rootTiles)&&(this.rootTiles.forEach(xa=>this._purgeTile(xa,!1)),this._setRootTiles(null),this.notifyChange("ready"));this._allTiles.clear();this.visible=!1};$a._purgeDescendantTiles=function(xa){if(xa.isLeaf)return!1;let Ka=!1;for(let Oa=0;4>Oa;++Oa)Ka=this._purgeTile(xa.children[Oa],!1)||Ka;xa.unsetChildren();return Ka};$a._purgeTile=function(xa,Ka){const Oa=this._purgeDescendantTiles(xa)||
xa.rendered;this._allTiles.removeUnordered(xa);this._unloadTile(xa);Ka&&this._updateTileNeighborsAfterGeometryChange(xa);this._tilePool.release(xa);return Oa};$a._unloadTile=function(xa){this.deferTileNeighborUpdate&&this.neighborTilesToUpdate.delete(xa);xa.unload(this._renderer)};$a._splitTile=function(xa){ba.weakAssert(xa.isLeaf,"tile that is already split should not be split again!");const Ka=xa.level+1,Oa=2*xa.lij[1],Va=2*xa.lij[2];xa.setChildren(this._createTile(Ka,Oa,Va,xa),this._createTile(Ka,
Oa,Va+1,xa),this._createTile(Ka,Oa+1,Va,xa),this._createTile(Ka,Oa+1,Va+1,xa));xa.setPendingUpdate(ja.TileUpdate.RENDERDATA);xa.updateAgentSuspension();this._allTiles.pushArray(xa.children);this._allTilesDirty=!0;this._emitTileScaleChange(xa,Ka);++this._performanceInfo.numSplit};$a._emitTileScaleChange=function(xa,Ka=xa.level){Ta.spatialReference=this.spatialReference;Ta.extent=xa.extent;Ta.scale=this._getLodBiasCorrectedScale(Ka);this.emit("scale-change",Ta)};$a._createTile=function(xa,Ka,Oa,Va){ba.weakAssert(!!Va,
"_createTile sanity check");xa=this._acquireTile(xa,Ka,Oa,Va);xa.updateClippingStatus(this.extent);xa.loadable&&(xa.updateScreenDepth(this._viewProjectionMatrix),xa.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===ja.TileUpdate.SPLIT&&xa.setPendingUpdate(ja.TileUpdate.SPLIT));return xa};$a._mergeTile=function(xa){ba.weakAssert(!xa.hasPendingUpdate(ja.TileUpdate.SPLIT),"_mergeTile sanity check");this._purgeDescendantTiles(xa)&&(ba.weakAssert(!xa.renderData,"_mergeTile sanity check"),
this._loadTile(xa),this._updateTileNeighborsAfterGeometryChange(xa),this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(xa));this._allTilesDirty=!0;++this._performanceInfo.numMerged;this._emitTileScaleChange(xa)};$a._checkTileAndNeighborsWaterproofness=function(xa){xa.checkGeometryWaterproofness();this._checkTileNeighborsWaterproofness(xa)};$a._checkTileNeighborsWaterproofness=function(xa){ba.ENABLE_WATERPROOFNESS_TESTS&&xa.forallNeighbors(Ka=>Ka.isLoaded?(Ka.checkGeometryWaterproofness(),
!0):!1)};$a._loadChildren=function(xa){this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(xa);ba.weakAssert(xa.rendered,"parent should be rendered");this._unloadTile(xa);const Ka=xa.children;Ka.forEach(Oa=>this._prepareToLoadTile(Oa));Ka.forEach(Oa=>this._loadTilePrepared(Oa));this._updateTileNeighborsAfterGeometryChange(xa,xa.level+1);this.deferTileNeighborUpdate||(Ka.forEach(Oa=>Oa.updateNeighborsWithChangedEdgeResolution()),Ka.forEach(Oa=>Oa.checkGeometryWaterproofness()),
this._checkTileNeighborsWaterproofness(xa))};$a._loadParent=function(xa){this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(xa);xa=xa.parent;this._unloadChildren(xa);this._loadTile(xa);this._updateTileNeighborsAfterGeometryChange(xa);this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(xa)};$a._unloadChildren=function(xa){if(!xa.isLeaf)for(let Ka=0;4>Ka;++Ka){const Oa=xa.children[Ka];this._unloadChildren(Oa);this._unloadTile(Oa)}};$a._postLoadTile=function(xa){xa.setPendingUpdate(ja.TileUpdate.RENDERDATA);
this.requestUpdate();this._allTilesDirty=!0;this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(xa);this._elevationUpdate(xa)};$a._loadTile=function(xa){xa.load(this._renderer);this._postLoadTile(xa)};$a._loadTilePrepared=function(xa){xa.loadPrepared(this._renderer);this._postLoadTile(xa)};$a._prepareToLoadTile=function(xa){xa.prepareToLoad(this._renderer)};$a._elevationDataArrived=function(xa,Ka,Oa){Oa=new W.ElevationData(xa.lij,xa.extent,Oa);xa.dataArrived(Ka,
da.LayerClass.ELEVATION,Oa);Oa=[xa];xa=xa.level;const Va=this._iteratorPool.acquire();for(Va.reset(Oa);!Va.done;){const Ra=Va.next();Ra.findElevationBoundsForLayer(Ka,xa);Ra.computeElevationBounds()}Va.remove();this._updateTilesVisibility(Oa)};$a._handleLayerViewChanges=function(xa=pa.noBudget){if(this._layerViewsDirty){var Ka=this._layerViewsDirty=!1,Oa=new Set,Va=-1;for(const za of this.view.allLayerViews.items)if(Oa.add(za.uid),ba.isSurfaceLayerView(za))if(this._basemapLayerViewHandles.has(za.uid)){var Ra=
this._layerClassFromLayerView(za);Ra=this._getLayerIdxByUID(Ra,za.uid);if(e.isSome(Ra)){if(Ra<Va||e.isNone(Va))Ka=!0;Va=Ra}}else this._registerTiledLayerView(za),za.layer.loaded&&(Ka=!0);this._basemapLayerViewHandles.forEach((za,ya)=>{Oa.has(ya)||(this._unregisterTiledLayerView(ya),Ka=!0)});Ka&&this._updateTiledLayers();this._renderer.isTransparent=this._allSurfaceLayersTransparent();this.hasCompositeBlendMode=this._hasCompositeBlendMode();xa.madeProgress()}};$a._allSurfaceLayersTransparent=function(){var xa,
Ka;let Oa=0===(null==(xa=this.view.map)?void 0:null==(Ka=xa.ground)?void 0:Ka.opacity);for(const Va of this.view.allLayerViews.items)if(ba.isMapTileLayerView(Va)&&!J.isBaseLayer(Va.layer)&&0!==Va.fullOpacity){Oa=!1;break}return Oa};$a._hasCompositeBlendMode=function(){for(const xa of this.view.allLayerViews.items)if(ba.isBlendableLayerView(xa)){const Ka=ba.isGroupLayer(xa.layer.parent)?"normal":xa.layer.blendMode;if(Ha.isCompositeBlendMode(Ha.blendModeFromString[Ka]))return!0}return!1};$a._layerClassFromLayerView=
function(xa){return ba.isElevationLayerView(xa)?da.LayerClass.ELEVATION:da.LayerClass.MAP};$a._registerTiledLayerView=function(xa){const Ka=[],Oa=this._layerClassFromLayerView(xa);Ka.push(t.watch(()=>xa.suspended,()=>this._updateTiledLayers()));Ka.push(t.watch(()=>xa.fullOpacity,()=>this._updateTileTextures(V.TextureUpdate.UNFADED)));Ka.push(t.watch(()=>"effectiveScaleRange"in xa.layer?xa.layer.effectiveScaleRange:null,()=>this._restartAllAgents(Oa)));ba.isBlendableLayerView(xa)&&Ka.push(t.watch(()=>
xa.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode();this._updateTileTextures(V.TextureUpdate.UNFADED)}));xa.on("data-changed",()=>{const Va=this._getLayerIdxByUID(Oa,xa.uid);e.isSome(Va)&&this._invalidateLayerData(Va,Oa)});this._basemapLayerViewHandles.set(xa.uid,Ka)};$a._unregisterTiledLayerView=function(xa){const Ka=this._basemapLayerViewHandles.get(xa);if(Ka){for(let Oa=0;Oa<Ka.length;Oa++)Ka[Oa].remove();this._basemapLayerViewHandles.delete(xa)}};$a._updateTiledLayers=
function(){if(this.tilingScheme&&!this.view.suspended){var xa=[[],[]],Ka=null;this.view.allLayerViews.forEach(Va=>{if(Va.layer&&!Va.suspended&&ba.isSurfaceLayerView(Va)&&Va.fullExtent){var Ra=this._layerClassFromLayerView(Va);if(Ra===da.LayerClass.MAP){const za=Va.displayLevelRange.maxLevel;Infinity!==za&&(null===Ka||za>Ka)&&(Ka=za)}xa[Ra].push(Va)}});for(const Va of da.LayerClasses){var Oa=this._layerViews[Va];const Ra=xa[Va];Ra.reverse();const za=Ra.length;let ya=Oa.length!==za;const Na=Array(za),
Wa=Array(Oa.length);this._layerIndexByUid[Va].clear();for(let bb=0;bb<za;bb++){this._layerIndexByUid[Va].set(Ra[bb].uid,bb);const Aa=Oa.indexOf(Ra[bb]);Na[bb]=Aa;bb!==Aa&&(ya=!0);-1<Aa&&(Wa[Aa]=bb)}if(ya){Oa=this._postorderIterator;for(Oa.reset(this.rootTiles);!Oa.done;)Oa.next().modifyLayers(Wa,Na,Va);this._layerViews[Va]=Ra;this._restartAllAgents(Va);this._updateTilesVisibility(this.rootTiles)}}this.tilingScheme.ensureMaxLod(Ka)&&this._viewChangeUpdate()}};$a._restartAllAgents=function(xa){const Ka=
this._postorderIterator;for(Ka.reset(this.rootTiles);!Ka.done;){const Oa=Ka.next();Oa.restartAgents(xa);xa===da.LayerClass.ELEVATION&&Oa.computeElevationBounds()}};$a.layerViewByIndex=function(xa,Ka){return this._layerViews[Ka][xa]};$a.numLayers=function(xa){return this._layerViews[xa].length};$a._updateTileTextures=function(xa){this._allTiles.forAll(Ka=>{Ka.updateAgents(da.LayerClass.MAP);xa===V.TextureUpdate.IMMEDIATE?this.renderer.updateTileTexture(Ka,ja.TileUpdate.TEXTURE_NOFADING):Ka.updateRenderData(da.LayerClass.MAP,
xa)});this._renderer.isTransparent=this._allSurfaceLayersTransparent()};$a._invalidateLayerData=function(xa,Ka){this._allTiles.forAll(Oa=>Oa.removeLayerAgent(xa,Ka));this._allTiles.forAll(Oa=>Oa.invalidateLayerData(xa,Ka))};$a.setTileTreeDirty=function(){this._allTilesDirty=!0};$a.requestRender=function(xa=Ga.RenderRequestType.UPDATE){this.renderer.setNeedsRender(xa)};$a.requestUpdate=function(){1===++this._pendingUpdates&&(this._hasPendingUpdates=!0)};$a.requestTileData=function(xa,Ka,Oa,Va){const Ra=
this.layerViewByIndex(Ka,Oa);Ka=Ra.layer;if(!Ka.tilemapCache||ba.isVectorTileLayerView(Ra))return this._requestTileData(xa,Oa,Ra,Va);++this._asyncWorkItems;return Ka.tilemapCache.fetchAvailability(xa.lij[0],xa.lij[1],xa.lij[2],{...Va,timeout:6E3}).then(()=>--this._asyncWorkItems).catch(za=>{--this._asyncWorkItems;w.isAbortError(za)||this._dataMissing(xa,Oa,Ra,{notInTilemap:!0});throw za;}).then(()=>this._frameTask.schedule(()=>this._requestTileData(xa,Oa,Ra,Va),Va.signal))};$a._requestTileData=function(xa,
Ka,Oa,Va){return Ka===da.LayerClass.ELEVATION?ba.isElevationLayerView(Oa)?this._requestElevationTileData(xa,Oa,Va):Promise.reject():ba.isMapTileLayerView(Oa)?this._requestMapTileData(xa,Oa,Va):Promise.reject()};$a._requestElevationTileData=function(xa,Ka,Oa){++this._asyncWorkItems;const Va=ya=>{if(!w.isAborted(Oa)){var Na=this._layerIndexByUid[da.LayerClass.ELEVATION].get(Ka.uid);null==Na?Ea.warn("TerrainSurface: received data from unknown layer %d %s",da.LayerClass.ELEVATION,xa.lij.toString()):(this._usedMemory=
null,this.requestUpdate(),this._elevationDataArrived(xa,Na,ya))}},Ra=ya=>{w.isAbortError(ya)||(this._dataMissing(xa,da.LayerClass.ELEVATION,Ka,ya),this.requestUpdate())};if(ba.useFetchTileForLayer(Ka.layer))return Ka.layer.fetchTile(xa.lij[0],xa.lij[1],xa.lij[2],{noDataValue:la.ELEVATION_NODATA_VALUE,signal:Oa.signal}).then(ya=>{if(w.isAborted(Oa))Ea.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.");else return this._frameTask.schedule(()=>
Va(ya),Oa.signal,Ra)},Ra).finally(()=>{--this._asyncWorkItems});const za=Ka.getTileUrl(xa.lij[0],xa.lij[1],xa.lij[2]);return this._elevationDataRequester.request(za,"binary",Oa).then(ya=>this._lercDecoder.decode(ya,{noDataValue:la.ELEVATION_NODATA_VALUE},Oa.signal)).then(ya=>{ya?Va({values:ya.pixelData,width:ya.width,height:ya.height,noDataValue:ya.noDataValue,minValue:ya.minValue,maxValue:ya.maxValue}):Ra(Error("LERC decoding failed"))},Ra).finally(()=>{--this._asyncWorkItems})};$a._requestMapTileData=
function(xa,Ka,Oa){++this._asyncWorkItems;const Va=(Wa,bb)=>{--this._asyncWorkItems;ba.releaseTileData(bb);w.isAborted(Oa)||(this._dataMissing(xa,da.LayerClass.MAP,Ka,Wa),this.requestUpdate())},Ra=Wa=>bb=>Va(bb,Wa),za=Wa=>this._frameTask.schedule(()=>{--this._asyncWorkItems;this.requestUpdate();w.isAborted(Oa)?ba.releaseTileData(Wa):this._mapTileDataArrived(xa,Ka,Wa)},Oa.signal,Ra(Wa)).catch(Ra(Wa)),ya=(Wa,bb=null)=>this._frameTask.schedule(()=>Va(Wa,bb));if(ba.isVectorTileLayerView(Ka)){var Na=Ka.schemaHelper.getLevelRowColumn(xa.lij);
return Ka.fetchTile(Na[0],Na[1],Na[2],Oa).then(za,ya)}if(ba.isImageryTileLayerView(Ka))return Ka.fetchTile(xa.lij[0],xa.lij[1],xa.lij[2],Oa).then(za,ya);if(ba.isTileLayerView(Ka)&&ba.useFetchTileForLayer(Ka.layer))return Ka.layer.fetchTile(xa.lij[0],xa.lij[1],xa.lij[2],Oa).then(Wa=>{w.isAborted(Oa)?(Ea.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),ya(w.createAbortError())):za(Wa)},ya);Na=Ka.getTileUrl(xa.lij[0],
xa.lij[1],xa.lij[2]);M.isRefreshableLayer(Ka.layer)&&Ka.layer.refreshTimestamp&&(Na+=`${Na.includes("?")?"\x26":"?"}_ts=${Ka.layer.refreshTimestamp}`);return this._mapDataRequester.request(Na,Ka.hasMixedImageFormats?"image+type":"image",Oa).then(za,ya)};$a._mapTileDataArrived=function(xa,Ka,Oa){Ka=this._getLayerIdxByUID(da.LayerClass.MAP,Ka.uid);e.isSome(Ka)?xa.dataArrived(Ka,da.LayerClass.MAP,Oa):(ba.releaseTileData(Oa),Ea.warn("TerrainSurface: received data from unknown layer"))};$a._getLayerIdxByUID=
function(xa,Ka){return this._layerIndexByUid[xa].get(Ka)};$a._dataMissing=function(xa,Ka,Oa,Va){Oa=this._getLayerIdxByUID(Ka,Oa.uid);e.isSome(Oa)?xa.dataMissing(Oa,Ka,Va):Ea.warn("TerrainSurface: received data from unknown layer")};$a.updateTileOverlayParams=function(xa){this.rootTiles&&this.overlayManager&&(this._allTiles.forAll(Ka=>{Ka.renderData&&this.overlayManager.setTileParameters(Ka)}),this._renderer.setNeedsRender(xa))};$a.getUsedMemory=function(){if(!this.tilingScheme)return 0;e.isNone(this._usedMemory)&&
(this._usedMemory=this._recalculateUsedMemory());return e.isSome(this._usedMemory)?this._usedMemory:0};$a._recalculateUsedMemory=function(){return this.tilingScheme?this._allTiles.reduce((xa,Ka)=>xa+Ka.usedMemory,0):null};$a.getUsedMemoryForLayerView=function(xa){let Ka=0;const Oa=this._layerClassFromLayerView(xa),Va=this._getLayerIdxByUID(Oa,xa.uid);e.isSome(Va)&&this._allTiles.forAll(Ra=>Ka+=Ra.getUsedMemoryForLayer(Oa,Va));return Ka};$a.getTile=function(xa){if(e.isNone(xa)||e.isNone(this.rootTiles))return null;
const Ka=xa.split("/").map(za=>+za);if(0===Ka[0])return this.rootTiles.find(za=>za.lij[1]===Ka[1]&&za.lij[2]===Ka[2]);xa=2**Ka[0];const Oa=Math.floor(Ka[1]/xa),Va=Math.floor(Ka[2]/xa);let Ra;this.rootTiles.some(za=>za.lij[1]===Oa&&za.lij[2]===Va?(Ra=za,!0):!1);if(Ra){for(xa=1<<Ka[0]-1;Ra.lij[0]<Ka[0];){let za=Ka[1]&xa?2:0;0<(Ka[2]&xa)&&za++;if(!Ra.children[za])return null;Ra=Ra.children[za];xa>>=1}ba.weakAssert(Ra.lij[0]===Ka[0]&&Ra.lij[1]===Ka[1]&&Ra.lij[2]===Ka[2],"not the right tile?");return Ra}return null};
$a.checkAllTileWaterproofness=function(){if(ba.ENABLE_WATERPROOFNESS_TESTS){var xa=this.rootTiles;if(!e.isNone(xa)){var Ka=Ra=>{var za,ya,Na,Wa;return null!=(za=0<(null==Ra?void 0:null==(ya=Ra.renderData)?void 0:null==(Na=ya.geometryInfo)?void 0:null==(Wa=Na.indices)?void 0:Wa.length))?za:!1},Oa=Ra=>{var za,ya,Na;Ra.renderData&&!Ra.renderData.geometryState&&console.error("Tile[",Ra.lij,"] has renderData but not geometryState");Ra.renderData&&!Ra.renderData.geometryInfo&&console.error("Tile[",Ra.lij,
"] has renderData but not geometryInfo");null==(za=Ra.renderData)||!za.geometryInfo||0<(null!=(ya=null==(Na=Ra.renderData.geometryInfo.indices)?void 0:Na.length)?ya:0)||console.error("Tile[",Ra.lij,"] has renderData but no indices - geometryInfo: ",Ra.renderData.geometryInfo);if(Ka(Ra)){Ra.checkGeometryWaterproofness();for(const Wa of Ra.children)za=Wa,ya=Ra,Ka(za)&&console.error("Tile[",za.lij,"] has geometry although parent[",ya.lij,"] has geom")}else if(Ra.isLeaf)console.error("Tile[",Ra.lij,"] has no geometry and no children, from root to leaf");
else for(const Wa of Ra.children)Oa(Wa)},Va=Ra=>{var za,ya;const Na=null!=(za=null==(ya=Ra.parent)?void 0:ya.visible)?za:!0;za=Ra.visible;Ra.computeVisibility();ya=Ra.visible;za!==ya&&Na&&console.error(" Tile[",Ra.lij,"] has out of date visibility: ",za," instead of ",ya);if(!Ra.isLeaf)for(const Wa of Ra.children)Va(Wa)};for(const Ra of xa)Oa(Ra),Va(Ra)}}};$a.isEastEndWrap=function(xa){return this.isGlobal&&xa[2]===this.lijEastEnd(xa[0])-1};$a.isWestEndWrap=function(xa){return this.isGlobal&&0===
xa[2]};$a.lijEastEnd=function(xa){return 2**(xa+(this.spatialReference.isGeographic?1:0))};$a.wrapEastWest=function(xa){const Ka=this.lijEastEnd(xa[0]),Oa=xa[2];return 0<=Oa&&Oa<Ka?xa:this.isGlobal?[xa[0],xa[1],(Oa+(0>Oa?Ka:0))%Ka]:null};b._createClass(ma,[{key:"renderer",get:function(){return this._renderer}},{key:"frustum",get:function(){return this._frustum}},{key:"snapLevel",get:function(){var xa,Ka,Oa=null==(xa=this.view.pointsOfInterest)?void 0:null==(Ka=xa.contentCameraOnSurface)?void 0:Ka.scale;
Oa&&(xa=this.view.state.contentCamera,xa=O.directionToHeadingTilt(this.view,xa.eye,xa.viewForward,xa.up).tilt,90<xa&&(xa=180-xa),xa=2*(xa/90)**2,Oa=O.scaleToZoom(this.view,Oa)-xa,.25<Math.abs(this._snapLevel-Oa)&&(Math.round(Oa)!==Math.round(this._snapLevel)&&(this._viewChanged=!0),this._snapLevel=Oa));return Math.round(this._snapLevel)}},{key:"lodSnapping",get:function(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?V.LODSnapping.ON:V.LODSnapping.OFF}},{key:"upsampleInfoPool",
get:function(){return this._upsampleInfoPool}},{key:"upsampleMapCache",get:function(){return this._upsampleMapCache}},{key:"elevationQueryCache",get:function(){return this._elevationQueryCache}},{key:"mapTileRequester",get:function(){return this._mapDataRequester}},{key:"_userClippingExtent",get:function(){var {spatialReference:xa}=this,{clippingArea:Ka}=this.view;if(e.isNone(Ka)||e.isNone(xa))return null;const Oa=P.create();xa=S.toBoundingRect(Ka,Oa,xa)?Oa:null;Ka=this._get("extent");return P.equals(xa,
Ka)?Ka:xa}},{key:"rootTilesExtent",get:function(){return this._rootTilesExtent}},{key:"extent",get:function(){const xa=P.intersection(this.groundExtent,this._userClippingExtent,P.create()),Ka=this._get("extent");return P.equals(xa,Ka)?Ka:xa}},{key:"groundExtent",get:function(){return e.isSome(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}},{key:"_tilingSchemeExtent",get:function(){var xa;return null==(xa=this.tilingSchemeLogic)?void 0:xa.extent}},{key:"updating",get:function(){this._hasPendingUpdates||
(this._maxNumUpdating=1);return!!((this._watchUpdatingTracking.updating||this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||0<this._asyncWorkItems||!this._allTilesSorted||this._layerViewsDirty)&&this.ready&&!this.suspended||this.overlayManager.updating||this._frameTask.updating)}},{key:"updatingProgressValue",get:function(){this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating);return 1-this._pendingUpdates/this._maxNumUpdating}},{key:"viewingMode",get:function(){return this.view.state.viewingMode}},
{key:"ready",get:function(){return e.isSome(this.rootTiles)}},{key:"renderOrder",set:function(xa){this._renderer.renderOrder=xa;this._set("renderOrder",xa)}},{key:"spatialReference",get:function(){var xa,Ka;return null!=(xa=null==(Ka=this.tilingScheme)?void 0:Ka.spatialReference)?xa:null}},{key:"slicePlaneEnabled",set:function(xa){this._renderer.slicePlaneEnabled=xa;this._set("slicePlaneEnabled",xa);this._updateTransparentTerrain()}},{key:"velvetOverground",set:function(xa){xa!==this.velvetOverground&&
(this._renderer.velvetOverground=xa);this._set("velvetOverground",xa)}},{key:"visible",set:function(xa){xa!==this._visible&&(this._visible=xa,this._renderer.setVisibility(xa),this.suspended=!xa)}},{key:"opaque",get:function(){return this._renderer.opaque}},{key:"suspended",set:function(xa){this._set("suspended",xa);this._viewChangeUpdate()}},{key:"elevationBounds",get:function(){return this._elevationBounds}},{key:"updatingRootTiles",get:function(){return this._updatingRootTiles}},{key:"running",
get:function(){return this.updating&&this.ready&&!this.suspended}},{key:"lodBias",get:function(){return this.view.qualitySettings.tiledSurface.lodBias-(1-this.view.resourceController.memoryController.memoryFactor)*la.MAX_MEMORY_LOD_BIAS}},{key:"performanceInfo",get:function(){const xa=this._performanceInfo;xa.numNodes=this._allTiles.length;xa.numLeaves=xa.numVisible=xa.numRendered=xa.numLoadedPerLevel.length=xa.numRenderedPerLevel.length=0;this._allTiles.forAll(Ka=>{Ka.isLeaf&&xa.numLeaves++;const Oa=
Ka.level;Ka.renderData&&(xa.numLoadedPerLevel[Oa]=(xa.numLoadedPerLevel[Oa]||0)+1);Ka.visible&&(xa.numVisible++,Ka.rendered&&(xa.numRenderedPerLevel[Oa]=(xa.numRenderedPerLevel[Oa]||0)+1,xa.numRendered++))});return xa}},{key:"test",get:function(){const xa=this;return{renderer:xa._renderer,lercDecoder:xa._lercDecoder,forceReload:()=>{e.isSome(xa.rootTiles)&&(xa._mergeTile(xa.rootTiles[0]),xa._viewChangeUpdate())},getTiles:()=>xa._allTiles.toArray(),getRenderedTiles(){wa.clear();xa._allTiles.forAll(Oa=>
{Oa.visible&&Oa.rendered&&wa.push(Oa)});const Ka=wa.toArray();oa.sortTiles(xa.renderOrder,Ka);return Ka},lockTilingScheme(Ka,Oa){xa._extentHelper.defaultTiledLayersExtent=Oa;xa.tilingSchemeLogic.test.lockTilingScheme(Ka)}}}},{key:"isGlobal",get:function(){return this._isGlobal}},{key:"shadingEnabled",get:function(){return this._renderer.shadingEnabled}},{key:"isWebMercator",get:function(){var xa;return!(null==(xa=this.tilingScheme)||!xa.spatialReference.isWebMercator)}},{key:"isWebMercatorOnPlateeCarree",
get:function(){var xa;return this.isWebMercator&&N.isPlateCarree(null==(xa=this.view)?void 0:xa.renderSpatialReference)}}]);return ma}(g.EventedMixin(l));c.__decorate([u.property()],l.prototype,"_renderer",void 0);c.__decorate([u.property()],l.prototype,"_hasPendingUpdates",void 0);c.__decorate([u.property()],l.prototype,"_asyncWorkItems",void 0);c.__decorate([u.property()],l.prototype,"_allTilesDirty",void 0);c.__decorate([u.property()],l.prototype,"_allTilesSorted",void 0);c.__decorate([u.property()],
l.prototype,"_viewChanged",void 0);c.__decorate([u.property({readOnly:!0})],l.prototype,"_watchUpdatingTracking",void 0);c.__decorate([u.property()],l.prototype,"_frameTask",void 0);c.__decorate([u.property({readOnly:!0})],l.prototype,"snapLevel",null);c.__decorate([u.property({readOnly:!0})],l.prototype,"lodSnapping",null);c.__decorate([u.property({constructOnly:!0})],l.prototype,"view",void 0);c.__decorate([u.property()],l.prototype,"_userClippingExtent",null);c.__decorate([u.property()],l.prototype,
"_rootTilesExtent",void 0);c.__decorate([u.property({readOnly:!0})],l.prototype,"extent",null);c.__decorate([u.property({readOnly:!0})],l.prototype,"groundExtent",null);c.__decorate([u.property({readOnly:!0})],l.prototype,"_tilingSchemeExtent",null);c.__decorate([u.property({readOnly:!0})],l.prototype,"updating",null);c.__decorate([u.property(U.updatingProgress)],l.prototype,"updatingProgress",void 0);c.__decorate([u.property({readOnly:!0})],l.prototype,"updatingProgressValue",null);c.__decorate([u.property()],
l.prototype,"_maxNumUpdating",void 0);c.__decorate([u.property({aliasOf:"view.map.ground.opacity"})],l.prototype,"baseOpacity",void 0);c.__decorate([u.property()],l.prototype,"hasCompositeBlendMode",void 0);c.__decorate([u.property({readOnly:!0})],l.prototype,"overlayManager",void 0);c.__decorate([u.property({readOnly:!0})],l.prototype,"viewingMode",null);c.__decorate([u.property()],l.prototype,"maxTextureScale",void 0);c.__decorate([u.property({readOnly:!0})],l.prototype,"ready",null);c.__decorate([u.property({value:ia.RenderOrder.FRONT_TO_BACK})],
l.prototype,"renderOrder",null);c.__decorate([u.property({readOnly:!0})],l.prototype,"rootTiles",void 0);c.__decorate([u.property({readOnly:!0})],l.prototype,"spatialReference",null);c.__decorate([u.property({type:m,aliasOf:"view.map.ground.surfaceColor"})],l.prototype,"backgroundColor",void 0);c.__decorate([u.property({value:!1})],l.prototype,"slicePlaneEnabled",null);c.__decorate([u.property({readOnly:!0})],l.prototype,"tilingScheme",void 0);c.__decorate([u.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],
l.prototype,"tilingSchemeLocked",void 0);c.__decorate([u.property({readOnly:!0})],l.prototype,"tilingSchemeLogic",void 0);c.__decorate([u.property({value:!0})],l.prototype,"velvetOverground",null);c.__decorate([x.aliasOf("_renderer.wireframe")],l.prototype,"wireframe",void 0);c.__decorate([u.property({value:!1})],l.prototype,"suspended",null);c.__decorate([u.property({readOnly:!0,aliasOf:"view.qualitySettings.tiledSurface.textureFadeDuration"})],l.prototype,"textureFadeDuration",void 0);c.__decorate([u.property()],
l.prototype,"_layerViewsDirty",void 0);c.__decorate([x.aliasOf("_renderer.renderPatchBorders")],l.prototype,"renderPatchBorders",void 0);c.__decorate([x.aliasOf("_renderer.renderingDisabled")],l.prototype,"renderingDisabled",void 0);c=l=c.__decorate([C.subclass("esri.views.3d.terrain.TerrainSurface")],l);const Ia=D.create(),Ma=P.create(),Qa=[0,0,0],wa=new v,Ja={spatialReference:null,tile:null,extent:null,context:"ground"},Ta={spatialReference:null,extent:null,scale:0};return c})},"esri/layers/support/ElevationQueryTileCache":function(){define(["exports"],
function(a){let b=function(){function c(l){this.store=l}var m=c.prototype;m.destroy=function(){this.store.destroy()};m.get=function(l){return this.store.get(l)};m.put=function(l,r){this.store.put(l,r,r.values.byteLength+256)};return c}();a.ElevationQueryTileCache=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/LercDecoder":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe","../../core/workers/WorkerHandle"],
function(a,b,c,m){let l=function(n){function g(f=null){var d=n.call(this,"LercWorker","_decode",{_decode:e=>[e.buffer]},f,{strategy:"dedicated"})||this;d.schedule=f;d.ref=0;return d}b._inheritsLoose(g,n);var k=g.prototype;k.decode=function(f,d,e){return f&&0!==f.byteLength?this.invoke({buffer:f,options:d},e):Promise.resolve(null)};k.release=function(){0>=--this.ref&&(r.forEach((f,d)=>{f===this&&r.delete(d)}),this.destroy())};return g}(m.WorkerHandle);const r=new Map;a.acquireDecoder=function(n=null){let g=
r.get(c.unwrap(n));g||(c.isSome(n)?(g=new l(k=>n.schedule(k)),r.set(n,g)):(g=new l,r.set(null,g)));++g.ref;return g};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/workers/WorkerHandle":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../arrayUtils ../handleUtils ../Logger ../maybe ../promiseUtils ./workers".split(" "),function(a,b,c,m,l,r,n,g){const k=l.getLogger("esri.core.workers.WorkerHandle");l=function(){function f(e,h,
v,w,t={}){this._mainMethod=h;this._transferLists=v;this._listeners=[];this._promise=g.open(e,{...t,schedule:w}).then(x=>{if(void 0===this._thread){this._thread=x;this._promise=null;t.hasInitialize&&this.broadcast({},"initialize");for(const B of this._listeners)this._connectListener(B)}else x.close()});this._promise.catch(x=>k.error(`Failed to initialize ${e} worker: ${x}`))}var d=f.prototype;d.on=function(e,h){const v={removed:!1,eventName:e,callback:h,threadHandle:null};this._listeners.push(v);this._connectListener(v);
return m.makeHandle(()=>{v.removed=!0;c.remove(this._listeners,v);this._thread&&r.isSome(v.threadHandle)&&v.threadHandle.remove()})};d.destroy=function(){this._thread&&(this._thread.close(),this._thread=null);this._promise=null};d.invoke=function(e,h){return this.invokeMethod(this._mainMethod,e,h)};d.invokeMethod=function(e,h,v){if(this._thread){var w=this._transferLists[e];w=w?w(h):[];return this._thread.invoke(e,h,{transferList:w,signal:v})}return this._promise?this._promise.then(()=>{n.throwIfAborted(v);
return this.invokeMethod(e,h,v)}):Promise.reject(null)};d.broadcast=function(e,h){return this._thread?Promise.all(this._thread.broadcast(h,e)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(e,h)):Promise.reject()};d._connectListener=function(e){this._thread&&this._thread.on(e.eventName,e.callback).then(h=>{e.removed||(e.threadHandle=h)})};b._createClass(f,[{key:"promise",get:function(){return this._promise}}]);return f}();a.WorkerHandle=l;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ./enums ./RenderBucket ./decluttering/config ../webgl/TiledDisplayObject".split(" "),function(a,b,c,m,l,r,n,g,k){k=function(d){function e(v,w,t,x,B,q,u=null){w=d.call(this,v,w,t,x,B,4096,4096)||this;w._memCache=u;w.type="vector-tile";w._referenced=0;w._hasSymbolBuckets=
!1;w._memoryUsedByLayerData=0;w.layerData=new Map;w.layerCount=0;w.status="loading";w.allSymbolsFadingOut=!1;w.lastOpacityUpdate=0;w.symbols=new Map;w.isCoverage=!1;w.neededForCoverage=!1;w.decluttered=!1;w.invalidating=!1;w.parentTile=null;w.childrenTiles=new Set;w._processed=!1;w._referenced=1;w.styleRepository=q;w.id=v.id;return w}b._inheritsLoose(e,d);var h=e.prototype;h.setData=function(v){this.changeDataImpl(v);this.requestRender();this.ready();this.invalidating=!1;this._processed=!0};h.deleteLayerData=
function(v){let w=!1;for(const t of v)this.layerData.has(t)&&(v=this.layerData.get(t),this._memoryUsedByLayerData-=v.memoryUsed,v.type===r.BucketType.SYMBOL&&this.symbols.has(t)&&(this.symbols.delete(t),w=!0),v.destroy(),this.layerData.delete(t),this.layerCount--);c.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData);w&&this.emit("symbols-changed");this.requestRender()};h.processed=function(){return this._processed};h.hasData=function(){return 0<this.layerCount};
h.dispose=function(){"unloaded"!==this.status&&(f.delete(this),e._destroyRenderBuckets(this.layerData),this.layerData=null,this._memoryUsedByLayerData=this.layerCount=0,this.destroy(),this.status="unloaded")};h.release=function(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1};h.retain=function(){++this._referenced};h.changeDataImpl=function(v){let w=!1;if(v){const {bucketsWithData:t,emptyBuckets:x}=v;v=this._createRenderBuckets(t);if(x&&0<x.byteLength){const B=new Uint32Array(x);
for(const q of B)this._deleteLayerData(q)}for(const [B,q]of v)this._deleteLayerData(B),q.type===r.BucketType.SYMBOL&&(this.symbols.set(B,q.symbols),w=!0),this._memoryUsedByLayerData+=q.memoryUsed,this.layerData.set(B,q),this.layerCount++;c.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const [,t]of this.layerData)t.type===r.BucketType.SYMBOL&&(this._hasSymbolBuckets=!0);w&&this.emit("symbols-changed")};h.attachWithContext=
function(v){this.stage={context:v,trashDisplayObject(w){w.processDetach()},untrashDisplayObject(){return!1}}};h.setTransform=function(v,w){d.prototype.setTransform.call(this,v,w);var t=w/(v.resolution*v.pixelRatio);w=this.width/this.rangeX*t;t*=this.height/this.rangeY;const x=[0,0];v.toScreen(x,[this.x,this.y]);const B=this.transforms.tileUnitsToPixels;m.identity(B);m.translate(B,B,x);m.rotate(B,B,Math.PI*v.rotation/180);m.scale(B,B,[w,t,1])};h._createTransforms=function(){return{dvs:l.create(),tileMat3:l.create(),
tileUnitsToPixels:l.create()}};e._destroyRenderBuckets=function(v){if(v){var w=new Set;v.forEach(t=>{w.has(t)||(t.destroy(),w.add(t))});v.clear()}};h._createRenderBuckets=function(v){const w=new Map,t=new Map;for(const x of v){v=this._deserializeBucket(x,t);for(const B of v.layerUIDs)w.set(B,v)}return w};h._deserializeBucket=function(v,w){let t=w.get(v);if(t)return t;switch((new Uint32Array(v))[0]){case r.BucketType.FILL:t=new n.FillRenderBucket(v,this.styleRepository);break;case r.BucketType.LINE:t=
new n.LineRenderBucket(v,this.styleRepository);break;case r.BucketType.SYMBOL:t=new n.SymbolRenderBucket(v,this.styleRepository,this);break;case r.BucketType.CIRCLE:t=new n.CircleRenderBucket(v,this.styleRepository)}w.set(v,t);return t};h._deleteLayerData=function(v){if(this.layerData.has(v)){var w=this.layerData.get(v);this._memoryUsedByLayerData-=w.memoryUsed;w.destroy();this.layerData.delete(v);this.layerCount--}};b._createClass(e,[{key:"hasSymbolBuckets",get:function(){return this._hasSymbolBuckets}},
{key:"isFading",get:function(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<g.FADE_DURATION}},{key:"isHoldingForFade",get:function(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<g.FADE_DURATION)}},{key:"wasRequested",get:function(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}},{key:"referenced",get:function(){return this._referenced}},{key:"memoryUsage",get:function(){return(this._memoryUsedByLayerData+
256)/(this._referenced||1)}}]);return e}(k.TiledDisplayObject);const f=new Map;a.VectorTile=k;a.printAllocations=function(){f.forEach((d,e)=>{console.log(`\n${e.key}:`);d[0].forEach(h=>console.log(h));console.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");d[1].forEach(h=>console.log(h))})};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/mat3f32":function(){define(["exports"],function(a){function b(){const n=new Float32Array(9);n[0]=1;n[4]=1;n[8]=1;
return n}function c(n){const g=new Float32Array(9);g[0]=n[0];g[1]=n[1];g[2]=n[2];g[3]=n[3];g[4]=n[4];g[5]=n[5];g[6]=n[6];g[7]=n[7];g[8]=n[8];return g}function m(n,g,k,f,d,e,h,v,w){const t=new Float32Array(9);t[0]=n;t[1]=g;t[2]=k;t[3]=f;t[4]=d;t[5]=e;t[6]=h;t[7]=v;t[8]=w;return t}function l(n,g){return new Float32Array(n,g,9)}const r=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:m,createView:l},Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;a.createView=
l;a.fromValues=m;a.mat3f32=r})},"esri/views/2d/engine/vectorTiles/enums":function(){define(["exports"],function(a){a.MemoryBufferType=void 0;(function(b){b[b.UNKNOWN=0]="UNKNOWN";b[b.FILL_VERTEX=1]="FILL_VERTEX";b[b.FILL_DD_VERTEX=2]="FILL_DD_VERTEX";b[b.FILL_INDEX=3]="FILL_INDEX";b[b.OUTLINE_VERTEX=4]="OUTLINE_VERTEX";b[b.OUTLINE_DD_VERTEX=5]="OUTLINE_DD_VERTEX";b[b.OUTLINE_INDEX=6]="OUTLINE_INDEX";b[b.LINE_VERTEX=7]="LINE_VERTEX";b[b.LINE_DD_VERTEX=8]="LINE_DD_VERTEX";b[b.LINE_INDEX=9]="LINE_INDEX";
b[b.ICON_VERTEX=10]="ICON_VERTEX";b[b.ICON_DD_VERTEX=11]="ICON_DD_VERTEX";b[b.ICON_INDEX=12]="ICON_INDEX";b[b.TEXT_VERTEX=13]="TEXT_VERTEX";b[b.TEXT_DD_VERTEX=14]="TEXT_DD_VERTEX";b[b.TEXT_INDEX=15]="TEXT_INDEX";b[b.CIRCLE_VERTEX=16]="CIRCLE_VERTEX";b[b.CIRCLE_INDEX=17]="CIRCLE_INDEX"})(a.MemoryBufferType||(a.MemoryBufferType={}));a.BucketType=void 0;(function(b){b[b.FILL=1]="FILL";b[b.LINE=2]="LINE";b[b.SYMBOL=3]="SYMBOL";b[b.CIRCLE=4]="CIRCLE"})(a.BucketType||(a.BucketType={}));a.DrawPhase=void 0;
(function(b){b[b.BACKGROUND=0]="BACKGROUND";b[b.OPAQUE=1]="OPAQUE";b[b.TRANSLUCENT=2]="TRANSLUCENT";b[b.SYMBOLS=3]="SYMBOLS";b[b.HITTEST=4]="HITTEST"})(a.DrawPhase||(a.DrawPhase={}));a.ShaderProgramType=void 0;(function(b){b[b.BACKGROUND=0]="BACKGROUND";b[b.FILL=1]="FILL";b[b.OUTLINE=2]="OUTLINE";b[b.LINE=3]="LINE";b[b.ICON=4]="ICON";b[b.CIRCLE=5]="CIRCLE";b[b.TEXT=6]="TEXT";b[b.TILEINFO=7]="TILEINFO"})(a.ShaderProgramType||(a.ShaderProgramType={}));a.StyleUpdateType=void 0;(function(b){b[b.PAINTER_CHANGED=
0]="PAINTER_CHANGED";b[b.LAYOUT_CHANGED=1]="LAYOUT_CHANGED";b[b.LAYER_CHANGED=2]="LAYER_CHANGED";b[b.LAYER_REMOVED=3]="LAYER_REMOVED";b[b.SPRITES_CHANGED=4]="SPRITES_CHANGED"})(a.StyleUpdateType||(a.StyleUpdateType={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./enums ./decluttering/util ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),
function(a,b,c,m,l,r,n,g){let k=function(){function v(t,x){this.layerUIDs=[];this.isDestroyed=!1;this.data=t;this.memoryUsed=t.byteLength;let B=1;t=new Uint32Array(t);this.layerUIDs=[];const q=t[B++];for(let u=0;u<q;u++)this.layerUIDs[u]=t[B++];this.bufferDataOffset=B;x&&(this.layer=x.getStyleLayerByUID(this.layerUIDs[0]))}var w=v.prototype;w.destroy=function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)};w.prepareForRendering=function(t){c.isNone(this.data)||(this.doPrepareForRendering(t,
this.data,this.bufferDataOffset),this.data=null)};b._createClass(v,[{key:"isPreparedForRendering",get:function(){return c.isNone(this.data)}},{key:"offset",get:function(){return this.bufferDataOffset}}]);return v}(),f=function(v){function w(x,B){B=v.call(this,x,B)||this;B.type=m.BucketType.LINE;B.lineIndexStart=0;B.lineIndexCount=0;x=new Uint32Array(x);let q=B.bufferDataOffset;B.lineIndexStart=x[q++];B.lineIndexCount=x[q++];const u=x[q++];if(0<u){const C=new Map;for(let z=0;z<u;z++){const A=x[q++],
p=x[q++],y=x[q++];C.set(A,[p,y])}B.patternMap=C}B.bufferDataOffset=q;return B}b._inheritsLoose(w,v);var t=w.prototype;t.hasData=function(){return 0<this.lineIndexCount};t.triangleCount=function(){return this.lineIndexCount/3};t.doDestroy=function(){c.isSome(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose();c.isSome(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose();c.isSome(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose();this.lineIndexBuffer=this.lineVertexBuffer=this.lineVertexArrayObject=
null;this.memoryUsed=0};t.doPrepareForRendering=function(x,B,q){B=new Uint32Array(B);var u=new Int32Array(B.buffer);const C=B[q++];this.lineVertexBuffer=r.BufferObject.createVertex(x,n.Usage.STATIC_DRAW,new Int32Array(u.buffer,4*q,C));q+=C;u=B[q++];this.lineIndexBuffer=r.BufferObject.createIndex(x,n.Usage.STATIC_DRAW,new Uint32Array(B.buffer,4*q,u));q+=u;q=this.layer.lineMaterial;this.lineVertexArrayObject=new g.VertexArrayObject(x,q.getAttributeLocations(),q.getLayoutInfo(),{geometry:this.lineVertexBuffer},
this.lineIndexBuffer)};return w}(k),d=function(v){function w(x,B){B=v.call(this,x,B)||this;B.type=m.BucketType.FILL;B.fillIndexStart=0;B.fillIndexCount=0;B.outlineIndexStart=0;B.outlineIndexCount=0;x=new Uint32Array(x);let q=B.bufferDataOffset;B.fillIndexStart=x[q++];B.fillIndexCount=x[q++];B.outlineIndexStart=x[q++];B.outlineIndexCount=x[q++];const u=x[q++];if(0<u){const C=new Map;for(let z=0;z<u;z++){const A=x[q++],p=x[q++],y=x[q++];C.set(A,[p,y])}B.patternMap=C}B.bufferDataOffset=q;return B}b._inheritsLoose(w,
v);var t=w.prototype;t.hasData=function(){return 0<this.fillIndexCount||0<this.outlineIndexCount};t.triangleCount=function(){return(this.fillIndexCount+this.outlineIndexCount)/3};t.doDestroy=function(){c.isSome(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose();c.isSome(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose();c.isSome(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose();this.fillIndexBuffer=this.fillVertexBuffer=this.fillVertexArrayObject=null;c.isSome(this.outlineVertexArrayObject)&&
this.outlineVertexArrayObject.dispose();c.isSome(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose();c.isSome(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose();this.outlineIndexBuffer=this.outlineVertexBuffer=this.outlineVertexArrayObject=null;this.memoryUsed=0};t.doPrepareForRendering=function(x,B,q){B=new Uint32Array(B);var u=new Int32Array(B.buffer),C=B[q++];this.fillVertexBuffer=r.BufferObject.createVertex(x,n.Usage.STATIC_DRAW,new Int32Array(u.buffer,4*q,C));q+=C;C=B[q++];
this.fillIndexBuffer=r.BufferObject.createIndex(x,n.Usage.STATIC_DRAW,new Uint32Array(B.buffer,4*q,C));q+=C;C=B[q++];this.outlineVertexBuffer=r.BufferObject.createVertex(x,n.Usage.STATIC_DRAW,new Int32Array(u.buffer,4*q,C));q+=C;u=B[q++];this.outlineIndexBuffer=r.BufferObject.createIndex(x,n.Usage.STATIC_DRAW,new Uint32Array(B.buffer,4*q,u));q+=u;B=this.layer;q=B.fillMaterial;B=B.outlineMaterial;this.fillVertexArrayObject=new g.VertexArrayObject(x,q.getAttributeLocations(),q.getLayoutInfo(),{geometry:this.fillVertexBuffer},
this.fillIndexBuffer);this.outlineVertexArrayObject=new g.VertexArrayObject(x,B.getAttributeLocations(),B.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)};return w}(k),e=function(v){function w(x,B,q){B=v.call(this,x,B)||this;B.type=m.BucketType.SYMBOL;B.iconPerPageElementsMap=new Map;B.glyphPerPageElementsMap=new Map;B.symbolInstances=[];B.isIconSDF=!1;B.opacityChanged=!1;B.lastOpacityUpdate=0;B.symbols=[];const u=new Uint32Array(x),C=new Int32Array(x);x=new Float32Array(x);
let z=B.bufferDataOffset;B.isIconSDF=!!u[z++];var A=u[z++];for(var p=0;p<A;p++){var y=u[z++],D=u[z++],E=u[z++];B.iconPerPageElementsMap.set(y,[D,E])}A=u[z++];for(p=0;p<A;p++)y=u[z++],D=u[z++],E=u[z++],B.glyphPerPageElementsMap.set(y,[D,E]);A=u[z++];p=u[z++];B.iconOpacity=new Int32Array(A);B.textOpacity=new Int32Array(p);z=l.deserializeSymbols(u,C,x,z,B.symbols,q);B.bufferDataOffset=z;return B}b._inheritsLoose(w,v);var t=w.prototype;t.hasData=function(){return 0<this.iconPerPageElementsMap.size||0<
this.glyphPerPageElementsMap.size};t.triangleCount=function(){let x=0;for(const [,B]of this.iconPerPageElementsMap)x+=B[1];for(const [,B]of this.glyphPerPageElementsMap)x+=B[1];return x/3};t.doDestroy=function(){c.isSome(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose();c.isSome(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose();c.isSome(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose();c.isSome(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose();this.iconIndexBuffer=
this.iconOpacityBuffer=this.iconVertexBuffer=this.iconVertexArrayObject=null;c.isSome(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose();c.isSome(this.textVertexBuffer)&&this.textVertexBuffer.dispose();c.isSome(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose();c.isSome(this.textIndexBuffer)&&this.textIndexBuffer.dispose();this.textIndexBuffer=this.textOpacityBuffer=this.textVertexBuffer=this.textVertexArrayObject=null;this.memoryUsed=0};t.updateOpacityInfo=function(){if(this.opacityChanged){this.opacityChanged=
!1;var x=c.unwrap(this.iconOpacity),B=c.unwrap(this.iconOpacityBuffer);0<x.length&&x.byteLength===B.size&&B.setSubData(x);x=c.unwrap(this.textOpacity);B=c.unwrap(this.textOpacityBuffer);0<x.length&&x.byteLength===B.size&&B.setSubData(x)}};t.doPrepareForRendering=function(x,B,q){B=new Uint32Array(B);var u=new Int32Array(B.buffer),C=B[q++];this.iconVertexBuffer=r.BufferObject.createVertex(x,n.Usage.STATIC_DRAW,new Int32Array(u.buffer,4*q,C));q+=C;C=B[q++];this.iconIndexBuffer=r.BufferObject.createIndex(x,
n.Usage.STATIC_DRAW,new Uint32Array(B.buffer,4*q,C));q+=C;C=B[q++];this.textVertexBuffer=r.BufferObject.createVertex(x,n.Usage.STATIC_DRAW,new Int32Array(u.buffer,4*q,C));q+=C;u=B[q++];this.textIndexBuffer=r.BufferObject.createIndex(x,n.Usage.STATIC_DRAW,new Uint32Array(B.buffer,4*q,u));q+=u;this.iconOpacityBuffer=r.BufferObject.createVertex(x,n.Usage.STATIC_DRAW,c.unwrap(this.iconOpacity).buffer);this.textOpacityBuffer=r.BufferObject.createVertex(x,n.Usage.STATIC_DRAW,c.unwrap(this.textOpacity).buffer);
B=this.layer;q=B.iconMaterial;B=B.textMaterial;this.iconVertexArrayObject=new g.VertexArrayObject(x,q.getAttributeLocations(),q.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer);this.textVertexArrayObject=new g.VertexArrayObject(x,B.getAttributeLocations(),B.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)};return w}(k),h=function(v){function w(x,B){B=v.call(this,x,B)||this;B.type=m.BucketType.CIRCLE;
B.circleIndexStart=0;B.circleIndexCount=0;x=new Uint32Array(x);let q=B.bufferDataOffset;B.circleIndexStart=x[q++];B.circleIndexCount=x[q++];B.bufferDataOffset=q;return B}b._inheritsLoose(w,v);var t=w.prototype;t.hasData=function(){return 0<this.circleIndexCount};t.triangleCount=function(){return this.circleIndexCount/3};t.doDestroy=function(){c.isSome(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose();c.isSome(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose();c.isSome(this.circleIndexBuffer)&&
this.circleIndexBuffer.dispose();this.circleIndexBuffer=this.circleVertexBuffer=this.circleVertexArrayObject=null;this.memoryUsed=0};t.doPrepareForRendering=function(x,B,q){B=new Uint32Array(B);var u=new Int32Array(B.buffer);const C=B[q++];this.circleVertexBuffer=r.BufferObject.createVertex(x,n.Usage.STATIC_DRAW,new Int32Array(u.buffer,4*q,C));q+=C;u=B[q++];this.circleIndexBuffer=r.BufferObject.createIndex(x,n.Usage.STATIC_DRAW,new Uint32Array(B.buffer,4*q,u));q+=u;q=this.layer.circleMaterial;this.circleVertexArrayObject=
new g.VertexArrayObject(x,q.getAttributeLocations(),q.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)};return w}(k);a.CircleRenderBucket=h;a.FillRenderBucket=d;a.LineRenderBucket=f;a.RenderBucketBase=k;a.SymbolRenderBucket=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe",
"../enums","./core"],function(a,b,c,m,l){let r=function(f){this.tile=f;this.parent=null;this.children=new Set},n=function(){function f(){this.nodes=new Map;this.roots=new Set}var d=f.prototype;d.create=function(e){const h=new r(e);let v;const w=[];this.nodes.forEach(t=>{this._canConnectDirectly(h,t)&&w.push(t);!v&&this._canConnectDirectly(t,h)&&(v=t)});if(v){for(const t of w)v.children.delete(t),h.children.add(t),t.parent=h;v.children.add(h);h.parent=v}else{this.roots.add(h);for(const t of w)h.children.add(t),
t.parent=h,this.roots.delete(t)}this.nodes.set(e.key.id,h);return h};d.destroy=function(e){c.isSome(e.parent)?(e.parent.children.delete(e),e.children.forEach(h=>{c.isSome(e.parent)&&e.parent.children.add(h)})):this.roots.delete(e);e.children.forEach(h=>{(h.parent=e.parent)||this.roots.add(h)});this.nodes.delete(e.tile.key.id)};d.clear=function(){this.roots.clear();this.nodes.clear()};d._canConnectDirectly=function(e,h){let {level:v,row:w,col:t}=h.tile.key;for({world:h}=h.tile.key;0<v;){v--;w>>=1;
t>>=1;if(e.tile.key.level===v&&e.tile.key.row===w&&e.tile.key.col===t&&e.tile.key.world===h)return!0;if(this.nodes.has(`${v}/${w}/${t}/${h}`))break}return!1};return f}(),g=function(){function f(){this._tileGraph=new n;this._tileArray=null}var d=f.prototype;d.has=function(e){return"string"===typeof e?this._tileGraph.nodes.has(e):this._tileGraph.nodes.has(e.key.id)};d.getAll=function(){this._tileArray||(this._tileArray=[],this._tileGraph.nodes.forEach(e=>{this._tileArray.push(e.tile)}));return this._tileArray};
d.getRoots=function(){const e=[];this._tileGraph.roots.forEach(h=>{e.push(h.tile)});return e};d.getParent=function(e){e=this._tileGraph.nodes.get("string"===typeof e?e:e.key.id);return c.isSome(e.parent)&&e.parent.tile};d.getChildren=function(e){const h=[];this._tileGraph.nodes.get("string"===typeof e?e:e.key.id).children.forEach(v=>{h.push(v.tile)});return h};d.get=function(e){return this._tileGraph.nodes.get(e).tile};d.removeKey=function(e){e=this._tileGraph.nodes.get(e);this._tileGraph.destroy(e);
this._tileArray=null};d.forEach=function(e){this._tileGraph.nodes.forEach((h,v)=>e(h.tile,v))};d.add=function(e){this._tileGraph.create(e);this._tileArray=null};d.remove=function(e){e=this._tileGraph.nodes.get(e.key.id);this._tileGraph.destroy(e);this._tileArray=null};d.clear=function(){this._tileGraph.clear();this._tileArray=[]};return f}(),k=function(){function f(e,h,v){this._rows=Math.ceil(h/v);this._columns=Math.ceil(e/v);this._cellSize=v;this.cells=Array(this._rows);for(e=0;e<this._rows;e++)for(this.cells[e]=
Array(this._columns),h=0;h<this._columns;h++)this.cells[e][h]=[]}var d=f.prototype;d.getCell=function(e,h){h=Math.min(Math.max(Math.floor(h/this._cellSize),0),this._rows-1);e=Math.min(Math.max(Math.floor(e/this._cellSize),0),this._columns-1);return this.cells[h]&&this.cells[h][e]||null};d.getCellSpan=function(e,h,v,w){return[Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(h/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(v/this._cellSize),
0),this.columns-1),Math.min(Math.max(Math.floor(w/this._cellSize),0),this.rows-1)]};b._createClass(f,[{key:"cellSize",get:function(){return this._cellSize}},{key:"columns",get:function(){return this._columns}},{key:"rows",get:function(){return this._rows}}]);return f}();a.GridIndex=k;a.TileForest=g;a.TileGraph=n;a.TileNode=r;a.deserializeSymbols=function(f,d,e,h,v,w){const t=d[h++];for(let q=0;q<t;q++){const u=new l.VTLSymbol(w);u.xTile=d[h++];u.yTile=d[h++];u.hash=d[h++];u.priority=d[h++];var x=
d[h++];for(var B=0;B<x;B++){const C=d[h++],z=d[h++],A=d[h++],p=d[h++],y=!!d[h++],D=d[h++],E=e[h++],F=e[h++],G=d[h++],P=d[h++];u.colliders.push({xTile:C,yTile:z,dxPixels:A,dyPixels:p,hard:y,partIndex:D,width:G,height:P,minLod:E,maxLod:F})}x=f[h++];for(B=0;B<x;B++)u.textVertexRanges.push([f[h++],f[h++]]);x=f[h++];for(B=0;B<x;B++)u.iconVertexRanges.push([f[h++],f[h++]]);v.push(u)}return h};a.tileCoordChange=function(f,d,e,h,v,w){e-=v;if(0<=e)return(d>>e)+(h-(w<<e))*(f>>e);e=-e;return d-(w-(h<<e))*(f>>
e)<<e};a.writeOpacityToBuffers=function(f,d,e){for(const [q,u]of f.symbols){{var h=f,v=d,w=e,t=u;const C=h.layerData.get(q);if(C.type===m.BucketType.SYMBOL){for(const z of t){t=z.unique;var x=void 0;if(z.selectedForRendering){var B=t.parts[0];x=B.startOpacity;B=B.targetOpacity;h.allSymbolsFadingOut=h.allSymbolsFadingOut&&0===B;x=w?Math.floor(127*x)|B<<7:B?255:0;x|=x<<24|x<<16|x<<8}else x=0;for(const [A,p]of z.iconVertexRanges)for(B=A;B<A+p;B+=4)C.iconOpacity[B/4]=x;z.selectedForRendering?(x=t.parts[1],
t=x.startOpacity,x=x.targetOpacity,h.allSymbolsFadingOut=h.allSymbolsFadingOut&&0===x,t=w?Math.floor(127*t)|x<<7:x?255:0,x=t<<24|t<<16|t<<8|t):x=0;for(const [A,p]of z.textVertexRanges)for(t=A;t<A+p;t+=4)C.textOpacity[t/4]=x}C.lastOpacityUpdate=v;C.opacityChanged=!0}}}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports"],function(a){a.VTLSymbol=function(b){this.hash=this.yTile=
this.xTile=0;this.priority=1;this.colliders=[];this.textVertexRanges=[];this.iconVertexRanges=[];this.tile=b};a.VTLUniqueSymbol=function(){this.tileSymbols=[];this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}];this.show=!1};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/decluttering/config":function(){define(["exports"],function(a){a.COLLISION_GRID_CELL_SIZE=
32;a.DECLUTTER_BUDGET=1.5;a.DECLUTTER_TILES=!0;a.FADE_DURATION=200;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/mat3","../DisplayObject","../../tiling/TileKey"],function(a,b,c,m,l){m=function(r){function n(k,f,d,e,h,v=e,w=h){var t=r.call(this)||this;t.triangleCountReportedInDebug=0;t.triangleCount=0;t.texture=
null;t.key=new l(k);t.x=f;t.y=d;t.width=e;t.height=h;t.rangeX=v;t.rangeY=w;return t}b._inheritsLoose(n,r);var g=n.prototype;g.destroy=function(){this.texture&&(this.texture.dispose(),this.texture=null)};g.setTransform=function(k,f){f/=k.resolution*k.pixelRatio;const d=this.transforms.tileMat3,[e,h]=k.toScreenNoRotation([0,0],[this.x,this.y]);c.set(d,this.width/this.rangeX*f,0,0,0,this.height/this.rangeY*f,0,e,h,1);c.multiply(this.transforms.dvs,k.displayViewMat3,d)};return n}(m.DisplayObject);a.TiledDisplayObject=
m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/DisplayObject":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Evented ../../../core/has ../../../core/maybe ../../../core/promiseUtils".split(" "),function(a,b,c,m,l,r){const n=1/m("mapview-transitions-duration");c=function(g){function k(){var d=g.apply(this,arguments)||this;d._fadeOutResolver=null;d._fadeInResolver=null;d._clips=null;d.computedVisible=
!0;d.computedOpacity=1;d.fadeTransitionEnabled=!1;d.inFadeTransition=!1;d._isReady=!1;d._opacity=1;d._stage=null;d._visible=!0;return d}b._inheritsLoose(k,g);var f=k.prototype;f._getTransforms=function(){l.isNone(this._transforms)&&(this._transforms=this._createTransforms());return this._transforms};f.fadeIn=function(){if(this._fadeInResolver)return this._fadeInResolver.promise;this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null);this.computedOpacity=0;this.fadeTransitionEnabled=
!0;this._fadeInResolver=r.createResolver();this.requestRender();return this._fadeInResolver.promise};f.fadeOut=function(){if(this._fadeOutResolver)return this._fadeOutResolver.promise;this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this.fadeTransitionEnabled=!0;this._fadeOutResolver=r.createResolver();this.requestRender();return this._fadeOutResolver.promise};f.beforeRender=function(d){this.updateTransitionProperties(d.deltaTime,d.state.scale)};f.afterRender=function(d){this._fadeInResolver&&
this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)};f.remove=function(){var d;null==(d=this.parent)?void 0:d.removeChild(this)};f.setTransform=function(d){};f.processRender=function(d){this.stage&&this.computedVisible&&this.doRender(d)};f.requestRender=function(){this.stage&&this.stage.requestRender()};f.processDetach=function(){this._fadeInResolver&&(this._fadeInResolver(),
this._fadeInResolver=null);this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null);this.onDetach();this.emit("detach")};f.updateTransitionProperties=function(d,e){if(this.fadeTransitionEnabled){e=this._fadeOutResolver||!this.visible?0:this.opacity;const h=this.computedOpacity;h===e?this.computedVisible=this.visible:(d*=n,this.computedOpacity=h>e?Math.max(e,h-d):Math.min(e,h+d),this.computedVisible=0<this.computedOpacity,d=e===this.computedOpacity,this.inFadeTransition=!d,d||this.requestRender())}else this.computedOpacity=
this.opacity,this.computedVisible=this.visible};f.onAttach=function(){};f.onDetach=function(){};f.doRender=function(d){};f.ready=function(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())};b._createClass(k,[{key:"clips",get:function(){return this._clips},set:function(d){this._clips=d;this.requestRender()}},{key:"isReady",get:function(){return this._isReady}},{key:"opacity",get:function(){return this._opacity},set:function(d){this._opacity!==d&&(this._opacity=Math.min(1,
Math.max(d,0)),this.requestRender())}},{key:"stage",get:function(){return this._stage},set:function(d){if(this._stage!==d){var e=this._stage;(this._stage=d)?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):e.trashDisplayObject(this)}}},{key:"transforms",get:function(){return this._getTransforms()}},{key:"visible",get:function(){return this._visible},set:function(d){this._visible!==d&&(this._visible=d,this.requestRender())}}]);return k}(c);a.DisplayObject=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/tiling/TileKey":function(){define(["../../../chunks/_rollupPluginBabelHelpers","../../../core/ObjectPool"],function(a,b){let c=function(){function m(r,n,g,k){this.set(r,n,g,k)}m.getId=function(r,n,g,k){return"object"===typeof r?`${r.level}/${r.row}/${r.col}/${r.world}`:`${r}/${n}/${g}/${k}`};var l=m.prototype;l.acquire=function(r,n,g,k){this.set(r,n,g,k)};l.contains=function(r){const n=r.level-this.level;return this.row===
r.row>>n&&this.col===r.col>>n&&this.world===r.world};l.equals=function(r){return this.level===r.level&&this.row===r.row&&this.col===r.col&&this.world===r.world};l.clone=function(){return new m(this)};l.release=function(){this.world=this.col=this.row=this.level=0};l.set=function(r,n,g,k){if(null==r)this.world=this.col=this.row=this.level=0;else if("object"===typeof r)this.level=r.level||0,this.row=r.row||0,this.col=r.col||0,this.world=r.world||0;else if("string"===typeof r){const [f,d,e,h]=r.split("/");
this.level=parseFloat(f);this.row=parseFloat(d);this.col=parseFloat(e);this.world=parseFloat(h)}else this.level=+r,this.row=+n,this.col=+g,this.world=+k||0;return this};l.toString=function(){return`${this.level}/${this.row}/${this.col}/${this.world}`};l.getParentKey=function(){return 0>=this.level?null:new m(this.level-1,this.row>>1,this.col>>1,this.world)};l.getChildKeys=function(){const r=this.level+1,n=this.row<<1,g=this.col<<1,k=this.world;return[new m(r,n,g,k),new m(r,n,g+1,k),new m(r,n+1,g,
k),new m(r,n+1,g+1,k)]};l.compareRowMajor=function(r){return this.row<r.row?-1:this.row>r.row?1:this.col<r.col?-1:this.col>r.col?1:0};a._createClass(m,[{key:"key",get:function(){return this}},{key:"id",get:function(){return this.toString()},set:function(r){this.set(r)}},{key:"hash",get:function(){return(this.world&3)<<30|(this.col&4095)<<22|(this.row&4095)<<8|this.level&63}}]);return m}();c.pool=new b(c,null,null,25,50);return c})},"esri/views/3d/support/updatingProperties":function(){define(["exports"],
function(a){a.updatingProgress={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};a.updatingProgressValue={value:.5,readOnly:!0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/ElevationBounds":function(){define(["exports"],function(a){let b=function(){function c(m=0,l=0){this.min=m;this.max=l;this.level=0;this.hasNoDataValues=!1}c.prototype.copyFrom=function(m){this.min=m.min;this.max=m.max;this.level=
m.level;this.hasNoDataValues=m.hasNoDataValues};return c}();a.ElevationBounds=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/ElevationData":function(){define(["exports","../../../core/mathUtils","../../../core/maybe","../support/mathUtils","./TerrainConst"],function(a,b,c,m,l){function r(g,k,f){if(c.isNone(f))return null;for(const w of f){if(!w)continue;var d=w.safeWidth;f=b.clamp(w.dy*(w.y1-k),0,d);d=b.clamp(w.dx*(g-w.x0),0,d);
const t=Math.floor(f),x=Math.floor(d);var e=w.width,h=t*e+x,v=w.pixelData;const B=v[h],q=v[h+1];h+=e;e=v[h];v=v[h+1];if(B+e+q+v<.5*l.ELEVATION_NODATA_VALUE)return f-=t,d-=x,g=B+(q-B)*d,g+(e+(v-e)*d-g)*f}return null}let n=function(){function g(f,d,e){this.type="elevation";this.samplerData=null;this.level=f[0];this.i=f[1];this.j=f[2];this.extent=d;f=e.noDataValue;const h=e.values;let v=Infinity,w=-Infinity,t=!0,x=!1;for(let B=0;B<h.length;B++){const q=h[B];q!==f?(v=q<v?q:v,w=q>w?q:w,t=!1):x=!0}t&&(w=
v=0);this.samplerData={pixelData:e.values,width:e.width,height:e.height,noDataValue:f,safeWidth:.99999999*(e.width-1),dx:(e.width-1)/(d[2]-d[0]),dy:(e.width-1)/(d[3]-d[1]),x0:d[0],y1:d[3]};this.bounds=[v,-3E38<w?w:0];this.hasNoDataValues=x}var k=g.prototype;k.release=function(){this.bounds=this.samplerData=null};k.computeMinMaxValue=function(f,d,e,h){h.min=Infinity;h.max=-Infinity;h.hasNoDataValues=!1;f-=this.level;if(0>=f)return h;var v=2**f;if(Math.floor(d/v)!==this.i||Math.floor(e/v)!==this.j)return h;
var w=Infinity,t=-Infinity,x=this.samplerData.width,B=this.samplerData.pixelData,q=.5*l.ELEVATION_NODATA_VALUE;f=(x-1)/v;e=(e-this.j*v)*f;let u=(d-this.i*v)*f;if(1>f){const A=Math.floor(e),p=Math.floor(u);var C=A+p*x;d=B[C];v=B[C+1];var z=B[C+x];C=B[C+x+1];if(d+v+z+C<q)return w=e-A,q=u-p,t=m.bilerp(d,v,z,C,w,q),x=m.bilerp(d,v,z,C,w+f,q),B=m.bilerp(d,v,z,C,w,q+f),f=m.bilerp(d,v,z,C,w+f,q+f),h.min=Math.min(t,x,B,f),h.max=Math.max(t,x,B,f),h;e=A;u=p;f=1}else e=Math.floor(e),u=Math.floor(u),f=Math.ceil(f);
for(d=e;d<=e+f;d++)for(v=u;v<=u+f;v++)z=B[d+v*x],z<q?(w=Math.min(w,z),t=Math.max(t,z)):h.hasNoDataValues=!0;h.min=w;h.max=t;return h};return g}();a.ElevationData=n;a.sampleElevation=r;a.sampleElevationOrZero=function(g,k,f){g=r(g,k,f);return c.isSome(g)?g:0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/ExtentHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../layers/support/layerUtils ../../ViewingMode ./TerrainConst ./terrainUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x){function B(C,z){return r.isSome(C)&&!C.spatialReference.equals(z)?e.projectWithoutEngine(C,C.spatialReference,z):C}a.ExtentHelper=function(C){function z(p){p=C.call(this,p)||this;p._handles=new l;return p}b._inheritsLoose(z,C);var A=z.prototype;A.initialize=function(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])};A.destroy=function(){this._handles.destroy();this._handles=null};A._computeStencilEnabledExtents=
function(){const p=[];this.layerViews.forEach(y=>{y=y.layer;"IntegratedMeshLayer"===y.operationalLayerType&&null!=this.viewSpatialReference&&(y=B(y.fullExtent,this.viewSpatialReference),r.isSome(y)&&p.push(h.fromExtent(y)))});return p};b._createClass(z,[{key:"layerViewsExtent",get:function(){return this._computeLayerViewsExtent()}},{key:"tiledLayersExtent",get:function(){return this._computeTiledLayersExtent()}},{key:"stencilEnabledExtents",get:function(){return this._computeStencilEnabledExtents()}}]);
return z}(m);c.__decorate([n.property({readOnly:!0})],a.ExtentHelper.prototype,"layerViewsExtent",null);c.__decorate([n.property({readOnly:!0})],a.ExtentHelper.prototype,"tiledLayersExtent",null);c.__decorate([n.property({readOnly:!0})],a.ExtentHelper.prototype,"stencilEnabledExtents",null);c.__decorate([n.property()],a.ExtentHelper.prototype,"viewSpatialReference",void 0);c.__decorate([n.property()],a.ExtentHelper.prototype,"tilingScheme",void 0);c.__decorate([n.property()],a.ExtentHelper.prototype,
"defaultTiledLayersExtent",void 0);c.__decorate([n.property({constructOnly:!0})],a.ExtentHelper.prototype,"layers",void 0);c.__decorate([n.property({constructOnly:!0})],a.ExtentHelper.prototype,"layerViews",void 0);a.ExtentHelper=c.__decorate([d.subclass("esri.views.3d.terrain.ExtentHelper")],a.ExtentHelper);let q=function(C){function z(){return C.apply(this,arguments)||this}b._inheritsLoose(z,C);var A=z.prototype;A._computeLayerViewsExtent=function(){return this._globalExtent};A._computeTiledLayersExtent=
function(){return this._globalExtent};b._createClass(z,[{key:"_globalExtent",get:function(){return this.viewSpatialReference.isWebMercator?t.WEBMERCATOR_WORLD_EXTENT:t.GEOGRAPHIC_WORLD_EXTENT}}]);return z}(a.ExtentHelper);q=c.__decorate([d.subclass("esri.views.3d.terrain.ExtentHelperGlobal")],q);let u=function(C){function z(){return C.apply(this,arguments)||this}b._inheritsLoose(z,C);var A=z.prototype;A._computeLayerViewsExtent=function(){const p=h.empty(),y=this.viewSpatialReference;this.layerViews.forEach(F=>
{const G=F.layer;!F.isResolved()||"graphics"===G.type&&G.internal||(F=B("fullExtentInLocalViewSpatialReference"in F&&F.fullExtentInLocalViewSpatialReference||F.layer.fullExtent,y),h.expand(p,F,p))});const D=h.allFinite(p)?p:null,E=this._get("layerViewsExtent");return h.equals(D,E)?E:D};A._computeTiledLayersExtent=function(){const p=this.tilingScheme;if(!p)return null;const y=this.viewSpatialReference,D=h.empty();this.layers.forEach(G=>{if(G.loaded&&v.isTiledLayer(G)){const N=x.getTiledLayerInfo(G,
y,w.ViewingMode.Local);if(!r.isNone(N)){var {tileInfo:P,fullExtent:K}=N;r.isSome(P)&&r.isSome(K)&&(x.isProjectableRasterLayer(G)||p.compatibleWith(P)&&K.spatialReference.equals(p.spatialReference))&&h.expand(D,K,D)}}});h.expand(D,this.defaultTiledLayersExtent,D);const E=h.allFinite(D)?D:null,F=this._get("tiledLayersExtent");return h.equals(E,F)?F:E};return z}(a.ExtentHelper);u=c.__decorate([d.subclass("esri.views.3d.terrain.ExtentHelperLocal")],u);a.create=function(C,z){return C===w.ViewingMode.Global?
new q(z):new u(z)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/LayerClass":function(){define(["exports"],function(a){a.LayerClass=void 0;var b=a.LayerClass||(a.LayerClass={});b[b.ELEVATION=0]="ELEVATION";b[b.MAP=1]="MAP";a.LayerClasses=[a.LayerClass.ELEVATION,a.LayerClass.MAP];Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/OverlayManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Cyclical ../../../core/Handles ../../../core/has ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/scheduling ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec2 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../../../geometry/support/ray ../../../chunks/sphere ../../../geometry/support/vector ../../../geometry/support/webMercatorUtils ../state/utils/viewUtils ../support/debugFlags ../support/debugUtils ./interfaces ./Overlay ./OverlayRenderer ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/Intersector ../webgl-engine/lib/LocalOriginFactory ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/parts/requireUtils ../../support/Scheduler".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N,M,L,J,H,I,O,Q,S){const T=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let U;a.OverlayManager=function(ia){function ka(Y){Y=ia.call(this,Y)||this;Y._handles=new r;Y._spatialReference=null;Y._renderSR=null;Y._overlaySREqualsRenderSR=!0;Y._drapeSources=new Set;Y._drapeTargets=new Set;Y._placementDirty=!1;Y._contentUpdated=!1;Y._drawTexturesDirty=
!1;Y._drawTexturesAnimateDirty=!1;Y._hasUnusedRenderTargets=!1;Y._longitudeCyclical=null;Y._latestOriginId=0;Y._maxResolution=n("esri-mobile")?2048:4096;Y._animationTimeLast=0;return Y}b._inheritsLoose(ka,ia);var la=ka.prototype;la.initialize=function(){const Y=this.view;this.renderer=new L.OverlayRenderer({view:Y,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference});this._groundIntersector=H.newIntersector(this.view.state.viewingMode);this._groundIntersector.options.backfacesTerrain=
!0;this._groundIntersector.options.invisibleTerrain=!0;this._groundIntersector.options.hud=!1;this._handles.add([this.renderer.events.on("has-highlights",()=>{this.setDrawTexturesDirty();this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",ea=>{var ba;return null==(ba=Y._stage)?void 0:ba.renderView.setRenderParameters({hasOverlayWater:ea})}),this.renderer.events.on("renders-occluded",()=>{this.setDrawTexturesDirty();this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",
()=>this.setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),f.watch(()=>{var ea,ba,Z;return[null==(ea=Y.pointsOfInterest)?void 0:ea.renderPointOfView,null==(ba=Y.pointsOfInterest)?void 0:null==(Z=ba.centerOnSurfaceFrequent)?void 0:Z.location]},()=>this.setPlacementDirty()),f.watch(()=>{var ea;return null==(ea=Y.state)?void 0:ea.pixelRatio},()=>this.setPlacementDirty(),f.sync),this.surface.on("elevation-change",()=>this.setPlacementDirty()),Y.on("resize",
()=>this.setPlacementDirty()),d.addFrameTask({preRender:ea=>{this._contentUpdated=!1;this.renderer.processSyncDrapeSources();this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(ea),this._drawOverlayTextures(this.renderer.overlays,J.RenderRequestType.UPDATE));this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}}),Y.resourceController.scheduler.registerTask(S.TaskPriority.OVERLAY,this),Y._stage.renderView.events.on("force-camera-for-screenshot",ea=>{this._updateOverlays(ea,J.RenderRequestType.BACKGROUND);
this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,J.RenderRequestType.BACKGROUND,ea)})])};la.destroy=function(){this.renderer.dispose();this._handles&&(this._handles.destroy(),this._handles=null);k.isSome(U)&&(U.hide(),U=null)};la.setSpatialReference=function(Y){this._spatialReference=Y;this.renderer.spatialReference=Y;this._longitudeCyclical=null;const ea=this.view.renderSpatialReference;k.isSome(Y)&&k.isSome(ea)?(this._renderSR=ea,this._overlaySREqualsRenderSR=Y.equals(this._renderSR),
this._isSpherical&&(this._longitudeCyclical=Y.isWebMercator?new l.Cyclical(-2.0037508342787E7,2.0037508342787E7):new l.Cyclical(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()};la.registerDrapeSource=function(Y,ea,ba){this._drapeSources.add(Y);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);ea=this.renderer.createDrapeSourceRenderer(Y,ea,ba);this._updateDrapeSourceExtent(Y);
this._setContentDirty();this.notifyChange("running");return ea};la.registerGeometryDrapeSource=function(Y){return this.registerDrapeSource(Y,O.SortedRenderGeometryRenderer)};la._updateDrapeSourceExtent=function(Y){2===this.renderer.overlays.length&&k.isSome(Y.setDrapingExtent)&&k.isSome(this._spatialReference)&&Y.setDrapingExtent(this.renderer.overlays,this._spatialReference)};la.unregisterDrapeSource=function(Y){this._drapeSources.has(Y)&&(this._drapeSources.delete(Y),this.renderer.removeDrapeSourceRenderer(Y),
this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))};la.registerDrapeTarget=function(Y){this._drapeTargets.add(Y);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)};la.updateOverlayResult=function(){var Y;null==(Y=this.view._stage)?void 0:Y.renderView.setRenderParameters({overlays:this.renderer.overlays})};la.unregisterDrapeTarget=function(Y){this._drapeTargets.delete(Y);this.renderer.ensureDrapeTargets(this._drapeTargets)};
la._setContentDirty=function(){this.setPlacementDirty();this.setDrawTexturesDirty()};la.setPlacementDirty=function(){this._placementDirty=!0};la.runTask=function(){this._updateOverlays(this.view.state.camera,J.RenderRequestType.UPDATE)};la._updateOverlays=function(Y,ea){if(this._spatialReference){var ba=M.computeOverlayResolution(Y.fullWidth,Y.fullHeight,this._maxResolution);this._computeOverlayExtents(Y,ba,R);var Z=p.width(R.inner)/p.width(R.outer);this.renderer.ensureOverlays(this._drapeTargets,
this._drapeSources);Y=this._updateOverlay(N.OverlayIndex.INNER,R.inner,ba,1*R.pixelRatioAdjustment,R.mapUnitsPerPixel);ba=this._updateOverlay(N.OverlayIndex.OUTER,R.outer,ba,Z*R.pixelRatioAdjustment,R.mapUnitsPerPixel);if(Y===ha.EXTENT||ba===ha.EXTENT)this._drapeSources.forEach(fa=>this._updateDrapeSourceExtent(fa)),this.surface.updateTileOverlayParams(ea);Y===ha.NONE&&ba===ha.NONE||this.setDrawTexturesDirty();this._placementDirty=!1}};la._updateOverlay=function(Y,ea,ba,Z,fa){if(0===this.renderer.overlays.length)return ha.NONE;
Y=this.renderer.overlays[Y];const ja=Y.mapUnitsPerPixel;Y.mapUnitsPerPixel=fa;Y.pixelRatio=Z;{Z=Y.extent;const oa=P.TESTS_DISABLE_OPTIMIZATIONS?0:1E-5*Math.max(ea[2]-ea[0],ea[3]-ea[1],Z[2]-Z[0],Z[3]-Z[1]);Z=Math.abs(Z[0]-ea[0])<=oa&&Math.abs(Z[1]-ea[1])<=oa&&Math.abs(Z[2]-ea[2])<=oa&&Math.abs(Z[3]-ea[3])<=oa}if(Z&&ba===Y.resolution)return ja===fa?ha.NONE:ha.RERENDER_ONLY;p.copy(Y.extent,ea);Y.resolution=ba;ea=p.center(Y.extent);Y.renderLocalOrigin=I.fromValues(ea[0],ea[1],0,`OV_${this._latestOriginId++}`);
return ha.EXTENT};la.setTileParameters=function(Y){const ea=Y.renderData.overlay;if(0<this.renderer.overlays.length){const ba=this.renderer.overlays[N.OverlayIndex.INNER],Z=this.renderer.overlays[N.OverlayIndex.OUTER];Y=p.intersection(Y.extent,this.surface.extent,V);this._rectInsideRect(ba.extent,Y)||this._rectanglesOverlap(Y,ba.extent)||this._rectanglesOverlap(Y,Z.extent)?(this._setTileOverlayData(Y,N.OverlayIndex.INNER,ea),this._setTileOverlayData(Y,N.OverlayIndex.OUTER,ea)):(this._clearTileOverlayData(N.OverlayIndex.INNER,
ea),this._clearTileOverlayData(N.OverlayIndex.OUTER,ea))}else this._clearTileOverlayData(N.OverlayIndex.INNER,ea),this._clearTileOverlayData(N.OverlayIndex.OUTER,ea)};la.overlayPixelSizeInMapUnits=function(Y){if(0===this.renderer.overlays.length)return 0;const ea=this.renderer.overlays[N.OverlayIndex.INNER],ba=this.renderer.overlays[N.OverlayIndex.OUTER];Y=this._pointIsInExtent(Y,ea.extent)?ea:ba;return(Y.extent[2]-Y.extent[0])/Y.resolution};la._setTileOverlayData=function(Y,ea,ba){if(0!==this.renderer.overlays.length){var Z=
this.renderer.overlays[ea].extent,fa=p.width(Z),ja=p.height(Z),oa=Y[0];if(this._longitudeCyclical){oa=this._longitudeCyclical.minimalMonotonic(Z[0],oa);const sa=this._longitudeCyclical.minimalMonotonic(Z[0],Y[2]);oa>sa&&(oa=sa-(Y[2]-Y[0]))}ba.setScale(ea,p.width(Y)/fa,p.height(Y)/ja);ba.setOffset(ea,(oa-Z[0])/fa,(Y[1]-Z[1])/ja)}};la._clearTileOverlayData=function(Y,ea){ea.setScale(Y,-1,-1);ea.setOffset(Y,-1,-1)};la.reloadShaders=function(){var Y=b._asyncToGenerator(function*(){Q.removeLoadedShaderModules();
yield this.renderer.reloadShaders();this.setDrawTexturesDirty();this.runTask()});return function(){return Y.apply(this,arguments)}}();la._dispatchAnimationUpdate=function(Y){const ea=e.Milliseconds(Y.time-this._animationTimeLast);if(ea>=this.surface.view._stage.renderView.animationTimestep||k.isSome(this.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty)this.renderer.updateAnimation({dt:ea,forcedTime:this.forcedAnimationTime,camera:this.view.state.camera})&&(this._drawTexturesAnimateDirty=
!0),this._animationTimeLast=Y.time};la.setDrawTexturesDirty=function(){this.renderer.hasOverlays?this._drawTexturesDirty=this._contentUpdated=!0:this.setPlacementDirty()};la._intersectGroundFromView=function(Y,ea,ba,Z){ba=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(Y,ca,ea,ba);if(k.isNone(ba))return!1;ea=ba.origin;ba=B.add(W,ba.origin,ba.direction);this._groundIntersector.reset(ea,ba,Y);this._groundIntersector.intersect([],null);this.view.basemapTerrain.intersect(this._groundIntersector,
null,ea,ba);return this._groundIntersector.results.min.getIntersectionPoint(Z)};la._findHorizonBasedPointOfInterest=function(Y,ea){var ba=.5;ba=this.view.renderCoordsHelper.getAltitude(Y.eye);const Z=this.view.pointsOfInterest.centerOnSurfaceFrequent;var fa=g.clamp(Z.estimatedSurfaceAltitude,Y.aboveGround?-Infinity:ba+1E-5,Y.aboveGround?ba-1E-5:Infinity);ba=Y.aboveGround;if("global"===this.view.viewingMode){var ja=W;D.closestPointOnSilhouette(D.fromRadius(D.tmpSphere,A.getReferenceEllipsoid(this.view.spatialReference).radius+
fa),y.wrap(Y.eye,Y.viewForward),ja);B.subtract(ja,ja,Y.eye);fa=l.cyclicalPI.normalize(E.angleAroundAxis(Y.viewForward,ja,Y.viewRight))/Y.fovY+.5;ja=0>=fa||1<=fa?.5:.55;ba=ba?ja*fa:fa+ja*(1-fa)}else fa=C.fromValues(0,Math.tan(.5*Math.PI-Math.acos(-Y.viewForward[2])),1,0),fa=u.transformMat4(fa,fa,Y.projectionMatrix)[1],fa=g.clamp(.5+.5*fa,0,1),ba=1===fa||0===fa?.5:ba?.55*fa:1-.55*(1-fa);return this._intersectGroundFromView(Y,.5,ba,ea)?B.sqrDist(ea,Y.eye)<Z.distance*Z.distance:!1};la._computeOverlayExtents=
function(Y,ea,ba){var Z=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,fa=q.create();this._findHorizonBasedPointOfInterest(Y,fa)||B.copy(fa,Z);var ja=Math.max(.1,B.distance(Y.eye,fa));Z=G.viewAngle(this.view.renderCoordsHelper,Z,Y.eye);const oa=Math.PI/2-Math.abs(Z-Math.PI/2);P.OVERLAY_SHOW_CENTER?(k.isNone(U)&&(U=new K.PointGraphics(this.view.graphics,"red")),U.show(fa,this._renderSR)):k.isSome(U)&&U.hide();this._overlaySREqualsRenderSR||z.projectVectorToVector(fa,this._renderSR,
fa,this._spatialReference);Z=this.surface.extent;var sa=!this._isSpherical&&k.isSome(this._spatialReference)&&this._spatialReference.isGeographic,qa=sa&&k.isSome(this._spatialReference)?1/A.getReferenceEllipsoid(this._spatialReference).metersPerDegree:1;ja=Y.perRenderPixelRatio*ja*qa;ba.mapUnitsPerPixel=ja/this._worldToPCSRatio;ja=ea*ja/2;var Ha=!1;sa=sa?90:Infinity;this._isSpherical&&k.isSome(Z)&&k.isSome(this._spatialReference)&&(this._spatialReference.isWebMercator?(ja/=Math.cos(F.y2lat(fa[1])),
sa=Z[3]):(Ha=!0,ja/=A.getReferenceEllipsoid(this._spatialReference).metersPerDegree,sa=90),ja>=sa&&(ja=sa,fa[1]=0,this._spatialReference.isWebMercator&&(fa[0]=0)));qa=1;Ha&&(qa=1/Math.max(.2,Math.cos(Math.abs(g.deg2rad(fa[1])))),180<ja*qa&&(qa=180/ja),ba.mapUnitsPerPixel*=qa);Ha=Math.log(2)/12;ja=Math.exp(Math.round(Math.log(ja)/Ha)*Ha);const Ga=ja*qa;Ha=.5*ea/(32*Ga);var pa=.5*ea/(32*ja);fa[0]=Math.round(fa[0]*Ha)/Ha;fa[1]=Math.round(fa[1]*pa)/pa;Ha=ba.inner;Ha[0]=fa[0]-Ga;Ha[1]=fa[1]-ja;Ha[2]=fa[0]+
Ga;Ha[3]=fa[1]+ja;this._isSpherical&&this._shiftExtentToFitBounds(Ha,Infinity,sa);pa=ba.outer;6*Ga>p.width(Z)?p.copy(pa,k.unwrap(Z)):oa<=.25*Math.PI?(pa[0]=Ha[0]-Ga,pa[1]=Ha[1]-ja,pa[2]=Ha[2]+Ga,pa[3]=Ha[3]+ja):(z.projectVectorToVector(Y.eye,this._renderSR,W,this._spatialReference),x.subtract(aa,fa,W),Y=-Math.atan2(aa[1],aa[0])+.125*Math.PI,0>Y&&(Y+=2*Math.PI),u.scale(aa,T[Math.floor(Y/(.25*Math.PI))],2*ja),aa[0]*=qa,aa[2]*=qa,u.add(pa,Ha,aa));this._isSpherical?(pa[0]=this._longitudeCyclical.clamp(pa[0]),
pa[2]=this._longitudeCyclical.clamp(pa[2]),pa[1]=Math.max(pa[1],-sa),pa[3]=Math.min(pa[3],sa)):(Y=p.intersection(Ha,Z,V),fa=p.intersection(pa,Z,da),p.contains(Y,fa)&&(pa[2]=pa[0],pa[3]=pa[1]));ea=Math.abs(Ha[2]-Ha[0])/ea;ba.mapUnitsPerPixel=Math.max(ba.mapUnitsPerPixel,ea);ba.pixelRatioAdjustment=ba.mapUnitsPerPixel/ea};la._drawOverlayTextures=function(Y,ea,ba=this.view.state.camera){if(0!==Y.length&&(this._drawTexturesDirty||this._drawTexturesAnimateDirty)){var Z=this._drawTexturesDirty;this._drawTexturesAnimateDirty=
this._drawTexturesDirty=!1;var fa=this._drawOverlay(Y[N.OverlayIndex.INNER],ba);Y=this._drawOverlay(Y[N.OverlayIndex.OUTER],ba);fa!==J.ValidationState.CHANGED&&Y!==J.ValidationState.CHANGED||this.surface.updateTileOverlayParams(J.RenderRequestType.UPDATE);this._collectUnusedRenderTargetMemory();this.updateOverlayResult();Z?(this.surface.requestRender(ea),ea===J.RenderRequestType.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(J.RenderRequestType.BACKGROUND)}};la._drawOverlay=function(Y,
ea){this._longitudeCyclical?Y.setupGeometryViewsCyclical(this._longitudeCyclical):Y.setupGeometryViewsDirect();return Y.draw(this.renderer,ea.pixelRatio)};la._collectUnusedRenderTargetMemory=function(){this._hasUnusedRenderTargets=!1;if(this.renderer.hasOverlays){const Y=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(Y)}};la._rectanglesOverlap=function(Y,ea){return k.isNone(Y)?!1:this._longitudeCyclical?(this._longitudeCyclical.contains(ea[0],ea[2],Y[0])||
this._longitudeCyclical.contains(ea[0],ea[2],Y[2])||this._longitudeCyclical.contains(Y[0],Y[2],ea[0]))&&!(Y[1]>ea[3]||Y[3]<ea[1]):p.intersects(Y,ea)};la._rectInsideRect=function(Y,ea){return k.isNone(ea)?!1:this._longitudeCyclical?this._longitudeCyclical.contains(Y[0],Y[2],ea[0])&&this._longitudeCyclical.contains(Y[0],Y[2],ea[2])&&ea[1]>Y[1]&&ea[3]<Y[3]:p.contains(Y,ea)};la._pointIsInExtent=function(Y,ea){if(this._longitudeCyclical)return this._longitudeCyclical.contains(ea[0],ea[2],Y.x)&&Y.y>=ea[1]&&
Y.y<=ea[3];const ba=Y.x;Y=Y.y;return ba>ea[0]&&ba<ea[2]&&Y>ea[1]&&Y<ea[3]};la._shiftExtentToFitBounds=function(Y,ea,ba){let Z=0,fa=0;Y[0]<-ea?Z=Y[0]+ea:Y[2]>ea&&(Z=ea-Y[2]);Y[1]<-ba?fa=Y[1]+ba:Y[3]>ba&&(fa=ba-Y[3]);p.offset(Y,Z,fa)};b._createClass(ka,[{key:"running",get:function(){return this._placementDirty&&(0<this._drapeSources.size||0<this.view.graphics.length||P.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}},{key:"_isSpherical",get:function(){return this.view.state.isGlobal}},
{key:"_worldToPCSRatio",get:function(){return k.isSome(this._spatialReference)&&this._spatialReference.isGeographic&&!this.view.state.isLocal?A.getReferenceEllipsoid(this._spatialReference).metersPerDegree:1}},{key:"view",get:function(){return this.surface.view}},{key:"updating",get:function(){return this.running||this.renderer.updating||this._contentUpdated}},{key:"hasHighlights",get:function(){return this.renderer.hasHighlights}},{key:"rendersOccluded",get:function(){return this.renderer.rendersOccluded}},
{key:"hasOverlays",get:function(){return this.renderer.hasOverlays}},{key:"gpuMemoryUsage",get:function(){return this.renderer.gpuMemoryUsage}},{key:"test",get:function(){return{renderer:this.renderer,update:()=>this.runTask()}}}]);return ka}(m);c.__decorate([h.property()],a.OverlayManager.prototype,"_spatialReference",void 0);c.__decorate([h.property({readOnly:!0})],a.OverlayManager.prototype,"running",null);c.__decorate([h.property()],a.OverlayManager.prototype,"_placementDirty",void 0);c.__decorate([h.property()],
a.OverlayManager.prototype,"_contentUpdated",void 0);c.__decorate([h.property()],a.OverlayManager.prototype,"_isSpherical",null);c.__decorate([h.property()],a.OverlayManager.prototype,"_worldToPCSRatio",null);c.__decorate([h.property()],a.OverlayManager.prototype,"renderer",void 0);c.__decorate([h.property({constructOnly:!0})],a.OverlayManager.prototype,"surface",void 0);c.__decorate([h.property({readOnly:!0,aliasOf:"surface.suspended"})],a.OverlayManager.prototype,"suspended",void 0);c.__decorate([h.property({readOnly:!0})],
a.OverlayManager.prototype,"updating",null);c.__decorate([h.property({type:Boolean})],a.OverlayManager.prototype,"hasHighlights",null);c.__decorate([h.property({type:Boolean})],a.OverlayManager.prototype,"rendersOccluded",null);a.OverlayManager=c.__decorate([t.subclass("esri.views.3d.terrain.OverlayManager")],a.OverlayManager);const aa=C.create(),W=q.create(),R={inner:p.create(),outer:p.create(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},V=p.create(),da=p.create(),ca=y.create();var ha;(function(ia){ia[ia.NONE=
0]="NONE";ia[ia.EXTENT=1]="EXTENT";ia[ia.RERENDER_ONLY=2]="RERENDER_ONLY"})(ha||(ha={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/parts/requireUtils":function(){define(["exports"],function(a){a.removeLoadedShaderModules=function(){var b;const c=null==(b=globalThis.require)?void 0:b.modules;if(c){b=Object.keys(c);for(const m of b)-1!==m.search(".glsl")&&delete c[m]}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/terrain/PlanarPatch":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/spatialReferenceUtils ./PatchGeometryFactory ./Tile ../webgl-engine/materials/internal/MaterialUtil".split(" "),function(a,b,c,m,l,r,n,g,k,f,d,e,h){let v=
function(t){function x(q,u,C){var z=t.call(this)||this;z.horizontalScaleFactor=1;z.extentInRenderSR=g.create();void 0!==q&&z.init(q,u,C);return z}b._inheritsLoose(x,t);var B=x.prototype;B.init=function(q,u,C){t.prototype.init.call(this,q,u,C);q=C.view.renderSpatialReference;C=C.spatialReference;this.horizontalScaleFactor=u=c.isSome(q)&&f.isPlateCarree(q)&&C.isGeographic?this.ellipsoid.radius*Math.PI/180:1;C=this.extentInRenderSR;q=this.extent;if(this.surface.isWebMercatorOnPlateeCarree)u=m.fromValues(q[0],
q[1],0),l.projectVectorToVector(u,r.WebMercator,u,r.PlateCarree),q=m.fromValues(q[2],q[3],0),l.projectVectorToVector(q,r.WebMercator,q,r.PlateCarree),C[0]=u[0],C[1]=u[1],C[2]=q[0],C[3]=q[1];else for(let z=0;4>z;++z)C[z]=q[z]*u;this.centerAtSeaLevel[0]=.5*(C[0]+C[2]);this.centerAtSeaLevel[1]=.5*(C[1]+C[3]);this.centerAtSeaLevel[2]=0;this._edgeLen=Math.max(C[2]-C[0],C[3]-C[1]);this._edgeLen2=this._edgeLen*this._edgeLen;this.updateRadiusAndCenter()};B.updateRadiusAndCenter=function(){this._updateCenter();
var q=this.extentInRenderSR;const u=.5*(q[2]-q[0]);q=.5*(q[3]-q[1]);this._center[e.CenterPosition.MIDDLE][3]=Math.max(Math.sqrt(u*u+q*q),.5*(this.elevationBounds[0]-this.elevationBounds[1]))};B._isVisible=function(q){return k.intersectsAABB(q,this._aabb())};B._aabb=function(){const q=this.extentInRenderSR;return n.wrap(q[0],q[1],this.elevationBounds[0],q[2],q[3],this.elevationBounds[1])};B.intersectsRay=function(q,u,C,z){w[0]=1/u[0];w[1]=1/u[1];w[2]=1/u[2];return h.intersectAabbInvDirBefore(this._aabb(),
q,w,C,z)};B.createGeometry=function(){d.createPlanarGlobePatch(this.renderData,this.horizontalScaleFactor);this.setMemoryDirty()};B.getDefaultVerticesPerRowOnLevel=function(){return 9>this.level?3:2};B.updateCornerElevations=function(){d.updateCornerElevationsPlanar(this.renderData,this.horizontalScaleFactor)};B.updateEdgeElevations=function(){d.updateEdgesElevationsAndNormalsPlanar(this.renderData,this.horizontalScaleFactor)};return x}(e.Tile);const w=m.create();a.PlanarPatch=v;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/PatchGeometryFactory":function(){define("exports ../../../core/mathUtils ../../../core/maybe ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ./ElevationData ./interfaces ./PatchGeometry ./PatchGeometryLUT ./PatchRenderData ./TerrainConst ./terrainUtils".split(" "),function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w){function t(Y,
ea,ba,Z,fa,ja){const oa=ea-1;var sa=Y.vertexAttributes.count,qa=2*(Math.min(ea-2,Z[1])-Math.max(1,Z[0]))*(Math.min(ea-2,fa[1])-Math.max(1,fa[0]));const Ha=w.neighborEdgeIndices.map((Qa,wa)=>0===wa&&fa[1]<ea-2||1===wa&&Z[1]<ea-2||2===wa&&1<fa[0]||3===wa&&1<Z[0]);var Ga=Y.outerEdges.reduce((Qa,wa,Ja)=>Qa+(Ha[Ja]?0:oa-2+wa.count-1),0);const pa=ba.reduce((Qa,wa)=>Qa+oa*(2*(wa.latitudeResolution-1)+1),0);qa=3*(qa+Ga+pa)*(ja?2:1);const Da=new (65536<sa?Uint32Array:Uint16Array)(qa);let ra=0;sa=(Qa,wa,Ja)=>
{Da[ra++]=Qa;Da[ra++]=wa;Da[ra++]=Ja};Ga=(Qa,wa,Ja)=>{Da[ra++]=Qa;Da[ra++]=wa;Da[ra++]=wa;Da[ra++]=Ja;Da[ra++]=Ja;Da[ra++]=Qa};const Ea=ja?Ga:sa,Ia=ea-2,Ma=oa-2;(()=>{for(let Qa=Math.max(fa[0],1)-1;Qa<Math.min(fa[1],ea-2)-1;++Qa)for(let wa=Math.max(Z[0],1)-1;wa<Math.min(Z[1],ea-2)-1;++wa){const Ja=Qa*Ia+wa,Ta=Ja+1,Xa=Ta+Ia,ma=Xa-1;Ea(Ja,Ta,Xa);Ea(Xa,ma,Ja)}})();(()=>{for(let wa=0;4>wa;++wa){if(Ha[wa])continue;const Ja=Y.outerEdges[wa],Ta=Y.innerEdges[wa];let Xa=0,ma=0;const $a=Ja.count,xa=Ta.count;
oa-2+Ja.count-1;const Ka=1===wa||2===wa?(Oa,Va,Ra)=>Ea(Oa,Va,Ra):(Oa,Va,Ra)=>Ea(Oa,Ra,Va);for(;Xa<$a-1||ma<xa-1;){const Oa=Ta.getVertexOffset(ma),Va=Ja.getVertexOffset(Xa);var Qa=Xa<$a-1;const Ra=ma<xa-1,za=Qa?oa*(Xa+.5)/($a-1):0,ya=Ra?1+Ma*(ma+.5)/(xa-1):0;Qa&&(!Ra||za<=ya)?(++Xa,Qa=Ja.getVertexOffset(Xa),Ka(Oa,Va,Qa)):(++ma,Qa=Ta.getVertexOffset(ma),Ka(Oa,Va,Qa))}}})();ba.forEach(Qa=>{let wa=Y.outerEdges[Qa.connectedOuterEdgeOffset].offset0;for(let Ja=0;Ja<Qa.latitudeResolution;++Ja){const Ta=0===
Ja?Qa.rowOffset:wa+ea;for(let Xa=0;Xa<oa;Xa++)Ea(wa,wa+1,Ta+Xa),Ja<Qa.latitudeResolution-1&&Ea(wa+1,Ta+Xa+1,Ta+Xa),++wa;wa=Ta}});Y.indices=Da;Y.indexCount=qa}function x(Y,ea){const ba=Y.localOrigin,Z=Y.geometryInfo;Y=Y.geometryState.neighborData.edgeResolutions;const fa=Z.numVerticesPerSide-2,ja=Z.vertexAttributes.position.typedBuffer;for(let sa=0;4>sa;++sa){var oa=0===sa||2===sa;Z.innerEdges[sa]=new d.EdgeDescriptor(ja,ba,(0===sa?fa-1:0)*fa+(1===sa?fa-1:0),(oa?0:1)*fa+(oa?1:0),fa);oa=Y[sa]+1;Z.outerEdges[sa]=
new d.EdgeDescriptor(ja,ba,ea,1,oa);ea+=oa}}function B(Y,ea){A(Y,ea);var ba=Y.geometryState.clippingArea,Z=Y.tile.extent;ba=c.isSome(ba)&&(Z[0]<ba[0]||Z[2]>ba[2]||Z[1]<ba[1]||Z[3]>ba[3])?K:P;for(Z=0;4>Z;++Z)ba(Y,Z,ea);L(Y,ea)}function q(Y,ea,ba,Z,fa){const ja=Math.cos(ba);ba=Math.sin(ba);const oa=Math.sin(ea);Z=fa+Z;Y[0]=Math.cos(ea)*ja*Z;Y[1]=oa*ja*Z;Y[2]=ba*Z}function u(Y,ea,ba){return Y?Z=>(Math.PI/2-2*Math.atan(Math.exp(-Z/ea)))*ea:Z=>Z*ba}function C(Y,ea){var ba=Y.geometryState;const Z=Y.tile,
fa=Z.extent,ja=c.unwrapOr(ba.clippingArea,fa);var oa=Y.geometryInfo;const sa=oa.boundingBox,qa=oa.outerEdges,Ha=ba.neighborData.cornerNeighborData,Ga=oa.uvOffsetAndScale[2],pa=oa.uvOffsetAndScale[3],Da=0<Ga?1/Ga:1,ra=0<pa?1/pa:1,Ea=-oa.uvOffsetAndScale[0]*Da,Ia=-oa.uvOffsetAndScale[1]*ra;oa=Z.surface.isWebMercatorOnPlateeCarree;const Ma=u(oa,oa?Z.ellipsoid.radius:0,ea),Qa=ba.samplerData,wa=ba.neighborData.edgeNeighbours,Ja=Y.localOrigin;Y=(Ta,Xa,ma,$a,xa)=>{var Ka=fa[1]*(1-xa)+fa[3]*xa,Oa=b.clamp(fa[0]*
(1-$a)+fa[2]*$a,ja[0],ja[2]);Ka=b.clamp(Ka,ja[1],ja[3]);var Va=[Ka===fa[3],Oa===fa[2],Ka===fa[1],Oa===fa[0]];const Ra=!Va[3]&&!Va[1]||!Va[0]&&!Va[2];Va=Ra?Va[0]&&c.isSome(wa[0])?wa[0]:Va[1]&&c.isSome(wa[1])?wa[1]:Va[2]&&c.isSome(wa[2])?wa[2]:Va[3]&&c.isSome(wa[3])?wa[3]:null:null;ma=Ra?Va?Va.neighborTile.level===Z.level?.5*(k.sampleElevationOrZero(Oa,Ka,Qa)+k.sampleElevationOrZero(Oa,Ka,Va.neighborSamplerData)):k.sampleElevationOrZero(Oa,Ka,Va.neighborSamplerData):k.sampleElevationOrZero(Oa,Ka,Qa):
Ha[ma].elevation;Oa=Oa*ea-Ja[0];Ka=Ma(Ka)-Ja[1];ma-=Ja[2];I(Oa,Ka,ma,sa);$a=b.clamp(Ea+$a*Da,0,1);xa=b.clamp(Ia+xa*ra,0,1);Ta.setVertexRawXYZUV(Xa,Oa,Ka,ma,$a,xa)};for(ba=0;4>ba;++ba)oa=qa[ba],Y(oa,0,0===ba?3:1===ba?1:2,1===ba?1:0,0===ba?1:0),Y(oa,oa.count-1,2===ba?1:3===ba?3:0,3===ba?0:1,2===ba?0:1)}function z(Y){p(Y,(ea,ba,Z,fa)=>{var ja=Y.tile.extentInRadians;q(ea,ja[0===ba?0:2],ja[0===Z?1:3],fa,Y.tile.ellipsoid.radius)})}function A(Y,ea){const ba=Y.tile;c.isSome(ba.renderData.geometryState.clippingArea)?
C(Y,ea):p(Y,(Z,fa,ja,oa)=>{var sa=Y.tile.extent,qa=u(ba.surface.isWebMercatorOnPlateeCarree,ba.ellipsoid.radius,ea);ja=0===ja?sa[1]:sa[3];Z[0]=(0===fa?sa[0]:sa[2])*ea;Z[1]=qa(ja);Z[2]=oa})}function p(Y,ea){var ba=Y.geometryInfo;const Z=ba.outerEdges,fa=Y.geometryState.neighborData.cornerNeighborData,ja=ba.boundingBox,oa=Y.localOrigin;Y=(sa,qa,Ha,Ga,pa)=>{ea(T,Ha,Ga,fa[qa].elevation);for(qa=0;3>qa;++qa)T[qa]-=oa[qa];I(T[0],T[1],T[2],ja);sa.setVertexRawXYZUV(pa,T[0],T[1],T[2],Ha,Ga)};for(ba=0;4>ba;++ba){const sa=
Z[ba];Y(sa,0===ba?3:1===ba?1:2,1===ba?1:0,0===ba?1:0,0);Y(sa,2===ba?1:3===ba?3:0,3===ba?0:1,2===ba?0:1,sa.count-1)}}function y(Y){var ea,ba;const Z=Y.vao;Y=Y.geometryInfo.vertexAttributes;null==Z?void 0:null==(ea=Z.vertexBuffers)?void 0:null==(ba=ea.geometry)?void 0:ba.setSubData(Y.position.typedBuffer)}function D(Y){z(Y);for(let ea=0;4>ea;++ea)E(Y,ea);M(Y)}function E(Y,ea){var ba,Z,fa,ja=Y.geometryState,oa=ja.neighborData;const sa=Y.tile;sa.level;const qa=sa.extent;var Ha=qa[2]-qa[0],Ga=qa[3]-qa[1],
pa=sa.extentInRadians;const Da=pa[0];pa[1];const ra=pa[2];pa[3];const Ea=sa.ellipsoid.radius,Ia=N(Y);pa=oa.edgeNeighbours[ea];const Ma=oa.edgeResolutions[ea],Qa=1===ea||3===ea;oa=1===ea?1:0;var wa=0===ea?1:0,Ja=qa[0]+oa*Ha;Ga=qa[1]+wa*Ga;var Ta=Da*(1-oa)+ra*oa;const Xa=Ia(wa);pa=null==pa?void 0:pa.neighborTile;var ma=sa.level-(null!=(ba=null==pa?void 0:pa.level)?ba:sa.level);const $a=2**ma,xa=Ma*$a,Ka=(ib=>{if(!ib)return 0;const mb=Qa?0:1;ib=sa.lij[mb+1]-ib.lij[mb+1]*$a;return(Qa?$a-1-ib:ib)*Ma})(pa),
Oa=null==pa?void 0:pa.extent;ba=(ea+2)%4;const Va=ja.samplerData,Ra=null==pa?void 0:null==(Z=pa.renderData)?void 0:null==(fa=Z.geometryState)?void 0:fa.samplerData;Z=pa&&0===ma;fa=(ib,mb,tb,Bb)=>.5*(k.sampleElevationOrZero(ib,mb,Ra)+k.sampleElevationOrZero(tb,Bb,Va));ja=(ib,mb)=>k.sampleElevationOrZero(ib,mb,Ra);const za=Z?fa:ja;let ya=Oa?1===ba?Oa[2]:Oa[0]:Ja,Na=Oa?0===ba?Oa[3]:Oa[1]:Ga;fa=(ib,mb,tb)=>{ib=(Ka+ib)/xa;Na=Oa[1]*(1-ib)+Oa[3]*ib;return za(ya,Na,mb,tb)};ja=(ib,mb,tb)=>{ib=(Ka+ib)/xa;ya=
Oa[0]*(1-ib)+Oa[2]*ib;return za(ya,Na,mb,tb)};fa=pa?Qa?fa:ja:(ib,mb,tb)=>k.sampleElevationOrZero(mb,tb,Va);let Wa=oa,bb=Ja,Aa=Ta,Pa=wa,ab=Ga,fb=Xa,hb=Math.sin(Aa),kb=Math.cos(Aa),nb=Math.cos(fb),rb=Math.sin(fb);const sb=Qa?()=>Ia(Pa):()=>Xa;oa=ib=>{Pa=ib;ab=qa[1]*(1-ib)+qa[3]*ib;fb=sb();nb=Math.cos(fb);rb=Math.sin(fb)};wa=ib=>{Wa=ib;bb=qa[0]*(1-ib)+qa[2]*ib;Aa=Da*(1-Wa)+ra*Wa;hb=Math.sin(Aa);kb=Math.cos(Aa)};oa=Qa?oa:wa;ja=Y.geometryInfo;wa=ja.boundingBox;Ta=ja.vertexAttributes;Ja=Ta.position.typedBuffer;
Ga=Ta.uv0.typedBuffer;Ta=Ta.normal.typedBuffer;ja=ja.outerEdges[ea];ma=ja.getVertexOffset(1);ba=Ma+1;var jb=Y.localOrigin;Y=jb[0];const qb=jb[1];jb=jb[2];const ob=sa.surface.shadingEnabled;var db=1===ea?-1:3===ea?1:0;ea=0===ea?-1:2===ea?1:0;Ha/=Ma;const va=db*Ha,ta=ea*Ha,Fa=1/Ma*db,Sa=1/Ma*ea,Ya=ib=>{m.sub(aa,ib,V);m.cross(W,aa,ca);m.cross(R,W,aa);m.add(ha,ha,R)};for(Ha=1;Ha<ba-1;++Ha){oa(Ha/Ma);ea=fa(Ha,bb,ab);var cb=Ea+ea;ea=kb*nb*cb;db=hb*nb*cb;const ib=rb*cb,mb=ea-Y,tb=db-qb,Bb=ib-jb;I(mb,tb,
Bb,wa);cb=v.GEOMETRY_VERTEX_STRIDE*ma;Ja[cb+0]=mb;Ja[cb+1]=tb;Ja[cb+2]=Bb;Ga[cb+0]=Wa;Ga[cb+1]=Pa;ob&&(m.set(ha,0,0,0),m.set(V,ea,db,ib),m.normalize(ca,V),ea=(xb,Hb)=>{Hb=k.sampleElevationOrZero(bb+xb*va,ab+xb*ta,Hb);Hb=Ea+Hb;var Ub=Wa+xb*Fa,Mb=Da*(1-Ub)+ra*Ub;Ub=Math.sin(Mb);Mb=Math.cos(Mb);xb=Ia(Pa+xb*Sa);const vb=Math.cos(xb);xb=l.fromValues(Mb*vb*Hb,Ub*vb*Hb,Math.sin(xb)*Hb);Ya(xb)},pa&&ea(-1,Ra),pa&&!Z||ea(1,Va),Ta[cb+0]=ha[0],Ta[cb+1]=ha[1],Ta[cb+2]=ha[2]);++ma}if(ob)for(pa=1;pa<ba-1;++pa)ja.getVertexRawNormal(ha,
pa),ja.getVertex(V,pa),m.normalize(ca,V),ja.getVertex(U,pa-1),Ya(U),ja.getVertex(U,pa+1),Ya(U),m.normalize(ha,ha),ja.setVertexRawNormal(pa,ha[0],ha[1],ha[2])}function F(Y,ea,ba,Z,fa,ja,oa){const sa=(Ha,Ga)=>k.sampleElevationOrZero(Ha,Ga,ba),qa=(Ha,Ga)=>k.sampleElevationOrZero(Ha,Ga,Z);return oa===fa?!Y||ea?sa:null:oa===ja?Y?qa:null:null}function G(Y,ea,ba,Z){if(ea!==Y)return()=>0;Y=ea?3:2;const fa=ea?1:0,ja=Z(Y,fa),oa=Z(fa,Y),sa=(null!=ja?1:0)+(null!=oa?1:0),qa=ea?ba:0,Ha=ea?0:ba;return(Ga,pa,Da)=>
((null!=ja?-(ja(Ga+qa,pa+Ha)-Da):0)+(null!=oa?+(oa(Ga-qa,pa-Ha)-Da):0))/sa}function P(Y,ea,ba){var Z=Y.geometryState.neighborData,fa=Y.tile,ja=fa.surface,oa=ja.shadingEnabled,sa=Z.edgeResolutions[ea],qa=fa.extent;const Ha=sa+1,Ga=Z.edgeNeighbours[ea];Z=Y.localOrigin;const pa=Y.geometryState.samplerData;var Da=(Oa,Va)=>k.sampleElevationOrZero(Oa,Va,pa),ra=(Oa,Va)=>.5*(k.sampleElevationOrZero(Oa,Va,Ga.neighborSamplerData)+k.sampleElevationOrZero(Oa,Va,pa)),Ea=(Oa,Va)=>k.sampleElevationOrZero(Oa,Va,
Ga.neighborSamplerData);const Ia=(null==Ga?void 0:Ga.neighborTile.level)===fa.level;ra=Ia?ra:Ea;Da=c.isSome(Ga)?ra:Da;ra=Y.geometryInfo;Y=ra.outerEdges[ea];ja=u(ja.isWebMercatorOnPlateeCarree,fa.ellipsoid.radius,ba);Ea=ra.boundingBox;ra=1===ea||3===ea;const Ma=1===ea?qa[2]:qa[0],Qa=0===ea?qa[3]:qa[1],wa=1===ea?1:0,Ja=0===ea?1:0;fa=(qa[2]-qa[0])/sa;const Ta=null==Ga?void 0:Ga.neighborSamplerData,Xa=c.isSome(Ga);var ma=(Oa,Va)=>F(Xa,Ia,pa,Ta,Oa,Va,ea);const $a=G(ra,!0,fa,ma);ma=G(ra,!1,fa,ma);for(let Oa=
1;Oa<Ha-1;++Oa){var xa=Oa/sa,Ka=ra?Ma:qa[0]*(1-xa)+qa[2]*xa;const Va=ra?qa[1]*(1-xa)+qa[3]*xa:Qa,Ra=ra?wa:xa;xa=ra?xa:Ja;const za=Da(Ka,Va),ya=Ka*ba-Z[0],Na=ja(Va)-Z[1],Wa=za-Z[2];I(ya,Na,Wa,Ea);if(oa){const bb=$a(Ka,Va,za);Ka=ma(Ka,Va,za);Y.setVertexRawXYZUVN(Oa,ya,Na,Wa,Ra,xa,bb,Ka,fa)}else Y.setVertexRawXYZUV(Oa,ya,Na,Wa,Ra,xa)}if(oa)for(ba=ra?0:1,oa=ra?1:0,sa=1;sa<Ha-1;++sa)Y.getNormal(ia,sa),qa=Y.getVertexZ(sa-1),Z=Y.getVertexZ(sa+1),Z=qa-Z,qa=ia[0]+.5*ba*Z,Z=ia[1]+.5*oa*Z,Da=2*fa,ja=1/Math.sqrt(qa*
qa+Z*Z+Da*Da),Y.setVertexRawNormal(sa,ja*qa,ja*Z,ja*Da)}function K(Y,ea,ba){var Z=Y.geometryState.neighborData,fa=Y.tile,ja=fa.level,oa=fa.surface,sa=oa.shadingEnabled;const qa=Z.edgeNeighbours[ea];var Ha=Z.edgeResolutions[ea],Ga=fa.extent,pa=Y.geometryState,Da=c.unwrapOr(pa.clippingArea,S),ra=Y.geometryInfo,Ea=ra.uvOffsetAndScale[0];Z=ra.uvOffsetAndScale[1];var Ia=Ea+ra.uvOffsetAndScale[2],Ma=Z+ra.uvOffsetAndScale[3];Ia=Ia>Ea?1/(Ia-Ea):1;Ma=Ma>Z?1/(Ma-Z):1;Ea=-Ea*Ia;const Qa=-Z*Ma;Z=Ha+1;var wa=
[Ga[3]>Da[3],Ga[2]>Da[2],Ga[1]<Da[1],Ga[0]<Da[0]];const Ja=pa.samplerData;pa=(Wa,bb)=>k.sampleElevationOrZero(Wa,bb,Ja);const Ta=(null==qa?void 0:qa.neighborTile.level)===ja;var Xa=(Wa,bb)=>{const Aa=k.sampleElevationOrZero(Wa,bb,qa.neighborSamplerData);return Ta?.5*(Aa+k.sampleElevationOrZero(Wa,bb,Ja)):Aa};Xa=c.isSome(qa)?Xa:pa;wa=wa[ea]?pa:Xa;pa=ra.outerEdges[ea];Xa=ra.boundingBox;ra=1===ea||3===ea;const ma=b.clamp(1===ea?Ga[2]:Ga[0],Da[0],Da[2]),$a=b.clamp(0===ea?Ga[3]:Ga[1],Da[1],Da[3]),xa=1===
ea?1:0,Ka=0===ea?1:0;Y=Y.localOrigin;oa=u(oa.isWebMercatorOnPlateeCarree,fa.ellipsoid.radius,ba);fa=(Ga[2]-Ga[0])/Ha;const Oa=null==qa?void 0:qa.neighborSamplerData,Va=c.isSome(qa),Ra=(null==qa?void 0:qa.neighborTile.level)===ja;var za=(Wa,bb)=>F(Va,Ra,Ja,Oa,Wa,bb,ea);ja=G(ra,!0,fa,za);za=G(ra,!1,fa,za);for(let Wa=1;Wa<Z-1;++Wa){var ya=Wa/Ha,Na=ra?ma:b.clamp(Ga[0]*(1-ya)+Ga[2]*ya,Da[0],Da[2]);const bb=ra?b.clamp(Ga[1]*(1-ya)+Ga[3]*ya,Da[1],Da[3]):$a,Aa=ra?xa:b.clamp(Ea+ya*Ia,0,1);ya=ra?b.clamp(Qa+
ya*Ma,0,1):Ka;const Pa=wa(Na,bb),ab=Na*ba-Y[0],fb=oa(bb)-Y[1],hb=Pa-Y[2];I(ab,fb,hb,Xa);if(sa){const kb=ja(Na,bb,Pa);Na=za(Na,bb,Pa);pa.setVertexRawXYZUVN(Wa,ab,fb,hb,Aa,ya,kb,Na,fa)}else pa.setVertexRawXYZUV(Wa,ab,fb,hb,Aa,ya)}if(sa)for(ba=ra?0:1,sa=ra?1:0,Ha=1;Ha<Z-1;++Ha)pa.getNormal(ia,Ha),Ga=pa.getVertexZ(Ha-1),Da=pa.getVertexZ(Ha+1),Da=Ga-Da,Ga=ia[0]+.5*ba*Da,Da=ia[1]+.5*sa*Da,Ia=2*fa,Ma=1/Math.sqrt(Ga*Ga+Da*Da+Ia*Ia),pa.setVertexRawNormal(Ha,Ma*Ga,Ma*Da,Ma*Ia)}function N(Y){Y=Y.tile;if(Y.surface.isWebMercator){const ba=
Y.extent,Z=Y.ellipsoid.radius;return fa=>{var ja=ba[1];return Math.PI/2-2*Math.atan(Math.exp(-(ja+fa*(ba[3]-ja))/Z))}}const ea=Y.extentInRadians;return ba=>ea[1]*(1-ba)+ea[3]*ba}function M(Y){Y.tile.surface.shadingEnabled&&H(Y,(ea,ba,Z,fa,ja,oa,sa)=>{{var qa=U;const Ha=N(ba);ba=ba.tile;const Ga=ba.extent;w.internalAssert(g.containsXYWithMargin(Ga,ja,oa,1));ja=(ja-Ga[0])/(Ga[2]-Ga[0]);const pa=ba.extentInRadians;ja=pa[0]*(1-ja)+pa[2]*ja;oa=Ha((oa-Ga[1])/(Ga[3]-Ga[1]));q(qa,ja,oa,sa,ba.ellipsoid.radius)}m.sub(aa,
U,Z);m.cross(W,aa,fa);m.cross(ea,W,aa)})}function L(Y,ea){Y.tile.surface.shadingEnabled&&H(Y,(ba,Z,fa,ja,oa,sa,qa)=>{J(Y,ea)(U,oa,sa,qa);Z=U[0]-fa[0];ja=U[1]-fa[1];fa=U[2]-fa[2];ba[0]=-Z*fa;ba[1]=-ja*fa;ba[2]=Z*Z+ja*ja})}function J(Y,ea){return Y.tile.surface.isWebMercatorOnPlateeCarree?(ba,Z,fa,ja)=>{var oa=Y.tile.ellipsoid.radius;ba[0]=Z*ea;ba[1]=(Math.PI/2-2*Math.atan(Math.exp(-fa/oa)))*oa;ba[2]=ja}:(ba,Z,fa,ja)=>{ba[0]=Z*ea;ba[1]=fa*ea;ba[2]=ja}}function H(Y,ea){var ba;if(Y.tile.surface.shadingEnabled){var Z=
Y.geometryState.neighborData.cornerNeighborData,fa=Y.tile,ja=fa.extent,oa="local"===(null==(ba=Y.tile.surface.view)?void 0:ba.viewingMode);oa&&m.set(ca,0,0,1);{const Ha=(Da,ra,Ea,Ia,Ma,Qa)=>{Da=(1===Qa?Ma.extent[0]:3===Qa?Ma.extent[2]:Da)+O[Ea][0]*Ia;ra=(0===Qa?Ma.extent[1]:2===Qa?Ma.extent[3]:ra)+O[Ea][1]*Ia;w.internalAssert(g.containsXYWithMargin(Ma.extent,Da,ra,1));Ea=k.sampleElevationOrZero(Da,ra,Ma.renderData.geometryState.samplerData);ea(R,Ma.renderData,V,ca,Da,ra,Ea);m.add(ha,ha,R)},Ga=(Da,
ra,Ea,Ia)=>{const Ma=Ea.extent[0===Ia||1===Ia?2:0]+O[Da][0]*ra;Da=Ea.extent[0===Ia||3===Ia?3:1]+O[Da][1]*ra;w.internalAssert(g.containsXYWithMargin(Ea.extent,Ma,Da,1));ra=k.sampleElevationOrZero(Ma,Da,Ea.renderData.geometryState.samplerData);ea(R,Ea.renderData,V,ca,Ma,Da,ra);m.add(ha,ha,R)},pa=(Da,ra,Ea,Ia,Ma,Qa)=>{var wa=O[Da][0]*ra;ra*=O[Da][1];Da=Ea.extent[0===Ia||1===Ia?2:0]+wa;Ia=Ea.extent[0===Ia||3===Ia?3:1]+ra;wa=Ma.extent[0===Qa||1===Qa?2:0]+wa;ra=Ma.extent[0===Qa||3===Qa?3:1]+ra;w.internalAssert(g.containsXYWithMargin(Ea.extent,
Da,Ia,1));w.internalAssert(g.containsXYWithMargin(Ma.extent,wa,ra,1));Qa=k.sampleElevationOrZero(Da,Ia,Ea.renderData.geometryState.samplerData);Ma=k.sampleElevationOrZero(wa,ra,Ma.renderData.geometryState.samplerData);ea(R,Ea.renderData,V,ca,Da,Ia,.5*(Qa+Ma));m.add(ha,ha,R)};ba=Da=>{var ra=0===Da||1===Da?ja[2]:ja[0],Ea=0===Da||3===Da?ja[3]:ja[1];Da=Z[Da].cornerTiles;var Ia=Da.reduce((wa,Ja)=>{var Ta;return Math.min(wa,null!=(Ta=null==Ja?void 0:Ja.level)?Ta:Infinity)},Infinity);for(var Ma=0;4>Ma;++Ma){var Qa=
Da[Ma];la[Ma]=(null==Qa?void 0:Qa.level)===Ia?Qa:null}for(Da=0;4>Da;++Da)if(Ia=la[(Da+3)%4],Ma=la[Da],null!=Ia&&Ia!==fa&&Ia===Ma){Ma=(Ia.extent[2]-Ia.extent[0])/Math.max(Ia.renderData.geometryState.neighborData.edgeResolutions[(Da+2)%4],2**(fa.level-Ia.level));Qa=(Da+0)%4;const wa=(Da+1)%4;Ha(ra,Ea,(Da+3)%4,Ma,Ia,Da);Ha(ra,Ea,Qa,Ma,Ia,Da);Ha(ra,Ea,wa,Ma,Ia,Da);return ha}w.internalAssert(la.some(wa=>(null==wa?void 0:wa.isLoaded)||wa===fa));ra=la.reduce((wa,Ja)=>Ja?Ja.extent[2]-Ja.extent[0]:wa,0);Ea=
la.reduce((wa,Ja)=>{var Ta;return Math.max(wa,null!=(Ta=null==Ja?void 0:Ja.renderData.geometryState.numVerticesPerSide)?Ta:1)},1);ra/=Ea;for(Ea=0;4>Ea;++Ea)if(Da=la[(Ea+3)%4],Ia=la[(Ea+0)%4],Da||Ia)Ma=0===Ea?1:1===Ea?2:2===Ea?3:0,Qa=0===Ea?2:1===Ea?3:2===Ea?0:1,Da&&Ia?pa(Ea,ra,Da,Ma,Ia,Qa):Ga(Ea,ra,null!=Da?Da:Ia,Da?Ma:Qa);return ha};for(var sa=0;4>sa;++sa){var qa=Y.geometryInfo.outerEdges[sa];qa.getVertex(V,1===sa||2===sa?0:qa.count-1);oa||m.normalize(ca,V);m.set(ha,0,0,0);qa=ba(sa);m.normalize(ka[sa],
qa)}}Y=Y.geometryInfo.outerEdges;for(oa=0;4>oa;++oa)ba=Y[oa],sa=ka[0===oa?3:1===oa?1:2],ba.setVertexRawNormal(0,sa[0],sa[1],sa[2]),sa=ka[2===oa?1:3===oa?3:0],ba.setVertexRawNormal(ba.count-1,sa[0],sa[1],sa[2])}}function I(Y,ea,ba,Z){Y<Z[0]?Z[0]=Y:Y>Z[3]&&(Z[3]=Y);ea<Z[1]?Z[1]=ea:ea>Z[4]&&(Z[4]=ea);ba<Z[2]?Z[2]=ba:ba>Z[5]&&(Z[5]=ba)}const O=[[0,1],[1,0],[0,-1],[-1,0]],Q=new e.PatchGeometryLUT,S=g.fromValues(-Infinity,-Infinity,Infinity,Infinity),T=l.create(),U=l.create(),aa=l.create(),W=l.create(),
R=l.create(),V=l.create(),da=l.create(),ca=l.create(),ha=l.create(),ia=l.create(),ka=[l.create(),l.create(),l.create(),l.create()],la=[null,null,null,null];a.createPlanarGlobePatch=function(Y,ea){var ba=Y.tile;const Z=ba.extent,fa=Y.localOrigin,ja=Y.geometryState;var oa=ba.surface;const sa=oa.isWebMercatorOnPlateeCarree,qa=oa.shadingEnabled,Ha=Z[0],Ga=Z[1],pa=Z[2]-Ha,Da=Z[3]-Ga;var ra=ja.clippingArea;oa=c.isSome(ra)?Math.max(0,(ra[0]-Z[0])/pa):0;const Ea=c.isSome(ra)?Math.max(0,(ra[1]-Z[1])/Da):0,
Ia=c.isSome(ra)?Math.min(1,(ra[2]-Z[0])/pa):1,Ma=c.isSome(ra)?Math.min(1,(ra[3]-Z[1])/Da):1;var Qa=Ia-oa,wa=Ma-Ea;const Ja=0<Qa?1/Qa:1,Ta=0<wa?1/wa:1,Xa=-oa*Ja,ma=-Ea*Ta;Qa=ja.numVerticesPerSide;const $a=Qa-1;wa=(Qa-2)**2;var xa=ja.neighborData.edgeResolutions.reduce((fb,hb)=>fb+hb+1,0);wa+=xa;xa=d.acquireTerrainAttributes(wa);const Ka=xa.position.typedBuffer,Oa=xa.uv0.typedBuffer,Va=xa.normal.typedBuffer,Ra=Y.geometryInfo,za=Ra.boundingBox;n.empty(za);let ya=0;ba=ba.ellipsoid.radius;const Na=ja.samplerData;
ra=c.isSome(ra)?ra:S;const Wa=g.fromValues(Math.max(Z[0],ra[0]),Math.max(Z[1],ra[1]),Math.min(Z[2],ra[2]),Math.min(Z[3],ra[3])),bb=fa[0],Aa=fa[1],Pa=fa[2],ab=u(sa,ba,ea);(()=>{for(let qb=1;qb<=$a-1;qb++){var fb=qb/$a,hb=ma+fb*Ta;fb=b.clamp(Ga+fb*Da,Wa[1],Wa[3]);hb=b.clamp(hb,0,1);const ob=ab(fb)-Aa,db=pa/$a;for(let va=1;va<=$a-1;va++){var kb=va/$a,nb=Xa+kb*Ja;kb=b.clamp(Ha+kb*pa,Wa[0],Wa[2]);var rb=b.clamp(nb,0,1);nb=k.sampleElevationOrZero(kb,fb,Na);var sb=kb*ea-bb,jb=nb-Pa;I(sb,ob,jb,za);nb=v.GEOMETRY_VERTEX_STRIDE*
ya;Ka[nb+0]=sb;Ka[nb+1]=ob;Ka[nb+2]=jb;Oa[nb+0]=rb;Oa[nb+1]=hb;if(qa){sb=k.sampleElevationOrZero(kb+db,fb,Na);jb=k.sampleElevationOrZero(kb-db,fb,Na);rb=k.sampleElevationOrZero(kb,fb+db,Na);const ta=k.sampleElevationOrZero(kb,fb-db,Na);kb=.25*(jb-sb);rb=.25*(ta-rb);sb=db;jb=Math.sqrt(kb*kb+rb*rb+sb*sb);Va[nb+0]=kb/jb;Va[nb+1]=rb/jb;Va[nb+2]=sb/jb}++ya}}})();Ra.numVerticesPerSide=ja.numVerticesPerSide;Ra.vertexAttributes=xa;r.set(Y.geometryInfo.uvOffsetAndScale,oa,Ea,Ia-oa,Ma-Ea);x(Y,ya);B(Y,ea);ya=
wa;t(Ra,ja.numVerticesPerSide,[],[0,Qa-1],[0,Qa-1],ja.wireframe);Y.intersectionData=null};a.createSphericalGlobePatch=function(Y,ea){var ba=Y.tile;const {extent:Z,extentInRadians:fa,surface:ja}=ba,oa=Y.localOrigin,sa=Y.geometryState;var qa=ja.isWebMercator;const Ha=ja.shadingEnabled,Ga=sa.numVerticesPerSide,pa=Ga-1,Da=(Ga-2)**2,ra=qa&&(ea===f.PatchType.HAS_SOUTH_POLE||ea===f.PatchType.HAS_BOTH_POLES),Ea=qa&&(ea===f.PatchType.HAS_NORTH_POLE||ea===f.PatchType.HAS_BOTH_POLES);var Ia=6*((ra?1:0)+(Ea?
1:0))*(pa+1);ea=sa.neighborData;qa=ea.edgeResolutions.reduce((Aa,Pa)=>Aa+Pa+1,0);const Ma=d.acquireTerrainAttributes(Da+Ia+qa);Ia=Y.geometryInfo;Ia.numVerticesPerSide=sa.numVerticesPerSide;Ia.vertexAttributes=Ma;r.set(Ia.uvOffsetAndScale,0,0,1,1);const Qa=Ma.position.typedBuffer,wa=Ma.uv0.typedBuffer,Ja=Ma.normal.typedBuffer,Ta=Ia.boundingBox;n.empty(Ta);const Xa=oa[0],ma=oa[1],$a=oa[2];Q.update(pa,fa);let xa=0;const Ka=sa.samplerData,Oa=ba.ellipsoid.radius,Va=N(Y),Ra=Ga-2,za=Z[0],ya=Z[2],Na=Z[1],
Wa=Z[3];(()=>{for(let hb=1;hb<=Ra;hb++){const kb=hb/pa,nb=Na*(1-kb)+Wa*kb;var Aa=Va(kb);const rb=Math.cos(Aa);Aa=Math.sin(Aa);for(let sb=1;sb<=Ra;sb++){const jb=sb/pa;var Pa=Q.sinLonLUT[sb],ab=Q.cosLonLUT[sb],fb=Oa+k.sampleElevationOrZero(za*(1-jb)+ya*jb,nb,Ka);ab=ab*rb*fb-Xa;Pa=Pa*rb*fb-ma;fb=Aa*fb-$a;I(ab,Pa,fb,Ta);const qb=v.GEOMETRY_VERTEX_STRIDE*xa;Qa[qb+0]=ab;Qa[qb+1]=Pa;Qa[qb+2]=fb;wa[qb+0]=jb;wa[qb+1]=kb;++xa}}})();Ha&&(()=>{const Aa=hb=>{m.subtract(aa,hb,da);m.cross(W,aa,ca);m.cross(R,W,
aa);return R},Pa=Ma.position,ab=Ma.normal;xa=0;const fb=(hb,kb,nb)=>{if(1<hb&&1<kb&&hb<Ra&&kb<Ra)Pa.getVec(xa+nb,U);else{nb=hb/pa;var rb=za*(1-nb)+ya*nb;nb=Q.sinLonLUT[hb];hb=Q.cosLonLUT[hb];var sb=kb/pa;kb=Na*(1-sb)+Wa*sb;var jb=Va(sb);sb=Math.cos(jb);jb=Math.sin(jb);rb=Oa+k.sampleElevationOrZero(rb,kb,Ka);m.set(U,hb*sb*rb-Xa,nb*sb*rb-ma,jb*rb-$a)}m.add(ha,ha,Aa(U))};for(let hb=1;hb<=Ra;hb++)for(let kb=1;kb<=Ra;kb++)Pa.getVec(xa,da),m.add(V,da,Y.localOrigin),m.normalize(ca,V),m.set(ha,0,0,0),fb(kb-
1,hb,-1),fb(kb+1,hb,1),fb(kb,hb-1,-Ra),fb(kb,hb+1,+Ra),m.normalize(ha,ha),ab.setVec(xa,ha),++xa})();xa=Da;x(Y,Da);D(Y);xa=Da+qa;const bb=[];(()=>{const Aa=(Pa,ab)=>{ab*=Ga;I(-Xa,-ma,-$a+Pa*Oa,Ta);bb.push({connectedRowOffset:ab,connectedOuterEdgeOffset:1===Pa?0:2,rowOffset:xa,latitudeResolution:6});ab=Math.PI/2-2*Math.atan(Math.exp(-(-1===Pa?Na:Wa)/Oa));const fb=Pa*Math.PI/2-ab;Pa=.99*(1===Pa?1:-1);const hb=Oa+0;for(let rb=1;6>=rb;++rb){var kb=ab+rb/6*fb;const sb=Math.cos(kb);kb=Math.sin(kb);for(let jb=
0;jb<=pa;jb++){var nb=jb/pa;const qb=Q.cosLonLUT[jb]*sb*hb-Xa,ob=Q.sinLonLUT[jb]*sb*hb-ma,db=kb*hb-$a;I(qb,ob,db,Ta);const va=v.GEOMETRY_VERTEX_STRIDE*xa;Qa[va+0]=qb;Qa[va+1]=ob;Qa[va+2]=db;wa[va+0]=nb;wa[va+1]=Pa;Ha&&(nb=1/Math.sqrt(qb*qb+ob*ob+db*db),Ja[va+0]=nb*qb,Ja[va+1]=nb*ob,Ja[va+2]=nb*db);++xa}}};ra&&Aa(-1,0);Ea&&Aa(1,pa)})();t(Ia,sa.numVerticesPerSide,bb,[0,Ga-1],[0,Ga-1],sa.wireframe);Y.intersectionData=null;for(ba=0;4>ba;++ba)w.internalAssert(Ia.outerEdges[ba].count===ea.edgeResolutions[ba]+
1)};a.updateCornerElevationsPlanar=function(Y,ea){A(Y,ea);L(Y,ea);y(Y)};a.updateCornerElevationsSpherical=function(Y){var ea,ba;z(Y);M(Y);const Z=Y.vao;Y=Y.geometryInfo.vertexAttributes;null==Z?void 0:null==(ea=Z.vertexBuffers)?void 0:null==(ba=ea.geometry)?void 0:ba.setSubData(Y.position.typedBuffer)};a.updateEdgesElevationsAndNormalsPlanar=function(Y,ea){B(Y,ea);y(Y)};a.updateEdgesElevationsSpherical=function(Y){D(Y);y(Y)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/terrain/PatchGeometry":function(){define("exports ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/buffer/BufferPool ../support/buffer/InterleavedLayout ./TerrainConst ./terrainUtils ../webgl-engine/lib/VertexAttribute".split(" "),function(a,b,c,m,l,r,n,g){let k=function(){function e(v,w,t,x,B){this._buf=v;this._localOrigin=w;this.offset0=t;this.stride=x;this.count=B}var h=e.prototype;h.getVertexOffset=function(v){n.internalAssert(0<=v&&v<this.count);
return this.offset0+this.stride*v};h.getVertex=function(v,w){w=this.getVertexOffset(w)*r.GEOMETRY_VERTEX_STRIDE;v[0]=this._buf[w+0]+this._localOrigin[0];v[1]=this._buf[w+1]+this._localOrigin[1];v[2]=this._buf[w+2]+this._localOrigin[2]};h.getVertexZ=function(v){v=this.getVertexOffset(v)*r.GEOMETRY_VERTEX_STRIDE;return this._buf[v+2]+this._localOrigin[2]};h.setVertex=function(v,w,t,x){v=this.getVertexOffset(v)*r.GEOMETRY_VERTEX_STRIDE;this._buf[v+0]=w[0]-this._localOrigin[0];this._buf[v+1]=w[1]-this._localOrigin[1];
this._buf[v+2]=w[2]-this._localOrigin[2];this._buf[v+3]=t;this._buf[v+4]=x};h.getNormal=function(v,w){w=this.getVertexOffset(w)*r.GEOMETRY_VERTEX_STRIDE;v[0]=this._buf[w+5];v[1]=this._buf[w+6];v[2]=this._buf[w+7]};h.setVertexRawXYZUV=function(v,w,t,x,B,q){v=this.getVertexOffset(v)*r.GEOMETRY_VERTEX_STRIDE;this._buf[v+0]=w;this._buf[v+1]=t;this._buf[v+2]=x;this._buf[v+3]=B;this._buf[v+4]=q};h.setVertexRawXYZUVN=function(v,w,t,x,B,q,u,C,z){v=this.getVertexOffset(v)*r.GEOMETRY_VERTEX_STRIDE;this._buf[v+
0]=w;this._buf[v+1]=t;this._buf[v+2]=x;this._buf[v+3]=B;this._buf[v+4]=q;this._buf[v+5]=u;this._buf[v+6]=C;this._buf[v+7]=z};h.setVertexRawNormal=function(v,w,t,x){v=this.getVertexOffset(v)*r.GEOMETRY_VERTEX_STRIDE;this._buf[v+5]=w;this._buf[v+6]=t;this._buf[v+7]=x};h.getVertexRawNormal=function(v,w){w=this.getVertexOffset(w)*r.GEOMETRY_VERTEX_STRIDE;v[0]=this._buf[w+5];v[1]=this._buf[w+6];v[2]=this._buf[w+7]};return e}();const f=l.newLayout().vec3f(g.VertexAttribute.POSITION).vec2f(g.VertexAttribute.UV0).vec3f(g.VertexAttribute.NORMAL),
d=new m.BufferPool(e=>f.createBuffer(e),e=>e.count);a.EdgeDescriptor=k;a.PatchGeometry=function(){this.vertexAttributes=this.indices=null;this.boundingBox=c.empty();this.numVerticesPerSide=this.indexCount=0;this.uvOffsetAndScale=b.create();this.outerEdges=[null,null,null,null];this.innerEdges=[null,null,null,null]};a.acquireTerrainAttributes=function(e){return d.acquire(e)};a.clearCaches=function(){d.clear()};a.releaseGeometry=function(e){d.release(e.vertexAttributes);e.vertexAttributes=null;e.indices=
null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/buffer/BufferPool":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/PooledArray"],function(a,b,c){let m=function(){function l(n,g){this._factoryCallback=n;this._lengthCallback=g;this._pool=new Map}var r=l.prototype;r.acquire=function(n){if(!l.test.disabled){var g=this._pool.get(n);if(g&&0!==g.length)return g.pop()}try{return this._factoryCallback(n)}catch(k){g=
window.performance&&window.performance.memory;let f="";g&&(f=`\n  totalJSHeapSize: ${g.totalJSHeapSize}, usedJSHeapSize: ${g.usedJSHeapSize}, jsHeapSizeLimit: ${g.jsHeapSizeLimit}`);console.log("Array allocation of size "+n+" failed: "+k+f);throw k;}};r.release=function(n){if(!l.test.disabled){var g=this._lengthCallback(n),k=this._pool.get(g);k||(k=new c({shrink:!0}),this._pool.set(g,k));k.push(n)}};r.clear=function(){this._pool.clear()};b._createClass(l,[{key:"test",get:function(){return{size:this._pool.size}}}]);
return l}();m.test={disabled:!1};a.BufferPool=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/PatchGeometryLUT":function(){define(["exports","./TerrainConst"],function(a,b){let c=function(){function m(){this.sinLonLUT=Array(b.MAX_PATCH_TESSELATION+1);this.cosLonLUT=Array(b.MAX_PATCH_TESSELATION+1)}m.prototype.update=function(l,r){const n=r[0];r=r[2];for(let k=0;k<=l;k++){var g=k/l;g=n*(1-g)+r*g;this.sinLonLUT[k]=Math.sin(g);this.cosLonLUT[k]=
Math.cos(g)}};return m}();a.PatchGeometryLUT=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/PatchRenderData":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/arrayUtils ../../../core/mathUtils ../../../core/maybe ../../../geometry/support/aaBoundingBox ../../../core/has ../../../geometry/Extent ../../../geometry/support/Ellipsoid ../support/buffer/glUtil ./ElevationData ./GeometryState ./interfaces ./LayerClass ./PatchGeometry ./terrainUtils ./TextureFader ./Tile ./TileOverlayData ./tileUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/BufferObject ../../webgl/VertexArrayObject".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A){n=function(){function p(){this.geometryInfo=new w.PatchGeometry;this.geometryState=this.intersectionData=null;this._textureRef=new x.TextureFader(()=>this.tile.surface.textureFadeDuration);this.overlay=new q;this._geometryStateChangedSinceLastUpdate=!0;this._wireframeChanged=this._clippingAreaChanged=this._cornerElevationChanged=this._edgeNeighborChanged=this._edgeResolutionChanged=this._samplerDataChanged=this._numVerticesPerSideChanged=this._hasGeometry=
!1}var y=p.prototype;y.init=function(D){this._tile=D;this.clear();D=this.geometryInfo;D.indices=null;D.vertexAttributes=null;r.empty(D.boundingBox);D.indexCount=0;D.numVerticesPerSide=0;this.intersectionData=null;this.geometryState=new e.GeometryState;this.localOrigin=null;this.overlay.clear()};y.clear=function(){this._releaseGeometry();this.releaseTexture();this._textureRef.clear()};y.updateGeometryIfChanged=function(D,E){E=this.updateGeometryStateAndPrepareForGeometryGeneration(E);this._hasGeometry=
!0;return this.updateNeighborDataAndGeometryIfNeeded(E,D)};y.updateNeighborDataAndGeometryIfNeeded=function(D=!1,E=this.vao.context){const F=this._updateNeighborData();if(D=D||this._geometryStateChangedSinceLastUpdate||F)this._updateGeometry(E),this._geometryStateChangedSinceLastUpdate=!1;return D};y._calculateEdgeResolution=function(D,E){const F=this.tile,G=this.geometryState.numVerticesPerSide-1;if(!F.surface.isGlobal){var P=F.surface.extent;if(l.isSome(P)&&(0===D&&F.extent[3]>P[3]||1===D&&F.extent[2]>
P[2]||2===D&&F.extent[1]<P[1]||3===D&&F.extent[0]<P[0]))return G}const K=F.level;P=t.neighborEdgeIndices[D];E=E||F.findNeighborTile(P,L=>L.isLoaded||L.level===K);if(!E||E.isLeaf&&!E.isLoaded){var N;t.internalAssert(l.isNone(null==(N=F.surface)?void 0:N.rootTiles)||F.surface.updatingRootTiles||!F.shouldHaveNeighbor(P));return G}if(E.isLoaded)return N=E.renderData.geometryState,E=K-E.level,0===E?Math.max(N.numVerticesPerSide-1,G):Math.max(1,N.neighborData.edgeResolutions[(D+2)%4]/2**E);t.internalAssert(!E.isLeaf);
let M=G;E.forAllSubtreeOnSide(t.oppositeEdge(P),L=>{if(L===F)return!0;if(L.isLoaded)return M=Math.max(M,2**(L.level-K)),!0;t.internalAssert(!L.isLeaf);return!1});return M};y._updateNeighborData=function(){const D=this.tile,E=L=>L.isLoaded||L.level===D.level,F=L=>L.isLoaded,G=[null,null,null,null],P=[null,null,null,null];(()=>{for(let L=0;4>L;++L){const J=D.findNeighborTile(t.neighborEdgeIndices[L],E);G[L]=J;P[L]=null!=J&&J.isLoaded?J:null}})();const K=[null,null,null,null];(()=>{for(let L=0;4>L;++L)K[L]=
D.findNeighborTile(t.neighborCornerIndices[L],F)})();const N=this.geometryState.neighborData;let M=!1;(()=>{for(let L=0;4>L;++L){const J=N.edgeResolutions[L],H=G[L],I=this._calculateEdgeResolution(L,H);N.edgeResolutions[L]=I;J!==I&&(this._edgeResolutionChanged=M=!0,H&&H!==D&&!H.isLoaded&&H.level===D.level&&(N.modifiedEdgeResolutions[L]=!0))}})();(()=>{const L=(I,O)=>{var Q=I.reduce((R,V)=>{var da;return Math.min(R,null!=(da=null==V?void 0:V.level)?da:Infinity)},Infinity);for(var S=0;4>S;++S){var T=
I[(S+3)%4],U=I[S];if(T&&T.level<D.level&&T===U){I=T;var aa=D.getNeighborEdgeStartVertexIndex(S,I);Q=1===(S&1);var W=(aa+(0===O||1===O&&!Q||3===O&&Q?1:0))/2**(D.level-I.level);aa=Q?0===O||1===O?I.extent[0]:I.extent[2]:m.lerp(I.extent[0],I.extent[2],W);Q=Q?m.lerp(I.extent[1],I.extent[3],W):0===O||3===O?I.extent[1]:I.extent[3];return d.sampleElevationOrZero(aa,Q,I.renderData.geometryState.samplerData)}}S=O=0;for(T=0;4>T;++T)if((U=I[T])&&U.level===Q){const R=U.extent;U=d.sampleElevationOrZero(R[0===T||
1===T?0:2],R[0===T||3===T?1:3],null==(aa=U.renderData)?void 0:null==(W=aa.geometryState)?void 0:W.samplerData);S+=U;O++}return O?S/O:0},J=N.cornerNeighborData,H=(I,O)=>{const Q=J[I],S=Q.cornerTiles;for(let U=0;4>U;++U){var T=t.neighborCornerIndices[U];const aa=O[U];T=null==aa?void 0:aa.findCorner(t.oppositeCorner(T),W=>(null==W?void 0:W.isLoaded)||W===D);S[U]=T}I=L(S,I);return Q.elevation!==I?(Q.elevation=I,!0):!1};for(let I=0;4>I;++I){const O=[K[I],P[(I+1)%4],D,P[I]],Q=O.map((S,T)=>O[(T+4-I)%4]);
H(I,Q)&&(M=this._cornerElevationChanged=!0)}})();(()=>{const L=N.edgeNeighbours;for(let Q=0;4>Q;++Q){var J,H=P[Q];H&&(t.internalAssert(null==H?void 0:H.isLoaded),t.internalAssert((null==H?void 0:H.lij[0])<=D.lij[0]));var I=L[Q];const S=null==I?void 0:I.version;if(null==H||!H.isLoaded||H.lij[0]>D.lij[0])H=null;else{var O=H.renderData.geometryState;H={neighborSamplerData:O.samplerData,neighborEdgeOverlapResolution:O.neighborData.edgeResolutions[Q+2],version:O.samplerDataVersion,neighborVerticesPerSide:O.numVerticesPerSide,
neighborTile:H}}O=null!=(J=null==H?void 0:H.version)?J:null;O=I&&H&&S!==O;const T=I&&H&&(null==I?void 0:I.neighborTile)!==(null==H?void 0:H.neighborTile);I=null!=I!==(null!=H)||O||T;this._edgeNeighborChanged||(this._edgeNeighborChanged=I);M||(M=I);if(I||!S)L[Q]=H}})();return M};y.updateEdgeAfterResolutionChange=function(D){var E,F;const G=this._calculateEdgeResolution(D),P=this.geometryState.neighborData.edgeResolutions,K=P[D];t.internalAssert((null!=(E=null==(F=this.geometryState.neighborData.edgeNeighbours[D])?
void 0:F.neighborTile.level)?E:0)<=this.tile.level);G!==K&&(P[D]=G,this._edgeResolutionChanged=!0,p.deferTileNeighborUpdate?p.neighborTilesToUpdate.add(this.tile):this._updateGeometry(this.vao.context))};y._updateGeometry=function(D){this.intersectionData=null;const E=this.tile;var F=E.lij,G=p.updatedGeometryTiles.get(F)||0;p.updatedGeometryTiles.set(F,G+1);F=this.geometryInfo.vertexAttributes;F=!this._vao||!F||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||
this._edgeResolutionChanged;G=!F&&this._edgeNeighborChanged;const P=!G&&this._cornerElevationChanged;this._wireframeChanged=this._clippingAreaChanged=this._cornerElevationChanged=this._edgeNeighborChanged=this._edgeResolutionChanged=this._samplerDataChanged=this._numVerticesPerSideChanged=!1;F?(this._releaseGeometry(),this._createGeometry(D)):G?E.updateEdgeElevations():P?E.updateCornerElevations():console.warn("Update for no reason?")};y.releaseGeometry=function(){return this._releaseGeometry()};
y.ensureTexture=function(D,E){l.isSome(this._texture)&&this._texture.descriptor.width!==D&&this.releaseTexture();l.isNone(this._texture)&&(this._texture=E(),this.tile.setMemoryDirty());return this._texture};y.releaseTexture=function(){l.isSome(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())};y.updateGeometryStateAndPrepareForGeometryGeneration=function(D){const E=this._getElevationInfo();var F=E.samplerData?this.tile.getElevationBasedVerticesPerSide(E.maxTileLevel):
this.tile.getDefaultVerticesPerRowOnLevel();F=Math.max(F,5);let G=this.tile.clippingArea;if(!this.tile.intersectsClippingArea||this.tile.isWithinClippingArea)G=null;const P=this.geometryState;let K=!1;P.numVerticesPerSide!==F&&(this._numVerticesPerSideChanged=!0,P.numVerticesPerSide=F,P.samplerDataVersion++,K=!0);E.changed&&(this._samplerDataChanged=!0,P.samplerData=E.samplerData,P.samplerDataVersion++,K=!0);c.equals(P.clippingArea,G)||(this._clippingAreaChanged=!0,P.clippingArea=G,K=!0);P.wireframe!==
D&&(this._wireframeChanged=!0,P.wireframe=D,K=!0);this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=K);this._hasGeometry=!0;return K};y._createGeometry=function(D){this.tile.createGeometry();const E=this.geometryInfo.vertexAttributes,F=this.geometryInfo.indices,G=D.gl;this._vao=new A.VertexArrayObject(D,C.Default3D,{geometry:f.glLayout(E.layout)},{geometry:z.BufferObject.createVertex(D,G.STATIC_DRAW,E.buffer)},z.BufferObject.createIndex(D,G.STATIC_DRAW,F));this._hasGeometry=
!0};y._releaseGeometry=function(){this._hasGeometry=!1;if(!this._vao)return!1;this._vao.dispose();this._vao=null;w.releaseGeometry(this.geometryInfo);return!0};y.setTextureReference=function(D,E=x.ActivationTime.Immediate){l.isSome(D)&&D.texture!==this._texture&&this.releaseTexture();this._textureRef.push(D,E)};y._getElevationInfo=function(){const D=this.geometryState.samplerData,E=this.tile.layerInfo[v.LayerClass.ELEVATION],F=E.length;let G=Array(F),P=0;var K=0;let N=!1;for(let J=0;J<F;J++){var M=
E[J];if(l.isSome(M.upsampleInfo)){M=M.upsampleInfo.tile;var L=M.layerInfo[v.LayerClass.ELEVATION][J].data;L=L&&L.samplerData;D&&D[P]===L||(N=!0);G[P++]=L;K=Math.max(K,M.lij[0])}else M.data&&(L=this.tile.surface.layerViewByIndex(J,v.LayerClass.ELEVATION),u.fallsWithinLayer(this.tile,L.layer,!1)&&(K=M.data,D&&D[P]===K.samplerData||(N=!0),G[P++]=K.samplerData,K=this.tile.level))}l.isSome(D)&&D.length!==P&&(N=!0);0<P?G.length=P:G=null;return{changed:N,samplerData:G,maxTileLevel:K}};y.checkGeometryWaterproofness=
function(){};b._createClass(p,[{key:"tile",get:function(){return this._tile}},{key:"hasGeometry",get:function(){return this._hasGeometry}},{key:"vao",get:function(){return this._vao}},{key:"textureReference",get:function(){return this._textureRef.current}},{key:"nextTextureReference",get:function(){return this._textureRef.next}},{key:"textureFadeFactor",get:function(){return this._textureRef.fadeFactor}},{key:"textureIsFading",get:function(){return this._textureRef.isFading}},{key:"estimatedGeometryMemoryUsage",
get:function(){const D=l.mapOr(this.intersectionData,0,E=>E.estimatedMemoryUsage);return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength+D}},{key:"textureDescriptor",get:function(){return l.isSome(this._texture)?this._texture.descriptor:null}},{key:"test",get:function(){return{hasTexture:null!=this._texture}}}]);return p}();n.updatedGeometryTiles=new Map;n.deferTileNeighborUpdate=!1;n.neighborTilesToUpdate=new Set;Object.defineProperty(a,"ActivationTime",{enumerable:!0,
get:()=>x.ActivationTime});a.PatchRenderData=n;a.isElevationSampleIn=function(p,y,D){if(l.isSome(D))for(const F of D)if(F){D=F.x0;var E=F.width;const G=D+(E-1)/F.dx,P=F.y1;E=P-(E-1)/F.dy;if(p>=D-t.eps&&p<=G+t.eps&&E-t.eps<=y&&y<=P+t.eps)return!0}return!1};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/GeometryState":function(){define(["exports"],function(a){let b=function(){this.elevation=0;this.normal=[0,0,1];this.cornerTiles=[null,
null,null,null]},c=function(){this.edgeNeighbours=[null,null,null,null];this.cornerNeighborData=[new b,new b,new b,new b];this.edgeResolutions=[1,1,1,1];this.modifiedEdgeResolutions=[!1,!1,!1,!1]};a.CornerNeighborData=b;a.EdgeNeighborData=function(){};a.GeometryState=function(){this.numVerticesPerSide=0;this.clippingArea=this.samplerData=null;this.wireframe=!1;this.samplerDataVersion=0;this.neighborData=new c};a.NeighborhoodData=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/terrain/TextureFader":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","./interfaces"],function(a,b,c,m){let l=function(){function r(g){this._getFadeDuration=g;this._delayedTime=this._fadeStart=0}var n=r.prototype;n.clear=function(){this._current=c.destroyMaybe(this._current);this._next=c.destroyMaybe(this._next);this._waiting=c.destroyMaybe(this._waiting);this._delayed=c.destroyMaybe(this._delayed)};n.push=function(g,k=a.ActivationTime.Immediate){this._delayed=
c.destroyMaybe(this._delayed);this._push(g,k)};n._push=function(g,k){this._isFadingEnabled||this.clear();if(c.isNone(this._current))this._current=g;else{var f=r.test.fadeMoment||performance.now();k!==a.ActivationTime.Immediate?(this._delayed=g,this._delayedTime=f+k):c.isNone(this._next)?(this._next=g,this._fadeStart=this._alignFadeStart(f)):c.isNone(g)||(c.destroyMaybe(this._waiting),this._waiting=g)}};n._alignFadeStart=function(g){const k=this._getFadeDuration();return g+k-g%k};b._createClass(r,
[{key:"current",get:function(){if(c.isNone(this._current))return null;if(!this._isFadingEnabled){var g=this._delayed||this._waiting||this._next||this._current;g!==this._current&&(this._current=null,this.clear(),this._current=g)}g=r.test.fadeMoment;c.isSome(this._delayed)&&(g=g||performance.now(),g>=this._delayedTime&&(this._push(this._delayed,a.ActivationTime.Immediate),this._delayed=null));if(c.isSome(this._next)){g=g||performance.now();var k=this._fadeDuration;const f=c.isSome(this._current)&&this._next.texture===
this._current.texture,d=this._next.type!==m.TextureUpdate.FADING;k=g-this._fadeStart>=k;if(f||d||k)c.destroyMaybe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(g)}return this._current}},{key:"next",get:function(){return this._next}},{key:"fadeFactor",get:function(){if(c.isNone(this._next))return 1;var g=r.test.fadeMoment||performance.now();g=Math.max(0,g-this._fadeStart);const k=this._fadeDuration;return g>k?0:1-g/k}},{key:"isFading",
get:function(){return c.isSome(this._next)||c.isSome(this._delayed)}},{key:"_fadeDuration",get:function(){return c.isNone(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}},{key:"_isFadingEnabled",get:function(){return 0<this._getFadeDuration()}}]);return r}();l.test={fadeMoment:0};a.ActivationTime=void 0;(function(r){r[r.Immediate=0]="Immediate";r[r.Delayed=5E3]="Delayed"})(a.ActivationTime||(a.ActivationTime={}));a.TextureFader=l;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/Tile":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/common ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../../../chunks/sphere ../../2d/engine/vectorTiles/VectorTile ../support/StreamDataLoader ./ElevationBounds ./ElevationTileAgent ./interfaces ./LayerClass ./MapTileAgent ./RasterTile ./TerrainConst ./terrainUtils ./TileAgent ./TilePerLayerInfo ./TileTexture ./TileUpdate ./tileUtils ../../webgl/Util".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G){function P(aa,W,R,V){const da=R===q.LayerClass.ELEVATION?T.acquire():S.acquire();da.init(aa,W,R,V);return da}function K(aa){aa.dispose();aa instanceof x.ElevationTileAgent?T.release(aa):aa instanceof u.MapTileAgent&&S.release(aa)}function N(aa,W,R){return Math.abs(aa-W)<=R}function M(aa,W,R){return m.isNone(aa)||m.isNone(W)||W===aa?!1:aa.level>=W.level?L(aa,W,R):L(W,aa,A.oppositeCorner(R))}function L(aa,W,R){A.internalAssert(aa.level>=
W.level);var V=A.isWestCorner(R),da=A.isNorthCorner(R);R=aa.extent;const ca=W.extent;var ha=[V?R[0]:R[2],da?R[3]:R[1]];const ia=[V?ca[2]:ca[0],da?ca[1]:ca[3]];V=1E-5*(R[2]-R[0]);da=N(ha[0],ia[0],V)||aa.surface.isGlobal&&N(ha[0],-ia[0],V);ha=N(ha[1],ia[1],V);return da&&ha?!0:aa.level===W.level||!da&&!ha?!1:da?J(ca[1],ca[3],R[1],R[3],V):J(ca[0],ca[2],R[0],R[2],V)}function J(aa,W,R,V,da=f.EPSILON){return aa-da<=R&&R<=V&&V<=W+da}const H=k.create(),I=k.create(),O=k.create();let Q=function(){function aa(){this.lij=
[0,0,0];this._children=[null,null,null,null];this._pendingUpdates=0;this._dirty=!0;this._previouslyRendered=!1;this.extent=e.create();this._elevationBounds=n.create();this.layerInfo=[[],[]];this.extentInRadians=e.create();this.centerAtSeaLevel=k.create();this._center=[k.create(),h.create(),k.create()];this.up=k.unitZ();this._intersectsClippingArea=this._isWithinClippingArea=!0;this._maxTesselation=0;this._usedMemory=null;this._curvatureHeight=this._edgeLen2=this._edgeLen=this.renderOrder=this._screenDepth=
this._mapDataRefCount=this._mapTileMemory=0}aa.prune=function(){S.prune(0);T.prune(0);y.TilePerLayerInfo.prune()};var W=aa.prototype;W.computeVisibility=function(){this._dirty=!1;const R=this._intersectsClippingArea&&this._isVisible(this.surface.frustum);R!==this._visible&&(this._visible=R,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setNeedsRender(),this.updateAgentSuspension());return this._visible};W.init=function(R,V,da){this.lij[0]=R[0];this.lij[1]=R[1];this.lij[2]=R[2];
this.ellipsoid=d.getReferenceEllipsoid(da.tilingScheme.spatialReference);da.tilingScheme.getExtent(R[0],R[1],R[2],this.extent);da.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians);this._intersectsClippingArea=this._isWithinClippingArea=!0;this._clippingArea=null;this._mapDataRefCount=0;da.upsampleMapCache.pop(this.key);this._edgeLen2=this._edgeLen=0;this._center[a.CenterPosition.MIDDLE][3]=0;this.vlevel=R?R[0]:0;V&&V.elevationBounds?r.copy(this._elevationBounds,V.elevationBounds):
r.set(this._elevationBounds,0,0);this._pendingUpdates=0;this.renderData=null;this._screenDepth=0;this._previouslyRendered=this._visible=!1;this._parent=V;this.unsetChildren();this._surface=da;this.updateVisibility();for(const ca of q.LayerClasses){R=da.numLayers(ca);V=this.layerInfo[ca];for(const ha of V)ha.release();V.length=R;for(let ha=0;ha<R;ha++)V[ha]=y.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool),ca===q.LayerClass.ELEVATION&&this.findElevationBoundsForLayer(ha,-1)}this.computeElevationBounds();
this._maxTesselation=Math.min(da.tilingScheme.pixelSize,z.MAX_PATCH_TESSELATION)};W.release=function(){A.weakAssert(!this.renderData,"tile.renderData was not unloaded");this._surface.upsampleMapCache.pop(this.key);for(const R of q.LayerClasses){for(const V of this.layerInfo[R])V.release();this.layerInfo[R].length=0}this._surface=this._parent=null;this.setMemoryDirty()};W.refMapData=function(){++this._mapDataRefCount;this.isCached||this._surface.upsampleMapCache.pop(this.key)};W.unrefMapData=function(){--this._mapDataRefCount;
if(this.isCached){this.setMemoryDirty();const R=this.cachedMemory;0<R&&this._surface.upsampleMapCache.put(this.key,this,R)}};W.setMemoryDirty=function(){this._usedMemory=null};W._ensureUsedMemory=function(){if(m.isSome(this._usedMemory))return this._usedMemory;let R=this._mapTileMemory=this._usedMemory=0;for(var {data:V}of this.layerInfo[q.LayerClass.MAP])V instanceof v.VectorTile?R+=this._getTerrainDataMemory(V):this._mapTileMemory+=this._getTerrainDataMemory(V);V=this.cpuImageMemorySize;for(const da of this.layerInfo[q.LayerClass.ELEVATION])this._usedMemory+=
da.data?V:0;this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemory+=G.getGpuMemoryUsage(this.renderData.textureDescriptor));this.isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemory+R);return this._usedMemory};W.getUsedMemoryForLayer=function(R,V){V=this.layerInfo[R][V];return null!=V&&V.data?R===q.LayerClass.MAP?this.isCached?0:this._getTerrainDataMemory(V.data):R===q.LayerClass.ELEVATION?this.cpuImageMemorySize:0:0};
W._getTerrainDataMemory=function(R){return R instanceof D?G.getGpuMemoryUsage(R.texture):R instanceof HTMLImageElement||R instanceof w.ImageWithType?this.cpuImageMemorySize:R instanceof v.VectorTile||R instanceof C.RasterTile?R.memoryUsage:0};W.updateScreenDepth=function(R){var V=this._center[a.CenterPosition.MIDDLE];const da=V[0],ca=V[1];V=V[2];const ha=R[2]*da+R[6]*ca+R[10]*V+R[14];this._screenDepth=0>ha?0:ha/(R[3]*da+R[7]*ca+R[11]*V+R[15])};W.shouldSplit=function(R,V,da){if(m.isSome(R.frustum)&&
(!this._intersectsClippingArea||!this._isVisible(R.frustum)))return E.TileUpdate.NONE;const ca=this.level;g.subtract(H,this._center[a.CenterPosition.MIDDLE],V);var ha=g.squaredLength(H);let ia=a.CenterPosition.MIDDLE;g.subtract(I,this._center[a.CenterPosition.TOP],V);var ka=g.squaredLength(I);ka<ha&&(ha=ka,ia=a.CenterPosition.TOP);g.subtract(I,this._center[a.CenterPosition.BOTTOM],V);ka=g.squaredLength(I);ka<ha&&(ha=ka,ia=a.CenterPosition.BOTTOM);if(this._edgeLen2>ha&&ca<R.maxLod)return E.TileUpdate.SPLIT;
ha=Math.sqrt(ha);const la=this._edgeLen/(R.fovX*ha*2);ka=()=>{const ba=ca+Math.ceil(-Math.log2(R.relativeWidthLimit/la));return ba!==this.vlevel?(this.vlevel=ba,E.TileUpdate.VSPLITMERGE):E.TileUpdate.NONE_HIT_MAXLOD};if(da===B.LODSnapping.ON&&1===this._surface.snapLevel-ca)return ca>=R.maxLod?ka():E.TileUpdate.SPLIT;const Y=g.dot(this.up,H);da=this._elevationBounds[1]-this._elevationBounds[0];const ea=da/this.edgeLen;return R.aboveGround&&0<Y&&.001>ea&&0<Y/ha-Math.sin(this._curvatureHeight/(this.edgeLen*
Math.SQRT1_2)*Math.PI)-ea?E.TileUpdate.NONE:la<R.relativeWidthLimit?this.vlevel!==this.level?(this.vlevel=this.level,E.TileUpdate.VSPLITMERGE):E.TileUpdate.NONE:ca>=R.maxLod?ka():6<ca&&(g.subtract(I,this._center[ia],V),g.scale(O,this.up,Y),g.subtract(O,O,I),ka=g.squaredLength(O),ka>this.radius*this.radius&&(g.scale(O,O,this.radius/Math.sqrt(ka)),g.add(O,O,this._center[ia]),g.subtract(O,V,O),Math.min(1,(Math.abs(g.dot(O,this.up))+.5*da+this._curvatureHeight)/g.length(O))*(this._edgeLen/(R.fovY*ha*
2))<.1/R.angledSplitBias*R.relativeHeightLimit))?E.TileUpdate.NONE:E.TileUpdate.SPLIT};W.setChildren=function(R,V,da,ca){A.weakAssert(!!(R&&V&&da&&ca),"Null child passed");this._children[0]=R;this._children[1]=V;this._children[2]=da;this._children[3]=ca};W.unsetChildren=function(){this._children[0]=null;this._children[1]=null;this._children[2]=null;this._children[3]=null};W.prepareToLoad=function(R){this.refMapData();for(const V of q.LayerClasses)this._createOrUpdateAgents(0,V);R.updateTileGeometryState(this)};
W.load=function(R){this.prepareToLoad(R);this.loadPrepared(R)};W.loadPrepared=function(R){R.loadTile(this)};W.unload=function(R){R.unloadTile(this);for(const V of q.LayerClasses){R=this.layerInfo[V];for(const da of R)da.loadingAgent&&da.loadingAgent!==p.TILE_AGENT_DONE&&(K(da.loadingAgent),da.loadingAgent=null),da.pendingUpdates=0}this.resetPendingUpdate(E.TileUpdate.GEOMETRY);this.resetPendingUpdate(E.TileUpdate.TEXTURE_NOFADING);this.resetPendingUpdate(E.TileUpdate.TEXTURE_FADING);this.unrefMapData()};
W.unloadMapData=function(){const R=this.layerInfo[q.LayerClass.MAP];for(const V of R)V.loadingAgent&&V.loadingAgent!==p.TILE_AGENT_DONE&&(K(V.loadingAgent),V.loadingAgent=null),V.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture();this.setMemoryDirty()};W.updateClippingStatus=function(R){if(e.equals(R,this._clippingArea))return!1;var V=this._intersectsClippingArea;const da=this._isWithinClippingArea;m.isSome(R)?(this._intersectsClippingArea=this.intersectsExtent(R),this._isWithinClippingArea=
this._isWithinExtent(R)):this._isWithinClippingArea=this._intersectsClippingArea=!0;this._clippingArea=R;this.updateVisibility();R=da&&this._isWithinClippingArea;V=!da&&!V&&!this._isWithinClippingArea&&!this._intersectsClippingArea;!this.renderData||R||V||this.setPendingUpdate(E.TileUpdate.GEOMETRY);return!0};W.updateVisibility=function(){this._dirty=!0;this._surface.setTileTreeDirty()};W.getLayerInfo=function(R,V){return this.layerInfo[V][R]};W.hasLayerData=function(R,V){R=this.layerInfo[V][R];return!(!R||
!R.data||R.dataInvalidated)};W._isSuspended=function(R){return this.hasPendingUpdate(E.TileUpdate.SPLIT)?!0:R===q.LayerClass.ELEVATION?!1:!this.loadable};W.hasPendingUpdate=function(R){return(this._pendingUpdates&R)===R};W.setPendingUpdate=function(R){this._pendingUpdates|=R;R===E.TileUpdate.SPLIT||R===E.TileUpdate.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()};W.resetPendingUpdate=function(R){return this.hasPendingUpdate(R)?(this._pendingUpdates&=~R,!0):!1};W.requestLayerData=
function(R,V,da){const ca=this.layerInfo[V][R];if(ca.waitingAgents.has(da))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),da.tile.lij.toString(),V,R),!0;ca.waitingAgents.push(da);if(ca.data&&!ca.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),da.tile.lij.toString(),V,R),da.dataArrived(this),!0;if(ca.requestPromise)return!0;m.abortMaybe(ca.requestAbort);
ca.requestAbort=new AbortController;const ha=this._surface.requestTileData(this,R,V,ca.requestAbort);if(!ha)return ca.requestAbort=null,!1;R=()=>{ca.requestPromise===ha&&(ca.requestPromise=null,ca.requestAbort=null)};ca.requestPromise=ha;ha.then(R,R);return!0};W.hasLij=function(R){return this.lij[0]===R[0]&&this.lij[1]===R[1]&&this.lij[2]===R[2]};W.findByLij=function(R){return this.hasLij(R)?this:this.isLeaf?null:(R=this._children[0].findByLij(R)||this._children[1].findByLij(R)||this._children[2].findByLij(R)||
this._children[3].findByLij(R))?R:null};W.distanceToSquared=function(R){return g.squaredLength(g.subtract(O,this._center[a.CenterPosition.MIDDLE],R))};W.containsPoint=function(R){const V=this.extent;return R[0]>=V[0]&&R[1]>=V[1]&&R[0]<=V[2]&&R[1]<=V[3]};W.unrequestLayerData=function(R,V,da){R=this.layerInfo[V][R];V=R.waitingAgents;da=null!=V.removeUnordered(da);A.weakAssert(da,"agent has not requested this piece of map data");1>V.length&&(R.abortRequest(),this.setMemoryDirty())};W.dataArrived=function(R,
V,da){R=this.layerInfo[V][R];R.data=da;R.dataInvalidated=!1;R.waitingAgents.forAll(ca=>ca.dataArrived(this));R.waitingAgents.clear();this.setMemoryDirty()};W.dataMissing=function(R,V,da){da.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${V}/${R} error ${da}`);R=this.layerInfo[V][R];R.dataMissing=!0;R.waitingAgents.forAll(ca=>ca.dataMissing());R.waitingAgents.clear();this.setMemoryDirty()};W.updateRenderData=function(R,V){switch(R){case q.LayerClass.MAP:return this._updateTexture(V);
case q.LayerClass.ELEVATION:return this._updateGeometry()}};W._updateTexture=function(R){this.renderData&&(this.resetPendingUpdate(R===B.TextureUpdate.FADING?E.TileUpdate.TEXTURE_NOFADING:E.TileUpdate.TEXTURE_FADING),this.setPendingUpdate(R===B.TextureUpdate.FADING?E.TileUpdate.TEXTURE_FADING:E.TileUpdate.TEXTURE_NOFADING))};W._updateGeometry=function(){this.setPendingUpdate(E.TileUpdate.GEOMETRY);for(const R of this.layerInfo[q.LayerClass.ELEVATION])R.pendingUpdates|=E.TileUpdate.GEOMETRY};W.invalidateLayerData=
function(R,V){this.layerInfo[V][R].invalidateSourceData();this.restartAgents(V)};W.computeElevationBounds=function(){const R=this._elevationBounds;r.set(R,Number.MAX_VALUE,-Number.MAX_VALUE);const V=this.layerInfo[q.LayerClass.ELEVATION];let da=!0;for(const ca of V)m.isSome(ca.elevationBounds)&&(R[0]=Math.min(R[0],ca.elevationBounds.min),R[1]=Math.max(R[1],ca.elevationBounds.max),ca.elevationBounds.hasNoDataValues||(da=!1));da&&(R[0]=Math.min(R[0],0),R[1]=Math.max(R[1],0));this.updateRadiusAndCenter();
this._surface.setTileTreeDirty()};W._updateCenter=function(){const R=this._elevationBounds;g.scale(O,this.up,.5*(R[0]+R[1]));g.add(this._center[a.CenterPosition.MIDDLE],this.centerAtSeaLevel,O);g.scale(O,this.up,R[0]);g.add(this._center[a.CenterPosition.TOP],this.centerAtSeaLevel,O);g.scale(O,this.up,R[1]);g.add(this._center[a.CenterPosition.BOTTOM],this.centerAtSeaLevel,O)};W.findElevationBoundsForLayer=function(R,V){const da=this.layerInfo[q.LayerClass.ELEVATION][R];if(!(m.isSome(da.elevationBounds)&&
da.elevationBounds.level>=V)&&(V=this._surface.layerViewByIndex(R,q.LayerClass.ELEVATION),V=A.getLayerWithExtentRange(V),F.fallsWithinLayer(this,V,!1))){V=U;var ca=!1;if(da.data)R=da.data,V.min=R.bounds[0],V.max=R.bounds[1],V.hasNoDataValues=R.hasNoDataValues,V.level=this.level,ca=!0;else{let ha=0,ia,ka;for(let la=this._parent;la&&(!ka||ha<z.getElevationDesiredResolutionLevel(this.level))&&!(ha=this.vlevel-la.level,ia=ka||ia,ka=la.layerInfo[q.LayerClass.ELEVATION][R].data,!ka&&ia&&ha>=z.getElevationDesiredResolutionLevel(this.level));la=
la.parent);if(ka=ka||ia)ka.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],V),Infinity!==V.min&&(V.level=ka.level,ca=!0)}ca&&(m.isNone(da.elevationBounds)&&(da.elevationBounds=new t.ElevationBounds),da.elevationBounds.copyFrom(V))}};W.modifyLayers=function(R,V,da){da=this.layerInfo[da];for(var ca of da)ca.loadingAgent&&ca.loadingAgent!==p.TILE_AGENT_DONE&&(K(ca.loadingAgent),ca.loadingAgent=null),ca.waitingAgents.clear();for(ca=0;ca<da.length;++ca)void 0===R[ca]&&da[ca].release();R=Array(...da);
ca=V.length;da.length=ca;for(let ha=0;ha<ca;ha++){const ia=V[ha];da[ha]=-1<ia?R[ia]:y.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()};W.restartAgents=function(R){this.renderData&&(this._createOrUpdateAgents(0,R),this.updateRenderData(R,B.TextureUpdate.FADING))};W.updateAgents=function(R){if(this.renderData){const V=this.layerInfo[R];for(const da of V)da.loadingAgent===p.TILE_AGENT_DONE&&(da.loadingAgent=null);this._createOrUpdateAgents(0,R)}};W.updateAgentSuspension=
function(){for(const R of q.LayerClasses){const V=this._isSuspended(R);for(const da of this.layerInfo[R])da.loadingAgent&&da.loadingAgent!==p.TILE_AGENT_DONE&&(da.loadingAgent.setSuspension(V),da.loadingAgent===p.TILE_AGENT_DONE&&this.updateRenderData(R,B.TextureUpdate.FADING))}};W.removeLayerAgent=function(R,V){R=this.layerInfo[V][R];R.loadingAgent&&R.loadingAgent!==p.TILE_AGENT_DONE&&R.loadingAgent.dispose();R.loadingAgent=null};W.agentDone=function(R,V){const da=this.layerInfo[V][R];da.loadingAgent=
p.TILE_AGENT_DONE;!da.data&&m.isNone(da.upsampleInfo)&&this._createOrUpdateAgents(R+1,V)};W._createOrUpdateAgents=function(R,V){const da=this.layerInfo[V];if(0!==da.length){var ca=(()=>{for(let ia=R;ia<da.length;++ia){const ka=this._surface.layerViewByIndex(ia,V);if(A.isBlendableLayerView(ka)&&"normal"!==ka.layer.blendMode)return!0}return!1})(),ha=this._isSuspended(V);for(let ia=R;ia<da.length;++ia){const ka=da[ia];let la=!1;const Y=this._surface.layerViewByIndex(ia,V),ea=A.getLayerWithExtentRange(Y);
ka.loadingAgent?F.fallsWithinLayer(this,ea,!1)?(ka.loadingAgent!==p.TILE_AGENT_DONE&&ka.loadingAgent.setSuspension(ha),ka.loadingAgent!==p.TILE_AGENT_DONE&&(la=ka.loadingAgent.update())):ka.dispose():F.fallsWithinLayer(this,ea,!1)&&(ka.loadingAgent=P(this,ia,V,ha),(la=ka.loadingAgent.startLoading())?ka.loadingAgent===p.TILE_AGENT_DONE&&this.setPendingUpdate(E.TileUpdate.GEOMETRY):(K(ka.loadingAgent),ka.loadingAgent=p.TILE_AGENT_DONE));ka.loadingAgent===p.TILE_AGENT_DONE&&this.updateRenderData(V,B.TextureUpdate.FADING);
if(!ca&&la&&Y.isOpaque)break}}};W._isWithinExtent=function(R){const V=this.extent;return V[0]>=R[0]&&R[2]>=V[2]&&V[1]>=R[1]&&R[3]>=V[3]};W.intersectsExtent=function(R){const V=this.extent;return V[2]>=R[0]&&R[2]>=V[0]&&V[3]>=R[1]&&R[3]>=V[1]};W.getElevationBasedVerticesPerSide=function(R){const V=this.vlevel-this.level;R=Math.max(this.level-R,z.getElevationDesiredResolutionLevel(this.level)-V);return c.clamp((this.maxTesselation>>R)+1,2,this.maxTesselation+1)};W._findLIJ=function(R,V){if(!R)return null;
var da=this.surface.rootTiles;if(m.isSome(da))for(var ca of da){da=ca.level;var ha=R[0];da>ha?da=!1:(da=ha-da,ha=Math.floor(R[2]/2**da),da=Math.floor(R[1]/2**da)===ca.lij[1]&&ha===ca.lij[2]);if(da){for(da=R[0]-ca.level-1;0<=da&&!ca.isLeaf&&!V(ca);)ca=ca.children[2*(R[1]>>da&1)+(R[2]>>da&1)],da--;return V(ca)?ca:null}}return null};W.findNeighborTile=function(R,V){const da=this.lij;return(R=this.getNeighborLIJ(da,R))?da[0]===R[0]&&da[1]===R[1]&&da[2]===R[2]?V(this)?this:null:this._findLIJ(R,V):null};
W.findCorner=function(R,V){R=R===B.NeighborIndex.NORTH_EAST?1:R===B.NeighborIndex.NORTH_WEST?0:R===B.NeighborIndex.SOUTH_WEST?2:3;let da=this;for(;!(da.isLeaf||V&&V(da));)da=da.children[R];return da};W.findNeighborCornerTileExact=function(R,V){var da;return null==(da=this.findNeighborTile(R,ca=>V(ca)||ca.level===this.level))?void 0:da.findCorner(A.oppositeCorner(R),V)};W.forAllSubtreeOnSide=function(R,V){const da=R===B.NeighborIndex.NORTH?[0,1]:R===B.NeighborIndex.NORTH_EAST?[1]:R===B.NeighborIndex.EAST?
[1,3]:R===B.NeighborIndex.SOUTH_EAST?[3]:R===B.NeighborIndex.SOUTH?[2,3]:R===B.NeighborIndex.SOUTH_WEST?[2]:R===B.NeighborIndex.WEST?[0,2]:[0],ca=ha=>{V(ha)||ha.isLeaf||da.forEach(ia=>ca(ha.children[ia]))};ca(this)};W.forallNeighbors=function(R){A.neighborCornerIndices.forEach(V=>this.findNeighborCornerTileExact(V,R));A.neighborEdgeIndices.forEach(V=>{var da;return null==(da=this.findNeighborTile(V,ca=>ca.level===this.level||R(ca)))?void 0:da.forAllSubtreeOnSide(A.oppositeEdge(V),R)})};W.getNeighborEdgeStartVertexIndex=
function(R,V){V=null!=V?V:this.findNeighborTile(A.neighborEdgeIndices[R],ha=>ha.isLoaded);if(!V||!this.isLoaded||!V.isLoaded)return 0;var da=this.level-V.level;if(0===da)return 0;da=2**da;const ca=(R=1===(R&1))?0:1;V=this.lij[ca+1]-V.lij[ca+1]*da;return R?da-1-V:V};W._updateNeighborsWithChangedEdgeResolution=function(){for(let V=0;4>V;++V)if(this.renderData.geometryState.neighborData.modifiedEdgeResolutions[V]){var R=A.neighborEdgeIndices[V];const da=this.findNeighborTile(R,ca=>ca.isLoaded||ca.level===
this.level);if(da){if(!da.isLoaded){A.internalAssert(!da.isLeaf);const ca=(V+2)%4;R=A.oppositeEdge(R);da.forAllSubtreeOnSide(R,ha=>{if(ha.isLoaded)return ha.updateEdgeAfterResolutionChange(ca),!0;A.internalAssert(!ha.isLeaf);return!1})}this.renderData.geometryState.neighborData.modifiedEdgeResolutions[V]=!1}}};W.updateNeighborDataAndGeometryIfNeeded=function(){this.isLoaded&&this.renderData.updateNeighborDataAndGeometryIfNeeded()};W.updateNeighborsAfterGeometryChange=function(R=this.level){this.forEachLoadedNeighbor(V=>
this._updateNeighbor(V));A.neighborEdgeIndices.forEach(V=>{V=this.findNeighborTile(V,da=>da.isLoaded&&da.level<R);null==V?void 0:V.updateNeighborsWithChangedEdgeResolution()})};W.updateNeighborsWithChangedEdgeResolution=function(){this.isLoaded&&this._updateNeighborsWithChangedEdgeResolution()};W.updateEdgeAfterResolutionChange=function(R){this.renderData.updateEdgeAfterResolutionChange(R)};W.forEachLoadedNeighbor=function(R){const V=this.level,da=ca=>ca.level===V||ca.isLoaded;A.neighborEdgeIndices.forEach((ca,
ha)=>{var ia,ka;const la=this.findNeighborTile(ca,da);null!=la&&la!==this&&la.forAllSubtreeOnSide(A.oppositeEdge(ca),Y=>Y.isLoaded?(R(Y),!0):!1);(ca=null==(ia=this.renderData)?void 0:null==(ka=ia.geometryState)?void 0:ka.neighborData)&&(ca.modifiedEdgeResolutions[ha]=!1)});A.neighborCornerIndices.forEach(ca=>{var ha;const ia=null==(ha=this.findNeighborTile(ca,da))?void 0:ha.findCorner(A.oppositeCorner(ca),ka=>ka.isLoaded);A.internalAssert(!ia||M(this,ia,ca));null!=ia&&ia.isLoaded&&R(ia)})};W._updateNeighbor=
function(R){null!=R&&R.isLoaded&&R.updateNeighborDataAndGeometryIfNeeded()};W.getNeighborLIJ=function(R,V){const da=A.isNorth(V)?-1:A.isSouth(V)?1:0;V=A.isWest(V)?-1:A.isEast(V)?1:0;R=[R[0],R[1]+da,R[2]+V];return 0>R[1]?null:this.surface.isGlobal?this.wrapLIJ(R):0>R[2]?null:R};W.wrapLIJ=function(R){return!R||0>R[1]||R[1]>=2**R[0]?null:this.surface.wrapEastWest(R)};W.compareLIJs=function(R){const V=this.lij;var da=V[0],ca=R[0];if(da===ca)return[V,R];const ha=da-ca;if(0>ha)return da=2**-ha,[[ca,V[1]*
da,V[2]*da],R];ca=2**ha;return[V,[da,R[1]*ca,R[2]*ca]]};W.checkGeometryWaterproofness=function(){A.ENABLE_WATERPROOFNESS_TESTS&&(A.internalAssert(this.isLoaded),this.renderData.checkGeometryWaterproofness())};W.shouldHaveNeighbor=function(R){const V=this.extent,da=this.surface.rootTilesExtent,ca=.25*(V[2]-V[0]);if(A.isNorth(R)&&V[3]+ca>=da[3]||A.isSouth(R)&&V[1]-ca<=da[1])return!1;const ha=this.surface.isGlobal;return!ha&&A.isWest(R)&&V[0]-ca<=da[0]||!ha&&A.isEast(R)&&V[2]+ca>=da[2]?!1:!0};b._createClass(aa,
[{key:"isCached",get:function(){return!this.shouldLoad&&0>=this._mapDataRefCount}},{key:"maxTesselation",get:function(){return this._maxTesselation}},{key:"isWithinClippingArea",get:function(){return this._isWithinClippingArea}},{key:"intersectsClippingArea",get:function(){return this._intersectsClippingArea}},{key:"clippingArea",get:function(){return this._clippingArea}},{key:"parent",get:function(){return this._parent}},{key:"children",get:function(){return this._children}},{key:"surface",get:function(){return this._surface}},
{key:"elevationBounds",get:function(){return this._elevationBounds}},{key:"level",get:function(){return this.lij[0]}},{key:"key",get:function(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}},{key:"edgeLen",get:function(){return this._edgeLen}},{key:"radius",get:function(){return this._center[a.CenterPosition.MIDDLE][3]}},{key:"screenDepth",get:function(){return this._screenDepth}},{key:"visible",get:function(){this._dirty&&this.computeVisibility();return this._visible}},{key:"loadable",get:function(){return this.visible||
this._surface.view.state.fixedContentCamera}},{key:"rendered",get:function(){const R=!!this.renderData;R!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=R,this._surface.renderer.setNeedsRender());return R}},{key:"shouldLoad",get:function(){if(!this.loadable)return!1;if(this._surface.lodSnapping===B.LODSnapping.ON){const R=this.level-this._surface.snapLevel;if(0===R)return!0;if(1===R)return!1}return this.isLeaf}},{key:"usedMemory",get:function(){return this._ensureUsedMemory()+
(this.isCached?0:this._mapTileMemory)}},{key:"cachedMemory",get:function(){return this.isCached?this.mapTileMemory:0}},{key:"mapTileMemory",get:function(){this._ensureUsedMemory();return this.layerInfo[q.LayerClass.MAP].reduce((R,V)=>R+(V instanceof v.VectorTile?V.memoryUsage:0),this._mapTileMemory)}},{key:"cpuImageMemorySize",get:function(){const R=this._surface.tilingScheme.pixelSize;return R*R*4}},{key:"isLoaded",get:function(){var R,V;return null!=(R=null==(V=this.renderData)?void 0:V.hasGeometry)?
R:!1}},{key:"updating",get:function(){if(this.hasPendingUpdates)return!0;for(const R of q.LayerClasses){const V=this.layerInfo[R];for(const da of V)if(da.loadingAgent&&da.loadingAgent!==p.TILE_AGENT_DONE&&da.loadingAgent.updating)return!0}return!1}},{key:"hasPendingUpdates",get:function(){return 0!==this._pendingUpdates}},{key:"isLeaf",get:function(){return null==this._children[0]}},{key:"test",get:function(){return{cachedMemory:this.cachedMemory}}},{key:"westNeighborWestExtent",get:function(){return this.extent[0]*
(this.isWestEnd?-1:1)}},{key:"eastNeighborEastExtent",get:function(){return this.extent[2]*(this.isEastEnd?-1:1)}},{key:"isEastEnd",get:function(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}},{key:"isWestEnd",get:function(){return 0===this.lij[2]}},{key:"isNorthEnd",get:function(){return 0===this.lij[1]}},{key:"isSouthEnd",get:function(){return this.extent[1]+f.EPSILON>=this.surface.extent[1]}}]);return aa}();const S=new l(u.MapTileAgent),T=new l(x.ElevationTileAgent),U=new t.ElevationBounds;
a.CenterPosition=void 0;(function(aa){aa[aa.TOP=0]="TOP";aa[aa.MIDDLE=1]="MIDDLE";aa[aa.BOTTOM=2]="BOTTOM"})(a.CenterPosition||(a.CenterPosition={}));a.SplitLimits=function(){this.angledSplitBias=this.maxLod=this.relativeHeightLimit=this.relativeWidthLimit=this.fovY=this.fovX=0;this.aboveGround=!0};a.Tile=Q;a.almostEquals=N;a.isCornerNeighbor=M;a.isEdgeNeighbor=function(aa,W,R){if(m.isNone(aa)||m.isNone(W))return!1;if(0===aa.level&&0===W.level&&(aa.isEastEnd&&W.isWestEnd&&R===B.NeighborIndex.EAST||
aa.isWestEnd&&W.isEastEnd&&R===B.NeighborIndex.WEST))return!0;const V=1E-6*(aa.extent[2]-aa.extent[0]);switch(R){case B.NeighborIndex.NORTH:return N(aa.extent[3],W.extent[1],V);case B.NeighborIndex.SOUTH:return N(aa.extent[1],W.extent[3],V);case B.NeighborIndex.EAST:return N(aa.extent[2],W.extent[0],V)||N(aa.extent[2],-W.extent[0],V);case B.NeighborIndex.WEST:return N(aa.extent[0],W.extent[2],V)||N(aa.extent[0],-W.extent[2],V)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/terrain/ElevationTileAgent":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./TerrainConst","./TileAgent"],function(a,b,c,m){m=function(l){function r(){var n=l.apply(this,arguments)||this;n._scaleRangeEnabled=!1;return n}b._inheritsLoose(r,l);b._createClass(r,[{key:"_desiredMinLevelDelta",get:function(){return c.getElevationDesiredResolutionLevel(this.tile.level)-(this.tile.vlevel-this.tile.level)}},{key:"_progressiveLevelModulo",get:function(){return 0}}]);
return r}(m.TileAgent);a.ElevationTileAgent=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TileAgent":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ./interfaces ./TerrainConst ./terrainUtils ./tileUtils".split(" "),function(a,b,c,m,l,r,n){let g=function(){function d(){}var e=d.prototype;e.init=function(h,v,w,t){this.tile=h;this._layerIdx=v;this._layerClass=w;this._suspended=t;this._tileLayerInfo=
h.getLayerInfo(v,w);this._tileRequested=null;h=this._findAncestorWithData();this._setUpsampleTile(h)};e.startLoading=function(){return this._requestNext()};e.dispose=function(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null);this._tileLayerInfo=this.tile=null};e.setSuspension=function(h){h!==this._suspended&&((this._suspended=h)?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,
this),this._tileRequested=null):this._tileLayerInfo.data||this.update())};e.update=function(){const h=this._findAncestorWithData();this._setUpsampleTile(h);return this._requestNext()};e.dataArrived=function(h){this._setUpsampleTile(h);this._tileRequested=null;h===this.tile?this.tile.updateRenderData(this._layerClass,m.TextureUpdate.FADING):this._requestNext()};e.dataMissing=function(){this._tileRequested=null;this._tileLayerInfo.data=null;this._requestNext()};e._agentDone=function(){this.tile.agentDone(this._layerIdx,
this._layerClass);this.dispose()};e._requestNext=function(){if(this._suspended)return!0;const h=this._findNextDownload();if(this._tileRequested){if(h===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this);this._tileRequested=null}c.isSome(h)?h.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=h):this._agentDone();return!!this._tileRequested};e._findNextDownload=function(){const h=this._layerIdx,v=this._layerClass;var w=
this.tile.surface.layerViewByIndex(h,v);const t=r.getLayerWithExtentRange(w),{minLevel:x,maxLevel:B}=w.dataLevelRange;w=this._desiredMinLevelDelta;const q=this._progressiveLevelModulo+w,u=this._scaleRangeEnabled?n.fallsWithinLayer:()=>!0;let C=this.tile;const z=C.level;let A;var p=this._tileLayerInfo.upsampleInfo;const y=c.isSome(p)?p.tile.level:-1;p=c.isSome(p)?y-z>=w:!1;const D=c.get(t,"tilemapCache");for(;C&&u(C,t,!1)&&C.level>=x;){const E=C.level,F=z-E,G=C.layerInfo[v][h];if(G.data&&F>=w){(!p||
E>y)&&this._setUpsampleTile(C);G.dataInvalidated&&(A=C);break}if((c.isNone(D)||"unavailable"!==D.getAvailability(C.lij[0],C.lij[1],C.lij[2]))&&E<=B&&!G.data&&!G.dataMissing){if(c.isNone(A)||C.level===x||0===E%l.PROGRESSIVE_LOADING_MODULO||z-A.level<w)A=C;if(F>=q)break}C=C.parent}c.isSome(A)&&z-A.level<w&&this._tileLayerInfo.upsampleInfo&&(A=null);return A};e._findAncestorWithData=function(){const h=this.tile.vlevel,v=this._desiredMinLevelDelta;let w;for(let t=this.tile;t;t=t.parent)if(t.hasLayerData(this._layerIdx,
this._layerClass)){if(h-t.level>=v)return t;w=t}return w};e._setUpsampleTile=function(h){this._tileLayerInfo.setUpsampleInfo(this.tile,h);this.tile.updateRenderData(this._layerClass,m.TextureUpdate.FADING)};b._createClass(d,[{key:"updating",get:function(){return!!this._tileRequested}},{key:"test",get:function(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}]);return d}();var k=function(d){function e(){return d.apply(this,arguments)||this}b._inheritsLoose(e,
d);e.prototype.dispose=function(){};b._createClass(e,[{key:"_desiredMinLevelDelta",get:function(){throw f;}},{key:"_progressiveLevelModulo",get:function(){throw f;}}]);return e}(g);const f=Error("Abstract method called on TileAgent");k=new k;a.TILE_AGENT_DONE=k;a.TileAgent=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/tileUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../core/PooledArray"],
function(a,b,c,m){function l(f,d){d(f);if(!f.isLeaf)for(const e of f.children)l(e,d)}function r(f,d){return f.lij[0]-d.lij[0]||f.lij[1]-d.lij[1]||f.lij[2]-d.lij[2]}function n(f,d,e){const h=f.screenDepth,v=d.screenDepth;return h<v?-e:h>v?e:r(f,d)}let g=function(){function f(){this._queue=new m;this._last=null;this.remove=()=>{}}var d=f.prototype;d.resetOne=function(e){this._queue.clear();this._queue.push(e);this._last=null};d.reset=function(e=null){this._queue.clear();c.isSome(e)&&this._queue.pushArray(e);
this._last=null};d.skipSubtree=function(){this._last=null};d.next=function(){this._last&&!this._last.isLeaf&&this._queue.pushArray(this._last.children);return this._last=this._queue.pop()};b._createClass(f,[{key:"done",get:function(){return 0===this._queue.length&&(!this._last||this._last.isLeaf)}}]);return f}(),k=function(){function f(){this.q=new m}var d=f.prototype;d.reset=function(e){this.q.clear();if(!c.isNone(e))for(this.q.pushArray(e),e=0;e<this.q.length;++e){const h=this.q.data[e];h.isLeaf||
this.q.pushArray(h.children)}};d.next=function(){return this.q.pop()};b._createClass(f,[{key:"done",get:function(){return 0===this.q.length}}]);return f}();a.IteratorPostorder=k;a.IteratorPreorder=g;a.compareTiles=n;a.computeUpsampleInfo=function(f,d,e){let h=1,v=0,w=0;for(;f!==d;)if(h*=.5,v*=.5,w*=.5,f.lij[2]&1&&(v+=.5),0===(f.lij[1]&1)&&(w+=.5),f=f.parent,null==f)throw Error("tile was not a descendant of upsampleTile");e.init(d,v,w,h)};a.fallsWithinLayer=function(f,d,e){if(c.isNone(d)||c.isNone(d.fullExtent))return!1;
const h=d.fullExtent,v=f.extent;if(e){if(v[0]<h.xmin||v[1]<h.ymin||v[2]>h.xmax||v[3]>h.ymax)return!1}else if(h.xmin>v[2]||h.ymin>v[3]||h.xmax<v[0]||h.ymax<v[1])return!1;f=f.surface.tilingScheme.levels[f.level].scale;return 0<d.minScale&&f>1.00000001*d.minScale||0<d.maxScale&&f<.99999999*d.maxScale?!1:!0};a.hasLoadableSiblings=function(f){for(let d=0;d<f.length;d++){const e=f[d],h=e.parent;if(h)for(let v=0;4>v;v++){const w=h.children[v];if(w&&w!==e&&w.loadable)return!0}}return!1};a.sortTiles=function(f,
d){d.sort((e,h)=>n(e,h,f))};a.sortTilesByPOI=function(f,d){const e=new Map;f.forAll(h=>e.set(h.lij,h.distanceToSquared(d)));f.sort((h,v)=>e.get(h.lij)-e.get(v.lij)||r(h,v))};a.tilesAreRelated=function(f,d){if(!f||!d||f[0]===d[0])return!1;const e=f[0]<d[0],h=e?f:d;f=e?d:f;d=1<<f[0]-h[0];return Math.floor(f[1]/d)===h[1]&&Math.floor(f[2]/d)===h[2]};a.traverseTilesPreorder=function(f,d){if(Array.isArray(f))for(let e=0;e<f.length;e++)l(f[e],d);else l(f,d)};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/MapTileAgent":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./TerrainConst","./TileAgent"],function(a,b,c,m){m=function(l){function r(){var n=l.call(this)||this;n._scaleRangeEnabled=!0;return n}b._inheritsLoose(r,l);b._createClass(r,[{key:"_desiredMinLevelDelta",get:function(){return 0}},{key:"_progressiveLevelModulo",get:function(){return c.PROGRESSIVE_LOADING_MODULO}}]);return r}(m.TileAgent);a.MapTileAgent=
m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/RasterTile":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/RasterColorizer.glsl ../../webgl/enums ../../webgl/rasterUtils".split(" "),function(a,b,c,m,l,r){const n={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,
colormapOffset:null,stretchType:"none",type:"stretch"};let g=function(){function k(d,e,h=null,v=null){this.type="raster-tile";this._interpolation=this._bandIds=this._symbolizerParameters=this._source=this._memoryUsed=null;this._dirty=!1;this._transformGrid=null;this.isRendereredSource=!1;this.lij=this.rawPixelData=this.symbolizerRenderer=null;this.opacity=1;this.lij=d;this.source=e;this.width=h||e.width;this.height=v||e.height}var f=k.prototype;f.bind=function(d){if(!(this.source&&this.source.pixels&&
0<this.source.pixels.length))return!1;(c.isNone(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(d,this.bandIds);c.isSome(this._rasterTexture)&&(this._updateColormapTexture(d),this.transformGrid&&c.isNone(this._transformGridTexture)&&(this._transformGridTexture=r.createTransformTexture(d,this.transformGrid)));return!0};f.getUniforms=function(){const {symbolizerParameters:d,transformGrid:e,width:h,height:v,opacity:w}=this,t=r.getCommonUniforms(e,[h,v],[this.source.width,this.source.height],
w),x=r.getColormapUniforms(d.colormap,d.colormapOffset),B="stretch"===this.symbolizerParameters.type?r.getStretchUniforms(this.symbolizerParameters):null,q="hillshade"===this.symbolizerParameters.type?r.getShadedReliefUniforms(this.symbolizerParameters):null;return new m.ColorizerUniforms(t,x,B||q,this._rasterTexture,this._transformGridTexture,this._colormapTexture)};f.release=function(){this._rasterTexture=c.disposeMaybe(this._rasterTexture);this._transformGridTexture=c.disposeMaybe(this._transformGridTexture);
this._colormapTexture=c.disposeMaybe(this._colormapTexture);this.rawPixelData=this.transformGrid=this.source=null;return!0};f._updateRasterTexture=function(d,e){const h=this.source?this.source.extractBands(e):null;h&&h.pixels&&0<h.pixels.length?(e=c.isNone(e)&&c.isNone(this.bandIds)||c.isSome(e)&&c.isSome(this.bandIds)&&e.join("")===this.bandIds.join(""),c.isSome(this._rasterTexture)&&e||(this._rasterTexture=c.disposeMaybe(this._rasterTexture),e=this._getRasterTextureInterpolation(this.interpolation),
this._rasterTexture=r.createRasterTexture(d,h,e,this.isRendereredSource||this.hasStretchTypeNone()))):this._rasterTexture=c.disposeMaybe(this._rasterTexture)};f.hasStretchTypeNone=function(){return"stretchType"in this.symbolizerParameters&&"none"===this.symbolizerParameters.stretchType&&!this.symbolizerParameters.useGamma&&"u8"===this.source.pixelType};f._getRasterTextureInterpolation=function(d){return"lut"===this.symbolizerParameters.type||"nearest"===d||"majority"===d?"nearest":"bilinear"};f._updateColormapTexture=
function(d){const e=this._colormap,h=this.symbolizerParameters.colormap;if(!h)this._colormapTexture=c.disposeMaybe(this._colormapTexture),this._colormap=null;else if(!e)this._colormapTexture=r.createColormapTexture(d,h),this._colormap=h;else if(h.length!==e.length||h.some((v,w)=>v!==e[w]))this._colormapTexture=c.disposeMaybe(this._colormapTexture),this._colormapTexture=r.createColormapTexture(d,h),this._colormap=h};b._createClass(k,[{key:"source",get:function(){return this._source},set:function(d){this._source=
d;this._rasterTexture=c.disposeMaybe(this._rasterTexture);this._memoryUsed=null}},{key:"symbolizerParameters",get:function(){return this.isRendereredSource?{...n,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||n},set:function(d){this._symbolizerParameters=d}},{key:"bandIds",get:function(){return this._bandIds},set:function(d){c.isSome(d)&&0<d.length?this._bandIds&&d.every((e,h)=>this._bandIds[h]?e===this._bandIds[h]:!1)||(this._bandIds=d,this._dirty=!0):this._bandIds=null}},{key:"interpolation",
get:function(){return this._interpolation||"nearest"},set:function(d){this._interpolation=d;c.isSome(this._rasterTexture)&&(d=this._getRasterTextureInterpolation(d),this._rasterTexture.setSamplingMode("bilinear"===d?l.TextureSamplingMode.LINEAR:l.TextureSamplingMode.NEAREST))}},{key:"transformGrid",get:function(){return this._transformGrid},set:function(d){this._transformGrid=d;this._transformGridTexture=c.disposeMaybe(this._transformGridTexture);this._memoryUsed=null}},{key:"memoryUsage",get:function(){c.isNone(this._memoryUsed)&&
(this._memoryUsed=[this._rasterTexture,this._transformGridTexture,this._colormapTexture].map(d=>c.isSome(d)?d.descriptor.width*d.descriptor.height*4:0).reduce((d,e)=>d+e,0));return this._memoryUsed}}]);return k}();a.RasterTile=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/RasterColorizer.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../core/maybe ./vec3f64 ../views/2d/engine/imagery/enums ../views/3d/webgl-engine/core/shaderLibrary/output/BlendOptions ../views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl ../views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/BackgroundGrid.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileBlendInput ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ./BlendLayers.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/BlendModes.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/BooleanPassUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/FloatsPassUniform ../views/3d/webgl-engine/core/shaderModules/IntegerPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A){function p(K){const N=new z.ShaderBuilder;N.include(d.TileComposite);N.include(g.Common);N.include(n.Colormap);K.tileBlendInput===f.TileBlendInput.GridComposite&&(N.extensions.add("GL_OES_standard_derivatives"),N.fragment.include(k.BackgroundGrid));const M=K.tileBlendInput===f.TileBlendInput.ColorComposite;M&&N.fragment.uniforms.add(new x.Float3PassUniform("backgroundColor",O=>O.backgroundColor));K.baseOpacityMode!==e.BaseOpacityMode.One&&N.fragment.uniforms.add(new B.FloatPassUniform("baseOpacity",
O=>O.baseOpacity));const L=K.baseOpacityMode===e.BaseOpacityMode.OnBaseLayer,J=K.baseOpacityMode===e.BaseOpacityMode.OnBackground||K.baseOpacityMode===e.BaseOpacityMode.OnBaseLayer,H=K.blendMode!==r.LayerBlendMode.Normal;N.fragment.include(h.BlendModes,K);const I=K.tileBlendInput!==f.TileBlendInput.LayerOnly;if(H&&!I||L)N.fragment.uniforms.add(new A.Texture2DPassUniform("fboColor",O=>O.fboTexture)),N.fragment.uniforms.add(new B.FloatPassUniform("tileSize",O=>c.isSome(O.fboTexture)?O.fboTexture.descriptor.width:
1));N.fragment.code.add(C.glsl`
    vec4 applyBackgroundBlend(vec4 layerColor) {
      ${I||L?C.glsl`
          vec4 bgColor = ${L?C.glsl`texture2D(fboColor, gl_FragCoord.xy / tileSize)`:M?C.glsl`vec4(backgroundColor, 1.0)`:C.glsl`gridColor(vuv)`};
          ${J?C.glsl`bgColor *= baseOpacity;`:""}`:""}
      ${H?C.glsl`
            vec3 pmColorLayer = layerColor.rgb * layerColor.a;
            vec4 fboTex = ${I?C.glsl`bgColor;`:C.glsl`texture2D(fboColor, gl_FragCoord.xy / tileSize) ${L?" * baseOpacity":""};`}
            vec3 Cb = fboTex.a == 0.0 ? fboTex.rgb : vec3(fboTex.rgb * fboTex.a);
            return applyBlendMode(pmColorLayer.rgb, layerColor.a * u_opacity, Cb, fboTex.a);`:I||L?C.glsl`
            float composeAlpha = layerColor.a * u_opacity;
            vec4 pmColorLayer = vec4(layerColor.rgb, 1.0);
            return mix(bgColor, pmColorLayer, composeAlpha);`:C.glsl`
            return layerColor * layerColor.a * u_opacity;`}
    }
  `);K.colorizerType===l.RasterColorizerType.Stretch?y(N,K):K.colorizerType===l.RasterColorizerType.Lut?N.fragment.code.add(C.glsl`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`):K.colorizerType===l.RasterColorizerType.Hillshade&&D(N,K);return N}function y(K,N){K.fragment.uniforms.add([new u.IntegerPassUniform("u_bandCount",L=>L.symbolizer.u_bandCount),new q.FloatsPassUniform("u_minCutOff",L=>L.symbolizer.u_minCutOff,3),new q.FloatsPassUniform("u_maxCutOff",L=>L.symbolizer.u_maxCutOff,3),new q.FloatsPassUniform("u_factor",L=>L.symbolizer.u_factor,3),new B.FloatPassUniform("u_minOutput",L=>L.symbolizer.u_minOutput),new B.FloatPassUniform("u_maxOutput",L=>L.symbolizer.u_maxOutput),
new w.BooleanPassUniform("u_useGamma",L=>L.symbolizer.u_useGamma),new q.FloatsPassUniform("u_gamma",L=>L.symbolizer.u_gamma,3),new q.FloatsPassUniform("u_gammaCorrection",L=>L.symbolizer.u_gammaCorrection,3),new B.FloatPassUniform("u_opacity",L=>L.common.u_opacity)]);K.fragment.code.add(C.glsl`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const M=N.applyColormap?C.glsl`gl_FragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:C.glsl`gl_FragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;K.fragment.code.add(C.glsl`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${N.stretchType===l.RasterColorizerStretchType.Noop?C.glsl`
        gl_FragColor = applyBackgroundBlend(currentPixel);`:C.glsl`
        if (currentPixel.a == 0.0) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${M}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function D(K,N){K=K.fragment;K.uniforms.add([new A.Texture2DPassUniform("u_image",M=>M.u_image),new u.IntegerPassUniform("u_hillshadeType",M=>M.symbolizer.u_hillshadeType),new q.FloatsPassUniform("u_sinZcosAs",M=>M.symbolizer.u_sinZcosAs,6),new q.FloatsPassUniform("u_sinZsinAs",M=>M.symbolizer.u_sinZsinAs,6),new q.FloatsPassUniform("u_cosZs",M=>M.symbolizer.u_cosZs,6),new q.FloatsPassUniform("u_weights",M=>M.symbolizer.u_weights,6),new t.Float2PassUniform("u_factor",M=>M.symbolizer.u_factor),
new B.FloatPassUniform("u_minValue",M=>M.symbolizer.u_minValue),new B.FloatPassUniform("u_maxValue",M=>M.symbolizer.u_maxValue),new t.Float2PassUniform("u_srcImageSize",M=>M.common.u_srcImageSize)]);K.include(v.ColorConversion);K.code.add(C.glsl`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec3 hsv = rgb2hsv(colormap(vec4(val, val, val, 1.0), false).rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv) * alpha, alpha);
}`);K.code.add(C.glsl`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);N=N.applyColormap?C.glsl`gl_FragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:C.glsl`hillshade *= alpha;
gl_FragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;K.code.add(C.glsl`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${N}
    }
  `)}let E=function(K){function N(M,L,J,H,I,O){M=K.call(this,M,H,I)||this;M.colormap=L;M.symbolizer=J;M.u_colormap=O;M.backgroundColor=m.ZEROS;M.fboTexture=null;M.baseOpacity=1;return M}b._inheritsLoose(N,K);return N}(g.CommonPassParameters),F=function(K){function N(){return K.apply(this,arguments)||this}b._inheritsLoose(N,K);return N}(E),G=function(K){function N(){return K.apply(this,arguments)||this}b._inheritsLoose(N,K);return N}(E);const P=Object.freeze(Object.defineProperty({__proto__:null,ColorizerUniforms:E,
ColorizerStretchUniforms:F,ColorizerHillshadeUniforms:G,build:p},Symbol.toStringTag,{value:"Module"}));a.ColorizerHillshadeUniforms=G;a.ColorizerStretchUniforms=F;a.ColorizerUniforms=E;a.RasterColorizer=P;a.build=p})},"esri/views/2d/engine/imagery/enums":function(){define(["exports"],function(a){a.RasterColorizerType=void 0;(function(b){b[b.Stretch=0]="Stretch";b[b.Lut=1]="Lut";b[b.Hillshade=2]="Hillshade";b[b.COUNT=3]="COUNT"})(a.RasterColorizerType||(a.RasterColorizerType={}));a.RasterColorizerStretchType=
void 0;(function(b){b[b.Noop=0]="Noop";b[b.PerBand=1]="PerBand";b[b.COUNT=2]="COUNT"})(a.RasterColorizerStretchType||(a.RasterColorizerStretchType={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/BlendOptions":function(){define(["exports"],function(a){a.AlphaBlendMode=void 0;(function(b){b[b.OneMinusSourceAlpha=0]="OneMinusSourceAlpha";b[b.SourceAlpha=1]="SourceAlpha";b[b.COUNT=2]="COUNT"})(a.AlphaBlendMode||
(a.AlphaBlendMode={}));a.LayerBlendMode=void 0;(function(b){b[b.Normal=0]="Normal";b[b.Average=1]="Average";b[b.Lighten=2]="Lighten";b[b.Lighter=3]="Lighter";b[b.Plus=4]="Plus";b[b.Screen=5]="Screen";b[b.ColorDodge=6]="ColorDodge";b[b.Darken=7]="Darken";b[b.Multiply=8]="Multiply";b[b.ColorBurn=9]="ColorBurn";b[b.Overlay=10]="Overlay";b[b.SoftLight=11]="SoftLight";b[b.HardLight=12]="HardLight";b[b.VividLight=13]="VividLight";b[b.Hue=14]="Hue";b[b.Saturation=15]="Saturation";b[b.Luminosity=16]="Luminosity";
b[b.Color=17]="Color";b[b.DestinationOver=18]="DestinationOver";b[b.DestinationAtop=19]="DestinationAtop";b[b.DestinationIn=20]="DestinationIn";b[b.DestinationOut=21]="DestinationOut";b[b.SourceAtop=22]="SourceAtop";b[b.SourceIn=23]="SourceIn";b[b.SourceOut=24]="SourceOut";b[b.Xor=25]="Xor";b[b.Difference=26]="Difference";b[b.Exclusion=27]="Exclusion";b[b.Minus=28]="Minus";b[b.Invert=29]="Invert";b[b.Reflect=30]="Reflect";b[b.COUNT=31]="COUNT"})(a.LayerBlendMode||(a.LayerBlendMode={}));a.blendModeFromString=
{normal:a.LayerBlendMode.Normal,average:a.LayerBlendMode.Average,lighten:a.LayerBlendMode.Lighten,lighter:a.LayerBlendMode.Lighter,screen:a.LayerBlendMode.Screen,plus:a.LayerBlendMode.Plus,"color-dodge":a.LayerBlendMode.ColorDodge,darken:a.LayerBlendMode.Darken,multiply:a.LayerBlendMode.Multiply,"color-burn":a.LayerBlendMode.ColorBurn,overlay:a.LayerBlendMode.Overlay,"soft-light":a.LayerBlendMode.SoftLight,"hard-light":a.LayerBlendMode.HardLight,"vivid-light":a.LayerBlendMode.VividLight,hue:a.LayerBlendMode.Hue,
saturation:a.LayerBlendMode.Saturation,luminosity:a.LayerBlendMode.Luminosity,color:a.LayerBlendMode.Color,difference:a.LayerBlendMode.Difference,exclusion:a.LayerBlendMode.Exclusion,minus:a.LayerBlendMode.Minus,invert:a.LayerBlendMode.Invert,reflect:a.LayerBlendMode.Reflect,"destination-over":a.LayerBlendMode.DestinationOver,"destination-atop":a.LayerBlendMode.DestinationAtop,"destination-in":a.LayerBlendMode.DestinationIn,"destination-out":a.LayerBlendMode.DestinationOut,"source-atop":a.LayerBlendMode.SourceAtop,
"source-in":a.LayerBlendMode.SourceIn,"source-out":a.LayerBlendMode.SourceOut,xor:a.LayerBlendMode.Xor};a.isCompositeBlendMode=function(b){return b===a.LayerBlendMode.DestinationOver||b===a.LayerBlendMode.DestinationAtop||b===a.LayerBlendMode.DestinationIn||b===a.LayerBlendMode.DestinationOut||b===a.LayerBlendMode.SourceAtop||b===a.LayerBlendMode.SourceIn||b===a.LayerBlendMode.SourceOut||b===a.LayerBlendMode.Xor};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl":function(){define(["exports","../../shaderModules/FloatPassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,c,m){a.Colormap=function(l){l.fragment.uniforms.add([new m.Texture2DPassUniform("u_colormap",r=>r.u_colormap),new b.FloatPassUniform("u_colormapOffset",r=>r.colormap.u_colormapOffset),new b.FloatPassUniform("u_colormapMaxIndex",r=>r.colormap.u_colormapMaxIndex),new b.FloatPassUniform("u_opacity",
r=>r.common.u_opacity)]);l.fragment.code.add(c.glsl`vec4 colormap(vec4 currentPixel, bool isFloat) {
float clrIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || clrIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);
result = texture2D(u_colormap, clrPosition);
}
return result;
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ./Projection.glsl ../terrain/TileComposite.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,c,m,l,r,n){m=function(g){function k(f,d,e){var h=g.call(this)||this;h.common=
f;h.u_image=d;h.u_transformGrid=e;return h}b._inheritsLoose(k,g);return k}(m.TileCompositePassParameters);a.Common=function(g){g.include(c.Projection);g.fragment.uniforms.add([new n.Texture2DPassUniform("u_image",k=>k.u_image),new l.BooleanPassUniform("u_flipY",k=>k.common.u_flipY),new l.BooleanPassUniform("u_applyTransform",k=>k.common.u_applyTransform)]);g.fragment.code.add(r.glsl`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)};a.CommonPassParameters=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Projection.glsl":function(){define(["exports","../../shaderModules/Float2PassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,c,m){a.Projection=function(l){l.fragment.uniforms.add(new m.Texture2DPassUniform("u_transformGrid",r=>r.u_transformGrid));l.fragment.uniforms.add(new b.Float2PassUniform("u_transformSpacing",
r=>r.common.u_transformSpacing));l.fragment.uniforms.add(new b.Float2PassUniform("u_transformGridSize",r=>r.common.u_transformGridSize));l.fragment.uniforms.add(new b.Float2PassUniform("u_targetImageSize",r=>r.common.u_targetImageSize));l.fragment.code.add(c.glsl`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);
vec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;
vec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);
vec2 srcLocation;
vec2 transform_location = index_transform + oneTransformPixel * 0.5;
if (pos.s <= pos.t) {
vec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));
vec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));
} else {
vec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));
vec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));
}
return srcLocation;;
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec2f64 ../../shaderModules/Float2PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute".split(" "),function(a,b,c,m,l,r,n){let g=function(k){function f(){var d=k.apply(this,
arguments)||this;d.scale=1;d.offset=c.ZEROS;return d}b._inheritsLoose(f,k);return f}(r.NoParameters);a.TileComposite=function(k){k.attributes.add(n.VertexAttribute.POSITION,"vec2");k.attributes.add(n.VertexAttribute.UV0,"vec2");k.vertex.uniforms.add(new l.FloatPassUniform("scale",f=>f.scale));k.vertex.uniforms.add(new m.Float2PassUniform("offset",f=>f.offset));k.varyings.add("uv","vec2");k.varyings.add("vuv","vec2");k.vertex.code.add(r.glsl`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)};a.TileCompositePassParameters=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/BackgroundGrid.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.BackgroundGrid=function(c){c.code.add(b.glsl`
    float lineFactorAtPosition(float value) {
      float pos = value * ${b.glsl.float(257)};
      if(pos < 0.5 || pos > ${b.glsl.float(256.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec4 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec4(vec3(1.0, 0.972, 0.918) * line, 1.0);
    }`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileBlendInput":function(){define(["exports"],function(a){a.TileBlendInput=void 0;var b=a.TileBlendInput||(a.TileBlendInput={});b[b.LayerOnly=0]="LayerOnly";b[b.ColorComposite=1]="ColorComposite";b[b.GridComposite=2]="GridComposite";b[b.COUNT=3]="COUNT";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/chunks/BlendLayers.glsl":function(){define("exports ../core/maybe ../views/3d/webgl-engine/core/shaderLibrary/output/BlendOptions ../views/3d/webgl-engine/core/shaderLibrary/terrain/BackgroundGrid.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/BlendModes.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){function e(v){const w=new f.ShaderBuilder;var t=v.output===a.BlendLayersOutput.GridOnly;const x=v.output===a.BlendLayersOutput.GridComposite;var B=x||t,q=v.output===a.BlendLayersOutput.ColorOnly;const u=v.output===a.BlendLayersOutput.ColorComposite;var C=u||q;const z=x||u;w.include(l.TileComposite);C&&w.fragment.uniforms.add(new n.Float3PassUniform("backgroundColor",A=>A.backgroundColor));v.baseOpacityMode!==a.BaseOpacityMode.One&&w.fragment.uniforms.add(new g.FloatPassUniform("baseOpacity",
A=>A.baseOpacity));B&&(w.extensions.add("GL_OES_standard_derivatives"),w.fragment.include(m.BackgroundGrid));if(t||q)return w.fragment.code.add(k.glsl`
    void main() {
      gl_FragColor = ${q?k.glsl`vec4(backgroundColor, 1.0)`:k.glsl`gridColor(uv)`};
    }
  `),w;t=v.blendMode!==c.LayerBlendMode.Normal;B=v.baseOpacityMode===a.BaseOpacityMode.OnBaseLayer;q=v.baseOpacityMode===a.BaseOpacityMode.OnBackground||v.baseOpacityMode===a.BaseOpacityMode.OnBaseLayer;C=v.premultipliedSource;w.fragment.uniforms.add(new d.Texture2DPassUniform("tex",A=>A.texture));w.fragment.uniforms.add(new g.FloatPassUniform("opacity",A=>A.opacity));if(t||B||C)w.fragment.uniforms.add(new d.Texture2DPassUniform("fboColor",A=>A.fboTexture)),w.fragment.uniforms.add(new g.FloatPassUniform("tileSize",
A=>b.isSome(A.fboTexture)?A.fboTexture.descriptor.width:1));w.fragment.include(r.BlendModes,v);w.fragment.code.add(k.glsl`
    void main() {
      ${z||B||C?k.glsl`
      vec4 bgColor = ${u?k.glsl`vec4(backgroundColor, 1.0)`:x?k.glsl`gridColor(uv)`:k.glsl`texture2D(fboColor, gl_FragCoord.xy / tileSize)`};
      ${q?k.glsl`bgColor *= baseOpacity;`:""}`:""}
      vec4 colorLayer = texture2D(tex, uv);
      ${t?k.glsl`
          vec4 fboTex = ${z?k.glsl`bgColor;`:k.glsl`texture2D(fboColor, gl_FragCoord.xy / tileSize) ${B?" * baseOpacity":""};`}
          vec3 Cb = fboTex.a == 0.0 ? fboTex.rgb : vec3(fboTex.rgb * fboTex.a);
          gl_FragColor = applyBlendMode(colorLayer.rgb, colorLayer.a * opacity, Cb, fboTex.a);`:k.glsl`
          vec4 pmColorLayer = vec4(colorLayer.xyz, 1.0);
          float composeAlpha = colorLayer.a * opacity;
          gl_FragColor = ${C?k.glsl`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`:z||B?k.glsl`mix(bgColor, pmColorLayer, composeAlpha);`:k.glsl`pmColorLayer * composeAlpha;`}`}
    }
  `);return w}a.BlendLayersOutput=void 0;(function(v){v[v.Composite=0]="Composite";v[v.ColorOnly=1]="ColorOnly";v[v.GridOnly=2]="GridOnly";v[v.ColorComposite=3]="ColorComposite";v[v.GridComposite=4]="GridComposite";v[v.COUNT=5]="COUNT"})(a.BlendLayersOutput||(a.BlendLayersOutput={}));a.BaseOpacityMode=void 0;(function(v){v[v.One=0]="One";v[v.OnBackground=1]="OnBackground";v[v.OnBaseLayer=2]="OnBaseLayer";v[v.COUNT=3]="COUNT"})(a.BaseOpacityMode||(a.BaseOpacityMode={}));const h=Object.freeze(Object.defineProperty({__proto__:null,
get BlendLayersOutput(){return a.BlendLayersOutput},get BaseOpacityMode(){return a.BaseOpacityMode},build:e},Symbol.toStringTag,{value:"Module"}));a.BlendLayers=h;a.build=e})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/BlendModes.glsl":function(){define(["exports","../output/BlendOptions","../../shaderModules/interfaces"],function(a,b,c){a.BlendModes=function(m,l){l=l.blendMode;if(l!==b.LayerBlendMode.Normal){l===b.LayerBlendMode.Reflect&&m.code.add(c.glsl`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`);l!==b.LayerBlendMode.ColorDodge&&l!==b.LayerBlendMode.VividLight||m.code.add(c.glsl`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`);l!==b.LayerBlendMode.ColorBurn&&l!==b.LayerBlendMode.VividLight||m.code.add(c.glsl`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`);l===b.LayerBlendMode.Overlay&&m.code.add(c.glsl`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`);l===b.LayerBlendMode.HardLight&&m.code.add(c.glsl`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`);l===b.LayerBlendMode.SoftLight&&m.code.add(c.glsl`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`);l===b.LayerBlendMode.VividLight&&m.code.add(c.glsl`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`);if(l===b.LayerBlendMode.Hue||l===b.LayerBlendMode.Saturation||l===b.LayerBlendMode.Color||l===b.LayerBlendMode.Luminosity)m.code.add(c.glsl`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),l!==b.LayerBlendMode.Hue&&l!==b.LayerBlendMode.Saturation||m.code.add(c.glsl`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`);m.code.add(c.glsl`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${l===b.LayerBlendMode.Multiply?c.glsl`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.Average?c.glsl`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.Lighten?c.glsl`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.Darken?c.glsl`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:
l===b.LayerBlendMode.Lighter?c.glsl`return vec4(cl * ol + cb * ob, ol + ob);`:l===b.LayerBlendMode.Plus?c.glsl`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:l===b.LayerBlendMode.Minus?c.glsl`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:l===b.LayerBlendMode.Screen?c.glsl`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.Difference?c.glsl`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:
l===b.LayerBlendMode.Invert?c.glsl`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:l===b.LayerBlendMode.DestinationOver?c.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:l===b.LayerBlendMode.DestinationAtop?c.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:l===b.LayerBlendMode.DestinationOut?c.glsl`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:l===b.LayerBlendMode.SourceAtop?c.glsl`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:l===b.LayerBlendMode.SourceOut?
c.glsl`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:l===b.LayerBlendMode.Xor?c.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:l===b.LayerBlendMode.DestinationIn?c.glsl`return vec4(cb * ob * ol, ol * ob);`:l===b.LayerBlendMode.SourceIn?c.glsl`return vec4(cl * ol * ob, ol * ob);`:l===b.LayerBlendMode.Hue?c.glsl`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.Saturation?c.glsl`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.Color?c.glsl`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.Luminosity?c.glsl`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.Exclusion?c.glsl`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.Reflect?c.glsl`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.ColorDodge?c.glsl`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.ColorBurn?c.glsl`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.Overlay?c.glsl`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.SoftLight?c.glsl`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.HardLight?c.glsl`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.VividLight?c.glsl`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:c.glsl``}
    }
  `)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/rasterUtils":function(){define("exports ../../chunks/vec2f64 ./context-util ./enums ./FramebufferObject ./Texture".split(" "),function(a,b,c,m,l,r){a.createColormapTexture=function(n,g){return new r.Texture(n,{width:g.length/4,height:1,target:m.TextureType.TEXTURE_2D,pixelFormat:m.PixelFormat.RGBA,internalFormat:m.PixelFormat.RGBA,dataType:m.PixelType.UNSIGNED_BYTE,samplingMode:m.TextureSamplingMode.NEAREST,
wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE,flipped:!1},g)};a.createFrameBuffer=function(n,g,k,f){f=new r.Texture(n,{width:g,height:k,target:m.TextureType.TEXTURE_2D,pixelFormat:m.PixelFormat.RGBA,internalFormat:m.PixelFormat.RGBA,samplingMode:m.TextureSamplingMode.NEAREST,dataType:f?m.PixelType.UNSIGNED_BYTE:m.PixelType.FLOAT,wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE,flipped:!1});return new l.FramebufferObject(n,{colorTarget:m.TargetType.TEXTURE,depthStencilTarget:m.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER,
width:g,height:k},f)};a.createRasterTexture=function(n,g,k="nearest",f=!1){var d;const e=(f=!(f&&"u8"===g.pixelType))?m.PixelType.FLOAT:m.PixelType.UNSIGNED_BYTE,h=null==g.pixels||0===g.pixels.length?null:f?g.getAsRGBAFloat():g.getAsRGBA(),v=null==(d=n.capabilities.textureFloat)?void 0:d.textureFloatLinear;return new r.Texture(n,{width:g.width,height:g.height,target:m.TextureType.TEXTURE_2D,pixelFormat:m.PixelFormat.RGBA,internalFormat:n.type===c.ContextType.WEBGL2&&f?m.SizedPixelFormat.RGBA32F:m.PixelFormat.RGBA,
samplingMode:!v||"bilinear"!==k&&"cubic"!==k?m.TextureSamplingMode.NEAREST:m.TextureSamplingMode.LINEAR,dataType:e,wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE,flipped:!1},h)};a.createTransformTexture=function(n,g){const {spacing:k,offsets:f,coefficients:d,size:[e,h]}=g;var v=1<k[0];g={width:v?4*e:e,height:h,target:m.TextureType.TEXTURE_2D,pixelFormat:m.PixelFormat.RGBA,internalFormat:n.type===c.ContextType.WEBGL2?m.SizedPixelFormat.RGBA32F:m.PixelFormat.RGBA,dataType:m.PixelType.FLOAT,samplingMode:m.TextureSamplingMode.NEAREST,
wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE,flipped:!1};const w=new Float32Array(v?e*h*16:2*f.length);if(v)for(let t=0,x=0;t<d.length;t++)w[x++]=d[t],2===t%3&&(w[x++]=1);else for(v=0;v<h;v++)for(let t=0;t<e;t++){const x=4*(v*e+t),B=2*(t*h+v);w[x]=f[B];w[x+1]=f[B+1];w[x+3]=-1===f[B]?0:1}return new r.Texture(n,g,w)};a.getBasicGridUniforms=function(n,g){return{u_scale:n,u_offset:g}};a.getColormapUniforms=function(n,g){return{u_colormapOffset:g||0,u_colormapMaxIndex:n?n.length/4-1:0}};a.getCommonUniforms=
function(n,g,k,f=1,d=!0){return{u_flipY:d,u_applyTransform:n?!0:!1,u_opacity:f,u_transformSpacing:n?n.spacing:b.ZEROS,u_transformGridSize:n?n.size:b.ZEROS,u_targetImageSize:g,u_srcImageSize:k}};a.getShadedReliefUniforms=function(n){return{u_hillshadeType:n.hillshadeType,u_sinZcosAs:n.sinZcosAs,u_sinZsinAs:n.sinZsinAs,u_cosZs:n.cosZs,u_weights:n.weights,u_factor:n.factor,u_minValue:n.minValue,u_maxValue:n.maxValue}};a.getStretchUniforms=function(n){return{u_bandCount:n.bandCount,u_minOutput:n.outMin,
u_maxOutput:n.outMax,u_minCutOff:n.minCutOff,u_maxCutOff:n.maxCutOff,u_factor:n.factor,u_useGamma:n.useGamma,u_gamma:n.gamma,u_gammaCorrection:n.gammaCorrection}};a.getUniformLocationInfos=function(n,g){n=n.gl;g=g.glName;const k=n.getProgramParameter(g,n.ACTIVE_UNIFORMS),f=new Map;let d;for(let e=0;e<k;e++)(d=n.getActiveUniform(g,e))&&f.set(d.name,{location:n.getUniformLocation(g,d.name),info:d});return f};a.setTextures=function(n,g,k,f){k.length===f.length&&(f.some(d=>null==d)||k.some(d=>null==d)||
k.forEach((d,e)=>{g.setUniform1i(d,e);n.bindTexture(f[e],e)}))};a.setUniforms=function(n,g,k){Object.keys(k).forEach(f=>{var d=g.get(f)||g.get(f+"[0]");if(d){var e=k[f];if(null!==d&&null!=e)switch({info:d}=d,d.type){case m.UniformType.FLOAT:1<d.size?n.setUniform1fv(f,e):n.setUniform1f(f,e);break;case m.UniformType.FLOAT_VEC2:n.setUniform2fv(f,e);break;case m.UniformType.FLOAT_VEC3:n.setUniform3fv(f,e);break;case m.UniformType.FLOAT_VEC4:n.setUniform4fv(f,e);break;case m.UniformType.FLOAT_MAT3:n.setUniformMatrix3fv(f,
e);break;case m.UniformType.FLOAT_MAT4:n.setUniformMatrix4fv(f,e);break;case m.UniformType.INT:1<d.size?n.setUniform1iv(f,e):n.setUniform1i(f,e);break;case m.UniformType.BOOL:n.setUniform1i(f,e?1:0);break;case m.UniformType.INT_VEC2:case m.UniformType.BOOL_VEC2:n.setUniform2iv(f,e);break;case m.UniformType.INT_VEC3:case m.UniformType.BOOL_VEC3:n.setUniform3iv(f,e);break;case m.UniformType.INT_VEC4:case m.UniformType.BOOL_VEC4:n.setUniform4iv(f,e)}}})};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ./terrainUtils ./tileUtils".split(" "),function(a,b,c,m,l,r,n){let g=function(){function d(){this.waitingAgents=new l;this.requestAbort=this.requestPromise=this.loadingAgent=this._upsampleInfo=null;this.pendingUpdates=0}d.acquire=function(h){const v=k.acquire();v._init(h);return v};
var e=d.prototype;e.release=function(){this.dispose();f.delete(this);k.release(this)};e.dispose=function(){this.loadingAgent=c.disposeMaybe(this.loadingAgent);this.abortRequest();this._unsetUpsampleInfo();this.pendingUpdates=0;this._data=r.releaseTileData(this._data)};d.prune=function(){k.prune(0)};e._init=function(h){this.waitingAgents.clear();this._data=r.releaseTileData(this._data);this.dataInvalidated=this.dataMissing=!1;this._unsetUpsampleInfo();this.abortRequest();this.loadingAgent=null;this.pendingUpdates=
0;this._pool=h;this.elevationBounds=null};e.invalidateSourceData=function(){this.dataInvalidated=!0;this.dataMissing=!1;this._unsetUpsampleInfo()};e.abortRequest=function(){this.requestAbort=c.abortMaybe(this.requestAbort);this.requestPromise=null};e._unsetUpsampleInfo=function(){c.isSome(this._upsampleInfo)&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)};e.setUpsampleInfo=function(h,v){if(h===v||c.isNone(v))this._unsetUpsampleInfo();else{if(c.isNone(this._upsampleInfo))this._upsampleInfo=
this._pool.acquire();else{if(this._upsampleInfo.tile===v)return;this._upsampleInfo.tile.unrefMapData()}v.refMapData();n.computeUpsampleInfo(h,v,this._upsampleInfo)}};b._createClass(d,[{key:"upsampleInfo",get:function(){return this._upsampleInfo}},{key:"data",get:function(){return this._data},set:function(h){r.releaseTileData(this._data);this._data=h}}]);return d}();const k=new m(g,null,()=>{}),f=new Map;a.TilePerLayerInfo=g;a.printAllocations=function(){0<f.size&&(console.log(`${f.size} live TilePerLayerInfo allocations:`),
f.forEach(d=>console.log(d,"\n")))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TileTexture":function(){define(["../../../chunks/_rollupPluginBabelHelpers"],function(a){return function(){function b(m){this._texture=m;this.type="tile-texture";this._refCount=1}var c=b.prototype;c.retain=function(){++this._refCount};c.release=function(){--this._refCount;0===this._refCount&&this._texture.dispose()};c.generateMipmap=function(){this._texture.generateMipmap()};
a._createClass(b,[{key:"texture",get:function(){return this._texture}},{key:"descriptor",get:function(){return this._texture.descriptor}}]);return b}()})},"esri/views/3d/terrain/TileUpdate":function(){define(["exports"],function(a){a.TileUpdate=void 0;var b=a.TileUpdate||(a.TileUpdate={});b[b.NONE=0]="NONE";b[b.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD";b[b.SPLIT=2]="SPLIT";b[b.VSPLITMERGE=4]="VSPLITMERGE";b[b.MERGE=8]="MERGE";b[b.RENDERDATA=16]="RENDERDATA";b[b.GEOMETRY=32]="GEOMETRY";b[b.TEXTURE_NOFADING=
64]="TEXTURE_NOFADING";b[b.TEXTURE_FADING=128]="TEXTURE_FADING";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TileOverlayData":function(){define(["../../../chunks/_rollupPluginBabelHelpers"],function(a){return function(){function b(){this._scales=[-1,-1,-1,-1];this._offsets=[-1,-1,-1,-1]}var c=b.prototype;c.clear=function(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1;this._offsets[0]=this._offsets[1]=this._offsets[2]=
this._offsets[3]=-1};c.setScale=function(m,l,r){this._scales[2*m]=l;this._scales[2*m+1]=r};c.setOffset=function(m,l,r){this._offsets[2*m]=l;this._offsets[2*m+1]=r};a._createClass(b,[{key:"scales",get:function(){return this._scales}},{key:"offsets",get:function(){return this._offsets}}]);return b}()})},"esri/views/3d/terrain/RenderOrder":function(){define(["exports"],function(a){a.RenderOrder=void 0;var b=a.RenderOrder||(a.RenderOrder={});b[b.BACK_TO_FRONT=-1]="BACK_TO_FRONT";b[b.NONE=0]="NONE";b[b.FRONT_TO_BACK=
1]="FRONT_TO_BACK";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/SphericalPatch":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/frustum ../../../geometry/support/plane ./interfaces ./PatchGeometryFactory ./Tile".split(" "),function(a,b,c,m,l,r,n,g,
k,f,d,e){e=function(w){function t(B,q,u){var C=w.call(this)||this;C.obb=Array(8);for(let z=0;8>z;z++)C.obb[z]=l.create();void 0!==B&&C.init(B,q,u);return C}b._inheritsLoose(t,w);var x=t.prototype;x.init=function(B,q,u){w.prototype.init.call(this,B,q,u);q=this.ellipsoid.radius;u=this.extentInRadians[0];const C=this.extentInRadians[1],z=this.extentInRadians[2],A=this.extentInRadians[3];B=B[0];const p=c.lerp(C,A,.5),y=c.lerp(u,z,.5);this._edgeLen=(z-u)*Math.cos(0===B?0:Math.min(Math.abs(C),Math.abs(A)))*
q;this._edgeLen2=this._edgeLen*this._edgeLen;this._curvatureHeight=q-Math.sqrt(q*q-this._edgeLen2/4);r.lonLatToSphericalPCPF(this.centerAtSeaLevel,y,p,this.ellipsoid.radius);q=l.fromArray(this.centerAtSeaLevel);m.normalize(q,q);this.up=q;this._updateOBB();this.updateRadiusAndCenter()};x.updateRadiusAndCenter=function(){if(0===this.lij[0])m.set(this._center[a.CenterPosition.MIDDLE],0,0,0),m.set(this._center[a.CenterPosition.TOP],0,0,0),m.set(this._center[a.CenterPosition.BOTTOM],0,0,0),this.ellipsoid||
(this.ellipsoid=n.getReferenceEllipsoid(this.surface.spatialReference)),this._center[a.CenterPosition.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const B=Math.max(m.squaredDistance(this._center[a.CenterPosition.MIDDLE],this.obb[0]),m.squaredDistance(this._center[a.CenterPosition.MIDDLE],this.obb[1]));this._center[a.CenterPosition.MIDDLE][3]=Math.sqrt(B)}};x._isVisible=function(B){if(!g.intersectsSphere(B,this._center[a.CenterPosition.MIDDLE]))return!1;if(10>
this.lij[0])return!0;const q=this.obb;for(let z=0;z<g.NumPlanes.NUM;z++){var u=z===g.PlaneIndex.NEAR,C=B[z];u&&(v[0]=C[0],v[1]=C[1],v[2]=C[2],v[3]=C[3]-this.surface.view.state.camera.near);u=u?v:C;for(C=0;8>C;C++){const A=q[C];if(0>u[0]*A[0]+u[1]*A[1]+u[2]*A[2]+u[3])break}if(8===C)return!1}return!0};x.computeElevationBounds=function(){w.prototype.computeElevationBounds.call(this);this._updateOBB()};x.createGeometry=function(){const B=this._getPatchType(this.lij[1],this.lij[0]);d.createSphericalGlobePatch(this.renderData,
B);this.setMemoryDirty()};x._updateOBB=function(){const B=this.extentInRadians,q=this.obb;for(let u=0;2>u;u++){const C=this.elevationBounds[u];let z=4*u;r.lonLatToSphericalPCPF(q[z++],B[0],B[1],this.ellipsoid.radius+C);r.lonLatToSphericalPCPF(q[z++],B[0],B[3],this.ellipsoid.radius+C);r.lonLatToSphericalPCPF(q[z++],B[2],B[3],this.ellipsoid.radius+C);r.lonLatToSphericalPCPF(q[z++],B[2],B[1],this.ellipsoid.radius+C)}if(this.surface.isWebMercator)switch(this._getPatchType(this.lij[1],this.lij[0])){case f.PatchType.HAS_NORTH_POLE:m.set(q[1],
0,0,this.ellipsoid.radius);m.set(q[2],0,0,this.ellipsoid.radius);m.set(q[5],0,0,this.ellipsoid.radius);m.set(q[6],0,0,this.ellipsoid.radius);break;case f.PatchType.HAS_SOUTH_POLE:m.set(q[0],0,0,-this.ellipsoid.radius),m.set(q[3],0,0,-this.ellipsoid.radius),m.set(q[4],0,0,-this.ellipsoid.radius),m.set(q[7],0,0,-this.ellipsoid.radius)}};x._getPatchType=function(B,q){return B===(1<<q)-1?0===B?f.PatchType.HAS_BOTH_POLES:f.PatchType.HAS_SOUTH_POLE:0===B?f.PatchType.HAS_NORTH_POLE:f.PatchType.REGULAR};
x.intersectsRay=function(B,q,u,C){var z=this._center[a.CenterPosition.MIDDLE];u=z[3]+u;var A=z[0]-B[0];C=z[1]-B[1];B=z[2]-B[2];z=(A*q[0]+C*q[1]+B*q[2])/(q[0]*q[0]+q[1]*q[1]+q[2]*q[2]);A=q[0]*z-A;C=q[1]*z-C;q=q[2]*z-B;return A*A+C*C+q*q<u*u};x.getDefaultVerticesPerRowOnLevel=function(){return this.level<h.length?h[this.level]+1:2};x.updateCornerElevations=function(){d.updateCornerElevationsSpherical(this.renderData)};x.updateEdgeElevations=function(){d.updateEdgesElevationsSpherical(this.renderData)};
return t}(e.Tile);const h=[128,64,32,16,16,8,8,4],v=k.create();a.CenterPosition=void 0;(function(w){w[w.TOP=0]="TOP";w[w.MIDDLE=1]="MIDDLE";w[w.BOTTOM=2]="BOTTOM"})(a.CenterPosition||(a.CenterPosition={}));a.SphericalPatch=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TerrainRenderer":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/ObjectPool ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/buffer/BufferView ../../ViewingMode ./interfaces ./LayerClass ./Overlay ./OverlayRenderer ./PatchGeometry ./PatchRenderData ./RenderOrder ./ScaleRangeQueries ./terrainUtils ./TileRenderer ./TileUpdate ./tileUtils ../webgl-engine/collections/Component/ComponentIntersectionData ../webgl-engine/core/shaderLibrary/ShaderOutputOptions ../webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../../../chunks/Terrain.glsl ../webgl-engine/core/shaderLibrary/terrain/TileBlendInput ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Intersector ../webgl-engine/lib/IntersectorInterfaces ../webgl-engine/lib/Material ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/VertexAttribute ../webgl-engine/lib/verticalOffsetUtils ../webgl-engine/materials/DrawParameters ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/shaders/TerrainTechnique ../webgl-engine/shaders/TerrainTechniqueConfiguration ../../webgl/enums".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N,M,L,J,H,I,O,Q,S,T,U,aa,W,R,V,da,ca,ha,ia){function ka(ja,oa,sa){sa[0]=ja[0]*oa[2]+oa[0];sa[1]=ja[1]*oa[3]+oa[1];sa[2]=ja[2]*oa[2];sa[3]=ja[3]*oa[3]}const la=t.create(),Y=w.create();m=function(ja){function oa(qa){qa=ja.call(this,qa)||this;qa.type=Q.IntersectorType.TERRAIN;qa.isGround=!0;qa.tileSize=256;qa._techniqueConfiguration=new ha.TerrainTechniqueConfiguration;qa._passParameters=new L.TerrainPassParameters;qa.rctx=null;qa._isTransparent=
!1;qa._scaleRangeQueries=new D.ScaleRangeQueries;qa.renderDataPool=new r(p.PatchRenderData);qa._patchGroups=new Map;qa.patchGroupsDirty=!0;qa.tileIterator=new P.IteratorPreorder;qa.highestVisibleLODTile=null;qa.visible=!0;qa._opaque=!0;qa._velvetOverground=!0;qa._castShadows=!0;qa.emptyTex=null;qa.tileRenderer=null;qa.stencilEnabledLayerExtents=[];qa.numTilesRendered=0;qa.numTilesCulled=0;qa.numOriginsRendered=0;qa.needsHighlight=!1;qa.renderOccludedFlags=S.RenderOccludedFlag.Occlude;return qa}a._inheritsLoose(oa,
ja);var sa=oa.prototype;sa.initialize=function(){this.stage.addRenderPlugin([U.RenderSlot.OPAQUE_TERRAIN,U.RenderSlot.TRANSPARENT_TERRAIN,U.RenderSlot.OCCLUDED_TERRAIN],this)};sa.destroy=function(){this.stage.removeRenderPlugin(this);A.clearCaches()};sa.setDebugScreenSizePerspective=function(qa){this._techniqueConfiguration.screenSizePerspective!==qa&&(this._techniqueConfiguration.screenSizePerspective=qa,this.setNeedsRender())};sa.toggleShading=function(){this._techniqueConfiguration.shading=!this._techniqueConfiguration.shading;
this.setNeedsRender()};sa.setRootTiles=function(qa){this._rootTiles=qa;this.setNeedsRender()};sa.setNeedsHighlight=function(qa){this.needsHighlight=qa;this.setNeedsRender()};sa.setRenderOccludedOverlay=function(qa){this.renderOccludedFlags=qa?z.overlayRenderOccludedFlag:S.RenderOccludedFlag.Occlude;this.setNeedsRender()};sa.setStencilEnabledLayerExtents=function(qa){this.stencilEnabledLayerExtents=qa;this.setNeedsRender()};sa.setTileSize=function(qa){this.tileSize=qa;l.isSome(this.tileRenderer)&&
(this.tileRenderer.tileSize=qa);this.setNeedsRender()};sa._prepareTileForLoading=function(qa){qa.renderData||(qa.renderData=this.renderDataPool.acquire(),qa.renderData.init(qa),qa.renderData.localOrigin=this._getLocalOriginOfTile(qa))};sa.loadTile=function(qa){this._prepareTileForLoading(qa);this.updateTileGeometry(qa);this.updateTileTexture(qa,G.TileUpdate.TEXTURE_FADING)};sa.queryVisibleLevelRange=function(qa,Ha,Ga,pa){this._scaleRangeQueries.queryVisibleLevelRange(qa,Ha,Ga,pa);this.setNeedsRender()};
sa.updateTileTexture=function(qa,Ha){l.isSome(this.tileRenderer)&&(this.tileRenderer.updateTileTexture(qa,Ha===G.TileUpdate.TEXTURE_FADING?q.TextureUpdate.FADING:q.TextureUpdate.UNFADED),this.setNeedsRender(),qa.resetPendingUpdate(Ha))};sa.updateTileGeometryState=function(qa){this._prepareTileForLoading(qa);qa.renderData.updateGeometryStateAndPrepareForGeometryGeneration(this.wireframe)};sa.updateTileGeometry=function(qa){for(const Ha of qa.layerInfo[u.LayerClass.ELEVATION])Ha.pendingUpdates&=~G.TileUpdate.GEOMETRY;
qa.resetPendingUpdate(G.TileUpdate.GEOMETRY);qa.renderData.updateGeometryIfChanged(this.rctx,this.wireframe)&&this.setNeedsRender()};sa.unloadTile=function(qa){const Ha=qa.renderData;Ha&&(Ha.releaseGeometry(),this.renderDataPool.release(Ha),Ha.clear(),qa.renderData=null,qa.setMemoryDirty(),this.setNeedsRender())};sa._getLocalOriginOfTile=function(qa){const Ha=Math.max(0,7*Math.floor((qa.level-3)/7));if(this.isGlobal&&0===Ha)return v.ZEROS;for(;qa.parent&&qa.level>Ha;)qa=qa.parent;return qa.centerAtSeaLevel};
sa.setVisibility=function(qa){this.visible=qa;this.setNeedsRender()};sa.getStats=function(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numOriginsRendered:this.numOriginsRendered}};sa.setNeedsRender=function(qa=H.RenderRequestType.UPDATE){this.patchGroupsDirty=!0;this._context.requestRender(qa)};sa.initializeRenderContext=function(qa){this._context=qa;this.rctx=qa.renderContext.rctx;this._techniqueRepository=qa.shaderTechniqueRepository;this.tileRenderer=new F.TileRenderer(this.rctx,
this.tileSize,this._techniqueRepository);this.updateTileBackground();this.emptyTex=I.createEmptyTexture(this.rctx)};sa.uninitializeRenderContext=function(){this.emptyTex=l.disposeMaybe(this.emptyTex);this.tileRenderer=l.disposeMaybe(this.tileRenderer)};sa.intersect=function(qa,Ha,Ga,pa){if(this._rootTiles&&(!qa.options.selectOpaqueTerrainOnly||!qa.options.selectionMode||this._opaque)){var Da=ea,ra=ba;h.subtract(Da,pa,Ga);h.set(ra,1/Da[0],1/Da[1],1/Da[2]);var Ea=qa.results.min,Ia=qa.results.max,Ma=
qa.results.ground,Qa=qa.options.store===Q.StoreResults.MIN,wa=!!qa.results.ground.target,Ja=R.getVerticalOffsetTerrain(qa.verticalOffset),Ta=qa.tolerance,Xa,ma=Qa&&l.isSome(Ea.dist)?Ea.dist:Infinity,$a=Ka=>{var Oa=Ka.renderData;if(null!=Oa&&Oa.vao){var Va=Oa.geometryInfo;t.set(la,Va.boundingBox);var Ra=Oa.localOrigin;l.isSome(Ja)&&(Ja.localOrigin=Ra,Ja.applyToAabb(la));Z[0]=Ga[0]-Ra[0];Z[1]=Ga[1]-Ra[1];Z[2]=Ga[2]-Ra[2];if(da.intersectAabbInvDirBefore(la,Z,ra,Ta,ma)){var za=(Wa,bb,Aa)=>{Wa.set(this.type,
Ka,bb,Aa,e.IDENTITY);ma=Qa&&l.isSome(Ea.dist)?Ea.dist:Infinity};Oa=(Wa,bb)=>{l.isSome(bb)&&0<=Wa&&(qa.options.backfacesTerrain||0>h.dot(bb,Da))&&(qa.options.invisibleTerrain||!qa.options.selectionMode||null==Ha||Ha(Ga,pa,Wa))&&((null==Ma.dist||Wa<Ma.dist)&&za(Ma,Wa,bb),qa.options.isFiltered||(qa.options.store===Q.StoreResults.ALL&&(l.isNone(Xa)?(Xa=O.newIntersectorResult(qa.ray),za(Xa,Wa,bb),qa.results.all.push(Xa)):Wa<Xa.dist&&za(Xa,Wa,bb)),(null==Ea.dist||Wa<Ea.dist)&&za(Ea,Wa,bb),qa.options.store!==
Q.StoreResults.MIN&&(null==Ia.dist||Wa>Ia.dist)&&za(Ia,Wa,bb)))};var ya=fa;h.subtract(ya,pa,Ra);Ra=Va.indices;var Na=Va.vertexAttributes;Na={data:Na.getField(W.VertexAttribute.POSITION,x.BufferViewVec3f).typedBuffer,size:3,stride:Na.stride/4};Va=Va.indexCount/3;if(l.isNone(Ja)&&Va>K.componentMinimalSizeForIntersectionData){const Wa=Ka.renderData;l.isNone(Wa.intersectionData)&&(Wa.intersectionData=new K.ComponentIntersectionData(Ra,0,Va,Na));Wa.intersectionData.intersectRay({r0:Z,r1:ya},Oa)}else da.intersectTriangles(Z,
ya,0,Va,Ra,Na,null,Ja,Oa)}}},xa=this._rootTiles;l.isSome(xa)&&(()=>{const Ka=this.tileIterator;Ka.reset(xa);const Oa=qa.options.invisibleTerrain;for(;!Ka.done;){const Va=Ka.next();!(Va.visible||Oa&&Va.intersectsClippingArea)||!l.isSome(Ja)&&!Va.intersectsRay(Ga,Da,Ta,ma)||wa&&this._useStencilForTile(Va)?Ka.skipSubtree():$a(Va)}})()}};sa.prepareTechnique=function(qa){if(qa.bindParameters.slot===U.RenderSlot.OCCLUDED_TERRAIN){if(0===(qa.renderOccludedMask&z.overlayRenderOccludedFlag))return null}else if(qa.bindParameters.slot!==
(this.opaque?U.RenderSlot.OPAQUE_TERRAIN:U.RenderSlot.TRANSPARENT_TERRAIN))return null;switch(qa.pass){case T.RenderPass.MATERIAL:return this._techniqueConfiguration.hasScreenSpaceReflections=qa.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=l.isSome(qa.bindParameters.clouds.data),this._techniqueConfiguration.receiveShadows=qa.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=qa.bindParameters.ssaoHelper.ready,this._techniqueConfiguration.overlayMode=
this.overlayRenderer.isEmpty()?M.OverlayMode.Disabled:this.overlayRenderer.hasWater?M.OverlayMode.EnabledWithWater:M.OverlayMode.Enabled,this._updateTechnique(N.ShaderOutput.Color,(qa.bindParameters.slot===U.RenderSlot.OCCLUDED_TERRAIN?C.OverlaySource.Occluded:C.OverlaySource.ColorAndWater)===C.OverlaySource.Occluded);case T.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL:case T.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:if(this._castShadows&&1===qa.bindParameters.lighting.globalFactor)return this._techniqueConfiguration.receiveShadows=
this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(N.ShaderOutput.Shadow,!1);break;case T.RenderPass.MATERIAL_DEPTH:if(!this.isTransparent||!this.overlayRenderer.isEmpty())return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(N.ShaderOutput.Depth,!1);break;case T.RenderPass.MATERIAL_NORMAL:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(N.ShaderOutput.Normal,
!1);case T.RenderPass.MATERIAL_HIGHLIGHT:if(this.needsHighlight)return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(N.ShaderOutput.Highlight,!1)}return null};sa.render=function(qa,Ha){const Ga=qa.pass,pa=1===qa.bindParameters.lighting.globalFactor;this._updatePatchGroups();Ha.useStencil=!1;switch(Ga){case T.RenderPass.MATERIAL:this._renderMaterialPass(qa,Ha,qa.bindParameters.slot===U.RenderSlot.OCCLUDED_TERRAIN?C.OverlaySource.Occluded:
C.OverlaySource.ColorAndWater);break;case T.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL:case T.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:this._castShadows&&pa&&this._renderAuxiliaryPass(qa,Ha,C.OverlaySource.None);break;case T.RenderPass.MATERIAL_DEPTH:this.isTransparent&&this.overlayRenderer.isEmpty()||this._renderAuxiliaryPass(qa,Ha,C.OverlaySource.None);break;case T.RenderPass.MATERIAL_NORMAL:this._renderAuxiliaryPass(qa,Ha,C.OverlaySource.None);break;case T.RenderPass.MATERIAL_HIGHLIGHT:this.needsHighlight&&
(this._renderAuxiliaryPass(qa,Ha,C.OverlaySource.Highlight),qa.rctx.clearSafe(ia.ClearBufferBit.DEPTH_BUFFER_BIT))}this._scaleRangeQueries.hasPendingQueries()&&this.setNeedsRender()};sa._renderMaterialPass=function(qa,Ha,Ga){const {rctx:pa}=qa;this._passParameters.overlaySource=Ga;pa.bindTechnique(Ha,this._passParameters,qa.bindParameters);this.numOriginsRendered=this.numTilesCulled=this.numTilesRendered=0;this._scaleRangeQueries.prepareQueries();this.opaque?this._renderPatchGroups(qa,Ha,Ga):qa.offscreenRenderingHelper.renderToTargets(()=>
this._renderPatchGroups(qa,Ha,Ga),qa.offscreenRenderingHelper.tmpColor,qa.offscreenRenderingHelper.mainDepth,[0,0,0,0]);this._scaleRangeQueries.processQueries()};sa._renderAuxiliaryPass=function(qa,Ha,Ga){const pa=qa.rctx;this._passParameters.overlaySource=Ga;pa.bindTechnique(Ha,this._passParameters,qa.bindParameters);this._renderPatchGroupsAuxiliary(qa,Ha,Ga)};sa.updateTileBackground=function(qa=null){if(!l.isNone(this.tileRenderer)){var Ha=this.tileRenderer,Ga=null;l.isSome(qa)&&(qa=c.toUnitRGBA(qa),
Ga=v.fromValues(qa[0]||0,qa[1]||0,qa[2]||0));Ha.setBackground(Ga);this.allTiles.forAll(pa=>Ha.updateTileTexture(pa,q.TextureUpdate.FADING));this._techniqueConfiguration.tileBlendInput=Ha.backgroundIsGrid?J.TileBlendInput.GridComposite:l.isSome(Ha.backgroundColor)?J.TileBlendInput.ColorComposite:J.TileBlendInput.LayerOnly;this.setNeedsRender()}};sa._updatePatchGroups=function(){if(this.patchGroupsDirty){this.highestVisibleLODTile=null;this._rebuildPatchGroups();if(this.renderOrder!==y.RenderOrder.NONE){const qa=
Array.from(this._patchGroups.values());qa.forEach(Ha=>P.sortTiles(this.renderOrder,Ha));qa.sort((Ha,Ga)=>P.compareTiles(Ha[0],Ga[0],this.renderOrder));this._patchGroups=new Map(qa.map(Ha=>[Ha[0].renderData.localOrigin,Ha]))}this.patchGroupsDirty=!1}};sa._rebuildPatchGroups=function(){var qa;const Ha=this._rootTiles;if(!l.isNone(Ha)){null==(qa=Ha[0])?void 0:qa.surface.checkAllTileWaterproofness();this._patchGroups.clear();for(const Ga of Ha)this._rebuildPatchGroupsForRootTile(Ga)}};sa._rebuildPatchGroupsForRootTile=
function(qa){const Ha=this.tileIterator;for(Ha.resetOne(qa);!Ha.done;){qa=Ha.next();const Ga=qa.renderData;if(Ga&&!qa.visible)this.numTilesCulled++,Ha.skipSubtree();else if(!qa.rendered)this.numTilesCulled++;else if(Ga){const pa=this._patchGroups.get(Ga.localOrigin)||[];this._patchGroups.set(Ga.localOrigin,pa);pa.push(qa);if(!this.highestVisibleLODTile||qa.vlevel>this.highestVisibleLODTile.vlevel)this.highestVisibleLODTile=qa;Ha.skipSubtree()}}};sa._useStencilForTile=function(qa){for(const Ha of this.stencilEnabledLayerExtents)if(qa.intersectsExtent(Ha))return!0;
return!1};sa._renderPatchGroupsAuxiliary=function(qa,Ha,Ga){const pa=0<this.stencilEnabledLayerExtents.length;this._patchGroups.forEach(Da=>{Ha.program.bindDraw(new V.DrawParameters(Da[0].renderData.localOrigin),qa.bindParameters);for(let ra=0;ra<Da.length;ra++)this._renderPatch(qa,Ha,Da[ra],ia.PrimitiveType.TRIANGLES,pa,Ga)});qa.rctx.bindVAO(null)};sa._renderPatchGroups=function(qa,Ha,Ga){const pa=qa.rctx;var Da=qa.bindParameters.camera;const ra=Ha.program;this._techniqueConfiguration.screenSizePerspective&&
this.pointsOfInterest&&aa.getSettings(this.stage.viewingMode,this.ellipsoidRadius).update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:Da.fovY});const Ea=0<this.stencilEnabledLayerExtents.length,Ia=Ga===C.OverlaySource.Occluded;Ia&&(ra.bindTexture("tex",this.emptyTex),ra.setUniform1f("blend",1),ra.setUniform4fv("texOffsetAndScale",w.ZEROS));Da=l.isSome(this.tileRenderer)&&l.isSome(this.tileRenderer.backgroundColor)?this.tileRenderer.backgroundColor:v.ZEROS;this._techniqueConfiguration.tileBlendInput===
J.TileBlendInput.ColorComposite&&ra.setUniform3fv("backgroundColor",Da);const Ma=this.wireframe?ia.PrimitiveType.LINES:ia.PrimitiveType.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&ra.bindTexture("texNext",this.emptyTex);this._patchGroups.forEach(Qa=>{Ha.program.bindDraw(new V.DrawParameters(Qa[0].renderData.localOrigin),qa.bindParameters);this.numOriginsRendered++;for(let wa=0;wa<Qa.length;wa++){const Ja=Qa[wa],Ta=Ja.renderData.textureReference;if(!l.isNone(Ta)){if(!Ia){this._scaleRangeQueries.scaleQueriesForTile(Ja);
ka(Ja.renderData.geometryInfo.uvOffsetAndScale,Ta.offsetAndScale,Y);ra.setUniform4fv("texOffsetAndScale",Y);ra.bindTexture("tex",Ta.texture.texture);const Xa=Ja.renderData.textureFadeFactor,ma=1>Xa?Ja.renderData.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&l.isSome(ma)&&1>Xa?(ka(Ja.renderData.geometryInfo.uvOffsetAndScale,ma.offsetAndScale,Y),ra.setUniform1f("fadeFactor",Xa),ra.setUniform4fv("nextTexOffsetAndScale",Y),ra.setUniform3fv("nextTexOpacities",ma.opacities),
ra.bindTexture("texNext",ma.texture.texture)):ra.setUniform1f("fadeFactor",1);Ja.renderData.textureIsFading&&this.setNeedsRender();ra.setUniform3fv("textureOpacities",Ta.opacities)}this._renderPatch(qa,Ha,Ja,Ma,Ea,Ga);Ja.renderOrder=this.numTilesRendered;this.numTilesRendered++}}});pa.bindVAO(null)};sa._renderPatch=function(qa,Ha,Ga,pa,Da,ra){const Ea=Ga.renderData,Ia=Ea.vao,Ma=Ia.indexBuffer;if(!l.isNone(Ma)){var Qa=Ha.program;ra!==C.OverlaySource.None&&this._bindOverlayPatchData(Qa,Ea.overlay);
Da&&(Ha.useStencil=this._useStencilForTile(Ga),Ha.bindPipelineState(qa.rctx,qa.bindParameters.slot));Ha=Ea.geometryInfo.indexCount;qa.rctx.bindVAO(Ia);Qa.assertCompatibleVertexAttributeLocations(Ia);qa.rctx.drawElements(pa,Ha,Ma.indexType,0)}};sa._bindOverlayPatchData=function(qa,Ha){qa.setUniform4fv("overlayTexOffset",Ha.offsets);qa.setUniform4fv("overlayTexScale",Ha.scales)};sa._updateTechnique=function(qa,Ha){this._techniqueConfiguration.output=qa;qa===N.ShaderOutput.Color&&(this._techniqueConfiguration.atmosphere=
this.isGlobal&&this._velvetOverground);this._techniqueConfiguration.renderOccluded=Ha;this._techniqueConfiguration.stencilEnabled=!1;return this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(ca.TerrainTechnique,this._techniqueConfiguration,this._shaderTechnique)};a._createClass(oa,[{key:"isGlobal",get:function(){return this.stage.viewingMode===B.ViewingMode.Global}},{key:"shadingEnabled",get:function(){var qa;return null==(qa=this._techniqueConfiguration)?void 0:qa.shading}},{key:"canRender",
get:function(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}},{key:"renderingDisabled",set:function(qa){this._set("renderingDisabled",!!qa);this.setNeedsRender()}},{key:"opaque",get:function(){return this._opaque&&!this._techniqueConfiguration.hasSlicePlane},set:function(qa){this._opaque!==qa&&(this._opaque=qa,this.setNeedsRender())}},{key:"needsLinearDepth",get:function(){return this.overlayRenderer.hasWater}},{key:"isTransparent",get:function(){return this._isTransparent},set:function(qa){this._isTransparent!==
qa&&(this._isTransparent=qa,this.setNeedsRender())}},{key:"renderPatchBorders",get:function(){return!!this._techniqueConfiguration.tileBorders},set:function(qa){this._techniqueConfiguration.tileBorders!==qa&&(this._techniqueConfiguration.tileBorders=qa,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}},{key:"cullBackFaces",get:function(){return this._techniqueConfiguration.backfaceCullingEnabled},set:function(qa){this._techniqueConfiguration.backfaceCullingEnabled!==qa&&(this._techniqueConfiguration.backfaceCullingEnabled=
qa,this.notifyChange("cullBackFaces"),this.setNeedsRender())}},{key:"renderOrder",set:function(qa){this._set("renderOrder",qa);this.setNeedsRender()}},{key:"velvetOverground",set:function(qa){this._velvetOverground!==qa&&(this._velvetOverground=qa,this.setNeedsRender())}},{key:"layerUid",get:function(){return R.TERRAIN_ID}},{key:"slicePlaneEnabled",get:function(){return this._techniqueConfiguration.hasSlicePlane},set:function(qa){this._techniqueConfiguration.hasSlicePlane!==qa&&(this._techniqueConfiguration.hasSlicePlane=
qa,this.setNeedsRender())}},{key:"textureFadingEnabled",set:function(qa){this._techniqueConfiguration.textureFadingEnabled!==qa&&(this._techniqueConfiguration.textureFadingEnabled=qa,this.setNeedsRender())}},{key:"wireframe",set:function(qa){this._get("wireframe")!==qa&&(this._set("wireframe",qa),this.allTiles.forAll(Ha=>{Ha.isLoaded&&(this.updateTileGeometry(Ha),Ha.updateNeighborsAfterGeometryChange())}),this.setNeedsRender())}},{key:"test",get:function(){return{tileRenderer:this.tileRenderer}}}]);
return oa}(m);b.__decorate([n.property({constructOnly:!0})],m.prototype,"overlayRenderer",void 0);b.__decorate([n.property({constructOnly:!0})],m.prototype,"stage",void 0);b.__decorate([n.property({readOnly:!0})],m.prototype,"isGlobal",null);b.__decorate([n.property({constructOnly:!0})],m.prototype,"allTiles",void 0);b.__decorate([n.property({constructOnly:!0})],m.prototype,"ellipsoidRadius",void 0);b.__decorate([n.property({value:!1})],m.prototype,"renderingDisabled",null);b.__decorate([n.property()],
m.prototype,"renderPatchBorders",null);b.__decorate([n.property()],m.prototype,"cullBackFaces",null);b.__decorate([n.property({value:y.RenderOrder.FRONT_TO_BACK})],m.prototype,"renderOrder",null);b.__decorate([n.property()],m.prototype,"wireframe",null);b=m=b.__decorate([d.subclass("esri.views.3d.terrain.TerrainRenderer")],m);const ea=v.create(),ba=v.create(),Z=v.create(),fa=v.create();return b})},"esri/views/3d/terrain/ScaleRangeQueries":function(){define(["exports","../../../core/ObjectPool","../../../core/PooledArray",
"../../../chunks/vec4","../../../chunks/vec4f64"],function(a,b,c,m,l){let r=function(){this.extent=l.create();this.maxLevel=this.minLevel=0;this.callback=null},n=function(){function g(){this._queries=new c({initialSize:10});this._queriesInvPtr=0;this._queryQueue=new c({initialSize:30});this._queryPool=new b(r)}var k=g.prototype;k.queryVisibleLevelRange=function(f,d,e,h){const v=this._queryPool.acquire();m.copy(v.extent,f);v.minLevel=d?d:-Number.MAX_VALUE;v.maxLevel=null!=e?e:Number.MAX_VALUE;v.callback=
h;this._queryQueue.push(v)};k.hasPendingQueries=function(){return 0!==this._queryQueue.length};k.prepareQueries=function(){for(;this._queries.length<this._queries.data.length&&0<this._queryQueue.length;){const f=this._queryQueue.pop();this._queries.push(f)}this._queriesInvPtr=this._queries.length};k.processQueries=function(){for(let f=0;f<this._queries.length;f++){const d=this._queries.data[f];this._queryPool.release(d);d.callback(f>=this._queriesInvPtr);d.callback=null}this._queries.clear()};k.scaleQueriesForTile=
function(f){const d=f.level;let e=0;for(;e<this._queriesInvPtr;){const h=this._queries.data[e],v=h.extent;d>=h.minLevel&&d<=h.maxLevel&&v[0]<=f.extent[2]&&v[2]>=f.extent[0]&&v[1]<=f.extent[3]&&v[3]>=f.extent[1]?(this._queries.swapElements(e,this._queriesInvPtr-1),this._queriesInvPtr--):e++}};return g}();a.ScaleRangeQueries=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TileRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../layers/support/layerUtils ../support/StreamDataLoader ./BlendLayersTechnique ./interfaces ./LayerClass ./terrainUtils ./TextureFader ./TextureReference ./TileCompositor ./TileTexture ./TileUpdate ../webgl-engine/core/shaderLibrary/output/BlendOptions ../../../chunks/BlendLayers.glsl ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/Texture".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z){function A(G,P){E.layerIndex=P;const K=G.layerInfo[d.LayerClass.MAP][P];if(m.isSome(K.data))return l.set(E.offset,0,0),E.tile=G,E.scale=1,E.sourceLod=G.lij,E.sourceLayerInfo=K,E;G=K.upsampleInfo;return m.isSome(G)?(P=G.tile.layerInfo[d.LayerClass.MAP][P],E.tile=G.tile,l.copy(E.offset,G.offset),E.scale=G.scale,E.sourceLod=G.tile.lij,E.sourceLayerInfo=P,E):null}let p=function(){function G(K,N,M){this._rctx=K;this.tileSize=N;this._techniqueRepository=
M;this._passParameters=new k.BlendLayersPassParameters;this._backgroundColor=this._backgroundTexture=null;this._backgroundDirty=!1;this._blackTex=null;this._numTexturedLayer=0;this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy;this._composition=new w.TileCompositor(this._rctx,this._techniqueRepository);this._blackTex=new t(u.createColorTexture(this._rctx,[0,0,0,1]));this._ensureBackgroundTexture(this.tileSize)}var P=G.prototype;P.dispose=function(){this._composition=m.disposeMaybe(this._composition);
this._backgroundTexture=m.releaseMaybe(this._backgroundTexture);this._blackTex=m.releaseMaybe(this._blackTex)};P.updateTileTexture=function(K,N){if(K.renderData){for(var M=K.surface,L=M.baseOpacity,J=this._numTexturedLayer=0,H=this.tileSize,I=!1,O=M.view.state.pixelRatio,Q=!1,S=K.layerInfo[d.LayerClass.MAP],T=S.length,U=0;U<S.length;U++){const W=M.layerViewByIndex(U,d.LayerClass.MAP),R=W.fullOpacity;y[U]=R;n.isBaseLayer(W.layer)&&T>=S.length&&(T=U);if(0===R){S[U].pendingUpdates&=~(x.TileUpdate.TEXTURE_NOFADING&
x.TileUpdate.TEXTURE_FADING);continue}++J;const V=A(K,U);if(V){S[U].pendingUpdates&=~(x.TileUpdate.TEXTURE_NOFADING&x.TileUpdate.TEXTURE_FADING);if(e.isBlendableLayerView(W)){var aa=e.isGroupLayer(W.layer.parent)?"normal":W.layer.blendMode;D[U]=aa;if(aa="normal"!==aa)Q=aa,I=!1}e.isVectorTileLayerView(W)?H=Math.max(H,this.tileSize*O):1===L&&1===R&&(W.isOpaque||this._dataToTexture(V)&&V.sourceLayerInfo.data.descriptor.isOpaque)&&(I=!0);++this._numTexturedLayer}}this._composition.cleanupFBOPool(O,S.length);
O=H;H=c.nextHighestPowerOfTwo(O);M=H*H;L=O*O;M===L?H=O:(O=H/2,H=M-L<L-O*O?H:O);M=H/this.tileSize;--U;this._ensureBackgroundTexture(this.tileSize);0===this._numTexturedLayer?this._useBackgroundTexture(K,J):(1!==this._numTexturedLayer||Q||!this._useLayerTexture(K,U,T,y[U]))&&this._composeMapLayers(K,N,U,T,y,D,H,M,!I||Q)}};P._ensureBackgroundTexture=function(K){m.isNone(this._backgroundTexture)&&(this._backgroundTexture=this._buildTexture(K),this._backgroundDirty=!0);this._backgroundDirty&&(this._composition.bindPool(0,
K),this._passParameters.offset=r.ZEROS,this._passParameters.scale=1,this._passParameters.opacity=1,this._passParameters.blendMode=B.LayerBlendMode.Normal,m.isSome(this.backgroundColor)&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,m.isSome(this.backgroundColor)?q.BlendLayersOutput.ColorOnly:q.BlendLayersOutput.GridOnly),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.releasePool(),this._backgroundDirty=
!1)};P._useBackgroundTexture=function(K,N){let M=h.ActivationTime.Immediate;if(K.surface.view.layerViewManager.updating||0<N)M=h.ActivationTime.Delayed;this._backgroundTexture&&m.isNone(K.renderData.textureReference)&&(M=h.ActivationTime.Immediate);K.renderData.setTextureReference(m.isSome(this._backgroundTexture)?new v.TextureReference(this._backgroundTexture,f.TextureUpdate.FADING,F,K.surface.baseOpacity,1,0):null,M)};P._useLayerTexture=function(K,N,M,L){var J=N<M;M=J?1:K.surface.baseOpacity;J=
J?K.surface.baseOpacity:1;N=A(K,N);return this._dataToTexture(N)?(K.renderData.setTextureReference(new v.TextureReference(N.sourceLayerInfo.data,f.TextureUpdate.FADING,N,M,L,J)),!0):!1};P._composeMapLayers=function(K,N,M,L,J,H,I,O,Q){this._composition.bindPool(0,I);const S=K.surface.baseOpacity;let T=!1,U=C.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,aa=!1,W=0;for(;0<=M;M--){const V=A(K,M);if(V&&0!==J[M]){var R=M<L&&1>S&&!T;this._passParameters.baseOpacity=R?S:1;R&&(T=!0);R=0===W;R=Q&&R?this.backgroundIsGrid?
q.BlendLayersOutput.GridComposite:q.BlendLayersOutput.ColorComposite:q.BlendLayersOutput.Composite;e.isVectorTileRenderInfo(V)?(this._passParameters.opacity=J[M],this._passParameters.blendMode=B.blendModeFromString[H[M]],aa=this._composition.drawVectorData(this._passParameters,V,O,this.tileSize,I,aa,R)):e.isImageryTileRenderInfo(V)?(this._passParameters.opacity=J[M],this._passParameters.blendMode=B.blendModeFromString[H[M]],this._composition.drawImageryTileData(V,R,this._passParameters),this._hasNearestInterpolation(V)&&
(U=C.TextureSamplingMode.NEAREST)):this._dataToTexture(V)&&(this._passParameters.texture=V.sourceLayerInfo.data.texture,this._passParameters.offset=V.offset,this._passParameters.scale=V.scale,this._passParameters.opacity=J[M],this._passParameters.blendMode=B.blendModeFromString[H[M]],this._composition.drawRasterData(R,this._passParameters));W++}}L=K.renderData.ensureTexture(I,()=>this._buildTexture(I,U));this._composition.copyFBOToTexture(L);this._composition.releasePool();K.renderData.setTextureReference(new v.TextureReference(L,
N,F,T?1:S,1,0))};P._hasNearestInterpolation=function(K){K=K.sourceLayerInfo.data;return K.source?"nearest"===K.interpolation:!1};P._dataToTexture=function(K){e.isRasterTileRenderInfo(K)&&this._rasterDataToTexture(K);return e.isTextureTileRenderInfo(K)};P._rasterDataToTexture=function(K){const N=K.sourceLayerInfo;N.data=this._buildTexture(N.data);K.tile.setMemoryDirty()};P.setBackground=function(K){this._backgroundColor!==K&&(this._backgroundColor=K,this._backgroundDirty=!0)};P._buildTexture=function(K,
N=C.TextureSamplingMode.LINEAR_MIPMAP_LINEAR){if(m.isNone(K))return null;const M={target:C.TextureType.TEXTURE_2D,pixelFormat:C.PixelFormat.RGBA,dataType:C.PixelType.UNSIGNED_BYTE,wrapMode:C.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:N,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0};N=this._rctx;let L;if("number"===typeof K)M.width=M.height=K,L=new t(new z.Texture(N,M));else if(K instanceof g.ImageWithType)M.isOpaque=K.isOpaque,L=new t(new z.Texture(N,M,K.image)),K.release();else try{L=
new t(new z.Texture(N,M,K))}catch(J){L=new t(u.createEmptyTexture(N)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}K=N.bindTexture(L.texture,z.Texture.TEXTURE_UNIT_FOR_UPDATES);L.generateMipmap();N.bindTexture(K,z.Texture.TEXTURE_UNIT_FOR_UPDATES);return L};b._createClass(G,[{key:"backgroundIsGrid",get:function(){return m.isNone(this._backgroundColor)}},{key:"backgroundColor",get:function(){return this._backgroundColor}},{key:"test",get:function(){return{backgroundTexture:this._backgroundTexture}}}]);
return G}();const y=[],D=[],E={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},F={offset:[0,0],scale:1};a.TileRenderer=p;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/BlendLayersTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/vec3f64 ./BlendModeTechniqueConfiguration ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../../../chunks/BlendLayers.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t){g=function(x){function B(){var q=x.apply(this,arguments)||this;q.opacity=1;q.baseOpacity=1;q.texture=null;q.fboTexture=null;q.blendMode=n.LayerBlendMode.Normal;q.backgroundColor=l.ZEROS;return q}c._inheritsLoose(B,x);return B}(g.TileCompositePassParameters);d=function(x){function B(){return x.apply(this,arguments)||this}c._inheritsLoose(B,x);var q=B.prototype;q.initializeProgram=function(u){const C=B.shader.get().build(this.configuration);return new v.Program(u.rctx,
C,h.Default3D)};q.initializePipeline=function(){return t.makePipelineState({blending:t.simpleBlendingParams(w.BlendFactor.ONE,w.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:t.defaultColorWriteParams})};return B}(d.ShaderTechnique);d.shader=new f.ReloadableShaderModule(k.BlendLayers,()=>new Promise((x,B)=>a(["../webgl-engine/core/shaderLibrary/util/BlendLayers.glsl"],x,B)));r=function(x){function B(){var q=x.apply(this,arguments)||this;q.output=k.BlendLayersOutput.Composite;q.baseOpacityMode=k.BaseOpacityMode.One;
q.premultipliedSource=!1;return q}c._inheritsLoose(B,x);return B}(r.BlendModeTechniqueConfiguration);m.__decorate([e.parameter({count:k.BlendLayersOutput.COUNT})],r.prototype,"output",void 0);m.__decorate([e.parameter({count:k.BaseOpacityMode.COUNT})],r.prototype,"baseOpacityMode",void 0);m.__decorate([e.parameter()],r.prototype,"premultipliedSource",void 0);b.BlendLayersPassParameters=g;b.BlendLayersTechnique=d;b.BlendLayersTechniqueConfiguration=r;Object.defineProperties(b,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/BlendModeTechniqueConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../webgl-engine/core/shaderLibrary/output/BlendOptions","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,m,l){let r=function(n){function g(){var k=n.apply(this,arguments)||this;k.blendMode=m.LayerBlendMode.Normal;return k}b._inheritsLoose(g,n);return g}(l.ShaderTechniqueConfiguration);
c.__decorate([l.parameter({count:m.LayerBlendMode.COUNT})],r.prototype,"blendMode",void 0);a.BlendModeTechniqueConfiguration=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TextureReference":function(){define(["exports","../../../chunks/vec3f64","../../../chunks/vec4f64"],function(a,b,c){let m=function(){function l(r,n,g,k,f,d){this.texture=r;this.type=n;r.retain();this.offsetAndScale=c.fromValues(g.offset[0],g.offset[1],g.scale,
g.scale);this.opacities=b.fromValues(k,d,f)}l.prototype.destroy=function(){this.texture.release()};return l}();a.TextureReference=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TileCompositor":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/maybe ../../../chunks/vec2f64 ../../2d/engine/imagery/enums ../../2d/engine/vectorTiles/VectorTileRendererHelper3D ./BlendLayersTechnique ./LayerClass ./RasterColorizerTechnique ./support/FBOPool ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/terrain/TileBlendInput ../../../chunks/BlendLayers.glsl ../webgl-engine/lib/BindParameters ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/Texture ../../webgl/Util".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u){const C=c.getLogger("esri.views.3d.terrain");c=function(){function z(p,y){this._rctx=p;this._techniqueRepository=y;this._fboPools=[];this._doubleBufferFbo=[];this._vectorTileHelper=new n.VectorTileRendererHelper3D;this._bindParameters=new w.BindParameters(null,null,null);this._blendLayersTechniqueConfig=new g.BlendLayersTechniqueConfiguration;this._poolToWrite=0;this._vaoQuad=x.createQuadVAO(this._rctx,t.Pos2Tex);this._fboPools.push(new d.FBOPool(this._rctx));
this._fboPools.push(new d.FBOPool(this._rctx))}var A=z.prototype;A.dispose=function(){this._fboPools.forEach(p=>{p.clear();p=null});this._fboPools=null;this._doubleBufferFbo.forEach(p=>p=m.disposeMaybe(p));this._vaoQuad=m.disposeMaybe(this._vaoQuad);this._vectorTileHelper=m.disposeMaybe(this._vectorTileHelper);this._backgroundTechnique=m.releaseMaybe(this._backgroundTechnique);this._applyOpacityTechnique=m.releaseMaybe(this._applyOpacityTechnique);this._blendLayersTechnique=m.releaseMaybe(this._blendLayersTechnique)};
A._getBlendLayersTechnique=function(p,y,D,E=!1){this._blendLayersTechniqueConfig.output=y;this._blendLayersTechniqueConfig.blendMode=p;this._blendLayersTechniqueConfig.baseOpacityMode=D?y===v.BlendLayersOutput.Composite?v.BaseOpacityMode.OnBaseLayer:v.BaseOpacityMode.OnBackground:v.BaseOpacityMode.One;this._blendLayersTechniqueConfig.premultipliedSource=E;return this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(g.BlendLayersTechnique,this._blendLayersTechniqueConfig,this._blendLayersTechnique)};
A.drawBackground=function(p,y){y=this._getBlendLayersTechnique(e.LayerBlendMode.Normal,y,!1);p=this._rctx.bindTechnique(y,p,this._bindParameters);this._render(p)};A._render=function(p){this._rctx.bindVAO(this._vaoQuad);p.assertCompatibleVertexAttributeLocations(this._vaoQuad);this._rctx.drawArrays(B.PrimitiveType.TRIANGLE_STRIP,0,u.vertexCount(this._vaoQuad,"geometry"))};A.drawRasterData=function(p,y,D=!1){if(!m.isNone(y.texture)){var E=1>y.baseOpacity;y.blendMode!==e.LayerBlendMode.Normal||E||D?
(y.fboTexture=this._currentFBO.colorTexture,this._switchPool(this._currentFBO.width)):y.fboTexture=null;p=this._getBlendLayersTechnique(y.blendMode,p,E,D);y=this._rctx.bindTechnique(p,y,this._bindParameters);this._render(y)}};A.drawImageryTileData=function(p,y,D){var E=p.sourceLayerInfo.data;if(E.source){p.tile.surface.layerViewByIndex(p.layerIndex,k.LayerClass.MAP).ensureSymbolizerParameters(E);var F=1>D.baseOpacity;D.blendMode!==e.LayerBlendMode.Normal||F?(D.fboTexture=this._currentFBO.colorTexture,
this._switchPool(this._currentFBO.width)):D.fboTexture=null;y=this._getRasterColorizerTechnique(E,y,D.blendMode,F);F=this._rctx.bindTechnique(y);E.bind(this._rctx)&&(E.opacity=D.opacity,E=E.getUniforms(),E.scale=p.scale,E.offset=p.offset,E.backgroundColor=D.backgroundColor,E.fboTexture=D.fboTexture,E.baseOpacity=D.baseOpacity,y.bindPass(E,null),this._render(F))}};A._getRasterColorizerTechnique=function(p,y,D,E){const F=p.symbolizerParameters,G=["stretch","lut","hillshade"].indexOf(F.type);m.isNone(this._rasterColorizerConfig)&&
(this._rasterColorizerConfig=new f.RasterColorizerTechniqueConfiguration,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float"));this._rasterColorizerConfig.tileBlendInput=y===v.BlendLayersOutput.ColorComposite?h.TileBlendInput.ColorComposite:y===v.BlendLayersOutput.GridComposite?h.TileBlendInput.GridComposite:h.TileBlendInput.LayerOnly;this._rasterColorizerConfig.blendMode=D;this._rasterColorizerConfig.baseOpacityMode=E?y===v.BlendLayersOutput.Composite?
v.BaseOpacityMode.OnBaseLayer:v.BaseOpacityMode.OnBackground:v.BaseOpacityMode.One;this._rasterColorizerConfig.colorizerType=G;this._rasterColorizerConfig.applyColormap=!!F.colormap;this._rasterColorizerConfig.stretchType=p.hasStretchTypeNone()?r.RasterColorizerStretchType.Noop:r.RasterColorizerStretchType.PerBand;return this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(f.RasterColorizerTechnique,this._rasterColorizerConfig,this._rasterColorizerTechnique)};A.drawVectorData=
function(p,y,D,E,F,G,P){const K=this._rctx,N=y.sourceLayerInfo.data,M=y.tile.surface.layerViewByIndex(y.layerIndex,k.LayerClass.MAP),L=1>p.baseOpacity||1>p.opacity||p.blendMode!==e.LayerBlendMode.Normal||P!==v.BlendLayersOutput.Composite;this._getBlendLayersTechnique(p.blendMode,P,1>p.baseOpacity,L).bindPipelineState(K);let J;L?(J=this._acquire(F),K.bindFramebuffer(J),K.setClearColor(0,0,0,0),K.clearSafe(B.ClearBufferBit.COLOR_BUFFER_BIT|B.ClearBufferBit.DEPTH_BUFFER_BIT)):G&&K.clearSafe(B.ClearBufferBit.DEPTH_BUFFER_BIT);
try{this._vectorTileHelper.render(K,y.sourceLod,N,M.painter,M.layer.styleRepository,M.schemaHelper,Math.round(1/y.scale),y.offset,E,D)}catch(H){C.warnOnce("A render call containing vector tiles did not resolve correctly.",H)}return m.isSome(J)?(K.bindFramebuffer(this._currentFBO),p.texture=J.colorTexture,p.offset=l.ZEROS,p.scale=1,this.drawRasterData(P,p,L),J.release(),G):!0};A.copyFBOToTexture=function(p){const y=this._rctx,D=y.bindTexture(p.texture,q.Texture.TEXTURE_UNIT_FOR_UPDATES),E=p.descriptor;
y.gl.copyTexImage2D(B.TextureType.TEXTURE_2D,0,E.pixelFormat,0,0,E.width,E.height,0);p.generateMipmap();y.bindTexture(D,q.Texture.TEXTURE_UNIT_FOR_UPDATES)};A._initFBO=function(p,y){this._rctx.bindFramebuffer(p);this._rctx.setViewport(0,0,y,y);this._rctx.setClearColor(0,0,0,0);this._rctx.setClearDepth(1);this._rctx.clearSafe(B.ClearBufferBit.COLOR_BUFFER_BIT|B.ClearBufferBit.DEPTH_BUFFER_BIT)};A._acquire=function(p){return this._fboPools[this._poolToWrite].acquire(p)};A.bindPool=function(p,y){this._poolToWrite=
p;null==this._doubleBufferFbo[p]&&(this._doubleBufferFbo[p]=this._acquire(y),this._initFBO(this._doubleBufferFbo[p],y))};A._switchPool=function(p){this._releaseCurrentFBO();this._doubleBufferFbo[this._poolToWrite]=null;this._poolToWrite=0===this._poolToWrite?1:0;this.bindPool(this._poolToWrite,p)};A._releaseCurrentFBO=function(){this._doubleBufferFbo[this._poolToWrite].release();this._doubleBufferFbo[this._poolToWrite]=null};A.releasePool=function(){this._rctx.bindFramebuffer(null);this._releaseCurrentFBO()};
A.cleanupFBOPool=function(p,y){if(p!==this._lastPixelRatio||y!==this._lastNumLayers)this._fboPools.forEach(D=>D.clear()),this._lastPixelRatio=p,this._lastNumLayers=y};b._createClass(z,[{key:"_currentFBO",get:function(){return this._doubleBufferFbo[this._poolToWrite]}}]);return z}();a.TileCompositor=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/VectorTileRendererHelper3D":function(){define(["exports","../../../../geometry",
"../../../../Viewpoint","../../ViewState","../../../../geometry/Point"],function(a,b,c,m,l){b=function(){function r(){this._renderParams={context:null,drawPhase:1,state:new m({viewpoint:new c({targetGeometry:new l(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,deltaTime:-1,
timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1}}var n=r.prototype;n.dispose=function(){this._renderParams=null};n.render=function(g,k,f,d,e,h,v,w,t,x){const B=h.adjustLevel(k[0]),q=this._renderParams;q.context=g;q.painter=d;q.glyphMosaic=d.glyphMosaic;q.spriteMosaic=d.spriteMosaic;q.pixelRatio=x;q.displayLevel=B;q.requiredLevel=B;x=h.getScale(k[0]);const [u,C]=h.getShift(k,v*x);k=.125*v*x/t;h=f.transforms.dvs;h[0]=k;h[4]=-k;h[6]=
-1-u-w[0]*v*2;h[7]=1+C+(1-w[1])*v*2-2;q.state.size[0]=t;q.state.size[1]=t;f.stage||f.attachWithContext(g);f.triangleCount=0;d.drawTile(q,f,e)};return r}();a.VectorTileRendererHelper3D=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/ViewState":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../Viewpoint ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../chunks/common ../../chunks/mat2d ../../chunks/mat2df32 ../../chunks/mat2df64 ../../chunks/mat3 ../../chunks/mat3f32 ../../chunks/vec2 ../../chunks/vec2f32 ../../chunks/vec2f64 ../../core/libs/gl-matrix-2/types/vec2 ./viewpointUtils ../../geometry/Extent ../../geometry/Point".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A){var p;const y=[0,0];c=p=function(D){function E(G){G=D.call(this,G)||this;G._viewpoint2D={center:q.create(),rotation:0,scale:0,spatialReference:null};G.center=[0,0];G.extent=new z;G.id=0;G.inverseTransform=v.create();G.resolution=0;G.rotation=0;G.scale=0;G.transform=v.create();G.transformNoRotation=v.create();G.displayMat3=t.create();G.displayViewMat3=t.create();G.viewMat3=t.create();G.viewMat2d=h.create();G.worldScreenWidth=0;G.size=[0,0];return G}
a._inheritsLoose(E,D);var F=E.prototype;F.copy=function(G){const P=this.size,K=this.viewpoint;K&&P?(this.viewpoint=C.copy(K,G.viewpoint),this._set("size",x.copy(P,G.size))):(this.viewpoint=G.viewpoint.clone(),this._set("size",[G.size[0],G.size[1]]));this._set("pixelRatio",G.pixelRatio);return this};F.clone=function(){return new p({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})};F.toMap=function(G,P,K){if(u.isVec2(P))return x.transformMat2d(G,P,this.inverseTransform);
y[0]=P;y[1]=K;return x.transformMat2d(G,y,this.inverseTransform)};F.toScreen=function(G,P,K){if(u.isVec2(P))return x.transformMat2d(G,P,this.transform);y[0]=P;y[1]=K;return x.transformMat2d(G,y,this.transform)};F.toScreenNoRotation=function(G,P,K){if(u.isVec2(P))return x.transformMat2d(G,P,this.transformNoRotation);y[0]=P;y[1]=K;return x.transformMat2d(G,y,this.transformNoRotation)};F.getScreenTransform=function(G,P){const {center:K}=this._viewpoint2D,N=this._get("pixelRatio")||1,M=this._get("size");
C.getMatrix(G,K,M,P,0,N);return G};F._update=function(){const {center:G,spatialReference:P,scale:K,rotation:N}=this._viewpoint2D,M=this._get("pixelRatio")||1,L=this._get("size"),J=new m({targetGeometry:new A(G[0],G[1],P),scale:K,rotation:N});this._set("viewpoint",J);if(L&&P&&K){this.resolution=C.getResolution(J);this.rotation=N;this.scale=K;this.spatialReference=P;x.copy(this.center,G);w.set(this.displayMat3,0!==L[0]?2/L[0]:0,0,0,0,0!==L[1]?-2/L[1]:0,0,-1,1,1);var H=w.identity(this.viewMat3),I=B.fromValues(L[0]/
2,L[1]/2),O=B.fromValues(-L[0]/2,-L[1]/2),Q=d.toRadian(N);w.translate(H,H,I);w.rotate(H,H,Q);w.translate(H,H,O);w.multiply(this.displayViewMat3,this.displayMat3,H);H=e.fromTranslation(this.viewMat2d,I);e.rotate(H,H,Q);e.translate(H,H,O);C.getExtent(this.extent,J,L);C.getTransform(this.transform,J,L,M);e.invert(this.inverseTransform,this.transform);C.getTransformNoRotation(this.transformNoRotation,J,L,M);this.worldScreenWidth=C.getWorldScreenWidth(this.spatialReference,this.resolution);this._set("id",
this.id+1);return this}};a._createClass(E,[{key:"pixelRatio",set:function(G){this._set("pixelRatio",G);this._update()}},{key:"size",set:function(G){this._set("size",G);this._update()}},{key:"viewpoint",set:function(G){if(G){const P=this._viewpoint2D,K=G.targetGeometry;P.center[0]=K.x;P.center[1]=K.y;P.rotation=G.rotation;P.scale=G.scale;P.spatialReference=K.spatialReference}this._update()}}]);return E}(l.JSONSupport);b.__decorate([r.property({readOnly:!0})],c.prototype,"id",void 0);b.__decorate([r.property({value:1,
json:{write:!0}})],c.prototype,"pixelRatio",null);b.__decorate([r.property({json:{write:!0}})],c.prototype,"size",null);b.__decorate([r.property()],c.prototype,"spatialReference",void 0);b.__decorate([r.property({type:m,json:{write:!0}})],c.prototype,"viewpoint",null);return c=p=b.__decorate([f.subclass("esri.views.2d.ViewState")],c)})},"esri/chunks/mat2df64":function(){define(["exports"],function(a){function b(){return[1,0,0,1,0,0]}function c(n){return[n[0],n[1],n[2],n[3],n[4],n[5]]}function m(n,
g,k,f,d,e){return[n,g,k,f,d,e]}function l(n,g){return new Float64Array(n,g,6)}const r=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:m,createView:l},Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;a.createView=l;a.fromValues=m;a.mat2df64=r})},"esri/core/libs/gl-matrix-2/types/vec2":function(){define(["exports"],function(a){function b(m){return m instanceof Float32Array&&2<=m.length}function c(m){return Array.isArray(m)&&2<=m.length}a.isVec2=function(m){return b(m)||
c(m)};a.isVec2f32=b;a.isVec2f64=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/viewpointUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../Viewpoint ../../core/Collection ../../core/maybe ../../core/unitUtils ../../chunks/common ../../chunks/mat2d ../../chunks/mat2df64 ../../chunks/vec2 ../../chunks/vec2f64 ../../geometry/Extent ../../geometry/Geometry ../../geometry/Point ../../geometry/projection ../../geometry/SpatialReference ../../geometry/support/spatialReferenceUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x){function B(ca,ha){return ha.type?f.set(ca,ha.x,ha.y):f.copy(ca,ha)}function q(ca,ha){return Math.max(ca.width/Math.max(1,ha[0]),ca.height/Math.max(1,ha[1]))*G(ca.spatialReference)}function u(ca,ha,ia,ka){return C.apply(this,arguments)}function C(){C=b._asyncToGenerator(function*(ca,ha,ia,ka){if(!ca||Array.isArray(ca)&&!ca.length)return null;m.isCollection(ca)&&(ca=ca.toArray());if(Array.isArray(ca)&&ca.length&&"object"===typeof ca[0]){var la=ca.every(ja=>
"attributes"in ja);var Y=ca.some(ja=>!ja.geometry),ea=ca;if(la&&Y&&ha&&ha.allLayerViews){la=new Map;for(var ba of ca)ca=ba.layer,Y=la.get(ca)||[],ea=ba.attributes[ca.objectIdField],null!=ea&&Y.push(ea),la.set(ca,Y);const ja=[];la.forEach((oa,sa)=>{const qa=ha.allLayerViews.find(Ha=>Ha.layer.id===sa.id);if("queryFeatures"in qa){const Ha=sa.createQuery();Ha.objectIds=oa;Ha.returnGeometry=!0;ja.push(qa.queryFeatures(Ha))}});ba=yield Promise.all(ja);ca=[];for(var Z of ba)if(Z&&Z.features&&Z.features.length)for(var fa of Z.features)l.isSome(fa.geometry)&&
ca.push(fa.geometry);ea=ca}for(const ja of ea)ka=yield u(ja,ha,ia,ka);return ka}if(Array.isArray(ca)&&2===ca.length&&"number"===typeof ca[0]&&"number"===typeof ca[1])la=new v(ca);else if(ca instanceof h)la=ca;else if("geometry"in ca)if(ca.geometry)la=ca.geometry;else if(ca.layer){const ja=ca.layer;Z=ha.allLayerViews.find(oa=>oa.layer.id===ja.id);"queryFeatures"in Z&&(fa=ja.createQuery(),fa.objectIds=[ca.attributes[ja.objectIdField]],fa.returnGeometry=!0,Z=yield Z.queryFeatures(fa),la=l.get(Z,"features",
0,"geometry"))}if(l.isNone(la))return null;Z="point"===la.type?new e({xmin:la.x,ymin:la.y,xmax:la.x,ymax:la.y,spatialReference:la.spatialReference}):la.extent;if(!Z)return null;w.isLoaded()||w.canProjectWithoutEngine(Z.spatialReference,ia)||(yield w.load());ia=w.project(Z,ia);return ia?ka=ka?ka.union(ia):ia:null});return C.apply(this,arguments)}function z(ca){if(ca&&(!Array.isArray(ca)||"number"!==typeof ca[0])&&("object"===typeof ca||Array.isArray(ca)&&"object"===typeof ca[0])){if("layer"in ca&&
ca.layer&&ca.layer.minScale&&ca.layer.maxScale){var ha=ca.layer;return{min:ha.minScale,max:ha.maxScale}}if(Array.isArray(ca)&&ca.length&&ca.every(ia=>"layer"in ia)){let ia=ha=0;for(const ka of ca)(ca=ka.layer)&&ca.minScale&&ca.maxScale&&(ha=ca.minScale<ha?ca.minScale:ha,ia=ca.maxScale>ia?ca.maxScale:ia);return ha&&ia?{min:ha,max:ia}:null}}}function A(ca,ha){return x.equals(ca.wkid?ca:ca.spatialReference||t.WGS84,ha)?ca:w.project(ca,ha)}function p(){p=b._asyncToGenerator(function*(ca,ha){if(!ca||!ha)return new c({targetGeometry:new v,
scale:0,rotation:0});let ia=ha.spatialReference;const {constraints:ka,padding:la,viewpoint:Y,size:ea}=ha,ba=[la?ea[0]-la.left-la.right:ea[0],la?ea[1]-la.top-la.bottom:ea[1]];let Z=null;ca instanceof c?Z=ca:ca.viewpoint?Z=ca.viewpoint:ca.target&&"esri.Viewpoint"===ca.target.declaredClass&&(Z=ca.target);let fa=null;if(Z&&Z.targetGeometry)fa=Z.targetGeometry;else if(ca instanceof e)fa=ca;else if(ca||ca&&("center"in ca||"extent"in ca||"target"in ca))fa=(yield u(ca.center,ha,ia))||(yield u(ca.extent,ha,
ia))||(yield u(ca.target,ha,ia))||(yield u(ca,ha,ia));!fa&&Y&&Y.targetGeometry?fa=Y.targetGeometry:!fa&&ha.extent&&(fa=ha.extent);if(!ia){var ja=ha.spatialReference||ha.extent||fa;ia=ja.wkid?ja:ja.spatialReference||t.WGS84}w.isLoaded()||x.equals(fa.spatialReference,ia)||w.canProjectWithoutEngine(fa,ia)||(yield w.load());ja=A(fa.center?fa.center:fa,ia);var oa=null;Z&&l.isSome(Z.targetGeometry)&&"point"===Z.targetGeometry.type?oa=Z.scale:"scale"in ca&&ca.scale?oa=ca.scale:"zoom"in ca&&-1!==ca.zoom&&
ka&&ka.effectiveLODs?oa=ka.zoomToScale(ca.zoom):Array.isArray(fa)||"point"===fa.type||"extent"===fa.type&&0===fa.width&&0===fa.height?(oa=A(ha.extent,ia),oa=l.isSome(oa)?q(oa,ba):ha.extent?q(ha.extent,ba):Y.scale):oa=q(A(fa.extent,ia),ba);if(ha=z(ca))ha.min&&ha.min>oa?oa=ha.min:ha.max&&ha.max<oa&&(oa=ha.max);ha=0;Z?ha=Z.rotation:ca.hasOwnProperty("rotation")?ha=ca.rotation:Y&&(ha=Y.rotation);ca=new c({targetGeometry:ja,scale:oa,rotation:ha});ka&&(ca=ka.fit(ca),ka.constrainByGeometry(ca),ka.rotationEnabled||
(ca.rotation=ha));return ca});return p.apply(this,arguments)}function y(ca,ha){const ia=ca.targetGeometry,ka=ha.targetGeometry;ia.x=ka.x;ia.y=ka.y;ia.spatialReference=ka.spatialReference;ca.scale=ha.scale;ca.rotation=ha.rotation;return ca}function D(ca,ha,ia){return ia?f.set(ca,.5*(ha[0]-ia.right+ia.left),.5*(ha[1]-ia.bottom+ia.top)):f.scale(ca,ha,.5)}function E(ca,ha,ia,ka){H(ca,ha,ia,ka);return g.invert(ca,ca)}function F(ca){var ha=ca.scale;ca=ca.targetGeometry;ca=l.isSome(ca)&&x.isValid(ca.spatialReference)?
1/(39.37*r.getMetersPerUnitForSR(ca.spatialReference)*96):1;return ha*ca}function G(ca){return x.isValid(ca)?39.37*r.getMetersPerUnitForSR(ca)*96:1}function P(ca){return(ca=x.getInfo(ca))?ca.valid[1]-ca.valid[0]:0}const K=180/Math.PI,N=function(){const ca=d.create();return function(ha,ia,ka){const la=ia.targetGeometry;B(ca,la);ia=.5*F(ia);ha.xmin=ca[0]-ia*ka[0];ha.ymin=ca[1]-ia*ka[1];ha.xmax=ca[0]+ia*ka[0];ha.ymax=ca[1]+ia*ka[1];ha.spatialReference=la.spatialReference;return ha}}(),M=function(){const ca=
d.create();return function(ha,ia,ka){return f.sub(ha,f.scale(ha,ia,.5),D(ca,ia,ka))}}(),L=function(){const ca=k.create(),ha=d.create();return function(ia,ka,la,Y){const ea=F(ka);ka=n.toRadian(ka.rotation)||0;f.set(ha,ea,ea);g.fromScaling(ca,ha);g.rotate(ca,ca,ka);g.translate(ca,ca,M(ha,la,Y));g.translate(ca,ca,[0,Y.top-Y.bottom]);return f.set(ia,ca[4],ca[5])}}(),J=function(){const ca=d.create(),ha=d.create(),ia=d.create();return function(ka,la,Y,ea,ba,Z){f.negate(ca,la);f.scale(ha,Y,.5*Z);f.set(ia,
1/ea*Z,-1/ea*Z);g.fromTranslation(ka,ha);ba&&g.rotate(ka,ka,ba);g.scale(ka,ka,ia);g.translate(ka,ka,ca);return ka}}(),H=function(){const ca=d.create();return function(ha,ia,ka,la){const Y=F(ia),ea=n.toRadian(ia.rotation)||0;B(ca,ia.targetGeometry);return J(ha,ca,ka,Y,ea,la)}}(),I=function(){const ca=d.create();return function(ha,ia,ka,la){const Y=F(ia);B(ca,ia.targetGeometry);return J(ha,ca,ka,Y,0,la)}}(),O=function(){const ca=d.create(),ha=d.create(),ia=[0,0,0];return function(ka,la,Y){f.subtract(ca,
ka,la);f.normalize(ca,ca);f.subtract(ha,ka,Y);f.normalize(ha,ha);f.cross(ia,ca,ha);ka=Math.acos(f.dot(ca,ha)/(f.length(ca)*f.length(ha)))*K;0>ia[2]&&(ka=-ka);isNaN(ka)&&(ka=0);return ka}}(),Q=function(){const ca=d.create();return function(ha,ia,ka,la){const Y=ha.targetGeometry;y(ha,ia);L(ca,ia,ka,la);Y.x+=ca[0];Y.y+=ca[1];return ha}}(),S=function(){return function(ca,ha,ia){y(ca,ha);ha=ca.targetGeometry;ha.x=ia.x;ha.y=ia.y;ha.spatialReference=ia.spatialReference;return ca}}(),T=function(){const ca=
d.create();return function(ha,ia,ka,la,Y){Y||(Y="center");f.sub(ca,ka,la);f.scale(ca,ca,.5);ka=ca[0];la=ca[1];switch(Y){case "center":f.set(ca,0,0);break;case "left":f.set(ca,-ka,0);break;case "top":f.set(ca,0,la);break;case "right":f.set(ca,ka,0);break;case "bottom":f.set(ca,0,-la);break;case "top-left":f.set(ca,-ka,la);break;case "bottom-left":f.set(ca,-ka,-la);break;case "top-right":f.set(ca,ka,la);break;case "bottom-right":f.set(ca,ka,-la)}da(ha,ia,ca);return ha}}(),U=function(){const ca=d.create();
return function(ha,ia,ka,la,Y){y(ha,ia);isNaN(ka)||0===ka||(R(ca,la,ia,Y),ha.scale=ia.scale*ka,V(ca,ca,ha,Y),da(ha,ha,f.set(ca,ca[0]-la[0],la[1]-ca[1])));return ha}}(),aa=function(){const ca=d.create();return function(ha,ia,ka,la,Y,ea){y(ha,ia);isNaN(ka)||0===ka||(R(ca,Y,ia,ea),ha.scale=ia.scale*ka,ha.rotation+=la,V(ca,ca,ha,ea),da(ha,ha,f.set(ca,ca[0]-Y[0],Y[1]-ca[1])));return ha}}(),W=function(){const ca=d.create(),ha=d.create();return function(ia,ka,la,Y,ea,ba,Z){M(ha,ba,Z);f.add(ca,ea,ha);return Y?
aa(ia,ka,la,Y,ca,ba):U(ia,ka,la,ca,ba)}}(),R=function(){const ca=k.create();return function(ha,ia,ka,la){return f.transformMat2d(ha,ia,E(ca,ka,la,1))}}(),V=function(){const ca=k.create();return function(ha,ia,ka,la){return f.transformMat2d(ha,ia,H(ca,ka,la,1))}}(),da=function(){const ca=d.create(),ha=k.create();return function(ia,ka,la){y(ia,ka);const Y=F(ka),ea=ia.targetGeometry;g.fromRotation(ha,n.toRadian(ka.rotation)||0);g.scale(ha,ha,d.fromValues(Y,Y));f.transformMat2d(ca,la,ha);ea.x+=ca[0];
ea.y+=ca[1];return ia}}();a.addPadding=Q;a.angleBetween=O;a.centerAt=S;a.copy=y;a.create=function(ca,ha){return p.apply(this,arguments)};a.extentToScale=q;a.getAnchor=D;a.getExtent=N;a.getMatrix=J;a.getPaddingMapTranslation=L;a.getPaddingScreenTranslation=M;a.getResolution=F;a.getResolutionToScaleFactor=G;a.getTransform=H;a.getTransformNoRotation=I;a.getWorldScreenWidth=function(ca,ha){return Math.round(P(ca)/ha)};a.getWorldWidth=P;a.padAndScaleAndRotateBy=W;a.resize=T;a.rotateBy=function(ca,ha,ia){y(ca,
ha);ca.rotation+=ia;return ca};a.rotateTo=function(ca,ha,ia){y(ca,ha);ca.rotation=ia;return ca};a.scaleAndRotateBy=aa;a.scaleTo=function(ca,ha,ia){y(ca,ha);ca.scale=ia;return ca};a.setExtent=function(ca,ha,ia,ka,la){S(ca,ha,ia.center);ca.scale=q(ia,ka);la&&la.constraints&&la.constraints.constrain(ca);return ca};a.toMap=R;a.toScreen=V;a.translateBy=da;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/RasterColorizerTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../2d/engine/imagery/enums ./BlendModeTechniqueConfiguration ../../../chunks/RasterColorizer.glsl ../webgl-engine/core/shaderLibrary/terrain/TileBlendInput ../../../chunks/BlendLayers.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t){d=function(x){function B(){return x.apply(this,arguments)||this}c._inheritsLoose(B,x);var q=B.prototype;q.initializeProgram=function(u){const C=B.shader.get().build(this.configuration);return new v.Program(u.rctx,C,h.Default3D)};q.initializePipeline=function(){return t.makePipelineState({blending:t.simpleBlendingParams(w.BlendFactor.ONE,w.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:t.defaultColorWriteParams})};return B}(d.ShaderTechnique);d.shader=new f.ReloadableShaderModule(n.RasterColorizer,
()=>new Promise((x,B)=>a(["../webgl-engine/core/shaderLibrary/raster/RasterColorizer.glsl"],x,B)));r=function(x){function B(){var q=x.apply(this,arguments)||this;q.colorizerType=l.RasterColorizerType.Stretch;q.stretchType=l.RasterColorizerStretchType.Noop;q.tileBlendInput=g.TileBlendInput.LayerOnly;q.baseOpacityMode=k.BaseOpacityMode.One;q.applyColormap=!0;return q}c._inheritsLoose(B,x);return B}(r.BlendModeTechniqueConfiguration);m.__decorate([e.parameter({count:l.RasterColorizerType.COUNT})],r.prototype,
"colorizerType",void 0);m.__decorate([e.parameter({count:l.RasterColorizerStretchType.COUNT})],r.prototype,"stretchType",void 0);m.__decorate([e.parameter({count:g.TileBlendInput.COUNT})],r.prototype,"tileBlendInput",void 0);m.__decorate([e.parameter({count:k.BaseOpacityMode.COUNT})],r.prototype,"baseOpacityMode",void 0);m.__decorate([e.parameter()],r.prototype,"applyColormap",void 0);b.RasterColorizerTechnique=d;b.RasterColorizerTechniqueConfiguration=r;Object.defineProperties(b,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/support/FBOPool":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/ObjectPool","../../../webgl/enums","../../../webgl/FramebufferObject"],function(a,b,c,m,l){let r=function(){function g(f){this._rctx=f;this._pools=new Map}var k=g.prototype;k.acquire=function(f){return this._getPool(f).acquire()};k.clear=function(){this._pools.forEach(f=>f.destroy());this._pools.clear()};k._getPool=function(f){var d=
this._pools.get(f);d||(d=n.bind(n,this._rctx,{colorTarget:m.TargetType.TEXTURE,depthStencilTarget:m.DepthStencilTargetType.DEPTH_RENDER_BUFFER,width:f,height:f},e=>this._getPool(e.width).release(e)),d=new c(d,null,()=>{}),this._pools.set(f,d));return d};return g}(),n=function(g){function k(f,d,e){var h=g.call(this,f,d)||this;h.release=()=>e(b._assertThisInitialized(h));return h}b._inheritsLoose(k,g);return k}(l.FramebufferObject);a.FBOPool=r;a.PooledFramebufferObject=n;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/ComponentIntersectionData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/mathUtils ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../materials/internal/MaterialUtil".split(" "),function(a,b,c,m,l,r){function n(B,q,u){let C=0,z=Infinity;for(let p=0;3>p;++p){var A=B[p];if(q[p]<A){if(1E-6>=u[p])return!1;C=Math.max(C,(A-q[p])/u[p])}else-1E-6>=
u[p]&&(z=Math.min(z,(A-q[p])/u[p]));if(C>z)return!1;A=B[p+3];if(q[p]>A){if(-1E-6<=u[p])return!1;C=Math.max(C,(A-q[p])/u[p])}else 1E-6<=u[p]&&(z=Math.min(z,(A-q[p])/u[p]));if(C>z)return!1}return!0}function g(B,q,u,C,z,A){let p=C;for(;u<p;){var y=B[u];q[6*y+z+3]<=A?++u:(--p,B[u]=B[p],B[p]=y)}y=u;for(p=C;y<p;)C=B[p-1],q[6*C+z]>=A?--p:(B[p-1]=B[y],B[y]=C,++y);return{next:u,mid:y}}function k(B,q,u,C){if(C<=u)return l.fromValues(NaN,NaN,NaN,NaN,NaN,NaN);var z=6*B[u];for(var A=0;3>A;++A)t[A]=q[z+0+A],x[A]=
q[z+3+A];for(u+=1;u<C;++u)for(z=6*B[u],A=0;3>A;++A)t[A]=Math.min(t[A],q[z+0+A]),x[A]=Math.max(x[A],q[z+3+A]);return l.fromValues(t[0],t[1],t[2],x[0],x[1],x[2])}function f(B){var q=B[3]-B[0];const u=B[4]-B[1],C=B[5]-B[2];q=q>u?q>C?0:u>C?1:2:u>C?1:C>q?2:0;return{axis:q,midValue:(B[q]+B[q+3])/2}}function d(B,q,u,C,z){u-=q;const A=new Float32Array(6*u);for(let y=0;y<u;++y){var p=3*(y+q);const D=B[p+0]*z,E=B[p+1]*z;p=B[p+2]*z;for(let F=0;3>F;++F){const G=C[D+F],P=C[E+F],K=C[p+F];A[6*y+F]=Math.min(G,P,
K);A[6*y+3+F]=Math.max(G,P,K)}}return A}function e(B,q,u,C){const z=C-u;var A=0;for(var p=u;p<C;++p)for(var y=0;3>y;++y)A=Math.max(q[3*p+y],A);C=65535>=A?new Uint16Array(3*z):new Uint32Array(3*z);for(A=0;A<z;++A)for(p=3*(B[A]+u),y=0;3>y;++y)C[3*A+y]=q[p+y];return C}let h=function(B,q,u,C,z){this.aabb=B;this.axis=q;this.d=u;this.midStartIndex=C;this.rightStartIndex=z},v=function(){function B(u,C,z,A){this.globalTriangleVertexIndices=u;this.firstTriangleIndex=C;this.positionAttribute=A;this.rayDirection=
m.create();this.bspNodeTree=[];this.vertexPositionBuffer=A.data;this.vertexPositionStride=A.stride;const p=z-C,y=65535>=p?new Uint16Array(p):new Uint32Array(p);this.indices=y;for(let D=0;D<p;++D)y[D]=D;{const D=d(u,C,z,A.data,A.stride),E=c.clamp(Math.log2(p/40),2,10),F=(G,P,K)=>{var N=k(y,D,G,P);const M=P-G;if(40>=M)return G=new h(N,void 0,0,G,P),this.bspNodeTree.push(G),G;const {axis:L,midValue:J}=f(N),H=g(y,D,G,P,L,J),I=(O,Q)=>{if(!(K>E)){var S=Q-O;if(!(40>S||S>=.8*M))return F(O,Q,K+1)}};N=new h(N,
L,J,H.next,H.mid);this.bspNodeTree.push(N);N.leftNode=I(G,H.next);N.rightNode=I(H.mid,P);return N};F(0,p,0);this.triangleVertexIndices=e(y,u,C,z)}}var q=B.prototype;q.intersectRayTriangleRange=function(u,C){{if(u>=C)return;const J=this.triangleVertexIndices,H=this.positionAttribute.data,I=this.positionAttribute.stride;var z=this.rayOrigin;const O=z[0],Q=z[1];z=z[2];var A=this.rayDirection;const S=A[0],T=A[1];A=A[2];for(let U=u,aa=3*u;U<C;++U){var p=J[aa]*I,y=H[p],D=H[p+1],E=H[p+2],F=J[aa+1]*I;p=H[F];
var G=H[F+1];F=H[F+2];var P=J[aa+2]*I,K=H[P],N=H[P+1];P=H[P+2];aa+=3;p-=y;G-=D;F-=E;K-=y;N-=D;P-=E;var M=T*P-N*A,L=A*K-P*S;const W=S*N-K*T,R=p*M+G*L+F*W;if(!(Math.abs(R)<=Number.EPSILON)){y=O-y;D=Q-D;E=z-E;M=y*M+D*L+E*W;if(0<R){if(0>M||M>R)continue}else if(0<M||M<R)continue;L=D*F-G*E;E=E*p-F*y;D=y*G-p*D;y=S*L+T*E+A*D;if(0<R){if(0>y||M+y>R)continue}else if(0<y||M+y<R)continue;D=(K*L+N*E+P*D)/R;0<=D&&(E=this.indices[U]+this.firstTriangleIndex,p=r.computeNormal(p,G,F,K,N,P,w),this.callback(D,p,E,!1))}}}B.numFacesTested+=
C-u};q.intersectRay=function(u,C){B.numFacesTested=0;var z=m.fromValues(u.r0[0],u.r0[1],u.r0[2]),A=m.fromValues(u.r1[0],u.r1[1],u.r1[2]);u=A[0]-z[0];const p=A[1]-z[1];A=A[2]-z[2];1E-6>u*u+p*p+A*A||(this.rayOrigin=z,z=this.rayDirection,z[0]=u,z[1]=p,z[2]=A,z=this.triangleVertexIndices.length/3,this.callback=C,this.intersectRayBSP(this.bspNodeTree[0],0,z))};q.intersectRayBSP=function(u,C,z){const A=this.rayOrigin,p=this.rayDirection;if(n(u.aabb,A,p)){var y=u.axis,D=u.d;if(A[y]<D||0>p[y]){const E=u.midStartIndex;
if(C<E){const F=u.leftNode;void 0!==F?this.intersectRayBSP(F,C,E):this.intersectRayTriangleRange(C,E)}}this.intersectRayTriangleRange(u.midStartIndex,u.rightStartIndex);if(A[y]>D||0<p[y])C=u.rightStartIndex,C<z&&(u=u.rightNode,void 0!==u?this.intersectRayBSP(u,C,z):this.intersectRayTriangleRange(C,z))}};b._createClass(B,[{key:"estimatedMemoryUsage",get:function(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}]);return B}();v.numFacesTested=0;const w=m.create(),t=[Infinity,
Infinity,Infinity],x=[-Infinity,-Infinity,-Infinity];a.ComponentIntersectionData=v;a.componentMinimalSizeForIntersectionData=200;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec4f64 ../../../../../../geometry/support/aaBoundingRect ../../../../terrain/interfaces ../../renderPasses/AllRenderPasses ../shading/PhysicallyBasedRenderingParameters.glsl ../shading/Water.glsl ../../shaderModules/Float3PassUniform ../../shaderModules/Float4DrawUniform ../../shaderModules/Float4Uniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){function w(q,u){q.extensions.add("GL_OES_standard_derivatives");u.pbrMode!==n.PBRMode.Water&&u.pbrMode!==n.PBRMode.WaterOnIntegratedMesh||q.include(g.Water,u);const {vertex:C,fragment:z}=q;q.varyings.add("vtcOverlay","vec4");C.code.add(h.glsl`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`);z.code.add(h.glsl`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`);z.code.add(h.glsl`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`);if(u.pbrMode===n.PBRMode.Water||u.pbrMode===n.PBRMode.WaterOnIntegratedMesh)z.uniforms.add([new k.Float3PassUniform("lightingMainDirection",(A,p)=>p.lighting.lightingMainDirection),new k.Float3PassUniform("lightingMainIntensity",(A,p)=>p.lighting.mainLight.intensity)]),z.code.add(h.glsl`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, lightingMainDirection, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`)}function t(q,u){return 0===u.overlays.length?null:q.identifier===r.RenderPassIdentifier.Material&&q.subPass===r.MaterialSubPass.Color?u.overlays[l.OverlayIndex.INNER].getColorTextureNoRasterImage():q.identifier===r.RenderPassIdentifier.Highlight?u.overlays[l.OverlayIndex.INNER].getValidTexture(l.RenderTargetType.Highlight):null}a.OverlayMode=void 0;(function(q){q[q.Disabled=0]="Disabled";q[q.Enabled=1]="Enabled";q[q.EnabledWithWater=2]="EnabledWithWater";q[q.COUNT=3]="COUNT"})(a.OverlayMode||
(a.OverlayMode={}));let x=function(q){function u(){var C=q.apply(this,arguments)||this;C.overlayOpacity=1;return C}b._inheritsLoose(u,q);return u}(h.NoParameters);const B=c.create();a.OverlayIM=function(q,u){const {vertex:C,fragment:z}=q;C.uniforms.add([new f.Float4DrawUniform("overlayTexOffset",(A,p)=>{for(const y of p.overlays){const {index:D,extent:E}=y;0<m.area(E)&&(B[2*D]=A.toMapSpace[0]/m.width(E)-E[0]/m.width(E),B[2*D+1]=A.toMapSpace[1]/m.height(E)-E[1]/m.height(E))}return B}),new f.Float4DrawUniform("overlayTexScale",
(A,p)=>{for(const y of p.overlays){const {index:D,extent:E}=y;0<m.area(E)&&(B[2*D]=A.toMapSpace[2]/m.width(E),B[2*D+1]=A.toMapSpace[3]/m.height(E))}return B})]);z.constants.add("overlayOpacity","float",1);z.uniforms.add(new v.Texture2DPassUniform("ovColorTex",(A,p)=>t(A,p)));w(q,u)};a.OverlayTerrain=function(q,u){q.vertex.uniforms.add([new d.Float4Uniform("overlayTexOffset"),new d.Float4Uniform("overlayTexScale")]);q.fragment.uniforms.add([new e.FloatPassUniform("overlayOpacity",C=>C.overlayOpacity),
new v.Texture2DPassUniform("ovColorTex",(C,z)=>0===z.overlays.length?null:z.overlays[l.OverlayIndex.INNER].getColorTexture(C.overlaySource))]);w(q,u)};a.OverlayTerrainPassParameters=x;a.getColorTexture=t;a.overlay=w;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/renderPasses/AllRenderPasses":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec3f64","../shaderLibrary/attributes/VertexNormal.glsl"],
function(a,b,c,m){let l=function(k){function f(){var d=k.apply(this,arguments)||this;d.slicePlaneLocalOrigin=c.create();d.origin=d.slicePlaneLocalOrigin;return d}b._inheritsLoose(f,k);return f}(m.VertexNormalPassParameters);m=function(k){function f(){return k.apply(this,arguments)||this}b._inheritsLoose(f,k);return f}(m.VertexNormalDrawParameters);a.RenderPassIdentifier=void 0;(function(k){k[k.Material=0]="Material";k[k.ShadowMap=1]="ShadowMap";k[k.Highlight=2]="Highlight"})(a.RenderPassIdentifier||
(a.RenderPassIdentifier={}));a.MaterialSubPass=void 0;(function(k){k[k.Color=0]="Color";k[k.Alpha=1]="Alpha";k[k.Depth=2]="Depth";k[k.Normal=3]="Normal"})(a.MaterialSubPass||(a.MaterialSubPass={}));let r=function(k){function f(){var d=k.apply(this,arguments)||this;d.identifier=a.RenderPassIdentifier.Material;d.transparent=!1;d.integratedMesh=!1;return d}b._inheritsLoose(f,k);return f}(l),n=function(k){function f(){var d=k.apply(this,arguments)||this;d.identifier=a.RenderPassIdentifier.ShadowMap;return d}
b._inheritsLoose(f,k);return f}(l),g=function(k){function f(){var d=k.apply(this,arguments)||this;d.identifier=a.RenderPassIdentifier.Highlight;return d}b._inheritsLoose(f,k);return f}(l);a.DrawParameters=m;a.HighlightPassParameters=g;a.MaterialPassParameters=r;a.PassParameters=l;a.ShadowMapPassParameters=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4DrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers",
"./Uniform","../shaderTechnique/BindType"],function(a,b,c,m){c=function(l){function r(n,g){return l.call(this,n,"vec4",m.BindType.Draw,(k,f,d)=>k.setUniform4fv(n,g(f,d)))||this}b._inheritsLoose(r,l);return r}(c.Uniform);a.Float4DrawUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/Terrain.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../views/3d/terrain/interfaces ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/HeaderComment.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3DrawUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/lighting/SceneLighting".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N){function M(I){const O=new G.ShaderBuilder;O.include(C.HeaderComment,{name:"Terrain Shader",output:I.output});O.attributes.add(K.VertexAttribute.POSITION,"vec3");O.attributes.add(K.VertexAttribute.UV0,"vec2");O.attributes.add(K.VertexAttribute.NORMAL,"vec3");const {vertex:Q,fragment:S}=O;Q.uniforms.add([new F.Matrix4PassUniform("proj",(T,U)=>U.camera.projectionMatrix),new E.Matrix4DrawUniform("view",(T,U)=>c.translate(J,U.camera.viewMatrix,
T.origin)),new A.Float3DrawUniform("origin",T=>T.origin)]);S.uniforms.add(new A.Float3DrawUniform("origin",T=>T.origin));if(I.output===g.ShaderOutput.Color){O.include(f.Transform);O.include(t.NormalUtils,I);O.include(u.TerrainTexture,I);O.include(w.EvaluateSceneLighting,I);const T=I.overlayMode!==q.OverlayMode.Disabled,U=I.overlayMode===q.OverlayMode.EnabledWithWater;T&&O.include(q.OverlayTerrain,{...I,pbrMode:x.PBRMode.Water});U&&O.include(d.VertexTangent,I);O.varyings.add("vnormal","vec3");O.varyings.add("vpos",
"vec3");(I.atmosphere||I.screenSizePerspective)&&Q.uniforms.add(new F.Matrix4PassUniform("viewNormal",(W,R)=>R.camera.viewInverseTransposeMatrix));const aa=I.receiveShadows&&!I.renderOccluded;aa&&O.varyings.add("linearDepth","float");I.tileBorders&&O.varyings.add("vuv","vec2");I.atmosphere&&(Q.uniforms.add(new p.Float3PassUniform("lightingMainDirection",(W,R)=>R.lighting.lightingMainDirection)),O.varyings.add("wnormal","vec3"),O.varyings.add("wlight","vec3"));I.screenSizePerspective&&(O.varyings.add("screenSizeDistanceToCamera",
"float"),O.varyings.add("screenSizeCosAngle","float"));Q.code.add(D.glsl`
      void main(void) {
        vpos = position;
        vnormal = ${I.shading?D.glsl`normal`:D.glsl`getLocalUp(vpos, origin)`};
        vec2 uv = uv0;
        ${I.atmosphere?D.glsl`
        wnormal = normalize((viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz);
        wlight = normalize((view  * vec4(lightingMainDirection, 1.0)).xyz);`:""}
        ${I.tileBorders?D.glsl`vuv = uv;`:""}
        ${I.screenSizePerspective?D.glsl`
        vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
        screenSizeDistanceToCamera = length(viewPos);
        vec3 viewSpaceNormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;
        screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}
        gl_Position = transformPosition(proj, view, vpos);
        ${aa?D.glsl`linearDepth = gl_Position.w;`:""}
        forwardTextureCoordinates(uv);
        ${T?D.glsl`setOverlayVTC(uv);`:""}
        ${U?D.glsl`forwardVertexTangent(vnormal);`:D.glsl``}
      }
    `);O.extensions.add("GL_OES_standard_derivatives");O.extensions.add("GL_EXT_shader_texture_lod");O.include(k.SliceDraw,I);O.include(w.EvaluateSceneLighting,I);O.include(v.EvaluateAmbientOcclusion,I);O.include(B.ReadShadowMapDraw,I);S.uniforms.add([new A.Float3DrawUniform("cameraPosition",(W,R)=>l.subtract(H,R.camera.eye,W.origin)),new p.Float3PassUniform("viewDirection",(W,R)=>l.normalize(H,l.set(H,R.camera.viewMatrix[12],R.camera.viewMatrix[13],R.camera.viewMatrix[14]))),new y.FloatPassUniform("lightingGlobalFactor",
(W,R)=>R.lighting.globalFactor),new p.Float3PassUniform("lightingMainDirection",(W,R)=>R.lighting.lightingMainDirection),new p.Float3PassUniform("lightingMainIntensity",(W,R)=>R.lighting.mainLight.intensity)]);S.constants.add("ambientBoostFactor","float",N.ambientBoost);U&&S.uniforms.add([new P.Texture2DPassUniform("ovWaterTex",(W,R)=>0===R.overlays.length?null:R.overlays[n.OverlayIndex.INNER].getNormalTexture(W.overlaySource)),new E.Matrix4DrawUniform("view",(W,R)=>c.translate(J,R.camera.viewMatrix,
W.origin))]);S.code.add(D.glsl`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`);S.code.add(D.glsl`
      void main() {
        ${aa?D.glsl`float shadow = readShadowMap(vpos, linearDepth);`:D.glsl`float shadow = 0.0;`}
        vec3 normal = normalize(vnormal);
        float vndl = dot(normal, lightingMainDirection);
        float ssao = evaluateAmbientOcclusionInverse();
        vec4 tileColor = getTileColor();
        ${T?D.glsl`
            vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
            vec4 overlayColor = overlayOpacity * overlayColorOpaque;
            vec4 groundColor = tileColor;
            tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}
        if (rejectBySlice(vpos)) {
          tileColor *= sliceOpacity;
        }
        ${I.atmosphere?D.glsl`
            float ndotl = clamp(vndl, 0.0, 1.0);
            vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
            atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); //avoid atmosphere on bright base maps
            atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
            atm *= tileColor.a; // premultiply with tile alpha`:""}

        vec3 albedo = ${I.atmosphere?D.glsl`atm + tileColor.rgb;`:D.glsl`tileColor.rgb;`}

        // heuristic shading function used in the old terrain, now used to add ambient lighting
        float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl${I.shading?"":D.glsl`*2.5`}, 0.0, 1.0));

        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor ${I.shading?"":D.glsl`* lightingGlobalFactor`};

        gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);
        ${U?D.glsl`
            vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
            float waterNormalLength = length(overlayWaterMask);
            if (waterNormalLength > 0.95) {
              mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
              vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
              vec4 viewPosition = view*vec4(vpos, 1.0);
              vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + origin);
              vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
              // un-gamma the ground color to mix in linear space
              gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w);
            }`:""}
        ${I.screenSizePerspective?D.glsl`
          float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
          if (perspectiveScale <= 0.25) {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
          }
          else if (perspectiveScale <= 0.5) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
          }
          else if (perspectiveScale >= 0.99) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
          }
          else {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
          }`:""}
        ${I.tileBorders?D.glsl`
            vec2 dVuv = fwidth(vuv);
            vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));
            float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
      }
    `)}if(I.output===g.ShaderOutput.Depth||I.output===g.ShaderOutput.Shadow)O.include(f.Transform,{hasModelTransformation:!1,linearDepth:!0}),O.include(e.OutputDepth,{output:I.output}),O.include(t.NormalUtils,I),O.varyings.add("linearDepth","float"),Q.uniforms.add(new z.Float2PassUniform("nearFar",(T,U)=>U.camera.nearFar)),Q.code.add(D.glsl`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),S.code.add(D.glsl`void main() {
outputDepth(linearDepth);
}`);I.output===g.ShaderOutput.Normal&&(O.include(f.Transform),O.include(t.NormalUtils,I),O.varyings.add("vnormal","vec3"),O.varyings.add("vpos","vec3"),Q.uniforms.add(new F.Matrix4PassUniform("viewNormal",(T,U)=>U.camera.viewInverseTransposeMatrix)),Q.code.add(D.glsl`
        void main(void) {
          vec3 normal = ${I.shading?D.glsl`normal`:D.glsl`getLocalUp(position, origin)`};
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
          vnormal = normalize((viewNormal * vec4(normal, 1.0)).xyz);
        }
    `),S.code.add(D.glsl`void main() {
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) {
normal = -normal;
}
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
}`));I.output===g.ShaderOutput.Highlight&&(O.include(f.Transform),O.include(t.NormalUtils,I),O.include(q.OverlayTerrain,I),Q.code.add(D.glsl`void main() {
setOverlayVTC(uv0);
gl_Position = transformPosition(proj, view, position);
}`),O.include(h.OutputHighlight),S.code.add(D.glsl`void main() {
vec4 overlayColor = getCombinedOverlayColor();
if (overlayColor.a == 0.0) {
gl_FragColor = vec4(0.0);
return;
}
outputHighlight();
}`));return O}let L=function(I){function O(){return I.apply(this,arguments)||this}b._inheritsLoose(O,I);return O}(q.OverlayTerrainPassParameters);const J=m.create(),H=r.create();m=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:L,build:M},Symbol.toStringTag,{value:"Module"}));a.Terrain=m;a.TerrainPassParameters=L;a.build=M})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,
b){a.VertexTangent=function(c,m){c.varyings.add("tbnTangent","vec3");c.varyings.add("tbnBiTangent","vec3");m.spherical?c.vertex.code.add(b.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):c.vertex.code.add(b.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`);c.fragment.code.add(b.glsl`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl":function(){define("exports ./BackgroundGrid.glsl ./TileBlendInput ../../shaderModules/Float3Uniform ../../shaderModules/Float4Uniform ../../shaderModules/FloatUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DUniform".split(" "),function(a,b,c,m,l,r,n,g){a.TerrainTexture=function(k,f){k.varyings.add("vtc","vec2");
k.vertex.uniforms.add(new l.Float4Uniform("texOffsetAndScale"));k.fragment.uniforms.add(new g.Texture2DUniform("tex"));k.fragment.uniforms.add(new m.Float3Uniform("textureOpacities"));const d=f.textureFadingEnabled&&!f.renderOccluded;d&&(k.vertex.uniforms.add(new l.Float4Uniform("nextTexOffsetAndScale")),k.varyings.add("nvtc","vec2"),k.fragment.uniforms.add(new g.Texture2DUniform("texNext")),k.fragment.uniforms.add(new m.Float3Uniform("nextTexOpacities")),k.fragment.uniforms.add(new r.FloatUniform("fadeFactor")));
const e=f.tileBlendInput===c.TileBlendInput.ColorComposite;(f=f.tileBlendInput===c.TileBlendInput.GridComposite)&&k.fragment.include(b.BackgroundGrid);e&&k.fragment.uniforms.add(new m.Float3Uniform("backgroundColor"));k.vertex.code.add(n.glsl`
  void forwardTextureCoordinates(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${d?n.glsl`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:n.glsl``}
  }`);k.fragment.code.add(n.glsl`
    vec4 applyBaseOpacity(vec4 _color, vec3 _opacities) {
      return _opacities.z <= 0.0 ? _color : _color * _opacities.x;
    }

    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${f||e?n.glsl`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = ${e?n.glsl`vec4(backgroundColor, 1.0)`:n.glsl`gridColor(uv)`} * opacities.y;
              float alpha = opacities.z * color.a;
              return mix(bg, color, alpha) * opacities.x;`:n.glsl`return color;`}
    }`);d?k.fragment.code.add(n.glsl`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):k.fragment.code.add(n.glsl`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/TerrainTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../ViewingMode ../../../../chunks/Terrain.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h){n=function(v){function w(){var x=v.apply(this,arguments)||this;x.useStencil=!1;return x}c._inheritsLoose(w,v);var t=w.prototype;t.initializeConfiguration=function(x,B){B.spherical=x.viewingMode===m.ViewingMode.Global};t.initializeProgram=function(x){const B=w.shader.get().build(this.configuration);return new f.Program(x.rctx,B,k.Default3D)};t.initializePipeline=function(){this._stencilPipelineState=this._createPipeline(!0);return this._createPipeline(!1)};t._createPipeline=
function(x){const B=this.configuration,q=B.backfaceCullingEnabled&&!B.renderOccluded;return h.makePipelineState({blending:B.renderOccluded?h.simpleBlendingParams(e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA):null,culling:q&&h.backFaceCullingParams,depthTest:!B.renderOccluded&&{func:e.CompareFunction.LESS},depthWrite:!B.renderOccluded&&h.defaultDepthWriteParams,colorWrite:h.defaultColorWriteParams,stencilTest:x?d.renderWhenBitIsNotSet(g.StencilBits.IntegratedMeshMaskExcluded):null})};t.getPipelineState=
function(x,B){return this.useStencil?this._stencilPipelineState:v.prototype.getPipelineState.call(this,x,B)};return w}(n.ShaderTechnique);n.shader=new r.ReloadableShaderModule(l.Terrain,()=>new Promise((v,w)=>a(["../core/shaderLibrary/terrain/Terrain.glsl"],v,w)));b.TerrainTechnique=n;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/TerrainTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/terrain/Overlay.glsl ../core/shaderLibrary/terrain/TileBlendInput ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,c,m,l,r,n,g,k,f){f=function(d){function e(){var h=d.apply(this,arguments)||this;h.output=l.ShaderOutput.Color;h.overlayMode=n.OverlayMode.Disabled;h.tileBlendInput=g.TileBlendInput.LayerOnly;h.spherical=!1;h.atmosphere=!1;h.receiveShadows=!1;h.hasSlicePlane=!1;h.backfaceCullingEnabled=!1;h.stencilEnabled=!1;h.textureFadingEnabled=!1;h.renderOccluded=!1;h.hasScreenSpaceReflections=!1;h.hasCloudsReflections=!1;h.tileBorders=!1;h.screenSizePerspective=!1;h.receiveAmbientOcclusion=!1;h.shading=
m("enable-feature:terrain-shading");return h}b._inheritsLoose(e,d);return e}(f.DefaultTechniqueConfiguration);c.__decorate([k.parameter({count:l.ShaderOutput.COUNT})],f.prototype,"output",void 0);c.__decorate([k.parameter({count:n.OverlayMode.COUNT})],f.prototype,"overlayMode",void 0);c.__decorate([k.parameter({count:g.TileBlendInput.COUNT})],f.prototype,"tileBlendInput",void 0);c.__decorate([k.parameter()],f.prototype,"spherical",void 0);c.__decorate([k.parameter()],f.prototype,"atmosphere",void 0);
c.__decorate([k.parameter()],f.prototype,"receiveShadows",void 0);c.__decorate([k.parameter()],f.prototype,"hasSlicePlane",void 0);c.__decorate([k.parameter()],f.prototype,"backfaceCullingEnabled",void 0);c.__decorate([k.parameter()],f.prototype,"stencilEnabled",void 0);c.__decorate([k.parameter()],f.prototype,"textureFadingEnabled",void 0);c.__decorate([k.parameter()],f.prototype,"renderOccluded",void 0);c.__decorate([k.parameter()],f.prototype,"hasScreenSpaceReflections",void 0);c.__decorate([k.parameter()],
f.prototype,"hasCloudsReflections",void 0);c.__decorate([k.parameter()],f.prototype,"tileBorders",void 0);c.__decorate([k.parameter()],f.prototype,"screenSizePerspective",void 0);c.__decorate([k.parameter()],f.prototype,"receiveAmbientOcclusion",void 0);c.__decorate([k.parameter()],f.prototype,"shading",void 0);c.__decorate([k.parameter({constValue:!0})],f.prototype,"isGround",void 0);c.__decorate([k.parameter({constValue:r.PBRMode.Disabled})],f.prototype,"pbrMode",void 0);c.__decorate([k.parameter({constValue:!1})],
f.prototype,"highStepCount",void 0);c.__decorate([k.parameter({constValue:!1})],f.prototype,"useCustomDTRExponentForWater",void 0);c.__decorate([k.parameter({constValue:!1})],f.prototype,"useFillLights",void 0);a.TerrainTechniqueConfiguration=f;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TerrainSurfacePerformanceInfo":function(){define(function(){return function(){this.numMerged=this.numSplit=this.numRendered=this.numVisible=this.numLeaves=
this.numNodes=0;this.numRenderedPerLevel=[];this.numLoadedPerLevel=[]}})},"esri/views/3d/terrain/TilingSchemeLogic":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../layers/support/layerUtils ../../ViewingMode ./terrainUtils ./TilingScheme".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q){a.TilingSchemeLogic=function(u){function C(A){A=u.call(this,A)||this;A._handles=new l;return A}b._inheritsLoose(C,u);var z=C.prototype;z.initialize=function(){this._handles.add(this.layers.on("change",()=>this._update()));this._handles.add(n.watch(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme()));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()};z.destroy=function(){this._handles=r.destroyMaybe(this._handles);
this._waitTask=null};z._update=function(){this._waitTask=null;if(!this.tilingSchemeLocked){var A;this.layers.some(y=>!t.isTiledLayer(y)||y.isRejected()?!1:!y.isFulfilled()||r.isSome(B.getTiledLayerInfo(y,this.viewSpatialReference,this.viewingMode))?(A=y,"vector-tile"!==(null==y?void 0:y.type)&&!B.isProjectableRasterLayer(y)):!1);if(A)if(A.isResolved()){var p=B.getTiledLayerInfo(A,this.viewSpatialReference,this.viewingMode);r.isSome(p)&&(p=new q.TilingScheme(p.tileInfo),this._lockTilingScheme(p))}else this._updateWhen(A)}};
z._updateWhen=function(A){const p=A.when().catch(()=>{}).then(()=>{p!==this._waitTask||this.destroyed||this._update()});this._waitTask=p};z._lockTilingScheme=function(A){if(this.viewingMode===x.ViewingMode.Global){const p=A.levels.length-1;A.spatialReference.isWebMercator?A=q.TilingScheme.makeWebMercatorAuxiliarySphere(p):h.canProjectToWGS84ComparableLonLat(A.spatialReference)&&(A=q.TilingScheme.makeGCSWithTileSize(A.spatialReference,A.pixelSize,p))}this.tilingSchemeLocked=!0;this.tilingScheme=A;
this.extentHelper.tilingScheme=this.tilingScheme;this._updateTiledLayerExtent();this._handles.removeAll();this._handles.add(n.watch(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))};z._updateTiledLayerExtent=function(){this._set("extent",this.extentHelper.tiledLayersExtent)};z._setAdHocTilingScheme=function(){if(this.viewingMode===x.ViewingMode.Global){var A=this.extentHelper.viewSpatialReference;const p=h.canProjectToWGS84ComparableLonLat(A)||w.isMars(A)||w.isMoon(A);
A.isWebMercator?this.tilingScheme=q.TilingScheme.WebMercatorAuxiliarySphere:p&&(this.tilingScheme=q.TilingScheme.makeGCSWithTileSize(A,256));this._set("extent",this.extentHelper.layerViewsExtent)}else A=this.extentHelper.layerViewsExtent,r.isSome(A)&&!v.equals(A,this.extent)&&(this.tilingScheme=q.TilingScheme.fromExtent(A,this.extentHelper.viewSpatialReference),this._set("extent",A))};b._createClass(C,[{key:"test",get:function(){return{lockTilingScheme:A=>this._lockTilingScheme(A),done:!this._waitTask}}}]);
return C}(m);c.__decorate([g.property()],a.TilingSchemeLogic.prototype,"tilingScheme",void 0);c.__decorate([g.property({readOnly:!0})],a.TilingSchemeLogic.prototype,"extent",void 0);c.__decorate([g.property({value:!1})],a.TilingSchemeLogic.prototype,"tilingSchemeLocked",void 0);c.__decorate([g.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"viewSpatialReference",void 0);c.__decorate([g.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"layers",void 0);c.__decorate([g.property({constructOnly:!0})],
a.TilingSchemeLogic.prototype,"extentHelper",void 0);c.__decorate([g.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"viewingMode",void 0);a.TilingSchemeLogic=c.__decorate([e.subclass("esri.views.3d.terrain.TilingSchemeLogic")],a.TilingSchemeLogic);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["exports","../../../chunks/vec2f64"],function(a,b){let c=function(){function m(){this.offset=
b.create();this.scale=0;this.tile=null}var l=m.prototype;l.init=function(r,n,g,k){this.tile=r;this.offset[0]=n;this.offset[1]=g;this.scale=k};l.dispose=function(){this.tile=null;this.offset[0]=0;this.scale=this.offset[1]=0};return m}();a.UpsampleInfo=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/Stage":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/PooledArray ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../state/helpers/SceneIntersectionHelper ./lib/AutoDisposable ./lib/basicInterfaces ./lib/ChangeSet ./lib/GeometryRecord ./lib/WebGLLayer ./parts/Model ./parts/RenderView ../../support/Scheduler".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z){var A;a.Stage=A=function(p){function y(E){E=p.call(this,E)||this;E._handles=new l;E._model=new u.Model;E._layers=new n;E._changeSet=new x.ChangeSet;E._layerSyncSet=new Set;return E}b._inheritsLoose(y,p);var D=y.prototype;D.initialize=function(){this._set("renderView",new C.RenderView(this));this._frameTask=this.resourceController.scheduler.registerTask(z.TaskPriority.STAGE,this);this._handles.add(this._frameTask)};D.destroy=function(){B.GeometryRecord.pool.prune(0);
this._handles.destroy();this.dispose()};D.add=function(E){this._model.add(E);q.isWebGLLayer(E)&&(E.attachStage(this),this._addLayer(E));this.renderView.requestRender()};D.remove=function(E){r.isNone(E)||(this.renderView.requestRender(),this._model.remove(E),q.isWebGLLayer(E)&&(this._removeLayer(E),E.detachStage()))};D.addMany=function(E){r.isSome(E)&&(this._model.addMany(E),this.renderView.requestRender())};D.removeMany=function(E){r.isSome(E)&&(this._model.removeMany(E),this.renderView.requestRender())};
D.load=function(){var E=b._asyncToGenerator(function*(F){r.isNone(F)||(Array.isArray(F)||(F=[F]),yield Promise.all(F.filter(G=>r.isNone(G.glTexture)).map(G=>this.schedule(()=>this._model.has(G)?G.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique):null))))});return function(F){return E.apply(this,arguments)}}();D.loadImmediate=function(E){return E.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)};D.forEachOfType=
function(E,F){this._model.forEachOfType(E,F)};D.handleEvent=function(E,F){this.destroyed||(this._model.dirtySet[E](F),this.renderView.requestRender())};D.runTask=function(E){this._frameTask.processQueue(E);E.done||this._commit()};D._commit=function(){const E=this._model.dirtySet;A.DebugSettings.logDirtySet&&console.log("Dirty set: "+E.formatDebugInfo());E.commit(this._changeSet);A.DebugSettings.logDirtySet&&(console.log("RGs add: "+this._changeSet.adds.map(F=>F.id)),console.log("RGs remove: "+this._changeSet.removes.map(F=>
F.id)));this._layerSyncSet.clear();this.renderView.modify(this._changeSet);this.renderView.requestRender()};D.schedule=function(E,F){return this._frameTask.schedule(E,F)};D.syncLayer=function(E){this._layerSyncSet.add(E);this.renderView.requestRender()};D.processSyncLayers=function(){const E=this._model.dirtySet;this._layers.forAll(F=>{if(this._layerSyncSet.has(F.id)||F.updatePolicy===t.UpdatePolicy.SYNC)E.commitLayer(F.id,this._changeSet),this._layerSyncSet.delete(F.id)});for(const F of this._layerSyncSet)E.commitLayer(F,
this._changeSet);this._layerSyncSet.clear();this.renderView.modify(this._changeSet)};D.getObject=function(E){return this._model.getObject(E)};D._addLayer=function(E){this._layers.includes(E)||this._layers.push(E)};D._removeLayer=function(E){this._commit();null!=this._layers.removeUnordered(E)&&(this._model.dirtySet.getResidentRenderGeometries(E.id,this._changeSet.removes),this.renderView.modify(this._changeSet))};D.addRenderPlugin=function(E,F,G){E=this.renderView.renderPlugins.add(E,F,G);G=()=>{v.isIntersectionHandler(F)&&
this.sceneIntersectionHelper.addIntersectionHandler(F)};if(g.isPromiseLike(E))return E.then(G);G()};D.removeRenderPlugin=function(E){v.isIntersectionHandler(E)&&this.sceneIntersectionHelper.removeIntersectionHandler(E);this.renderView.renderPlugins.remove(E)};b._createClass(y,[{key:"viewingMode",get:function(){return this.state.viewingMode}},{key:"updating",get:function(){return this._model.dirtySet.dirty||this.renderView.updating||this._frameTask.updating}},{key:"running",get:function(){return this._model.dirtySet.dirty}},
{key:"layers",get:function(){return this._layers}},{key:"performanceInfo",get:function(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}},{key:"test",get:function(){const E=this;return{getCount(F){return E._model.test.content.filter(G=>G.type===F).length},model:E._model}}}]);return y}(w.AutoDisposableMixin(m));a.Stage.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1};c.__decorate([k.property({constructOnly:!0})],a.Stage.prototype,"resourceController",void 0);
c.__decorate([k.property({constructOnly:!0})],a.Stage.prototype,"options",void 0);c.__decorate([k.property({constructOnly:!0})],a.Stage.prototype,"state",void 0);c.__decorate([k.property({constructOnly:!0})],a.Stage.prototype,"sceneIntersectionHelper",void 0);c.__decorate([k.property({readOnly:!0})],a.Stage.prototype,"viewingMode",null);c.__decorate([k.property({constructOnly:!0})],a.Stage.prototype,"container",void 0);c.__decorate([k.property({constructOnly:!0})],a.Stage.prototype,"renderSR",void 0);
c.__decorate([k.property({constructOnly:!0})],a.Stage.prototype,"_handles",void 0);c.__decorate([k.property({readOnly:!0})],a.Stage.prototype,"updating",null);c.__decorate([k.property({constructOnly:!0})],a.Stage.prototype,"_model",void 0);c.__decorate([w.autoDispose(),k.property()],a.Stage.prototype,"renderView",void 0);a.Stage=A=c.__decorate([h.subclass("esri.views.3d.webgl-engine.Stage")],a.Stage);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/parts/Model":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../lib/ContentObjectType ../lib/GridLocalOriginFactory ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util ../lib/WebGLLayer".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t){a.Model=function(x){function B(){var u=x.apply(this,arguments)||this;u.dirtySet=new h({model:b._assertThisInitialized(u)});u._content=new Map;u._originFactory=new e.GridLocalOriginFactory(null,75E4);return u}b._inheritsLoose(B,x);var q=B.prototype;q.getObject=function(u){return this._content.get(u)};q.add=function(u){const C=u.id;w.assert(!this._content.has(C),"Model/Stage already contains object to be added");this._content.set(C,u);t.isWebGLLayer(u)&&this.dirtySet.layerAdded(u)};
q.remove=function(u){w.assert(this._content.has(u.id),"Model/Stage doesn't contain object to be removed");this._content.delete(u.id);u.unload();t.isWebGLLayer(u)&&this.dirtySet.layerRemoved(u)};q.addMany=function(u){for(const C of u)l.isSome(C)&&(w.assert(!this._content.has(C.id),"Model/Stage already contains object to be added"),this._content.set(C.id,C))};q.removeMany=function(u){for(const C of u)w.assert(this._content.has(C.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(C.id),
C.unload()};q.has=function(u){return this._content.has(u.id)};q.forEachOfType=function(u,C){this._content.forEach(z=>{z.type===u&&C(z)})};q.getRenderGeometry=function(u,C){const {geometry:z,material:A,id:p,shaderTransformation:y,origin:D,instanceParameters:E}=C,F=new v.RenderGeometry(z,A,{id:p,boundingInfo:z.boundingInfo,calculateShaderTransformation:y,castShadow:u.castShadow});F.updateTransformation(G=>u.getCombinedStaticTransformation(C,G));F.origin=D||this._originFactory.getOrigin(F.boundingSphere);
F.instanceParameters=E;return F};q.updateRenderGeometryTransformation=function(u,C,z){if(l.isNone(u))return!1;z.updateTransformation(p=>u.getCombinedStaticTransformation(C,p));const A=this._originFactory.getOrigin(z.boundingSphere);return z.origin!==A};q.getStats=function(){const u={},C=Array.from(this._content.values());for(let z=0;z<d.ContentObjectType.COUNT;++z)u[z]=C.filter(A=>A.type===z).length;return{contentTypes:u,dirtySet:this.dirtySet.formatDebugInfo()}};b._createClass(B,[{key:"test",get:function(){return{content:Array.from(this._content.values())}}}]);
return B}(m);c.__decorate([r.property({constructOnly:!0})],a.Model.prototype,"dirtySet",void 0);a.Model=c.__decorate([f.subclass("esri.views.3d.webgl-engine.parts.Model")],a.Model);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/maybe ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./GeometryRecord ./ModelDirtyTypes ./Util".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){c=function(w){function t(B){B=w.call(this,B)||this;B._residentGeomRecords=new Map;B._dirtyGeomRecords=new Map;B.dirty=!1;return B}a._inheritsLoose(t,w);var x=t.prototype;x.commit=function(B){this.dirty=!1;this._dirtyGeomRecords.forEach((q,u)=>this.commitLayer(u,B))};x.commitLayer=function(B,q){const u=this._dirtyGeomRecords.get(B);u&&(u.forEach((C,z)=>{const A=this._ensureGeomRecord(B,z);C.forEach((p,y)=>{var D=p[0],E=p[1],F=p[2];p=!1;if(E&h.ModelDirty.Geometry.UPDATE){var G=
A.get(y);if(G){G=G[1];if(F&h.ModelDirty.State.TRANSFORMATION){const P=this.model.getObject(z);this.model.updateRenderGeometryTransformation(P,D,G)&&(p=!0)}p||q.updates.push({renderGeometry:G,updateType:F})}else v.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(E&h.ModelDirty.Geometry.REMOVE||p)(F=A.get(y))?(q.removes.push(F[1]),A.delete(y),F[0].disposed&&e.GeometryRecord.pool.release(F[0])):E===h.ModelDirty.Geometry.REMOVE&&v.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove");
if(E&h.ModelDirty.Geometry.ADD||p)E=this.model.getObject(z),l.isSome(E)&&(E=this.model.getRenderGeometry(E,D),D=[D,E],q.adds.push(E),A.set(y,D))});0===A.size&&this._residentGeomRecords.get(B).delete(z)}),0===this._residentGeomRecords.get(B).size&&this._residentGeomRecords.delete(B),this._dirtyGeomRecords.delete(B))};x.getResidentRenderGeometries=function(B,q){(B=this._residentGeomRecords.get(B))&&B.forEach(u=>u.forEach(C=>q.push(C[1])))};x._objectStateChanged=function(B,q){for(const u of q.geometryRecords)this._updateOrCreateDirtyRecord(q,
u,null,h.ModelDirty.Geometry.UPDATE,0,0,h.ModelDirty.Geometry.UPDATE,h.ModelDirty.Geometry.ADD|h.ModelDirty.Geometry.REMOVE,B)};x.visibilityChanged=function(B){this._objectStateChanged(h.ModelDirty.State.VISIBILITIES,B)};x.highlightChanged=function(B){this._objectStateChanged(h.ModelDirty.State.HIGHLIGHTS,B)};x.occlusionChanged=function(B){this._objectStateChanged(h.ModelDirty.State.OCCLUDEES,B)};x.vertexAttrsUpdated=function(B){this._updateOrCreateDirtyRecord(B.object,B.record,null,h.ModelDirty.Geometry.UPDATE,
0,0,h.ModelDirty.Geometry.UPDATE,h.ModelDirty.Geometry.ADD|h.ModelDirty.Geometry.REMOVE,h.ModelDirty.State.VERTEXATTRS)};x.layerAdded=function(B){B.objects.forAll(q=>this._layerObjectAdded(B,q))};x.layerRemoved=function(B){B.objects.forAll(q=>this._layerObjectRemoved(B,q))};x.layerObjectAdded=function(B){this._layerObjectAdded(B.layer,B.object)};x._layerObjectAdded=function(B,q){B=B.id;for(const u of q.geometryRecords)this._objectGeometryAdded(q,u,B)};x.layerObjectRemoved=function(B){this._layerObjectRemoved(B.layer,
B.object)};x.layerObjectsAdded=function(B){for(const q of B.objects)this._layerObjectAdded(B.layer,q)};x.layerObjectsRemoved=function(B){for(const q of B.objects)this._layerObjectRemoved(B.layer,q)};x._layerObjectRemoved=function(B,q){B=B.id;for(const u of q.geometryRecords)this._objectGeometryRemoved(q,u,B)};x.shaderTransformationChanged=function(B){(B=this._residentGeomRecords.get(B.id))&&B.forEach((q,u)=>{(u=this.model.getObject(u))&&u.hasVolativeTransformation()&&q.forEach(C=>{C[1].shaderTransformationChanged()})})};
x.objectTransformation=function(B){const q=this._getParentLayerId(B);this._ensureGeomRecord(q,B.id).forEach(u=>{this._updateOrCreateDirtyRecord(B,u[0],q,h.ModelDirty.Geometry.UPDATE,0,0,h.ModelDirty.Geometry.UPDATE,h.ModelDirty.Geometry.ADD|h.ModelDirty.Geometry.REMOVE,h.ModelDirty.State.TRANSFORMATION)})};x.objectGeometryAdded=function(B){this._objectGeometryAdded(B.object,B.record)};x._objectGeometryAdded=function(B,q,u=null){this._updateOrCreateDirtyRecord(B,q,u,h.ModelDirty.Geometry.ADD,h.ModelDirty.Geometry.REMOVE,
0,0,0)};x.objectGeometryRemoved=function(B){this._objectGeometryRemoved(B.object,B.record)};x._objectGeometryRemoved=function(B,q,u=null){this._updateOrCreateDirtyRecord(B,q,u,h.ModelDirty.Geometry.REMOVE,h.ModelDirty.Geometry.ADD,h.ModelDirty.Geometry.UPDATE,0,0)};x._updateOrCreateDirtyRecord=function(B,q,u,C,z,A,p,y,D){u=l.unwrapOr(u,this._getParentLayerId(B));const E=q.id;B=this._ensureDirtyRecord(u,B.id);(u=B.get(E))?(q=u[1],q&z?(B.delete(E),u[0].disposed&&e.GeometryRecord.pool.release(u[0])):
q&A?(u[1]=C,u[2]=D):q&p?u[2]|=D:q&y||v.assert(!1,"ModelDirtySet.objectGeometryAdded: inconsistent state")):B.set(E,[q,C,D]);this.dirty=this._hasDirtyGeometryRecords};x._ensureGeomRecord=function(B,q){let u=this._residentGeomRecords.get(B);u||(u=new Map,this._residentGeomRecords.set(B,u));B=u.get(q);B||(B=new Map,u.set(q,B));return B};x._ensureDirtyRecord=function(B,q){let u=this._dirtyGeomRecords.get(B);u||(u=new Map,this._dirtyGeomRecords.set(B,u));B=u.get(q);B||(B=new Map,u.set(q,B));return B};
x._getParentLayerId=function(B){return l.isSome(B.parentLayer)?B.parentLayer.id:r.NullUID};x.formatDebugInfo=function(){const B=["ADD","UPD",void 0,"REM"];let q="";this._dirtyGeomRecords.forEach((u,C)=>{u.forEach((z,A)=>{0<q.length&&(q+="\n");q+=C+"."+A;const p=[];z.forEach(y=>{const D=y[1];p[D]||(p[D]=[]);p[D].push(y[0].geometry.id)});for(z=0;z<p.length;z++)if(p[z])for(q+=" "+B[z-1]+": ",A=0;A<p[z].length;A++)q+=p[z][A]+", "})});return q};a._createClass(t,[{key:"_hasDirtyGeometryRecords",get:function(){return m.someMap(this._dirtyGeomRecords,
B=>m.someMap(B,q=>q&&0<q.size))}},{key:"test",get:function(){const B=this;return{get residentLayerCount(){return B._residentGeomRecords.size},get residentObjectCount(){return Array.from(B._residentGeomRecords.values()).reduce((q,u)=>q+u.size,0)}}}}]);return t}(c);b.__decorate([n.property({constructOnly:!0})],c.prototype,"model",void 0);b.__decorate([n.property()],c.prototype,"dirty",void 0);return c=b.__decorate([d.subclass("esri.views.3d.webgl-engine.lib.ModelDirtySet")],c)})},"esri/views/3d/webgl-engine/parts/RenderView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/time ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../collections/Component/ComponentObjectCollection ../core/shaderTechnique/ShaderTechniqueRepository ../lib/AutoDisposable ../lib/basicInterfaces ../lib/CompositingHelper ../lib/depthRangeUtils ../lib/GLMaterialRepository ../lib/MagnifierHelper ../lib/Renderer ../lib/RenderingContext ../lib/TextureRepository ../materials/StippleTextureRepository ../materials/internal/WaterTextureRepository ./contextCache ./requireUtils ./ScreenshotManager ./testUtils ../../../webgl/context-util".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N,M){const L=n.getLogger("esri.views.3d.webgl-engine.parts.View");a.RenderView=function(H){function I(Q){var S=H.call(this,{})||this;S.events=new l;S.waterTextureRepository=new F.WaterTextureRepository;S._magnifierHelper=new A.MagnifierHelper;S._needsUpdate=!0;S._needsRender=!0;S._idleSuspend=!0;S._needsWaterReflectionUpdate=!1;S._lastAnimationUpdate=0;S._container=Q.container;S._viewingMode=Q.viewingMode;S._initializeContext(Q);
k.watch(()=>{var T;return null==(T=S.waterTextureRepository)?void 0:T.updating},()=>S.requestRender(),k.initial);S._magnifierHelper.events.on("request-render",()=>S.requestRender());S._stippleTextureRepository=new E.StippleTextureRepository(S._rctx);S._shaderTechniqueRepository=new x.ShaderTechniqueRepository({rctx:S._rctx,viewingMode:Q.viewingMode,stippleTextureRepository:S._stippleTextureRepository,waterTextureRepository:S.waterTextureRepository});S._textureRepository=new D.TextureRepository(Q,
S._shaderTechniqueRepository,S._rctx);S._textureRepository.events.on("changed",T=>S.requestRender(T));S._materialRepository=new z.GLMaterialRepository(S._textureRepository,S._shaderTechniqueRepository,()=>S.requestRender(),()=>S.requestRender());S._compositingHelper=new u(S._rctx,S._shaderTechniqueRepository);S._renderer=new p.Renderer(S._materialRepository,S._textureRepository,S._shaderTechniqueRepository,S._rctx,S._compositingHelper,S._magnifierHelper,T=>S.requestRender(T),(T,U)=>Q.schedule(T,U),
Q);S._screenshotManager=new K.ScreenshotManager(S._rctx,(T,U,aa)=>S._renderer.render(T,U,U,aa),T=>S.requestRender(T),Q.options.screenshot.renderOverlay,T=>S.events.emit("force-camera-for-screenshot",T),()=>S._renderer.disposeOffscreenBuffers());S._registerFrameTask(Q);return S}b._inheritsLoose(I,H);var O=I.prototype;O.normalizeCtorArgs=function(){return{}};O.dispose=function(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._frameTask=g.removeMaybe(this._frameTask);
this._shaderTechniqueRepository=g.disposeMaybe(this._shaderTechniqueRepository);H.prototype.dispose.call(this);this._rctx=this._tmpDepthBuffer=null};O.requestRender=function(Q=q.RenderRequestType.UPDATE){Q===q.RenderRequestType.UPDATE?this._needsUpdate=!0:this._needsRender=!0};O.ensureEdgeView=function(){return this._renderer.ensureEdgeView()};O.updateLightSources=function(Q,S,T){this._renderer.updateLightSources(Q,S,T);this.requestRender()};O.setRenderParameters=function(Q){void 0!==Q.idleSuspend&&
this._idleSuspend!==!!Q.idleSuspend&&(this._idleSuspend=!!Q.idleSuspend,this.requestRender());this._renderer.setRenderParameters(Q)};O.modify=function(Q){this._renderer.modify(Q);Q.clear()};O.takeScreenshot=function(Q){return this._screenshotManager.takeScreenshot(Q)};O.getAlpha=function(){return this._rctx.contextAttributes.alpha};O.readAccumulatedShadow=function(Q){return this._renderer.readAccumulatedShadow(Q[0],Q[1])};O.readHUDVisibility=function(Q,S,T,U,aa){this._renderer.readHUDVisibility(Q,
S,T,U,aa)};O.getMinimalDepthForArea=function(Q,S,T,U,aa,W=aa){W=U.constrainWindowSize(S,T,aa*U.pixelRatio,W*U.pixelRatio);const R=this._ensureDepthBuffer(W);this._renderer.readDepthPixels(U,W,R);aa=Number.MAX_VALUE;for(let V=0;V<W[2]*W[3];V++){const da=C.textureToDepth(4*V,R,U.nearFar);aa>da&&da!==U.nearFar[0]&&da!==U.nearFar[1]&&(aa=da)}g.isSome(Q)&&(Q=Q.pickDepth(S*U.pixelRatio,T*U.pixelRatio,U),g.isSome(Q)&&aa>Q&&Q!==U.nearFar[0]&&Q!==U.nearFar[1]&&(aa=Q));return aa===Number.MAX_VALUE?void 0:aa};
O._ensureDepthBuffer=function(Q){Q=4*Q[2]*Q[3];if(g.isNone(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<Q)this._tmpDepthBuffer=new Uint8Array(Q);return this._tmpDepthBuffer};O.reloadShaders=function(){var Q=b._asyncToGenerator(function*(){P.removeLoadedShaderModules();yield this._shaderTechniqueRepository.reloadAll();this.requestRender()});return function(){return Q.apply(this,arguments)}}();O._registerFrameTask=function(Q){const S=Q.state,T={viewCamera:S.camera,frameHasDecorations:!1};
let U=!1,aa=q.RenderRequestType.BACKGROUND,W=!1;this._frameTask=f.addFrameTask({preRender:R=>{U=this.updating;aa=this._needsUpdate?q.RenderRequestType.UPDATE:q.RenderRequestType.BACKGROUND;Q.processSyncLayers();const V=d.Milliseconds(R.time-this._lastAnimationUpdate);if(V>this.animationTimestep||g.isSome(this.forcedAnimationTime)||U||this._needsRender)this._renderer.updateAnimation({camera:S.camera,dt:V,forcedTime:this.forcedAnimationTime})&&this.requestRender(q.RenderRequestType.BACKGROUND),this._lastAnimationUpdate=
R.time},render:()=>{if((this._needsUpdate||this._needsRender||!this._idleSuspend||!this._renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&0<S.camera.fullWidth&&0<S.camera.fullHeight){const R=this._needsUpdate&&this._idleSuspend&&this._renderer.isCameraFinal;this._needsWaterReflectionUpdate=this._needsUpdate=this._needsRender=!1;this._renderer.render(null,S.camera,S.contentCamera,q.Decorations.ON);W=!0;R&&this._renderer.hasWaterReflection&&(this.requestRender(q.RenderRequestType.BACKGROUND),
this._needsWaterReflectionUpdate=!0)}},update:()=>{T.viewCamera=S.camera;T.frameHasDecorations=this._renderer.hasSlicePlane||this._magnifierHelper.enabled;this._textureRepository.update();this._screenshotManager.update(T)},finish:()=>{W&&(this._renderer.finish(aa),W=!1)}})};O._initializeContext=function(Q){var S;const T=Q.options;this._canvas=T.canvas;this._canvas||(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const U=
{alpha:T.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==T.stencil?!0:T.stencil,powerPreference:"high-performance",preserveDrawingBuffer:null!=(S=T.preserveDrawingBuffer)?S:!1};S=M.createContextOrErrorHTML("3d",this._canvas,U);g.isNone(S)?(Q=r("esri-force-webgl"),L.error("A WebGL context with the requested version ("+Q?Q:"automatic) could not be created.")):(this._rctx=this._newRenderingContext(S,Q),this._loadShaderOnlyExtensions(),!T.alpha&&this._rctx.contextAttributes.alpha&&
L.error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&11<=r("safari")&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas))};O._newRenderingContext=function(Q,S){const T={disabledExtensions:S.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:S.options.debugWebGLExtensions||{},maxAnisotropy:8},U=(aa,W)=>S.resourceController.memoryController.newCache(aa,W);if(N.contextCache.enabled){let aa=
J.get(Q);if(aa)return aa.configure(T),aa.newCache=U,aa.ref(),aa;aa=new y.RenderingContext(Q,T,U);J.set(Q,aa);aa.ref();return aa}return new y.RenderingContext(Q,T,U)};O._loadShaderOnlyExtensions=function(){this._rctx.capabilities.enable("standardDerivatives");this._rctx.capabilities.enable("shaderTextureLOD");this._rctx.capabilities.enable("textureFloat")};b._createClass(I,[{key:"performanceInfo",get:function(){const Q=this._rctx.gl;return{renderer:this._renderer.performanceInfo,textureMemory:void 0!==
Q.getUsedTextureMemory?Q.getUsedTextureMemory():void 0,renderbufferMemory:void 0!==Q.getUsedRenderbufferMemory?Q.getUsedRenderbufferMemory():void 0,VBOMemory:void 0!==Q.getUsedVBOMemory?Q.getUsedVBOMemory():void 0}}},{key:"updating",get:function(){return this._needsUpdate||this._needsWaterReflectionUpdate||this._renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}},{key:"edgeView",get:function(){return this._renderer.edgeView}},
{key:"textureRepository",get:function(){return this._textureRepository}},{key:"compositingHelper",get:function(){return this._compositingHelper}},{key:"magnifier",set:function(Q){this._magnifierHelper.magnifier=Q}},{key:"renderingContext",get:function(){return this._rctx}},{key:"capabilities",get:function(){return this._rctx.capabilities}},{key:"canvas",get:function(){return this._canvas}},{key:"shadowsEnabled",get:function(){return this._renderer.shadowsEnabled}},{key:"renderPlugins",get:function(){return this._renderer.renderPlugins}},
{key:"test",get:function(){return{renderer:this._renderer}}},{key:"gpuMemoryUsage",get:function(){return this._renderer.gpuMemoryUsage}},{key:"animationTimestep",get:function(){return this._renderer.animationTimestep}},{key:"componentObjectCollection",get:function(){g.isNone(this._componentObjectCollection)&&(this._componentObjectCollection=new t.ComponentObjectCollection(this._renderer.renderPassManager,this._viewingMode));return this._componentObjectCollection},set:function(Q){this._componentObjectCollection=
Q}}]);return I}(B.AutoDisposableMixin(m));c.__decorate([e.property({type:Boolean,readOnly:!0})],a.RenderView.prototype,"updating",null);c.__decorate([B.autoDispose()],a.RenderView.prototype,"_rctx",void 0);c.__decorate([B.autoDispose()],a.RenderView.prototype,"_container",void 0);c.__decorate([B.autoDispose()],a.RenderView.prototype,"_canvas",void 0);c.__decorate([B.autoDispose()],a.RenderView.prototype,"_stippleTextureRepository",void 0);c.__decorate([B.autoDispose(),e.property()],a.RenderView.prototype,
"waterTextureRepository",void 0);c.__decorate([B.autoDispose(),e.property()],a.RenderView.prototype,"_magnifierHelper",void 0);c.__decorate([B.autoDispose(),e.property()],a.RenderView.prototype,"_textureRepository",void 0);c.__decorate([B.autoDispose()],a.RenderView.prototype,"_compositingHelper",void 0);c.__decorate([B.autoDispose()],a.RenderView.prototype,"_renderer",void 0);c.__decorate([B.autoDispose()],a.RenderView.prototype,"_screenshotManager",void 0);c.__decorate([B.autoDispose()],a.RenderView.prototype,
"componentObjectCollection",null);c.__decorate([B.autoDispose()],a.RenderView.prototype,"_componentObjectCollection",void 0);c.__decorate([e.property()],a.RenderView.prototype,"_needsUpdate",void 0);c.__decorate([e.property()],a.RenderView.prototype,"_needsWaterReflectionUpdate",void 0);a.RenderView=c.__decorate([w.subclass("esri.views.3d.webgl-engine.parts.RenderView")],a.RenderView);const J=G.getContextCache();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/collections/Component/ComponentObjectCollection":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/vec4f32 ../../../../../chunks/vec32 ../../../../../chunks/vec33 ../../../../ViewingMode ../../../layers/i3s/I3SUtil ../../../layers/support/symbolColorUtils ../../../support/orientedBoundingBox ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ./ComponentData ./ComponentObject ./IntersectionGeometry ./Renderable ./RenderGeometry ./RenderSubmitSystem ./SourceGeometry ./Material/ComponentMaterial ./Material/shader/ComponentData.glsl ../../lib/ComponentUtils ../../lib/Util ../../lib/VertexAttribute ../../lib/verticalOffsetUtils ../../lib/edgeRendering/bufferLayouts ../../lib/edgeRendering/EdgeProcessingWorker ../../lib/TextureBackedBuffer/BufferManager ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N,M,L,J,H,I){function O(W,R){return W===R?D.ComponentParameterSummary.All:0===W?D.ComponentParameterSummary.None:D.ComponentParameterSummary.Some}const Q=c.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");c=function(){function W(V,da){this._renderManager=V;this._viewingMode=da;this._objects=[new l,new l];this._renderSubmit=new p.RenderSubmitSystem(this);this._renderManager.register(this._renderSubmit);
this._componentBufferManager=new L.BufferManager(V.rctx,2)}var R=W.prototype;R.dispose=function(){G.assert(0===this._objects[u.State.Hidden].length&&0===this._objects[u.State.Visible].length,"ObjectCollection should be empty upon disposal");this._componentBufferManager.destroy()};R.createObject=function(V){const da=new u.ComponentObject;da.toMapSpace=V.toMapSpace;da.transform=V.transform;da.obb=t.clone(V.obb);da.components=new q(this._componentBufferManager,V.geometry.componentOffsets);da.renderable=
this._createRenderable(V,da.components);da.intersectionGeometry=new C(V.geometry.positionData,da.components);this._objects[da.visible].push(da);return da};R.destroyObject=function(V){this._objects[V.visible].removeUnordered(V);V.dispose();this._notifyDirty()};R.setObjectVisibility=function(V,da){da!==V.visible&&(this._objects[V.visible].removeUnordered(V),this._objects[da].push(V),V.visible=da,this._notifyDirty())};R.preSubmit=function(V){const da=V.camera.eye;this.visibleObjects.forAll(ca=>ca.renderable.meta.cameraDepthSquared=
g.squaredDistance(da,ca.obb.center))};R.getMaterial=function(V){return V.renderable.material};R.updateMaterial=function(V,da){V=V.renderable.material;da(V);V.dirty&&this._notifyDirty()};R.setAllComponentVisibilities=function(V,da){V.components.visibility.reset(da);V.components.visibilityDirty();this._notifyDirty()};R.forEachVisibleComponent=function(V,da){return V.components.visibility.forEachComponent(da)};R.getComponentCount=function(V){const da=V.components.visibility.componentCount();return{visible:da,
invisible:V.components.count-da}};R.setComponentData=function(V,da){const ca=V.renderable.material,ha=V.components;var ia=ha.materialDataBuffer;const ka=ha.materialDataIndices,la={castShadows:!0,pickable:!0,externalColor:f.create(),externalColorMixMode:w.ColorMixModeEnum.Multiply,elevationOffset:0};ia=ia.textureBuffer;const Y=new Uint8Array(4),ea=new Uint32Array(Y.buffer);let ba=0,Z=0,fa=0,ja=ha.verticalOffsets,oa=Infinity,sa=-Infinity,qa=!1,Ha=!1,Ga=0;for(let pa=0;pa<ha.count;pa++)da(pa,la),ba+=
+(1>la.externalColor[3]),Z+=+(la.externalColorMixMode===w.ColorMixModeEnum.Replace&&1===la.externalColor[3]),fa+=+la.castShadows,w.encodeSymbolColor(la.externalColor,la.externalColorMixMode,Y),Y[2]=Y[2]&254|+la.castShadows,ia.setData(ka[pa],0,Y[0],Y[1],Y[2],Y[3]),qa||(qa=0<pa&&Ga!==ea[0]),Ga=ea[0],Ha||(Ha=0!==la.elevationOffset),Ha&&m.isNone(ja)&&(ja=Array(pa).fill(0)),m.isSome(ja)&&(ja[pa]=la.elevationOffset),oa=Math.min(oa,la.elevationOffset),sa=Math.max(sa,la.elevationOffset),E.encodeElevationOffset(la.elevationOffset,
Y),ia.setData(ka[pa],1,Y[0],Y[1],Y[2],Y[3]),la.pickable!==F.getVisibility(ha.pickability,pa)&&(ha.pickability=F.updateVisibilityWithCount(ha.pickability,ha.count,pa,la.pickable));ha.verticalOffsets=Ha?ja:null;V.offsetObb=Ha?v.computeOffsetObb(V.obb,oa,sa,this._viewingMode,m.isSome(V.offsetObb)?V.offsetObb:t.clone(V.obb)):null;qa||Ha?(ca.componentParameters=new D.ComponentParametersVarying,ca.componentParameters.castShadows=O(fa,ha.count),ca.componentParameters.transparent=O(ba,ha.count),ca.componentParameters.opaqueOverride=
O(Z,ha.count),ca.componentParameters.texture=ia,ia.updateTexture()):(ca.componentParameters=new D.ComponentParametersUniform,ca.componentParameters.castShadows=la.castShadows?D.ComponentParameterSummary.All:D.ComponentParameterSummary.None,ca.componentParameters.externalColor=la.externalColor,ca.componentParameters.externalColorMixMode=la.externalColorMixMode);this._notifyDirty()};R.getComponentAabb=function(V,da,ca,ha=!1){V.intersectionGeometry.getComponentAabb(da,ca);const ia=V.components.verticalOffsets;
if(ha||m.isNone(ia))return ca;da=ia[da];if(this._viewingMode===h.ViewingMode.Local||0===da)return ca[2]+=da,ca[5]+=da,ca;da=m.unwrap(K.getVerticalOffsetI3S(da));da.localOrigin=V.transform.position;return da.applyToAabb(ca)};R.getComponentObb=function(V){return V.obb};R.getObjectTransform=function(V){return V.transform};R.getComponentPositions=function(V,da,ca){return V.intersectionGeometry.getComponentPositions(da,ca)};R.intersect=function(V,da,ca,ha,ia,ka){m.isSome(ia)&&(ia.localOrigin=V.transform.position);
const la=r.invert(T,V.transform.rotationScale);g.sub(U,da,V.transform.position);g.sub(aa,ca,V.transform.position);g.transformMat3(U,U,la);g.transformMat3(aa,aa,la);da=r.transpose(T,la);return V.intersectionGeometry.intersect(U,aa,ha,da,ia,V.components.verticalOffsets,ka)};R.addEdges=function(V,da,ca,ha){const {indices:ia,positions:ka}=V.intersectionGeometry,la=V.components.offsets;return da.addComponentObject(V,V.transform,{center:V.obb.center,radius:t.radius(V.obb)},ka,ia,la,ca,ha)};R.extractEdgeInformation=
function(){var V=b._asyncToGenerator(function*(da,ca,ha){var ia=da.components.visibility;if(ia.allInvisible())return{buffer:M.extractComponentsEdgeLocationsLayout.createBuffer(0),origin:[0,0,0]};const {indices:ka,positions:la}=da.intersectionGeometry,Y=da.components.offsets,ea=N.EdgeInputBufferLayout.createBuffer(la.count);e.copy(ea.position,la);d.transformMat3(ea.position,ea.position,da.transform.rotationScale);this._setComponentIndices(ea.componentIndex,ka,Y);ia=this._computeVisibilityIndices(ka,
ia,Y,ea.count);da=k.clone(da.transform.position);ca=yield ca.extractComponentsEdgeLocations({indices:ia,indicesLength:ia.length,skipDeduplicate:!0,data:ea,writerSettings:{reducedPrecision:!1,variants:0}},ha);return{origin:da,buffer:ca}});return function(da,ca,ha){return V.apply(this,arguments)}}();R._setComponentIndices=function(V,da,ca){let ha=0;for(let ka=0;ka<ca.length-1;ka++){var ia=ca[ka];const la=ca[ka+1];for(;ia<la;ia++)V.set(da?da[ia]:ia,ha);ha++}};R._computeVisibilityIndices=function(V,da,
ca,ha){if(V&&da.allVisible())return V;let ia=0;da.forEachComponentRange((Y,ea)=>{ia+=ca[ea]-ca[Y];return!0});const ka=2===(null==V?void 0:V.BYTES_PER_ELEMENT)||65536>=ha?new Uint16Array(ia):new Uint32Array(ia);let la=0;da.forEachComponentRange((Y,ea)=>{Y=ca[Y];for(ea=ca[ea];Y<ea;Y++)ka[la++]=V?V[Y]:Y;return!0});return ka};R.addComponentHighlight=function(V,da){V=V.components;m.isNone(V.highlightCounts)&&(V.highlightCounts=new Uint32Array(V.count+1));0===V.highlightCounts[da]++&&(V.highlightsDirty(),
this._notifyDirty());V.highlightCounts[V.count]++};R.removeComponentHighlight=function(V,da){V=V.components;if(m.isNone(V.highlightCounts))Q.warn("Removing non-existing highlight.");else{var ca=V.highlightCounts[da],ha=V.highlightCounts[V.count];0===ca?Q.warn("Removing non-existing highlight."):1<ca?(V.highlightCounts[da]=ca-1,V.highlightCounts[V.count]=ha-1):(V.highlightCounts[da]=0,V.highlightsDirty(),this._notifyDirty(),1===ha?V.highlightCounts=null:V.highlightCounts[V.count]=ha-1)}};R.clearHighlights=
function(V){V=V.components;m.isSome(V.highlightCounts)&&(V.highlightCounts=null,V.highlightsDirty(),this._notifyDirty())};R.getObjectGPUMemoryUsage=function(V){return V.renderable.meta.gpuMemoryEstimate};R._createRenderable=function(V,da){const ca=this._renderManager.rctx,ha=V.geometry;var ia=ha.vertices.layoutParameters,ka=J.BufferObject.createVertex(ca,H.Usage.STATIC_DRAW,ha.vertices.data);const la=m.applySome(ha.indices,Z=>J.BufferObject.createIndex(ca,H.Usage.STATIC_DRAW,Z));var Y=x.glLayout(y.createVertexBufferLayout(ia));
const ea=new Uint16Array(ha.vertices.count);for(let Z=0;Z<da.count;Z++){var ba=da.offsets[Z];const fa=da.offsets[Z+1],ja=da.materialDataIndices[Z];if(m.isSome(ha.indices))for(;ba<fa;ba++)ea[ha.indices[ba]]=ja;else for(;ba<fa;ba++)ea[ba]=ja}da=J.BufferObject.createVertex(ca,H.Usage.STATIC_DRAW,ea.buffer);V=new D.ComponentMaterial(V.transform,V.toMapSpace);Y=new I.VertexArrayObject(ca,V.attributeLocations,{data:Y,componentIndices:S},{data:ka,componentIndices:da},m.unwrap(la));ia=new A.RenderGeometry(Y,
H.PrimitiveType.TRIANGLES,ia,m.isSome(la));ka={cameraDepthSquared:.5,gpuMemoryEstimate:ka.byteSize+da.byteSize+(m.isSome(la)?la.byteSize:0)};return new z.Renderable(V,ia,ka)};R._notifyDirty=function(){this._renderManager.notifyDirty()};b._createClass(W,[{key:"visibleObjects",get:function(){return this._objects[u.State.Visible]}}]);return W}();const S=x.glLayout(B.newLayout().u16(P.VertexAttribute.COMPONENTINDEX)),T=n.create(),U=k.create(),aa=k.create();a.ComponentObjectCollection=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SUtil":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../request ../../../../core/arrayUtils ../../../../core/Error ../../../../core/has ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf32 ../../../../chunks/quatf64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/SpatialReference ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../rest/support/Query ../../../ViewingMode ./I3SBinaryReader ./I3SProjectionUtil ../support/edgeUtils ../support/symbolColorUtils ../../support/orientedBoundingBox".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K){function N(wa){return wa&&parseInt(wa.substring(wa.lastIndexOf("/")+1,wa.length),10)}function M(wa,Ja){var Ta=Ja[0],Xa=Ja[1];Ja=Ja[3];const ma=wa[0]-Ta;Ta-=wa[2];const $a=wa[1]-Xa;wa=Xa-wa[3];Xa=Math.max(ma,Ta,0);const xa=Math.max($a,wa,0);Xa=Xa*Xa+xa*xa;return Xa>Ja*Ja?a.MbsIntersectResult.OUTSIDE:0<Xa?a.MbsIntersectResult.INTERSECTS_CENTER_OUTSIDE:-Math.max(ma,Ta,$a,wa)>Ja?a.MbsIntersectResult.INSIDE:a.MbsIntersectResult.INTERSECTS_CENTER_INSIDE}
function L(wa,Ja,Ta){const Xa=[],ma=Ta&&Ta.missingFields;Ta=Ta&&Ta.originalFields;for(const $a of wa){wa=$a.toLowerCase();let xa=!1;for(const Ka of Ja)if(wa===Ka.name.toLowerCase()){Xa.push(Ka.name);xa=!0;Ta&&Ta.push($a);break}!xa&&ma&&ma.push($a)}return Xa}function J(){J=b._asyncToGenerator(function*(wa,Ja,Ta,Xa,ma){if(0===Ja.length)return[];const $a=wa.attributeStorageInfo;if(n.isSome(wa.associatedLayer))try{return yield I(wa.associatedLayer,Ja,Ta,Xa)}catch(xa){if(wa.associatedLayer.loaded)throw xa;
}if($a){Ja=H(Ja,Ta,ma);if(n.isNone(Ja))throw new l("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const xa=wa.parsedUrl.path;wa=yield Promise.all(Ja.map(Ka=>S(xa,$a,Ka.node,Ka.indices,Xa).then(Oa=>{for(let Va=0;Va<Ka.graphics.length;Va++){const Ra=Ka.graphics[Va],za=Oa[Va];if(Ra.attributes)for(const ya in Ra.attributes)ya in za||(za[ya]=Ra.attributes[ya]);Ra.attributes=za}return Ka.graphics})));return m.flatten(wa)}throw new l("scenelayer:no-attribute-source",
"This scene layer does not have a source for attributes available");});return J.apply(this,arguments)}function H(wa,Ja,Ta){const Xa=new Map,ma=[];Ta=Ta();for(const Ka of wa){var $a=Ka.attributes[Ja];for(var xa=0;xa<Ta.length;xa++){wa=Ta[xa];const Oa=wa.featureIds.indexOf($a);if(0<=Oa){$a=Xa.get(wa.node);$a||($a={node:wa.node,indices:[],graphics:[]},ma.push($a),Xa.set(wa.node,$a));$a.indices.push(Oa);for($a.graphics.push(Ka);0<xa;xa--)Ta[xa]=Ta[xa-1];Ta[0]=wa;break}}}return ma}function I(wa,Ja,Ta,
Xa){return O.apply(this,arguments)}function O(){O=b._asyncToGenerator(function*(wa,Ja,Ta,Xa){Ja.sort((xa,Ka)=>xa.attributes[Ta]-Ka.attributes[Ta]);var ma=Ja.map(xa=>xa.attributes[Ta]);const $a=[];Xa=L(Xa,wa.fields,{originalFields:$a});wa=yield Q(wa,ma,Xa);for(ma=0;ma<Ja.length;ma++){const xa=Ja[ma],Ka=wa[ma],Oa={};if(xa.attributes)for(const Va in xa.attributes)Oa[Va]=xa.attributes[Va];for(let Va=0;Va<$a.length;Va++)Oa[$a[Va]]=Ka[Xa[Va]];xa.attributes=Oa}return Ja});return O.apply(this,arguments)}
function Q(wa,Ja,Ta){var Xa=wa.capabilities.query.maxRecordCount;if(null!=Xa&&Ja.length>Xa)return Xa=m.splitIntoChunks(Ja,Xa),Promise.all(Xa.map(ma=>Q(wa,ma,Ta))).then(m.flatten);Xa=new y({objectIds:Ja,outFields:Ta,orderByFields:[wa.objectIdField]});return wa.queryFeatures(Xa).then(ma=>{if(ma&&ma.features&&ma.features.length===Ja.length)return ma.features.map($a=>$a.attributes);throw new l("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer");})}function S(wa,
Ja,Ta,Xa,ma){const $a=[];for(const xa of Ja)xa&&ma.includes(xa.name)&&$a.push({url:`${wa}/nodes/${Ta.resources.attributes}/attributes/${xa.key}/0`,storageInfo:xa});return g.eachAlways($a.map(xa=>c(xa.url,{responseType:"array-buffer"}).then(Ka=>E.readBinaryAttribute(xa.storageInfo,Ka.data)))).then(xa=>{const Ka=[];for(const Oa of Xa){const Va={};for(let Ra=0;Ra<xa.length;Ra++)null!=xa[Ra].value&&(Va[$a[Ra].storageInfo.name]=T(xa[Ra].value,Oa));Ka.push(Va)}return Ka})}function T(wa,Ja){if(!wa)return null;
Ja=wa[Ja];return k.isInt16Array(wa)?-32768===Ja?null:Ja:k.isInt32Array(wa)?Ja===ka?null:Ja:Ja!==Ja?null:Ja}function U(wa){var Ja=wa.store.indexCRS||wa.store.geographicCRS;const Ta=void 0===Ja?wa.store.indexWKT:void 0;if(Ta)if(wa.spatialReference){if(Ta!==wa.spatialReference.wkt)throw new l("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{});}else throw new l("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference",
"Found indeWKT in the scene layer store but no layer spatial reference",{});Ja=Ja?new z(N(Ja)):wa.spatialReference;return Ja.equals(wa.spatialReference)?wa.spatialReference:Ja}function aa(wa){var Ja=wa.store.vertexCRS||wa.store.projectedCRS;const Ta=void 0===Ja?wa.store.vertexWKT:void 0;if(Ta)if(wa.spatialReference){if(Ta!==wa.spatialReference.wkt)throw new l("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",
{});}else throw new l("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});Ja=Ja?new z(N(Ja)):wa.spatialReference;return Ja.equals(wa.spatialReference)?wa.spatialReference:Ja}function W(wa,Ja,Ta){if(!u.canProjectWithoutEngine(wa,Ja))throw new l("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===
Ta&&!R(wa,Ja))throw new l("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});}function R(wa,Ja){return wa.equals(Ja)||wa.isWGS84&&Ja.isWebMercator||wa.isWebMercator&&Ja.isWGS84}function V(wa,Ja,Ta){const Xa=U(wa);wa=aa(wa);W(Xa,Ja,Ta);W(wa,Ja,Ta)}function da(wa,Ja,Ta,Xa,ma=0){if(Xa===C.getSphericalPCPF(Xa))if(Ja.isGeographic){var $a=C.getReferenceEllipsoid(Ja);Xa=1+Math.max(0,ma)/($a.radius+wa.center[2]);
x.set(Ta.center,wa.center[0],wa.center[1],wa.center[2]+ma);u.projectBuffer(Ta.center,Ja,0,Ta.center,C.getSphericalPCPF(Ja),0,1);v.copy(Ta.quaternion,wa.quaternion);v.conjugate(Ga,wa.quaternion);x.set(Ia,0,0,1);x.transformQuat(Ia,Ia,Ga);x.set(Ia,wa.halfSize[0]*Math.abs(Ia[0]),wa.halfSize[1]*Math.abs(Ia[1]),wa.halfSize[2]*Math.abs(Ia[2]));x.scale(Ia,Ia,$a.inverseFlattening);x.add(Ta.halfSize,wa.halfSize,Ia);x.scale(Ta.halfSize,Ta.halfSize,Xa)}else{{K.corners(wa,pa);x.set(Ta.center,wa.center[0],wa.center[1],
wa.center[2]+ma);u.computeTranslationToOriginAndRotation(Ja,Ta.center,Ha,C.getSphericalPCPF(Ja));x.set(Ta.center,Ha[12],Ha[13],Ha[14]);Xa=2*Math.sqrt(1+Ha[0]+Ha[5]+Ha[10]);Ga[0]=(Ha[6]-Ha[9])/Xa;Ga[1]=(Ha[8]-Ha[2])/Xa;Ga[2]=(Ha[1]-Ha[4])/Xa;Ga[3]=.25*Xa;v.multiply(Ta.quaternion,Ga,wa.quaternion);v.conjugate(Ga,Ta.quaternion);let xa=Xa=wa=0;for($a of pa)$a[2]+=ma,u.projectBuffer($a,Ja,0,$a,C.getSphericalPCPF(Ja),0,1),x.sub(Ia,$a,Ta.center),x.transformQuat(Ia,Ia,Ga),wa=Math.max(wa,Math.abs(Ia[0])),
Xa=Math.max(Xa,Math.abs(Ia[1])),xa=Math.max(xa,Math.abs(Ia[2]));x.set(Ta.halfSize,wa,Xa,xa)}}else Ja.isWGS84&&(Xa.isWebMercator||p.isPlateCarree(Xa))?(x.copy(sa,wa.center),sa[2]+=ma,ma=C.getSphericalPCPF(Xa),u.projectBuffer(sa,Ja,0,sa,ma,0,1),ca(ma,wa,sa,Xa,Ta)):Ja.isWebMercator&&p.isPlateCarree(Xa)?(x.copy(sa,wa.center),sa[2]+=ma,ca(Ja,wa,sa,Xa,Ta)):wa===Ta?(Ta.center[2]+=ma,u.projectBuffer(Ta.center,Ja,0,Ta.center,Xa,0,1)):(x.set(Ta.center,wa.center[0],wa.center[1],wa.center[2]+ma),u.projectBuffer(Ta.center,
Ja,0,Ta.center,Xa,0,1),v.copy(Ta.quaternion,wa.quaternion),x.copy(Ta.halfSize,wa.halfSize))}function ca(wa,Ja,Ta,Xa,ma){const $a=f.fromQuat(qa,Ja.quaternion);for(let Ka=0;8>Ka;++Ka){for(var xa=0;3>xa;++xa)oa[xa]=Ja.halfSize[xa]*(0!==(Ka&1<<xa)?-1:1);for(xa=0;3>xa;++xa){let Oa=Ta[xa];for(let Va=0;3>Va;++Va)Oa+=oa[Va]*$a[3*Va+xa];fa[3*Ka+xa]=Oa}}u.projectBuffer(fa,wa,0,fa,Xa,0,8);K.compute(ja,ma)}const ha=A.create(),ia=q.create();a.MbsIntersectResult=void 0;(function(wa){wa[wa.OUTSIDE=0]="OUTSIDE";
wa[wa.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE";wa[wa.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE";wa[wa.INSIDE=3]="INSIDE"})(a.MbsIntersectResult||(a.MbsIntersectResult={}));const ka=-(2**31);q=G.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0});let la=function(){this.material=this.edgeMaterial=null;this.castShadows=!0};const Y=B.create(),ea=B.create(),ba=B.create(),Z=t.create(),fa=new Float64Array(24),ja={data:fa,size:3},oa=B.create(),sa=B.create(),qa=d.create(),Ha=h.create(),
Ga=w.create(),pa=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],Da=A.create(),ra=A.create(),Ea=K.create(),Ia=[0,0,0],Ma={data:Array(72),size:3},Qa=h.create();a.SymbolInfo=la;a.addWraparound=function(wa,Ja){return(wa|0)+(Ja|0)|0};a.checkPointCloudLayerCompatibleWithView=function(wa,Ja){W(wa.spatialReference,Ja.spatialReference,Ja.viewingMode)};a.checkPointCloudLayerValid=function(wa){var Ja;(Ja=null==wa.store||null==wa.store.defaultGeometrySchema)||(wa=wa.store.defaultGeometrySchema,
Ja=!!(null==wa.geometryType||"points"!==wa.geometryType||null!=wa.topology&&"PerAttributeArray"!==wa.topology||null!=wa.encoding&&""!==wa.encoding&&"lepcc-xyz"!==wa.encoding||null==wa.vertexAttributes||null==wa.vertexAttributes.position));if(Ja)throw new l("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{});};a.checkSceneLayerCompatibleWithView=function(wa,Ja){V(wa,Ja.spatialReference,Ja.viewingMode)};a.checkSceneLayerValid=function(wa){var Ja;
(Ja=null==wa.store||null==wa.store.defaultGeometrySchema)||(Ja=wa.store.defaultGeometrySchema,Ja=!!(null!=Ja.geometryType&&"triangles"!==Ja.geometryType||null!=Ja.topology&&"PerAttributeArray"!==Ja.topology||null==Ja.vertexAttributes||null==Ja.vertexAttributes.position));if(Ja)throw new l("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:wa.parsedUrl.path});};a.checkSpatialReference=W;a.checkSpatialReferences=V;a.computeOffsetObb=function(wa,
Ja,Ta,Xa,ma){v.copy(ma.quaternion,wa.quaternion);if(Xa===D.ViewingMode.Global){v.conjugate(Z,wa.quaternion);x.transformQuat(Y,wa.center,Z);x.abs(ea,Y);x.min(ba,ea,wa.halfSize);x.sub(ba,ea,ba);Xa=x.length(ba);x.add(ba,ea,wa.halfSize);const $a=x.length(ba);Xa<Ta?(x.copy(ma.center,wa.center),x.set(Y,Ta,Ta,Ta),x.add(ma.halfSize,wa.halfSize,Y)):(Ja=0<$a?1+Ja/$a:1,Xa=0<Xa?1+Ta/Xa:1,Ta=(Xa+Ja)/2,Ja=(Xa-Ja)/2,x.scale(ma.halfSize,ea,Ja),x.scaleAndAdd(ma.halfSize,ma.halfSize,wa.halfSize,Ta),x.scale(ma.center,
ea,Ta),x.scaleAndAdd(ma.center,ma.center,wa.halfSize,Ja),x.sign(Y,Y),x.multiply(ma.center,ma.center,Y),x.transformQuat(ma.center,ma.center,ma.quaternion))}else Xa=x.set(Y,0,0,1),x.scaleAndAdd(ma.center,wa.center,Xa,(Ta+Ja)/2),v.conjugate(Z,wa.quaternion),x.transformQuat(Xa,Xa,Z),x.abs(Xa,Xa),x.scaleAndAdd(ma.halfSize,wa.halfSize,Xa,(Ta-Ja)/2);return ma};a.computeVisibilityObb=function(wa,Ja,Ta,Xa,ma,$a){if(!$a||0===$a.length||n.isNone(Ja))return null;const xa=F.computeGlobalTransformation(wa.mbs,
ma,Ta,Ja);e.invert(Qa,xa);let Ka;const Oa=()=>{if(!Ka)if(Ka=pa,A.empty(ra),n.isSome(wa.serviceObb)){da(wa.serviceObb,Ta,Ea,Ja,ma);K.corners(Ea,Ka);for(var ya of Ka)x.transformMat4(ya,ya,Qa),A.expandPointInPlace(ra,ya)}else{var Na=wa.mbs;ya=Na[3];u.projectVectorToVector(Na,Ta,Ia,Ja);x.transformMat4(Ia,Ia,Qa);Ia[2]+=ma;for(Na=0;8>Na;++Na){const Wa=Ka[Na];x.copy(Wa,[Ia[0]+(Na&1?ya:-ya),Ia[1]+(Na&2?ya:-ya),Ia[2]+(Na&4?ya:-ya)]);A.expandPointInPlace(ra,Wa)}}};let Va=Infinity,Ra=-Infinity;const za=ya=>
{if("replace"===ya.type&&(ya=ya.geometry,ya.hasZ)){A.empty(Da);var Na=ya.spatialReference||Xa;ya=ya.rings.reduce((Wa,bb)=>bb.reduce((Aa,Pa)=>{u.projectVectorToVector(Pa,Na,Ia,Ja);x.transformMat4(Ia,Ia,Qa);A.expandPointInPlace(Da,Ia);return Math.min(Ia[2],Aa)},Wa),Infinity);Oa();A.intersects(ra,Da)&&(Va=Math.min(Va,ya),Ra=Math.max(Ra,ya))}};$a.forEach(ya=>za(ya));if(Infinity===Va)return null;$a=(ya,Na,Wa)=>{x.transformMat4(Ia,Wa,xa);ya[Na+0]=Ia[0];ya[Na+1]=Ia[1];ya[Na+2]=Ia[2];Na+=24;Wa[2]=Va;x.transformMat4(Ia,
Wa,xa);ya[Na+0]=Ia[0];ya[Na+1]=Ia[1];ya[Na+2]=Ia[2];Na+=24;Wa[2]=Ra;x.transformMat4(Ia,Wa,xa);ya[Na+0]=Ia[0];ya[Na+1]=Ia[1];ya[Na+2]=Ia[2]};for(let ya=0;8>ya;++ya)$a(Ma.data,3*ya,Ka[ya]);return K.compute(Ma)};a.containsDraco=function(wa){if(r("disable-feature:i3s-draco")||!wa)return!1;for(const Ta of wa)for(const Xa of Ta.geometryBuffers){var Ja;if("draco"===(null==(Ja=Xa.compressedAttributes)?void 0:Ja.encoding))return!0}return!1};a.extractWkid=N;a.filterInPlace=function(wa,Ja,Ta){let Xa=0,ma=0;
for(let $a=0;$a<Ja.length&&Xa<wa.length;$a++)wa[Xa]===Ja[$a]&&(Ta($a)&&(wa[ma]=wa[Xa],ma++),Xa++);wa.length=ma};a.findFieldsCaseInsensitive=L;a.findIntersectingNodes=function(wa,Ja,Ta,Xa,ma,$a){const xa=Ja!==Xa;ma.traverse(Ta,Ka=>{let Oa=Ka.mbs;xa&&(Oa=ia,u.projectBoundingSphere(Ka.mbs,Xa,Oa,Ja));if(M(wa,Oa)===a.MbsIntersectResult.OUTSIDE)return!1;$a(Ka);return!0})};a.getCacheKeySuffix=function(wa,Ja){return n.isNone(Ja)?"@null":Ja===C.getSphericalPCPF(Ja)?"@ECEF":wa.equals(Ja)?"":null!=Ja.wkid?"@"+
Ja.wkid:null};a.getCachedAttributeValue=T;a.getClipRect=function(wa,Ja){if(0===Ja.rotationScale[1]&&0===Ja.rotationScale[2]&&0===Ja.rotationScale[3]&&0===Ja.rotationScale[5]&&0===Ja.rotationScale[6]&&0===Ja.rotationScale[7])return ha[0]=(wa[0]-Ja.position[0])/Ja.rotationScale[0],ha[1]=(wa[1]-Ja.position[1])/Ja.rotationScale[4],ha[2]=(wa[2]-Ja.position[0])/Ja.rotationScale[0],ha[3]=(wa[3]-Ja.position[1])/Ja.rotationScale[4],ha};a.getIndexCrs=U;a.getSymbolInfo=function(wa){const Ja=new la;var Ta=!1;
let Xa=!1;for(const $a of wa.symbolLayers.items)if("fill"===$a.type&&$a.enabled){var ma=$a.material;wa=$a.edges;n.isSome(ma)&&!Ta&&(Ta=ma.color,ma=P.parseColorMixMode(ma.colorMixMode),n.isSome(Ta)?Ja.material={color:[Ta.r/255,Ta.g/255,Ta.b/255],alpha:Ta.a,colorMixMode:ma}:Ja.material={color:[1,1,1],alpha:1,colorMixMode:P.ColorMixModeEnum.Multiply},Ja.castShadows=$a.castShadows,Ta=!0);n.isSome(wa)&&!Xa&&(Ja.edgeMaterial=G.createMaterialFromEdges(wa,{}),Xa=!0)}Ja.material||(Ja.material={color:[1,1,
1],alpha:1,colorMixMode:P.ColorMixModeEnum.Multiply});return Ja};a.getVertexCrs=aa;a.intersectBoundingBoxWithMbs=function(wa,Ja){var Ta=Ja[0],Xa=Ja[1],ma=Ja[2];Ja=Ja[3];const $a=wa[0]-Ta;Ta-=wa[3];const xa=wa[1]-Xa;Xa-=wa[4];const Ka=wa[2]-ma;wa=ma-wa[5];ma=Math.max($a,Ta,0);const Oa=Math.max(xa,Xa,0),Va=Math.max(Ka,wa,0);ma=ma*ma+Oa*Oa+Va*Va;return ma>Ja*Ja?a.MbsIntersectResult.OUTSIDE:0<ma?a.MbsIntersectResult.INTERSECTS_CENTER_OUTSIDE:-Math.max($a,Ta,xa,Xa,Ka,wa)>Ja?a.MbsIntersectResult.INSIDE:
a.MbsIntersectResult.INTERSECTS_CENTER_INSIDE};a.intersectBoundingRectWithMbs=M;a.invalidateMbs=function(wa){n.isSome(wa)&&(wa[3]=-1)};a.invalidateObb=function(wa){n.isSome(wa)&&(wa.halfSize[0]=-1)};a.isSupportedLocalModeProjection=R;a.isValidMbs=function(wa){return 0<=wa[3]};a.isValidObb=function(wa){return n.isSome(wa)&&0<=wa.halfSize[0]};a.objectIdFilter=function(wa,Ja,Ta){let Xa=0,ma=0;for(;Xa<Ta.length;)0<=m.binaryIndexOf(wa,Ta[Xa])===Ja&&(Ta[ma]=Ta[Xa],ma++),Xa++;Ta.length=ma};a.rendererNeedsTextures=
function(wa){if(null==wa||"simple"!==wa.type&&"class-breaks"!==wa.type&&"unique-value"!==wa.type||("unique-value"===wa.type||"class-breaks"===wa.type)&&null==wa.defaultSymbol)return!0;wa=wa.getSymbols();if(0===wa.length)return!0;for(const Ja of wa){if("mesh-3d"!==Ja.type||0===Ja.symbolLayers.length)return!0;for(const Ta of Ja.symbolLayers.items)if("fill"!==Ta.type||n.isNone(Ta.material)||n.isNone(Ta.material.color)||"replace"!==Ta.material.colorMixMode)return!0}return!1};a.transformObb=da;a.transparentEdgeMaterial=
q;a.whenGraphicAttributes=function(wa,Ja,Ta,Xa,ma){return J.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/quatf32":function(){define(["exports"],function(a){function b(){const n=new Float32Array(4);n[3]=1;return n}function c(n){const g=new Float32Array(4);g[0]=n[0];g[1]=n[1];g[2]=n[2];g[3]=n[3];return g}function m(n,g,k,f){const d=new Float32Array(4);d[0]=n;d[1]=g;d[2]=k;d[3]=f;return d}function l(n,g){return new Float32Array(n,
g,4)}const r=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:m,createView:l},Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;a.createView=l;a.fromValues=m;a.quatf32=r})},"esri/views/3d/layers/i3s/I3SBinaryReader":function(){define("exports ../../../../core/Error ../../../../core/lang ../../../../core/Logger ./LEPCC ../../webgl-engine/lib/VertexAttribute".split(" "),function(a,b,c,m,l,r){function n(A,p,y){let D="",E=0;for(;E<y;){var F=A[p+E];if(128>F)D+=String.fromCharCode(F),
E++;else if(192<=F&&224>F){if(E+1>=y)throw new b("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");D+=String.fromCharCode((F&31)<<6|A[p+E+1]&63);E+=2}else if(224<=F&&240>F){if(E+2>=y)throw new b("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");D+=String.fromCharCode((F&15)<<12|(A[p+E+1]&63)<<6|A[p+E+2]&63);E+=3}else if(240<=F&&248>F){if(E+3>=y)throw new b("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");F=(F&
7)<<18|(A[p+E+1]&63)<<12|(A[p+E+2]&63)<<6|A[p+E+3]&63;D=65536<=F?D+String.fromCharCode((F-65536>>10)+55296,(F&1023)+56320):D+String.fromCharCode(F);E+=4}else throw new b("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");}return D}function g(A,p){const y={byteOffset:0,byteCount:0,fields:Object.create(null)};let D=0;for(let E=0;E<p.length;E++){const F=p[E],G=F.valueType||F.type;y.fields[F.property]=(0,z[G])(A,D);D+=C[G].BYTES_PER_ELEMENT}y.byteCount=D;return y}function k(A,p,
y){const D=[];let E,F=0,G;for(G=0;G<A;G+=1){E=p[G];if(0<E){if(D.push(n(y,F,E-1)),0!==y[F+E-1])throw new b("string-array-error","Invalid string array: missing null termination.");}else D.push(null);F+=E}return D}function f(A,p){return new C[p.valueType](A,p.byteOffset,p.count*p.valuesPerElement)}function d(A,p){return new Uint8Array(A,p.byteOffset,p.byteCount)}function e(A,p,y){A=null!=p.header?g(A,p.header):{byteOffset:0,byteCount:0,fields:{count:y}};y={header:A,byteOffset:A.byteCount,byteCount:0,
entries:Object.create(null)};let D=A.byteCount;for(let E=0;E<p.ordering.length;E++){const F=p.ordering[E],G=c.clone(p[F]);G.count=A.fields.count;if("String"===G.valueType){if(G.byteOffset=D,G.byteCount=A.fields[F+"ByteCount"],"UTF-8"!==G.encoding)throw new b("unsupported-encoding","Unsupported String encoding.",{encoding:G.encoding});}else if(x(G.valueType)){const P=B(G.valueType);D+=0!==D%P?P-D%P:0;G.byteOffset=D;G.byteCount=P*G.valuesPerElement*G.count}else throw new b("unsupported-value-type",
"Unsupported binary valueType",{valueType:G.valueType});D+=G.byteCount;y.entries[F]=G}y.byteCount=D-y.byteOffset;return y}function h(A,p,y){p!==A&&q.error(`Invalid ${y} buffer size\n expected: ${A}, actual: ${p})`);if(p<A)throw new b("buffer-too-small","Binary buffer is too small",{expectedSize:A,actualSize:p});}function v(A){return{isDraco:!1,isLegacy:!1,color:null!=A.color,normal:null!=A.normal,uv0:null!=A.uv0,uvRegion:null!=A.uvRegion,featureIndex:null!=A.faceRange&&null!=A.featureId}}function w(A){const p=
{isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const y of A.ordering)if(A.vertexAttributes[y])switch(y){case "normal":p.normal=!0;break;case "color":p.color=!0;break;case "uv0":p.uv0=!0;break;case "region":p.uvRegion=!0}A.featureAttributes&&A.featureAttributeOrder&&(p.featureIndex=!0);return p}function t(A){const p={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const y of A)switch(y){case "normal":p.normal=!0;break;case "uv0":p.uv0=
!0;break;case "color":p.color=!0;break;case "uv-region":p.uvRegion=!0;break;case "feature-index":p.featureIndex=!0}return p}function x(A){return C.hasOwnProperty(A)}function B(A){return x(A)?C[A].BYTES_PER_ELEMENT:0}const q=m.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader"),u={position:r.VertexAttribute.POSITION,normal:r.VertexAttribute.NORMAL,color:r.VertexAttribute.COLOR,uv0:r.VertexAttribute.UV0,region:r.VertexAttribute.UVREGION},C={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,
Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},z={Float32:(A,p)=>(new DataView(A,0)).getFloat32(p,!0),Float64:(A,p)=>(new DataView(A,0)).getFloat64(p,!0),UInt8:(A,p)=>(new DataView(A,0)).getUint8(p),Int8:(A,p)=>(new DataView(A,0)).getInt8(p),UInt16:(A,p)=>(new DataView(A,0)).getUint16(p,!0),Int16:(A,p)=>(new DataView(A,0)).getInt16(p,!0),UInt32:(A,p)=>(new DataView(A,0)).getUint32(p,!0),Int32:(A,p)=>(new DataView(A,0)).getInt32(p,!0)};a.createAttributeDataIndex=
e;a.createGeometryDescriptor=function(A,p){return A&&A.compressedAttributes&&"draco"===A.compressedAttributes.encoding?t(A.compressedAttributes.attributes):A?v(A):w(p)};a.createGeometryDescriptorForDraco=t;a.createGeometryDescriptorFromDefinition=v;a.createGeometryDescriptorFromSchema=w;a.createGeometryIndexFromSchema=function(A,p){var y=g(A,p&&p.header);let D=y.byteCount;const E={isDraco:!1,header:y,byteOffset:y.byteCount,byteCount:0,vertexAttributes:{}};y=y.fields;var F=null!=y.vertexCount?y.vertexCount:
y.count;for(var G of p.ordering){if(!p.vertexAttributes[G])continue;const K={...p.vertexAttributes[G],byteOffset:D,count:F};E.vertexAttributes[u[G]?u[G]:"_"+G]=K;D+=B(K.valueType)*K.valuesPerElement*F}G=y.faceCount;if(p.faces&&G){E.faces={};for(var P of p.ordering)p.faces[P]&&(F={...p.faces[P],byteOffset:D,count:G},E.faces[P]=F,D+=B(F.valueType)*F.valuesPerElement*G)}P=y.featureCount;if(p.featureAttributes&&p.featureAttributeOrder&&P){E.featureAttributes={};for(const K of p.featureAttributeOrder)p.featureAttributes[K]&&
(y={...p.featureAttributes[K],byteOffset:D,count:P},E.featureAttributes[K]=y,G="UInt64"===y.valueType?8:B(y.valueType),D+=G*y.valuesPerElement*P)}h(D,A.byteLength,"geometry");E.byteCount=D-E.byteOffset;return E};a.createRawView=d;a.createTypedView=f;a.getBytesPerValue=B;a.isValueType=x;a.readBinaryAttribute=function(A,p,y){if("lepcc-rgb"===A.encoding)return l.decodeRGB(p);if("lepcc-intensity"===A.encoding)return l.decodeIntensity(p);if(null!=A.encoding&&""!==A.encoding)throw new b("unknown-attribute-storage-info-encoding",
"Unknown Attribute Storage Info Encoding");A["attributeByteCounts "]&&!A.attributeByteCounts&&(q.warn("Warning: Trailing space in 'attributeByteCounts '."),A.attributeByteCounts=A["attributeByteCounts "]);"ObjectIds"===A.ordering[0]&&A.hasOwnProperty("objectIds")&&(q.warn("Warning: Case error in objectIds"),A.ordering[0]="objectIds");y=e(p,A,y);h(y.byteOffset+y.byteCount,p.byteLength,"attribute");if(A=y.entries.attributeValues||y.entries.objectIds){if("String"===A.valueType){y=y.entries.attributeByteCounts;
const D=f(p,y);p=d(p,A);return k(y.count,D,p)}return f(p,A)}throw new b("bad-attribute-storage-info","Bad attributeStorageInfo specification.");};a.readHeader=g;a.readStringArray=k;a.valueType2ArrayBufferReader=z;a.valueType2TypedArrayClassMap=C;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/LEPCC":function(){define(["exports","../../../../core/Error"],function(a,b){function c(n,g,k){return{identifier:String.fromCharCode.apply(null,
new Uint8Array(n,k+r.identifierOffset,r.identifierLength)),version:g.getUint16(k+r.versionOffset,!0),checksum:g.getUint32(k+r.checksumOffset,!0)}}function m(n,g,k){const f=[];g=l(n,g,f);const d=[];for(let e=0;e<f.length;e++){d.length=0;g=l(n,g,d);for(let h=0;h<d.length;h++)k.push(d[h]+f[e])}return g}function l(n,g,k){var f=new DataView(n,g),d=f.getUint8(0);const e=d&31;var h=!!(d&32),v=(d&192)>>6;d=0;if(0===v)d=f.getUint32(1,!0),g+=5;else if(1===v)d=f.getUint16(1,!0),g+=3;else if(2===v)d=f.getUint8(1),
g+=2;else throw new b("lepcc-decode-error","Bad count type");if(h)throw new b("lepcc-decode-error","LUT not implemented");n=new Uint8Array(n,g,Math.ceil(d*e/8));v=h=f=0;const w=-1>>>32-e;for(let t=0;t<d;t++){for(;h<e;)f|=n[v]<<h,h+=8,v+=1;k[t]=f&w;f>>>=e;h-=e;32<h+e&&(f|=n[v-1]>>8-h)}return g+v}const r={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};a.decodeIntensity=function(n){const g=new DataView(n,0);var k=0;const {identifier:f,version:d}=c(n,g,k);k+=r.byteCount;
if("Intensity "!==f)throw new b("lepcc-decode-error","Bad identifier");if(1<d)throw new b("lepcc-decode-error","Unknown version");var e=k;var h=g.getUint32(e+0,!0);var v=g.getUint32(e+4,!0);var w=g.getUint32(e+8,!0);var t=g.getUint16(e+12,!0);var x=g.getUint8(e+14);g.getUint8(e+15);k+=16;if(v*2**32+h!==n.byteLength)throw new b("lepcc-decode-error","Bad size");h=new Uint16Array(w);if(8===x){if(w+k!==n.byteLength)throw new b("lepcc-decode-error","Bad size");n=new Uint8Array(n,k,w);for(k=0;k<w;k++)h[k]=
n[k]*t}else if(16===x){if(2*w+k!==n.byteLength)throw new b("lepcc-decode-error","Bad size");n=new Uint16Array(n,k,w);for(k=0;k<w;k++)h[k]=n[k]*t}else{x=[];if(l(n,k,x)!==n.byteLength)throw new b("lepcc-decode-error","Bad size");for(n=0;n<w;n++)h[n]=x[n]*t}return h};a.decodeRGB=function(n){var g=new DataView(n,0),k=0;const {identifier:f,version:d}=c(n,g,k);k+=r.byteCount;if("ClusterRGB"!==f)throw new b("lepcc-decode-error","Bad identifier");if(1<d)throw new b("lepcc-decode-error","Unknown version");
var e=k;var h=g.getUint32(e+0,!0);var v=g.getUint32(e+4,!0);var w=g.getUint32(e+8,!0);var t=g.getUint16(e+12,!0);var x=g.getUint8(e+14);e=g.getUint8(e+15);k+=16;if(v*2**32+h!==n.byteLength)throw new b("lepcc-decode-error","Bad size");if((2===x||1===x)&&0===e){if(3*t+w+k!==n.byteLength||256<t)throw new b("lepcc-decode-error","Bad count");g=new Uint8Array(n,k,3*t);k=new Uint8Array(n,k+3*t,w);n=new Uint8Array(3*w);for(t=0;t<w;t++)h=k[t],n[3*t]=g[3*h],n[3*t+1]=g[3*h+1],n[3*t+2]=g[3*h+2];return n}if(0===
x&&0===e){if(3*w+k!==n.byteLength||0!==t)throw new b("lepcc-decode-error","Bad count");return(new Uint8Array(n,k)).slice()}if(2>=x&&1===e){if(k+3!==n.byteLength||1!==t)throw new b("lepcc-decode-error","Bad count");n=g.getUint8(k);t=g.getUint8(k+1);k=g.getUint8(k+2);g=new Uint8Array(3*w);for(h=0;h<w;h++)g[3*h]=n,g[3*h+1]=t,g[3*h+2]=k;return g}throw new b("lepcc-decode-error","Bad method "+x+","+e);};a.decodeXYZ=function(n){var g=new DataView(n,0),k=0;const {identifier:f,version:d}=c(n,g,k);k+=r.byteCount;
if("LEPCC     "!==f)throw new b("lepcc-decode-error","Bad identifier");if(1<d)throw new b("lepcc-decode-error","Unknown version");var e=k;var h=g.getUint32(e+0,!0);var v=g.getUint32(e+4,!0);var w=g.getFloat64(e+8,!0);var t=g.getFloat64(e+16,!0);var x=g.getFloat64(e+24,!0);var B=g.getFloat64(e+32,!0);var q=g.getFloat64(e+40,!0);var u=g.getFloat64(e+48,!0);var C=g.getFloat64(e+56,!0);var z=g.getFloat64(e+64,!0);var A=g.getFloat64(e+72,!0);var p=g.getUint32(e+80,!0);g.getUint32(e+84,!0);k+=88;if(v*2**
32+h!==n.byteLength)throw new b("lepcc-decode-error","Bad size");h=new Float64Array(3*p);v=[];p=[];g=[];e=[];k=m(n,k,v);k=m(n,k,p);k=m(n,k,g);k=m(n,k,e);if(k!==n.byteLength)throw new b("lepcc-decode-error","Bad length");k=n=0;for(let y=0;y<v.length;y++){k+=v[y];let D=0;for(let E=0;E<p[y];E++){D+=g[n];const F=e[n];h[3*n]=Math.min(B,w+2*C*D);h[3*n+1]=Math.min(q,t+2*z*k);h[3*n+2]=Math.min(u,x+2*A*F);n++}}return{errorX:C,errorY:z,errorZ:A,result:h}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/layers/i3s/I3SProjectionUtil":function(){define(["exports","../../../../chunks/mat4f64","../../../../chunks/vec3f64","../../../../geometry/projection","../../../../geometry/projectionEllipsoid"],function(a,b,c,m,l){function r(n,g,k){const f=c.create(),d=2**(4*Math.ceil(Math.log(n[3])*Math.LOG2E/4)+1);if(k.isGeographic){var e=d/l.getReferenceEllipsoid(k).radius*180/Math.PI;k=Math.max(-90,Math.min(90,Math.round(n[1]/e)*e));e/=Math.cos((Math.abs(k)-e/2)/180*Math.PI);f[0]=Math.round(n[0]/
e)*e;f[1]=k}else k=Math.round(n[1]/d),f[0]=Math.round(n[0]/d)*d,f[1]=k*d;f[2]=Math.round((n[2]+g)/d)*d;return f}a.computeGlobalTransformation=function(n,g,k,f){n=r(n,g,k);g=b.create();m.computeTranslationToOriginAndRotation(k,n,g,f);return g};a.getLocalOrigin=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/orientedBoundingBox":function(){define("exports ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/quat ../../../chunks/quatf32 ../../../chunks/quatf64 ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/plane ./dito".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){function w(y=[0,0,0],D=[-1,-1,-1],E=[0,0,0,1]){return{center:k.clone(y),halfSize:g.clone(D),quaternion:l.clone(E)}}function t(y,D){const E=h.signedDistance(D,y.center);y=x(y,h.normal(D));return E>y?1:E<-y?-1:0}function x(y,D){m.conjugate(B,y.quaternion);n.transformQuat(q,D,B);y=y.halfSize;return Math.abs(q[0]*y[0])+Math.abs(q[1]*y[1])+Math.abs(q[2]*y[2])}const B=r.create(),q=k.create(),u=k.create(),C=d.create(),z=c.create(),A=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,
1.2],p=(()=>{const y=new Int8Array(162);let D=0;const E=F=>{for(let G=0;G<F.length;G++)y[D+G]=F[G];D+=6};E([6,2,3,1,5,4]);E([0,2,3,1,5,4]);E([0,2,3,7,5,4]);E([0,1,3,2,6,4]);E([0,1,3,2,0,0]);E([0,1,5,7,3,2]);E([0,1,3,7,6,4]);E([0,1,3,7,6,2]);E([0,1,5,7,6,2]);E([0,1,5,4,6,2]);E([0,1,5,4,0,0]);E([0,1,3,7,5,4]);E([0,2,6,4,0,0]);E([0,0,0,0,0,0]);E([1,3,7,5,0,0]);E([2,3,7,6,4,0]);E([2,3,7,6,0,0]);E([2,3,1,5,7,6]);E([0,1,5,7,6,2]);E([0,1,5,7,6,4]);E([0,1,3,7,6,4]);E([4,5,7,6,2,0]);E([4,5,7,6,0,0]);E([4,
5,1,3,7,6]);E([0,2,3,7,5,4]);E([6,2,3,7,5,4]);E([6,2,3,1,5,4]);return y})();a.ObbArray=function(y){this.buffer=new ArrayBuffer(56*y);this.obbs=Array(y);for(let D=0;D<y;D++)this.obbs[D]={center:k.createView(this.buffer,56*D),halfSize:g.createView(this.buffer,56*D+24),quaternion:l.createView(this.buffer,56*D+36)}};a.clone=function(y){return w(y.center,y.halfSize,y.quaternion)};a.compute=function(y,D){D=D||w();v.computeOBB(y,D);return D};a.corners=function(y,D){for(let E=0;8>E;++E){const F=D[E];F[0]=
E&1?-y.halfSize[0]:y.halfSize[0];F[1]=E&2?-y.halfSize[1]:y.halfSize[1];F[2]=E&4?-y.halfSize[2]:y.halfSize[2];n.transformQuat(F,F,y.quaternion);n.add(F,F,y.center)}};a.create=w;a.intersectLine=function(y,D,E,F=0){m.conjugate(B,y.quaternion);n.subtract(q,D,y.center);D=n.transformQuat(q,q,B);E=n.transformQuat(u,E,B);let G=-Infinity,P=Infinity;for(let K=0;3>K;K++)if(1E-6<Math.abs(E[K])){const N=(F+y.halfSize[K]-D[K])/E[K],M=(-F-y.halfSize[K]-D[K])/E[K];G=Math.max(G,Math.min(N,M));P=Math.min(P,Math.max(N,
M))}else if(D[K]>y.halfSize[K]+F||D[K]<-y.halfSize[K]-F)return!1;return G<=P};a.intersectPlane=t;a.isVisible=function(y,D){return 0>=t(y,D[0])&&0>=t(y,D[1])&&0>=t(y,D[2])&&0>=t(y,D[3])&&0>=t(y,D[4])&&0>=t(y,D[5])};a.maximumDistancePlane=function(y,D){const E=h.signedDistance(D,y.center);y=x(y,h.normal(D));return E+y};a.minimumDistancePlane=function(y,D){const E=h.signedDistance(D,y.center);y=x(y,h.normal(D));return E-y};a.projectedArea=function(y,D,E,F,G){m.conjugate(B,y.quaternion);n.sub(q,D,y.center);
n.transformQuat(q,q,B);var P=q[0]<-y.halfSize[0]?-1:q[0]>y.halfSize[0]?1:0,K=q[1]<-y.halfSize[1]?-1:q[1]>y.halfSize[1]?1:0,N=q[2]<-y.halfSize[2]?-1:q[2]>y.halfSize[2]?1:0;D=Math.abs(P)+Math.abs(K)+Math.abs(N);if(0===D)return Infinity;D=1===D?4:6;P=6*(P+3*K+9*N+13);b.fromQuat(z,y.quaternion);b.scale(z,z,y.halfSize);for(K=0;K<D;K++)N=p[P+K],n.set(q,((N&1)<<1)-1,(N&2)-1,((N&4)>>1)-1),n.transformMat3(q,q,z),n.add(C,y.center,q),C[3]=1,f.transformMat4(C,C,E),N=1/Math.max(1E-6,C[3]),A[2*K]=C[0]*N,A[2*K+
1]=C[1]*N;y=2*D-2;E=A[0]*(A[3]-A[y+1])+A[y]*(A[1]-A[y-1]);for(D=2;D<y;D+=2)E+=A[D]*(A[D+3]-A[D-1]);return Math.abs(E)*F*G*.125};a.projectedRadius=x;a.radius=function(y){return n.len(y.halfSize)};a.set=function(y,D){n.copy(D.center,y.center);n.copy(D.halfSize,y.halfSize);m.copy(D.quaternion,y.quaternion)};a.toAaBoundingBox=function(y,D){D||(D=e.create());var E=b.fromQuat(z,y.quaternion);const F=y.halfSize[0]*Math.abs(E[0])+y.halfSize[1]*Math.abs(E[3])+y.halfSize[2]*Math.abs(E[6]),G=y.halfSize[0]*Math.abs(E[1])+
y.halfSize[1]*Math.abs(E[4])+y.halfSize[2]*Math.abs(E[7]);E=y.halfSize[0]*Math.abs(E[2])+y.halfSize[1]*Math.abs(E[5])+y.halfSize[2]*Math.abs(E[8]);D[0]=y.center[0]-F;D[1]=y.center[1]-G;D[2]=y.center[2]-E;D[3]=y.center[0]+F;D[4]=y.center[1]+G;D[5]=y.center[2]+E;return D};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/dito":function(){define(["exports"],function(a){function b(R,V,da,ca,ha,ia){if(!(1E-6>V[0]*V[0]+V[1]*V[1]+V[2]*V[2]))for(e(E,
da,V),e(F,ca,V),e(G,ha,V),c(R,V,D),K[1]=D[0],P[1]=D[1],N[1]=P[1]-K[1],da=[da,ca,ha],ca=[E,F,G],ha=0;3>ha;++ha){c(R,da[ha],D);K[0]=D[0];P[0]=D[1];c(R,ca[ha],D);K[2]=D[0];P[2]=D[1];N[0]=P[0]-K[0];N[2]=P[2]-K[2];const ka=n(N);ka<ia.quality&&(d(ia.b0,da[ha]),d(ia.b1,V),d(ia.b2,ca[ha]),ia.quality=ka)}}function c(R,V,da){const {data:ca,size:ha}=R;da[0]=Number.POSITIVE_INFINITY;da[1]=Number.NEGATIVE_INFINITY;for(R=0;R<ca.length;R+=ha){const ia=ca[R]*V[0]+ca[R+1]*V[1]+ca[R+2]*V[2];da[0]=Math.min(da[0],ia);
da[1]=Math.max(da[1],ia)}}function m(R,V,da){d(da.center,R);f(da.halfSize,V,.5);da.quaternion[0]=0;da.quaternion[1]=0;da.quaternion[2]=0;da.quaternion[3]=1}function l(R,V,da,ca,ha,ia){c(R,V,D);ha[0]=D[0];ia[0]=D[1];c(R,da,D);ha[1]=D[0];ia[1]=D[1];c(R,ca,D);ha[2]=D[0];ia[2]=D[1]}function r(R,V,da,ca,ha,ia,ka){T[0]=R[0];T[1]=R[1];T[2]=R[2];T[3]=V[0];T[4]=V[1];T[5]=V[2];T[6]=da[0];T[7]=da[1];T[8]=da[2];var la=ka.quaternion,Y=T,ea=Y[0]+Y[4]+Y[8];if(0<ea)ea=Math.sqrt(ea+1),la[3]=.5*ea,ea=.5/ea,la[0]=(Y[5]-
Y[7])*ea,la[1]=(Y[6]-Y[2])*ea,la[2]=(Y[1]-Y[3])*ea;else{ea=0;Y[4]>Y[0]&&(ea=1);Y[8]>Y[3*ea+ea]&&(ea=2);const ba=(ea+1)%3,Z=(ea+2)%3;let fa=Math.sqrt(Y[3*ea+ea]-Y[3*ba+ba]-Y[3*Z+Z]+1);la[ea]=.5*fa;fa=.5/fa;la[3]=(Y[3*ba+Z]-Y[3*Z+ba])*fa;la[ba]=(Y[3*ba+ea]+Y[3*ea+ba])*fa;la[Z]=(Y[3*Z+ea]+Y[3*ea+Z])*fa}g(U,ca,ha);f(U,U,.5);f(ka.center,R,U[0]);f(S,V,U[1]);g(ka.center,ka.center,S);f(S,da,U[2]);g(ka.center,ka.center,S);f(ka.halfSize,ia,.5)}function n(R){return R[0]*R[1]+R[0]*R[2]+R[1]*R[2]}function g(R,
V,da){R[0]=V[0]+da[0];R[1]=V[1]+da[1];R[2]=V[2]+da[2]}function k(R,V,da){R[0]=V[0]-da[0];R[1]=V[1]-da[1];R[2]=V[2]-da[2]}function f(R,V,da){R[0]=V[0]*da;R[1]=V[1]*da;R[2]=V[2]*da}function d(R,V,da=0){R[0]=V[da+0];R[1]=V[da+1];R[2]=V[da+2]}function e(R,V,da){const ca=V[0],ha=V[1];V=V[2];const ia=da[0],ka=da[1];da=da[2];R[0]=ha*da-V*ka;R[1]=V*ia-ca*da;R[2]=ca*ka-ha*ia}function h(R,V){var da=V[0]*V[0]+V[1]*V[1]+V[2]*V[2];0<da&&(da=1/Math.sqrt(da),R[0]=V[0]*da,R[1]=V[1]*da,R[2]=V[2]*da)}function v(R,
V){const da=V[0]-R[0],ca=V[1]-R[1];R=V[2]-R[2];return da*da+ca*ca+R*R}const w=[0,0,0],t=[0,0,0],x=[0,0,0],B=[0,0,0],q=[0,0,0],u=[0,0,0],C=[0,0,0],z=[0,0,0],A=[0,0,0],p=[0,0,0],y=[0,0,0],D=[0,0],E=[0,0,0],F=[0,0,0],G=[0,0,0],P=[0,0,0],K=[0,0,0],N=[0,0,0],M=[0,0,0],L=[0,0,0],J=[0,0,0],H=[0,0,0],I=[0,0,0],O=[0,0,0],Q=[0,0,0],S=[0,0,0],T=[1,0,0,0,1,0,0,0,1],U=[0,0,0];let aa=function(R){this.minVert=Array(7);this.maxVert=Array(7);this.buffer=new ArrayBuffer(448);var V=0;this.minProj=new Float64Array(this.buffer,
V,7);V+=56;this.maxProj=new Float64Array(this.buffer,V,7);V+=56;for(var da=0;7>da;++da)this.minVert[da]=new Float64Array(this.buffer,V,3),V+=24;for(da=0;7>da;++da)this.maxVert[da]=new Float64Array(this.buffer,V,3),V+=24;for(V=0;7>V;++V)this.minProj[V]=Number.POSITIVE_INFINITY,this.maxProj[V]=Number.NEGATIVE_INFINITY;V=Array(7);da=Array(7);const {data:ca,size:ha}=R;for(R=0;R<ca.length;R+=ha){var ia=ca[R];ia<this.minProj[0]&&(this.minProj[0]=ia,V[0]=R);ia>this.maxProj[0]&&(this.maxProj[0]=ia,da[0]=
R);ia=ca[R+1];ia<this.minProj[1]&&(this.minProj[1]=ia,V[1]=R);ia>this.maxProj[1]&&(this.maxProj[1]=ia,da[1]=R);ia=ca[R+2];ia<this.minProj[2]&&(this.minProj[2]=ia,V[2]=R);ia>this.maxProj[2]&&(this.maxProj[2]=ia,da[2]=R);ia=ca[R]+ca[R+1]+ca[R+2];ia<this.minProj[3]&&(this.minProj[3]=ia,V[3]=R);ia>this.maxProj[3]&&(this.maxProj[3]=ia,da[3]=R);ia=ca[R]+ca[R+1]-ca[R+2];ia<this.minProj[4]&&(this.minProj[4]=ia,V[4]=R);ia>this.maxProj[4]&&(this.maxProj[4]=ia,da[4]=R);ia=ca[R]-ca[R+1]+ca[R+2];ia<this.minProj[5]&&
(this.minProj[5]=ia,V[5]=R);ia>this.maxProj[5]&&(this.maxProj[5]=ia,da[5]=R);ia=ca[R]-ca[R+1]-ca[R+2];ia<this.minProj[6]&&(this.minProj[6]=ia,V[6]=R);ia>this.maxProj[6]&&(this.maxProj[6]=ia,da[6]=R)}for(R=0;7>R;++R)ia=V[R],d(this.minVert[R],ca,ia),ia=da[R],d(this.maxVert[R],ca,ia)},W=function(){this.b0=[1,0,0];this.b1=[0,1,0];this.b2=[0,0,1];this.quality=0};a.computeOBB=function(R,V){const {data:da,size:ca}=R;var ha=da.length/ca;if(!(0>=ha)){var ia=new aa(R);g(w,ia.minProj,ia.maxProj);f(w,w,.5);k(t,
ia.maxProj,ia.minProj);var ka=n(t),la=new W;la.quality=ka;14>ha&&(R={data:new Float64Array(ia.buffer,112,42),size:3});var Y=[0,0,0],ea=[0,0,0],ba=[0,0,0];ha=[0,0,0];var Z=[0,0,0],fa=[0,0,0],ja=[0,0,0];var oa=R;var sa=v(ia.maxVert[0],ia.minVert[0]),qa=0;for(var Ha=1;7>Ha;++Ha){const Ga=v(ia.maxVert[Ha],ia.minVert[Ha]);Ga>sa&&(sa=Ga,qa=Ha)}d(Y,ia.minVert[qa]);d(ea,ia.maxVert[qa]);if(1E-6>v(Y,ea))oa=1;else{k(ha,Y,ea);h(ha,ha);{const {data:Ga,size:pa}=oa;ia=Number.NEGATIVE_INFINITY;sa=0;for(qa=0;qa<Ga.length;qa+=
pa)y[0]=Ga[qa]-Y[0],y[1]=Ga[qa+1]-Y[1],y[2]=Ga[qa+2]-Y[2],Ha=ha[0]*y[0]+ha[1]*y[1]+ha[2]*y[2],Ha=y[0]*y[0]+y[1]*y[1]+y[2]*y[2]-Ha*Ha/(ha[0]*ha[0]+ha[1]*ha[1]+ha[2]*ha[2]),Ha>ia&&(ia=Ha,sa=qa);d(ba,Ga,sa)}1E-6>ia?oa=2:(k(Z,ea,ba),h(Z,Z),k(fa,ba,Y),h(fa,fa),e(ja,Z,ha),h(ja,ja),b(oa,ja,ha,Z,fa,la),oa=0)}switch(oa){case 1:m(w,t,V);return;case 2:ka=R;d(L,ha);Math.abs(ha[0])>Math.abs(ha[1])&&Math.abs(ha[0])>Math.abs(ha[2])?L[0]=0:Math.abs(ha[1])>Math.abs(ha[2])?L[1]=0:L[2]=0;1E-6>L[0]*L[0]+L[1]*L[1]+L[2]*
L[2]&&(L[0]=L[1]=L[2]=1);e(J,ha,L);h(J,J);e(H,ha,J);h(H,H);l(ka,ha,J,H,I,O);k(Q,O,I);r(ha,J,H,I,O,Q,V);return}oa=R;{ia=D;const {data:Ga,size:pa}=oa;d(B,Ga);d(x,B);ia[0]=M[0]*ja[0]+M[1]*ja[1]+M[2]*ja[2];ia[1]=ia[0];for(sa=pa;sa<Ga.length;sa+=pa)qa=Ga[sa]*ja[0]+Ga[sa+1]*ja[1]+Ga[sa+2]*ja[2],qa<ia[0]&&(ia[0]=qa,d(B,Ga,sa)),qa>ia[1]&&(ia[1]=qa,d(x,Ga,sa))}ja=Y[0]*ja[0]+Y[1]*ja[1]+Y[2]*ja[2];D[1]-1E-6<=ja&&(x[0]=void 0);D[0]+1E-6>=ja&&(B[0]=void 0);void 0!==x[0]&&(k(q,x,Y),h(q,q),k(u,x,ea),h(u,u),k(C,
x,ba),h(C,C),e(z,u,ha),h(z,z),e(A,C,Z),h(A,A),e(p,q,fa),h(p,p),b(oa,z,ha,u,q,la),b(oa,A,Z,C,u,la),b(oa,p,fa,q,C,la));void 0!==B[0]&&(k(q,B,Y),h(q,q),k(u,B,ea),h(u,u),k(C,B,ba),h(C,C),e(z,u,ha),h(z,z),e(A,C,Z),h(A,A),e(p,q,fa),h(p,p),b(oa,z,ha,u,q,la),b(oa,A,Z,C,u,la),b(oa,p,fa,q,C,la));l(R,la.b0,la.b1,la.b2,I,O);R=[0,0,0];k(R,O,I);la.quality=n(R);la.quality<ka?r(la.b0,la.b1,la.b2,I,O,R,V):m(w,t,V)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/ComponentData":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers",
"../../../../../core/maybe","../../../../../core/typedArrayUtil","./IndexRange/ComponentRangeRunLengthEncoded","../../lib/AutoDisposable"],function(a,b,c,m,l){function r(n,g,k){const f=[],d=[];let e=k.length,h=k.length;g.forEachComponent(v=>{0<n[v]?(e!==v-1&&(f.length&&f.push(k[e+1]-f[f.length-1]),f.push(k[v])),e=v):(h!==v-1&&(d.length&&d.push(k[h+1]-d[d.length-1]),d.push(k[v])),h=v);return!0});f.length&&f.push(k[e+1]-f[f.length-1]);d.length&&d.push(k[h+1]-d[d.length-1]);return{highlightRanges:f,
defaultRanges:d}}return function(n){function g(f,d){var e=n.call(this)||this;e.pickability=null;e.highlightCounts=null;e.verticalOffsets=null;e.cachedGeometryRanges=null;e.cachedHighlightRanges=null;e.cachedDefaultRanges=null;e.offsets=c.slice(d);d=e.count;e.visibility=new m.ComponentRangeRunLengthEncoded(d);e.materialDataBuffer=f.getBuffer(d);e.materialDataIndices=new Uint16Array(d);for(f=0;f<d;f++)e.materialDataIndices[f]=e.materialDataBuffer.acquireIndex();return e}a._inheritsLoose(g,n);var k=
g.prototype;k.dispose=function(){n.prototype.dispose.call(this);for(let f=0;f<this.count;f++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[f])};k.highlightsDirty=function(){this.cachedDefaultRanges=this.cachedHighlightRanges=null};k.visibilityDirty=function(){this.cachedGeometryRanges=null;this.highlightsDirty()};k._updateCachedHighlightRanges=function(){if((b.isNone(this.cachedHighlightRanges)||b.isNone(this.cachedDefaultRanges))&&b.isSome(this.highlightCounts)){const {highlightRanges:f,
defaultRanges:d}=r(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=f;this.cachedDefaultRanges=d}};a._createClass(g,[{key:"count",get:function(){return this.offsets.length-1}},{key:"geometryRanges",get:function(){b.isNone(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets));return this.cachedGeometryRanges}},{key:"highlightRanges",get:function(){if(b.isNone(this.highlightCounts))return null;this._updateCachedHighlightRanges();
return this.cachedHighlightRanges}},{key:"defaultShadowMapRanges",get:function(){if(b.isNone(this.highlightCounts))return this.geometryRanges;this._updateCachedHighlightRanges();return this.cachedDefaultRanges}}]);return g}(l.AutoDisposable)})},"esri/views/3d/webgl-engine/collections/Component/IndexRange/ComponentRangeRunLengthEncoded":function(){define(["exports"],function(a){let b=function(){function c(l){this._totalCount=l;this._indexRanges=[0,l]}var m=c.prototype;m.allVisible=function(){return this.componentCount()===
this._totalCount};m.allInvisible=function(){return 0===this._indexRanges.length};m.componentCount=function(){const l=this._indexRanges;let r=0;for(let n=0;n<l.length;n+=2)r+=l[n+1];return r};m.reset=function(l){if("all"===l||l.length===this._totalCount)this._indexRanges=[0,this._totalCount];else{{const g=[];if(0!==l.length){var r=l[0],n=1;for(let k=1;k<l.length;k++){const f=l[k];r+n===f?n+=1:(g.push(r),g.push(n),r=f,n=1)}g.push(r);g.push(n)}l=g}this._indexRanges=l}};m.forEachComponent=function(l){const r=
this._indexRanges;for(let g=0;g<r.length;g+=2){var n=r[g];const k=n+r[g+1];for(;n<k;n++)if(!l(n))return!1}return!0};m.forEachComponentRange=function(l){const r=this._indexRanges;for(let n=0;n<r.length;n+=2){const g=r[n];if(!l(g,g+r[n+1]))return!1}return!0};m.computeOffsetRanges=function(l){const r=Array(this._indexRanges.length),n=this._indexRanges;for(let k=0;k<n.length;k+=2){var g=n[k];const f=l[g];g=l[g+n[k+1]];r[k]=f;r[k+1]=g-f}return r};return c}();a.ComponentRangeRunLengthEncoded=b;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObject":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../lib/AutoDisposable"],function(a,b,c,m){let l=function(r){function n(){var g=r.apply(this,arguments)||this;g.visible=a.State.Hidden;return g}b._inheritsLoose(n,r);return n}(m.AutoDisposable);c.__decorate([m.autoDispose()],l.prototype,"renderable",void 0);
c.__decorate([m.autoDispose()],l.prototype,"components",void 0);a.State=void 0;(function(r){r[r.Hidden=0]="Hidden";r[r.Visible=1]="Visible"})(a.State||(a.State={}));a.ComponentObject=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/IntersectionGeometry":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/buffer/BufferView ./ComponentIntersectionData ../../lib/ComponentUtils ../../lib/geometryDataUtils ../../materials/internal/MaterialUtil".split(" "),
function(a,b,c,m,l,r,n,g,k,f){let d=function(){function v(t,x){this._indices=b.isSome(t.indices)?t.indices:k.generateDefaultIndexArray(t.positions.length/3);this._positions=new r.BufferViewVec3f(t.positions);this._components=x;this._componentIntersectionData=Array(x.count)}var w=v.prototype;w.getComponentAabb=function(t,x){if(b.isSome(this._perComponentAabbs)){for(let B=0;6>B;B++)x[B]=this._perComponentAabbs[6*t+B];return x}this._computePerComponentAabbs();return this.getComponentAabb(t,x)};w.getComponentPositions=
function(t,x){x.indices=this._indices;x.data=this._positions.typedBuffer;x.stride=this._positions.typedBufferStride;x.startIndex=this._components.offsets[t];x.endIndex=this._components.offsets[t+1]};w.intersect=function(t,x,B,q,u,C,z){const A={data:this._positions.typedBuffer,stride:this._positions.typedBufferStride,size:3},p=this._indices,y=this._components.offsets,D=f.computeInvDir(t,x,e),E=t[2],F=x[2];this._components.visibility.forEachComponent(G=>{if(!g.getVisibility(this._components.pickability,
G))return!0;var P=this.getComponentAabb(G,h);if(b.isSome(C)){var K=C[G];b.isSome(u)?u.componentOffset=K:(t[2]=E-K,x[2]=F-K)}b.isSome(u)&&u.applyToAabb(P);if(!f.intersectAabbInvDir(P,t,D,B))return!0;P=y[G]/3;K=y[G+1]/3;const N=(L,J,H)=>{z(G,L,c.transformMat3(J,J,q),H)},M=K-P;b.isNone(u)&&M>n.componentMinimalSizeForIntersectionData?(null==this._componentIntersectionData[G]&&(this._componentIntersectionData[G]=new n.ComponentIntersectionData(this._indices,P,K,A)),this._componentIntersectionData[G].intersectRay({r0:t,
r1:x},N)):f.intersectTriangles(t,x,P,K,p,A,void 0,u,N);return!0})};w._computePerComponentAabbs=function(){const t=this._components.count;this._perComponentAabbs=new Float32Array(6*t);const x=this._indices,B=this._positions.typedBuffer,q=this._positions.typedBufferStride,u=this._components.offsets;let C=0;for(let p=0;p<t;p++){var z=u[p];const y=u[p+1];let D=Infinity,E=Infinity,F=Infinity,G=-Infinity,P=-Infinity,K=-Infinity;for(;z<y;z++){var A=x[z]*q;const N=B[A],M=B[A+1];A=B[A+2];D=Math.min(D,N);E=
Math.min(E,M);F=Math.min(F,A);G=Math.max(G,N);P=Math.max(P,M);K=Math.max(K,A)}this._perComponentAabbs[C++]=D;this._perComponentAabbs[C++]=E;this._perComponentAabbs[C++]=F;this._perComponentAabbs[C++]=G;this._perComponentAabbs[C++]=P;this._perComponentAabbs[C++]=K}};a._createClass(v,[{key:"positions",get:function(){return this._positions}},{key:"indices",get:function(){return this._indices}}]);return v}();const e=m.create(),h=l.create();return d})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["exports"],
function(a){function b(c=!0){return{isVisibleBit:!c,data:new Uint32Array(0)}}a.defaultVisibilities=b;a.getVisibility=function(c,m){if(null==c)return!0;const {isVisibleBit:l,data:r}=c,n=8*r.BYTES_PER_ELEMENT;return m<r.length*n?(c=m/n|0,m=0!==(r[c]&1<<m-c*n)===l):!c.isVisibleBit};a.updateVisibilityWithCount=function(c,m,l,r){if(l>=m)return c;null==c&&(c=b());let n=c.data;const g=8*n.BYTES_PER_ELEMENT,k=l/g|0,f=l-g*k,d=n;r=r===c.isVisibleBit;l<d.length*g||!r||(l=Math.max(k+1,Math.ceil(1.5*d.length)),
l=Math.min(l,((m-1)/g|0)+1),n=new Uint32Array(l),n.set(d));k<n.length&&(n[k]=n[k]&~(1<<f)|(r?1:0)<<f);c.data=n;return c};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/Renderable":function(){define(["exports"],function(a){let b=function(){function c(m,l,r){this.material=m;this.geometry=l;this.meta=r}c.prototype.dispose=function(){this.material.dispose();this.geometry.dispose()};return c}();a.Renderable=
b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/RenderGeometry":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../lib/AutoDisposable"],function(a,b,c,m){let l=function(r){function n(g,k,f,d){var e=r.call(this)||this;e.primitiveType=k;e.parameters=f;e.indexed=d;e.vao=g;return e}b._inheritsLoose(n,r);return n}(m.AutoDisposable);c.__decorate([m.autoDispose()],
l.prototype,"vao",void 0);a.RenderGeometry=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/RenderSubmitSystem":function(){define(["exports","./DepthRange"],function(a,b){let c=function(){function m(r){this._objects=r}var l=m.prototype;l.submit=function(r,n){this._objects.preSubmit(n);this._objects.visibleObjects.forAll(g=>g.renderable.material.submit(r,n,g))};l.queryShadowCasterDepthRange=function(r){return this._objects.visibleObjects.length?
b.computeDepthRange(r,this._objects.visibleObjects):null};return m}();a.RenderSubmitSystem=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/DepthRange":function(){define("exports ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/quat ../../../../../chunks/quatf64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/plane ../../../support/orientedBoundingBox ../../lib/depthRange".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e){function h(P,K,N){return g.set(P,K.data[N+0],K.data[N+1],K.data[N+2])}function v(P,K){P.push(K[0]);P.push(K[1]);P.push(K[2])}function w(P,K,N,M){r.conjugate(p,P.quaternion);g.sub(y,K,P.center);g.transformQuat(y,y,p);const L=8*((y[0]<-P.halfSize[0]?-1:y[0]>P.halfSize[0]?1:0)+3*(y[1]<-P.halfSize[1]?-1:y[1]>P.halfSize[1]?1:0)+9*(y[2]<-P.halfSize[2]?-1:y[2]>P.halfSize[2]?1:0)+13);K=z[L];if(0===K)return K;m.fromQuat(A,P.quaternion);m.scale(A,A,P.halfSize);const J=(H,I)=>
{I=z[L+I+1];g.set(H,((I&1)<<1)-1,(I&2)-1,((I&4)>>1)-1);g.transformMat3(H,H,A);return g.add(H,P.center,H)};N.length=0;v(N,J(D,0));v(N,J(E,1));v(N,J(y,2));v(N,J(F,3));M(N);if(1===K)return K;N.length=0;v(N,D);v(N,F);v(N,J(y,4));v(N,J(G,5));M(N);if(2===K)return K;N.length=0;v(N,D);v(N,G);v(N,J(y,6));v(N,E);M(N);return K}const t=new c({allocator:P=>P||{near:Infinity,far:-Infinity,mask:0,object:null},deallocator:P=>{P.object=null;return P}}),x=e.empty(),B=k.create(),q=k.create(),u=new c({deallocator:null}),
C=new c({deallocator:null}),z=(()=>{const P=new Int8Array(216);let K=0;const N=M=>{for(let L=0;L<M.length;L++)P[K+L]=M[L];K+=8};N([3,0,6,2,3,1,5,4]);N([2,0,2,3,1,5,4,0]);N([3,1,0,2,3,7,5,4]);N([2,0,1,3,2,6,4,0]);N([1,0,1,3,2,0,0,0]);N([2,1,5,7,3,2,0,0]);N([3,2,0,1,3,7,6,4]);N([2,2,0,1,3,7,6,0]);N([3,3,0,1,5,7,6,2]);N([2,0,1,5,4,6,2,0]);N([1,0,1,5,4,0,0,0]);N([2,1,3,7,5,4,0,0]);N([1,0,2,6,4,0,0,0]);N([0,0,0,0,0,0,0,0]);N([1,1,3,7,5,0,0,0]);N([2,2,3,7,6,4,0,0]);N([1,2,3,7,6,0,0,0]);N([2,3,1,5,7,6,2,
0]);N([3,4,0,1,5,7,6,2]);N([2,5,7,6,4,0,1,0]);N([3,5,0,1,3,7,6,4]);N([2,4,5,7,6,2,0,0]);N([1,4,5,7,6,0,0,0]);N([2,5,1,3,7,6,4,0]);N([3,6,0,2,3,7,5,4]);N([2,6,2,3,7,5,4,0]);N([3,7,6,2,3,1,5,4]);return P})(),A=l.create(),p=n.create(),y=k.create(),D=k.create(),E=k.create(),F=k.create(),G=k.create();a.computeDepthRange=function(P,K){const N=e.empty(),{eye:M,frustum:L,viewForward:J}=P;K.forAll(H=>{var I=b.isSome(H.offsetObb)?H.offsetObb:H.obb;const O=g.dot(g.sub(y,I.center,M),J),Q=d.projectedRadius(I,
J);if(!e.within(N,O-Q)||!e.within(N,O+Q)){a:{var S=0;for(let T=0;4>T;T++){const U=d.intersectPlane(I,L[T]);if(0<U){I=-1;break a}0===U&&(S|=1<<T)}I=S}-1!==I&&(0===I?(x.far=O+Q,x.near=O-Q,e.union(N,x)):(S=t.pushNew(),S.near=O-Q,S.far=O+Q,S.mask=I,S.object=H))}});for(P=0;P<t.length;P++){const H=t.data[P];e.within(N,H.near)&&e.within(N,H.far)||(x.far=H.far,x.near=Infinity,K=b.isSome(H.object.offsetObb)?H.object.offsetObb:H.object.obb,0===w(K,M,u,I=>{var O=C;for(var Q=0;4>Q&&0<I.length;Q++)if(0!==(H.mask&
1<<Q)){{var S=L[Q],T=I,U=O;U.length=0;const aa=T.length-3;h(B,T,aa);const W=f.signedDistance(S,B);0>=W&&(U.push(B[0]),U.push(B[1]),U.push(B[2]));let R=0,V=W;for(R;R<aa;R+=3){h(q,T,R);const da=f.signedDistance(S,q);0>V*da&&(g.lerp(B,q,B,da/(da-V)),v(U,B));0>=da&&v(U,q);V=da;g.copy(B,q)}0>V*W&&(h(q,T,aa),g.lerp(B,q,B,W/(W-V)),v(U,B))}S=I;I=O;O=S}for(O=0;O<I.length;O+=3)g.set(B,I.data[O+0],I.data[O+1],I.data[O+2]),Q=g.dot(g.sub(B,B,M),J),x.near=Math.min(x.near,Q)})&&(x.near=0),e.union(N,x))}t.length=
0;return N};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["exports"],function(a){function b(m,l){return{near:m,far:l}}function c(m,l,r){m.near=l;m.far=r;return m}a.ZERO={near:0,far:0};a.create=b;a.empty=function(m){return m?c(m,Infinity,-Infinity):b(Infinity,-Infinity)};a.set=c;a.union=function(m,l,r=m){r.near=Math.min(m.near,l.near);r.far=Math.max(m.far,l.far);return r};a.within=function(m,
l){return m.near<=l&&l<=m.far};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/SourceGeometry":function(){define(["exports","../../../support/buffer/InterleavedLayout","../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl","../../lib/VertexAttribute"],function(a,b,c,m){a.createVertexBufferLayout=function(l){const r=b.newLayout().vec3f(m.VertexAttribute.POSITION);l.normals&&r.vec2i16(m.VertexAttribute.NORMALCOMPRESSED,
{glNormalized:!0});l.textureCoordinates===c.TextureCoordinateAttributeType.Default?r.vec2f(m.VertexAttribute.UV0):l.textureCoordinates===c.TextureCoordinateAttributeType.Atlas&&(r.vec2f(m.VertexAttribute.UV0),r.vec4u16(m.VertexAttribute.UVREGION,{glNormalized:!0}));l.colors&&r.vec4u8(m.VertexAttribute.COLOR,{glNormalized:!0});return r.alignTo(4)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentMaterial":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ../../../../../../core/maybe ../../../../../../chunks/mat3 ../../../../../../chunks/mat3f32 ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f32 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f32 ../../../../layers/support/symbolColorUtils ../../../../terrain/interfaces ./ComponentTechnique ./ComponentTechniqueConfiguration ./shader/ComponentData.glsl ../../../../../../chunks/ComponentShader.glsl ./shader/VertexDiscardByOpacity.glsl ../../../core/material/MaterialBase ../../../core/renderPasses/AllRenderPasses ../../../core/shaderLibrary/ShaderOutputOptions ../../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../../core/shaderLibrary/shading/Normals.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/util/AlphaCutoff ../../../core/shaderLibrary/util/EllipsoidMode ../../../core/util/TwoVectorPosition ../../../lib/basicInterfaces".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E){function F(M){switch(M){case q.MaterialSubPass.Color:return u.ShaderOutput.Color;case q.MaterialSubPass.Alpha:return u.ShaderOutput.Alpha;case q.MaterialSubPass.Depth:return u.ShaderOutput.Depth;case q.MaterialSubPass.Normal:return u.ShaderOutput.Normal}}let G=function(M){function L(H,I){var O=M.call(this)||this;O.toMapSpace=I;O.baseColor=f.fromValues(1,1,1,1);O.usePBR=!1;O.hasParametersFromSource=!1;O.mrrFactors=g.fromValues(1,1,.5);
O.emissiveFactor=g.fromValues(0,0,0);O.baseColorTexture=null;O.metallicRoughnessTexture=null;O.emissionTexture=null;O.occlusionTexture=null;O.normalTexture=null;O.objectOpacity=1;O.commonMaterialParameters=new K;O.componentParameters=new N;O.textureAlphaCutoff=p.defaultMaskAlphaCutoff;O.alphaDiscardMode=E.AlphaDiscardMode.Opaque;O.isIntegratedMesh=!1;O.polygonOffsetEnabled=!1;O.ellipsoidMode=y.EllipsoidMode.Earth;O.hasOccludees=!1;O._techniqueConfiguration=new v.ComponentTechniqueConfiguration;I=
new D.TwoVectorPosition(H.position);const Q=r.clone(H.rotationScale);l.invert(Q,Q);O.transformNormalGlobalFromModel=l.transpose(Q,Q);O.transformWorldFromModelTL=I.low;O.transformWorldFromModelTH=I.high;O.transformWorldFromModelRS=H.rotationScale;return O}b._inheritsLoose(L,M);var J=L.prototype;J.dispose=function(){this._technique=m.releaseMaybe(this._technique);this.normalTexture=this.occlusionTexture=this.emissionTexture=this.metallicRoughnessTexture=this.baseColorTexture=null};J.prepareTechnique=
function(H,I,O,Q){const S=this._techniqueConfiguration;S.hasVertexColors=Q.colors;S.hasNormals=Q.normals;S.textureCoordinateType=Q.textureCoordinates;S.hasMetalnessAndRoughnessTexture=m.isSome(this.metallicRoughnessTexture);S.hasEmissionTexture=m.isSome(this.emissionTexture);S.hasOcclusionTexture=m.isSome(this.occlusionTexture);S.hasNormalTexture=m.isSome(this.normalTexture);S.transparencyPassType=I.identifier===q.RenderPassIdentifier.Material&&null!=O.transparencyPassType?O.transparencyPassType:
E.TransparencyPassType.NONE;S.hasMultipassTerrain=I.identifier===q.RenderPassIdentifier.Material&&null!=O.multipassTerrain?O.multipassTerrain.enabled:!1;S.cullAboveGround=I.identifier===q.RenderPassIdentifier.Material&&null!=O.multipassTerrain?O.multipassTerrain.cullAboveGround:!1;S.ellipsoidMode=this.ellipsoidMode;S.componentData=this.componentParameters.type;S.cullFace=this.commonMaterialParameters.cullFace;S.doubleSidedMode=this.commonMaterialParameters.doubleSided?z.NormalsDoubleSidedMode.View:
z.NormalsDoubleSidedMode.None;S.hasBaseColorTexture=m.isSome(this.baseColorTexture);Q=this._computeWhichMaterialPass();S.blendingEnabled=Q===P.Transparent||Q===P.OpaqueAndTransparent;S.alphaDiscardMode=this.alphaDiscardMode;S.integratedMeshMode=this.isIntegratedMesh?(0===O.overlays.length?0:m.isSome(O.overlays[e.OverlayIndex.INNER].getColorTextureNoRasterImage()))?t.getOverlayNormalTexture(O)?v.IntegratedMeshMode.ColorOverlayWithWater:v.IntegratedMeshMode.ColorOverlay:v.IntegratedMeshMode.NoOverlay:
v.IntegratedMeshMode.None;S.isGround=this.isIntegratedMesh;S.hasPolygonOffset=this.polygonOffsetEnabled;Q=this.hasParametersFromSource&&m.isNone(this.baseColorTexture);S.pbrMode=S.integratedMeshMode===v.IntegratedMeshMode.ColorOverlayWithWater?A.PBRMode.WaterOnIntegratedMesh:this.usePBR?Q?A.PBRMode.Schematic:A.PBRMode.Normal:A.PBRMode.Disabled;S.normalType=S.integratedMeshMode===v.IntegratedMeshMode.None?S.hasNormals?C.NormalAttributeType.CompressedAttribute:C.NormalAttributeType.ScreenDerivative:
C.NormalAttributeType.Ground;S.hasSlicePlane=m.isSome(O.slicePlane)&&this.commonMaterialParameters.hasSlicePlane;I.identifier===q.RenderPassIdentifier.ShadowMap?(S.output=u.ShaderOutput.Shadow,S.vertexDiscardMode=x.VertexDiscardMode.None):I.identifier===q.RenderPassIdentifier.Highlight?(S.output=u.ShaderOutput.Highlight,S.vertexDiscardMode=x.VertexDiscardMode.None):(this._computeWhichMaterialPass()===P.OpaqueAndTransparent?S.vertexDiscardMode=I.transparent?x.VertexDiscardMode.Opaque:x.VertexDiscardMode.Transparent:
S.vertexDiscardMode=x.VertexDiscardMode.None,S.output=F(I.subPass),I.subPass===q.MaterialSubPass.Alpha&&(S.hasOccludees=O.hasOccludees),I.subPass===q.MaterialSubPass.Color?(S.receiveAmbientOcclusion=O.ssaoHelper.ready,S.hasOccludees=O.hasOccludees,S.receiveShadows=O.shadowMap.ready,S.hasScreenSpaceReflections=O.ssr.enabled,S.hasCloudsReflections=m.isSome(O.clouds.data)):(S.receiveAmbientOcclusion=!1,S.receiveShadows=!1),S.snowCover=this.hasSnowCover(O));this._technique=H.releaseAndAcquire(h.ComponentTechnique,
S,this._technique);this._setClean();return this._technique};J.hasSnowCover=function(H){return m.isSome(H.weather)&&H.weatherVisible&&"snowy"===H.weather.type&&"enabled"===H.weather.snowCover};J.submit=function(H,I,O){if(0!==this.objectOpacity){var Q=O.renderable.geometry,S=O.components;O=O.renderable.meta.cameraDepthSquared;var T=S.geometryRanges,U=S.highlightRanges;S=S.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case P.Opaque:H.materialOpaque.submitDraw(this,Q,T,O);break;case P.Transparent:H.materialTransparent.submitDraw(this,
Q,T,O);break;case P.OpaqueAndTransparent:H.materialOpaque.submitDraw(this,Q,T,O);H.materialTransparent.submitDraw(this,Q,T,O);break;case P.IntegratedMesh:H.materialIntegratedMesh.submitDraw(this,Q,T,O),(0===I.overlays.length?0:m.isSome(I.overlays[e.OverlayIndex.INNER].getValidTexture(e.RenderTargetType.Highlight)))&&H.highlightIntegratedMesh.submitDraw(this,Q,T,O)}(I=this.componentParameters.castShadows!==a.ComponentParameterSummary.None)&&H.shadowMap.submitDraw(this,Q,T,O);m.isSome(U)&&(H.highlight.submitDraw(this,
Q,U,O),I&&H.highlightShadowMap.submitDraw(this,Q,U,O));I&&m.isSome(S)&&H.defaultShadowMap.submitDraw(this,Q,S,O)}};J._computeWhichMaterialPass=function(){return this.isIntegratedMesh?P.IntegratedMesh:1>this.objectOpacity?P.Transparent:this.componentParameters.opaqueOverride===a.ComponentParameterSummary.All?P.Opaque:1>this.baseColor[3]||this.alphaDiscardMode===E.AlphaDiscardMode.Blend||this.alphaDiscardMode===E.AlphaDiscardMode.MaskBlend?P.Transparent:this.componentParameters.transparent===a.ComponentParameterSummary.None?
P.Opaque:this.componentParameters.transparent===a.ComponentParameterSummary.All?P.Transparent:P.OpaqueAndTransparent};b._createClass(L,[{key:"texture",get:function(){return m.isSome(this.baseColorTexture)?this.baseColorTexture.glTexture:null}},{key:"textureMetallicRoughness",get:function(){return m.isSome(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.glTexture:null}},{key:"textureEmissive",get:function(){return m.isSome(this.emissionTexture)?this.emissionTexture.glTexture:null}},{key:"textureOcclusion",
get:function(){return m.isSome(this.occlusionTexture)?this.occlusionTexture.glTexture:null}},{key:"textureNormal",get:function(){return m.isSome(this.normalTexture)?this.normalTexture.glTexture:null}},{key:"attributeLocations",get:function(){return t.attributeLocations}}]);return L}(B.MaterialBase);c.__decorate([B.parameter({vectorOps:k.vec4})],G.prototype,"baseColor",void 0);c.__decorate([B.parameter()],G.prototype,"usePBR",void 0);c.__decorate([B.parameter()],G.prototype,"hasParametersFromSource",
void 0);c.__decorate([B.parameter({vectorOps:n.vec3})],G.prototype,"mrrFactors",void 0);c.__decorate([B.parameter({vectorOps:n.vec3})],G.prototype,"emissiveFactor",void 0);c.__decorate([B.parameter({dispose:!0})],G.prototype,"baseColorTexture",void 0);c.__decorate([B.parameter({dispose:!0})],G.prototype,"metallicRoughnessTexture",void 0);c.__decorate([B.parameter({dispose:!0})],G.prototype,"emissionTexture",void 0);c.__decorate([B.parameter({dispose:!0})],G.prototype,"occlusionTexture",void 0);c.__decorate([B.parameter({dispose:!0})],
G.prototype,"normalTexture",void 0);c.__decorate([B.parameter()],G.prototype,"objectOpacity",void 0);c.__decorate([B.parameterBlock()],G.prototype,"commonMaterialParameters",void 0);c.__decorate([B.parameterBlock()],G.prototype,"componentParameters",void 0);c.__decorate([B.parameter()],G.prototype,"textureAlphaCutoff",void 0);c.__decorate([B.parameter()],G.prototype,"alphaDiscardMode",void 0);c.__decorate([B.parameter()],G.prototype,"isIntegratedMesh",void 0);c.__decorate([B.parameter()],G.prototype,
"polygonOffsetEnabled",void 0);c.__decorate([B.parameter()],G.prototype,"ellipsoidMode",void 0);c.__decorate([B.parameter()],G.prototype,"hasOccludees",void 0);a.ShadingNormalSource=void 0;(function(M){M[M.VERTEX=0]="VERTEX";M[M.GROUND=1]="GROUND";M[M.SCREEN_DERIVATIVE=2]="SCREEN_DERIVATIVE"})(a.ShadingNormalSource||(a.ShadingNormalSource={}));var P;(function(M){M[M.Opaque=0]="Opaque";M[M.Transparent=1]="Transparent";M[M.OpaqueAndTransparent=2]="OpaqueAndTransparent";M[M.IntegratedMesh=3]="IntegratedMesh"})(P||
(P={}));let K=function(M){function L(){var J=M.apply(this,arguments)||this;J.doubleSided=!1;J.cullFace=E.CullFaceOptions.Back;J.hasSlicePlane=!0;return J}b._inheritsLoose(L,M);return L}(B.MaterialParameterBlock);c.__decorate([B.parameter()],K.prototype,"doubleSided",void 0);c.__decorate([B.parameter()],K.prototype,"cullFace",void 0);c.__decorate([B.parameter()],K.prototype,"hasSlicePlane",void 0);let N=function(M){function L(){var J=M.apply(this,arguments)||this;J.externalColor=f.fromValues(1,1,1,
1);J.externalColorMixMode=d.ColorMixModeEnum.Multiply;J.castShadows=a.ComponentParameterSummary.All;return J}b._inheritsLoose(L,M);b._createClass(L,[{key:"transparent",get:function(){return 1>this.externalColor[3]?a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}},{key:"opaqueOverride",get:function(){return this.externalColorMixMode===d.ColorMixModeEnum.Replace&&1===this.externalColor[3]?a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}},{key:"visible",get:function(){return 0<
this.externalColor[3]?a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}},{key:"type",get:function(){return w.ComponentDataType.Uniform}}]);return L}(B.MaterialParameterBlock);c.__decorate([B.parameter({vectorOps:k.vec4})],N.prototype,"externalColor",void 0);c.__decorate([B.parameter()],N.prototype,"externalColorMixMode",void 0);c.__decorate([B.parameter()],N.prototype,"castShadows",void 0);a.ComponentParameterSummary=void 0;(function(M){M[M.All=0]="All";M[M.Some=1]="Some";M[M.None=
2]="None"})(a.ComponentParameterSummary||(a.ComponentParameterSummary={}));n=function(M){function L(){var J=M.apply(this,arguments)||this;J.texture=null;J.transparent=a.ComponentParameterSummary.None;J.opaqueOverride=a.ComponentParameterSummary.None;J.castShadows=a.ComponentParameterSummary.None;return J}b._inheritsLoose(L,M);b._createClass(L,[{key:"type",get:function(){return w.ComponentDataType.Varying}}]);return L}(B.MaterialParameterBlock);c.__decorate([B.parameter()],n.prototype,"texture",void 0);
c.__decorate([B.parameter()],n.prototype,"transparent",void 0);c.__decorate([B.parameter()],n.prototype,"opaqueOverride",void 0);c.__decorate([B.parameter()],n.prototype,"castShadows",void 0);a.CommonMaterialParameters=K;a.ComponentMaterial=G;a.ComponentParametersUniform=N;a.ComponentParametersVarying=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechnique":function(){define("require exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../ViewingMode ./ComponentTechniqueConfiguration ./shader/ComponentData.glsl ../../../../../../chunks/ComponentShader.glsl ../../../core/shaderLibrary/ShaderOutputOptions ../../../core/shaderLibrary/util/DoublePrecision.glsl ../../../core/shaderTechnique/ReloadableShaderModule ../../../core/shaderTechnique/ShaderTechnique ../../../lib/basicInterfaces ../../../lib/OrderIndependentTransparency ../../../lib/Program ../../../lib/StencilUtils ../../../../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t){d=function(x){function B(){return x.apply(this,arguments)||this}c._inheritsLoose(B,x);var q=B.prototype;q.bindDraw=function(u,C){const z=this.program;z.bindDraw(u,C);z.rebindTextures();u.componentParameters.type===r.ComponentDataType.Varying&&u.componentParameters.texture.bind(z,"componentColorTex","componentColorTexInvDim")};q.initializeConfiguration=function(u,C){C.spherical=u.viewingMode===m.ViewingMode.Global;C.doublePrecisionRequiresObfuscation=k.doublePrecisionRequiresObfuscation(u.rctx)};
q.initializeProgram=function(u){const C=B.shader.get(),z=C.build(this.configuration);return new v.Program(u.rctx,z,C.attributeLocations)};q._setPipelineState=function(u){const C=this.configuration,z=C.integratedMeshMode!==l.IntegratedMeshMode.None,A=u===e.TransparencyPassType.NONE,p=u===e.TransparencyPassType.FrontFace;return t.makePipelineState({blending:C.output!==g.ShaderOutput.Color&&C.output!==g.ShaderOutput.Alpha||!C.blendingEnabled?null:A?h.blendingDefault:h.oitBlending(u),culling:t.cullingParams(C.cullFace),
depthTest:{func:h.oitDepthTest(u)},depthWrite:A||p?t.defaultDepthWriteParams:null,colorWrite:t.defaultColorWriteParams,stencilWrite:z||C.hasOccludees?w.stencilWriteMaskOn:null,stencilTest:z?w.replaceBitWhenDepthTestPasses(e.StencilBits.IntegratedMeshMaskExcluded):C.hasOccludees?w.stencilBaseAllZerosParams:null,polygonOffset:A||p?C.hasPolygonOffset?{factor:2,units:2}:null:h.OITPolygonOffset})};q.initializePipeline=function(){return this._setPipelineState(this.configuration.transparencyPassType)};return B}(d.ShaderTechnique);
d.shader=new f.ReloadableShaderModule(n.ComponentShader,()=>new Promise((x,B)=>a(["./shader/ComponentShader.glsl"],x,B)));b.ComponentTechnique=d;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechniqueConfiguration":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ./shader/ComponentData.glsl ./shader/VertexDiscardByOpacity.glsl ../../../core/shaderLibrary/ShaderOutputOptions ../../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../../../core/shaderLibrary/shading/Normals.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/util/EllipsoidMode ../../../core/shaderTechnique/BindType ../../../core/shaderTechnique/ShaderTechniqueConfiguration ../../../lib/basicInterfaces".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){a.PassDiscardMode=void 0;(function(t){t[t.None=0]="None";t[t.Transparent=1]="Transparent";t[t.Opaque=2]="Opaque";t[t.COUNT=3]="COUNT"})(a.PassDiscardMode||(a.PassDiscardMode={}));a.IntegratedMeshMode=void 0;(function(t){t[t.None=0]="None";t[t.NoOverlay=1]="NoOverlay";t[t.ColorOverlay=2]="ColorOverlay";t[t.ColorOverlayWithWater=3]="ColorOverlayWithWater";t[t.COUNT=4]="COUNT"})(a.IntegratedMeshMode||(a.IntegratedMeshMode={}));let w=function(t){function x(){var B=
t.apply(this,arguments)||this;B.output=r.ShaderOutput.Color;B.textureCoordinateType=g.TextureCoordinateAttributeType.None;B.componentData=m.ComponentDataType.Uniform;B.cullFace=v.CullFaceOptions.Back;B.vertexDiscardMode=l.VertexDiscardMode.None;B.doubleSidedMode=k.NormalsDoubleSidedMode.WindingOrder;B.alphaDiscardMode=v.AlphaDiscardMode.Opaque;B.integratedMeshMode=a.IntegratedMeshMode.None;B.transparencyPassType=v.TransparencyPassType.NONE;B.ellipsoidMode=d.EllipsoidMode.Earth;B.pbrMode=f.PBRMode.Disabled;
B.normalType=n.NormalAttributeType.Attribute;B.spherical=!1;B.doublePrecisionRequiresObfuscation=!1;B.hasVertexColors=!1;B.hasNormals=!1;B.hasSlicePlane=!1;B.hasBaseColorTexture=!1;B.receiveAmbientOcclusion=!0;B.receiveShadows=!0;B.blendingEnabled=!0;B.hasScreenSpaceReflections=!1;B.hasPolygonOffset=!1;B.hasMetalnessAndRoughnessTexture=!1;B.hasEmissionTexture=!1;B.hasOcclusionTexture=!1;B.hasNormalTexture=!1;B.hasOccludees=!1;B.hasMultipassTerrain=!1;B.cullAboveGround=!1;B.isGround=!1;B.hasCloudsReflections=
!0;B.snowCover=!1;return B}b._inheritsLoose(x,t);return x}(h.ShaderTechniqueConfiguration);c.__decorate([h.parameter({count:r.ShaderOutput.COUNT})],w.prototype,"output",void 0);c.__decorate([h.parameter({count:g.TextureCoordinateAttributeType.COUNT})],w.prototype,"textureCoordinateType",void 0);c.__decorate([h.parameter({count:m.ComponentDataType.COUNT})],w.prototype,"componentData",void 0);c.__decorate([h.parameter({count:v.CullFaceOptions.COUNT})],w.prototype,"cullFace",void 0);c.__decorate([h.parameter({count:l.VertexDiscardMode.COUNT})],
w.prototype,"vertexDiscardMode",void 0);c.__decorate([h.parameter({count:k.NormalsDoubleSidedMode.COUNT})],w.prototype,"doubleSidedMode",void 0);c.__decorate([h.parameter({count:v.AlphaDiscardMode.COUNT})],w.prototype,"alphaDiscardMode",void 0);c.__decorate([h.parameter({count:a.IntegratedMeshMode.COUNT})],w.prototype,"integratedMeshMode",void 0);c.__decorate([h.parameter({count:v.TransparencyPassType.COUNT})],w.prototype,"transparencyPassType",void 0);c.__decorate([h.parameter({count:d.EllipsoidMode.COUNT})],
w.prototype,"ellipsoidMode",void 0);c.__decorate([h.parameter({count:f.PBRMode.COUNT})],w.prototype,"pbrMode",void 0);c.__decorate([h.parameter({count:n.NormalAttributeType.COUNT})],w.prototype,"normalType",void 0);c.__decorate([h.parameter()],w.prototype,"spherical",void 0);c.__decorate([h.parameter()],w.prototype,"doublePrecisionRequiresObfuscation",void 0);c.__decorate([h.parameter()],w.prototype,"hasVertexColors",void 0);c.__decorate([h.parameter()],w.prototype,"hasNormals",void 0);c.__decorate([h.parameter()],
w.prototype,"hasSlicePlane",void 0);c.__decorate([h.parameter()],w.prototype,"hasBaseColorTexture",void 0);c.__decorate([h.parameter()],w.prototype,"receiveAmbientOcclusion",void 0);c.__decorate([h.parameter()],w.prototype,"receiveShadows",void 0);c.__decorate([h.parameter()],w.prototype,"blendingEnabled",void 0);c.__decorate([h.parameter()],w.prototype,"hasScreenSpaceReflections",void 0);c.__decorate([h.parameter()],w.prototype,"hasPolygonOffset",void 0);c.__decorate([h.parameter()],w.prototype,
"hasMetalnessAndRoughnessTexture",void 0);c.__decorate([h.parameter()],w.prototype,"hasEmissionTexture",void 0);c.__decorate([h.parameter()],w.prototype,"hasOcclusionTexture",void 0);c.__decorate([h.parameter()],w.prototype,"hasNormalTexture",void 0);c.__decorate([h.parameter()],w.prototype,"hasOccludees",void 0);c.__decorate([h.parameter()],w.prototype,"hasMultipassTerrain",void 0);c.__decorate([h.parameter()],w.prototype,"cullAboveGround",void 0);c.__decorate([h.parameter()],w.prototype,"isGround",
void 0);c.__decorate([h.parameter()],w.prototype,"hasCloudsReflections",void 0);c.__decorate([h.parameter()],w.prototype,"snowCover",void 0);c.__decorate([h.parameter({constValue:e.BindType.Draw})],w.prototype,"pbrTextureBindType",void 0);c.__decorate([h.parameter({constValue:!0})],w.prototype,"hasSliceHighlight",void 0);c.__decorate([h.parameter({constValue:!1})],w.prototype,"hasSliceInVertexProgram",void 0);c.__decorate([h.parameter({constValue:!1})],w.prototype,"useCustomDTRExponentForWater",void 0);
c.__decorate([h.parameter({constValue:!1})],w.prototype,"hasVertexTangents",void 0);c.__decorate([h.parameter({constValue:!0})],w.prototype,"supportsTextureAtlas",void 0);c.__decorate([h.parameter({constValue:!1})],w.prototype,"highStepCount",void 0);c.__decorate([h.parameter({constValue:!1})],w.prototype,"instancedDoublePrecision",void 0);c.__decorate([h.parameter({constValue:!0})],w.prototype,"useFillLights",void 0);a.ComponentTechniqueConfiguration=w;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl":function(){define("exports ../../../../../../../core/compilerUtils ../../../../../../../core/floatRGBA ./DecodeSymbolColor.glsl ../../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../../core/shaderModules/Float2Uniform ../../../../core/shaderModules/Float4DrawUniform ../../../../core/shaderModules/IntegerDrawUniform ../../../../core/shaderModules/interfaces ../../../../core/shaderModules/Texture2DUniform ../../../../lib/VertexAttribute".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){function e(v){const {vertex:w,fragment:t}=v;w.uniforms.add(new n.Float4DrawUniform("externalColor",x=>x.componentParameters.externalColor));t.uniforms.add(new g.IntegerDrawUniform("externalColorMixMode",x=>x.componentParameters.externalColorMixMode));v.varyings.add("vExternalColor","vec4");w.code.add(k.glsl`float readElevationOffset() {
return 0.0;
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);t.code.add(k.glsl`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}`)}a.ComponentDataType=void 0;(function(v){v[v.Uniform=0]="Uniform";v[v.Varying=1]="Varying";v[v.COUNT=2]="COUNT"})(a.ComponentDataType||(a.ComponentDataType={}));const h=2**32/1E4;a.ComponentData=function(v,w){switch(w.componentData){case a.ComponentDataType.Varying:{const {vertex:t,fragment:x}=v;t.include(l.RgbaFloatEncoding);t.uniforms.add([new f.Texture2DUniform("componentColorTex"),new r.Float2Uniform("componentColorTexInvDim")]);v.attributes.add(d.VertexAttribute.COMPONENTINDEX,"float");v.varyings.add("vExternalColorMixMode",
"mediump float");v.varyings.add("vExternalColor","vec4");v.include(m.DecodeSymbolColor);t.constants.add("elevationScale","float",2*h);t.code.add(k.glsl`vec4 _readComponentColor() {
float normalizedIndex = (componentIndex * 2.0 + 0.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return texture2D(componentColorTex, indexCoord);
}
float readElevationOffset() {
float normalizedIndex = (componentIndex * 2.0 + 1.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return (rgba2float(texture2D(componentColorTex, indexCoord)) - 0.5) * elevationScale;
}
vec4 forwardExternalColor(out bool castShadows) {
vec4 componentColor = _readComponentColor() * 255.0;
float shadowFlag = mod(componentColor.b * 255.0, 2.0);
componentColor.b -= shadowFlag;
castShadows = shadowFlag >= 1.0;
int decodedColorMixMode;
vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451;
vExternalColorMixMode = float(decodedColorMixMode) + 0.5;
return vExternalColor;
}`);x.code.add(k.glsl`void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
externalColor = vExternalColor;
externalColorMixMode = int(vExternalColorMixMode);
}`)}break;case a.ComponentDataType.Uniform:return e(v);case a.ComponentDataType.COUNT:break;default:b.neverReached(w.componentData)}};a.MAX_ELEVATION_OFFSET=h;a.encodeElevationOffset=function(v,w){c.packFloatRGBA(v/h*.5+.5,w)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/IntegerDrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],
function(a,b,c,m){c=function(l){function r(n,g){return l.call(this,n,"int",m.BindType.Draw,(k,f,d)=>k.setUniform1i(n,g(f,d)))||this}b._inheritsLoose(r,l);return r}(c.Uniform);a.IntegerDrawUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl":function(){define(["exports","../../../../core/shaderModules/interfaces"],function(a,b){a.VertexDiscardMode=void 0;(function(c){c[c.None=
0]="None";c[c.Transparent=1]="Transparent";c[c.Opaque=2]="Opaque";c[c.COUNT=3]="COUNT"})(a.VertexDiscardMode||(a.VertexDiscardMode={}));a.VertexDiscardByOpacity=function(c,m){c=c.vertex;c.code.add(b.glsl`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`);switch(m.vertexDiscardMode){case a.VertexDiscardMode.None:c.code.add(b.glsl`#define vertexDiscardByOpacity(_opacity_) {}`);break;case a.VertexDiscardMode.Opaque:c.code.add(b.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);
break;case a.VertexDiscardMode.Transparent:c.code.add(b.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode":function(){define(["exports","../../../../../../geometry/support/spatialReferenceUtils"],function(a,b){a.EllipsoidMode=void 0;(function(c){c[c.Earth=
1]="Earth";c[c.Mars=2]="Mars";c[c.Moon=3]="Moon";c[c.COUNT=4]="COUNT"})(a.EllipsoidMode||(a.EllipsoidMode={}));a.getEllipsoidMode=function(c){return c&&b.isMars(c)?a.EllipsoidMode.Mars:c&&b.isMoon(c)?a.EllipsoidMode.Moon:a.EllipsoidMode.Earth};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/ComponentShader.glsl":function(){define("exports ../geometry/support/Ellipsoid ../views/3d/terrain/interfaces ../views/3d/webgl-engine/collections/Component/Material/ComponentTechniqueConfiguration ../views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl ../views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4Uniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/basicInterfaces ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N,M,L,J,H,I){function O(T){const U=new L.ShaderBuilder;U.include(v.VertexPosition,T);U.include(h.VertexNormal,T);U.include(e.VertexColor,T);U.include(d.TextureCoordinateAttribute,T);U.include(n.ForwardLinearDepth,T);U.include(l.ComponentData,T);U.include(F.DiscardOrAdjustAlphaDraw,T);U.include(k.SlicePass,T);U.include(p.ReadBaseColorTexture,T);U.include(r.VertexDiscardByOpacity,T);const {vertex:aa,fragment:W}=U;W.uniforms.add(new M.Matrix4Uniform("view"));
if(T.pbrMode===A.PBRMode.Normal||T.pbrMode===A.PBRMode.Schematic)U.include(A.PhysicallyBasedRenderingParameters,T),T.hasNormalTexture&&U.include(q.ComputeNormalTexture,T);T.output===g.ShaderOutput.Shadow&&T.componentData===l.ComponentDataType.Varying?aa.code.add(N.glsl`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):aa.code.add(N.glsl`#define discardShadows(castShadows) {}`);const R=T.integratedMeshMode===m.IntegratedMeshMode.ColorOverlay||
T.integratedMeshMode===m.IntegratedMeshMode.ColorOverlayWithWater,V=R&&T.output===g.ShaderOutput.Color&&T.pbrMode===A.PBRMode.WaterOnIntegratedMesh;R&&(U.include(C.EvaluateSceneLighting,T),U.include(D.OverlayIM,T),T.spherical?aa.code.add(N.glsl`
      const float invEllipsoidRadius = ${N.glsl.float(1/(T.ellipsoidMode===G.EllipsoidMode.Earth?b.earth.radius:T.ellipsoidMode===G.EllipsoidMode.Mars?b.mars.radius:b.moon.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):aa.code.add(N.glsl`vec2 projectOverlay(vec3 pos) { return pos.xy; }`));V&&(U.varyings.add("tbnTangent","vec3"),U.varyings.add("tbnBiTangent","vec3"),U.varyings.add("groundNormal","vec3"));aa.code.add(N.glsl`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      if (externalColor.a < ${N.glsl.float(E.symbolAlphaCutoff)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${V?T.spherical?N.glsl`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:N.glsl`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${R?N.glsl`setOverlayVTC(projectOverlay(position));`:""}
    }
  `);T.output===g.ShaderOutput.Alpha&&(W.include(x.ReadLinearDepth),U.include(z.multipassTerrainTest,T),U.include(B.ComputeMaterialColor,T),R&&W.uniforms.add(new J.Texture2DPassUniform("ovColorTex",(da,ca)=>D.getColorTexture(da,ca))),W.code.add(N.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${T.hasMultipassTerrain?N.glsl`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${R?N.glsl`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `));T.output===g.ShaderOutput.Color&&(W.include(x.ReadLinearDepth),U.include(z.multipassTerrainTest,T),U.include(B.ComputeMaterialColor,T),U.include(u.ComputeShadingNormal,T),U.include(C.EvaluateSceneLighting,T),T.receiveShadows?(U.include(y.ReadShadowMapPass,T),W.code.add(N.glsl`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):W.code.add(N.glsl`float evaluateShadow() { return 0.0; }`),R&&W.uniforms.add(new J.Texture2DPassUniform("ovColorTex",(da,ca)=>D.getColorTexture(da,ca))),W.code.add(N.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${T.hasMultipassTerrain?N.glsl`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${R?N.glsl`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),T.pbrMode===A.PBRMode.Normal||T.pbrMode===A.PBRMode.Schematic?(W.uniforms.add(new P.Float3PassUniform("lightingMainIntensity",(da,ca)=>ca.lighting.mainLight.intensity)),W.code.add(N.glsl`
        ${T.pbrMode===A.PBRMode.Normal?N.glsl`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * lightingMainIntensity[2];
      `),T.hasNormalTexture?W.code.add(N.glsl`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):W.code.add(N.glsl`vec3 shadingNormal = normalVertex;`),W.code.add(N.glsl`${T.spherical?N.glsl`vec3 normalGround = normalize(positionWorld());`:N.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),W.code.add(N.glsl`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${T.snowCover?N.glsl`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${R?N.glsl` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(T.receiveShadows?W.code.add(N.glsl`float shadow = evaluateShadow();`):T.spherical?(W.uniforms.add(new K.FloatPassUniform("lightingGlobalFactor",(da,ca)=>ca.lighting.globalFactor)),W.code.add(N.glsl`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):W.code.add(N.glsl`float shadow = 0.0;`),V&&W.uniforms.add(new J.Texture2DPassUniform("ovNormalTex",(da,ca)=>Q(ca))),T.snowCover&&(U.extensions.add("GL_OES_standard_derivatives"),W.code.add(N.glsl`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)),W.code.add(N.glsl`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${R?N.glsl` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${V?N.glsl`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),W.code.add(N.glsl`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${T.transparencyPassType===H.TransparencyPassType.Color?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));if(T.output===g.ShaderOutput.Depth||T.output===g.ShaderOutput.Shadow)U.include(w.OutputDepth,T),W.code.add(N.glsl`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`);T.output===g.ShaderOutput.Normal&&(U.include(u.ComputeShadingNormal,T),W.code.add(N.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${T.normalType===f.NormalAttributeType.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `));T.output===g.ShaderOutput.Highlight&&(U.include(t.OutputHighlight),W.code.add(N.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${R?N.glsl`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  gl_FragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `));return U}function Q(T){return 0===T.overlays.length?null:T.overlays[c.OverlayIndex.INNER].getValidTexture(c.RenderTargetType.Water)}I=new Map([[I.VertexAttribute.POSITION,0],[I.VertexAttribute.NORMAL,1],[I.VertexAttribute.NORMALCOMPRESSED,1],[I.VertexAttribute.COLOR,2],[I.VertexAttribute.UV0,3],[I.VertexAttribute.UVREGION,4],[I.VertexAttribute.COMPONENTINDEX,5]]);const S=Object.freeze(Object.defineProperty({__proto__:null,attributeLocations:I,build:O,getOverlayNormalTexture:Q},Symbol.toStringTag,
{value:"Module"}));a.ComponentShader=S;a.attributeLocations=I;a.build=O;a.getOverlayNormalTexture=Q})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl":function(){define("exports ../attributes/VertexColor.glsl ../util/MixExternalColor.glsl ../../shaderModules/Float4DrawUniform ../../shaderModules/FloatDrawUniform ../../shaderModules/interfaces".split(" "),function(a,b,c,m,l,r){a.ComputeMaterialColor=function(n,g){n.include(b.VertexColor,g);n.fragment.include(c.MixExternalColor);
n=n.fragment;n.uniforms.add(new m.Float4DrawUniform("baseColor",k=>k.baseColor));n.uniforms.add(new l.FloatDrawUniform("objectOpacity",k=>k.objectOpacity));g.hasVertexColors?n.code.add(r.glsl`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):n.code.add(r.glsl`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`);n.code.add(r.glsl`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl":function(){define("exports ../../../../../../core/compilerUtils ../attributes/NormalAttribute.glsl ../attributes/VertexNormal.glsl ../attributes/VertexPosition.glsl ./Normals.glsl ../../shaderModules/interfaces".split(" "),function(a,b,c,m,l,r,n){a.ComputeShadingNormal=function(g,k){const f=g.fragment;switch(k.doubleSidedMode){case r.NormalsDoubleSidedMode.None:f.code.add(n.glsl`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case r.NormalsDoubleSidedMode.View:g.include(l.VertexPosition,k);f.code.add(n.glsl`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case r.NormalsDoubleSidedMode.WindingOrder:f.code.add(n.glsl`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:b.neverReached(k.doubleSidedMode);case r.NormalsDoubleSidedMode.COUNT:}switch(k.normalType){case c.NormalAttributeType.Attribute:case c.NormalAttributeType.CompressedAttribute:g.include(m.VertexNormal,k);f.code.add(n.glsl`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case c.NormalAttributeType.ScreenDerivative:g.extensions.add("GL_OES_standard_derivatives");g.include(l.VertexPosition,k);f.code.add(n.glsl`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case c.NormalAttributeType.Ground:k.spherical?(g.include(l.VertexPosition,k),f.code.add(n.glsl`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):f.code.add(n.glsl`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`);g.extensions.add("GL_OES_standard_derivatives");f.code.add(n.glsl`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:b.neverReached(k.normalType);case c.NormalAttributeType.COUNT:}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl":function(){define("exports ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexTextureCoordinates.glsl ../util/TextureAtlasLookup.glsl ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform".split(" "),function(a,
b,c,m,l,r){a.ReadBaseColorTexture=function(n,g){const k=n.fragment;g.hasBaseColorTexture?(n.include(c.VertexTextureCoordinates,g),g=g.textureCoordinateType===b.TextureCoordinateAttributeType.Atlas,k.uniforms.add(r.createTexture2DDrawSizeUniforms("baseColorTexture",f=>f.texture,g)),g?(n.include(m.TextureAtlasLookup),k.code.add(l.glsl`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, baseColorTextureSize, vuv0, vuvRegion);
}`)):k.code.add(l.glsl`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)):k.code.add(l.glsl`vec4 readBaseColorTexture() { return vec4(1.0); }`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/material/MaterialBase":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../shaderModules/interfaces"],function(a,b,c){c=function(l){function r(){var g=l.apply(this,arguments)||this;g._dirty=!0;return g}b._inheritsLoose(r,l);var n=r.prototype;n._setDirty=function(){this._dirty=
!0};n._setClean=function(){this._dirty=!1;if(null!=this._parameterBlocks)for(const g of this._parameterBlocks)this[g]._setClean()};n._checkParameterBlocksDirty=function(){if(null==this._parameterBlocks)return!1;for(const g of this._parameterBlocks)if(this[g].dirty)return!0;return!1};b._createClass(r,[{key:"dirty",get:function(){return this._dirty||this._checkParameterBlocksDirty()}}]);return r}(c.NoParameters);let m=function(){function l(){this._dirty=!0}var r=l.prototype;r._setDirty=function(){this._dirty=
!0};r._setClean=function(){this._dirty=!1};b._createClass(l,[{key:"dirty",get:function(){return this._dirty}}]);return l}();a.MaterialBase=c;a.MaterialParameterBlock=m;a.parameter=function(l={}){return(r,n)=>{var g;const k=null!=(g=r._parameterCount)?g:0;r._parameterCount=k+1;if(l.vectorOps){const f=l.vectorOps;Object.defineProperty(r,n,{get(){return this[k]},set(d){const e=this[k];if(null==e)this[k]=d;else{if(f.equals(e,d))return;f.copy(e,d)}this._setDirty()}})}else Object.defineProperty(r,n,{get(){return this[k]},
set(f){this[k]!==f&&(l.dispose&&this[k]&&this[k].dispose(),this[k]=f,this._setDirty())}})}};a.parameterBlock=function(){return(l,r)=>{var n;const g=null!=(n=l._parameterCount)?n:0;l._parameterCount=g+1;l._parameterBlocks=l._parameterBlocks||[];l._parameterBlocks.push(g);Object.defineProperty(l,r,{get(){return this[g]},set(k){this[g]!==k&&(this[g]=k,this._setDirty())}})}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/util/TwoVectorPosition":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec3","../../../../../chunks/vec3f32","../../../../../chunks/vec3f64"],function(a,b,c,m,l){let r=function(){function g(f){this._low=m.create();this._high=m.create();f&&this.set(f)}var k=g.prototype;k.set=function(f){const d=this._low,e=this._high;c.copy(d,f);c.sub(e,f,d)};k.setElements=function(f,d,e){c.set(n,f,d,e);this.set(n)};k.get=function(f){return c.add(f,this._low,this._high)};k.getLowScaled=function(f){return c.scale(f,
this._low,1)};b._createClass(g,[{key:"low",get:function(){return this._low}},{key:"high",get:function(){return this._high}}]);return g}();const n=l.create();a.TwoVectorPosition=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout","../VertexAttribute"],function(a,b,c,m){const l=c.newLayout().vec3f(m.VertexAttribute.POSITION).u16(m.VertexAttribute.COMPONENTINDEX).u16(m.VertexAttribute.U16PADDING),
r=c.newLayout().vec2u8(m.VertexAttribute.SIDENESS);b=b.glLayout(r);c=c.newLayout().vec3f(m.VertexAttribute.POSITION0).vec3f(m.VertexAttribute.POSITION1).u16(m.VertexAttribute.COMPONENTINDEX).u8(m.VertexAttribute.VARIANTOFFSET,{glNormalized:!0}).u8(m.VertexAttribute.VARIANTSTROKE).u8(m.VertexAttribute.VARIANTEXTENSION,{glNormalized:!0}).u8(m.VertexAttribute.U8PADDING,{glPadding:!0}).u16(m.VertexAttribute.U16PADDING,{glPadding:!0});const n=c.clone().vec3f(m.VertexAttribute.NORMAL),g=c.clone().vec3f(m.VertexAttribute.NORMALA).vec3f(m.VertexAttribute.NORMALB);
m=new Map([[m.VertexAttribute.POSITION0,0],[m.VertexAttribute.POSITION1,1],[m.VertexAttribute.COMPONENTINDEX,2],[m.VertexAttribute.VARIANTOFFSET,3],[m.VertexAttribute.VARIANTSTROKE,4],[m.VertexAttribute.VARIANTEXTENSION,5],[m.VertexAttribute.NORMAL,6],[m.VertexAttribute.NORMALA,6],[m.VertexAttribute.NORMALB,7],[m.VertexAttribute.SIDENESS,8]]);a.CommonInstancesLayout=c;a.EdgeInputBufferLayout=l;a.EdgeShaderAttributeLocations=m;a.RegularEdgeInstancesLayout=n;a.SilhouetteEdgeInstancesLayout=g;a.VertexLayout=
r;a.glVertexLayout=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../geometry/support/meshUtils/deduplicate ../../../support/meshProcessing ../../../support/buffer/InterleavedLayout ../../../support/buffer/workerHelper ../VertexAttribute ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing".split(" "),
function(a,b,c,m,l,r,n,g,k,f){function d(A){const p=h(A.data,A.skipDeduplicate,A.indices,A.indicesLength);w.updateSettings(A.writerSettings);t.updateSettings(A.writerSettings);return f.extractEdges(p,w,t)}function e(A){return{data:g.EdgeInputBufferLayout.createView(A.dataBuffer),indices:"Uint32Array"===A.indicesType?new Uint32Array(A.indicesBuffer):"Uint16Array"===A.indicesType?new Uint16Array(A.indicesBuffer):void 0,indicesLength:A.indicesLength,writerSettings:A.writerSettings,skipDeduplicate:A.skipDeduplicate}}
function h(A,p,y,D){if(p)return p=m.computeNeighbors(y,D,A.count),{faces:y,facesLength:D,neighbors:p,vertices:A};A=c.deduplicate(A.buffer,A.stride/4,{originalIndices:y,originalIndicesLength:D});D=m.computeNeighbors(A.indices,D,A.uniqueCount);return{faces:A.indices,facesLength:A.indices.length,neighbors:D,vertices:g.EdgeInputBufferLayout.createView(A.buffer)}}let v=function(){function A(){}var p=A.prototype;p.extract=function(){var y=b._asyncToGenerator(function*(D){var E=e(D);D=d(E);E=[E.data.buffer];
E.push(D.regular.lodInfo.lengths.buffer);E.push(D.silhouette.lodInfo.lengths.buffer);return{result:{regular:{instancesData:r.packInterleavedBuffer(D.regular.instancesData,E),lodInfo:{lengths:D.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:r.packInterleavedBuffer(D.silhouette.instancesData,E),lodInfo:{lengths:D.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:D.averageEdgeLength},transferList:E}});return function(D){return y.apply(this,arguments)}}();p.extractComponentsEdgeLocations=
function(){var y=b._asyncToGenerator(function*(D){D=e(D);D=h(D.data,D.skipDeduplicate,D.indices,D.indicesLength);D=f.extractEdges(D,q,u);const E=[];return{result:r.packInterleavedBuffer(D.regular.instancesData,E),transferList:E}});return function(D){return y.apply(this,arguments)}}();p.extractEdgeLocations=function(){var y=b._asyncToGenerator(function*(D){D=e(D);D=h(D.data,D.skipDeduplicate,D.indices,D.indicesLength);D=f.extractEdges(D,B,u);const E=[];return{result:r.packInterleavedBuffer(D.regular.instancesData,
E),transferList:E}});return function(D){return y.apply(this,arguments)}}();return A}();const w=new k.RegularEdgeBufferWriter,t=new k.SilhouetteEdgeBufferWriter;k=function(){function A(){}var p=A.prototype;p.allocate=function(y){return C.createBuffer(y)};p.trim=function(y,D){return y.slice(0,D)};p.write=function(y,D,E){y.position0.setVec(D,E.position0);y.position1.setVec(D,E.position1)};return A}();let x=function(){function A(){}var p=A.prototype;p.allocate=function(y){return z.createBuffer(y)};p.trim=
function(y,D){return y.slice(0,D)};p.write=function(y,D,E){y.position0.setVec(D,E.position0);y.position1.setVec(D,E.position1);y.componentIndex.set(D,E.componentIndex)};return A}();const B=new k,q=new x,u={allocate:()=>null,write:()=>{},trim:()=>null},C=l.newLayout().vec3f(n.VertexAttribute.POSITION0).vec3f(n.VertexAttribute.POSITION1),z=l.newLayout().vec3f(n.VertexAttribute.POSITION0).vec3f(n.VertexAttribute.POSITION1).u16(n.VertexAttribute.COMPONENTINDEX).u16(n.VertexAttribute.U16PADDING,{glPadding:!0});
a.EdgeProcessingWorker=v;a.default=function(){return new v};a.extract=d;a.extractComponentsEdgeLocationsLayout=z;a.extractEdgeLocationsLayout=C;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/meshProcessing":function(){define(["exports"],function(a){a.computeNeighbors=function(b,c,m){c/=3;const l=new Uint32Array(m+1),r=new Uint32Array(m+1);var n=(t,x)=>{t<x?l[t+1]++:r[x+1]++};for(var g=0;g<c;g++){var k=b[3*g],f=b[3*g+1],d=b[3*g+2];
n(k,f);n(f,d);n(d,k)}g=n=0;for(k=0;k<m;k++)f=l[k+1],d=r[k+1],l[k+1]=n,r[k+1]=g,n+=f,g+=d;const e=new Uint32Array(6*c),h=l[m];n=(t,x,B)=>{t<x?(t=l[t+1]++,e[2*t]=x,e[2*t+1]=B):(x=r[x+1]++,e[2*h+2*x]=t,e[2*h+2*x+1]=B)};for(g=0;g<c;g++)k=b[3*g],f=b[3*g+1],d=b[3*g+2],n(k,f,g),n(f,d,g),n(d,k,g);n=(t,x)=>{const B=2*t;t=x-t;for(x=1;x<t;x++){const q=e[B+2*x],u=e[B+2*x+1];let C=x-1;for(C;0<=C&&e[B+2*C]>q;C--)e[B+2*C+2]=e[B+2*C],e[B+2*C+3]=e[B+2*C+1];e[B+2*C+2]=q;e[B+2*C+3]=u}};for(g=0;g<m;g++)n(l[g],l[g+1]),
n(h+r[g],h+r[g+1]);const v=new Int32Array(3*c),w=(t,x)=>t===b[3*x]?0:t===b[3*x+1]?1:t===b[3*x+2]?2:-1;c=(t,x)=>{t=w(t,x);v[3*x+t]=-1};n=(t,x,B,q)=>{t=w(t,x);v[3*x+t]=q;B=w(B,q);v[3*q+B]=x};for(g=0;g<m;g++){k=l[g];f=l[g+1];d=r[g];const t=r[g+1];for(;k<f&&d<t;){const x=e[2*k],B=e[2*h+2*d];x===B?(n(g,e[2*k+1],B,e[2*h+2*d+1]),k++,d++):x<B?(c(g,e[2*k+1]),k++):(c(B,e[2*h+2*d+1]),d++)}for(;k<f;)c(g,e[2*k+1]),k++;for(;d<t;)c(e[2*h+2*d],e[2*h+2*d+1]),d++}return v};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/buffer/workerHelper":function(){define(["exports","../../../../geometry/support/buffer/BufferView","./InterleavedLayout"],function(a,b,c){function m(n){const g=[];n.fields.forEach((k,f)=>{var d=k.constructor;g.push([f,{...k,constructor:`${d.ElementType}_${d.ElementCount}`}])});return{stride:n.stride,fields:g,fieldNames:n.fieldNames}}function l(n){const g=c.newLayout();g.stride=n.stride;g.fieldNames=n.fieldNames;n.fields.forEach(k=>
g.fields.set(k[0],{...k[1],constructor:r.get(k[1].constructor)}));return g}b=[b.BufferViewFloat,b.BufferViewVec2f,b.BufferViewVec3f,b.BufferViewVec4f,b.BufferViewMat3f,b.BufferViewMat4f,b.BufferViewFloat64,b.BufferViewVec2f64,b.BufferViewVec3f64,b.BufferViewVec4f64,b.BufferViewMat3f64,b.BufferViewMat4f64,b.BufferViewUint8,b.BufferViewVec2u8,b.BufferViewVec3u8,b.BufferViewVec4u8,b.BufferViewUint16,b.BufferViewVec2u16,b.BufferViewVec3u16,b.BufferViewVec4u16,b.BufferViewUint32,b.BufferViewVec2u32,b.BufferViewVec3u32,
b.BufferViewVec4u32,b.BufferViewInt8,b.BufferViewVec2i8,b.BufferViewVec3i8,b.BufferViewVec4i8,b.BufferViewInt16,b.BufferViewVec2i16,b.BufferViewVec3i16,b.BufferViewVec4i16,b.BufferViewInt32,b.BufferViewVec2i32,b.BufferViewVec3i32,b.BufferViewVec4i32];const r=new Map;b.forEach(n=>r.set(`${n.ElementType}_${n.ElementCount}`,n));a.packInterleavedBuffer=function(n,g){g.push(n.buffer);return{buffer:n.buffer,layout:m(n.layout)}};a.packLayout=m;a.unpackInterleavedBuffer=function(n){return l(n.layout).createView(n.buffer)};
a.unpackLayout=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("exports ../../../../../core/RandomLCG ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../support/buffer/glUtil ./bufferLayouts".split(" "),function(a,b,c,m,l,r){function n(B){const q=d;q[0]=B.position0[0];q[1]=B.position0[1];q[2]=B.position0[2];q[3]=B.position1[0];q[4]=B.position1[1];q[5]=B.position1[2];
h[0]=5381;for(B=0;B<e.length;B++)h[0]=31*h[0]+e[B];return h[0]}function g(B){const q=d;q[0]=k(B.position0[0]);q[1]=k(B.position0[1]);q[2]=k(B.position0[2]);q[3]=k(B.position1[0]);q[4]=k(B.position1[1]);q[5]=k(B.position1[2]);h[0]=5381;for(B=0;B<e.length;B++)h[0]=31*h[0]+e[B];return h[0]}function k(B){return Math.round(1E4*B)/1E4}let f=function(){function B(){}var q=B.prototype;q.updateSettings=function(u){this.settings=u;this.edgeHashFunction=u.reducedPrecision?g:n};q.write=function(u,C,z){var A=
this.edgeHashFunction(z);x.seed=A;A=x.getIntRange(0,255);const p=x.getIntRange(0,this.settings.variants-1);var y=x.getFloat();y=-(1-Math.min(y/.7,1))+Math.max(0,y-.7)/(1-.7);y=255*(Math.abs(y)**1.2*(0>y?-1:1)*.5+.5);u.position0.setVec(C,z.position0);u.position1.setVec(C,z.position1);u.componentIndex.set(C,z.componentIndex);u.variantOffset.set(C,A);u.variantStroke.set(C,p);u.variantExtension.set(C,y)};q.trim=function(u,C){return u.slice(0,C)};return B}();const d=new Float32Array(6),e=new Uint32Array(d.buffer),
h=new Uint32Array(1);let v=function(){function B(){this.commonWriter=new f}var q=B.prototype;q.updateSettings=function(u){this.commonWriter.updateSettings(u)};q.allocate=function(u){return r.RegularEdgeInstancesLayout.createBuffer(u)};q.write=function(u,C,z){this.commonWriter.write(u,C,z);c.add(t,z.faceNormal0,z.faceNormal1);c.normalize(t,t);u.normal.setVec(C,t)};q.trim=function(u,C){return this.commonWriter.trim(u,C)};return B}();v.Layout=r.RegularEdgeInstancesLayout;v.glLayout=l.glLayout(r.RegularEdgeInstancesLayout,
1);let w=function(){function B(){this.commonWriter=new f}var q=B.prototype;q.updateSettings=function(u){this.commonWriter.updateSettings(u)};q.allocate=function(u){return r.SilhouetteEdgeInstancesLayout.createBuffer(u)};q.write=function(u,C,z){this.commonWriter.write(u,C,z);u.normalA.setVec(C,z.faceNormal0);u.normalB.setVec(C,z.faceNormal1)};q.trim=function(u,C){return this.commonWriter.trim(u,C)};return B}();w.Layout=r.SilhouetteEdgeInstancesLayout;w.glLayout=l.glLayout(r.SilhouetteEdgeInstancesLayout,
1);const t=m.create(),x=new b;a.CommonBufferWriter=f;a.RegularEdgeBufferWriter=v;a.SilhouetteEdgeBufferWriter=w;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define("exports ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../core/typedArrayUtil ../../../../../chunks/vec3 ../../../../../chunks/vec3f64".split(" "),function(a,b,c,m,l,r){function n(h,v){const w=
c.acosClamped(h.cosAngle),t=f.fwd,x=f.ortho;l.direction(t,h.position1,h.position0);h=0<l.dot(l.cross(x,h.faceNormal0,h.faceNormal1),t)?-1:1;return w*h>v}function g(h){const v=h.faces.length/3,w=h.faces;h=h.neighbors;var t=0;for(var x=0;x<v;x++){var B=h[3*x+1],q=h[3*x+2],u=w[3*x],C=w[3*x+1],z=w[3*x+2];t+=-1===h[3*x]||u<C?1:0;t+=-1===B||C<z?1:0;t+=-1===q||z<u?1:0}t=new Int32Array(4*t);x=0;for(B=0;B<v;B++){q=h[3*B];u=h[3*B+1];C=h[3*B+2];z=w[3*B];const A=w[3*B+1],p=w[3*B+2];if(-1===q||z<A)t[x++]=z,t[x++]=
A,t[x++]=B,t[x++]=q;if(-1===u||A<p)t[x++]=A,t[x++]=p,t[x++]=B,t[x++]=u;if(-1===C||p<z)t[x++]=p,t[x++]=z,t[x++]=B,t[x++]=C}return t}function k(h){const v=h.faces.length/3,w=h.vertices.position;h=h.faces;const t=d.v0,x=d.v1,B=d.v2,q=new Float32Array(3*v);for(let u=0;u<v;u++){const C=h[3*u+1],z=h[3*u+2];w.getVec(h[3*u],t);w.getVec(C,x);w.getVec(z,B);l.subtract(x,x,t);l.subtract(B,B,t);l.cross(t,x,B);l.normalize(t,t);q[3*u]=t[0];q[3*u+1]=t[1];q[3*u+2]=t[2]}return q}a.EdgeType=void 0;(function(h){h[h.SOLID=
0]="SOLID";h[h.SKETCH=1]="SKETCH"})(a.EdgeType||(a.EdgeType={}));const f={edge:{position0:r.create(),position1:r.create(),faceNormal0:r.create(),faceNormal1:r.create(),componentIndex:0,cosAngle:0},ortho:r.create(),fwd:r.create()},d={v0:r.create(),v1:r.create(),v2:r.create()},e={anglePlanar:4,angleSignificantEdge:35};a.extractEdges=function(h,v,w,t=e){const x=h.vertices.position;var B=h.vertices.componentIndex,q=c.deg2rad(t.anglePlanar);t=c.deg2rad(t.angleSignificantEdge);const u=Math.cos(t),C=Math.cos(q),
z=f.edge,A=z.position0,p=z.position1,y=z.faceNormal0,D=z.faceNormal1,E=k(h),F=g(h),G=F.length/4;h=v.allocate(G);t=0;const P=w.allocate(G);let K=0,N=0,M=0;const L=b.range(0,G),J=new Float32Array(G);m.forEach(J,(Q,S,T)=>{x.getVec(F[4*S],A);x.getVec(F[4*S+1],p);T[S]=l.distance(A,p)});L.sort((Q,S)=>J[S]-J[Q]);const H=[],I=[];for(let Q=0;Q<G;Q++){var O=L[Q];const S=J[O],T=F[4*O],U=F[4*O+1],aa=F[4*O+2];O=F[4*O+3];const W=-1===O;x.getVec(T,A);x.getVec(U,p);if(W)l.set(y,E[3*aa],E[3*aa+1],E[3*aa+2]),l.copy(D,
y),z.componentIndex=B.get(T),z.cosAngle=l.dot(y,D);else{l.set(y,E[3*aa],E[3*aa+1],E[3*aa+2]);l.set(D,E[3*O],E[3*O+1],E[3*O+2]);z.componentIndex=B.get(T);z.cosAngle=l.dot(y,D);if(z.cosAngle>C)continue;-.9999>z.cosAngle&&l.copy(D,y)}N+=S;M++;W||z.cosAngle<u?(v.write(h,t++,z),H.push(S)):n(z,q)&&(w.write(P,K++,z),I.push(S))}B=new Float32Array(H.reverse());q=new Float32Array(I.reverse());return{regular:{instancesData:v.trim(h,t),lodInfo:{lengths:B}},silhouette:{instancesData:w.trim(P,K),lodInfo:{lengths:q}},
averageEdgeLength:N/M}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["exports","./ManagedTextureBackedBuffer"],function(a,b){let c=function(){function m(r,n=1){this.rctx=r;this.fieldCount=n;this.buffers=[]}var l=m.prototype;l.garbageCollect=function(){this.buffers=this.buffers.filter(r=>0===r.activeCount?(r.dispose(),!1):!0)};l.destroy=function(){this.buffers.forEach(r=>
r.dispose());this.buffers=[]};l.getBuffer=function(r){for(const n of this.buffers)if(n.availableCount>=r)return n;if(r>b.MAX_INDEX_COUNT)return null;r=new b.ManagedTextureBackedBuffer(this.rctx,this.fieldCount);this.buffers.push(r);return r};l.updateTextures=function(){for(const r of this.buffers)r.textureBuffer.updateTexture()};return m}();a.BufferManager=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","./SimpleIndexManager","./TextureBackedBuffer"],function(a,b,c,m){let l=function(){function r(g,k=1){this.textureBuffer=new m.TextureBackedBuffer(g,k);this.indexManager=new c.SimpleIndexManager(65536)}var n=r.prototype;n.dispose=function(){this.textureBuffer.dispose();this.textureBuffer=void 0};n.acquireIndex=function(){const g=this.indexManager.acquire();this.textureBuffer.resizeToFit(g);return g};n.releaseIndex=function(g){this.indexManager.release(g)};
b._createClass(r,[{key:"availableCount",get:function(){return this.indexManager.availableCount}},{key:"activeCount",get:function(){return this.indexManager.activeCount}}]);return r}();a.MAX_INDEX_COUNT=65536;a.ManagedTextureBackedBuffer=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=
function(){function m(r){this.maxCount=r;this._nextIndex=0;this.recycledIndices=[]}var l=m.prototype;l.acquire=function(){if(0<this.recycledIndices.length)return this.recycledIndices.pop();if(this.availableCount)return this._nextIndex++};l.release=function(r){this.recycledIndices.push(r)};b._createClass(m,[{key:"activeCount",get:function(){return this._nextIndex-this.recycledIndices.length}},{key:"availableCount",get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex}}]);
return m}();a.SimpleIndexManager=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["exports","../../../../../geometry/support/buffer/BufferView","../../../../webgl/enums","../../../../webgl/Texture"],function(a,b,c,m){let l=function(){function r(g,k=1){this.rctx=g;this.fieldCount=k;this.textureWidth=4096;this.dirty=!0;this.texture=new m.Texture(this.rctx,{target:c.TextureType.TEXTURE_2D,
pixelFormat:c.PixelFormat.RGBA,dataType:c.PixelType.UNSIGNED_BYTE,samplingMode:c.TextureSamplingMode.NEAREST,wrapMode:c.TextureWrapMode.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1});this.data=new b.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}var n=r.prototype;n.dispose=function(){this.texture.dispose();this.data=this.texture=void 0};n.setData=function(g,k,f,d,e,h){g=g*this.fieldCount+k;this.dirty=!0;this.data.set(g,0,f);this.data.set(g,1,d);this.data.set(g,2,e);this.data.set(g,
3,h)};n.setDataElement=function(g,k,f,d){g=g*this.fieldCount+k;this.dirty=!0;this.data.set(g,f,d)};n.resizeToFit=function(g){g*=this.fieldCount;g>=this.data.count&&(g=new b.BufferViewVec4u8(new ArrayBuffer(Math.ceil((g+1)/this.textureWidth)*this.textureWidth*4)),g.typedBuffer.set(this.data.typedBuffer),this.data=g)};n.updateTexture=function(){if(this.dirty){var g=this.texture.descriptor.width;this.data.count>g*this.texture.descriptor.height&&this.texture.resize(g,this.data.count/g);this.texture.setData(this.data.typedBuffer);
this.dirty=!1}};n.bind=function(g,k,f){g.bindTexture(k,this.texture);g.setUniform2f(f,1/this.texture.descriptor.width,1/this.texture.descriptor.height)};return r}();a.TextureBackedBuffer=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/CompositingHelper":function(){define("../../../../core/maybe ../../terrain/interfaces ./glUtil3D ../../../../chunks/Compositing.glsl ../shaders/CompositingTechnique ../shaders/CompositingTechniqueConfiguration ../../../webgl/enums ../../../webgl/Util".split(" "),
function(a,b,c,m,l,r,n,g){return function(){function k(d,e){this._rctx=d;this._techniqueRepository=e;this._configuration=new r.CompositingTechniqueConfiguration;this._passParameters=new m.CompositingPassParameters}var f=k.prototype;f.dispose=function(){this._vao=a.disposeMaybe(this._vao)};f.compositeTransparent=function(d,e,h,v,w=1){this._configuration.alphaMode=r.AlphaMode.Alpha;this._configuration.function=r.CompositingFunction.Transparency;this._configuration.hasOpacityFactor=1!==w;this._passParameters.colorTexture=
e;this._passParameters.alphaTexture=h;this._passParameters.frontFaceTexture=v;e=this._rctx;h=this._techniqueRepository.acquire(l.CompositingTechnique,this._configuration);e.bindTechnique(h,this._passParameters,d);d=this._ensureVAO();e.bindVAO(d);e.drawArrays(n.PrimitiveType.TRIANGLE_STRIP,0,g.vertexCount(d,"geometry"));h.release()};f.composite=function(d,e,h=r.AlphaMode.None,v=1,w=r.CompositingFunction.Standard,t=b.OverlayIndex.INNER){const x=this._rctx;this._configuration.alphaMode=h;this._configuration.function=
w;this._configuration.hasOpacityFactor=1!==v;this._passParameters.overlayIndex=t;this._passParameters.texture=e;this._passParameters.opacity=v;e=this._techniqueRepository.acquire(l.CompositingTechnique,this._configuration);x.bindTechnique(e,this._passParameters,d);d=this._ensureVAO();x.bindVAO(d);x.drawArrays(n.PrimitiveType.TRIANGLE_STRIP,0,g.vertexCount(d,"geometry"));e.release()};f._ensureVAO=function(){a.isNone(this._vao)&&(this._vao=c.createQuadVAO(this._rctx));return this._vao};return k}()})},
"esri/chunks/Compositing.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../core/compilerUtils ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/IntegerPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/shaders/CompositingTechniqueConfiguration".split(" "),
function(a,b,c,m,l,r,n,g,k,f){function d(v){const w=new g.ShaderBuilder;w.include(m.ScreenSpacePass);const t=w.fragment;switch(v.function){case f.CompositingFunction.Standard:t.uniforms.add(new k.Texture2DPassUniform("tex",x=>x.texture));v.hasOpacityFactor?(t.uniforms.add(new l.FloatPassUniform("opacity",x=>x.opacity)),t.code.add(n.glsl`void main() {
gl_FragColor = texture2D(tex, uv) * opacity;
}`)):t.code.add(n.glsl`void main() {
gl_FragColor = texture2D(tex, uv);
}`);break;case f.CompositingFunction.OverlayWithTransparency:t.uniforms.add(new k.Texture2DPassUniform("tex",x=>x.texture));t.uniforms.add(new r.IntegerPassUniform("overlayIdx",x=>x.overlayIndex));v.hasOpacityFactor&&t.uniforms.add(new l.FloatPassUniform("opacity",x=>x.opacity));t.code.add(n.glsl`
        void main() {
          vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
          gl_FragColor = texture2D(tex, overlayUV) ${v.hasOpacityFactor?"* opacity":""};
        }`);break;case f.CompositingFunction.TransparentToHUDVisibility:t.uniforms.add(new k.Texture2DPassUniform("tex",x=>x.texture));t.code.add(n.glsl`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`);break;case f.CompositingFunction.Transparency:t.uniforms.add([new k.Texture2DPassUniform("colorTexture",x=>x.colorTexture),new k.Texture2DPassUniform("alphaTexture",x=>x.alphaTexture),new k.Texture2DPassUniform("frontFaceTexture",x=>x.frontFaceTexture)]);t.code.add(n.glsl`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`);break;case f.CompositingFunction.COUNT:break;default:c.neverReached(v.function)}return w}let e=function(v){function w(){var t=v.apply(this,arguments)||this;t.overlayIndex=0;t.opacity=1;return t}b._inheritsLoose(w,v);return w}(n.NoParameters);const h=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:e,build:d},Symbol.toStringTag,{value:"Module"}));a.Compositing=h;a.CompositingPassParameters=e;a.build=d})},"esri/views/3d/webgl-engine/shaders/CompositingTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/Compositing.glsl ./CompositingTechniqueConfiguration ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){l=function(e){function h(){return e.apply(this,arguments)||this}c._inheritsLoose(h,e);var v=h.prototype;v.initializeProgram=function(w){const t=h.shader.get().build(this.configuration);return new n.Program(w.rctx,t,r.Default3D)};v.initializePipeline=function(){if(this.configuration.function===k.CompositingFunction.TransparentToHUDVisibility)return d.makePipelineState({colorWrite:{r:!1,g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case k.AlphaMode.None:return d.makePipelineState({colorWrite:d.defaultColorWriteParams});
case k.AlphaMode.Alpha:return d.makePipelineState({blending:d.separateBlendingParams(f.BlendFactor.SRC_ALPHA,f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA,f.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:d.defaultColorWriteParams});default:return d.makePipelineState({blending:d.simpleBlendingParams(f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:d.defaultColorWriteParams})}};return h}(l.ShaderTechnique);l.shader=new m.ReloadableShaderModule(g.Compositing,()=>new Promise((e,h)=>
a(["./Compositing.glsl"],e,h)));b.CompositingTechnique=l;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/floatRGBA ../../../../core/maybe ../../../../core/PooledArray ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../chunks/sphere ../../support/mathUtils ./depthRange ./Octree ./Util".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t){function x(M,L){if(L.isVisible){var J=v.empty(),H=L.getSpatialQueryAccelerator();m.isSome(H)?B(J,M,H):q(J,M,L.objects);return J}}function B(M,L,J){var H=L.eye;const I=L.viewForward,O=L.frustum,Q=T=>T.isVisible;var S=J.objectCount;500>S?(v.set(G,L.near,Math.min(M.near,L.far)),J.forEachInDepthRange(H,I,w.DepthOrder.FRONT_TO_BACK,G,(T,U)=>{u(M,L,T);G.far=M.near;U.setRange(G)},O,Q),v.set(G,Math.max(M.far,L.near),L.far),J.forEachInDepthRange(H,I,w.DepthOrder.BACK_TO_FRONT,
G,(T,U)=>{u(M,L,T);G.near=M.far;U.setRange(G)},O,Q)):(S=Math.max(Math.min(S,500),Math.ceil(.1*S)),H=J.findClosest(I,w.DepthOrder.FRONT_TO_BACK,O,Q,S),J=J.findClosest(I,w.DepthOrder.BACK_TO_FRONT,O,Q,S),H&&J&&(z(M,L,H.boundingVolumeWorldSpace.bounds),z(M,L,J.boundingVolumeWorldSpace.bounds)))}function q(M,L,J){P.clear();J.forAll(H=>{H.isVisible&&0!==H.geometryRecords.length&&P.add(H)});P.empty||(P.sort(L),v.set(G,L.near,Math.min(M.near,L.far)),P.forEachInDepthRange(G,w.DepthOrder.FRONT_TO_BACK,(H,
I)=>{I<M.near&&u(M,L,H)}),v.set(G,Math.max(M.far,L.near),L.far),P.forEachInDepthRange(G,w.DepthOrder.BACK_TO_FRONT,(H,I,O)=>{M.far=Math.max(M.far,O)}))}function u(M,L,J){if(J.isVisible&&d.intersectsSphere(L.frustum,J.boundingVolumeWorldSpace.bounds)){var H=J.transformation,I=F;J.geometryRecords.forEach(O=>{r.multiply(I,H,O.getShaderTransformation());const Q=h.maxScale(I);C(M,L,O.geometry.boundingInfo,I,Q)})}}function C(M,L,J,H,I){if(!m.isNone(J)){var O=L.eye,Q=L.viewForward;g.transformMat4(E,J.center,
H);O=Q[0]*(E[0]-O[0])+Q[1]*(E[1]-O[1])+Q[2]*(E[2]-O[2]);E[3]=J.radius*I;if(!(O-E[3]>M.near&&O+E[3]<M.far)&&d.intersectsSphere(L.frustum,E))if(100<J.radius&&J.getChildren())for(J=J.getChildren(),O=0;8>O;++O)J[O]&&C(M,L,J[O],H,I);else N.unionDepthRangeWithAABB(M,L.viewProjectionMatrix,H,J.bbMin,J.bbMax)}}function z(M,L,J){var H=L.eye;L=L.viewForward;H=(J[0]-H[0])*L[0]+(J[1]-H[1])*L[1]+(J[2]-H[2])*L[2];M.near=Math.min(M.near,H-J[3]);M.far=Math.max(M.far,H+J[3])}let A=function(){function M(){this._items=
new l({allocator:J=>J||{obj:null,distance:0,near:0,far:0},deallocator:J=>{J.obj=null;J.distance=0;J.near=0;J.far=0;return J}})}var L=M.prototype;L.clear=function(){this._items.clear()};L.add=function(J){this._items.pushNew().obj=J};L.sort=function(J){const H=J.eye,I=J.viewForward;this._items.forAll(O=>{const Q=O.obj.boundingVolumeWorldSpace.bounds,S=(Q[0]-H[0])*I[0]+(Q[1]-H[1])*I[1]+(Q[2]-H[2])*I[2];O.distance=S;O.near=S-Q[3];O.far=S+Q[3]});this._items.sort((O,Q)=>O.distance-Q.distance)};L.forEachInDepthRange=
function(J,H,I){if(H===w.DepthOrder.FRONT_TO_BACK)for(H=0;H<this._items.length;++H){var O=this._items.data[H];O.far<J.near||O.near>J.far||I(O.obj,O.near,O.far)}else for(H=this._items.length-1;0<=H;--H)O=this._items.data[H],O.far<J.near||O.near>J.far||I(O.obj,O.near,O.far)};b._createClass(M,[{key:"length",get:function(){return this._items.length}},{key:"empty",get:function(){return 0===this._items.length}}]);return M}(),p=function(){function M(){this.view=n.create();this.viewProj=n.create();this.frustum=
d.create();this.geometries=[];this.near=[];this.far=[];this.nearCandidates=[];this.farCandidates=[];this.range={near:0,far:0};this.looseRange={near:0,far:0}}var L=M.prototype;L.compute=function(J,H){this._reset();r.copy(this.view,J.viewMatrix);r.multiply(this.viewProj,J.projectionMatrix,this.view);d.copy(this.frustum,J.frustum);J=this.view;const I=J[2],O=J[6],Q=J[10],S=J[14];J=this.range;let T=0;H.forEach(W=>{if(W.instanceParameters.visible&&W.castShadow){if(W.hasShaderTransformation){W.computeBoundingSphere(W.getShaderTransformation(),
E,1);var R=E}else R=W.boundingSphere;var V=I*R[0]+O*R[1]+Q*R[2]+S,da=V-R[3];R=V+R[3];this.geometries[T]=W;this.near[T]=-R;this.far[T]=-da;++T}});if(0===this.geometries.length)return J;for(H=0;H<this.geometries.length;++H)this.near[H]>J.far&&(J.far=this.near[H]),2<this.near[H]&&this.far[H]<J.near&&(J.near=this.far[H]);H=this.looseRange;H.near=Math.max(.5*J.near,2);H.far=2*J.far;var U=0;let aa=0;for(let W=0;W<this.geometries.length;++W)this.near[W]<J.near&&(this.near[W]>=H.near?J.near=this.near[W]:
this.nearCandidates[U++]=W),this.far[W]>J.far&&(this.far[W]<=H.far?J.far=this.far[W]:this.farCandidates[aa++]=W);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return J;this.nearCandidates.sort((W,R)=>this.near[W]<this.near[R]?-1:this.near[W]>this.near[R]?1:0);this.farCandidates.sort((W,R)=>this.far[W]<this.far[R]?1:this.far[W]>this.far[R]?-1:0);for(H=0;H<this.nearCandidates.length;++H)U=this.nearCandidates[H],this.near[U]<J.near&&(U=this.geometries[U],this._includeNearBoundingInfoRec(U.boundingInfo,
U.getShaderTransformation()));for(H=0;H<this.farCandidates.length;++H)U=this.farCandidates[H],this.far[U]>J.far&&(U=this.geometries[U],this._includeFarBoundingInfoRec(U.boundingInfo,U.getShaderTransformation()));return J};L._reset=function(){this.geometries.length=0;this.near.length=0;this.far.length=0;this.nearCandidates.length=0;this.farCandidates.length=0;this.range.near=Number.MAX_VALUE;this.range.far=-Number.MAX_VALUE};L._includeNearBoundingInfoRec=function(J,H){if(!m.isNone(J)){var I=J.getCenter();
g.transformMat4(E,I,H);I=h.maxScale(H);var O=E[0],Q=E[1],S=E[2];I*=J.getBSRadius();var T=this.frustum;if(!(T[0][0]*O+T[0][1]*Q+T[0][2]*S+T[0][3]>I||T[1][0]*O+T[1][1]*Q+T[1][2]*S+T[1][3]>I||T[2][0]*O+T[2][1]*Q+T[2][2]*S+T[2][3]>I||T[3][0]*O+T[3][1]*Q+T[3][2]*S+T[3][3]>I||(O=this.view[2]*O+this.view[6]*Q+this.view[10]*S+this.view[14],Q=O+I,2>-(O-I)||-Q>=this.range.near)))if(-Q>this.looseRange.near)this.range.near=-Q;else{if(100<I&&(I=J.getChildren(),void 0!==I)){for(J=0;8>J;++J)void 0!==I[J]&&this._includeNearBoundingInfoRec(I[J],
H);return}N.unionDepthRangeWithAABB(this.range,this.viewProj,H,J.getBBMin(),J.getBBMax())}}};L._includeFarBoundingInfoRec=function(J,H){if(!m.isNone(J)){var I=J.getBSRadius(),O=J.getCenter();g.transformMat4(E,O,H);var Q=h.maxScale(H);O=E[0];var S=E[1],T=E[2];I*=Q;Q=this.frustum;if(!(Q[0][0]*O+Q[0][1]*S+Q[0][2]*T+Q[0][3]>I||Q[1][0]*O+Q[1][1]*S+Q[1][2]*T+Q[1][3]>I||Q[2][0]*O+Q[2][1]*S+Q[2][2]*T+Q[2][3]>I||Q[3][0]*O+Q[3][1]*S+Q[3][2]*T+Q[3][3]>I||(O=this.view[2]*O+this.view[6]*S+this.view[10]*T+this.view[14]-
I,-O<=this.range.far)))if(-O<this.looseRange.far)this.range.far=-O;else{if(100<I&&(I=J.getChildren(),void 0!==I)){for(J=0;8>J;++J)void 0!==I[J]&&this._includeFarBoundingInfoRec(I[J],H);return}N.unionDepthRangeWithAABB(this.range,this.viewProj,H,J.getBBMin(),J.getBBMax())}}};return M}(),y=function(){function M(){this.modelViewProj=n.create();this.clipPosition=[f.create(),f.create(),f.create(),f.create(),f.create(),f.create(),f.create(),f.create()]}var L=M.prototype;L.unionDepthRangeWithAABB=function(J,
H,I,O,Q){var S=this.modelViewProj;r.multiply(S,H,I);H=!1;for(I=0;8>I;++I){const T=this.clipPosition[I],U=0===I||3===I||4===I||7===I?O[0]:Q[0],aa=0===I||1===I||4===I||5===I?O[1]:Q[1],W=4>I?O[2]:Q[2];T[0]=S[0]*U+S[4]*aa+S[8]*W+S[12];T[1]=S[1]*U+S[5]*aa+S[9]*W+S[13];T[2]=S[2]*U+S[6]*aa+S[10]*W+S[14];T[3]=S[3]*U+S[7]*aa+S[11]*W+S[15]}for(O=0;12>O;++O){Q=this._clipTriangle(this.clipPosition[D[O][0]],this.clipPosition[D[O][1]],this.clipPosition[D[O][2]]);S=!0;for(I=0;I<Q.length;++I)if(2<=Q[I][3]){S=!1;
break}if(!S)for(H=!0,S=0;S<Q.length;++S)I=Q[S][3],I<J.near&&(J.near=I),I>J.far&&(J.far=I)}return H};L._inside=function(J,H){if(0===H)return J[0]>=-J[3];if(1===H)return J[1]>=-J[3];if(2===H)return J[0]<=J[3];if(3===H)return J[1]<=J[3];t.assert(!1)};L._intersect=function(J,H,I){let O=0;0===I?O=(-J[3]-J[0])/(H[0]-J[0]+H[3]-J[3]):1===I?O=(-J[3]-J[1])/(H[1]-J[1]+H[3]-J[3]):2===I?O=(J[3]-J[0])/(H[0]-J[0]-H[3]+J[3]):3===I&&(O=(J[3]-J[1])/(H[1]-J[1]-H[3]+J[3]));return k.lerp(f.create(),J,H,O)};L._clipTriangle=
function(J,H,I){J=[J,H,I];for(H=0;4>H;++H){I=J;J=[];for(let O=0;O<I.length;++O){const Q=I[O],S=I[(O+1)%I.length];this._inside(S,H)?(this._inside(Q,H)||J.push(this._intersect(Q,S,H)),J.push(S)):this._inside(Q,H)&&J.push(this._intersect(Q,S,H))}}return J};return M}();const D=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],E=e.create(),F=n.create(),G=v.empty(),P=new A,K=new p,N=new y;a.DepthRangeFromRenderGeometries=p;a.depthRangeFromLayer=x;a.depthRangeFromScene=
function(M,L,J){if(1E4>L.size)return K.compute(M,L);const H=v.empty();J.forAll(I=>{I.isVisible&&v.union(H,x(M,I))});return H};a.textureToDepth=function(M,L,J){return c.unpackFloatRGBA(L,M)*(J[1]-J[0])+J[0]};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/MagnifierHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../support/requestImageUtils ./DefaultVertexBufferLayouts ./glUtil3D ./Program ./VertexAttribute ../shaders/Magnifier.glsl ../../../magnifier/resources ../../../webgl/enums ../../../webgl/renderState ../../../webgl/Texture".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E){a.MagnifierHelper=function(F){function G(){var K=F.apply(this,arguments)||this;K._handles=new r;K._magnifier=null;K._imageSources=null;K._imageLoadTask=null;K._resources=null;K._passParameters=new A.MagnifierPassParameters;K.events=new l;K.attributeLocations=new Map([[z.VertexAttribute.POSITION,0]]);K.tmpScreenPoint=d.createScreenPointArray();K.tmpRenderPoint=d.createRenderScreenPointArray();return K}b._inheritsLoose(G,F);var P=G.prototype;
P.dispose=function(){this._magnifier=null;this._handles.destroy();g.isSome(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null);this._disposeResources()};P.render=function(K,N){var M=this._validMagnifier;if(!g.isNone(M)){var L=N.camera.pixelRatio,J=Math.ceil(L*M.size);this._updateResources(K,J);if(!g.isNone(this._resources)){this._passParameters.maskEnabled=M.maskEnabled;this._passParameters.overlayEnabled=M.overlayEnabled;var H=this._resources.program;K.useProgram(H);
H.bindPass(this._passParameters,N);var I=this._resources.textures,O=Math.ceil(1/this.factor*J);I.input.resize(O,O);var Q=N.camera.fullWidth,S=N.camera.fullHeight;d.screenPointObjectToArray(M.position,this.tmpScreenPoint);N=N.camera.screenToRender(this.tmpScreenPoint,this.tmpRenderPoint);var T=.5*O,U=.5*O;N[0]=n.clamp(N[0],T,Q-T-1);N[1]=n.clamp(N[1],U,S-U-1);T=Math.floor(N[0]-T);U=Math.floor(N[1]-U);H.bindTexture("textureInput",I.input);K.gl.copyTexImage2D(I.input.descriptor.target,0,I.input.descriptor.pixelFormat,
T,U,O,O,0);O=-1+(N[0]+M.offset.x*L)/Q*2;M=-1+(N[1]-M.offset.y*L)/S*2;Q=J/Q*2;J=J/S*2;K.bindVAO(this._resources.vao);H.bindTexture("textureOverlay",I.overlay);H.bindTexture("textureMask",I.mask);H.setUniform4f("drawPosition",O,M,Q,J);K.setPipelineState(this._resources.pipelineState);K.drawArrays(y.PrimitiveType.TRIANGLE_STRIP,0,4)}}};P._updateResourceLoading=function(){var K=this;const N=this._validMagnifier;if(!g.isNone(N)){var M=N.maskUrl,L=N.overlayUrl;!g.isSome(this._imageLoadTask)||this._imageLoadTask.maskUrl===
M&&this._imageLoadTask.overlayUrl===L||(this._imageLoadTask.task.abort(),this._imageSources=this._imageLoadTask=null);g.isSome(this._imageSources)||g.isSome(this._imageLoadTask)||(this._imageLoadTask={maskUrl:M,overlayUrl:L,task:k.createTask(function(){var J=b._asyncToGenerator(function*(H){const I=g.isNone(M)||g.isNone(L)?p.loadMagnifierResources(H):null,O=g.isSome(M)?B.requestImage(M,{signal:H}):I.then(Q=>Q.mask);H=g.isSome(L)?B.requestImage(L,{signal:H}):I.then(Q=>Q.overlay);K._imageSources={mask:yield O,
overlay:yield H};K._disposeResources();K.events.emit("request-render")});return function(H){return J.apply(this,arguments)}}())},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}};P._updateResources=function(K,N){this.enabled?g.isSome(this._resources)?this._resources.textures.size!==N&&(K=this._createTextureResources(K,N),g.isNone(K)?this._disposeResources():(this._disposeTextureResources(this._resources.textures),this._resources.textures=
K)):(N=this._createTextureResources(K,N),g.isNone(N)||(this._resources={textures:N,program:this._createProgram(K),vao:u.createQuadVAO(K,q.Pos2,this.attributeLocations,0,1),pipelineState:D.makePipelineState({blending:D.simpleBlendingParams(y.BlendFactor.ONE,y.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:D.defaultColorWriteParams})})):this._disposeResources()};P._disposeResources=function(){g.isNone(this._resources)||(this._disposeTextureResources(this._resources.textures),
this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)};P._disposeTextureResources=function(K){K.mask.dispose();K.overlay.dispose();K.input.dispose()};P._createTextureResources=function(K,N){if(g.isNone(this._imageSources))return null;this._imageSources.overlay.width=N;this._imageSources.overlay.height=N;this._imageSources.mask.width=N;this._imageSources.mask.height=N;const M=new E.Texture(K,{target:y.TextureType.TEXTURE_2D,pixelFormat:y.PixelFormat.RGBA,internalFormat:y.PixelFormat.RGBA,
dataType:y.PixelType.UNSIGNED_BYTE,wrapMode:y.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:y.TextureSamplingMode.LINEAR,flipped:!0,preMultiplyAlpha:e.isSVG(this._imageSources.overlay.src)&&K.driverTest.svgAlwaysPremultipliesAlpha?!1:!0},this._imageSources.overlay),L=new E.Texture(K,{target:y.TextureType.TEXTURE_2D,pixelFormat:y.PixelFormat.ALPHA,internalFormat:y.PixelFormat.ALPHA,dataType:y.PixelType.UNSIGNED_BYTE,wrapMode:y.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:y.TextureSamplingMode.LINEAR,flipped:!0},
this._imageSources.mask);return{input:new E.Texture(K,{target:y.TextureType.TEXTURE_2D,pixelFormat:y.PixelFormat.RGBA,internalFormat:y.PixelFormat.RGBA,dataType:y.PixelType.UNSIGNED_BYTE,wrapMode:y.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:y.TextureSamplingMode.LINEAR,flipped:!1}),mask:L,overlay:M,size:N}};P._createProgram=function(K){return new C.Program(K,A.build(),this.attributeLocations)};b._createClass(G,[{key:"updating",get:function(){return g.isNone(this._imageSources)&&g.isSome(this._imageLoadTask)&&
!this._imageLoadTask.task.finished}},{key:"magnifier",get:function(){return this._magnifier},set:function(K){K!==this._magnifier&&(this._handles.removeAll(),this._magnifier=K,K=()=>{this._updateResourceLoading();this.events.emit("request-render")},g.isSome(this._magnifier)&&this._handles.add(f.watch(()=>g.applySome(this._magnifier,N=>N.version),K)),K())}},{key:"enabled",get:function(){return g.isSome(this._validMagnifier)}},{key:"_validMagnifier",get:function(){return g.isSome(this._magnifier)&&this._magnifier.visible&&
g.isSome(this._magnifier.position)&&0<this._magnifier.size?this._magnifier:null}},{key:"factor",get:function(){return g.isSome(this._magnifier)?this._magnifier.factor||1:1}}]);return G}(m);c.__decorate([h.property()],a.MagnifierHelper.prototype,"_imageSources",void 0);c.__decorate([h.property()],a.MagnifierHelper.prototype,"_imageLoadTask",void 0);c.__decorate([h.property({readOnly:!0})],a.MagnifierHelper.prototype,"updating",null);a.MagnifierHelper=c.__decorate([x.subclass("esri/views/3d/webgl-engine/lib/MagnifierHelper")],
a.MagnifierHelper);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/Magnifier.glsl":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderModules/BooleanPassUniform ../core/shaderModules/Float4Uniform ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder ../core/shaderModules/Texture2DUniform ../lib/VertexAttribute".split(" "),function(a,b,c,m,l,r,n,g){let k=function(f){function d(){var e=
f.apply(this,arguments)||this;e.maskEnabled=!1;e.overlayEnabled=!1;return e}b._inheritsLoose(d,f);return d}(l.NoParameters);a.MagnifierPassParameters=k;a.build=function(){const f=new r.ShaderBuilder;f.attributes.add(g.VertexAttribute.POSITION,"vec2");f.vertex.uniforms.add(new m.Float4Uniform("drawPosition"));f.varyings.add("vUV","vec2");f.vertex.code.add(l.glsl`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`);f.fragment.uniforms.add(new n.Texture2DUniform("textureInput"));f.fragment.uniforms.add(new n.Texture2DUniform("textureMask"));f.fragment.uniforms.add(new n.Texture2DUniform("textureOverlay"));f.fragment.uniforms.add(new c.BooleanPassUniform("maskEnabled",d=>d.maskEnabled));f.fragment.uniforms.add(new c.BooleanPassUniform("overlayEnabled",d=>d.overlayEnabled));f.fragment.code.add(l.glsl`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`);return f};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/magnifier/resources":function(){define(["require","exports","../../chunks/_rollupPluginBabelHelpers","../../core/promiseUtils","../../support/requestImageUtils"],function(a,b,c,m,l){function r(){r=c._asyncToGenerator(function*(g){var k=new Promise((d,e)=>a(["./mask-svg"],h=>d(n(h)),e)),f=new Promise((d,e)=>a(["./overlay-svg"],h=>d(n(h)),e));k=l.requestImage((yield k).default,{signal:g});
f=l.requestImage((yield f).default,{signal:g});f={mask:yield k,overlay:yield f};m.throwIfAborted(g);return f});return r.apply(this,arguments)}const n=g=>Object.freeze(Object.defineProperty({__proto__:null,default:g},Symbol.toStringTag,{value:"Module"}));b.loadMagnifierResources=function(g){return r.apply(this,arguments)};Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Handles ../../../../core/MapUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/time ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/boundedPlane ../../support/animationUtils ../../support/debugFlags ../core/renderPasses/RenderPassManager ../core/shaderLibrary/hud/HUDUniforms ./basicInterfaces ./BoundingInfo ./depthRange ./depthRangeUtils ./glUtil3D ./Highlight ./Material ./OffscreenRendering ./RenderContext ./rendererUtils ./RenderPass ./RenderPluginManager ./RenderSlot ./ShadowAccumulator ./ShadowHighlight ./ShadowMap ./SliceHelper ./SmaaRenderPass ./SSAOHelper ./edgeRendering/EdgeView ./edgeRendering/interfaces ../materials/renderers/MergedRenderer ../shaders/CompositingTechniqueConfiguration ../statistics/RendererPerformanceInfo ../../../webgl/enums".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N,M,L,J,H,I,O,Q,S,T,U,aa,W,R,V){a.Renderer=function(la){function Y(ba,Z,fa,ja,oa,sa,qa,Ha,Ga){var pa=la.call(this,{})||this;pa._materialRepository=ba;pa._shaderTechniqueRepository=fa;pa._rctx=ja;pa._compositingHelper=oa;pa._magnifierHelper=sa;pa._requestRender=qa;pa._stage=Ga;pa._materialRenderers=new Map;pa._needsTransparentPass=!1;pa._hasHUDElements=!1;pa._hasHighlights=!1;pa._hasWater=!1;pa._hasOverlayWater=!1;pa._content=new Map;
pa._isRendering=!1;pa._fallbackDepthStencilTexture=null;pa.performanceInfo=new R.RendererPerformanceInfo;pa._antialiasing=z.AntiAliasingMode.SMAA;pa._oitEnabled=!1;pa._multipassTerrain=!0;pa._transparentTerrain=!1;pa._hasAnimations=!1;pa._animationTimestep=f.Milliseconds(0);pa._handles=new r;pa._renderHiddenTransparentEdges=()=>{};pa._oitUsed=!1;pa._smaaPass=new Q.SmaaRenderPass(pa._rctx,fa);pa._oitEnabled=pa._hasOITSupport;pa._requestRender();pa._offscreenRendering=new G.OffscreenRendering(pa._rctx,
pa._compositingHelper);pa._sliceHelper=new O;pa._shadowMap=new I.ShadowMap(pa._rctx,Ga.viewingMode,2);pa._ssaoHelper=new S.SSAOHelper(fa,pa._rctx,()=>pa._requestRender());pa._highlight=new E.Highlight(fa,pa._rctx);pa._shadowHighlight=new H.ShadowHighlight(pa._rctx,Ga.viewingMode);pa._shadowAccumulator=new J.ShadowAccumulator(pa._rctx,fa,Ga,Da=>{const ra=pa.shadowsEnabled;pa._shadowMap.enabled=!0;pa._ensureCameraBindParameters(Da.camera,Da.contentCamera);pa._renderPlugins.prepareRender();pa._shadowMap.enabled=
ra},(Da,ra,Ea)=>{Da.shadowMap.start(Da.camera,ra,Ea);pa._renderShadowCascades(N.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL,Da.shadowMap);Da.camera.setGLViewport(pa._rctx);pa._ensureCameraBindParameters(Da.camera,Da.contentCamera)},()=>pa._requestRender());pa._renderContext=new P.RenderContext(pa._rctx,pa._offscreenRendering,pa._shadowMap,pa._ssaoHelper,pa._sliceHelper);pa._renderPlugins=new M.RenderPluginManager({renderContext:pa._renderContext,shaderTechniqueRepository:fa,textureRep:Z,materialRep:pa._materialRepository,
requestRender:pa._requestRender,schedule:Ha});pa.renderPassManager=new u.RenderPassManager(pa._rctx,pa._shaderTechniqueRepository);pa._renderPlugins.add(pa.renderPassManager.slots(),pa.renderPassManager);pa._handles.add([k.watch(()=>pa._stage.state.camera,()=>pa._requestRender(),k.syncAndInitial),k.watch(()=>q.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,Da=>{pa._renderHiddenTransparentEdges=Da?()=>pa._renderEdges(U.Transparency.TRANSPARENT):()=>{};pa._requestRender()},k.initial)]);return pa}b._inheritsLoose(Y,
la);var ea=Y.prototype;ea.normalizeCtorArgs=function(){return{}};ea.dispose=function(){this._handles.destroy();this._smaaPass.dispose();this._materialRenderers.forEach(ba=>ba.dispose());this._materialRenderers.clear();this._edgeView=g.destroyMaybe(this._edgeView);this._offscreenRendering.dispose();this._fallbackDepthStencilTexture=g.disposeMaybe(this._fallbackDepthStencilTexture);this._shadowMap.enabled=!1;this._shadowMap.dispose();this._ssaoHelper.enabled=!1;this._ssaoHelper.dispose();this._highlight.dispose();
this._shadowHighlight.dispose();this._shadowAccumulator.dispose();A.BoundingInfo.prune();this._content.clear()};ea.disposeOffscreenBuffers=function(){this._offscreenRendering.dispose();this._shadowMap.dispose();this._smaaPass.disable();this._ssaoHelper.disposeOffscreenBuffers()};ea.ensureEdgeView=function(){g.isNone(this._edgeView)&&(this._edgeView=new T.EdgeView({rctx:this._rctx,renderSR:this._stage.renderSR,viewingMode:this._stage.viewingMode,techniqueRepository:this._shaderTechniqueRepository,
setNeedsRender:()=>this._requestRender(),schedule:ba=>this._stage.resourceController.schedule(ba)}),this._handles.add(k.watch(()=>g.applySome(this._edgeView,ba=>ba.updating),()=>this._requestRender(),k.sync)),this._requestRender());return this._edgeView};ea.setRenderParameters=function(ba){const {_shadowMap:Z,_ssaoHelper:fa,_bindParameters:ja}=this;void 0!==ba.screenSpaceReflectionsEnabled&&ja.ssr.enabled!==ba.screenSpaceReflectionsEnabled&&(ja.ssr.enabled=ba.screenSpaceReflectionsEnabled,this._requestRender());
void 0!==ba.shadowMap&&Z.enabled!==ba.shadowMap&&(Z.enabled=ba.shadowMap,this._requestRender());void 0!==ba.shadowMapMaxCascades&&Z.maxCascades!==ba.shadowMapMaxCascades&&(Z.maxCascades=ba.shadowMapMaxCascades,this._requestRender());if(g.isSome(ba.environment)){g.isSome(ba.environment.weather)&&(this._bindParameters.weather=ba.environment.weather,this._bindParameters.weatherVisible=ba.weatherVisible,this._renderContext.bindParameters.weather=ba.environment.weather,this._renderContext.bindParameters.weatherVisible=
ba.weatherVisible);void 0!==ba.environment.lighting.ambientOcclusionEnabled&&fa.enabled!==ba.environment.lighting.ambientOcclusionEnabled&&(fa.enabled=ba.environment.lighting.ambientOcclusionEnabled,this._requestRender());void 0!==ba.environment.lighting.waterReflectionEnabled&&this._waterReflectionEnabled!==ba.environment.lighting.waterReflectionEnabled&&(this._waterReflectionEnabled=ba.environment.lighting.waterReflectionEnabled,this._requestRender());var oa="sun"===ba.environment.lighting.type;
ja.enableFillLights!==oa&&(ja.enableFillLights=oa,this._requestRender())}ba.background&&this._offscreenRendering.background!==ba.background&&(this._offscreenRendering.background=ba.background,this._requestRender());oa=ba.antialiasingEnabled?z.AntiAliasingMode.SMAA:z.AntiAliasingMode.NONE;void 0!==ba.antialiasingEnabled&&this._antialiasing!==oa&&(this._antialiasing=oa,this._requestRender());void 0!==ba.highQualityTransparency&&this._multipassTerrain!==ba.highQualityTransparency&&(this._oitEnabled=
(this._multipassTerrain=ba.highQualityTransparency)&&this._hasOITSupport,this._requestRender());void 0!==ba.defaultHighlightOptions&&(this._highlight.setDefaultOptions(ba.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(ba.defaultHighlightOptions),this._requestRender());void 0!==ba.overlays&&this._bindParameters.overlays!==ba.overlays&&(this._bindParameters.overlays=ba.overlays,this._requestRender());void 0!==ba.slicePlane&&this._sliceHelper.plane!==ba.slicePlane&&(this._sliceHelper.plane=
g.unwrap(ba.slicePlane),this._requestRender());void 0!==ba.transparentTerrain&&this._transparentTerrain!==ba.transparentTerrain&&(this._transparentTerrain=ba.transparentTerrain,this._requestRender());void 0!==ba.hasOverlayWater&&this._hasOverlayWater!==ba.hasOverlayWater&&(this._hasOverlayWater=ba.hasOverlayWater,this._requestRender());void 0!==ba.shadowCastOptions&&this._shadowAccumulator.setOptions(ba.shadowCastOptions)};ea.modify=function(ba){this._isRendering&&console.warn("Renderer.modify called while rendering");
const {adds:Z,removes:fa,updates:ja}=ba;if(0!==Z.length||0!==fa.length||0!==ja.length){fa.forAll(({id:sa})=>this._content.delete(sa));Z.forAll(sa=>this._content.set(sa.id,sa));var oa=!1;K.splitRenderGeometryChangeSetByMaterial(ba).forEach((sa,qa)=>{let Ha=this._materialRenderers.get(qa);if(!Ha)if(0<sa.adds.length)Ha=new aa.MergedRenderer(this._rctx,this._materialRepository,qa),this._materialRenderers.set(qa,Ha);else return;Ha.modify(sa);Ha.isEmpty&&(oa=!0)});oa&&this._materialRenderers.forEach((sa,
qa)=>{sa.isEmpty&&(this._materialRenderers.delete(qa),sa.dispose())});this._hasHighlights=n.someMap(this._materialRenderers,sa=>sa.hasHighlights);this._bindParameters.hasOccludees=n.someMap(this._materialRenderers,sa=>sa.hasOccludees);this._hasWater=n.someMap(this._materialRenderers,sa=>sa.hasWater);this._needsTransparentPass=n.someMap(this._materialRenderers,sa=>sa.requiresSlot(L.RenderSlot.TRANSPARENT_MATERIAL,N.RenderPass.MATERIAL));this._hasHUDElements=n.someMap(this._materialRenderers,sa=>sa.requiresSlot(L.RenderSlot.LINE_CALLOUTS_HUD_DEPTH,
N.RenderPass.MATERIAL)||sa.requiresSlot(L.RenderSlot.HUD_MATERIAL,N.RenderPass.MATERIAL)||sa.requiresSlot(L.RenderSlot.LABEL_MATERIAL,N.RenderPass.MATERIAL));this._requestRender()}};ea.updateAnimation=function(ba){this._hasAnimations=!1;this._materialRenderers.forEach(Z=>this._hasAnimations=Z.updateAnimation(ba)||this._hasAnimations);return this._hasAnimations=this._renderPlugins.updateAnimation(ba)||this._hasAnimations};ea.updateLightSources=function(ba,Z,fa){this._bindParameters.lighting.groundLightingFactor=
Z;this._bindParameters.lighting.globalFactor=fa;this._bindParameters.lighting.set(ba)};ea.render=function(ba,Z,fa,ja){this._isRendering=!0;this.performanceInfo.prerender(this._rctx);this._bindParameters.transparencyPassType=z.TransparencyPassType.NONE;var oa=this._offscreenRendering;oa.needLastFrameColorTexture=this.hasWaterReflection;oa.advanceCurrentRenderTarget();const sa=x.create(this._sliceHelper.plane);ja===z.Decorations.OFF&&(this._sliceHelper.plane=null);this._rctx.bindFramebuffer(ba);Z.setGLViewport(this._rctx);
this._ensureCameraBindParameters(Z,fa);this._renderPlugins.prepareRender();this.performanceInfo.advance(R.Statistics.Prepare);var qa=this._computeDepthRange(Z);this._renderShadowMap(ba,Z,this._bindParameters.lighting.lightingMainDirection,qa);this.performanceInfo.advance(R.Statistics.Shadowmap);oa.initializeFrame(Z);this._ensureBindParameters(Z,fa);this._renderLinearDepth();this.performanceInfo.advance(R.Statistics.Lineardepth);this._accumulateShadows(qa,Z,fa);this._renderNormal();this.performanceInfo.advance(R.Statistics.Normals);
this._ensureBindParametersSSR();this._ssaoHelper.computeSSAO(this._bindParameters,oa.linearDepthTexture,oa.normalTexture);this.performanceInfo.advance(R.Statistics.SSAO);this._renderContext.pass=N.RenderPass.MATERIAL;oa.bindFramebuffer();this._renderOpaqueGeometry();this.performanceInfo.advance(R.Statistics.Opaque);Z=this._multipassTerrain&&this._transparentTerrain;this._renderTerrainLinearDepth(Z);this._setMultipassEnabled(Z);this._setTerrainCulling(Z);this._renderEdges(U.Transparency.OPAQUE);this.performanceInfo.advance(R.Statistics.OpaqueEdges);
this._offscreenRendering.bindTarget(this._offscreenRendering.currentColorTarget,this._offscreenRendering.mainDepth);this._renderSlot(L.RenderSlot.VOXEL);this._renderHiddenTransparentEdges();(fa=this._needsTransparentPass||this._renderPlugins.needsTransparentPass)&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry());this.performanceInfo.advance(R.Statistics.Transparent);this._renderGeometryLinearDepth(Z);qa=this._renderHUDVisibility();
Z||this._renderInternalSlot(L.RenderSlot.LINE_CALLOUTS);this.performanceInfo.advance(R.Statistics.Hudvisibility);this._renderEdges(U.Transparency.TRANSPARENT,Z);this.performanceInfo.advance(R.Statistics.TransparentEdges);this._renderTransparentTerrain();this._transparentTerrain&&qa&&(Z?this._renderLineCallouts(C.HUDTransparentRenderStyle.Occluded):oa.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(C.HUDTransparentRenderStyle.Occluded,oa.framebuffer),this.performanceInfo.advance(R.Statistics.HudOccluded));
this.performanceInfo.advance(R.Statistics.TransparentTerrain);this._setTerrainCulling(!1);this._transparentTerrain&&(oa.compositeTransparentTerrainOntoMain(this._bindParameters),Z&&(this._renderEdges(U.Transparency.OPAQUE),this.performanceInfo.advance(R.Statistics.OpaqueEdges),fa&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(R.Statistics.Transparent),this._renderEdges(U.Transparency.TRANSPARENT),
this.performanceInfo.advance(R.Statistics.TransparentEdges)));Z&&this._renderLineCallouts(C.HUDTransparentRenderStyle.NotOccluded);this._setMultipassEnabled(!1);this._shadowAccumulator.render(this._bindParameters);oa.renderToTargets(()=>{this._renderInternalSlot(L.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);this._renderSlot(L.RenderSlot.POSTPROCESSING_ENVIRONMENT_TRANSPARENT);this._renderSlot(L.RenderSlot.LASERLINES)},oa.currentColorTarget,oa.mainDepth);this.performanceInfo.advance(R.Statistics.Atmosphere);
this._renderPlugins.needsLaserlineWithContrastControl&&oa.renderTmpAndCompositeToMain(()=>this._renderSlot(L.RenderSlot.LASERLINES_CONTRAST_CONTROL),this._bindParameters,W.AlphaMode.PremultipliedAlpha);this.performanceInfo.advance(R.Statistics.Laserline);this._renderOccluded();this.performanceInfo.advance(R.Statistics.Occluded);oa=(ja=ja===z.Decorations.ON&&this._magnifierHelper.enabled)&&g.isNone(ba)?this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor,this._offscreenRendering.tmpDepth):
ba;this._rctx.bindFramebuffer(oa);Z=this._offscreenRendering.colorTexture;!this._renderAntiAliasing(this._antialiasing,Z)&&g.isSome(Z)&&this._compositingHelper.composite(this._bindParameters,Z,W.AlphaMode.None);this.performanceInfo.advance(R.Statistics.Antialiasing);this._renderHUD(C.HUDTransparentRenderStyle.NotOccluded,oa);this.performanceInfo.advance(R.Statistics.HudNotoccluded);this._renderHighlights(oa,this._bindParameters);this.performanceInfo.advance(R.Statistics.Highlights);ja&&this._magnifierHelper.render(this._rctx,
this._bindParameters);oa!==ba&&(this._rctx.bindFramebuffer(ba),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.tmpColorTexture,W.AlphaMode.None));this._disposeOITBuffers();this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera);this._sliceHelper.plane=sa;this._isRendering=!1;if(this.onPostRender)this.onPostRender();this.performanceInfo.postrender()};ea.finish=function(ba){this._hasAnimations||(this._animationTimestep=f.Milliseconds(0));ba===z.RenderRequestType.BACKGROUND&&
(this._rctx.gl.getError(),this._animationTimestep=f.Milliseconds(Math.max(.9*this._animationTimestep+this.performanceInfo.elapsedTime/B.MAXIMUM_ANIMATION_LOAD*(1-.9),B.MINIMUM_IDLE_ANIMATION_MS)))};ea.readDepthPixels=function(ba,Z,fa){const ja=this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth);this._needsLinearDepth||(this._ensureBindParameters(ba,ba),this._bindParameters.camera.setGLViewport(this._rctx),this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(V.ClearBufferBit.COLOR_BUFFER_BIT|
V.ClearBufferBit.DEPTH_BUFFER_BIT|V.ClearBufferBit.STENCIL_BUFFER_BIT),this._renderGeometryAndTransparentTerrainPass(N.RenderPass.MATERIAL_DEPTH));ja.readPixels(Z[0],Z[1],Z[2],Z[3],V.PixelFormat.RGBA,V.PixelType.UNSIGNED_BYTE,fa)};ea.readHUDVisibility=function(ba,Z,fa,ja,oa){this._offscreenRendering.bindTarget(this._offscreenRendering.hudVisibility).readPixels(ba,Z,fa,ja,V.PixelFormat.RGBA,V.PixelType.UNSIGNED_BYTE,oa)};ea.readAccumulatedShadow=function(ba,Z){return this._shadowAccumulator.readAccumulatedShadow(ba,
Z)};ea._setMultipassEnabled=function(ba){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=ba};ea._setTerrainCulling=function(ba){this._bindParameters.multipassTerrain.cullAboveGround=ba};ea._renderSlot=function(ba){this._bindParameters.slot=ba;this._renderPlugins.render()};ea._renderEdges=function(ba,Z=!1){const fa=this._edgeView;g.isSome(fa)&&fa.shouldRender()&&this._offscreenRendering.renderTmpAndCompositeToMain(()=>fa.render(this._bindParameters,ba),
this._bindParameters,W.AlphaMode.Alpha,Z)};ea._renderShadowMap=function(ba,Z,fa,ja){const oa=this._shadowMap;oa.enabled&&(oa.start(Z,fa,ja),this._shadowHighlight.updateParameters(Z,fa),this.needsShadowHighlight?(this._renderShadowCascades(N.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,this._shadowMap,sa=>oa.takeCascadeSnapshotTo(sa,I.SnapshotSlot.Highlight)),oa.clear(),this._renderShadowCascades(N.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,this._shadowMap,sa=>{oa.takeCascadeSnapshotTo(sa,I.SnapshotSlot.Default);
this._renderGeometryAndTransparentTerrainPass(N.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT)})):this._renderShadowCascades(N.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL),oa.finish(ba),Z.setGLViewport(this._rctx))};ea._renderShadowCascades=function(ba,Z=this._shadowMap,fa=ja=>{}){for(const ja of Z.getCascades())ja.camera.setGLViewport(this._rctx),this._ensureCameraBindParameters(ja.camera,ja.camera),this._renderGeometryAndTransparentTerrainPass(ba),fa(ja)};ea._renderLinearDepth=function(){this._needsLinearDepth?
this._offscreenRendering.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(N.RenderPass.MATERIAL_DEPTH),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth);this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture};ea._renderTerrainLinearDepth=function(ba){ba?(ba=this._renderContext.pass,this._renderContext.pass=N.RenderPass.MATERIAL_DEPTH,this._offscreenRendering.renderToTargets(()=>
this._renderTransparentTerrain(),this._offscreenRendering.terrainLinearDepth,this._offscreenRendering.tmpDepth,[-1E10,-1E10,-1E10,1],!0,!0),this._renderContext.pass=ba):this._offscreenRendering.disposeTarget(this._offscreenRendering.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreenRendering.terrainLinearDepthTexture};ea._renderGeometryLinearDepth=function(ba){ba?(ba=this._renderContext.pass,this._offscreenRendering.renderToTargets(()=>this._renderGeometryPass(N.RenderPass.MATERIAL_DEPTH),
this._offscreenRendering.geometryLinearDepth,this._offscreenRendering.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.pass=ba):this._offscreenRendering.disposeTarget(this._offscreenRendering.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreenRendering.geometryLinearDepthTexture};ea._renderNormal=function(){this.needsNormal?this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(N.RenderPass.MATERIAL_NORMAL)},this._offscreenRendering.normal,
this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)};ea._computeDepthRange=function(ba){if(!this.needsDepthRange)return p.ZERO;const Z=y.depthRangeFromScene(ba,this._content,this._stage.layers);p.union(Z,this.renderPlugins.queryDepthRange(ba));Z.near=Math.max(ba.near,Z.near);Z.far=Math.min(ba.far,Z.far);return Z};ea._renderGeometryAndTransparentTerrainPass=function(ba){this._renderContext.pass=ba;this._renderGeometryPass(ba);this._renderTransparentTerrain()};
ea._renderGeometryPass=function(ba){this._renderContext.pass=ba;this._renderOpaqueGeometry();this._renderTransparentGeometry()};ea._renderOpaqueGeometry=function(){this._renderSlot(L.RenderSlot.INTEGRATED_MESH);this._renderSlot(L.RenderSlot.OPAQUE_TERRAIN);this._renderInternalSlot(L.RenderSlot.OPAQUE_MATERIAL);this._renderSlot(L.RenderSlot.OPAQUE_MATERIAL);this._renderSlot(L.RenderSlot.POSTPROCESSING_ENVIRONMENT_OPAQUE)};ea._renderTransparentGeometry=function(){this._renderInternalSlot(L.RenderSlot.TRANSPARENT_MATERIAL);
this._renderSlot(L.RenderSlot.TRANSPARENT_MATERIAL)};ea._renderTransparentTerrain=function(){this._renderSlot(L.RenderSlot.TRANSPARENT_TERRAIN)};ea._renderHUDVisibility=function(){let ba=!1;this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture;ba=this._renderInternalSlot(L.RenderSlot.OCCLUSION_PIXELS)},this._multipassTerrain&&this._transparentTerrain);
return ba};ea._renderLineCallouts=function(ba){this._bindParameters.renderTransparentlyOccludedHUD=ba;ba===C.HUDTransparentRenderStyle.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderInternalSlot(L.RenderSlot.LINE_CALLOUTS),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderInternalSlot(L.RenderSlot.LINE_CALLOUTS)};ea._renderHUD=function(ba,Z){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(()=>
this._renderHUDElements(ba),!0),this._rctx.bindFramebuffer(Z),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.hudColorTexture,W.AlphaMode.PremultipliedAlpha)):ba===C.HUDTransparentRenderStyle.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderHUDElements(C.HUDTransparentRenderStyle.Occluded),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderHUDElements(ba))};ea._renderHUDElements=function(ba){this._bindParameters.renderTransparentlyOccludedHUD=
ba;this._renderInternalSlot(L.RenderSlot.LINE_CALLOUTS_HUD_DEPTH);this._renderInternalSlot(L.RenderSlot.HUD_MATERIAL);this._renderInternalSlot(L.RenderSlot.LABEL_MATERIAL)};ea._renderHighlights=function(ba,Z){if(this.needsHighlight){var fa=this._highlight,ja=this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(N.RenderPass.MATERIAL_HIGHLIGHT);this._rctx.clearSafe(V.ClearBufferBit.DEPTH_BUFFER_BIT);this._renderHUDElements(C.HUDTransparentRenderStyle.Both)},this._offscreenRendering.highlight,
this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=ja.colorTexture;this.needsShadowHighlight&&this._shadowHighlight.render(Z,ba);fa.render(this._bindParameters,ja,ba)}else this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight)};ea._accumulateShadows=function(ba,Z,fa){this.needsShadowCast&&this._shadowAccumulator.renderAccumulation(this._offscreenRendering.linearDepthTexture,ba,Z,fa)};ea._renderOrderIndependentTransparency=function(ba,
Z){const fa=oa=>{this._bindParameters.transparencyPassType=oa;this._offscreenRendering.renderOITPass(()=>ba(),oa,Z)},ja=this._renderContext.pass;this._renderContext.pass=N.RenderPass.MATERIAL_ALPHA;fa(z.TransparencyPassType.Alpha);this._renderContext.pass=N.RenderPass.MATERIAL;fa(z.TransparencyPassType.Color);fa(z.TransparencyPassType.FrontFace);this._offscreenRendering.compositeTransparentOntoOpaque(this._bindParameters,Z);this._bindParameters.transparencyPassType=z.TransparencyPassType.NONE;this._renderContext.pass=
ja;this._oitUsed=!0};ea._disposeOITBuffers=function(){this._oitUsed||(this._offscreenRendering.disposeTarget(this._offscreenRendering.alphaFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.colorFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.frontFaceTarget));this._oitUsed=!1};ea._renderOccluded=function(){let ba=0;this._materialRenderers.forEach((sa,qa)=>{qa&&qa.isVisible()&&qa.renderOccluded===F.RenderOccludedFlag.OccludeAndTransparentStencil&&
(ba|=qa.renderOccluded,ca.push(qa))});const Z=this._offscreenRendering,fa=(sa,qa,Ha,Ga,pa)=>{0!==(ba&qa)&&(Z.renderToTargets(Ha,Z.tmpColor,Z.mainDepth,[0,0,0,0],Ga,pa),Z.compositeOccludedOntoMain(this._bindParameters,sa))};0!==ca.length&&(this._renderInternalSlot(L.RenderSlot.OCCLUDER_MATERIAL,ca),fa(.5,F.RenderOccludedFlag.OccludeAndTransparentStencil,()=>this._renderInternalSlot(L.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL,ca),!1,!1),ca.length=0);this._materialRenderers.forEach((sa,qa)=>{qa&&qa.isVisible()&&
(qa.renderOccluded===F.RenderOccludedFlag.OccludeAndTransparent||qa.renderOccluded===F.RenderOccludedFlag.Transparent||qa.renderOccluded===F.RenderOccludedFlag.Opaque)&&(ba|=qa.renderOccluded,da.push(qa))});const ja=this._renderPlugins.renderOccludedFlags;if(ba|=ja){var oa=sa=>{this._renderContext.renderOccludedMask=sa;ja>F.RenderOccludedFlag.Occlude&&this._renderSlot(L.RenderSlot.OCCLUDED_TERRAIN);this._renderInternalSlot(L.RenderSlot.OPAQUE_MATERIAL,da);this._renderInternalSlot(L.RenderSlot.TRANSPARENT_MATERIAL,
da);this._renderInternalSlot(L.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,da);this._renderContext.resetRenderOccludedMask()};this._renderContext.pass=N.RenderPass.MATERIAL;fa(.5,F.RenderOccludedFlag.OccludeAndTransparent,()=>oa(F.RenderOccludedFlag.OccludeAndTransparent),!0,z.StencilBits.OutlineVisualElementMask);fa(.5,F.RenderOccludedFlag.Transparent,()=>oa(F.RenderOccludedFlag.Transparent),!0,z.StencilBits.OutlineVisualElementMask);fa(1,F.RenderOccludedFlag.Opaque,()=>oa(F.RenderOccludedFlag.Opaque),
!0,z.StencilBits.OutlineVisualElementMask);da.length=0}};ea._renderAntiAliasing=function(ba,Z){if(ba===z.AntiAliasingMode.SMAA){if(this._smaaPass.enable(()=>this._requestRender())&&g.isSome(Z))return this._smaaPass.render(Z),!0}else this._smaaPass.disable();return!1};ea._ensureCameraBindParameters=function(ba,Z){this._bindParameters.camera=ba;this._bindParameters.contentCamera=Z};ea._ensureBindParameters=function(ba,Z){var fa;this._ensureCameraBindParameters(ba,Z);ba=this._renderContext.offscreenRenderingHelper;
this._bindParameters.hudVisibilityTexture=ba.hudVisibilityTexture;this._bindParameters.highlightDepthTexture=null!=(fa=ba.depthTexture)?fa:this._getFallbackDepthTexture()};ea._ensureBindParametersSSR=function(){this.hasWaterReflection?(this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=t.IDENTITY:(w.invert(ia,this._bindParameters.camera.viewMatrix),w.invert(ha,this._bindParameters.camera.projectionMatrix),w.multiply(ka,ia,ha),w.multiply(ka,this._renderContext.lastFrameCamera.viewMatrix,
ka),w.multiply(ka,this._renderContext.lastFrameCamera.projectionMatrix,ka),this._reprojectionMatrix=ka),this._bindParameters.ssr.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):this._bindParameters.ssr.lastFrameColorTexture=null;this._bindParameters.ssr.enabled=this.hasWaterReflection};ea._renderInternalSlot=function(ba,Z){let fa=!1;this._bindParameters.slot=ba;g.isSome(Z)?Z.forEach(ja=>{ja.shouldRender(this._renderContext)&&(ja=this._materialRenderers.get(ja),g.isSome(ja)&&
(fa=ja.render(this._renderContext.pass,this._bindParameters)||fa))}):this._materialRenderers.forEach((ja,oa)=>{oa.shouldRender(this._renderContext)&&ja.render(this._renderContext.pass,this._bindParameters)&&(fa=!0)});return fa};ea._getFallbackDepthTexture=function(){this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=D.createEmptyDepthTexture(this._rctx));return this._fallbackDepthStencilTexture};b._createClass(Y,[{key:"_bindParameters",get:function(){return this._renderContext.bindParameters}},
{key:"hasWater",get:function(){return this._hasWater||this._hasOverlayWater}},{key:"hasWaterReflection",get:function(){return this.hasWater&&this._waterReflectionEnabled}},{key:"updating",get:function(){return this._antialiasing===z.AntiAliasingMode.SMAA&&this._smaaPass.updating||g.isSome(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}},{key:"edgeView",get:function(){return this._edgeView}},{key:"isCameraFinal",get:function(){return w.equals(this._bindParameters.ssr.reprojectionMatrix,
t.IDENTITY)}},{key:"_reprojectionMatrix",set:function(ba){l.update(this._bindParameters.ssr.reprojectionMatrix,ba)&&this.notifyChange("isCameraFinal")}},{key:"shadowsEnabled",get:function(){var ba;return!(null==(ba=this._shadowMap)||!ba.enabled)}},{key:"hasSlicePlane",get:function(){return!!this._sliceHelper.plane}},{key:"renderPlugins",get:function(){return this._renderPlugins}},{key:"_hasOITSupport",get:function(){return this._rctx.driverTest.floatBufferBlendWorking}},{key:"animationTimestep",get:function(){return this._animationTimestep}},
{key:"_needsLinearDepth",get:function(){return this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled||this.needsShadowHighlight||this.needsShadowCast}},{key:"needsNormal",get:function(){return this._ssaoHelper.enabled}},{key:"needsDepthRange",get:function(){return this._shadowMap.enabled||this.needsShadowCast}},{key:"needsHighlight",get:function(){return this._hasHighlights||this._renderPlugins.needsHighlight}},{key:"needsShadowHighlight",get:function(){return this._shadowMap.enabled&&
this._shadowHighlight.isVisible&&this.needsHighlight}},{key:"needsShadowCast",get:function(){return this._shadowAccumulator.isAccumulating}},{key:"gpuMemoryUsage",get:function(){var ba,Z,fa,ja,oa,sa,qa,Ha,Ga,pa;return{offscreen:null!=(ba=null==(Z=this._offscreenRendering)?void 0:Z.gpuMemoryUsage)?ba:0,highlights:(null!=(fa=null==(ja=this._highlight)?void 0:ja.gpuMemoryUsage)?fa:0)+(null!=(oa=null==(sa=this._shadowHighlight)?void 0:sa.gpuMemoryUsage)?oa:0),shadows:null!=(qa=null==(Ha=this._shadowMap)?
void 0:Ha.gpuMemoryUsage)?qa:0,ssao:null!=(Ga=null==(pa=this._ssaoHelper)?void 0:pa.gpuMemoryUsage)?Ga:0}}},{key:"test",get:function(){const ba=this;return{offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,getFramebufferTexture:Z=>{switch(Z){case a.FramebufferId.Color:return ba._offscreenRendering.colorTexture;case a.FramebufferId.LinearDepth:return ba._offscreenRendering.linearDepthTexture;
case a.FramebufferId.Normals:return ba._offscreenRendering.normalTexture;case a.FramebufferId.ShadowMap:return ba._shadowMap.depthTexture;case a.FramebufferId.HudVisibility:return ba._offscreenRendering.hudVisibilityTexture;case a.FramebufferId.Highlight:return ba._offscreenRendering.highlightTexture}}}}}]);return Y}(m);c.__decorate([d.property()],a.Renderer.prototype,"_shadowAccumulator",void 0);c.__decorate([d.property()],a.Renderer.prototype,"_smaaPass",void 0);c.__decorate([d.property()],a.Renderer.prototype,
"_antialiasing",void 0);c.__decorate([d.property()],a.Renderer.prototype,"_edgeView",void 0);c.__decorate([d.property()],a.Renderer.prototype,"updating",null);c.__decorate([d.property()],a.Renderer.prototype,"isCameraFinal",null);a.Renderer=c.__decorate([v.subclass("esri.views.3d.webgl-engine.lib.Renderer")],a.Renderer);a.FramebufferId=void 0;(function(la){la[la.Color=0]="Color";la[la.LinearDepth=1]="LinearDepth";la[la.Normals=2]="Normals";la[la.ShadowMap=3]="ShadowMap";la[la.HudVisibility=4]="HudVisibility";
la[la.Highlight=5]="Highlight"})(a.FramebufferId||(a.FramebufferId={}));const da=[],ca=[],ha=t.create(),ia=t.create(),ka=t.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/animationUtils":function(){define(["exports","../../../core/time"],function(a,b){b=b.Milliseconds(1E3/30);a.MAXIMUM_ANIMATION_LOAD=.5;a.MINIMUM_IDLE_ANIMATION_MS=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/core/renderPasses/RenderPassManager":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ./AllRenderPasses ./RenderPass ../util/TwoVectorPosition ../../lib/depthRange ../../lib/RenderPass ../../lib/RenderSlot".split(" "),function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){let w=function(){function q(C,
z){this.rctx=C;this.shaderTechniqueRepository=z;this.canRender=!0;this._materialPassParameters=new k.MaterialPassParameters;this._shadowPassParameters=new k.ShadowMapPassParameters;this._highlightPassParameters=new k.HighlightPassParameters;this._systems=new Set;this._passes={materialOpaque:new f.RenderPass(C,z),materialTransparent:new f.RenderPass(C,z,f.RenderPassSorting.BackToFront),materialIntegratedMesh:new f.RenderPass(C,z),shadowMap:new f.RenderPass(C,z),highlight:new f.RenderPass(C,z),highlightIntegratedMesh:new f.RenderPass(C,
z),highlightShadowMap:new f.RenderPass(C,z),defaultShadowMap:new f.RenderPass(C,z)}}var u=q.prototype;u.register=function(C){this._systems.add(C)};u.prepareRender=function(C){if(0!==this._systems.size){for(const z of Object.values(this._passes))z.prepareSubmit();this._systems.forEach(z=>z.submit(this._passes,C.bindParameters));for(const z of Object.values(this._passes))z.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}};u.render=function(C){if(0!==this._systems.size)switch(this._configure(C),
C.bindParameters.slot){case v.RenderSlot.OPAQUE_MATERIAL:switch(C.pass){case h.RenderPass.MATERIAL:return this._materialPassParameters.subPass=k.MaterialSubPass.Color,this._passes.materialOpaque.dispatch(this._materialPassParameters,C.bindParameters);case h.RenderPass.MATERIAL_DEPTH:return this._materialPassParameters.subPass=k.MaterialSubPass.Depth,this._passes.materialOpaque.dispatch(this._materialPassParameters,C.bindParameters);case h.RenderPass.MATERIAL_NORMAL:return this._materialPassParameters.subPass=
k.MaterialSubPass.Normal,this._passes.materialOpaque.dispatch(this._materialPassParameters,C.bindParameters);case h.RenderPass.MATERIAL_HIGHLIGHT:return this._passes.highlight.dispatch(this._highlightPassParameters,C.bindParameters);case h.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL:return this._passes.shadowMap.dispatch(this._shadowPassParameters,C.bindParameters);case h.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:return this._passes.highlightShadowMap.dispatch(this._shadowPassParameters,C.bindParameters);
case h.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this._passes.defaultShadowMap.dispatch(this._shadowPassParameters,C.bindParameters)}break;case v.RenderSlot.TRANSPARENT_MATERIAL:switch(C.pass){case h.RenderPass.MATERIAL:return this._materialPassParameters.subPass=k.MaterialSubPass.Color,this._passes.materialTransparent.dispatch(this._materialPassParameters,C.bindParameters);case h.RenderPass.MATERIAL_ALPHA:return this._materialPassParameters.subPass=k.MaterialSubPass.Alpha,this._passes.materialTransparent.dispatch(this._materialPassParameters,
C.bindParameters);case h.RenderPass.MATERIAL_DEPTH:return this._materialPassParameters.subPass=k.MaterialSubPass.Depth,this._passes.materialTransparent.dispatch(this._materialPassParameters,C.bindParameters);case h.RenderPass.MATERIAL_NORMAL:return this._materialPassParameters.subPass=k.MaterialSubPass.Normal,this._passes.materialTransparent.dispatch(this._materialPassParameters,C.bindParameters)}break;case v.RenderSlot.INTEGRATED_MESH:switch(C.pass){case h.RenderPass.MATERIAL:return this._materialPassParameters.subPass=
k.MaterialSubPass.Color,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,C.bindParameters);case h.RenderPass.MATERIAL_DEPTH:return this._materialPassParameters.subPass=k.MaterialSubPass.Depth,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,C.bindParameters);case h.RenderPass.MATERIAL_NORMAL:return this._materialPassParameters.subPass=k.MaterialSubPass.Normal,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,C.bindParameters);
case h.RenderPass.MATERIAL_HIGHLIGHT:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParameters,C.bindParameters)}}};u.notifyDirty=function(){this._context.requestRender()};u.slots=function(){return[v.RenderSlot.OPAQUE_MATERIAL,v.RenderSlot.TRANSPARENT_MATERIAL,v.RenderSlot.INTEGRATED_MESH]};u.initializeRenderContext=function(C){this._context=C};u.uninitializeRenderContext=function(){};u.queryDepthRange=function(C){const z={near:Infinity,far:-Infinity};this._systems.forEach(A=>
{A=A.queryShadowCasterDepthRange(C);c.isSome(A)&&e.union(z,A,z)});return z};u._configure=function(C){this._updateParameters(C,C.pass===h.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL||C.pass===h.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||C.pass===h.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT?this._shadowPassParameters:C.pass===h.RenderPass.MATERIAL_HIGHLIGHT?this._highlightPassParameters:this._materialPassParameters)};u._updateParameters=function(C,z){const A=C.bindParameters.camera,p=A.viewInverseTransposeMatrix;
n.set(t,p[3],p[7],p[11]);B.set(t);n.copy(z.transformWorldFromViewTH,B.high);n.copy(z.transformWorldFromViewTL,B.low);n.copy(z.slicePlaneLocalOrigin,t);m.fromMat4(z.transformViewFromCameraRelativeRS,A.viewMatrix);r.copy(z.transformProjFromView,A.projectionMatrix);z.identifier===k.RenderPassIdentifier.Material&&(this._materialPassParameters.transparent=C.bindParameters.slot===v.RenderSlot.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=C.bindParameters.slot===v.RenderSlot.INTEGRATED_MESH,
m.transpose(x,z.transformViewFromCameraRelativeRS),m.invert(z.transformNormalViewFromGlobal,x))};b._createClass(q,[{key:"needsHighlight",get:function(){return 0<this._passes.highlight.count||0<this._passes.highlightIntegratedMesh.count}},{key:"needsTransparentPass",get:function(){return 0<this._passes.materialTransparent.count}}]);return q}();const t=g.create(),x=l.create(),B=new d.TwoVectorPosition;a.RenderPassManager=w;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/core/renderPasses/RenderPass":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/PooledArray ../../lib/basicInterfaces ../../../../webgl/enums".split(" "),function(a,b,c,m,l,r){a.RenderPassSorting=void 0;(function(k){k[k.FrontToBack=0]="FrontToBack";k[k.BackToFront=1]="BackToFront"})(a.RenderPassSorting||(a.RenderPassSorting={}));let n=function(){function k(d,e,h=a.RenderPassSorting.FrontToBack){this._rctx=
d;this._techniqueRepository=e;this._sorting=h;this._draws=new m({initialSize:32,allocator:v=>v||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}});this._previouslyBoundDraw=new Map}var f=k.prototype;f.submitDraw=function(d,e,h,v){const w=this._draws.pushNew();w.geometry=e;w.geometryRanges=h;w.material=d;w.depthSquaredHint=v;w.indexType=e.indexed?c.unwrap(e.vao.indexBuffer).indexType:0};f.dispatch=function(d,e){const h=this._rctx;this._previouslyBoundDraw.clear();
let v=null;const w=this._draws.map(q=>q.material.prepareTechnique(this._techniqueRepository,d,e,q.geometry.parameters)),t=this._draws.length;for(let q=0;q<t;q++){var x=w[q];if(x!==v||x.configuration.transparencyPassType!==l.TransparencyPassType.NONE)h.bindTechnique(x,d,e),v=x;var B=this._draws.data[q];const u=B.geometry;h.bindVAO(u.vao);this._previouslyBoundDraw.get(x)!==B.material&&(x.bindDraw(B.material,e),this._previouslyBoundDraw.set(x,B.material));x=B.geometryRanges;const C=x.length;if(0!==B.indexType){const z=
g.get(B.indexType);for(let A=0;A<C;A+=2)h.drawElements(u.primitiveType,x[A+1],B.indexType,x[A]*z)}else for(B=0;B<C;B+=2)h.drawArrays(u.primitiveType,x[B],x[B+1])}};f.prepareSubmit=function(){this._draws.clear()};f.finishSubmit=function(){const d=this._sorting===a.RenderPassSorting.FrontToBack?1:-1;this._draws.sort((e,h)=>{const v=d*(e.depthSquaredHint-h.depthSquaredHint);return 0!==v?v:e.geometry.vao.size-h.geometry.vao.size})};b._createClass(k,[{key:"count",get:function(){return this._draws.length}}]);
return k}();const g=new Map;g.set(r.DataType.UNSIGNED_BYTE,1);g.set(r.DataType.UNSIGNED_SHORT,2);g.set(r.DataType.UNSIGNED_INT,4);a.RenderPass=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Highlight":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec2 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../core/shaderTechnique/ShaderTechniqueConfiguration ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./glUtil3D ../shaders/HighlightApplyTechnique ../../../../chunks/HighlightBlur.glsl ../shaders/HighlightBlurTechnique ../../../../chunks/HighlightDownsample.glsl ../shaders/HighlightDownsampleTechnique ../shaders/HighlightPassParameters ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C){let z=function(){function A(y,D){this._techniqueRep=y;this._rctx=D;this.viewportToRestore=r.create();this._passParameters=new t.HighlightPassParameters;this._downsampleDrawParameters=new v.HighlightDownsampleDrawParameters;this._blurDrawParameters=new e.HighlightBlurDrawParameters;this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}var p=A.prototype;p._assertResources=
function(){if(!this.quadVAO){this.quadVAO=f.createQuadVAO(this._rctx);var y={colorTarget:B.TargetType.TEXTURE,depthStencilTarget:B.DepthStencilTargetType.NONE,width:0,height:0},D={target:B.TextureType.TEXTURE_2D,pixelFormat:B.PixelFormat.RGBA,dataType:B.PixelType.UNSIGNED_BYTE,samplingMode:B.TextureSamplingMode.LINEAR,wrapMode:B.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0};this.blur0Fbo=new q.FramebufferObject(this._rctx,y,D);this.blur1Fbo=new q.FramebufferObject(this._rctx,y,D);y=new n.ShaderTechniqueConfiguration;
this._blurTechnique=this._techniqueRep.acquire(h.HighlightBlurTechnique,y);this._downsampleTechnique=this._techniqueRep.acquire(w.HighlightDownsampleTechnique,y);this._applyTechnique=this._techniqueRep.acquire(d.HighlightApplyTechnique,y)}};p.dispose=function(){this._blurTechnique=c.releaseMaybe(this._blurTechnique);this._downsampleTechnique=c.releaseMaybe(this._downsampleTechnique);this._applyTechnique=c.releaseMaybe(this._applyTechnique);if(this._grid.coverageMipmap)for(let y=1;y<this._grid.coverageMipmap.length;y++)this._grid.coverageMipmap[y].dispose();
this._grid.vao&&this._grid.vao.dispose(!0);this.quadVAO&&(this.quadVAO.dispose(!0),this.quadVAO=null);this.blur0Fbo=c.disposeMaybe(this.blur0Fbo);this.blur1Fbo=c.disposeMaybe(this.blur1Fbo)};p.setDefaultOptions=function(y){this._passParameters={...new t.HighlightPassParameters,...y}};p.render=function(y,D,E){this._passParameters.highlightColorTexture=D.colorTexture;this._assertResources();var F=y.camera;l.copy(this.viewportToRestore,F.fullViewport);var G=F.pixelRatio;const P=Math.ceil(F.fullWidth/
G);F=Math.ceil(F.fullHeight/G);this.blur0Fbo.resize(P,F);this.blur1Fbo.resize(P,F);G=this._rctx;G.bindVAO(this.quadVAO);let K=null;this._gridUpdateResources(D,32);this._gridComputeMipmap(y);this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture;K=this._grid.vao;const N=G.bindTechnique(this._blurTechnique,this._passParameters,y);G.bindVAO(K);G.bindFramebuffer(this.blur0Fbo);G.setViewport(0,0,P,F);G.setClearColor(0,0,0,0);G.clear(B.ClearBufferBit.COLOR_BUFFER_BIT);
this._blurDrawParameters.blurInputTexture=D.colorTexture;m.set(this._blurDrawParameters.blurSize,1/P,0);N.bindDraw(this._blurDrawParameters,y);G.drawArrays(this._blurTechnique.primitiveType,0,u.vertexCount(K,"geometry"));G.bindFramebuffer(this.blur1Fbo);G.clear(B.ClearBufferBit.COLOR_BUFFER_BIT);this._blurDrawParameters.blurInputTexture=this.blur0Fbo.colorTexture;m.set(this._blurDrawParameters.blurSize,0,1/F);N.bindDraw(this._blurDrawParameters,y);G.drawArrays(this._blurTechnique.primitiveType,0,
u.vertexCount(K,"geometry"));G.bindFramebuffer(E);G.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]);this._passParameters.blurColorTexture=this.blur1Fbo.colorTexture;G.bindTechnique(this._applyTechnique,this._passParameters,y);G.drawArrays(this._applyTechnique.primitiveType,0,u.vertexCount(K,"geometry"));G.bindVAO(null)};p._gridUpdateResources=function(y,D){const E=this._rctx,F=this._grid;var G=!1;null===F.coverageMipmap&&(F.coverageMipmap=
[y],G=!0);if(F.viewportWidth!==y.width||F.viewportHeight!==y.height)G=!0,F.viewportWidth=y.width,F.viewportHeight=y.height;F.coverageMipmap[0]=y;F.cellPixelSize!==D&&(F.cellPixelSize=D,G=!0);if(G){for(D=1;D<F.coverageMipmap.length;D++)F.coverageMipmap[D].dispose();F.mipmapLevels=Math.ceil(Math.log(F.cellPixelSize)*Math.LOG2E);F.coverageMipmap.length=F.mipmapLevels+1;for(D=0;D<F.mipmapLevels;D++)G=F.coverageMipmap[D],F.coverageMipmap[D+1]=new q.FramebufferObject(E,{colorTarget:B.TargetType.TEXTURE,
depthStencilTarget:B.DepthStencilTargetType.NONE,width:Math.ceil(G.width/2),height:Math.ceil(G.height/2)},{target:B.TextureType.TEXTURE_2D,pixelFormat:B.PixelFormat.RGB,dataType:B.PixelType.UNSIGNED_SHORT_5_6_5,samplingMode:B.TextureSamplingMode.LINEAR,wrapMode:B.TextureWrapMode.CLAMP_TO_EDGE,width:Math.ceil(G.width/2),height:Math.ceil(G.height/2)})}G=Math.ceil(y.height/F.cellPixelSize);var P=Math.ceil(y.width/F.cellPixelSize);if(!F.vao||F.verticalCellCount!==G||F.horizontalCellCount!==P){F.verticalCellCount=
G;F.horizontalCellCount=P;y=G+1;D=P+1;G=1/G;P=1/P;const K=new Float32Array(24*y*D);let N=0;for(let M=0;M<y;M++)for(let L=0;L<D;L++)K[N+0]=(L-.5)*P*2-1,K[N+1]=(M-.5)*G*2-1,K[N+2]=L*P,K[N+3]=M*G,K[N+4]=(L+.5)*P*2-1,K[N+5]=(M-.5)*G*2-1,K[N+6]=L*P,K[N+7]=M*G,K[N+8]=(L-.5)*P*2-1,K[N+9]=(M+.5)*G*2-1,K[N+10]=L*P,K[N+11]=M*G,K[N+12]=(L-.5)*P*2-1,K[N+13]=(M+.5)*G*2-1,K[N+14]=L*P,K[N+15]=M*G,K[N+16]=(L+.5)*P*2-1,K[N+17]=(M-.5)*G*2-1,K[N+18]=L*P,K[N+19]=M*G,K[N+20]=(L+.5)*P*2-1,K[N+21]=(M+.5)*G*2-1,K[N+22]=
L*P,K[N+23]=M*G,N+=24;F.vao&&F.vao.dispose(!0);F.vao=new C.VertexArrayObject(E,g.Default3D,{geometry:k.Pos2Tex},{geometry:x.BufferObject.createVertex(E,B.Usage.STATIC_DRAW,K)})}};p._gridComputeMipmap=function(y){const D=this._rctx,E=this._grid,F=D.bindTechnique(this._downsampleTechnique,this._passParameters,y);D.bindVAO(this.quadVAO);for(let G=0;G<E.mipmapLevels;G++){D.bindFramebuffer(E.coverageMipmap[G+1]);const P=E.coverageMipmap[G+1].width,K=E.coverageMipmap[G+1].height;this._downsampleDrawParameters.inputTexture=
E.coverageMipmap[G].colorTexture;m.set(this._downsampleDrawParameters.invFramebufferDim,1/P,1/K);F.bindDraw(this._downsampleDrawParameters,y);D.setViewport(0,0,P,K);D.drawArrays(B.PrimitiveType.TRIANGLE_STRIP,0,u.vertexCount(this.quadVAO,"geometry"))}};b._createClass(A,[{key:"gpuMemoryUsage",get:function(){let y=(c.isSome(this.blur0Fbo)?this.blur0Fbo.gpuMemoryUsage:0)+(c.isSome(this.blur1Fbo)?this.blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const D of this._grid.coverageMipmap)y+=
D.gpuMemoryUsage;return y}},{key:"test",get:function(){return{coverage:this._grid.coverageMipmap,blur:[this.blur0Fbo,this.blur1Fbo]}}}]);return A}();a.Highlight=z;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/HighlightApplyTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HighlightApply.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f){l=function(d){function e(){return d.apply(this,arguments)||this}c._inheritsLoose(e,d);var h=e.prototype;h.initializeProgram=function(v){const w=e.shader.get().build();return new n.Program(v.rctx,w,r.Default3D)};h.initializePipeline=function(){return f.makePipelineState({blending:f.separateBlendingParams(k.BlendFactor.SRC_ALPHA,k.BlendFactor.ONE,k.BlendFactor.ONE_MINUS_SRC_ALPHA,k.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:f.defaultColorWriteParams})};return e}(l.ShaderTechnique);
l.shader=new m.ReloadableShaderModule(g.HighlightApply,()=>new Promise((d,e)=>a(["./HighlightApply.glsl"],d,e)));b.HighlightApplyTechnique=l;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/HighlightApply.glsl":function(){define("exports ./vec4 ./vec4f64 ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,m,l,r,n,g){function k(){const d=new r.ShaderBuilder,{vertex:e,fragment:h}=d,v=e.code,w=h.code;d.attributes.add(g.VertexAttribute.POSITION,"vec2");d.varyings.add("uv","vec2");d.attributes.add(g.VertexAttribute.UV0,"vec2");e.uniforms.add(new n.Texture2DPassUniform("coverageTex",t=>t.coverageTexture));v.add(l.glsl`void main() {
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`);h.uniforms.add(new n.Texture2DPassUniform("tex",t=>t.blurColorTexture));h.uniforms.add(new n.Texture2DPassUniform("origin",t=>t.highlightColorTexture));h.uniforms.add(new m.Float4PassUniform("uColor",t=>t.color));h.uniforms.add(new m.Float4PassUniform("haloColor",t=>t.haloColor));h.uniforms.add(new m.Float4PassUniform("opacities",t=>b.set(f,t.haloOpacity,t.haloOpacityOccluded,t.fillOpacity,t.fillOpacityOccluded)));h.constants.add("outlineSize","float",8.6);h.constants.add("blurSize","float",.4);
w.add(l.glsl`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`);return d}const f=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:k},Symbol.toStringTag,{value:"Module"}));a.HighlightApply=c;a.build=k})},"esri/chunks/HighlightBlur.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec2f64 ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,m,l,r,n,g,k){function f(){const h=new r.ShaderBuilder,{vertex:v,fragment:w}=h,t=v.code,x=w.code;h.attributes.add(k.VertexAttribute.POSITION,"vec2");h.attributes.add(k.VertexAttribute.UV0,"vec2");h.varyings.add("blurCoordinate","vec3");v.uniforms.add(new g.Texture2DPassUniform("coverageTex",B=>B.coverageTexture));w.uniforms.add(new m.Float2DrawUniform("blurSize",B=>B.blurSize));t.add(l.glsl`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`);w.uniforms.add(new n.Texture2DDrawUniform("tex",B=>B.blurInputTexture));x.add(l.glsl`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture2D(tex, uv);
if (blurCoordinate.z == 1.0) {
gl_FragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
gl_FragColor = sum;
}
}`);return h}let d=function(h){function v(){var w=h.apply(this,arguments)||this;w.blurSize=c.create();return w}b._inheritsLoose(v,h);return v}(l.NoParameters);const e=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:d,build:f},Symbol.toStringTag,{value:"Module"}));a.HighlightBlur=e;a.HighlightBlurDrawParameters=d;a.build=f})},"esri/views/3d/webgl-engine/shaders/HighlightBlurTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HighlightBlur.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k){l=function(f){function d(){return f.apply(this,arguments)||this}c._inheritsLoose(d,f);var e=d.prototype;e.initializeProgram=function(h){const v=d.shader.get().build();return new n.Program(h.rctx,v,r.Default3D)};e.initializePipeline=function(){return k.makePipelineState({colorWrite:k.defaultColorWriteParams})};return d}(l.ShaderTechnique);l.shader=new m.ReloadableShaderModule(g.HighlightBlur,()=>new Promise((f,d)=>a(["./HighlightBlur.glsl"],f,d)));b.HighlightBlurTechnique=
l;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/HighlightDownsample.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec2f64 ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),function(a,
b,c,m,l,r,n,g){function k(){const e=new r.ShaderBuilder,{vertex:h,fragment:v}=e,w=h.code,t=v.code;e.attributes.add(g.VertexAttribute.POSITION,"vec2");w.add(l.glsl`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`);v.uniforms.add(new n.Texture2DDrawUniform("tex",x=>x.inputTexture));v.uniforms.add(new m.Float2DrawUniform("invFramebufferDim",x=>x.invFramebufferDim));t.add(l.glsl`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`);return e}let f=function(e){function h(){var v=e.apply(this,arguments)||this;v.invFramebufferDim=c.create();return v}b._inheritsLoose(h,e);return h}(l.NoParameters);const d=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:f,build:k},Symbol.toStringTag,{value:"Module"}));a.HighlightDownsample=d;a.HighlightDownsampleDrawParameters=f;a.build=k})},"esri/views/3d/webgl-engine/shaders/HighlightDownsampleTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HighlightDownsample.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k){l=function(f){function d(){return f.apply(this,arguments)||this}c._inheritsLoose(d,f);var e=d.prototype;e.initializeProgram=function(h){const v=d.shader.get().build();return new n.Program(h.rctx,v,r.Default3D)};e.initializePipeline=function(){return k.makePipelineState({colorWrite:k.defaultColorWriteParams})};return d}(l.ShaderTechnique);l.shader=new m.ReloadableShaderModule(g.HighlightDownsample,()=>new Promise((f,d)=>a(["./HighlightDownsample.glsl"],f,d)));b.HighlightDownsampleTechnique=
l;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/HighlightPassParameters":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec4f32","../../../../chunks/vec4f64","../core/shaderModules/interfaces"],function(a,b,c,m,l){l=function(r){function n(){var g=r.apply(this,arguments)||this;g.color=c.fromValues(1,0,1,1);g.haloColor=c.fromValues(1,0,1,1);g.haloOpacity=1;g.haloOpacityOccluded=
.25;g.fillOpacity=.2;g.fillOpacityOccluded=.05;g.shadowColor=m.fromValues(1,0,1,1);g.shadowOpacity=.15;g.occludedShadowOpacity=.075;return g}b._inheritsLoose(n,r);return n}(l.NoParameters);a.HighlightPassParameters=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/OffscreenRendering":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./basicInterfaces ./RenderTargetHelper ../shaders/CompositingTechniqueConfiguration ../../../webgl/context-util ../../../webgl/enums".split(" "),
function(a,b,c,m,l,r,n,g){let k=function(){function e(v,w){this._rctx=v;this._compositingHelper=w;this._mainColorTarget=0;this._dimensions={width:4,height:4};this._needLastFrameColorTexture=!1;this._background={type:"color",color:[0,0,0,1]};const t=v.type===n.ContextType.WEBGL2,x=this._renderTargetHelper=new l.RenderTargetHelper(v);this.mainColorTargets=[x.registerColorTarget({name:"mainColorTarget0"}),x.registerColorTarget({name:"mainColorTarget1"})];this.frontFaceTarget=x.registerColorTarget({name:"frontFaceTarget"});
v=B=>x.registerColorTarget({name:B,dataType:g.PixelType.FLOAT,internalFormat:t?g.SizedPixelFormat.RGBA32F:g.PixelFormat.RGBA,samplingMode:g.TextureSamplingMode.NEAREST});this.colorFloatTarget=v("colorFloatTarget");this.alphaFloatTarget=v("alphaFloatTarget");this.mainDepth=x.registerDepthTarget({name:"mainDepth"});this.linearDepth=x.registerColorTarget({name:"linearDepth",samplingMode:g.TextureSamplingMode.NEAREST});this.terrainLinearDepth=x.registerColorTarget({name:"terrainLinearDepth"});this.geometryLinearDepth=
x.registerColorTarget({name:"geometryLinearDepth"});this.normal=x.registerColorTarget({name:"normal"});this.highlight=x.registerColorTarget({name:"highlight",internalFormat:t?g.SizedPixelFormat.RGBA4:g.PixelFormat.RGBA,dataType:g.PixelType.UNSIGNED_SHORT_4_4_4_4});this.hudVisibility=x.registerColorTarget({name:"hudVisibility",internalFormat:t?g.SizedPixelFormat.RGBA4:g.PixelFormat.RGBA,dataType:g.PixelType.UNSIGNED_SHORT_4_4_4_4});this.tmpColor=x.registerColorTarget({name:"tmpColor"});this.tmpDepth=
x.registerDepthTarget({name:"tmpDepth"});this.hudColor=x.registerColorTarget({name:"hudColor"})}var h=e.prototype;h.dispose=function(){this._renderTargetHelper.dispose()};h.getFramebuffer=function(v,w){return this._renderTargetHelper.getFramebuffer(this._dimensions,v,w)};h.advanceCurrentRenderTarget=function(){this._mainColorTarget=0===this._mainColorTarget&&this._needLastFrameColorTexture?1:0};h.initializeFrame=function(v){const w=this._rctx;this._dimensions.width=v.fullWidth;this._dimensions.height=
v.fullHeight;this.bindTarget(this.currentColorTarget,this.mainDepth);w.setClearStencil(0);v=this._background.color;w.setClearColor(v[0]*v[3],v[1]*v[3],v[2]*v[3],v[3]);w.clearSafe(g.ClearBufferBit.COLOR_BUFFER_BIT|g.ClearBufferBit.DEPTH_BUFFER_BIT|g.ClearBufferBit.STENCIL_BUFFER_BIT)};h.composite=function(v){c.isSome(this.colorTexture)&&this._compositingHelper.composite(v,this.colorTexture,r.AlphaMode.None)};h.renderTmpAndCompositeToMain=function(v,w,t,x=!1){this.renderToTargets(v,this.tmpColor,x?
this.tmpDepth:this.mainDepth,f);this._compositingHelper.composite(w,this._getColorTexture(this.tmpColor),t)};h.renderHUDVisibility=function(v,w=!1){this.renderToTargets(v,this.hudVisibility,w?this.tmpDepth:this.mainDepth,d)};h.compositeTransparentTerrainOntoHUDVisibility=function(v){this.renderToTargets(()=>this._compositingHelper.composite(v,this._getColorTexture(this.tmpColor),r.AlphaMode.None,1,r.CompositingFunction.TransparentToHUDVisibility),this.hudVisibility,this.tmpDepth)};h.renderOITPass=
function(v,w,t){let x,B;switch(w){case m.TransparencyPassType.Color:x=this.colorFloatTarget;B=[0,0,0,0];break;case m.TransparencyPassType.Alpha:x=this.alphaFloatTarget;B=[1,1,1,1];break;case m.TransparencyPassType.FrontFace:x=this.frontFaceTarget,B=[0,0,0,0]}t?this.renderToTargets(v,x,this.tmpDepth,B,!0,!0):this.renderToTargets(v,x,this.mainDepth,B,!1)};h.compositeTransparentTerrainOntoMain=function(v){this.bindFramebuffer();this._compositingHelper.composite(v,this._getColorTexture(this.tmpColor),
r.AlphaMode.PremultipliedAlpha)};h.compositeOccludedOntoMain=function(v,w){this.bindFramebuffer();this._compositingHelper.composite(v,this._getColorTexture(this.tmpColor),r.AlphaMode.PremultipliedAlpha,w)};h.compositeTransparentOntoOpaque=function(v,w){w?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1E-13),this._rctx.clearSafe(g.ClearBufferBit.COLOR_BUFFER_BIT)):this.bindFramebuffer();this._compositingHelper.compositeTransparent(v,this._getColorTexture(this.colorFloatTarget),
this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))};h.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};h.renderDepthDetached=function(v){this.bindTarget(this.currentColorTarget);v();this.bindTarget(this.currentColorTarget,this.mainDepth)};h.disposeTarget=function(v){this._renderTargetHelper.disposeTargetResource(v)};h.renderToTargets=function(v,w,t,x,B=!1,q=!1){const u=this._rctx;w=this.bindTarget(w,t);t=0;x&&(u.setClearColor(x[0],x[1],
x[2],Math.max(1E-13,x[3])),t|=g.ClearBufferBit.COLOR_BUFFER_BIT);B&&(t|=g.ClearBufferBit.DEPTH_BUFFER_BIT);!1===q?q=0:(!0===q&&(q=255),t|=g.ClearBufferBit.STENCIL_BUFFER_BIT);t&&u.clearSafe(t,q);v();u.gl.flush();this.bindTarget(this.currentColorTarget,this.mainDepth);return w};h.bindTarget=function(v,w){v=this._renderTargetHelper.getFramebuffer(this._dimensions,v,w);this._rctx.bindFramebuffer(v);return v};h._getColorTexture=function(v){return this._renderTargetHelper.getColorTexture(v,this._dimensions)};
b._createClass(e,[{key:"width",get:function(){return this._dimensions.width}},{key:"height",get:function(){return this._dimensions.height}},{key:"background",get:function(){return this._background},set:function(v){this._background=v}},{key:"currentColorTarget",get:function(){return this.mainColorTargets[this._mainColorTarget]}},{key:"previousColorTarget",get:function(){return this.mainColorTargets[1-this._mainColorTarget]}},{key:"framebuffer",get:function(){return this.getFramebuffer(this.currentColorTarget,
this.mainDepth)}},{key:"colorTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}},{key:"depthTexture",get:function(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}},{key:"linearDepthTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}},{key:"terrainLinearDepthTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}},{key:"geometryLinearDepthTexture",
get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}},{key:"lastFrameColorTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}},{key:"normalTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}},{key:"highlightTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}},{key:"hudVisibilityTexture",get:function(){return this._getColorTexture(this.hudVisibility)}},
{key:"tmpColorTexture",get:function(){return this._getColorTexture(this.tmpColor)}},{key:"hudColorTexture",get:function(){return this._getColorTexture(this.hudColor)}},{key:"mainColorTexture",get:function(){return this._getColorTexture(this.currentColorTarget)}},{key:"needLastFrameColorTexture",get:function(){return this._needLastFrameColorTexture},set:function(v){!v&&this._needLastFrameColorTexture&&(this._mainColorTarget=0,this.disposeTarget(this.mainColorTargets[1]));this._needLastFrameColorTexture=
v}},{key:"gpuMemoryUsage",get:function(){let v=0;this._renderTargetHelper&&(v+=this._renderTargetHelper.gpuMemoryUsage);return v}}]);return e}();const f=[0,0,0,0],d=[0,1,0,1];a.OffscreenRendering=k;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/RenderTargetHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/uid ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,b,c,m,l,r,n,g,k){const f={dataType:l.PixelType.UNSIGNED_BYTE,internalFormat:l.PixelFormat.RGBA},d={};let e=function(){function h(w){this.rctx=w;this._activeTargets=new Set;this._depthTextures=new Map;this._depthBuffers=new Map;this._colorTextures=new Map;this._framebuffers=new Map;this.depthTextureSupported=w.capabilities.depthTexture}var v=h.prototype;v.dispose=function(){this._depthBuffers.forEach(w=>w.dispose());this._depthBuffers.clear();this._depthTextures.forEach(w=>w.dispose());
this._depthTextures.clear();this._colorTextures.forEach(w=>w.dispose());this._colorTextures.clear();this._framebuffers.forEach(w=>w.dispose());this._framebuffers.clear();this._activeTargets.clear()};v.disposeTargetResource=function(w){w=w.id;this._activeTargets.has(w)&&(this._activeTargets.delete(w),this._disposeWithFramebuffers(this._depthTextures,w),this._disposeWithFramebuffers(this._depthBuffers,w),this._disposeWithFramebuffers(this._colorTextures,w))};v._disposeWithFramebuffers=function(w,t){const x=
w.get(t);x&&(this._framebuffers.forEach((B,q)=>{if(B.colorAttachment===x||B.depthStencilAttachment===x)B.detachAll(),B.dispose(),this._framebuffers.delete(q)}),x.dispose(),w.delete(t))};v.getDepthTexture=function(w,t){if(!this.depthTextureSupported)return null;let x=this._depthTextures.get(w.id);!x||x.descriptor.width===t.width&&x.descriptor.height===t.height||(x.dispose(),x=null);x||(x=new g.Texture(this.rctx,{target:l.TextureType.TEXTURE_2D,pixelFormat:l.PixelFormat.DEPTH_STENCIL,dataType:l.PixelType.UNSIGNED_INT_24_8,
samplingMode:l.TextureSamplingMode.NEAREST,wrapMode:l.TextureWrapMode.CLAMP_TO_EDGE,width:t.width,height:t.height}),this._depthTextures.set(w.id,x),this._activeTargets.add(w.id));return x};v.getAllocatedDepthTexture=function(w){return this._depthTextures.get(w.id)};v.getDepthBuffer=function(w,t){if(this.depthTextureSupported)return null;let x=this._depthBuffers.get(w.id);x?x.descriptor.width===t.width&&x.descriptor.height===t.height||x.resize(t.width,t.height):(x=new n.Renderbuffer(this.rctx,{internalFormat:l.RenderbufferFormat.DEPTH_STENCIL,
...t}),this._depthBuffers.set(w.id,x),this._activeTargets.add(w.id));return x};v.getColorTexture=function(w,t){let x=this._colorTextures.get(w.id);!x||x.descriptor.width===t.width&&x.descriptor.height===t.height||(x.dispose(),x=null);x||(x=new g.Texture(this.rctx,{target:l.TextureType.TEXTURE_2D,pixelFormat:l.PixelFormat.RGBA,internalFormat:w.internalFormat,dataType:w.dataType,samplingMode:null!=w.samplingMode?w.samplingMode:l.TextureSamplingMode.LINEAR,wrapMode:l.TextureWrapMode.CLAMP_TO_EDGE,width:t.width,
height:t.height}),this._colorTextures.set(w.id,x),this._activeTargets.add(w.id));return x};v.getAllocatedColorTexture=function(w){return this._colorTextures.get(w.id)};v.registerDepthTarget=function(w={}){return{id:m.generateUID(),...d,...w}};v.registerColorTarget=function(w={}){return{id:m.generateUID(),...f,...w}};v.getFramebuffer=function(w,t,x){const B=this._getKey(t,x);let q=this._framebuffers.get(B);t=this.getColorTexture(t,w);if(this.depthTextureSupported){var u=x?this.getDepthTexture(x,w):
void 0;if(!q)return q=c.isSome(x)?new r.FramebufferObject(this.rctx,{colorTarget:l.TargetType.TEXTURE,depthStencilTarget:l.DepthStencilTargetType.DEPTH_STENCIL_TEXTURE},t,u):new r.FramebufferObject(this.rctx,{colorTarget:l.TargetType.TEXTURE,depthStencilTarget:l.DepthStencilTargetType.NONE},t),this._framebuffers.set(B,q),q;if(q.width!==w.width||q.height!==w.height||q.colorTexture!==t||q.depthStencilTexture!==u)q.detachAll(),q.resize(w.width,w.height),q.attachColorTexture(t),q.attachDepthStencilTexture(u);
return q}u=x?this.getDepthBuffer(x,w):void 0;if(!q)return q=new r.FramebufferObject(this.rctx,{colorTarget:l.TargetType.TEXTURE,depthStencilTarget:x?l.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER:l.DepthStencilTargetType.NONE},t,u),this._framebuffers.set(B,q),q;if(q.width!==w.width||q.height!==w.height||q.colorTexture!==t)q.detachAll(),q.resize(w.width,w.height),q.attachColorTexture(t),q.attachDepthStencilBuffer(u);return q};v._getKey=function(w,t){return`${w.id}_${t?t.id:"X"}_${w.name}${t?
"_"+t.name:""}`};b._createClass(h,[{key:"gpuMemoryUsage",get:function(){let w=0;const t=new Set,x=B=>{t.has(B)||(t.add(B),w+=k.getGpuMemoryUsage(B))};this._depthTextures.forEach(x);this._colorTextures.forEach(x);this._depthBuffers.forEach(x);return w}}]);return h}();a.RenderTargetHelper=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/RenderPluginManager":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/PooledArray ../../../../core/promiseUtils ./depthRange ./RenderSlot".split(" "),
function(a,b,c,m,l,r){let n=function(){function k(d){this.context=d;this._renderPlugins=new c;this.slots=[];for(d=0;d<r.RenderSlot.MAX_SLOTS;++d)this.slots[d]=[]}var f=k.prototype;f.add=function(d,e,h){const v=()=>{if(null!=h&&h.aborted)throw e.uninitializeRenderContext(),m.createAbortError();this._renderPlugins.push(e);for(const t of d)this.slots[t].push(e);this.context.requestRender()},w=e.initializeRenderContext(this.context,h);if(m.isPromiseLike(w))return w.then(v);v()};f.remove=function(d){if(null!=
this._renderPlugins.removeUnordered(d)){for(let e=0;e<this.slots.length;++e)this.slots[e]=this.slots[e].filter(h=>h!==d);d.uninitializeRenderContext();this.context.requestRender()}};f.prepareRender=function(){this._renderPlugins.forAll(d=>{d.prepareRender&&d.prepareRender(this.context.renderContext)})};f.updateAnimation=function(d){let e=!1;this._renderPlugins.forAll(h=>{h.updateAnimation&&(e=h.updateAnimation(d)||e)});return e};f.render=function(){const d=[];this.slots[this.context.renderContext.bindParameters.slot].filter(e=>
{if(!e.canRender)return!1;if("prepareTechnique"in e)return(e=e.prepareTechnique(this.context.renderContext))?(d.push(e),!0):!1;d.push(null);return!0}).forEach((e,h)=>e.render(this.context.renderContext,d[h]))};f.queryDepthRange=function(d){const e=g;e.near=Infinity;e.far=-Infinity;this._renderPlugins.forAll(h=>{h.queryDepthRange&&(h=h.queryDepthRange(d))&&l.union(e,h,e)});return e};b._createClass(k,[{key:"needsTransparentPass",get:function(){return this._renderPlugins.some(d=>d.needsTransparentPass)}},
{key:"needsHighlight",get:function(){return this._renderPlugins.some(d=>d.needsHighlight)}},{key:"needsLinearDepth",get:function(){return this._renderPlugins.some(d=>d.needsLinearDepth)}},{key:"needsLaserlineWithContrastControl",get:function(){const d=this.slots[r.RenderSlot.LASERLINES_CONTRAST_CONTROL];return!!d&&0<d.length}},{key:"renderOccludedFlags",get:function(){return this._renderPlugins.reduce((d,e)=>d|e.renderOccludedFlags,0)}}]);return k}();const g={near:0,far:0};a.RenderPluginManager=n;
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/ShadowAccumulator":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Handles ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../core/shaderTechnique/ShaderTechniqueConfiguration ./BindParameters ./Camera ./depthRange ./glUtil3D ./ShadowCastRenderer ./ShadowMap ../../../../chunks/ShadowCastAccumulate.glsl ../shaders/ShadowCastAccumulateTechnique ../../../support/Scheduler ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Util".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F){var G;a.ShadowAccumulator=G=function(K){function N(L,J,H,I,O,Q){var S=K.call(this,{})||this;S._rctx=L;S._stage=H;S._prepareForShadowMapPass=I;S._renderToShadowMap=O;S._requestRender=Q;S._progress=0;S._sampleCount=0;S._passParameters=new A.ShadowCastAccumulatePassParameters;S._enabled=!1;S._cachedLightDirections=[];S._depthRange=q.ZERO;S._previewing=!1;S._handles=new r;S._cameraForcedForScreenshot=!1;S._bindParameters=new x.BindParameters(new z.ShadowMap(L,
H.viewingMode),null,null);S._bindParameters.shadowMap.enabled=!0;S._bindParameters.camera=new B.Camera;S._vao=u.createQuadVAO(L);S._fbo=new E.FramebufferObject(L,{colorTarget:D.TargetType.TEXTURE,depthStencilTarget:D.DepthStencilTargetType.NONE,width:0,height:0},{target:D.TextureType.TEXTURE_2D,pixelFormat:D.PixelFormat.RGBA,dataType:D.PixelType.UNSIGNED_BYTE,samplingMode:D.TextureSamplingMode.LINEAR,wrapMode:D.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0});S._accumulationRenderer=new C.ShadowCastRenderer(J,
L,b._assertThisInitialized(S),Q);S._handles.add(S._stage.resourceController.scheduler.registerTask(y.TaskPriority.SHADOW_ACCUMULATOR,b._assertThisInitialized(S)));S._handles.add(k.watch(()=>H.renderView,T=>{S._handles.remove(G.renderViewHandleKey);g.isNone(T)||S._handles.add(T.events.on("force-camera-for-screenshot",()=>S._cameraForcedForScreenshot=!0),G.renderViewHandleKey)},k.syncAndInitial));return S}b._inheritsLoose(N,K);var M=N.prototype;M.normalizeCtorArgs=function(){return{}};M.runTask=function(L){for(this._prepareForShadowMapPass(this._bindParameters);!L.done&&
!this._isDoneAccumulating;)this._accumulateShadow(),L.madeProgress();this._requestRender()};M.renderAccumulation=function(L,J,H,I){this._passParameters.linearDepthTexture=L;this._depthRange=J;this._updateCamera(H);this._bindParameters.contentCamera=I;this.notifyChange("canAccumulate");if(this.isAccumulating&&this.canAccumulate){(this._previewing||0===this._progress||this._cameraForcedForScreenshot)&&this._clear();L=this._cameraForcedForScreenshot?this._sampleCount:Math.min(G.previewSamples,this._sampleCount-
this._progress);for(J=0;J<L;++J)this._accumulateShadow();this._cameraForcedForScreenshot=!1}};M.render=function(L){this._accumulationRenderer.render(L)};M.dispose=function(){this._stop();this._handles.destroy();this._accumulationRenderer=g.disposeMaybe(this._accumulationRenderer);this._bindParameters.shadowMap.dispose();this._fbo=g.disposeMaybe(this._fbo);this._vao=g.disposeMaybe(this._vao);this._accumulationTechnique=g.releaseMaybe(this._accumulationTechnique);this._sampleCount=this._cachedLightDirections.length=
0};M.setOptions=function(L){void 0!==L.enabled&&(this.enabled=L.enabled);void 0!==L.previewing&&(this.previewing=L.previewing);void 0!==L.lightDirections&&(this.lightDirections=L.lightDirections);this._accumulationRenderer.setOptions(L)};M.readAccumulatedShadow=function(L,J){if(!this._isActive||1>this._progress||0>L||L>this._fbo.width||0>J||J>this._fbo.height)return 0;const H=P;this._fbo.readPixels(L,J,1,1,D.PixelFormat.RGBA,D.PixelType.UNSIGNED_BYTE,H);return H[0]/this._progress};M._start=function(){this._progress=
0;this._enabled=!0};M._stop=function(){this._enabled=!1};M._invalidate=function(){this._progress=0;this._requestRenderIfEnabled()};M._clear=function(){this._rctx.bindFramebuffer(this._fbo);this._rctx.setClearColor(0,0,0,0);this._rctx.clearSafe(D.ClearBufferBit.COLOR_BUFFER_BIT);this._progress=0};M._accumulateShadow=function(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress],this._depthRange);this._passParameters.origin=this._bindParameters.camera.center;this._rctx.bindFramebuffer(this._fbo);
const L=this.accumulationTechnique;this._rctx.bindTechnique(L,this._passParameters,this._bindParameters);this._rctx.bindVAO(this._vao);this._rctx.drawArrays(L.primitiveType,0,F.vertexCount(this._vao,"geometry"));this._progress++};M._updateCamera=function(L){L.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(L),this._fbo.resize(L.fullWidth,L.fullHeight),this._opacityFromElevation=1-n.smoothstep(C.shadowCastDisableElevationMin,C.shadowCastDisableElevationMax,L.relativeElevation))};
M._requestRenderIfEnabled=function(){this._enabled&&this._requestRender()};b._createClass(N,[{key:"computedSamples",get:function(){return this._progress}},{key:"shadowCastTexture",get:function(){return this._fbo.colorTexture}},{key:"isAccumulating",get:function(){return this._isPreviewing||this._isRefining}},{key:"accumulationTechnique",get:function(){g.isNone(this._accumulationTechnique)&&(this._accumulationTechnique=new p.ShadowCastAccumulateTechnique({rctx:this._rctx,viewingMode:this._stage.viewingMode},
new t.ShaderTechniqueConfiguration));return this._accumulationTechnique}},{key:"_isRefining",get:function(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}},{key:"_isPreviewing",get:function(){return this._isActive&&this._previewing}},{key:"_isActive",get:function(){return this._enabled&&0<this._sampleCount}},{key:"canAccumulate",get:function(){return null!==this._passParameters.linearDepthTexture&&this._depthRange!==q.ZERO&&this._opacityFromElevation>C.shadowCastDisabledElevationThreshold}},
{key:"_isDoneAccumulating",get:function(){return this._progress>=this._sampleCount}},{key:"_lightDirections",get:function(){return this._cachedLightDirections},set:function(L){const J=this._cachedLightDirections;if(!l.equals(J,L,v.equals)){var H=L.length;J.length=H;this._sampleCount=Math.min(A.shadowCastMaxSamples,H);for(let I=0;I<H;++I){const O=L[I],Q=J[I]||w.create();v.copy(Q,O);J[I]=Q}this._invalidate()}}},{key:"_opacityFromElevation",get:function(){return this._accumulationRenderer.opacityFromElevation},
set:function(L){this._accumulationRenderer.opacityFromElevation=L}},{key:"running",get:function(){return this._isRefining&&this.canAccumulate&&0<this._progress}},{key:"previewing",set:function(L){this._previewing!==L&&(this._previewing=L,this._requestRenderIfEnabled())}},{key:"lightDirections",set:function(L){this._lightDirections=L}},{key:"enabled",set:function(L){L!==this._enabled&&(L?this._start():this._stop())}},{key:"test",get:function(){const L=this;return{lightDirections:this._lightDirections,
get isDone(){return L._isDoneAccumulating},get isActive(){return L._isActive}}}}]);return N}(m);a.ShadowAccumulator.previewSamples=6;a.ShadowAccumulator.renderViewHandleKey="renderView";c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_progress",void 0);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_sampleCount",void 0);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_enabled",void 0);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_depthRange",void 0);
c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_previewing",void 0);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_accumulationRenderer",void 0);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_isRefining",null);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_isActive",null);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"canAccumulate",null);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"_isDoneAccumulating",null);c.__decorate([f.property()],
a.ShadowAccumulator.prototype,"_opacityFromElevation",null);c.__decorate([f.property()],a.ShadowAccumulator.prototype,"running",null);a.ShadowAccumulator=G=c.__decorate([h.subclass("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],a.ShadowAccumulator);const P=new Uint8Array(4);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/ShadowCastRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec4 ../../../../chunks/vec4f64 ./glUtil3D ../shaders/ShadowCastVisualizeTechnique ../shaders/ShadowCastVisualizeTechniqueConfiguration ../../../webgl/Util".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t){const x=e.fromValues(.01,0,.25,1),B=1/512;a.ShadowCastRenderer=function(q){function u(z,A,p,y){var D=q.call(this,{})||this;D._techniqueRepository=z;D._rctx=A;D._shadowAccumulator=p;D._requestRender=y;D._passParameters={shadowCastMap:D._shadowCastTexture,sampleScale:0,color:x,threshold:.5,bandSize:.1,opacityFromElevation:1,__tagStrict:"NoParameters"};D._techniqueConfig=new w.ShadowCastVisualizeTechniqueConfiguration;D._enabled=!1;D._vao=h.createQuadVAO(A);
D._techniqueConfig.visualization=w.ShadowCastVisualization.Gradient;return D}b._inheritsLoose(u,q);var C=u.prototype;C.normalizeCtorArgs=function(){return{}};C.dispose=function(){this._stop();this._vao=l.disposeMaybe(this._vao);this._techniqueRepository.release(this._technique);this._shadowAccumulator=this._technique=null};C.render=function(z){if(this._isRenderingVisualization){this._passParameters.sampleScale=1/this._computedSamples;var A=this.visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao);
this._rctx.bindTechnique(A,this._passParameters,z);this._rctx.drawArrays(A.primitiveType,0,t.vertexCount(this._vao,"geometry"))}};C.setOptions=function(z){void 0!==z.enabled&&this._setEnabled(z.enabled);void 0!==z.color&&this._setColor(z.color);void 0!==z.threshold&&(this._threshold=z.threshold);void 0!==z.visualization&&(this._visualization=z.visualization);void 0!==z.bandSize&&(this._bandSize=z.bandSize);void 0!==z.bandsEnabled&&(this._bandsEnabled=z.bandsEnabled)};C._setColor=function(z){d.exactEquals(z,
this._passParameters.color)||(d.copy(this._passParameters.color,z),this._requestRenderIfRunning())};C._setEnabled=function(z){z!==this._enabled&&(z?this._start():this._stop())};C._requestRenderIfRunning=function(){this._enabled&&this._requestRender()};C._start=function(){this._enabled=!0;this._requestRender()};C._stop=function(){this._enabled=!1;this._requestRender()};b._createClass(u,[{key:"visualizeShadowCastTechnique",get:function(){return this._technique=this._techniqueRepository.releaseAndAcquire(v.ShadowCastVisualizeTechnique,
this._techniqueConfig,this._technique)}},{key:"opacityFromElevation",get:function(){return this._passParameters.opacityFromElevation},set:function(z){this._passParameters.opacityFromElevation!==z&&(this._passParameters.opacityFromElevation=z,this.notifyChange("opacityFromElevation"))}},{key:"_isRenderingVisualization",get:function(){return this._enabled&&0<this._computedSamples&&this.opacityFromElevation>B}},{key:"_computedSamples",get:function(){return this._shadowAccumulator.computedSamples}},{key:"_shadowCastTexture",
get:function(){return this._shadowAccumulator.shadowCastTexture}},{key:"_threshold",get:function(){return this._passParameters.threshold},set:function(z){this._threshold!==z&&(this._passParameters.threshold=z,this._requestRenderIfRunning())}},{key:"_visualization",get:function(){return this._techniqueConfig.visualization},set:function(z){z!==this._visualization&&(this._techniqueConfig.visualization=z,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}},
{key:"_bandSize",get:function(){return this._passParameters.bandSize},set:function(z){z!==this._bandSize&&(this._passParameters.bandSize=z,this._requestRenderIfRunning())}},{key:"_bandsEnabled",get:function(){return this._techniqueConfig.bandsEnabled},set:function(z){z!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=z,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}}]);return u}(m);c.__decorate([r.property()],a.ShadowCastRenderer.prototype,
"opacityFromElevation",null);a.ShadowCastRenderer=c.__decorate([f.subclass("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],a.ShadowCastRenderer);a.shadowCastDisableElevationMax=5E4;a.shadowCastDisableElevationMin=4E4;a.shadowCastDisabledElevationThreshold=B;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/ShadowCastVisualizeTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../../../../chunks/ShadowCastVisualize.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){l=function(e){function h(w,t){var x;return x=e.call(this,w,t,()=>x.destroy())||this}c._inheritsLoose(h,e);var v=h.prototype;v.initializeProgram=function(w){const t=h.shader.get().build(this.configuration);return new g.Program(w.rctx,t,r.Default3D)};v.initializePipeline=function(){return d.makePipelineState({blending:n.blendingDefault,colorWrite:d.defaultColorWriteParams,depthTest:null,depthWrite:null})};c._createClass(h,[{key:"primitiveType",get:function(){return f.PrimitiveType.TRIANGLE_STRIP}}]);
return h}(l.ShaderTechnique);l.shader=new m.ReloadableShaderModule(k.ShadowCastVisualize,()=>new Promise((e,h)=>a(["./ShadowCastVisualize.glsl"],e,h)));b.ShadowCastVisualizeTechnique=l;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/ShadowCastVisualize.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ./ShadowCastAccumulate.glsl ../views/3d/webgl-engine/shaders/ShadowCastVisualizeTechniqueConfiguration".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e){function h(w){const t=new k.ShaderBuilder,x=t.fragment;x.include(l.RgbaFloatEncoding);x.include(c.ReadLinearDepth);t.include(m.CameraSpace);t.include(b.ScreenSpacePass);const {visualization:B,bandsEnabled:q}=w;x.constants.add("inverseSampleValue","float",d.shadowCastMaxSamples);x.uniforms.add([new f.Texture2DPassUniform("shadowCastMap",C=>C.shadowCastMap),new n.FloatPassUniform("sampleScale",C=>C.sampleScale),new n.FloatPassUniform("opacityFromElevation",C=>C.opacityFromElevation),
new r.Float4PassUniform("uColor",C=>C.color)]);w=B===e.ShadowCastVisualization.Gradient;const u=B===e.ShadowCastVisualization.Threshold;w&&q?x.uniforms.add(new n.FloatPassUniform("bandSize",C=>C.bandSize)):u&&x.uniforms.add(new n.FloatPassUniform("threshold",C=>C.threshold));x.code.add(g.glsl`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${u?g.glsl`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${w&&q?g.glsl`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${w?g.glsl`* strength`:""});
      }
    `);return t}const v=Object.freeze(Object.defineProperty({__proto__:null,build:h},Symbol.toStringTag,{value:"Module"}));a.ShadowCastVisualize=v;a.build=h})},"esri/chunks/ShadowCastAccumulate.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./mat4 ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){function w(){const q=new h.ShaderBuilder,u=q.fragment;u.include(k.RgbaFloatEncoding);u.include(r.ReadLinearDepth);q.include(g.CameraSpace);q.include(l.ScreenSpacePass);q.include(n.ReadShadowMapPass,{receiveShadows:!0});u.uniforms.add([new v.Texture2DPassUniform("depthMap",C=>C.linearDepthTexture),new e.Matrix4PassUniform("inverseViewMatrix",(C,z)=>c.invert(B,c.translate(B,z.camera.viewMatrix,z.camera.center))),new f.Float2PassUniform("nearFar",(C,z)=>z.camera.nearFar)]);
u.constants.add("sampleValue","float",x);u.code.add(d.glsl`void main(void) {
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
gl_FragColor = vec4(sampleValue);
}`);return q}let t=function(q){function u(){return q.apply(this,arguments)||this}b._inheritsLoose(u,q);return u}(n.ReadShadowMapBindParameters);const x=1/255,B=m.create();m=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:t,shadowCastMaxSamples:255,build:w},Symbol.toStringTag,{value:"Module"}));a.ShadowCastAccumulate=m;a.ShadowCastAccumulatePassParameters=t;a.build=w;a.shadowCastMaxSamples=255})},"esri/views/3d/webgl-engine/shaders/ShadowCastVisualizeTechniqueConfiguration":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,m){a.ShadowCastVisualization=void 0;(function(r){r[r.Gradient=0]="Gradient";r[r.Threshold=1]="Threshold";r[r.COUNT=2]="COUNT"})(a.ShadowCastVisualization||(a.ShadowCastVisualization={}));let l=function(r){function n(){var g=r.apply(this,arguments)||this;g.visualization=a.ShadowCastVisualization.Gradient;g.bandsEnabled=!1;return g}b._inheritsLoose(n,r);
return n}(m.ShaderTechniqueConfiguration);c.__decorate([m.parameter({count:a.ShadowCastVisualization.COUNT})],l.prototype,"visualization",void 0);c.__decorate([m.parameter()],l.prototype,"bandsEnabled",void 0);a.ShadowCastVisualizeTechniqueConfiguration=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/ShadowCastAccumulateTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/ShadowCastAccumulate.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f){l=function(d){function e(v,w){var t;return t=d.call(this,v,w,()=>t.destroy())||this}c._inheritsLoose(e,d);var h=e.prototype;h.initializeProgram=function(v){const w=e.shader.get().build();return new n.Program(v.rctx,w,r.Default3D)};h.initializePipeline=function(){return f.makePipelineState({blending:f.separateBlendingParams(k.BlendFactor.ONE,k.BlendFactor.ONE,k.BlendFactor.ONE,k.BlendFactor.ONE),colorWrite:f.defaultColorWriteParams,depthTest:null,depthWrite:null})};c._createClass(e,
[{key:"primitiveType",get:function(){return k.PrimitiveType.TRIANGLE_STRIP}}]);return e}(l.ShaderTechnique);l.shader=new m.ReloadableShaderModule(g.ShadowCastAccumulate,()=>new Promise((d,e)=>a(["./ShadowCastAccumulate.glsl"],d,e)));b.ShadowCastAccumulateTechnique=l;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/ShadowHighlight":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../core/shaderLibrary/shading/ReadShadowMap.glsl ./glUtil3D ../shaders/ShadowHighlightTechnique ../../../webgl/Util".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){let e=function(){function v(t,x){this._rctx=t;this._viewingMode=x;this._maxOpacity=1;this._passParameters=new f.ShadowHighlightPassParameters;this._drawParameters=new g.ReadShadowMapBindParameters;this._vao=k.createQuadVAO(this._rctx)}var w=v.prototype;w.render=function(t,x){if(t.shadowMap.enabled&&t.linearDepthTexture&&this.isVisible){var B=this.technique;this._drawParameters.origin=t.camera.center;this._rctx.bindFramebuffer(x);this._rctx.bindTechnique(B,this._passParameters,
t).bindDraw(this._drawParameters,t);this._rctx.bindVAO(this._vao);this._rctx.drawArrays(B.primitiveType,0,d.vertexCount(this._vao,"geometry"))}};w.setDefaultOptions=function(t){this._passParameters={...this._passParameters,...t};this._updateMaxOpacity()};w.updateParameters=function(t,x){this._passParameters.opacityElevation=1-c.smoothstep(4E4,5E4,t.relativeElevation);t=this._viewingMode===n.ViewingMode.Global?l.normalize(h,t.center):l.set(h,0,0,1);x=l.dot(t,x);this._passParameters.dayNightTerminator=
c.smoothstep(0,1,c.clamp(30*x,0,1))};w.dispose=function(){this._vao=m.disposeMaybe(this._vao);this._technique=m.releaseMaybe(this._technique)};w._updateMaxOpacity=function(){this._maxOpacity=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity)*this._passParameters.shadowColor[3]};b._createClass(v,[{key:"technique",get:function(){m.isNone(this._technique)&&(this._technique=new f.ShadowHighlightTechnique({rctx:this._rctx,viewingMode:this._viewingMode}));return this._technique}},
{key:"gpuMemoryUsage",get:function(){var t,x;return null!=(t=null==(x=this._vao)?void 0:x.size)?t:0}},{key:"isVisible",get:function(){const {opacityElevation:t,dayNightTerminator:x}=this._passParameters;return.001953125<=this._maxOpacity*t*x}}]);return v}();const h=r.create();a.ShadowHighlight=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/ShadowHighlightTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec4f64 ../core/shaderModules/interfaces ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/ShadowHighlight.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e){l=function(h){function v(){var w=h.apply(this,arguments)||this;w.shadowColor=m.fromValues(1,0,1,1);w.shadowOpacity=.2;w.occludedShadowOpacity=.1;w.opacityElevation=1;w.dayNightTerminator=1;return w}c._inheritsLoose(v,h);return v}(l.NoParameters);n=function(h){function v(t){var x;return x=h.call(this,t,null,()=>x.destroy())||this}c._inheritsLoose(v,h);var w=v.prototype;w.initializeProgram=function(t){const x=v.shader.get().build();return new k.Program(t.rctx,x,g.Default3D)};
w.initializePipeline=function(){return e.makePipelineState({blending:e.separateBlendingParams(d.BlendFactor.SRC_ALPHA,d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA,d.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:e.defaultColorWriteParams,depthTest:null,depthWrite:null})};c._createClass(v,[{key:"primitiveType",get:function(){return d.PrimitiveType.TRIANGLE_STRIP}}]);return v}(n.ShaderTechnique);n.shader=new r.ReloadableShaderModule(f.ShadowHighlight,()=>new Promise((h,v)=>a(["./ShadowHighlight.glsl"],
h,v)));b.ShadowHighlightPassParameters=l;b.ShadowHighlightTechnique=n;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/ShadowHighlight.glsl":function(){define("exports ../core/maybe ./mat4 ./mat4f64 ./vec2 ./vec2f64 ./vec3 ./vec3f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/ShadowMap".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A){function p(){const G=new C.ShaderBuilder;G.include(e.ReadShadowMapDraw,{receiveShadows:!0});const P=G.fragment;P.include(v.RgbaFloatEncoding);P.include(d.ReadLinearDepth);G.include(h.CameraSpace);G.include(k.ScreenSpacePass);P.uniforms.add([new z.Texture2DPassUniform("defaultDepthTex",(K,N)=>N.shadowMap.getSnapshot(A.SnapshotSlot.Default)),new z.Texture2DPassUniform("highlightDepthTex",(K,N)=>N.shadowMap.getSnapshot(A.SnapshotSlot.Highlight)),
new z.Texture2DPassUniform("depthMap",(K,N)=>N.linearDepthTexture),new z.Texture2DPassUniform("highlightMap",(K,N)=>N.highlightColorTexture),new x.Float4PassUniform("uColor",K=>K.shadowColor),new w.Float2PassUniform("nearFar",(K,N)=>N.camera.nearFar),new B.FloatPassUniform("opacity",K=>K.shadowOpacity),new B.FloatPassUniform("occludedOpacity",K=>K.occludedShadowOpacity),new B.FloatPassUniform("terminationFactor",K=>K.opacityElevation*K.dayNightTerminator),new t.Float3PassUniform("lightingMainDirectionView",
(K,N)=>n.normalize(E,n.transformMat4(E,N.lighting.lightingMainDirection,N.camera.viewInverseTransposeMatrix))),new w.Float2PassUniform("texelSize",(K,N)=>b.isSome(N.linearDepthTexture)?l.set(F,1/N.linearDepthTexture.descriptor.width,1/N.linearDepthTexture.descriptor.height):r.ZEROS),new u.Matrix4PassUniform("inverseViewMatrix",(K,N)=>c.invert(D,c.translate(D,N.camera.viewMatrix,N.camera.center)))]);P.constants.add("unoccludedHighlightFlag","vec4",f.unoccludedHighlightFlag).add("highlightedThreshold",
"float",y.highlightedThreshold).add("selfShadowThreshold","float",y.selfShadowThreshold);P.code.add(q.glsl`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`);P.code.add(q.glsl`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`);return G}const y={highlightedThreshold:.99999,selfShadowThreshold:.025},D=m.create(),E=g.create(),F=r.create();m=Object.freeze(Object.defineProperty({__proto__:null,build:p},Symbol.toStringTag,{value:"Module"}));a.ShadowHighlight=m;a.build=p})},"esri/views/3d/webgl-engine/lib/SliceHelper":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/boundedPlane"],function(a,b){const c=b.create();return function(){function m(){this._plane=b.create()}a._createClass(m,[{key:"isEnabled",
get:function(){return!b.equals(this.plane,c)}},{key:"plane",get:function(){return this._plane},set:function(l){b.copy(l||c,this._plane)}}]);return m}()})},"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../support/requestImageUtils ./glUtil3D ./SMAATechnique ./SMAATechniqueConfiguration ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q){b.SmaaRenderPass=function(u){function C(A,p){var y=u.call(this,{})||this;y.rctx=A;y._techniqueRep=p;y._isEnabled=!1;return y}c._inheritsLoose(C,u);var z=C.prototype;z.normalizeCtorArgs=function(){return{}};z.dispose=function(){this._abortController=r.abortMaybe(this._abortController);this.disable()};z._loadResources=function(A){if(r.isSome(this._abortController))return!1;if(r.isSome(this._searchTexture))return!0;this._abortController=new AbortController;
const p=this._abortController.signal;(new Promise((y,D)=>a(["./SmaaRenderPassData"],y,D))).then(y=>this._loadTextures(y,p)).then(()=>A()).finally(()=>this._abortController=null);return!1};z._loadTextures=function(A,p){n.throwIfAborted(p);return Promise.all([this._loadTextureFromBase64(A.areaTexture,x.TextureSamplingMode.LINEAR,x.PixelFormat.RGB),this._loadTextureFromBase64(A.searchTexure,x.TextureSamplingMode.NEAREST,x.PixelFormat.LUMINANCE)]).then(([y,D])=>{n.isAborted(p)?(y.dispose(),D.dispose(),
n.throwIfAborted(p)):(this._areaTexture=y,this._searchTexture=D)})};z.enable=function(A){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const p=new t.SMAATechniqueConfiguration,y=(D,E)=>this._techniqueRep.releaseAndAcquire(w.SMAATechnique,D,E);p.output=t.SMAAOutput.EdgeDetector;this._edgeDetectTechnique=y(p,this._edgeDetectTechnique);p.output=t.SMAAOutput.BlendWeight;this._blendWeightsTechnique=y(p,this._blendWeightsTechnique);p.output=
t.SMAAOutput.Blur;this._blurTechnique=y(p,this._blurTechnique)}if(!this._loadResources(A))return!1;this._vao=v.createScreenSizeTriangleVAO(this.rctx);this._edges=new B.FramebufferObject(this.rctx,{colorTarget:x.TargetType.TEXTURE,depthStencilTarget:x.DepthStencilTargetType.NONE},{target:x.TextureType.TEXTURE_2D,pixelFormat:x.PixelFormat.RGB,dataType:x.PixelType.UNSIGNED_BYTE,samplingMode:x.TextureSamplingMode.LINEAR,wrapMode:x.TextureWrapMode.CLAMP_TO_EDGE,width:4,height:4});this._blend=new B.FramebufferObject(this.rctx,
{colorTarget:x.TargetType.TEXTURE,depthStencilTarget:x.DepthStencilTargetType.NONE},{target:x.TextureType.TEXTURE_2D,pixelFormat:x.PixelFormat.RGBA,dataType:x.PixelType.UNSIGNED_BYTE,samplingMode:x.TextureSamplingMode.LINEAR,wrapMode:x.TextureWrapMode.CLAMP_TO_EDGE,width:4,height:4});return this._isEnabled=!0};z.disable=function(){this._isEnabled&&(this._vao=r.disposeMaybe(this._vao),this._areaTexture=r.disposeMaybe(this._areaTexture),this._searchTexture=r.disposeMaybe(this._searchTexture),this._blend=
r.disposeMaybe(this._blend),this._edges=r.disposeMaybe(this._edges),this._isEnabled=!1)};z.render=function(A){if(this._isEnabled){var p=this.rctx,y=p.getBoundFramebufferObject(),D=A.descriptor.width,E=A.descriptor.height;p.bindVAO(this._vao);p.setViewport(0,0,D,E);this._edges.resize(D,E);p.bindFramebuffer(this._edges);p.setClearColor(0,0,0,1);p.clear(x.ClearBufferBit.COLOR_BUFFER_BIT);var F=p.bindTechnique(this._edgeDetectTechnique);F.bindTexture("tColor",A);F.setUniform4f("resolution",1/D,1/E,D,
E);p.drawArrays(x.PrimitiveType.TRIANGLES,0,3);this._blend.resize(D,E);p.bindFramebuffer(this._blend);p.setClearColor(0,0,1,1);p.clear(x.ClearBufferBit.COLOR_BUFFER_BIT);F=p.bindTechnique(this._blendWeightsTechnique);F.setUniform4f("resolution",1/D,1/E,D,E);F.bindTexture("tSearch",this._searchTexture);F.bindTexture("tArea",this._areaTexture);F.bindTexture("tEdges",this._edges.colorTexture);p.drawArrays(x.PrimitiveType.TRIANGLES,0,3);p.bindFramebuffer(y);p.setClearColor(0,1,0,1);p.clear(x.ClearBufferBit.COLOR_BUFFER_BIT);
y=p.bindTechnique(this._blurTechnique);y.setUniform4f("resolution",1/D,1/E,D,E);y.bindTexture("tColor",A);y.bindTexture("tBlendWeights",this._blend.colorTexture);p.drawArrays(x.PrimitiveType.TRIANGLES,0,3)}};z._loadTextureFromBase64=function(A,p,y){return h.requestImage(A).then(D=>new q.Texture(this.rctx,{pixelFormat:y,dataType:x.PixelType.UNSIGNED_BYTE,wrapMode:x.TextureWrapMode.CLAMP_TO_EDGE,width:D.width,height:D.height,samplingMode:p},D))};c._createClass(C,[{key:"updating",get:function(){return r.isSome(this._abortController)}}]);
return C}(l);m.__decorate([g.property()],b.SmaaRenderPass.prototype,"_abortController",void 0);m.__decorate([g.property({readOnly:!0})],b.SmaaRenderPass.prototype,"updating",null);b.SmaaRenderPass=m.__decorate([e.subclass("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],b.SmaaRenderPass);Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/SMAATechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../../chunks/SMAA.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k){l=function(f){function d(){return f.apply(this,arguments)||this}c._inheritsLoose(d,f);var e=d.prototype;e.initializeProgram=function(h){const v=d.shader.get().build(this.configuration);return new n.Program(h.rctx,v,r.Default3D)};e.initializePipeline=function(){return k.makePipelineState({colorWrite:k.defaultColorWriteParams})};return d}(l.ShaderTechnique);l.shader=new m.ReloadableShaderModule(g.SMAA,()=>new Promise((f,d)=>a(["../shaders/SMAA.glsl"],f,d)));b.SMAATechnique=
l;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/SMAA.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/Float4Uniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DUniform ../views/3d/webgl-engine/lib/SMAATechniqueConfiguration ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),function(a,
b,c,m,l,r,n){function g(d){const e=new m.ShaderBuilder;d.output===r.SMAAOutput.EdgeDetector&&(e.attributes.add(n.VertexAttribute.POSITION,"vec2"),e.vertex.uniforms.add(new b.Float4Uniform("resolution")),e.varyings.add("fTexCoord","vec2"),e.varyings.add("fOffset[3]","vec4"),e.vertex.code.add(c.glsl`void SMAAEdgeDetectionVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
fOffset[2] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAAEdgeDetectionVS( fTexCoord );
}`),e.fragment.uniforms.add(new l.Texture2DUniform("tColor")),e.fragment.code.add(c.glsl`
      vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {
        vec2 threshold = vec2( ${c.glsl.float(k.threshold)} );

        // Calculate color deltas:
        vec4 delta;
        vec3 C = texture2D( colorTex, texcoord ).rgb;

        vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;
        vec3 t = abs( C - Cleft );
        delta.x = max( max( t.r, t.g ), t.b );

        vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;
        t = abs( C - Ctop );
        delta.y = max( max( t.r, t.g ), t.b );

        // We do the usual threshold:
        vec2 edges = step( threshold, delta.xy );

        // Then discard if there is no edge:
        if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )
            discard;

        // Calculate right and bottom deltas:
        vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;
        t = abs( C - Cright );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;
        t = abs( C - Cbottom );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the maximum delta in the direct neighborhood:
        float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );

        // Calculate left-left and top-top deltas:
        vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;
        t = abs( C - Cleftleft );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;
        t = abs( C - Ctoptop );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the final maximum delta:
        maxDelta = max( max( maxDelta, delta.z ), delta.w );

        // Local contrast adaptation in action:
        edges.xy *= step( maxDelta, float(${c.glsl.float(k.localConstrastAdaption)}) * delta.xy );

        return vec4( edges, 0.0, 0.0 );
      }

      void main() {
        gl_FragColor = SMAAColorEdgeDetectionPS( fTexCoord, fOffset, tColor );
      }
    `));d.output===r.SMAAOutput.BlendWeight&&(e.attributes.add(n.VertexAttribute.POSITION,"vec2"),e.vertex.uniforms.add(new b.Float4Uniform("resolution")),e.varyings.add("fTexCoord","vec2"),e.varyings.add("fOffset[3]","vec4"),e.varyings.add("fPixCoord","vec2"),e.vertex.code.add(c.glsl`
      void SMAABlendingWeightCalculationVS( vec2 texcoord ) {
        fPixCoord = texcoord * resolution.zw;
        fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        fOffset[2] = vec4( fOffset[0].xz, fOffset[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${c.glsl.int(k.maxSearchSteps)} );
      }

      void main() {
        fTexCoord = (position + 1.0 ) * 0.5;
        gl_Position = vec4(position, 0, 1);
        SMAABlendingWeightCalculationVS( fTexCoord );
      }
    `),e.fragment.uniforms.add(new l.Texture2DUniform("tEdges")),e.fragment.uniforms.add(new l.Texture2DUniform("tArea")),e.fragment.uniforms.add(new l.Texture2DUniform("tSearch")),e.fragment.uniforms.add(new l.Texture2DUniform("tColor")),e.fragment.uniforms.add(new b.Float4Uniform("resolution")),e.fragment.code.add(c.glsl`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 SMAASampleLevelZeroOffset(sampler2D texture, vec2 coord, vec2 offset) {
        return texture2D(texture, coord + offset.x * resolution.xy, 0.0);
      }

      vec2 round( vec2 x ) {
        return sign( x ) * floor( abs( x ) + 0.5 );
      }

      float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${c.glsl.int(k.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${c.glsl.int(k.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${c.glsl.int(k.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${c.glsl.int(k.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${c.glsl.int(k.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {
        vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );
        vec2 e = texture2D( edgesTex, texcoord ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );
          coords.y = offset[ 1 ].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTex, coords, 0.0 ).r;
          coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );
          d.y = coords.x;
          d = d * resolution.z - pixcoord.x;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );
          coords.x = offset[ 0 ].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTex, coords, 0.0 ).g;
          coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );
          d.y = coords.y;
          d = d * resolution.w - pixcoord.y;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 0.0, 1.0 ) ).g;
          weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offset[ 0 ]+offset[ 1 ]+offset[ 2 ] + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0,1,0,1),dbg);
        }
        return weights;
      }

      void main() {
        gl_FragColor = SMAABlendingWeightCalculationPS( fTexCoord, fPixCoord, fOffset, tEdges, tArea, tSearch, ivec4( 0.0 ) );
      }
    `));d.output===r.SMAAOutput.Blur&&(e.attributes.add(n.VertexAttribute.POSITION,"vec2"),e.vertex.uniforms.add(new b.Float4Uniform("resolution")),e.varyings.add("fTexCoord","vec2"),e.varyings.add("fOffset[2]","vec4"),e.vertex.code.add(c.glsl`void SMAANeighborhoodBlendingVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAANeighborhoodBlendingVS(fTexCoord);
}`),e.fragment.uniforms.add(new l.Texture2DUniform("tBlendWeights")),e.fragment.uniforms.add(new l.Texture2DUniform("tColor")),e.fragment.uniforms.add(new b.Float4Uniform("resolution")),e.fragment.code.add(c.glsl`vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {
vec4 a;
a.xz = texture2D( blendTex, texcoord ).xz;
a.y = texture2D( blendTex, offset[ 1 ].zw ).g;
a.w = texture2D( blendTex, offset[ 1 ].xy ).a;
if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {
return texture2D( colorTex, texcoord, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTex, texcoord, 0.0 );
texcoord += sign( offset ) * resolution.xy;
vec4 Cop = texture2D( colorTex, texcoord, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
vec4 mixed = mix(C, Cop, s);
return mixed;
}
}
void main() {
gl_FragColor = SMAANeighborhoodBlendingPS( fTexCoord, fOffset, tColor, tBlendWeights );
}`));return e}const k={threshold:.05,localConstrastAdaption:2,maxSearchSteps:8,maxDistanceAreaTex:16},f=Object.freeze(Object.defineProperty({__proto__:null,build:g},Symbol.toStringTag,{value:"Module"}));a.SMAA=f;a.build=g})},"esri/views/3d/webgl-engine/lib/SMAATechniqueConfiguration":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,m){a.SMAAOutput=void 0;(function(r){r[r.EdgeDetector=
0]="EdgeDetector";r[r.BlendWeight=1]="BlendWeight";r[r.Blur=2]="Blur";r[r.COUNT=3]="COUNT"})(a.SMAAOutput||(a.SMAAOutput={}));let l=function(r){function n(){var g=r.apply(this,arguments)||this;g.output=a.SMAAOutput.EdgeDetector;return g}b._inheritsLoose(n,r);return n}(m.ShaderTechniqueConfiguration);c.__decorate([m.parameter({count:a.SMAAOutput.COUNT})],l.prototype,"output",void 0);a.SMAATechniqueConfiguration=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/arrayUtils ../../../../../core/Logger ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../core/support/WatchUpdatingTracking ../../../../../chunks/sphere ../../../../../chunks/vec33 ../../../../ViewingMode ../../collections/Component/Material/shader/ComponentData.glsl ../../core/util/TwoVectorPosition ../GridLocalOriginFactory ../localOriginHelper ../LocalOriginManager ../Object3D ../VertexAttribute ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing ./EdgeRenderer ./EdgeShaderParameters ./EdgeWorkerHandle ./interfaces ./strokes ./util ../TextureBackedBuffer/BufferManager ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N,M,L,J,H,I,O,Q,S,T,U){function aa(da){let ca=null,ha=null;for(let ka=0;ka<da.geometries.length;ka++){var ia;const la=da.geometryRecords[ka];if(la.material.supportsEdges){if(!ca)ca=la.transformation;else if(!l.equals(ca,la.transformation))return!1;if(!ha&&g.isSome(la.origin))ha=la;else if(g.isSome(null==(ia=ha)?void 0:ia.origin)&&g.isSome(la.origin)&&ha.origin.id!==la.origin.id)return!1}}return!0}const W=r.getLogger("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView");
a.EdgeView=function(da){function ca(ia){var ka=da.call(this,ia)||this;ka.updatingHandles=new q.WatchUpdatingTracking;ka.perObjectData=new Map;ka.perObjectDataEvictionCache=new Set;ka.renderers=new Map;ka.numberOfRenderedEdges={[H.Transparency.TRANSPARENT]:0,[H.Transparency.OPAQUE]:0};ka.gpuMemoryUsage=0;ka.workerAbort=new AbortController;ka.tmpModelPosition=B.create();ka.localOrigins=new E.LocalOriginManager(new y.GridLocalOriginFactory(ia.renderSR));return ka}b._inheritsLoose(ca,da);var ha=ca.prototype;
ha.initialize=function(){this.worker=new J(this.schedule);this.componentColorManager=new Q.BufferManager(this.rctx,3);const ia=P.VertexLayout.createBuffer(4);for(let ka=0;4>ka;ka++)ia.sideness.set(ka,0,0===ka||3===ka?0:1),ia.sideness.set(ka,1,0===ka||1===ka?0:1);this.verticesBufferObject=S.BufferObject.createVertex(this.rctx,T.Usage.STATIC_DRAW,ia.buffer)};ha.destroy=function(){this.destroyed||(this.perObjectData.forEach(ia=>this._discardObjectEntry(ia)),this.perObjectData.clear(),this.strokesTexture=
g.disposeMaybe(this.strokesTexture),this.componentColorManager=g.destroyMaybe(this.componentColorManager),this.workerAbort.abort(),this.worker.destroy(),this.verticesBufferObject=g.disposeMaybe(this.verticesBufferObject),this.renderers.clear(),this.updatingHandles.destroy())};ha.shouldRender=function(){return 0<this.renderers.size};ha.addComponentObject=function(){var ia=b._asyncToGenerator(function*(ka,la,Y,ea,ba,Z,fa,ja){if(this.hasObject(ka))return this.getObjectMemoryUsage(ka);let oa;Y=new R(new Promise(sa=>
oa=sa),Y.center,Y.radius);this.perObjectData.set(ka,Y);ka=yield this.updatingHandles.addPromise(this._addComponentGeometry(la,Y,ea,ba,Z,fa,ja));this.setNeedsRender();oa();return ka});return function(ka,la,Y,ea,ba,Z,fa,ja){return ia.apply(this,arguments)}}();ha.addOrUpdateObject3D=function(){var ia=b._asyncToGenerator(function*(ka,la,Y,ea){if(this.destroyed)W.warn("Attempt to add an object to a destroyed instance");else{var ba=this.perObjectData.get(ka);0<(null==ba?void 0:ba.renderables.length)&&this.perObjectDataEvictionCache.add(ba);
var Z,fa=ka.boundingVolumeWorldSpace.bounds;fa=new R(new Promise(oa=>Z=oa),u.getCenter(fa),u.getRadius(fa));this.perObjectData.set(ka,fa);var ja=[];if(Y.mergeGeometries&&1<ka.geometries.length&&aa(ka))ja.push(this._addObjectMergedGeometries(ka,fa,la,Y,ea));else for(let oa=0;oa<ka.geometries.length;oa++){const sa=ka.geometryRecords[oa];sa.material.supportsEdges&&ja.push(this._addGeometry(ka,fa,ka.geometries[oa],sa,la[0],Y,ea))}yield this.updatingHandles.addPromise(Promise.all(ja));this.perObjectDataEvictionCache.delete(fa);
this._discardObjectEntry(ba);this.setNeedsRender();Z()}});return function(ka,la,Y,ea){return ia.apply(this,arguments)}}();ha._discardObjectEntry=function(ia){ia&&(ia.renderables.length&&(ia.renderables.forEach(ka=>this._removeRenderable(ka)),this.setNeedsRender()),ia.loaded=null)};ha.hasObject=function(ia){return this.perObjectData.has(ia)};ha.updateAllComponentOpacities=function(){var ia=b._asyncToGenerator(function*(ka,la){const Y=la instanceof Array?ea=>la[ea]:()=>la;(yield this.updatingHandles.addPromise(this._getObjectEntry(ka))).renderables.forEach(ea=>
{const ba=ea.components.meta.length;for(let Z=0;Z<ba;Z++){const fa=Y(Z),ja=ea.components.meta[Z],oa=ja.index;ja.material.opacity=fa;ea.components.buffer.textureBuffer.setDataElement(oa,1,3,255*fa)}this._updateTransparency(ea)});this.setNeedsRender()});return function(ka,la){return ia.apply(this,arguments)}}();ha.getObjectMemoryUsage=function(){var ia=b._asyncToGenerator(function*(ka){return(yield this._getObjectEntry(ka)).renderables.reduce((la,Y)=>la+Y.statistics.gpuMemoryUsage,0)});return function(ka){return ia.apply(this,
arguments)}}();ha.updateAllComponentMaterials=function(){var ia=b._asyncToGenerator(function*(ka,la,Y,ea){const ba=ka instanceof F.Object3D,Z=!!Y.hasSlicePlane,fa=O.determineRendererType(la),ja=M.EdgeRenderer.getKey(fa,Z,ba);(yield this.updatingHandles.addPromise(this._getObjectEntry(ka))).renderables.forEach(oa=>{if(ja!==oa.rendererKey){var sa=this.renderers.get(oa.rendererKey);const qa=this._acquireRenderer(fa,Z,ba);sa.removeRenderable(oa);sa.refCount.decrement();oa.rendererKey=ja;qa.addRenderable(oa)}for(sa=
0;sa<la.length;sa++)oa.components.meta[sa].material=la[sa];ea&&this._updateComponentBuffer(oa.components);this._updateTransparency(oa)});this.setNeedsRender()});return function(ka,la,Y,ea){return ia.apply(this,arguments)}}();ha.updateAllVerticalOffsets=function(){var ia=b._asyncToGenerator(function*(ka,la){(yield this.updatingHandles.addPromise(this._getObjectEntry(ka))).renderables.forEach(Y=>{const ea=Y.components.meta;for(let Z=0;Z<ea.length;Z++){var ba;Y.components.meta[Z].verticalOffset=null!=
(ba=null==la?void 0:la[Z])?ba:0}this._updateComponentBuffer(Y.components)});this.setNeedsRender()});return function(ka,la){return ia.apply(this,arguments)}}();ha.updateObjectVisibility=function(){var ia=b._asyncToGenerator(function*(ka,la){(yield this.updatingHandles.addPromise(this._getObjectEntry(ka))).renderables.forEach(Y=>Y.visible=la);this.setNeedsRender()});return function(ka,la){return ia.apply(this,arguments)}}();ha.removeObject=function(ia){const ka=this.perObjectData.get(ia);ka&&(this.perObjectData.delete(ia),
this._discardObjectEntry(ka))};ha._getObjectEntry=function(){var ia=b._asyncToGenerator(function*(ka){ka=this.perObjectData.get(ka);if(!ka)throw"no object";yield ka.loaded;if(null==ka.loaded)throw k.createAbortError();return ka});return function(ka){return ia.apply(this,arguments)}}();ha.removeAll=function(){this.perObjectData.forEach((ia,ka)=>this.removeObject(ka))};ha.render=function(ia,ka){this.numberOfRenderedEdges[ka]=0;if(!g.isNone(this.componentColorManager)){this.localOrigins.updateViewMatrices(ia.camera.viewMatrix);
var la=ia.camera.viewInverseTransposeMatrix,Y=B.create(),ea=new p.TwoVectorPosition,ba=0,Z=0;this.renderers.forEach(ja=>{0===ja.refCount.value?(this.renderers.delete(ja.key),ja.dispose()):ja.forEachRenderable(oa=>{oa.visible&&(ba+=oa.statistics.averageEdgeLength,Z++,oa.regular&&ja.updateTechnique(ia,!1),oa.silhouette&&ja.updateTechnique(ia,!0))},ka)});this.componentColorManager.garbageCollect();this.componentColorManager.updateTextures();if(0!==Z){var fa=new L.EdgePassParameters(40*ba/Z,ia.camera.perScreenPixelRatio,
ka);x.set(Y,la[3],la[7],la[11]);ea.set(Y);x.copy(fa.transformWorldFromViewTH,ea.high);x.copy(fa.transformWorldFromViewTL,ea.low);v.fromMat4(fa.transformViewFromCameraRelativeRS,ia.camera.viewMatrix);v.transpose(V,fa.transformViewFromCameraRelativeRS);v.invert(fa.transformNormalViewFromGlobal,V);fa.transformProjFromView=ia.camera.projectionMatrix;this._updateObjectCameraDistances(ia);this.renderers.forEach(ja=>{this._renderRegularEdges(ja,ia,fa);this._renderSilhouetteEdges(ja,ia,fa)})}}};ha._updateTransparency=
function(ia){const ka=O.determineEdgeTransparency(ia.components.meta),la=O.determineObjectTransparency(ia.components.meta);if(ka!==ia.edgeTransparency||la!==ia.objectTransparency)ia.edgeTransparency=ka,ia.objectTransparency=la,this.renderers.get(ia.rendererKey).setRenderablesDirty()};ha._computeModelTransformWithLocalOrigin=function(ia,ka,la){ia.getCombinedStaticTransformation(ka,la);g.isSome(ka.origin)?this.localOrigins.register(ka.origin):(ia=x.set(this.tmpModelPosition,la[12],la[13],la[14]),ka.origin=
this.localOrigins.acquire(ia));D.applyToModelMatrix(ka.origin.vec3,la);return ka.origin};ha._updateComponentBuffer=function(ia){const {meta:ka,buffer:la}=ia;ia=new Uint8Array(4);for(let ea=0;ea<ka.length;ea++){var Y=ka[ea].material;const ba=ka[ea].index,Z=n.clamp(Math.round(Y.size*M.LINE_WIDTH_FRACTION_FACTOR),0,255),fa=n.clamp(Y.extensionLength,-M.EXTENSION_LENGTH_OFFSET,255-M.EXTENSION_LENGTH_OFFSET)+M.EXTENSION_LENGTH_OFFSET,ja="solid"===Y.type?N.EdgeType.SOLID:N.EdgeType.SKETCH,oa=255*Y.opacity;
Y=Y.color;la.textureBuffer.setData(ba,0,255*Y[0],255*Y[1],255*Y[2],255*Y[3]);la.textureBuffer.setData(ba,1,Z,fa,ja,oa);A.encodeElevationOffset(ka[ea].verticalOffset,ia);la.textureBuffer.setData(ba,2,ia[0],ia[1],ia[2],ia[3])}};ha._createComponentBuffers=function(ia){if(g.isNone(this.componentColorManager))return null;const ka=[],la=this.componentColorManager.getBuffer(ia.length);for(let Y=0;Y<ia.length;Y++){const ea=ia[Y],ba=la.acquireIndex();ka.push({index:ba,verticalOffset:0,material:ea})}ia={meta:ka,
buffer:la};this._updateComponentBuffer(ia);return ia};ha._extractEdges=function(ia,ka,la,Y,ea,ba=ea.length){return this.worker.process({data:ka,indices:ea,indicesLength:ba,writerSettings:ia,skipDeduplicate:la},this.workerAbort.signal,Y)};ha._createEdgeResources=function(ia){const ka={};if(g.isNone(this.verticesBufferObject))return ka;if(0<ia.regular.lodInfo.lengths.length){var la=new U.VertexArrayObject(this.rctx,P.EdgeShaderAttributeLocations,{vertices:P.glVertexLayout,instances:K.RegularEdgeBufferWriter.glLayout},
{vertices:this.verticesBufferObject,instances:S.BufferObject.createVertex(this.rctx,T.Usage.STATIC_DRAW,ia.regular.instancesData.buffer)});ka.regular={vao:la,lod:ia.regular.lodInfo}}0<ia.silhouette.lodInfo.lengths.length&&(la=new U.VertexArrayObject(this.rctx,P.EdgeShaderAttributeLocations,{vertices:P.glVertexLayout,instances:K.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:S.BufferObject.createVertex(this.rctx,T.Usage.STATIC_DRAW,ia.silhouette.instancesData.buffer)}),
ka.silhouette={vao:la,lod:ia.silhouette.lodInfo});return ka};ha._addGeometry=function(){var ia=b._asyncToGenerator(function*(ka,la,Y,ea,ba,Z,fa){const ja=Y.vertexAttributes.get(G.VertexAttribute.POSITION),oa=Y.indices.get(G.VertexAttribute.POSITION),sa=t.create();ka=this._computeModelTransformWithLocalOrigin(ka,ea,sa);return this._addPositionData(la,{position:ja,indices:oa,modelTransform:sa,origin:ka},Y.edgeIndicesLength,ba,Z,fa)});return function(ka,la,Y,ea,ba,Z,fa){return ia.apply(this,arguments)}}();
ha._addPositionData=function(){var ia=b._asyncToGenerator(function*(ka,la,Y,ea,ba,Z=!1){if(null!=ka.loaded){var fa=this._createComponentBuffers([ea]);if(!(g.isNone(fa)||0>=Y)){ea=this._acquireRenderer(ea.type,!!ba.hasSlicePlane,!0);var {modelTransform:ja,origin:oa}=la;ba=la.indices;la=la.position;var sa=la.data.length/la.size,qa=P.EdgeInputBufferLayout.createBuffer(sa);for(let pa=0;pa<sa;pa++)qa.position.set(pa,0,la.data[pa*la.size]),qa.position.set(pa,1,la.data[pa*la.size+1]),qa.position.set(pa,
2,la.data[pa*la.size+2]);O.fillComponenBufferIndices(fa.meta,[0,qa.componentIndex.count],qa.componentIndex);Z=yield this.updatingHandles.addPromise(this._extractEdges(ea.writerSettings,qa,!1,Z,ba,Y));if(null!=ka.loaded){var {regular:Ha,silhouette:Ga}=this._createEdgeResources(Z);Y=(Ha?Ha.vao.size:0)+(Ga?Ga.vao.size:0);fa={regular:Ha,silhouette:Ga,transform:{modelMatrix:ja,origin:oa},statistics:{gpuMemoryUsage:Y,externalMemoryUsage:!1,averageEdgeLength:Z.averageEdgeLength},components:fa,visible:!0,
edgeTransparency:O.determineEdgeTransparency(fa.meta),objectTransparency:O.determineObjectTransparency(fa.meta),distanceToCamera:0,rendererKey:ea.key};ka.renderables.push(fa);ea.addRenderable(fa);this.gpuMemoryUsage+=Y}}}});return function(ka,la,Y,ea,ba){return ia.apply(this,arguments)}}();ha._addComponentGeometry=function(){var ia=b._asyncToGenerator(function*(ka,la,Y,ea,ba,Z,fa){if(null==la.loaded)return 0;const ja=this._createComponentBuffers(Z);if(g.isNone(ja))return 0;Z=O.determineRendererType(Z);
fa=this._acquireRenderer(Z,fa.hasSlicePlane||!1,!1);Z=P.EdgeInputBufferLayout.createBuffer(Y.count);C.copy(Z.position,Y);O.fillComponenBufferIndices(ja.meta,ba,Z.componentIndex,ea);ea=yield this.updatingHandles.addPromise(this._extractEdges(fa.writerSettings,Z,!0,!1,ea));if(null==la.loaded)return 0;const {regular:oa,silhouette:sa}=this._createEdgeResources(ea);Y=(oa?oa.vao.size:0)+(sa?sa.vao.size:0);ka={regular:oa,silhouette:sa,transform:ka,statistics:{gpuMemoryUsage:Y,externalMemoryUsage:!0,averageEdgeLength:ea.averageEdgeLength},
components:ja,visible:!0,edgeTransparency:O.determineEdgeTransparency(ja.meta),objectTransparency:O.determineObjectTransparency(ja.meta),distanceToCamera:0,rendererKey:fa.key};la.renderables.push(ka);fa.addRenderable(ka);return Y});return function(ka,la,Y,ea,ba,Z,fa){return ia.apply(this,arguments)}}();ha._addObjectMergedGeometries=function(){var ia=b._asyncToGenerator(function*(ka,la,Y,ea,ba){var Z=new Map,fa=0,ja=null,oa=0;for(var sa=0;sa<ka.geometries.length;sa++){var qa=ka.geometries[sa],Ha=ka.geometryRecords[sa];
Ha.material.supportsEdges&&(!ja&&Ha.origin&&(ja=Ha),Ha=qa.vertexAttributes.get(G.VertexAttribute.POSITION),oa+=Ha.data.length/Ha.size,fa+=qa.edgeIndicesLength)}oa=65536<=oa?Uint32Array:Uint16Array;fa=fa?new oa(fa):null;oa=[];sa=0;for(qa=0;qa<ka.geometries.length;qa++){Ha=ka.geometries[qa];if(!ka.geometryRecords[qa].material.supportsEdges)continue;var Ga=Ha.vertexAttributes.get(G.VertexAttribute.POSITION);const pa=Ha.indices.get(G.VertexAttribute.POSITION);let Da=Z.get(Ga.data);if(null==Da){Da=oa.length/
3;for(let ra=0;ra<Ga.data.length;ra+=Ga.size)oa.push(Ga.data[ra+0]),oa.push(Ga.data[ra+1]),oa.push(Ga.data[ra+2]);Z.set(Ga.data,Da)}if(pa)for(Ga=0;Ga<Ha.edgeIndicesLength;Ga++)fa[sa++]=Da+pa[Ga]}ja=ja||ka.geometryRecords[0];Z=t.create();ja=this._computeModelTransformWithLocalOrigin(ka,ja,Z);for(sa=0;sa<ka.geometryRecords.length;sa++)ka.geometryRecords[sa].origin=ja;yield this.updatingHandles.addPromise(this._addPositionData(la,{position:{data:oa,size:3},indices:fa,modelTransform:Z,origin:ja},fa.length,
Y[0],ea,ba))});return function(ka,la,Y,ea,ba){return ia.apply(this,arguments)}}();ha._acquireRenderer=function(ia,ka,la){const Y=M.EdgeRenderer.getKey(ia,ka,la);let ea=this.renderers.get(Y);g.isNone(this.strokesTexture)&&(this.strokesTexture=I.generateStrokesTexture(this.rctx));ea||(ea=new M.EdgeRenderer(this.rctx,this.techniqueRepository,{type:ia,hasSlicePlane:ka,strokesTexture:this.strokesTexture,legacy:la,spherical:this.viewingMode===z.ViewingMode.Global}),this.renderers.set(Y,ea));ea.refCount.increment();
return ea};ha._removeRenderable=function(ia){ia.regular&&(ia.regular.vao.vertexBuffers.instances.dispose(),ia.regular.vao.dispose(!1),ia.regular.vao=null);ia.silhouette&&(ia.silhouette.vao.vertexBuffers.instances.dispose(),ia.silhouette.vao.dispose(!1),ia.silhouette.vao=null);const ka=this.renderers.get(ia.rendererKey);if(ka){ka.removeRenderable(ia);ka.refCount.decrement();"origin"in ia.transform&&this.localOrigins.release(ia.transform.origin);this.gpuMemoryUsage-=ia.statistics.externalMemoryUsage?
0:ia.statistics.gpuMemoryUsage;for(const la of ia.components.meta)ia.components.buffer.releaseIndex(la.index)}};ha._updateObjectCameraDistances=function(ia){const ka=ia.camera.eye,la=ia.camera.viewForward,Y=B.create();ia=ea=>{const {center:ba,radius:Z}=ea;x.sub(Y,ba,ka);const fa=x.dot(Y,la),ja=fa<-Z?Infinity:fa<Z?0:fa-Z;ea.renderables.forEach(oa=>oa.distanceToCamera=ja)};this.perObjectData.forEach(ia);this.perObjectDataEvictionCache.forEach(ia)};ha._renderRegularEdges=function(ia,ka,la){const Y=ia.bindRegularEdges(la,
ka),ea=la.transparency;ia.forEachRenderable(ba=>{if(ba.visible&&ba.regular){var Z=O.computeEdgeCount(ba.regular.lod.lengths,ba.distanceToCamera,la),fa="origin"in ba.transform?this.localOrigins.getViewMatrix(ba.transform.origin):t.IDENTITY;ia.renderRegularEdges(Y,ba,ka,Z,fa);this.numberOfRenderedEdges[ea]+=Z}},ea)};ha._renderSilhouetteEdges=function(ia,ka,la){const Y=ia.bindSilhouetteEdges(la,ka),ea=la.transparency;ia.forEachRenderable(ba=>{if(ba.visible&&ba.silhouette){var Z=O.computeEdgeCount(ba.silhouette.lod.lengths,
ba.distanceToCamera,la),fa="origin"in ba.transform?this.localOrigins.getViewMatrix(ba.transform.origin):t.IDENTITY;ia.renderSilhouetteEdges(Y,ba,ka,Z,fa);this.numberOfRenderedEdges[ea]+=Z}},ea)};b._createClass(ca,[{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"usedMemory",get:function(){return this.gpuMemoryUsage}},{key:"numberOfRenderedPrimitives",get:function(){return this.numberOfRenderedEdges[H.Transparency.TRANSPARENT]+this.numberOfRenderedEdges[H.Transparency.OPAQUE]}}]);
return ca}(m);c.__decorate([f.property({constructOnly:!0})],a.EdgeView.prototype,"rctx",void 0);c.__decorate([f.property({constructOnly:!0})],a.EdgeView.prototype,"renderSR",void 0);c.__decorate([f.property({constructOnly:!0})],a.EdgeView.prototype,"viewingMode",void 0);c.__decorate([f.property({constructOnly:!0})],a.EdgeView.prototype,"techniqueRepository",void 0);c.__decorate([f.property({constructOnly:!0})],a.EdgeView.prototype,"setNeedsRender",void 0);c.__decorate([f.property({constructOnly:!0})],
a.EdgeView.prototype,"schedule",void 0);c.__decorate([f.property({readOnly:!0})],a.EdgeView.prototype,"updatingHandles",void 0);c.__decorate([f.property({readOnly:!0})],a.EdgeView.prototype,"updating",null);a.EdgeView=c.__decorate([h.subclass("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],a.EdgeView);let R=function(da,ca,ha){this.center=ca;this.radius=ha;this.renderables=[];this.loaded=da;this.loaded.then(()=>{null!=this.loaded&&(this.loaded=!0)})};const V=w.create();Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["exports"],function(a){a.applyToModelMatrix=function(b,c){const m=-b[0],l=-b[1];b=-b[2];const r=c[3],n=c[7],g=c[11],k=c[15];c[0]+=r*m;c[1]+=r*l;c[2]+=r*b;c[4]+=n*m;c[5]+=n*l;c[6]+=n*b;c[8]+=g*m;c[9]+=g*l;c[10]+=g*b;c[12]+=k*m;c[13]+=k*l;c[14]+=k*b};a.applyToViewMatrix=function(b,c){const m=b[0],l=b[1];b=b[2];c[12]+=m*c[0]+l*c[4]+b*c[8];c[13]+=m*c[1]+l*c[5]+b*c[9];
c[14]+=m*c[2]+l*c[6]+b*c[10];c[14]+=m*c[3]+l*c[7]+b*c[11]};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["exports","../../../../chunks/mat4","../../../../chunks/mat4f64","./localOriginHelper"],function(a,b,c,m){let l=function(){function r(g){this.factory=g;this.originData=new Map}var n=r.prototype;n.acquire=function(g){return this.register(this.factory.getOrigin(g))};n.register=function(g){const k=
this.originData.get(g.id);if(k)return k.refCount++,k.origin;this.originData.set(g.id,{refCount:1,viewMatrix:c.create(),origin:g});return g};n.release=function(g){const k=this.originData.get(g.id);k&&(k.refCount--,0===k.refCount&&this.originData.delete(g.id))};n.updateViewMatrices=function(g){this.originData.forEach(k=>{b.copy(k.viewMatrix,g);m.applyToViewMatrix(k.origin.vec3,k.viewMatrix)})};n.getViewMatrix=function(g){return this.originData.get(g.id).viewMatrix};return r}();a.LocalOriginManager=
l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../../../chunks/vec3 ../../../support/debugFlags ../../core/shaderLibrary/util/DoublePrecision.glsl ../../core/util/TwoVectorPosition ./EdgeShaderParameters ./EdgeShaderTechnique ./EdgeShaderTechniqueConfiguration ./interfaces ../../shaders/sources/edgeRenderer/EdgeUtil.glsl ../../../../webgl/enums".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t){const x={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0};let B=function(){function C(){this._value=0}var z=C.prototype;z.increment=function(){this._value++};z.decrement=function(){this._value--};b._createClass(C,[{key:"value",get:function(){return this._value}}]);return C}();const q={solid:w.EdgeUtilMode.SOLID,sketch:w.EdgeUtilMode.SKETCH,uber:w.EdgeUtilMode.MIXED};w=function(){function C(A,p,y){this.rctx=A;this.shaderTechniqueRepository=
p;this._configuration=new h.EdgeShaderTechniqueConfiguration;this.refCount=new B;this.renderables=new Set;this.sortedRenderables={[v.Transparency.TRANSPARENT]:{[v.Transparency.TRANSPARENT]:new m,[v.Transparency.OPAQUE]:new m},[v.Transparency.OPAQUE]:{[v.Transparency.TRANSPARENT]:new m,[v.Transparency.OPAQUE]:new m}};this._renderablesDirty=!1;this._drawParameters=new d.EdgeDrawParameters;this._settings={...x,...y};this.key=C.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);
this.writerSettings={variants:this._settings.strokesTexture.variants,reducedPrecision:g.TESTS_DISABLE_OPTIMIZATIONS};this._configuration.legacy=this._settings.legacy;this._configuration.mode=q[this._settings.type];this._configuration.silhouette=!1;this._configuration.antialiasing=!!this.rctx.capabilities.blendMinMax;this._configuration.hasSlicePlane=this._settings.hasSlicePlane;this._configuration.doublePrecisionRequiresObfuscation=k.doublePrecisionRequiresObfuscation(A);this._configuration.spherical=
y.spherical}var z=C.prototype;z.dispose=function(){this._technique=c.releaseMaybe(this._technique)};z.addRenderable=function(A){this.renderables.add(A);this._renderablesDirty=!0};z.removeRenderable=function(A){this.renderables.delete(A);this._renderablesDirty=!0};z.setRenderablesDirty=function(){this._renderablesDirty=!0};z.forEachRenderable=function(A,p){this._renderablesDirty&&this._sortRenderables();this.sortedRenderables[p][v.Transparency.TRANSPARENT].forAll(A);this.sortedRenderables[p][v.Transparency.OPAQUE].forAll(A)};
z.updateTechnique=function(A,p){this._configuration.hasMultipassTerrain=!!A.multipassTerrain.enabled;this._configuration.cullAboveGround=!!A.multipassTerrain.cullAboveGround;this._configuration.silhouette=p;return this._technique=this.shaderTechniqueRepository.releaseAndAcquire(e.EdgeShaderTechnique,this._configuration,this._technique)};z.bindRegularEdges=function(A,p){return this.rctx.bindTechnique(this.updateTechnique(p,!1),A,p)};z.bindSilhouetteEdges=function(A,p){return this.rctx.bindTechnique(this.updateTechnique(p,
!0),A,p)};z.renderRegularEdges=function(A,p,y,D,E){this._render(A,p,p.regular.vao,y,D,E)};z.renderSilhouetteEdges=function(A,p,y,D,E){this._render(A,p,p.silhouette.vao,y,D,E)};z._render=function(A,p,y,D,E,F){this._bindDraw(A,p,D,F);this.rctx.bindVAO(y);this.rctx.capabilities.instancing.drawArraysInstanced(t.PrimitiveType.TRIANGLE_FAN,0,4,E)};z._bindDraw=function(A,p,y,D){p.components.buffer.textureBuffer.bind(A,"componentDataTex","componentDataTexInvDim");if("origin"in p.transform)A.setUniformMatrix4fv("localView",
D),A.setUniformMatrix4fv("model",p.transform.modelMatrix),n.copy(this._drawParameters.slicePlaneLocalOrigin,p.transform.origin.vec3);else{D=new f.TwoVectorPosition(p.transform.position);const E=l.transpose(u,l.invert(u,p.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=D.low;this._drawParameters.transformWorldFromModelTH=D.high;this._drawParameters.transformWorldFromModelRS=p.transform.rotationScale;this._drawParameters.transformNormalGlobalFromModel=E;p=y.camera.viewInverseTransposeMatrix;
n.set(this._drawParameters.slicePlaneLocalOrigin,p[3],p[7],p[11])}A.bindDraw(this._drawParameters,y);"uber"!==this._settings.type&&"sketch"!==this._settings.type||this._setSketchUniforms(A)};z._setSketchUniforms=function(A){const p=this._settings.strokesTexture,y=p.texture;c.isNone(y)||(A.bindTexture("strokesTexture",y),A.setUniform2f("strokesTextureScale",1/y.descriptor.width,1/y.descriptor.height),A.setUniform1f("strokesLog2Resolution",Math.log2(p.resolution)),A.setUniform1f("strokesNormalizationScale",
p.normalizationScale),A.setUniform1f("strokesAmplitude",p.amplitude),A.setUniform1f("strokeVariants",p.variants))};z._sortRenderables=function(){this._renderablesDirty=!1;this.sortedRenderables[v.Transparency.TRANSPARENT][v.Transparency.TRANSPARENT].clear();this.sortedRenderables[v.Transparency.TRANSPARENT][v.Transparency.OPAQUE].clear();this.sortedRenderables[v.Transparency.OPAQUE][v.Transparency.TRANSPARENT].clear();this.sortedRenderables[v.Transparency.OPAQUE][v.Transparency.OPAQUE].clear();this.renderables.forEach(p=>
{p.objectTransparency!==v.Transparency.INVISIBLE&&p.edgeTransparency!==v.Transparency.INVISIBLE&&this.sortedRenderables[p.objectTransparency][p.edgeTransparency].push(p)});const A=(p,y)=>"origin"in p.transform&&"origin"in y.transform?p.transform.origin.id<y.transform.origin.id?-1:p.transform.origin.id>y.transform.origin.id?1:0:0;this.sortedRenderables[v.Transparency.TRANSPARENT][v.Transparency.TRANSPARENT].sort(A);this.sortedRenderables[v.Transparency.TRANSPARENT][v.Transparency.OPAQUE].sort(A);this.sortedRenderables[v.Transparency.OPAQUE][v.Transparency.TRANSPARENT].sort(A);
this.sortedRenderables[v.Transparency.OPAQUE][v.Transparency.OPAQUE].sort(A)};C.getKey=function(A,p,y){return`edges-t:${A}:${p}:${y}`};return C}();const u=r.create();a.EXTENSION_LENGTH_OFFSET=128;a.EdgeRenderer=w;a.LINE_WIDTH_FRACTION_FACTOR=8;a.componentDataInvDimName="componentDataTexInvDim";a.componentDataTexName="componentDataTex";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderParameters":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/mat3f64","../../../../../chunks/vec3f64","../../core/shaderLibrary/attributes/VertexPosition.glsl"],function(a,b,c,m,l){let r=function(n){function g(k,f,d){var e=n.call(this)||this;e.distanceFalloffFactor=k;e.minimumEdgeLength=f;e.transparency=d;e.transformNormalViewFromGlobal=c.create();return e}b._inheritsLoose(g,n);return g}(l.VertexPositionPassParameters);l=function(n){function g(){var k=n.apply(this,arguments)||this;k.transformNormalViewFromGlobal=
c.create();k.slicePlaneLocalOrigin=m.create();k.transformNormalGlobalFromModel=c.create();return k}b._inheritsLoose(g,n);return g}(l.VertexPositionDrawParameters);a.EdgeDrawParameters=l;a.EdgePassParameters=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechnique":function(){define("require exports ../../../../../chunks/_rollupPluginBabelHelpers ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../Program ./bufferLayouts ../../../../../chunks/EdgeShader.glsl ../../../../webgl/enums ../../../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f){l=function(d){function e(){return d.apply(this,arguments)||this}c._inheritsLoose(e,d);var h=e.prototype;h.initializeProgram=function(v){const w=e.shader.get().build(this.configuration);return new r.Program(v.rctx,w,n.EdgeShaderAttributeLocations)};h.initializePipeline=function(v){return v.blendMinMax?f.makePipelineState({blending:f.separateBlendingParams(k.BlendFactor.ONE,k.BlendFactor.ONE,k.BlendFactor.ZERO,k.BlendFactor.ONE,k.BlendOperation.ADD,v.blendMinMax.MAX),depthTest:{func:k.CompareFunction.LEQUAL},
colorWrite:f.defaultColorWriteParams}):f.makePipelineState({depthTest:{func:k.CompareFunction.LEQUAL},depthWrite:f.defaultDepthWriteParams,colorWrite:f.defaultColorWriteParams})};return e}(l.ShaderTechnique);l.shader=new m.ReloadableShaderModule(g.EdgeShader,()=>new Promise((d,e)=>a(["../../shaders/sources/edgeRenderer/EdgeShader.glsl"],d,e)));b.EdgeShaderTechnique=l;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/EdgeShader.glsl":function(){define("exports ./vec2 ./vec2f64 ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4Uniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardShortEdges.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u){function C(A){const p=new d.ShaderBuilder,y=p.vertex,D=p.fragment;A.legacy&&y.uniforms.add(new f.Matrix4Uniform("model"));A.antialiasing&&(y.code.add(k.glsl`#define ANTIALIASING 1`),D.code.add(k.glsl`#define ANTIALIASING 1`));p.include(h.AdjustProjectedPosition,A);p.include(x.EdgeUtil,A);p.include(B.LineAmplitude,A);p.include(u.UnpackAttributes,A);p.include(q.LineOffset,A);p.include(m.SliceDraw,A);p.include(w.DiscardNonSilhouetteEdges,A);p.include(v.DiscardByCoverage,
A);p.include(t.DiscardShortEdges,A);p.include(l.multipassTerrainTest,A);p.varyings.add("vColor","vec4");p.varyings.add("vRadius","float");p.varyings.add("vPosition","vec3");p.varyings.add("vWorldPosition","vec3");p.varyings.add("vViewPos","vec3");p.varyings.add("vLineLengthPixels","float");p.varyings.add("vSizeFalloffFactor","float");y.uniforms.add(new r.Float2PassUniform("pixelToNDC",(E,F)=>b.set(z,2/F.camera.fullViewport[2],2/F.camera.fullViewport[3])));y.uniforms.add(new n.Float4PassUniform("viewport",
(E,F)=>F.camera.fullViewport));y.uniforms.add(new g.FloatPassUniform("pixelRatio",(E,F)=>F.camera.pixelRatio));p.attributes.add(e.VertexAttribute.POSITION0,"vec3");p.attributes.add(e.VertexAttribute.POSITION1,"vec3");p.attributes.add(e.VertexAttribute.VARIANTOFFSET,"float");p.attributes.add(e.VertexAttribute.VARIANTSTROKE,"float");p.attributes.add(e.VertexAttribute.VARIANTEXTENSION,"float");y.code.add(k.glsl`const float opaqueCutoff = 1.0 / 255.0;
void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
vec2 sideness = unpackedAttributes.sideness;
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;
vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
vViewPos = viewPos;
vec4 projPosV0 = projFromViewPosition(viewPosV0);
vec4 projPosV1 = projFromViewPosition(viewPosV1);
vec4 projPos = projFromViewPosition(viewPos);
vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
vec2 ndcToPixel = viewport.zw * 0.5;
vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
float lineLengthPixels = length(screenSpaceLinePixels);
float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;
float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;
float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;
vSizeFalloffFactor = falloffFactor;
float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;
#ifdef ANTIALIASING
const float aaPaddingPixels = 1.0;
float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;
#else
float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;
#endif
vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;
vec2 ndcOffset = (
screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
+ perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
);
projPos.xy += ndcOffset * projPos.w;
projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;
projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));
float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;
float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;
vPosition = vec3(
halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
pixelPositionAlongLine,
pixelPositionAlongLine / extendedLineLengthPixels
);
vRadius = lineWidthPixels * 0.5;
vLineLengthPixels = extendedLineLengthPixels;
discardShortEdges(unpackedAttributes, lineLengthPixels);
gl_Position = projPos;
}
void main() {
ComponentData component = readComponentData();
UnpackedAttributes unpackedAttributes = unpackAttributes(component);
vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);
vColor = component.color;
if (vColor.a < opaqueCutoff) {
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return;
}
if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
return;
}
calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);
calculateStyleOutputs(unpackedAttributes);
}`);p.fragment.code.add(k.glsl`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float lineOffset = calculateLineOffset();
      float positionX = position.x - lineOffset;

      if (radius < 1.0) {
        // Handle this specifically for subpixel sizes:
        // 1. Compute correct coverage (note coverage is computed by
        //    0.5 - dist, so we make sure that that will lead to correct
        //    subpixel coverage
        // 2. Ignore rounded caps
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);

        float coverage = min(coverageX, coverageY);

        return vec2(0.5 - coverage, 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${A.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      float alpha = vColor.a * coverage;

      gl_FragColor = vec4(vColor.rgb, alpha);

    }
  `);return p}const z=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:C},Symbol.toStringTag,{value:"Module"}));a.EdgeShader=c;a.build=C})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl":function(){define("exports ../../../../../../chunks/vec2f64 ../../../core/shaderLibrary/util/IsNaN.glsl ../../../core/shaderModules/Float2PassUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Matrix3PassUniform ../../../core/shaderModules/Matrix4PassUniform ../../../core/shaderModules/Matrix4Uniform".split(" "),
function(a,b,c,m,l,r,n,g){const k=b.fromValues(.5,-4E-4);a.AdjustProjectedPosition=function(f,d){f=f.vertex;f.include(c.IsNaN);f.constants.add("depthBias","vec2",k);f.uniforms.add(new m.Float2PassUniform("inverseViewport",(e,h)=>h.inverseViewport));d.legacy?(f.uniforms.add(new g.Matrix4Uniform("localView")),f.uniforms.add(new n.Matrix4PassUniform("proj",(e,h)=>h.camera.projectionMatrix)),f.code.add(l.glsl`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(f.uniforms.add(new r.Matrix3PassUniform("transformNormalViewFromGlobal",e=>e.transformNormalViewFromGlobal)),f.uniforms.add(new n.Matrix4PassUniform("transformProjFromView",e=>e.transformProjFromView)),f.code.add(l.glsl`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`));f.code.add(l.glsl`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/IsNaN.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.IsNaN=function(c){const m=b.glsl`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;c.code.add(m)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,b){a.DiscardByCoverage=function(c,m){c=c.fragment;c.constants.add("coverageTestThreshold","float",.01);m.antialiasing?c.code.add(b.glsl`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):
c.code.add(b.glsl`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,b){a.DiscardNonSilhouetteEdges=function(c,m){c=c.vertex;m.silhouette?
(c.code.add(b.glsl`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),m.legacy?c.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):c.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):c.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardShortEdges.glsl":function(){define(["exports","../../../core/shaderModules/interfaces","./EdgeUtil.glsl"],function(a,b,c){a.DiscardShortEdges=function(m,l){m=m.vertex;switch(l.mode){case c.EdgeUtilMode.SKETCH:m.code.add(b.glsl`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);
break;case c.EdgeUtilMode.MIXED:m.code.add(b.glsl`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case c.EdgeUtilMode.SOLID:m.code.add(b.glsl`#define discardShortEdges(unpackedAttributes, lineLengthPixels) {}`)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl":function(){define("exports ../../../collections/Component/Material/shader/ComponentData.glsl ../../../core/shaderLibrary/util/DoublePrecision.glsl ../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../core/shaderModules/Float2Uniform ../../../core/shaderModules/Float3DrawUniform ../../../core/shaderModules/Float3PassUniform ../../../core/shaderModules/FloatPassUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Matrix3DrawUniform ../../../core/shaderModules/Matrix3PassUniform ../../../core/shaderModules/Matrix4PassUniform ../../../core/shaderModules/Texture2DUniform ../../../lib/VertexAttribute".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){a.EdgeUtilMode=void 0;(function(w){w[w.SOLID=0]="SOLID";w[w.SKETCH=1]="SKETCH";w[w.MIXED=2]="MIXED";w[w.COUNT=3]="COUNT"})(a.EdgeUtilMode||(a.EdgeUtilMode={}));a.EdgeUtil=function(w,t){const x=w.vertex;x.include(m.RgbaFloatEncoding);x.uniforms.add(new g.FloatPassUniform("distanceFalloffFactor",B=>B.distanceFalloffFactor));x.code.add(k.glsl`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`);x.uniforms.add(new h.Texture2DUniform("componentDataTex"));x.uniforms.add(new l.Float2Uniform("componentDataTexInvDim"));w.attributes.add(v.VertexAttribute.COMPONENTINDEX,"float");x.constants.add("componentColorFieldOffset","float",0);x.constants.add("componentOtherFieldOffset","float",1);x.constants.add("componentVerticalOffsetFieldOffset","float",2);x.constants.add("componentFieldCount","float",3);x.constants.add("lineWidthFractionFactor","float",8);x.constants.add("extensionLengthOffset","float",
128);x.constants.add("componentTexWidth","float",4096);x.constants.add("verticalOffsetScale","float",2*b.MAX_ELEVATION_OFFSET);x.code.add(k.glsl`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float rowIndex = floor(fieldIndex / componentTexWidth);
float colIndex = mod(fieldIndex, componentTexWidth);
vec2 linearIndex = vec2(
(colIndex + 0.5) / componentTexWidth,
(rowIndex + 0.5) * componentDataTexInvDim.y
);
return linearIndex;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texture2D(componentDataTex, colorIndex);
vec4 otherValue = texture2D(componentDataTex, otherIndex);
float verticalOffset = (rgba2float(texture2D(componentDataTex, verticalOffsetIndex)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`);t.legacy?x.code.add(k.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(x.uniforms.add(new f.Matrix3DrawUniform("transformNormalGlobalFromModel",B=>B.transformNormalGlobalFromModel)),x.code.add(k.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`));t.silhouette?(w.attributes.add(v.VertexAttribute.NORMALA,"vec3"),w.attributes.add(v.VertexAttribute.NORMALB,"vec3"),x.code.add(k.glsl`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(w.attributes.add(v.VertexAttribute.NORMAL,"vec3"),x.code.add(k.glsl`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`));t.legacy?x.code.add(k.glsl`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(x.include(c.DoublePrecision,t),x.include(c.DoublePrecision,t),x.uniforms.add([new d.Matrix3PassUniform("transformViewFromCameraRelativeRS",B=>B.transformViewFromCameraRelativeRS),new f.Matrix3DrawUniform("transformWorldFromModelRS",B=>B.transformWorldFromModelRS),new r.Float3DrawUniform("transformWorldFromModelTL",B=>B.transformWorldFromModelTL),new r.Float3DrawUniform("transformWorldFromModelTH",B=>B.transformWorldFromModelTH),new n.Float3PassUniform("transformWorldFromViewTL",B=>B.transformWorldFromViewTL),
new n.Float3PassUniform("transformWorldFromViewTH",B=>B.transformWorldFromViewTH)]),x.code.add(k.glsl`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${t.spherical?k.glsl`normalize(transformWorldFromModelTL + rotatedModelPosition);`:k.glsl`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `));x.uniforms.add(new e.Matrix4PassUniform("transformProjFromView",(B,q)=>q.camera.projectionMatrix));x.code.add(k.glsl`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`);x.code.add(k.glsl`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)};a.usesSketchLogic=function(w){return w.mode===a.EdgeUtilMode.SKETCH||w.mode===a.EdgeUtilMode.MIXED};a.usesSolidLogic=function(w){return w.mode===a.EdgeUtilMode.SOLID||w.mode===a.EdgeUtilMode.MIXED};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl":function(){define(["exports","../../../core/shaderModules/FloatUniform","../../../core/shaderModules/interfaces","./EdgeUtil.glsl",
"./UnpackAttributes.glsl"],function(a,b,c,m,l){a.LineAmplitude=function(r,n){const g=r.vertex;r.include(l.UnpackAttributes,n);m.usesSketchLogic(n)&&g.uniforms.add(new b.FloatUniform("strokesAmplitude"));switch(n.mode){case m.EdgeUtilMode.SOLID:g.code.add(c.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case m.EdgeUtilMode.SKETCH:g.code.add(c.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case m.EdgeUtilMode.MIXED:g.code.add(c.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../../core/shaderModules/interfaces","../../../lib/VertexAttribute","./EdgeUtil.glsl"],function(a,b,c,m,l){a.UnpackAttributes=function(r,n){const g=r.vertex;r.attributes.add(m.VertexAttribute.SIDENESS,"vec2");n.mode===l.EdgeUtilMode.MIXED?g.code.add(c.glsl`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):g.code.add(c.glsl`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`);switch(n.mode){case l.EdgeUtilMode.MIXED:g.code.add(c.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case l.EdgeUtilMode.SKETCH:g.code.add(c.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case l.EdgeUtilMode.SOLID:g.code.add(c.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case l.EdgeUtilMode.COUNT:break;default:b.neverReached(n.mode)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl":function(){define("exports ../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../core/shaderModules/Float2Uniform ../../../core/shaderModules/FloatUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Texture2DUniform ./EdgeUtil.glsl ./UnpackAttributes.glsl".split(" "),
function(a,b,c,m,l,r,n,g){a.LineOffset=function(k,f){const d=k.vertex;k.include(g.UnpackAttributes,f);const e=k.fragment;n.usesSketchLogic(f)&&(d.uniforms.add(new c.Float2Uniform("strokesTextureScale")),d.uniforms.add(new m.FloatUniform("strokesLog2Resolution")),d.uniforms.add(new m.FloatUniform("strokeVariants")),k.varyings.add("vStrokeUV","vec2"),e.uniforms.add(new r.Texture2DUniform("strokesTexture")),e.uniforms.add(new m.FloatUniform("strokesNormalizationScale")),d.code.add(l.glsl`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * strokesTextureScale;
vStrokeUV.x += variantOffset;
}`),k.fragment.include(b.RgbaFloatEncoding),e.code.add(l.glsl`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`));switch(f.mode){case n.EdgeUtilMode.SOLID:d.code.add(l.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`);e.code.add(l.glsl`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case n.EdgeUtilMode.SKETCH:d.code.add(l.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`);e.code.add(l.glsl`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case n.EdgeUtilMode.MIXED:k.varyings.add("vType","float"),d.code.add(l.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),e.code.add(l.glsl`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechniqueConfiguration":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../core/shaderTechnique/ShaderTechniqueConfiguration ../../materials/DefaultTechniqueConfiguration ../../shaders/sources/edgeRenderer/EdgeUtil.glsl".split(" "),function(a,b,c,m,l,r){l=function(n){function g(){var k=
n.apply(this,arguments)||this;k.mode=r.EdgeUtilMode.SOLID;k.hasSlicePlane=!1;k.silhouette=!1;k.legacy=!1;k.antialiasing=!1;k.doublePrecisionRequiresObfuscation=!1;k.hasMultipassTerrain=!1;k.cullAboveGround=!1;k.spherical=!1;return k}b._inheritsLoose(g,n);return g}(l.DefaultTechniqueConfiguration);c.__decorate([m.parameter({count:r.EdgeUtilMode.COUNT})],l.prototype,"mode",void 0);c.__decorate([m.parameter()],l.prototype,"hasSlicePlane",void 0);c.__decorate([m.parameter()],l.prototype,"silhouette",
void 0);c.__decorate([m.parameter()],l.prototype,"legacy",void 0);c.__decorate([m.parameter()],l.prototype,"antialiasing",void 0);c.__decorate([m.parameter()],l.prototype,"doublePrecisionRequiresObfuscation",void 0);c.__decorate([m.parameter()],l.prototype,"hasMultipassTerrain",void 0);c.__decorate([m.parameter()],l.prototype,"cullAboveGround",void 0);c.__decorate([m.parameter()],l.prototype,"spherical",void 0);a.EdgeShaderTechniqueConfiguration=l;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeWorkerHandle":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/typedArrayUtil","../../../../../core/workers/WorkerHandle","../../../support/buffer/workerHelper","./EdgeProcessingWorker"],function(a,b,c,m,l){return function(r){function n(k){return r.call(this,"EdgeProcessingWorker","extract",{extract:f=>[f.dataBuffer],extractComponentsEdgeLocations:f=>[f.dataBuffer],
extractEdgeLocations:f=>[f.dataBuffer]},k)||this}a._inheritsLoose(n,r);var g=n.prototype;g.process=function(){var k=a._asyncToGenerator(function*(f,d,e){if(e)return l.extract(f);f=this._packInput(f);d=yield this.invoke(f,d);return this._unpackOutput(d)});return function(f,d,e){return k.apply(this,arguments)}}();g.extractEdgeLocations=function(){var k=a._asyncToGenerator(function*(f,d){f=this._packInput(f);d=yield this.invokeMethod("extractEdgeLocations",f,d);return m.unpackInterleavedBuffer(d)});
return function(f,d){return k.apply(this,arguments)}}();g.extractComponentsEdgeLocations=function(){var k=a._asyncToGenerator(function*(f,d){f=this._packInput(f);d=yield this.invokeMethod("extractComponentsEdgeLocations",f,d);return m.unpackInterleavedBuffer(d)});return function(f,d){return k.apply(this,arguments)}}();g._packInput=function(k){return{dataBuffer:k.data.buffer,writerSettings:k.writerSettings,skipDeduplicate:k.skipDeduplicate,indicesBuffer:k.indices.buffer,indicesType:b.isUint32Array(k.indices)?
"Uint32Array":"Uint16Array",indicesLength:k.indicesLength}};g._unpackOutput=function(k){return{regular:{instancesData:m.unpackInterleavedBuffer(k.regular.instancesData),lodInfo:{lengths:new Float32Array(k.regular.lodInfo.lengths)}},silhouette:{instancesData:m.unpackInterleavedBuffer(k.silhouette.instancesData),lodInfo:{lengths:new Float32Array(k.silhouette.lodInfo.lengths)}},averageEdgeLength:k.averageEdgeLength}};return n}(c.WorkerHandle)})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define("exports ../../../../../core/floatRGBA ../../../../../core/mathUtils ../../../../../core/maybe ../../../../webgl/enums ../../../../webgl/Texture".split(" "),
function(a,b,c,m,l,r){function n(d,e){if(!d)return null;var h=d.length/2;const v=.1*h;h=Array(h);let w=0;e=e===g.PRESSURE;for(let t=0;t<d.length;t+=2){const x=(d[t]+d[t+1])/2;e?h[w++]=Math.min(v,1-.5*(1-x)):h[w++]=Math.min(v,.5*x)}return h}var g;(function(d){d[d.DISTANCE=0]="DISTANCE";d[d.PRESSURE=1]="PRESSURE"})(g||(g={}));let k=function(){function d(e,h,v,w,t){this.resolution=e;this.normalizationScale=h;this.amplitude=v;this.variants=w;this.texture=t}d.prototype.dispose=function(){this.texture=
m.disposeMaybe(this.texture)};return d}();const f={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,
-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,
.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,
-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,
-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,
.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,
.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,
.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,
-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,
1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,
.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,
-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,
.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,
.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,
.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,
.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,
3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,
4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,
1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-7.6E-4,2.7E-4,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,
.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,
.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,
.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,
.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,
2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,
-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,
.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,
2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,
.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,
.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,
.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,
-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,
.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,
.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,
-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,
.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,
.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,
.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,
.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,
6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,
1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,
-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,
2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,
.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,
.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,
.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};a.StrokesTexture=k;a.generateStrokesTexture=
function(d){const e=f.resolution;var h=e/2;const v=new Uint8Array(4*e*e),w=4*e*h;h=f.amplitude;const t=2*h,x=4*e,B=Math.log2(e)+1,q=f.strokes.length;let u=(B-1)*q*x;for(const {distance:C,pressure:z}of f.strokes){let A=C,p=z,y=u;for(let D=0;D<B;D++){0!==D&&(A=n(A,g.DISTANCE),p=n(p,g.PRESSURE));for(let E=0;E<f.resolution;E++){const F=p?p[E%p.length]:1;b.packFloatRGBA((A?A[E%A.length]/t:0)+.5,v,y);b.packFloatRGBA(F,v,y+w);y+=4}y-=x*(q+1)}u+=x}d=new r.Texture(d,{pixelFormat:l.PixelFormat.RGBA,dataType:l.PixelType.UNSIGNED_BYTE,
hasMipmap:!1,samplingMode:l.TextureSamplingMode.LINEAR,width:e,height:e,wrapMode:l.TextureWrapMode.REPEAT},v);return new k(e,t,h,q,d)};a.rasterizeStrokes=function(){var d=f.resolution;const e=Math.log2(d)+1;var h=f.strokes.length;const v=f.amplitude,w=Math.ceil(2*v+.5);var t;for(t=0;1<=d;)t+=d,d/=2;t+=6*(e+1);h*=w;d=new Uint8ClampedArray(4*t*h);const x=4*t;d.fill(255);let B=24;for(const {distance:q,pressure:u}of f.strokes){let C=q,z=u,A=B;for(let p=0;p<e;p++){0!==p&&(C=n(C,g.DISTANCE),z=n(z,g.PRESSURE));
for(let y=0;y<C.length;y++){const D=C?C[y]:0,E=z?c.clamp(z[y],0,1):1;let F=A;for(let G=-v;G<w-v;G++){const P=255-255*c.clamp(1-(Math.abs(G-D+.5)-.5*E),0,1);d[F+0]=P;d[F+1]=P;d[F+2]=P;d[F+3]=255;F+=x}A+=4}A+=24}B+=w*x}return new ImageData(d,t,h)};a.strokesDefinition=f;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["exports","../../../../../core/arrayUtils","../../../../../core/maybe",
"./interfaces"],function(a,b,c,m){a.computeEdgeCount=function(l,r,n){const g=l.length;r*=n.minimumEdgeLength;n=b.binaryIndexOf(l,r,!0);l=-1===n?r<l[0]?0:l.length:n;return g-l};a.determineEdgeTransparency=function(l){let r=m.Transparency.INVISIBLE;for(const {material:n}of l)if(0<n.size*n.color[3]*n.opacity){if(1>n.color[3]*n.opacity)return m.Transparency.TRANSPARENT;r=m.Transparency.OPAQUE}return r};a.determineObjectTransparency=function(l){let r=m.Transparency.INVISIBLE;for(const {material:n}of l)if(0<
n.size*n.color[3]*n.opacity){switch(n.objectTransparency){case m.Transparency.TRANSPARENT:case m.Transparency.INVISIBLE:return m.Transparency.TRANSPARENT;case m.Transparency.OPAQUE:if(1>n.opacity)return m.Transparency.TRANSPARENT}r=m.Transparency.OPAQUE}return r};a.determineRendererType=function(l){let r=null;for(const n of l)if(l=n.type,0<n.size*n.color[3])if(c.isNone(r))r=l;else if(r!==l)return"uber";return c.isSome(r)?r:"uber"};a.estimateLengthAtDistance=function(l,r,n,g){return g/l*n*2*Math.tan(.5*
r)};a.fillComponenBufferIndices=function(l,r,n,g){for(let f=0;f<l.length;f++){const d=l[f].index;var k=r[f];const e=r[f+1];if(g)for(;k<e;k++)n.set(g[k],d);else for(;k<e;k++)n.set(k,d)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/statistics/RendererPerformanceInfo":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PerformanceSampler ../../../../core/time ../../../../core/accessorSupport/utils ../../../webgl/Measurement".split(" "),
function(a,b,c,m,l,r,n){a.Statistics=void 0;(function(d){d[d.Prepare=0]="Prepare";d[d.Shadowmap=1]="Shadowmap";d[d.Lineardepth=2]="Lineardepth";d[d.Normals=3]="Normals";d[d.SSAO=4]="SSAO";d[d.Opaque=5]="Opaque";d[d.OpaqueEdges=6]="OpaqueEdges";d[d.Transparent=7]="Transparent";d[d.TransparentEdges=8]="TransparentEdges";d[d.Hudvisibility=9]="Hudvisibility";d[d.TransparentTerrain=10]="TransparentTerrain";d[d.Atmosphere=11]="Atmosphere";d[d.Laserline=12]="Laserline";d[d.Occluded=13]="Occluded";d[d.Antialiasing=
14]="Antialiasing";d[d.Highlights=15]="Highlights";d[d.HudOccluded=16]="HudOccluded";d[d.HudNotoccluded=17]="HudNotoccluded"})(a.Statistics||(a.Statistics={}));const g="prepare;shadowmap;lineardepth;normals;ssao;opaque;opaque edges;transparent;transparent edges;hudvisibility;transparent terrain;atmosphere;laserline;occluded;antialiasing;highlights;hudOccluded;hudNotoccluded".split(";");let k=function(d){function e(){var h=d.call(this,"total")||this;h.total=0;h.frameCount=0;return h}b._inheritsLoose(e,
d);return e}(m),f=function(){function d(){this._startTime=l.Milliseconds(0);this._lastSample=l.Milliseconds(0);this._enableGPUTimer=0;this.totalTime=new k;this.gpuTime=new m("gpu",9);this.renderPassTimings=g.map(h=>new m(h))}var e=d.prototype;e.enableGPUTimer=function(){++this._enableGPUTimer;return{remove:r.once(()=>--this._enableGPUTimer)}};e.prerender=function(h){this._startTime=this._lastSample=l.Milliseconds(performance.now());this._enableGPUTimer&&(this._gpuTimer=n.startMeasurement(h))};e.advance=
function(h){const v=l.Milliseconds(performance.now());this.renderPassTimings[h].record(v-this._lastSample);this._lastSample=v};e.postrender=function(){c.isSome(this._gpuTimer)&&(this._gpuTimer.stop(v=>c.isSome(v)&&this.gpuTime.record(v),16),this._gpuTimer=null);const h=performance.now()-this._startTime;this.totalTime.record(h);this.totalTime.total+=h;this.totalTime.frameCount++};b._createClass(d,[{key:"elapsedTime",get:function(){return l.Milliseconds(performance.now()-this._startTime)}}]);return d}();
a.RenderTime=k;a.RendererPerformanceInfo=f;a.performanceStatsCategories=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/Measurement":function(){define(["exports","../../core/maybe"],function(a,b){let c=function(){function r(g){this.timer=g;this.start=g.createQuery();g.createTimestamp(this.start)}var n=r.prototype;n.stop=function(g,k=50){this.end=this.timer.createQuery();this.timer.createTimestamp(this.end);this._checkQueryResult(g,k)};
n._checkQueryResult=function(g,k){if(this.timer.resultAvailable(this.end))if(this.timer.disjoint())g(null);else{var f=this.timer.getResult(this.start),d=this.timer.getResult(this.end);g((d-f)/1E6)}else setTimeout(()=>this._checkQueryResult(g,k),k)};return r}(),m=function(){function r(g){this.timer=g;this.query=g.createQuery();l=!0;this.timer.beginTimeElapsed(this.query)}var n=r.prototype;n.stop=function(g,k=50){this.timer.endTimeElapsed();l=!1;this._checkQueryResult(g,k)};n._checkQueryResult=function(g,
k){var f=this.timer.resultAvailable(this.query);const d=this.timer.disjoint();f&&!d?(f=this.timer.getResult(this.query),g(f/1E6)):d?g(null):setTimeout(()=>this._checkQueryResult(g,k),k)};return r}(),l=!1;a.startMeasurement=function(r){r=r.capabilities.disjointTimerQuery;return b.isNone(r)?null:0<r.timestampBits()?new c(r):l?null:new m(r)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/RenderingContext":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../webgl/RenderingContext"],function(a,b,c,m){m=function(l){function r(g,k,f){g=l.call(this,g,k)||this;g.newCache=f;g._refCount=1;return g}b._inheritsLoose(r,l);var n=r.prototype;n.dispose=function(){0<--this._refCount||l.prototype.dispose.call(this)};n.ref=function(){++this._refCount};n.bindTechnique=function(g,k,f,d){this.useProgram(g.program);const e=c.isSome(f)?f.slot:null;g.bindPipelineState(this,e,d);c.isSome(k)&&
c.isSome(f)&&g.bindPass(k,f);return g.program};b._createClass(r,[{key:"test",get:function(){return this.programCache.test}}]);return r}(m.RenderingContext);a.RenderingContext=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/RenderingContext":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/maybe ../../core/promiseUtils ../../core/time ./checkWebGLError ./context-util ./ContextState ./enums ./InstanceCounter ./ProgramCache ./renderState ./Texture ./Util ./WebGLDriverTest ./capabilities/Capabilities ./capabilities/isWebGL2Context".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x){function B(C,z,A,p){z?p!==z&&C.bindBuffer(A,z.glName):C.bindBuffer(A,null);return z}function q(C,z){switch(C){case k.PrimitiveType.POINTS:return 2*z;case k.PrimitiveType.TRIANGLES:return z/3;case k.PrimitiveType.TRIANGLE_STRIP:return z-2;case k.PrimitiveType.TRIANGLE_FAN:return z-2;default:return 0}}let u=function(){function C(A,p){this.gl=A;this.instanceCounter=new f.InstanceCounter;this.programCache=new d.ProgramCache(this);this._state=new g.ContextState;
this._numOfTriangles=this._numOfDrawCalls=0;this.type=x(A)?n.ContextType.WEBGL2:n.ContextType.WEBGL1;this._loadExtensions();this.configure(p)}var z=C.prototype;z.configure=function(A){this._capabilities=new t.Capabilities(this.gl,A);this._parameters=this._loadParameters(A);A=this.gl.getParameter(this.gl.VIEWPORT);this._state=new g.ContextState;this._state.viewport={x:A[0],y:A[1],width:A[2],height:A[3]};this._stateTracker=new e.StateTracker({setBlending:p=>{p?(this.setBlendingEnabled(!0),this.setBlendEquationSeparate(p.opRgb,
p.opAlpha),this.setBlendFunctionSeparate(p.srcRgb,p.dstRgb,p.srcAlpha,p.dstAlpha),p=p.color,this.setBlendColor(p.r,p.g,p.b,p.a)):this.setBlendingEnabled(!1)},setCulling:p=>{p?(this.setFaceCullingEnabled(!0),this.setCullFace(p.face),this.setFrontFace(p.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:p=>{p?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(p.factor,p.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:p=>{p?(this.setDepthTestEnabled(!0),this.setDepthFunction(p.func)):
this.setDepthTestEnabled(!1)},setStencilTest:p=>{if(p){this.setStencilTestEnabled(!0);const y=p.function;this.setStencilFunction(y.func,y.ref,y.mask);p=p.operation;this.setStencilOp(p.fail,p.zFail,p.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:p=>{p?(this.setDepthWriteEnabled(!0),this.setDepthRange(p.zNear,p.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:p=>{p?this.setColorMask(p.r,p.g,p.b,p.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:p=>{p?this.setStencilWriteMask(p.mask):
this.setStencilWriteMask(0)}});this.enforceState();this._driverTest=new w.WebGLDriverTest(this)};z.dispose=function(){this.programCache.dispose();this.bindVAO(null);this.unbindBuffer(k.BufferType.ARRAY_BUFFER);this.unbindBuffer(k.BufferType.ELEMENT_ARRAY_BUFFER);x(this.gl)&&(this.unbindBuffer(k.BufferType.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(k.BufferType.PIXEL_PACK_BUFFER),this.unbindBuffer(k.BufferType.PIXEL_UNPACK_BUFFER),this.unbindBuffer(k.BufferType.COPY_READ_BUFFER),
this.unbindBuffer(k.BufferType.COPY_WRITE_BUFFER));this._state.textureUnitMap.length=0;r.webglDebugEnabled()&&this.instanceCounter.printResourceCount()};z.setPipelineState=function(A){this._stateTracker.setPipeline(A)};z.setBlendingEnabled=function(A){this._state.blend!==A&&(!0===A?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=A,this._stateTracker.invalidateBlending())};z.externalProgramUpdate=function(){var A;null==(A=this._state.program)?void 0:A.stop();this._state.program=
null};z.externalTextureUnitUpdate=function(A,p){for(let y=0;y<A.length;++y)this._state.textureUnitMap[A[y]]=null;0<=p&&(this._state.activeTexture=p)};z.externalVertexArrayObjectUpdate=function(){const A=this.capabilities.vao;A&&(A.bindVertexArray(null),this._state.vertexArrayObject=null);this._state.vertexBuffer=null;this._state.indexBuffer=null};z.externalVertexBufferUpdate=function(){this._state.vertexBuffer=null};z.externalIndexBufferUpdate=function(){this._state.indexBuffer=null};z.setBlendColor=
function(A,p,y,D){if(A!==this._state.blendColor.r||p!==this._state.blendColor.g||y!==this._state.blendColor.b||D!==this._state.blendColor.a)this.gl.blendColor(A,p,y,D),this._state.blendColor.r=A,this._state.blendColor.g=p,this._state.blendColor.b=y,this._state.blendColor.a=D,this._stateTracker.invalidateBlending()};z.setBlendFunction=function(A,p){if(A!==this._state.blendFunction.srcRGB||p!==this._state.blendFunction.dstRGB)this.gl.blendFunc(A,p),this._state.blendFunction.srcRGB=A,this._state.blendFunction.srcAlpha=
A,this._state.blendFunction.dstRGB=p,this._state.blendFunction.dstAlpha=p,this._stateTracker.invalidateBlending()};z.setBlendFunctionSeparate=function(A,p,y,D){if(this._state.blendFunction.srcRGB!==A||this._state.blendFunction.srcAlpha!==y||this._state.blendFunction.dstRGB!==p||this._state.blendFunction.dstAlpha!==D)this.gl.blendFuncSeparate(A,p,y,D),this._state.blendFunction.srcRGB=A,this._state.blendFunction.srcAlpha=y,this._state.blendFunction.dstRGB=p,this._state.blendFunction.dstAlpha=D,this._stateTracker.invalidateBlending()};
z.setBlendEquation=function(A){this._state.blendEquation.mode!==A&&(this.gl.blendEquation(A),this._state.blendEquation.mode=A,this._state.blendEquation.modeAlpha=A,this._stateTracker.invalidateBlending())};z.setBlendEquationSeparate=function(A,p){if(this._state.blendEquation.mode!==A||this._state.blendEquation.modeAlpha!==p)this.gl.blendEquationSeparate(A,p),this._state.blendEquation.mode=A,this._state.blendEquation.modeAlpha=p,this._stateTracker.invalidateBlending()};z.setColorMask=function(A,p,
y,D){if(this._state.colorMask.r!==A||this._state.colorMask.g!==p||this._state.colorMask.b!==y||this._state.colorMask.a!==D)this.gl.colorMask(A,p,y,D),this._state.colorMask.r=A,this._state.colorMask.g=p,this._state.colorMask.b=y,this._state.colorMask.a=D,this._stateTracker.invalidateColorWrite()};z.setClearColor=function(A,p,y,D){if(this._state.clearColor.r!==A||this._state.clearColor.g!==p||this._state.clearColor.b!==y||this._state.clearColor.a!==D)this.gl.clearColor(A,p,y,D),this._state.clearColor.r=
A,this._state.clearColor.g=p,this._state.clearColor.b=y,this._state.clearColor.a=D};z.setFaceCullingEnabled=function(A){this._state.faceCulling!==A&&(!0===A?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=A,this._stateTracker.invalidateCulling())};z.setPolygonOffsetFillEnabled=function(A){this._state.polygonOffsetFill!==A&&(!0===A?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=A,this._stateTracker.invalidatePolygonOffset())};
z.setPolygonOffset=function(A,p){if(this._state.polygonOffset[0]!==A||this._state.polygonOffset[1]!==p)this._state.polygonOffset[0]=A,this._state.polygonOffset[1]=p,this.gl.polygonOffset(A,p),this._stateTracker.invalidatePolygonOffset()};z.setCullFace=function(A){this._state.cullFace!==A&&(this.gl.cullFace(A),this._state.cullFace=A,this._stateTracker.invalidateCulling())};z.setFrontFace=function(A){this._state.frontFace!==A&&(this.gl.frontFace(A),this._state.frontFace=A,this._stateTracker.invalidateCulling())};
z.setScissorTestEnabled=function(A){this._state.scissorTest!==A&&(!0===A?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=A)};z.setScissorRect=function(A,p,y,D){if(this._state.scissorRect.x!==A||this._state.scissorRect.y!==p||this._state.scissorRect.width!==y||this._state.scissorRect.height!==D)this.gl.scissor(A,p,y,D),this._state.scissorRect.x=A,this._state.scissorRect.y=p,this._state.scissorRect.width=y,this._state.scissorRect.height=D};z.setDepthTestEnabled=
function(A){this._state.depthTest!==A&&(!0===A?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=A,this._stateTracker.invalidateDepthTest())};z.setClearDepth=function(A){this._state.clearDepth!==A&&(this.gl.clearDepth(A),this._state.clearDepth=A)};z.setDepthFunction=function(A){this._state.depthFunction!==A&&(this.gl.depthFunc(A),this._state.depthFunction=A,this._stateTracker.invalidateDepthTest())};z.setDepthWriteEnabled=function(A){this._state.depthWrite!==
A&&(this.gl.depthMask(A),this._state.depthWrite=A,this._stateTracker.invalidateDepthWrite())};z.setDepthRange=function(A,p){if(this._state.depthRange.zNear!==A||this._state.depthRange.zFar!==p)this.gl.depthRange(A,p),this._state.depthRange.zNear=A,this._state.depthRange.zFar=p,this._stateTracker.invalidateDepthWrite()};z.setStencilTestEnabled=function(A){this._state.stencilTest!==A&&(!0===A?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=A,this._stateTracker.invalidateStencilTest())};
z.setClearStencil=function(A){A!==this._state.clearStencil&&(this.gl.clearStencil(A),this._state.clearStencil=A)};z.setStencilFunction=function(A,p,y){if(this._state.stencilFunction.func!==A||this._state.stencilFunction.ref!==p||this._state.stencilFunction.mask!==y)this.gl.stencilFunc(A,p,y),this._state.stencilFunction.face=k.Face.FRONT_AND_BACK,this._state.stencilFunction.func=A,this._state.stencilFunction.ref=p,this._state.stencilFunction.mask=y,this._stateTracker.invalidateStencilTest()};z.setStencilFunctionSeparate=
function(A,p,y,D){if(this._state.stencilFunction.face!==A||this._state.stencilFunction.func!==p||this._state.stencilFunction.ref!==y||this._state.stencilFunction.mask!==D)this.gl.stencilFuncSeparate(A,p,y,D),this._state.stencilFunction.face=A,this._state.stencilFunction.func=p,this._state.stencilFunction.ref=y,this._state.stencilFunction.mask=D,this._stateTracker.invalidateStencilTest()};z.setStencilWriteMask=function(A){this._state.stencilWriteMask!==A&&(this.gl.stencilMask(A),this._state.stencilWriteMask=
A,this._stateTracker.invalidateStencilWrite())};z.setStencilOp=function(A,p,y){if(this._state.stencilOperation.face!==k.Face.FRONT_AND_BACK||this._state.stencilOperation.fail!==A||this._state.stencilOperation.zFail!==p||this._state.stencilOperation.zPass!==y)this.gl.stencilOp(A,p,y),this._state.stencilOperation.face=k.Face.FRONT_AND_BACK,this._state.stencilOperation.fail=A,this._state.stencilOperation.zFail=p,this._state.stencilOperation.zPass=y,this._stateTracker.invalidateStencilTest()};z.setStencilOpSeparate=
function(A,p,y,D){if(this._state.stencilOperation.face!==A||this._state.stencilOperation.fail!==p||this._state.stencilOperation.zFail!==y||this._state.stencilOperation.zPass!==D)this.gl.stencilOpSeparate(A,p,y,D),this._state.stencilOperation.face=A,this._state.stencilOperation.fail=p,this._state.stencilOperation.zFail=y,this._state.stencilOperation.zPass=D,this._stateTracker.invalidateStencilTest()};z.setActiveTexture=function(A,p=!1){const y=this._state.activeTexture;0<=A&&(p||A!==this._state.activeTexture)&&
(this.gl.activeTexture(k.BASE_TEXTURE_UNIT+A),this._state.activeTexture=A);return y};z.clear=function(A){A&&this.gl.clear(A)};z.clearSafe=function(A,p=255){A&&(A&k.ClearBufferBit.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),A&k.ClearBufferBit.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),A&k.ClearBufferBit.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(p),this.gl.clear(A))};z.drawArrays=function(A,p,y){r.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=q(A,y));this.gl.drawArrays(A,
p,y);r.webglDebugEnabled()&&(A=v.getErrorString(this))&&console.error("drawArrays:",A)};z.drawElements=function(A,p,y,D){r.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=q(A,p));this.gl.drawElements(A,p,y,D);if(r.webglDebugEnabled()){const P=v.getErrorString(this);if(P){var E,F=this.getBoundVAO(),G=null==F?void 0:F.indexBuffer;F={indexBuffer:G,vertexBuffers:null==F?void 0:F.vertexBuffers};A={mode:A,count:p,type:y,offset:D};G=null!=(E=c.applySome(G,K=>K.size))?E:0;p=D+p;console.error(`drawElements: ${P}${G<
p?`. Buffer is too small. Attempted to draw index ${p} of ${G}`:""}`,{args:A,vao:F})}}};z.logInfo=function(){r.webglDebugEnabled()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)};z.resetInfo=function(){r.webglDebugEnabled()&&(this._numOfTriangles=this._numOfDrawCalls=0)};z.setViewport=function(A,p,y,D){y=Math.max(Math.round(y),1);D=Math.max(Math.round(D),1);const E=this._state.viewport;if(E.x!==A||E.y!==p||E.width!==y||E.height!==D)E.x=A,E.y=p,E.width=y,E.height=
D,this.gl.viewport(A,p,y,D)};z.getViewport=function(){return{x:this._state.viewport.x,y:this._state.viewport.y,width:this._state.viewport.width,height:this._state.viewport.height}};z.useProgram=function(A){var p,y;this._state.program!==A&&(null==(p=this._state.program)?void 0:p.stop(),this._state.program=A,this.gl.useProgram(null!=(y=null==A?void 0:A.glName)?y:null))};z.bindTexture=function(A,p,y=!1){(p>=this.parameters.maxTextureImageUnits||0>p)&&console.error("Input texture unit is out of range of available units!");
const D=this._state.textureUnitMap[p];if(c.isNone(A)||null==A.glName)return c.isSome(D)&&(this.setActiveTexture(p,y),this.gl.bindTexture(D.descriptor.target,null)),this._state.textureUnitMap[p]=null,D;if(!y&&D===A)return A.isDirty&&(this.setActiveTexture(p,y),A.applyChanges()),D;this.setActiveTexture(p,y);this.gl.bindTexture(A.descriptor.target,A.glName);A.applyChanges();this._state.textureUnitMap[p]=A;return D};z.unbindTexture=function(A){if(!c.isNone(A))for(let p=0;p<this.parameters.maxTextureImageUnits;p++)this._state.textureUnitMap[p]===
A&&(this.bindTexture(null,p),this._state.textureUnitMap[p]=null)};z.bindFramebuffer=function(A,p=!1){if(p||this._state.readFramebuffer!==A||this._state.drawFramebuffer!==A)c.isNone(A)?(this.gl.bindFramebuffer(k.FramebufferTarget.FRAMEBUFFER,null),this._state.readFramebuffer=null,this._state.drawFramebuffer=null):(A.initializeAndBind(k.FramebufferTarget.FRAMEBUFFER),this._state.readFramebuffer=A,this._state.drawFramebuffer=A)};z.bindFramebufferSeparate=function(A,p,y=!1){const D=p===k.FramebufferTarget.READ_FRAMEBUFFER,
E=D?this._state.readFramebuffer:this._state.drawFramebuffer;if(y||E!==A)c.isNone(A)?this.gl.bindFramebuffer(p,null):A.initializeAndBind(p),D?this._state.readFramebuffer=c.unwrapOr(A,null):this._state.drawFramebuffer=c.unwrapOr(A,null)};z.blitFramebuffer=function(A,p,y=0,D=0,E=A.width,F=A.height,G=0,P=0,K=p.width,N=p.height,M=k.ClearBufferBit.COLOR_BUFFER_BIT,L=k.TextureSamplingMode.NEAREST){this.bindFramebufferSeparate(A,k.FramebufferTarget.READ_FRAMEBUFFER);this.bindFramebufferSeparate(p,k.FramebufferTarget.DRAW_FRAMEBUFFER);
this.gl.blitFramebuffer(y,D,E,F,G,P,K,N,M,L)};z.bindBuffer=function(A,p){if(A){var y;null!=(y=p)?y:p=A.bufferType;switch(p){case k.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=B(this.gl,A,p,this._state.vertexBuffer);break;case k.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=B(this.gl,A,p,this._state.indexBuffer);break;case k.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=B(this.gl,A,p,this._state.uniformBuffer);break;case k.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=
B(this.gl,A,p,this._state.pixelPackBuffer);break;case k.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=B(this.gl,A,p,this._state.pixelUnpackBuffer);break;case k.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=B(this.gl,A,p,this._state.copyReadBuffer);break;case k.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=B(this.gl,A,p,this._state.copyWriteBuffer)}}};z.bindRenderbuffer=function(A){const p=this.gl;A||(p.bindRenderbuffer(p.RENDERBUFFER,null),this._state.renderbuffer=
null);this._state.renderbuffer!==A&&(p.bindRenderbuffer(p.RENDERBUFFER,A.glName),this._state.renderbuffer=A)};z._getBufferBinding=function(A,p){if(p>=this.parameters.maxUniformBufferBindings||0>p)return console.error("Uniform buffer binding point is out of range!"),null;A=this._state.uniformBufferBindingPoints;let y=A[p];c.isNone(y)&&(y={buffer:null,offset:0,size:0},A[p]=y);return y};z.bindBufferBase=function(A,p,y){const D=this._getBufferBinding(A,p);c.isNone(D)||D.buffer===y&&0===D.offset&&0===
D.size||(this.gl.bindBufferBase(A,p,y?y.glName:null),D.buffer=y,D.offset=0,D.size=0)};z.bindBufferRange=function(A,p,y,D,E){const F=this._getBufferBinding(A,p);c.isNone(F)||F.buffer===y&&F.offset===D&&F.size===E||(0!==D%this._parameters.uniformBufferOffsetAlignment?console.error("Uniform buffer binding offset is not a multiple of the context offset alignment"):(this.gl.bindBufferRange(A,p,y.glName,D,E),F.buffer=y,F.offset=D,F.size=E))};z.bindUBO=function(A,p,y,D){c.isNone(p)?this.bindBufferBase(k.BufferType.UNIFORM_BUFFER,
A,null):(r.webglDebugEnabled()&&(null!=D?D:p.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),p.initialize(),void 0!==y&&void 0!==D?this.bindBufferRange(k.BufferType.UNIFORM_BUFFER,A,p.buffer,y,D):this.bindBufferBase(k.BufferType.UNIFORM_BUFFER,A,p.buffer))};z.unbindUBO=function(A){for(let p=0,y=this._state.uniformBufferBindingPoints.length;p<y;p++){const D=this._state.uniformBufferBindingPoints[p];c.isSome(D)&&D.buffer===
A.buffer&&this.bindBufferBase(k.BufferType.UNIFORM_BUFFER,p,null)}};z.unbindBuffer=function(A){switch(A){case k.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=B(this.gl,null,A,this._state.vertexBuffer);break;case k.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=B(this.gl,null,A,this._state.indexBuffer);break;case k.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=B(this.gl,null,A,this._state.uniformBuffer);break;case k.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=B(this.gl,
null,A,this._state.pixelPackBuffer);break;case k.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=B(this.gl,null,A,this._state.pixelUnpackBuffer);break;case k.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=B(this.gl,null,A,this._state.copyReadBuffer);break;case k.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=B(this.gl,null,A,this._state.copyWriteBuffer)}};z.bindVAO=function(A=null){c.isNone(A)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=
null):this._state.vertexArrayObject!==A&&(A.bind(),this._state.vertexArrayObject=A)};z.clientWaitAsync=function(){var A=b._asyncToGenerator(function*(p=l.Milliseconds(10)){const y=this.gl,D=y.fenceSync(k.SyncCondition.SYNC_GPU_COMMANDS_COMPLETE,0);this.instanceCounter.increment(k.ResourceType.Sync,D);y.flush();let E;do yield m.after(p),E=y.clientWaitSync(D,0,0);while(E===k.ClientWaitSyncStatus.TIMEOUT_EXPIRED);this.instanceCounter.decrement(k.ResourceType.Sync,D);y.deleteSync(D);if(E===k.ClientWaitSyncStatus.WAIT_FAILED)throw Error("Client wait failed");
});return function(){return A.apply(this,arguments)}}();z.getBoundFramebufferObject=function(A=k.FramebufferTarget.FRAMEBUFFER){return A===k.FramebufferTarget.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer};z.getBoundVAO=function(){return this._state.vertexArrayObject};z.resetState=function(){this.useProgram(null);this.bindVAO(null);this.bindFramebuffer(null,!0);this.unbindBuffer(k.BufferType.ARRAY_BUFFER);this.unbindBuffer(k.BufferType.ELEMENT_ARRAY_BUFFER);x(this.gl)&&
(this.unbindBuffer(k.BufferType.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(k.BufferType.PIXEL_PACK_BUFFER),this.unbindBuffer(k.BufferType.PIXEL_UNPACK_BUFFER),this.unbindBuffer(k.BufferType.COPY_READ_BUFFER),this.unbindBuffer(k.BufferType.COPY_WRITE_BUFFER));for(let A=0;A<this.parameters.maxTextureImageUnits;++A)this.bindTexture(null,A);this.setBlendingEnabled(!1);this.setBlendFunction(k.BlendFactor.ONE,k.BlendFactor.ZERO);this.setBlendEquation(k.BlendOperation.ADD);
this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(k.Face.BACK);this.setFrontFace(k.CullMode.CCW);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(k.CompareFunction.LESS);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(k.CompareFunction.ALWAYS,0,0);this.setStencilOp(k.StencilOperation.KEEP,
k.StencilOperation.KEEP,k.StencilOperation.KEEP);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)};z.enforceState=function(){var A,p;const y=this.gl;var D=this.capabilities.vao;D&&D.bindVertexArray(null);for(let K=0;K<this.parameters.maxVertexAttributes;K++)y.disableVertexAttribArray(K);this._state.vertexBuffer?
y.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):y.bindBuffer(k.BufferType.ARRAY_BUFFER,null);this._state.indexBuffer?y.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):y.bindBuffer(k.BufferType.ELEMENT_ARRAY_BUFFER,null);if(x(y)){var E,F;this._state.uniformBuffer?y.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):y.bindBuffer(k.BufferType.UNIFORM_BUFFER,null);for(var G=0;G<this._parameters.maxUniformBufferBindings;G++){var P=
this._state.uniformBufferBindingPoints[G];if(c.isSome(P)){const {buffer:K,offset:N,size:M}=P;null!==K?0===N&&0===M?y.bindBufferBase(k.BufferType.UNIFORM_BUFFER,G,K.glName):y.bindBufferRange(k.BufferType.UNIFORM_BUFFER,G,K.glName,N,M):y.bindBufferBase(k.BufferType.UNIFORM_BUFFER,G,null)}}this._state.pixelPackBuffer?y.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):y.bindBuffer(k.BufferType.PIXEL_PACK_BUFFER,null);this._state.pixelUnpackBuffer?y.bindBuffer(this._state.pixelUnpackBuffer.bufferType,
this._state.pixelUnpackBuffer.glName):y.bindBuffer(k.BufferType.PIXEL_UNPACK_BUFFER,null);this._state.copyReadBuffer?y.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):y.bindBuffer(k.BufferType.COPY_READ_BUFFER,null);this._state.copyWriteBuffer?y.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):y.bindBuffer(k.BufferType.COPY_WRITE_BUFFER,null);y.bindFramebuffer(k.FramebufferTarget.READ_FRAMEBUFFER,null);y.readBuffer(y.BACK);this._state.readFramebuffer&&
(y.bindFramebuffer(k.FramebufferTarget.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),y.readBuffer(k.ColorAttachment.COLOR_ATTACHMENT0));y.bindFramebuffer(k.FramebufferTarget.DRAW_FRAMEBUFFER,null!=(E=null==(F=this._state.drawFramebuffer)?void 0:F.glName)?E:null)}else this._state.readFramebuffer=this._state.drawFramebuffer,y.bindFramebuffer(k.FramebufferTarget.FRAMEBUFFER,null!=(G=null==(P=this._state.drawFramebuffer)?void 0:P.glName)?G:null);if(D&&this._state.vertexArrayObject){if(D=this._state.vertexArrayObject)this._state.vertexArrayObject.unbind(),
this._state.vertexArrayObject=null;this.bindVAO(D)}y.useProgram(null!=(A=null==(p=this._state.program)?void 0:p.glName)?A:null);y.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a);y.bindRenderbuffer(y.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null);!0===this._state.blend?y.enable(this.gl.BLEND):y.disable(this.gl.BLEND);y.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha);
y.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha);y.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a);y.clearDepth(this._state.clearDepth);y.clearStencil(this._state.clearStencil);y.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a);y.cullFace(this._state.cullFace);y.depthFunc(this._state.depthFunction);
y.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar);!0===this._state.depthTest?y.enable(y.DEPTH_TEST):y.disable(y.DEPTH_TEST);y.depthMask(this._state.depthWrite);y.frontFace(this._state.frontFace);y.lineWidth(1);!0===this._state.faceCulling?y.enable(y.CULL_FACE):y.disable(y.CULL_FACE);y.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]);!0===this._state.polygonOffsetFill?y.enable(y.POLYGON_OFFSET_FILL):y.disable(y.POLYGON_OFFSET_FILL);y.scissor(this._state.scissorRect.x,
this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height);!0===this._state.scissorTest?y.enable(y.SCISSOR_TEST):y.disable(y.SCISSOR_TEST);y.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask);y.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass);!0===this._state.stencilTest?y.enable(y.STENCIL_TEST):y.disable(y.STENCIL_TEST);
y.stencilMask(this._state.stencilWriteMask);for(A=0;A<this.parameters.maxTextureImageUnits;A++)y.activeTexture(k.BASE_TEXTURE_UNIT+A),y.bindTexture(k.TextureType.TEXTURE_2D,null),y.bindTexture(k.TextureType.TEXTURE_CUBE_MAP,null),x(y)&&(y.bindTexture(k.TextureType.TEXTURE_3D,null),y.bindTexture(k.TextureType.TEXTURE_2D_ARRAY,null)),p=this._state.textureUnitMap[A],c.isSome(p)&&y.bindTexture(p.descriptor.target,p.glName);y.activeTexture(k.BASE_TEXTURE_UNIT+this._state.activeTexture);y.viewport(this._state.viewport.x,
this._state.viewport.y,this._state.viewport.width,this._state.viewport.height);this.resetInfo()};z._loadExtensions=function(){this.type===n.ContextType.WEBGL1&&this.gl.getExtension("OES_element_index_uint");this.gl.getExtension("KHR_parallel_shader_compile")};z._loadParameters=function(A){var p,y=this.capabilities.textureFilterAnisotropic;A=null!=(p=A.maxAnisotropy)?p:Infinity;p=x(this.gl);const D=this.gl;y={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),
maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:y?Math.min(this.gl.getParameter(y.MAX_TEXTURE_MAX_ANISOTROPY),A):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:p?D.getParameter(D.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:p?D.getParameter(D.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:p?D.getParameter(D.MAX_FRAGMENT_UNIFORM_BLOCKS):
0,maxUniformBlockSize:p?D.getParameter(D.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:p?D.getParameter(D.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:p?D.getParameter(D.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:p?D.getParameter(D.MAX_SAMPLES):1};h.Texture.TEXTURE_UNIT_FOR_UPDATES=y.maxTextureImageUnits-1;return y};b._createClass(C,[{key:"driverTest",get:function(){return this._driverTest}},{key:"contextAttributes",get:function(){return this.gl.getContextAttributes()}},{key:"parameters",
get:function(){return this._parameters}},{key:"capabilities",get:function(){return this._capabilities}}]);return C}();a.RenderingContext=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/ContextState":function(){define(["exports","./enums"],function(a,b){a.ContextState=function(){this.blend=!1;this.blendColor={r:0,g:0,b:0,a:0};this.blendFunction={srcRGB:b.BlendFactor.ONE,dstRGB:b.BlendFactor.ZERO,srcAlpha:b.BlendFactor.ONE,dstAlpha:b.BlendFactor.ZERO};
this.blendEquation={mode:b.BlendOperation.ADD,modeAlpha:b.BlendOperation.ADD};this.colorMask={r:!0,g:!0,b:!0,a:!0};this.faceCulling=!1;this.cullFace=b.Face.BACK;this.frontFace=b.CullMode.CCW;this.scissorTest=!1;this.scissorRect={x:0,y:0,width:0,height:0};this.depthTest=!1;this.depthFunction=b.CompareFunction.LESS;this.clearDepth=1;this.depthWrite=!0;this.depthRange={zNear:0,zFar:1};this.viewport=null;this.polygonOffsetFill=this.stencilTest=!1;this.polygonOffset=[0,0];this.stencilFunction={face:b.Face.FRONT_AND_BACK,
func:b.CompareFunction.ALWAYS,ref:0,mask:1};this.clearStencil=0;this.stencilWriteMask=1;this.stencilOperation={face:b.Face.FRONT_AND_BACK,fail:b.StencilOperation.KEEP,zFail:b.StencilOperation.KEEP,zPass:b.StencilOperation.KEEP};this.clearColor={r:0,g:0,b:0,a:0};this.copyWriteBuffer=this.copyReadBuffer=this.pixelUnpackBuffer=this.pixelPackBuffer=this.uniformBuffer=this.indexBuffer=this.vertexBuffer=this.program=null;this.uniformBufferBindingPoints=[];this.renderbuffer=this.drawFramebuffer=this.readFramebuffer=
null;this.activeTexture=0;this.textureUnitMap=[]};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/InstanceCounter":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../support/AllocationTracer","./enums"],function(a,b,c,m){const l={RECORD_ALLOCATIONS:!1};let r=function(){function n(){this._current=[];this._max=[];for(this._allocations=new c.AllocationTracer(l.RECORD_ALLOCATIONS);this._current.length<m.ResourceType.COUNT;)this._current.push(0),
this._max.push(0)}var g=n.prototype;g.resetMax=function(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)};g.increment=function(k,f){const d=++this._current[k];this._max[k]=Math.max(d,this._max[k]);this._allocations.add(f)};g.decrement=function(k,f){--this._current[k];this._allocations.remove(f)};g.printResourceCount=function(){if(0<this.total){console.log("Live objects:");for(let k=0;k<m.ResourceType.COUNT;++k){const f=this._current[k];0<f&&console.log(`${m.ResourceType[k]}: ${f}`)}}this._allocations.print()};
b._createClass(n,[{key:"max",get:function(){return this._max}},{key:"current",get:function(){return this._current}},{key:"total",get:function(){return this.current.reduce((k,f)=>k+f,0)}}]);return n}();a.InstanceCounter=r;a.test=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/support/AllocationTracer":function(){define(["exports"],function(a){let b=function(){function c(l){this._allocations=new Map;l?Error.stackTraceLimit=Infinity:(this.add=
()=>{},this.remove=()=>{})}var m=c.prototype;m.add=function(l){this._allocations.set(l,Error().stack)};m.remove=function(l){this._allocations.delete(l)};m.print=function(){if(0<this._allocations.size){console.log(`${this._allocations.size} live object allocations:`);const l=new Map;this._allocations.forEach(r=>{var n;l.set(r,(null!=(n=l.get(r))?n:0)+1)});l.forEach((r,n)=>{n=n.split("\n");n.shift();n.shift();console.log(`${r}: ${n.shift()}`);n.forEach(g=>console.log("   ",g))})}};return c}();a.AllocationTracer=
b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/ProgramCache":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe","../../core/NestedMap","./Program"],function(a,b,c,m,l){let r=function(){function n(k){this._rctx=k;this._store=new m.NestedMap}var g=n.prototype;g.dispose=function(){this._store.forEach(k=>k.forEach(f=>f.dispose()));this._store.clear()};g.acquire=function(k,f,d,e){const h=this._store.get(k,
f);if(c.isSome(h))return h.ref(),h;d=new l.Program(this._rctx,k,f,d,e);d.ref();this._store.set(k,f,d);return d};b._createClass(n,[{key:"test",get:function(){let k=0;this._store.forEach(f=>f.forEach(d=>k+=d.hasGLName?2:1));return{cachedWebGLObjects:k}}}]);return n}();a.ProgramCache=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/Program":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/arrayUtils ../../core/has ../../core/maybe ./checkWebGLError ./context-util ./enums ./ShaderTranspiler".split(" "),
function(a,b,c,m,l,r,n,g,k){function f(v,w,t){v=v.gl;const x=v.createShader(w);v.shaderSource(x,t);v.compileShader(x);r.webglValidateShadersEnabled()&&!v.getShaderParameter(x,v.COMPILE_STATUS)&&(console.error("Compile error in ".concat(w===g.ShaderType.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(v.getShaderInfoLog(x)),console.error(d(t)));h.enabled&&(h.compiledLOC+=t.match(/\n/g).length+1);return x}function d(v){let w=2;return v.replace(/\n/g,()=>{var t=w++;t=1E3<=t?t.toString():("  "+
t).slice(-3);return"\n"+t+":"})}function e(v,w,t){const x=v.get(w);return x?c.update(x,t):(v.set(w,Array.from(t)),!0)}m=function(){function v(t,x,B,q,u=new Map){this._context=t;this._locations=q;this._uniformBlockBindings=u;this._refCount=1;this._compiled=!1;this._nameToUniformLocation={};this._nameToUniform1={};this._nameToUniform1v=new Map;this._nameToUniform2=new Map;this._nameToUniform3=new Map;this._nameToUniform4=new Map;this._nameToUniformMatrix3=new Map;this._nameToUniformMatrix4=new Map;
t||console.error("RenderingContext isn't initialized!");0===x.length&&console.error("Shaders source should not be empty!");this._context.type===n.ContextType.WEBGL2&&(x=k.transpileShader(x,g.ShaderType.VERTEX_SHADER),B=k.transpileShader(B,g.ShaderType.FRAGMENT_SHADER));this._vShader=f(this._context,g.ShaderType.VERTEX_SHADER,x);this._fShader=f(this._context,g.ShaderType.FRAGMENT_SHADER,B);this._vShader&&this._fShader||console.error("Error loading shaders!");this._context.instanceCounter.increment(g.ResourceType.Shader,
this);r.webglValidateShadersEnabled()&&(this.vertexShader=x,this.fragmentShader=B)}var w=v.prototype;w.dispose=function(){if(!(0<--this._refCount)){var t=this._context.gl;this._vShader&&(t.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(g.ResourceType.Shader,this));this._fShader&&(t.deleteShader(this._fShader),this._fShader=null);this._glName&&(t.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(g.ResourceType.Program,this))}};
w.ref=function(){++this._refCount};w._getUniformLocation=function(t){void 0===this._nameToUniformLocation[t]&&(++h.numUniforms,this._nameToUniformLocation[t]=this._context.gl.getUniformLocation(this.glName,t));return this._nameToUniformLocation[t]};w.hasUniform=function(t){return null!==this._getUniformLocation(t)};w.setUniform1i=function(t,x){const B=this._nameToUniform1[t];if(void 0===B||x!==B)this._context.gl.uniform1i(this._getUniformLocation(t),x),this._nameToUniform1[t]=x};w.setUniform1iv=function(t,
x){e(this._nameToUniform1v,t,x)&&this._context.gl.uniform1iv(this._getUniformLocation(t),x)};w.setUniform2iv=function(t,x){e(this._nameToUniform2,t,x)&&this._context.gl.uniform2iv(this._getUniformLocation(t),x)};w.setUniform3iv=function(t,x){e(this._nameToUniform3,t,x)&&this._context.gl.uniform3iv(this._getUniformLocation(t),x)};w.setUniform4iv=function(t,x){e(this._nameToUniform4,t,x)&&this._context.gl.uniform4iv(this._getUniformLocation(t),x)};w.setUniform1f=function(t,x){const B=this._nameToUniform1[t];
if(void 0===B||x!==B)this._context.gl.uniform1f(this._getUniformLocation(t),x),this._nameToUniform1[t]=x};w.setUniform1fv=function(t,x){e(this._nameToUniform1v,t,x)&&this._context.gl.uniform1fv(this._getUniformLocation(t),x)};w.setUniform2f=function(t,x,B){const q=this._nameToUniform2.get(t);if(void 0===q)this._context.gl.uniform2f(this._getUniformLocation(t),x,B),this._nameToUniform2.set(t,[x,B]);else if(x!==q[0]||B!==q[1])this._context.gl.uniform2f(this._getUniformLocation(t),x,B),q[0]=x,q[1]=B};
w.setUniform2fv=function(t,x){e(this._nameToUniform2,t,x)&&this._context.gl.uniform2fv(this._getUniformLocation(t),x)};w.setUniform3f=function(t,x,B,q){const u=this._nameToUniform3.get(t);if(void 0===u)this._context.gl.uniform3f(this._getUniformLocation(t),x,B,q),this._nameToUniform3[t]=[x,B,q];else if(x!==u[0]||B!==u[1]||q!==u[2])this._context.gl.uniform3f(this._getUniformLocation(t),x,B,q),u[0]=x,u[1]=B,u[2]=q};w.setUniform3fv=function(t,x){e(this._nameToUniform3,t,x)&&this._context.gl.uniform3fv(this._getUniformLocation(t),
x)};w.setUniform4f=function(t,x,B,q,u){const C=this._nameToUniform4.get(t);if(void 0===C)this._context.gl.uniform4f(this._getUniformLocation(t),x,B,q,u),this._nameToUniform4.set(t,[x,B,q,u]);else if(void 0===C||x!==C[0]||B!==C[1]||q!==C[2]||u!==C[3])this._context.gl.uniform4f(this._getUniformLocation(t),x,B,q,u),C[0]=x,C[1]=B,C[2]=q,C[3]=u};w.setUniform4fv=function(t,x){e(this._nameToUniform4,t,x)&&this._context.gl.uniform4fv(this._getUniformLocation(t),x)};w.setUniformMatrix3fv=function(t,x,B=!1){e(this._nameToUniformMatrix3,
t,x)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(t),B,x)};w.setUniformMatrix4fv=function(t,x,B=!1){e(this._nameToUniformMatrix4,t,x)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(t),B,x)};w.stop=function(){};b._createClass(v,[{key:"glName",get:function(){if(l.isSome(this._glName))return this._glName;if(l.isNone(this._vShader))return null;const t=this._context.gl,x=t.createProgram();t.attachShader(x,this._vShader);t.attachShader(x,this._fShader);this._locations.forEach((B,
q)=>t.bindAttribLocation(x,B,q));t.linkProgram(x);r.webglValidateShadersEnabled()&&!t.getProgramParameter(x,t.LINK_STATUS)&&console.error("Could not link shader\n"+`validated: ${t.getProgramParameter(x,t.VALIDATE_STATUS)}`+`, gl error ${t.getError()}`+`, vertex: ${t.getShaderParameter(this._vShader,t.COMPILE_STATUS)}`+`, fragment: ${t.getShaderParameter(this._fShader,t.COMPILE_STATUS)}`+`, info log: ${t.getProgramInfoLog(x)}`+`, vertex source: ${this.vertexShader}`+`, fragment source: ${this.fragmentShader}`);
if(this._context.type===n.ContextType.WEBGL2)for(const [B,q]of this._uniformBlockBindings){const u=t.getUniformBlockIndex(x,B);4294967295>u&&t.uniformBlockBinding(x,u,q)}this._glName=x;this._context.instanceCounter.increment(g.ResourceType.Program,this);return x}},{key:"hasGLName",get:function(){return l.isSome(this._glName)}},{key:"isCompiled",get:function(){if(this._compiled)return!0;const t=this._context.gl.getExtension("KHR_parallel_shader_compile");return null==t?this._compiled=!0:this._compiled=
!!this._context.gl.getProgramParameter(this.glName,t.COMPLETION_STATUS_KHR)}}]);return v}();const h={compiledLOC:0,numUniforms:0,enabled:!1};a.Program=m;a.test=h;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/ShaderTranspiler":function(){define("exports ../../core/has ../../core/maybe ./enums ./reservedWordsGLSL3 ./testUtils".split(" "),function(a,b,c,m,l,r){function n(){function u(T){T.length&&M.push({type:x[G],data:T,position:H,line:L,
column:J})}function C(){N=N.length?[]:N;if("/"===K&&"*"===P)return H=F+E-1,G=0,K=P,E+1;if("/"===K&&"/"===P)return H=F+E-1,G=1,K=P,E+1;if("#"===P)return G=2,H=F+E,E;if(/\s/.test(P))return G=9,H=F+E,E;I=/\d/.test(P);O=/[^\w_]/.test(P);H=F+E;G=I?4:O?3:9999;return E}function z(){if(("\r"===P||"\n"===P)&&"\\"!==K)return u(N.join("")),G=999,E;N.push(P);K=P;return E+1}function A(){if("."===K&&/\d/.test(P))return G=5,E;if("/"===K&&"*"===P)return G=0,E;if("/"===K&&"/"===P)return G=1,E;if("."===P&&N.length){for(;p(N););
G=5;return E}if(";"===P||")"===P||"("===P){if(N.length)for(;p(N););u(P);G=999;return E+1}var T=2===N.length&&"\x3d"!==P;if(/[\w_\d\s]/.test(P)||T){for(;p(N););G=999;return E}N.push(P);K=P;return E+1}function p(T){var U=0;do{var aa=w.indexOf(T.slice(0,T.length+U).join(""));var W=w[aa];if(-1===aa){if(0<U--+T.length)continue;W=T.slice(0,1).join("")}u(W);H+=W.length;N=N.slice(W.length);return N.length}while(1)}function y(){if("."===P||/[eE]/.test(P))return N.push(P),G=5,K=P,E+1;if("x"===P&&1===N.length&&
"0"===N[0])return G=11,N.push(P),K=P,E+1;if(/[^\d]/.test(P))return u(N.join("")),G=999,E;N.push(P);K=P;return E+1}function D(){"f"===P&&(N.push(P),K=P,E+=1);if(/[eE]/.test(P)||"-"===P&&/[eE]/.test(K))return N.push(P),K=P,E+1;if(/[^\d]/.test(P))return u(N.join("")),G=999,E;N.push(P);K=P;return E+1}var E=0,F=0,G=999,P,K,N=[],M=[],L=1,J=0,H=0,I=!1,O=!1,Q="",S;return function(T){M=[];if(null!==T){T=T.replace?T.replace(/\r\n/g,"\n"):T;E=0;Q+=T;for(S=Q.length;P=Q[E],E<S;){T=E;switch(G){case 0:"/"===P&&
"*"===K?(N.push(P),u(N.join("")),G=999):(N.push(P),K=P);E+=1;break;case 1:E=z();break;case 2:E=z();break;case 3:E=A();break;case 4:E=y();break;case 11:/[^a-fA-F0-9]/.test(P)?(u(N.join("")),G=999):(N.push(P),K=P,E+=1);break;case 5:E=D();break;case 9999:if(/[^\d\w_]/.test(P)){var U=N.join("");G=-1<v.indexOf(U)?8:-1<t.indexOf(U)?7:6;u(N.join(""));G=999}else N.push(P),K=P,E+=1;break;case 9:/[^\s]/g.test(P)?(u(N.join("")),G=999):(N.push(P),K=P,E+=1);break;case 999:E=C()}if(T!==E)switch(Q[T]){case "\n":J=
0;++L;break;default:++J}}F+=E;Q=Q.slice(E);return M}N.length&&u(N.join(""));G=10;u("(eof)");return M}}function g(u){return u.map(C=>"eof"!==C.type?C.data:"").join("")}function k(u,C="100",z="300 es"){const A=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const p of u)if("preprocessor"===p.type){const y=A.exec(p.data);if(y){u=y[1].replace(/\s\s+/g," ");if(u===z)return u;if(u===C)return p.data="#version "+z,C;throw Error("unknown glsl version: "+u);}}u.splice(0,0,{type:"preprocessor",data:"#version "+
z},{type:"whitespace",data:"\n"});return null}function f(u,C,z,A){A=A||z;for(const p of u)if("ident"===p.type&&p.data===z)return A in C?C[A]++:C[A]=0,f(u,C,A+"_"+C[A],A);return z}function d(u,C,z="afterVersion"){const A={data:"\n",type:"whitespace"},p=D=>D<u.length?/[^\r\n]$/.test(u[D].data):!1;let y=function(D){let E=-1,F=0,G=-1;for(let K=0;K<D.length;K++){var P=D[K];"preprocessor"===P.type&&(P.data.match(/#(if|ifdef|ifndef)\s+.+/)?++F:P.data.match(/#endif\s*.*/)&&--F);("afterVersion"===z||"afterPrecision"===
z)&&"preprocessor"===P.type&&/^#version/.test(P.data)&&(G=Math.max(G,K));if("afterPrecision"===z&&"keyword"===P.type&&"precision"===P.data){a:{for(P=K;P<D.length;P++){const N=D[P];if("operator"===N.type&&";"===N.data)break a}P=null}if(null===P)throw Error("precision statement not followed by any semicolons!");G=Math.max(G,P)}E<G&&0===F&&(E=K)}return E+1}(u);p(y-1)&&u.splice(y++,0,A);for(const D of C)u.splice(y++,0,D);p(y-1)&&p(y)&&u.splice(y,0,A)}function e(u,C,z,A="lowp"){d(u,[{type:"keyword",data:"out"},
{type:"whitespace",data:" "},{type:"keyword",data:A},{type:"whitespace",data:" "},{type:"keyword",data:z},{type:"whitespace",data:" "},{type:"ident",data:C},{type:"operator",data:";"}],"afterPrecision")}function h(u,C,z,A,p="lowp"){d(u,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"\x3d"},{type:"whitespace",data:" "},{type:"integer",data:A.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},
{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:p},{type:"whitespace",data:" "},{type:"keyword",data:z},{type:"whitespace",data:" "},{type:"ident",data:C},{type:"operator",data:";"}],"afterPrecision")}b={exports:{}};(function(u){(function(C){C=C();void 0!==C&&(u.exports=C)})(function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})})(b);
const v=b.exports;b={exports:{}};(function(u){(function(C){C=C();void 0!==C&&(u.exports=C)})(function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})})(b);const w=b.exports;b={exports:{}};(function(u){(function(C){C=C();void 0!==C&&(u.exports=C)})(function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT".split(" ")})})(b);
const t=b.exports;var x="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");const B=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"],q=new Map;a.transpileShader=function(u,C){var z=r.shaderTranspiler.enableCache?q.get(u):null;if(c.isSome(z))return z;z=n();var A=[];A=A.concat(z(u));z=A=A.concat(z(null));if("300 es"===k(z,"100","300 es"))return u;var p=A=null;const y={},D={};for(let P=
0;P<z.length;++P){const K=z[P];switch(K.type){case "keyword":C===m.ShaderType.VERTEX_SHADER&&"attribute"===K.data?K.data="in":"varying"===K.data&&(K.data=C===m.ShaderType.VERTEX_SHADER?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(K.data.trim())&&(K.data=K.data.replace(/(2D|Cube|EXT)/g,""));C===m.ShaderType.FRAGMENT_SHADER&&"gl_FragColor"===K.data&&(A||(A=f(z,y,"fragColor"),e(z,A,"vec4")),K.data=A);if(C===m.ShaderType.FRAGMENT_SHADER&&"gl_FragData"===K.data){{var E=
void 0;let N=void 0;var F=z;var G=P+1;let M=-1;for(;G<F.length;G++){const L=F[G];if("operator"===L.type&&("["===L.data&&(N=G),"]"===L.data)){E=G;break}"integer"===L.type&&(M=parseInt(L.data,10))}N&&E&&F.splice(N,E-N+1);F=M}E=f(z,y,"fragData");h(z,E,"vec4",F,"mediump");K.data=E}else C===m.ShaderType.FRAGMENT_SHADER&&"gl_FragDepthEXT"===K.data&&(p||(p=f(z,y,"gl_FragDepth")),K.data=p);break;case "ident":if(l.includes(K.data)){if(F=C===m.ShaderType.VERTEX_SHADER)a:{for(F=P-1;0<=F;F--)if(E=z[F],"whitespace"!==
E.type&&"block-comment"!==E.type)if("keyword"===E.type){if("attribute"===E.data||"in"===E.data){F=!0;break a}}else break;F=!1}if(F)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");K.data in D||(D[K.data]=f(z,y,K.data));K.data=D[K.data]}}}for(C=z.length-1;0<=C;--C)A=z[C],"preprocessor"===A.type&&((p=A.data.match(/#extension\s+(.*):/))&&p[1]&&B.includes(p[1].trim())&&(p=z[C+1],z.splice(C,p&&"whitespace"===p.type?2:1)),(p=A.data.match(/#ifdef\s+(.*)/))&&p[1]&&
B.includes(p[1].trim())&&(A.data="#if 1"),(p=A.data.match(/#ifndef\s+(.*)/))&&p[1]&&B.includes(p[1].trim())&&(A.data="#if 0"));z=g(z);r.shaderTranspiler.enableCache&&q.set(u,z);return z};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/reservedWordsGLSL3":function(){define(function(){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/testUtils":function(){define(["exports"],function(a){a.shaderTranspiler={enableCache:!1};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/WebGLDriverTest":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/maybe ./testDoublePrecisionArithmetic ./testFloatBufferBlend ./testSamplerPrecision ./testSVGPremultipliedAlpha".split(" "),function(a,b,c,m,l,r,n){let g=function(){function k(f){this.context=
f;this._floatBufferBlendWorking=l.testFloatBufferBlend(f);n.testSVGPremultipliedAlpha(f).then(d=>this._svgAlwaysPremultipliesAlpha=!d)}b._createClass(k,[{key:"floatBufferBlendWorking",get:function(){if(c.isNone(this._floatBufferBlendWorking))throw Error("floatBufferBlendWorking test not yet available");return this._floatBufferBlendWorking}},{key:"svgAlwaysPremultipliesAlpha",get:function(){if(c.isNone(this._svgAlwaysPremultipliesAlpha))throw Error("svgAlwaysPremultipliesAlpha test not yet available");
return this._svgAlwaysPremultipliesAlpha}},{key:"doublePrecisionRequiresObfuscation",get:function(){if(c.isNone(this._doublePrecisionRequiresObfuscation)){const f=m.testDoublePrecisionArithmetic(this.context,!1),d=m.testDoublePrecisionArithmetic(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==f&&(0===d||5<f/d)}return this._doublePrecisionRequiresObfuscation}},{key:"ignoresSamplerPrecision",get:function(){c.isNone(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=r.testSamplerPrecision(this.context));
return this._ignoresSamplerPrecision}}]);return k}();a.WebGLDriverTest=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/testDoublePrecisionArithmetic":function(){define("exports ../../core/floatRGBA ../../chunks/vec3f64 ./BufferObject ./doublePrecisionUtils ./enums ./FramebufferObject ./VertexArrayObject ./VertexElementDescriptor".split(" "),function(a,b,c,m,l,r,n,g,k){a.testDoublePrecisionArithmetic=function(f,d){var e=new n.FramebufferObject(f,
{colorTarget:r.TargetType.TEXTURE,depthStencilTarget:r.DepthStencilTargetType.NONE},{target:r.TextureType.TEXTURE_2D,wrapMode:r.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:r.PixelFormat.RGBA,dataType:r.PixelType.UNSIGNED_BYTE,samplingMode:r.TextureSamplingMode.NEAREST,width:1,height:1});const h=m.BufferObject.createVertex(f,r.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),v=new g.VertexArrayObject(f,new Map([["position",0]]),{geometry:[new k.VertexElementDescriptor("position",2,r.DataType.UNSIGNED_SHORT,
0,4)]},{geometry:h}),w=c.fromValues(5633261.287538229,2626832.878767164,1434988.0495278358),t=c.fromValues(5633271.46742708,2626873.6381334523,1434963.231608387);d=f.programCache.acquire(`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${d?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `,
"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor \x3d v_color;\n  }\n  ",new Map([["position",0]]));var x=new Float32Array(6);l.encodeDoubleArray(w,x,3);var B=new Float32Array(6);l.encodeDoubleArray(t,B,3);f.useProgram(d);d.setUniform3f("u_highA",x[0],x[2],x[4]);d.setUniform3f("u_lowA",x[1],x[3],x[5]);d.setUniform3f("u_highB",B[0],B[2],B[4]);d.setUniform3f("u_lowB",B[1],B[3],B[5]);x=d;B=f.getBoundFramebufferObject();const {x:q,y:u,width:C,height:z}=f.getViewport();
f.bindFramebuffer(e);f.setViewport(0,0,1,1);f.bindVAO(v);f.drawArrays(r.PrimitiveType.TRIANGLE_STRIP,0,4);d=new Uint8Array(4);e.readPixels(0,0,1,1,r.PixelFormat.RGBA,r.PixelType.UNSIGNED_BYTE,d);x.dispose();v.dispose(!1);h.dispose();e.dispose();f.setViewport(q,u,C,z);f.bindFramebuffer(B);f=(w[2]-t[2])/25;e=b.unpackFloatRGBA(d);return Math.abs(f-e)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/testFloatBufferBlend":function(){define("exports ../3d/webgl-engine/lib/OrderIndependentTransparency ./BufferObject ./context-util ./enums ./FramebufferObject ./renderState ./VertexArrayObject ./VertexElementDescriptor".split(" "),
function(a,b,c,m,l,r,n,g,k){var f={exports:{}};(function(d){(function(e){e=e();void 0!==e&&(d.exports=e)})(function(){function e(z){if(null==u){u={};C={};for(var A in z)"number"==typeof z[A]&&(u[z[A]]=A,C[A]=z[A])}}function h(){if(null==u)throw"WebGLDebugUtils.init(ctx) not called";}function v(z){h();var A=u[z];return void 0!==A?"gl."+A:"/*UNKNOWN WebGL ENUM*/ 0x"+z.toString(16)}function w(z,A,p,y){z=q[z];if(void 0!==z&&(z=z[A],void 0!==z&&z[p])){if("object"===typeof z[p]&&void 0!==z[p].enumBitwiseOr){A=
z[p].enumBitwiseOr;p=0;z=[];for(var D=0;D<A.length;++D){var E=C[A[D]];0!==(y&E)&&(p|=E,z.push(v(E)))}return p===y?z.join(" | "):v(y)}return v(y)}return null===y?"null":void 0===y?"undefined":y.toString()}function t(z,A,p){z.__defineGetter__(p,function(){return A[p]});z.__defineSetter__(p,function(y){A[p]=y})}function x(z,A,p,y){function D(K,N){return function(){p&&p(N,arguments);var M=K[N].apply(K,arguments),L=y.getError();0!=L&&(E[L]=!0,A(L,N,arguments));return M}}y=y||z;e(z);A=A||function(K,N,M){for(var L=
"",J=M.length,H=0;H<J;++H)L+=(0==H?"":", ")+w(N,J,H,M[H]);K="WebGL error "+v(K)+" in "+N+"("+L+")";window.console&&window.console.error?window.console.error(K):window.console&&window.console.log&&window.console.log(K)};var E={},F={},G;for(G in z)if("function"==typeof z[G])if("getExtension"!=G)F[G]=D(z,G);else{var P=D(z,G);F[G]=function(){var K=P.apply(z,arguments);return x(K,A,p,y)}}else t(F,z,G);F.getError=function(){for(var K in E)if(E.hasOwnProperty(K)&&E[K])return E[K]=!1,K;return z.NO_ERROR};
return F}function B(z){var A=z.getParameter(z.MAX_VERTEX_ATTRIBS),p=z.createBuffer();z.bindBuffer(z.ARRAY_BUFFER,p);for(var y=0;y<A;++y)z.disableVertexAttribArray(y),z.vertexAttribPointer(y,4,z.FLOAT,!1,0,0),z.vertexAttrib1f(y,0);z.deleteBuffer(p);A=z.getParameter(z.MAX_TEXTURE_IMAGE_UNITS);for(y=0;y<A;++y)z.activeTexture(z.TEXTURE0+y),z.bindTexture(z.TEXTURE_CUBE_MAP,null),z.bindTexture(z.TEXTURE_2D,null);z.activeTexture(z.TEXTURE0);z.useProgram(null);z.bindBuffer(z.ARRAY_BUFFER,null);z.bindBuffer(z.ELEMENT_ARRAY_BUFFER,
null);z.bindFramebuffer(z.FRAMEBUFFER,null);z.bindRenderbuffer(z.RENDERBUFFER,null);z.disable(z.BLEND);z.disable(z.CULL_FACE);z.disable(z.DEPTH_TEST);z.disable(z.DITHER);z.disable(z.SCISSOR_TEST);z.blendColor(0,0,0,0);z.blendEquation(z.FUNC_ADD);z.blendFunc(z.ONE,z.ZERO);z.clearColor(0,0,0,0);z.clearDepth(1);z.clearStencil(-1);z.colorMask(!0,!0,!0,!0);z.cullFace(z.BACK);z.depthFunc(z.LESS);z.depthMask(!0);z.depthRange(0,1);z.frontFace(z.CCW);z.hint(z.GENERATE_MIPMAP_HINT,z.DONT_CARE);z.lineWidth(1);
z.pixelStorei(z.PACK_ALIGNMENT,4);z.pixelStorei(z.UNPACK_ALIGNMENT,4);z.pixelStorei(z.UNPACK_FLIP_Y_WEBGL,!1);z.pixelStorei(z.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);z.UNPACK_COLORSPACE_CONVERSION_WEBGL&&z.pixelStorei(z.UNPACK_COLORSPACE_CONVERSION_WEBGL,z.BROWSER_DEFAULT_WEBGL);z.polygonOffset(0,0);z.sampleCoverage(1,!1);z.scissor(0,0,z.canvas.width,z.canvas.height);z.stencilFunc(z.ALWAYS,0,4294967295);z.stencilMask(4294967295);z.stencilOp(z.KEEP,z.KEEP,z.KEEP);z.viewport(0,0,z.canvas.width,z.canvas.height);
for(z.clear(z.COLOR_BUFFER_BIT|z.DEPTH_BUFFER_BIT|z.STENCIL_BUFFER_BIT);z.getError(););}var q={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},
texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},
bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,
1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},u=null,C=null;return{init:e,mightBeEnum:function(z){h();return void 0!==u[z]},glEnumToString:v,glFunctionArgToString:w,glFunctionArgsToString:function(z,A){for(var p="",y=A.length,
D=0;D<y;++D)p+=(0==D?"":", ")+w(z,y,D,A[D]);return p},makeDebugContext:x,makeLostContextSimulatingCanvas:function(z){function A(T){return"function"==typeof T?T:function(U){T.handleEvent(U)}}function p(){for(var T=Object.keys(S),U=0;U<T.length;++U)delete S[T]}function y(){++I;L||H==I&&z.loseContext()}function D(T,U){var aa=T[U];return function(){y();if(!L)return aa.apply(T,arguments)}}function E(T){return{statusMessage:T,preventDefault:function(){O=!0}}}function F(T){for(var U in T)"function"==typeof T[U]?
N[U]=D(T,U):t(N,T,U);N.getError=function(){y();if(!L)for(var R;R=G.getError();)S[R]=!0;for(R in S)if(S[R])return delete S[R],R;return N.NO_ERROR};var aa="createBuffer createFramebuffer createProgram createRenderbuffer createShader createTexture".split(" ");for(U=0;U<aa.length;++U){var W=aa[U];N[W]=function(R){return function(){y();if(L)return null;var V=R.apply(T,arguments);V.__webglDebugContextLostId__=M;J.push(V);return V}}(T[W])}aa="getActiveAttrib getActiveUniform getBufferParameter getContextAttributes getAttachedShaders getFramebufferAttachmentParameter getParameter getProgramParameter getProgramInfoLog getRenderbufferParameter getShaderParameter getShaderInfoLog getShaderSource getTexParameter getUniform getUniformLocation getVertexAttrib".split(" ");
for(U=0;U<aa.length;++U)W=aa[U],N[W]=function(R){return function(){y();return L?null:R.apply(T,arguments)}}(N[W]);aa="isBuffer isEnabled isFramebuffer isProgram isRenderbuffer isShader isTexture".split(" ");for(U=0;U<aa.length;++U)W=aa[U],N[W]=function(R){return function(){y();return L?!1:R.apply(T,arguments)}}(N[W]);N.checkFramebufferStatus=function(R){return function(){y();return L?N.FRAMEBUFFER_UNSUPPORTED:R.apply(T,arguments)}}(N.checkFramebufferStatus);N.getAttribLocation=function(R){return function(){y();
return L?-1:R.apply(T,arguments)}}(N.getAttribLocation);N.getVertexAttribOffset=function(R){return function(){y();return L?0:R.apply(T,arguments)}}(N.getVertexAttribOffset);N.isContextLost=function(){return L};return N}var G,P=[],K=[];var N={};var M=1,L=!1,J=[],H=0,I=0,O=!1,Q=0,S={};z.getContext=function(T){return function(){var U=T.apply(z,arguments);if(U instanceof WebGLRenderingContext){if(U!=G){if(G)throw"got different context";G=U;N=F(G)}return N}return U}}(z.getContext);(function(T){var U=T.addEventListener;
T.addEventListener=function(aa,W,R){switch(aa){case "webglcontextlost":P.push(A(W));break;case "webglcontextrestored":K.push(A(W));break;default:U.apply(T,arguments)}}})(z);z.loseContext=function(){if(!L){L=!0;H=0;for(++M;G.getError(););p();S[G.CONTEXT_LOST_WEBGL]=!0;var T=E("context lost"),U=P.slice();setTimeout(function(){for(var aa=0;aa<U.length;++aa)U[aa](T);0<=Q&&setTimeout(function(){z.restoreContext()},Q)},0)}};z.restoreContext=function(){L&&K.length&&setTimeout(function(){if(!O)throw"can not restore. webglcontestlost listener did not call event.preventDefault";
for(var T=0;T<J.length;++T){var U=J[T];U instanceof WebGLBuffer?G.deleteBuffer(U):U instanceof WebGLFramebuffer?G.deleteFramebuffer(U):U instanceof WebGLProgram?G.deleteProgram(U):U instanceof WebGLRenderbuffer?G.deleteRenderbuffer(U):U instanceof WebGLShader?G.deleteShader(U):U instanceof WebGLTexture&&G.deleteTexture(U)}B(G);L=!1;I=0;O=!1;T=K.slice();U=E("context restored");for(var aa=0;aa<T.length;++aa)T[aa](U)},0)};z.loseContextInNCalls=function(T){if(L)throw"You can not ask a lost contet to be lost";
H=I+T};z.getNumCalls=function(){return I};z.setRestoreTimeout=function(T){Q=T};return z},resetToInitialState:B}})})(f);a.testFloatBufferBlend=function(d){var e,h,v;if(!d.gl)return!1;if(d.type===m.ContextType.WEBGL1){var w,t;return!(null==(w=d.capabilities.textureFloat)||!w.textureFloat||null==(t=d.capabilities.colorBufferFloat)||!t.textureFloat)}if(!((null==(e=d.capabilities.textureFloat)?0:e.textureFloat)&&(null==(h=d.capabilities.colorBufferFloat)?0:h.textureFloat)&&(null==(v=d.capabilities.colorBufferFloat)?
0:v.floatBlend)))return!1;e=new r.FramebufferObject(d,{colorTarget:l.TargetType.TEXTURE,depthStencilTarget:l.DepthStencilTargetType.NONE},{target:l.TextureType.TEXTURE_2D,wrapMode:l.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:l.PixelFormat.RGBA,dataType:l.PixelType.FLOAT,internalFormat:l.SizedPixelFormat.RGBA32F,samplingMode:l.TextureSamplingMode.NEAREST,width:1,height:1});h=c.BufferObject.createVertex(d,l.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));v=new g.VertexArrayObject(d,new Map([["a_pos",
0]]),{geometry:[new k.VertexElementDescriptor("a_pos",2,l.DataType.UNSIGNED_SHORT,0,4)]},{geometry:h});w=d.programCache.acquire("\n  precision highp float;\n  attribute vec2 a_pos;\n\n  void main() {\n    gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n   precision highp float;\n\n   void main() {\n    gl_FragColor \x3d vec4(0.5, 0.5, 0.5, 0.5);\n   }\n  ",new Map([["a_pos",0]]));d.useProgram(w);t=d.getBoundFramebufferObject();const {x,y:B,width:q,height:u}=d.getViewport();d.bindFramebuffer(e);
d.setViewport(0,0,1,1);d.bindVAO(v);d.drawArrays(l.PrimitiveType.TRIANGLE_STRIP,0,4);var C=n.makePipelineState({blending:b.blendingAlpha});d.setPipelineState(C);d.drawArrays(l.PrimitiveType.TRIANGLE_STRIP,0,4);f.exports.init(d);C=d.gl.getError();d.setViewport(x,B,q,u);d.bindFramebuffer(t);w.dispose();v.dispose(!1);h.dispose();e.dispose();return 1282===C?(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1):!0};Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/testSamplerPrecision":function(){define("exports ../../core/Logger ./BufferObject ./enums ./FramebufferObject ./Texture ./VertexArrayObject ./VertexElementDescriptor".split(" "),function(a,b,c,m,l,r,n,g){const k=b.getLogger("esri.views.WebGLDriverTest");a.testSamplerPrecision=function(f){var d=new l.FramebufferObject(f,{colorTarget:m.TargetType.TEXTURE,depthStencilTarget:m.DepthStencilTargetType.NONE},{target:m.TextureType.TEXTURE_2D,
wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:m.PixelFormat.RGBA,dataType:m.PixelType.UNSIGNED_BYTE,samplingMode:m.TextureSamplingMode.NEAREST,width:1,height:1});const e=new Uint8Array(4),h=c.BufferObject.createVertex(f,m.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),v=new n.VertexArrayObject(f,new Map([["a_position",0]]),{geometry:[new g.VertexElementDescriptor("a_position",2,m.DataType.SHORT,0,4)]},{geometry:h}),w=f.programCache.acquire("\nprecision highp float;\nattribute vec2 a_pos;\nuniform highp sampler2D u_texture;\nvarying vec4 v_color;\n\nfloat getBit(in float bitset, in int bitIndex) {\n  float offset \x3d pow(2.0, float(bitIndex));\n  return mod(floor(bitset / offset), 2.0);\n}\n\nvoid main() {\n  vec4 value \x3d texture2D(u_texture, vec2(0.0));\n  float bit \x3d getBit(value.x * 255.0, 1);\n\n  v_color \x3d bit * vec4(1.0);\n  gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n",
"\nprecision highp float;\nvarying vec4 v_color;\n\nvoid main() {\n  gl_FragColor \x3d v_color;\n}\n",new Map([["a_pos",0]]));f.useProgram(w);var t=new r.Texture(f,{target:m.TextureType.TEXTURE_2D,wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:m.PixelFormat.RGBA,dataType:m.PixelType.UNSIGNED_BYTE,samplingMode:m.TextureSamplingMode.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));w.setUniform1i("u_texture",0);f.bindTexture(t,0);t=f.getBoundFramebufferObject();f.bindFramebuffer(d);f.useProgram(w);
const {x,y:B,width:q,height:u}=f.getViewport();f.setViewport(0,0,1,1);f.bindVAO(v);f.drawArrays(m.PrimitiveType.TRIANGLE_STRIP,0,4);f.setViewport(x,B,q,u);d.readPixels(0,0,1,1,m.PixelFormat.RGBA,m.PixelType.UNSIGNED_BYTE,e);w.dispose();v.dispose(!1);h.dispose();d.dispose();(d=255!==e[0]||255!==e[1]||255!==e[2]||255!==e[3])&&k.warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${e[0]}.${e[1]}.${e[2]}.${e[3]}]`);
f.bindFramebuffer(t);return d};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/testSVGPremultipliedAlpha":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../2d/engine/webgl/DefaultVertexAttributeLayouts ./BufferObject ./enums ./FramebufferObject ./Texture ./VertexArrayObject".split(" "),function(a,b,c,m,l,r,n,g){function k(){k=b._asyncToGenerator(function*(f){const d=new Image;d.src="data:image/svg+xml,%3C%3Fxml version\x3d'1.0' encoding\x3d'UTF-8'%3F%3E%3Csvg width\x3d'5' height\x3d'5' version\x3d'1.1' viewBox\x3d'0 0 5 5' xmlns\x3d'http://www.w3.org/2000/svg'%3E%3Crect width\x3d'5' height\x3d'5' fill\x3d'%23f00' fill-opacity\x3d'.5'/%3E%3C/svg%3E%0A";
d.width=5;d.height=5;yield d.decode();if(!f.gl)return!0;const e=new r.FramebufferObject(f,{colorTarget:l.TargetType.TEXTURE,depthStencilTarget:l.DepthStencilTargetType.NONE},{target:l.TextureType.TEXTURE_2D,wrapMode:l.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:l.PixelFormat.RGBA,dataType:l.PixelType.UNSIGNED_BYTE,samplingMode:l.TextureSamplingMode.NEAREST,width:1,height:1}),h=m.BufferObject.createVertex(f,l.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),v=new g.VertexArrayObject(f,new Map([["a_pos",
0]]),c.Pos2us,{geometry:h}),w=f.programCache.acquire("\n  precision highp float;\n\n  attribute vec2 a_pos;\n  varying vec2 v_uv;\n\n  void main() {\n    v_uv \x3d a_pos;\n    gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n  precision highp float;\n\n  varying vec2 v_uv;\n  uniform sampler2D u_texture;\n\n  void main() {\n    gl_FragColor \x3d texture2D(u_texture, v_uv);\n  }\n  ",new Map([["a_pos",0]]));f.useProgram(w);const t=new n.Texture(f,{dataType:l.PixelType.UNSIGNED_BYTE,
pixelFormat:l.PixelFormat.RGBA,preMultiplyAlpha:!1,wrapMode:l.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:l.TextureSamplingMode.LINEAR},d);f.bindTexture(t,0);w.setUniform1i("u_texture",0);const x=f.getBoundFramebufferObject(),{x:B,y:q,width:u,height:C}=f.getViewport();f.bindFramebuffer(e);f.setViewport(0,0,1,1);f.setClearColor(0,0,0,0);f.setBlendingEnabled(!1);f.clearSafe(l.ClearBufferBit.COLOR_BUFFER_BIT);f.bindVAO(v);f.drawArrays(l.PrimitiveType.TRIANGLE_STRIP,0,4);const z=new Uint8Array(4);e.readPixels(0,
0,1,1,l.PixelFormat.RGBA,l.PixelType.UNSIGNED_BYTE,z);w.dispose();v.dispose(!1);h.dispose();e.dispose();t.dispose();f.setViewport(B,q,u,C);f.bindFramebuffer(x);d.src="";return 255===z[0]});return k.apply(this,arguments)}a.testSVGPremultipliedAlpha=function(f){return k.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/webgl/DefaultVertexAttributeLayouts":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],
function(a,b,c){const m={geometry:[new c.VertexElementDescriptor("a_pos",2,b.DataType.BYTE,0,2)]},l={geometry:[new c.VertexElementDescriptor("a_pos",2,b.DataType.BYTE,0,4),new c.VertexElementDescriptor("a_tex",2,b.DataType.BYTE,2,4)]};b={geometry:[new c.VertexElementDescriptor("a_pos",2,b.DataType.UNSIGNED_SHORT,0,4)]};a.Pos2b=m;a.Pos2us=b;a.PosTex2b=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/capabilities/Capabilities":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ./DisjointTimerQuery ./DrawBuffers ./Instancing ./load ./LoseContext ./VertexArrayObjects".split(" "),
function(a,b,c,m,l,r,n,g){let k=function(){function f(d,e){this.gl=d;this._textureFloatLinear=this._fragDepth=this._shaderTextureLOD=this._standardDerivatives=this._depthTexture=null;this._disabledExtensions=e.disabledExtensions||{};this._debugWebGLExtensions=e.debugWebGLExtensions||{}}f.prototype.enable=function(d){return this[d]};b._createClass(f,[{key:"drawBuffers",get:function(){this._drawBuffers||(this._drawBuffers=m.load(this.gl,this._disabledExtensions));return this._drawBuffers}},{key:"instancing",
get:function(){this._instancing||(this._instancing=l.load(this.gl));return this._instancing}},{key:"vao",get:function(){this._vertexArrayObject||(this._vertexArrayObject=g.load(this.gl,this._disabledExtensions));return this._vertexArrayObject}},{key:"compressedTextureETC",get:function(){this._compressedTextureETC||(this._compressedTextureETC=r.loadCompressedTextureETC(this.gl,this._disabledExtensions));return this._compressedTextureETC}},{key:"compressedTextureS3TC",get:function(){this._compressedTextureS3TC||
(this._compressedTextureS3TC=r.loadCompressedTextureS3TC(this.gl,this._disabledExtensions));return this._compressedTextureS3TC}},{key:"textureFilterAnisotropic",get:function(){this._textureFilterAnisotropic||(this._textureFilterAnisotropic=r.loadTextureFilterAnisotropicCapability(this.gl,this._disabledExtensions));return this._textureFilterAnisotropic}},{key:"disjointTimerQuery",get:function(){this._disjointTimerQuery||(this._disjointTimerQuery=c.createDisjointTimerQuery(this.gl,this._disabledExtensions));
return this._disjointTimerQuery}},{key:"textureFloat",get:function(){this._textureFloat||(this._textureFloat=r.loadTextureFloat(this.gl,this._disabledExtensions));return this._textureFloat}},{key:"colorBufferFloat",get:function(){this._colorBufferFloat||(this._colorBufferFloat=r.loadColorBufferFloat(this.gl,this._disabledExtensions));return this._colorBufferFloat}},{key:"blendMinMax",get:function(){this._minMaxBlending||(this._minMaxBlending=r.loadMinMaxBlending(this.gl,this._disabledExtensions));
return this._minMaxBlending}},{key:"depthTexture",get:function(){null===this._depthTexture&&(this._depthTexture=r.loadBooleanExtension(this.gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]));return this._depthTexture}},{key:"standardDerivatives",get:function(){null===this._standardDerivatives&&(this._standardDerivatives=r.loadBooleanExtension(this.gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"]));
return this._standardDerivatives}},{key:"shaderTextureLOD",get:function(){null===this._shaderTextureLOD&&(this._shaderTextureLOD=r.loadBooleanExtension(this.gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]));return this._shaderTextureLOD}},{key:"fragDepth",get:function(){null===this._fragDepth&&(this._fragDepth=r.loadBooleanExtension(this.gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"]));return this._fragDepth}},{key:"loseContext",get:function(){this._loseContext||
(this._loseContext=n.load(this.gl,this._debugWebGLExtensions));return this._loseContext}},{key:"textureNorm16",get:function(){this._textureNorm16||(this._textureNorm16=r.loadTextureNorm16(this.gl,this._disabledExtensions));return this._textureNorm16}},{key:"textureFloatLinear",get:function(){null===this._textureFloatLinear&&(this._textureFloatLinear=r.loadBooleanExtension(this.gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"]));return this._textureFloatLinear}}]);return f}();
a.Capabilities=k;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["exports","./isWebGL2Context"],function(a,b){let c=function(m,l,r,n,g,k,f,d){this.createQuery=m;this.resultAvailable=l;this.getResult=r;this.disjoint=n;this.beginTimeElapsed=g;this.endTimeElapsed=k;this.createTimestamp=f;this.timestampBits=d};a.DisjointTimerQuery=c;a.createDisjointTimerQuery=function(m,l){if(l.disjointTimerQuery)return null;
let r=m.getExtension("EXT_disjoint_timer_query_webgl2");return r&&b(m)?new c(()=>m.createQuery(),n=>m.getQueryParameter(n,m.QUERY_RESULT_AVAILABLE),n=>m.getQueryParameter(n,m.QUERY_RESULT),()=>m.getParameter(r.GPU_DISJOINT_EXT),n=>m.beginQuery(r.TIME_ELAPSED_EXT,n),()=>m.endQuery(r.TIME_ELAPSED_EXT),n=>r.queryCounterEXT(n,r.TIMESTAMP_EXT),()=>m.getQuery(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):(r=m.getExtension("EXT_disjoint_timer_query"))?new c(()=>r.createQueryEXT(),n=>r.getQueryObjectEXT(n,r.QUERY_RESULT_AVAILABLE_EXT),
n=>r.getQueryObjectEXT(n,r.QUERY_RESULT_EXT),()=>m.getParameter(r.GPU_DISJOINT_EXT),n=>r.beginQueryEXT(r.TIME_ELAPSED_EXT,n),()=>r.endQueryEXT(r.TIME_ELAPSED_EXT),n=>r.queryCounterEXT(n,r.TIMESTAMP_EXT),()=>r.getQueryEXT(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/capabilities/DrawBuffers":function(){define(["exports","./isWebGL2Context"],function(a,b){a.load=function(c,m){return m.disjointTimerQuery?
null:b(c)?{drawBuffers:c.drawBuffers.bind(c),MAX_DRAW_BUFFERS:c.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:c.MAX_COLOR_ATTACHMENTS}:m.drawBuffers?null:(c=c.getExtension("WEBGL_draw_buffers"))?{drawBuffers:c.drawBuffersWEBGL.bind(c),MAX_DRAW_BUFFERS:c.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:c.MAX_COLOR_ATTACHMENTS_WEBGL}:null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/capabilities/Instancing":function(){define(["exports","./isWebGL2Context"],
function(a,b){a.load=function(c){return b(c)?{drawArraysInstanced:c.drawArraysInstanced.bind(c),drawElementsInstanced:c.drawElementsInstanced.bind(c),vertexAttribDivisor:c.vertexAttribDivisor.bind(c)}:(c=c.getExtension("ANGLE_instanced_arrays"))?{drawArraysInstanced:c.drawArraysInstancedANGLE.bind(c),drawElementsInstanced:c.drawElementsInstancedANGLE.bind(c),vertexAttribDivisor:c.vertexAttribDivisorANGLE.bind(c)}:null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/webgl/capabilities/load":function(){define(["exports","./isWebGL2Context"],function(a,b){a.loadBooleanExtension=function(c,m,l,r,n){if(r&&b(c))return!0;if(m[l])return!1;for(const g of n)if(c.getExtension(g))return!0;return!1};a.loadColorBufferFloat=function(c,m){if(b(c)){var l=!m.colorBufferHalfFloat&&c.getExtension("EXT_color_buffer_half_float")||!m.colorBufferFloat&&c.getExtension("EXT_color_buffer_float"),r=!m.colorBufferFloat&&c.getExtension("EXT_color_buffer_float");m=!m.floatBlend&&
!m.colorBufferFloat&&c.getExtension("EXT_float_blend");return l||r||m?{textureFloat:!!r,textureHalfFloat:!!l,floatBlend:!!m,R16F:c.R16F,RG16F:c.RG16F,RGBA16F:c.RGBA16F,R32F:c.R32F,RG32F:c.RG32F,RGBA32F:c.RGBA32F,R11F_G11F_B10F:c.R11F_G11F_B10F,RGB16F:c.RGB16F}:null}return c instanceof WebGLRenderingContext?(l=!m.colorBufferHalfFloat&&c.getExtension("EXT_color_buffer_half_float"),r=!m.colorBufferFloat&&c.getExtension("WEBGL_color_buffer_float"),c=!m.floatBlend&&!m.colorBufferFloat&&c.getExtension("EXT_float_blend"),
l||r||c?{textureFloat:!!r,textureHalfFloat:!!l,floatBlend:!!c,RGBA16F:l?l.RGBA16F_EXT:void 0,RGB16F:l?l.RGB16F_EXT:void 0,RGBA32F:r?r.RGBA32F_EXT:void 0}:null):null};a.loadCompressedTextureETC=function(c,m){return m.compressedTextureETC?null:(c=c.getExtension("WEBGL_compressed_texture_etc"))?{COMPRESSED_R11_EAC:c.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:c.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:c.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:c.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:c.COMPRESSED_RGB8_ETC2,
COMPRESSED_SRGB8_ETC2:c.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:c.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:c.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:c.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:c.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null};a.loadCompressedTextureS3TC=function(c,m){return m.compressedTextureS3TC?null:(c=c.getExtension("WEBGL_compressed_texture_s3tc"))?{COMPRESSED_RGB_S3TC_DXT1:c.COMPRESSED_RGB_S3TC_DXT1_EXT,
COMPRESSED_RGBA_S3TC_DXT1:c.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:c.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:c.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null};a.loadMinMaxBlending=function(c,m){return b(c)?{MIN:c.MIN,MAX:c.MAX}:m.blendMinMax?null:(c=c.getExtension("EXT_blend_minmax"))?{MIN:c.MIN_EXT,MAX:c.MAX_EXT}:null};a.loadTextureFilterAnisotropicCapability=function(c,m){return m.textureFilterAnisotropic?null:(c=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||
c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?{MAX_TEXTURE_MAX_ANISOTROPY:c.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:c.TEXTURE_MAX_ANISOTROPY_EXT}:null};a.loadTextureFloat=function(c,m){if(b(c))return{textureFloat:!0,textureFloatLinear:!m.textureFloatLinear&&!!c.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:c.HALF_FLOAT,R16F:c.R16F,RG16F:c.RG16F,RGBA16F:c.RGBA16F,R32F:c.R32F,RG32F:c.RG32F,RGBA32F:c.RGBA32F,R11F_G11F_B10F:c.R11F_G11F_B10F,
RGB16F:c.RGB16F};if(c instanceof WebGLRenderingContext){const l=!m.textureHalfFloat&&c.getExtension("OES_texture_half_float");return{textureFloat:!m.textureFloat&&!!c.getExtension("OES_texture_float"),textureFloatLinear:!m.textureFloatLinear&&!!c.getExtension("OES_texture_float_linear"),textureHalfFloat:!!l,textureHalfFloatLinear:!m.textureHalfFloatLinear&&!!c.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:l?l.HALF_FLOAT_OES:void 0}}return null};a.loadTextureNorm16=function(c,m){return!b(c)||
m.textureNorm16?null:(c=c.getExtension("EXT_texture_norm16"))?{R16:c.R16_EXT,RG16:c.RG16_EXT,RGB16:c.RGB16_EXT,RGBA16:c.RGBA16_EXT,R16_SNORM:c.R16_SNORM_EXT,RG16_SNORM:c.RG16_SNORM_EXT,RGB16_SNORM:c.RGB16_SNORM_EXT,RGBA16_SNORM:c.RGBA16_SNORM_EXT}:null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/capabilities/LoseContext":function(){define(["exports"],function(a){a.load=function(b,c){const m=c.loseContext&&b.getExtension("WEBGL_lose_context");
return m?{loseRenderingContext:()=>m.loseContext()}:null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["exports","./isWebGL2Context"],function(a,b){a.load=function(c,m){return b(c)?{createVertexArray:c.createVertexArray.bind(c),deleteVertexArray:c.deleteVertexArray.bind(c),bindVertexArray:c.bindVertexArray.bind(c)}:m.vao?null:(c=c.getExtension("OES_vertex_array_object")||c.getExtension("MOZ_OES_vertex_array_object")||
c.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:c.createVertexArrayOES.bind(c),deleteVertexArray:c.deleteVertexArrayOES.bind(c),bindVertexArray:c.bindVertexArrayOES.bind(c)}:null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextureRepository":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./basicInterfaces ./ContentObjectType ./TextureTechnique ./TextureTechniqueConfiguration ./Util ../../../support/Scheduler".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q){const u=r.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");a.TextureRepository=function(z){function A(y,D,E){var F=z.call(this,{})||this;F._stage=y;F._techniqueRepository=D;F._rctx=E;F._textures=new Map;F._loadingCount=0;F._frameUpdates=new Map;F.events=new l;F._frameTask=y.resourceController.scheduler.registerTask(q.TaskPriority.TEXTURE_UNLOAD);return F}b._inheritsLoose(A,z);var p=A.prototype;p.normalizeCtorArgs=function(){return{}};p.dispose=
function(){this._frameTask.remove();this._stage.forEachOfType(w.ContentObjectType.Texture,y=>y.unload())};p.acquire=function(y){const D=this._textures.get(y);return D?(D.ref(),n.unwrapOr(D.loadingPromise,D)):this._createNewRef(y)};p.update=function(){let y=!1;this._frameUpdates.forEach(D=>{const E=D.texture.frameUpdate(this._rctx,this.textureTechnique,D.previousToken);0<=E&&E!==D.previousToken&&(D.previousToken=E,y=!0)});y&&this.events.emit("changed",v.RenderRequestType.BACKGROUND)};p._createNewRef=
function(y){const D=this._stage.getObject(y);if(n.isNone(D))return B.assert(void 0!==D),null;const E=D.events.on("unloaded",()=>{E.remove();this._onTextureUnloaded(y)}),F=new C(y,()=>{this._frameTask.schedule(()=>{F.isUnreferenced&&D.unload()})});this._textures.set(y,F);F.ref();if(n.isSome(D.glTexture))return this._updateGLTexture(F,D.glTexture),D.requiresFrameUpdates&&this._frameUpdates.set(y,{texture:D,previousToken:-1}),F;this._loadingCount++;F.loadingPromise=this._stage.schedule(()=>{const G=
D.load(this._rctx,()=>this.textureTechnique),P=N=>{this._loadingCount--;F.loadingPromise=null;this._updateGLTexture(F,N);D.requiresFrameUpdates&&this._frameUpdates.set(y,{texture:D,previousToken:-1});return F},K=N=>{this._loadingCount--;F.loadingPromise=null;g.isAbortError(N)||u.error(N);return null};return g.isPromiseLike(G)?G.then(P,K):P(G)});return F.loadingPromise};p._updateGLTexture=function(y,D){y.glTexture=D;this.events.emit("changed",v.RenderRequestType.UPDATE)};p._onTextureUnloaded=function(y){this._textures.delete(y);
this._frameUpdates.delete(y)};b._createClass(A,[{key:"updating",get:function(){return 0<this._loadingCount||this._frameTask.updating}},{key:"textureTechnique",get:function(){n.isNone(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(t.TextureTechnique,new x.TextureTechniqueConfiguration));return this._textureTechnique}}]);return A}(m);c.__decorate([k.property()],a.TextureRepository.prototype,"_loadingCount",void 0);c.__decorate([k.property()],a.TextureRepository.prototype,
"_frameTask",void 0);c.__decorate([k.property()],a.TextureRepository.prototype,"updating",null);a.TextureRepository=c.__decorate([h.subclass("esri.views.3d.webgl-engine.lib.TextureRepository")],a.TextureRepository);let C=function(){function z(p,y){this.id=p;this._release=y;this._refCount=0}var A=z.prototype;A.ref=function(){++this._refCount};A.release=function(){--this._refCount;0<this._refCount||(0===this._refCount?this._release():(u.error("Cannot dereference texture that has no references!"),this._refCount=
0))};b._createClass(z,[{key:"isUnreferenced",get:function(){return 0===this._refCount}}]);return z}();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/internal/WaterTextureRepository":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../assets ../../../../../core/Accessor ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../support/requestImageUtils ../../lib/basicInterfaces ../../../../webgl/enums ../../../../webgl/Texture".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w){const t=r.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");a.WaterTextureRepository=function(x){function B(){var u=x.apply(this,arguments)||this;u._data=[];u._state=h.ResourceState.NOT_LOADED;return u}b._inheritsLoose(B,x);var q=B.prototype;q.dispose=function(){this._state=h.ResourceState.NOT_LOADED;this._data.forEach(u=>u.dispose());this._data.length=0};q.loadTextures=function(u){const C=[m.getAssetUrl("esri/images/materials/water/normals.jpg"),
m.getAssetUrl("esri/images/materials/water/perturbation.jpg")];this._state=h.ResourceState.LOADING;Promise.all(C.map(z=>e.requestImage(z))).then(z=>{z.forEach(A=>this._data.push(new w.Texture(u,{target:v.TextureType.TEXTURE_2D,pixelFormat:v.PixelFormat.RGBA,dataType:v.PixelType.UNSIGNED_BYTE,wrapMode:v.TextureWrapMode.REPEAT,samplingMode:v.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8,width:A.width,height:A.height},A)));this._state=h.ResourceState.LOADED}).catch(z=>{t.error("Failed to load textures for water material.",
z);this._state=h.ResourceState.NOT_LOADED})};q.bind=function(u){this._state===h.ResourceState.LOADED&&(u.bindTexture("texWaveNormal",this._data[0]),u.bindTexture("texWavePerturbation",this._data[1]))};b._createClass(B,[{key:"updating",get:function(){return this._state===h.ResourceState.LOADING}},{key:"resourceState",get:function(){return this._state}}]);return B}(l);c.__decorate([n.property()],a.WaterTextureRepository.prototype,"_state",void 0);c.__decorate([n.property({type:Boolean,readOnly:!0})],
a.WaterTextureRepository.prototype,"updating",null);a.WaterTextureRepository=c.__decorate([d.subclass("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],a.WaterTextureRepository);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/parts/contextCache":function(){define(["exports"],function(a){const b=new Map;a.getContextCache=function(){return b};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/parts/ScreenshotManager":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../../../../chunks/vec4f64 ../lib/AutoDisposable ../lib/basicInterfaces ../../../support/screenshotUtils ../../../webgl/enums ../../../webgl/FramebufferObject".split(" "),function(a,b,c,m,l,r,n,g,k,f){r=function(d){function e(v,w,t,x,B,q){var u=d.call(this)||this;u._rctx=v;u._renderScene=w;u._requestRenderScene=t;u._renderOverlay=
x;u._forceCameraHook=B;u._disposeOffscreenBuffers=q;u.supersample=!0;u._screenshotQueue=[];return u}b._inheritsLoose(e,d);var h=e.prototype;h.dispose=function(){this._rctx=null};h.takeScreenshot=function(v){this._requestRenderScene(n.RenderRequestType.BACKGROUND);const w=m.createResolver();this._screenshotQueue.push({settings:v,resolver:w});return w.promise};h.update=function(v){for(const w of this._screenshotQueue){if(this.isDisposed){w.resolver.reject();continue}const t=this._renderScreenshot(v,
{...w.settings,pixelRatio:w.settings.pixelRatio*v.viewCamera.pixelRatio});w.resolver(t)}this._screenshotQueue.length=0};h._renderScreenshotOverlay=function(v,w,t){if(c.isNone(this._renderOverlay))return w;v.width=w.width;v.height=w.height;const x=v.getContext("2d"),B=t.pixelRatio;x.save();x.translate(0,w.height);x.scale(1,-1);t.region&&x.translate(-t.region.x,-t.region.y);x.scale(B,B);w=this._renderOverlay(v,w);x.restore();return w};h._readbackScreenshot=function(v,w){return v.resample?this._readbackScreenshotResampled(v,
w):this._readbackScreenshotImmediate(v,w)};h._readbackScreenshotResampled=function(v,w){const {framebufferWidth:t,framebufferHeight:x,region:B,resample:q}=v,u=this._ensureScreenshotEncodeCanvas();let C=g.createEmptyImageData(t,x,u);this._rctx.gl.readPixels(0,0,t,x,k.PixelFormat.RGBA,k.DataType.UNSIGNED_BYTE,new Uint8Array(C.data.buffer));w();C=this._renderScreenshotOverlay(u,C,{...v,region:null});v=g.createEmptyImageData(B.width,B.height,u);return g.resampleHermite(C,v,!0,q.region.x,x-(q.region.y+
q.region.height),q.region.width,q.region.height)};h._readbackScreenshotImmediate=function(v,w){const {framebufferHeight:t,region:x}=v,B=this._ensureScreenshotEncodeCanvas(),q=g.createEmptyImageData(x.width,x.height,B);this._rctx.gl.readPixels(x.x,t-(x.y+x.height),x.width,x.height,k.PixelFormat.RGBA,k.DataType.UNSIGNED_BYTE,new Uint8Array(q.data.buffer));w();return this._renderScreenshotOverlay(B,q,v)};h._renderScreenshot=function(v,w){let t=null;const x=v.viewCamera,{framebufferWidth:B,framebufferHeight:q}=
w;var u=!1;v=w.disableDecorations&&v.frameHasDecorations;var C=w.ignorePadding&&x.pixelRatio!==w.pixelRatio;if(v=B!==x.fullWidth||q!==x.fullHeight||v||C){C=x.clone();if(w.ignorePadding){u=l.clone(C.padding);for(var z=0;4>z;z++)u[z]=Math.round(u[z]/C.pixelRatio*w.pixelRatio);C.padding=u}C.fullWidth=B;C.fullHeight=q;C.pixelRatio=w.pixelRatio;u=x.fovX-C.fovX;z=x.fovY-C.fovY;0>u&&u<z?C.fovX=x.fovX:0>z&&z<u&&(C.fovY=x.fovY);this._forceCameraHook(C);u=!0;t=new f.FramebufferObject(this._rctx,{width:C.fullWidth,
height:C.fullHeight,colorTarget:k.TargetType.TEXTURE,depthStencilTarget:k.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER});this._renderScene(t,C,w.disableDecorations?n.Decorations.OFF:n.Decorations.ON);this._disposeOffscreenBuffers()}C=()=>{this._rctx.bindFramebuffer(null);c.disposeMaybe(t)};w=this._readbackScreenshot(w,C);C();if(v&&!this._rctx.contextAttributes.alpha)for(v=3;v<w.data.length;v+=4)w.data[v]=255;u&&this._forceCameraHook(x);return w};h._ensureScreenshotEncodeCanvas=function(){this._screenshotEncodeCanvas||
(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas};return e}(r.AutoDisposable);a.ScreenshotManager=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/parts/testUtils":function(){define(["exports","./contextCache"],function(a,b){a.contextCache={enabled:!1,disposeContextCache:()=>{const c=b.getContextCache();c.forEach(m=>m.dispose());c.clear()}};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/intersectorUtilsConversions":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ../../layers/i3s/Intersector ../../terrain/Intersector ./intersectorUtils ./lodRendering/Intersector".split(" "),function(a,b,c,m,l,r,n,g,k,f){function d(B,q){return b.isNone(B)?null:k.isObjectIntersectorResult(B)||k.isHudIntersectorResult(B)?
e(B.target.object.metadata,q):n.isPclIntersectorResult(B)?(B=B.target.createGraphic(),{type:"graphic",graphic:B,layer:B.layer}):g.isOverlayIntersectorResult(B)||f.isLodIntersectorResult(B)?e(B.target,q):n.isI3sIntersectorResult(B)?h(B.target,q):null}function e(B,q){if(b.isNone(B)||b.isNone(B.graphicUid))return null;const u=t(B,q);if(b.isNone(u))return null;if(u===q.graphics)return b.isNone(q.graphicsView)||"number"!==typeof B.graphicUid?null:q.graphicsView.getHit(B.graphicUid);q=q.allLayerViews.find(C=>
C.layer===u);return!q||q.suspended||b.isNone(B.graphicUid)?null:"getHit"in q?q.getHit(B.graphicUid):null}function h(B,q){const u=t(B,q);return b.isNone(u)?null:(q=q.allLayerViews.find(C=>C.layer===u))&&!q.suspended&&"getGraphicFromIntersectorTarget"in q?w(q.getGraphicFromIntersectorTarget(B)):null}function v(B,q){const u=t(B,q);return b.isNone(u)?null:(q=q.allLayerViews.find(C=>C.layer===u))&&!q.suspended&&"getAABBFromIntersectorTarget"in q?q.getAABBFromIntersectorTarget(B):null}function w(B){return b.isSome(B)?
{type:"graphic",graphic:B,layer:B.layer}:null}function t(B,q){return b.isNone(B.layerUid)?null:b.isSome(q.graphicsView)&&B.layerUid===q.graphicsView.processor.layer.id?q.graphics:q.map.findLayerByUid(B.layerUid)}const x=m.create();a.getIntersectedFeatureBSRadius=function(B,q){return k.isObjectIntersectorResult(B)||k.isHudIntersectorResult(B)?r.getRadius(B.target.object.boundingVolumeWorldSpace.bounds):f.isLodIntersectorResult(B)?(c.getScaling(x,B.transformation),B.target.baseBoundingSphere.radius*
Math.max(x[0],x[1],x[2])):n.isI3sIntersectorResult(B)?b.applySome(v(B.target,q),u=>.5*l.diameter(u)):null};a.hasLod=function(B){return k.isObjectIntersectorResult(B)||k.isHudIntersectorResult(B)?!1:f.isLodIntersectorResult(B)?1<B.target.numLodLevels:n.isI3sIntersectorResult(B)?!0:!1};a.toGraphic=function(B,q){B=d(B,q);return b.isSome(B)&&"graphic"===B.type?B.graphic:null};a.toHit=d;a.toOwner=function(B,q){if(k.isObjectIntersectorResult(B)||k.isHudIntersectorResult(B))return t(B.target.object.metadata,
q);if(g.isTerrainIntersectorResult(B)){var u;return null==(u=q.map)?void 0:u.ground}return n.isPclIntersectorResult(B)||n.isI3sIntersectorResult(B)||g.isOverlayIntersectorResult(B)?t(B.target,q):null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/Intersector":function(){define(["exports","../../webgl-engine/lib/IntersectorInterfaces","../../webgl-engine/lib/intersectorUtils"],function(a,b,c){a.isI3sIntersectorResult=function(m){return c.isValidIntersectorResult(m)&&
m.intersector===b.IntersectorType.I3S&&!!m.target};a.isPclIntersectorResult=function(m){return c.isValidIntersectorResult(m)&&m.intersector===b.IntersectorType.PCL&&!!m.target};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/Intersector":function(){define(["exports","../webgl-engine/lib/IntersectorInterfaces","../webgl-engine/lib/intersectorUtils"],function(a,b,c){a.isOverlayIntersectorResult=function(m){return c.isValidIntersectorResult(m)&&
m.intersector===b.IntersectorType.OVERLAY&&!!m.target};a.isTerrainIntersectorResult=function(m){return c.isValidIntersectorResult(m)&&m.intersector===b.IntersectorType.TERRAIN&&!!m.target};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/lodRendering/Intersector":function(){define(["exports","../IntersectorInterfaces","../intersectorUtils"],function(a,b,c){a.isLodIntersectorResult=function(m){return c.isValidIntersectorResult(m)&&
m.intersector===b.IntersectorType.LOD&&!!m.target};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/support/hitTestSelectUtils":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe"],function(a,b,c){function m(){m=b._asyncToGenerator(function*(r,n){if("2d"===r.type)return r.hitTest(n);r=yield r.hitTest(n);if(0===r.results.length)return r;n=r.results[0];const g=c.isSome(n.distance)?1.05*n.distance:n.distance;
n=r.results.findIndex(k=>k.distance>g);-1!==n&&(r.results=r.results.slice(0,n));return r});return m.apply(this,arguments)}function l(r){return c.isSome(r)&&"graphic"===r.type}a.filterGraphicHits=function(r){return r.filter(l)};a.findFirstGraphicHit=function(r){var n;return null!=(n=r.find(l))?n:null};a.hitTestSelectSimilarDistance=function(r,n){return m.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/support/WebGLRequirements":function(){define(["exports",
"../../core/Error","../webgl/capabilities","../webgl/context-util"],function(a,b,c,m){a.check=function(l){const r=c.getWebGLCapabilities(l);if(!r.available)return new b("webgl:required","WebGL is required but not supported.");if("3d"===l&&r.majorPerformanceCaveat)return new b("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!r.supportsHighPrecisionFragment)return new b("webgl:high-precision-fragment-required",
"WebGL support for high precision fragment shaders is required but not supported.");if(!r.supportsVertexShaderSamplers)return new b("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(r.type===m.ContextType.WEBGL1){if(!r.supportsElementIndexUint)return new b("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!r.supportsStandardDerivatives)return new b("webgl:standard-derivatives-required",
"WebGL support for standard derivatives is required but not supported.");if(!r.supportsInstancedArrays)return new b("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/capabilities":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe","./context-util"],function(a,b,c,m){function l(v){switch(v){case m.ContextType.WEBGL1:return r();
case m.ContextType.WEBGL2:return n()}}function r(){if(!k){{const v=new e,w=g(m.ContextType.WEBGL1,v);c.isNone(w)||(v.supportsElementIndexUint=null!==w.getExtension("OES_element_index_uint"),v.supportsStandardDerivatives=null!==w.getExtension("OES_standard_derivatives"),v.supportsInstancedArrays=null!==w.getExtension("ANGLE_instanced_arrays"),v.supportsTextureFloat=null!==w.getExtension("OES_texture_float"),v.supportsTextureHalfFloat=null!==w.getExtension("OES_texture_half_float"),v.supportsColorBufferFloat=
null!==w.getExtension("WEBGL_color_buffer_float"),v.supportsColorBufferFloatBlend=null!==w.getExtension("EXT_float_blend"),v.supportsColorBufferHalfFloat=null!==w.getExtension("EXT_color_buffer_half_float"));k=v}}return k}function n(){if(!f){{const v=new h,w=g(m.ContextType.WEBGL2,v);c.isNone(w)||(v.supportsColorBufferFloat=null!==w.getExtension("EXT_color_buffer_float"),v.supportsColorBufferFloatBlend=null!==w.getExtension("EXT_float_blend"),v.supportsColorBufferHalfFloat=v.supportsColorBufferFloat||
null!==w.getExtension("EXT_color_buffer_half_float"));f=v}}return f}function g(v,w){const t=document.createElement("canvas");if(!t)return null;let x=m.createContext(t,v,{failIfMajorPerformanceCaveat:!0});c.isNone(x)&&(x=m.createContext(t,v),c.isSome(x)&&(w.majorPerformanceCaveat=!0));if(c.isNone(x))return x;if(v===m.ContextType.WEBGL1){if(v=x.getParameter(x.VERSION),v=null==v?void 0:v.match(/^WebGL\s+([\d.]*)/))v=parseFloat(v[1]),w.available=.94<=v}else w.available=!0;w.maxTextureSize=x.getParameter(x.MAX_TEXTURE_SIZE);
w.supportsVertexShaderSamplers=0<x.getParameter(x.MAX_VERTEX_TEXTURE_IMAGE_UNITS);if(v=x.getShaderPrecisionFormat(x.FRAGMENT_SHADER,x.HIGH_FLOAT))w.supportsHighPrecisionFragment=0<v.precision;return x}let k,f,d=function(){this.majorPerformanceCaveat=this.available=!1;this.maxTextureSize=0;this.supportsColorBufferHalfFloat=this.supportsColorBufferFloatBlend=this.supportsColorBufferFloat=this.supportsTextureHalfFloat=this.supportsTextureFloat=this.supportsInstancedArrays=this.supportsStandardDerivatives=
this.supportsElementIndexUint=this.supportsHighPrecisionFragment=this.supportsVertexShaderSamplers=!1},e=function(v){function w(){var t=v.apply(this,arguments)||this;t.type=m.ContextType.WEBGL1;return t}b._inheritsLoose(w,v);return w}(d),h=function(v){function w(){var t=v.apply(this,arguments)||this;t.type=m.ContextType.WEBGL2;t.supportsElementIndexUint=!0;t.supportsStandardDerivatives=!0;t.supportsInstancedArrays=!0;t.supportsTextureFloat=!0;t.supportsTextureHalfFloat=!0;return t}b._inheritsLoose(w,
v);return w}(d);a.getWebGL1Capabilities=r;a.getWebGL2Capabilities=n;a.getWebGLCapabilities=function(v){for(v=m.getContextTypes(v);1<v.length;){const w=l(v.shift());if(w.available)return w}return l(v.shift())};a.getWebGLVersionCapabilities=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/ui/3d/DefaultUI3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../DefaultUI".split(" "),
function(a,b,c,m,l,r,n,g){m=function(k){function f(d){d=k.call(this,d)||this;d.components=["attribution","zoom","navigation-toggle","compass"];return d}a._inheritsLoose(f,k);return f}(g);b.__decorate([c.property()],m.prototype,"components",void 0);return m=b.__decorate([n.subclass("esri.views.ui.3d.DefaultUI3D")],m)})},"esri/views/ui/DefaultUI":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w){m.getLogger("esri.views.ui.DefaultUI");c=function(t){function x(q){q=t.call(this,q)||this;q._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"};q.components=[];return q}a._inheritsLoose(x,t);var B=x.prototype;B.initialize=function(){this._handles.add([l.watch(()=>this.components,this._componentsWatcher.bind(this),l.initial),l.watch(()=>this.view,this._updateViewAwareWidgets.bind(this),l.initial)])};
B._add=function(q,u,C,z){if("string"===typeof q&&this._defaultPositionLookup[q]){if(this._find(q))return;q=this._createComponent(q)}t.prototype._add.call(this,q,u,C,z)};B._removeComponents=function(q){q.forEach(u=>{if(u=this._find(u))this.remove(u),u.destroy()})};B._updateViewAwareWidgets=function(q){this.components.forEach(u=>{(u=(u=this._find(u))&&u.widget)&&void 0!==u.view&&(u.view=q)})};B._componentsWatcher=function(q,u){this._removeComponents(u);this._addComponents(q);this._adjustPadding(q)};
B._adjustPadding=function(q){q.includes("attribution")||this._isOverridden("padding")||({top:q}=this.padding,this.padding=q)};B._addComponents=function(q){this.initialized&&q.forEach(u=>this.add(this._createComponent(u),this._defaultPositionLookup[u]))};B._createComponent=function(q){const u=this._createWidget(q);if(u)return new f({id:q,node:u})};B._createWidget=function(q){if("attribution"===q)return this._createAttribution();if("compass"===q)return this._createCompass();if("navigation-toggle"===
q)return this._createNavigationToggle();if("zoom"===q)return this._createZoom()};B._createAttribution=function(){return new e({view:this.view})};B._createCompass=function(){return new h({view:this.view})};B._createNavigationToggle=function(){return new v({view:this.view})};B._createZoom=function(){return new w({view:this.view})};return x}(d);b.__decorate([r.property()],c.prototype,"components",void 0);return c=b.__decorate([k.subclass("esri.views.ui.DefaultUI")],c)})},"esri/views/ui/Component":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/domUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,m,l,r,n,g,k){c=function(f){function d(){var h=f.apply(this,arguments)||this;h.widget=null;return h}a._inheritsLoose(d,f);var e=d.prototype;e.destroy=function(){this.widget&&this.widget.destroy();this.node=null};e.castNode=function(h){if(!h)return this._set("widget",null),null;if("string"===typeof h||h&&"nodeType"in h)return this._set("widget",null),m.byId(h);h&&"function"===typeof h.render&&!h.domNode&&(h.domNode=document.createElement("div"));this._set("widget",h);return h.domNode};
a._createClass(d,[{key:"id",get:function(){return this.get("widget.id")||this.get("node.id")}},{key:"node",set:function(h){const v=this._get("node");h!==v&&(h&&h.classList.add("esri-component"),v&&v.classList.remove("esri-component"),this._set("node",h))}}]);return d}(c);b.__decorate([l.property({dependsOn:[]})],c.prototype,"id",null);b.__decorate([l.property()],c.prototype,"node",null);b.__decorate([g.cast("node")],c.prototype,"castNode",null);b.__decorate([l.property({readOnly:!0})],c.prototype,
"widget",void 0);return c=b.__decorate([k.subclass("esri.views.ui.Component")],c)})},"esri/views/ui/UI":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/domUtils ../../core/Evented ../../core/Handles ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../support/themeUtils ./Component ../../widgets/support/widgetUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){function w(q){const u="object"===typeof q&&null!==q&&Object.getPrototypeOf(q);return null!==u&&u!==Object.prototype||!("component"in q||"index"in q||"position"in q)?null:q}function t(q,{top:u,bottom:C,left:z,right:A}){q.style.top=u;q.style.bottom=C;q.style.left=z;q.style.right=A}const x={left:0,top:0,bottom:0,right:0},B={bottom:30,top:15,right:15,left:15};m=function(q){function u(z){var A=q.call(this,z)||this;A._cornerNameToContainerLookup={};A._positionNameToContainerLookup=
{};A._components=[];A._componentToKey=new Map;A._handles=new l;A.view=null;A._applyViewPadding=()=>{const p=A.container;p&&t(p,A._toPxPosition(A._getViewPadding()))};A._applyUIPadding=()=>{const p=A._innerContainer;p&&t(p,A._toPxPosition(A.padding))};A._initContainers();return A}a._inheritsLoose(u,q);var C=u.prototype;C.initialize=function(){this._handles.add([r.watch(()=>{var z;return[null==(z=this.view)?void 0:z.padding,this.container]},this._applyViewPadding,r.initial),r.watch(()=>this.padding,
this._applyUIPadding,r.initial)])};C.destroy=function(){this.container=null;for(const z of this._components)z.destroy();this._components.length=0;this._handles.destroy();this._componentToKey.clear()};C.castPadding=function(z){return"number"===typeof z?{bottom:z,top:z,right:z,left:z}:{...B,...z}};C.add=function(z,A){let p,y;if(Array.isArray(z))z.forEach(E=>this.add(E,A));else{var D=w(z);D&&({index:p,position:A,component:z,key:y}=D);A&&"object"===typeof A&&({index:p,key:y,position:A}=A);!z||A&&!this._isValidPosition(A)||
this._add(z,A,p,y)}};C.remove=function(z,A){if(z){if(Array.isArray(z))return z.map(D=>this.remove(D,A));var p=this._find(z);if(p){var y=this._componentToKey;if(!y.has(z)||y.get(z)===A)return y=this._components.indexOf(p),p.node.parentNode&&p.node.parentNode.removeChild(p.node),this._componentToKey.delete(z),this._components.splice(y,1)[0]}}};C.empty=function(z){if(Array.isArray(z))return z.map(A=>this.empty(A)).reduce((A,p)=>A.concat(p));z=z||"manual";return"manual"===z?Array.prototype.slice.call(this._manualContainer.children).filter(A=>
!A.classList.contains("esri-ui-corner")).map(A=>this.remove(A)):this._isValidPosition(z)?Array.prototype.slice.call(this._cornerNameToContainerLookup[z].children).map(this.remove,this):null};C.move=function(z,A){Array.isArray(z)&&z.forEach(D=>this.move(D,A));if(z){var p=w(z)||w(A);if(p){var y=p.index;A=p.position;z=p.component||z}(!A||this._isValidPosition(A))&&(z=this.remove(z))&&this.add(z,{position:A,index:y})}};C.find=function(z){return z?(z=this._findById(z))&&(z.widget||z.node):null};C.getPosition=
function(z){for(const A in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[A].contains(z))return A;return null};C._add=function(z,A,p,y){z instanceof h||(z=new h({node:z}));this._place({component:z,position:A,index:p});this._components.push(z);y&&this._componentToKey.set(z,y)};C._find=function(z){return z?z instanceof h?this._findByComponent(z):"string"===typeof z?this._findById(z):this._findByNode(z.domNode||z):null};C._getViewPadding=function(){return this.get("view.padding")||
x};C._attachContainers=function(z){z.appendChild(this._innerContainer);z.appendChild(this._manualContainer)};C._initContainers=function(){var z=document.createElement("div");z.classList.add("esri-ui-inner-container");z.classList.add("esri-ui-corner-container");const A=document.createElement("div");A.classList.add("esri-ui-inner-container");A.classList.add("esri-ui-manual-container");const p=document.createElement("div");p.classList.add("esri-ui-top-left");p.classList.add("esri-ui-corner");z.appendChild(p);
const y=document.createElement("div");y.classList.add("esri-ui-top-right");y.classList.add("esri-ui-corner");z.appendChild(y);const D=document.createElement("div");D.classList.add("esri-ui-bottom-left");D.classList.add("esri-ui-corner");z.appendChild(D);const E=document.createElement("div");E.classList.add("esri-ui-bottom-right");E.classList.add("esri-ui-corner");z.appendChild(E);this._innerContainer=z;this._manualContainer=A;z=v.isRTL();this._cornerNameToContainerLookup={"top-left":p,"top-right":y,
"bottom-left":D,"bottom-right":E,"top-leading":z?y:p,"top-trailing":z?p:y,"bottom-leading":z?E:D,"bottom-trailing":z?D:E};this._positionNameToContainerLookup={manual:A,...this._cornerNameToContainerLookup}};C._isValidPosition=function(z){return!!this._positionNameToContainerLookup[z]};C._place=function(z){const A=z.component,p=z.index;z=this._positionNameToContainerLookup[z.position||"manual"];var y=-1<p,D=A.widget;D&&!D._started&&"function"===typeof D.postMixInProperties&&"function"===typeof D.buildRendering&&
"function"===typeof D.postCreate&&"function"===typeof D.startup&&A.widget.startup();y?(y=Array.prototype.slice.call(z.children),0===p?z.firstChild?c.insertBefore(A.node,z.firstChild):z.appendChild(A.node):p>=y.length?z.appendChild(A.node):c.insertBefore(A.node,y[p])):z.appendChild(A.node)};C._toPxPosition=function(z){return{top:this._toPxUnit(z.top),left:this._toPxUnit(z.left),right:this._toPxUnit(z.right),bottom:this._toPxUnit(z.bottom)}};C._toPxUnit=function(z){return 0===z?"0":z+"px"};C._findByComponent=
function(z){let A=null,p;this._components.some(y=>{(p=y===z)&&(A=y);return p});return A};C._findById=function(z){let A=null,p;this._components.some(y=>{(p=y.id===z)&&(A=y);return p});return A};C._findByNode=function(z){let A=null,p;this._components.some(y=>{(p=y.node===z)&&(A=y);return p});return A};a._createClass(u,[{key:"container",set:function(z){const A=this._get("container");z!==A&&(z&&(z.classList.add("esri-ui"),e.setCalciteThemeClass(z),this._attachContainers(z)),A&&(A.classList.remove("esri-ui"),
t(A,{top:"",bottom:"",left:"",right:""}),c.empty(A)),this._set("container",z))}},{key:"height",get:function(){const z=this.get("view.height")||0;if(0===z)return z;const A=this._getViewPadding();return Math.max(z-(A.top+A.bottom),0)}},{key:"padding",get:function(){return this._get("padding")},set:function(z){z?this._override("padding",z):this._clearOverride("padding")}},{key:"width",get:function(){const z=this.get("view.width")||0;if(0===z)return z;const A=this._getViewPadding();return Math.max(z-
(A.left+A.right),0)}}]);return u}(m.EventedAccessor);b.__decorate([n.property()],m.prototype,"container",null);b.__decorate([n.property()],m.prototype,"height",null);b.__decorate([n.property({value:B})],m.prototype,"padding",null);b.__decorate([f.cast("padding")],m.prototype,"castPadding",null);b.__decorate([n.property()],m.prototype,"view",void 0);b.__decorate([n.property()],m.prototype,"width",null);return m=b.__decorate([d.subclass("esri.views.ui.UI")],m)})},"esri/widgets/Attribution":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/reactiveUtils ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Attribution/AttributionViewModel ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w){l=function(t){function x(q,u){var C=t.call(this,q,u)||this;C._isOpen=!1;C._attributionTextOverflowed=!1;C._prevSourceNodeHeight=0;C._resizeObserver=new ResizeObserver(z=>z.forEach(({target:A})=>C._checkSourceTextOverflow(A)));C.iconClass="esri-icon-description";C.itemDelimiter=" | ";C.label=void 0;C.messages=null;C.view=null;C.viewModel=new d;return C}a._inheritsLoose(x,t);var B=x.prototype;B.initialize=function(){this.own(c.on(()=>{var q;return null==(q=this.viewModel)?
void 0:q.items},"change",()=>this.scheduleRender()))};B.destroy=function(){var q;null==(q=this._resizeObserver)?void 0:q.disconnect()};B.render=function(){return v.tsx("div",{bind:this,class:this.classes("esri-attribution esri-widget",{["esri-attribution--open"]:this._isOpen}),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())};B.renderPoweredBy=function(){return v.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",v.tsx("a",
{class:"esri-attribution__link",href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))};B.renderSourcesNode=function(){const q=this._isOpen,u=this._isInteractive,C=u?"0":"",{attributionText:z}=this;return v.tsx("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes("esri-attribution__sources",{["esri-attribution__sources--open"]:q,["esri-interactive"]:u}),innerHTML:z,tabindex:C})};B._afterSourcesNodeCreate=function(q){this._prevSourceNodeHeight=q.clientWidth;
this._resizeObserver.observe(q)};B._checkSourceTextOverflow=function(q){let u=!1;const {clientHeight:C,clientWidth:z,scrollWidth:A}=q;q=A>z;const p=this._attributionTextOverflowed!==q;this._attributionTextOverflowed=q;p&&(u=!0);this._isOpen&&(q=C<this._prevSourceNodeHeight,this._prevSourceNodeHeight=C,q&&(this._isOpen=!1,u=!0));u&&this.scheduleRender()};B._toggleState=function(){this._isInteractive&&(this._isOpen=!this._isOpen)};a._createClass(x,[{key:"_isInteractive",get:function(){return this._isOpen||
this._attributionTextOverflowed}},{key:"attributionText",get:function(){return this.viewModel.items.reduce((q,u)=>{q.includes(u.text)||q.push(u.text);return q},[]).join(this.itemDelimiter)}}]);return x}(f);b.__decorate([g.property()],l.prototype,"_isOpen",void 0);b.__decorate([g.property()],l.prototype,"_isInteractive",null);b.__decorate([g.property()],l.prototype,"_attributionTextOverflowed",void 0);b.__decorate([g.property()],l.prototype,"_prevSourceNodeHeight",void 0);b.__decorate([g.property({readOnly:!0,
dependsOn:["viewModel.items.length","itemDelimiter"]})],l.prototype,"attributionText",null);b.__decorate([g.property()],l.prototype,"iconClass",void 0);b.__decorate([g.property()],l.prototype,"itemDelimiter",void 0);b.__decorate([g.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],l.prototype,"label",void 0);b.__decorate([g.property(),h.messageBundle("esri/widgets/Attribution/t9n/Attribution")],l.prototype,"messages",void 0);b.__decorate([m.aliasOf("viewModel.view")],l.prototype,
"view",void 0);b.__decorate([g.property({type:d})],l.prototype,"viewModel",void 0);b.__decorate([e.accessibleHandler()],l.prototype,"_toggleState",null);return l=b.__decorate([k.subclass("esri.widgets.Attribution")],l)})},"esri/widgets/Attribution/AttributionViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/asyncUtils ../../core/Collection ../../core/HandleOwner ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../geometry/SpatialReference".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w){function t(u,C){return u&&"copyright"in u&&(!C||"function"===typeof u.originOf&&"user"===u.originOf("copyright"))}function x(u,C){return u.length!==C.length||u.some((z,A)=>z.text!==C[A].text)}function B(u,C,z){z&&C&&(u.find(A=>A.layerView===C&&A.text===z)||u.push({text:z,layerView:C}))}const q=[];c=function(u){function C(A){var p=u.call(this,A)||this;p._clear=()=>{p._fetchedAttributionData.clear();p._pendingAttributions.clear();p.handles.remove("suspension");
p.notifyChange("state")};p._pendingAttributions=new Set;p._fetchedAttributionData=new Map;p.items=new l;p.view=null;p._allLayerViewsChange=y=>{p.handles.remove("suspension");const D=p.get("view.allLayerViews");D&&p.handles.add(D.map(E=>n.watch(()=>{var F;return[E.suspended,null==(F=E.layer)?void 0:F.attributionVisible]},()=>p._updateAttributionItems())),"suspension");y&&y.removed&&y.removed.forEach(E=>{p._pendingAttributions.delete(E);p._fetchedAttributionData.delete(E)});p._updateAttributionItems()};
p.handles.add([n.on(()=>{var y;return null==(y=p.view)?void 0:y.allLayerViews},"change",y=>p._allLayerViewsChange(y),{onListenerAdd:()=>p._allLayerViewsChange(),onListenerRemove:p._clear}),n.when(()=>{var y;return!0===(null==(y=p.view)?void 0:y.stationary)},()=>p._updateAttributionItems())]);return p}a._inheritsLoose(C,u);var z=C.prototype;z.destroy=function(){this.view=null;this._fetchedAttributionData.clear();this._pendingAttributions.clear();this.items.removeAll()};z._updateAttributionItems=function(){const A=
this.get("view.allLayerViews");q.length=0;A?(A.forEach(p=>{var y;if(!p.suspended&&null!=(y=p.layer)&&y.attributionVisible)if(y=p.layer,t(y,"user"))B(q,p,y.copyright);else if(y.hasAttributionData)if(this._fetchedAttributionData.has(p)){var D=this._fetchedAttributionData.get(p);D?B(q,p,this._getDynamicAttribution(D,this.view,y)):t(y)&&B(q,p,y.copyright)}else this._fetchAttributionData(p);else(D=y.get("portalItem.accessInformation"))?B(q,p,D):B(q,p,y.copyright)}),x(this.items,q)&&(this.items.removeAll(),
this.items.addMany(q)),q.length=0,this.notifyChange("state")):this._clear()};z._fetchAttributionData=function(){var A=a._asyncToGenerator(function*(p){if(!this._pendingAttributions.has(p)){this._pendingAttributions.add(p);var y=yield m.result(p.layer.fetchAttributionData());this._pendingAttributions.has(p)&&(y=y.ok?this._createContributionIndex(y.value,"bing-maps"===p.layer.type):null,this._pendingAttributions.delete(p),this._fetchedAttributionData.set(p,y));this._updateAttributionItems()}});return function(p){return A.apply(this,
arguments)}}();z._createContributionIndex=function(A,p){A=A.contributors;const y={};if(!A)return y;for(let G=0;G<A.length;G++){const P=A[G];var D=P.coverageAreas;if(!D)return;for(const K of D){var E=K.bbox,F=K.zoomMin-(p&&K.zoomMin?1:0);D=K.zoomMax-(p&&K.zoomMax?1:0);for(E={extent:v.geographicToWebMercator({xmin:E[1],ymin:E[0],xmax:E[3],ymax:E[2],spatialReference:w.WGS84}),attribution:P.attribution||"",score:null!=K.score?K.score:100,id:G};F<=D;F++)y[F]=y[F]||[],y[F].push(E)}}y.maxKey=Math.max.apply(null,
Object.keys(y));return y};z._getDynamicAttribution=function(A,p,y){const {extent:D,scale:E}=p;y=y.tileInfo.scaleToZoom(E);y=Math.min(A.maxKey,Math.round(y));if(!D||null==y||-1>=y)return"";A=A[y];const F=v.project(D.center.clone().normalize(),p.spatialReference),G={};return A?A.filter(P=>{const K=!G[P.id]&&F&&h.extentContainsPoint(P.extent,F);K&&(G[P.id]=!0);return K}).sort((P,K)=>K.score-P.score||P.objectId-K.objectId).map(P=>P.attribution).join(", "):""};a._createClass(C,[{key:"state",get:function(){return this.get("view.ready")?
0<this._pendingAttributions.size?"loading":"ready":"disabled"}}]);return C}(r.HandleOwner);b.__decorate([g.property({readOnly:!0,type:l})],c.prototype,"items",void 0);b.__decorate([g.property({readOnly:!0})],c.prototype,"state",null);b.__decorate([g.property()],c.prototype,"view",void 0);return c=b.__decorate([e.subclass("esri.widgets.Attribution.AttributionViewModel")],c)})},"esri/widgets/Compass":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Compass/CompassViewModel ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){m=function(w){function t(B,q){B=w.call(this,B,q)||this;B.goToOverride=null;B.iconClass="esri-icon-locate-circled";B.label=void 0;B.messages=null;B.view=null;B.viewModel=new f;return B}a._inheritsLoose(t,w);var x=t.prototype;x.reset=function(){return this.viewModel.reset()};x.render=function(){const {orientation:B,state:q}=this.viewModel;var u="disabled"===q,C="compass"===("rotation"===q?"rotation":"compass");const z=u?-1:0;u={["esri-disabled"]:u,["esri-interactive"]:!u};
C={["esri-icon-compass"]:C,["esri-icon-dial"]:!C};const {messages:A}=this;return h.tsx("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",u),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:z,"aria-label":A.reset,title:A.reset},h.tsx("span",{"aria-hidden":"true",class:this.classes("esri-compass__icon",C),styles:this._toRotationTransform(B)}),h.tsx("span",{class:"esri-icon-font-fallback-text"},A.reset))};x._reset=function(){this.viewModel.reset()};x._toRotationTransform=
function(B){return{transform:`rotateZ(${B.z}deg)`}};return t}(k);b.__decorate([c.aliasOf("viewModel.goToOverride")],m.prototype,"goToOverride",void 0);b.__decorate([n.property()],m.prototype,"iconClass",void 0);b.__decorate([n.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],m.prototype,"label",void 0);b.__decorate([n.property(),e.messageBundle("esri/widgets/Compass/t9n/Compass")],m.prototype,"messages",void 0);b.__decorate([c.aliasOf("viewModel.view")],m.prototype,"view",void 0);
b.__decorate([n.property({type:f})],m.prototype,"viewModel",void 0);b.__decorate([d.accessibleHandler()],m.prototype,"_reset",null);return m=b.__decorate([g.subclass("esri.widgets.Compass")],m)})},"esri/widgets/Compass/CompassViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Handles ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../support/GoTo".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e){c=function(h){function v(t){t=h.call(this,t)||this;t._handles=new m;t.orientation={x:0,y:0,z:0};t.view=null;t._updateForCamera=t._updateForCamera.bind(a._assertThisInitialized(t));t._updateForRotation=t._updateForRotation.bind(a._assertThisInitialized(t));t._updateRotationWatcher=t._updateRotationWatcher.bind(a._assertThisInitialized(t));return t}a._inheritsLoose(v,h);var w=v.prototype;w.initialize=function(){this._handles.add(r.watch(()=>this.view,this._updateRotationWatcher,
r.initial))};w.destroy=function(){this._handles=l.removeMaybe(this._handles);this.view=null};w.reset=function(){if(this.get("view.ready")){var t={};"2d"===this.view.type?t.rotation=0:t.heading=0;this.callGoTo({target:t})}};w._updateForRotation=function(t){void 0!==t&&null!==t&&(this.orientation={z:t})};w._updateForCamera=function(t){t&&(this.orientation={x:0,y:0,z:-t.heading})};w._updateRotationWatcher=function(t){this._handles.removeAll();t&&this._handles.add("2d"===t.type?r.watch(()=>null==t?void 0:
t.rotation,this._updateForRotation,r.initial):r.watch(()=>null==t?void 0:t.camera,this._updateForCamera,r.initial))};a._createClass(v,[{key:"canShowNorth",get:function(){const t=this.get("view.spatialReference");return!(!t||!t.isWebMercator&&!t.isGeographic)}},{key:"state",get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}}]);return v}(e.GoToMixin(c));b.__decorate([n.property({readOnly:!0})],c.prototype,"canShowNorth",null);b.__decorate([n.property()],
c.prototype,"orientation",void 0);b.__decorate([n.property({readOnly:!0})],c.prototype,"state",null);b.__decorate([n.property()],c.prototype,"view",void 0);return c=b.__decorate([d.subclass("esri.widgets.CompassViewModel")],c)})},"esri/widgets/NavigationToggle":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./NavigationToggle/NavigationToggleViewModel ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){m=function(w){function t(B,q){B=w.call(this,B,q)||this;B.iconClass="esri-icon-pan2";B.label=void 0;B.messages=null;B.view=null;B.viewModel=new f;return B}a._inheritsLoose(t,w);var x=t.prototype;x.toggle=function(){return this.viewModel.toggle()};x.render=function(){const B="disabled"===this.get("viewModel.state");var q="pan"===this.get("viewModel.navigationMode");const u={["esri-navigation-toggle__button--active"]:q};q={["esri-navigation-toggle__button--active"]:!q};
const C=B?-1:0,z=this.messages.toggle;return h.tsx("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",{["esri-disabled"]:B,["esri-navigation-toggle--horizontal"]:"horizontal"===this.layout}),onclick:this._toggle,onkeydown:this._toggle,tabIndex:C,"aria-label":z,title:z},h.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--pan",u)},h.tsx("span",{class:"esri-icon-pan"})),h.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button",
"esri-navigation-toggle__button--rotate",q)},h.tsx("span",{class:"esri-icon-rotate"})))};x._toggle=function(){this.toggle()};a._createClass(t,[{key:"layout",set:function(B){"horizontal"!==B&&(B="vertical");this._set("layout",B)}}]);return t}(k);b.__decorate([n.property()],m.prototype,"iconClass",void 0);b.__decorate([n.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],m.prototype,"label",void 0);b.__decorate([n.property({value:"vertical"})],m.prototype,"layout",null);b.__decorate([n.property(),
e.messageBundle("esri/widgets/NavigationToggle/t9n/NavigationToggle")],m.prototype,"messages",void 0);b.__decorate([c.aliasOf("viewModel.view")],m.prototype,"view",void 0);b.__decorate([n.property({type:f})],m.prototype,"viewModel",void 0);b.__decorate([d.accessibleHandler()],m.prototype,"_toggle",null);return m=b.__decorate([g.subclass("esri.widgets.NavigationToggle")],m)})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Handles ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,m,l,r,n,g,k,f){c=function(d){function e(v){v=d.call(this,v)||this;v._handles=new m;v.navigationMode="pan";v.view=null;return v}a._inheritsLoose(e,d);var h=e.prototype;h.initialize=function(){this._handles.add(l.when(()=>{var v;return null==(v=this.view)?void 0:v.inputManager},()=>this._setNavigationMode()))};h.destroy=function(){this._handles.destroy();this.view=this._handles=null};h.toggle=function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",
this._setNavigationMode())};h._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"};a._createClass(e,[{key:"state",get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"}}]);return e}(c);b.__decorate([r.property({readOnly:!0})],c.prototype,"state",null);b.__decorate([r.property()],c.prototype,"navigationMode",void 0);b.__decorate([r.property()],c.prototype,"view",void 0);return c=b.__decorate([f.subclass("esri.widgets.NavigationToggleViewModel")],
c)})},"esri/widgets/Zoom":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory ./Zoom/IconButton ./Zoom/ZoomViewModel".split(" "),function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){m=function(w){function t(B,
q){B=w.call(this,B,q)||this;B.iconClass="esri-icon-zoom-in-magnifying-glass";B.label=void 0;B.messages=null;B.view=null;B.viewModel=new v;return B}a._inheritsLoose(t,w);var x=t.prototype;x.initialize=function(){this._zoomInButton=new h({action:this.zoomIn.bind(this),iconClass:"esri-icon-plus"});this._zoomOutButton=new h({action:this.zoomOut.bind(this),iconClass:"esri-icon-minus"})};x.destroy=function(){this._zoomInButton.destroy();this._zoomOutButton.destroy();this._zoomOutButton=this._zoomInButton=
null};x.render=function(){const B=this.viewModel,q={["esri-zoom--horizontal"]:"horizontal"===this.layout};this._zoomInButton.enabled="ready"===B.state&&B.canZoomIn;this._zoomOutButton.enabled="ready"===B.state&&B.canZoomOut;this._zoomInButton.title=this.messages.zoomIn;this._zoomOutButton.title=this.messages.zoomOut;return e.tsx("div",{class:this.classes("esri-zoom esri-widget",q)},this._zoomInButton.render(),this._zoomOutButton.render())};x.zoomIn=function(){return this.viewModel.zoomIn()};x.zoomOut=
function(){return this.viewModel.zoomOut()};a._createClass(t,[{key:"layout",set:function(B){"horizontal"!==B&&(B="vertical");this._set("layout",B)}}]);return t}(k);b.__decorate([n.property()],m.prototype,"iconClass",void 0);b.__decorate([n.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],m.prototype,"label",void 0);b.__decorate([n.property({value:"vertical"})],m.prototype,"layout",null);b.__decorate([n.property(),d.messageBundle("esri/widgets/Zoom/t9n/Zoom")],m.prototype,"messages",
void 0);b.__decorate([c.aliasOf("viewModel.view")],m.prototype,"view",void 0);b.__decorate([n.property({type:v})],m.prototype,"viewModel",void 0);return m=b.__decorate([g.subclass("esri.widgets.Zoom")],m)})},"esri/widgets/Zoom/IconButton":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../Widget ../support/decorators/accessibleHandler ../support/jsxFactory ../support/widgetUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){m=function(e){function h(){var w=e.apply(this,arguments)||this;w.enabled=!0;w.iconClass="";w.title="";return w}a._inheritsLoose(h,e);var v=h.prototype;v.render=function(){const w=this.enabled?0:-1,t={[this.iconClass]:!!this.iconClass};return f.tsx("div",{bind:this,class:this.classes("esri-widget--button esri-widget",{["esri-disabled"]:!this.enabled,["esri-interactive"]:this.enabled}),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:w,
title:this.title},f.tsx("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",t)}),f.tsx("span",{class:"esri-icon-font-fallback-text"},this.title))};v._triggerAction=function(){this.action.call(this)};return h}(g);b.__decorate([c.property()],m.prototype,"action",void 0);b.__decorate([c.property()],m.prototype,"enabled",void 0);b.__decorate([c.property()],m.prototype,"iconClass",void 0);b.__decorate([c.property()],m.prototype,"title",void 0);b.__decorate([k.accessibleHandler()],
m.prototype,"_triggerAction",null);return m=b.__decorate([n.subclass("esri.widgets.IconButton")],m)})},"esri/widgets/Zoom/ZoomViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./ZoomConditions2D ./ZoomConditions3D".split(" "),function(a,b,c,m,l,r,
n,g,k,f,d){c=function(e){function h(w){w=e.call(this,w)||this;w.canZoomIn=!1;w.canZoomOut=!1;return w}a._inheritsLoose(h,e);var v=h.prototype;v.destroy=function(){this.view=null};v.zoomIn=function(){if(this.canZoomIn){var w=this.view;"2d"===w.type?w.mapViewNavigation.zoomIn():m.ignoreAbortErrors(w.goTo({zoomFactor:2}))}};v.zoomOut=function(){if(this.canZoomOut){var w=this.view;"2d"===w.type?w.mapViewNavigation.zoomOut():m.ignoreAbortErrors(w.goTo({zoomFactor:.5}))}};a._createClass(h,[{key:"state",
get:function(){return this.get("view.ready")?"ready":"disabled"}},{key:"view",set:function(w){w?"2d"===w.type?this._zoomConditions=new f({view:w}):"3d"===w.type&&(this._zoomConditions=new d({view:w})):this._zoomConditions=null;this._set("view",w)}}]);return h}(c);b.__decorate([l.property()],c.prototype,"_zoomConditions",void 0);b.__decorate([l.property({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],c.prototype,"canZoomIn",void 0);b.__decorate([l.property({aliasOf:"_zoomConditions.canZoomOut",
readOnly:!0})],c.prototype,"canZoomOut",void 0);b.__decorate([l.property({readOnly:!0})],c.prototype,"state",null);b.__decorate([l.property()],c.prototype,"view",null);return c=b.__decorate([k.subclass("esri.widgets.Zoom.ZoomViewModel")],c)})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,m,l,r,n,g){c=function(k){function f(){return k.apply(this,arguments)||this}a._inheritsLoose(f,k);a._createClass(f,[{key:"canZoomIn",get:function(){if(!this.get("view.ready"))return!1;const d=this.get("view.animation.target.scale")||this.get("view.scale"),e=this.get("view.constraints.effectiveMaxScale");return 0===e||d>e}},{key:"canZoomOut",get:function(){if(!this.get("view.ready"))return!1;const d=this.get("view.animation.target.scale")||this.get("view.scale"),e=this.get("view.constraints.effectiveMinScale");
return 0===e||d<e}}]);return f}(c);b.__decorate([m.property({readOnly:!0})],c.prototype,"canZoomIn",null);b.__decorate([m.property({readOnly:!0})],c.prototype,"canZoomOut",null);b.__decorate([m.property()],c.prototype,"view",void 0);return c=b.__decorate([g.subclass("esri.widgets.Zoom.ZoomConditions2D")],c)})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,m,l,r,n,g){c=function(k){function f(){return k.apply(this,arguments)||this}a._inheritsLoose(f,k);a._createClass(f,[{key:"canZoomIn",get:function(){return!!this.get("view.ready")}},{key:"canZoomOut",get:function(){return!!this.get("view.ready")}}]);return f}(c);b.__decorate([m.property({readOnly:!0})],c.prototype,"canZoomIn",null);b.__decorate([m.property({readOnly:!0})],c.prototype,"canZoomOut",null);b.__decorate([m.property()],c.prototype,"view",void 0);return c=b.__decorate([g.subclass("esri.widgets.Zoom.ZoomConditions3D")],
c)})},"esri/layers/SceneLayer":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../PopupTemplate ../renderers/ClassBreaksRenderer ../renderers/DictionaryRenderer ../renderers/DotDensityRenderer ../renderers/HeatmapRenderer ../renderers/PieChartRenderer ../renderers/Renderer ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/support/jsonUtils ../renderers/support/types ../request ../core/Collection ../core/Error ../core/Logger ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/reactiveUtils ../core/urlUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/utils ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/PropertyOrigin ./Layer ./mixins/APIKeyMixin ./mixins/ArcGISService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./mixins/SceneService ./support/capabilities ./support/commonProperties ./support/FeatureReduction ./support/FeatureReductionSelection ./support/FetchAssociatedFeatureLayer ./support/fieldProperties ./support/FieldsIndex ./support/fieldUtils ./support/I3SLayerDefinitions ./support/LabelClass ./support/labelingInfo ./support/LayerFloorInfo ./support/RangeInfo ./support/SceneFilter ../renderers/support/styleUtils ../rest/support/Query ../support/popupUtils ../webdoc/support/opacityUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N,M,L,J,H,I,O,Q,S,T,U,aa,W,R,V,da,ca,ha,ia,ka,la,Y,ea,ba,Z){const fa=["3DObject","Point"],ja=B.getLogger("esri.layers.SceneLayer");l=W.defineFieldProperties();u=function(qa){function Ha(...pa){pa=qa.call(this,...pa)||this;pa.featureReduction=null;pa.rangeInfos=null;pa.operationalLayerType="ArcGISSceneServiceLayer";pa.type="scene";pa.fields=null;pa.floorInfo=null;pa.outFields=null;pa.nodePages=null;pa.materialDefinitions=null;pa.textureSetDefinitions=
null;pa.geometryDefinitions=null;pa.serviceUpdateTimeStamp=null;pa.excludeObjectIds=new t;pa.definitionExpression=null;pa.filter=null;pa.path=null;pa.labelsVisible=!0;pa.labelingInfo=null;pa.legendEnabled=!0;pa.priority=null;pa.semantic=null;pa.cachedDrawingInfo={color:!1};pa.popupEnabled=!0;pa.popupTemplate=null;pa.objectIdField=null;pa.globalIdField=null;pa._fieldUsageInfo={};pa.screenSizePerspectiveEnabled=!0;return pa}b._inheritsLoose(Ha,qa);var Ga=Ha.prototype;Ga.normalizeCtorArgs=function(pa,
Da){return"string"===typeof pa?{url:pa,...Da}:pa};Ga.getField=function(pa){return this.fieldsIndex.get(pa)};Ga.getFieldDomain=function(pa,Da){var ra,Ea,Ia,Ma;return(Da=null==(ra=this.getFeatureType(null==Da?void 0:Da.feature))?void 0:null==(Ea=ra.domains)?void 0:Ea[pa])&&"inherited"!==Da.type?Da:null!=(Ia=null==(Ma=this.getField(pa))?void 0:Ma.domain)?Ia:null};Ga.getFeatureType=function(pa){return pa&&q.isSome(this.associatedLayer)?this.associatedLayer.getFeatureType(pa):null};Ga.readNodePages=function(pa,
Da,ra){"Point"===Da.layerType&&(pa=Da.pointNodePages);return null==pa||"object"!==typeof pa?null:da.I3SNodePageDefinition.fromJSON(pa,ra)};Ga.readCachedDrawingInfo=function(pa){if(null==pa||"object"!==typeof pa)pa={};null==pa.color&&(pa.color=!1);return pa};Ga.readObjectIdField=function(pa,Da){!pa&&Da.fields&&Da.fields.some(ra=>{"esriFieldTypeOID"===ra.type&&(pa=ra.name);return!!pa});return pa||void 0};Ga.readGlobalIdField=function(pa,Da){!pa&&Da.fields&&Da.fields.some(ra=>{"esriFieldTypeGlobalID"===
ra.type&&(pa=ra.name);return!!pa});return pa||void 0};Ga.readProfile=function(pa,Da){pa=Da.store.profile;if(null!=pa&&oa[pa])return oa[pa];ja.error("Unknown or missing profile",{profile:pa,layer:this});return"mesh-pyramids"};Ga.load=function(pa){const Da=q.isSome(pa)?pa.signal:null,ra=this.loadFromPortal({supportedTypes:["Scene Service"]},pa).catch(C.throwIfAbortError).then(()=>this._fetchService(Da)).then(()=>Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,Da),this._setAssociatedFeatureLayer(Da),
q.isSome(this.filter)?this.filter.loadGeometries(this.spatialReference):null])).then(()=>this._validateElevationInfo()).then(()=>this._applyAssociatedLayerOverrides()).then(()=>this._populateFieldUsageInfo()).then(()=>Y.loadStyleRenderer(this,{origin:"service"},Da)).then(()=>V.fixRendererFields(this.renderer,this.fieldsIndex)).then(()=>this.finishLoadEditablePortalLayer(pa));this.addResolvingPromise(ra);return Promise.resolve(this)};Ga.beforeSave=function(){var pa=b._asyncToGenerator(function*(){q.isSome(this.filter)&&
(yield this.load())});return function(){return pa.apply(this,arguments)}}();Ga.createQuery=function(){const pa=new ea;"mesh"!==this.geometryType&&(pa.returnGeometry=!0,pa.returnZ=!0);pa.where=this.definitionExpression||"1\x3d1";pa.sqlFormat="standard";return pa};Ga.queryExtent=function(pa,Da){return this._getAssociatedLayerForQuery().then(ra=>ra.queryExtent(pa||this.createQuery(),Da))};Ga.queryFeatureCount=function(pa,Da){return this._getAssociatedLayerForQuery().then(ra=>ra.queryFeatureCount(pa||
this.createQuery(),Da))};Ga.queryFeatures=function(pa,Da){return this._getAssociatedLayerForQuery().then(ra=>ra.queryFeatures(pa||this.createQuery(),Da)).then(ra=>{if(null!=ra&&ra.features)for(const Ea of ra.features)Ea.layer=this,Ea.sourceLayer=this;return ra})};Ga.queryObjectIds=function(pa,Da){return this._getAssociatedLayerForQuery().then(ra=>ra.queryObjectIds(pa||this.createQuery(),Da))};Ga.queryAttachments=function(pa,Da){return this._getAssociatedLayerForQuery().then(ra=>ra.queryAttachments(pa,
Da))};Ga.getFieldUsageInfo=function(pa){const Da={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[pa]||Da:(ja.error("#getFieldUsageInfo()","Unavailable until layer is loaded"),Da)};Ga.createPopupTemplate=function(pa){return ba.createPopupTemplate(this,pa)};Ga._getAssociatedLayerForQuery=function(){const pa=this.associatedLayer;return q.isSome(pa)&&pa.loaded?Promise.resolve(pa):this._loadAssociatedLayerForQuery()};
Ga._loadAssociatedLayerForQuery=function(){var pa=b._asyncToGenerator(function*(){yield this.load();if(q.isNone(this.associatedLayer))throw new x("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{yield this.associatedLayer.load()}catch(Da){throw new x("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",{layer:this,error:Da});}return this.associatedLayer});return function(){return pa.apply(this,
arguments)}}();Ga.hasCachedStatistics=function(pa){return null!=this.statisticsInfo&&this.statisticsInfo.some(Da=>Da.name===pa)};Ga.queryCachedStatistics=function(){var pa=b._asyncToGenerator(function*(Da,ra){yield this.load(ra);if(!this.statisticsInfo)throw new x("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");const Ea=this.fieldsIndex.get(Da);if(!Ea)throw new x("scenelayer:field-unexisting",`Field '${Da}' does not exist on the layer`);for(const Ia of this.statisticsInfo)if(Ia.name===
Ea.name)return Da=A.join(this.parsedUrl.path,Ia.href),w(Da,{query:{f:"json",token:this.apiKey},responseType:"json",signal:ra?ra.signal:null}).then(Ma=>Ma.data);throw new x("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available");});return function(Da,ra){return pa.apply(this,arguments)}}();Ga.saveAs=function(){var pa=b._asyncToGenerator(function*(Da,ra){return this._debouncedSaveOperations(O.SaveOperationType.SAVE_AS,{...ra,getTypeKeywords:()=>this._getTypeKeywords(),
portalItemLayerType:"scene"},Da)});return function(Da,ra){return pa.apply(this,arguments)}}();Ga.save=function(){var pa=b._asyncToGenerator(function*(){return this._debouncedSaveOperations(O.SaveOperationType.SAVE,{getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"})});return function(){return pa.apply(this,arguments)}}();Ga.applyEdits=function(){var pa=b._asyncToGenerator(function*(Da,ra){const Ea=yield new Promise((Ia,Ma)=>a(["./graphics/editingSupport"],Ia,Ma));yield this.load();
if(q.isNone(this.associatedLayer))throw new x(`${this.type}-layer:not-editable`,"Service is not editable");yield this.associatedLayer.load();return Ea.applyEdits(this,this.associatedLayer.source,Da,ra)});return function(Da,ra){return pa.apply(this,arguments)}}();Ga.on=function(pa,Da){return qa.prototype.on.call(this,pa,Da)};Ga.validateLayer=function(pa){if(pa.layerType&&!fa.includes(pa.layerType))throw new x("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:pa.layerType});
if(isNaN(this.version.major)||isNaN(this.version.minor))throw new x("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(2<this.version.major)throw new x("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});{pa=this.normalReferenceFrame;var Da=this.spatialReference;let ra=!1,Ea=!1;if(null==pa)Ea=ra=!0;else switch(Da=Da&&
Da.isGeographic,pa){case "east-north-up":case "earth-centered":ra=!0;Ea=Da;break;case "vertex-reference-frame":ra=!0;Ea=!Da;break;default:ra=!1}if(!ra)throw new x("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!Ea)throw new x("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.");}};Ga._getTypeKeywords=function(){const pa=[];if("points"===this.profile)pa.push("Point");else if("mesh-pyramids"===
this.profile)pa.push("3DObject");else throw new x("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);return pa};Ga._populateFieldUsageInfo=function(){this._fieldUsageInfo={};if(this.fields)for(const pa of this.fields){const Da=!(!this.attributeStorageInfo||!this.attributeStorageInfo.some(Ea=>Ea.name===pa.name)),ra=!!(q.isSome(this.associatedLayer)&&this.associatedLayer.fields&&this.associatedLayer.fields.some(Ea=>Ea&&pa.name===Ea.name));this._fieldUsageInfo[pa.name]=
{supportsLabelingInfo:Da,supportsRenderer:Da,supportsPopupTemplate:Da||ra,supportsLayerQuery:ra}}};Ga._applyAssociatedLayerOverrides=function(){this._applyAssociatedLayerFieldsOverrides();this._applyAssociatedLayerPopupOverrides()};Ga._applyAssociatedLayerFieldsOverrides=function(){if(!q.isNone(this.associatedLayer)&&this.associatedLayer.fields){var pa=null;for(const Da of this.associatedLayer.fields){const ra=this.getField(Da.name);ra?(!ra.domain&&Da.domain&&(ra.domain=Da.domain.clone()),ra.editable=
Da.editable,ra.nullable=Da.nullable,ra.length=Da.length):(pa||(pa=this.fields?this.fields.slice():[]),pa.push(Da.clone()))}pa&&this._set("fields",pa)}};Ga._applyAssociatedLayerPopupOverrides=function(){if(!q.isNone(this.associatedLayer)){var pa=["popupTemplate","popupEnabled"],Da=E.getProperties(this);for(let ra=0;ra<pa.length;ra++){const Ea=pa[ra],Ia=this.originIdOf(Ea),Ma=this.associatedLayer.originIdOf(Ea);Ia<Ma&&(Ma===K.OriginId.SERVICE||Ma===K.OriginId.PORTAL_ITEM)&&Da.setAtOrigin(Ea,this.associatedLayer[Ea],
Ma)}}};Ga._setAssociatedFeatureLayer=function(){var pa=b._asyncToGenerator(function*(Da){if(["mesh-pyramids","points"].includes(this.profile)){Da=new aa.FetchAssociatedFeatureLayer(this.parsedUrl,this.portalItem,this.apiKey,Da);try{this.associatedLayer=yield Da.fetch()}catch(ra){C.isAbortError(ra)||this._logWarningOnPopupEnabled()}}});return function(Da){return pa.apply(this,arguments)}}();Ga._logWarningOnPopupEnabled=function(){var pa=b._asyncToGenerator(function*(){yield z.whenOnce(()=>this.popupEnabled&&
null!=this.popupTemplate);const Da=`this SceneLayer: ${this.title}`;null==this.attributeStorageInfo?ja.warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${Da}`):ja.info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${Da}`)});return function(){return pa.apply(this,arguments)}}();Ga._validateElevationInfo=function(){const pa=this.elevationInfo;pa&&("mesh-pyramids"===this.profile&&"relative-to-scene"===
pa.mode&&ja.warn(".elevationInfo\x3d","Mesh scene layers don't support relative-to-scene elevation mode"),pa.featureExpressionInfo&&"0"!==pa.featureExpressionInfo.expression&&ja.warn(".elevationInfo\x3d","Scene layers do not support featureExpressionInfo"))};b._createClass(Ha,[{key:"types",get:function(){return q.isSome(this.associatedLayer)?this.associatedLayer.types:[]}},{key:"typeIdField",get:function(){return q.isSome(this.associatedLayer)?this.associatedLayer.typeIdField:null}},{key:"formTemplate",
get:function(){return q.isSome(this.associatedLayer)?this.associatedLayer.formTemplate:null}},{key:"fieldsIndex",get:function(){return new R(this.fields)}},{key:"elevationInfo",set:function(pa){this._set("elevationInfo",pa);this.loaded&&this._validateElevationInfo()}},{key:"geometryType",get:function(){return sa[this.profile]||"mesh"}},{key:"renderer",set:function(pa){V.fixRendererFields(pa,this.fieldsIndex);this._set("renderer",pa)}},{key:"capabilities",get:function(){var pa=q.isSome(this.associatedLayer)&&
this.associatedLayer.capabilities?this.associatedLayer.capabilities:Q.zeroCapabilities;const {query:Da,editing:{supportsGlobalId:ra,supportsRollbackOnFailure:Ea,supportsUploadWithItemId:Ia,supportsReturnServiceEditsInSourceSpatialReference:Ma},data:{supportsZ:Qa,supportsM:wa,isVersioned:Ja,supportsAttachment:Ta},operations:{supportsEditing:Xa,supportsUpdate:ma,supportsQuery:$a,supportsQueryAttachments:xa}}=pa;pa=pa.operations.supportsChangeTracking;return{query:Da,editing:{supportsGlobalId:ra,supportsReturnServiceEditsInSourceSpatialReference:Ma,
supportsRollbackOnFailure:Ea,supportsGeometryUpdate:!1,supportsUploadWithItemId:Ia},data:{supportsAttachment:Ta,supportsZ:Qa,supportsM:wa,isVersioned:Ja},operations:{supportsQuery:$a,supportsQueryAttachments:xa,supportsEditing:Xa&&pa,supportsAdd:!1,supportsDelete:!1,supportsUpdate:ma&&pa}}}},{key:"editingEnabled",get:function(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.userHasEditingPrivileges},set:function(pa){null!=pa?this._override("editingEnabled",pa):this._clearOverride("editingEnabled")}},
{key:"defaultPopupTemplate",get:function(){return q.isSome(this.associatedLayer)||this.attributeStorageInfo?this.createPopupTemplate():null}},{key:"displayField",get:function(){return q.isSome(this.associatedLayer)?this.associatedLayer.displayField:null}}]);return Ha}(O.SceneService(L.ArcGISService(J.OperationalLayer(H.PortalLayer(I.ScaleRangeLayer(u.MultiOriginJSONMixin(M.APIKeyMixin(N))))))));c.__decorate([p.property({types:{key:"type",base:T.FeatureReduction,typeMap:{selection:U}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",
write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],u.prototype,"featureReduction",void 0);c.__decorate([p.property({type:[ka.RangeInfo],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],u.prototype,"rangeInfos",void 0);c.__decorate([p.property({json:{read:!1}})],u.prototype,"associatedLayer",void 0);c.__decorate([p.property({type:["show","hide"]})],u.prototype,"listMode",void 0);
c.__decorate([p.property({type:["ArcGISSceneServiceLayer"]})],u.prototype,"operationalLayerType",void 0);c.__decorate([p.property({json:{read:!1},readOnly:!0})],u.prototype,"type",void 0);c.__decorate([p.property({...l.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],u.prototype,"fields",void 0);c.__decorate([p.property()],u.prototype,"types",null);c.__decorate([p.property()],u.prototype,"typeIdField",null);c.__decorate([p.property()],u.prototype,"formTemplate",null);c.__decorate([p.property({readOnly:!0})],
u.prototype,"fieldsIndex",null);c.__decorate([p.property({type:ia,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],u.prototype,"floorInfo",void 0);c.__decorate([p.property(l.outFields)],u.prototype,"outFields",void 0);c.__decorate([p.property({type:da.I3SNodePageDefinition,readOnly:!0,json:{read:!1}})],u.prototype,"nodePages",void 0);c.__decorate([G.reader("service","nodePages",["nodePages","pointNodePages"])],u.prototype,"readNodePages",null);c.__decorate([p.property({type:[da.I3SMaterialDefinition],
readOnly:!0})],u.prototype,"materialDefinitions",void 0);c.__decorate([p.property({type:[da.I3STextureSetDefinition],readOnly:!0})],u.prototype,"textureSetDefinitions",void 0);c.__decorate([p.property({type:[da.I3SGeometryDefinition],readOnly:!0})],u.prototype,"geometryDefinitions",void 0);c.__decorate([p.property({readOnly:!0})],u.prototype,"serviceUpdateTimeStamp",void 0);c.__decorate([p.property({readOnly:!0})],u.prototype,"attributeStorageInfo",void 0);c.__decorate([p.property({readOnly:!0})],
u.prototype,"statisticsInfo",void 0);c.__decorate([p.property({type:t.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],u.prototype,"excludeObjectIds",void 0);c.__decorate([p.property({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],u.prototype,"definitionExpression",void 0);c.__decorate([p.property({type:la,json:{name:"layerDefinition.polygonFilter",
write:!0}})],u.prototype,"filter",void 0);c.__decorate([p.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],u.prototype,"path",void 0);c.__decorate([p.property(S.elevationInfo)],u.prototype,"elevationInfo",null);c.__decorate([p.property({type:String})],u.prototype,"geometryType",null);c.__decorate([p.property(S.labelsVisible)],u.prototype,"labelsVisible",void 0);c.__decorate([p.property({type:[ca],json:{origins:{service:{name:"drawingInfo.labelingInfo",read:{reader:ha.reader},
write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:ha.reader},write:!0}})],u.prototype,"labelingInfo",void 0);c.__decorate([p.property(S.legendEnabled)],u.prototype,"legendEnabled",void 0);c.__decorate([p.property({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(qa,Ha){var Ga,pa;if("number"===
typeof qa&&0<=qa&&1>=qa)return qa;qa=null==(Ga=Ha.layerDefinition)?void 0:null==(pa=Ga.drawingInfo)?void 0:pa.transparency;return void 0!==qa?Z.transparencyToOpacity(qa):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],u.prototype,"opacity",void 0);c.__decorate([p.property({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],u.prototype,"priority",void 0);c.__decorate([p.property({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],u.prototype,
"semantic",void 0);c.__decorate([p.property({types:v.webSceneRendererTypes,json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],u.prototype,"renderer",null);c.__decorate([p.property({json:{read:!1}})],u.prototype,"cachedDrawingInfo",void 0);c.__decorate([G.reader("service","cachedDrawingInfo")],u.prototype,"readCachedDrawingInfo",null);c.__decorate([p.property({readOnly:!0,json:{read:!1}})],u.prototype,"capabilities",null);
c.__decorate([p.property({type:Boolean,json:{read:!1}})],u.prototype,"editingEnabled",null);c.__decorate([p.property(S.popupEnabled)],u.prototype,"popupEnabled",void 0);c.__decorate([p.property({type:m,json:{name:"popupInfo",write:!0}})],u.prototype,"popupTemplate",void 0);c.__decorate([p.property({readOnly:!0,json:{read:!1}})],u.prototype,"defaultPopupTemplate",null);c.__decorate([p.property({type:String,json:{read:!1}})],u.prototype,"objectIdField",void 0);c.__decorate([G.reader("service","objectIdField",
["objectIdField","fields"])],u.prototype,"readObjectIdField",null);c.__decorate([p.property({type:String,json:{read:!1}})],u.prototype,"globalIdField",void 0);c.__decorate([G.reader("service","globalIdField",["globalIdField","fields"])],u.prototype,"readGlobalIdField",null);c.__decorate([p.property({readOnly:!0,type:String,json:{read:!1}})],u.prototype,"displayField",null);c.__decorate([p.property({type:String,json:{read:!1}})],u.prototype,"profile",void 0);c.__decorate([G.reader("service","profile",
["store.profile"])],u.prototype,"readProfile",null);c.__decorate([p.property({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],u.prototype,"normalReferenceFrame",void 0);c.__decorate([p.property(S.screenSizePerspectiveEnabled)],u.prototype,"screenSizePerspectiveEnabled",void 0);u=c.__decorate([P.subclass("esri.layers.SceneLayer")],u);const oa={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points",
"features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},sa={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return u})},"esri/layers/mixins/SceneService":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/Error ../../core/has ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/originUtils ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../support/arcgisLayerUrl ../support/commonProperties ../support/I3SIndexInfo ../../portal/Portal ../../portal/PortalItem ../../webdoc/support/saveUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E){const F=g.getLogger("esri.layers.mixins.SceneService");var G;(function(K){K[K.existingItem=0]="existingItem";K[K.newItem=1]="newItem"})(G||(G={}));const P={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};b.SaveOperationType=void 0;(function(K){K[K.SAVE=0]="SAVE";K[K.SAVE_AS=1]="SAVE_AS"})(b.SaveOperationType||(b.SaveOperationType={}));b.SCENE_SERVICE_ITEM_TYPE=
"Scene Service";b.SceneService=K=>{K=function(N){function M(){var J=N.apply(this,arguments)||this;J.spatialReference=null;J.fullExtent=null;J.heightModelInfo=null;J.minScale=0;J.maxScale=0;J.version={major:Number.NaN,minor:Number.NaN,versionString:""};J.copyright=null;J.sublayerTitleMode="item-title";J.title=null;J.layerId=null;J.indexInfo=null;J._debouncedSaveOperations=f.debounce(function(){var H=c._asyncToGenerator(function*(I,O,Q){switch(I){case b.SaveOperationType.SAVE:return J._save(O);case b.SaveOperationType.SAVE_AS:return J._saveAs(Q,
O)}});return function(I,O,Q){return H.apply(this,arguments)}}());return J}c._inheritsLoose(M,N);var L=M.prototype;L.readSpatialReference=function(J,H){return this._readSpatialReference(H)};L._readSpatialReference=function(J){if(null!=J.spatialReference)return C.fromJSON(J.spatialReference);J=J.store;J=(J=J.indexCRS||J.geographicCRS)&&parseInt(J.substring(J.lastIndexOf("/")+1,J.length),10);return null!=J?new C(J):null};L.readFullExtent=function(J,H,I){if(null!=J&&"object"===typeof J)return H=null==
J.spatialReference?{...J,spatialReference:this._readSpatialReference(H)}:J,q.fromJSON(H,I);I=H.store;H=this._readSpatialReference(H);return null==H||null==I||null==I.extent||!Array.isArray(I.extent)||I.extent.some(O=>-1E38>O)?null:new q({xmin:I.extent[0],ymin:I.extent[1],xmax:I.extent[2],ymax:I.extent[3],spatialReference:H})};L.parseVersionString=function(J){const H={major:Number.NaN,minor:Number.NaN,versionString:J};J=J.split(".");2<=J.length&&(H.major=parseInt(J[0],10),H.minor=parseInt(J[1],10));
return H};L.readVersion=function(J,H){J=H.store;return this.parseVersionString(null!=J.version?J.version.toString():"")};L.readTitlePortalItem=function(J){return"item-title"!==this.sublayerTitleMode?void 0:J};L.readTitleService=function(J,H){J=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return z.titleFromUrlAndName(this.url,H.name);H=H.name;if(!H&&this.url){const I=z.parse(this.url);k.isSome(I)&&(H=I.title)}"item-title-and-service-name"===this.sublayerTitleMode&&
J&&(H=J+" - "+H);return z.cleanTitle(H)};L.writeUrl=function(J,H,I,O){z.writeUrlWithLayerId(this,J,"layers",H,O)};L._fetchIndexAndUpdateExtent=function(){var J=c._asyncToGenerator(function*(H,I){this.indexInfo=p.fetchIndexInfo(this.parsedUrl.path,this.rootNode,H,this.apiKey,F,I);null==this.fullExtent||this.fullExtent.hasZ||this._updateExtent(yield this.indexInfo)});return function(H,I){return J.apply(this,arguments)}}();L._updateExtent=function(J){if("page"===(null==J?void 0:J.type)){var H,I,O=J.rootIndex%
J.pageSize;J=null==(H=J.rootPage)?void 0:null==(I=H.nodes)?void 0:I[O];if(null==J||null==J.obb||null==J.obb.center||null==J.obb.halfSize)throw new r("sceneservice:invalid-node-page","Invalid node page.");-1E38>J.obb.center[0]||null==this.fullExtent||this.fullExtent.hasZ||(H=J.obb.halfSize,I=J.obb.center[2],H=Math.sqrt(H[0]*H[0]+H[1]*H[1]+H[2]*H[2]),this.fullExtent.zmin=I-H,this.fullExtent.zmax=I+H)}else"node"===(null==J?void 0:J.type)&&(I=null==(O=J.rootNode)?void 0:O.mbs,!Array.isArray(I)||4!==I.length||
-1E38>I[0]||(H=I[2],I=I[3],this.fullExtent.zmin=H-I,this.fullExtent.zmax=H+I))};L._fetchService=function(){var J=c._asyncToGenerator(function*(H){if(null==this.url)throw new r("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==this.layerId&&/SceneServer\/*$/i.test(this.url)){const I=yield this._fetchFirstLayerId(H);null!=I&&(this.layerId=I)}return this._fetchServiceLayer(H)});return function(H){return J.apply(this,arguments)}}();L._fetchFirstLayerId=
function(){var J=c._asyncToGenerator(function*(H){H=yield l(this.url,{query:{f:"json",token:this.apiKey},responseType:"json",signal:H});if(H.data&&Array.isArray(H.data.layers)&&0<H.data.layers.length)return H.data.layers[0].id});return function(H){return J.apply(this,arguments)}}();L._fetchServiceLayer=function(){var J=c._asyncToGenerator(function*(H){H=yield l(this.parsedUrl.path,{query:{f:"json",token:this.apiKey},responseType:"json",signal:H});H.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));
let I=!1;H.data.layerType&&"Voxel"===H.data.layerType&&(I=!0);if(I)return this._fetchVoxelServiceLayer();H=H.data;this.read(H,{origin:"service",url:this.parsedUrl});this.validateLayer(H)});return function(H){return J.apply(this,arguments)}}();L._fetchVoxelServiceLayer=function(){var J=c._asyncToGenerator(function*(H){H=(yield l(this.parsedUrl.path+"/layer",{query:{f:"json",token:this.apiKey},responseType:"json",signal:H})).data;this.read(H,{origin:"service",url:this.parsedUrl});this.validateLayer(H)});
return function(H){return J.apply(this,arguments)}}();L._ensureLoadBeforeSave=function(){var J=c._asyncToGenerator(function*(){yield this.load();"beforeSave"in this&&"function"===typeof this.beforeSave&&(yield this.beforeSave())});return function(){return J.apply(this,arguments)}}();L.validateLayer=function(J){};L._updateTypeKeywords=function(J,H,I){J.typeKeywords||(J.typeKeywords=[]);H=H.getTypeKeywords();for(const O of H)J.typeKeywords.push(O);J.typeKeywords&&(J.typeKeywords=J.typeKeywords.filter((O,
Q,S)=>S.indexOf(O)===Q),I===G.newItem&&(J.typeKeywords=J.typeKeywords.filter(O=>"Hosted Service"!==O)))};L._saveAs=function(){var J=c._asyncToGenerator(function*(H,I){I={...P,...I};H=D.from(H);H||(F.error("_saveAs(): requires a portal item parameter"),yield Promise.reject(new r("sceneservice:portal-item-required","_saveAs() requires a portal item to save to")));H.id&&(H=H.clone(),H.id=null);const O=H.portal||y.getDefault();yield this._ensureLoadBeforeSave();H.type="Scene Service";H.portal=O;const Q=
{origin:"portal-item",url:null,messages:[],portal:O,portalItem:H,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},S={layers:[this.write({},Q)]};yield Promise.all(Q.resources.pendingOperations);yield this._validateAgainstJSONSchema(S,Q,I);H.url=this.url;H.title||(H.title=this.title);this._updateTypeKeywords(H,I,G.newItem);yield O._signIn();yield O.user.addItem({item:H,folder:I&&I.folder,data:S});yield E.saveResources(this.resourceReferences,
Q,null);this.portalItem=H;B.updateOrigins(Q);return Q.portalItem=H});return function(H,I){return J.apply(this,arguments)}}();L._save=function(){var J=c._asyncToGenerator(function*(H){H={...P,...H};this.portalItem||(F.error("_save(): requires the .portalItem property to be set"),yield Promise.reject(new r("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService")));"Scene Service"!==this.portalItem.type&&(F.error("_save(): Non-matching portal item type. Got "+
this.portalItem.type+", expected Scene Service"),yield Promise.reject(new r("sceneservice:portal-item-wrong-type",'Portal item needs to have type "Scene Service"')));yield this._ensureLoadBeforeSave();const I={origin:"portal-item",url:this.portalItem.itemUrl&&d.urlToObject(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||y.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},O={layers:[this.write({},
I)]};yield Promise.all(I.resources.pendingOperations);yield this._validateAgainstJSONSchema(O,I,H);this.portalItem.url=this.url;this.portalItem.title||(this.portalItem.title=this.title);this._updateTypeKeywords(this.portalItem,H,G.existingItem);yield this.portalItem.update({data:O});yield E.saveResources(this.resourceReferences,I,null);B.updateOrigins(I);return this.portalItem});return function(H){return J.apply(this,arguments)}}();L._validateAgainstJSONSchema=function(){var J=c._asyncToGenerator(function*(H,
I,O){I=I.messages.filter(Q=>"error"===Q.type).map(Q=>new r(Q.name,Q.message,Q.details));O&&O.validationOptions.ignoreUnsupported&&(I=I.filter(Q=>"layer:unsupported"!==Q.name&&"symbol:unsupported"!==Q.name&&"symbol-layer:unsupported"!==Q.name&&"property:unsupported"!==Q.name&&"url:unsupported"!==Q.name&&"scenemodification:unsupported"!==Q.name));if(O.validationOptions.enabled&&(H=(yield new Promise((Q,S)=>a(["../support/schemaValidator"],Q,S))).validate(H,O.portalItemLayerType),0<H.length)){const Q=
`Layer item did not validate:\n${H.join("\n")}`;F.error(`_validateAgainstJSONSchema(): ${Q}`);if("throw"===O.validationOptions.failPolicy)throw O=H.map(S=>new r("sceneservice:schema-validation",S)).concat(I),new r("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:O});}if(0<I.length)throw new r("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",
{errors:I});});return function(H,I,O){return J.apply(this,arguments)}}();c._createClass(M,[{key:"url",set:function(J){J=z.sanitizeUrlWithLayerId({layer:this,url:J,nonStandardUrlAllowed:!1,logger:F});this._set("url",J.url);null!=J.layerId&&this._set("layerId",J.layerId)}},{key:"parsedUrl",get:function(){var J=this._get("url");if(!J)return null;J=d.urlToObject(J);null!=this.layerId&&(J.path=`${J.path}/layers/${this.layerId}`);return J}}]);return M}(K);m.__decorate([e.property(A.id)],K.prototype,"id",
void 0);m.__decorate([e.property({type:C})],K.prototype,"spatialReference",void 0);m.__decorate([w.reader("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],K.prototype,"readSpatialReference",null);m.__decorate([e.property({type:q})],K.prototype,"fullExtent",void 0);m.__decorate([w.reader("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],K.prototype,"readFullExtent",null);m.__decorate([e.property({readOnly:!0,type:u})],
K.prototype,"heightModelInfo",void 0);m.__decorate([e.property({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},write:!1}}}})],K.prototype,"minScale",void 0);m.__decorate([e.property({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],K.prototype,"maxScale",void 0);m.__decorate([e.property({readOnly:!0})],K.prototype,"version",void 0);m.__decorate([w.reader("version",["store.version"])],
K.prototype,"readVersion",null);m.__decorate([e.property({type:String,json:{read:{source:"copyrightText"}}})],K.prototype,"copyright",void 0);m.__decorate([e.property({type:String,json:{read:!1}})],K.prototype,"sublayerTitleMode",void 0);m.__decorate([e.property({type:String})],K.prototype,"title",void 0);m.__decorate([w.reader("portal-item","title")],K.prototype,"readTitlePortalItem",null);m.__decorate([w.reader("service","title",["name"])],K.prototype,"readTitleService",null);m.__decorate([e.property({type:Number,
json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],K.prototype,"layerId",void 0);m.__decorate([e.property(A.url)],K.prototype,"url",null);m.__decorate([x.writer("url")],K.prototype,"writeUrl",null);m.__decorate([e.property()],K.prototype,"parsedUrl",null);m.__decorate([e.property({readOnly:!0})],K.prototype,"store",void 0);m.__decorate([e.property({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],K.prototype,"rootNode",
void 0);return K=m.__decorate([t.subclass("esri.layers.mixins.SceneService")],K)};Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/accessorSupport/originUtils":function(){define(["exports","../multiOriginJSONSupportUtils"],function(a,b){a.updateOrigins=function(c){c&&c.writtenProperties&&c.writtenProperties.forEach(({target:m,propName:l,newOrigin:r})=>{b.isMultiOriginJSONMixin(m)&&r&&m.originOf(l)!==r&&m.updateOrigin(l,r)})};Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/multiOriginJSONSupportUtils":function(){define(["exports"],function(a){a.isMultiOriginJSONMixin=function(b){return b&&"getAtOrigin"in b&&"originOf"in b};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/I3SIndexInfo":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../request","../../core/Error","../../core/maybe"],function(a,b,c,m,l){function r(){r=
b._asyncToGenerator(function*(n,g,k,f,d,e){var h=null;if(l.isSome(k)){h=`${n}/nodepages/`;const v=h+Math.floor(k.rootIndex/k.nodesPerPage);try{return{type:"page",rootPage:(yield c(v,{query:{f:"json",token:f},responseType:"json",signal:e})).data,rootIndex:k.rootIndex,pageSize:k.nodesPerPage,lodMetric:k.lodSelectionMetricType,urlPrefix:h}}catch(w){l.isSome(d)&&d.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",v,w),h=w}}if(!g)return null;g=g&&g.split("/").pop();
n=`${n}/nodes/`;g=n+g;try{return{type:"node",rootNode:(yield c(g,{query:{f:"json",token:f},responseType:"json",signal:e})).data,urlPrefix:n}}catch(v){throw new m("sceneservice:root-node-missing","Root node missing.",{pageError:h,nodeError:v,url:g});}});return r.apply(this,arguments)}a.fetchIndexInfo=function(n,g,k,f,d,e){return r.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/webdoc/support/saveUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/asyncUtils ../../core/Error ../../core/promiseUtils ../../core/uuid ../../portal/support/resourceUtils".split(" "),
function(a,b,c,m,l,r,n){function g(){g=b._asyncToGenerator(function*(h,v,w){if(v&&v.resources){var t=v.portalItem===h.portalItem?new Set(h.paths):new Set;h.paths.length=0;h.portalItem=v.portalItem;var x=new Set(v.resources.toKeep.map(u=>u.resource.path)),B=new Set,q=[];x.forEach(u=>{t.delete(u);h.paths.push(u)});for(const u of v.resources.toUpdate)if(t.delete(u.resource.path),x.has(u.resource.path)||B.has(u.resource.path)){const {resource:C,content:z,finish:A,error:p}=u,y=n.getSiblingOfSameTypeI(C,
r.generateUUID());h.paths.push(y.path);q.push(k({resource:y,content:z,finish:A,error:p},w))}else h.paths.push(u.resource.path),q.push(d(u,w)),B.add(u.resource.path);for(const u of v.resources.toAdd)q.push(k(u,w)),h.paths.push(u.resource.path);t.forEach(u=>{u=v.portalItem.resourceFromPath(u);q.push(u.portalItem.removeResource(u).catch(()=>{}))});if(0!==q.length&&(x=yield l.eachAlways(q),l.throwIfAborted(w),w=x.filter(u=>"error"in u).map(u=>u.error),0<w.length))throw new m("save:resources","Failed to save one or more resources",
{errors:w});}});return g.apply(this,arguments)}function k(h,v){return f.apply(this,arguments)}function f(){f=b._asyncToGenerator(function*(h,v){v=yield c.result(h.resource.portalItem.addResource(h.resource,h.content,v));if(!0===v.ok)h.finish&&h.finish(h.resource);else throw h.error&&h.error(v.error),v.error;});return f.apply(this,arguments)}function d(h,v){return e.apply(this,arguments)}function e(){e=b._asyncToGenerator(function*(h,v){v=yield c.result(h.resource.update(h.content,v));if(!0===v.ok)h.finish(h.resource);
else throw h.error(v.error),v.error;});return e.apply(this,arguments)}a.saveResources=function(h,v,w){return g.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/portal/support/resourceUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../core/Error ../../core/maybe ../../core/urlUtils".split(" "),function(a,b,c,m,l,r){function n(){n=b._asyncToGenerator(function*(w,t={},x){yield w.load(x);
var B=r.join(w.itemUrl,"resources");const {start:q=1,num:u=10,sortOrder:C="asc",sortField:z="created"}=t;t={query:{start:q,num:u,sortOrder:C,sortField:z,token:w.apiKey},signal:l.get(x,"signal")};B=yield w.portal._request(B,t);return{total:B.total,nextStart:B.nextStart,resources:B.resources.map(({created:A,size:p,resource:y})=>({created:new Date(A),size:p,resource:w.resourceFromPath(y)}))}});return n.apply(this,arguments)}function g(){g=b._asyncToGenerator(function*(w,t,x,B){if(!w.hasPath())throw new m(`portal-item-resource-${t}:invalid-path`,
"Resource does not have a valid path");const q=w.portalItem;yield q.load(B);t=r.join(q.userItemUrl,"add"===t?"addResources":"updateResources");const [u,C]=d(w.path);x=yield h(x);const z=new FormData;u&&"."!==u&&z.append("resourcesPrefix",u);z.append("fileName",C);z.append("file",x,C);z.append("f","json");l.isSome(B)&&B.access&&z.append("access",B.access);yield q.portal._request(t,{method:"post",body:z,signal:l.get(B,"signal")});return w});return g.apply(this,arguments)}function k(){k=b._asyncToGenerator(function*(w,
t,x){if(!t.hasPath())throw new m("portal-item-resources-remove:invalid-path","Resource does not have a valid path");yield w.load(x);const B=r.join(w.userItemUrl,"removeResources");yield w.portal._request(B,{method:"post",query:{resource:t.path},signal:l.get(x,"signal")});t.portalItem=null});return k.apply(this,arguments)}function f(){f=b._asyncToGenerator(function*(w,t){yield w.load(t);const x=r.join(w.userItemUrl,"removeResources");return w.portal._request(x,{method:"post",query:{deleteAll:!0},signal:l.get(t,
"signal")})});return f.apply(this,arguments)}function d(w){const t=w.lastIndexOf("/");return-1===t?[".",w]:[w.slice(0,t),w.slice(t+1)]}function e(w){{const u=r.getPathExtension(w);w=l.isNone(u)?[w,""]:[w.slice(0,w.length-u.length-1),`.${u}`]}const [t,x]=w,[B,q]=d(t);return[B,q,x]}function h(w){return v.apply(this,arguments)}function v(){v=b._asyncToGenerator(function*(w){return w instanceof Blob?w:(yield c(w.url,{responseType:"blob"})).data});return v.apply(this,arguments)}a.addOrUpdateResource=function(w,
t,x,B){return g.apply(this,arguments)};a.contentToBlob=h;a.fetchResources=function(w){return n.apply(this,arguments)};a.getSiblingOfSameType=function(w,t){if(!w.hasPath())return null;const [x,,B]=e(w.path);return w.portalItem.resourceFromPath(r.join(x,t+B))};a.getSiblingOfSameTypeI=function(w,t){if(!w.hasPath())return null;const [x,,B]=e(w.path);return w.portalItem.resourceFromPath(r.join(x,t+B))};a.removeAllResources=function(w,t){return f.apply(this,arguments)};a.removeResource=function(w,t,x){return k.apply(this,
arguments)};a.splitPrefixFileNameAndExtension=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/capabilities":function(){define(["exports"],function(a){a.zeroCapabilities={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1,supportsCacheHint:!1,supportsResize:!1},data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,
supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,
supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsDisjointSpatialRelationship:!1,
supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsSpatialAggregationStatistics:!1,
supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/FetchAssociatedFeatureLayer":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../kernel ../../request ../../core/maybe ../../core/promiseUtils ../FeatureLayer ../../portal/Portal ../../portal/PortalItem".split(" "),function(a,b,c,m,l,r,n,g,k){let f=
function(){function d(h,v,w,t){this.parsedUrl=h;this.portalItem=v;this.apiKey=w;this.signal=t;this.rootDocument=null;if(h=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i))this.urlParts={root:h[1],layerId:parseInt(h[2],10)}}var e=d.prototype;e.fetch=function(){var h=b._asyncToGenerator(function*(){var v;if(!this.urlParts)return null;const w=null!=(v=this.portalItem)?v:yield this._portalItemFromServiceItemId();if(l.isNone(w))return this._loadFromUrl();v=yield this._findAndLoadRelatedPortalItem(w);
return l.isNone(v)?null:this._loadFeatureLayerFromPortalItem(v)});return function(){return h.apply(this,arguments)}}();e.fetchPortalItem=function(){var h=b._asyncToGenerator(function*(){var v;if(!this.urlParts)return null;const w=null!=(v=this.portalItem)?v:yield this._portalItemFromServiceItemId();return l.isNone(w)?null:this._findAndLoadRelatedPortalItem(w)});return function(){return h.apply(this,arguments)}}();e._fetchRootDocument=function(){var h=b._asyncToGenerator(function*(){if(l.isSome(this.rootDocument))return this.rootDocument;
if(l.isNone(this.urlParts))return this.rootDocument={},{};const v={query:{f:"json",token:this.apiKey},responseType:"json",signal:this.signal},w=`${this.urlParts.root}/SceneServer`;try{this.rootDocument=(yield m(w,v)).data}catch{this.rootDocument={}}return this.rootDocument});return function(){return h.apply(this,arguments)}}();e._fetchServiceOwningPortalUrl=function(){var h=b._asyncToGenerator(function*(){var v;const w=null==(v=c.id)?void 0:v.findServerInfo(this.parsedUrl.path);if(null!=w&&w.owningSystemUrl)return w.owningSystemUrl;
v=this.parsedUrl.path.replace(/(.*\/rest)\/.*/i,"$1")+"/info";try{const t=(yield m(v,{query:{f:"json"},responseType:"json",signal:this.signal})).data.owningSystemUrl;if(t)return t}catch(t){r.throwIfAbortError(t)}return null});return function(){return h.apply(this,arguments)}}();e._findAndLoadRelatedPortalItem=function(){var h=b._asyncToGenerator(function*(v){try{return(yield v.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:this.signal})).find(w=>"Feature Service"===
w.type)||null}catch(w){return r.throwIfAbortError(w),null}});return function(v){return h.apply(this,arguments)}}();e._loadFeatureLayerFromPortalItem=function(){var h=b._asyncToGenerator(function*(v){yield v.load({signal:this.signal});const w=yield this._findMatchingAssociatedSublayerUrl(v.url);return(new n({url:w,portalItem:v})).load({signal:this.signal})});return function(v){return h.apply(this,arguments)}}();e._loadFromUrl=function(){var h=b._asyncToGenerator(function*(){const v=yield this._findMatchingAssociatedSublayerUrl(`${this.urlParts.root}/FeatureServer`);
return(new n({url:v})).load({signal:this.signal})});return function(){return h.apply(this,arguments)}}();e._findMatchingAssociatedSublayerUrl=function(){var h=b._asyncToGenerator(function*(v){v=v.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1");var w={query:{f:"json"},responseType:"json",authMode:"no-prompt",signal:this.signal};const t=this.urlParts.layerId;var x=this._fetchRootDocument();w=m(v,w);const [B,q]=yield Promise.all([w,x]);x=q&&q.layers;w=B.data&&B.data.layers;if(!Array.isArray(w))throw Error("expected layers array");
if(!Array.isArray(x)){if(t<w.length)return`${v}/${w[t].id}`}else for(let u=0;u<Math.min(x.length,w.length);u++)if(x[u].id===t)return`${v}/${w[u].id}`;throw Error("could not find matching associated sublayer");});return function(v){return h.apply(this,arguments)}}();e._portalItemFromServiceItemId=function(){var h=b._asyncToGenerator(function*(){var v=(yield this._fetchRootDocument()).serviceItemId;if(!v)return null;v=new k({id:v,apiKey:this.apiKey});const w=yield this._fetchServiceOwningPortalUrl();
l.isSome(w)&&(v.portal=new g({url:w}));try{return v.load({signal:this.signal})}catch(t){return r.throwIfAbortError(t),null}});return function(){return h.apply(this,arguments)}}();return d}();a.FetchAssociatedFeatureLayer=f;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/I3SLayerDefinitions":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,m,l,r,n,g,k,f){a.I3SNodePageDefinition=function(d){function e(){var h=d.apply(this,arguments)||this;h.nodesPerPage=null;h.rootIndex=0;h.lodSelectionMetricType=null;return h}b._inheritsLoose(e,d);return e}(m.JSONSupport);c.__decorate([l.property({type:Number})],a.I3SNodePageDefinition.prototype,"nodesPerPage",void 0);c.__decorate([l.property({type:Number})],a.I3SNodePageDefinition.prototype,"rootIndex",void 0);c.__decorate([l.property({type:String})],a.I3SNodePageDefinition.prototype,
"lodSelectionMetricType",void 0);a.I3SNodePageDefinition=c.__decorate([f.subclass("esri.layer.support.I3SNodePageDefinition")],a.I3SNodePageDefinition);a.I3SMaterialTexture=function(d){function e(){var h=d.apply(this,arguments)||this;h.factor=1;return h}b._inheritsLoose(e,d);return e}(m.JSONSupport);c.__decorate([l.property({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],a.I3SMaterialTexture.prototype,"id",void 0);c.__decorate([l.property({type:Number})],a.I3SMaterialTexture.prototype,
"factor",void 0);a.I3SMaterialTexture=c.__decorate([f.subclass("esri.layer.support.I3SMaterialTexture")],a.I3SMaterialTexture);a.I3SMaterialPBRMetallicRoughness=function(d){function e(){var h=d.apply(this,arguments)||this;h.baseColorFactor=[1,1,1,1];h.baseColorTexture=null;h.metallicRoughnessTexture=null;h.metallicFactor=1;h.roughnessFactor=1;return h}b._inheritsLoose(e,d);return e}(m.JSONSupport);c.__decorate([l.property({type:[Number]})],a.I3SMaterialPBRMetallicRoughness.prototype,"baseColorFactor",
void 0);c.__decorate([l.property({type:a.I3SMaterialTexture})],a.I3SMaterialPBRMetallicRoughness.prototype,"baseColorTexture",void 0);c.__decorate([l.property({type:a.I3SMaterialTexture})],a.I3SMaterialPBRMetallicRoughness.prototype,"metallicRoughnessTexture",void 0);c.__decorate([l.property({type:Number})],a.I3SMaterialPBRMetallicRoughness.prototype,"metallicFactor",void 0);c.__decorate([l.property({type:Number})],a.I3SMaterialPBRMetallicRoughness.prototype,"roughnessFactor",void 0);a.I3SMaterialPBRMetallicRoughness=
c.__decorate([f.subclass("esri.layer.support.I3SMaterialPBRMetallicRoughness")],a.I3SMaterialPBRMetallicRoughness);a.I3SMaterialDefinition=function(d){function e(){var h=d.apply(this,arguments)||this;h.alphaMode="opaque";h.alphaCutoff=.25;h.doubleSided=!1;h.cullFace="none";h.normalTexture=null;h.occlusionTexture=null;h.emissiveTexture=null;h.emissiveFactor=null;h.pbrMetallicRoughness=null;return h}b._inheritsLoose(e,d);return e}(m.JSONSupport);c.__decorate([k.enumeration({opaque:"opaque",mask:"mask",
blend:"blend"})],a.I3SMaterialDefinition.prototype,"alphaMode",void 0);c.__decorate([l.property({type:Number})],a.I3SMaterialDefinition.prototype,"alphaCutoff",void 0);c.__decorate([l.property({type:Boolean})],a.I3SMaterialDefinition.prototype,"doubleSided",void 0);c.__decorate([k.enumeration({none:"none",back:"back",front:"front"})],a.I3SMaterialDefinition.prototype,"cullFace",void 0);c.__decorate([l.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"normalTexture",void 0);
c.__decorate([l.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"occlusionTexture",void 0);c.__decorate([l.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"emissiveTexture",void 0);c.__decorate([l.property({type:[Number]})],a.I3SMaterialDefinition.prototype,"emissiveFactor",void 0);c.__decorate([l.property({type:a.I3SMaterialPBRMetallicRoughness})],a.I3SMaterialDefinition.prototype,"pbrMetallicRoughness",void 0);a.I3SMaterialDefinition=c.__decorate([f.subclass("esri.layer.support.I3SMaterialDefinition")],
a.I3SMaterialDefinition);a.I3STextureFormat=function(d){function e(){return d.apply(this,arguments)||this}b._inheritsLoose(e,d);return e}(m.JSONSupport);c.__decorate([l.property({type:String,json:{read:{source:["name","index"],reader:(d,e)=>null!=d?d:`${e.index}`}}})],a.I3STextureFormat.prototype,"name",void 0);c.__decorate([k.enumeration({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],a.I3STextureFormat.prototype,"format",void 0);a.I3STextureFormat=c.__decorate([f.subclass("esri.layer.support.I3STextureFormat")],
a.I3STextureFormat);a.I3STextureSetDefinition=function(d){function e(){var h=d.apply(this,arguments)||this;h.atlas=!1;return h}b._inheritsLoose(e,d);return e}(m.JSONSupport);c.__decorate([l.property({type:[a.I3STextureFormat]})],a.I3STextureSetDefinition.prototype,"formats",void 0);c.__decorate([l.property({type:Boolean})],a.I3STextureSetDefinition.prototype,"atlas",void 0);a.I3STextureSetDefinition=c.__decorate([f.subclass("esri.layer.support.I3STextureSetDefinition")],a.I3STextureSetDefinition);
a.I3SGeometryAttribute=function(d){function e(){return d.apply(this,arguments)||this}b._inheritsLoose(e,d);return e}(m.JSONSupport);c.__decorate([k.enumeration({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],a.I3SGeometryAttribute.prototype,"type",void 0);c.__decorate([l.property({type:Number})],a.I3SGeometryAttribute.prototype,"component",void 0);a.I3SGeometryAttribute=c.__decorate([f.subclass("esri.layer.support.I3SGeometryAttribute")],a.I3SGeometryAttribute);
a.I3SGeometryCompressedAttributes=function(d){function e(){return d.apply(this,arguments)||this}b._inheritsLoose(e,d);return e}(m.JSONSupport);c.__decorate([k.enumeration({draco:"draco"})],a.I3SGeometryCompressedAttributes.prototype,"encoding",void 0);c.__decorate([l.property({type:[String]})],a.I3SGeometryCompressedAttributes.prototype,"attributes",void 0);a.I3SGeometryCompressedAttributes=c.__decorate([f.subclass("esri.layer.support.I3SGeometryCompressedAttributes")],a.I3SGeometryCompressedAttributes);
a.I3SGeometryBuffer=function(d){function e(){var h=d.apply(this,arguments)||this;h.offset=0;return h}b._inheritsLoose(e,d);return e}(m.JSONSupport);c.__decorate([l.property({type:Number})],a.I3SGeometryBuffer.prototype,"offset",void 0);c.__decorate([l.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"position",void 0);c.__decorate([l.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"normal",void 0);c.__decorate([l.property({type:a.I3SGeometryAttribute})],
a.I3SGeometryBuffer.prototype,"uv0",void 0);c.__decorate([l.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"color",void 0);c.__decorate([l.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"uvRegion",void 0);c.__decorate([l.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"featureId",void 0);c.__decorate([l.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"faceRange",void 0);c.__decorate([l.property({type:a.I3SGeometryCompressedAttributes})],
a.I3SGeometryBuffer.prototype,"compressedAttributes",void 0);a.I3SGeometryBuffer=c.__decorate([f.subclass("esri.layer.support.I3SGeometryBuffer")],a.I3SGeometryBuffer);a.I3SGeometryDefinition=function(d){function e(){return d.apply(this,arguments)||this}b._inheritsLoose(e,d);return e}(m.JSONSupport);c.__decorate([k.enumeration({triangle:"triangle"})],a.I3SGeometryDefinition.prototype,"topology",void 0);c.__decorate([l.property()],a.I3SGeometryDefinition.prototype,"geometryBuffers",void 0);a.I3SGeometryDefinition=
c.__decorate([f.subclass("esri.layer.support.I3SGeometryDefinition")],a.I3SGeometryDefinition);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/RangeInfo":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,m,l,r,n,g,k){a.RangeInfo=function(f){function d(){var e=f.apply(this,arguments)||this;e.name=null;e.field=null;e.currentRangeExtent=null;e.fullRangeExtent=null;e.type="rangeInfo";return e}b._inheritsLoose(d,f);return d}(m.JSONSupport);c.__decorate([l.property({type:String,json:{read:!0,write:!0}})],a.RangeInfo.prototype,"name",void 0);c.__decorate([l.property({type:String,json:{read:!0,write:!0}})],a.RangeInfo.prototype,"field",void 0);c.__decorate([l.property({type:[Number],json:{read:!0,
write:!0}})],a.RangeInfo.prototype,"currentRangeExtent",void 0);c.__decorate([l.property({type:[Number],json:{read:!0,write:!0}})],a.RangeInfo.prototype,"fullRangeExtent",void 0);c.__decorate([l.property({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],a.RangeInfo.prototype,"type",void 0);a.RangeInfo=c.__decorate([k.subclass("esri.layers.support.RangeInfo")],a.RangeInfo);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/SceneFilter":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/Handles ../../core/JSONSupport ../../core/lang ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/persistable ./PolygonCollection ../../chunks/persistableUrlUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w){var t;l=t=function(x){function B(u){u=x.call(this,u)||this;u.spatialRelationship="disjoint";u.geometries=new v;u._geometriesSource=null;u._handles=new m;return u}a._inheritsLoose(B,x);var q=B.prototype;q.initialize=function(){this._handles.add(g.on(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,g.sync))};q.destroy=function(){this._handles.destroy()};q.readGeometries=function(u,C,z){this._geometriesSource={url:w.fromJSON(u,z),context:z}};
q.loadGeometries=function(){var u=a._asyncToGenerator(function*(C,z){if(!n.isNone(this._geometriesSource)){var {url:A,context:p}=this._geometriesSource;z=yield c(A,{responseType:"json",signal:n.get(z,"signal")});var y=C.toJSON();C=z.data.map(D=>({...D,spatialReference:y}));this.geometries=v.fromJSON(C,p);this._geometriesSource=null}});return function(C,z){return u.apply(this,arguments)}}();q.clone=function(){return new t({geometries:r.clone(this.geometries),spatialRelationship:this.spatialRelationship})};
return B}(l.JSONSupport);b.__decorate([k.property({type:["disjoint","contains"],nonNullable:!0,json:{write:!0}})],l.prototype,"spatialRelationship",void 0);b.__decorate([k.property({type:v,nonNullable:!0,json:{write:!0}}),h.persistable({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries"})],l.prototype,"geometries",void 0);b.__decorate([d.reader(["web-scene","portal-item"],"geometries")],l.prototype,"readGeometries",null);return l=t=b.__decorate([e.subclass("esri.layers.support.SceneFilter")],
l)})},"esri/core/accessorSupport/decorators/persistable":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../maybe ../../multiOriginJSONSupportUtils ../../urlUtils ../../uuid ../metadata ../PropertyOrigin ./property ../../../portal/support/resourceExtension ../../../chunks/persistableUrlUtils".split(" "),function(a,b,c,m,l,r,n,g,k,f,d,e){function h(q,u,C){const z=g.getOwnPropertyMetadata(u,C);return{type:String,read:(A,p,y)=>{A=e.read(A,p,y);if(z.type===String)return A;
if("function"===typeof z.type)return new z.type({url:A})},write:{writer(A,p,y,D){if(D&&D.resources){var E=m.isNone(A)?null:"string"===typeof A?A:A.url;E=E?e.toJSON(E,{...D,verifyItemRelativeUrls:D&&D.verifyItemRelativeUrls?{writtenUrls:D.verifyItemRelativeUrls.writtenUrls,rootPath:null}:null},e.MarkKeep.NO):null;var F=z.type!==String&&(!l.isMultiOriginJSONMixin(this)||D&&D.origin&&this.originIdOf(C)>k.nameToId(D.origin));if(D&&D.portalItem&&m.isSome(E)&&!r.isAbsolute(E))if(F){{F=D.portalItem.resourceFromPath(E);
const G=t(A,E,D),P=d.getResourceContentExtension(G),K=r.getPathExtension(F.path);P!==K?v(this,C,A,E,p,y,D,q):(w(this,C,F,G,D.resources.toUpdate),p[y]=E)}}else D.resources.toKeep.push({resource:D.portalItem.resourceFromPath(E)}),p[y]=E;else D&&D.portalItem&&(m.isNone(E)||m.isSome(e.itemIdFromResourceUrl(E))||r.isBlobProtocol(E)||F)?v(this,C,A,E,p,y,D,q):p[y]=E}else p[y]="string"===typeof A?e.toJSON(A,D):A.write({},D)}}}}function v(q,u,C,z,A,p,y,D){const E=n.generateUUID();C=t(C,z,y);const F=r.join(m.get(D,
"prefix"),E);D=`${F}.${d.getResourceContentExtension(C)}`;const G=y.portalItem.resourceFromPath(D);r.isBlobProtocol(z)&&y.resources.pendingOperations.push(x(z).then(P=>{G.path=`${F}.${d.getResourceContentExtension(P)}`;A[p]=G.itemRelativeUrl}).catch(()=>{}));w(q,u,G,C,y.resources.toAdd);A[p]=G.itemRelativeUrl}function w(q,u,C,z,A){A.push({resource:C,content:z,finish:p=>{"string"===typeof q[u]?q[u]=p.url:q[u].url=p.url}})}function t(q,u,C){return"string"===typeof q?{url:u}:new Blob([JSON.stringify(q.toJSON(C))],
{type:"application/json"})}function x(q){return B.apply(this,arguments)}function B(){B=c._asyncToGenerator(function*(q){const u=(yield new Promise((C,z)=>a(["../../../request"],A=>C(Object.freeze(Object.defineProperty({__proto__:null,default:A},Symbol.toStringTag,{value:"Module"}))),z))).default;({data:q}=yield u(q,{responseType:"blob"}));return q});return B.apply(this,arguments)}b.persistable=function(q){const u=m.isSome(q)&&q.origins?q.origins:[void 0];return(C,z)=>{a:if(m.isSome(q)&&"resource"===
q.type)var A=h(q,C,z);else{switch(m.isSome(q)&&q.type?q.type:"other"){case "other":A={read:!0,write:!0};break a;case "url":{const {read:p,write:y}=e.persistableUrlUtils;A={read:p,write:y};break a}}A=void 0}for(const p of u){const y=f.propertyJSONMeta(C,p,z);for(const D in A)y[D]=A[D]}}};Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/portal/support/resourceExtension":function(){define(["exports","../../core/urlUtils"],function(a,b){const c={},m=c["text/plain"],
l={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip"};for(const r in l)c[l[r]]=r;a.getResourceContentExtension=function(r){r instanceof Blob?r=r.type:(r=b.getPathExtension(r.url),r=l[r]||"text/plain");return c[r]||m};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/layers/support/PolygonCollection":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/JSONSupport ../../core/Warning ../../core/Logger ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/has ../../core/accessorSupport/set ../../core/accessorSupport/decorators/subclass ../../geometry/Polygon ../../geometry/projection".split(" "),function(a,b,c,m,l,r,n,g,k,f,d,e,h){var v;c=v=function(w){function t(B){return w.call(this,
B)||this}a._inheritsLoose(t,w);var x=t.prototype;x.clone=function(){return new v(this.items.map(B=>B.clone()))};x.write=function(B,q){return this.toJSON(q)};x.toJSON=function(B){var q;const u=null==B?void 0:null==(q=B.layer)?void 0:q.spatialReference;return u?this.toArray().map(C=>{if(!u.equals(C.spatialReference)){if(!h.canProjectWithoutEngine(C.spatialReference,u))return B&&B.messages&&B.messages.push(new l("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",
{modification:this,spatialReference:B.layer.spatialReference,context:B})),null;const z=new e;h.projectPolygon(C,z,u);C=z}C=C.toJSON(B);delete C.spatialReference;return C}).filter(C=>null!=C):(null!=B&&B.messages&&B.messages.push(new l("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:B.layer.spatialReference,context:B})),this.toArray().map(C=>C.toJSON(B)))};t.fromJSON=function(B,q){const u=new v;B.forEach(C=>u.add(e.fromJSON(C,
q)));return u};return t}(m.JSONSupportMixin(c.ofType(e)));return c=v=b.__decorate([d.subclass("esri.layers.support.PolygonCollection")],c)})},"esri/views/3d/layers/ElevationLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./LayerView3D ./TiledLayerView3D ../../layers/LayerView".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){l=function(e){function h(){var v=e.apply(this,arguments)||this;v.type="elevation-3d";return v}a._inheritsLoose(h,e);h.prototype.initialize=function(){var v,w,t,x;const B=null==(v=this.view)?void 0:null==(w=v.map)?void 0:w.allLayers;v=B&&B.includes(this.layer);var q=(w=null==(q=this.view)?void 0:null==(t=q.map)?void 0:null==(x=t.ground)?void 0:x.layers)&&w.includes(this.layer);v&&!q&&(q=new c("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added to layers in map.ground"),
this.addResolvingPromise(Promise.reject(q)));this._addTilingSchemeMatchPromise()};return h}(f.TiledLayerView3D(k.LayerView3D(d)));b.__decorate([m.property()],l.prototype,"layer",void 0);b.__decorate([m.property({readOnly:!0,aliasOf:"layer.tileInfo"})],l.prototype,"tileInfo",void 0);return l=b.__decorate([g.subclass("esri.views.3d.layers.ElevationLayerView3D")],l)})},"esri/views/3d/layers/LayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/handleUtils ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/heightModelInfoUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e){a.LayerView3D=h=>{h=function(v){function w(){var x=v.apply(this,arguments)||this;x.slicePlaneEnabled=!1;x.supportsHeightUnitConversion=!1;return x}b._inheritsLoose(w,v);var t=w.prototype;t.postscript=function(x){v.prototype.postscript.call(this,x);e.supportsHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())};t._validateHeightModelInfo=function(){var x=b._asyncToGenerator(function*(){const B=new AbortController;var q=B.signal;this.handles.add(m.makeHandle(()=>
B.abort()));yield r.whenOnce(()=>{var u;return null==(u=this.view.defaultsFromMap)?void 0:u.heightModelInfoReady},q);l.throwIfAborted(q);if(q=e.rejectLayerError(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion))throw q;});return function(){return x.apply(this,arguments)}}();t.canResume=function(){const x=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return v.prototype.canResume.call(this)&&(!x||!x.minScale||!x.maxScale||x.minScale>=x.maxScale)};
t.getSuspendInfo=function(){const x=v.prototype.getSuspendInfo.call(this),B=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;B&&B.minScale&&B.maxScale&&B.minScale<B.maxScale&&(x.outsideScaleRange=!0);return x};return w}(h);c.__decorate([n.property()],h.prototype,"view",void 0);c.__decorate([n.property()],h.prototype,"slicePlaneEnabled",void 0);return h=c.__decorate([d.subclass("esri.views.3d.layers.LayerView3D")],h)};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/TiledLayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../support/updatingProperties ../terrain/terrainUtils".split(" "),function(a,
b,c,m,l,r,n,g,k,f,d,e,h){a.TiledLayerView3D=v=>{v=function(w){function t(){return w.apply(this,arguments)||this}b._inheritsLoose(t,w);var x=t.prototype;x.getTileUrl=function(B,q,u){return this.layer.getTileUrl(B,q,u)};x._addTilingSchemeMatchPromise=function(){if(l.isNone(this.fullExtent))return this.addResolvingPromise(Promise.reject(new m("tilingscheme:extent-not-defined","This layer doesn't define a fullExtent.")));var B=this._getTileInfoSupportError(this.tileInfo,this.fullExtent);if(l.isSome(B))return this.addResolvingPromise(Promise.reject(B));
B=r.whenOnce(()=>{var q,u;return null==(q=this.view)?void 0:null==(u=q.basemapTerrain)?void 0:u.tilingSchemeLocked}).then(()=>{const q=this._getTileInfoCompatibilityError(this.tileInfo,this.view.basemapTerrain.tilingScheme);if(q)throw q;});this.addResolvingPromise(B)};x._getTileInfoSupportError=function(B,q){if(B=h.checkIfTileInfoSupportedForView(B,q,this.view.spatialReference,this.view.state.viewingMode)){q={layer:this.layer,error:B};switch(B.name){case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":case "tilingscheme:local-unsupported-spatial-reference":B=
new m("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",q);break;default:B=new m("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",q)}return B}return null};x._getTileInfoCompatibilityError=function(B,q){return q.compatibleWith(B)?null:new m("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")};x.levelRangeFromScaleRange=
function(B,q){const u={minLevel:0,maxLevel:Infinity};var C=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!C)return u;const z=C.levels[0];C=A=>{A=Math.log(z.scale/A)/Math.LN2;return 1E-9>.5-Math.abs(.5-A%1)?Math.round(A):Math.ceil(A)};null!=B&&0<B&&(u.minLevel=Math.max(0,C(B)));null!=q&&0<q&&(u.maxLevel=Math.max(0,C(q)));return u};x.isUpdating=function(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)};b._createClass(t,[{key:"imageFormatIsOpaque",
get:function(){return!1}},{key:"fullExtent",get:function(){return this.layer.fullExtent}},{key:"isOpaque",get:function(){return 1<=this.fullOpacity&&this.imageFormatIsOpaque}},{key:"dataLevelRange",get:function(){const B=this.tileInfo.lods;return this.levelRangeFromScaleRange(B[0].scale,B[B.length-1].scale)}},{key:"displayLevelRange",get:function(){var B=this.tileInfo.lods;B=this.levelRangeFromScaleRange(this.layer.minScale||B[0].scale,this.layer.maxScale||B[B.length-1].scale);this.layer.maxScale&&
B.maxLevel++;return B}}]);return t}(v);c.__decorate([n.property({readOnly:!0})],v.prototype,"imageFormatIsOpaque",null);c.__decorate([n.property({readOnly:!0})],v.prototype,"updating",void 0);c.__decorate([n.property(e.updatingProgress)],v.prototype,"updatingProgress",void 0);c.__decorate([n.property(e.updatingProgressValue)],v.prototype,"updatingProgressValue",void 0);c.__decorate([n.property()],v.prototype,"fullExtent",null);c.__decorate([n.property({readOnly:!0})],v.prototype,"isOpaque",null);
c.__decorate([n.property({readOnly:!0})],v.prototype,"dataLevelRange",null);c.__decorate([n.property({readOnly:!0})],v.prototype,"displayLevelRange",null);c.__decorate([n.property()],v.prototype,"layer",void 0);c.__decorate([n.property()],v.prototype,"tileInfo",void 0);return v=c.__decorate([d.subclass("esri.views.3d.layers.TiledLayerView3D")],v)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/FeatureLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../support/featureFlags ./FeatureLayerViewBase3D".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){l=function(e){function h(){var v=e.apply(this,arguments)||this;v.type="feature-3d";v.direct3DObjectFeatureLayerDisplayEnabled=f.enableDirect3DObjectFeatureLayerDisplay();return v}a._inheritsLoose(h,e);h.prototype.initialize=function(){"capabilities"in this.layer&&this.layer.capabilities.operations.supportsQuery||this.addResolvingPromise(Promise.reject(new c("featurelayerview:query-not-supported","layer view requires a layer with query capability",{layer:this.layer})));
this.layer.infoFor3D&&!this.direct3DObjectFeatureLayerDisplayEnabled&&this.addResolvingPromise(Promise.reject(new c("featurelayerview3d:unsupported-geometry-type",`Unsupported geometry type ${this.layer.geometryType}`)));"mesh"!==this.layer.geometryType||k.canProjectWithoutEngine(this.layer.spatialReference,this.view.spatialReference)||this.addResolvingPromise(Promise.reject(new c("layerview:spatial-reference-incompatible","The spatial references of the feature layer is incompatible with the spatial reference of the view")))};
a._createClass(h,[{key:"featureSpatialReference",get:function(){var v,w;return null==(v=this.view.featureTiles)?void 0:null==(w=v.tilingScheme)?void 0:w.spatialReference}}]);return h}(d);b.__decorate([m.property({constructOnly:!0})],l.prototype,"direct3DObjectFeatureLayerDisplayEnabled",void 0);b.__decorate([m.property()],l.prototype,"layer",void 0);return l=b.__decorate([g.subclass("esri.views.3d.layers.FeatureLayerView3D")],l)})},"esri/views/3d/layers/FeatureLayerViewBase3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ./FeatureLikeLayerView3D ./LayerView3D ./support/FeatureTileFetcher3DLayerViewContext ../support/EventedSet ../support/updatingProperties ../webgl-engine/lib/basicInterfaces ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C){n=function(A){function p(D){D=A.call(this,D)||this;D._controllerTotal=0;D._processorTotal=0;D.suspendResumeExtentMode="data";return D}a._inheritsLoose(p,A);var y=p.prototype;y.initialize=function(){this.updatingHandles.add(()=>this.view.floors,()=>m.isSome(this.processor.filterVisibility)&&this.processor.filterVisibility.filterChanged());this.handles.add(l.watch(()=>this._updatingRequiredFieldsPromise,D=>this.updatingHandles.addPromise(D),l.syncAndInitial))};
y.destroy=function(){this.updatingHandles.removeAll();this.handles.removeAll();this.fetcherContext=m.destroyMaybe(this.fetcherContext)};y.setVisibility=function(D,E){var F;null==(F=this.processor)?void 0:F.setObjectIdVisibility(D,E)};y.createQuery=function(){return A.prototype.createQuery.call(this)};y.queryFeatures=function(D,E){const F=()=>A.prototype.queryFeatures.call(this,D,E);return"mesh"===this.layer.geometryType?this._queryFeaturesMesh(this._ensureQuery(D),F):F()};y.beforeSetController=function(D){D.maximumNumberOfFeatures=
this.maximumNumberOfFeatures};y.createController=function(){this.fetcherContext=new w.FeatureTileFetcher3DLayerViewContext({layerView:this,returnZ:this.hasZ,returnM:this.hasM});const D=new e.FeatureTileController3D({layerView:this,context:this.fetcherContext,graphics:new t.EventedSet,extent:this.clippingExtent});this.updatingHandles.add(()=>D.serviceDataExtent,E=>{this.processor&&(this.processor.dataExtent=E)},l.initial);this.handles.add(l.watch(()=>this.suspended,E=>{E?D.suspend():D.resume()},l.syncAndInitial));
this.updatingHandles.add(()=>{var E;return null==(E=this.processor)?void 0:E.displayFeatureLimit},E=>D.displayFeatureLimit=E,l.initial);this.handles.add(l.when(()=>!this.updating,()=>{this._processorTotal=this._controllerTotal=0}));return D};y.doRefresh=function(){var D=a._asyncToGenerator(function*(E){E&&!this.suspended&&this.controller&&this.controller.refetch();m.isSome(this.processor.filterVisibility)&&(this.processor.filterVisibility.dirty=!0)});return function(E){return D.apply(this,arguments)}}();
y.getUsedMemory=function(){var D,E,F,G;const P=null!=(D=null==(E=this.processor)?void 0:E.usedMemory)?D:0;D=null!=(F=null==(G=this.controller)?void 0:G.memoryForUnusedFeatures)?F:0;return P+D};y.getUnloadedMemory=function(){var D,E,F,G,P;const K=null!=(D=null==(E=this.processor)?void 0:E.unprocessedMemoryEstimate)?D:0;D=null!=(F=(null==(G=this.controller)?NaN:G.expectedFeatureDiff)*(null==(P=this.processor)?NaN:P.usedMemoryPerFeature))?F:0;return K+D};y.ignoresMemoryFactor=function(){var D;return null==
(D=this.controller)?void 0:D.hasMaximumNumberOfFeaturesOverride};y._queryFeaturesMesh=function(){var D=a._asyncToGenerator(function*(E,F){yield this._validateQueryFeaturesMesh(E);F=yield F();if(E&&E.outStatistics||m.isNone(this.graphics3DProcessor))return F;E=this.layer.objectIdField;const G=this.graphics3DProcessor.graphics3DGraphicsByObjectID,P=[];for(const K of F.features)if(K.geometry){const N=G.get(K.attributes[E]);N&&(K.geometry=d.hydrateGeometry(N.graphic.geometry),P.push(K))}else P.push(K);
F.features=P;return F});return function(E,F){return D.apply(this,arguments)}}();y._validateQueryFeaturesMesh=function(){var D=a._asyncToGenerator(function*(E){if(E){var F=P=>{throw new c("feature-layer-view:unsupported-query",`Queries on Mesh feature collection layers do not support '${P}'`);},G=["quantizationParameters","geometryPrecision","maxAllowableOffset"];for(const P of G)null!=E[P]&&F(P);"returnM"in E&&E.returnM&&F("returnM");"returnCentroid"in E&&E.returnCentroid&&F("returnCentroid");m.isSome(E.outSpatialReference)&&
!E.outSpatialReference.equals(this.view.spatialReference)&&F("outSpatialReference")}});return function(E){return D.apply(this,arguments)}}();a._createClass(p,[{key:"maximumNumberOfFeatures",get:function(){var D,E;return null!=(D=null==(E=this.controller)?void 0:E.maximumNumberOfFeatures)?D:this._get("maximumNumberOfFeatures")},set:function(D){this._set("maximumNumberOfFeatures",D);this.controller&&(this.controller.maximumNumberOfFeatures=D)}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return this.controller?
!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded):!1}},{key:"updatingProgressValue",get:function(){var D,E;let F=0;if(null!=(D=this.controller)&&D.updating){D=this.controller.updatingRemaining;var G=Math.max(this.controller.updatingTotal,this._controllerTotal);0<G&&(F=(G-D)/G,this._controllerTotal=G)}D=0;null!=(E=this.processor)&&E.updating&&(E=this.processor.updatingRemaining,G=Math.max(E,this._processorTotal),0<G&&(D=(G-E)/G,this._processorTotal=G));return.5*(F+D)}},{key:"updatePolicy",
get:function(){if(!this.controller)return B.UpdatePolicy.ASYNC;switch(this.controller.mode){case "snapshot":{const D=z[this.layer.geometryType];return null==D||this.controller.serviceDataCount>D?B.UpdatePolicy.ASYNC:B.UpdatePolicy.SYNC}case "tiles":return B.UpdatePolicy.ASYNC}}},{key:"hasZ",get:function(){const D=this.layer,E=D.capabilities&&D.capabilities.data;return E&&E.supportsZ?"returnZ"in D&&null!=D.returnZ?D.returnZ:E.supportsZ:!1}},{key:"hasM",get:function(){const D=this.layer,E=D.capabilities&&
D.capabilities.data;return E&&E.supportsM?"returnM"in D&&null!=D.returnM?D.returnM:!1:!1}},{key:"performanceInfo",get:function(){var D,E,F,G,P;const K=null==(D=this.controller)?void 0:D.displayFeatureLimit;D=m.isSome(K)&&K.averageSymbolComplexity;D=m.isSome(D)?`f:${D.primitivesPerFeature},v:${D.primitivesPerCoordinate}`:"n/a";D={...this._getResourceInfo(),storedFeatures:0,totalVertices:0,partial:this.maximumNumberOfFeaturesExceeded,mode:null!=(E=null==(F=this.controller)?void 0:F.mode)?E:"n/a",symbolComplexity:D,
nodes:null!=(G=null==(P=this.controller)?void 0:P.tileDescriptors.length)?G:0};this.controller&&D.displayedNumberOfFeatures&&(E=this.controller.debug,D.storedFeatures=E.storedFeatures,D.totalVertices=E.totalVertices);return D}},{key:"test",get:function(){var D;return{updatePolicy:this.updatePolicy,controller:this.controller,loadedGraphics:null==(D=this.controller)?void 0:D.graphics}}}]);return p}(C(h.FeatureLikeLayerView3D(q(v.LayerView3D(u)))));b.__decorate([r.property()],n.prototype,"layer",void 0);
b.__decorate([r.property()],n.prototype,"controller",void 0);b.__decorate([r.property()],n.prototype,"_controllerTotal",void 0);b.__decorate([r.property()],n.prototype,"_processorTotal",void 0);b.__decorate([r.property()],n.prototype,"maximumNumberOfFeatures",null);b.__decorate([r.property()],n.prototype,"maximumNumberOfFeaturesExceeded",null);b.__decorate([r.property(x.updatingProgress)],n.prototype,"updatingProgress",void 0);b.__decorate([r.property({readOnly:!0})],n.prototype,"updatingProgressValue",
null);b.__decorate([r.property({readOnly:!0})],n.prototype,"updatePolicy",null);b.__decorate([r.property({readOnly:!0})],n.prototype,"hasZ",null);b.__decorate([r.property({readOnly:!0})],n.prototype,"hasM",null);b.__decorate([r.property()],n.prototype,"suspendResumeExtentMode",void 0);n=b.__decorate([f.subclass("esri.views.3d.layers.FeatureLayerViewBase3D")],n);const z={point:5E3,polygon:500,polyline:1E3};return n})},"esri/layers/graphics/controllers/FeatureTileController3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/asyncUtils ../../../core/Collection ../../../core/has ../../../core/Error ../../../core/Handles ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/Promise ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../core/support/WatchUpdatingTracking ../../support/arcgisLayerUrl ../../../portal/support/geometryServiceUtils ../../../rest/support/StatisticDefinition ../../../views/3d/layers/support/FeatureTileFetcher3D ../../../views/3d/layers/support/FeatureTileFetcher3DDebugger ../../../views/3d/support/debugFlags".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y){function D(F,G){if(!G)return!1;for(const P of G)if(!F.has(P))return!0;return!1}const E=d.getLogger("esri.layers.graphics.controllers.FeatureTileController3D");a.FeatureTileController3D=function(F){function G(K){K=F.call(this,K)||this;K.type="feature-tile-3d";K.watchUpdatingTracking=new q.WatchUpdatingTracking;K.serviceDataExtent=null;K.serviceDataCount=a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT;K.vertexLimitExceeded=!1;K.displayFeatureLimit=
null;K.suspended=!1;K.tileFetcher=null;K.handles=new k;K.fetchDataInfoPromise=null;K.fetchDataInfoAbortController=null;K.lifeCycleAbortController=new AbortController;return K}b._inheritsLoose(G,F);var P=G.prototype;P._approximateExtentSizeAtScale=function(K,N){const M=this.layerView.view,L=N.levels[0];return(L.tileSize[0]/(L.scale/K)+L.tileSize[1]/(L.scale/K))/2*Math.ceil((M.width/N.pixelSize+M.height/N.pixelSize)/2)};P.initialize=function(){this.watchUpdatingTracking.add(()=>this.vertexLimitInfo,
()=>this.watchUpdatingTracking.addPromise(this._updateVertexLimitExceeded(null,this.lifeCycleAbortController.signal)));this.watchUpdatingTracking.add(()=>this.mode,()=>this._modeChanged(),w.initial);this.addResolvingPromise(Promise.resolve().then(()=>this._verifyCapabilities()).then(()=>this.watchUpdatingTracking.addPromise(this._fetchServiceDataInfo())).then(()=>this._initializeTileFetcher()))};P._verifyCapabilities=function(){const K=this.layerView.layer;if(!K.get("capabilities.operations.supportsQuery")&&
"ogc-feature"!==K.type)throw new g("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:K});};P.destroy=function(){this._cancelFetchServiceDataInfo();this.tileFetcher=e.destroyMaybe(this.tileFetcher);this.handles=e.destroyMaybe(this.handles);this.tilesHandle=e.removeMaybe(this.tilesHandle);this.lifeCycleAbortController&&(this.lifeCycleAbortController.abort(),this.lifeCycleAbortController=null);this.watchUpdatingTracking.destroy();
this._set("watchUpdatingTracking",null)};P.suspend=function(){this.suspended||(this.suspended=!0,e.isSome(this.tileFetcher)&&this.tileFetcher.suspend())};P.resume=function(){this.suspended&&(this.suspended=!1,e.isSome(this.tileFetcher)&&this.tileFetcher.resume())};P.restart=function(){const K=()=>{e.isSome(this.tileFetcher)&&this.tileFetcher.restart()};this.watchUpdatingTracking.addPromise(this._fetchServiceDataInfo().then(K,K))};P.refetch=function(){const K=()=>{e.isSome(this.tileFetcher)&&this.tileFetcher.refetch()};
this.watchUpdatingTracking.addPromise(this._fetchServiceDataInfo().then(K,K))};P._initializeTileFetcher=function(){const K=this.layerView.view;if(K){var N=w.whenOnce(()=>{var M;return null==(M=K.featureTiles)?void 0:M.tilingScheme},this.lifeCycleAbortController.signal);this.watchUpdatingTracking.addPromise(N);N.then(()=>{const {layerView:M,tileDescriptors:L}=this,J=M.layer,H=new A.FeatureTileFetcher3D({context:this.context,filterExtent:this.extent,tileDescriptors:L,features:this.graphics});this.tileFetcher=
H;this.suspended?this.tileFetcher.suspend():this.tileFetcher.resume();const I=this.layerView.view.resourceController;I&&this.handles.add(w.watch(()=>I.memoryController.memoryFactor,Q=>H.memoryFactor=Q,w.syncAndInitial));const O="polygon"===this.context.geometryType?"polygonLodFactor":"polyline"===this.context.geometryType?"polylineLodFactor":null;O&&this.handles.add(w.watch(()=>{var Q,S,T;return null==(Q=this.layerView.view)?void 0:null==(S=Q.qualitySettings)?void 0:null==(T=S.graphics3D)?void 0:
T[O]},Q=>H.lodFactor=Q||1,w.initial));"ogc-feature"!==J.type&&this.watchUpdatingTracking.add(()=>J.createQueryVersion,()=>this._dataFilterChanged());this.watchUpdatingTracking.add(()=>M.availableFields,(Q,S)=>this._availableFieldsChanged(S,Q));this.watchUpdatingTracking.add(()=>M.requiredFields,(Q,S)=>this._requiredFieldsChanged(S,Q));this.handles.add([J.on("apply-edits",Q=>this._applyEdits(Q)),w.watch(()=>this.extent,Q=>H.filterExtent=Q,w.sync),w.watch(()=>this.tileDescriptors,Q=>H.tileDescriptors=
Q,w.sync),w.watch(()=>this.maximumNumberOfFeatures,Q=>{H.maximumNumberOfFeatures=Q;H.useTileCount=this.serviceDataCount>Q},w.syncAndInitial),w.watch(()=>this.serviceDataCount,Q=>H.useTileCount=Q>this.maximumNumberOfFeatures,w.syncAndInitial),w.watch(()=>y.FEATURE_TILE_FETCH_SHOW_TILES,Q=>{Q&&H&&!H.debugger?(H.debugger=new p.FeatureTileFetcher3DDebugger(H,K.featureTiles.tilingScheme.toTileInfo(),K),H.debugger.update()):!Q&&this.tileFetcher&&H.debugger&&(H.debugger.destroy(),H.debugger=null)},w.syncAndInitial)]);
this.supportsExceedsLimitQuery||this.watchUpdatingTracking.add(()=>this.maxTotalSnapshotVertices,()=>this.watchUpdatingTracking.addPromise(this._updateVertexLimitExceeded(null,this.lifeCycleAbortController.signal)))}).catch(()=>{})}};P._modeChanged=function(){switch(this.mode){case "tiles":this.tilesHandle||(this.tilesHandle=this.layerView.view.featureTiles.addClient());break;default:E.warn("Unhandled feature layer mode "+this.mode);case "snapshot":e.isSome(this.tilesHandle)&&(this.tilesHandle.remove(),
this.tilesHandle=null)}};P._dataFilterChanged=function(){this._set("maxTotalSnapshotVertices",0);this.notifyChange("maxTotalSnapshotVertices");this.refetch()};P._applyEdits=function(K){e.isNone(this.tileFetcher)||this.tileFetcher.applyEdits(K).then(N=>{N&&(N.deletedFeatures.length||N.updatedFeatures.length||N.addedFeatures.length)&&this.watchUpdatingTracking.addPromise(this._updateServiceDataExtent(this.lifeCycleAbortController.signal))}).catch(N=>{if(!v.isAbortError(N))throw N;})};P._availableFieldsChanged=
function(K,N){e.isSome(this.tileFetcher)&&D(this.tileFetcher.availableFields,N)&&this.refetch()};P._requiredFieldsChanged=function(K,N){e.isSome(this.tileFetcher)&&D(this.tileFetcher.availableFields,N)&&this.restart()};P._createVertexLimitExceededQuery=function(K){const N=this.layerView.layer,M=N.createQuery();M.outStatistics=[new z({statisticType:"exceedslimit",maxVertexCount:K,outStatisticFieldName:"exceedslimit",maxPointCount:1E8,maxRecordCount:1E8})];N.capabilities.query.supportsCacheHint&&(M.cacheHint=
!0);return M};P._createDataInfoQuery=function(){const K=this.layerView.layer,N=K.createQuery();N.outSpatialReference=this.layerView.view.spatialReference;K.capabilities.query.supportsCacheHint&&(N.cacheHint=!0);return N};P._fullExtentIsAccurate=function(){const K=this.layerView.layer;if(K.definitionExpression)return!1;switch(K.type){case "feature":return u.isHostedAgolService(K.url);case "csv":case "geojson":case "ogc-feature":case "wfs":return!0}};P._updateServiceDataExtent=function(){var K=b._asyncToGenerator(function*(N){try{yield this._tryUpdateServiceDataExtent(N)}catch(M){v.isAbortError(M)||
this._set("serviceDataExtent",f.clone(this.layerView.fullExtentInLocalViewSpatialReference))}});return function(N){return K.apply(this,arguments)}}();P._tryUpdateServiceDataExtent=function(){var K=b._asyncToGenerator(function*(N){var M=this.layerView;const L=M.layer,J=L.capabilities.query.supportsExtent,H=f.clone(M.fullExtentInLocalViewSpatialReference),I=L.fullExtent,O=this._fullExtentIsAccurate(),Q=this.serviceDataCount;J&&Q<=a.FeatureTileController3DConstants.MAX_FEATURE_COUNT_FOR_EXTENT&&(!H||
!O)&&"queryExtent"in L?(M=this._createDataInfoQuery(),N=yield L.queryExtent(M,{timeout:a.FeatureTileController3DConstants.QUERY_EXTENT_TIMEOUT,signal:N}),this._set("serviceDataExtent",N.extent)):H?this._set("serviceDataExtent",H):e.isSome(I)?(N=yield C.projectGeometry(I,M.view.spatialReference,"portalItem"in L?L.portalItem:null,N),this._set("serviceDataExtent",N)):this._set("serviceDataExtent",null)});return function(N){return K.apply(this,arguments)}}();P._updateServiceDataCount=function(){var K=
b._asyncToGenerator(function*(N){const M=this.layerView.layer;if("queryFeatureCount"in M)if(N=yield l.result(M.queryFeatureCount(this._createDataInfoQuery(),{timeout:a.FeatureTileController3DConstants.QUERY_STATISTICS_TIMEOUT,signal:N})),!0===N.ok)this._set("serviceDataCount",N.value);else{if(v.isAbortError(N.error))throw N.error;this._set("serviceDataCount",a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT)}else this._set("serviceDataCount",a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT)});
return function(N){return K.apply(this,arguments)}}();P._updateVertexLimitExceeded=function(){var K=b._asyncToGenerator(function*(N,M){var L=this.vertexLimitInfo;if(e.isNone(L))this._set("vertexLimitExceeded",!1);else{var J=1<this.minimumNumberOfVerticesForGeometry;if(0>=L.primitivesPerFeature||J){var {primitivesPerFeature:H,primitivesPerCoordinate:I,maximumTotalNumberOfPrimitives:O}=L;0!==H&&e.isSome(N)&&(yield N);L=this.serviceDataCount;var Q=L!==a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT;
N=Q?Math.ceil((O-L*H)/(I||1)):Math.ceil(O/(I||1));J&&(N=Math.min(N,5E6));if(Q&&this.minimumNumberOfVerticesForGeometry*L>N)this._set("vertexLimitExceeded",!0);else if(this.supportsExceedsLimitQuery)if(M=yield l.result(this.layerView.layer.queryFeatures(this._createVertexLimitExceededQuery(N),{timeout:a.FeatureTileController3DConstants.QUERY_STATISTICS_TIMEOUT,signal:M})),!1===M.ok){if(v.isAbortError(M.error))throw M.error;this._set("vertexLimitExceeded",!1)}else(M=M.value.features[0])&&M.attributes?
this._set("vertexLimitExceeded",!!M.attributes.exceedslimit):this._set("vertexLimitExceeded",!1);else this._set("vertexLimitExceeded",this.maxTotalSnapshotVertices>N)}else this._set("vertexLimitExceeded",!1)}});return function(N,M){return K.apply(this,arguments)}}();P._fetchServiceDataInfo=function(){var K=b._asyncToGenerator(function*(){this._cancelFetchServiceDataInfo();let N=new AbortController;const M=N.signal;var L=this._updateServiceDataCount(M);L=v.eachAlways([L,this._updateVertexLimitExceeded(L,
M)]);const J=L.then(()=>this._updateServiceDataExtent(M)).catch(H=>{v.isAbortError(H)||E.error("#fetchServiceDataInfo()",H)}).then(()=>{J===this.fetchDataInfoPromise&&(this.fetchDataInfoAbortController=this.fetchDataInfoPromise=null);N=null});N&&(this.fetchDataInfoPromise=J);this.fetchDataInfoAbortController=N;return L.then(()=>{},()=>{})});return function(){return K.apply(this,arguments)}}();P._cancelFetchServiceDataInfo=function(){const K=this.fetchDataInfoAbortController;K&&(this.fetchDataInfoPromise=
this.fetchDataInfoAbortController=null,K.abort())};b._createClass(G,[{key:"extent",set:function(K){if(K&&!K.spatialReference.equals(this.layerView.view.spatialReference))E.error("#extent\x3d","extent needs to be in the same spatial reference as the view");else{var N=this._get("extent");N===K||N&&K&&N.equals(K)||(K=K?K.clone():null,this._set("extent",K))}}},{key:"updating",get:function(){return!!(e.isSome(this.tileFetcher)&&this.tileFetcher.updating||null!=this.fetchDataInfoPromise||"tiles"===this.mode&&
this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating||this.watchUpdatingTracking&&this.watchUpdatingTracking.updating)}},{key:"updatingTotal",get:function(){return this.updating&&e.isSome(this.tileFetcher)?this.tileFetcher.updatingTotal:0}},{key:"updatingRemaining",get:function(){return this.updating&&e.isSome(this.tileFetcher)?this.tileFetcher.updatingRemaining:0}},{key:"expectedFeatureDiff",get:function(){return this.updating&&e.isSome(this.tileFetcher)?this.tileFetcher.expectedFeatureDiff:
0}},{key:"memoryForUnusedFeatures",get:function(){return e.isSome(this.tileFetcher)?this.tileFetcher.memoryForUnusedFeatures:0}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!(!e.isSome(this.tileFetcher)||!this.tileFetcher.maximumNumberOfFeaturesExceeded)}},{key:"maximumNumberOfFeatures",get:function(){return e.isSome(this.displayFeatureLimit)?this.displayFeatureLimit.maximumNumberOfFeatures:0},set:function(K){K!==this.maximumNumberOfFeatures&&(null==K?this._clearOverride("maximumNumberOfFeatures"):
this._override("maximumNumberOfFeatures",K))}},{key:"hasMaximumNumberOfFeaturesOverride",get:function(){return this._isOverridden("maximumNumberOfFeatures")}},{key:"mode",get:function(){var K,N,M=this.layerView.layer;if("feature"===M.type&&e.isSome(M.infoFor3D))return"snapshot";if(!1===(null==(K=this.layerView.view.qualitySettings)?void 0:null==(N=K.graphics3D)?void 0:N.snapshotAvailable)||this.serviceDataCount===a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT||this.vertexLimitExceeded)return"tiles";
K=(K=(K=this.layerView.view)&&K.featureTiles)&&K.tilingScheme;return M&&M.minScale&&this.serviceDataExtent&&K&&(M=this._approximateExtentSizeAtScale(M.minScale,K),(this.serviceDataExtent.width/M+this.serviceDataExtent.height/M)/2>a.FeatureTileController3DConstants.MAX_SNAPSHOT_MIN_SCALE_FACTOR)?"tiles":!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"}},{key:"maxTotalSnapshotVertices",get:function(){const K=this._get("maxTotalSnapshotVertices")||
0,N="snapshot"===this.mode&&e.isSome(this.tileFetcher)&&this.tileFetcher.totalVertices||0;return Math.max(K,N)}},{key:"tileDescriptors",get:function(){return"snapshot"===this.mode?new r([{id:"dummy-tile-full-extent",lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:new r}},{key:"test",get:function(){return{fetchDataInfoPromise:this.fetchDataInfoPromise,tileFetcher:this.tileFetcher}}},{key:"vertexLimitInfo",get:function(){if(e.isNone(this.displayFeatureLimit)||
e.isNone(this.displayFeatureLimit.averageSymbolComplexity))return null;const {averageSymbolComplexity:K,maximumTotalNumberOfPrimitives:N}=this.displayFeatureLimit,{primitivesPerCoordinate:M,primitivesPerFeature:L}=K,J=this._get("vertexLimitInfo");return e.isNone(J)||J.maximumTotalNumberOfPrimitives!==N||J.primitivesPerCoordinate!==M||J.primitivesPerFeature!==L?{primitivesPerCoordinate:M,primitivesPerFeature:L,maximumTotalNumberOfPrimitives:N}:J}},{key:"supportsExceedsLimitQuery",get:function(){const K=
this.layerView.layer;return K.capabilities&&K.capabilities.operations&&K.capabilities.operations.supportsExceedsLimitStatistics}},{key:"minimumNumberOfVerticesForGeometry",get:function(){switch(this.layerView.layer.geometryType){case "point":return 1;case "multipoint":return 1;case "polygon":return 4;case "polyline":return 2;case "multipatch":case "mesh":return 3;default:return 0}}},{key:"debug",get:function(){return{storedFeatures:e.isSome(this.tileFetcher)?this.tileFetcher.storedFeatures:0,totalFeatures:e.isSome(this.tileFetcher)?
this.tileFetcher.totalFeatures:0,totalVertices:e.isSome(this.tileFetcher)?this.tileFetcher.totalVertices:0}}}]);return G}(h.EsriPromiseMixin(m));c.__decorate([t.property({readOnly:!0})],a.FeatureTileController3D.prototype,"type",void 0);c.__decorate([t.property({constructOnly:!0})],a.FeatureTileController3D.prototype,"graphics",void 0);c.__decorate([t.property({constructOnly:!0})],a.FeatureTileController3D.prototype,"layerView",void 0);c.__decorate([t.property({constructOnly:!0})],a.FeatureTileController3D.prototype,
"context",void 0);c.__decorate([t.property()],a.FeatureTileController3D.prototype,"extent",null);c.__decorate([t.property()],a.FeatureTileController3D.prototype,"updating",null);c.__decorate([t.property({readOnly:!0})],a.FeatureTileController3D.prototype,"watchUpdatingTracking",void 0);c.__decorate([t.property()],a.FeatureTileController3D.prototype,"updatingTotal",null);c.__decorate([t.property()],a.FeatureTileController3D.prototype,"updatingRemaining",null);c.__decorate([t.property()],a.FeatureTileController3D.prototype,
"expectedFeatureDiff",null);c.__decorate([t.property()],a.FeatureTileController3D.prototype,"memoryForUnusedFeatures",null);c.__decorate([t.property()],a.FeatureTileController3D.prototype,"maximumNumberOfFeaturesExceeded",null);c.__decorate([t.property({readOnly:!0})],a.FeatureTileController3D.prototype,"serviceDataExtent",void 0);c.__decorate([t.property({readOnly:!0})],a.FeatureTileController3D.prototype,"serviceDataCount",void 0);c.__decorate([t.property({readOnly:!0})],a.FeatureTileController3D.prototype,
"vertexLimitExceeded",void 0);c.__decorate([t.property()],a.FeatureTileController3D.prototype,"displayFeatureLimit",void 0);c.__decorate([t.property({type:Number})],a.FeatureTileController3D.prototype,"maximumNumberOfFeatures",null);c.__decorate([t.property({readOnly:!0})],a.FeatureTileController3D.prototype,"mode",null);c.__decorate([t.property({readOnly:!0})],a.FeatureTileController3D.prototype,"maxTotalSnapshotVertices",null);c.__decorate([t.property({readOnly:!0,dependsOn:["mode"]})],a.FeatureTileController3D.prototype,
"tileDescriptors",null);c.__decorate([t.property()],a.FeatureTileController3D.prototype,"tileFetcher",void 0);c.__decorate([t.property()],a.FeatureTileController3D.prototype,"fetchDataInfoPromise",void 0);c.__decorate([t.property({readOnly:!0})],a.FeatureTileController3D.prototype,"vertexLimitInfo",null);a.FeatureTileController3D=c.__decorate([B.subclass("esri.layers.graphics.controllers.FeatureTileController3D")],a.FeatureTileController3D);a.FeatureTileController3DConstants=void 0;(function(F){F.NO_SERVICE_DATA_COUNT=
Infinity;F.MAX_SNAPSHOT_MIN_SCALE_FACTOR=5;F.reset=function(){F.MAX_FEATURE_COUNT_FOR_EXTENT=1E4;F.QUERY_STATISTICS_TIMEOUT=12E3;F.QUERY_EXTENT_TIMEOUT=1E4}})(a.FeatureTileController3DConstants||(a.FeatureTileController3DConstants={}));a.FeatureTileController3DConstants.reset();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/FeatureTileFetcher3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../rest/support/QuantizationParameters ../../../../rest/support/Query ../../../ViewingMode ./featureReference ./FeatureTile ../../terrain/tileUtils ../../../support/Scheduler".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y){function D(L){return"dummy-tile-full-extent"===L.id}function E(L){let J=0;for(const H of L)H.features&&0<H.features.length&&H.alive&&(J=Math.max(J,H.descriptor.lij[0]));return J}function F(L){L.setFeatures([],0,null);L.featuresMissing=!1;return A.FetchStatus.DONE}function G(L){return g.isNone(L)?new Set:new Set(L.map(J=>J.name))}function P(L,J){if(g.isNone(L)||g.isNone(J))return G(J);const H=new Set;for(const {name:I}of J)L.has(I)&&H.add(I);
return H}const K=r.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");a.FeatureTileFetcher3D=function(L){function J(I){I=L.call(this,I)||this;I._useTileCount=!1;I.updating=!1;I.updatingTotal=0;I.updatingRemaining=0;I.expectedFeatureDiff=0;I.maximumNumberOfFeaturesExceeded=!1;I.maximumNumberOfFeaturesExceededThrottle=1E3;I._fullRatio=1;I._farRatio=1;I.changes={updates:{adds:[],removes:[]},adds:[],removes:[]};I.handles=new l;I._frameTask=y.ImmediateTask;I._dirty=!1;I.featureTiles=new Map;
I.displayingFeatureReferences=new Map;I.numDisplayingFeatureReferences=0;I.suspended=!0;I.pendingEdits=null;return I}b._inheritsLoose(J,L);var H=J.prototype;H.initialize=function(){this.handles.add(f.on(()=>this.tileDescriptors,"change",()=>this._setDirty(),{onListenerAdd:()=>this._setDirty()}));this.objectIdField=this.context.objectIdField;this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?z.MultiFeatureReference:z.SingleFeatureReference;const I=this.context.scheduler;
g.isSome(I)&&(this._frameTask=I.registerTask(y.TaskPriority.FEATURE_TILE_FETCHER,this));this._setDirty()};H.destroy=function(){this._frameTask.remove();this.handles=g.destroyMaybe(this.handles);this.featureTiles.forEach(I=>{this._cancelFetchTile(I);this._removeTile(I)});this.featureTiles.clear();this.displayingFeatureReferences.clear();this.pendingEdits&&(this.pendingEdits.controller.abort(),this.pendingEdits=null)};H.restart=function(){this.featureTiles.forEach(I=>{this._cancelFetchTile(I);this._clearTile(I);
this._resetFetchTile(I)});g.isSome(this.context.memoryCache)&&this.context.memoryCache.clear();this._setDirty()};H.refetch=function(){this.featureTiles.forEach(I=>{this._cancelFetchTile(I);this._resetFetchTile(I)});g.isSome(this.context.memoryCache)&&this.context.memoryCache.clear();this._setDirty()};H.suspend=function(){this.suspended||(this.suspended=!0,this._pause(),this._setDirty())};H.resume=function(){this.suspended&&(this.suspended=!1,this._unpause())};H._pause=function(){this.paused&&(this.featureTiles.forEach(I=>
this._cancelFetchTile(I)),this._updated())};H._unpause=function(){this.paused||(this._setDirty(),this._updated())};H.applyEdits=function(I){this.pendingEdits||(this.pendingEdits={edits:Promise.resolve(),count:0,controller:new AbortController},this._pause());const O=this.pendingEdits;O.count++;const Q=O.edits.then(()=>I.result.catch(S=>{if(k.isAbortError(S))throw S;return null}).then(S=>{if(!S)return S;this._applyEditsDeleteFeatures(S.deletedFeatures);return this._applyEditsAddUpdateFeatures(S.addedFeatures,
S.updatedFeatures,O.controller.signal).then(()=>S)}).then(S=>{0===--O.count&&(this.pendingEdits===O&&(this.pendingEdits=null),g.isSome(this.context.memoryCache)&&this.context.memoryCache.clear(),this._unpause(),this._updated());return S}));O.edits=Q;this._updated();return Q};H._applyEditsDeleteFeatures=function(I){if(0!==I.length){var O=this.context.globalIdField,Q=O&&this.availableFields.has(O),S=new Set,T=this.objectIdField;I.forEach(({objectId:U,globalId:aa})=>{(!U||0>U)&&O?(Q||K.errorOncePerTick(`Editing the specified service requires the layer's globalIdField, ${O} to be included the layer's outFields for updates to be reflected in the view`),
(U=this.features.find(W=>W.attributes&&W.attributes[O]===aa))&&S.add(B.getObjectId(U,T))):S.add(U)});this.featureTiles.forEach(U=>{if(U.features){var aa=U.features.filter(W=>!S.has(B.getObjectId(W,this.objectIdField)));aa.length!==U.features.length&&(U.setFeatures(aa,0,U.availableFields),this._invalidateCounts())}})}};H._applyEditsAddUpdateFeatures=function(){var I=b._asyncToGenerator(function*(O,Q,S){const T=[],U=new Set;O.forEach(W=>T.push(W.objectId));Q.forEach(W=>{T.push(W.objectId);U.add(W.objectId)});
if(0!==T.length){var aa=[];this.featureTiles.forEach(W=>{(W=this._applyEditsAddUpdateTile(W,T,U,S))&&aa.push(W)});yield k.eachAlways(aa)}});return function(O,Q,S){return I.apply(this,arguments)}}();H._applyEditsAddUpdateTile=function(){var I=b._asyncToGenerator(function*(O,Q,S,T){if(O.features){var U=this._createQuery(O);U.resultType=void 0;U.cacheHint=!1;U.objectIds=Q;Q=yield this._queryFeatures(U,T);T=null;0<S.size&&(U=O.features.filter(aa=>!S.has(B.getObjectId(aa,this.objectIdField))),U.length!==
O.features.length&&(T=U));if(0<Q.features.length){T||(T=O.features.slice());for(const aa of Q.features)T.push(aa)}T&&(O.hasPreciseFeatureCount&&(O.numFeatures=Math.max(O.numFeatures,T.length)),O.setFeatures(T,0,P(O.availableFields,Q.fields)),this._invalidateCounts())}});return function(O,Q,S,T){return I.apply(this,arguments)}}();H._queryFeatures=function(I,O){return this.context.query.queryFeaturesDehydrated(I,{signal:O,timeout:6E5})};H._setDirty=function(){this._dirty=!0;this._updated()};H.runTask=
function(I){this._frameTask.processQueue(I);if(this._dirty&&this.constructed){this._dirty=!1;var O=this._getListOfTiles();this._markTilesNotAlive(O);if(I.run(()=>this._addTiles(O,I))&&I.run(()=>this._filterExtentTiles(O,I))&&I.run(()=>this._removeTiles(O,I))&&!I.done){var Q=this._sortTiles(O);I.run(()=>this._displayTiles(Q,I))&&I.run(()=>this._fetchTiles(Q,I))&&I.run(()=>this._updateMemoryEstimates(Q,I))||this._setDirty();this._updated();this.updating||this._updateMaximumNumberOfFeaturesExceeded()}else this._setDirty()}};
H._markTilesNotAlive=function(I){for(const O of I)O.alive=!1};H._addTiles=function(I,O){if(this.suspended)return!1;this.tileDescriptors.forEach(Q=>{const S=this.featureTiles.get(Q.id);S?S.alive=!0:O.done||(I.push(this._addTile(Q)),O.madeProgress())});return O.hasProgressed};H._filterExtentTiles=function(I,O){for(const Q of I){if(O.done)break;Q.alive&&(Q.filtered=!Q.intersects(this.filterExtent),Q.filtered&&(this._clearTile(Q),O.madeProgress()))}return O.hasProgressed};H._removeTiles=function(I,O){for(let Q=
I.length-1;0<=Q&&!O.done;Q--){const S=I[Q];S.alive||(this._removeTile(S),Q!==I.length-1&&(I[Q]=I[I.length-1]),I.pop(),O.madeProgress())}return O.hasProgressed};H._sortTiles=function(I){I.sort((O,Q)=>O.descriptor.loadPriority-Q.descriptor.loadPriority);return I};H._displayTiles=function(I,O){const Q=this._updateRatio(I),S=T=>{const U=1>this._fullRatio?Q(T)*this._farRatio:1;T.reduceFeatures(U,this.memoryFactor,this.objectIdField)&&this._setDirty();return this._showTile(T)};for(const T of I)if(!O.run(()=>
S(T))){this._setDirty();break}return O.hasProgressed};H._fetchTiles=function(I,O){if(this.paused)return!1;var Q=!1;for(const T of I)if(T.needsFetching){var S=g.isSome(this.context.memoryCache)?this.context.memoryCache.pop(T.id):null;if(g.isSome(S))T.cache=S,this._setDirty(),this._scheduleUpdated(),O.madeProgress();else if(this._needsNumFeatures(T)&&(Q=new AbortController,S=this._fetchTileCount(T,Q.signal),this._handleRequest(T,S,Q,()=>T.numFeatures=A.FAILED_FEATURE_COUNT),Q=!0,O.madeProgress()),O.done)return!0}if(Q)return O.hasProgressed;
for(const T of I)if(T.needsFetching&&(I=new AbortController,Q=this._fetchTile(T,I.signal),this._handleRequest(T,Q,I,U=>{T.setFeatures([],0,null);this._invalidateCounts();T.featuresMissing=!1;this.context.logFetchError(K,U)}),O.madeProgress(),O.done))return!0;return O.hasProgressed};H._updateMemoryEstimates=function(I,O){I.some(Q=>O.run(()=>Q.updateMemoryEstimates())?!1:(this._setDirty(),!0));return O.hasProgressed};H._reclip=function(I,O){if(this.constructed){var Q=[];this.featureTiles.forEach(S=>
{g.isNone(S.displayingFeatures)||0===S.displayingFeatures.length||(S.intersectionIncludingBorrowed(O,N),S.intersectionIncludingBorrowed(I,M),x.equals(N,M)||Q.push(S))});this._refreshDisplayingFeatures(Q);this._updated()}};H._refreshDisplayingFeatures=function(I){const O=new Set,Q=this.changes.updates;for(const S of I)if(!g.isNone(S.displayingFeatures))for(const T of S.displayingFeatures)I=B.getObjectId(T,this.objectIdField),O.has(I)||(O.add(I),{feature:I}=this.displayingFeatureReferences.get(I),Q.removes.push(I),
Q.adds.push(I));this._applyChanges()};H._updated=function(){let I=0;this.paused||this.featureTiles.forEach(Q=>Q.isFetching?++I:0);var O=this._dirty||0<I||!!this.pendingEdits;this._set("updating",O);if(O){let Q=0,S=0,T=0,U=0,aa=0;const W=this.displayingFeatureReferences.size/this.numDisplayingFeatureReferences;this.featureTiles.forEach(V=>{++S;if(V.isFetching&&V.hasPreciseFeatureCount){const da=this._maximumFeaturesForTile(V)*(1-V.emptyFeatureRatio),ca=g.isSome(V.displayingFeatures)?V.displayingFeatures.length*
W:0;aa+=da-ca}V.needsFetching?++U:0<V.numFeatures&&(++T,Q+=V.numFeatures)});U+=I;let R=O=0;Q?(R=Q,O=Math.min(U*Q/T,Q)):(R=S,O=U);aa=Math.min(this.maximumNumberOfFeatures-this.features.length,aa);this._set("updatingTotal",R);this._set("updatingRemaining",O);this._set("expectedFeatureDiff",aa)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update()};H._updateMaximumNumberOfFeaturesExceeded=function(){const I=n.someMap(this.featureTiles,
O=>O.perTileMaximumNumberOfFeaturesExceeded);this._set("maximumNumberOfFeaturesExceeded",I)};H._updateRatio=function(I){const O=E(I),Q=U=>1/(1<<Math.max(0,O-U.descriptor.lij[0]));let S=0,T=0;for(const U of I)I=U.numFeatures,S+=I,T+=I*Q(U);this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/S);this._farRatio=this.maximumNumberOfFeatures/T;this._scheduleUpdated();return Q};H._maximumFeaturesUpdated=function(I,O){I!==O&&(O>I&&this.featureTiles.forEach(Q=>{if(Q.featuresMissing){var S=this._maximumFeaturesForTile(Q);
Q.features&&(Q.features.length>=S||Q.fetchStatus===A.FetchStatus.FULL)||(this._cancelFetchTile(Q),this._resetFetchTile(Q))}}),this._setDirty())};H._addTile=function(I){I=new A.FeatureTile(I);this.featureTiles.set(I.id,I);this._resetFetchTile(I);this._referenceDisplayingFeaturesFromRelatedTiles(I);return I};H._referenceDisplayingFeaturesFromRelatedTiles=function(I){const O=I.descriptor.resolution;this.featureTiles.forEach(Q=>{if(!(g.isNone(Q.displayingFeatures)||I===Q||I.descriptor.lij&&Q.descriptor.lij&&
!p.tilesAreRelated(I.descriptor.lij,Q.descriptor.lij))){g.isNone(I.displayingFeatures)&&(I.displayingFeatures=[]);I.descriptor.extent&&Q.descriptor.extent&&(g.isNone(I.extentIncludingBorrowedFeatures)&&(I.extentIncludingBorrowedFeatures=x.clone(I.descriptor.extent)),x.expand(I.extentIncludingBorrowedFeatures,Q.descriptor.extent,I.extentIncludingBorrowedFeatures));for(const S of Q.displayingFeatures)I.displayingFeatures.push(S),Q=this.displayingFeatureReferences.get(B.getObjectId(S,this.objectIdField)),
Q.ref(Q.feature,O),this.numDisplayingFeatureReferences++}});I.featureLimit=g.isSome(I.displayingFeatures)?I.displayingFeatures.length:0};H._removeTile=function(I){this._clearTile(I);this.featureTiles.delete(I.id)};H._resetFetchTile=function(I){I.filtered=!I.intersects(this.filterExtent);I.filtered?I.needsFetching&&(I.fetchStatus=A.FetchStatus.DONE):I.fetchStatus=A.FetchStatus.FETCH_NEEDED};H._cancelFetchTile=function(I){const O=I.requestController;g.isSome(O)&&(I.requestController=null,I.resetFetching(),
O.abort())};H._fetchTileCount=function(){var I=b._asyncToGenerator(function*(O,Q){O.numFeatures=yield this._fetchCount(O,Q);this._updateRatio(this._getListOfTiles());return O.fetchStatus===A.FetchStatus.REFETCHING?A.FetchStatus.REFETCH_NEEDED:A.FetchStatus.FETCH_NEEDED});return function(O,Q){return I.apply(this,arguments)}}();H._fetchTile=function(){var I=b._asyncToGenerator(function*(O,Q){var S=this._maximumFeaturesForTile(O);if(0>=S)return F(O);const T=this._getMaxRecordCount(O);var U=Math.ceil(S/
T);if(D(O)||!this.context.capabilities.supportsMaxRecordCountFactor||O.numFeatures<=S&&U>u.MAX_MAX_RECORD_COUNT_FACTOR)return this._fetchPagedTile(O,Q);U=this._createQuery(O);U.maxRecordCountFactor=Math.ceil(S/T);O.isRefetching&&O.features&&0<O.features.length&&(U.maxRecordCountFactor=Math.max(Math.ceil(O.features.length/(1-O.emptyFeatureRatio)/T)+1,U.maxRecordCountFactor));const {features:aa,exceededTransferLimit:W,fields:R}=yield this._queryFeatures(U,Q);S=W?U.maxRecordCountFactor>=u.MAX_MAX_RECORD_COUNT_FACTOR?
A.FetchStatus.FULL:A.FetchStatus.DONE:A.FetchStatus.FULL;yield this._frameTask.schedule(()=>{O.featuresMissing=aa.length<O.numFeatures||W;const V=this._removeEmptyFeatures(aa);O.setFeatures(aa,V,G(R))},Q);k.throwIfAborted(Q);this._invalidateCounts();return S});return function(O,Q){return I.apply(this,arguments)}}();H._fetchCount=function(){var I=b._asyncToGenerator(function*(O,Q){return this.context.query.queryFeatureCount(this._createFeatureCountQuery(O),{signal:Q})});return function(O,Q){return I.apply(this,
arguments)}}();H._fetchPagedTile=function(){var I=b._asyncToGenerator(function*(O,Q){let S=0,T=0,U,aa=0,W=this._maximumFeaturesForTile(O)-aa;const R=this._getMaxRecordCount(O);let V=null;for(;;){const da=this._createQuery(O),ca=this._setPagingParameters(da,S,W,R),{features:ha,exceededTransferLimit:ia,fields:ka}=yield this._queryFeatures(da,Q);yield this._frameTask.schedule(()=>{ca&&(S+=g.unwrap(da.num));aa+=ha.length;T+=this._removeEmptyFeatures(ha);O.featuresMissing=S<O.numFeatures||ia;U=U?U.concat(ha):
ha;V=P(V,ka);O.setFeatures(U,T,V)},Q);k.throwIfAborted(Q);this._invalidateCounts();this._setDirty();W=this._maximumFeaturesForTile(O)-aa;if(!ca||!ia||0>=W)return ia?A.FetchStatus.DONE:A.FetchStatus.FULL}});return function(O,Q){return I.apply(this,arguments)}}();H._createFeatureCountQuery=function(I){I=this._createQuery(I);this.context.capabilities.supportsCacheHint&&(I.resultType=void 0,I.cacheHint=!0);return I};H._createQuery=function(I){const O=this.context.createQuery(),Q=I.descriptor.extent;Q&&
(O.geometry=x.toExtent(Q,this.context.tilingScheme.spatialReference));this._setResolutionParams(O,I);this._useTileQuery(I)?O.resultType="tile":this.context.capabilities.supportsCacheHint&&(O.cacheHint=!0);return O};H._setPagingParameters=function(I,O,Q,S){if(!this.context.capabilities.supportsPagination)return!1;I.start=O;0<Q&&this.context.capabilities.supportsMaxRecordCountFactor?(I.maxRecordCountFactor=Math.ceil(Q/S),I.num=Math.min(I.maxRecordCountFactor*S,Q)):I.num=Math.min(S);return!0};H._getEffectiveTileResolution=
function(I){if(null==I.descriptor.resolution)return null;const O=this.context.viewingMode===C.ViewingMode.Global?this.context.tilingScheme.resolutionAtLevel(3):Infinity;return Math.min(I.descriptor.resolution,O)/this.lodFactor};H._setResolutionParams=function(I,O){this.supportsResolution&&(O=this._getEffectiveTileResolution(O),null!=O&&(this.context.capabilities.supportsQuantization?I.quantizationParameters=new q({mode:"view",originPosition:"upper-left",tolerance:O,extent:this.context.fullExtent}):
"polyline"===this.context.geometryType&&(I.maxAllowableOffset=O)))};H._removeEmptyFeatures=function(I){const O=I.length;for(let Q=0;Q<I.length;)B.hasVertices(I[Q].geometry)?++Q:(I[Q]=I[I.length-1],--I.length);return O-I.length};H._needsNumFeatures=function(I){return this.useTileCount&&I.needsFeatureCount&&!D(I)};H._getMaxRecordCount=function(I){const {tileMaxRecordCount:O,maxRecordCount:Q}=this.context;return this._useTileQuery(I)&&g.isSome(O)&&0<O&&this.context.capabilities.supportsResultType?O:
g.isSome(Q)&&0<Q?Q:2E3};H._useTileQuery=function(I){return D(I)&&this.context.capabilities.supportsCacheHint?!1:this.context.capabilities.supportsResultType};H._handleRequest=function(I,O,Q,S){I.fetchStatus=I.needsRefetching?A.FetchStatus.REFETCHING:A.FetchStatus.FETCHING;I.requestController=Q;let T=!1;O.then(U=>{I.requestController=null;I.fetchStatus=U}).catch(U=>{I.requestController===Q&&(I.requestController=null,I.fetchStatus=A.FetchStatus.DONE);k.isAbortError(U)?T=!0:S(U)}).then(()=>{T||this._setDirty();
this._scheduleUpdated()})};H._scheduleUpdated=function(){this.handles&&!this.handles.has("scheduleUpdated")&&this.handles.add(d.schedule(()=>{this.handles.remove("scheduleUpdated");this._updated()}),"scheduleUpdated")};H._showTile=function(I){if(g.isSome(I.displayingFeatures)&&!I.needsDisplayUpdate)return!1;var O=I.features;if(0===I.featureLimit||!O)return O=g.isSome(I.displayingFeatures)&&0<I.displayingFeatures.length,this._hideTileFeatures(I),I.displayingFeatures=[],O;const Q=I.descriptor.resolution,
S=this.changes.updates,T=this.changes.adds,U=Math.min(I.featureLimit,O.length);I.featureLimit=U;for(let W=0;W<U;++W){var aa=O[W];const R=B.getObjectId(aa,this.objectIdField),V=this.displayingFeatureReferences.get(R);V?(aa=V.ref(aa,Q),aa.oldVersion!==aa.newVersion&&(S.removes.push(aa.oldVersion),S.adds.push(aa.newVersion))):(this.displayingFeatureReferences.set(R,new this.FeatureReferenceClass(aa,Q)),T.push(aa));this.numDisplayingFeatureReferences++}this._hideTileFeatures(I);this._applyChanges();I.displayingFeatures=
O.slice(0,U);return!0};H._hideTile=function(I){this._cancelFetchTile(I);this._hideTileFeatures(I)};H._hideTileFeatures=function(I){if(!g.isNone(I.displayingFeatures)){var O=this.changes.updates,Q=this.changes.removes;for(const T of I.displayingFeatures){const U=B.getObjectId(T,this.objectIdField);var S=this.displayingFeatureReferences.get(U);S&&((S=S.unref(I.descriptor.resolution),this.numDisplayingFeatureReferences--,S)?S.oldVersion!==S.newVersion&&(null==S.newVersion?(this.displayingFeatureReferences.delete(U),
Q.push(S.oldVersion)):(O.adds.push(S.newVersion),O.removes.push(S.oldVersion))):console.error("Hiding unreferenced feature"))}this._applyChanges();I.displayingFeatures=null}};H._applyChanges=function(){var I=this.changes.updates;0<I.removes.length&&(this.features.removeMany(I.removes),I.removes.length=0);0<I.adds.length&&(this.features.addMany(I.adds),I.adds.length=0);I=this.changes.adds;const O=this.changes.removes,Q=Math.min(I.length,O.length);let S=0;for(;S<Q;){const T=Math.min(S+200,Q);this.features.addMany(I.slice(S,
T));this.features.removeMany(O.slice(S,T));S=T}I.length>Q&&this.features.addMany(0===S?I:I.slice(S));O.length>Q&&this.features.removeMany(0===S?O:O.slice(S));I.length=0;O.length=0};H._clearTile=function(I){this._hideTile(I);I.features&&g.isSome(this.context.memoryCache)&&this.context.memoryCache.put(I.id,I.cache,16+I.estimatedSize);I.setFeatures(null,0,null);this._invalidateCounts()};H._invalidateCounts=function(){this.notifyChange("totalVertices");this.notifyChange("totalFeatures");this.notifyChange("memoryForUnusedFeatures")};
H._getListOfTiles=function(){return Array.from(this.featureTiles.values())};H._maximumFeaturesForTile=function(I){const O=I.hasPreciseFeatureCount?I.numFeatures:Infinity;return Math.min(Math.ceil((I.hasPreciseFeatureCount?O:this.maximumNumberOfFeatures)*(1>this._fullRatio?this._farRatio:1)/(1-I.emptyFeatureRatio)),O)};b._createClass(J,[{key:"maximumNumberOfFeatures",set:function(I){I=I||Infinity;const O=this._get("maximumNumberOfFeatures");I===O||1>I||(this._set("maximumNumberOfFeatures",I),this._maximumFeaturesUpdated(O,
I))}},{key:"memoryFactor",set:function(I){this.memoryFactor!==I&&(this._set("memoryFactor",I),this._setDirty())}},{key:"lodFactor",set:function(I){this.lodFactor!==I&&(this._set("lodFactor",I),this.supportsResolution&&this.refetch())}},{key:"useTileCount",get:function(){return this._useTileCount&&g.isSome(this.context.query.queryFeatureCount)},set:function(I){this._useTileCount=I;this.notifyChange("useTileCount")}},{key:"memoryForUnusedFeatures",get:function(){let I=0;this.featureTiles.forEach(O=>
I+=O.estimatedUnusedSize);return I}},{key:"totalVertices",get:function(){let I=0;this.featureTiles.forEach(O=>I+=O.numVertices);return I}},{key:"totalFeatures",get:function(){let I=0;this.featureTiles.forEach(O=>I+=O.numFeatures);return I}},{key:"filterExtent",set:function(I){if(I&&this.context.tilingScheme&&!I.spatialReference.equals(this.context.tilingScheme.spatialReference))K.error("#filterExtent\x3d","extent needs to be in the same spatial reference as the tiling scheme");else{var O=this._get("filterExtent");
O===I||O&&I&&O.equals(I)||(I=I?I.clone():null,this._set("filterExtent",I),this._reclip(I,O))}}},{key:"paused",get:function(){return this.suspended||!!this.pendingEdits}},{key:"availableFields",get:function(){let I=null;this.featureTiles.forEach(O=>{g.isNone(O.displayingFeatures)||0===O.displayingFeatures.length||(g.isNone(I)?I=new Set(O.availableFields):I.forEach(Q=>{O.availableFields.has(Q)||g.unwrap(I).delete(Q)}))});return g.isSome(I)?I:new Set}},{key:"running",get:function(){return this.updating}},
{key:"supportsResolution",get:function(){return this.context.capabilities.supportsMultipleResolutions&&"point"!==this.context.geometryType}},{key:"storedFeatures",get:function(){return this._getListOfTiles().reduce((I,O)=>I+(O.features?O.features.length:0),0)}},{key:"test",get:function(){return{process:I=>this.runTask(I),getFeatureTileById:I=>this.featureTiles.get(I),forEachFeatureTile:I=>this.featureTiles.forEach(I)}}}]);return J}(m);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,
"features",void 0);c.__decorate([e.property()],a.FeatureTileFetcher3D.prototype,"tileDescriptors",void 0);c.__decorate([e.property({value:Infinity})],a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeatures",null);c.__decorate([e.property({value:1})],a.FeatureTileFetcher3D.prototype,"memoryFactor",null);c.__decorate([e.property({value:1})],a.FeatureTileFetcher3D.prototype,"lodFactor",null);c.__decorate([e.property()],a.FeatureTileFetcher3D.prototype,"useTileCount",null);c.__decorate([e.property({readOnly:!0})],
a.FeatureTileFetcher3D.prototype,"updating",void 0);c.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updatingTotal",void 0);c.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updatingRemaining",void 0);c.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"expectedFeatureDiff",void 0);c.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"memoryForUnusedFeatures",null);c.__decorate([e.property({readOnly:!0})],
a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeaturesExceeded",void 0);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeaturesExceededThrottle",void 0);c.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"totalVertices",null);c.__decorate([e.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"totalFeatures",null);c.__decorate([e.property()],a.FeatureTileFetcher3D.prototype,"filterExtent",null);c.__decorate([e.property({constructOnly:!0})],
a.FeatureTileFetcher3D.prototype,"context",void 0);a.FeatureTileFetcher3D=c.__decorate([t.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],a.FeatureTileFetcher3D);const N=x.create(),M=x.create();a.contextCapabilitiesFromLayer=function(L){const J=L.capabilities.query;a:switch(L.geometryType){case "polyline":L=!0;break a;case "polygon":L=L.capabilities&&L.capabilities.query&&L.capabilities.query.supportsQuantization;break a;default:L=!1}return{supportsMultipleResolutions:L,supportsPagination:!(!J||
!J.supportsPagination),supportsResultType:!(!J||!J.supportsResultType),supportsCacheHint:!(!J||!J.supportsCacheHint),supportsQuantization:!(!J||!J.supportsQuantization),supportsQuantizationEditMode:!(!J||!J.supportsQuantizationEditMode),supportsMaxRecordCountFactor:!(!J||!J.supportsMaxRecordCountFactor),supportsFormatPBF:!(!J||!J.supportsFormatPBF)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/featureReference":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../layers/graphics/dehydratedFeatures","../../../../layers/graphics/dehydratedFeatureComparison"],function(a,b,c,m){c=function(){function n(k,f){this.highestResolutionVersion=null;this.versions=[];this.ref(k,f)}var g=n.prototype;g.ref=function(k,f){const d=this.feature;r.oldVersion=d;this.feature&&Object.defineProperty(k,"uid",{value:this.feature.uid,configurable:!0});for(var e of this.versions)if(e.resolution===f){e.refCount++;if((f=this.highestResolutionVersion===
e&&!m.equals(k,e.feature))||this.highestResolutionVersion!==e)e.feature=k;r.newVersion=f?k:d;return r}e={feature:k,resolution:f,refCount:1};this.versions.push(e);!this.highestResolutionVersion||f<this.highestResolutionVersion.resolution?(r.newVersion=k,this.highestResolutionVersion=e):r.newVersion=d;return r};g.unref=function(k){for(let f=0;f<this.versions.length;f++){const d=this.versions[f];if(d.resolution===k)return d.refCount--,r.oldVersion=this.feature,0===d.refCount&&(this.versions[f]=this.versions[this.versions.length-
1],this.versions.length--,this.highestResolutionVersion===d&&(this._recalculateHighestResolutionVersion(),r.oldVersion=d.feature)),r.newVersion=this.feature,r}return null};g._recalculateHighestResolutionVersion=function(){if(0===this.versions.length)this.highestResolutionVersion=null;else{var k=this.versions[0];for(let f=1;f<this.versions.length;f++){const d=this.versions[f];d.resolution<k.resolution&&(k=d)}this.highestResolutionVersion=k}};b._createClass(n,[{key:"isReferenced",get:function(){return 0!==
this.versions.length}},{key:"isSingle",get:function(){return 1===this.versions.length&&1===this.versions[0].refCount}},{key:"feature",get:function(){return this.highestResolutionVersion?this.highestResolutionVersion.feature:null}}]);return n}();let l=function(){function n(k){this._feature=k;this.refCount=1}var g=n.prototype;g.ref=function(k){++this.refCount;r.oldVersion=this._feature;this.feature&&Object.defineProperty(k,"uid",{value:this.feature.uid,configurable:!0});m.equals(this._feature,k)||(this._feature=
k);r.newVersion=this._feature;return r};g.unref=function(){r.oldVersion=this._feature;if(0<this.refCount&&(this.refCount--,!this.isReferenced))return r.newVersion=null,r;r.newVersion=this._feature;return r};b._createClass(n,[{key:"isReferenced",get:function(){return 0!==this.refCount}},{key:"isSingle",get:function(){return 1===this.refCount}},{key:"feature",get:function(){return this._feature}}]);return n}();const r={oldVersion:null,newVersion:null};a.MultiFeatureReference=c;a.SingleFeatureReference=
l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/FeatureTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/arrayUtils ../../../../core/maybe ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures".split(" "),function(a,b,c,m,l,r){const n=new Set;let g=function(){function f(e){this.descriptor=e;this.fetchStatus=a.FetchStatus.FETCH_NEEDED;this._features=
null;this._featureLimit=this._numVertices=0;this.featuresMissing=!0;this._shuffled=!1;this._numFeatures=-1;this._emptyFeatureRatio=0;this._estimatedSize=-1;this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;this._availableFields=n;this._displayingFeatures=null;this.alive=!0;this.filtered=!1}var d=f.prototype;d.setFeatures=function(e,h,v){this._availableFields=m.unwrapOr(v,n);this._features=e;this._shuffled=!1;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0;e&&0<e.length?(this._emptyFeatureRatio=
h/(e.length+h),this._numVertices=e.reduce((w,t)=>w+r.numVertices(t.geometry),0)):this._numVertices=this._emptyFeatureRatio=0};d.updateMemoryEstimates=function(){if(0>this._estimatedSize){this._estimatedUnusedSize=this._estimatedSize=0;if(this._features)for(var e=0;e<this._features.length;++e){const h=r.estimateSize(this._features[e]);this._estimatedSize+=h;e>=this.featureLimit&&(this._estimatedUnusedSize+=h)}return!0}if(this._estimatedUnusedSizeDirty){this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=
!1;if(this._features)for(e=this.featureLimit;e<this._features.length;++e)this._estimatedUnusedSize+=r.estimateSize(this._features[e]);return!0}return!1};d.resetFetching=function(){this.fetchStatus=this.fetchStatus===a.FetchStatus.REFETCHING?a.FetchStatus.REFETCH_NEEDED:a.FetchStatus.FETCH_NEEDED};d.intersects=function(e){if(!e||!this.descriptor.extent)return!0;l.fromExtent(e,k);return l.intersects(this.descriptor.extent,k)};d.intersectionIncludingBorrowed=function(e,h){const v=m.isSome(this.extentIncludingBorrowedFeatures)?
this.extentIncludingBorrowedFeatures:this.descriptor.extent;if(!e&&!v)return l.copy(h,l.POSITIVE_INFINITY),h;e?(l.fromExtent(e,h),l.intersection(h,v,h)):l.copy(h,v);return h};d._shuffle=function(e){this._features.sort((h,v)=>r.getObjectId(h,e)-r.getObjectId(v,e));c.shuffle(this._features,16438);this._estimatedUnusedSizeDirty=this._shuffled=!0};d.reduceFeatures=function(e,h,v){if(0>=e)return!1;if(!this._features)return this.featureLimit=0,!1;let w=!1;this.featureLimit=Math.ceil(this.numFeatures*e);
this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,this.fetchStatus===a.FetchStatus.DONE&&0<this._features.length&&(this.fetchStatus=a.FetchStatus.REFETCH_NEEDED,w=!0));!this._shuffled&&1>e&&this._shuffle(v);e=Math.max(this.featureLimit,Math.ceil(h*this.numFeatures));this._features.length>e&&(this._features.length=e,this.featuresMissing=!0,this.fetchStatus===a.FetchStatus.FULL&&(this.fetchStatus=a.FetchStatus.DONE));return w};b._createClass(f,[{key:"displayingFeatures",
get:function(){return this._displayingFeatures},set:function(e){this._displayingFeatures=e;this.extentIncludingBorrowedFeatures=null}},{key:"perTileMaximumNumberOfFeaturesExceeded",get:function(){return!this.filtered&&(this.featuresMissing||this.features&&this.featureLimit!==this.features.length)}},{key:"features",get:function(){return this._features}},{key:"featureLimit",get:function(){return this._featureLimit},set:function(e){this._featureLimit!==e&&(this._featureLimit=e,this._estimatedUnusedSizeDirty=
!0)}},{key:"availableFields",get:function(){return this._availableFields}},{key:"emptyFeatureRatio",get:function(){return this._emptyFeatureRatio}},{key:"numFeatures",get:function(){return this.hasPreciseFeatureCount?this._numFeatures:this._features?this._features.length:0},set:function(e){this._numFeatures=e}},{key:"hasPreciseFeatureCount",get:function(){return-1<this._numFeatures}},{key:"needsFeatureCount",get:function(){return-1===this._numFeatures}},{key:"numVertices",get:function(){return this._numVertices}},
{key:"id",get:function(){return this.descriptor.id}},{key:"estimatedSize",get:function(){this.updateMemoryEstimates();return this._estimatedSize}},{key:"estimatedUnusedSize",get:function(){return this._estimatedUnusedSize}},{key:"isFetching",get:function(){return this.fetchStatus===a.FetchStatus.FETCHING||this.fetchStatus===a.FetchStatus.REFETCHING}},{key:"isRefetching",get:function(){return this.fetchStatus===a.FetchStatus.REFETCHING}},{key:"needsFetching",get:function(){return this.fetchStatus===
a.FetchStatus.FETCH_NEEDED||this.fetchStatus===a.FetchStatus.REFETCH_NEEDED}},{key:"needsRefetching",get:function(){return this.fetchStatus===a.FetchStatus.REFETCH_NEEDED}},{key:"isFetched",get:function(){return this.fetchStatus===a.FetchStatus.DONE||this.fetchStatus===a.FetchStatus.FULL}},{key:"needsDisplayUpdate",get:function(){var e;if(e=!!this._features){a:{e=this._features;var h=this.displayingFeatures,v=this.featureLimit;if(m.isNone(h)||m.isNone(e)||v!==h.length||v>e.length)e=!1;else{for(let w=
0;w<v;++w)if(e[w]!==h[w]){e=!1;break a}e=!0}}e=!e}return e}},{key:"cache",get:function(){return{availableFields:this._availableFields,features:this.features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}},set:function(e){this.requestController=null;this._availableFields=e.availableFields;this._features=e.features;this._numFeatures=e.numFeatures;this._emptyFeatureRatio=e.emptyFeatureRatio;this.fetchStatus=e.fetchStatus;
this.featuresMissing=e.featuresMissing;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0}}]);return f}();a.FetchStatus=void 0;(function(f){f[f.FETCH_NEEDED=0]="FETCH_NEEDED";f[f.REFETCH_NEEDED=1]="REFETCH_NEEDED";f[f.FETCHING=2]="FETCHING";f[f.REFETCHING=3]="REFETCHING";f[f.DONE=4]="DONE";f[f.FULL=5]="FULL"})(a.FetchStatus||(a.FetchStatus={}));const k=l.create();a.FAILED_FEATURE_COUNT=-2;a.FeatureTile=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/layers/support/FeatureTileFetcher3DDebugger":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Graphic ../../../../geometry/Polygon ../../../../symbols/FillSymbol3DLayer ../../../../symbols/PointSymbol3D ../../../../symbols/PolygonSymbol3D ../../../../symbols/TextSymbol3DLayer ../../terrain/TilingScheme".split(" "),function(a,b,c,m,l,r,n,g,k){const f=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],
[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];let d=function(){function e(v,w,t){this.loadingGraphics=new Map;this.loadedGraphics=new Map;this.pendingGraphics=new Map;this._enabled=!0;this.tileFetcher=v;this.view=t;this.tilingScheme=new k.TilingScheme(w);this.loadedSymbols=f.map(x=>new n(new l({material:{color:[x[0],x[1],x[2],.6]},outline:{color:"black",size:1}})));this.loadingSymbols=[new n(new l({material:{color:[200,
200,200,.4]},outline:{color:[30,30,30],size:1}}))];this.pendingSymbols=[new n(new l({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))];this.dataExtentSymbol=new n(new l({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}var h=e.prototype;h.destroy=function(){this.enabled=!1};h.update=function(){this._enabled?(this._synchronizeMaps(this.loadingGraphics,{filter:v=>v.isFetching,symbols:this.loadingSymbols}),this._synchronizeMaps(this.loadedGraphics,{filter:v=>!v.isFetching,
symbols:this.loadedSymbols}),this._synchronizeMaps(this.pendingGraphics,{filter:v=>!v.isFetching,symbols:this.pendingSymbols}),this.showDataExtent(this.tileFetcher.filterExtent)):(this.loadingGraphics.forEach(v=>{this.view.graphics.removeMany(v)}),this.loadingGraphics.clear(),this.loadedGraphics.forEach(v=>{this.view.graphics.removeMany(v)}),this.loadedGraphics.clear(),this.pendingGraphics.forEach(v=>{this.view.graphics.removeMany(v)}),this.pendingGraphics.clear(),this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),
this.dataExtentGraphic=null))};h.showDataExtent=function(v){this.dataExtentGraphic&&(this.view.graphics.remove(this.dataExtentGraphic),this.dataExtentGraphic=null);v&&(v=m.fromExtent(v),this.dataExtentGraphic=new c({geometry:v,symbol:this.dataExtentSymbol}),this.view.graphics.add(this.dataExtentGraphic))};h._synchronizeMaps=function(v,w){const t=[];v.forEach((x,B)=>{const q=this.tileFetcher.test.getFeatureTileById(B);q&&w.filter(q)||(this.view.graphics.removeMany(x),t.push(B))});t.forEach(x=>v.delete(x));
this.tileFetcher.test.forEachFeatureTile(x=>{if(w.filter(x)&&!v.has(x.id)){const [u,C,z]=x.descriptor.lij;this.tilingScheme.ensureMaxLod(u);var B=this.tilingScheme.getExtentGeometry(u,C,z),q=new c({geometry:B,symbol:w.symbols[u%w.symbols.length]});B=new c({geometry:B.center,symbol:new r({verticalOffset:{screenLength:40/.75},callout:{type:"line",color:"white",border:{color:"black"}},symbolLayers:[new g({text:`${u}/${C}/${z}`,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})]})});q=
[q,B];v.set(x.id,q);this.view.graphics.addMany(q)}})};b._createClass(e,[{key:"enabled",get:function(){return this._enabled},set:function(v){this._enabled=v;this.update()}}]);return e}();a.FeatureTileFetcher3DDebugger=d;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/FeatureLikeLayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ../../../rest/support/Query ./graphics/Graphics3DFeatureProcessor ./graphics/QueryEngine ./support/HeatmapFeatureProcessor ./support/projectExtentUtils ../webgl-engine/lib/basicInterfaces ../../support/Scheduler".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u){a.FeatureLikeLayerView3D=C=>{C=function(z){function A(){var y=z.apply(this,arguments)||this;y.controller=null;y.updatePolicy=q.UpdatePolicy.SYNC;y.suspendResumeExtentMode="computed";y.slicePlaneEnabled=!1;y.fullExtentInLocalViewSpatialReference=null;y.suspendResumeExtent=null;y._controllerCreated=!1;y.clippingExtent=null;y.supportsHeightUnitConversion=!0;y.pendingController=null;y.queryEngine=null;return y}b._inheritsLoose(A,z);var p=A.prototype;p.initialize=
function(){var y=this;const D=this.layer;"isTable"in D&&D.isTable?this.addResolvingPromise(Promise.reject(new m("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:D}))):(this.addResolvingPromise(this._validateGeometryType()),this.updatingHandles.add(()=>this.layer.renderer,E=>this._recreateProcessor(E),r.initial),this.addResolvingPromise(b._asyncToGenerator(function*(){const E=yield B.toViewIfLocal(y);y.fullExtentInLocalViewSpatialReference=E;yield y._initializeController()})()),
this.updatingHandles.add(()=>this.updatePolicy,E=>this.processor.preferredUpdatePolicy=E),this.queryEngine=new t.QueryEngine({layerView:this,priority:u.TaskPriority.FEATURE_QUERY_ENGINE}),this.notifyChange("updating"))};p.destroy=function(){this._destroyPendingController();this.controller=l.destroyMaybe(this.controller);this._set("processor",l.destroyMaybe(this.processor));this.queryEngine=l.destroyMaybe(this.queryEngine);this.loadedGraphics=null};p._destroyPendingController=function(){this.pendingController=
l.destroyMaybe(this.pendingController)};p.getHit=function(y){var D;let E=null;null==(D=this.loadedGraphics)?void 0:D.forEach(F=>{F.uid===y&&(E=e.hydrateGraphic(F,this.layer))});return E?{type:"graphic",graphic:E,layer:E.layer}:null};p.whenGraphicBounds=function(y,D){var E;return null==(E=this.processor)?void 0:E.whenGraphicBounds(y,D)};p.computeAttachmentOrigin=function(y,D){var E;return null==(E=this.processor)?void 0:E.computeAttachmentOrigin(y,D)};p.queryFeatures=function(y,D){return this.queryEngine.executeQuery(this._ensureQuery(y),
l.get(D,"signal"))};p.queryObjectIds=function(y,D){return this.queryEngine.executeQueryForIds(this._ensureQuery(y),l.get(D,"signal"))};p.queryFeatureCount=function(y,D){return this.queryEngine.executeQueryForCount(this._ensureQuery(y),l.get(D,"signal"))};p.queryExtent=function(y,D){return this.queryEngine.executeQueryForExtent(this._ensureQuery(y),l.get(D,"signal"))};p._ensureQuery=function(y){return l.isNone(y)?this.createQuery():v.from(y)};p.highlight=function(y){return this.processor.highlight(y,
this.layer.objectIdField)};p.maskOccludee=function(y){return this.processor.maskOccludee(y)};p.canResume=function(){var y;return z.prototype.canResume.call(this)&&!(null!=(y=this.processor)&&y.scaleVisibilitySuspended)};p.getSuspendInfo=function(){const y=z.prototype.getSuspendInfo.call(this);return this.processor?{...y,...this.processor.suspendInfo}:y};p.isUpdating=function(){var y,D,E;return!this.processor||this.processor.destroyed?!1:!(this._controllerCreated&&(null==(y=this.controller)||!y.updating)&&
null!=(D=this.view)&&null!=(E=D.basemapTerrain)&&E.ready&&!this.processor.updating)};p._initializeController=function(){var y=b._asyncToGenerator(function*(){const D=this.createController();this.pendingController=D;yield D.when();this._setControllerWhenInitialized(D)});return function(){return y.apply(this,arguments)}}();p._setControllerWhenInitialized=function(){var y=b._asyncToGenerator(function*(D){try{yield this.when()}catch(E){}this._controllerCreated=!0;this.notifyChange("updating");!this.isResolved()||
this.destroyed?this._destroyPendingController():(yield r.whenOnce(()=>{var E,F;return null==(E=this.view)?void 0:null==(F=E.basemapTerrain)?void 0:F.ready}),this.beforeSetController(D),this.pendingController=null,this.controller=D,this.loadedGraphics=D.graphics,this.notifyChange("updating"))});return function(D){return y.apply(this,arguments)}}();p._updateClippingExtent=function(y){this.clippingExtent=y;if(!this.controller)return!1;switch(this.controller.type){case "stream":return!1;case "feature-tile-3d":return this.controller.extent=
y,!0}};p._validateGeometryType=function(){var y=b._asyncToGenerator(function*(){switch(this.layer.geometryType){case "multipatch":case "multipoint":throw new m("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:this.layer.geometryType});}});return function(){return y.apply(this,arguments)}}();p._recreateProcessor=function(y){var D,E;y="heatmap"===(null==y?void 0:y.type);const F="heatmap"===(null==(D=this.processor)?void 0:D.type);D=this.processor;
D&&y===F||(y=y?new x.HeatmapFeatureProcessor({owner:this}):new w({owner:this,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.updatePolicy,updateClippingExtent:G=>this._updateClippingExtent(G)}),this._set("processor",y),null==D?void 0:D.destroy(),null==(E=this.queryEngine)?void 0:E.clear(),this.addResolvingPromise(y.setup()))};p._getResourceInfo=function(){var y,
D;const E=this.controller instanceof h.FeatureTileController3D?this.controller:null;return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:null!=(y=null==E?void 0:E.maximumNumberOfFeatures)?y:-1,totalNumberOfFeatures:null!=(D=null==E?void 0:E.serviceDataCount)?D:-1,nodes:0,...this.processor.performanceInfo}};b._createClass(A,[{key:"legendEnabled",get:function(){var y;return this.canResume()&&(null==(y=this.processor)?void 0:y.legendEnabled)}},{key:"graphics3DProcessor",
get:function(){var y;return"graphics-3d"===(null==(y=this.processor)?void 0:y.type)?this.processor:null}},{key:"heatmapProcessor",get:function(){var y;return"heatmap"===(null==(y=this.processor)?void 0:y.type)?this.processor:null}},{key:"performanceInfo",get:function(){return this._getResourceInfo()}}]);return A}(C);c.__decorate([n.property()],C.prototype,"loadedGraphics",void 0);c.__decorate([n.property()],C.prototype,"suspended",void 0);c.__decorate([n.property({readOnly:!0})],C.prototype,"legendEnabled",
null);c.__decorate([n.property()],C.prototype,"updating",void 0);c.__decorate([n.property()],C.prototype,"controller",void 0);c.__decorate([n.property()],C.prototype,"processor",void 0);c.__decorate([n.property({readOnly:!0})],C.prototype,"updatePolicy",void 0);c.__decorate([n.property({readOnly:!0})],C.prototype,"suspendResumeExtentMode",void 0);c.__decorate([n.property({type:Boolean})],C.prototype,"slicePlaneEnabled",void 0);c.__decorate([n.property({readOnly:!0})],C.prototype,"suspendInfo",void 0);
c.__decorate([n.property()],C.prototype,"graphics3DProcessor",null);c.__decorate([n.property()],C.prototype,"heatmapProcessor",null);return C=c.__decorate([d.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],C)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DFeatureProcessor":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/compilerUtils ../../../../core/HandleOwner ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../core/accessorSupport/diffUtils ../../../../geometry/support/webMercatorUtils ../../../../renderers/support/renderingInfoUtils ../../../../rest/support/Query ../interfaces ./constants ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DFilterVisibility ./Graphics3DFrustumVisibility ./Graphics3DObjectStates ./Graphics3DScaleVisibility ./graphicUtils ../support/attributeUtils ../../webgl-engine/lib/basicInterfaces".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F){l=function(P){function K(M){M=P.call(this,M)||this;M.type="graphics-3d";M.elevationFeatureExpressionEnabled=!1;M.dataExtent=null;M.drapeSourceType=B.DrapeSourceType.Features;M.preferredUpdatePolicy=F.UpdatePolicy.ASYNC;M.suspendResumeExtent=null;return M}a._inheritsLoose(K,P);var N=K.prototype;N.normalizeCtorArgs=function(M){const L=M.frustumVisibilityEnabled?new A:null,J=M.scaleVisibilityEnabled?new y:null,H=(M.filterVisibilityEnabled||
M.timeExtentEnabled)&&"multipatch"!==M.owner.layer.geometryType?new z.Graphics3DFilterVisibility:null,I=M.elevationAlignmentEnabled?new C:null,{owner:O,updateClippingExtent:Q,dataExtent:S,elevationFeatureExpressionEnabled:T,preferredUpdatePolicy:U}=M;return{owner:O,updateClippingExtent:Q,dataExtent:S,frustumVisibility:L,scaleVisibility:J,filterVisibility:H,elevationAlignment:I,elevationFeatureExpressionEnabled:T,preferredUpdatePolicy:U}};N.initialize=function(){const M=new u.Graphics3DCore({owner:this,
layer:this.layer,preferredUpdatePolicy:this.preferredUpdatePolicy,elevationFeatureExpressionEnabled:this.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:this.owner.hasZ,hasM:this.owner.hasM});this._set("graphicsCore",M);this.scaleVisibility&&this.updatingHandles.add(()=>this.layer.effectiveScaleRange,()=>this.scaleVisibility.layerMinMaxScaleChangeHandler());const L=this.filterVisibility;r.isSome(L)&&(this.updatingHandles.add(()=>"filter"in this.owner&&this.owner.filter,()=>L.filterChanged()),
this.updatingHandles.add(()=>"timeExtent"in this.owner&&this.owner.timeExtent,()=>L.filterChanged()),this.updatingHandles.add(()=>"layerFilter"in this.owner&&this.owner.layerFilter,()=>L.filterChanged()));this.elevationAlignment&&this.updatingHandles.add(()=>this.layer.elevationInfo,(J,H)=>{v.diff(J,H)&&this.updatingHandles.addPromise(this.graphicsCore.elevationInfoChange())});this.updatingHandles.add(()=>this.layer.labelsVisible,()=>this.graphicsCore.updateVisibilityInfo());this.updatingHandles.add(()=>
this.layer.labelingInfo,(J,H)=>{v.diff(J,H)&&this.graphicsCore.updateLabelingInfo()});this.updatingHandles.add(()=>this.preferredUpdatePolicy,J=>this.graphicsCore.preferredUpdatePolicy=J)};N.destroy=function(){this.handles.removeAll();this.updatingHandles.removeAll();this._set("frustumVisibility",r.destroyMaybe(this.frustumVisibility));this._set("scaleVisibility",r.destroyMaybe(this.scaleVisibility));this._set("filterVisibility",r.destroyMaybe(this.filterVisibility));this._set("elevationAlignment",
r.destroyMaybe(this.elevationAlignment));this._set("objectStates",r.destroyMaybe(this.objectStates));this._set("graphicsCore",r.destroyMaybe(this.graphicsCore));this._set("owner",null)};N.setup=function(){var M=a._asyncToGenerator(function*(){r.isSome(this.frustumVisibility)&&this.frustumVisibility.setup(this);const L=this.owner,J=this.owner.view.basemapTerrain,H=(I,O,Q)=>this.graphicsCore.spatialIndex.queryGraphicUIDsInExtent(I,O,Q);this.scaleVisibility&&this.scaleVisibility.setup(this,this.layer,
H,this.graphicsCore,J);r.isSome(this.filterVisibility)&&("filter"in L||"timeExtent"in L)&&this.filterVisibility.setup(L,this.graphicsCore);this.elevationAlignment&&this.elevationAlignment.setup(this,H,this.graphicsCore,L.view.elevationProvider);this._set("objectStates",new p.Graphics3DObjectStates(this.graphicsCore));this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility));this._set("deconfliction",L.view.deconflictor.addGraphicsOwner(this.graphicsCore));
yield n.logOnError(this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,filterVisibility:this.filterVisibility,deconflictor:this.deconfliction,labeler:this.labeling,objectStates:this.objectStates}));this.updatingHandles.add(()=>this.layer.renderer,I=>this.updatingHandles.addPromise(this.graphicsCore.rendererChange(I)));this.updatingHandles.add(()=>L.fullOpacity,()=>this.graphicsCore.opacityChange());this._setupSuspendResumeExtent();this.updateClippingExtent&&
(this.updatingHandles.add(()=>L.view.clippingArea,()=>this._updateClippingExtent()),this._updateClippingExtent());this.graphicsCore.startCreateGraphics();this.graphicsCore.labelsEnabled&&(yield n.logOnError(this.graphicsCore.updateLabelingInfo()))});return function(){return M.apply(this,arguments)}}();N.maskOccludee=function(M){const {set:L,handle:J}=this.objectStates.acquireSet(F.Object3DState.MaskOccludee,null);this.objectStates.setUid(L,M.uid);return J};N.highlight=function(M,L){if(M instanceof
x){const {set:J,handle:H}=this.objectStates.acquireSet(F.Object3DState.Highlight,L);this.owner.queryObjectIds(M).then(I=>this.objectStates.setObjectIds(J,I));return H}if("number"===typeof M||"string"===typeof M||M instanceof c)return this.highlight([M],L);"toArray"in M&&(M=M.toArray());if(Array.isArray(M)&&0<M.length){if(M[0]instanceof c)if(null!=E.attributeLookup(this.layer.fieldsIndex,M[0].attributes,L))M=M.map(J=>E.attributeLookup(this.layer.fieldsIndex,J.attributes,L));else{M=M.map(I=>I.uid);
const {set:J,handle:H}=this.objectStates.acquireSet(F.Object3DState.Highlight,null);this.objectStates.setUids(J,M);return H}if("number"===typeof M[0]||"string"===typeof M[0]){const {set:J,handle:H}=this.objectStates.acquireSet(F.Object3DState.Highlight,L);this.objectStates.setObjectIds(J,M);return H}}return G};N.whenGraphicBounds=function(M,L){var J;return null==(J=this.graphicsCore)?void 0:J.whenGraphicBounds(M,L)};N.computeAttachmentOrigin=function(M,L){var J;return null==(J=this.graphicsCore)?
void 0:J.computeAttachmentOrigin(M,L)};N.notifyGraphicGeometryChanged=function(M){this.graphicsCore.notifyGraphicGeometryChanged(M)};N.notifyGraphicVisibilityChanged=function(M){this.graphicsCore.notifyGraphicVisibilityChanged(M)};N.getRenderingInfo=function(M,L,J){M=t.getRenderingInfo(M,{renderer:L,arcade:J});r.isSome(M)&&M.color&&(L=M.color,L[0]/=255,L[1]/=255,L[2]/=255);return M};N.getRenderingInfoAsync=function(M,L,J,H){return t.getRenderingInfoAsync(M,{renderer:L,arcade:J,...H})};N.getSymbolLayerSize=
function(M,L){var J;return null==(J=this.graphicsCore)?void 0:J.getSymbolLayerSize(M,L)};N.setObjectIdVisibility=function(M,L){var J;null==(J=this.graphicsCore)?void 0:J.setObjectIdVisibility(M,L)};N._updateClippingExtent=function(){const M=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(M,this.owner.view.spatialReference)&&(this.updateClippingExtent(M)||this.graphicsCore.recreateAllGraphics())};N._setupSuspendResumeExtent=function(){(this.frustumVisibility||this.scaleVisibility)&&
this.handles.add(g.watch(()=>this.suspendResumeExtentMode,()=>{this.handles.remove("suspendResumeExtentMode");switch(this.suspendResumeExtentMode){case "computed":this.handles.add([g.watch(()=>this.graphicsCore.computedExtent,M=>this._updateSuspendResumeExtent(M),g.initial),g.watch(()=>this.graphicsCore.extentPadding,()=>this._updateSuspendResumeExtent(this.graphicsCore.computedExtent))],"suspendResumeExtentMode");break;case "data":this.handles.add([g.when(()=>this.dataExtent,M=>this._updateSuspendResumeExtent(M),
g.initial),g.watch(()=>this.graphicsCore.extentPadding,()=>this._updateSuspendResumeExtent(r.unwrap(this.dataExtent)))],"suspendResumeExtentMode");break;default:m.neverReached(this.suspendResumeExtentMode)}},g.initial))};N._updateSuspendResumeExtent=function(M){M?this._suspendResumeExtentChanged(this._extentToSuspendResumeRect(M,this.suspendResumeExtent)):this._suspendResumeExtentChanged(null)};N._extentToSuspendResumeRect=function(M,L){const J=this.owner.view.spatialReference;if(!M.spatialReference.equals(J)){if(!w.canProject(M,
J))return;M=w.project(M,J)}return D.enlargeExtent(M,L,q.SUSPEND_RESUME_EXTENT_OPTIMISM,this.graphicsCore.extentPadding)};N._suspendResumeExtentChanged=function(M){r.isSome(this.frustumVisibility)&&this.frustumVisibility.setExtent(M);this.scaleVisibility&&this.scaleVisibility.setExtent(M)};a._createClass(K,[{key:"layer",get:function(){return this.owner.layer}},{key:"suspendResumeExtentMode",get:function(){return"suspendResumeExtentMode"in this.owner?this.owner.suspendResumeExtentMode:"computed"}},
{key:"scaleVisibilitySuspended",get:function(){var M;return null==(M=this.scaleVisibility)?void 0:M.suspended}},{key:"suspended",get:function(){return this.owner.suspended}},{key:"legendEnabled",get:function(){return r.isNone(this.frustumVisibility)||!this.frustumVisibility.suspended}},{key:"suspendInfo",get:function(){var M;const L={};null!=(M=this.scaleVisibility)&&M.suspended&&(L.outsideScaleRange=!0);r.isSome(this.frustumVisibility)&&this.frustumVisibility.suspended&&(L.outsideOfView=!0);return L}},
{key:"updating",get:function(){var M,L;return!!(null!=(M=this.graphicsCore)&&M.updating||r.isSome(this.frustumVisibility)&&this.frustumVisibility.updating||null!=(L=this.updatingHandles)&&L.updating)}},{key:"updatingRemaining",get:function(){var M,L;return null!=(M=null==(L=this.graphicsCore)?void 0:L.updatingRemaining)?M:0}},{key:"featureStore",get:function(){var M;return null==(M=this.graphicsCore)?void 0:M.featureStore}},{key:"view",get:function(){return this.owner.view}},{key:"loadedGraphics",
get:function(){return this.owner.loadedGraphics}},{key:"fullOpacity",get:function(){var M;return null==(M=this.owner)?void 0:M.fullOpacity}},{key:"filter",get:function(){return"filter"in this.owner?this.owner.filter:null}},{key:"slicePlaneEnabled",get:function(){return this.owner.slicePlaneEnabled}},{key:"updatePolicy",get:function(){return this.owner.updatePolicy}},{key:"featureSpatialReference",get:function(){return"featureSpatialReference"in this.owner?this.owner.featureSpatialReference:this.owner.view.spatialReference}},
{key:"graphics3DGraphics",get:function(){var M;return null==(M=this.graphicsCore)?void 0:M.graphics3DGraphics}},{key:"graphics3DGraphicsByObjectID",get:function(){var M;return null==(M=this.graphicsCore)?void 0:M.graphics3DGraphicsByObjectID}},{key:"symbolUpdateType",get:function(){var M;return null==(M=this.graphicsCore)?void 0:M.symbolUpdateType}},{key:"displayFeatureLimit",get:function(){var M;const L=this.view.resourceController.memoryController.memoryFactor,J=null==(M=this.graphicsCore)?void 0:
M.displayFeatureLimit;return 1===L?J:{...J,maximumNumberOfFeatures:Math.ceil(J.maximumNumberOfFeatures*L),maximumTotalNumberOfFeatures:Math.ceil(J.maximumTotalNumberOfFeatures*L),minimumTotalNumberOfFeatures:Math.ceil(J.minimumTotalNumberOfFeatures*L)}}},{key:"usedMemory",get:function(){var M,L;return null!=(M=null==(L=this.graphicsCore)?void 0:L.usedMemory)?M:0}},{key:"usedMemoryPerFeature",get:function(){var M,L;return null!=(M=null==(L=this.graphicsCore)?void 0:L.usedMemoryPerGraphic)?M:0}},{key:"unprocessedMemoryEstimate",
get:function(){var M,L;return null!=(M=null==(L=this.graphicsCore)?void 0:L.unprocessedMemoryEstimate)?M:0}},{key:"performanceInfo",get:function(){return{core:this.graphicsCore.performanceInfo,elevationUpdating:this.elevationAlignment.updating,visibilityFrustum:r.isNone(this.frustumVisibility)||!this.frustumVisibility.suspended,visibilityScale:!this.scaleVisibility.suspended}}}]);return K}(l.HandleOwner);b.__decorate([k.property()],l.prototype,"type",void 0);b.__decorate([k.property({constructOnly:!0})],
l.prototype,"owner",void 0);b.__decorate([k.property()],l.prototype,"layer",null);b.__decorate([k.property({constructOnly:!0})],l.prototype,"updateClippingExtent",void 0);b.__decorate([k.property({constructOnly:!0})],l.prototype,"elevationFeatureExpressionEnabled",void 0);b.__decorate([k.property({constructOnly:!0})],l.prototype,"graphicsCore",void 0);b.__decorate([k.property({constructOnly:!0})],l.prototype,"scaleVisibility",void 0);b.__decorate([k.property({constructOnly:!0})],l.prototype,"filterVisibility",
void 0);b.__decorate([k.property({constructOnly:!0})],l.prototype,"elevationAlignment",void 0);b.__decorate([k.property({constructOnly:!0})],l.prototype,"frustumVisibility",void 0);b.__decorate([k.property({readOnly:!0})],l.prototype,"deconfliction",void 0);b.__decorate([k.property({readOnly:!0})],l.prototype,"labeling",void 0);b.__decorate([k.property({readOnly:!0})],l.prototype,"objectStates",void 0);b.__decorate([k.property()],l.prototype,"suspendResumeExtentMode",null);b.__decorate([k.property()],
l.prototype,"dataExtent",void 0);b.__decorate([k.property()],l.prototype,"scaleVisibilitySuspended",null);b.__decorate([k.property()],l.prototype,"suspended",null);b.__decorate([k.property()],l.prototype,"legendEnabled",null);b.__decorate([k.property()],l.prototype,"suspendInfo",null);b.__decorate([k.property()],l.prototype,"updating",null);b.__decorate([k.property()],l.prototype,"updatingRemaining",null);b.__decorate([k.property()],l.prototype,"featureStore",null);b.__decorate([k.property()],l.prototype,
"view",null);b.__decorate([k.property()],l.prototype,"loadedGraphics",null);b.__decorate([k.property()],l.prototype,"fullOpacity",null);b.__decorate([k.property()],l.prototype,"filter",null);b.__decorate([k.property()],l.prototype,"slicePlaneEnabled",null);b.__decorate([k.property()],l.prototype,"drapeSourceType",void 0);b.__decorate([k.property()],l.prototype,"updatePolicy",null);b.__decorate([k.property()],l.prototype,"preferredUpdatePolicy",void 0);b.__decorate([k.property()],l.prototype,"displayFeatureLimit",
null);l=b.__decorate([h.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureProcessor")],l);const G={remove(){},pause(){},resume(){}};return l})},"esri/views/3d/layers/graphics/Graphics3DCore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../renderers/ClassBreaksRenderer ../../../../renderers/DictionaryRenderer ../../../../renderers/DotDensityRenderer ../../../../renderers/HeatmapRenderer ../../../../renderers/PieChartRenderer ../../../../renderers/Renderer ../../../../renderers/SimpleRenderer ../../../../renderers/UniqueValueRenderer ../../../../renderers/support/jsonUtils ../../../../symbols ../../../../core/Accessor ../../../../core/has ../../../../core/Error ../../../../core/Handles ../../../../core/handleUtils ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../core/accessorSupport/diffUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/Layer ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures ../../../../renderers/support/rendererConversion ../../../../support/arcadeOnDemand ../../../../symbols/support/defaults3D ../../../../symbols/support/symbolConversion ./ElevationQuery ./enums ./featureExpressionInfoUtils ./Graphics3DFeatureStore ./Graphics3DGraphicCreationContext ./Graphics3DSymbolCreationContext ./Graphics3DSymbolFactory ./Graphics3DWebStyleSymbol ./GraphicStateTracking ./graphicUtils ./interfaces ./Loadable ./SpatialIndex2D ./symbolComplexity ../support/StageLayerElevationProvider ../../support/extentUtils ../../support/PropertiesPool ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/GridLocalOriginFactory ../../webgl-engine/lib/WebGLLayer ../../../support/Scheduler ../../../../geometry/Extent ../../../../geometry/Point ../../../../symbols/LabelSymbol3D ../../../../symbols/TextSymbol ../../../../symbols/WebStyleSymbol".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N,M,L,J,H,I,O,Q,S,T,U,aa,W,R,V,da,ca,ha,ia,ka,la,Y,ea,ba,Z,fa,ja,oa,sa,qa,Ha,Ga,pa,Da,ra,Ea,Ia,Ma){var Qa;const wa=M.create(),Ja=J.create(),Ta=u.getLogger("esri.views.3d.layers.graphics.Graphics3DCore");a.Graphics3DCore=Qa=function(Oa){function Va(za){var ya=Oa.call(this,za)||this;ya.propertiesPool=new sa.PropertiesPool({computedExtent:Da},b._assertThisInitialized(ya));ya.computedExtent=null;ya.currentRenderer=null;ya.rendererHasGeometryOperations=
!1;ya.graphicStateTracking=null;ya.symbolCreationContext=new ha.Graphics3DSymbolCreationContext((Na,Wa)=>ya._frameTask.schedule(Na,Wa));ya.graphics3DGraphics=new Map;ya.stageLayer=null;ya.stage=null;ya.graphicsDrapedUids=new Set;ya.graphicsBySymbol=new Map;ya.symbolConversionCache=new Map;ya.symbols=new Map;ya.graphicsWithoutSymbol=new Map;ya.graphicsWaitingForSymbol=new Map;ya.graphicsUpdateId=0;ya._handles=new B;ya._frameTask=pa.ImmediateTask;ya.suspendSymbolCleanup=!1;ya._viewSpatialReference=
null;ya.arcadeOnDemand=null;ya.rendererChangeAbortController=null;ya.elevationInfoChangeAbortController=null;ya.setupAbortController=null;ya.elevationAlignment=null;ya.scaleVisibility=null;ya._spatialIndex=null;ya.extentPadding=0;ya._updatingPendingLoadedGraphicsChange=null;ya.featureStore=null;ya.deconflictor=null;ya.labeler=null;ya.objectStates=null;ya.viewElevationProvider=null;ya.stageLayerElevationProvider=null;ya.sharedSymbolResourcesOwnerHandle=null;ya.whenGraphics3DGraphicRequests={};ya.pendingUpdates=
new Map;ya.numberOfGraphics=0;ya.numberOfGraphicsProvidingElevation=0;ya.pendingAdds=0;ya.pendingRemoves=0;ya._loadingSymbols=0;ya.pendingUpdatesPool=new A({allocator:Na=>Na||new ma,deallocator:Na=>{Na.clear();return Na}});ya.symbolWarningLogged=!1;ya.geometryWarningLogged=!1;ya.objectIdInvisibleSet=new Set;ya._whenSymbolRemoved=new A;ya.preferredUpdatePolicy=qa.UpdatePolicy.SYNC;ya.forcedUpdatePolicy=null;ya.elevationFeatureExpressionEnabled=!0;ya.owner=null;ya.layer=null;ya.graphicSymbolSupported=
!0;ya.getRenderingInfoWithoutRenderer=!1;ya.hasZ=null;ya.hasM=null;ya._usedMemory=0;ya._visible=void 0;ya._startCreateGraphics=!1;return ya}b._inheritsLoose(Va,Oa);var Ra=Va.prototype;Ra._getConvertedSymbol=function(za){if("web-style"===za.type)return za.clone();var ya=this.symbolConversionCache.get(za.id);if(z.isSome(ya))return ya;ya=aa.to3D(za,{retainId:!0,hasLabelingContext:this._hasLabelingContext(za)});const Na=ya.symbol||null;z.isNone(Na)&&ya.error&&Ta.error(ya.error.message);this.symbolConversionCache.set(za.id,
Na);return Na};Ra._getSymbolComplexitiesUsedOrRenderer=function(za){if(z.isNone(za))return[];var ya=za.getSymbols(),Na="backgroundFillSymbol"in za&&za.backgroundFillSymbol;if(!(Na||ya&&ya.length))return[];za=[];Na=this._getSymbolComplexityUsedOrRenderer(Na);z.isSome(Na)&&za.push(Na);for(const Wa of ya)ya=this._getSymbolComplexityUsedOrRenderer(Wa),z.isSome(ya)&&za.push(ya);return za};Ra._getSymbolComplexityUsedOrRenderer=function(za){if(z.isNone(za))return null;const ya=this.symbols.get(za.id);if(z.isSome(ya))return ya.complexity;
za=this._getConvertedSymbol(za);return z.isSome(za)?fa.defaultSymbolComplexity(za):null};Ra._getSymbolComplexitiesUsed=function(){const za=[];this.symbols.forEach(ya=>{z.isSome(ya)&&za.push(ya.complexity)});return za};Ra.initialize=function(){this._viewSpatialReference=this.owner.view.spatialReference;this._set("featureStore",new da.Graphics3DFeatureStore({objectIdField:this.owner.layer&&this.owner.layer.objectIdField,hasZ:this.hasZ,hasM:this.hasM,viewSpatialReference:this._viewSpatialReference,featureSpatialReference:this.owner.featureSpatialReference,
getSpatialIndex:()=>this.spatialIndex,forEach:za=>this.graphics3DGraphics.forEach(za),toArray:()=>Array.from(this.graphics3DGraphics.values())}))};Ra.setup=function(){var za=b._asyncToGenerator(function*(ya){this.setupAbortController=new AbortController;const Na=this.setupAbortController.signal;this._set("elevationAlignment",ya.elevationAlignment);this._set("scaleVisibility",ya.scaleVisibility);this._set("filterVisibility",ya.filterVisibility);this._set("deconflictor",ya.deconflictor);this._set("labeler",
ya.labeler);this._set("objectStates",ya.objectStates);const Wa=this.owner.view;this.viewElevationProvider=new W.ViewElevationProvider(this._viewSpatialReference,Wa);this._initializeStage(Wa,this.layer.uid);this.symbolCreationContext.sharedResources=Wa.sharedSymbolResources;this.sharedSymbolResourcesOwnerHandle=Wa.sharedSymbolResources.addGraphicsOwner(this.owner);z.isSome(this.currentRenderer)&&(this.symbolCreationContext.renderer=this.currentRenderer);this.symbolCreationContext.stage=this.stage;
this.symbolCreationContext.streamDataRequester=Wa.sharedSymbolResources.streamDataRequester;this.symbolCreationContext.renderCoordsHelper=Wa.renderCoordsHelper;this.symbolCreationContext.layer=this.layer;this.symbolCreationContext.graphicsCoreOwner=this.owner;this.symbolCreationContext.localOriginFactory=new Ha.GridLocalOriginFactory(Wa.renderSpatialReference);this.symbolCreationContext.elevationProvider=Wa.elevationProvider;this.symbolCreationContext.notifyGraphicGeometryChanged=bb=>this.notifyGraphicGeometryChanged(bb);
this.symbolCreationContext.notifyGraphicVisibilityChanged=bb=>this.notifyGraphicVisibilityChanged(bb);ya=V.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=yield V.createContext(ya,this._viewSpatialReference,Ta);p.throwIfAborted(Na);this.symbolCreationContext.screenSizePerspectiveEnabled=Wa.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;this.symbolCreationContext.slicePlaneEnabled=
!!this.owner.slicePlaneEnabled;this.symbolCreationContext.physicalBasedRenderingEnabled=!!this.owner.view.qualitySettings.physicallyBasedRenderingEnabled;if("drapeSourceType"in this.owner){const {owner:bb}=this;this.symbolCreationContext.drapeSourceRenderer=Wa.basemapTerrain.overlayManager.registerGeometryDrapeSource(bb);this._handles.add(q.makeHandle(()=>Wa.basemapTerrain.overlayManager.unregisterDrapeSource(bb)))}this._handles.add([y.watch(()=>this.suspendedOrOutsideOfView,()=>this._frameTask.reschedule(()=>
this._updateLayerVisibility())),y.watch(()=>{var bb;return[null==(bb=this.layer)?void 0:bb.screenSizePerspectiveEnabled,this.owner.view.screenSizePerspectiveEnabled]},()=>{const bb=Wa.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;if(bb!==this.symbolCreationContext.screenSizePerspectiveEnabled){var Aa;this.symbolCreationContext.screenSizePerspectiveEnabled=bb;null==(Aa=this.labeler)?void 0:Aa.reset();this.recreateAllGraphicsAndSymbols()}}),y.watch(()=>this.owner.slicePlaneEnabled,
bb=>this._slicePlaneEnabledChange(!!bb)),y.watch(()=>{var bb;return null==(bb=this.owner.view.state)?void 0:bb.pixelRatio},()=>this._pixelRatioChange()),y.watch(()=>{var bb;return null==(bb=this.owner.view.qualitySettings)?void 0:bb.physicallyBasedRenderingEnabled},bb=>this._physicalBasedRenderingChange(bb)),y.when(()=>{var bb;return null==(bb=Wa.basemapTerrain)?void 0:bb.tilingScheme},bb=>{bb.spatialReference.equals(this.symbolCreationContext.overlaySR)||(this.symbolCreationContext.overlaySR=Wa.basemapTerrain.spatialReference);
this._handles.has("loaded-graphics")?this.recreateAllGraphics():this._handles.add([y.on(()=>{var Aa;return null==(Aa=this.owner)?void 0:Aa.loadedGraphics},"change",Aa=>{this._graphicsCollectionChanged(Aa);this._signalUpdatingDuringAsyncLoadedGraphicsChange()},{onListenerAdd:()=>{this.recreateAllGraphics();this._signalUpdatingDuringAsyncLoadedGraphicsChange()}})],"loaded-graphics")},{initial:!0}),y.watch(()=>this.effectiveUpdatePolicy,bb=>{z.isSome(this.stageLayer)&&(this.stageLayer.updatePolicy=bb);
this.symbolCreationContext.isAsync=this.effectiveUpdatePolicy===qa.UpdatePolicy.ASYNC;bb===qa.UpdatePolicy.SYNC&&this.runTask(pa.noBudget)},y.syncAndInitial)]);this._frameTask=Wa.resourceController.scheduler.registerTask(pa.TaskPriority.GRAPHICS_CORE,this);this.layer&&"featureReduction"in this.layer&&this._handles.add(y.watch(()=>this.layer.featureReduction,()=>this.deconflictor.featureReductionChange()));this.notifyChange("averageSymbolComplexity");try{yield this.rendererChange(this.layer.renderer)}catch{}p.throwIfAborted(Na);
this.setupAbortController=null});return function(ya){return za.apply(this,arguments)}}();Ra._abortSetup=function(){this.setupAbortController&&(this.setupAbortController.abort(),this.setupAbortController=null)};Ra.destroy=function(){this._abortSetup();this._abortRendererChange();this._abortElevationInfoChange();this.owner.view.deconflictor.removeGraphicsOwner(this);this.owner.view.labeler.removeGraphicsOwner(this);this._updatingPendingLoadedGraphicsChange=z.removeMaybe(this._updatingPendingLoadedGraphicsChange);
this.clear();this.graphicStateTracking=z.destroyMaybe(this.graphicStateTracking);this.stage&&(this.stage.remove(this.stageLayer),this.stage=this.stageLayer=null);this._handles=z.destroyMaybe(this._handles);this._frameTask.remove();this._frameTask=pa.ImmediateTask;this._viewSpatialReference=null;this._set("owner",null);for(const za in this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[za].reject(new x("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=
null;this.sharedSymbolResourcesOwnerHandle=z.removeMaybe(this.sharedSymbolResourcesOwnerHandle);this.propertiesPool=z.destroyMaybe(this.propertiesPool);this.pendingUpdatesPool=null;this.symbolConversionCache.clear();this.objectIdInvisibleSet.clear();this._spatialIndex=z.destroyMaybe(this._spatialIndex);this._set("featureStore",z.destroyMaybe(this.featureStore))};Ra.clear=function(){var za,ya;null==(za=this.objectStates)?void 0:za.allGraphicsDeleted();z.isSome(this.graphicStateTracking)&&this.graphicStateTracking.allGraphicsDeleted();
this.graphics3DGraphics.forEach(Na=>Na.destroy());null==(ya=this._spatialIndex)?void 0:ya.clear();this.graphics3DGraphics.clear();this._usedMemory=this.numberOfGraphics=0;this._updateLayerVisibility();this.symbols.forEach(z.destroyMaybe);this.symbols.clear();this.graphicsBySymbol.clear();this.graphicsWithoutSymbol.clear();this.graphicsWaitingForSymbol.clear();this.pendingUpdates.clear();this.pendingUpdatesPool.clear();this.pendingRemoves=this.pendingAdds=0;this.notifyChange("updating");this.notifyChange("running");
this.notifyChange("updatingRemaining");this.featureStore.events.emit("changed")};Ra._initializeStage=function(za,ya){this.stage=za._stage;this.stageLayer=new Ga.WebGLLayer({isPickable:!this.suspendedOrOutsideOfView,updatePolicy:this.effectiveUpdatePolicy},ya);this.stage.add(this.stageLayer);za=this.stageLayer.events;za.on("objectTransformation",Na=>this.notifyGraphicGeometryChanged(Na.metadata.graphicUid));za.on("visibilityChanged",Na=>this.notifyGraphicVisibilityChanged(Na.metadata.graphicUid));
za.on("objectGeometryAdded",Na=>this.notifyGraphicGeometryChanged(Na.object.metadata.graphicUid));za.on("objectGeometryRemoved",Na=>this.notifyGraphicGeometryChanged(Na.object.metadata.graphicUid));za.on("vertexAttrsUpdated",Na=>this.notifyGraphicGeometryChanged(Na.object.metadata.graphicUid))};Ra.notifyGraphicGeometryChanged=function(za){z.isNone(this.graphicStateTracking)||z.isNone(za)||(za=this.graphics3DGraphics.get(za))&&this.graphicStateTracking.updateGraphicGeometry(za)};Ra.notifyGraphicVisibilityChanged=
function(za){z.isNone(this.graphicStateTracking)||z.isNone(za)||(za=this.graphics3DGraphics.get(za))&&this.graphicStateTracking.updateGraphicVisibility(za)};Ra._updateLayerVisibility=function(){var za=this.numberOfGraphics>10*this.displayFeatureLimit.maximumNumberOfFeatures;za=!this.suspendedOrOutsideOfView&&!za;za!==this._visible&&((this._visible=za)?(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.isPickable=!1,this._hideAllGraphics()),this._updateStageLayerVisibility())};
Ra._updateStageLayerVisibility=function(){this.stageLayer.isVisible=this._visible&&(null==this.layer.opacity||0<this.layer.opacity)};Ra.getGraphics3DGraphicById=function(za){return this.graphics3DGraphics.get(za)};Ra.getGraphics3DGraphicByObjectId=function(za){var ya;return null!=(ya=this.owner.layer)&&ya.objectIdField?this._findGraphics3DGraphicByObjectId(za):null};Ra._getGraphicObjectID=function(za,ya=this.owner.layer&&this.owner.layer.objectIdField){return O.getObjectId(za,ya)};Ra.updateLabelingInfo=
function(){var za=b._asyncToGenerator(function*(ya){const Na=this.deconflictor&&this.deconflictor.labelingInfoChange(ya);ya=this.labeler&&this.labeler.labelingInfoChange(ya);yield p.eachAlways([Na,ya])});return function(ya){return za.apply(this,arguments)}}();Ra.updateVisibilityInfo=function(){this.deconflictor&&this.deconflictor.labelingInfoChange();this.labeler&&this.labeler.visibilityInfoChange()};Ra.runTask=function(za){this._frameTask.processQueue(za);this._applyPendingUpdates(za);this.notifyChange("running");
this.running||this.notifyChange("updating");this.notifyChange("updatingRemaining")};Ra.setObjectIdVisibility=function(za,ya){ya?this.objectIdInvisibleSet.delete(za):this.objectIdInvisibleSet.add(za);za=this._findGraphics3DGraphicByObjectId(za);z.isSome(za)&&this._updateUserVisibility(za)};Ra._findGraphics3DGraphicByObjectId=function(za){return C.findInMap(this.graphics3DGraphics,ya=>this._getGraphicObjectID(ya.graphic)===za)};Ra._updateUserVisibility=function(za){if(z.isNone(za))return!1;var ya=za.graphic;
const Na=this._getGraphicObjectID(ya);ya=ya.visible&&!this.owner.suspended&&(z.isNone(Na)||!this.objectIdInvisibleSet.has(Na));return za.setVisibilityFlag(R.VisibilityFlag.USER_SETTING,ya,R.VisibilityGroup.GRAPHIC)};Ra._whenGraphics3DGraphic=function(za){var ya=this.graphics3DGraphics.get(za.uid);if(ya)return Promise.resolve(ya);if(ya=this.whenGraphics3DGraphicRequests[za.uid])return ya.promise;ya=p.createDeferred();this.whenGraphics3DGraphicRequests[za.uid]=ya;return ya.promise};Ra._boundsForGraphics3DGraphic=
function(){var za=b._asyncToGenerator(function*(ya,Na){const Wa=this._viewSpatialReference,bb=this.owner.view.renderSpatialReference,Aa=this.owner.view.basemapTerrain.spatialReference;var Pa=this.viewElevationProvider?{service:this.viewElevationProvider,useViewElevation:z.isSome(Na)&&Na.useViewElevation,minDemResolution:z.isSome(Na)&&Na.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}:null;ya=yield ya.getProjectedBoundingBox((ab,fb,hb)=>L.projectBuffer(ab,bb,fb,ab,Wa,fb,hb),
(ab,fb,hb)=>L.projectBuffer(ab,Aa,fb,ab,Wa,fb,hb),Pa,z.get(Na,"signal"));if(!ya)return null;Na=ya.boundingBox;ya.requiresDrapedElevation&&(Pa=this.symbolCreationContext.elevationProvider)&&(J.center(Na,wa),Pa=z.unwrapOr(Pa.getElevation(wa[0],wa[1],0,Wa,"ground"),0),Na[2]=Math.min(Na[2],Pa),Na[5]=Math.max(Na[5],Pa));return{boundingBox:Na,screenSpaceObjects:ya.screenSpaceObjects}});return function(ya,Na){return za.apply(this,arguments)}}();Ra.whenGraphicBounds=function(){var za=b._asyncToGenerator(function*(ya,
Na){yield y.whenOnce(()=>{var Aa;return null==(Aa=this.owner)?void 0:Aa.loadedGraphics});const Wa=this.owner.layer&&this.owner.layer.objectIdField;var bb=this.owner.loadedGraphics.find(Aa=>Aa===ya?!0:Wa&&Aa.attributes&&ya.attributes&&Aa.attributes[Wa]===ya.attributes[Wa]);if(!bb)throw new x("internal:graphic-not-part-of-view","Graphic is not part of this view");bb=yield this._whenGraphics3DGraphic(bb);return this._boundsForGraphics3DGraphic(bb,Na)});return function(ya,Na){return za.apply(this,arguments)}}();
Ra.computeAttachmentOrigin=function(za,ya){za=this.graphics3DGraphics.get(za.uid);if(!za)return null;var Na=za.computeAttachmentOrigin();if(0===Na.render.num&&0===Na.draped.num)return null;N.set($a,0,0,0);za=0;if(0<Na.render.num){if(!L.projectVectorToVector(Na.render.origin,this.symbolCreationContext.renderCoordsHelper.spatialReference,xa,ya))return null;N.add($a,$a,xa);za++}if(0<Na.draped.num){const [Wa,bb]=Na.draped.origin;Na=z.unwrapOr(this.viewElevationProvider.getElevation(Wa,bb,"ground"),0);
N.set(xa,Wa,bb,Na);if(!L.projectVectorToVector(xa,this.viewElevationProvider.spatialReference,xa,ya))return null;N.add($a,$a,xa);za++}1<za&&N.scale($a,$a,1/za);return new ra({x:$a[0],y:$a[1],z:$a[2],spatialReference:ya})};Ra.getSymbolLayerSize=function(za,ya){var Na=this.symbols.get(za.id);if(z.isNone(Na))throw new x("internal:symbol-not-part-of-view","Symbol is not part of this view");za=za.symbolLayers.indexOf(ya);if(-1===za)throw new x("internal:missing-symbol-layer","Symbol layer is not in symbol");
Na=Na.getSymbolLayerSize(za);if(null==Na)throw new x("internal:missing-size","Symbol layer has no valid size");return Na};Ra._graphicsCollectionChanged=function(za){this._startCreateGraphics&&(this.add(za.added),this.remove(za.removed))};Ra.graphicUpdateHandler=function(za){const ya=za.graphic.uid,Na=this.graphics3DGraphics.get(ya);if(!z.isNone(Na)||!z.isNone(this.graphicsWithoutSymbol.get(ya)))switch(za.property){case "visible":this._graphicUpdateVisibleHandler(Na);break;case "geometry":this._graphicUpdateGeometryHandler(Na,
za);break;case "symbol":this._graphicUpdateSymbolHandler(Na,za);break;case "transform":this._graphicUpdateTransformHandler(Na,za)}};Ra._graphicUpdateGeometryHandler=function(za,ya){const Na=ya.graphic.geometry;if(z.isNone(Na))this._recreateGraphic(ya.graphic);else if(z.isNone(za)){if(za=ya.graphic.symbol&&ya.graphic.symbol.id)if(za=this.symbols.get(za),z.isSome(za)&&za.loadStatus===ba.LoadStatus.LOADING)return;this._recreateGraphic(ya.graphic)}else{var Wa=za.graphics3DSymbol;!z.isNone(ya.newValue)&&
Wa.updateGeometry(za,ya.newValue)||this._recreateGraphic(za.graphic);this._expandComputedExtent(Na)}};Ra._graphicUpdateSymbolHandler=function(za,ya){var Na=ya.graphic;const Wa=z.isSome(za)?za.graphics3DSymbol:z.isSome(ya.oldValue)?this.symbols.get(ya.oldValue.id):null;if(z.isNone(Wa)||z.isNone(ya.newValue))this._recreateGraphic(Na);else{var bb=Wa.symbol;ya=this._getConvertedSymbol(ya.newValue);if(z.isSome(ya)&&(ya.type!==bb.type||"web-style"===ya.type)||"web-style"===bb.type)this._recreateGraphic(Na);
else{var Aa=this.graphicsBySymbol.get(bb.id);if(Aa&&1!==Aa.size)this._recreateGraphic(Na);else if(Aa=K.diff(bb,ya),z.isNone(Aa))this._updateSymbolMapping(bb.id,ya);else if(Aa={diff:Aa,graphics3DGraphicPatches:[],symbolStatePatches:[]},Wa.prepareSymbolPatch(Aa),K.isEmpty(Aa.diff)){var Pa=this._getRenderingInfo(Na);if(z.isNone(Pa))this._recreateGraphic(Na);else{Na=Wa.extentPadding;for(const ab of Aa.symbolStatePatches)ab();Na!==Wa.extentPadding&&this._recomputeExtentPadding();if(z.isSome(za))for(const ab of Aa.graphics3DGraphicPatches)ab(za,
Pa);this._updateSymbolMapping(bb.id,ya)}}else this._recreateGraphic(Na)}}};Ra._graphicUpdateVisibleHandler=function(za){this._updateUserVisibility(za)&&(this.labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty())};Ra._graphicUpdateTransformHandler=function(za,ya){};Ra.recreateGraphics=function(za){this.suspendSymbolCleanup=!0;this.remove(za);this.add(za);this.suspendSymbolCleanup=!1;this.effectiveUpdatePolicy===qa.UpdatePolicy.SYNC&&this._cleanupSymbols()};Ra._recreateGraphic=
function(za){this.recreateGraphics([za])};Ra._beginGraphicUpdate=function(za){const ya=this.graphicsUpdateId;this.graphicsUpdateId++;this.graphicsWaitingForSymbol.set(za.uid,ya);1===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating");return ya};Ra._endGraphicUpdate=function(za){za&&(this.graphicsWaitingForSymbol.delete(za.uid),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating")))};Ra._recomputeExtentPadding=function(){let za=0;this.symbols.forEach(ya=>
{z.isSome(ya)&&(za=Math.max(za,ya.extentPadding))});this._set("extentPadding",za)};Ra._expandComputedExtent=function(za){var ya=za.spatialReference;O.computeAABB(za,Ja);za=this._viewSpatialReference;var Na=Qa.tmpVec;!ya.equals(za)&&L.projectXYZToVector(Ja[0],Ja[1],0,ya,Na,za)&&(Ja[0]=Na[0],Ja[1]=Na[1],L.projectXYZToVector(Ja[3],Ja[4],0,ya,Na,za),Ja[3]=Na[0],Ja[4]=Na[1]);if(isFinite(Ja[0])&&isFinite(Ja[3])&&isFinite(Ja[1])&&isFinite(Ja[4])){ya=this.computedExtent;Na=null;var Wa=isFinite(Ja[2])&&isFinite(Ja[5]),
bb=Wa&&(!ya||null==ya.zmin||Ja[2]<ya.zmin);Wa=Wa&&(!ya||null==ya.zmax||Ja[5]>ya.zmax);if(ya){if(Ja[0]<ya.xmin||Ja[1]<ya.ymin||Ja[3]>ya.xmax||Ja[4]>ya.ymax||bb||Wa)Na=this.propertiesPool.get("computedExtent"),Na.xmin=Math.min(Ja[0],ya.xmin),Na.ymin=Math.min(Ja[1],ya.ymin),Na.xmax=Math.max(Ja[3],ya.xmax),Na.ymax=Math.max(Ja[4],ya.ymax),Na.spatialReference=za}else Na=this.propertiesPool.get("computedExtent"),Na.xmin=Ja[0],Na.ymin=Ja[1],Na.xmax=Ja[3],Na.ymax=Ja[4],Na.spatialReference=za;Na&&(bb&&(Na.zmin=
Ja[2]),Wa&&(Na.zmax=Ja[5]),this._set("computedExtent",Na))}};Ra._abortElevationInfoChange=function(){this.elevationInfoChangeAbortController&&(this.elevationInfoChangeAbortController.abort(),this.elevationInfoChangeAbortController=null)};Ra.elevationInfoChange=function(){var za=b._asyncToGenerator(function*(){var ya,Na;this._abortElevationInfoChange();const Wa=new AbortController;this.elevationInfoChangeAbortController=Wa;const bb=V.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);
this.symbolCreationContext.featureExpressionInfoContext=yield V.createContext(bb,this._viewSpatialReference,Ta);p.throwIfAborted(Wa);this.elevationInfoChangeAbortController=null;null==(ya=this.labeler)?void 0:ya.elevationInfoChange();this.forEachGraphics3DSymbol((Aa,Pa,ab)=>{Aa.globalPropertyChanged("elevationInfo",Pa)?Pa.forEach(fb=>{const hb=fb.graphic;fb=fb.labelGraphics;for(const kb of fb)kb.graphics3DSymbolLayer.updateGraphicElevationContext(hb,kb)}):this._recreateSymbol(ab)});this.updateStageLayerElevationProvider();
null==(Na=this.elevationAlignment)?void 0:Na.elevationInfoChange()});return function(){return za.apply(this,arguments)}}();Ra.updateStageLayerElevationProvider=function(){if(this.stageLayerElevationProvider){if(this.layer.elevationInfo&&"relative-to-scene"===this.layer.elevationInfo.mode||0===this.numberOfGraphicsProvidingElevation)this.owner.view.elevationProvider.unregister(this.stageLayerElevationProvider),this.stageLayerElevationProvider.dispose(),this.stageLayerElevationProvider=null}else(!this.layer.elevationInfo||
this.layer.elevationInfo&&"relative-to-scene"!==this.layer.elevationInfo.mode)&&0<this.numberOfGraphicsProvidingElevation&&(this.stageLayerElevationProvider=new ja.StageLayerElevationProvider({layer:this.layer,stageLayer:this.stageLayer,view:this.owner.view}),this.owner.view.elevationProvider.register("scene",this.stageLayerElevationProvider))};Ra._clearSymbolsAndGraphics=function(){var za,ya,Na,Wa;this.clear();z.isSome(this.filterVisibility)&&this.filterVisibility.clear();null==(za=this.labeler)?
void 0:za.reset();null==(ya=this.deconflictor)?void 0:ya.clear();null==(Na=this.elevationAlignment)?void 0:Na.clear();null==(Wa=this.stageLayer)?void 0:Wa.invalidateSpatialQueryAccelerator();this.stageLayerElevationProvider&&(this.owner.view.elevationProvider.unregister(this.stageLayerElevationProvider),this.stageLayerElevationProvider.dispose(),this.stageLayerElevationProvider=null)};Ra.startCreateGraphics=function(){this._startCreateGraphics=!0;this.recreateAllGraphics()};Ra.recreateAllGraphics=
function(){this._recreateAllGraphics(!1)};Ra.recreateAllGraphicsAndSymbols=function(){this._recreateAllGraphics(!0)};Ra._recreateAllGraphics=function(za=!1){if(this._startCreateGraphics){var {loadedGraphics:ya,view:Na}=this.owner,Wa=Na.basemapTerrain.tilingScheme&&ya&&ya.length?ya.toArray():null;!za&&Wa||this._clearSymbolsAndGraphics();this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;this.symbolCreationContext.slicePlaneEnabled=
!!this.owner.slicePlaneEnabled;this._set("computedExtent",null);Wa&&(za?this.add(Wa):this.recreateGraphics(Wa))}};Ra._recreateSymbol=function(za){var ya=this.graphicsBySymbol.get(za);const Na=[];ya&&(ya.forEach((Wa,bb)=>{var Aa;const Pa=Wa.usedMemory;this._conditionalRemove(Wa,bb);null==(Aa=this._spatialIndex)?void 0:Aa.remove(Wa);Na.push(Wa.graphic);Wa.destroy();this._removeGraphics3DGraphic(bb,Pa);this._updateLayerVisibility();this.featureStore.events.emit("changed")}),this.graphicsBySymbol.set(za,
new Map));ya=this.symbols.get(za);z.destroyMaybe(ya);this.symbols.delete(za);this.add(Na)};Ra._recreateGraphicsForSymbol=function(za){if(za=this.graphicsBySymbol.get(za)){const ya=[];za.forEach(Na=>ya.push(Na.graphic));this.recreateGraphics(ya)}};Ra._conditionalRemove=function(za,ya){var Na,Wa,bb;this.graphicsDrapedUids.delete(ya);null==(Na=this.objectStates)?void 0:Na.removeGraphic(za);null==(Wa=this.labeler)?void 0:Wa.removeGraphic(za);null==(bb=this.deconflictor)?void 0:bb.removeGraphic(za);z.isSome(this.graphicStateTracking)&&
this.graphicStateTracking.removeGraphic(za)};Ra.add=function(za){za&&0!==za.length&&(this.owner.view.basemapTerrain&&this.owner.view.basemapTerrain.tilingScheme?(this._updatePolicyForGraphics(za)===qa.UpdatePolicy.ASYNC?this._addDelayed(za):this._addImmediate(za),this.notifyChange("updating")):Ta.error("#add()","Cannot add graphics before terrain surface has been initialized"))};Ra._updatePolicyForGraphics=function(za){if(this.effectiveUpdatePolicy===qa.UpdatePolicy.SYNC&&("mesh"===this.layer.geometryType||
null==this.layer.geometryType))for(const ya of za)if(z.isSome(ya.geometry)&&"mesh"===ya.geometry.type&&!ya.geometry.loaded)return qa.UpdatePolicy.ASYNC;return this.effectiveUpdatePolicy};Ra._addImmediate=function(za){this.symbolWarningLogged=this.geometryWarningLogged=!1;for(const ya of za)this._addGraphic(ya,this._getRenderingInfo(ya,Ta),qa.UpdatePolicy.SYNC);this._cleanupSymbols();this.labeler&&(this.owner.view.labeler.setDirty(),this._cleanupSymbols());this.owner.view.deconflictor.setDirty()};
Ra._addDelayed=function(za){for(const ya of za){za=ya.uid;let Na=this.pendingUpdates.get(za);Na?Na.add?Na.state!==Xa.NEW&&Na.abortController.abort():this.pendingAdds++:(Na=this.pendingUpdatesPool.pushNew(),this.pendingAdds++,this.pendingUpdates.set(za,Na));Na.add=ya}this.notifyChange("running");this.notifyChange("updatingRemaining")};Ra.remove=function(za){this.effectiveUpdatePolicy===qa.UpdatePolicy.ASYNC?this._removeDelayed(za):this._removeImmediate(za);this.notifyChange("updating")};Ra._removeImmediate=
function(za){for(const ya of za)this._removeGraphic(ya);this._cleanupSymbols();this.labeler&&this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()};Ra._removeDelayed=function(za){for(const Na of za){za=Na.uid;var ya=this.pendingUpdates.get(za);ya?ya.add&&(ya.remove?ya.add=null:this.pendingUpdates.delete(za),ya.state===Xa.LOADING&&ya.abortController.abort(),this.pendingAdds--):(ya=this.pendingUpdatesPool.pushNew(),ya.remove=Na,this.pendingUpdates.set(za,ya),this.pendingRemoves++)}0===
this.pendingUpdates.size&&this._finishPendingUpdates();this.notifyChange("running");this.notifyChange("updatingRemaining")};Ra._finishPendingUpdates=function(){this.pendingUpdatesPool.clear();this._cleanupSymbols();(this.pendingAdds||this.pendingRemoves)&&Ta.warn("pendingAdds/Removes in inconsistent state!");this.pendingRemoves=this.pendingAdds=0};Ra._applyPendingUpdates=function(za){var ya;this.symbolWarningLogged=this.geometryWarningLogged=!1;if(0===this.pendingUpdates.size&&null!=(ya=this._spatialIndex)&&
ya.updating)this._spatialIndex.update();else{for(const [Na,Wa]of this.pendingUpdates){if(za.done)break;Wa.add&&Wa.state===Xa.NEW&&this._processPendingUpdateNew(Wa);ya=this.effectiveUpdatePolicy;!Wa.remove||Wa.add&&Wa.state!==Xa.READY||(this.pendingRemoves--,za.madeProgress(),this._removeGraphic(Wa.remove),Wa.remove=null,ya=qa.UpdatePolicy.SYNC);if(Wa.add)switch(Wa.state){case Xa.READY:this._addGraphic(Wa.add,Wa.renderingInfo,ya);Wa.add=null;this.pendingAdds--;za.madeProgress();break;case Xa.REJECTED:Wa.add=
null,this.pendingAdds--}null==Wa.remove&&null==Wa.add&&this.pendingUpdates.delete(Na)}0===this.pendingUpdates.size&&(this._finishPendingUpdates(),this.notifyChange("running"))}};Ra._processPendingUpdateNew=function(za){if(za.add){var ya=za.add.geometry;z.isSome(ya)&&"mesh"===ya.type&&!ya.loaded?this._processPendingUpdateNewMesh(za,ya):this._processPendingUpdateNewRenderingInfo(za)}else za.state=Xa.READY};Ra._processPendingUpdateNewMesh=function(){var za=b._asyncToGenerator(function*(ya,Na){ya.state=
Xa.LOADING;ya.abortController=new AbortController;const Wa=ya.abortController.signal;try{yield Na.load({signal:Wa})}catch(bb){return this._processPendingUpdateNewError(ya,bb)}ya.abortController=null;this._processPendingUpdateNewRenderingInfo(ya)});return function(ya,Na){return za.apply(this,arguments)}}();Ra._processPendingUpdateNewError=function(za,ya){za.abortController=null;p.isAbortError(ya)?za.state=Xa.NEW:za.state=Xa.REJECTED};Ra._processPendingUpdateNewRenderingInfo=function(){var za=b._asyncToGenerator(function*(ya){if(z.isNone(this.layer.renderer)||
"dictionary"!==this.layer.renderer.type)ya.renderingInfo=this._getRenderingInfo(ya.add,Ta);else{ya.state=Xa.LOADING;ya.abortController=new AbortController;var Na=null;try{Na=yield this._getRenderingInfoAsync(ya.add,{signal:ya.abortController.signal})}catch(Wa){ya.abortController=null;p.isAbortError(Wa)?ya.state=Xa.NEW:ya.state=Xa.REJECTED;return}z.isNone(Na)||z.isNone(Na.symbol)?(Ta&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,Ta.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),
ya.renderingInfo=null):ya.renderingInfo=Na}ya.state=Xa.READY});return function(ya){return za.apply(this,arguments)}}();Ra._addGraphic=function(za,ya,Na){this.graphicsWithoutSymbol.set(za.uid,za);if(!z.isNone(ya)&&!z.isNone(ya.symbol)&&O.hasGeometry(za)){var Wa=this.getOrCreateGraphics3DSymbol(ya.symbol,ya.renderer);if(!z.isNone(Wa)){this._expandComputedExtent(za.geometry);var bb=this._beginGraphicUpdate(za),Aa=new ca(za,ya,this.layer),Pa=!1,ab=kb=>{kb===Wa.symbol.id&&(Pa=!0)};this._whenSymbolRemoved.push(ab);
var fb=()=>{--this._loadingSymbols;if(!this.destroyed){this._whenSymbolRemoved.removeUnordered(ab);if(this.graphicsWaitingForSymbol.get(za.uid)!==bb||Pa||Wa.destroyed||this.graphicSymbolSupported&&za.symbol&&za.symbol.id!==Wa.symbol.id)--Wa.referenced,this._cleanupSymbols();else{const kb=this._createGraphics3DGraphic(Wa,Aa);this._spatialIndex&&z.isSome(kb)&&this._spatialIndex.add(kb);--Wa.referenced;this._endGraphicUpdate(za)}this.featureStore.events.emit("changed");this.labeler&&this.owner.view.labeler.setDirty()}},
hb=kb=>{--this._loadingSymbols;this.destroyed||(this._whenSymbolRemoved.removeUnordered(ab),Pa||(p.isAbortError(kb)?this.add([za]):Wa.destroyed||this._endGraphicUpdate(za)))};++this._loadingSymbols;Na===qa.UpdatePolicy.ASYNC?Wa.load(()=>this._frameTask.schedule(fb),kb=>this._frameTask.schedule(()=>hb(kb))):Wa.load(fb,hb)}}};Ra._removeGraphic=function(za){za=za.uid;const ya=this.graphics3DGraphics.get(za);if(ya){var Na;ya.graphics3DSymbol.onRemoveGraphic(ya);const Wa=ya.usedMemory,bb=ya.isElevationSource;
this._conditionalRemove(ya,za);null==(Na=this._spatialIndex)?void 0:Na.remove(ya);this.graphicsBySymbol.get(ya.graphics3DSymbol.symbol.id).delete(za);this.graphicsWithoutSymbol.delete(za);this._removeGraphics3DGraphic(za,Wa,bb);ya.destroy();this.featureStore.events.emit("changed")}else this.graphicsWithoutSymbol.delete(za),this.graphicsWaitingForSymbol.delete(za),0===this.graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating"))};Ra._hasLabelingContext=function(za){if(za instanceof
Ea||za instanceof Ia){const ya=this.symbolCreationContext.layer;return ya.labelingInfo?ya.labelingInfo.some(Na=>Na.symbol===za):!1}return!1};Ra._hasValidSymbolCreationContext=function(za){return za instanceof Ea&&!this._hasLabelingContext(za)?(Ta.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1):!0};Ra._getRenderingInfo=function(za,ya){const Na=za.geometry;if(z.isNone(Na))return ya&&!this.geometryWarningLogged&&(this.geometryWarningLogged=
!0,ya.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!L.canProjectWithoutEngine(Na.spatialReference,this._viewSpatialReference))return ya&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,ya.warn(`Graphic in layer ${this.layer.id} has incompatible spatial reference and will not render`)),null;if(!this.graphicSymbolSupported&&z.isSome(za.symbol))return ya&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,ya.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),
null;za=this.rendererHasGeometryOperations?Q.hydrateGraphic(za,this.layer):za;za=this.owner.getRenderingInfo&&(this.getRenderingInfoWithoutRenderer||z.isSome(this.currentRenderer))?this.owner.getRenderingInfo(za,this.currentRenderer,z.unwrap(this.arcadeOnDemand)):{symbol:za.symbol||U.getDefaultSymbol3D(za.geometry)};return z.isNone(za)||z.isNone(za.symbol)?(ya&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,ya.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),null):
za};Ra._getRenderingInfoAsync=function(za,ya){if(z.isNone(za.geometry))return Ta&&!this.geometryWarningLogged&&(this.geometryWarningLogged=!0,Ta.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!this.graphicSymbolSupported&&z.isSome(za.symbol))return Ta&&!this.symbolWarningLogged&&(this.symbolWarningLogged=!0,Ta.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;za=this.rendererHasGeometryOperations?Q.hydrateGraphic(za,
this.layer):za;return this.owner.getRenderingInfoAsync(za,z.unwrap(this.currentRenderer),z.unwrap(this.arcadeOnDemand),ya)};Ra._createGraphics3DSymbol=function(za,ya){if(!this._hasValidSymbolCreationContext(za))return null;za=this._getConvertedSymbol(za);if(!za)return null;let Na;z.isSome(ya)&&"backgroundFillSymbol"in ya&&ya.backgroundFillSymbol&&(ya=aa.to3D(ya.backgroundFillSymbol,{ignoreDrivers:!0}),z.isSome(ya.symbol)&&"web-style"!==ya.symbol.type&&"cim"!==ya.symbol.type&&(Na=ya.symbol.symbolLayers));
const Wa=ia.make(za,this.symbolCreationContext,Na);Wa.load(()=>{const bb=Wa.extentPadding;bb>this.extentPadding&&this._set("extentPadding",bb);this.notifyChange("averageSymbolComplexity")},()=>{});return Wa};Ra.getOrCreateGraphics3DSymbol=function(za,ya){let Na=this.symbols.get(za.id);void 0===Na&&(Na=za instanceof Ma?new ka(za,Wa=>this._frameTask.schedule(Wa),Wa=>this._createGraphics3DSymbol(Wa,ya)):this._createGraphics3DSymbol(za,ya),this.symbols.set(za.id,Na));z.isSome(Na)&&++Na.referenced;return Na};
Ra.trackGraphicState=function(za){z.isNone(this.graphicStateTracking)&&(this.graphicStateTracking=new la.GraphicStateTracking(this));return this.graphicStateTracking.add(za)};Ra._addGraphics3DGraphic=function(za){this._usedMemory+=za.usedMemory;this.graphics3DGraphics.set(za.graphic.uid,za);this.numberOfGraphics++;za.isElevationSource&&(this.numberOfGraphicsProvidingElevation++,this.updateStageLayerElevationProvider());this._updateLayerVisibility()};Ra._removeGraphics3DGraphic=function(za,ya,Na=!1){this._usedMemory-=
ya;this.graphics3DGraphics.delete(za);this.numberOfGraphics--;Na&&(this.numberOfGraphicsProvidingElevation--,this.updateStageLayerElevationProvider());this._updateLayerVisibility()};Ra._createGraphics3DGraphic=function(za,ya){var Na,Wa,bb;const Aa=ya.graphic;this.graphicsWithoutSymbol.delete(Aa.uid);if(!this.symbols.has(za.symbol.id))return this.add([Aa]),null;if(this.graphics3DGraphics.has(Aa.uid))return null;ya=za.createGraphics3DGraphic(ya);if(z.isNone(ya))return null;this._addGraphics3DGraphic(ya);
za=za.symbol.id;this.graphicsBySymbol.has(za)||this.graphicsBySymbol.set(za,new Map);this.graphicsBySymbol.get(za).set(Aa.uid,ya);ya.isDraped&&this.graphicsDrapedUids.add(Aa.uid);ya.centroid=null;z.isSome(Aa.geometry)&&"point"!==Aa.geometry.type&&(ya.centroid=Y.computeCentroid(Aa.geometry,this._viewSpatialReference));this._updateUserVisibility(ya);z.isSome(this.scaleVisibility)&&this.scaleVisibility.updateVisibility(ya);z.isSome(this.filterVisibility)&&this.filterVisibility.updateVisibility(ya);null==
(Na=this.deconflictor)?void 0:Na.addGraphic(ya);null==(Wa=this.labeler)?void 0:Wa.addGraphic(ya);null==(bb=this.objectStates)?void 0:bb.addGraphic(ya);this.deconflictor&&this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,ya);ya.initialize(this.stage,this.stageLayer,this.owner);z.isSome(this.graphicStateTracking)&&this.graphicStateTracking.addGraphic(ya);if(Na=this.whenGraphics3DGraphicRequests[Aa.uid])delete this.whenGraphics3DGraphicRequests[Aa.uid],Na.resolve(ya);return ya};Ra._abortRendererChange=
function(){this.rendererChangeAbortController&&(this.rendererChangeAbortController.abort(),this.rendererChangeAbortController=null)};Ra.rendererChange=function(){var za=b._asyncToGenerator(function*(ya){this._abortRendererChange();if(ya!==this.currentRenderer)if(this._validateRenderer(ya),z.isNone(ya)&&this._currentRendererChange(null,!1),S.isSupportedRenderer3D(ya))if(z.isSome(ya)&&ya.arcadeRequired){var Na=new AbortController;this.rendererChangeAbortController=Na;const {arcadeUtils:Wa}=yield this._ensureArcade();
p.throwIfAborted(Na);Wa.hasGeometryOperations(ya)&&(yield Wa.enableGeometryOperations(),p.throwIfAborted(Na));this.effectiveUpdatePolicy===qa.UpdatePolicy.ASYNC?yield this._frameTask.schedule(()=>this._currentRendererChange(ya,!0),Na.signal):this._currentRendererChange(ya,!0);this.rendererChangeAbortController=null}else this.effectiveUpdatePolicy===qa.UpdatePolicy.ASYNC?(this.rendererChangeAbortController=Na=new AbortController,yield this._frameTask.schedule(()=>this._currentRendererChange(ya,!1),
Na.signal),this.rendererChangeAbortController=null):this._currentRendererChange(ya,!1);else this._currentRendererChange(ya,!1)});return function(ya){return za.apply(this,arguments)}}();Ra._ensureArcade=function(){var za=b._asyncToGenerator(function*(){z.isNone(this.arcadeOnDemand)&&(this.arcadeOnDemand=yield T.loadArcade());return this.arcadeOnDemand});return function(){return za.apply(this,arguments)}}();Ra._currentRendererChange=function(za,ya){this.currentRenderer=za;this.rendererHasGeometryOperations=
ya;this.symbolCreationContext.arcade=z.unwrap(this.arcadeOnDemand);ya=this.symbolCreationContext.renderer;if(za!==ya)if(this.symbolConversionCache.clear(),z.isNone(za))this.symbolCreationContext.renderer=null,this.recreateAllGraphicsAndSymbols();else{var Na=K.diff(ya,za);this._updateUnchangedSymbolMappings(Na,za,ya);this.symbolCreationContext.renderer=za;z.isNone(Na)||("complete"===Na.type?this.recreateAllGraphicsAndSymbols():"partial"===Na.type&&(this._applyRendererDiff(Na,za,ya)?this._volatileGraphicsUpdated():
this.recreateAllGraphicsAndSymbols()),this.notifyChange("averageSymbolComplexity"))}};Ra._diffHasSymbolChange=function(za){for(const ya in za.diff)switch(ya){case "visualVariables":case "defaultSymbol":case "uniqueValueInfos":break;case "authoringInfo":case "fieldDelimiter":delete za.diff[ya];break;default:return!0}return!1};Ra._applySymbolSetDiff=function(za,ya,Na){za=za||[];ya=ya||[];const Wa=[];for(const bb of ya){const Aa=this.graphicsBySymbol.get(bb.id);Aa&&Aa.forEach((Pa,ab)=>{var fb=Pa.graphic,
hb=this.layer instanceof I?this.layer:null;const kb=z.unwrap(this.arcadeOnDemand);if(bb!==Na.defaultSymbol||Na.getSymbol(Q.hydrateGraphic(fb,hb),{arcade:kb})!==Na.defaultSymbol)hb=Pa.usedMemory,za.length||Na.defaultSymbol?Wa.push(fb):this.graphicsWithoutSymbol.set(ab,fb),fb=this.graphics3DGraphics.get(ab),this._conditionalRemove(fb,ab),Pa.destroy(),Aa.delete(ab),this._removeGraphics3DGraphic(ab,hb),this._updateLayerVisibility()});this._whenSymbolRemoved.forAll(Pa=>Pa(bb.id))}if(za.length||Wa.length)this.graphicsWithoutSymbol.forEach(bb=>
Wa.push(bb)),this.graphicsWithoutSymbol.clear(),this.add(Wa);this._cleanupSymbols();this.labeler&&this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()};Ra._applyUniqueValueRendererDiff=function(za,ya,Na){const Wa=za.diff.defaultSymbol,bb=za.diff.uniqueValueInfos;if(Wa||bb){const Aa=bb?bb.added.map(ab=>ab.symbol):[],Pa=bb?bb.removed.map(ab=>ab.symbol):[];if(bb)for(let ab=0;ab<bb.changed.length;ab++)Aa.push(bb.changed[ab].newValue.symbol),Pa.push(bb.changed[ab].oldValue.symbol);
Wa?(Na.defaultSymbol&&Pa.push(Na.defaultSymbol),ya.defaultSymbol&&Aa.push(ya.defaultSymbol)):Na.defaultSymbol&&Aa.length&&Pa.push(ya.defaultSymbol);this._applySymbolSetDiff(Aa,Pa,ya);delete za.diff.defaultSymbol;delete za.diff.uniqueValueInfos;return!0}return!1};Ra._calculateUnchangedSymbolMapping=function(za,ya,Na){if("unique-value"!==(null==ya?void 0:ya.type)||"unique-value"!==(null==Na?void 0:Na.type)||z.isSome(za)&&"partial"!==za.type)return[];const Wa=Aa=>z.isSome(Aa)?Aa.id:null;var bb=za&&za.diff;
za=bb&&bb.defaultSymbol;if(bb=bb&&bb.uniqueValueInfos)bb=bb.unchanged.map(Aa=>({oldId:Wa(Aa.oldValue.symbol),newId:Wa(Aa.newValue.symbol)}));else{bb=[];for(const Aa of Na.uniqueValueInfos){const Pa=Wa(Aa.symbol),ab=ya.uniqueValueInfos.find(fb=>fb.value===Aa.value);ab&&Pa!==Wa(ab.symbol)&&bb.push({oldId:Pa,newId:Wa(ab.symbol)})}}!za&&Na.defaultSymbol&&bb.push({oldId:Wa(Na.defaultSymbol),newId:Wa(ya.defaultSymbol)});return bb};Ra._updateSymbolMapping=function(za,ya){const Na=z.isSome(ya)&&ya?"string"===
typeof ya?ya:ya.id:null;if(za&&za!==Na){var Wa=this.graphicsBySymbol.get(za);this.graphicsBySymbol.delete(za);void 0!==Wa&&this.graphicsBySymbol.set(Na,Wa);Wa=this.symbols.get(za);void 0!==Wa&&(this.symbols.delete(za),this.symbols.set(Na,Wa),z.isSome(Wa)&&(za="string"===typeof ya?null:ya,z.isSome(za)?Wa.symbol=za:Wa.symbol.id=Na))}};Ra._updateUnchangedSymbolMappings=function(za,ya,Na){za=this._calculateUnchangedSymbolMapping(za,ya,Na);for(const {oldId:Wa,newId:bb}of za)this._updateSymbolMapping(Wa,
bb)};Ra._applyRendererDiff=function(za,ya,Na){if(this._diffHasSymbolChange(za))return!1;if(ya instanceof e&&Na instanceof e&&this._applyUniqueValueRendererDiff(za,ya,Na)&&0===Object.keys(za.diff).length)return!0;for(const [Wa]of this.graphicsBySymbol)if(Na=this.symbols.get(Wa),z.isSome(Na))switch(Na.applyRendererDiff(za,ya)){case ea.ApplyRendererDiffResult.Recreate_Symbol:this._recreateSymbol(Wa);break;case ea.ApplyRendererDiffResult.Recreate_Graphics:this._recreateGraphicsForSymbol(Wa)}return!0};
Ra.opacityChange=function(){this.forEachGraphics3DSymbol((za,ya)=>za.globalPropertyChanged("opacity",ya));this._updateStageLayerVisibility()};Ra._slicePlaneEnabledChange=function(za){za!==this.symbolCreationContext.slicePlaneEnabled&&(this.symbolCreationContext.slicePlaneEnabled=za,this.stageLayer.isSliceable=za,this.forEachGraphics3DSymbol((ya,Na)=>ya.globalPropertyChanged("slicePlaneEnabled",Na)),this.deconflictor&&this.deconflictor.slicePlaneEnabledChange(),this.labeler&&this.labeler.slicePlaneEnabledChange())};
Ra._physicalBasedRenderingChange=function(za){za!==this.symbolCreationContext.physicalBasedRenderingEnabled&&(this.symbolCreationContext.physicalBasedRenderingEnabled=za,this.forEachGraphics3DSymbol((ya,Na,Wa)=>{ya.globalPropertyChanged("physicalBasedRenderingEnabled",Na)||this._recreateSymbol(Wa)}))};Ra._pixelRatioChange=function(){this.forEachGraphics3DSymbol((za,ya,Na)=>{za.globalPropertyChanged("pixelRatio",ya)||this._recreateSymbol(Na)})};Ra._signalUpdatingDuringAsyncLoadedGraphicsChange=function(){this._updatingPendingLoadedGraphicsChange&&
this._updatingPendingLoadedGraphicsChange.remove();this._updatingPendingLoadedGraphicsChange=D.schedule(()=>{this._updatingPendingLoadedGraphicsChange=null})};Ra.setClippingExtent=function(za,ya){const Na=this.symbolCreationContext.clippingExtent,Wa=H.create();oa.toBoundingRect(za,Wa,ya)?this.symbolCreationContext.clippingExtent=J.fromRect(J.create(),Wa):this.symbolCreationContext.clippingExtent=null;return!J.equals(this.symbolCreationContext.clippingExtent,Na)};Ra.modifyGraphics3DGraphicVisibilities=
function(za){let ya=!1;this.graphics3DGraphics.forEach(Na=>{za(Na)&&(ya=!0)});ya&&(this.labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty())};Ra.forEachGraphics3DSymbol=function(za){for(const [ya,Na]of this.symbols){if(z.isNone(Na))break;const Wa=this.graphicsBySymbol.get(ya);za(Na,Wa||Ka,ya)}};Ra.updateAllGraphicsVisibility=function(){z.isSome(this.filterVisibility)&&(this.filterVisibility.dirty=!0);this.modifyGraphics3DGraphicVisibilities(za=>{const ya=this._updateUserVisibility(za);
za=z.isSome(this.scaleVisibility)&&this.scaleVisibility.updateVisibility(za);return ya||za})};Ra._hideAllGraphics=function(){this.modifyGraphics3DGraphicVisibilities(za=>za.setVisibilityFlag(R.VisibilityFlag.USER_SETTING,!1,R.VisibilityGroup.GRAPHIC))};Ra._validateRenderer=function(za){(za=S.validateTo3D(za))&&Ta.warn(`Renderer for layer '${this.layer.title?`${this.layer.title}, `:""}, id:${this.layer.id}' is not supported in a SceneView`,za.message)};Ra._volatileGraphicsUpdated=function(){var za;
null==(za=this.labeler)?void 0:za.reset();this.stageLayer.shaderTransformationChanged();this.notifyChange("updating")};Ra._cleanupSymbols=function(){if(!(0<this.graphicsWaitingForSymbol.size||this.suspendSymbolCleanup)){var za=!1;this.symbols.forEach((ya,Na)=>{if(!(z.isNone(ya)||0<ya.referenced)){var Wa=this.graphicsBySymbol.get(Na);Wa&&0!==Wa.size||(this.graphicsBySymbol.delete(Na),this.symbols.delete(Na),z.destroyMaybe(ya),za=!0)}});za&&(this._recomputeExtentPadding(),this.notifyChange("averageSymbolComplexity"))}};
b._createClass(Va,[{key:"spatialIndex",get:function(){if(!this._spatialIndex){var za;this._spatialIndex=new Z.SpatialIndex2D({objectIdField:null==(za=this.owner.layer)?void 0:za.objectIdField,spatialReference:this._viewSpatialReference,hasZ:this.hasZ,hasM:this.hasM});this._spatialIndex.setup(Array.from(this.graphics3DGraphics.values()))}this._spatialIndex.update();return this._spatialIndex}},{key:"effectiveUpdatePolicy",get:function(){return z.isSome(this.currentRenderer)&&"dictionary"===this.currentRenderer.type?
qa.UpdatePolicy.ASYNC:z.unwrapOr(this.forcedUpdatePolicy,this.preferredUpdatePolicy)}},{key:"updating",get:function(){var za;return!!(0<this.graphicsWaitingForSymbol.size||this.running||null!=(za=this.elevationAlignment)&&za.updating||z.isSome(this.scaleVisibility)&&this.scaleVisibility.updating||z.isSome(this.filterVisibility)&&this.filterVisibility.updating||this.rendererChangeAbortController||this.elevationInfoChangeAbortController||this._updatingPendingLoadedGraphicsChange||this._frameTask.updating||
0<this._loadingSymbols)}},{key:"running",get:function(){var za;return 0<this.pendingUpdates.size||!(null==(za=this._spatialIndex)||!za.updating)}},{key:"suspendedOrOutsideOfView",get:function(){var za;return this.owner.suspended||(null==(za=this.owner.suspendInfo)?void 0:za.outsideOfView)}},{key:"updatingRemaining",get:function(){var za,ya;return this.updating?this.pendingUpdates.size+.1*((null==(za=this._spatialIndex)?void 0:za.updatingRemaining)||0)+.1*((null==(ya=this.elevationAlignment)?void 0:
ya.updatingRemaining)||0):0}},{key:"displayFeatureLimit",get:function(){var za=this.owner&&this.owner.view&&this.owner.view.qualitySettings;const ya=za?za.graphics3D.minTotalNumberOfFeatures:0,Na=za?za.graphics3D.maxTotalNumberOfFeatures:0;za=za?za.graphics3D.maxTotalNumberOfPrimitives:0;const Wa=this.averageSymbolComplexity;var bb=Math.max(1,z.isSome(Wa)?Wa.primitivesPerFeature:1),Aa=z.isSome(Wa)&&0<Wa.drawCallsPerFeature?Na/Wa.drawCallsPerFeature*.3:Na;bb=Math.max(ya,Math.min(Na,Math.ceil(za/bb),
Aa));return(Aa=this._get("displayFeatureLimit"))&&Aa.minimumTotalNumberOfFeatures===ya&&Aa.maximumTotalNumberOfFeatures===Na&&Aa.maximumTotalNumberOfPrimitives===za&&Aa.averageSymbolComplexity===Wa&&Aa.maximumNumberOfFeatures===bb?Aa:{minimumTotalNumberOfFeatures:ya,maximumTotalNumberOfFeatures:Na,maximumTotalNumberOfPrimitives:za,averageSymbolComplexity:Wa,maximumNumberOfFeatures:bb}}},{key:"averageSymbolComplexity",get:function(){const za=fa.averageSymbolComplexities(this.symbolComplexities),ya=
this._get("averageSymbolComplexity");return 0===za.numComplexities||z.isSome(ya)&&(za.estimated&&(ya.primitivesPerFeature>=za.primitivesPerFeature||ya.primitivesPerCoordinate>=za.primitivesPerCoordinate||ya.drawCallsPerFeature>=za.drawCallsPerFeature)||ya.primitivesPerFeature===za.primitivesPerFeature&&ya.primitivesPerCoordinate===za.primitivesPerCoordinate&&ya.drawCallsPerFeature===za.drawCallsPerFeature)?ya:za}},{key:"usedMemory",get:function(){const za=z.isSome(this.averageSymbolComplexity)&&this.labelsEnabled?
this.averageSymbolComplexity.memory.bytesPerFeatureLabel*this.numberOfGraphics:0;return this._usedMemory+za}},{key:"usedMemoryPerGraphic",get:function(){return this._usedMemory&&this.numberOfGraphics?30<Math.abs(this.pendingAdds-this.pendingRemoves)/this.numberOfGraphics?0:this._usedMemory/this.numberOfGraphics:z.isSome(this.averageSymbolComplexity)?this.averageSymbolComplexity.memory.bytesPerFeature+(this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel:0):0}},{key:"unprocessedMemoryEstimate",
get:function(){return Math.max(0,(this.pendingAdds-this.pendingRemoves)*this.usedMemoryPerGraphic)}},{key:"symbolComplexities",get:function(){return this.currentRenderer?this._getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this._getSymbolComplexitiesUsed()}},{key:"graphics3DGraphicsByObjectID",get:function(){const za=this.owner.layer&&this.owner.layer.objectIdField;if(!za)return null;const ya=new Map;this.graphics3DGraphics.forEach(Na=>{if(Na){var Wa=this._getGraphicObjectID(Na.graphic,
za);z.isSome(Wa)&&ya.set(Wa,Na)}});return ya}},{key:"labelsEnabled",get:function(){return!(!this.labeler||!this.labeler.layerLabelsEnabled())}},{key:"symbolUpdateType",get:function(){if(0<this.pendingUpdates.size)return"unknown";let za=0,ya=0;return C.someMap(this.symbols,(Na,Wa)=>{if(z.isSome(Na)){Na=Na.getFastUpdateStatus();if(0<Na.loading)return!0;this.graphicsBySymbol.has(Wa)&&(ya+=Na.fast,za+=Na.slow)}return!1})?"unknown":0<=ya&&0===za?"fast":0<=za&&0===ya?"slow":"mixed"}},{key:"test",get:function(){return{snapshotInternals:()=>
({graphics:[...this.graphics3DGraphics.keys()].sort(),symbols:[...this.symbols.keys()].sort(),graphicsBySymbol:[...this.graphicsBySymbol.keys()].sort().map(za=>({symbolId:za,graphics:[...this.graphicsBySymbol.get(za).keys()].sort()})),graphicsWithoutSymbol:[...this.graphicsWithoutSymbol.keys()].sort(),graphicsDrapedUids:[...this.graphicsDrapedUids].sort(),pendingUpdates:this.pendingUpdates}),symbols:this.symbols,filterVisibility:this.filterVisibility,numPending:this.pendingUpdates.size,forceUpdatePolicy:za=>
{this.forcedUpdatePolicy=za}}}},{key:"performanceInfo",get:function(){return{visible:this.graphics3DGraphics.size,missing:this.graphicsWithoutSymbol.size,pending:this.pendingUpdates.size}}}]);return Va}(w);a.Graphics3DCore.tmpVec=M.create();c.__decorate([E.property({readOnly:!0})],a.Graphics3DCore.prototype,"computedExtent",void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"currentRenderer",void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"rendererHasGeometryOperations",
void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"_frameTask",void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"rendererChangeAbortController",void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"elevationInfoChangeAbortController",void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"setupAbortController",void 0);c.__decorate([E.property({readOnly:!0})],a.Graphics3DCore.prototype,"elevationAlignment",void 0);c.__decorate([E.property({readOnly:!0})],
a.Graphics3DCore.prototype,"scaleVisibility",void 0);c.__decorate([E.property({readOnly:!0})],a.Graphics3DCore.prototype,"filterVisibility",void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"_spatialIndex",void 0);c.__decorate([E.property({readOnly:!0})],a.Graphics3DCore.prototype,"extentPadding",void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"_updatingPendingLoadedGraphicsChange",void 0);c.__decorate([E.property({readOnly:!0})],a.Graphics3DCore.prototype,"featureStore",
void 0);c.__decorate([E.property({readOnly:!0})],a.Graphics3DCore.prototype,"deconflictor",void 0);c.__decorate([E.property({readOnly:!0})],a.Graphics3DCore.prototype,"labeler",void 0);c.__decorate([E.property({readOnly:!0})],a.Graphics3DCore.prototype,"objectStates",void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"_loadingSymbols",void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"preferredUpdatePolicy",void 0);c.__decorate([E.property()],a.Graphics3DCore.prototype,"forcedUpdatePolicy",
void 0);c.__decorate([E.property({readOnly:!0})],a.Graphics3DCore.prototype,"effectiveUpdatePolicy",null);c.__decorate([E.property({constructOnly:!0})],a.Graphics3DCore.prototype,"elevationFeatureExpressionEnabled",void 0);c.__decorate([E.property({constructOnly:!0})],a.Graphics3DCore.prototype,"owner",void 0);c.__decorate([E.property({constructOnly:!0})],a.Graphics3DCore.prototype,"layer",void 0);c.__decorate([E.property({constructOnly:!0})],a.Graphics3DCore.prototype,"graphicSymbolSupported",void 0);
c.__decorate([E.property({constructOnly:!0})],a.Graphics3DCore.prototype,"getRenderingInfoWithoutRenderer",void 0);c.__decorate([E.property({readOnly:!0})],a.Graphics3DCore.prototype,"updating",null);c.__decorate([E.property({readOnly:!0})],a.Graphics3DCore.prototype,"running",null);c.__decorate([E.property({readOnly:!0})],a.Graphics3DCore.prototype,"suspendedOrOutsideOfView",null);c.__decorate([E.property({readOnly:!0,dependsOn:[]})],a.Graphics3DCore.prototype,"updatingRemaining",null);c.__decorate([E.property({readOnly:!0,
dependsOn:["owner.view.qualitySettings.graphics3D.maxTotalNumberOfPrimitives","owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures","averageSymbolComplexity"]})],a.Graphics3DCore.prototype,"displayFeatureLimit",null);c.__decorate([E.property({readOnly:!0,dependsOn:[]})],a.Graphics3DCore.prototype,"averageSymbolComplexity",null);c.__decorate([E.property({constructOnly:!0})],a.Graphics3DCore.prototype,"hasZ",void 0);c.__decorate([E.property({constructOnly:!0})],a.Graphics3DCore.prototype,
"hasM",void 0);a.Graphics3DCore=Qa=c.__decorate([P.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],a.Graphics3DCore);var Xa;(function(Oa){Oa[Oa.NEW=0]="NEW";Oa[Oa.LOADING=1]="LOADING";Oa[Oa.READY=2]="READY";Oa[Oa.REJECTED=3]="REJECTED"})(Xa||(Xa={}));let ma=function(){function Oa(){this.renderingInfo=this.add=null;this.state=Xa.NEW;this.remove=null}Oa.prototype.clear=function(){this.renderingInfo=this.add=null;this.state=Xa.NEW;this.remove=this.abortController=null};return Oa}();const $a=
M.create(),xa=M.create(),Ka=new Map;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/renderers/support/rendererConversion":function(){define(["exports","../../core/has","../../core/Error","../../core/maybe","../../symbols/support/symbolConversion"],function(a,b,c,m,l){function r(f){return m.isNone(f)||"simple"===f.type||"unique-value"===f.type||"class-breaks"===f.type||"dictionary"===f.type||"heatmap"===f.type}function n(f,d){if(!d)return null;d=Array.isArray(d)?
d:[d];if(0<d.length){const e=d.map(v=>v.details.symbol.type||v.details.symbol.declaredClass).filter(v=>!!v);e.sort();const h=[];e.forEach((v,w)=>{0!==w&&v===e[w-1]||h.push(v)});return new c("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${h.join(", ")}) which are not supported in 3D`,{renderer:f,symbolErrors:d})}return null}function g(f){const d=f.uniqueValueInfos.map(h=>l.to3D(h.symbol).error).filter(h=>!!h),e=l.to3D(f.defaultSymbol);e.error&&d.unshift(e.error);return n(f,
d)}function k(f){const d=f.classBreakInfos.map(h=>l.to3D(h.symbol).error).filter(h=>!!h),e=l.to3D(f.defaultSymbol);e.error&&d.unshift(e.error);return n(f,d)}a.isSupportedRenderer3D=r;a.validateTo3D=function(f){if(m.isNone(f))return null;if(!r(f))return new c("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${f.type||f.declaredClass}'`,{renderer:f});switch(f.type){case "simple":return n(f,l.to3D(f.symbol).error);case "unique-value":return g(f);case "class-breaks":return k(f)}return null};
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/symbols/support/defaults3D":function(){define("exports ../../core/has ../../core/maybe ../FillSymbol3DLayer ../LineSymbol3D ../MeshSymbol3D ../PointSymbol3D ../PolygonSymbol3D ../edges/SolidEdges3D ./defaults ./defaultsJSON".split(" "),function(a,b,c,m,l,r,n,g,k,f,d){const e=n.fromSimpleMarkerSymbol(f.defaultPointSymbol2D),h=l.fromSimpleLineSymbol(f.defaultPolylineSymbol2D),v=g.fromSimpleFillSymbol(f.defaultPolygonSymbol2D),
w=new r({symbolLayers:[new m({material:{color:d.defaultColor},edges:new k({size:"1px",color:d.defaultOutlineColor})})]});a.getDefaultSymbol3D=function(t){if(c.isNone(t))return null;switch(t.type){case "mesh":return w;case "point":case "multipoint":return e;case "polyline":return h;case "polygon":case "extent":return v}return null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DFeatureStore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projection ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/data/optimizedFeatureQueryEngineAdapter".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t){a.Graphics3DFeatureStore=function(B){function q(C){var z=B.call(this,C)||this;z.events=new l;z.hasZ=null;z.hasM=null;z.objectIdField=null;z.viewSpatialReference=null;z.featureAdapter={getAttribute(A,p){return"graphic"in A?A.graphic.attributes[p]:t.optimizedFeatureQueryEngineAdapter.getAttribute(A,p)},getAttributes(A){return"graphic"in A?A.graphic.attributes:t.optimizedFeatureQueryEngineAdapter.getAttributes(A)},getObjectId:A=>"graphic"in A?h.getObjectId(A.graphic,
z.objectIdField):t.optimizedFeatureQueryEngineAdapter.getObjectId(A),getGeometry:A=>"graphic"in A?A.getAsOptimizedGeometry(z.hasZ,z.hasM):t.optimizedFeatureQueryEngineAdapter.getGeometry(A),getCentroid:(A,p)=>{if("graphic"in A){let y=null;r.isSome(A.centroid)?y=A.centroid:"point"===A.graphic.geometry.type&&e.projectPoint(A.graphic.geometry,x,z.viewSpatialReference)&&(y=x);A=Array(2+(p.hasZ?1:0)+(p.hasM?1:0));r.isNone(y)?(A[0]=0,A[1]=0,A[2]=0,A[3]=0):(A[0]=y.x,A[1]=y.y,p.hasZ&&(A[2]=y.hasZ?y.z:0),
p.hasM&&(A[p.hasZ?3:2]=y.hasM?y.m:0));return new w([],A)}return t.optimizedFeatureQueryEngineAdapter.getCentroid(A,p)},cloneWithGeometry:(A,p)=>"graphic"in A?new v.OptimizedFeature(p,z.featureAdapter.getAttributes(A),null,z.featureAdapter.getObjectId(A)):t.optimizedFeatureQueryEngineAdapter.cloneWithGeometry(A,p)};return z}b._inheritsLoose(q,B);var u=q.prototype;u.forEachInBounds=function(C,z){this.getSpatialIndex().forEachInBounds(C,z)};u.forEachBounds=function(C,z,A){const p=this.getSpatialIndex();
for(const y of C)C=this.featureAdapter.getObjectId(y),r.isSome(p.getBounds(C,A))&&z(A)};return q}(m);c.__decorate([n.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"getSpatialIndex",void 0);c.__decorate([n.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"toArray",void 0);c.__decorate([n.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"forEach",void 0);c.__decorate([n.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"hasZ",void 0);
c.__decorate([n.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"hasM",void 0);c.__decorate([n.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"objectIdField",void 0);c.__decorate([n.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"viewSpatialReference",void 0);c.__decorate([n.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"featureSpatialReference",void 0);a.Graphics3DFeatureStore=c.__decorate([d.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureStore")],
a.Graphics3DFeatureStore);const x={type:"point",x:0,y:0,hasZ:!1,hasM:!1,spatialReference:null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":function(){define(["exports","../../../core/maybe","../centroid","../OptimizedFeature","../OptimizedGeometry"],function(a,b,c,m,l){a.optimizedFeatureQueryEngineAdapter={getObjectId(r){return r.objectId},getAttributes(r){return r.attributes},getAttribute(r,
n){return r.attributes[n]},cloneWithGeometry(r,n){return new m.OptimizedFeature(n,r.attributes,null,r.objectId)},getGeometry(r){return r.geometry},getCentroid(r,n){b.isNone(r.centroid)&&(r.centroid=c.getCentroidOptimizedGeometry(new l,r.geometry,n.hasZ,n.hasM));return r.centroid}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/centroid":function(){define(["exports","../../core/maybe"],function(a,b){function c(l,r,n,g,k,f,d=1){f=k?
f?4:3:f?3:2;let e=n,h=n+f,v=0,w=0,t=n=0,x=0;for(let B=0,q=g-1;B<q;B++,e+=f,h+=f){g=r[e];const u=r[e+1],C=r[e+2],z=r[h],A=r[h+1],p=r[h+2];let y=g*A-z*u;t+=y;v+=(g+z)*y;w+=(u+A)*y;k&&(y=g*p-z*C,n+=(C+p)*y,x+=y);g<l[0]&&(l[0]=g);g>l[1]&&(l[1]=g);u<l[2]&&(l[2]=u);u>l[3]&&(l[3]=u);k&&(C<l[4]&&(l[4]=C),C>l[5]&&(l[5]=C))}0<t*d&&(t*=-1);0<x*d&&(x*=-1);if(!t)return null;l=[v,w,.5*t];k&&(l[3]=n,l[4]=.5*x);return l}function m(l,r,n,g,k){k=g?k?4:3:k?3:2;let f=r,d=r+k,e=0,h=0,v=0,w=0;for(let q=0,u=n-1;q<u;q++,
f+=k,d+=k){var t=l[f];const C=l[f+1],z=l[f+2],A=l[d],p=l[d+1],y=l[d+2];if(g){{var x=A-t;var B=p-C;const D=y-z;x=Math.sqrt(x*x+B*B+D*D)}}else x=A-t,B=p-C,x=Math.sqrt(x*x+B*B);x&&(e+=x,g?(t=[t+.5*(A-t),C+.5*(p-C),z+.5*(y-z)],h+=x*t[0],v+=x*t[1],w+=x*t[2]):(t=[t+.5*(A-t),C+.5*(p-C)],h+=x*t[0],v+=x*t[1]))}return 0<e?g?[h/e,v/e,w/e]:[h/e,v/e]:0<n?g?[l[r],l[r+1],l[r+2]]:[l[r],l[r+1]]:null}a.getCentroidOptimizedGeometry=function(l,r,n,g,k){if(b.isNone(r)||!r.lengths.length)return null;const f="upperLeft"===
(null==k?void 0:k.originPosition)?-1:1;l.lengths.length&&(l.lengths.length=0);l.coords.length&&(l.coords.length=0);k=l.coords;const d=[],e=n?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:h,coords:v}=r,w=n?g?4:3:g?3:2;let t=0;for(var x of h){const B=c(e,v,t,x,n,g,f);B&&d.push(B);t+=x*
w}d.sort((B,q)=>{let u=f*B[2]-f*q[2];0===u&&n&&(u=B[4]-q[4]);return u});d.length&&(x=6*d[0][2],k[0]=d[0][0]/x,k[1]=d[0][1]/x,n&&(x=6*d[0][4],k[2]=0!==x?d[0][3]/x:0),k[0]<e[0]||k[0]>e[1]||k[1]<e[2]||k[1]>e[3]||n&&(k[2]<e[4]||k[2]>e[5]))&&(k.length=0);if(!k.length)if(r=r.lengths[0]?m(v,0,h[0],n,g):null)k[0]=r[0],k[1]=r[1],n&&2<r.length&&(k[2]=r[2]);else return null;return l};a.lineCentroid=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DSymbolCreationContext":function(){define(["exports"],
function(a){a.Graphics3DSymbolCreationContext=function(b){this.schedule=b;this.featureExpressionInfoContext=this.localOriginFactory=this.graphicsCoreOwner=this.drapeSourceRenderer=this.layer=this.overlaySR=this.renderCoordsHelper=this.clippingExtent=this.stage=this.renderer=this.elevationProvider=this.streamDataRequester=this.sharedResources=null;this.screenSizePerspectiveEnabled=!0;this.isAsync=this.physicalBasedRenderingEnabled=this.slicePlaneEnabled=!1};a.Graphics3DSymbolLayerCreationContext=function(){};
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":function(){define(["exports","./Graphics3DPointSymbol","./Graphics3DSymbol"],function(a,b,c){a.make=function(m,l,r){let n;switch(m.type){case "point-3d":n=b;break;default:n=c}return new n(m,l,r)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DPointSymbol":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DSymbol".split(" "),
function(a,b,c,m,l,r){return function(n){function g(f,d,e){f=n.call(this,f,d,e)||this;f.calloutSymbolLayer=null;f.symbol.hasVisibleCallout()&&(f.calloutSymbolLayer=l.make(f.symbol,d));return f}a._inheritsLoose(g,n);var k=g.prototype;k.doLoad=function(){var f=a._asyncToGenerator(function*(d){const e=this.calloutSymbolLayer?b.result(this.calloutSymbolLayer.load()):null;try{yield n.prototype.doLoad.call(this,d),m.throwIfAborted(d)}catch(v){var h;null==(h=this.calloutSymbolLayer)?void 0:h.abortLoad();
throw v;}e&&(yield e)});return function(d){return f.apply(this,arguments)}}();k.destroy=function(){n.prototype.destroy.call(this);this.calloutSymbolLayer=c.destroyMaybe(this.calloutSymbolLayer)};k.createGraphics3DGraphic=function(f,d){d=n.prototype.createGraphics3DGraphic.call(this,f,d);c.isSome(this.calloutSymbolLayer)&&c.isSome(d)&&(f=this._createCalloutGraphic(f),c.isSome(f)&&d.addAuxiliaryGraphic(f));return d};k.globalPropertyChanged=function(f,d){return n.prototype.globalPropertyChanged.call(this,
f,d)?this.calloutSymbolLayer?this.calloutSymbolLayer.globalPropertyChanged(f,d,e=>this._getCalloutGraphicLayer(e)):!0:!1};k.updateGeometry=function(f,d){const e=n.prototype.updateGeometry.call(this,f,d);return e&&this.calloutSymbolLayer&&(f=this._getCalloutGraphicLayer(f))?this.calloutSymbolLayer.updateGeometry(f,d):e};k._createCalloutGraphic=function(f){const d=f.renderingInfo;f.renderingInfo={renderer:d.renderer,symbol:d.symbol,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,0],centerOffsetUnits:"world",
elevationOffset:0,materialCollection:null};return this.calloutSymbolLayer.createGraphics3DGraphic(f)};k._getCalloutGraphicLayer=function(f){for(const d of f._auxiliaryGraphics)if(d.graphics3DSymbolLayer===this.calloutSymbolLayer)return d};return g}(r)})},"esri/views/3d/layers/graphics/GraphicStateTracking":function(){define(["exports","../../../../core/arrayUtils","../../../../core/maybe","../../../../layers/graphics/dehydratedFeatures"],function(a,b,c,m){let l=function(){function r(g){this.graphicsCore=
g;this.idToState=new Map;this.states=new Set;const k=g.owner.layer&&g.owner.layer.objectIdField;k?(this.getGraphicId=f=>m.getObjectId(f,k),this.getGraphics3DGraphicById=f=>this.graphicsCore.getGraphics3DGraphicByObjectId(f)):(this.getGraphicId=f=>f.uid,this.getGraphics3DGraphicById=f=>this.graphicsCore.getGraphics3DGraphicById(f))}var n=r.prototype;n.destroy=function(){this.idToState.clear();this.states.forEach((g,k)=>this.remove(k))};n.add=function(g){const k={remove:()=>this.remove(g)};if(this.states.has(g))return k;
const f=this.getGraphicId(g.graphic),d=this.getGraphics3DGraphicById(f);this.states.has(g)||this.states.add(g);this._ensureStateList(f).push(g);g.displaying=c.isSome(d)?d.isVisible():!1;g.isDraped=c.isSome(d)?d.isDraped:!1;g.tracking=!0;c.isSome(d)&&g.emit("changed",{});return k};n.remove=function(g){if(this.states.has(g)){if(this.idToState.size){const k=this.getGraphicId(g.graphic),f=this.idToState.get(k);f&&(b.remove(f,g),0===f.length&&this.idToState.delete(k))}this.states.delete(g);g.tracking=
!1;g.displaying=!1}};n.addGraphic=function(g){this._forEachState(g,k=>{k.displaying=g.isVisible();k.isDraped=g.isDraped;k.emit("changed",{})})};n.removeGraphic=function(g){this._forEachState(g,k=>{k.displaying=!1;k.isDraped=!1})};n.updateGraphicGeometry=function(g){this._forEachState(g,k=>{k.emit("changed",{})})};n.updateGraphicVisibility=function(g){this._forEachState(g,k=>{k.displaying=g.isVisible()})};n.allGraphicsDeleted=function(){this.states.forEach(g=>{g.displaying=!1})};n._ensureStateList=
function(g){var k=this.idToState.get(g);if(k)return k;k=[];this.idToState.set(g,k);return k};n._forEachState=function(g,k){0!==this.states.size&&0!==this.idToState.size&&(g=this.getGraphicId(g.graphic),g=this.idToState.get(g),null!=g&&g.forEach(k))};return r}();a.GraphicStateTracking=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/SpatialIndex2D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/rbush/PooledRBush ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e){a.SpatialIndex2D=function(v){function w(x){x=v.call(this,x)||this;x._index=new f.PooledRBush(9,l("esri-csp-restrictions")?B=>({minX:B.extent[0],minY:B.extent[1],maxX:B.extent[2],maxY:B.extent[3]}):[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]);x._missing=new Set;x._boundsByFeature=new Map;x.spatialReference=null;x.hasZ=null;x.hasM=null;x.objectIdField=null;x.updating=!1;return x}b._inheritsLoose(w,v);var t=w.prototype;t.setup=function(x){this._addMany(x)};
t.destroy=function(){this._missing.clear();this._index.destroy();this._index=null;this._boundsByFeature.clear();this._boundsByFeature=null};t.update=function(){0<this._missing.size&&(this._addMany(Array.from(this._missing.values())),this.updating=!1,this._missing.clear())};t.queryGraphicUIDsInExtent=function(x,B,q){B.equals(this.spatialReference)&&(h.minX=x[0],h.minY=x[1],h.maxX=x[2],h.maxY=x[3],this.update(),this._index.search(h,u=>q(u.graphic.uid)))};t.add=function(x){this._missing.add(x);this.updating=
!0};t.remove=function(x){this._missing.delete(x)?this.updating=0<this._missing.size:(this._index.remove(x),x=e.getObjectId(x.graphic,this._get("objectIdField")),null!=x&&this._boundsByFeature.delete(x))};t._addMany=function(x){if(0!==x.length){var B=this._get("objectIdField");for(const q of x){q.computeExtent(this.spatialReference);const u=e.getObjectId(q.graphic,B);null!=u&&this._boundsByFeature.set(u,q.extent)}this._index.load(x)}};t.clear=function(){this._index.clear();this._missing.clear();this._boundsByFeature.clear();
this.updating=!1};t.forEachInBounds=function(x,B){h.minX=x[0];h.minY=x[1];h.maxX=x[2];h.maxY=x[3];this.update();this._index.search(h,q=>{B(q)})};t.getBounds=function(x,B){this.update();return(x=this._boundsByFeature.get(x))?d.fromRect(B,x):null};b._createClass(w,[{key:"updatingRemaining",get:function(){return this._missing.size}}]);return w}(m);c.__decorate([r.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"spatialReference",void 0);c.__decorate([r.property({constructOnly:!0})],a.SpatialIndex2D.prototype,
"hasZ",void 0);c.__decorate([r.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"hasM",void 0);c.__decorate([r.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"objectIdField",void 0);c.__decorate([r.property()],a.SpatialIndex2D.prototype,"updating",void 0);c.__decorate([r.property({readOnly:!0})],a.SpatialIndex2D.prototype,"updatingRemaining",null);a.SpatialIndex2D=c.__decorate([k.subclass("esri.views.3d.layers.graphics.SpatialIndex2D")],a.SpatialIndex2D);const h={minX:0,minY:0,maxX:0,
maxY:0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/libs/rbush/PooledRBush":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../arrayUtils ../../maybe ../../PooledArray ../../../chunks/quickselect".split(" "),function(a,b,c,m,l,r){function n(y,D){g(y,0,y.children.length,D,y)}function g(y,D,E,F,G){G||(G=new A([]));G.minX=Infinity;G.minY=Infinity;G.maxX=-Infinity;G.maxY=-Infinity;for(let P=D,K;P<E;P++)K=y.children[P],
k(G,y.leaf?F(K):K);return G}function k(y,D){y.minX=Math.min(y.minX,D.minX);y.minY=Math.min(y.minY,D.minY);y.maxX=Math.max(y.maxX,D.maxX);y.maxY=Math.max(y.maxY,D.maxY)}function f(y,D){return y.minX-D.minX}function d(y,D){return y.minY-D.minY}function e(y){return(y.maxX-y.minX)*(y.maxY-y.minY)}function h(y){return y.maxX-y.minX+(y.maxY-y.minY)}function v(y,D){return y.minX<=D.minX&&y.minY<=D.minY&&D.maxX<=y.maxX&&D.maxY<=y.maxY}function w(y,D){return D.minX<=y.maxX&&D.minY<=y.maxY&&D.maxX>=y.minX&&
D.maxY>=y.minY}function t(y,D,E,F,G){for(D=[D,E];D.length;){E=m.assumeNonNull(D.pop());const P=m.assumeNonNull(D.pop());if(E-P<=F)continue;const K=P+Math.ceil((E-P)/F/2)*F;r.quickselect(y,K,P,E,G);D.push(P,K,K,E)}}let x=function(){function y(E=9,F){this.compareMinX=f;this.compareMinY=d;this._toBBox=G=>G;this._maxEntries=Math.max(4,E||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));F&&("function"===typeof F?this._toBBox=F:this._initFormat(F));this.clear()}var D=y.prototype;D.destroy=
function(){this.clear();B.prune();q.prune();u.prune();C.prune()};D.all=function(E){this._all(this.data,E)};D.search=function(E,F){let G=this.data;const P=this._toBBox;if(w(E,G))for(B.clear();G;){for(let K=0,N=G.children.length;K<N;K++){const M=G.children[K],L=G.leaf?P(M):M;w(E,L)&&(G.leaf?F(M):v(E,L)?this._all(M,F):B.push(M))}G=B.pop()}};D.collides=function(E){let F=this.data;const G=this._toBBox;if(!w(E,F))return!1;for(B.clear();F;){for(let P=0,K=F.children.length;P<K;P++){const N=F.children[P],
M=F.leaf?G(N):N;if(w(E,M)){if(F.leaf||v(E,M))return!0;B.push(N)}}F=B.pop()}return!1};D.load=function(E){if(!E.length)return this;if(E.length<this._minEntries){for(let F=0,G=E.length;F<G;F++)this.insert(E[F]);return this}E=this._build(E.slice(0,E.length),0,E.length-1,0);if(this.data.children.length)if(this.data.height===E.height)this._splitRoot(this.data,E);else{if(this.data.height<E.height){const F=this.data;this.data=E;E=F}this._insert(E,this.data.height-E.height-1,!0)}else this.data=E;return this};
D.insert=function(E){E&&this._insert(E,this.data.height-1);return this};D.clear=function(){this.data=new A([]);return this};D.remove=function(E){if(!E)return this;let F=this.data,G=null,P=0,K=!1,N;const M=this._toBBox(E);u.clear();for(C.clear();F||0<u.length;){if(!F){var L;F=m.assumeNonNull(u.pop());G=u.data[u.length-1];P=null!=(L=C.pop())?L:0;K=!0}if(F.leaf&&(N=c.indexOf(F.children,E,F.children.length,F.indexHint),-1!==N)){F.children.splice(N,1);u.push(F);this._condense(u);break}K||F.leaf||!v(F,
M)?G?(P++,F=G.children[P],K=!1):F=null:(u.push(F),C.push(P),P=0,G=F,F=F.children[0])}return this};D.toJSON=function(){return this.data};D.fromJSON=function(E){this.data=E;return this};D._all=function(E,F){for(q.clear();E;){var G;if(!0===E.leaf)for(const P of E.children)F(P);else q.pushArray(E.children);E=null!=(G=q.pop())?G:null}};D._build=function(E,F,G,P){var K=G-F+1,N=this._maxEntries;if(K<=N)return E=new A(E.slice(F,G+1)),n(E,this._toBBox),E;P||(P=Math.ceil(Math.log(K)/Math.log(N)),N=Math.ceil(K/
N**(P-1)));const M=new p([]);M.height=P;K=Math.ceil(K/N);N=K*Math.ceil(Math.sqrt(N));for(t(E,F,G,N,this.compareMinX);F<=G;F+=N){const L=Math.min(F+N-1,G);t(E,F,L,K,this.compareMinY);for(let J=F;J<=L;J+=K)M.children.push(this._build(E,J,Math.min(J+K-1,L),P-1))}n(M,this._toBBox);return M};D._chooseSubtree=function(E,F,G,P){for(;;){P.push(F);if(!0===F.leaf||P.length-1===G)break;let K=Infinity,N=Infinity,M=void 0;for(let L=0,J=F.children.length;L<J;L++){const H=F.children[L],I=e(H),O=(Math.max(H.maxX,
E.maxX)-Math.min(H.minX,E.minX))*(Math.max(H.maxY,E.maxY)-Math.min(H.minY,E.minY))-I;O<N?(N=O,K=I<K?I:K,M=H):O===N&&I<K&&(K=I,M=H)}F=M||F.children[0]}return F};D._insert=function(E,F,G){var P=this._toBBox;G=G?E:P(E);u.clear();P=this._chooseSubtree(G,this.data,F,u);P.children.push(E);for(k(P,G);0<=F;)if(u.data[F].children.length>this._maxEntries)this._split(u,F),F--;else break;this._adjustParentBBoxes(G,u,F)};D._split=function(E,F){const G=E.data[F];var P=G.children.length;const K=this._minEntries;
this._chooseSplitAxis(G,K,P);(P=this._chooseSplitIndex(G,K,P))?(P=G.children.splice(P,G.children.length-P),P=G.leaf?new A(P):new p(P),P.height=G.height,n(G,this._toBBox),n(P,this._toBBox),F?E.data[F-1].children.push(P):this._splitRoot(G,P)):console.log("  Error: assertion failed at PooledRBush._split: no valid split index")};D._splitRoot=function(E,F){this.data=new p([E,F]);this.data.height=E.height+1;n(this.data,this._toBBox)};D._chooseSplitIndex=function(E,F,G){let P,K,N=void 0;P=K=Infinity;for(let L=
F;L<=G-F;L++){var M=g(E,0,L,this._toBBox);const J=g(E,L,G,this._toBBox),H=Math.max(0,Math.min(M.maxX,J.maxX)-Math.max(M.minX,J.minX))*Math.max(0,Math.min(M.maxY,J.maxY)-Math.max(M.minY,J.minY));M=e(M)+e(J);H<P?(P=H,N=L,K=M<K?M:K):H===P&&M<K&&(K=M,N=L)}return N};D._chooseSplitAxis=function(E,F,G){const P=E.leaf?this.compareMinX:f,K=E.leaf?this.compareMinY:d,N=this._allDistMargin(E,F,G,P);F=this._allDistMargin(E,F,G,K);N<F&&E.children.sort(P)};D._allDistMargin=function(E,F,G,P){E.children.sort(P);P=
this._toBBox;var K=g(E,0,F,P);const N=g(E,G-F,G,P);let M=h(K)+h(N);for(let L=F;L<G-F;L++){const J=E.children[L];k(K,E.leaf?P(J):J);M+=h(K)}for(G=G-F-1;G>=F;G--)K=E.children[G],k(N,E.leaf?P(K):K),M+=h(N);return M};D._adjustParentBBoxes=function(E,F,G){for(;0<=G;G--)k(F.data[G],E)};D._condense=function(E){for(let F=E.length-1;0<=F;F--){const G=E.data[F];if(0===G.children.length)if(0<F){const P=E.data[F-1],K=P.children;K.splice(c.indexOf(K,G,K.length,P.indexHint),1)}else this.clear();else n(G,this._toBBox)}};
D._initFormat=function(E){const F=["return a"," - b",";"];this.compareMinX=new Function("a","b",F.join(E[0]));this.compareMinY=new Function("a","b",F.join(E[1]));this._toBBox=new Function("a","return {minX: a"+E[0]+", minY: a"+E[1]+", maxX: a"+E[2]+", maxY: a"+E[3]+"};")};return y}();const B=new l,q=new l,u=new l,C=new l({deallocator:void 0});l=function(){this.minY=this.minX=Infinity;this.maxY=this.maxX=-Infinity};let z=function(y){function D(){var E=y.apply(this,arguments)||this;E.height=1;E.indexHint=
new c.PositionHint;return E}b._inheritsLoose(D,y);return D}(l),A=function(y){function D(E){var F=y.call(this)||this;F.children=E;F.leaf=!0;return F}b._inheritsLoose(D,y);return D}(z),p=function(y){function D(E){var F=y.call(this)||this;F.children=E;F.leaf=!1;return F}b._inheritsLoose(D,y);return D}(z);a.BBox=l;a.PooledRBush=x;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/quickselect":function(){define(["exports"],function(a){var b={exports:{}};
(function(c){(function(m){m=m();void 0!==m&&(c.exports=m)})(function(){function m(n,g,k,f,d){for(;f>k;){if(600<f-k){var e=f-k+1,h=g-k+1,v=Math.log(e),w=.5*Math.exp(2*v/3);v=.5*Math.sqrt(v*w*(e-w)/e)*(0>h-e/2?-1:1);m(n,g,Math.max(k,Math.floor(g-h*w/e+v)),Math.min(f,Math.floor(g+(e-h)*w/e+v)),d)}e=n[g];h=k;w=f;l(n,k,g);for(0<d(n[f],e)&&l(n,k,f);h<w;){l(n,h,w);h++;for(w--;0>d(n[h],e);)h++;for(;0<d(n[w],e);)w--}0===d(n[k],e)?l(n,k,w):(w++,l(n,w,f));w<=g&&(k=w+1);g<=w&&(f=w-1)}}function l(n,g,k){var f=
n[g];n[g]=n[k];n[k]=f}function r(n,g){return n<g?-1:n>g?1:0}return function(n,g,k,f,d){m(n,g,k||0,f||n.length-1,d||r)}})})(b);a.quickselect=b.exports})},"esri/views/3d/layers/support/StageLayerElevationProvider":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/unitUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../symbols/support/unitConversionUtils ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C){const z=n.getLogger("esri.views.3d.layers.support.StageLayerElevationProvider");a.StageLayerElevationProvider=function(G){function P(N){N=G.call(this,N)||this;N.elevationOffset=0;N._layerHandes=new r;return N}b._inheritsLoose(P,G);var K=P.prototype;K.initialize=function(){this.renderCoordsHelper=this.view.renderCoordsHelper;this.intersectLayers=[this.stageLayer];this.intersector=u.newIntersector(this.view.state.viewingMode);this.intersector.options.store=
C.StoreResults.MIN;var N=this._computeLayerExtent(this.stageLayer);this.zmin=N[2];this.zmax=N[5];N=this.stageLayer.events;this._layerHandes.add([N.on("layerObjectAdded",M=>this._objectChanged(M.object)),N.on("layerObjectRemoved",M=>this._objectChanged(M.object)),N.on("objectGeometryAdded",M=>this._objectChanged(M.object)),N.on("objectGeometryRemoved",M=>this._objectChanged(M.object)),N.on("vertexAttrsUpdated",M=>this._objectChanged(M.object)),N.on("objectTransformation",M=>this._objectChanged(M))])};
K.dispose=function(){this._layerHandes.destroy()};K.elevationInfoChanged=function(){const N=null!=this.layer?this.layer.elevationInfo:null;if(null!=N&&"on-the-ground"!==N.mode){const M=k.getMetersPerVerticalUnitForSR(this.layer.spatialReference),L=q.getMetersPerUnit(N.unit);this.elevationOffset=g.unwrapOr(N.offset,0)*L/M}else this.elevationOffset=0};K.getElevation=function(N,M,L,J){D[0]=N;D[1]=M;D[2]=L;if(!this.renderCoordsHelper.toRenderCoords(D,J,D))return z.error("could not project point for elevation alignment"),
null;N=this.elevationOffset;M=this.zmin+N;this.renderCoordsHelper.setAltitude(E,this.zmax+N,D);this.renderCoordsHelper.setAltitude(F,M,D);this.intersector.reset(E,F,null);this.intersector.intersect(this.intersectLayers,null,1,null,H=>H.metadata&&H.metadata.isElevationSource);return this.intersector.results.min.getIntersectionPoint(D)?this.renderCoordsHelper.getAltitude(D):null};K._objectChanged=function(N){var M;if(null!=(M=N.metadata)&&M.isElevationSource&&this.spatialReference){x.empty(A);N.metadata.lastValidElevationBB.isEmpty()||
this._expandExtent(N.metadata.lastValidElevationBB.min,N.metadata.lastValidElevationBB.max,A);M=N.boundingVolumeWorldSpace.min;var L=N.boundingVolumeWorldSpace.max;this._expandExtent(M,L,A);x.toRect(A,p);this.zmin=Math.min(this.zmin,A[2]);this.zmax=Math.max(this.zmax,A[5]);y.extent=p;y.spatialReference=this.spatialReference;this.emit("elevation-change",y);w.copy(N.metadata.lastValidElevationBB.min,M);w.copy(N.metadata.lastValidElevationBB.max,L)}};K._computeLayerExtent=function(N){x.empty(A);N.objects.forAll(M=>
this._expandExtent(M.boundingVolumeWorldSpace.min,M.boundingVolumeWorldSpace.max,A));return A};K._expandExtent=function(N,M,L){for(let J=0;8>J;++J)D[0]=J&1?N[0]:M[0],D[1]=J&2?N[1]:M[1],D[2]=J&4?N[2]:M[2],this.renderCoordsHelper.fromRenderCoords(D,D,this.spatialReference),x.expandWithVec3(L,D);return L};return P}(l.EventedMixin(m));c.__decorate([f.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,"layer",void 0);c.__decorate([f.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,
"stageLayer",void 0);c.__decorate([f.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,"view",void 0);c.__decorate([f.property({readOnly:!0,aliasOf:"view.spatialReference"})],a.StageLayerElevationProvider.prototype,"spatialReference",void 0);a.StageLayerElevationProvider=c.__decorate([v.subclass("esri.views.3d.layers.support.StageLayerElevationProvider")],a.StageLayerElevationProvider);const A=x.empty(),p=B.empty(),y={spatialReference:null,extent:p,context:"scene"},D=t.create(),
E=t.create(),F=t.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./ExtentSet ../../webgl-engine/lib/basicInterfaces ../../../support/Scheduler".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w){c=function(t){function x(){var q=t.apply(this,arguments)||this;q.dirtyExtents=new h.ExtentSet;q.globalDirty=!1;q.averageExtentUpdateSize=0;q.dirtyGraphicsSet=new Set;q.handles=new l;q.updateElevation=!1;q.graphicsCoreOwner=null;q.graphicsCore=null;q.events=new m;return q}a._inheritsLoose(x,t);var B=x.prototype;B.setup=function(q,u,C,z){this.graphicsCoreOwner=q;this.queryGraphicUIDsInExtent=u;this.graphicsCore=C;this.elevationProvider=z;q=this.graphicsCoreOwner.view.resourceController.scheduler;
this.handles.add([z.on("elevation-change",A=>this._elevationChanged(A)),n.watch(()=>this.graphicsCoreOwner.suspended,()=>this._suspendedChange()),q.registerTask(w.TaskPriority.ELEVATION_ALIGNMENT,this)])};B.destroy=function(){this.dirtyGraphicsSet.clear();this.handles.destroy();this.queryGraphicUIDsInExtent=this.graphicsCore=this.graphicsCoreOwner=this.handles=null};B.clear=function(){this.dirtyGraphicsSet.clear();this.notifyChange("updating")};B._suspendedChange=function(){!0===this.graphicsCoreOwner.suspended?
this.updateElevation=!1:!1===this.graphicsCoreOwner.suspended&&this.updateElevation&&(this.globalDirty=!0,this.notifyChange("updating"))};B.elevationInfoChange=function(){this.globalDirty=!0;this.notifyChange("updating")};B.runTask=function(q){this.globalDirty&&(this._markAllGraphicsElevationDirty(),this.globalDirty=!1,q.madeProgress());for(q.run(()=>this.dirtyExtents.merge(q));this.running&&!q.done;)this._updateDirtyGraphics(q),this._updateDirtyExtents(q);this.graphicsCoreOwner.view.deconflictor.setDirty();
this.notifyChange("updating")};B._updateDirtyGraphics=function(q){const u=this.graphicsCoreOwner.view.renderCoordsHelper,C=this.graphicsCore.effectiveUpdatePolicy===v.UpdatePolicy.ASYNC;for(const z of this.dirtyGraphicsSet.keys()){const A=this.graphicsCore.getGraphics3DGraphicById(z);this.dirtyGraphicsSet.delete(z);r.isSome(A)&&(A.alignWithElevation(this.elevationProvider,u,C),q.madeProgress());if(q.done)break}};B._updateDirtyExtents=function(q){for(;!this.dirtyExtents.empty&&!q.done;){const u=this.dirtyExtents.pop(),
C=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:u,spatialReference:C});const z=this.dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(u,C,A=>{const p=this.graphicsCore.getGraphics3DGraphicById(A);r.isSome(p)&&p.needsElevationUpdates()&&this.dirtyGraphicsSet.add(A)});this.averageExtentUpdateSize=.1*(this.dirtyGraphicsSet.size-z)+.9*this.averageExtentUpdateSize;q.madeProgress()}};B._markAllGraphicsElevationDirty=function(){this.dirtyExtents.clear();this.dirtyGraphicsSet.clear();
this.graphicsCore.graphics3DGraphics.forEach((q,u)=>this.dirtyGraphicsSet.add(u))};B._elevationChanged=function(q){if("scene"!==q.context||this.graphicsCore.layer.elevationInfo&&"relative-to-scene"===this.graphicsCore.layer.elevationInfo.mode){var {extent:u,spatialReference:C}=q;this.graphicsCoreOwner.suspended?(this.updateElevation||(q=this.graphicsCore.computedExtent)&&u[2]>q.xmin&&u[0]<q.xmax&&u[3]>q.ymin&&u[1]<q.ymax&&(this.updateElevation=!0),this.events.emit("invalidate-elevation",{extent:u,
spatialReference:C})):(-Infinity===u[0]?this.globalDirty=!0:this.dirtyExtents.add(u),this.notifyChange("updating"))}};a._createClass(x,[{key:"updating",get:function(){return this.running}},{key:"running",get:function(){return 0<this.dirtyGraphicsSet.size||this.dirtyExtents&&!this.dirtyExtents.empty||this.globalDirty}},{key:"updatingRemaining",get:function(){return this.dirtyGraphicsSet.size+this.dirtyExtents.size*this.averageExtentUpdateSize}}]);return x}(c);b.__decorate([g.property({readOnly:!0})],
c.prototype,"updating",null);b.__decorate([g.property({readOnly:!0})],c.prototype,"updatingRemaining",null);return c=b.__decorate([e.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],c)})},"esri/views/3d/layers/graphics/ExtentSet":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/PooledArray","../../../../geometry/support/aaBoundingRect","../../../support/Scheduler"],function(a,b,c,m,l){let r=function(){function n(){this._extents=new c({allocator:k=>
k||m.create()});this._tmpExtent=m.create();this._dirty=!1}var g=n.prototype;g.clear=function(){this._extents.clear()};g.add=function(k){this._contains(k)||(this._removeContained(k),m.copy(this._extents.pushNew(),k),this._dirty=!0)};g.pop=function(){this._dirty&&this._mergeTight();return this._extents.pop()};g.merge=function(k){this._mergeTight(k);return k.hasProgressed};g._mergeTight=function(k=l.noBudget){const f=this._extents,d=new Set;let e=0;for(;e!==f.length;){f.sort((h,v)=>h[0]-v[0]);e=f.length;
d.clear();for(let h=0;h<f.length;++h){if(k.done)return;const v=f.getItemAt(h);for(let w=h+1;w<f.length;++w){const t=f.getItemAt(w);if(t[0]>=v[2])break;d.add(t)}d.forEach(w=>{if(v!==w)if(w[2]<=v[0])d.delete(w);else{var t=m.area(v),x=m.area(w),B=this._tmpExtent;m.expand(v,w,B);t+=x;.05>(m.area(B)-t)/t&&(m.copy(v,B),d.delete(w),f.remove(w),k.madeProgress())}});d.add(v)}}this._dirty=!1};g._contains=function(k){return this._extents.some(f=>m.contains(f,k))};g._removeContained=function(k){this._extents.filterInPlace(f=>
!m.contains(k,f))};b._createClass(n,[{key:"empty",get:function(){return 0===this._extents.length}},{key:"size",get:function(){return this._extents.length}},{key:"test",get:function(){const k=this;return{containsPoint:f=>k._extents.some(d=>m.containsPoint(d,f))}}}]);return n}();a.ExtentSet=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DFilterVisibility":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/ObservableChangesType ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/FeatureFilter ../../../../layers/support/floorFilterUtils ./enums ./QueryEngine ../../../support/Scheduler".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u){const C=r.getLogger("esri.views.3d.layers.graphics.Graphics3DFilterVisibility");a.Graphics3DFilterVisibility=function(z){function A(...y){y=z.call(this,...y)||this;y._dirty=!1;y._querying=!1;y._handles=new l;return y}b._inheritsLoose(A,z);var p=A.prototype;p.setup=function(y,D){this._layerView=y;this._core=D;this._objectIdField=y.layer.objectIdField;this._queryEngine=new q.QueryEngine({layerView:this._layerView,priority:u.TaskPriority.FILTER_VISIBILITY});
this._handles.add(this._layerView.view.resourceController.scheduler.registerTask(u.TaskPriority.FILTER_VISIBILITY,this));this._handles.add(f.on(()=>{var E;return null==(E=D.owner)?void 0:E.loadedGraphics},"after-changes",E=>this._graphicsChanged(E),{onListenerAdd:()=>this.dirty=!0}));this.filterChanged()};p.destroy=function(){this._handles.destroy();this._handles=null;this.clear();this._core=this._layerView=null};p.clear=function(){this._queryEngine.clear()&&(this._core.modifyGraphics3DGraphicVisibilities(y=>
y.clearVisibilityFlag(B.VisibilityFlag.FILTER)),this._queryResult=null,this._querying=!1);this.dirty=!1};p._graphicsChanged=function(y){this._queryEngine&&0===(y.type&g.ObservableChangesType.ADD)||(this.dirty=!0)};p.updateVisibility=function(y){this.active&&(y.hasVisibilityFlag(B.VisibilityFlag.FILTER,B.VisibilityGroup.GRAPHIC)||y.setVisibilityFlag(B.VisibilityFlag.FILTER,!1,B.VisibilityGroup.GRAPHIC),this.dirty=!0)};p.filterChanged=function(){var y=this._recomputeFilter();y!==this._featureFilter&&
(this._featureFilter=y,this.dirty=!0);y="layerFilter"in this._layerView?this._layerView.layerFilter:null;y!==this._sceneFilter&&(this._sceneFilter=y,this.dirty=!0)};p._recomputeFilter=function(){var y="filter"in this._layerView?this._layerView.filter:null;const D="timeExtent"in this._layerView?this._layerView.timeExtent:null,E=x.getFloorFilterClause(this._layerView);if(n.isNone(D)&&n.isNone(E))return y;y=n.isSome(y)?y.clone():new t;n.isSome(D)&&(y.timeExtent=n.isSome(y.timeExtent)?y.timeExtent.intersection(D):
D);n.isSome(E)&&(y.where=null==y.where||""===y.where?E:`(${y.where}) AND (${E})`);return y};p.runTask=function(y){if(this.active){!this._dirty||this._querying||y.done||(this._querying=!0,this.dirty=!1,this._queryEngine.executeQueryForIdSet(this._featureFilter,this._sceneFilter).then(E=>{this._queryResult=E;this._querying=!1}).catch(E=>{if(!k.isAbortError(E)){C.warn("FeatureFilter query failed: "+E,{error:E});const F=new Set;this._core.graphics3DGraphics.forEach(G=>F.add(this._getFeatureId(G.graphic)));
this._queryResult=F;this._querying=!1}}),y.madeProgress());var D=this._queryResult;n.isSome(D)&&!y.done&&(this._core.modifyGraphics3DGraphicVisibilities(E=>{if(y.done)return!1;const F=D.has(this._getFeatureId(E.graphic));return E.setVisibilityFlag(B.VisibilityFlag.FILTER,F,B.VisibilityGroup.GRAPHIC)?(y.madeProgress(),!0):!1}),y.done||(this._queryResult=null))}else this.clear()};p._getFeatureId=function(y){return null==y.objectId?y.attributes[this._objectIdField]:y.objectId};b._createClass(A,[{key:"updating",
get:function(){return this._dirty||this._querying||n.isSome(this._queryResult)}},{key:"active",get:function(){return(this._featureFilter||this._sceneFilter)&&0<this._core.graphics3DGraphics.size}},{key:"running",get:function(){return this._dirty&&!this._querying||n.isSome(this._queryResult)}},{key:"dirty",set:function(y){this._dirty=y}}]);return A}(m);c.__decorate([d.property({readOnly:!0})],a.Graphics3DFilterVisibility.prototype,"updating",null);c.__decorate([d.property({readOnly:!0})],a.Graphics3DFilterVisibility.prototype,
"running",null);c.__decorate([d.property()],a.Graphics3DFilterVisibility.prototype,"_dirty",void 0);c.__decorate([d.property()],a.Graphics3DFilterVisibility.prototype,"_querying",void 0);c.__decorate([d.property()],a.Graphics3DFilterVisibility.prototype,"_queryResult",void 0);a.Graphics3DFilterVisibility=c.__decorate([w.subclass("esri.views.3d.layers.graphics.Graphics3DFilterVisibility")],a.Graphics3DFilterVisibility);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/layers/support/floorFilterUtils":function(){define(["exports"],function(a){function b(c,m){if(null==c||!c.length)return null;c=c.filter(l=>""!==l).map(l=>`'${l}'`);c.push("''");return`${m} IN (${c.join(",")}) OR ${m} IS NULL`}a.getFloorFilterClause=function(c){var m;const l=c.layer;return"floorInfo"in l&&null!=(m=l.floorInfo)&&m.floorField&&"floors"in c.view?b(c.view.floors,l.floorInfo.floorField):null};a.getLayerFloorFilterClause=function(c,m){var l;return"floorInfo"in m&&null!=(l=m.floorInfo)&&
l.floorField?b(c,m.floorInfo.floorField):null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/QueryEngine":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/graphics/data/QueryEngine ../../../../rest/support/FeatureSet ../../../../rest/support/Query ../../../../geometry/support/typeUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t){const x=h.QueryEngine;a.QueryEngine=function(B){function q(C){C=B.call(this,C)||this;C._dataQueryEngineInstance=null;return C}b._inheritsLoose(q,B);var u=q.prototype;u.destroy=function(){this.clear()};u.clear=function(){return this._dataQueryEngineInstance?(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0):!1};u.executeQueryForIdSet=function(){var C=b._asyncToGenerator(function*(z,A){return this.dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(z,
A))});return function(z,A){return C.apply(this,arguments)}}();u.executeQueryForCount=function(){var C=b._asyncToGenerator(function*(z,A){return this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(z),A)});return function(z,A){return C.apply(this,arguments)}}();u.executeQueryForExtent=function(){var C=b._asyncToGenerator(function*(z,A){const {count:p,extent:y}=yield this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(z),A);z=e.fromJSON(y);return{count:p,extent:z}});return function(z,
A){return C.apply(this,arguments)}}();u.executeQueryForIds=function(){var C=b._asyncToGenerator(function*(z,A){return this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(z),A)});return function(z,A){return C.apply(this,arguments)}}();u.executeQueryForLatestObservations=function(){var C=b._asyncToGenerator(function*(z,A){z=yield this.dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(z),A);z=v.fromJSON(z);z.features.forEach(p=>{p.layer=this.layer;p.sourceLayer=this.layer});
return z});return function(z,A){return C.apply(this,arguments)}}();u.executeQuery=function(){var C=b._asyncToGenerator(function*(z,A){z=yield this.dataQueryEngine.executeQuery(this._ensureQueryJSON(z),A);z=v.fromJSON(z);z.features.forEach(p=>{p.layer=this.layer;p.sourceLayer=this.layer});return z});return function(z,A){return C.apply(this,arguments)}}();u._ensureQueryJSON=function(C,z){let A=this.defaultQueryJSON;r.isSome(C)&&("outSpatialReference"in C&&!C.outSpatialReference&&(C.outSpatialReference=
this.spatialReference),A=C.toJSON());r.isSome(z)&&(A={...A,sceneFilter:{...z,geometry:z.geometry.toJSON()}});return A};u._ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const C="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,z=this.layer.objectIdField,A=t.featureGeometryTypeKebabDictionary.toJSON(this.queryGeometryType),p=this.layer.fields.map(K=>K.toJSON()),y=this.layerView.view.resourceController.scheduler,
D=this.priority,E=this.spatialReference.toJSON(),F=this.layerView.processor.featureStore,{hasZ:G,hasM:P}=this.layerView;return this._dataQueryEngineInstance=new x({hasZ:G,hasM:P,geometryType:A,fields:p,timeInfo:C,spatialReference:E,objectIdField:z,featureStore:F,scheduler:y,priority:D})};b._createClass(q,[{key:"queryGeometryType",get:function(){switch(this.layer.geometryType){case "multipoint":case "point":case "polygon":case "polyline":return this.layer.geometryType;case "mesh":return"polygon"}}},
{key:"defaultQueryJSON",get:function(){return(new w({outSpatialReference:this.spatialReference})).toJSON()}},{key:"dataQueryEngine",get:function(){return this._ensureDataQueryEngine()}}]);return q}(l);c.__decorate([n.property({constructOnly:!0})],a.QueryEngine.prototype,"layerView",void 0);c.__decorate([n.property({constructOnly:!0})],a.QueryEngine.prototype,"priority",void 0);c.__decorate([n.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],a.QueryEngine.prototype,"spatialReference",
void 0);c.__decorate([n.property({readOnly:!0,aliasOf:"layerView.layer"})],a.QueryEngine.prototype,"layer",void 0);c.__decorate([n.property({readOnly:!0})],a.QueryEngine.prototype,"queryGeometryType",null);c.__decorate([n.property({readOnly:!0})],a.QueryEngine.prototype,"defaultQueryJSON",null);a.QueryEngine=c.__decorate([d.subclass("esri.views.3d.layers.graphics.QueryEngine")],a.QueryEngine);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/data/QueryEngine":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/arrayUtils ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/MemCache ../../../core/unitUtils ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/boundsUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./attributeSupport ./projectionSupport ./QueryEngineCapabilities ./QueryEngineResult ./spatialQuerySupport ./timeSupport ./utils ../../support/FieldsIndex ../../../support/arcadeOnDemand ../../../views/support/Scheduler".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y){function D(M){return M.every(L=>"exceedslimit"!==L.statisticType)}const E=new n.MemCacheStorage(2E6);let F=0,G=function(){function M(J){this.capabilities={query:B.queryCapabilities};this.geometryType=J.geometryType;this.hasM=J.hasM;this.hasZ=J.hasZ;this.objectIdField=J.objectIdField;this.spatialReference=J.spatialReference;this.definitionExpression=J.definitionExpression;this.featureStore=J.featureStore;this.aggregateAdapter=J.aggregateAdapter;
this._changeHandle=this.featureStore.events.on("changed",()=>this.clearCache());this.timeInfo=J.timeInfo;J.cacheSpatialQueries&&(this._geometryQueryCache=new n.MemCache(F++ +"$$",E));this.fieldsIndex=new A(J.fields);J.scheduler&&J.priority&&(this._frameTask=J.scheduler.registerTask(J.priority))}var L=M.prototype;L.destroy=function(){this._frameTask=r.removeMaybe(this._frameTask);this.clearCache();r.destroyMaybe(this._geometryQueryCache);this._changeHandle=r.removeMaybe(this._changeHandle);r.destroyMaybe(this.fieldsIndex)};
L.clearCache=function(){var J;null==(J=this._geometryQueryCache)?void 0:J.clear();this._timeExtent=this._allItems=null};L.executeQuery=function(){var J=b._asyncToGenerator(function*(H,I){try{return(yield this._executeQuery(H,{},I)).createQueryResponse()}catch(O){if(O!==z.QUERY_ENGINE_EMPTY_RESULT)throw O;return(new q.QueryEngineResult([],H,this)).createQueryResponse()}});return function(H,I){return J.apply(this,arguments)}}();L.executeQueryForCount=function(){var J=b._asyncToGenerator(function*(H=
{},I){try{return(yield this._executeQuery(H,{returnGeometry:!1,returnCentroid:!1,outSR:null},I)).createQueryResponseForCount()}catch(O){if(O!==z.QUERY_ENGINE_EMPTY_RESULT)throw O;return 0}});return function(){return J.apply(this,arguments)}}();L.executeQueryForExtent=function(){var J=b._asyncToGenerator(function*(H,I){const O=H.outSR;try{const Q=yield this._executeQuery(H,{returnGeometry:!0,returnCentroid:!1,outSR:null},I),S=Q.size;if(!S)return{count:0,extent:null};k.set(K,k.NEGATIVE_INFINITY);this.featureStore.forEachBounds(Q.items,
aa=>k.expandWithAABB(K,aa),P);const T={xmin:K[0],ymin:K[1],xmax:K[3],ymax:K[4],spatialReference:z.cleanFromGeometryEngine(this.spatialReference)};this.hasZ&&isFinite(K[2])&&isFinite(K[5])&&(T.zmin=K[2],T.zmax=K[5]);const U=x.project(T,Q.spatialReference,O);U.spatialReference=z.cleanFromGeometryEngine(O||this.spatialReference);if(0===U.xmax-U.xmin){const aa=g.getMetersPerUnitForSR(U.spatialReference);U.xmin-=aa;U.xmax+=aa}if(0===U.ymax-U.ymin){const aa=g.getMetersPerUnitForSR(U.spatialReference);U.ymin-=
aa;U.ymax+=aa}if(this.hasZ&&null!=U.zmin&&null!=U.zmax&&0===U.zmax-U.zmin){const aa=g.getMetersPerUnitForSR(U.spatialReference);U.zmin-=aa;U.zmax+=aa}return{count:S,extent:U}}catch(Q){if(Q===z.QUERY_ENGINE_EMPTY_RESULT)return{count:0,extent:null};throw Q;}});return function(H,I){return J.apply(this,arguments)}}();L.executeQueryForIds=function(){var J=b._asyncToGenerator(function*(H,I){return this.executeQueryForIdSet(H,I).then(O=>Array.from(O))});return function(H,I){return J.apply(this,arguments)}}();
L.executeQueryForIdSet=function(){var J=b._asyncToGenerator(function*(H,I){try{const O=yield this._executeQuery(H,{returnGeometry:!0,returnCentroid:!1,outSR:null},I),Q=O.items,S=new Set;yield this._reschedule(()=>{for(const T of Q)S.add(O.featureAdapter.getObjectId(T))},I);return S}catch(O){if(O===z.QUERY_ENGINE_EMPTY_RESULT)return new Set;throw O;}});return function(H,I){return J.apply(this,arguments)}}();L.executeQueryForSnapping=function(){var J=b._asyncToGenerator(function*(H,I){const {point:O,
distance:Q,types:S}=H;if(S===q.SnappingTypes.NONE)return{candidates:[]};const T=yield this._reschedule(()=>this._checkQuerySupport(H.query),I),U=!v.equals(O.spatialReference,this.spatialReference);U&&(yield x.checkProjectionSupport(O.spatialReference,this.spatialReference));var aa="number"===typeof Q?Q:Q.x,W="number"===typeof Q?Q:Q.y;aa={xmin:O.x-aa,xmax:O.x+aa,ymin:O.y-W,ymax:O.y+W,spatialReference:O.spatialReference};aa=U?x.project(aa,this.spatialReference):aa;if(!aa)return{candidates:[]};W=(yield h.normalizeCentralMeridian(e.fromJSON(O),
null,{signal:I}))[0];const R=(yield h.normalizeCentralMeridian(e.fromJSON(aa),null,{signal:I}))[0];if(r.isNone(W)||r.isNone(R))return{candidates:[]};const V=new q.QueryEngineResult(this._searchFeatures(this._getQueryBBoxes(R.toJSON())),T,this);yield this._reschedule(()=>this._executeObjectIdsQuery(V),I);yield this._reschedule(()=>this._executeTimeQuery(V),I);yield this._reschedule(()=>this._executeAttributesQuery(V),I);I=W.toJSON();I=U?x.project(I,this.spatialReference):I;return V.createSnappingResponse({...H,
point:I,distance:U?Math.max(aa.xmax-aa.xmin,aa.ymax-aa.ymin)/2:Q},O.spatialReference)});return function(H,I){return J.apply(this,arguments)}}();L.executeQueryForLatestObservations=function(){var J=b._asyncToGenerator(function*(H,I){if(!this.timeInfo||!this.timeInfo.trackIdField)throw new m("feature-store:unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:H,timeInfo:this.timeInfo});try{const O=yield this._executeQuery(H,{},I);yield this._reschedule(()=>this._filterLatest(O),I);return O.createQueryResponse()}catch(O){if(O!==
z.QUERY_ENGINE_EMPTY_RESULT)throw O;return(new q.QueryEngineResult([],H,this)).createQueryResponse()}});return function(H,I){return J.apply(this,arguments)}}();L.executeQueryForSummaryStatistics=function(){var J=b._asyncToGenerator(function*(H={},I,O){const {field:Q,normalizationField:S,valueExpression:T}=I;return(yield this._getQueryEngineResultForStats(H,{field:Q,normalizationField:S,valueExpression:T},O)).createSummaryStatisticsResponse(I)});return function(){return J.apply(this,arguments)}}();
L.executeQueryForUniqueValues=function(){var J=b._asyncToGenerator(function*(H={},I,O){const {field:Q,valueExpression:S}=I;return(yield this._getQueryEngineResultForStats(H,{field:Q,valueExpression:S},O)).createUniqueValuesResponse(I)});return function(){return J.apply(this,arguments)}}();L.executeQueryForClassBreaks=function(){var J=b._asyncToGenerator(function*(H={},I,O){const {field:Q,normalizationField:S,valueExpression:T}=I;return(yield this._getQueryEngineResultForStats(H,{field:Q,normalizationField:S,
valueExpression:T},O)).createClassBreaksResponse(I)});return function(){return J.apply(this,arguments)}}();L.executeQueryForHistogram=function(){var J=b._asyncToGenerator(function*(H={},I,O){const {field:Q,normalizationField:S,valueExpression:T}=I;return(yield this._getQueryEngineResultForStats(H,{field:Q,normalizationField:S,valueExpression:T},O)).createHistogramResponse(I)});return function(){return J.apply(this,arguments)}}();L._schedule=function(){var J=b._asyncToGenerator(function*(H,I){return r.isSome(this._frameTask)?
this._frameTask.schedule(H,I):H(y.noBudget)});return function(H,I){return J.apply(this,arguments)}}();L._reschedule=function(){var J=b._asyncToGenerator(function*(H,I){return r.isSome(this._frameTask)?this._frameTask.reschedule(H,I):H(y.noBudget)});return function(H,I){return J.apply(this,arguments)}}();L._getAll=function(J){r.isNone(this._allItems)&&(this._allItems=this.featureStore.toArray());return new q.QueryEngineResult(this._allItems,J,this)};L._executeQuery=function(){var J=b._asyncToGenerator(function*(H,
I,O){H=l.clone(H);H=yield this._schedule(()=>z.normalizeQuery(H,this.definitionExpression,this.spatialReference),O);H=yield this._reschedule(()=>this._checkQuerySupport(H),O);H={...H,...I};const Q=yield this._reschedule(()=>this._executeSceneFilterQuery(H,O),O),S=yield this._reschedule(()=>this._executeGeometryQuery(H,Q,O),O);yield this._reschedule(()=>this._executeAggregateIdsQuery(S),O);yield this._reschedule(()=>this._executeObjectIdsQuery(S),O);yield this._reschedule(()=>this._executeTimeQuery(S),
O);yield this._reschedule(()=>this._executeAttributesQuery(S),O);return S});return function(H,I,O){return J.apply(this,arguments)}}();L._executeSceneFilterQuery=function(){var J=b._asyncToGenerator(function*(H,I){var O=this;if(r.isNone(H.sceneFilter))return null;const {outSR:Q,returnGeometry:S,returnCentroid:T}=H;var U=this.featureStore.featureSpatialReference,aa=H.sceneFilter.geometry;const W=r.isNone(U)||v.equals(U,aa.spatialReference)?aa:x.project(aa,U);if(!W)return null;U=S||T;U=v.isValid(Q)&&
!v.equals(this.spatialReference,Q)&&U?function(){var ca=b._asyncToGenerator(function*(ha){return O._project(ha,Q)});return function(ha){return ca.apply(this,arguments)}}():ca=>ca;const R=this.featureAdapter;aa=this._searchFeatures(this._getQueryBBoxes(W));if("disjoint"===H.sceneFilter.spatialRelationship){if(!aa.length)return null;const ca=new Set;for(var V of aa)ca.add(R.getObjectId(V));const ha=yield this._reschedule(()=>this.featureStore.toArray(),I);V=yield this._reschedule(b._asyncToGenerator(function*(){const ia=
yield u.getSpatialQueryOperator("esriSpatialRelDisjoint",W,O.geometryType,O.hasZ,O.hasM),ka=yield O._runSpatialFilter(ha,la=>!ca.has(R.getObjectId(la))||ia(R.getGeometry(la)),I);return new q.QueryEngineResult(ka,H,O)}),I);return U(V)}if(!aa.length)return new q.QueryEngineResult([],H,this);if(this._canExecuteSinglePass(W,H))return U(new q.QueryEngineResult(aa,H,this));const da=yield u.getSpatialQueryOperator("esriSpatialRelContains",W,this.geometryType,this.hasZ,this.hasM);V=yield this._runSpatialFilter(aa,
ca=>da(R.getGeometry(ca)),I);return U(new q.QueryEngineResult(V,H,this))});return function(H,I){return J.apply(this,arguments)}}();L._executeGeometryQuery=function(){var J=b._asyncToGenerator(function*(H,I,O){var Q=this;if(r.isSome(I)&&0===I.items.length)return I;H=r.isSome(I)?I.query:H;const {geometry:S,outSR:T,spatialRel:U,returnGeometry:aa,returnCentroid:W}=H;var R=this.featureStore.featureSpatialReference;const V=!S||r.isNone(R)||v.equals(R,S.spatialReference)?S:x.project(S,R),da=aa||W,ca=v.isValid(T)&&
!v.equals(this.spatialReference,T),ha=this._geometryQueryCache&&r.isNone(I)?ca&&da?JSON.stringify({originalFilterGeometry:S,spatialRelationship:U,outSpatialReference:T}):JSON.stringify({originalFilterGeometry:S,spatialRelationship:U}):null;R=ha?this._geometryQueryCache.get(ha):null;if(r.isSome(R))return new q.QueryEngineResult(R,H,this);R=function(){var ea=b._asyncToGenerator(function*(ba){ca&&da&&(yield Q._project(ba,T));ha&&Q._geometryQueryCache.put(ha,ba.items,ba.items.length+1);return ba});return function(ba){return ea.apply(this,
arguments)}}();if(!V)return R(r.isSome(I)?I:this._getAll(H));const ia=this.featureAdapter;let ka=this._searchFeatures(this._getQueryBBoxes(S));if("esriSpatialRelDisjoint"===U){if(!ka.length)return R(r.isSome(I)?I:this._getAll(H));const ea=new Set;for(var la of ka)ea.add(ia.getObjectId(la));const ba=r.isSome(I)?I.items:yield this._reschedule(()=>this.featureStore.toArray(),O);la=yield this._reschedule(b._asyncToGenerator(function*(){const Z=yield u.getSpatialQueryOperator(U,V,Q.geometryType,Q.hasZ,
Q.hasM),fa=yield Q._runSpatialFilter(ba,ja=>!ea.has(ia.getObjectId(ja))||Z(ia.getGeometry(ja)),O);return new q.QueryEngineResult(fa,H,Q)}),O);return R(la)}if(r.isSome(I)){const ea=new c.PositionHint;ka=ka.filter(ba=>0<=c.indexOf(I.items,ba,I.items.length,ea))}if(!ka.length)return R=new q.QueryEngineResult([],H,this),ha&&this._geometryQueryCache.put(ha,R.items,1),R;if(this._canExecuteSinglePass(V,H))return R(new q.QueryEngineResult(ka,H,this));const Y=yield u.getSpatialQueryOperator(U,V,this.geometryType,
this.hasZ,this.hasM);la=yield this._runSpatialFilter(ka,ea=>Y(ia.getGeometry(ea)),O);return R(new q.QueryEngineResult(la,H,this))});return function(H,I,O){return J.apply(this,arguments)}}();L._executeAggregateIdsQuery=function(J){if(0!==J.items.length&&J.query.aggregateIds&&J.query.aggregateIds.length&&!r.isNone(this.aggregateAdapter)){var H=new Set;for(const O of J.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(O).forEach(Q=>H.add(Q));var I=this.featureAdapter.getObjectId;J.items=J.items.filter(O=>
H.has(I(O)))}};L._executeObjectIdsQuery=function(J){if(0!==J.items.length&&J.query.objectIds&&J.query.objectIds.length){var H=new Set(J.query.objectIds),I=this.featureAdapter.getObjectId;J.items=J.items.filter(O=>H.has(I(O)))}};L._executeTimeQuery=function(J){if(0!==J.items.length){var H=C.getTimeOperator(this.timeInfo,J.query.timeExtent,this.featureAdapter);r.isNone(H)||(J.items=J.items.filter(H))}};L._executeAttributesQuery=function(J){if(0!==J.items.length){var H=t.getWhereClause(J.query.where,
this.fieldsIndex);if(H){if(!H.isStandardized)throw new TypeError("Where clause is not standardized");J.items=J.items.filter(I=>H.testFeature(I,this.featureAdapter))}}};L._runSpatialFilter=function(){var J=b._asyncToGenerator(function*(H,I,O){var Q=this;if(!I)return H;if(r.isNone(this._frameTask))return H.filter(aa=>I(aa));let S=0;const T=[],U=function(){var aa=b._asyncToGenerator(function*(W){for(;S<H.length;){const R=H[S++];I(R)&&(T.push(R),W.madeProgress());W.done&&(yield Q._reschedule(V=>U(V),
O))}});return function(W){return aa.apply(this,arguments)}}();return this._reschedule(aa=>U(aa),O).then(()=>T)});return function(H,I,O){return J.apply(this,arguments)}}();L._filterLatest=function(J){const {trackIdField:H,startTimeField:I,endTimeField:O}=this.timeInfo,Q=O||I,S=new Map,T=this.featureAdapter.getAttribute;for(const U of J.items){const aa=T(U,H),W=T(U,Q),R=S.get(aa);(!R||W>T(R,Q))&&S.set(aa,U)}J.items=Array.from(S.values())};L._canExecuteSinglePass=function(J,H){({spatialRel:H}=H);return u.canQueryWithRBush(J)&&
("esriSpatialRelEnvelopeIntersects"===H||"esriGeometryPoint"===this.geometryType&&("esriSpatialRelIntersects"===H||"esriSpatialRelContains"===H||"esriSpatialRelWithin"===H))};L._project=function(){var J=b._asyncToGenerator(function*(H,I){if(!I||v.equals(this.spatialReference,I))return H;const O=this.featureAdapter;I=yield x.projectMany(H.items.map(Q=>z.getGeometry(this.geometryType,this.hasZ,this.hasM,O.getGeometry(Q))),this.spatialReference,I);H.items=I.map((Q,S)=>O.cloneWithGeometry(H.items[S],
w.convertFromGeometry(Q,this.hasZ,this.hasM)));return H});return function(H,I){return J.apply(this,arguments)}}();L._getQueryBBoxes=function(J){if(u.canQueryWithRBush(J)){if(e.isExtent(J))return[f.fromValues(J.xmin,J.ymin,J.xmax,J.ymax)];if(e.isPolygon(J))return J.rings.map(H=>f.fromValues(Math.min(H[0][0],H[2][0]),Math.min(H[0][1],H[2][1]),Math.max(H[0][0],H[2][0]),Math.max(H[0][1],H[2][1])))}return[d.getBoundsXY(f.create(),J)]};L._searchFeatures=function(J){for(const H of J)this.featureStore.forEachInBounds(H,
I=>N.add(I));J=Array.from(N.values());N.clear();return J};L._checkStatisticsSupport=function(){var J=b._asyncToGenerator(function*(H,I){if(0>H.distance||null!=H.geometryPrecision||H.multipatchOption||H.pixelSize||H.relationParam||H.text||H.outStatistics||H.groupByFieldsForStatistics||H.having||H.orderByFields)throw new m("feature-store:unsupported-query","Unsupported query options",{query:H});this._checkAttributesQuerySupport(H);return Promise.all([this._checkStatisticsParamsSupport(I),u.checkSpatialQuerySupport(H,
this.geometryType,this.spatialReference),x.checkProjectionSupport(this.spatialReference,H.outSR)]).then(()=>H)});return function(H,I){return J.apply(this,arguments)}}();L._checkStatisticsParamsSupport=function(){var J=b._asyncToGenerator(function*(H){var I=[];H.valueExpression&&({arcadeUtils:I}=yield p.loadArcade(),I=I.extractFieldNames(H.valueExpression));H.field&&I.push(H.field);H.normalizationField&&I.push(H.normalizationField);if(!I.length)throw new m("feature-store:unsupported-query","params should have at least a field or valueExpression",
{params:H});t.validateFields(this.fieldsIndex,I,"params contains missing fields")});return function(H){return J.apply(this,arguments)}}();L._checkQuerySupport=function(){var J=b._asyncToGenerator(function*(H){if(0>H.distance||null!=H.geometryPrecision||H.multipatchOption||H.pixelSize||H.relationParam||H.text)throw new m("feature-store:unsupported-query","Unsupported query options",{query:H});this._checkAttributesQuerySupport(H);this._checkStatisticsQuerySupport(H);return Promise.all([u.checkSpatialQuerySupport(H,
this.geometryType,this.spatialReference),x.checkProjectionSupport(this.spatialReference,H.outSR)]).then(()=>H)});return function(H){return J.apply(this,arguments)}}();L._checkAttributesQuerySupport=function(J){const {outFields:H,orderByFields:I,returnDistinctValues:O,outStatistics:Q}=J,S=Q?Q.map(T=>T.outStatisticFieldName&&T.outStatisticFieldName.toLowerCase()).filter(Boolean):[];if(I&&0<I.length){const T=I.map(U=>{const aa=U.toLowerCase();return aa.includes(" asc")?aa.split(" asc")[0]:aa.includes(" desc")?
aa.split(" desc")[0]:U}).filter(U=>!S.includes(U));t.validateFields(this.fieldsIndex,T,"orderByFields contains missing fields")}if(H&&0<H.length)t.validateFields(this.fieldsIndex,H,"outFields contains missing fields");else if(O)throw new m("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:J});t.validateWhere(this.fieldsIndex,J.where)};L._checkStatisticsQuerySupport=function(J){const {outStatistics:H,groupByFieldsForStatistics:I,having:O}=J;var Q=I&&
I.length,S=H&&H.length;if(O){if(!Q||!S)throw new m("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:J});t.validateHaving(this.fieldsIndex,O,H)}if(S&&D(H)){S=H.map(T=>T.onStatisticField).filter(Boolean);t.validateFields(this.fieldsIndex,S,"onStatisticFields contains missing fields");Q&&t.validateFields(this.fieldsIndex,I,"groupByFieldsForStatistics contains missing fields");for(const T of H){const {onStatisticField:U,statisticType:aa}=
T;if(("percentile_disc"===aa||"percentile_cont"===aa)&&"statisticParameters"in T){if({statisticParameters:Q}=T,!Q)throw new m("feature-store:unsupported-query","statisticParamters should be set for percentile type",{definition:T,query:J});}else if("count"!==aa&&U&&t.hasInvalidFieldType(U,this.fieldsIndex))throw new m("feature-store:unsupported-query","outStatistics contains non-numeric fields",{definition:T,query:J});}}};L._getQueryEngineResultForStats=function(){var J=b._asyncToGenerator(function*(H,
I,O){H=l.clone(H);try{H=yield this._schedule(()=>z.normalizeQuery(H,this.definitionExpression,this.spatialReference),O);H=yield this._reschedule(()=>this._checkStatisticsSupport(H,I),O);const Q=yield this._reschedule(()=>this._executeSceneFilterQuery(H,O),O),S=yield this._reschedule(()=>this._executeGeometryQuery(H,Q,O),O);yield this._reschedule(()=>this._executeAggregateIdsQuery(S),O);yield this._reschedule(()=>this._executeObjectIdsQuery(S),O);yield this._reschedule(()=>this._executeTimeQuery(S),
O);yield this._reschedule(()=>this._executeAttributesQuery(S),O);return S}catch(Q){if(Q!==z.QUERY_ENGINE_EMPTY_RESULT)throw Q;return new q.QueryEngineResult([],H,this)}});return function(H,I,O){return J.apply(this,arguments)}}();b._createClass(M,[{key:"featureAdapter",get:function(){return this.featureStore.featureAdapter}},{key:"fullExtent",get:function(){const J=this.featureStore.fullBounds;return r.isNone(J)?null:{xmin:J[0],ymin:J[1],xmax:J[2],ymax:J[3],spatialReference:z.cleanFromGeometryEngine(this.spatialReference)}}},
{key:"timeExtent",get:function(){if(!this.timeInfo)return null;this._timeExtent||(this._timeExtent=C.getTimeExtent(this.timeInfo,this.featureStore));return this._timeExtent}}]);return M}();const P=k.create(),K=k.create(),N=new Set;a.Feature=function(M,L=null,J,H,I){this.attributes=M;this.geometry=J;this.centroid=H;this.filterFlags=I;this.groupId=-1;this.displayId=L};a.QueryEngine=G;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/data/attributeSupport":function(){define(["exports",
"../../../core/Error","../../../core/sql/WhereClauseCache"],function(a,b,c){function m(k,f){return k?n.get(k,f):null}function l(k,f,d,e=!0){const h=[];for(const v of f)if("*"!==v&&!k.has(v))if(e){f=r(v);try{const w=m(f,k);if(!w)throw new b("feature-store:unsupported-query","invalid SQL expression",{where:f});if(!w.isStandardized)throw new b("feature-store:unsupported-query","expression is not standard",{clause:w});l(k,w.fieldNames,"expression contains missing fields")}catch(w){if((f=w&&w.details)&&
(f.clause||f.where))throw w;f&&f.missingFields?h.push(...f.missingFields):h.push(v)}}else h.push(v);if(h.length)throw new b("feature-store:unsupported-query",d,{missingFields:h});}function r(k){return k.split(" as ")[0]}const n=new c.WhereClauseCache(50,500),g=new Set("esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeDate".split(" "));a.getAliasFromFieldName=function(k){return k.split(" as ")[1]};a.getExpressionFromFieldName=
r;a.getWhereClause=m;a.hasInvalidFieldType=function(k,f){return(k=f.get(k))?!g.has(k.type):!1};a.validateFields=l;a.validateHaving=function(k,f,d){if(!f)return!0;const e=n.get(f,k);if(!e)throw new b("feature-store:unsupported-query","invalid SQL expression",{having:f});if(!e.isAggregate)throw new b("feature-store:unsupported-query","having does not contain a valid aggregate function",{having:f});l(k,e.fieldNames,"having contains missing fields");if(!e.getExpressions().every(h=>{const {aggregateType:v,
field:w}=h,t=k.has(w)&&k.get(w).name;return d.some(x=>{const {onStatisticField:B,statisticType:q}=x;return(k.has(B)&&k.get(B).name)===t&&q.toLowerCase().trim()===v})}))throw new b("feature-store:unsupported-query","expressions in having should also exist in outStatistics",{having:f});return!0};a.validateWhere=function(k,f){if(!f)return!0;const d=n.get(f,k);if(!d)throw new b("feature-store:unsupported-query","invalid SQL expression",{where:f});if(!d.isStandardized)throw new b("feature-store:unsupported-query",
"where clause is not standard",{where:f});l(k,d.fieldNames,"where clause contains missing fields");return!0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/sql/WhereClauseCache":function(){define(["exports","../ItemCache","./WhereClause"],function(a,b,c){let m=function(){function l(r,n){this._cache=new b(r);this._invalidCache=new b(n)}l.prototype.get=function(r,n){const g=`${n.uid}:${r}`,k=this._cache.get(g);if(k)return k;if(void 0!==this._invalidCache.get(g))return null;
try{const f=c.WhereClause.create(r,n);this._cache.put(g,f);return f}catch{return this._invalidCache.put(g,null),null}};return l}();a.WhereClauseCache=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/sql/WhereClause":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../has ./AggregateFunctions ./StandardizedFunctions ./WhereGrammar".split(" "),function(a,b,c,m,l,r){function n(K,N){K+="";return K.length>=N?K:Array(N-K.length+1).join("0")+
K}function g(K,N,M="0",L="0",J="0",H="0",I="",O="0",Q="0"){return"+"===I||"-"===I?(K=`${n(parseInt(K,10),4)}-${n(parseInt(N,10),2)}-${n(parseInt(M,10),2)}`,N="",10>parseFloat(H)&&(N="0"),L=`${n(parseInt(L,10),2)}:${n(parseInt(J,10),2)}:${N+parseFloat(H).toString()}`,I=`${I}${n(parseInt(O,10),2)}:${n(parseInt(Q,10),2)}`,new Date(K+"T"+L+I)):new Date(parseInt(K,10),parseInt(N,10)-1,parseInt(M,10),parseInt(L,10),parseInt(J,10),parseFloat(H))}function k(K){let N=z.exec(K);if(null!==N){const [,M,L,J,H,
I,O]=N;return g(M,L,J,H,I,O)}N=A.exec(K);if(null!==N){const [,M,L,J,H,I,O,Q,S,T]=N;return g(M,L,J,H,I,O,Q,S,T)}N=p.exec(K);if(null!==N){const [,M,L,J,H,I,O,Q,S]=N;return g(M,L,J,H,I,"0",O,Q,S)}N=y.exec(K);if(null!==N){const [,M,L,J,H,I]=N;return g(M,L,J,H,I)}N=C.exec(K);if(null!==N){const [,M,L,J]=N;return g(M,L,J)}throw Error("SQL Invalid Timestamp");}function f(K){K=C.exec(K);if(null===K)throw Error("SQL Invalid Date");const [,N,M,L]=K;return new Date(parseInt(N,10),parseInt(M,10)-1,parseInt(L,
10))}function d(K){return Array.isArray(K)?K:[K]}function e(K){return null!==K?!0!==K:null}function h(K,N){return null!=K&&null!=N?!0===K&&!0===N:!1===K||!1===N?!1:null}function v(K,N){return null!=K&&null!=N?!0===K||!0===N:!0===K||!0===N?!0:null}function w(K,N){if(null==K)return null;let M=!1;for(const L of N)if(null==L)M=null;else if(K===L){M=!0;break}return M}function t(K,N,M){if(null==K)return null;{let L="",J=G.Normal;for(let H=0;H<N.length;H++){const I=N.charAt(H);switch(J){case G.Normal:I===
M?J=G.Escaped:L="-[]/{}()*+?.\\^$|".includes(I)?L+("\\"+I):"%"===I?L+".*":"_"===I?L+".":L+I;break;case G.Escaped:L="-[]/{}()*+?.\\^$|".includes(I)?L+("\\"+I):L+I,J=G.Normal}}N=new RegExp("^"+L+"$","m")}return N.test(K)}function x(K){return K instanceof Date?K.valueOf():K}function B(K,N,M){if(null==N||null==M)return null;N=x(N);M=x(M);switch(K){case "\x3c\x3e":return N!==M;case "\x3d":return N===M;case "\x3e":return N>M;case "\x3c":return N<M;case "\x3e\x3d":return N>=M;case "\x3c\x3d":return N<=M}}
function q(K,N,M){if(N instanceof l.SqlInterval)if(M instanceof Date)switch(K){case "+":return new Date(N.valueInMilliseconds()+M.getTime());case "-":return N.valueInMilliseconds()-M.getTime();case "*":return N.valueInMilliseconds()*M.getTime();case "/":return N.valueInMilliseconds()/M.getTime()}else if(M instanceof l.SqlInterval)switch(K){case "+":return l.SqlInterval.createFromMilliseconds(N.valueInMilliseconds()+M.valueInMilliseconds());case "-":return l.SqlInterval.createFromMilliseconds(N.valueInMilliseconds()-
M.valueInMilliseconds());case "*":return N.valueInMilliseconds()*M.valueInMilliseconds();case "/":return N.valueInMilliseconds()/M.valueInMilliseconds()}else N=N.valueInMilliseconds();else if(M instanceof l.SqlInterval)if(N instanceof Date)switch(K){case "+":return new Date(M.valueInMilliseconds()+N.getTime());case "-":return new Date(N.getTime()-M.valueInMilliseconds());case "*":return N.getTime()*M.valueInMilliseconds();case "/":return N.getTime()/M.valueInMilliseconds()}else M=M.valueInMilliseconds();
else if(N instanceof Date&&"number"===typeof M)switch(M*=864E5,N=N.getTime(),K){case "+":return new Date(N+M);case "-":return new Date(N-M);case "*":return new Date(N*M);case "/":return new Date(N/M)}else if(M instanceof Date&&"number"===typeof N)switch(N*=864E5,M=M.getTime(),K){case "+":return new Date(N+M);case "-":return new Date(N-M);case "*":return new Date(N*M);case "/":return new Date(N/M)}switch(K){case "+":return N+M;case "-":return N-M;case "*":return N*M;case "/":return N/M}}function u(K,
N,M,L){K=L.getAttribute(K,N);return null!=K&&1===M[N]?new Date(K):K}const C=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,z=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,A=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,p=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,y=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/,D=new Set(["current_timestamp","current_date","current_time"]);let E=function(){function K(){}
K.makeBool=function(N){return!0===N};K.featureValue=function(N,M,L,J){return u(N,M,L,J)};K.equalsNull=function(N){return null===N};K.applyLike=function(N,M,L){return t(N,M,L)};K.ensureArray=function(N){return d(N)};K.applyIn=function(N,M){return w(N,M)};K.currentDate=function(){const N=new Date;N.setHours(0,0,0,0);return N};K.makeSqlInterval=function(N,M,L){return l.SqlInterval.createFromValueAndQualifer(N,M,L)};K.convertInterval=function(N){return N instanceof l.SqlInterval?N.valueInMilliseconds():
N};K.currentTimestamp=function(){return new Date};K.compare=function(N,M,L){return B(N,M,L)};K.calculate=function(N,M,L){return q(N,M,L)};K.makeComparable=function(N){return x(N)};K.evaluateFunction=function(N,M){return l.evaluateFunction(N,M)};K.lookup=function(N,M){N=M[N];return void 0===N?null:N};K.between=function(N,M){return null==N||null==M[0]||null==M[1]?null:N>=M[0]&&N<=M[1]};K.notbetween=function(N,M){return null==N||null==M[0]||null==M[1]?null:N<M[0]||N>M[1]};K.ternaryNot=function(N){return e(N)};
K.ternaryAnd=function(N,M){return h(N,M)};K.ternaryOr=function(N,M){return v(N,M)};return K}(),F=function(){function K(M,L){this.fieldsIndex=L;this.datefields={};this.parameters={};this._hasDateFunctions=void 0;this.parseTree=r.WhereGrammar.parse(M);const {isStandardized:J,isAggregate:H,referencedFieldNames:I}=this._extractExpressionInfo(L);this.referencedFieldNames=I;this.isStandardized=J;this.isAggregate=H}K.create=function(M,L){return new K(M,L)};var N=K.prototype;N.testSet=function(M,L=P){const J=
{};for(const H of this.fieldNames)J[H]=M.map(I=>L.getAttribute(I,H));return!!this._evaluateNode(this.parseTree,{attributes:J},P)};N.calculateValue=function(M,L=P){M=this._evaluateNode(this.parseTree,M,L);return M instanceof l.SqlInterval?M.valueInMilliseconds()/864E5:M};N.calculateValueCompiled=function(M,L=P){if(null!=this.parseTree._compiledVersion)return this.parseTree._compiledVersion(M,this.parameters,L,this.datefields);if(c("esri-csp-restrictions"))return this.calculateValue(M,L);this._compileMe();
return this.parseTree._compiledVersion(M,this.parameters,L,this.datefields)};N.testFeature=function(M,L=P){return!!this._evaluateNode(this.parseTree,M,L)};N.testFeatureCompiled=function(M,L=P){if(null!=this.parseTree._compiledVersion)return!!this.parseTree._compiledVersion(M,this.parameters,L,this.datefields);if(c("esri-csp-restrictions"))return this.testFeature(M,L);this._compileMe();return!!this.parseTree._compiledVersion(M,this.parameters,L,this.datefields)};N.getFunctions=function(){const M=new Set;
this._visitAll(this.parseTree,L=>{"function"===L.type&&M.add(L.name.toLowerCase())});return Array.from(M)};N.getExpressions=function(){const M=new Map;this._visitAll(this.parseTree,L=>{if("function"===L.type){const J=L.name.toLowerCase();L=L.args.value[0];if("column-reference"===L.type){L=L.column;const H=`${J}-${L}`;M.has(H)||M.set(H,{aggregateType:J,field:L})}}});return[...M.values()]};N.getVariables=function(){const M=new Set;this._visitAll(this.parseTree,L=>{"parameter"===L.type&&M.add(L.value.toLowerCase())});
return Array.from(M)};N._compileMe=function(){const M="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=(new Function("feature","lookups","attributeAdapter","datefields",M)).bind(E)};N._extractExpressionInfo=function(M){const L=[],J=new Set;let H=!0,I=!0;this._visitAll(this.parseTree,O=>{switch(O.type){case "column-reference":{const Q=M.get(O.column);let S,T;Q?S=T=Q.name:(T=O.column,S=T.toLowerCase());!Q||"date"!==Q.type&&"esriFieldTypeDate"!==
Q.type||(this.datefields[Q.name]=1);J.has(S)||(J.add(S),L.push(T));O.column=T;break}case "function":{const {name:Q,args:S}=O;O=S.value.length;H&&(H=l.isStandardized(Q,O));I&&(I=m.isAggregate(Q,O))}}});return{referencedFieldNames:Array.from(L),isStandardized:H,isAggregate:I}};N._visitAll=function(M,L){if(null!=M)switch(L(M),M.type){case "when-clause":this._visitAll(M.operand,L);this._visitAll(M.value,L);break;case "case-expression":for(const J of M.clauses)this._visitAll(J,L);"simple"===M.format&&
this._visitAll(M.operand,L);null!==M.else&&this._visitAll(M.else,L);break;case "expression-list":for(const J of M.value)this._visitAll(J,L);break;case "unary-expression":this._visitAll(M.expr,L);break;case "binary-expression":this._visitAll(M.left,L);this._visitAll(M.right,L);break;case "function":this._visitAll(M.args,L)}};N.evaluateNodeToJavaScript=function(M){switch(M.type){case "interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(M.value)+", "+JSON.stringify(M.qualifier)+","+
JSON.stringify(M.op)+")";case "case-expression":var L="";if("simple"===M.format){var J="this.makeComparable("+this.evaluateNodeToJavaScript(M.operand)+")";L="( ";for(let H=0;H<M.clauses.length;H++)L+=" ("+J+" \x3d\x3d\x3d this.makeComparable("+this.evaluateNodeToJavaScript(M.clauses[H].operand)+")) ? ("+this.evaluateNodeToJavaScript(M.clauses[H].value)+") : "}else for(L="( ",J=0;J<M.clauses.length;J++)L+=" this.makeBool("+this.evaluateNodeToJavaScript(M.clauses[J].operand)+")\x3d\x3d\x3dtrue ? ("+
this.evaluateNodeToJavaScript(M.clauses[J].value)+") : ";L=null!==M.else?L+this.evaluateNodeToJavaScript(M.else):L+"null";return L+=" )";case "parameter":return"this.lookup("+JSON.stringify(M.value.toLowerCase())+",lookups)";case "expression-list":L="[";for(J of M.value)"["!==L&&(L+=","),L+=this.evaluateNodeToJavaScript(J);return L+="]";case "unary-expression":return"this.ternaryNot("+this.evaluateNodeToJavaScript(M.expr)+")";case "binary-expression":switch(M.operator){case "AND":return"this.ternaryAnd("+
this.evaluateNodeToJavaScript(M.left)+","+this.evaluateNodeToJavaScript(M.right)+" )";case "OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(M.left)+","+this.evaluateNodeToJavaScript(M.right)+" )";case "IS":if("null"!==M.right.type)throw Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(M.left)+")";case "ISNOT":if("null"!==M.right.type)throw Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(M.left)+")))";case "IN":return"this.applyIn("+
this.evaluateNodeToJavaScript(M.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(M.right)+"))";case "NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(M.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(M.right)+")))";case "BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(M.left)+","+this.evaluateNodeToJavaScript(M.right)+")";case "NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(M.left)+","+this.evaluateNodeToJavaScript(M.right)+
")";case "LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(M.left)+","+this.evaluateNodeToJavaScript(M.right)+","+JSON.stringify(M.escape)+")";case "NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(M.left)+","+this.evaluateNodeToJavaScript(M.right)+","+JSON.stringify(M.escape)+"))";case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return"this.compare("+JSON.stringify(M.operator)+","+this.evaluateNodeToJavaScript(M.left)+","+
this.evaluateNodeToJavaScript(M.right)+")";case "*":case "-":case "+":case "/":return"this.calculate("+JSON.stringify(M.operator)+","+this.evaluateNodeToJavaScript(M.left)+","+this.evaluateNodeToJavaScript(M.right)+")"}throw Error("Not Supported Operator "+M.operator);case "null":case "boolean":case "string":case "number":return JSON.stringify(M.value);case "date":return"(new Date("+f(M.value).getTime().toString()+"))";case "timestamp":return"(new Date("+k(M.value).getTime().toString()+"))";case "current-time":return"date"===
M.mode?"this.currentDate()":"this.currentTimestamp()";case "column-reference":return"this.featureValue(feature,"+JSON.stringify(M.column)+",datefields,attributeAdapter)";case "function":return"this.evaluateFunction("+JSON.stringify(M.name)+","+this.evaluateNodeToJavaScript(M.args)+")"}throw Error("Unsupported sql syntax "+M.type);};N._evaluateNode=function(M,L,J){switch(M.type){case "interval":return L=this._evaluateNode(M.value,L,J),l.SqlInterval.createFromValueAndQualifer(L,M.qualifier,M.op);case "case-expression":if("simple"===
M.format){var H=x(this._evaluateNode(M.operand,L,J));for(var I=0;I<M.clauses.length;I++)if(H===x(this._evaluateNode(M.clauses[I].operand,L,J)))return this._evaluateNode(M.clauses[I].value,L,J)}else for(H=0;H<M.clauses.length;H++)if(!0===this._evaluateNode(M.clauses[H].operand,L,J))return this._evaluateNode(M.clauses[H].value,L,J);return null!==M.else?this._evaluateNode(M.else,L,J):null;case "parameter":return this.parameters[M.value.toLowerCase()];case "expression-list":H=[];for(I of M.value)H.push(this._evaluateNode(I,
L,J));return H;case "unary-expression":return e(this._evaluateNode(M.expr,L,J));case "binary-expression":switch(M.operator){case "AND":return h(this._evaluateNode(M.left,L,J),this._evaluateNode(M.right,L,J));case "OR":return v(this._evaluateNode(M.left,L,J),this._evaluateNode(M.right,L,J));case "IS":if("null"!==M.right.type)throw Error("Unsupported RHS for IS");return null===this._evaluateNode(M.left,L,J);case "ISNOT":if("null"!==M.right.type)throw Error("Unsupported RHS for IS");return null!==this._evaluateNode(M.left,
L,J);case "IN":return H=d(this._evaluateNode(M.right,L,J)),w(this._evaluateNode(M.left,L,J),H);case "NOT IN":return H=d(this._evaluateNode(M.right,L,J)),e(w(this._evaluateNode(M.left,L,J),H));case "BETWEEN":return H=this._evaluateNode(M.left,L,J),M=this._evaluateNode(M.right,L,J),null==H||null==M[0]||null==M[1]?null:H>=x(M[0])&&H<=x(M[1]);case "NOTBETWEEN":return H=this._evaluateNode(M.left,L,J),M=this._evaluateNode(M.right,L,J),null==H||null==M[0]||null==M[1]?null:H<x(M[0])||H>x(M[1]);case "LIKE":return t(this._evaluateNode(M.left,
L,J),this._evaluateNode(M.right,L,J),M.escape);case "NOT LIKE":return e(t(this._evaluateNode(M.left,L,J),this._evaluateNode(M.right,L,J),M.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return B(M.operator,this._evaluateNode(M.left,L,J),this._evaluateNode(M.right,L,J));case "-":case "+":case "*":case "/":return q(M.operator,this._evaluateNode(M.left,L,J),this._evaluateNode(M.right,L,J))}case "null":case "boolean":case "string":case "number":return M.value;
case "date":return f(M.value);case "timestamp":return k(M.value);case "current-time":return L=new Date,"date"===M.mode&&L.setHours(0,0,0,0),L;case "column-reference":return u(L,M.column,this.datefields,J);case "function":return L=this._evaluateNode(M.args,L,J),this.isAggregate?m.aggregateFunction(M.name,L):l.evaluateFunction(M.name,L)}throw Error("Unsupported sql syntax "+M.type);};b._createClass(K,[{key:"fieldNames",get:function(){return this.referencedFieldNames}},{key:"hasDateFunctions",get:function(){if(null!=
this._hasDateFunctions)return this._hasDateFunctions;this._hasDateFunctions=!1;this._visitAll(this.parseTree,M=>{"current-time"===M.type?this._hasDateFunctions=!0:"function"===M.type&&(this._hasDateFunctions=this._hasDateFunctions||D.has(M.name.toLowerCase()))});return this._hasDateFunctions}}]);return K}();var G;(function(K){K[K.Normal=0]="Normal";K[K.Escaped=1]="Escaped"})(G||(G={}));const P={getAttribute(K,N){return(K&&"object"===typeof K.attributes?K.attributes:K)[N]}};a.WhereClause=F;a.defaultAttributeAdapter=
P;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/sql/AggregateFunctions":function(){define(["exports"],function(a){function b(l){let r=0;for(let n=0;n<l.length;n++)r+=l[n];return r/l.length}function c(l){const r=b(l),n=l.length;let g=0;for(const k of l)g+=(k-r)**2;return 1<n?g/(n-1):0}const m={min:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:Math.min.apply(Math,l[0])},max:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:Math.max.apply(Math,
l[0])},avg:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:b(l[0])},sum:{minParams:1,maxParams:1,evaluate:l=>{if(null==l[0])l=null;else{{l=l[0];let r=0;for(let n=0;n<l.length;n++)r+=l[n];l=r}}return l}},stddev:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:Math.sqrt(c(l[0]))},count:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:l[0].length},var:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:c(l[0])}};a.aggregateFunction=function(l,r){const n=m[l.toLowerCase()];if(null==n)throw Error("Function Not Recognised");
if(r.length<n.minParams||r.length>n.maxParams)throw Error(`Invalid Parameter count for call to ${l.toUpperCase()}`);return n.evaluate(r)};a.isAggregate=function(l,r){l=m[l.toLowerCase()];return null!=l&&r>=l.minParams&&r<=l.maxParams};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/sql/StandardizedFunctions":function(){define(["exports","../string"],function(a,b){let c=function(){function l(){this.op="+";this.minute=this.year=this.month=this.hour=
this.second=this.day=0}l._fixDefaults=function(r){if(null!==r.precision||null!==r.secondary)throw Error("Primary and Secondary SqlInterval qualifiers not supported");};l.createFromMilliseconds=function(r){const n=new l;n.second=r/1E3;return n};l.createFromValueAndQualifer=function(r,n,g){let k=null;const f=new l;f.op="-"===g?"-":"+";if("interval-period"===n.type){l._fixDefaults(n);if("year"===n.period||"month"===n.period)throw Error("Year-Month Intervals not supported");if(/^[0-9]{1,}$/.test(r))f[n.period]=
parseFloat(r);else throw Error("Illegal Interval");}else{l._fixDefaults(n.start);l._fixDefaults(n.end);if("year"===n.start.period||"month"===n.start.period)throw Error("Year-Month Intervals not supported");if("year"===n.end.period||"month"===n.end.period)throw Error("Year-Month Intervals not supported");switch(n.start.period){case "day":switch(n.end.period){case "hour":k=/^[0-9]{1,} [0-9]{1,}$/;if(k.test(r))f[n.start.period]=parseFloat(r.split(" ")[0]),f[n.end.period]=parseFloat(r.split(" ")[1]);
else throw Error("Illegal Interval");break;case "minute":k=/^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$/;if(k.test(r))f[n.start.period]=parseFloat(r.split(" ")[0]),r=r.split(" ")[1].split(":"),f.hour=parseFloat(r[0]),f.minute=parseFloat(r[1]);else throw Error("Illegal Interval");break;case "second":k=/^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(k.test(r))f[n.start.period]=parseFloat(r.split(" ")[0]),r=r.split(" ")[1].split(":"),f.hour=parseFloat(r[0]),f.minute=parseFloat(r[1]),f.second=
parseFloat(r[2]);else throw Error("Illegal Interval");break;default:throw Error("Invalid Interval.");}break;case "hour":switch(n.end.period){case "minute":k=/^[0-9]{1,}:[0-9]{1,}$/;if(k.test(r))f.hour=parseFloat(r.split(":")[0]),f.minute=parseFloat(r.split(":")[1]);else throw Error("Illegal Interval");break;case "second":k=/^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(k.test(r))r=r.split(":"),f.hour=parseFloat(r[0]),f.minute=parseFloat(r[1]),f.second=parseFloat(r[2]);else throw Error("Illegal Interval");
break;default:throw Error("Invalid Interval.");}break;case "minute":switch(n.end.period){case "second":k=/^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/;if(k.test(r))r=r.split(":"),f.minute=parseFloat(r[0]),f.second=parseFloat(r[1]);else throw Error("Illegal Interval");break;default:throw Error("Invalid Interval.");}break;default:throw Error("Invalid Interval.");}}return f};l.prototype.valueInMilliseconds=function(){return("-"===this.op?-1:1)*(1E3*this.second+6E4*this.minute+36E5*this.hour+864E5*this.day+
365/12*this.month*864E5+31536E6*this.year)};return l}();const m={extract:{minParams:2,maxParams:2,evaluate:([l,r])=>{if(null==r)return null;if(r instanceof Date)switch(l.toUpperCase()){case "SECOND":return r.getSeconds();case "MINUTE":return r.getMinutes();case "HOUR":return r.getHours();case "DAY":return r.getDate();case "MONTH":return r.getMonth()+1;case "YEAR":return r.getFullYear()}throw Error("Invalid Parameter for call to EXTRACT");}},substring:{minParams:2,maxParams:3,evaluate:l=>{if(2===l.length){const [r,
n]=l;return null==r||null==n?null:r.toString().substring(n-1)}if(3===l.length){const [r,n,g]=l;return null==r||null==n||null==g?null:0>=g?"":r.toString().substring(n-1,n+g-1)}}},position:{minParams:2,maxParams:2,evaluate:([l,r])=>null==l||null==r?null:r.indexOf(l)+1},trim:{minParams:2,maxParams:3,evaluate:l=>{var r=3===l.length,n=r?l[1]:" ";r=r?l[2]:l[1];if(null==n||null==r)return null;n=`(${b.escapeRegExpString(n)})`;switch(l[0]){case "BOTH":return r.replace(new RegExp(`^${n}*|${n}*$`,"g"),"");case "LEADING":return r.replace(new RegExp(`^${n}*`,
"g"),"");case "TRAILING":return r.replace(new RegExp(`${n}*$`,"g"),"")}throw Error("Invalid Parameter for call to TRIM");}},abs:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:Math.abs(l[0])},ceiling:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:Math.ceil(l[0])},floor:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:Math.floor(l[0])},log:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:Math.log(l[0])},log10:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:Math.log(l[0])*Math.LOG10E},
sin:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:Math.sin(l[0])},cos:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:Math.cos(l[0])},tan:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:Math.tan(l[0])},asin:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:Math.asin(l[0])},acos:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:Math.acos(l[0])},atan:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:Math.atan(l[0])},sign:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:
0<l[0]?1:0>l[1]?-1:0},power:{minParams:2,maxParams:2,evaluate:l=>null==l[0]||null==l[1]?null:l[0]**l[1]},mod:{minParams:2,maxParams:2,evaluate:l=>null==l[0]||null==l[1]?null:l[0]%l[1]},round:{minParams:1,maxParams:2,evaluate:l=>{const r=l[0];l=2===l.length?10**l[1]:1;return null==r?null:Math.round(r*l)/l}},truncate:{minParams:1,maxParams:2,evaluate:l=>null==l[0]?null:1===l.length?parseInt(l[0].toFixed(0),10):parseFloat(l[0].toFixed(l[1]))},char_length:{minParams:1,maxParams:1,evaluate:l=>"string"===
typeof l[0]||l[0]instanceof String?l[0].length:0},concat:{minParams:1,maxParams:Infinity,evaluate:l=>{let r="";for(let n=0;n<l.length;n++){if(null==l[n])return null;r+=l[n].toString()}return r}},lower:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:l[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:l=>null==l[0]?null:l[0].toString().toUpperCase()}};a.SqlInterval=c;a.evaluateFunction=function(l,r){const n=m[l.toLowerCase()];if(null==n)throw Error("Function Not Recognised");
if(r.length<n.minParams||r.length>n.maxParams)throw Error(`Invalid Parameter count for call to ${l.toUpperCase()}`);return n.evaluate(r)};a.isStandardized=function(l,r){l=m[l.toLowerCase()];return null!=l&&r>=l.minParams&&r<=l.maxParams};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/sql/WhereGrammar":function(){define(["exports","../../chunks/_commonjsHelpers"],function(a,b){var c={exports:{}};(function(l){(function(r,n){l.exports&&(l.exports=
n())})(b.commonjsGlobal,function(){function r(g,k,f,d){g=Error.call(this,g);Object.setPrototypeOf&&Object.setPrototypeOf(g,r.prototype);g.expected=k;g.found=f;g.location=d;g.name="SyntaxError";return g}function n(g,k,f){f=f||" ";if(g.length>k)return g;k-=g.length;f+=f.repeat(k);return g+f.slice(0,k)}(function(g,k){function f(){this.constructor=g}f.prototype=k.prototype;g.prototype=new f})(r,Error);r.prototype.format=function(g){var k="Error: "+this.message;if(this.location){var f=null,d;for(d=0;d<
g.length;d++)if(g[d].source===this.location.source){f=g[d].text.split(/\r\n|\n|\r/g);break}g=this.location.start;d=this.location.source+":"+g.line+":"+g.column;if(f){var e=this.location.end,h=n("",g.line.toString().length);f=f[g.line-1];e=g.line===e.line?e.column:f.length+1;k+="\n --\x3e "+d+"\n"+h+" |\n"+g.line+" | "+f+"\n"+h+" | "+n("",g.column-1)+n("",e-g.column,"^")}else k+="\n at "+d}return k};r.buildMessage=function(g,k){function f(w){return w.charCodeAt(0).toString(16).toUpperCase()}function d(w){return w.replace(/\\/g,
"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(t){return"\\x0"+f(t)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(t){return"\\x"+f(t)})}function e(w){return w.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(t){return"\\x0"+f(t)}).replace(/[\x10-\x1F\x7F-\x9F]/g,
function(t){return"\\x"+f(t)})}function h(w){return v[w.type](w)}var v={literal:function(w){return'"'+d(w.text)+'"'},class:function(w){var t=w.parts.map(function(x){return Array.isArray(x)?e(x[0])+"-"+e(x[1]):e(x)});return"["+(w.inverted?"^":"")+t+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(w){return w.description}};return"Expected "+function(w){w=w.map(h);var t,x;w.sort();if(0<w.length){for(x=t=1;t<w.length;t++)w[t-1]!==w[t]&&(w[x]=w[t],x++);w.length=
x}switch(w.length){case 1:return w[0];case 2:return w[0]+" or "+w[1];default:return w.slice(0,-1).join(", ")+", or "+w[w.length-1]}}(g)+" but "+(k?'"'+d(k)+'"':"end of input")+" found."};return{SyntaxError:r,parse:function(g,k){function f(Ba,X){return{type:"literal",text:Ba,ignoreCase:X}}function d(Ba,X,na){return{type:"class",parts:Ba,inverted:X,ignoreCase:na}}function e(Ba){var X=Oc[Ba],na;if(!X){for(na=Ba-1;!Oc[na];)na--;X=Oc[na];for(X={line:X.line,column:X.column};na<Ba;)10===g.charCodeAt(na)?
(X.line++,X.column=1):X.column++,na++;Oc[Ba]=X}return X}function h(Ba,X){var na=e(Ba),Ca=e(X);return{source:$a,start:{offset:Ba,line:na.line,column:na.column},end:{offset:X,line:Ca.line,column:Ca.column}}}function v(Ba){ua<dc||(ua>dc&&(dc=ua,Ic=[]),Ic.push(Ba))}function w(){var Ba=ua;wa();var X=x();X!==ma?(wa(),Ba=X):(ua=Ba,Ba=ma);return Ba}function t(){var Ba=ua;var X=x();if(X!==ma){Ba=[];var na=ua;var Ca=wa();var La=Ia();if(La!==ma){var Ua=wa();var Za=x();Za!==ma?na=Ca=[Ca,La,Ua,Za]:(ua=na,na=ma)}else ua=
na,na=ma;for(;na!==ma;)Ba.push(na),na=ua,Ca=wa(),La=Ia(),La!==ma?(Ua=wa(),Za=x(),Za!==ma?na=Ca=[Ca,La,Ua,Za]:(ua=na,na=ma)):(ua=na,na=ma);na={type:"expression-list"};X=[X];for(Ca=0;Ca<Ba.length;Ca++)X.push(Ba[Ca][3]);na.value=X;Ba=na}else ua=Ba,Ba=ma;return Ba}function x(){var Ba=ua;var X=B();if(X!==ma){Ba=[];var na=ua;var Ca=wa();var La=Y();if(La!==ma){var Ua=wa();var Za=B();Za!==ma?na=Ca=[Ca,La,Ua,Za]:(ua=na,na=ma)}else ua=na,na=ma;for(;na!==ma;)Ba.push(na),na=ua,Ca=wa(),La=Y(),La!==ma?(Ua=wa(),
Za=B(),Za!==ma?na=Ca=[Ca,La,Ua,Za]:(ua=na,na=ma)):(ua=na,na=ma);Ba=Xa(X,Ba)}else ua=Ba,Ba=ma;return Ba}function B(){var Ba=ua;var X=q();if(X!==ma){Ba=[];var na=ua;var Ca=wa();var La=la();if(La!==ma){var Ua=wa();var Za=q();Za!==ma?na=Ca=[Ca,La,Ua,Za]:(ua=na,na=ma)}else ua=na,na=ma;for(;na!==ma;)Ba.push(na),na=ua,Ca=wa(),La=la(),La!==ma?(Ua=wa(),Za=q(),Za!==ma?na=Ca=[Ca,La,Ua,Za]:(ua=na,na=ma)):(ua=na,na=ma);Ba=Xa(X,Ba)}else ua=Ba,Ba=ma;return Ba}function q(){var Ba=ua;var X=ka();if(X===ma){X=ua;if(33===
g.charCodeAt(ua)){var na=Oa;ua++}else na=ma,0===eb&&v(Kc);if(na!==ma){var Ca=ua;eb++;if(61===g.charCodeAt(ua)){var La=Va;ua++}else La=ma,0===eb&&v(vd);eb--;La===ma?Ca=void 0:(ua=Ca,Ca=ma);Ca!==ma?X=na=[na,Ca]:(ua=X,X=ma)}else ua=X,X=ma}X!==ma?(na=wa(),Ca=q(),Ca!==ma?Ba={type:"unary-expression",operator:"NOT",expr:Ca}:(ua=Ba,Ba=ma)):(ua=Ba,Ba=ma);if(Ba===ma){X=ua;Ba=A();if(Ba!==ma){wa();X=[];na=ua;Ca=wa();La=u();if(La!==ma){var Ua=wa();var Za=A();Za!==ma?na=Ca=[Ca,La,Ua,Za]:(ua=na,na=ma)}else ua=na,
na=ma;if(na!==ma)for(;na!==ma;)X.push(na),na=ua,Ca=wa(),La=u(),La!==ma?(Ua=wa(),Za=A(),Za!==ma?na=Ca=[Ca,La,Ua,Za]:(ua=na,na=ma)):(ua=na,na=ma);else X=ma;X!==ma&&(X={type:"arithmetic",tail:X});X===ma&&(X=ua,na=z(),na!==ma?(wa(),Ca=Ma(),Ca!==ma?(wa(),Ca=t(),Ca!==ma?(wa(),La=Qa(),La!==ma?X={op:na,right:Ca}:(ua=X,X=ma)):(ua=X,X=ma)):(ua=X,X=ma)):(ua=X,X=ma),X===ma&&(X=ua,na=z(),na!==ma?(wa(),Ca=Ma(),Ca!==ma?(wa(),Ca=Qa(),Ca!==ma?X={op:na,right:{type:"expression-list",value:[]}}:(ua=X,X=ma)):(ua=X,X=
ma)):(ua=X,X=ma),X===ma&&(X=ua,na=z(),na!==ma?(wa(),Ca=N(),Ca!==ma?X={op:na,right:Ca}:(ua=X,X=ma)):(ua=X,X=ma))),X===ma&&(X=ua,La=ka(),La!==ma?(wa(),na=ea(),na!==ma?(wa(),Ca=A(),Ca!==ma?(wa(),Ua=la(),Ua!==ma?(wa(),La=A(),La!==ma?X={op:"NOT"+na,right:{type:"expression-list",value:[Ca,La]}}:(ua=X,X=ma)):(ua=X,X=ma)):(ua=X,X=ma)):(ua=X,X=ma)):(ua=X,X=ma),X===ma&&(X=ua,La=ea(),La!==ma?(wa(),na=A(),na!==ma?(wa(),Ca=la(),Ca!==ma?(wa(),Ua=A(),Ua!==ma?X={op:La,right:{type:"expression-list",value:[na,Ua]}}:
(ua=X,X=ma)):(ua=X,X=ma)):(ua=X,X=ma)):(ua=X,X=ma)),X===ma&&(X=ua,na=ha(),na!==ma?(wa(),Ca=ka(),Ca!==ma?(wa(),Ca=A(),Ca!==ma?X={op:na+"NOT",right:Ca}:(ua=X,X=ma)):(ua=X,X=ma)):(ua=X,X=ma),X===ma&&(X=ua,na=ha(),na!==ma?(wa(),Ca=A(),Ca!==ma?X={op:na,right:Ca}:(ua=X,X=ma)):(ua=X,X=ma)),X===ma&&(X=ua,na=C(),na!==ma?(wa(),Ca=O(),Ca!==ma?(wa(),La=ua,g.substr(ua,6).toLowerCase()===Fa?(Ua=g.substr(ua,6),ua+=6):(Ua=ma,0===eb&&v(de)),Ua!==ma?(Ua=ua,eb++,Za=P(),eb--,Za===ma?Ua=void 0:(ua=Ua,Ua=ma),Ua!==ma?La=
"ESCAPE":(ua=La,La=ma)):(ua=La,La=ma),La!==ma?(wa(),La=Q(),La!==ma?X={op:na,right:Ca,escape:La.value}:(ua=X,X=ma)):(ua=X,X=ma)):(ua=X,X=ma)):(ua=X,X=ma),X===ma&&(X=ua,na=C(),na!==ma?(wa(),Ca=O(),Ca!==ma?X={op:na,right:Ca,escape:""}:(ua=X,X=ma)):(ua=X,X=ma))))));X===ma&&(X=null);""==X||void 0==X||null==X?X=Ba:(na=null,X=na="arithmetic"==X.type?Xa(Ba,X.tail):Ta(X.op,Ba,X.right,X.escape))}else ua=X,X=ma;Ba=X}return Ba}function u(){if(g.substr(ua,2)===Ra){var Ba=Ra;ua+=2}else Ba=ma,0===eb&&v(Lc);Ba===
ma&&(62===g.charCodeAt(ua)?(Ba=za,ua++):(Ba=ma,0===eb&&v(gc)),Ba===ma&&(g.substr(ua,2)===ya?(Ba=ya,ua+=2):(Ba=ma,0===eb&&v(fd)),Ba===ma&&(g.substr(ua,2)===Na?(Ba=Na,ua+=2):(Ba=ma,0===eb&&v(Qb)),Ba===ma&&(60===g.charCodeAt(ua)?(Ba=Wa,ua++):(Ba=ma,0===eb&&v(Wd)),Ba===ma&&(61===g.charCodeAt(ua)?(Ba=Va,ua++):(Ba=ma,0===eb&&v(vd)),Ba===ma&&(g.substr(ua,2)===bb?(Ba=bb,ua+=2):(Ba=ma,0===eb&&v(wd))))))));return Ba}function C(){var Ba=Ba=ua;var X=ka();if(X!==ma){var na=wa();var Ca=ia();Ca!==ma?Ba=X=[X,na,
Ca]:(ua=Ba,Ba=ma)}else ua=Ba,Ba=ma;Ba!==ma&&(Ba=Ba[0]+" "+Ba[2]);Ba===ma&&(Ba=ia());return Ba}function z(){var Ba=Ba=ua;var X=ka();if(X!==ma){var na=wa();var Ca=ca();Ca!==ma?Ba=X=[X,na,Ca]:(ua=Ba,Ba=ma)}else ua=Ba,Ba=ma;Ba!==ma&&(Ba=Ba[0]+" "+Ba[2]);Ba===ma&&(Ba=ca());return Ba}function A(){var Ba=ua;var X=y();if(X!==ma){Ba=[];var na=ua;var Ca=wa();var La=p();if(La!==ma){var Ua=wa();var Za=y();Za!==ma?na=Ca=[Ca,La,Ua,Za]:(ua=na,na=ma)}else ua=na,na=ma;for(;na!==ma;)Ba.push(na),na=ua,Ca=wa(),La=p(),
La!==ma?(Ua=wa(),Za=y(),Za!==ma?na=Ca=[Ca,La,Ua,Za]:(ua=na,na=ma)):(ua=na,na=ma);Ba=Xa(X,Ba)}else ua=Ba,Ba=ma;return Ba}function p(){if(43===g.charCodeAt(ua)){var Ba=Aa;ua++}else Ba=ma,0===eb&&v(Mc);Ba===ma&&(45===g.charCodeAt(ua)?(Ba=Pa,ua++):(Ba=ma,0===eb&&v(Nc)));return Ba}function y(){var Ba=ua;var X=E();if(X!==ma){Ba=[];var na=ua;var Ca=wa();var La=D();if(La!==ma){var Ua=wa();var Za=E();Za!==ma?na=Ca=[Ca,La,Ua,Za]:(ua=na,na=ma)}else ua=na,na=ma;for(;na!==ma;)Ba.push(na),na=ua,Ca=wa(),La=D(),
La!==ma?(Ua=wa(),Za=E(),Za!==ma?na=Ca=[Ca,La,Ua,Za]:(ua=na,na=ma)):(ua=na,na=ma);Ba=Xa(X,Ba)}else ua=Ba,Ba=ma;return Ba}function D(){if(42===g.charCodeAt(ua)){var Ba=ab;ua++}else Ba=ma,0===eb&&v(xd);Ba===ma&&(47===g.charCodeAt(ua)?(Ba=fb,ua++):(Ba=ma,0===eb&&v(yd)));return Ba}function E(){var Ba=Q();if(Ba===ma){var X=ua;var na=ua;var Ca=aa();if(Ca!==ma){var La=W();if(La!==ma){var Ua=R();Ua!==ma?na=parseFloat(Ca+La+Ua):(ua=na,na=ma)}else ua=na,na=ma}else ua=na,na=ma;na===ma&&(na=ua,Ca=aa(),Ca!==ma?
(La=W(),La!==ma?na=parseFloat(Ca+La):(ua=na,na=ma)):(ua=na,na=ma),na===ma&&(na=ua,Ca=aa(),Ca!==ma?(La=R(),La!==ma?na=parseFloat(Ca+La):(ua=na,na=ma)):(ua=na,na=ma),na===ma&&(na=ua,Ca=aa(),Ca!==ma&&(Ca=parseFloat(Ca)),na=Ca)));var Za=na;if(Za!==ma){var gb=ua;eb++;var lb=G();eb--;lb===ma?gb=void 0:(ua=gb,gb=ma);gb!==ma?X={type:"number",value:Za}:(ua=X,X=ma)}else ua=X,X=ma;Ba=X;if(Ba===ma){var pb=ua;var yb=ua;if(g.substr(ua,4).toLowerCase()===qb){var ub=g.substr(ua,4);ua+=4}else ub=ma,0===eb&&v(Cd);
if(ub!==ma){var wb=ua;eb++;var Ab=P();eb--;Ab===ma?wb=void 0:(ua=wb,wb=ma);wb!==ma?yb=ub=[ub,wb]:(ua=yb,yb=ma)}else ua=yb,yb=ma;var Jb=yb;Jb!==ma&&(Jb={type:"boolean",value:!0});pb=Jb;if(pb===ma){pb=ua;var Yb=ua;if(g.substr(ua,5).toLowerCase()===ob){var cc=g.substr(ua,5);ua+=5}else cc=ma,0===eb&&v(hd);if(cc!==ma){var kc=ua;eb++;var af=P();eb--;af===ma?kc=void 0:(ua=kc,kc=ma);kc!==ma?Yb=cc=[cc,kc]:(ua=Yb,Yb=ma)}else ua=Yb,Yb=ma;Jb=Yb;Jb!==ma&&(Jb={type:"boolean",value:!1});pb=Jb}Ba=pb;if(Ba===ma){var Pc=
ua;if(g.substr(ua,4).toLowerCase()===jb){var Gd=g.substr(ua,4);ua+=4}else Gd=ma,0===eb&&v(gd);if(Gd!==ma){var jd=ua;eb++;var bf=P();eb--;bf===ma?jd=void 0:(ua=jd,jd=ma);jd!==ma?Pc=Gd=[Gd,jd]:(ua=Pc,Pc=ma)}else ua=Pc,Pc=ma;var xe=Pc;xe!==ma&&(xe={type:"null",value:null});Ba=xe;if(Ba===ma){var Qc=ua;var Rc=ua;if(g.substr(ua,4).toLowerCase()===vb){var Je=g.substr(ua,4);ua+=4}else Je=ma,0===eb&&v(Ed);if(Je!==ma){var Hd=ua;eb++;var cf=P();eb--;cf===ma?Hd=void 0:(ua=Hd,Hd=ma);Hd!==ma?Rc="DATE":(ua=Rc,Rc=
ma)}else ua=Rc,Rc=ma;if(Rc!==ma){wa();var Ke=O();Ke!==ma?Qc={type:"date",value:Ke.value}:(ua=Qc,Qc=ma)}else ua=Qc,Qc=ma;Ba=Qc;if(Ba===ma){var Sc=ua;var Tc=ua;if(g.substr(ua,9).toLowerCase()===Mb){var Le=g.substr(ua,9);ua+=9}else Le=ma,0===eb&&v(ne);if(Le!==ma){var Id=ua;eb++;var df=P();eb--;df===ma?Id=void 0:(ua=Id,Id=ma);Id!==ma?Tc="TIMESTAMP":(ua=Tc,Tc=ma)}else ua=Tc,Tc=ma;if(Tc!==ma){wa();var Me=O();Me!==ma?Sc={type:"timestamp",value:Me.value}:(ua=Sc,Sc=ma)}else ua=Sc,Sc=ma;Ba=Sc;if(Ba===ma){var Nb=
ua;var ye=fa();if(ye!==ma){wa();if(45===g.charCodeAt(ua)){var nc=Pa;ua++}else nc=ma,0===eb&&v(Nc);nc===ma&&(43===g.charCodeAt(ua)?(nc=Aa,ua++):(nc=ma,0===eb&&v(Mc)));if(nc!==ma){wa();var kd=O();if(kd!==ma){wa();var Ne=L();Ne!==ma?Nb={type:"interval",value:kd,qualifier:Ne,op:nc}:(ua=Nb,Nb=ma)}else ua=Nb,Nb=ma}else ua=Nb,Nb=ma}else ua=Nb,Nb=ma;Nb===ma&&(Nb=ua,ye=fa(),ye!==ma?(wa(),nc=O(),nc!==ma?(wa(),kd=L(),kd!==ma?Nb={type:"interval",value:nc,qualifier:kd,op:""}:(ua=Nb,Nb=ma)):(ua=Nb,Nb=ma)):(ua=
Nb,Nb=ma));Ba=Nb}}}}}}var Cb=Ba;if(Cb===ma){var Vb=ua;var Uc=ua;if(g.substr(ua,7).toLowerCase()===xb){var Oe=g.substr(ua,7);ua+=7}else Oe=ma,0===eb&&v(ke);if(Oe!==ma){var Jd=ua;eb++;var ef=P();eb--;ef===ma?Jd=void 0:(ua=Jd,Jd=ma);Jd!==ma?Uc="EXTRACT":(ua=Uc,Uc=ma)}else ua=Uc,Uc=ma;if(Uc!==ma){wa();var ff=Ma();if(ff!==ma){wa();var ec=ja();ec===ma&&(ec=oa(),ec===ma&&(ec=sa(),ec===ma&&(ec=qa(),ec===ma&&(ec=Ha(),ec===ma&&(ec=Ga())))));var Pe=ec;if(Pe!==ma){wa();var gf=ba();if(gf!==ma){wa();var Qe=x();
if(Qe!==ma){wa();var hf=Qa();hf!==ma?Vb={type:"function",name:"extract",args:{type:"expression-list",value:[{type:"string",value:Pe},Qe]}}:(ua=Vb,Vb=ma)}else ua=Vb,Vb=ma}else ua=Vb,Vb=ma}else ua=Vb,Vb=ma}else ua=Vb,Vb=ma}else ua=Vb,Vb=ma;Cb=Vb;if(Cb===ma){var Wb=ua;var Vc=ua;if(g.substr(ua,9).toLowerCase()===Bb){var Re=g.substr(ua,9);ua+=9}else Re=ma,0===eb&&v(je);if(Re!==ma){var Kd=ua;eb++;var jf=P();eb--;jf===ma?Kd=void 0:(ua=Kd,Kd=ma);Kd!==ma?Vc="SUBSTRING":(ua=Vc,Vc=ma)}else ua=Vc,Vc=ma;if(Vc!==
ma){wa();var kf=Ma();if(kf!==ma){wa();var ze=x();if(ze!==ma){wa();var lf=ba();if(lf!==ma){wa();var Ae=x();if(Ae!==ma){wa();var oc=ua;var Wc=ua;if(g.substr(ua,3).toLowerCase()===tb){var Se=g.substr(ua,3);ua+=3}else Se=ma,0===eb&&v(ie);if(Se!==ma){var Ld=ua;eb++;var mf=P();eb--;mf===ma?Ld=void 0:(ua=Ld,Ld=ma);Ld!==ma?Wc="FOR":(ua=Wc,Wc=ma)}else ua=Wc,Wc=ma;var ld=Wc;if(ld!==ma){var nf=wa();var Te=x();if(Te!==ma){var of=wa();oc=ld=[ld,nf,Te,of]}else ua=oc,oc=ma}else ua=oc,oc=ma;oc===ma&&(oc=null);ld=
Qa();ld!==ma?Wb={type:"function",name:"substring",args:{type:"expression-list",value:oc?[ze,Ae,oc[2]]:[ze,Ae]}}:(ua=Wb,Wb=ma)}else ua=Wb,Wb=ma}else ua=Wb,Wb=ma}else ua=Wb,Wb=ma}else ua=Wb,Wb=ma}else ua=Wb,Wb=ma;Cb=Wb;if(Cb===ma){var Db=ua;var Be=Z();if(Be!==ma){wa();var Ce=Ma();if(Ce!==ma){wa();var pc=M();pc===ma&&(pc=null);wa();var md=x();if(md!==ma){wa();var De=ba();if(De!==ma){wa();var Ue=x();if(Ue!==ma){wa();var pf=Qa();pf!==ma?Db={type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",
value:null==pc?"BOTH":pc},md,Ue]}}:(ua=Db,Db=ma)}else ua=Db,Db=ma}else ua=Db,Db=ma}else ua=Db,Db=ma}else ua=Db,Db=ma}else ua=Db,Db=ma;Db===ma&&(Db=ua,Be=Z(),Be!==ma?(wa(),Ce=Ma(),Ce!==ma?(wa(),pc=M(),pc===ma&&(pc=null),wa(),md=x(),md!==ma?(wa(),De=Qa(),De!==ma?Db={type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:null==pc?"BOTH":pc},md]}}:(ua=Db,Db=ma)):(ua=Db,Db=ma)):(ua=Db,Db=ma)):(ua=Db,Db=ma));Cb=Db;if(Cb===ma){var Xb=ua;var Xc=ua;if(g.substr(ua,8).toLowerCase()===
Ub){var Ve=g.substr(ua,8);ua+=8}else Ve=ma,0===eb&&v(me);if(Ve!==ma){var Md=ua;eb++;var qf=P();eb--;qf===ma?Md=void 0:(ua=Md,Md=ma);Md!==ma?Xc="POSITION":(ua=Xc,Xc=ma)}else ua=Xc,Xc=ma;if(Xc!==ma){wa();var rf=Ma();if(rf!==ma){wa();var We=x();if(We!==ma){wa();var sf=ca();if(sf!==ma){wa();var Xe=x();if(Xe!==ma){wa();var tf=Qa();tf!==ma?Xb={type:"function",name:"position",args:{type:"expression-list",value:[We,Xe]}}:(ua=Xb,Xb=ma)}else ua=Xb,Xb=ma}else ua=Xb,Xb=ma}else ua=Xb,Xb=ma}else ua=Xb,Xb=ma}else ua=
Xb,Xb=ma;Cb=Xb;if(Cb===ma){var uc=ua;var Nd;var fc=ua;fc=Nd=F();if(fc===ma)if(fc=ua,96===g.charCodeAt(ua)?(Nd=yc,ua++):(Nd=ma,0===eb&&v(td)),Nd!==ma){var Od=[];if(ed.test(g.charAt(ua))){var qc=g.charAt(ua);ua++}else qc=ma,0===eb&&v(Fc);if(qc!==ma)for(;qc!==ma;)Od.push(qc),ed.test(g.charAt(ua))?(qc=g.charAt(ua),ua++):(qc=ma,0===eb&&v(Fc));else Od=ma;Od!==ma?(96===g.charCodeAt(ua)?(qc=yc,ua++):(qc=ma,0===eb&&v(td)),qc!==ma?fc=Od.join(""):(ua=fc,fc=ma)):(ua=fc,fc=ma)}else ua=fc,fc=ma;var Ye=fc;if(Ye!==
ma){wa();var uf=Ma();if(uf!==ma){wa();var Pd=t();Pd===ma&&(Pd=null);wa();var vf=Qa();vf!==ma?uc={type:"function",name:Ye,args:Pd?Pd:{type:"expression-list",value:[]}}:(ua=uc,uc=ma)}else ua=uc,uc=ma}else ua=uc,uc=ma;Cb=uc;if(Cb===ma){var ic;var Ob=ua;var Ee=pa();if(Ee!==ma){wa();var nd=x();if(nd!==ma){wa();var od=[];for(ic=T();ic!==ma;)od.push(ic),ic=T();ic=wa();var Qd=Da();Qd!==ma?Ob={type:"case-expression",format:"simple",operand:nd,clauses:od,else:null}:(ua=Ob,Ob=ma)}else ua=Ob,Ob=ma}else ua=Ob,
Ob=ma;if(Ob===ma)if(Ob=ua,Ee=pa(),Ee!==ma)if(wa(),nd=x(),nd!==ma){wa();od=[];for(ic=T();ic!==ma;)od.push(ic),ic=T();ic=wa();Qd=U();if(Qd!==ma){wa();var wf=Da();wf!==ma?Ob={type:"case-expression",format:"simple",operand:nd,clauses:od,else:Qd.value}:(ua=Ob,Ob=ma)}else ua=Ob,Ob=ma}else ua=Ob,Ob=ma;else ua=Ob,Ob=ma;var Fe=Ob;if(Fe===ma){var jc;var Tb=ua;var Ge=pa();if(Ge!==ma){wa();var pd=[];for(jc=S();jc!==ma;)pd.push(jc),jc=S();jc=wa();var Rd=Da();Rd!==ma?Tb={type:"case-expression",format:"searched",
clauses:pd,else:null}:(ua=Tb,Tb=ma)}else ua=Tb,Tb=ma;if(Tb===ma)if(Tb=ua,Ge=pa(),Ge!==ma){wa();pd=[];for(jc=S();jc!==ma;)pd.push(jc),jc=S();jc=wa();Rd=U();if(Rd!==ma){wa();var xf=Da();xf!==ma?Tb={type:"case-expression",format:"searched",clauses:pd,else:Rd.value}:(ua=Tb,Tb=ma)}else ua=Tb,Tb=ma}else ua=Tb,Tb=ma;Fe=Tb}Cb=Fe;if(Cb===ma){var Sd;var Td=ua;var Ze=G();if(Ze!==ma){var $e=[];for(Sd=K();Sd!==ma;)$e.push(Sd),Sd=K();Td=Ze+$e.join("")}else ua=Td,Td=ma;var Ud=Td;if(Ud!==ma){var He=Ud;Ud=/^CURRENT_DATE$/i.test(He)?
{type:"current-time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(He)?{type:"current-time",mode:"timestamp"}:{type:"column-reference",table:"",column:He}}Cb=Ud;if(Cb===ma&&(Cb=N(),Cb===ma)){Cb=ua;var yf=Ma();if(yf!==ma){wa();var Ie=x();if(Ie!==ma){wa();var zf=Qa();zf!==ma?(Ie.paren=!0,Cb=Ie):(ua=Cb,Cb=ma)}else ua=Cb,Cb=ma}else ua=Cb,Cb=ma}}}}}}}}return Cb}function F(){var Ba;var X=ua;var na=G();if(na!==ma){X=[];for(Ba=P();Ba!==ma;)X.push(Ba),Ba=P();X=na+X.join("")}else ua=X,X=ma;return X}function G(){if(Zc.test(g.charAt(ua))){var Ba=
g.charAt(ua);ua++}else Ba=ma,0===eb&&v(zd);return Ba}function P(){if(Yc.test(g.charAt(ua))){var Ba=g.charAt(ua);ua++}else Ba=ma,0===eb&&v(Lb);return Ba}function K(){if(Vd.test(g.charAt(ua))){var Ba=g.charAt(ua);ua++}else Ba=ma,0===eb&&v(qd);return Ba}function N(){var Ba=ua;if(64===g.charCodeAt(ua)){var X=hb;ua++}else X=ma,0===eb&&v($c);if(X!==ma){var na=F();na!==ma?Ba=X=[X,na]:(ua=Ba,Ba=ma)}else ua=Ba,Ba=ma;Ba!==ma&&(Ba={type:"parameter",value:Ba[1]});return Ba}function M(){var Ba=ua;if(g.substr(ua,
7).toLowerCase()===Ib){var X=g.substr(ua,7);ua+=7}else X=ma,0===eb&&v(oe);if(X!==ma){X=ua;eb++;var na=P();eb--;na===ma?X=void 0:(ua=X,X=ma);X!==ma?Ba="LEADING":(ua=Ba,Ba=ma)}else ua=Ba,Ba=ma;Ba===ma&&(Ba=ua,g.substr(ua,8).toLowerCase()===Pb?(X=g.substr(ua,8),ua+=8):(X=ma,0===eb&&v(pe)),X!==ma?(X=ua,eb++,na=P(),eb--,na===ma?X=void 0:(ua=X,X=ma),X!==ma?Ba="TRAILING":(ua=Ba,Ba=ma)):(ua=Ba,Ba=ma),Ba===ma&&(Ba=ua,g.substr(ua,4).toLowerCase()===Sb?(X=g.substr(ua,4),ua+=4):(X=ma,0===eb&&v(qe)),X!==ma?(X=
ua,eb++,na=P(),eb--,na===ma?X=void 0:(ua=X,X=ma),X!==ma?Ba="BOTH":(ua=Ba,Ba=ma)):(ua=Ba,Ba=ma)));return Ba}function L(){var Ba=ua;var X=ua;var na=J();if(na!==ma){wa();var Ca=Ma();if(Ca!==ma)if(wa(),Ca=I(),Ca!==ma){wa();var La=Qa();La!==ma?X={type:"interval-period",period:na.value,precision:Ca,secondary:null}:(ua=X,X=ma)}else ua=X,X=ma;else ua=X,X=ma}else ua=X,X=ma;X===ma&&(X=ua,na=J(),na!==ma&&(na=Hc(na)),X=na);if(X!==ma)if(wa(),na=ua,g.substr(ua,2).toLowerCase()===$b?(Ca=g.substr(ua,2),ua+=2):(Ca=
ma,0===eb&&v(re)),Ca!==ma?(Ca=ua,eb++,La=P(),eb--,La===ma?Ca=void 0:(ua=Ca,Ca=ma),Ca!==ma?na="TO":(ua=na,na=ma)):(ua=na,na=ma),na!==ma){wa();na=ua;Ca=J();Ca!==ma&&(Ca={type:"interval-period",period:Ca.value,precision:null,secondary:null});na=Ca;if(na===ma){na=ua;Ca=Ga();if(Ca!==ma)if(wa(),Ca=Ma(),Ca!==ma)if(wa(),Ca=I(),Ca!==ma)if(wa(),La=Ia(),La!==ma)if(wa(),La=H(),La!==ma){wa();var Ua=Qa();Ua!==ma?na=Gc(Ca,La):(ua=na,na=ma)}else ua=na,na=ma;else ua=na,na=ma;else ua=na,na=ma;else ua=na,na=ma;else ua=
na,na=ma;na===ma&&(na=ua,Ca=Ga(),Ca!==ma?(wa(),Ca=Ma(),Ca!==ma?(wa(),Ca=I(),Ca!==ma?(wa(),La=Qa(),La!==ma?na={type:"interval-period",period:"second",precision:Ca,secondary:null}:(ua=na,na=ma)):(ua=na,na=ma)):(ua=na,na=ma)):(ua=na,na=ma),na===ma&&(na=ua,Ca=Ga(),Ca!==ma&&(Ca={type:"interval-period",period:"second",precision:null,secondary:null}),na=Ca))}na!==ma?Ba={type:"interval-qualifier",start:X,end:na}:(ua=Ba,Ba=ma)}else ua=Ba,Ba=ma;else ua=Ba,Ba=ma;Ba===ma&&(Ba=ua,na=J(),na!==ma?(wa(),X=Ma(),X!==
ma?(wa(),X=H(),X!==ma?(wa(),Ca=Qa(),Ca!==ma?Ba={type:"interval-period",period:na.value,precision:X,secondary:null}:(ua=Ba,Ba=ma)):(ua=Ba,Ba=ma)):(ua=Ba,Ba=ma)):(ua=Ba,Ba=ma),Ba===ma&&(Ba=ua,na=J(),na!==ma&&(na=Hc(na)),Ba=na,Ba===ma&&(Ba=ua,na=Ga(),na!==ma?(wa(),X=Ma(),X!==ma?(wa(),X=I(),X!==ma?(wa(),Ca=Ia(),Ca!==ma?(wa(),na=H(),na!==ma?(wa(),Ca=Qa(),Ca!==ma?Ba=Gc(X,na):(ua=Ba,Ba=ma)):(ua=Ba,Ba=ma)):(ua=Ba,Ba=ma)):(ua=Ba,Ba=ma)):(ua=Ba,Ba=ma)):(ua=Ba,Ba=ma),Ba===ma&&(Ba=ua,na=Ga(),na!==ma?(wa(),X=
Ma(),X!==ma?(wa(),X=H(),X!==ma?(wa(),Ca=Qa(),Ca!==ma?Ba={type:"interval-period",period:"second",precision:X,secondary:null}:(ua=Ba,Ba=ma)):(ua=Ba,Ba=ma)):(ua=Ba,Ba=ma)):(ua=Ba,Ba=ma),Ba===ma&&(Ba=ua,na=Ga(),na!==ma&&(na={type:"interval-period",period:"second",precision:null,secondary:null}),Ba=na)))));return Ba}function J(){var Ba=ua;Ba=sa();Ba!==ma&&(Ba={type:"string",value:"day"});Ba===ma&&(Ba=ua,Ba=qa(),Ba!==ma&&(Ba={type:"string",value:"hour"}),Ba===ma&&(Ba=ua,Ba=Ha(),Ba!==ma&&(Ba={type:"string",
value:"minute"}),Ba===ma&&(Ba=ua,Ba=oa(),Ba!==ma&&(Ba={type:"string",value:"month"}),Ba===ma&&(Ba=ua,Ba=ja(),Ba!==ma&&(Ba={type:"string",value:"year"})))));return Ba}function H(){var Ba=V();Ba!==ma&&(Ba=parseFloat(Ba));return Ba}function I(){var Ba=V();Ba!==ma&&(Ba=parseFloat(Ba));return Ba}function O(){var Ba=Q();Ba===ma&&(Ba=N());return Ba}function Q(){var Ba=ua;if(39===g.charCodeAt(ua)){var X=kb;ua++}else X=ma,0===eb&&v(Ec);X===ma&&(g.substr(ua,2)===nb?(X=nb,ua+=2):(X=ma,0===eb&&v(ad)));if(X!==
ma){X=[];var na=ua;g.substr(ua,2)===rb?(na=rb,ua+=2):(na=ma,0===eb&&v(zc));na!==ma&&(na="'");na===ma&&(ud.test(g.charAt(ua))?(na=g.charAt(ua),ua++):(na=ma,0===eb&&v(Ad)));for(;na!==ma;)X.push(na),na=ua,g.substr(ua,2)===rb?(na=rb,ua+=2):(na=ma,0===eb&&v(zc)),na!==ma&&(na="'"),na===ma&&(ud.test(g.charAt(ua))?(na=g.charAt(ua),ua++):(na=ma,0===eb&&v(Ad)));39===g.charCodeAt(ua)?(na=kb,ua++):(na=ma,0===eb&&v(Ec));na!==ma?Ba={type:"string",value:X.join("")}:(ua=Ba,Ba=ma)}else ua=Ba,Ba=ma;return Ba}function S(){var Ba=
ua;if(ra()!==ma){wa();var X=x();if(X!==ma){wa();var na=Ea();na!==ma?(wa(),na=x(),na!==ma?Ba={type:"when-clause",operand:X,value:na}:(ua=Ba,Ba=ma)):(ua=Ba,Ba=ma)}else ua=Ba,Ba=ma}else ua=Ba,Ba=ma;return Ba}function T(){var Ba=ua;if(ra()!==ma){wa();var X=x();if(X!==ma){wa();var na=Ea();na!==ma?(wa(),na=x(),na!==ma?Ba={type:"when-clause",operand:X,value:na}:(ua=Ba,Ba=ma)):(ua=Ba,Ba=ma)}else ua=Ba,Ba=ma}else ua=Ba,Ba=ma;return Ba}function U(){var Ba=ua;var X=ua;if(g.substr(ua,4).toLowerCase()===Kb){var na=
g.substr(ua,4);ua+=4}else na=ma,0===eb&&v(bd);if(na!==ma){na=ua;eb++;var Ca=P();eb--;Ca===ma?na=void 0:(ua=na,na=ma);na!==ma?X="ELSE":(ua=X,X=ma)}else ua=X,X=ma;X!==ma?(wa(),X=x(),X!==ma?Ba={type:"else-clause",value:X}:(ua=Ba,Ba=ma)):(ua=Ba,Ba=ma);return Ba}function aa(){var Ba=V();if(Ba===ma){Ba=ua;if(45===g.charCodeAt(ua)){var X=Pa;ua++}else X=ma,0===eb&&v(Nc);X===ma&&(43===g.charCodeAt(ua)?(X=Aa,ua++):(X=ma,0===eb&&v(Mc)));if(X!==ma){var na=V();na!==ma?Ba=X[0]+na:(ua=Ba,Ba=ma)}else ua=Ba,Ba=ma}return Ba}
function W(){var Ba=ua;if(46===g.charCodeAt(ua)){var X=sb;ua++}else X=ma,0===eb&&v($d);X!==ma?(Ba=V(),Ba===ma&&(Ba=null),Ba="."+(null!=Ba?Ba:"")):(ua=Ba,Ba=ma);return Ba}function R(){var Ba;var X=Ba=ua;if(Zb.test(g.charAt(ua))){var na=g.charAt(ua);ua++}else na=ma,0===eb&&v(Eb);na!==ma?(vc.test(g.charAt(ua))?(X=g.charAt(ua),ua++):(X=ma,0===eb&&v(Bd)),X===ma&&(X=null),X="e"+(null===X?"":X)):(ua=X,X=ma);X!==ma?(na=V(),na!==ma?Ba=X+na:(ua=Ba,Ba=ma)):(ua=Ba,Ba=ma);return Ba}function V(){var Ba=[];var X=
da();if(X!==ma)for(;X!==ma;)Ba.push(X),X=da();else Ba=ma;Ba!==ma&&(Ba=Ba.join(""));return Ba}function da(){if(Rb.test(g.charAt(ua))){var Ba=g.charAt(ua);ua++}else Ba=ma,0===eb&&v(ae);return Ba}function ca(){var Ba=ua;if(g.substr(ua,2).toLowerCase()===db){var X=g.substr(ua,2);ua+=2}else X=ma,0===eb&&v(be);if(X!==ma){X=ua;eb++;var na=P();eb--;na===ma?X=void 0:(ua=X,X=ma);X!==ma?Ba="IN":(ua=Ba,Ba=ma)}else ua=Ba,Ba=ma;return Ba}function ha(){var Ba=ua;if(g.substr(ua,2).toLowerCase()===va){var X=g.substr(ua,
2);ua+=2}else X=ma,0===eb&&v(ce);if(X!==ma){X=ua;eb++;var na=P();eb--;na===ma?X=void 0:(ua=X,X=ma);X!==ma?Ba="IS":(ua=Ba,Ba=ma)}else ua=Ba,Ba=ma;return Ba}function ia(){var Ba=ua;if(g.substr(ua,4).toLowerCase()===ta){var X=g.substr(ua,4);ua+=4}else X=ma,0===eb&&v(Dd);if(X!==ma){X=ua;eb++;var na=P();eb--;na===ma?X=void 0:(ua=X,X=ma);X!==ma?Ba="LIKE":(ua=Ba,Ba=ma)}else ua=Ba,Ba=ma;return Ba}function ka(){var Ba=ua;if(g.substr(ua,3).toLowerCase()===Sa){var X=g.substr(ua,3);ua+=3}else X=ma,0===eb&&v(ee);
if(X!==ma){X=ua;eb++;var na=P();eb--;na===ma?X=void 0:(ua=X,X=ma);X!==ma?Ba="NOT":(ua=Ba,Ba=ma)}else ua=Ba,Ba=ma;return Ba}function la(){var Ba=ua;if(g.substr(ua,3).toLowerCase()===Ya){var X=g.substr(ua,3);ua+=3}else X=ma,0===eb&&v(fe);if(X!==ma){X=ua;eb++;var na=P();eb--;na===ma?X=void 0:(ua=X,X=ma);X!==ma?Ba="AND":(ua=Ba,Ba=ma)}else ua=Ba,Ba=ma;return Ba}function Y(){var Ba=ua;if(g.substr(ua,2).toLowerCase()===cb){var X=g.substr(ua,2);ua+=2}else X=ma,0===eb&&v(Xd);if(X!==ma){X=ua;eb++;var na=P();
eb--;na===ma?X=void 0:(ua=X,X=ma);X!==ma?Ba="OR":(ua=Ba,Ba=ma)}else ua=Ba,Ba=ma;return Ba}function ea(){var Ba=ua;if(g.substr(ua,7).toLowerCase()===ib){var X=g.substr(ua,7);ua+=7}else X=ma,0===eb&&v(ge);if(X!==ma){X=ua;eb++;var na=P();eb--;na===ma?X=void 0:(ua=X,X=ma);X!==ma?Ba="BETWEEN":(ua=Ba,Ba=ma)}else ua=Ba,Ba=ma;return Ba}function ba(){var Ba=ua;if(g.substr(ua,4).toLowerCase()===mb){var X=g.substr(ua,4);ua+=4}else X=ma,0===eb&&v(he);if(X!==ma){X=ua;eb++;var na=P();eb--;na===ma?X=void 0:(ua=
X,X=ma);X!==ma?Ba="FROM":(ua=Ba,Ba=ma)}else ua=Ba,Ba=ma;return Ba}function Z(){var Ba=ua;if(g.substr(ua,4).toLowerCase()===Hb){var X=g.substr(ua,4);ua+=4}else X=ma,0===eb&&v(le);if(X!==ma){X=ua;eb++;var na=P();eb--;na===ma?X=void 0:(ua=X,X=ma);X!==ma?Ba="TRIM":(ua=Ba,Ba=ma)}else ua=Ba,Ba=ma;return Ba}function fa(){var Ba=ua;if(g.substr(ua,8).toLowerCase()===Jc){var X=g.substr(ua,8);ua+=8}else X=ma,0===eb&&v(se);if(X!==ma){X=ua;eb++;var na=P();eb--;na===ma?X=void 0:(ua=X,X=ma);X!==ma?Ba="INTERVAL":
(ua=Ba,Ba=ma)}else ua=Ba,Ba=ma;return Ba}function ja(){var Ba=ua;if(g.substr(ua,4).toLowerCase()===ac){var X=g.substr(ua,4);ua+=4}else X=ma,0===eb&&v(te);if(X!==ma){X=ua;eb++;var na=P();eb--;na===ma?X=void 0:(ua=X,X=ma);X!==ma?Ba="YEAR":(ua=Ba,Ba=ma)}else ua=Ba,Ba=ma;return Ba}function oa(){var Ba=ua;if(g.substr(ua,5).toLowerCase()===rc){var X=g.substr(ua,5);ua+=5}else X=ma,0===eb&&v(ue);if(X!==ma){X=ua;eb++;var na=P();eb--;na===ma?X=void 0:(ua=X,X=ma);X!==ma?Ba="MONTH":(ua=Ba,Ba=ma)}else ua=Ba,Ba=
ma;return Ba}function sa(){var Ba=ua;if(g.substr(ua,3).toLowerCase()===hc){var X=g.substr(ua,3);ua+=3}else X=ma,0===eb&&v(Fd);if(X!==ma){X=ua;eb++;var na=P();eb--;na===ma?X=void 0:(ua=X,X=ma);X!==ma?Ba="DAY":(ua=Ba,Ba=ma)}else ua=Ba,Ba=ma;return Ba}function qa(){var Ba=ua;if(g.substr(ua,4).toLowerCase()===wc){var X=g.substr(ua,4);ua+=4}else X=ma,0===eb&&v(ve);if(X!==ma){X=ua;eb++;var na=P();eb--;na===ma?X=void 0:(ua=X,X=ma);X!==ma?Ba="HOUR":(ua=Ba,Ba=ma)}else ua=Ba,Ba=ma;return Ba}function Ha(){var Ba=
ua;if(g.substr(ua,6).toLowerCase()===xc){var X=g.substr(ua,6);ua+=6}else X=ma,0===eb&&v(we);if(X!==ma){X=ua;eb++;var na=P();eb--;na===ma?X=void 0:(ua=X,X=ma);X!==ma?Ba="MINUTE":(ua=Ba,Ba=ma)}else ua=Ba,Ba=ma;return Ba}function Ga(){var Ba=ua;if(g.substr(ua,6).toLowerCase()===sc){var X=g.substr(ua,6);ua+=6}else X=ma,0===eb&&v(mc);if(X!==ma){X=ua;eb++;var na=P();eb--;na===ma?X=void 0:(ua=X,X=ma);X!==ma?Ba="SECOND":(ua=Ba,Ba=ma)}else ua=Ba,Ba=ma;return Ba}function pa(){var Ba=ua;if(g.substr(ua,4).toLowerCase()===
tc){var X=g.substr(ua,4);ua+=4}else X=ma,0===eb&&v(Yd);if(X!==ma){X=ua;eb++;var na=P();eb--;na===ma?X=void 0:(ua=X,X=ma);X!==ma?Ba="CASE":(ua=Ba,Ba=ma)}else ua=Ba,Ba=ma;return Ba}function Da(){var Ba=ua;if(g.substr(ua,3).toLowerCase()===lc){var X=g.substr(ua,3);ua+=3}else X=ma,0===eb&&v(zb);if(X!==ma){X=ua;eb++;var na=P();eb--;na===ma?X=void 0:(ua=X,X=ma);X!==ma?Ba="END":(ua=Ba,Ba=ma)}else ua=Ba,Ba=ma;return Ba}function ra(){var Ba=ua;if(g.substr(ua,4).toLowerCase()===Cc){var X=g.substr(ua,4);ua+=
4}else X=ma,0===eb&&v(Fb);if(X!==ma){X=ua;eb++;var na=P();eb--;na===ma?X=void 0:(ua=X,X=ma);X!==ma?Ba="WHEN":(ua=Ba,Ba=ma)}else ua=Ba,Ba=ma;return Ba}function Ea(){var Ba=ua;if(g.substr(ua,4).toLowerCase()===Bc){var X=g.substr(ua,4);ua+=4}else X=ma,0===eb&&v(Ac);if(X!==ma){X=ua;eb++;var na=P();eb--;na===ma?X=void 0:(ua=X,X=ma);X!==ma?Ba="THEN":(ua=Ba,Ba=ma)}else ua=Ba,Ba=ma;return Ba}function Ia(){if(44===g.charCodeAt(ua)){var Ba=Dc;ua++}else Ba=ma,0===eb&&v(rd);return Ba}function Ma(){if(40===g.charCodeAt(ua)){var Ba=
Gb;ua++}else Ba=ma,0===eb&&v(Zd);return Ba}function Qa(){if(41===g.charCodeAt(ua)){var Ba=bc;ua++}else Ba=ma,0===eb&&v(sd);return Ba}function wa(){var Ba;var X=[];for(Ba=Ja();Ba!==ma;)X.push(Ba),Ba=Ja();return X}function Ja(){if(dd.test(g.charAt(ua))){var Ba=g.charAt(ua);ua++}else Ba=ma,0===eb&&v(cd);return Ba}function Ta(Ba,X,na,Ca){Ba={type:"binary-expression",operator:Ba,left:X,right:na};void 0!==Ca&&(Ba.escape=Ca);return Ba}function Xa(Ba,X){for(var na=0;na<X.length;na++)Ba=Ta(X[na][1],Ba,X[na][3]);
return Ba}k=void 0!==k?k:{};var ma={},$a=k.grammarSource,xa={start:w},Ka=w,Oa="!",Va="\x3d",Ra="\x3e\x3d",za="\x3e",ya="\x3c\x3d",Na="\x3c\x3e",Wa="\x3c",bb="!\x3d",Aa="+",Pa="-",ab="*",fb="/",hb="@",kb="'",nb="N'",rb="''",sb=".",jb="null",qb="true",ob="false",db="in",va="is",ta="like",Fa="escape",Sa="not",Ya="and",cb="or",ib="between",mb="from",tb="for",Bb="substring",xb="extract",Hb="trim",Ub="position",Mb="timestamp",vb="date",Ib="leading",Pb="trailing",Sb="both",$b="to",Jc="interval",ac="year",
rc="month",hc="day",wc="hour",xc="minute",sc="second",tc="case",lc="end",Cc="when",Bc="then",Kb="else",Dc=",",Gb="(",bc=")",yc="`",Zc=/^[A-Za-z_\x80-\uFFFF]/,Yc=/^[A-Za-z0-9_]/,Vd=/^[A-Za-z0-9_.\x80-\uFFFF]/,ud=/^[^']/,Rb=/^[0-9]/,Zb=/^[eE]/,vc=/^[+\-]/,dd=/^[ \t\n\r]/,ed=/^[^`]/,Kc=f("!",!1),vd=f("\x3d",!1),Lc=f("\x3e\x3d",!1),gc=f("\x3e",!1),fd=f("\x3c\x3d",!1),Qb=f("\x3c\x3e",!1),Wd=f("\x3c",!1),wd=f("!\x3d",!1),Mc=f("+",!1),Nc=f("-",!1),xd=f("*",!1),yd=f("/",!1),zd=d([["A","Z"],["a","z"],"_",
["\u0080","\uffff"]],!1,!1),Lb=d([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),qd=d([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),$c=f("@",!1),Ec=f("'",!1),ad=f("N'",!1),zc=f("''",!1),Ad=d(["'"],!0,!1),$d=f(".",!1),ae=d([["0","9"]],!1,!1),Eb=d(["e","E"],!1,!1),Bd=d(["+","-"],!1,!1),gd=f("NULL",!0),Cd=f("TRUE",!0),hd=f("FALSE",!0),be=f("IN",!0),ce=f("IS",!0),Dd=f("LIKE",!0),de=f("ESCAPE",!0),ee=f("NOT",!0),fe=f("AND",!0),Xd=f("OR",!0),ge=f("BETWEEN",!0),he=f("FROM",!0),ie=f("FOR",
!0),je=f("SUBSTRING",!0),ke=f("EXTRACT",!0),le=f("TRIM",!0),me=f("POSITION",!0),ne=f("TIMESTAMP",!0),Ed=f("DATE",!0),oe=f("LEADING",!0),pe=f("TRAILING",!0),qe=f("BOTH",!0),re=f("TO",!0),se=f("INTERVAL",!0),te=f("YEAR",!0),ue=f("MONTH",!0),Fd=f("DAY",!0),ve=f("HOUR",!0),we=f("MINUTE",!0),mc=f("SECOND",!0),Yd=f("CASE",!0),zb=f("END",!0),Fb=f("WHEN",!0),Ac=f("THEN",!0),bd=f("ELSE",!0),rd=f(",",!1),Zd=f("(",!1),sd=f(")",!1),cd=d([" ","\t","\n","\r"],!1,!1),td=f("`",!1),Fc=d(["`"],!0,!1),Hc=function(Ba){return{type:"interval-period",
period:Ba.value,precision:null,secondary:null}},Gc=function(Ba,X){return{type:"interval-period",period:"second",precision:Ba,secondary:X}},ua=0,Oc=[{line:1,column:1}],dc=0,Ic=[],eb=0;if("startRule"in k){if(!(k.startRule in xa))throw Error("Can't start parsing from rule \""+k.startRule+'".');Ka=xa[k.startRule]}var id=Ka();if(id!==ma&&ua===g.length)return id;id!==ma&&ua<g.length&&v({type:"end"});throw function(Ba,X,na){return new r(r.buildMessage(Ba,X),Ba,X,na)}(Ic,dc<g.length?g.charAt(dc):null,dc<
g.length?h(dc,dc+1):h(dc,dc));}}})})(c);let m=function(){function l(){}l.parse=function(r){return c.exports.parse(r)};return l}();a.WhereGrammar=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/data/projectionSupport":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../geometry/projection ../../../geometry/geometryAdapters/json ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),
function(a,b,c,m,l,r,n){function g(t,x){if(!x)return null;if("x"in x){var B={x:0,y:0};[B.x,B.y]=t(x.x,x.y,e);null!=x.z&&(B.z=x.z);null!=x.m&&(B.m=x.m);return B}if("xmin"in x)return B={xmin:0,ymin:0,xmax:0,ymax:0},[B.xmin,B.ymin]=t(x.xmin,x.ymin,e),[B.xmax,B.ymax]=t(x.xmax,x.ymax,e),x.hasZ&&(B.zmin=x.zmin,B.zmax=x.zmax,B.hasZ=!0),x.hasM&&(B.mmin=x.mmin,B.mmax=x.mmax,B.hasM=!0),B;if("rings"in x)return{rings:k(x.rings,t),hasM:x.hasM,hasZ:x.hasZ};if("paths"in x)return{paths:k(x.paths,t),hasM:x.hasM,hasZ:x.hasZ};
if("points"in x)return{points:f(x.points,t),hasM:x.hasM,hasZ:x.hasZ}}function k(t,x){const B=[];for(const q of t)B.push(f(q,x));return B}function f(t,x){const B=[];for(const q of t)t=x(q[0],q[1],[0,0]),B.push(t),2<q.length&&t.push(q[2]),3<q.length&&t.push(q[3]);return B}function d(){d=b._asyncToGenerator(function*(t,x){x&&(t=Array.isArray(t)?t.map(B=>c.isSome(B.geometry)&&B.geometry.spatialReference):[t],yield m.initializeProjection(t.map(B=>({source:B,dest:x}))))});return d.apply(this,arguments)}
const e=[0,0],h=g.bind(null,n.lngLatToXY),v=g.bind(null,n.xyToLngLat),w=new (function(){function t(){this._jobs=[];this._timer=null;this._process=this._process.bind(this)}var x=t.prototype;x.push=function(){var B=b._asyncToGenerator(function*(q,u,C){if(!(q&&q.length&&u&&C)||r.equals(u,C))return q;const z={geometries:q,inSpatialReference:u,outSpatialReference:C,resolve:null};this._jobs.push(z);return new Promise(A=>{z.resolve=A;null===this._timer&&(this._timer=setTimeout(this._process,10))})});return function(q,
u,C){return B.apply(this,arguments)}}();x._process=function(){this._timer=null;const B=this._jobs.shift();if(B){var {geometries:q,inSpatialReference:u,outSpatialReference:C,resolve:z}=B;n.canProject(u,C)?r.isWebMercator(C)?z(q.map(h)):z(q.map(v)):z(m.projectMany(l.jsonAdapter,q,u,C,null,null));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}};return t}());a.checkProjectionSupport=function(t,x){return d.apply(this,arguments)};a.project=function(t,x,B,q){if(!t)return t;B||(B=x,x=t.spatialReference);
return r.isValid(x)&&r.isValid(B)&&!r.equals(x,B)?n.canProject(x,B)?(t=r.isWebMercator(B)?h(t):v(t),t.spatialReference=B,t):m.projectMany(l.jsonAdapter,[t],x,B,null,q)[0]:t};a.projectMany=function(t,x,B){return w.push(t,x,B)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/geometryAdapters/json":function(){define(["exports"],function(a){let b=function(n,g,k){this.x=n;this.y=g;this.spatialReference=k;this.m=this.z=void 0},c=function(n,g,k,
f){this.rings=n;this.spatialReference=g;this.hasM=this.hasZ=void 0;k&&(this.hasZ=k);f&&(this.hasM=f)},m=function(n,g,k,f){this.paths=n;this.spatialReference=g;this.hasM=this.hasZ=void 0;k&&(this.hasZ=k);f&&(this.hasM=f)},l=function(n,g,k,f){this.points=n;this.spatialReference=g;this.hasM=this.hasZ=void 0;k&&(this.hasZ=k);f&&(this.hasM=f)},r=function(n,g,k,f,d){this.xmin=n;this.ymin=g;this.xmax=k;this.ymax=f;this.spatialReference=d;this.mmax=this.mmin=this.zmax=this.zmin=void 0};a.jsonAdapter={convertToGEGeometry:function(n,
g){return null==g?null:n.convertJSONToGeometry(g)},exportPoint:function(n,g,k){k=new b(n.getPointX(g),n.getPointY(g),k);const f=n.hasZ(g),d=n.hasM(g);f&&(k.z=n.getPointZ(g));d&&(k.m=n.getPointM(g));return k},exportPolygon:function(n,g,k){return new c(n.exportPaths(g),k,n.hasZ(g),n.hasM(g))},exportPolyline:function(n,g,k){return new m(n.exportPaths(g),k,n.hasZ(g),n.hasM(g))},exportMultipoint:function(n,g,k){return new l(n.exportPoints(g),k,n.hasZ(g),n.hasM(g))},exportExtent:function(n,g,k){var f=n.hasZ(g);
const d=n.hasM(g);k=new r(n.getXMin(g),n.getYMin(g),n.getXMax(g),n.getYMax(g),k);f&&(f=n.getZExtent(g),k.zmin=f.vmin,k.zmax=f.vmax);d&&(n=n.getMExtent(g),k.mmin=n.vmin,k.mmax=n.vmax);return k}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/data/QueryEngineResult":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../geometry/support/centroid ../../../geometry/support/extentUtils ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ./AttributesBuilder ./projectionSupport ./utils ../../support/fieldUtils ../../../statistics/utils ../../../support/arcadeOnDemand".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){function w(B,q,u,C,z,A){z-=u;A-=C;B=Math.min(1,Math.max(0,((B-u)*z+(q-C)*A)/(z*z+A*A)));return{x:u+z*B,y:C+A*B}}function t(B,q){return B?q?4:3:q?3:2}let x=function(){function B(u,C,z){this.items=u;this.query=C;this.geometryType=z.geometryType;this.hasM=z.hasM;this.hasZ=z.hasZ;this.fieldsIndex=z.fieldsIndex;this.objectIdField=z.objectIdField;this.spatialReference=z.spatialReference;this.featureAdapter=z.featureAdapter}var q=B.prototype;q.createQueryResponseForCount=
function(){const u=new k(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return u.countDistinctValues(this.items);const {groupByFieldsForStatistics:C,having:z,outStatistics:A}=this.query;if(null==C||!C.length)return 1;const p=new Map,y=new Map,D=new Set;for(const G of A){var {statisticType:E}=G;E="exceedslimit"!==E?G.onStatisticField:void 0;if(!y.has(E)){var F=[];for(const P of C){const K=this._getAttributeValues(u,P,p);F.push(K)}y.set(E,this._calculateUniqueValues(F,
u.returnDistinctValues))}E=y.get(E);for(const P in E){const {data:K,items:N}=E[P];F=K.join(",");z&&!u.validateItems(N,z)||D.add(F)}}return D.size};q.createQueryResponse=function(){var u=c._asyncToGenerator(function*(){let C;C=this.query.outStatistics?this.query.outStatistics.some(z=>"exceedslimit"===z.statisticType)?this._createExceedsLimitQueryResponse(this.query):yield this._createStatisticsQueryResponse(this.query):this._createFeatureQueryResponse(this.query);this.query.returnQueryGeometry&&(g.isValid(this.query.outSR)&&
!g.equals(this.query.geometry.spatialReference,this.query.outSR)?C.queryGeometry=d.cleanFromGeometryEngine({spatialReference:this.query.outSR,...f.project(this.query.geometry,this.query.geometry.spatialReference,this.query.outSR)}):C.queryGeometry=d.cleanFromGeometryEngine({spatialReference:this.query.outSR,...this.query.geometry}));return C});return function(){return u.apply(this,arguments)}}();q.createSnappingResponse=function(u,C){const z=this.featureAdapter,A=t(this.hasZ,this.hasM),{x:p,y}=u.point,
D="number"===typeof u.distance?u.distance:u.distance.x,E="number"===typeof u.distance?u.distance:u.distance.y,F={candidates:[]},G="esriGeometryPolygon"===this.geometryType;C=this._getPointCreator(u.point,this.spatialReference,C);for(const I of this.items){var P=z.getGeometry(I);if(m.isNone(P))continue;const {coords:O,lengths:Q}=P;if(u.types&b.SnappingTypes.EDGE){P=0;for(var K=0;K<Q.length;K++){var N=Q[K];for(var M=0;M<N;M++,P+=A){var L=O[P],J=O[P+1];if(M!==N-1){const S=O[P+A],T=O[P+A+1],{x:U,y:aa}=
w(p,y,L,J,S,T);var H=(p-U)/D;const W=(y-aa)/E;H=H*H+W*W;1>=H&&F.candidates.push({type:"edge",objectId:z.getObjectId(I),distance:Math.sqrt(H),target:C(U,aa),start:C(L,J),end:C(S,T)})}}}}if(u.types&b.SnappingTypes.VERTEX)for(P=G?O.length-A:O.length,K=0;K<P;K+=A)N=O[K],M=O[K+1],L=(p-N)/D,J=(y-M)/E,L=L*L+J*J,1>=L&&F.candidates.push({type:"vertex",objectId:z.getObjectId(I),distance:Math.sqrt(L),target:C(N,M)})}F.candidates.sort((I,O)=>I.distance-O.distance);return F};q._getPointCreator=function(u,C,z){const A=
m.isSome(z)&&!g.equals(C,z)?p=>f.project(p,C,z):p=>p;return null!=u.z&&null!=u.m?(p,y)=>A({x:p,y,z:u.z,m:u.m}):null!=u.z?(p,y)=>A({x:p,y,z:u.z}):null!=u.m?(p,y)=>A({x:p,y,m:u.m}):(p,y)=>A({x:p,y})};q.createSummaryStatisticsResponse=function(){var u=c._asyncToGenerator(function*(C){const {field:z,valueExpression:A,normalizationField:p,normalizationType:y,normalizationTotal:D,minValue:E,maxValue:F,scale:G}=C;C=this.fieldsIndex.isDateField(z);var P=yield this._getDataValues({field:z,valueExpression:A,
normalizationField:p,normalizationType:y,normalizationTotal:D,scale:G});const K=h.isNullCountSupported({normalizationType:y,normalizationField:p,minValue:E,maxValue:F}),N=this.fieldsIndex.get(z),M={value:.5,fieldType:null==N?void 0:N.type};P=e.isStringField(N)?h.calculateStringStatistics({values:P,supportsNullCount:K,percentileParams:M}):h.calculateStatistics({values:P,minValue:E,maxValue:F,useSampleStdDev:!y,supportsNullCount:K,percentileParams:M});return h.processSummaryStatisticsResult(P,C)});
return function(C){return u.apply(this,arguments)}}();q.createUniqueValuesResponse=function(){var u=c._asyncToGenerator(function*(C){const {field:z,valueExpression:A,domain:p,returnAllCodedValues:y,scale:D}=C;C=yield this._getDataValues({field:z,valueExpression:A,scale:D});C=h.calculateUniqueValuesCount(C);return h.createUVResult(C,p,y)});return function(C){return u.apply(this,arguments)}}();q.createClassBreaksResponse=function(){var u=c._asyncToGenerator(function*(C){const {field:z,valueExpression:A,
normalizationField:p,normalizationType:y,normalizationTotal:D,classificationMethod:E,standardDeviationInterval:F,minValue:G,maxValue:P,numClasses:K,scale:N}=C;C=yield this._getDataValues({field:z,valueExpression:A,normalizationField:p,normalizationType:y,normalizationTotal:D,scale:N});C=h.calculateClassBreaks(C,{field:z,normalizationField:p,normalizationType:y,normalizationTotal:D,classificationMethod:E,standardDeviationInterval:F,minValue:G,maxValue:P,numClasses:K});return h.resolveCBResult(C,E)});
return function(C){return u.apply(this,arguments)}}();q.createHistogramResponse=function(){var u=c._asyncToGenerator(function*(C){const {field:z,valueExpression:A,normalizationField:p,normalizationType:y,normalizationTotal:D,classificationMethod:E,standardDeviationInterval:F,minValue:G,maxValue:P,numBins:K,scale:N}=C;C=yield this._getDataValues({field:z,valueExpression:A,normalizationField:p,normalizationType:y,normalizationTotal:D,scale:N});return h.calculateHistogram(C,{field:z,normalizationField:p,
normalizationType:y,normalizationTotal:D,classificationMethod:E,standardDeviationInterval:F,minValue:G,maxValue:P,numBins:K})});return function(C){return u.apply(this,arguments)}}();q._sortFeatures=function(u,C,z){if(1<u.length&&C&&C.length)for(const A of C.reverse()){C=A.split(" ");const p=C[0],y=this.fieldsIndex.get(p);C=C[1]&&"desc"===C[1].toLowerCase();const D=h.getAttributeComparator(null==y?void 0:y.type,C);u.sort((E,F)=>{E=z(E,p,y);F=z(F,p,y);return D(E,F)})}};q._createFeatureQueryResponse=
function(u){const C=this.items,{geometryType:z,hasM:A,hasZ:p,objectIdField:y,spatialReference:D}=this,{outFields:E,outSR:F,quantizationParameters:G,resultRecordCount:P,resultOffset:K,returnZ:N,returnM:M}=u,L=null!=P?C.length>(K||0)+P:!1,J=E&&(E.includes("*")?[...this.fieldsIndex.fields]:E.map(H=>this.fieldsIndex.get(H)));return{exceededTransferLimit:L,features:this._createFeatures(u,C),fields:J,geometryType:z,hasM:A&&M,hasZ:p&&N,objectIdFieldName:y,spatialReference:d.cleanFromGeometryEngine(F?F:D),
transform:G&&n.toQuantizationTransform(G)||null}};q._createFeatures=function(u,C){const z=new k(u,this.featureAdapter,this.fieldsIndex),{hasM:A,hasZ:p}=this,{orderByFields:y,quantizationParameters:D,returnGeometry:E,returnCentroid:F,maxAllowableOffset:G,resultOffset:P,resultRecordCount:K,returnZ:N=!1,returnM:M=!1}=u,L=p&&N,J=A&&M;u=[];var H=0;C=[...C];this._sortFeatures(C,y,(Q,S,T)=>z.getFieldValue(Q,S,T));if(E||F){var I=n.toQuantizationTransform(D);if(E&&!F)for(var O of C)u[H++]={attributes:z.getAttributes(O),
geometry:d.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(O),G,I,L,J)};else if(!E&&F)for(const Q of C)u[H++]={attributes:z.getAttributes(Q),centroid:d.transformCentroid(this,this.featureAdapter.getCentroid(Q,this),I)};else for(const Q of C)u[H++]={attributes:z.getAttributes(Q),centroid:d.transformCentroid(this,this.featureAdapter.getCentroid(Q,this),I),geometry:d.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(Q),G,I,L,J)}}else for(I of C)(O=
z.getAttributes(I))&&(u[H++]={attributes:O});H=P||0;null!=K&&(u=u.slice(H,Math.min(u.length,H+K)));return u};q._createExceedsLimitQueryResponse=function(u){var C=!1;let z=Number.POSITIVE_INFINITY,A=Number.POSITIVE_INFINITY;C=Number.POSITIVE_INFINITY;for(const p of u.outStatistics)if("exceedslimit"===p.statisticType){z=null!=p.maxPointCount?p.maxPointCount:Number.POSITIVE_INFINITY;A=null!=p.maxRecordCount?p.maxRecordCount:Number.POSITIVE_INFINITY;C=null!=p.maxVertexCount?p.maxVertexCount:Number.POSITIVE_INFINITY;
break}if("esriGeometryPoint"===this.geometryType)C=this.items.length>z;else if(this.items.length>A)C=!0;else{u=this.hasZ?this.hasM?4:3:this.hasM?3:2;const p=this.featureAdapter;C=this.items.reduce((y,D)=>{D=p.getGeometry(D);return y+(m.isSome(D)&&D.coords.length||0)},0)/u>C}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(C)}}]}};q._createStatisticsQueryResponse=
function(){var u=c._asyncToGenerator(function*(C){var z={attributes:{}};const A=[],p=new Map,y=new Map,D=new Map,E=new Map,F=new k(C,this.featureAdapter,this.fieldsIndex);var G=C.outStatistics;const {groupByFieldsForStatistics:P,having:K,orderByFields:N}=C;C=P&&P.length;const M=!!C,L=M&&P[0],J=M&&!this.fieldsIndex.get(L);for(const S of G){const {outStatisticFieldName:T,statisticType:U}=S;G=S;var H="exceedslimit"!==U?S.onStatisticField:void 0;const aa="percentile_disc"===U||"percentile_cont"===U,W=
"EnvelopeAggregate"===U||"CentroidAggregate"===U||"ConvexHullAggregate"===U,R=M&&1===C&&(H===L||J)&&"count"===U;if(M){if(!D.has(H)){var I=[];for(const V of P){var O=this._getAttributeValues(F,V,p);I.push(O)}D.set(H,this._calculateUniqueValues(I,F.returnDistinctValues))}I=D.get(H);for(const V in I){const {count:da,data:ca,items:ha,itemPositions:ia}=I[V];O=ca.join(",");if(!K||F.validateItems(ha,K)){const ka=E.get(O)||{attributes:{}};if(W){ka.aggregateGeometries||(ka.aggregateGeometries={});const {aggregateGeometries:la,
outStatisticFieldName:Y}=yield this._getAggregateGeometry(G,ha);ka.aggregateGeometries[Y]=la}else{var Q=null;if(R)Q=da;else{const la=this._getAttributeValues(F,H,p);Q=ia.map(Y=>la[Y]);Q=aa&&"statisticParameters"in G?this._getPercentileValue(G,Q):this._getStatisticValue(G,Q,null,F.returnDistinctValues)}ka.attributes[T]=Q}P.forEach((la,Y)=>ka.attributes[this.fieldsIndex.get(la)?la:`EXPR_${Y+1}`]=ca[Y]);E.set(O,ka)}}}else if(W){z.aggregateGeometries||(z.aggregateGeometries={});const {aggregateGeometries:V,
outStatisticFieldName:da}=yield this._getAggregateGeometry(G,this.items);z.aggregateGeometries[da]=V}else H=this._getAttributeValues(F,H,p),z.attributes[T]=aa&&"statisticParameters"in G?this._getPercentileValue(G,H):this._getStatisticValue(G,H,y,F.returnDistinctValues);A.push({name:T,alias:T,type:"esriFieldTypeDouble"})}z=M?Array.from(E.values()):[z];this._sortFeatures(z,N,(S,T)=>S.attributes[T]);return{fields:A,features:z}});return function(C){return u.apply(this,arguments)}}();q._getAggregateGeometry=
function(){var u=c._asyncToGenerator(function*(C,z){var A=yield new Promise((N,M)=>a(["../../../geometry/geometryEngineJSON"],N,M));const {statisticType:p,outStatisticFieldName:y}=C,{featureAdapter:D,spatialReference:E,geometryType:F,hasZ:G,hasM:P}=this;z=z.map(N=>d.getGeometry(F,G,P,D.getGeometry(N)));const K=A.convexHull(E,z,!0)[0];C={aggregateGeometries:null,outStatisticFieldName:null};"EnvelopeAggregate"===p?(A=K?r.getPolygonExtent(K):r.getGeometryExtent(A.union(E,z)),C.aggregateGeometries={...A,
spatialReference:E},C.outStatisticFieldName=y||"extent"):"CentroidAggregate"===p?(A=K?l.polygonCentroid(K):l.extentCentroid(r.getGeometryExtent(A.union(E,z))),C.aggregateGeometries={x:A[0],y:A[1],spatialReference:E},C.outStatisticFieldName=y||"centroid"):"ConvexHullAggregate"===p&&(C.aggregateGeometries=K,C.outStatisticFieldName=y||"convexHull");return C});return function(C,z){return u.apply(this,arguments)}}();q._getStatisticValue=function(u,C,z,A){const {onStatisticField:p,statisticType:y}=u;u=
null;u=null!=z&&z.has(p)?z.get(p):e.isStringField(this.fieldsIndex.get(p))?h.calculateStringStatistics({values:C,returnDistinct:A}):h.calculateStatistics({values:C,minValue:null,maxValue:null,useSampleStdDev:!0});z&&z.set(p,u);return u["var"===y?"variance":y]};q._getPercentileValue=function(u,C){const {onStatisticField:z,statisticParameters:A,statisticType:p}=u,{value:y,orderBy:D}=A;u=this.fieldsIndex.get(z);return h.calculatePercentile(C,{value:y,orderBy:D,fieldType:null==u?void 0:u.type,isDiscrete:"percentile_disc"===
p})};q._getAttributeValues=function(u,C,z){if(z.has(C))return z.get(C);const A=this.fieldsIndex.get(C),p=this.items.map(y=>u.getFieldValue(y,C,A));z.set(C,p);return p};q._getAttributeNormalizedValues=function(u,C){return this.items.map(z=>u.getNormalizedValue(z,{field:C.field,fieldInfo:this.fieldsIndex.get(C.field),normalizationField:C.normalizationField,normalizationFieldInfo:this.fieldsIndex.get(C.normalizationField),normalizationType:C.normalizationType,normalizationTotal:C.normalizationTotal}))};
q._getAttributeExpressionValues=function(){var u=c._asyncToGenerator(function*(C,z,A){const {arcadeUtils:p}=yield v.loadArcade();z=p.createFunction(z);A=A&&p.getViewInfo(A);return C.getExpressionValues(this.items,z,A,p)});return function(C,z,A){return u.apply(this,arguments)}}();q._calculateUniqueValues=function(u,C){const z={},A=this.items,p=A.length;for(let y=0;y<p;y++){const D=A[y],E=[];for(const G of u)E.push(G[y]);const F=E.join(",");C?null==z[F]&&(z[F]={count:1,data:E,items:[D],itemPositions:[y]}):
null==z[F]?z[F]={count:1,data:E,items:[D],itemPositions:[y]}:(z[F].count++,z[F].items.push(D),z[F].itemPositions.push(y))}return z};q._getDataValues=function(){var u=c._asyncToGenerator(function*(C){const z=new k(this.query,this.featureAdapter,this.fieldsIndex),{valueExpression:A,field:p,normalizationField:y,normalizationType:D,normalizationTotal:E,scale:F}=C;C=A?{viewingMode:"map",scale:F,spatialReference:this.query.outSR||this.spatialReference}:null;return A?this._getAttributeExpressionValues(z,
A,C):this._getAttributeNormalizedValues(z,{field:p,normalizationField:y,normalizationType:D,normalizationTotal:E})});return function(C){return u.apply(this,arguments)}}();c._createClass(B,[{key:"size",get:function(){return this.items.length}}]);return B}();b.SnappingTypes=void 0;(function(B){B[B.NONE=0]="NONE";B[B.EDGE=1]="EDGE";B[B.VERTEX=2]="VERTEX"})(b.SnappingTypes||(b.SnappingTypes={}));b.QueryEngineResult=x;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/layers/graphics/data/AttributesBuilder":function(){define(["../../../core/maybe","./attributeSupport","../../../statistics/utils"],function(a,b,c){return function(){function m(r,n,g){this._fieldDataCache=new Map;this._returnDistinctMap=new Map;this.returnDistinctValues=r.returnDistinctValues;this.fieldsIndex=g;this.featureAdapter=n;if((n=r.outFields)&&!n.includes("*")){this.outFields=n;r=0;for(const f of n){var k=b.getExpressionFromFieldName(f);k=(n=this.fieldsIndex.get(k))?null:b.getWhereClause(k,
g);n=n?n.name:b.getAliasFromFieldName(f)||`FIELD_EXP_${r++}`;this._fieldDataCache.set(f,{alias:n,clause:k})}}}var l=m.prototype;l.countDistinctValues=function(r){if(!this.returnDistinctValues)return r.length;r.forEach(n=>this.getAttributes(n));return this._returnDistinctMap.size};l.getAttributes=function(r){r=this._processAttributesForOutFields(r);return this._processAttributesForDistinctValues(r)};l.getFieldValue=function(r,n,g){const k=g?g.name:n;let f=null;this._fieldDataCache.has(k)?f=this._fieldDataCache.get(k).clause:
g||(f=b.getWhereClause(n,this.fieldsIndex),this._fieldDataCache.set(k,{alias:k,clause:f}));return g?this.featureAdapter.getAttribute(r,k):f.calculateValue(r,this.featureAdapter)};l.getNormalizedValue=function(r,n){const g=n.normalizationType,k=n.normalizationTotal;let f=this.getFieldValue(r,n.field,n.fieldInfo);g&&Number.isFinite(f)&&(r=this.getFieldValue(r,n.normalizationField,n.normalizationFieldInfo),f=c.getNormalizedValue(f,g,r,k));return f};l.getExpressionValue=function(r,n,g,k){r={attributes:this.featureAdapter.getAttributes(r),
layer:{fields:this.fieldsIndex.fields}};g=k.createExecContext(r,g);return k.executeFunction(n,g)};l.getExpressionValues=function(r,n,g,k){const f={fields:this.fieldsIndex.fields};return r.map(d=>{d={attributes:this.featureAdapter.getAttributes(d),layer:f};d=k.createExecContext(d,g);return k.executeFunction(n,d)})};l.validateItem=function(r,n){this._fieldDataCache.has(n)||this._fieldDataCache.set(n,{alias:n,clause:b.getWhereClause(n,this.fieldsIndex)});return this._fieldDataCache.get(n).clause.testFeature(r,
this.featureAdapter)};l.validateItems=function(r,n){this._fieldDataCache.has(n)||this._fieldDataCache.set(n,{alias:n,clause:b.getWhereClause(n,this.fieldsIndex)});return this._fieldDataCache.get(n).clause.testSet(r,this.featureAdapter)};l._processAttributesForOutFields=function(r){const n=this.outFields;if(!n||!n.length)return this.featureAdapter.getAttributes(r);const g={};for(const k of n){const {alias:f,clause:d}=this._fieldDataCache.get(k);g[f]=d?d.calculateValue(r,this.featureAdapter):this.featureAdapter.getAttribute(r,
f)}return g};l._processAttributesForDistinctValues=function(r){if(a.isNone(r)||!this.returnDistinctValues)return r;var n=this.outFields,g=[];if(n)for(const f of n){var {alias:k}=this._fieldDataCache.get(f);g.push(r[k])}else for(k in r)g.push(r[k]);n=`${(n||["*"]).join(",")}=${g.join(",")}`;g=this._returnDistinctMap.get(n)||0;this._returnDistinctMap.set(n,++g);return 1<g?null:r};return m}()})},"esri/statistics/utils":function(){define(["exports","../rest/support/ClassBreaksDefinition","../rest/support/generateRendererUtils"],
function(a,b,c){function m(u){const C=null!=u.minValue||null!=u.maxValue,z=!!u.sqlExpression&&u.supportsSQLExpression;return!(null!=u.normalizationField||null!=u.normalizationType)&&!C&&!z}function l(u){const {values:C,useSampleStdDev:z,supportsNullCount:A}=u;var p=Number.POSITIVE_INFINITY;let y=Number.NEGATIVE_INFINITY,D=null,E=null;var F=null;let G=null,P=0;const K=null==u.minValue?-Infinity:u.minValue,N=null==u.maxValue?Infinity:u.maxValue;for(const M of C)Number.isFinite(M)?M>=K&&M<=N&&(D+=M,
p=Math.min(p,M),y=Math.max(y,M),P++):"string"===typeof M&&P++;if(P&&null!=D){E=D/P;F=0;for(const M of C)Number.isFinite(M)&&M>=K&&M<=N&&(F+=(M-E)**2);G=z?1<P?F/(P-1):0:0<P?F/P:0;F=Math.sqrt(G)}else y=p=null;p={avg:E,count:P,max:y,min:p,stddev:F,sum:D,variance:G};A&&(p.nullcount=C.length-P);u.percentileParams&&(p.median=r(C,u.percentileParams));return p}function r(u,C){const {fieldType:z,value:A,orderBy:p,isDiscrete:y}=C,D=n(z,"desc"===p);u=[...u].filter(P=>null!=P).sort((P,K)=>D(P,K));if(0===u.length)return null;
if(0>=A)return u[0];if(1<=A)return u[u.length-1];var E=(u.length-1)*A,F=Math.floor(E);C=F+1;E%=1;F=u[F];const G=u[C];return C>=u.length||y||"string"===typeof F||"string"===typeof G?F:F*(1-E)+G*E}function n(u,C){const z=C?1:-1,A=k(C),p=g(C);if(!u||!["esriFieldTypeDate","esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",...B].includes(u))return(y,D)=>"number"===typeof y&&"number"===typeof D?A(y,D):"string"===typeof y&&"string"===typeof D?p(y,D):z;if("esriFieldTypeDate"===u)return(y,D)=>
{y=(new Date(y)).getTime();D=(new Date(D)).getTime();return isNaN(y)||isNaN(D)?z:A(y,D)};if(B.has(u))return(y,D)=>A(y,D);if("esriFieldTypeString"===u)return(y,D)=>p(y,D);if("esriFieldTypeGUID"===u||"esriFieldTypeGlobalID"===u){const y=g(C);return(D,E)=>y(f(D),f(E))}return C?(y,D)=>1:(y,D)=>-1}function g(u){return u?(C,z)=>{var A,p;C=null==(A=C)?void 0:A.toUpperCase();z=null==(p=z)?void 0:p.toUpperCase();return C>z?-1:C<z?1:0}:(C,z)=>{var A,p;C=null==(A=C)?void 0:A.toUpperCase();z=null==(p=z)?void 0:
p.toUpperCase();return C<z?-1:C>z?1:0}}function k(u){return u?(C,z)=>z-C:(C,z)=>C-z}function f(u){return u.substr(24,12)+u.substr(19,4)+u.substr(16,2)+u.substr(14,2)+u.substr(11,2)+u.substr(9,2)+u.substr(6,2)+u.substr(4,2)+u.substr(2,2)+u.substr(0,2)}function d(u,C){const z=h({field:C.field,normalizationType:C.normalizationType,normalizationField:C.normalizationField,classificationMethod:C.classificationMethod,standardDeviationInterval:C.standardDeviationInterval,breakCount:C.numClasses||5});u=e(u,
C.minValue,C.maxValue);return c.createGenerateRendererClassBreaks({definition:z,values:u,normalizationTotal:C.normalizationTotal})}function e(u,C,z){C=null==C?-Infinity:C;z=null==z?Infinity:z;return u.filter(A=>Number.isFinite(A)&&A>=C&&A<=z)}function h(u){const C=u.field,z=u.classificationMethod||"equal-interval",A=u.normalizationType,p=u.normalizationField,y=new b;y.classificationField=C;y.breakCount=u.breakCount;y.classificationMethod=z;y.standardDeviationInterval="standard-deviation"===z?u.standardDeviationInterval||
1:void 0;y.normalizationType=A;y.normalizationField="field"===A?p:void 0;return y}function v(u,C){const {field:z,classificationMethod:A,standardDeviationInterval:p,normalizationType:y,normalizationField:D,normalizationTotal:E,minValue:F,maxValue:G}=C,P=C.numBins||10;let K=C=null,N=null;A&&"equal-interval"!==A||y?({classBreaks:u}=d(u,{field:z,normalizationType:y,normalizationField:D,normalizationTotal:E,classificationMethod:A,standardDeviationInterval:p,minValue:F,maxValue:G,numClasses:P}),C=u[0].minValue,
K=u[u.length-1].maxValue,N=u.map(M=>[M.minValue,M.maxValue])):(null!=F&&null!=G?(C=F,K=G):(u=l({values:u,minValue:F,maxValue:G,useSampleStdDev:!y,supportsNullCount:m({normalizationType:y,normalizationField:D,minValue:F,maxValue:G})}),C=u.min,K=u.max),N=t(C,K,P));return{min:C,max:K,intervals:N}}function w(u,C){let z=-1;for(let A=u.length-1;0<=A;A--)if(C>=u[A][0]){z=A;break}return z}function t(u,C,z){const A=(C-u)/z,p=[];let y;for(let D=1;D<=z;D++)y=u+A,y=Number(y.toFixed(16)),p.push([u,D===z?C:y]),
u=y;return p}const x=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,B=new Set(["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),q="min max avg stddev count sum variance nullcount median".split(" ");a.calculateClassBreaks=d;a.calculateHistogram=function(u,C){const {min:z,max:A,intervals:p}=v(u,C),y=p.map((D,E)=>({minValue:p[E][0],maxValue:p[E][1],count:0}));for(const D of u)null!=D&&D>=z&&D<=A&&(u=w(p,D),-1<u&&y[u].count++);return{bins:y,minValue:z,maxValue:A,
normalizationTotal:C.normalizationTotal}};a.calculatePercentile=r;a.calculateStatistics=l;a.calculateStringStatistics=function(u){const C=u.returnDistinct?[...new Set(u.values)]:u.values,z=C.filter(p=>null!=p).length,A={count:z};u.supportsNullCount&&(A.nullcount=C.length-z);u.percentileParams&&(A.median=r(C,u.percentileParams));return A};a.calculateUniqueValuesCount=function(u){const C={};for(let z of u){if(null==z||"string"===typeof z&&""===z.trim())z=null;null==C[z]?C[z]={count:1,data:z}:C[z].count++}return{count:C}};
a.createClassBreaksDefinition=h;a.createUVResult=function(u,C,z){const A=u.count;u=[];z&&C&&"coded-value"===C.type&&C.codedValues.forEach(p=>{p=p.code;A.hasOwnProperty(p)||(A[p]={data:p,count:0})});for(const p in A)C=A[p],u.push({value:C.data,count:C.count,label:C.label});return{uniqueValueInfos:u}};a.getAttributeComparator=n;a.getEqualIntervalBins=t;a.getNormalizedValue=function(u,C,z,A){let p=null;switch(C){case "log":0!==u&&(p=Math.log(u)*Math.LOG10E);break;case "percent-of-total":Number.isFinite(A)&&
0!==A&&(p=u/A*100);break;case "field":Number.isFinite(z)&&0!==z&&(p=u/z);break;case "natural-log":0<u&&(p=Math.log(u));break;case "square-root":0<u&&(p=u**.5)}return p};a.isNullCountSupported=m;a.processSummaryStatisticsResult=function(u,C){let z;for(z in u)q.includes(z)&&(Number.isFinite(u[z])||(u[z]=null));if(!C)return u;["avg","stddev","variance"].forEach(A=>{null!=u[A]&&(u[A]=Math.ceil(u[A]))});return u};a.resolveCBResult=function(u,C){let z=u.classBreaks;const A=z[0].minValue,p=z[z.length-1].maxValue,
y="standard-deviation"===C;z=z.map(D=>{const E=D.label;D={minValue:D.minValue,maxValue:D.maxValue,label:E};if(y&&E){const F=E.match(x).map(G=>+G.trim());2===F.length?(D.minStdDev=F[0],D.maxStdDev=F[1],0>F[0]&&0<F[1]&&(D.hasAvg=!0)):1===F.length&&(E.includes("\x3c")?(D.minStdDev=null,D.maxStdDev=F[0]):E.includes("\x3e")&&(D.minStdDev=F[0],D.maxStdDev=null))}return D});return{minValue:A,maxValue:p,classBreakInfos:z,normalizationTotal:u.normalizationTotal}};a.statisticTypes=q;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/support/ClassBreaksDefinition":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/jsonMap ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./ClassificationDefinition".split(" "),function(a,b,c,m,l,r,n,g,k){l=new c.JSONMap({esriClassifyEqualInterval:"equal-interval",
esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"});c=new c.JSONMap({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});k=function(f){function d(){var e=f.apply(this,arguments)||this;e.breakCount=null;e.classificationField=null;e.classificationMethod=null;e.normalizationField=null;e.normalizationType=
null;e.type="class-breaks-definition";return e}a._inheritsLoose(d,f);a._createClass(d,[{key:"standardDeviationInterval",set:function(e){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",e)}},{key:"definedInterval",set:function(e){"defined-interval"===this.classificationMethod&&this._set("definedInterval",e)}}]);return d}(k);b.__decorate([m.property({json:{write:!0}})],k.prototype,"breakCount",void 0);b.__decorate([m.property({json:{write:!0}})],k.prototype,"classificationField",
void 0);b.__decorate([m.property({type:String,json:{read:l.read,write:l.write}})],k.prototype,"classificationMethod",void 0);b.__decorate([m.property({json:{write:!0}})],k.prototype,"normalizationField",void 0);b.__decorate([m.property({json:{read:c.read,write:c.write}})],k.prototype,"normalizationType",void 0);b.__decorate([m.property({value:null,json:{write:!0}})],k.prototype,"standardDeviationInterval",null);b.__decorate([m.property({value:null,json:{write:!0}})],k.prototype,"definedInterval",
null);b.__decorate([m.property()],k.prototype,"type",void 0);return k=b.__decorate([g.subclass("esri.rest.support.ClassBreaksDefinition")],k)})},"esri/rest/support/ClassificationDefinition":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./colorRamps ../../symbols/Symbol".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){c=new c.JSONMap({classBreaksDef:"class-breaks-definition",uniqueValueDef:"unique-value-definition"});m=function(e){function h(){var v=e.apply(this,arguments)||this;v.baseSymbol=null;v.colorRamp=null;v.type=null;return v}a._inheritsLoose(h,e);return h}(m.JSONSupport);b.__decorate([l.property({type:d,json:{write:!0}})],m.prototype,"baseSymbol",void 0);b.__decorate([l.property({types:f.types,json:{read:{reader:f.fromJSON},write:!0}})],m.prototype,"colorRamp",void 0);b.__decorate([l.property({json:{read:c.read,
write:c.write}})],m.prototype,"type",void 0);return m=b.__decorate([k.subclass("esri.rest.support.ClassificationDefinition")],m)})},"esri/rest/support/generateRendererUtils":function(){define(["exports"],function(a){function b(d){const {classificationMethod:e,breakCount:h,normalizationType:v,definedInterval:w}=d.definition,t=[];var x=d.values;if(0===x.length)return[];x=x.sort((A,p)=>A-p);var B=x[0],q=x[x.length-1];if("equal-interval"===e)if(x.length>=h){x=(q-B)/h;d=B;for(var u=1;u<h;u++){var C=Number((B+
u*x).toFixed(6));t.push({minValue:d,maxValue:C,label:c(d,C,v)});d=C}t.push({minValue:d,maxValue:q,label:c(d,q,v)})}else x.forEach(A=>{t.push({minValue:A,maxValue:A,label:c(A,A,v)})});else if("natural-breaks"===e){x=m(x);d=l(x.uniqueValues,d.valueFrequency||x.valueFrequency,h);for(u=1;u<h;u++)x.uniqueValues.length>u&&(C=Number(x.uniqueValues[d[u]].toFixed(6)),t.push({minValue:B,maxValue:C,label:c(B,C,v)}),B=C);t.push({minValue:B,maxValue:q,label:c(B,q,v)})}else if("quantile"===e)if(x.length>=h&&B!==
q){d=Math.ceil(x.length/h);u=0;for(C=1;C<h;C++){var z=d+u-1;z>x.length&&(z=x.length-1);0>z&&(z=0);t.push({minValue:B,maxValue:x[z],label:c(B,x[z],v)});B=x[z];u+=d;d=Math.ceil((x.length-u)/(h-C))}t.push({minValue:B,maxValue:q,label:c(B,q,v)})}else for(q=-1,B=0;B<x.length;B++)d=x[B],d!==q&&(q=d,t.push({minValue:q,maxValue:d,label:c(q,d,v)}),q=d);else if("standard-deviation"===e)if(d=g(x),u=k(x,d),0===u)t.push({minValue:x[0],maxValue:x[0],label:c(x[0],x[0],v)});else{x=n(B,q,h,d,u)*u;u=0;for(C=h;1<=C;C--)z=
Number((d-(C-.5)*x).toFixed(6)),t.push({minValue:B,maxValue:z,label:c(B,z,v)}),B=z,u++;C=Number((d+.5*x).toFixed(6));t.push({minValue:B,maxValue:C,label:c(B,C,v)});B=C;u++;for(z=1;z<=h;z++)C=u===2*h?q:Number((d+(z+.5)*x).toFixed(6)),t.push({minValue:B,maxValue:C,label:c(B,C,v)}),B=C,u++}else if("defined-interval"===e){if(!w)return t;q=x[0];x=x[x.length-1];B=Math.ceil((x-q)/w);d=q;for(u=1;u<B;u++)C=Number((q+u*w).toFixed(6)),t.push({minValue:d,maxValue:C,label:c(d,C,v)}),d=C;t.push({minValue:d,maxValue:x,
label:c(d,x,v)})}return t}function c(d,e,h){let v=null;return v=d===e?h&&"percent-of-total"===h?d+"%":d.toString():h&&"percent-of-total"===h?d+"% - "+e+"%":d+" - "+e}function m(d){const e=[],h=[];let v=Number.MIN_VALUE,w=1,t=-1;for(let x=0;x<d.length;x++){const B=d[x];B===v?(w++,h[t]=w):null!==B&&(e.push(B),v=B,w=1,h.push(w),t++)}return{uniqueValues:e,valueFrequency:h}}function l(d,e,h){var v=d.length;const w=[];h>v&&(h=v);for(var t=0;t<h;t++)w.push(Math.round(t*v/h-1));w.push(v-1);t=r(w,d,e,h);{v=
t.mean;t=t.sdcm;var x=h,B=0,q=0;let C=0,z=0,A=!0;for(let p=0;2>p&&A;p++){0===p&&(A=!1);for(var u=0;u<x-1;u++)for(;w[u+1]+1!==w[u+2];)if(w[u+1]+=1,B=f(u,w,d,e),C=B.sbMean,B=B.sbSdcm,q=f(u+1,w,d,e),z=q.sbMean,q=q.sbSdcm,B+q<t[u]+t[u+1])t[u]=B,t[u+1]=q,v[u]=C,v[u+1]=z,A=!0;else{--w[u+1];break}for(u=x-1;0<u;u--)for(;w[u]!==w[u-1]+1;)if(--w[u],B=f(u-1,w,d,e),C=B.sbMean,B=B.sbSdcm,q=f(u,w,d,e),z=q.sbMean,q=q.sbSdcm,B+q<t[u-1]+t[u])t[u-1]=B,t[u]=q,v[u-1]=C,v[u]=z,A=!0;else{w[u]+=1;break}}v=A}v&&(t=r(w,d,
e,h));return w}function r(d,e,h,v){let w=[];var t=[],x=[];let B=0;const q=[],u=[];for(var C=0;C<v;C++){var z=f(C,d,e,h);q.push(z.sbMean);u.push(z.sbSdcm);B+=u[C]}z=B;for(C=!0;C||B<z;){C=!1;w=[];for(t=0;t<v;t++)w.push(d[t]);for(x=0;x<v;x++)for(z=d[x]+1;z<=d[x+1];z++)if(t=e[z],0<x&&z!==d[x+1]&&Math.abs(t-q[x])>Math.abs(t-q[x-1]))d[x]=z;else if(x<v-1&&d[x]!==z-1&&Math.abs(t-q[x])>Math.abs(t-q[x+1])){d[x+1]=z-1;break}z=B;B=0;t=[];x=[];for(let A=0;A<v;A++){t.push(q[A]);x.push(u[A]);const p=f(A,d,e,h);
q[A]=p.sbMean;u[A]=p.sbSdcm;B+=u[A]}}if(B>z){for(e=0;e<v;e++)d[e]=w[e],q[e]=t[e],u[e]=x[e];B=z}return{mean:q,sdcm:u}}function n(d,e,h,v,w){d=Math.max(v-d,e-v)/w/h;return 1<=d?1:.5<=d?.5:.25}function g(d){let e=0;for(let h=0;h<d.length;h++)e+=d[h];return e/=d.length}function k(d,e){let h=0;for(let v=0;v<d.length;v++){const w=d[v];h+=(w-e)*(w-e)}h/=d.length;return Math.sqrt(h)}function f(d,e,h,v){var w=0,t=0;for(var x=e[d]+1;x<=e[d+1];x++){const B=v[x];w+=h[x]*B;t+=B}0>=t&&console.log("Exception in Natural Breaks calculation");
w/=t;t=0;for(x=e[d]+1;x<=e[d+1];x++)t+=v[x]*(h[x]-w)**2;return{sbMean:w,sbSdcm:t}}a.createGenerateRendererClassBreaks=function(d){const {normalizationTotal:e}=d;return{classBreaks:b(d),normalizationTotal:e}};a.createGenerateRendererUniqueValues=function(d){d=m(d);const e=[],h=d.uniqueValues.length;for(let v=0;v<h;v++){const w=d.uniqueValues[v];e.push({value:w,count:d.valueFrequency[v],label:w.toString()})}return{uniqueValues:e}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/layers/graphics/data/utils":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/jsonMap ../../../core/maybe ../../../core/unitUtils ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../centroid ../featureConversionUtils ../OptimizedGeometry ./projectionSupport".split(" "),function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){function w(P,K,N,M=P.hasZ,L=P.hasM){if(l.isNone(K))return null;
const J=P.hasZ&&M,H=P.hasM&&L;return N?(P=e.quantizeOptimizedGeometry(E,K,P.hasZ,P.hasM,"esriGeometryPoint",N,M,L),e.convertToPoint(P,J,H)):e.convertToPoint(K,J,H)}function t(){t=c._asyncToGenerator(function*(P,K,N){const {outFields:M,orderByFields:L,groupByFieldsForStatistics:J,outStatistics:H}=P;if(M)for(var I=0;I<M.length;I++)M[I]=M[I].trim();if(L)for(I=0;I<L.length;I++)L[I]=L[I].trim();if(J)for(I=0;I<J.length;I++)J[I]=J[I].trim();if(H)for(I=0;I<H.length;I++)H[I].onStatisticField&&(H[I].onStatisticField=
H[I].onStatisticField.trim());P.geometry&&!P.outSR&&(P.outSR=P.geometry.spatialReference);return x(P,K,N)});return t.apply(this,arguments)}function x(P,K,N){return B.apply(this,arguments)}function B(){B=c._asyncToGenerator(function*(P,K,N){if(!P)return null;var {where:M}=P;P.where=M=M&&M.trim();if(!M||/^1 *= *1$/.test(M)||K&&K===M)P.where=null;if(!P.geometry)return P;K=yield q(P);P.distance=0;P.units=null;"esriSpatialRelEnvelopeIntersects"===P.spatialRel&&({spatialReference:M}=P.geometry,K=n.getGeometryExtent(K),
K.spatialReference=M);P.geometry=K;yield v.checkProjectionSupport(K.spatialReference,N);K=(yield k.normalizeCentralMeridian(g.fromJSON(K)))[0];if(l.isNone(K))throw p;K=K.toJSON();K=yield v.project(K,K.spatialReference,N);if(!K)throw p;K.spatialReference=N;P.geometry=K;return P});return B.apply(this,arguments)}function q(P){return u.apply(this,arguments)}function u(){u=c._asyncToGenerator(function*(P){const {geometry:K,distance:N,units:M}=P;if(null==N||"vertexAttributes"in K)return K;var L=K.spatialReference;
P=M?A.fromJSON(M):r.getUnitString(L);L=L&&(f.isGeographic(L)||f.isWebMercator(L))?K:yield v.checkProjectionSupport(L,f.WGS84).then(()=>v.project(K,f.WGS84));return(yield C())(L.spatialReference,L,N,P)});return u.apply(this,arguments)}function C(){return z.apply(this,arguments)}function z(){z=c._asyncToGenerator(function*(){return(yield new Promise((P,K)=>a(["../../../geometry/geometryEngineJSON"],P,K))).geodesicBuffer});return z.apply(this,arguments)}const A=new m.JSONMap({esriSRUnit_Meter:"meters",
esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),p=Object.freeze({}),y=new h,D=new h,E=new h,F={esriGeometryPoint:e.convertToPoint,esriGeometryPolyline:e.convertToPolyline,esriGeometryPolygon:e.convertToPolygon,esriGeometryMultipoint:e.convertToMultipoint},G=(P,K)=>"_geVersion"!==P?K:void 0;b.QUERY_ENGINE_EMPTY_RESULT=p;b.cleanFromGeometryEngine=function(P){return P&&"_geVersion"in
P?JSON.parse(JSON.stringify(P,G)):P};b.getCentroid=function(P,K,N){if("esriGeometryPolygon"!==P.geometryType||!K||!K.centroid&&!K.geometry)return null;K.centroid||(K.centroid=d.getCentroidOptimizedGeometry(new h,K.geometry,P.hasZ,P.hasM));return w(P,K.centroid,N)};b.getGeometry=function(P,K,N,M,L,J,H=K,I=N){const O=K&&H,Q=N&&I;M=l.isSome(M)?"coords"in M?M:M.geometry:null;if(l.isNone(M))return null;if(L)return K=e.generalizeOptimizedGeometry(D,M,K,N,P,L,H,I),J&&(K=e.quantizeOptimizedGeometry(E,K,O,
Q,P,J)),F[P](K,O,Q);if(J)return J=e.quantizeOptimizedGeometry(E,M,K,N,P,J,H,I),F[P](J,O,Q);e.removeZMValues(y,M,K,N,H,I);return F[P](y,O,Q)};b.normalizeQuery=function(P,K,N){return t.apply(this,arguments)};b.normalizeQueryLike=x;b.transformCentroid=w;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./utils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h){function v(){return new Promise((B,q)=>a(["../../../geometry/geometryEngineJSON"],B,q))}function w(){w=c._asyncToGenerator(function*(B,q,u){const {spatialRel:C,geometry:z}=B;if(z){if(!0!==x.spatialRelationship[C])throw new m("feature-store:unsupported-query","Unsupported query spatial relationship",{query:B});if(g.isValid(z.spatialReference)&&g.isValid(u)){if(!0!==x.queryGeometry[n.getJsonType(z)])throw new m("feature-store:unsupported-query","Unsupported query geometry type",
{query:B});if(!0!==x.layerGeometry[q])throw new m("feature-store:unsupported-query","Unsupported layer geometry type",{query:B});if(B.outSR)return e.checkProjectionSupport(B.geometry&&B.geometry.spatialReference,B.outSR)}}});return w.apply(this,arguments)}const t={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",
esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},x={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},
layerGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};b.canQueryWithRBush=function(B){if(n.isExtent(B))return!0;if(n.isPolygon(B)){for(const q of B.rings)if(5!==q.length||q[0][0]!==q[1][0]||q[0][0]!==q[4][0]||q[2][0]!==q[3][0]||q[0][1]!==q[3][1]||q[0][1]!==q[4][1]||q[1][1]!==q[2][1])return!1;return!0}return!1};b.checkSpatialQuerySupport=function(B,q,u){return w.apply(this,arguments)};b.getSpatialQueryOperator=function(B,
q,u,C,z){if(n.isPolygon(q)&&"esriGeometryPoint"===u&&("esriSpatialRelIntersects"===B||"esriSpatialRelContains"===B)){const A=f.convertFromPolygon(new d,q,!1,!1);return Promise.resolve(p=>k.polygonContainsPoint(A,!1,!1,p))}if(n.isPolygon(q)&&"esriGeometryMultipoint"===u){const A=f.convertFromPolygon(new d,q,!1,!1);if("esriSpatialRelContains"===B)return Promise.resolve(p=>k.polygonContainsMultipoint(A,!1,!1,p,C,z))}if(n.isExtent(q)&&"esriGeometryPoint"===u&&("esriSpatialRelIntersects"===B||"esriSpatialRelContains"===
B))return Promise.resolve(A=>l.extentContainsPoint(q,h.getGeometry(u,C,z,A)));if(n.isExtent(q)&&"esriGeometryMultipoint"===u&&"esriSpatialRelContains"===B)return Promise.resolve(A=>l.extentContainsMultipoint(q,h.getGeometry(u,C,z,A)));if(n.isExtent(q)&&"esriSpatialRelIntersects"===B){const A=r.getExtentIntersector(u);return Promise.resolve(p=>A(q,h.getGeometry(u,C,z,p)))}return v().then(A=>{const p=A[t[B]].bind(null,q.spatialReference,q);return y=>p(h.getGeometry(u,C,z,y))})};Object.defineProperties(b,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/intersects":function(){define(["exports","./intersectsBase"],function(a,b){a.extentIntersectsExtent=b.extentIntersectsExtent;a.extentIntersectsMultipoint=b.extentIntersectsMultipoint;a.extentIntersectsPoint=b.extentIntersectsPoint;a.extentIntersectsPolygon=b.extentIntersectsPolygon;a.extentIntersectsPolyline=b.extentIntersectsPolyline;a.extentIntersectsRings=b.extentIntersectsRings;a.getFeatureExtentIntersector=
b.getFeatureExtentIntersector;a.isSelfIntersecting=b.isSelfIntersecting;a.segmentIntersects=b.segmentIntersects;a.getExtentIntersector=function(c){return"mesh"===c?b.extentIntersectsExtent:b.getFeatureExtentIntersector(c)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/contains":function(){define(["exports"],function(a){function b(c,m,l,r,n){if(!c)return!1;m=m?l?4:3:l?3:2;const {coords:g,lengths:k}=c;l=!1;c=0;for(const d of k){var f=
c;for(let e=c,h=c+d*m;e<h;e+=m){f=e+m;f===h&&(f=c);const v=g[e],w=g[e+1],t=g[f];f=g[f+1];(w<n&&f>=n||f<n&&w>=n)&&v+(n-w)/(f-w)*(t-v)<r&&(l=!l)}c+=d*m}return l}a.polygonContainsCoords=b;a.polygonContainsMultipoint=function(c,m,l,r,n,g){n=n?g?4:3:g?3:2;const {coords:k,lengths:f}=r;if(!f)return!1;for(let d=0,e=0;d<f.length;d++,e+=n)if(!b(c,m,l,k[e],k[e+1]))return!1;return!0};a.polygonContainsPoint=function(c,m,l,r){return b(c,m,l,r.coords[0],r.coords[1])};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/data/timeSupport":function(){define(["exports"],function(a){function b(l,r,n,g,k){if(null!=g&&null!=k)return f=>{const d=l.getAttribute(f,r);f=l.getAttribute(f,n);return(null==d||d<=k)&&(null==f||f>=g)};if(null!=g)return f=>{f=l.getAttribute(f,n);return null==f||f>=g};if(null!=k)return f=>{f=l.getAttribute(f,r);return null==f||f<=k}}function c(l,r,n,g){if(null!=n&&null!=g&&n===g)return k=>l.getAttribute(k,r)===n;if(null!=n&&null!=g)return k=>
{k=l.getAttribute(k,r);return k>=n&&k<=g};if(null!=n)return k=>l.getAttribute(k,r)>=n;if(null!=g)return k=>l.getAttribute(k,r)<=g}function m(){return()=>!1}a.getTimeExtent=function(l,r){if(!l)return null;const n=r.featureAdapter,{startTimeField:g,endTimeField:k}=l;let f=Number.POSITIVE_INFINITY,d=Number.NEGATIVE_INFINITY;if(g&&k)r.forEach(e=>{const h=n.getAttribute(e,g);e=n.getAttribute(e,k);null==h||isNaN(h)||(f=Math.min(f,h));null==e||isNaN(e)||(d=Math.max(d,e))});else{const e=g||k;r.forEach(h=>
{h=n.getAttribute(h,e);null==h||isNaN(h)||(f=Math.min(f,h),d=Math.max(d,h))})}return{start:f,end:d}};a.getTimeOperator=function(l,r,n){if(!r||!l)return null;const {startTimeField:g,endTimeField:k}=l;if(!g&&!k)return null;const {start:f,end:d}=r;return null===f&&null===d?null:void 0===f&&void 0===d?m():g&&k?b(n,g,k,f,d):c(n,g||k,f,d)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projectionEllipsoid ../../support/FrustumExtentIntersection ../../../support/Scheduler".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h){c=function(v){function w(){var x=v.apply(this,arguments)||this;x.suspended=!1;x.extent=null;x.extentIntersectionDirty=!0;x._isVisibleBelowSurface=!1;x.handles=new m;x.graphicsCoreOwner=null;x.updating=!0;return x}a._inheritsLoose(w,v);var t=w.prototype;t.setup=function(x){this.graphicsCoreOwner=x;this.extentIntersection=new e.FrustumExtentIntersection({renderCoordsHelper:x.view.renderCoordsHelper});const B=x.view,q=B.basemapTerrain;x=B.resourceController.scheduler;
this.handles.add([B.on("resize",()=>this._viewChange()),l.watch(()=>B.state.camera,()=>this._viewChange(),l.sync),x.registerTask(h.TaskPriority.FRUSTUM_VISIBILITY,this),q.on("elevation-bounds-change",()=>this._elevationBoundsChange())]);"local"===B.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add([l.watch(()=>{var u,C,z;return[q.baseOpacity,q.wireframe,null==(u=B.map)?void 0:null==(C=u.ground)?void 0:null==(z=C.navigationConstraint)?void 0:z.type]},()=>this._updateIsVisibleBelowSurface(),
l.initial)])};t.destroy=function(){this.extentIntersection=this.extent=this.graphicsCoreOwner=null;this.handles&&(this.handles.destroy(),this.handles=null)};t._setDirty=function(){this.updating||this._set("updating",!0)};t.setExtent=function(x){this.extent=x;this.extentIntersectionDirty=!0;this._setDirty()};t._viewChange=function(){this._setDirty()};t._elevationBoundsChange=function(){this._setDirty();this.extentIntersectionDirty=!0};t._updateIsVisibleBelowSurface=function(){const x=this.graphicsCoreOwner.view,
B=x.basemapTerrain,q=x.map.ground&&x.map.ground.navigationConstraint&&"none"===x.map.ground.navigationConstraint.type;this.isVisibleBelowSurface="local"===x.viewingMode||!B.opaque||q};t._updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var x=this.graphicsCoreOwner.view;if(this._isVisibleBelowSurface)var B=-.3*d.getReferenceEllipsoid(x.spatialReference).radius;else{const {min:q,max:u}=x.basemapTerrain.elevationBounds;B=q-Math.max(1,(u-q)*(1.2-1))}this.extentIntersection.update(this.extent,
x.spatialReference,B)}};t.runTask=function(){this._set("updating",!1);if(this.extent){this._updateExtentIntersection();var x=this.graphicsCoreOwner.view.frustum,B=d.getReferenceEllipsoid(this.graphicsCoreOwner.view.spatialReference).radius;this._set("suspended",!this.extentIntersection.isVisibleInFrustum(x,B))}else this._set("suspended",!1)};a._createClass(w,[{key:"isVisibleBelowSurface",set:function(x){this._isVisibleBelowSurface=x;this._setDirty();this.extentIntersectionDirty=!0}},{key:"running",
get:function(){return this.updating}}]);return w}(c);b.__decorate([r.property({readOnly:!0})],c.prototype,"suspended",void 0);b.__decorate([r.property({readOnly:!0})],c.prototype,"updating",void 0);return c=b.__decorate([f.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],c)})},"esri/views/3d/layers/graphics/Graphics3DObjectStates":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/handleUtils","./Graphics3DObjectStateSet"],function(a,
b,c,m){let l=function(){function r(g){this._graphicsCore=g;this._stateSets=[]}var n=r.prototype;n.destroy=function(){this._stateSets&&this._stateSets.forEach(g=>g.objectStateSet.removeAll());this._stateSets=null};n.acquireSet=function(g,k){const f=new m.Graphics3DObjectStateSet(g,k);this._stateSets.push(f);g=c.makeHandle(()=>this.releaseSet(f));return{set:f,handle:g}};n.releaseSet=function(g){g.objectStateSet.removeAll();g=this._stateSets?this._stateSets.indexOf(g):-1;-1!==g&&this._stateSets.splice(g,
1)};n._addObjectStateSet=function(g,k){g.addObjectStateSet(k.stateType,k.objectStateSet)};n._removeObjectStateSet=function(g,k){g.removeObjectState(k.objectStateSet)};n.setUid=function(g,k){g.ids.add(k);(k=this._graphicsCore.graphics3DGraphics.get(k))&&this._addObjectStateSet(k,g)};n.setUids=function(g,k){k.forEach(f=>this.setUid(g,f))};n.setObjectIds=function(g,k){k.forEach(f=>g.ids.add(f));this._initializeSet(g)};n.addGraphic=function(g){this._stateSets.forEach(k=>{!k.paused&&k.hasGraphic(g)&&this._addObjectStateSet(g,
k)})};n.removeGraphic=function(g){this._stateSets.forEach(k=>{k.hasGraphic(g)&&this._removeObjectStateSet(g,k)})};n.allGraphicsDeleted=function(){this._stateSets&&this._stateSets.forEach(g=>g.objectStateSet.removeAll())};n._initializeSet=function(g){const k=this._graphicsCore.graphics3DGraphics;g.objectIdField?k.forEach(f=>{f&&g.hasGraphic(f)&&this._addObjectStateSet(f,g)}):g.ids.forEach(f=>{(f=k.get(f))&&this._addObjectStateSet(f,g)})};b._createClass(r,[{key:"test",get:function(){return{states:this._stateSets}}}]);
return r}();a.Graphics3DObjectStates=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DObjectStateSet":function(){define(["exports","../../webgl-engine/lib/Object3DStateSet"],function(a,b){let c=function(){function m(l,r){this.stateType=l;this.objectIdField=r;this.objectStateSet=new b.Object3DStateSet;this.ids=new Set;this.paused=!1}m.prototype.hasGraphic=function(l){return this.objectIdField?this.ids.has(l.graphic.attributes[this.objectIdField]):
this.ids.has(l.graphic.uid)};return m}();a.Graphics3DObjectStateSet=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Object3DStateSet":function(){define(["exports","./basicInterfaces"],function(a,b){var c;(function(l){l[l.Object=0]="Object";l[l.RenderGeometry=1]="RenderGeometry";l[l.External=2]="External";l[l.COUNT=3]="COUNT"})(c||(c={}));let m=function(){function l(){this.items=[]}var r=l.prototype;r.addObject=function(n,
g){this.items.push({type:c.Object,objectStateId:g,object:n})};r.addRenderGeometry=function(n,g,k){this.items.push({type:c.RenderGeometry,objectStateId:g,renderGeometry:n,owner:k})};r.addExternal=function(n,g){this.items.push({type:c.External,objectStateId:g,remove:n})};r.remove=function(n){for(let g=this.items.length-1;0<=g;--g){const k=this.items[g];k.objectStateId===n&&(this._removeObjectStateItem(k),this.items.splice(g,1))}};r.removeObject=function(n){for(let g=this.items.length-1;0<=g;--g){const k=
this.items[g];k.type===c.Object&&k.object===n&&(this._removeObjectStateItem(k),this.items.splice(g,1))}};r.removeRenderGeometry=function(n){for(let g=this.items.length-1;0<=g;--g){const k=this.items[g];k.type===c.RenderGeometry&&k.renderGeometry===n&&(this._removeObjectStateItem(k),this.items.splice(g,1))}};r.removeAll=function(){this.items.forEach(n=>{this._removeObjectStateItem(n)});this.items=[]};r._removeObjectStateItem=function(n){switch(n.type){case c.Object:n.objectStateId.channel===b.Object3DState.Highlight?
n.object.removeHighlight(n.objectStateId):n.objectStateId.channel===b.Object3DState.MaskOccludee&&n.object.removeOcclude(n.objectStateId);break;case c.RenderGeometry:n.owner.removeRenderGeometryObjectState(n.renderGeometry,n.objectStateId);break;case c.External:n.remove(n.objectStateId)}};return l}();a.Object3DStateSet=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projection ../../../../geometry/support/aaBoundingRect ./enums ../../../support/layerViewUtils ../../../support/Scheduler".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w){c=function(t){function x(){var q=t.apply(this,arguments)||this;q._scaleRangeActive=!1;q.layerScaleRangeVisibilityQuery=!1;q.handles=new m;q.graphicsCoreOwner=null;q.layer=null;q.queryGraphicUIDsInExtent=null;q.extent=null;q.graphicsCore=null;q.basemapTerrain=null;q.layerScaleEnabled=!0;q.suspended=!1;q.updating=!0;return q}a._inheritsLoose(x,t);var B=x.prototype;B.setup=function(q,u,C,z,A){this.graphicsCoreOwner=q;this.layer=u;this.queryGraphicUIDsInExtent=
C;this.graphicsCore=z;this.basemapTerrain=A;this.updateScaleRangeActive();this.handles.add(this.graphicsCoreOwner.view.resourceController.scheduler.registerTask(w.TaskPriority.SCALE_VISIBILITY,this))};B.destroy=function(){this.handles.destroy();this.graphicsCore=this.queryGraphicUIDsInExtent=this.extent=this.graphicsCoreOwner=this.handles=null};B._setDirty=function(){this.updating||this._set("updating",!0)};B.setExtent=function(q){const u=this.graphicsCoreOwner.view.spatialReference,C=this.graphicsCoreOwner.view.basemapTerrain.spatialReference;
if(u===C)this.extent=q;else{const z=e.create();d.projectBoundingRect(q,u,z,C)?this.extent=z:this.extent=null}this._setDirty()};B.scaleRangeActive=function(){return this._scaleRangeActive};B.updateScaleRangeActive=function(){var q=this.layer,u=q.effectiveScaleRange;u=this.layerScaleEnabled&&(0<u.minScale||0<u.maxScale);q.labelingInfo&&!u&&(u=q.labelingInfo.some(C=>C&&(0<C.minScale||0<C.maxScale)));q=this._scaleRangeActive!==u;(this._scaleRangeActive=u)&&!this.handles.has("terrain-events")&&this.basemapTerrain?
(this.handles.add(this.basemapTerrain.on("scale-change",C=>this._scaleUpdateHandler(C)),"terrain-events"),this.layerScaleEnabled&&this.handles.add(this.basemapTerrain.on("tiles-visibility-changed",()=>this._setDirty()),"terrain-events")):!u&&this.handles.has("terrain-events")&&this.handles.remove("terrain-events");return q};B.runTask=function(){const q=this.graphicsCoreOwner.view.basemapTerrain;if(!(this.extent&&q&&q.ready&&this._scaleRangeActive&&this.layerScaleEnabled))this._finishUpdate(!0);else if(!this.layerScaleRangeVisibilityQuery){this.layerScaleRangeVisibilityQuery=
!0;const u=this.layer.effectiveScaleRange;q.queryVisibleScaleRange(this.extent,u.minScale,u.maxScale,C=>this._finishUpdate(C))}};B._finishUpdate=function(q){this.layerScaleRangeVisibilityQuery=!1;this._set("suspended",!q);this._set("updating",!1)};B._visibleAtLayerScale=function(q){const u=this.layer.effectiveScaleRange;return!this.layerScaleEnabled||v.scaleBoundsPredicate(q,u.minScale||0,u.maxScale||0)};B._visibleAtLabelScale=function(q,u){return v.scaleBoundsPredicate(q,u.minScale||0,u.maxScale||
0)};B._graphicScale=function(q){let u;l.isSome(q.centroid)?u=q.centroid:l.isSome(q.graphic.geometry)&&"point"===q.graphic.geometry.type&&(u=q.graphic.geometry);return u?this.graphicsCoreOwner.view.basemapTerrain?this.graphicsCoreOwner.view.basemapTerrain.getScale(u):1:null};B._graphicVisible=function(q){if(!this.layerScaleEnabled)return!0;q=this._graphicScale(q);return this._visibleAtLayerScale(q)};B.updateVisibility=function(q){if(this._scaleRangeActive){const u=this._graphicVisible(q);return q.setVisibilityFlag(h.VisibilityFlag.SCALE_RANGE,
u,h.VisibilityGroup.GRAPHIC)}return!1};B.updateGraphicLabelScaleVisibility=function(q){if(!this._scaleRangeActive||!q.labelGraphics||0===q.labelGraphics.length)return!1;const u=this._graphicScale(q);if(q=this._updateLabelScaleVisibility(q,u))this.graphicsCoreOwner.view.deconflictor.setDirty(),this.graphicsCoreOwner.view.labeler.setDirty();return q};B._updateLabelScaleVisibility=function(q,u){if(!q.labelGraphics||0===q.labelGraphics.length)return!1;const C=q.labelGraphics[0]._labelClass;return C&&
null!=C.minScale&&null!=C.maxScale&&(u=this._visibleAtLabelScale(u,C),q.setVisibilityFlag(h.VisibilityFlag.SCALE_RANGE,u,h.VisibilityGroup.LABEL))?!0:!1};B._scaleUpdateHandler=function(q){this._setDirty();if(!this.graphicsCoreOwner.suspended){var u=q.extent,C=q.scale,z=this._visibleAtLayerScale(C),A=!1;this.queryGraphicUIDsInExtent(u,q.spatialReference,p=>{p=this.graphicsCore.getGraphics3DGraphicById(p);if(!l.isNone(p)){var y=p.centroid;l.isSome(y)&&(u[0]>y.x||u[1]>y.y||u[2]<y.x||u[3]<y.y)||(p.setVisibilityFlag(h.VisibilityFlag.SCALE_RANGE,
z,h.VisibilityGroup.GRAPHIC)&&(A=!0),this._updateLabelScaleVisibility(p,C)&&(A=!0))}});A&&(this.graphicsCoreOwner.view.deconflictor.setDirty(),this.graphicsCoreOwner.view.labeler.setDirty())}};B.layerMinMaxScaleChangeHandler=function(){this.updateScaleRangeActive()&&!this._scaleRangeActive?this.graphicsCore.modifyGraphics3DGraphicVisibilities(q=>q.clearVisibilityFlag(h.VisibilityFlag.SCALE_RANGE)):this._scaleRangeActive&&this.graphicsCore.updateAllGraphicsVisibility();this._setDirty()};a._createClass(x,
[{key:"running",get:function(){return!(!this.graphicsCoreOwner.view.basemapTerrain||!this.updating)}}]);return x}(c);b.__decorate([r.property({constructOnly:!0})],c.prototype,"layerScaleEnabled",void 0);b.__decorate([r.property({readOnly:!0})],c.prototype,"suspended",void 0);b.__decorate([r.property({readOnly:!0})],c.prototype,"updating",void 0);return c=b.__decorate([f.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],c)})},"esri/views/3d/layers/support/attributeUtils":function(){define(["exports"],
function(a){a.attributeLookup=function(b,c,m){if(!m||null==c)return null;if(!b){a:{b=m.toLowerCase();for(var l in c)if(l.toLowerCase()===b){c=c[l];break a}c=null}return c}return(l=b.get(m))?c[l.name]:null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/HeatmapFeatureProcessor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/byteSizeEstimations ../../../../core/Error ../../../../core/HandleOwner ../../../../core/handleUtils ../../../../core/Logger ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/scaleUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/data/FeatureStore ../../../../layers/support/fieldUtils ../../../../renderers/support/heatmapUtils ../interfaces ../../terrain/OverlayRenderer ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/DrapedHeatmapRenderer ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/ModelDirtyTypes ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/HeatmapDensityMaterial".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N,M,L,J,H){const I=g.getLogger("esri.views.3d.layers.support.HeatmapFeatureProcessor");a.HeatmapFeatureProcessor=function(Q){function S(U){U=Q.call(this,U)||this;U.type="heatmap";U.filterVisibility={filterChanged(){},dirty:!1};U.preferredUpdatePolicy=P.UpdatePolicy.ASYNC;U.dataExtent=null;U.drapeSourceType=F.DrapeSourceType.Features;U._renderGeometries=new Map;U._material=new H.HeatmapDensityMaterial({});U._materialWithField=new H.HeatmapDensityMaterial({isAttributeDriven:!0});
U._fieldTotal=0;U._drapeSourceRenderer=null;return U}b._inheritsLoose(S,Q);var T=S.prototype;T.initialize=function(){this._featureStore=new y({geometryType:"esriGeometryPoint",hasZ:this.hasZ,hasM:this.hasM});const {colorBufferFloat:U,textureFloat:aa}=this._renderView.capabilities,{floatBufferBlendWorking:W}=this._renderView.renderingContext.driverTest;if(null==aa||!aa.textureFloat)throw new l("heatmap:missing-texture-float","HeatmapRenderer requires WebGL2 or the WebGL1 extension OES_texture_float.");
if(null==U||!U.textureFloat)throw new l("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL2 extension EXT_color_buffer_float or the WebGL1 extension WEBGL_color_buffer_float.");if(null==U||!U.floatBlend)throw new l("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend.");if(!W)throw new l("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend. This device claims support for it, but does not actually support it.");
this._drapeSourceRenderer=this.view.basemapTerrain.overlayManager.registerDrapeSource(this,K.DrapedHeatmapRenderer,this._rendererParameters);this.updatingHandles.addOnCollectionChange(()=>this._loadedPointGraphics,R=>this._onLoadedFeaturesChange(R),f.initial);this.updatingHandles.addWhen(()=>this._materialParameters,R=>this._forEachMaterial(V=>V.setParameters(R)),f.initial);this.updatingHandles.add(()=>this._rendererParameters,R=>this._drapeSourceRenderer.set(R));this.updatingHandles.add(()=>this._heatmapRendererField,
()=>{this._recreate()},f.sync);this.updatingHandles.add(()=>({fieldName:this._heatmapRendererFieldName,numeric:this._heatmapRendererFieldIsNumeric}),({fieldName:R,numeric:V})=>{if(k.isSome(R)&&V){let da=0;this._featureStore.forEach(ca=>{var ha;return da+=null!=(ha=ca.attributes[R])?ha:0});this._fieldTotal=da}else this._fieldTotal=this._featureStore.numFeatures},f.initial);this.handles.add([f.watch(()=>({fieldName:this._heatmapRendererFieldName,field:this._heatmapRendererField}),({fieldName:R,field:V})=>
{if(R&&!V){var da;I.warn(`Heatmap renderer field '${R}' for layer '${null!=(da=this.layer.title)?da:this.layer.id}' not found`)}}),f.watch(()=>({field:this._heatmapRendererField,numeric:this._heatmapRendererFieldIsNumeric}),({field:R,numeric:V})=>{if(k.isSome(R)&&!V){var da;I.warn(`Heatmap renderer field '${R.name}' for layer '${null!=(da=this.layer.title)?da:this.layer.id}' does not contain numeric values and cannot be used to drive the heatmap density`)}}),n.makeHandle(()=>this.view.basemapTerrain.overlayManager.unregisterDrapeSource(this))])};
T.destroy=function(){this._renderGeometries.clear();this._material=k.disposeMaybe(this._material);this._materialWithField=k.disposeMaybe(this._materialWithField);this._featureStore.clear();this._featureStore=null};T.whenGraphicBounds=function(){var U=b._asyncToGenerator(function*(){return null});return function(){return U.apply(this,arguments)}}();T.computeAttachmentOrigin=function(){return null};T.highlight=function(){return O};T.maskOccludee=function(){return O};T.setObjectIdVisibility=function(){};
T.setup=function(){var U=b._asyncToGenerator(function*(){});return function(){return U.apply(this,arguments)}}();T._onLoadedFeaturesChange=function(U){if(this._featuresArePoints){var {objectIdField:aa}=this.layer;this._featureStore.removeManyById(U.removed.map(R=>C.getObjectId(R,aa)));this._featureStore.addMany(U.added.map(R=>new A.OptimizedFeature(z.convertFromPoint(new p,R.geometry),R.attributes,k.applySome(R.centroid,V=>z.convertFromPoint(new p,V)),C.getObjectId(R,aa))));var W=U.added;U=U.removed;
this._fieldTotal+=this._computeFieldTotalChange(W,U);U=k.mapSome(U,({uid:R})=>{const V=this._renderGeometries.get(R);this._renderGeometries.delete(R);return V});W=W.map(R=>{const V=this._pointGraphicToRenderGeometry(R);this._renderGeometries.set(R.uid,V);return V});0<U.length&&this._drapeSourceRenderer.removeGeometries(U,M.ModelDirty.Geometry.REMOVE);0<W.length&&this._drapeSourceRenderer.addGeometries(W,M.ModelDirty.Geometry.ADD);(0<W.length||0<U.length)&&this._renderView.requestRender()}};T._recreate=
function(){if(this._loadedPointGraphics){var U=this._loadedPointGraphics.toArray();this._onLoadedFeaturesChange({added:U,removed:U})}};T._pointGraphicToRenderGeometry=function(U){const aa=this._heatmapRendererFieldName,W=k.isSome(aa)?this._materialWithField:this._material,R=B.create();q.projectPointToVector(U.geometry,R,this._overlaySpatialReference);R[2]=G.DRAPED_Z;const V=[[J.VertexAttribute.POSITION,{data:R,size:R.length}]],da=this._heatmapRendererFieldIsNumeric;if(k.isSome(aa)){var ca;V.push([J.VertexAttribute.FEATUREATTRIBUTE,
{data:[da?null!=(ca=U.attributes[aa])?ca:0:0],size:1}])}U=new L.RenderGeometry(new N.Geometry(V,null,P.PrimitiveType.Point),W,{layerUid:this.layer.uid,graphicUid:U.uid});x.copy(U.boundingSphere,R);return U};T._forEachMaterial=function(U){U(this._material);U(this._materialWithField)};T._computeFieldTotalChange=function(U,aa){if(k.isNone(this._heatmapRendererFieldName)||!this._heatmapRendererFieldIsNumeric)return U.length-aa.length;const W=this._heatmapRendererFieldName,R=(V,da)=>{var ca;return V+(null!=
(ca=da.attributes[W])?ca:0)};return U.reduce(R,0)-aa.reduce(R,0)};T._clampSearchRadius=function(U){112<U&&I.warnOnce("SceneView supports a maximum radius of 112 pt for HeatmapRenderer.");return Math.min(U,112)};b._createClass(S,[{key:"layer",get:function(){return this.owner.layer}},{key:"featureStore",get:function(){return this._featureStore}},{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"updatingRemaining",get:function(){return 0}},{key:"suspendInfo",get:function(){return{}}},
{key:"legendEnabled",get:function(){return!0}},{key:"displayFeatureLimit",get:function(){var U,aa,W,R,V,da;const ca=null!=(U=null==(aa=this.owner)?void 0:null==(W=aa.view)?void 0:null==(R=W.resourceController)?void 0:null==(V=R.memoryController)?void 0:V.memoryFactor)?U:1;var ha=(U=null==(ha=this.owner)?void 0:null==(da=ha.view)?void 0:da.qualitySettings)?Math.ceil(U.heatmap.maxTotalNumberOfFeatures*ca):0;return{minimumTotalNumberOfFeatures:0,maximumTotalNumberOfFeatures:ha,maximumTotalNumberOfPrimitives:2*
ha,maximumNumberOfFeatures:ha}}},{key:"hasZ",get:function(){return"hasZ"in this.layer&&this.layer.hasZ}},{key:"hasM",get:function(){return"hasM"in this.layer&&this.layer.hasM}},{key:"view",get:function(){return this.owner.view}},{key:"fullOpacity",get:function(){return this.owner.fullOpacity}},{key:"updatePolicy",get:function(){return this.owner.updatePolicy}},{key:"scaleVisibilitySuspended",get:function(){return!1}},{key:"usedMemory",get:function(){var U,aa,W,R,V;const da=this.usedMemoryPerFeature*
this._featureStore.numFeatures,{R32F:ca}=null==(U=this._renderView)?void 0:null==(aa=U.capabilities)?void 0:aa.colorBufferFloat;U=null!=ca?1:4;aa=null!=(W=Math.ceil((null==(R=this._overlayRenderer)?NaN:null==(V=R.overlays[0])?NaN:V.resolution)*this._densityMapPixelRatio))?W:0;W=aa*aa*U*4;R=k.isSome(this._heatmapRenderer)?d.pt2px(Math.min(this._heatmapRenderer.radius,112)):0;return W+da+R*U*4}},{key:"usedMemoryPerFeature",get:function(){if(0===this._featureStore.numFeatures)return 0;let U=0;this._featureStore.forEach(V=>
U+=m.estimateAttributesObjectSize(V.attributes));U/=this._featureStore.numFeatures;const aa=m.estimateNumberByteSize(),W=6*m.estimateFixedArraySize([0,0,0],aa),R=6*m.estimateFixedArraySize([0,0],aa);return W+R+(this._heatmapRendererFieldIsNumeric?6*aa:0)+U}},{key:"unprocessedMemoryEstimate",get:function(){return 0}},{key:"performanceInfo",get:function(){return{core:{visible:this._featureStore.numFeatures,missing:0,pending:0},elevationUpdating:!1,visibilityFrustum:!0,visibilityScale:!0}}},{key:"_overlayRenderer",
get:function(){return this.view.basemapTerrain.overlayManager.renderer}},{key:"_overlaySpatialReference",get:function(){return k.unwrap(this._overlayRenderer.spatialReference)}},{key:"_rendererParameters",get:function(){return{...this._radiusParameter,...this._densityParameters,...this._colorRampParameter,...this._pixelRatioParameter}}},{key:"_materialParameters",get:function(){return{...this._radiusParameter,...this._resolutionForScaleParameter}}},{key:"_densityParameters",get:function(){const U=
this._heatmapRenderer;if(k.isNone(U))return null;const {minDensity:aa,maxDensity:W}=U;return{minDensity:aa,maxDensity:W,fieldTotal:this._fieldTotal}}},{key:"_radiusParameter",get:function(){return k.applySome(this._heatmapRenderer,({radius:U})=>({searchRadius:d.pt2px(this._clampSearchRadius(U))}))}},{key:"_resolutionForScaleParameter",get:function(){return k.applySome(this._heatmapRenderer,({referenceScale:U})=>({resolutionForScale:0===U?0:u.getResolutionForScale(U,this.view.spatialReference)}))}},
{key:"_colorRampParameter",get:function(){return k.applySome(this._heatmapRenderer,U=>({colorRampData:E.generateGradient(U.colorStops)}))}},{key:"_pixelRatioParameter",get:function(){return{pixelRatio:this._densityMapPixelRatio}}},{key:"_densityMapPixelRatio",get:function(){var U,aa,W,R,V,da,ca,ha;const ia=null!=(U=null==(aa=this.owner)?void 0:null==(W=aa.view)?void 0:null==(R=W.resourceController)?void 0:null==(V=R.memoryController)?void 0:V.memoryFactor)?U:1;return(null!=(da=null==(ca=this.owner)?
void 0:null==(ha=ca.view)?void 0:ha.qualitySettings.heatmap.pixelRatio)?da:1)*Math.sqrt(ia)}},{key:"_renderView",get:function(){return this.view._stage.renderView}},{key:"_featuresArePoints",get:function(){return"point"===this.layer.geometryType}},{key:"_loadedPointGraphics",get:function(){return this.owner.loadedGraphics}},{key:"_heatmapRenderer",get:function(){const U=this.layer.renderer;return"heatmap"===(null==U?void 0:U.type)?U:null}},{key:"_heatmapRendererFieldName",get:function(){return k.applySome(this._heatmapRenderer,
U=>U.field)}},{key:"_heatmapRendererField",get:function(){return k.applySome(this._heatmapRendererFieldName,U=>this.layer.fieldsIndex.get(U))}},{key:"_heatmapRendererFieldIsNumeric",get:function(){const U=this._heatmapRendererField;return k.isNone(U)?!1:D.isNumericField(U)}}]);return S}(r.HandleOwner);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"type",void 0);c.__decorate([e.property({constructOnly:!0})],a.HeatmapFeatureProcessor.prototype,"owner",void 0);c.__decorate([e.property()],
a.HeatmapFeatureProcessor.prototype,"layer",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"featureStore",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"updating",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"updatingRemaining",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"suspendInfo",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"legendEnabled",null);c.__decorate([e.property()],
a.HeatmapFeatureProcessor.prototype,"filterVisibility",void 0);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"displayFeatureLimit",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"preferredUpdatePolicy",void 0);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"hasZ",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"hasM",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"dataExtent",void 0);c.__decorate([e.property()],
a.HeatmapFeatureProcessor.prototype,"view",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"fullOpacity",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"updatePolicy",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"drapeSourceType",void 0);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_featureStore",void 0);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_overlayRenderer",null);c.__decorate([e.property()],
a.HeatmapFeatureProcessor.prototype,"_overlaySpatialReference",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_rendererParameters",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_materialParameters",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_densityParameters",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_radiusParameter",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_resolutionForScaleParameter",
null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_colorRampParameter",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_pixelRatioParameter",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_densityMapPixelRatio",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_renderGeometries",void 0);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_material",void 0);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,
"_materialWithField",void 0);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_renderView",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_featuresArePoints",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_loadedPointGraphics",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRenderer",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRendererFieldName",null);c.__decorate([e.property()],
a.HeatmapFeatureProcessor.prototype,"_heatmapRendererField",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRendererFieldIsNumeric",null);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_fieldTotal",void 0);c.__decorate([e.property()],a.HeatmapFeatureProcessor.prototype,"_drapeSourceRenderer",void 0);a.HeatmapFeatureProcessor=c.__decorate([t.subclass("esri.views.3d.layers.support.HeatmapFeatureProcessor")],a.HeatmapFeatureProcessor);const O=n.makeHandle();
a.MAX_RADIUS_PT=112;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/data/FeatureStore":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../core/Evented ../../../core/Logger ../../../core/maybe ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../featureConversionUtils ./BoundsStore ./optimizedFeatureQueryEngineAdapter".split(" "),function(a,b,c,m,l,r,n,g,k,f){return function(){function d(h){this.geometryInfo=
h;this._boundsStore=new k.BoundsStore;this._featuresById=new Map;this._markedIds=new Set;this.events=new c;this.featureAdapter=f.optimizedFeatureQueryEngineAdapter}var e=d.prototype;e.add=function(h){this._add(h);this._emitChanged()};e.addMany=function(h){for(const v of h)this._add(v);this._emitChanged()};e.clear=function(){this._featuresById.clear();this._boundsStore.clear();this._emitChanged()};e.removeById=function(h){h=this._featuresById.get(h);if(!h)return null;this._remove(h);this._emitChanged();
return h};e.removeManyById=function(h){this._boundsStore.invalidateIndex();for(const v of h)(h=this._featuresById.get(v))&&this._remove(h);this._emitChanged()};e.forEachBounds=function(h,v,w){for(const t of h)(h=this._boundsStore.get(t.objectId))&&v(r.fromRect(w,h))};e.getFeature=function(h){return this._featuresById.get(h)};e.has=function(h){return this._featuresById.has(h)};e.toArray=function(){return Array.from(this._featuresById.values())};e.forEach=function(h){this._featuresById.forEach(v=>h(v))};
e.forEachInBounds=function(h,v){this._boundsStore.forEachInBounds(h,w=>{v(this._featuresById.get(w))})};e.startMarkingUsedFeatures=function(){this._boundsStore.invalidateIndex();this._markedIds.clear()};e.sweep=function(){let h=!1;this._featuresById.forEach((v,w)=>{this._markedIds.has(w)||(h=!0,this._remove(v))});this._markedIds.clear();h&&this._emitChanged()};e._emitChanged=function(){this.events.emit("changed",void 0)};e._add=function(h){if(h){var v=h.objectId;if(null==v)m.getLogger("esri.layers.graphics.data.FeatureStore").error(new b("featurestore:invalid-feature",
"feature id is missing",{feature:h}));else{var w=this._featuresById.get(v);this._markedIds.add(v);if(w){h.displayId=w.displayId;var t=this._boundsStore.get(v);this._boundsStore.delete(v)}else if(l.isSome(this.onFeatureAdd))this.onFeatureAdd(h);!l.isNone(h.geometry)&&h.geometry.coords&&h.geometry.coords.length?(t=g.getBoundsOptimizedGeometry(l.isSome(t)?t:n.create(),h.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),l.isSome(t)&&this._boundsStore.set(v,t)):this._boundsStore.set(v,null);this._featuresById.set(v,
h)}}};e._remove=function(h){if(l.isSome(this.onFeatureRemove))this.onFeatureRemove(h);this._markedIds.delete(h.objectId);this._boundsStore.delete(h.objectId);this._featuresById.delete(h.objectId);return h};a._createClass(d,[{key:"geometryType",get:function(){return this.geometryInfo.geometryType}},{key:"hasM",get:function(){return this.geometryInfo.hasM}},{key:"hasZ",get:function(){return this.geometryInfo.hasZ}},{key:"numFeatures",get:function(){return this._featuresById.size}},{key:"fullBounds",
get:function(){return this._boundsStore.fullBounds}},{key:"storeStatistics",get:function(){let h=0;this._featuresById.forEach(v=>{l.isSome(v.geometry)&&v.geometry.coords&&(h+=v.geometry.coords.length)});return{featureCount:this._featuresById.size,vertexCount:h/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}}]);return d}()})},"esri/layers/graphics/data/BoundsStore":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/has","../../../core/libs/rbush/PooledRBush","../../../geometry/support/aaBoundingRect"],
function(a,b,c,m,l){function r(k,f,d){n.minX=f[0];n.minY=f[1];n.maxX=f[2];n.maxY=f[3];k.search(n,d)}const n={minX:0,minY:0,maxX:0,maxY:0};let g=function(){function k(){this._indexInvalid=!1;this._boundsToLoad=[];this._boundsById=new Map;this._idByBounds=new Map;this._index=new m.PooledRBush(9,c("esri-csp-restrictions")?d=>({minX:d[0],minY:d[1],maxX:d[2],maxY:d[3]}):["[0]","[1]","[2]","[3]"]);this._loadIndex=()=>{if(this._indexInvalid){const d=Array(this._idByBounds.size);let e=0;this._idByBounds.forEach((h,
v)=>{d[e++]=v});this._indexInvalid=!1;this._index.clear();this._index.load(d)}else this._boundsToLoad.length&&(this._index.load(this._boundsToLoad.filter(d=>this._idByBounds.has(d))),this._boundsToLoad.length=0)}}var f=k.prototype;f.clear=function(){this._indexInvalid=!1;this._boundsToLoad.length=0;this._boundsById.clear();this._idByBounds.clear();this._index.clear()};f.delete=function(d){const e=this._boundsById.get(d);this._boundsById.delete(d);e&&(this._idByBounds.delete(e),this._indexInvalid||
this._index.remove(e))};f.forEachInBounds=function(d,e){this._loadIndex();r(this._index,d,h=>e(this._idByBounds.get(h)))};f.get=function(d){return this._boundsById.get(d)};f.has=function(d){return this._boundsById.has(d)};f.invalidateIndex=function(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)};f.set=function(d,e){if(!this._indexInvalid){const h=this._boundsById.get(d);h&&(this._index.remove(h),this._idByBounds.delete(h))}this._boundsById.set(d,e);e&&(this._idByBounds.set(e,
d),this._indexInvalid||(this._boundsToLoad.push(e),5E4<this._boundsToLoad.length&&this._loadIndex()))};b._createClass(k,[{key:"fullBounds",get:function(){if(!this._boundsById.size)return null;const d=l.empty();for(const e of this._boundsById.values())e&&(d[0]=Math.min(e[0],d[0]),d[1]=Math.min(e[1],d[1]),d[2]=Math.max(e[2],d[2]),d[3]=Math.max(e[3],d[3]));return d}},{key:"valid",get:function(){return!this._indexInvalid}}]);return k}();a.BoundsStore=g;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/DrapedHeatmapRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../ViewingMode ../core/shaderTechnique/ShaderTechniqueConfiguration ./glUtil3D ./SortedRenderGeometryRenderer ../shaders/HeatmapTechnique ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q){a.DrapedHeatmapRenderer=function(u){function C(A){A=u.call(this,A)||this;A.pixelRatio=1;A._colorRampData=new Uint8ClampedArray(4);A.type="draped-heatmap";A._heatmapParameters=new w.HeatmapPassParameters;return A}b._inheritsLoose(C,u);var z=C.prototype;z.initialize=function(){var A={colorTarget:t.TargetType.TEXTURE,depthStencilTarget:t.DepthStencilTargetType.NONE,width:0,height:0},{capabilities:p}=this.rctx,{R32F:y}=p.colorBufferFloat;({textureFloatLinear:p}=
p.textureFloat);y=null!=y;this._densityMap=new x.FramebufferObject(this.rctx,A,{target:t.TextureType.TEXTURE_2D,pixelFormat:y?t.PixelFormat.RED:t.PixelFormat.RGBA,internalFormat:y?t.SizedPixelFormat.R32F:t.PixelFormat.RGBA,dataType:t.PixelType.FLOAT,samplingMode:p?t.TextureSamplingMode.LINEAR:t.TextureSamplingMode.NEAREST,wrapMode:t.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0});this._quad=h.createQuadVAO(this.rctx);A=this._colorRampData;this._colorRamp=new B.Texture(this.rctx,{target:t.TextureType.TEXTURE_2D,
pixelFormat:t.PixelFormat.RGBA,dataType:t.PixelType.UNSIGNED_BYTE,samplingMode:t.TextureSamplingMode.LINEAR,wrapMode:t.TextureWrapMode.CLAMP_TO_EDGE,width:A.length/4,height:1},A);this._technique=new w.HeatmapTechnique({rctx:this.rctx,viewingMode:d.ViewingMode.Local},new e.ShaderTechniqueConfiguration);this._heatmapParameters.densityMap=this._densityMap.colorTexture;this.own(l.watch(()=>[this.colorRampData,this.minDensity,this.maxDensity,this.fieldTotal,this.pixelRatio,this.searchRadius],()=>this.rendererContext.notifyContentChanged()))};
z.destroy=function(){this._technique=m.releaseMaybe(this._technique);this._densityMap=m.disposeMaybe(this._densityMap);this._quad=m.disposeMaybe(this._quad);this._colorRamp=m.disposeMaybe(this._colorRamp)};z.render=function(A,p){const y=this._sortedMaterialRenderers,D=y.length;if(!(1>D)){var E=this.rctx.getBoundFramebufferObject(),F=this.rctx.getViewport(),{pixelRatio:G}=this,P=Math.ceil(F.width*G);G=Math.ceil(F.height*G);this._densityMap.resize(P,G);this.rctx.bindFramebuffer(this._densityMap);this.rctx.setViewport(0,
0,P,G);this.rctx.clear(t.ClearBufferBit.COLOR_BUFFER_BIT);P=!1;for(G=0;G<D;G++){const K=y.getItemAt(G);K.material.shouldRender(A)&&(P=P||K.materialRenderer.render(A.pass,p))}this.rctx.bindFramebuffer(E);this.rctx.setViewport(F.x,F.y,F.width,F.height);P&&(this.rctx.bindVAO(this._quad),this.rctx.useProgram(this._technique.program),this._technique.bindPipelineState(this.rctx),this._technique.bindPass(this._heatmapParameters,A.bindParameters),this.rctx.drawArrays(this._technique.primitiveType,0,q.vertexCount(this._quad,
"geometry")))}};b._createClass(C,[{key:"searchRadius",get:function(){return this._heatmapParameters.searchRadius},set:function(A){A!==this._heatmapParameters.searchRadius&&(this._heatmapParameters.searchRadius=A,this.notifyChange("searchRadius"))}},{key:"minDensity",get:function(){return this._heatmapParameters.minDensity},set:function(A){A!==this._heatmapParameters.minDensity&&(this._heatmapParameters.minDensity=A,this.notifyChange("minDensity"))}},{key:"maxDensity",get:function(){return this._heatmapParameters.maxDensity},
set:function(A){A!==this._heatmapParameters.maxDensity&&(this._heatmapParameters.maxDensity=A,this.notifyChange("maxDensity"))}},{key:"fieldTotal",get:function(){return this._heatmapParameters.fieldTotal},set:function(A){this._heatmapParameters.fieldTotal=A;this.notifyChange("fieldTotal")}},{key:"colorRampData",get:function(){return this._colorRampData},set:function(A){const {colorRamp:p}=this._heatmapParameters;if(m.isSome(p)&&A!==this._colorRampData){const y=A.length/4;y!==p.descriptor.width&&p.resize(y,
1);p.setData(A)}this._colorRampData=A}},{key:"_colorRamp",get:function(){return this._heatmapParameters.colorRamp},set:function(A){this._heatmapParameters.colorRamp=A}},{key:"hasHighlights",get:function(){return!1}},{key:"hasWater",get:function(){return!1}},{key:"rendersOccluded",get:function(){return!1}}]);return C}(v.SortedRenderGeometryRenderer);c.__decorate([r.property()],a.DrapedHeatmapRenderer.prototype,"searchRadius",null);c.__decorate([r.property()],a.DrapedHeatmapRenderer.prototype,"minDensity",
null);c.__decorate([r.property()],a.DrapedHeatmapRenderer.prototype,"maxDensity",null);c.__decorate([r.property()],a.DrapedHeatmapRenderer.prototype,"fieldTotal",null);c.__decorate([r.property()],a.DrapedHeatmapRenderer.prototype,"pixelRatio",void 0);c.__decorate([r.property()],a.DrapedHeatmapRenderer.prototype,"colorRampData",null);c.__decorate([r.property()],a.DrapedHeatmapRenderer.prototype,"_colorRampData",void 0);a.DrapedHeatmapRenderer=c.__decorate([f.subclass("esri.views.3d.webgl-engine.lib.DrapedHeatmapRenderer")],
a.DrapedHeatmapRenderer);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/HeatmapTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderModules/interfaces ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../../../../chunks/Heatmap.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e){m=function(h){function v(){var w=h.apply(this,arguments)||this;w.colorRamp=null;w.densityMap=null;w.searchRadius=1;w.fieldTotal=0;w.minDensity=0;w.maxDensity=100;return w}c._inheritsLoose(v,h);return v}(m.NoParameters);r=function(h){function v(t,x){var B;return B=h.call(this,t,x,()=>B.destroy())||this}c._inheritsLoose(v,h);var w=v.prototype;w.initializeProgram=function(t){const x=v.shader.get().build();return new k.Program(t.rctx,x,n.Default3D)};w.initializePipeline=
function(){return e.makePipelineState({blending:g.blendingDefault,colorWrite:e.defaultColorWriteParams,depthTest:null,depthWrite:null})};c._createClass(v,[{key:"primitiveType",get:function(){return d.PrimitiveType.TRIANGLE_STRIP}}]);return v}(r.ShaderTechnique);r.shader=new l.ReloadableShaderModule(f.HeatmapShader,()=>new Promise((h,v)=>a(["./Heatmap.glsl"],h,v)));b.HeatmapPassParameters=m;b.HeatmapTechnique=r;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/chunks/Heatmap.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/util/DiscardOrAdjustAlphaBlend.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),function(a,b,c,m,l,r,n){function g(){const f=new r.ShaderBuilder;
f.include(b.ScreenSpacePass);f.include(c.DiscardOrAdjustAlphaBlend);f.fragment.uniforms.add([new n.Texture2DPassUniform("densityMap",d=>d.densityMap),new n.Texture2DPassUniform("tex",d=>d.colorRamp),new m.FloatPassUniform("densityNormalizer",d=>1/(d.maxDensity-d.minDensity)),new m.FloatPassUniform("minDensity",d=>d.minDensity)]);f.fragment.uniforms.add(new m.FloatPassUniform("densityMultiplier",d=>3/(d.searchRadius*d.searchRadius*Math.PI)));f.fragment.code.add(l.glsl`void main() {
float density = texture2D(densityMap, uv).r * densityMultiplier;
float densityRatio = (density - minDensity) * densityNormalizer;
vec4 color = texture2D(tex, vec2(clamp(densityRatio, 0.0, 1.0), 0.5));
discardOrAdjustAlpha(color);
gl_FragColor = color;
}`);return f}const k=Object.freeze(Object.defineProperty({__proto__:null,build:g},Symbol.toStringTag,{value:"Module"}));a.HeatmapShader=k;a.build=g})},"esri/views/3d/webgl-engine/materials/HeatmapDensityMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../core/libs/gl-matrix-2/types/vec2 ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/RenderPass ../lib/RenderSlot ../lib/VertexAttribute ./internal/bufferWriterUtils ../shaders/HeatmapDensityTechnique".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){let w=function(z){function A(){var p=z.apply(this,arguments)||this;p.isAttributeDriven=!1;return p}b._inheritsLoose(A,z);return A}(v.HeatmapDensityPassParameters),t=function(z){function A(y){y=z.call(this,y,new w)||this;y._techniqueConfig=new v.HeatmapDensityTechniqueConfiguration;return y}b._inheritsLoose(A,z);var p=A.prototype;p.requiresSlot=function(y,D){return y===d.RenderSlot.DRAPED_MATERIAL&&D===f.RenderPass.MATERIAL};p.getConfiguration=function(){this._techniqueConfig.isAttributeDriven=
this.parameters.isAttributeDriven;return this._techniqueConfig};p.createGLMaterial=function(y){return new x(y)};p.intersect=function(y,D,E,F,G,P,K,N,M){if(!c.isNone(M)&&r.isVec2(P))for(D=y.vertexAttributes.get(e.VertexAttribute.POSITION),{parameters:E}=this,{searchRadius:E}=E,{screenToWorldRatio:y}=y,y=E*y+2*y,y*=y,E=D.data.length/D.size,F=0;F<E;F++)G=F*D.size,G=m.set(C,D.data[G],D.data[G+1]),m.squaredDistance(G,P)<y&&K(M.dist,M.normal,-1,!1)};p.createBufferWriter=function(){return new B(this.parameters.isAttributeDriven?
u:q)};return A}(k.Material),x=function(z){function A(){return z.apply(this,arguments)||this}b._inheritsLoose(A,z);A.prototype.beginSlot=function(p){return this.ensureTechnique(v.HeatmapDensityTechnique,p)};return A}(g),B=function(){function z(p){this.vertexBufferLayout=p}var A=z.prototype;A.allocate=function(p){return this.vertexBufferLayout.createBuffer(p)};A.elementCount=function(p){return 6*p.indices.get(e.VertexAttribute.POSITION).length};A.write=function(p,y,D,E){h.writePosition(y.indices.get(e.VertexAttribute.POSITION),
y.vertexAttributes.get(e.VertexAttribute.POSITION).data,p.transformation,D.position,E,6);p=y.indices.get(e.VertexAttribute.POSITION).length;const F=D.uv0;let G=E;for(let P=0;P<p;++P)F.setValues(G++,-1,-1),F.setValues(G++,1,-1),F.setValues(G++,1,1),F.setValues(G++,1,1),F.setValues(G++,-1,1),F.setValues(G++,-1,-1);(D="featureAttribute"in D?D.featureAttribute:null)&&h.writeBufferFloat(y.indices.get(e.VertexAttribute.FEATUREATTRIBUTE),y.vertexAttributes.get(e.VertexAttribute.FEATUREATTRIBUTE).data,D,
E,6)};return z}();const q=n.newLayout().vec3f(e.VertexAttribute.POSITION).vec2f(e.VertexAttribute.UV0),u=q.clone().f32(e.VertexAttribute.FEATUREATTRIBUTE),C=l.create();Object.defineProperty(a,"RadiusMode",{enumerable:!0,get:()=>v.RadiusMode});a.HeatmapDensityMaterial=t;a.HeatmapDensityMaterialParameters=w;a.isHeatMapDensityMaterial=function(z){return z instanceof t};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/HeatmapDensityTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Material ../lib/Program ../materials/DefaultTechniqueConfiguration ../../../../chunks/HeatmapDensity.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){b.RadiusMode=void 0;(function(w){w[w.Screen=0]="Screen";w[w.World=1]="World"})(b.RadiusMode||(b.RadiusMode={}));k=function(w){function t(){var x=w.apply(this,arguments)||this;x.searchRadius=128;x.resolutionForScale=0;return x}c._inheritsLoose(t,w);return t}(k.MaterialParameters);r=function(w){function t(){return w.apply(this,arguments)||this}c._inheritsLoose(t,w);var x=t.prototype;x.initializeProgram=function(B){const q=t.shader.get().build(this.configuration);
return new f.Program(B.rctx,q,g.Default3D)};x.initializePipeline=function(){return v.makePipelineState({blending:v.simpleBlendingParams(h.BlendFactor.ONE,h.BlendFactor.ONE,h.BlendOperation.ADD),colorWrite:v.defaultColorWriteParams,depthTest:null,depthWrite:null})};x.destroy=function(){w.prototype.destroy.call(this)};return t}(r.ShaderTechnique);r.shader=new l.ReloadableShaderModule(e.HeatmapDensity,()=>new Promise((w,t)=>a(["./HeatmapDensity.glsl"],w,t)));l=function(w){function t(){var x=w.apply(this,
arguments)||this;x.isAttributeDriven=!1;return x}c._inheritsLoose(t,w);return t}(d.DefaultTechniqueConfiguration);m.__decorate([n.parameter()],l.prototype,"isAttributeDriven",void 0);b.HeatmapDensityPassParameters=k;b.HeatmapDensityTechnique=r;b.HeatmapDensityTechniqueConfiguration=l;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/HeatmapDensity.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,m,l,r){function n(k){const f=new l.ShaderBuilder;b.addProjViewLocalOrigin(f,k);({isAttributeDriven:k}=k);f.attributes.add(r.VertexAttribute.POSITION,"vec3");f.attributes.add(r.VertexAttribute.UV0,"vec2");k&&(f.attributes.add(r.VertexAttribute.FEATUREATTRIBUTE,"float"),f.varyings.add("attributeValue","float"));f.varyings.add("unitCirclePos","vec2");f.vertex.uniforms.add(new c.FloatPassUniform("radius",({resolutionForScale:d,searchRadius:e},{camera:h,screenToWorldRatio:v})=>2*e*(0===
d?1:d/v)*h.pixelRatio/h.fullViewport[2]));f.vertex.code.add(m.glsl`
    void main() {
      unitCirclePos = uv0;

      vec4 posProj = proj * (view * vec4(${r.VertexAttribute.POSITION}, 1.0));
      vec4 quadOffset = vec4(unitCirclePos * radius, 0.0, 0.0);

      ${k?m.glsl`attributeValue = ${r.VertexAttribute.FEATUREATTRIBUTE};`:""}
      gl_Position = posProj + quadOffset;
    }
  `);f.fragment.code.add(m.glsl`
    void main() {
      float radiusRatioSquared = dot(unitCirclePos, unitCirclePos);
      if (radiusRatioSquared > 1.0) {
        discard;
      }

      float oneMinusRadiusRatioSquared = 1.0 - radiusRatioSquared;
      float density = oneMinusRadiusRatioSquared * oneMinusRadiusRatioSquared ${k?m.glsl` * attributeValue`:""};
      gl_FragColor = vec4(density);
    }
  `);return f}const g=Object.freeze(Object.defineProperty({__proto__:null,build:n},Symbol.toStringTag,{value:"Module"}));a.HeatmapDensity=g;a.build=n})},"esri/views/3d/layers/support/projectExtentUtils":function(){define(["exports","../../../../core/maybe","../../../../geometry/support/webMercatorUtils","../../../../portal/support/geometryServiceUtils"],function(a,b,c,m){a.toViewIfLocal=function(l){const r=l.view.spatialReference,n=l.layer.fullExtent;var g=b.isSome(n)&&n.spatialReference;if(b.isNone(n)||
!g)return Promise.resolve(null);if(g.equals(r))return Promise.resolve(n.clone());g=c.project(n,r);return b.isSome(g)?Promise.resolve(g):l.view.state.isLocal?m.projectGeometry(n,r,l.layer.portalItem).then(k=>!l.destroyed&&k?k:void 0).catch(()=>null):Promise.resolve(null)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/FeatureTileFetcher3DLayerViewContext":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/maybe","./FeatureTileFetcher3D","./featureTileQuery3D"],function(a,b,c,m,l){let r=function(){function n(k){this._capabilities=this._memoryCache=null;const f=k.layerView.layer;this.layerView=k.layerView;this.objectIdField=f.objectIdField;this.globalIdField="globalIdField"in f?f.globalIdField:null;this.returnZ=k.returnZ;this.returnM=k.returnM;const d=this.layerView.view.resourceController;this.query=l.createFeatureTileQuery3D(f,e=>d.schedule(e));d&&this.memoryCacheEnabled&&(this._memoryCache=
d.memoryController.newCache(f.uid))}var g=n.prototype;g.destroy=function(){this._memoryCache=c.destroyMaybe(this._memoryCache);this.query.destroy()};g.createQuery=function(){const k=this.layerView.layer.createQuery();k.outFields=this.layerView.availableFields;k.returnZ=this.returnZ;k.returnM=this.returnM;k.outSpatialReference=this.tilingScheme.spatialReference;return k};g.logFetchError=function(k,f){k.error("#fetchTile()",this.layerView.layer,f&&f.message?f.message:f)};b._createClass(n,[{key:"memoryCacheEnabled",
get:function(){switch(this.layerView.layer.source.type){case "feature-layer":case "ogc-feature":return!0;case "csv":case "geojson":case "memory":case "wfs":return!1}}},{key:"memoryCache",get:function(){return this._memoryCache}},{key:"viewingMode",get:function(){return this.layerView.view.state.viewingMode}},{key:"tilingScheme",get:function(){return this.layerView.view.featureTiles.tilingScheme}},{key:"scheduler",get:function(){const k=this.layerView.view.resourceController;return k?k.scheduler:null}},
{key:"geometryType",get:function(){return this.layerView.layer.geometryType}},{key:"fullExtent",get:function(){return this.layerView.layer.fullExtent}},{key:"tileMaxRecordCount",get:function(){return this.layerView.layer.capabilities.query.tileMaxRecordCount}},{key:"maxRecordCount",get:function(){return this.layerView.layer.capabilities.query.maxRecordCount}},{key:"capabilities",get:function(){return c.isSome(this._capabilities)?this._capabilities:this._capabilities=m.contextCapabilitiesFromLayer(this.layerView.layer)}}]);
return n}();a.FeatureTileFetcher3DLayerViewContext=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/featureTileQuery3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/dehydratedFeatures ../../../../rest/query/operations/query ../../support/PBFDecoder".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v){let w=function(q){function u(z){return q.call(this,z)||this}b._inheritsLoose(u,q);var C=u.prototype;C.queryFeatureCount=function(z,A){return this.layer.queryFeatureCount(z,A)};C.destroy=function(){this._decoder=l.destroyMaybe(this._decoder)};C._createRequestOptions=function(z){return{...z,query:{...this.layer.customParameters,token:this.layer.apiKey,...null==z?void 0:z.query}}};b._createClass(u,[{key:"queryFeaturesDehydrated",get:function(){var z=this.layer.capabilities;
if((z=z&&z.query)&&z.supportsFormatPBF){var A,p;l.isNone(this._decoder)&&(this._decoder=new v.PBFDecoder(this.schedule));const y={sourceSpatialReference:null!=(A=null==(p=this.layer.spatialReference)?void 0:p.toJSON())?A:null,applyTransform:!0,maxStringAttributeLength:1024};return(D,E)=>h.runQuery(this.layer.parsedUrl,D,"pbf",this._createRequestOptions(E)).then(F=>{r.throwIfAborted(E);return l.isSome(this._decoder)?this._decoder.invoke({buffer:F.data,options:y},E.signal):Promise.reject(r.createAbortError())})}return(y,
D)=>h.executeQuery(this.layer.parsedUrl,y,this.layer.spatialReference,this._createRequestOptions(D)).then(E=>e.fromFeatureSetJSON(E.data))}}]);return u}(m);c.__decorate([n.property({constructOnly:!0})],w.prototype,"layer",void 0);c.__decorate([n.property({constructOnly:!0})],w.prototype,"schedule",void 0);c.__decorate([n.property({readOnly:!0})],w.prototype,"queryFeaturesDehydrated",null);w=c.__decorate([d.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],w);let t=
function(q){function u(z){return q.call(this,z)||this}b._inheritsLoose(u,q);var C=u.prototype;C.queryFeaturesDehydrated=function(z,A){return this.layer.queryFeatures(z,A)};C.queryFeatureCount=function(z,A){return this.layer.queryFeatureCount(z,A)};return u}(m);c.__decorate([n.property({constructOnly:!0})],t.prototype,"layer",void 0);c.__decorate([n.property({readOnly:!0})],t.prototype,"queryFeaturesDehydrated",null);t=c.__decorate([d.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceMeshQuery3D")],
t);let x=function(q){function u(C){return q.call(this,C)||this}b._inheritsLoose(u,q);u.prototype.queryFeaturesDehydrated=function(C,z){return this.layer.queryFeatures(C,z)};return u}(m);c.__decorate([n.property({constructOnly:!0})],x.prototype,"layer",void 0);x=c.__decorate([d.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],x);let B=function(q){function u(z){return q.call(this,z)||this}b._inheritsLoose(u,q);var C=u.prototype;C.queryFeaturesDehydrated=function(z,
A){return this.source.queryFeaturesJSON(z,A).then(e.fromFeatureSetJSON,p=>{if(p&&"query-features-json:unsupported"===p.name)return this.layer.queryFeatures(z,A);throw p;})};C.queryFeatureCount=function(z,A){return this.layer.queryFeatureCount(z,A)};return u}(m);c.__decorate([n.property({constructOnly:!0})],B.prototype,"layer",void 0);c.__decorate([n.property({constructOnly:!0})],B.prototype,"source",void 0);B=c.__decorate([d.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],
B);a.createFeatureTileQuery3D=function(q,u){return"feature"===q.type&&"feature-layer"===q.source.type?l.isSome(q.infoFor3D)?new t({layer:q}):new w({layer:q,schedule:u}):"feature"===q.type&&"memory"===q.source.type||"csv"===q.type||"geojson"===q.type||"wfs"===q.type?new B({layer:q,source:q.source}):"ogc-feature"===q.type?new x({layer:q}):null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/PBFDecoder":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Graphic ../../../core/maybe ../../../core/workers/WorkerHandle ../../../geometry/SpatialReference ../../../layers/support/Field".split(" "),
function(a,b,c,m,l,r,n){let g=function(){function f(e){this._schedule=e;this._handle=new k(e)}var d=f.prototype;d.destroy=function(){this._handle.destroy()};d.invoke=function(e,h){if(!e.buffer||0===e.buffer.byteLength)return Promise.resolve(null);e.options.sourceSpatialReference&&e.options.sourceSpatialReference instanceof r&&(e.options={...e.options,sourceSpatialReference:e.options.sourceSpatialReference.toJSON()});return this._handle.invoke(e,h).then(v=>this._schedule(()=>{v.spatialReference=r.fromJSON(v.spatialReference);
if(v.fields)for(var w=0;w<v.fields.length;w++)v.fields[w]=n.fromJSON(v.fields[w]);w=v.spatialReference;for(const t of v.features)t.uid=c.generateUID(),m.isSome(t.geometry)&&(t.geometry.spatialReference=w);return v}))};return f}(),k=function(f){function d(e){return f.call(this,"PBFDecoderWorker","_parseFeatureQuery",{_parseFeatureQuery:h=>[h.buffer]},e)||this}b._inheritsLoose(d,f);return d}(l.WorkerHandle);a.PBFDecoder=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/support/EventedSet":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/ObservableChangesType","../../../core/SetUtils"],function(a,b,c,m,l){c=function(r){function n(){var k=r.apply(this,arguments)||this;k._set=new Set;return k}b._inheritsLoose(n,r);var g=n.prototype;g.clear=function(){if(0<this._set.size){const k=this.toArray();this._set.clear();this.emit("after-changes",{type:m.ObservableChangesType.REMOVE});this.emit("change",
{added:[],removed:k})}};g.addMany=function(k){if(0!==k.length){for(const f of k)this._set.add(f);this.emit("after-changes",{type:m.ObservableChangesType.ADD});this.emit("change",{added:k,removed:[]})}};g.remove=function(k){this._set.delete(k)&&(this.emit("after-changes",{type:m.ObservableChangesType.REMOVE}),this.emit("change",{added:[],removed:[k]}))};g.removeMany=function(k){const f=[];for(const d of k)this._set.delete(d)&&f.push(d);0<f.length&&(this.emit("after-changes",{type:m.ObservableChangesType.REMOVE}),
this.emit("change",{added:[],removed:f}))};g.toArray=function(){return[...this._set]};g.find=function(k){let f;l.someSet(this._set,d=>k(d)?(f=d,!0):!1);return f};g.forEach=function(k){this._set.forEach(f=>k(f))};b._createClass(n,[{key:"length",get:function(){return this._set.size}}]);return n}(c);a.EventedSet=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/layers/FeatureLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/deprecate ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/FeatureEffect ../../layers/support/FeatureFilter ../../layers/support/fieldUtils ../../layers/support/floorFilterUtils ../../rest/support/Query ../../support/arcadeOnDemand ./support/popupUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C){const z=l.getLogger("esri.views.layers.FeatureLayerView");return A=>{A=function(p){function y(...E){E=p.call(this,...E)||this;E._updatingRequiredFieldsPromise=null;E.filter=null;E.timeExtent=null;E.layer=null;E.requiredFields=[];E.view=null;return E}a._inheritsLoose(y,p);var D=y.prototype;D.initialize=function(){this.handles.add([g.watch(()=>{var E;const F=this.layer;return[null==F?void 0:null==(E=F.elevationInfo)?void 0:E.featureExpressionInfo,
null==F?void 0:F.displayField,null==F?void 0:F.timeInfo,F&&"renderer"in F&&F.renderer,F&&"labelingInfo"in F&&F.labelingInfo,F&&"floorInfo"in F&&F.floorInfo,this.filter,this.featureEffect,this.timeExtent]},()=>this._handleRequiredFieldsChange(),g.syncAndInitial),g.on(()=>{var E;return null==(E=this.view)?void 0:E.floors},"change",()=>this._handleRequiredFieldsChange()),g.on(()=>{const E=this.layer;return E&&"sublayers"in E&&E.sublayers},"change",()=>this._handleRequiredFieldsChange())])};D.highlight=
function(E){throw Error("missing implementation");};D.createQuery=function(){var E={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};E=r.isSome(this.filter)?this.filter.createQuery(E):new q(E);if("feature"===this.layer.type){const F=B.getFloorFilterClause(this);r.isSome(F)&&(E.where=E.where?`(${E.where}) AND (${F})`:F)}r.isSome(this.timeExtent)&&(E.timeExtent=r.isSome(E.timeExtent)?E.timeExtent.intersection(this.timeExtent):this.timeExtent.clone());return E};D.queryFeatures=
function(E,F){throw Error("missing implementation");};D.queryObjectIds=function(E,F){throw Error("missing implementation");};D.queryFeatureCount=function(E,F){throw Error("missing implementation");};D.queryExtent=function(E,F){throw Error("missing implementation");};D.fetchPopupFeatures=function(){var E=a._asyncToGenerator(function*(F,G){if(F=this.validateFetchPopupFeatures(G))throw F;return this.fetchClientPopupFeatures(G)});return function(F,G){return E.apply(this,arguments)}}();D._loadArcadeModules=
function(E){if(E.get("expressionInfos.length")||Array.isArray(E.content)&&E.content.some(F=>"expression"===F.type))return u.loadArcade()};D._handleRequiredFieldsChange=function(){const E=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",E);E.then(()=>{this._updatingRequiredFieldsPromise===E&&this._set("_updatingRequiredFieldsPromise",null)})};D._updateRequiredFields=function(){var E=a._asyncToGenerator(function*(){if(this.layer&&this.view){var F="3d"===this.view.type,{layer:G,
layer:{fieldsIndex:P,objectIdField:K}}=this,N="renderer"in G&&G.renderer,M="orderBy"in G&&G.orderBy,L=G.featureReduction,J=new Set;N=yield n.eachAlways([N?N.collectRequiredFields(J,P):null,x.collectLabelingFields(J,G),F?x.collectElevationFields(J,G):null,r.isSome(this.filter)?x.collectFilterFields(J,G,this.filter):null,r.isSome(this.featureEffect)?x.collectFilterFields(J,G,this.featureEffect.filter):null,L?x.collectFeatureReductionFields(J,G,L):null,M?x.collectOrderByInfos(J,G,M):null]);G.timeInfo&&
this.timeExtent&&x.collectFields(J,G.fieldsIndex,[G.timeInfo.startField,G.timeInfo.endField]);"feature"===G.type&&G.floorInfo&&x.collectFields(J,G.fieldsIndex,[G.floorInfo.floorField]);"subtype-group"===G.type&&(x.collectField(J,P,G.subtypeField),M=G.sublayers.map(H=>{var I;return Promise.all([null==(I=H.renderer)?void 0:I.collectRequiredFields(J,P),x.collectLabelingFields(J,H)])}),yield n.eachAlways(M));for(const H of N)H.error&&z.error(H.error);x.collectField(J,P,K);F&&"displayField"in G&&G.displayField&&
x.collectField(J,P,G.displayField);F=Array.from(J).sort();this._set("requiredFields",F)}});return function(){return E.apply(this,arguments)}}();D.validateFetchPopupFeatures=function(E){if(r.isNone(E))return null;for(const F of E.clientGraphics){const G=F.layer;if("popupEnabled"in G&&!G.popupEnabled)return new m("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:G});if(F.isAggregate){if(!(G.featureReduction&&"popupTemplate"in G.featureReduction&&G.featureReduction.popupEnabled&&G.featureReduction.popupTemplate))return new m("featurelayerview:fetchPopupFeatures",
"Popups are disabled",{layer:G})}else if("popupTemplate"in G&&!C.getFetchPopupTemplate(G,E))return new m("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:G})}};D.fetchClientPopupFeatures=function(){var E=a._asyncToGenerator(function*(F){const G=r.isSome(F)?F.clientGraphics:null;if(!G||0===G.length)return[];const P=Array(G.length),K=new Map,N=yield this.createPopupQuery(F);for(let L=0;L<G.length;L++){const J=G[L];if(J.isAggregate){P[L]=J;continue}var {layer:M}=
J;if(!("popupEnabled"in M))continue;const H=x.unpackFieldNames(this.layer.fieldsIndex,N.outFields);M=C.getFetchPopupTemplate(M,F);if(r.isNone(M))continue;const I=yield this._loadArcadeModules(M);I&&I.arcadeUtils.hasGeometryOperations(M)||!x.featureHasFields(H,J)?K.set(J.getObjectId(),L):P[L]=J}if("stream"===this.layer.type||0===K.size)return P.filter(Boolean);N.objectIds=Array.from(K.keys());try{const L=yield this.layer.queryFeatures(N);for(const J of L.features){const H=K.get(J.getObjectId());P[H]=
J}}catch{}return P.filter(Boolean)});return function(F){return E.apply(this,arguments)}}();D.createPopupQuery=function(){var E=a._asyncToGenerator(function*(F){const G=this.layer.createQuery(),P=new Set;var K=!1,N=r.isSome(F)&&F.clientGraphics?F.clientGraphics.map(M=>M.layer):[this.layer];for(const M of N)if("popupEnabled"in M&&(N=C.getFetchPopupTemplate(M,F),!r.isNone(N))){K=(K=yield this._loadArcadeModules(N))&&K.arcadeUtils.hasGeometryOperations(N);K=!("point"!==this.layer.geometryType&&!K);N=
yield C.getRequiredFields(this.layer,N);for(const L of N)P.add(L)}G.returnGeometry=K;G.returnZ=K;G.returnM=K;G.outFields=Array.from(P);G.outSpatialReference=this.view.spatialReference;"feature"===this.layer.type&&(F=B.getFloorFilterClause(this),r.isSome(F)&&(G.where=G.where?`(${G.where}) AND (${F})`:F));return G});return function(F){return E.apply(this,arguments)}}();D.canResume=function(){return!p.prototype.canResume.call(this)||r.isSome(this.timeExtent)&&this.timeExtent.isEmpty?!1:!0};a._createClass(y,
[{key:"availableFields",get:function(){const {layer:E,layer:{fieldsIndex:F},requiredFields:G}=this;return"outFields"in E&&E.outFields?x.fixFields(F,[...x.unpackFieldNames(F,E.outFields),...G]):x.fixFields(F,G)}},{key:"effect",get:function(){c.deprecatedProperty(z,"effect",{replacement:"featureEffect",version:"4.22"});return this.featureEffect},set:function(E){c.deprecatedProperty(z,"effect",{replacement:"featureEffect",version:"4.22"});this.featureEffect=E}},{key:"featureEffect",get:function(){return this.layer&&
"featureEffect"in this.layer?this.layer.featureEffect:null},set:function(E){void 0===E?this._clearOverride("featureEffect"):this._override("featureEffect",E)}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(E){z.error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}}]);return y}(A);b.__decorate([k.property()],A.prototype,"_updatingRequiredFieldsPromise",void 0);b.__decorate([k.property({readOnly:!0})],
A.prototype,"availableFields",null);b.__decorate([k.property()],A.prototype,"effect",null);b.__decorate([k.property({type:w})],A.prototype,"featureEffect",null);b.__decorate([k.property({type:t})],A.prototype,"filter",void 0);b.__decorate([k.property(v.combinedViewLayerTimeExtentProperty)],A.prototype,"timeExtent",void 0);b.__decorate([k.property()],A.prototype,"layer",void 0);b.__decorate([k.property({type:Number})],A.prototype,"maximumNumberOfFeatures",null);b.__decorate([k.property({readOnly:!0,
type:Boolean})],A.prototype,"maximumNumberOfFeaturesExceeded",null);b.__decorate([k.property({readOnly:!0})],A.prototype,"requiredFields",void 0);b.__decorate([k.property()],A.prototype,"suspended",void 0);b.__decorate([k.property()],A.prototype,"view",void 0);return A=b.__decorate([h.subclass("esri.views.layers.FeatureLayerView")],A)}})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../layers/support/fieldUtils"],
function(a,b,c,m){function l(){l=b._asyncToGenerator(function*(r,n=r.popupTemplate){if(c.isNone(n))return[];const g=yield n.getRequiredFields(r.fieldsIndex);({lastEditInfoEnabled:n}=n);const {objectIdField:k,typeIdField:f,globalIdField:d,relationships:e}=r;if(g.includes("*"))return["*"];n=n?yield m.getFeatureEditFields(r):[];const h=m.fixFields(r.fieldsIndex,[...g,...n]);f&&h.push(f);h&&k&&r.fieldsIndex.has(k)&&!h.includes(k)&&h.push(k);h&&d&&r.fieldsIndex.has(d)&&!h.includes(d)&&h.push(d);e&&e.forEach(v=>
{({keyField:v}=v);h&&v&&r.fieldsIndex.has(v)&&!h.includes(v)&&h.push(v)});return h});return l.apply(this,arguments)}a.getFetchPopupTemplate=function(r,n){return r.popupTemplate?r.popupTemplate:c.isSome(n)&&n.defaultPopupTemplateEnabled&&c.isSome(r.defaultPopupTemplate)?r.defaultPopupTemplate:null};a.getRequiredFields=function(r){return l.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,m,l,r,n,g,k,f){return d=>{d=function(e){function h(){return e.apply(this,arguments)||this}a._inheritsLoose(h,e);h.prototype.initialize=function(){this.handles.add(l.on(()=>this.layer,"refresh",v=>{this.doRefresh(v.dataChanged).catch(w=>{m.isAbortError(w)||c.getLogger(this.declaredClass).error(w)})}),"RefreshableLayerView")};return h}(d);b.__decorate([r.property()],d.prototype,"layer",void 0);return d=b.__decorate([f.subclass("esri.layers.mixins.RefreshableLayerView")],d)}})},"esri/views/3d/layers/PointCloudLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/asyncUtils ../../../core/Collection ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/screenUtils ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/plane ../../../layers/graphics/dehydratedFeatures ../../../layers/support/CodedValue ../../../layers/support/CodedValueDomain ../../../layers/support/Domain ../../../layers/support/InheritedDomain ../../../layers/support/RangeDomain ../../../layers/support/fieldUtils ../../../layers/support/PromiseQueue ../../../symbols/support/unitConversionUtils ./LayerView3D ./PointCloudWorkerHandle ./i3s/I3SUtil ./i3s/LoDUtil ./i3s/PagedNodeIndex ./i3s/PointCloudRendererUtil ./i3s/PointCloudWorkerUtil ./i3s/PointGraphic ./i3s/PointRenderer ./support/PopupSceneLayerView ../support/extentUtils ../support/index ../support/orientedBoundingBox ../support/updatingProperties ../webgl-engine/lib/RenderSlot ../../layers/LayerView ../../support/layerViewUtils ../../support/Scheduler".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N,M,L,J,H,I,O,Q,S,T,U,aa,W,R,V,da,ca,ha){const ia=l.getLogger("esri.views.3d.layers.PointCloudLayerView3D"),ka=z.create();l=function(Y){function ea(){var Z=Y.apply(this,arguments)||this;Z.type="point-cloud-3d";Z.maximumPointCount=4E6;Z.slicePlaneEnabled=!1;Z._renderer=null;Z._rendererAdded=!1;Z._renderedNodes=new Set;Z._nodeScales=new Map;Z._updateViewNeeded=!0;Z._lodFactor=1;Z._maxLoggedBoxWarnings=5;Z._pageMultiplier=1;Z._nodeLoadEpoch=
0;Z._indexQueue=[];Z._workQueue=[];Z._idleQueue=new P.PromiseQueue;Z._indexPagesLoading=new Map;Z._loadingNodes=new Map;Z._recalcWork=!0;Z._layerIsVisible=!1;Z._codedDomainPopulationPromise=null;Z._codedDomainPopulationAbortController=null;Z._totalWork=0;Z._index=null;Z._loadingInitNodePage=!1;Z._nodeIdArray=[];return Z}a._inheritsLoose(ea,Y);var ba=ea.prototype;ba.initialize=function(){const Z=this.view.resourceController;this._worker=new M.PointCloudWorkerHandle(oa=>Z.schedule(oa));this.addResolvingPromise(this._worker.promise);
this._tmpPoint=A.makeDehydratedPoint(0,0,0,this.layer.spatialReference);L.checkPointCloudLayerValid(this.layer);L.checkPointCloudLayerCompatibleWithView(this.layer,this.view);this._indexRequester=Z.createStreamDataRequester(aa.ClientType.I3S_INDEX);this._dataRequester=Z.createStreamDataRequester(aa.ClientType.I3S_DATA);this._initRenderer();const fa=this._initNodePages(),ja=this.view.resourceController.memoryController;this._memCache=ja.newCache(this.layer.uid);this.updatingHandles.add(()=>this._clippingBox,
()=>this._setUpdateViewNeeded(),g.initial);this.updatingHandles.add(()=>this._elevationOffset,()=>this._elevationOffsetChanged(),g.initial);this.updatingHandles.add(()=>this.layer.renderer,()=>this._rendererChanged(),g.initial);this.updatingHandles.add(()=>this.layer.filters,()=>this._reload(),g.initial);this.updatingHandles.add(()=>this.layer.outFields,()=>this._reload(),g.initial);this.updatingHandles.add(()=>this.layer.effectiveScaleRange,()=>this._setUpdateViewNeeded());this.updatingHandles.add(()=>
this.view.state.contentCamera,()=>this._setUpdateViewNeeded());this.handles.add([this.view.basemapTerrain.on("scale-change",oa=>this._scaleUpdateHandler(oa)),g.watch(()=>ja.memoryFactor,()=>this._setUpdateViewNeeded(),g.sync)]);this.addResolvingPromise(fa);this.when(()=>{this.handles.add([Z.scheduler.registerTask(ha.TaskPriority.POINT_CLOUD_LAYER,this),Z.scheduler.registerIdleStateCallbacks(()=>this._idleBegin(),()=>this._idleEnd()),this.updatingHandles.add(()=>this.suspended,oa=>{oa?this._clearNodeState():
this._setUpdateViewNeeded()},g.initial)])},()=>{this.updatingHandles.removeAll();this.handles.removeAll()})};ba._setUpdateViewNeeded=function(){this._updateViewNeeded=!0;this._updateLoading()};ba.destroy=function(){this.cancelLoading();this._worker&&(this._worker.destroy(),this._worker=null);this._destroyRenderer();this._memCache.destroy();this._memCache=null;this._codedDomainPopulationAbortController&&(this._codedDomainPopulationAbortController.abort(),this._codedDomainPopulationAbortController=
null);this._codedDomainPopulationPromise=null};ba._initRenderer=function(){this._renderer=new S.PointRenderer({createGraphic:(Z,fa,ja)=>this._createGraphic(Z,fa,ja)});this._renderer.layerUid=this.layer.uid;this.updatingHandles.add(()=>this._clippingBox,Z=>this._renderer.clippingBox=Z,g.initial);this.updatingHandles.add(()=>this.suspended,Z=>this._setPointsVisible(!Z),g.initial);this.updatingHandles.add(()=>this.pointScale,Z=>this._renderer.scaleFactor=Z,g.initial);this._renderer.minSizePx=Math.sqrt(2);
this.updatingHandles.add(()=>this.useRealWorldSymbolSizes,Z=>this._renderer.useRealWorldSymbolSizes=Z,g.initial);this.updatingHandles.add(()=>this.pointSize,Z=>{const fa=k.pt2px(Z);this._renderer.size=Z;this._renderer.sizePx=fa},g.initial);this.updatingHandles.add(()=>this.slicePlaneEnabled,Z=>this._renderer.slicePlaneEnabled=Z,g.initial);this.updatingHandles.add(()=>this.inverseDensity,()=>this._setUpdateViewNeeded(),g.initial);this.updatingHandles.add(()=>this.maximumPointCount,()=>this._setUpdateViewNeeded(),
g.initial);this.updatingHandles.add(()=>this.view.qualitySettings.sceneService.pointCloud.lodFactor,Z=>{this._lodFactor=Z;this._setUpdateViewNeeded()},g.initial)};ba._destroyRenderer=function(){this._renderer.removeAll();this._setPointsVisible(!1)};ba._createGraphic=function(Z,fa,ja){const oa=r.isSome(Z.pointIdFilterMap)?Z.pointIdFilterMap[fa]:fa;ja=this.view.computeMapPointFromVec3d(ja);const sa=this._createGraphicAttributes(Z,oa);return new Q.PointGraphic({pointCloudMetadata:{nodeId:Z.id,pointIndexInNode:fa,
attributePointIndexInNode:oa,epoch:this._nodeLoadEpoch},geometry:ja,attributes:sa,layer:this.layer,sourceLayer:this.layer})};ba._createGraphicAttributes=function(Z,fa){const ja={};for(const oa of Z.attributes)this._encodeGraphicAttribute(oa.attributeInfo,oa.values,fa,ja);return ja};ba._encodeGraphicAttribute=function(Z,fa,ja,oa){var sa=Z.storageInfo&&Z.storageInfo.attributeValues;const qa=sa?sa.valuesPerElement:1;if(1===qa)oa[Z.name]=fa[ja];else if("UInt8"===sa.valueType&&4>=qa){sa=0;ja*=qa;for(let Ha=
ja;Ha<ja+qa;Ha++)sa=(sa<<8)+fa[Ha];oa[Z.name]=sa}else oa[Z.name]=void 0};ba._setPointsVisible=function(Z){Z&&!this._rendererAdded?(this.view._stage.addRenderPlugin([V.RenderSlot.OPAQUE_MATERIAL],this._renderer),this._rendererAdded=!0):!Z&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)};ba._rendererChanged=function(){this._renderer.useFixedSizes=I.rendererUsesFixedSizes(this.layer.renderer);this._reload()};ba._reload=function(){this._clearNodeState();
this._memCache.clear();this._setUpdateViewNeeded()};ba._elevationOffsetChanged=function(){this._clearNodeState();this._memCache.clear();this._initNodePages()};ba._scaleUpdateHandler=function(Z){const fa=this.layer.effectiveScaleRange;ca.isScaleRangeActive(fa.minScale,fa.maxScale)?q.projectBoundingRect(Z.extent,Z.spatialReference,la,this.layer.spatialReference)&&(this._nodeScales.forEach((ja,oa)=>{this._renderedNodes.has(oa)?(ja=this._index.getNode(oa),C.containsPoint(la,ja.obb.center)&&this._nodeScales.set(oa,
Z.scale)):this._nodeScales.delete(oa)}),this._setUpdateViewNeeded()):this._nodeScales.clear()};ba._displayNodes=function(Z){this._workQueue=J.nodeDiff([...this._renderedNodes],Z,this._index);J.sortFrontToBack(this._workQueue,this.view.state.contentCamera.viewForward,this._index);J.splitWorkEntries(this._workQueue,8,this._index);this._updateQueues();this._totalWork=this._computeWork();this._updateLoading();this._layerIsVisible=0<Z.length||this._loadingInitNodePage;this.notifyChange("suspended")};ba.cancelLoading=
function(){this._cancelNodeLoading();this._cancelIndexLoading()};ba._cancelNodeLoading=function(){const Z=[];this._loadingNodes.forEach(({abortController:fa})=>Z.push(fa));this._loadingNodes.clear();for(const fa of Z)fa.abort();this._workQueue=[];this._idleQueue.cancelAll();this._totalWork=this._computeWork();this._updateLoading()};ba._updateQueues=function(){const Z=new Set;this._workQueue.forEach(oa=>oa.load.forEach(sa=>Z.add(sa)));const fa=[],ja=new Map;this._loadingNodes.forEach((oa,sa)=>{Z.has(sa)?
ja.set(sa,oa):fa.push(oa)});this._loadingNodes=ja;for(const {abortController:oa}of fa)oa.abort();this._workQueue=this._workQueue.filter(oa=>{for(const sa of oa.load)if(this._loadingNodes.has(sa))return this._recalcWork=!0,!1;return!0});this._totalWork=this._computeWork();this._updateLoading()};ba._cancelIndexLoading=function(){this._indexQueue=[];this._indexPagesLoading.forEach(({abortController:Z})=>Z.abort());this._indexPagesLoading.clear();this._totalWork=this._computeWork();this._updateLoading()};
ba._clearNodeState=function(){this._nodeLoadEpoch++;this._renderedNodes.forEach(Z=>this._removeFromRenderer(Z));this._cancelNodeLoading()};ba._idleBegin=function(){this._setUpdateViewNeeded()};ba._idleEnd=function(){this._setUpdateViewNeeded()};ba.runTask=function(Z){if(this.suspended)this._updateViewNeeded&&(this._updateViewNeeded=!1,Z=this._isRootNodeVisible(),Z!==this._layerIsVisible&&(this._layerIsVisible=Z,this.notifyChange("suspended")),this._updateLoading());else{for(Z.run(()=>this._updateWorkQueues());0<
this._indexQueue.length&&Z.run(()=>this._processIndexQueue()););this._processWorkQueue(Z);this._idleQueue.runTask(Z)}};ba._processIndexQueue=function(){const Z=this._indexQueue.shift(),fa=this._loadNodePage(Z);this._indexPagesLoading.set(Z,fa);fa.promise.then(ja=>{this._index.addPage(Z,ja,this._elevationOffset);this._setUpdateViewNeeded()}).then(()=>{this._indexPagesLoading.delete(Z)},()=>{this._indexPagesLoading.delete(Z)});return!0};ba._processWorkQueue=function(Z){for(;!Z.done;){const fa=this._scheduleWorkEntry();
if(r.isNone(fa))break;this._processWorkEntry(fa);Z.madeProgress()}};ba._scheduleWorkEntry=function(){let Z=this._workQueue.length;for(;Z--;){const fa=this._workQueue.shift();if(fa.remove.find(ja=>!this._renderedNodes.has(ja)))this._workQueue.push(fa);else return fa}return null};ba._processWorkEntry=function(Z){if(0===Z.load.length)for(const fa of Z.remove)this._removeFromRenderer(fa);else Promise.all(Z.load.map(fa=>{const ja=new AbortController,oa=this._memCache.pop(fa.toString());r.isSome(oa)?this._loadingNodes.set(fa,
{abortController:ja,promise:Promise.resolve(oa)}):this._loadingNodes.has(fa)||this._loadingNodes.set(fa,{abortController:ja,promise:this._loadNode(fa,ja.signal)});return this._loadingNodes.get(fa).promise})).then(fa=>{for(let ja=0;ja<Z.load.length;ja++)if(fa[ja]){const oa=this._setupRendererData(Z.load[ja],fa[ja]);this._addToRenderer(oa)}for(const ja of Z.remove)this._removeFromRenderer(ja)}).catch(()=>{}).then(()=>{for(const fa of Z.load)this._loadingNodes.delete(fa);this._updateLoading();this._recalcWork&&
!this._idleQueue.running&&0===this._indexQueue.length&&0===this._loadingNodes.size&&(this._recalcWork=!1,this._setUpdateViewNeeded())}),this._updateLoading()};ba._populateClassCodeCodedDomain=function(){var Z=a._asyncToGenerator(function*(fa,ja){const oa=this.layer.fieldsIndex.get("CLASS_CODE");oa&&!oa.domain&&fa.includes(oa.name)&&(fa=yield c.result(this.layer.queryCachedStatistics("CLASS_CODE",{signal:ja})),!1!==fa.ok&&(fa=(fa=fa.value)&&fa.labels&&fa.labels.labels)&&Array.isArray(fa)&&(oa.domain=
new y({name:"CLASS_CODE",codedValues:fa.map(sa=>new p.CodedValue({code:sa.value,name:sa.label}))})))});return function(fa,ja){return Z.apply(this,arguments)}}();ba.prepareFetchPopupFeatures=function(){var Z=a._asyncToGenerator(function*(fa){this._codedDomainPopulationPromise||(this._codedDomainPopulationAbortController=new AbortController,this._codedDomainPopulationPromise=this._populateClassCodeCodedDomain(fa,this._codedDomainPopulationAbortController.signal).then(()=>{this._codedDomainPopulationAbortController=
null}));return this._codedDomainPopulationPromise});return function(fa){return Z.apply(this,arguments)}}();ba.whenGraphicAttributes=function(){var Z=a._asyncToGenerator(function*(fa,ja){var oa=this;const sa=this._splitGraphicsPerNode(fa),qa=this.layer.attributeStorageInfo,Ha=ja.map(Da=>I.getAttributeInfo(qa,Da)),Ga=function(){var Da=a._asyncToGenerator(function*(ra,Ea){const Ia=oa._index.getNode(Ea);yield c.forEach(Ha,function(){var Ma=a._asyncToGenerator(function*(Qa){const wa=Qa.useElevation?yield oa._loadElevationAttributeFromGeometry(Ia.resourceId):
yield oa._loadAndParseAttribute(Ia,Qa);if(wa)for(const Ja of ra)oa._isValidPointGraphic(Ja)&&oa._encodeGraphicAttribute(Qa,wa,Ja.pointCloudMetadata.attributePointIndexInNode,Ja.attributes)});return function(Qa){return Ma.apply(this,arguments)}}())});return function(ra,Ea){return Da.apply(this,arguments)}}(),pa=[];sa.forEach((Da,ra)=>{pa.push(Ga(Da,ra))});yield n.eachAlways(pa);return fa});return function(fa,ja){return Z.apply(this,arguments)}}();ba._isValidPointGraphic=function(Z){return Z instanceof
Q.PointGraphic&&Z.pointCloudMetadata&&Z.pointCloudMetadata.epoch===this._nodeLoadEpoch};ba._splitGraphicsPerNode=function(Z){const fa=new Map;for(const ja of Z){if(!this._isValidPointGraphic(ja))continue;Z=ja.pointCloudMetadata;const oa=fa.get(Z.nodeId);oa?oa.push(ja):fa.set(Z.nodeId,[ja])}return fa};ba._loadAndParseAttribute=function(){var Z=a._asyncToGenerator(function*(fa,ja){const oa=yield this._loadAttribute(fa.resourceId,ja,null);return r.isSome(oa)?O.getAttributeValues({attributeInfo:ja,buffer:oa},
null,fa.vertexCount):null});return function(fa,ja){return Z.apply(this,arguments)}}();ba._loadElevationAttributeFromGeometry=function(){var Z=a._asyncToGenerator(function*(fa){fa=O.readGeometry(this.layer.store.defaultGeometrySchema,yield this._loadGeometry(fa,null));return O.elevationFromPositions(fa,fa.length/3)});return function(fa){return Z.apply(this,arguments)}}();ba.highlight=function(Z){if(!Z)return{remove(){}};Z=m.isCollection(Z)?Z.toArray():Array.isArray(Z)?Z:[Z];return this._renderer.highlight(Z.map(fa=>
this._graphicToPointDefinition(fa)))};ba._graphicToPointDefinition=function(Z){if(!this._isValidPointGraphic(Z))return null;const {nodeId:fa,pointIndexInNode:ja}=Z.pointCloudMetadata;return null!=fa&&null!=ja?{nodeId:fa,pointId:ja}:null};ba._computeWork=function(){let Z=0;for(const fa of this._workQueue)Z+=fa.load.length+fa.remove.length;Z+=this._loadingNodes.size;Z+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize;Z+=this._loadingInitNodePage?100:0;return Z+=this._updateViewNeeded?
100:0};ba._updateLoading=function(){this.notifyChange("updating");this.notifyChange("updatingProgressValue")};ba.canResume=function(){return Y.prototype.canResume.call(this)&&this._layerIsVisible};ba.isUpdating=function(){return this.suspended?this._updateViewNeeded:0<this._computeWork()};ba._initNodePages=function(){const Z=this.layer.store.index;this._index=new H(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,Z.nodesPerPage||Z.nodePerIndexBlock);this._cancelIndexLoading();
this._traverseVisible=this._index.createVisibilityTraverse();this._layerIsVisible=this._loadingInitNodePage=!0;this.notifyChange("suspended");this._updateLoading();this._pageMultiplier=null!=Z.nodesPerPage?1:Z.nodePerIndexBlock;return this._loadNodePage(0).promise.then(fa=>{this._index.addPage(0,fa,this._elevationOffset);this._loadingInitNodePage=!1;this._setUpdateViewNeeded()})};ba._loadNodePage=function(Z){const fa=new AbortController;return{promise:this._requestNodePage(`${this.baseUrl}/nodepages/${Z*
this._pageMultiplier}`,fa.signal).then(ja=>ja.nodes.map((oa,sa)=>({resourceId:null!=oa.resourceId?oa.resourceId:Z*this._index.pageSize+sa,obb:oa.obb,firstChild:oa.firstChild,childCount:oa.childCount,vertexCount:null!=oa.vertexCount?oa.vertexCount:oa.pointCount,lodThreshold:null!=oa.lodThreshold?oa.lodThreshold:oa.effectiveArea}))),abortController:fa}};ba._updateWorkQueues=function(){if(!this._updateViewNeeded)return!1;let Z=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor();const fa=this.maximumPointCount*
this._lodFactor*this._getLodMemoryFactor();let ja=this._computeNodesForMinimumDensity(Z),oa=this._computePointCount(ja),sa=Math.sqrt(oa/(.75*fa));for(;oa>fa;)Z*=sa,ja=this._computeNodesForMinimumDensity(Z),oa=this._computePointCount(ja),sa=Math.sqrt(2);this._displayNodes(ja);this._updateViewNeeded=!1;this._updateLoading();return!0};ba._computePointCount=function(Z){let fa=0;for(let ja=0;ja<Z.length;ja++){const oa=this._index.getNode(Z[ja]);oa&&(fa+=oa.vertexCount)}return fa};ba._getLodMemoryFactor=
function(){return this.view.resourceController.memoryController.memoryFactor};ba._isRootNodeVisible=function(){let Z=!1;this._traverseVisible({frustum:this.view.state.contentCamera.frustum,clippingBox:this._clippingBox},{predicate:(fa,ja,oa)=>{Z=oa;return!1},pageMiss:()=>{}});return Z};ba._computeNodesForMinimumDensity=function(Z){const fa=this.view.state.contentCamera,ja=fa.frustum,oa=this._clippingBox,sa=fa.viewForward,qa=x.dot(sa,fa.eye),Ha=z.fromNormalAndOffset(sa,-qa,ka),Ga=fa.perScreenPixelRatio/
2,pa=Z*Z,Da=this._nodeIdArray;Da.length=0;const {minScale:ra,maxScale:Ea}=ca.extractSafeScaleBounds(this.layer),Ia=0===ra&&0===Ea?Ma=>Da.push(Ma):Ma=>{const Qa=this._getScale(Ma);ca.scaleBoundsPredicate(Qa,ra,Ea)&&Da.push(Ma)};this._traverseVisible({frustum:ja,clippingBox:oa},{predicate:(Ma,Qa,wa)=>{if(!wa)return!1;if(0===Qa.childCount)return Ia(Ma),!1;wa=this._index.getRenderObb(Ma);return this._computeAveragePixelArea(wa,Qa.lodThreshold,Qa.vertexCount,Ha,Ga)<=pa?(Ia(Ma),!1):!0},pageMiss:(Ma,Qa)=>
{Ia(Ma);this._indexQueue.includes(Qa)||this._indexQueue.push(Qa)}});return Da};ba._getScale=function(Z){var fa=this._nodeScales.get(Z);null==fa&&(fa=this._index.getNode(Z).obb.center,this._tmpPoint.x=fa[0],this._tmpPoint.y=fa[1],this._tmpPoint.z=fa[2],fa=this.view.basemapTerrain.getScale(this._tmpPoint),this._nodeScales.set(Z,fa));return fa};ba._computeAveragePixelArea=function(Z,fa,ja,oa,sa){Z=Math.max(1E-7,W.minimumDistancePlane(Z,oa));return fa/(Z*Z)/(4*sa*sa)/ja};ba._loadNode=function(Z,fa){try{return this._loadNodeAsync(Z,
fa)}catch(ja){throw n.isAbortError(ja)||ia.error(ja),ja;}};ba._loadAdditionalUserAttributes=function(){var Z=a._asyncToGenerator(function*(fa,ja,oa){var sa=this.layer.outFields;if(!sa)return[];sa=G.unpackFieldNames(this.layer.fieldsIndex,sa);fa=new Set(fa.map(Ga=>r.isSome(Ga)?Ga.name:null));const qa=this.layer.attributeStorageInfo,Ha=[];for(const Ga of sa)fa.has(Ga)||(sa=I.getAttributeInfo(qa,Ga))&&Ha.push(ja(sa));ja=yield n.eachAlwaysValues(Ha);n.throwIfAborted(oa);return r.mapSome(ja,Ga=>Ga)});
return function(fa,ja,oa){return Z.apply(this,arguments)}}();ba._loadNodeAsync=function(){var Z=a._asyncToGenerator(function*(fa,ja){var oa=this;const sa=this._index.getNode(fa),qa=I.getRendererInfo(this.layer),Ha=I.getFilterInfo(this.layer),Ga=sa.resourceId,pa=function(){var Da=a._asyncToGenerator(function*(ra){if(r.isNone(ra))return null;if(ra.useElevation)return{attributeInfo:ra,buffer:null};const Ea=yield oa._loadAttribute(Ga,ra,ja);return r.isSome(Ea)?{attributeInfo:ra,buffer:Ea}:null});return function(ra){return Da.apply(this,
arguments)}}();return this._idleQueue.push(a._asyncToGenerator(function*(){var Da=oa._loadGeometry(Ga,ja);const {primaryAttribute:ra,modulationAttribute:Ea}=qa,Ia=pa(ra),Ma=pa(Ea);var Qa=Ha.map(xa=>xa.attributeInfo);const wa=Qa.map(xa=>pa(xa));Qa=oa._loadAdditionalUserAttributes([ra,Ea,...Qa],pa,ja);const [Ja,Ta,Xa,ma,$a]=yield Promise.all([Da,Ia,Ma,Promise.all(wa),Qa]);n.throwIfAborted(ja);Da={geometryBuffer:Ja,primaryAttributeData:Ta,modulationAttributeData:Xa,filterAttributesData:ma,userAttributesData:$a,
schema:oa.layer.store.defaultGeometrySchema,rendererInfo:qa,filterInfo:Ha,obb:oa._index.getRenderObb(fa),elevationOffset:oa._elevationOffset,inSR:oa.layer.spatialReference.toJSON(),outSR:oa.view.renderCoordsHelper.spatialReference.toJSON()};return oa._worker.invoke(Da,ja)}),ja)});return function(fa,ja){return Z.apply(this,arguments)}}();ba._loadGeometry=function(){var Z=a._asyncToGenerator(function*(fa,ja){return this._requestData(`${this.baseUrl}/nodes/${fa}/geometries/0`,ja)});return function(fa,
ja){return Z.apply(this,arguments)}}();ba._loadAttribute=function(){var Z=a._asyncToGenerator(function*(fa,ja,oa){return r.isNone(ja)||!ja.storageInfo?null:this._requestData(`${this.baseUrl}/nodes/${fa}/attributes/${ja.storageInfo.key}`,oa)});return function(fa,ja,oa){return Z.apply(this,arguments)}}();ba._requestNodePage=function(Z,fa){return this._indexRequester.request(Z,"json",{query:{f:"json",token:this.layer.apiKey},signal:fa})};ba._requestData=function(Z,fa){return this._dataRequester.request(Z,
"binary",{query:{token:this.layer.apiKey},signal:fa})};ba._removeFromRenderer=function(Z){if(this._renderedNodes.has(Z)){const fa=this._renderer.removeNode(Z);this._renderedNodes.delete(Z);this._nodeScales.delete(Z);this._memCache.put(fa.id.toString(),fa,5*fa.coordinates.length+128)}};ba._addToRenderer=function(Z){this._renderedNodes.has(Z.id)||(this._renderedNodes.add(Z.id),this._renderer.addNode(Z))};ba._setupRendererData=function(Z,fa){const ja=this._index.getNode(Z),oa=Math.sqrt(ja.lodThreshold/
ja.vertexCount),sa=this._index.getRenderObb(Z);if(S.isInstanceOfNode(fa))return fa.splatSize=oa,fa.obb=sa,fa.origin=B.clone(fa.obb.center),fa;var qa=.01*Math.max(sa.halfSize[0],sa.halfSize[1],sa.halfSize[2]);if(fa.obb.halfSize[0]>sa.halfSize[0]+qa||fa.obb.halfSize[1]>sa.halfSize[1]+qa||fa.obb.halfSize[2]>sa.halfSize[2]+qa)0<this._maxLoggedBoxWarnings&&(qa=Ha=>`[${Ha.halfSize[0]}, ${Ha.halfSize[1]}, ${Ha.halfSize[2]}]`,ia.warn(`Node ${Z} reported bounding box too small. got ${qa(sa)} but points cover ${qa(fa.obb)}`),
0===--this._maxLoggedBoxWarnings&&ia.warn("  Too many bounding box errors, stopping reporting for this layer.")),this._index.setRenderObb(Z,fa.obb);return{id:Z,coordinates:fa.points,origin:B.clone(sa.center),rgb:fa.rgb,attributes:fa.attributes,pointIdFilterMap:fa.pointIdFilterMap,highlights:null,splatSize:oa,obb:sa,isLeaf:0===ja.childCount}};ba.getUsedMemory=function(){let Z=0;this._renderer.forEachNode(fa=>{Z+=160;Z+=f.estimateSize(fa.coordinates);for(const ja of fa.attributes)fa=ja.values,f.isArrayBuffer(fa.buffer)&&
(Z+=f.estimateSize(fa))});return Z};ba.getUnloadedMemory=function(){var Z=this._renderedNodes.size;if(4>Z)return 0;const fa=[...this._renderedNodes].reduce((sa,qa)=>sa+this._index.getNode(qa).vertexCount);let ja=this._loadingNodes.size;for(var oa=0;oa<this._workQueue.length;oa++)ja+=this._workQueue[oa].load.length,ja-=this._workQueue[oa].remove.length;if(0>ja)return 0;oa=ja*fa/Z;Z=(this.getUsedMemory()-160*Z)/fa;return oa*Z+160*ja};ba.ignoresMemoryFactor=function(){return!1};a._createClass(ea,[{key:"pointScale",
get:function(){const Z=I.getSplatSizeAlgorithm(this.layer&&this.layer.renderer);return Z&&null!=Z.scaleFactor?Z.scaleFactor:1}},{key:"useRealWorldSymbolSizes",get:function(){const Z=I.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);return Z&&null!=Z.useRealWorldSymbolSizes?Z.useRealWorldSymbolSizes:!1}},{key:"pointSize",get:function(){const Z=I.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);return Z&&null!=Z.size?Z.size:0}},{key:"inverseDensity",get:function(){return this.layer&&this.layer.renderer?
96/this.layer.renderer.pointsPerInch:5}},{key:"availableFields",get:function(){var Z=I.getRendererInfo(this.layer);const fa=new Set;Z.primaryAttribute&&fa.add(Z.primaryAttribute.name);Z.modulationAttribute&&fa.add(Z.primaryAttribute.name);if(Z=I.getFilterInfo(this.layer))for(const ja of Z)fa.add(ja.attributeInfo.name);if(this.layer.outFields)for(const ja of G.unpackFieldNames(this.layer.fieldsIndex,this.layer.outFields))fa.add(ja);return Array.from(fa)}},{key:"_clippingBox",get:function(){if(!this.view||
!this.view.clippingArea)return null;const Z=u.create();return U.projectToBoundingBox(this.view.clippingArea,Z,this.view.renderSpatialReference)?Z:null}},{key:"_elevationOffset",get:function(){const Z=this.layer&&this.layer.elevationInfo;if(Z&&"absolute-height"===Z.mode){const fa=d.getMetersPerVerticalUnitForSR(this.layer.spatialReference),ja=K.getMetersPerUnit(Z.unit);return r.unwrapOr(Z.offset,0)*ja/fa}return 0}},{key:"running",get:function(){return this.suspended?this._updateViewNeeded:this._updateViewNeeded||
0<this._indexQueue.length||0<this._workQueue.length||this._idleQueue.running}},{key:"updatingProgressValue",get:function(){if(this.suspended)return this._updateViewNeeded?0:1;const Z=this._computeWork();return 1-Math.min(this._totalWork,Z)/this._totalWork}},{key:"performanceInfo",get:function(){return{nodes:this._renderedNodes.size,displayedNumberOfFeatures:[...this._renderedNodes].reduce((Z,fa)=>Z+this._index.getNode(fa).vertexCount,0),maximumNumberOfFeatures:this.maximumPointCount,totalNumberOfFeatures:-1,
core:null,"Loading Nodes":this._loadingNodes.size,"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,"Idle Queue":this._idleQueue.length}}},{key:"test",get:function(){return{index:this._index,visibleNodes:this._renderedNodes}}}]);return ea}(T.PopupSceneLayerView(N.LayerView3D(da)));b.__decorate([e.property()],l.prototype,"layer",void 0);b.__decorate([e.property({readOnly:!0,aliasOf:"layer.parsedUrl.path"})],l.prototype,"baseUrl",void 0);b.__decorate([e.property({readOnly:!0})],
l.prototype,"pointScale",null);b.__decorate([e.property({readOnly:!0})],l.prototype,"useRealWorldSymbolSizes",null);b.__decorate([e.property({readOnly:!0})],l.prototype,"pointSize",null);b.__decorate([e.property({readOnly:!0})],l.prototype,"inverseDensity",null);b.__decorate([e.property()],l.prototype,"maximumPointCount",void 0);b.__decorate([e.property({readOnly:!0})],l.prototype,"availableFields",null);b.__decorate([e.property({readOnly:!0})],l.prototype,"_clippingBox",null);b.__decorate([e.property({readOnly:!0})],
l.prototype,"_elevationOffset",null);b.__decorate([e.property({type:Boolean})],l.prototype,"slicePlaneEnabled",void 0);b.__decorate([e.property()],l.prototype,"updating",void 0);b.__decorate([e.property(R.updatingProgress)],l.prototype,"updatingProgress",void 0);b.__decorate([e.property({readOnly:!0})],l.prototype,"updatingProgressValue",null);b=l=b.__decorate([t.subclass("esri.views.3d.layers.PointCloudLayerView3D")],l);const la=C.create();return b})},"esri/views/3d/layers/PointCloudWorkerHandle":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../core/workers/WorkerHandle"],function(a,b,c,m){m=function(l){function r(n){var g;return g=l.call(this,"PointCloudWorker","transform",{transform:k=>g._getTransferList(k)},n)||this}b._inheritsLoose(r,l);r.prototype._getTransferList=function(n){const g=[n.geometryBuffer];c.isSome(n.primaryAttributeData)&&n.primaryAttributeData.buffer&&g.push(n.primaryAttributeData.buffer);c.isSome(n.modulationAttributeData)&&n.modulationAttributeData.buffer&&
g.push(n.modulationAttributeData.buffer);if(c.isSome(n.filterAttributesData))for(const k of n.filterAttributesData)c.isSome(k)&&k.buffer&&g.push(k.buffer);for(const k of n.userAttributesData)k.buffer&&g.push(k.buffer);return g};return r}(m.WorkerHandle);a.PointCloudWorkerHandle=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/LoDUtil":function(){define(["exports","../../../../chunks/vec3"],function(a,b){function c(k,f,d){for(;0<
k;){const e=f.indexOf(k);if(0<=e)return e;k=d.getParentId(k)}return f.indexOf(k)}function m(k,f,d){const e=[f.remove[0]],h=[];for(;1===e.length;){const w=e.pop();h.length=0;for(let t=0;t<f.load.length;t++){let x=f.load[t];for(var v=d.getParentId(x);v!==w;)x=v,v=d.getParentId(x);v=e.indexOf(x);0>v&&(v=e.length,e.push(x),h.push([]));h[v].push(f.load[t])}}f.load=e;for(f=0;f<e.length;f++)1<h[f].length?k.push({remove:[e[f]],load:h[f]}):e[f]=h[f][0]}const l=[!1],r=[null],n=[!1],g=[null];a.nodeDiff=function(k,
f,d){for(var e=0;e<f.length;e++)n[e]=!1,g[e]=null;for(e=0;e<k.length;e++)l[e]=!1,r[e]=null;for(e=0;e<f.length;e++){var h=c(f[e],k,d);0<=h&&(n[e]=!0,null!=r[h]?r[h].push(f[e]):r[h]=[f[e]])}for(e=0;e<k.length;e++)h=c(k[e],f,d),0<=h&&(l[e]=!0,null!=g[h]?g[h].push(k[e]):g[h]=[k[e]]);d=[];for(e=0;e<k.length;e++)null!=r[e]||l[e]||d.push({load:[],remove:[k[e]]});for(e=0;e<f.length;e++)null!=g[e]||n[e]||d.push({load:[f[e]],remove:[]});for(e=0;e<f.length;e++)null!=g[e]&&(1<g[e].length||g[e][0]!==f[e])&&d.push({load:[f[e]],
remove:g[e]});for(f=0;f<k.length;f++)null!=r[f]&&(1<r[f].length||r[f][0]!==k[f])&&d.push({load:r[f],remove:[k[f]]});return d};a.sortFrontToBack=function(k,f,d){return k.sort((e,h)=>{if(0===e.load.length&&0===h.load.length)return 0;if(0===e.load.length)return-1;if(0===h.load.length)return 1;if(0===e.remove.length&&0===h.remove.length)return e=d.getRenderCenter(e.load[0]),h=d.getRenderCenter(h.load[0]),b.dot(e,f)-b.dot(h,f);if(0===e.remove.length)return-1;if(0===h.remove.length)return 1;if(1===e.load.length&&
1===h.load.length)return e=d.getRenderCenter(e.load[0]),h=d.getRenderCenter(h.load[0]),b.dot(e,f)-b.dot(h,f);if(1===e.load.length)return-1;if(1===h.load.length)return 1;e=d.getRenderCenter(e.remove[0]);h=d.getRenderCenter(h.remove[0]);return b.dot(e,f)-b.dot(h,f)})};a.splitWorkEntries=function(k,f,d){for(let e=0;e<k.length;++e){const h=k[e];h.load.length>f&&1===h.remove.length&&m(k,h,d)}};a.splitWorkEntry=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/layers/i3s/PagedNodeIndex":function(){define(["../../../../geometry/support/aaBoundingBox","./I3SUtil","../../support/orientedBoundingBox"],function(a,b,c){return function(){function m(r,n,g){this._pages=[];this.pageSize=0;this._renderSR=this._nodeSR=null;this._nodeSR=r;this._renderSR=n;this.pageSize=g}var l=m.prototype;l.addPage=function(r,n,g=0){for(;this._pages.length<r;)this._pages.push(null);var k=this._nodeSR,f=this._renderSR,d=new c.ObbArray(n.length);for(var e=0;e<n.length;e++)b.transformObb(n[e].obb,
k,d.obbs[e],f,g);g=d.obbs;this._pages[r]={nodes:n,renderObbs:g,parents:new Uint32Array(this.pageSize)};r=this._pages;n=this.pageSize;for(g=[0];g.length;)for(k=g.pop(),f=r[k/n|0].nodes[k%n],d=0;d<f.childCount;d++)e=f.firstChild+d,null!=r[e/n|0]&&(r[e/n|0].parents[e%n]=k,g.push(e))};l.hasPage=function(r){return!!this._pages[r]};l.getNode=function(r){const n=this.pageSize;return this._pages[r/n|0].nodes[r%n]};l.getRenderObb=function(r){const n=this.pageSize;return this._pages[r/n|0].renderObbs[r%n]};
l.getRenderCenter=function(r){return this.getRenderObb(r).center};l.setRenderObb=function(r,n){const g=this.pageSize;c.set(n,this._pages[r/g|0].renderObbs[r%g])};l.getParentId=function(r){const n=this.pageSize;return this._pages[r/n|0].parents[r%n]};l.hasNodes=function(r,n){var g=r/this.pageSize|0;for(r=(r+n-1)/this.pageSize|0;g<=r;g++)if(null==this._pages[g])return!1;return!0};l.forEachNodeId=function(r){for(let n=0;n<this._pages.length;n++){const g=this._pages[n];if(g)for(let k=0;k<g.nodes.length;k++)r(n*
this.pageSize+k)}};l.createVisibilityTraverse=function(){var r=this,n=[],g=[],k=a.create();return(f,d)=>{if(r.hasNodes(0,1))for(n.length=0,n.push(0),g.length=0,g.push(0);0<n.length;){var e=n.pop();let B=g.pop();var h=r.getNode(e),v=r.getRenderObb(e),w=!0;if(null!=f.clippingBox){var t=1<<f.frustum.length;if(0===(B&t)){var x=c.toAaBoundingBox(v,k);a.contains(f.clippingBox,x)?B|=t:a.intersects(f.clippingBox,x)||(w=!1)}}for(t=0;t<f.frustum.length&&w;t++)if(x=1<<t,0===(B&x)){const q=c.intersectPlane(v,
f.frustum[t]);0<q?w=!1:0>q&&(B|=x)}if(d.predicate(e,h,w)){v=h.firstChild;h=h.childCount;w=!1;x=v/r.pageSize|0;for(t=(v+h-1)/r.pageSize|0;x<=t;x++)if(!r.hasPage(x)){d.pageMiss(e,x);w=!0;break}if(!w)for(e=0;e<h;e++)n.push(v+e),g.push(B)}}}};return m}()})},"esri/views/3d/layers/i3s/PointCloudRendererUtil":function(){define(["exports"],function(a){function b(m,l){for(const r of m)if(r.name===l&&null!=r.attributeValues&&"UInt8"===r.attributeValues.valueType&&3===r.attributeValues.valuesPerElement)return{name:l,
storageInfo:r,useElevation:!1};return null}function c(m,l){for(const r of m)if(r.name===l)return m="embedded-elevation"===r.encoding,{name:l,storageInfo:m?null:r,useElevation:m};return"elevation"===l.toLowerCase()?{name:l,storageInfo:null,useElevation:!0}:null}a.getAttributeInfo=c;a.getFilterInfo=function(m){const l=m.filters;return l?l.map(r=>({filterJSON:r.toJSON(),attributeInfo:c(m.attributeStorageInfo,r.field)})):[]};a.getFixedSizeAlgorithm=function(m){return(m=m&&m.pointSizeAlgorithm)&&"fixed-size"===
m.type?m:null};a.getRendererInfo=function(m){const l=m.renderer;var r=l&&l.type;const n=l&&m.renderer.toJSON()||null;let g=null,k=!1;"point-cloud-unique-value"===r?g=c(m.attributeStorageInfo,l.field):"point-cloud-stretch"===r?g=c(m.attributeStorageInfo,l.field):"point-cloud-class-breaks"===r?g=c(m.attributeStorageInfo,l.field):(g="point-cloud-rgb"===r?b(m.attributeStorageInfo,l.field):b(m.attributeStorageInfo,"RGB"),k=null!=g);r=null;l&&l.colorModulation&&(r=c(m.attributeStorageInfo,l.colorModulation.field));
return{rendererJSON:n,isRGBRenderer:k,primaryAttribute:g,modulationAttribute:r}};a.getSplatSizeAlgorithm=function(m){return(m=m&&m.pointSizeAlgorithm)&&"splat"===m.type?m:null};a.rendererUsesFixedSizes=function(m){return(m=m&&m.pointSizeAlgorithm)&&m.type?"fixed-size"===m.type:!1};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/PointCloudWorkerUtil":function(){define("exports ../../../../core/maybe ../../../../renderers/PointCloudClassBreaksRenderer ../../../../renderers/PointCloudStretchRenderer ../../../../renderers/PointCloudUniqueValueRenderer ./I3SBinaryReader ./LEPCC".split(" "),
function(a,b,c,m,l,r,n){function g(d,e){const h=new Float64Array(e);for(let v=0;v<e;v++)h[v]=d[3*v+2];return h}function k(d){return null==d||"none"===d?null:"low-four-bit"===d?e=>e&15:"high-four-bit"===d?e=>(e&240)>>4:"absolute-value"===d?e=>Math.abs(e):"modulo-ten"===d?e=>e%10:null}function f(d){let e=0;for(const h of d?d:[])e|=1<<h;return e}a.elevationFromPositions=g;a.evaluateRenderer=function(d,e,h,v){const {rendererJSON:w,isRGBRenderer:t}=d;var x=d=null;if(e&&t)d=e;else if(e&&"pointCloudUniqueValueRenderer"===
w.type){x=l.fromJSON(w);var B=x.colorUniqueValueInfos;d=new Uint8Array(3*v);var q=k(x.fieldTransformType);for(var u=0;u<v;u++){var C=(q?q(e[u]):e[u])+"";for(var z=0;z<B.length;z++)if(B[z].values.includes(C)){d[3*u]=B[z].color.r;d[3*u+1]=B[z].color.g;d[3*u+2]=B[z].color.b;break}}}else if(e&&"pointCloudStretchRenderer"===w.type)for(x=m.fromJSON(w),B=x.stops,d=new Uint8Array(3*v),q=k(x.fieldTransformType),u=0;u<v;u++)if(C=q?q(e[u]):e[u],z=B.length-1,C<B[0].value)d[3*u]=B[0].color.r,d[3*u+1]=B[0].color.g,
d[3*u+2]=B[0].color.b;else if(C>=B[z].value)d[3*u]=B[z].color.r,d[3*u+1]=B[z].color.g,d[3*u+2]=B[z].color.b;else for(z=1;z<B.length;z++){if(C<B[z].value){C=(C-B[z-1].value)/(B[z].value-B[z-1].value);d[3*u]=B[z].color.r*C+B[z-1].color.r*(1-C);d[3*u+1]=B[z].color.g*C+B[z-1].color.g*(1-C);d[3*u+2]=B[z].color.b*C+B[z-1].color.b*(1-C);break}}else if(e&&"pointCloudClassBreaksRenderer"===w.type)for(x=c.fromJSON(w),B=x.colorClassBreakInfos,d=new Uint8Array(3*v),q=k(x.fieldTransformType),u=0;u<v;u++)for(C=
q?q(e[u]):e[u],z=0;z<B.length;z++){if(C>=B[z].minValue&&C<=B[z].maxValue){d[3*u]=B[z].color.r;d[3*u+1]=B[z].color.g;d[3*u+2]=B[z].color.b;break}}else for(d=new Uint8Array(3*v),e=0;e<d.length;e++)d[e]=255;if(h&&x&&x.colorModulation)for(e=x.colorModulation.minValue,x=x.colorModulation.maxValue,B=0;B<v;B++)q=h[B],q=q>=x?1:q<=e?.3:.3+.7*(q-e)/(x-e),d[3*B]*=q,d[3*B+1]*=q,d[3*B+2]*=q;return d};a.filterInPlace=function(d,e,h,v,w){const t=d.length/3;let x=0;for(let A=0;A<t;A++){let p=!0;for(let y=0;y<v.length&&
p;y++){var {filterJSON:B}=v[y],q=w[y].values[A];switch(B.type){case "pointCloudValueFilter":var u="exclude"===B.mode;B.values.includes(q)===u&&(p=!1);break;case "pointCloudBitfieldFilter":u=f(B.requiredSetBits);B=f(B.requiredClearBits);if((q&u)!==u||0!==(q&B))p=!1;break;case "pointCloudReturnFilter":var C=q&15,z=q>>>4&15;q=1<z;u=1===C;C=C===z;z=!1;for(const D of B.includedReturns)if("last"===D&&C||"firstOfMany"===D&&u&&q||"lastOfMany"===D&&C&&q||"single"===D&&!q){z=!0;break}z||(p=!1)}}p&&(h[x]=A,
d[3*x]=d[3*A],d[3*x+1]=d[3*A+1],d[3*x+2]=d[3*A+2],e[3*x]=e[3*A],e[3*x+1]=e[3*A+1],e[3*x+2]=e[3*A+2],x++)}return x};a.getAttributeValues=function(d,e,h){return b.isSome(d)&&d.attributeInfo.useElevation?g(e,h):b.isSome(d)?r.readBinaryAttribute(d.attributeInfo.storageInfo,d.buffer,h):null};a.readGeometry=function(d,e){if(null==d.encoding||""===d.encoding){d=r.createGeometryIndexFromSchema(e,d);if(b.isNone(d.vertexAttributes.position))return;e=r.createTypedView(e,d.vertexAttributes.position);var h=d.header.fields;
d=[h.offsetX,h.offsetY,h.offsetZ];h=[h.scaleX,h.scaleY,h.scaleZ];const v=e.length/3,w=new Float64Array(3*v);for(let t=0;t<v;t++)w[3*t]=e[3*t]*h[0]+d[0],w[3*t+1]=e[3*t+1]*h[1]+d[1],w[3*t+2]=e[3*t+2]*h[2]+d[2];return w}if("lepcc-xyz"===d.encoding)return n.decodeXYZ(e).result};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/renderers/PointCloudClassBreaksRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorClassBreakInfo".split(" "),
function(a,b,c,m,l,r,n,g,k,f){var d;l=d=function(e){function h(v){v=e.call(this,v)||this;v.type="point-cloud-class-breaks";v.field=null;v.legendOptions=null;v.fieldTransformType=null;v.colorClassBreakInfos=null;return v}a._inheritsLoose(h,e);h.prototype.clone=function(){return new d({...this.cloneProperties(),field:this.field,fieldTransformType:this.fieldTransformType,colorClassBreakInfos:c.clone(this.colorClassBreakInfos),legendOptions:c.clone(this.legendOptions)})};return h}(g);b.__decorate([r.enumeration({pointCloudClassBreaksRenderer:"point-cloud-class-breaks"})],
l.prototype,"type",void 0);b.__decorate([m.property({json:{write:!0},type:String})],l.prototype,"field",void 0);b.__decorate([m.property({type:k.LegendOptions,json:{write:!0}})],l.prototype,"legendOptions",void 0);b.__decorate([m.property({type:g.fieldTransformTypeKebabDict.apiValues,json:{type:g.fieldTransformTypeKebabDict.jsonValues,read:g.fieldTransformTypeKebabDict.read,write:g.fieldTransformTypeKebabDict.write}})],l.prototype,"fieldTransformType",void 0);b.__decorate([m.property({type:[f],json:{write:!0}})],
l.prototype,"colorClassBreakInfos",void 0);return l=d=b.__decorate([n.subclass("esri.renderers.PointCloudClassBreaksRenderer")],l)})},"esri/renderers/PointCloudRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/jsonMap ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./support/pointCloud/ColorModulation ./support/pointCloud/pointSizeAlgorithmTypeUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f){n=c.strict()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks",pointCloudRGBRenderer:"point-cloud-rgb",pointCloudStretchRenderer:"point-cloud-stretch",pointCloudUniqueValueRenderer:"point-cloud-unique-value"});m=function(d){function e(v){v=d.call(this,v)||this;v.type=void 0;v.pointSizeAlgorithm=null;v.colorModulation=null;v.pointsPerInch=10;return v}a._inheritsLoose(e,d);var h=e.prototype;h.clone=function(){console.warn(".clone() is not implemented for "+this.declaredClass);
return null};h.cloneProperties=function(){return{pointSizeAlgorithm:l.clone(this.pointSizeAlgorithm),colorModulation:l.clone(this.colorModulation),pointsPerInch:l.clone(this.pointsPerInch)}};return e}(m.JSONSupport);b.__decorate([r.property({type:n.apiValues,readOnly:!0,nonNullable:!0,json:{type:n.jsonValues,read:!1,write:n.write}})],m.prototype,"type",void 0);b.__decorate([r.property({types:f.pointSizeAlgorithmTypes,json:{write:!0}})],m.prototype,"pointSizeAlgorithm",void 0);b.__decorate([r.property({type:k,
json:{write:!0}})],m.prototype,"colorModulation",void 0);b.__decorate([r.property({json:{write:!0},nonNullable:!0,type:Number})],m.prototype,"pointsPerInch",void 0);m=b.__decorate([g.subclass("esri.renderers.PointCloudRenderer")],m);(m||(m={})).fieldTransformTypeKebabDict=new c.JSONMap({none:"none",lowFourBit:"low-four-bit",highFourBit:"high-four-bit",absoluteValue:"absolute-value",moduloTen:"modulo-ten"});return m})},"esri/renderers/support/pointCloud/ColorModulation":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,m,l,r,n,g){var k;c=k=function(f){function d(){var e=f.apply(this,arguments)||this;e.field=null;e.minValue=0;e.maxValue=255;return e}a._inheritsLoose(d,f);d.prototype.clone=function(){return new k({field:this.field,minValue:this.minValue,maxValue:this.maxValue})};return d}(c.JSONSupport);b.__decorate([m.property({type:String,json:{write:!0}})],c.prototype,"field",void 0);b.__decorate([m.property({type:Number,nonNullable:!0,json:{write:!0}})],c.prototype,"minValue",void 0);b.__decorate([m.property({type:Number,
nonNullable:!0,json:{write:!0}})],c.prototype,"maxValue",void 0);return c=k=b.__decorate([g.subclass("esri.renderers.support.pointCloud.ColorModulation")],c)})},"esri/renderers/support/pointCloud/pointSizeAlgorithmTypeUtils":function(){define(["exports","./PointSizeAlgorithm","./PointSizeFixedSizeAlgorithm","./PointSizeSplatAlgorithm"],function(a,b,c,m){a.pointSizeAlgorithmTypes={key:"type",base:b,typeMap:{"fixed-size":c,splat:m}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/renderers/support/pointCloud/PointSizeAlgorithm":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/jsonMap ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,m,l,r,n,g,k){c=new c.JSONMap({pointCloudFixedSizeAlgorithm:"fixed-size",pointCloudSplatAlgorithm:"splat"});
m=function(f){function d(){return f.apply(this,arguments)||this}a._inheritsLoose(d,f);return d}(m.JSONSupport);b.__decorate([l.property({type:c.apiValues,readOnly:!0,nonNullable:!0,json:{type:c.jsonValues,read:!1,write:c.write}})],m.prototype,"type",void 0);return m=b.__decorate([k.subclass("esri.renderers.support.pointCloud.PointSizeAlgorithm")],m)})},"esri/renderers/support/pointCloud/PointSizeFixedSizeAlgorithm":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./PointSizeAlgorithm".split(" "),
function(a,b,c,m,l,r,n,g,k){var f;m=f=function(d){function e(){var h=d.apply(this,arguments)||this;h.type="fixed-size";h.size=0;h.useRealWorldSymbolSizes=null;return h}a._inheritsLoose(e,d);e.prototype.clone=function(){return new f({size:this.size,useRealWorldSymbolSizes:this.useRealWorldSymbolSizes})};return e}(k);b.__decorate([n.enumeration({pointCloudFixedSizeAlgorithm:"fixed-size"})],m.prototype,"type",void 0);b.__decorate([c.property({type:Number,nonNullable:!0,json:{write:!0}})],m.prototype,
"size",void 0);b.__decorate([c.property({type:Boolean,json:{write:!0}})],m.prototype,"useRealWorldSymbolSizes",void 0);return m=f=b.__decorate([g.subclass("esri.renderers.support.pointCloud.PointSizeFixedSizeAlgorithm")],m)})},"esri/renderers/support/pointCloud/PointSizeSplatAlgorithm":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./PointSizeAlgorithm".split(" "),
function(a,b,c,m,l,r,n,g,k){var f;m=f=function(d){function e(){var h=d.apply(this,arguments)||this;h.type="splat";h.scaleFactor=1;return h}a._inheritsLoose(e,d);e.prototype.clone=function(){return new f({scaleFactor:this.scaleFactor})};return e}(k);b.__decorate([n.enumeration({pointCloudSplatAlgorithm:"splat"})],m.prototype,"type",void 0);b.__decorate([c.property({type:Number,value:1,nonNullable:!0,json:{write:!0}})],m.prototype,"scaleFactor",void 0);return m=f=b.__decorate([g.subclass("esri.renderers.support.pointCloud.PointSizeSplatAlgorithm")],
m)})},"esri/renderers/support/pointCloud/ColorClassBreakInfo":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,m,l,r,n,g){var k;m=k=function(f){function d(){var e=f.apply(this,arguments)||this;e.description=null;e.label=null;e.minValue=
0;e.maxValue=0;e.color=null;return e}a._inheritsLoose(d,f);d.prototype.clone=function(){return new k({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,color:l.clone(this.color)})};return d}(m.JSONSupport);b.__decorate([r.property({type:String,json:{write:!0}})],m.prototype,"description",void 0);b.__decorate([r.property({type:String,json:{write:!0}})],m.prototype,"label",void 0);b.__decorate([r.property({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],
m.prototype,"minValue",void 0);b.__decorate([r.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],m.prototype,"maxValue",void 0);b.__decorate([r.property({type:c,json:{type:[n.Integer],write:!0}})],m.prototype,"color",void 0);return m=k=b.__decorate([g.subclass("esri.renderers.support.pointCloud.ColorClassBreakInfo")],m)})},"esri/renderers/PointCloudStretchRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./visualVariables/support/ColorStop".split(" "),
function(a,b,c,m,l,r,n,g,k,f){var d;l=d=function(e){function h(v){v=e.call(this,v)||this;v.type="point-cloud-stretch";v.field=null;v.legendOptions=null;v.fieldTransformType=null;v.stops=null;return v}a._inheritsLoose(h,e);h.prototype.clone=function(){return new d({...this.cloneProperties(),field:c.clone(this.field),fieldTransformType:c.clone(this.fieldTransformType),stops:c.clone(this.stops),legendOptions:c.clone(this.legendOptions)})};return h}(g);b.__decorate([r.enumeration({pointCloudStretchRenderer:"point-cloud-stretch"})],
l.prototype,"type",void 0);b.__decorate([m.property({json:{write:!0},type:String})],l.prototype,"field",void 0);b.__decorate([m.property({type:k.LegendOptions,json:{write:!0}})],l.prototype,"legendOptions",void 0);b.__decorate([m.property({type:g.fieldTransformTypeKebabDict.apiValues,json:{type:g.fieldTransformTypeKebabDict.jsonValues,read:g.fieldTransformTypeKebabDict.read,write:g.fieldTransformTypeKebabDict.write}})],l.prototype,"fieldTransformType",void 0);b.__decorate([m.property({type:[f],json:{write:!0}})],
l.prototype,"stops",void 0);return l=d=b.__decorate([n.subclass("esri.renderers.PointCloudStretchRenderer")],l)})},"esri/renderers/PointCloudUniqueValueRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorUniqueValueInfo".split(" "),
function(a,b,c,m,l,r,n,g,k,f){var d;l=d=function(e){function h(v){v=e.call(this,v)||this;v.type="point-cloud-unique-value";v.field=null;v.fieldTransformType=null;v.colorUniqueValueInfos=null;v.legendOptions=null;return v}a._inheritsLoose(h,e);h.prototype.clone=function(){return new d({...this.cloneProperties(),field:c.clone(this.field),fieldTransformType:c.clone(this.fieldTransformType),colorUniqueValueInfos:c.clone(this.colorUniqueValueInfos),legendOptions:c.clone(this.legendOptions)})};return h}(g);
b.__decorate([r.enumeration({pointCloudUniqueValueRenderer:"point-cloud-unique-value"})],l.prototype,"type",void 0);b.__decorate([m.property({json:{write:!0},type:String})],l.prototype,"field",void 0);b.__decorate([m.property({type:g.fieldTransformTypeKebabDict.apiValues,json:{type:g.fieldTransformTypeKebabDict.jsonValues,read:g.fieldTransformTypeKebabDict.read,write:g.fieldTransformTypeKebabDict.write}})],l.prototype,"fieldTransformType",void 0);b.__decorate([m.property({type:[f],json:{write:!0}})],
l.prototype,"colorUniqueValueInfos",void 0);b.__decorate([m.property({type:k.LegendOptions,json:{write:!0}})],l.prototype,"legendOptions",void 0);return l=d=b.__decorate([n.subclass("esri.renderers.PointCloudUniqueValueRenderer")],l)})},"esri/renderers/support/pointCloud/ColorUniqueValueInfo":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,m,l,r,n,g){var k;m=k=function(f){function d(){var e=f.apply(this,arguments)||this;e.description=null;e.label=null;e.values=null;e.color=null;return e}a._inheritsLoose(d,f);d.prototype.clone=function(){return new k({description:this.description,label:this.label,values:l.clone(this.values),color:l.clone(this.color)})};return d}(m.JSONSupport);b.__decorate([r.property({type:String,json:{write:!0}})],m.prototype,"description",void 0);b.__decorate([r.property({type:String,json:{write:!0}})],
m.prototype,"label",void 0);b.__decorate([r.property({type:[String],json:{write:!0}})],m.prototype,"values",void 0);b.__decorate([r.property({type:c,json:{type:[n.Integer],write:!0}})],m.prototype,"color",void 0);return m=k=b.__decorate([g.subclass("esri.renderers.support.pointCloud.ColorUniqueValueInfo")],m)})},"esri/views/3d/layers/i3s/PointGraphic":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,m,l,r,n,g,k){a.PointGraphic=function(f){function d(e){return f.call(this,e)||this}b._inheritsLoose(d,f);return d}(m);c.__decorate([l.property({constructOnly:!0,clonable:"reference"})],a.PointGraphic.prototype,"pointCloudMetadata",void 0);a.PointGraphic=c.__decorate([k.subclass("esri.views.3d.layers.i3s.PointGraphic")],a.PointGraphic);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/PointRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../../../../chunks/mat4 ../../../../chunks/mat4f32 ../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/plane ../../../../geometry/support/ray ./PointHighlights ../../support/orientedBoundingBox ../../webgl-engine/core/shaderLibrary/ShaderOutputOptions ../../webgl-engine/core/shaderLibrary/Slice.glsl ../../webgl-engine/core/shaderModules/interfaces ../../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/RenderPass ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/shaders/PointRendererTechnique ../../webgl-engine/shaders/PointRendererTechniqueConfiguration ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject ../../../webgl/VertexElementDescriptor".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G){function P(I,O,Q,S,T){if(Q.drawScreenSpace)return Q.fixedSize*O*S;T=(T?256:64)*O*S;return Q.drawFixedSize?Math.min(Q.fixedSize/2,T):0<Q.screenMinSize?Math.min(Math.max(Q.screenMinSize*O*S,I/2),T):Math.min(I/2,T)}function K(I){return c.isSome(I.component)?I.component:-1}function N(I,O){if(c.isNone(I))return I;I=I.filter(Q=>Q.id!==O);return 0===I.length?null:I}function M(I){return c.isSome(I.dist)&&c.isSome(I.point)&&c.isSome(I.pointId)&&
c.isSome(I.node)}const L={positions:[new G.VertexElementDescriptor(A.VertexAttribute.POSITION,3,E.DataType.FLOAT,0,12)],colors:[new G.VertexElementDescriptor(A.VertexAttribute.COLOR,3,E.DataType.UNSIGNED_BYTE,0,3,!0)]};A=function(){function I(Q){this._params=Q;this.type=C.IntersectorType.PCL;this.isGround=!1;this._highlights=new v.PointHighlights({forEachNode:S=>this.forEachNode(S),addHighlight:(S,T,U)=>this._addHighlight(S,T,U),removeHighlight:(S,T)=>this._removeHighlight(S,T)});this.canRender=!0;
this.layerUid="";this._useFixedSizes=!1;this._scaleFactor=1;this._minSizePx=0;this._useRealWorldSymbolSizes=!1;this._sizePx=this._size=0;this._slicePlaneEnabled=!1;this._clipBox=d.create(d.POSITIVE_INFINITY);this._techniqueConfig=new y.PointRendererTechniqueConfiguration;this.tempMatrix4=r.create();this.tempVec3=g.create();this.nodes=new m}var O=I.prototype;O.initializeRenderContext=function(Q){this._context=Q;this._techniqueRep=this._context.shaderTechniqueRepository;Q.requestRender()};O.uninitializeRenderContext=
function(){};O.intersect=function(Q,S,T,U){const aa=k.create(),W=k.create(),R=k.create(),V=k.create(),da=e.create(),ca=Q.camera.perScreenPixelRatio/2,ha=Q.camera.near,ia=this._getSizeParams();n.subtract(W,U,T);const ka=1/n.length(W);n.scale(W,W,ka);n.negate(R,W);f.set(da,W[0],W[1],W[2],-n.dot(W,T));const la=new J,Y=new J,ea=[],ba=d.create(),Z=d.create(this._clipBox);d.offset(Z,-T[0],-T[1],-T[2],Z);this.nodes.forAll(sa=>{const qa=sa.splatSize*this._scaleFactor;var Ha=w.minimumDistancePlane(sa.obb,
da),Ga=w.maximumDistancePlane(sa.obb,da);Ha-=ia.drawScreenSpace?0:P(qa,Ha+ha,ia,ca,sa.isLeaf);Ga-=ia.drawScreenSpace?0:P(qa,Ga+ha,ia,ca,sa.isLeaf);Ha=null!=la.dist&&null!=Y.dist&&la.dist<Ha*ka&&Y.dist>Ga*ka;if(!(0>Ga||Ha)&&(Ga=P(qa,Ga+ha,ia,ca,sa.isLeaf),w.intersectLine(sa.obb,T,W,Ga))){Ga*=Ga;w.toAaBoundingBox(sa.obb,ba);d.offset(ba,-T[0],-T[1],-T[2],ba);Ha=!d.contains(Z,ba);n.subtract(V,sa.origin,T);var pa=sa.coordinates.length/3;for(let Ia=0;Ia<pa;Ia++){aa[0]=V[0]+sa.coordinates[3*Ia];aa[1]=V[1]+
sa.coordinates[3*Ia+1];aa[2]=V[2]+sa.coordinates[3*Ia+2];if(Ha&&!d.containsPoint(Z,aa))continue;var Da=n.dot(aa,W),ra=n.squaredLength(aa)-Da*Da;if(ra>Ga)continue;var Ea=Da+ha;const Ma=ia.drawScreenSpace?0:P(qa,Ea,ia,ca,sa.isLeaf);if(0>Da-Ma)continue;Ea-=Ma;Ea=P(qa,Ea,ia,ca,sa.isLeaf);if(ra>Ea*Ea)continue;const Qa=(Da-Ma)*ka;Da=wa=>{var Ja=Ia,Ta=wa.point;c.isNone(Ta)&&(Ta=k.create());Ta[0]=sa.origin[0]+sa.coordinates[3*Ja];Ta[1]=sa.origin[1]+sa.coordinates[3*Ja+1];Ta[2]=sa.origin[2]+sa.coordinates[3*
Ja+2];wa.point=Ta;wa.dist=Qa;wa.normal=R;wa.node=sa;wa.pointId=Ia;wa.layerUid=this.layerUid;return wa};(null==la.dist||Qa<la.dist)&&(null==S||S(T,U,Qa))&&Da(la);Q.options.store!==C.StoreResults.MIN&&(null==Y.dist||Qa>Y.dist)&&(null==S||S(T,U,Qa))&&Da(Y);Q.options.store!==C.StoreResults.ALL||null!=S&&!S(T,U,Qa)||(ra=new J,ea.push(Da(ra)))}}});const fa=sa=>{const {layerUid:qa,node:Ha,pointId:Ga}=sa;return{point:sa.point,layerUid:qa,graphicUid:Ga,createGraphic:()=>this._params.createGraphic(Ha,Ga,sa.point)}},
ja=(sa,qa)=>{const Ha=fa(qa);sa.set(this.type,Ha,qa.dist,qa.normal)};if(M(la)){var oa=Q.results.min;(null==oa.dist||la.dist<oa.dist)&&ja(oa,la)}M(Y)&&Q.options.store!==C.StoreResults.MIN&&(oa=Q.results.max,(null==oa.dist||Y.dist>oa.dist)&&ja(oa,Y));if(Q.options.store===C.StoreResults.ALL){oa=h.fromPoints(T,U);for(const sa of ea){const qa=u.newIntersectorResult(oa);ja(qa,sa);Q.results.all.push(qa)}}};O.prepareTechnique=function(Q){if(0===this.nodes.length||Q.pass!==z.RenderPass.MATERIAL&&Q.pass!==
z.RenderPass.MATERIAL_DEPTH&&Q.pass!==z.RenderPass.MATERIAL_HIGHLIGHT)return null;this.nodes.forAll(T=>{null==T.vao&&this._initNode(Q,T)});const S=this._getSizeParams();this._techniqueConfig.drawScreenSize=S.drawScreenSpace;this._techniqueConfig.hasSlicePlane=this._slicePlaneEnabled;this._techniqueConfig.hasOccludees=Q.bindParameters.hasOccludees;this._techniqueConfig.output=Q.pass===z.RenderPass.MATERIAL_DEPTH?t.ShaderOutput.Depth:Q.pass===z.RenderPass.MATERIAL_HIGHLIGHT?t.ShaderOutput.Highlight:
t.ShaderOutput.Color;return this._techniqueRep.releaseAndAcquire(p.PointRendererTechnique,this._techniqueConfig,this._technique)};O.render=function(Q,S){const T=Q.rctx,U=T.bindTechnique(S,H,Q.bindParameters),aa=Q.bindParameters.camera,W=this._clipBox,R=!d.equals(W,d.POSITIVE_INFINITY,(ca,ha)=>ca===ha);R||(n.set(this.tempVec3,-Infinity,-Infinity,-Infinity),U.setUniform3fv("clipMin",this.tempVec3),n.set(this.tempVec3,Infinity,Infinity,Infinity),U.setUniform3fv("clipMax",this.tempVec3));const V=this._getSizeParams(),
da=aa.pixelRatio;V.drawFixedSize&&U.setUniform2f("pointScale",V.fixedSize*da,aa.fullHeight);this.nodes.forAll(ca=>{if(0!==ca.coordinates.length&&(!Q.isHighlightPass||ca.highlights)){U.setUniform2f("screenMinMaxSize",V.screenMinSize*da,(ca.isLeaf?256:64)*da);V.drawFixedSize||U.setUniform2f("pointScale",ca.splatSize*this._scaleFactor*da,aa.fullHeight/da);var ha=ca.origin;R&&(n.set(this.tempVec3,W[0]-ha[0],W[1]-ha[1],W[2]-ha[2]),U.setUniform3fv("clipMin",this.tempVec3),n.set(this.tempVec3,W[3]-ha[0],
W[4]-ha[1],W[5]-ha[2]),U.setUniform3fv("clipMax",this.tempVec3));l.fromTranslation(this.tempMatrix4,ha);l.multiply(this.tempMatrix4,aa.viewMatrix,this.tempMatrix4);U.setUniformMatrix4fv("modelView",this.tempMatrix4);S.bindDraw(new x.SlicePlaneParameters(ha),Q.bindParameters);T.bindVAO(ca.vao);Q.isHighlightPass?this._renderHighlightFragments(T,ca):T.drawArrays(E.PrimitiveType.POINTS,0,ca.coordinates.length/3)}})};O._renderHighlightFragments=function(Q,S){var T=S.highlights;if(!c.isNone(T)){S=c.unwrap(T[0].component);
var U=S+1;for(let aa=1;aa<T.length;aa++){const W=c.unwrap(T[aa].component);W!==U&&(U-=S,0<U&&Q.drawArrays(E.PrimitiveType.POINTS,S,U),S=W);U=W+1}T=U-S;0<T&&Q.drawArrays(E.PrimitiveType.POINTS,S,T)}};O.addNode=function(Q){this.nodes.push(Q);this._highlights.nodeAdded(Q);this._requestRender()};O.removeNode=function(Q){let S=null;this.nodes.filterInPlace(T=>T.id===Q?(S=T,T.vao=c.disposeMaybe(T.vao),this._highlights.nodeRemoved(T),!1):!0);this._requestRender();return S};O.forEachNode=function(Q){this.nodes.forAll(Q)};
O.removeAll=function(){this.nodes.forAll(Q=>Q.vao=c.disposeMaybe(Q.vao));this._highlights.removeAll();this.nodes.clear();this._requestRender()};O.highlight=function(Q){return this._highlights.add(Q)};O._addHighlight=function(Q,S,T){var U=Q.highlights;c.isNone(U)&&(U=[]);S={component:S,id:T};U.push(S);S=K(S);for(T=U.length-1;0<T&&S<K(U[T-1]);)[U[T-1],U[T]]=[U[T],U[T-1]],--T;Q.highlights=U;this._requestRender()};O._removeHighlight=function(Q,S){Q.highlights=N(Q.highlights,S);this._requestRender()};
O._initNode=function(Q,S){Q=Q.rctx;S.vao=new F.VertexArrayObject(Q,q.Default3D,L,{positions:D.BufferObject.createVertex(Q,E.Usage.STATIC_DRAW,S.coordinates),colors:D.BufferObject.createVertex(Q,E.Usage.STATIC_DRAW,S.rgb)})};O._requestRender=function(){this._context&&this._context.requestRender()};O._getSizeParams=function(){const Q=this._useFixedSizes,S=Q&&!this._useRealWorldSymbolSizes;return{drawScreenSpace:S,drawFixedSize:Q,fixedSize:S?this._sizePx:this._size,screenMinSize:Q?0:this._minSizePx}};
b._createClass(I,[{key:"needsHighlight",get:function(){return this._highlights.hasHighlights}},{key:"useFixedSizes",get:function(){return this._useFixedSizes},set:function(Q){this._useFixedSizes!==Q&&(this._useFixedSizes=Q,this._requestRender())}},{key:"scaleFactor",get:function(){return this._scaleFactor},set:function(Q){this._scaleFactor!==Q&&(this._scaleFactor=Q,this._requestRender())}},{key:"minSizePx",get:function(){return this._minSizePx},set:function(Q){this._minSizePx!==Q&&(this._minSizePx=
Q,this._requestRender())}},{key:"useRealWorldSymbolSizes",get:function(){return this._useRealWorldSymbolSizes},set:function(Q){this._useRealWorldSymbolSizes!==Q&&(this._useRealWorldSymbolSizes=Q,this._requestRender())}},{key:"size",get:function(){return this._size},set:function(Q){this._size!==Q&&(this._size=Q,this._requestRender())}},{key:"sizePx",get:function(){return this._sizePx},set:function(Q){this._sizePx!==Q&&(this._sizePx=Q,this._requestRender())}},{key:"clippingBox",set:function(Q){d.set(this._clipBox,
Q||d.POSITIVE_INFINITY)}},{key:"slicePlaneEnabled",get:function(){return this._slicePlaneEnabled},set:function(Q){this._slicePlaneEnabled!==Q&&(this._slicePlaneEnabled=Q,this._requestRender())}}]);return I}();let J=function(){this.normal=this.dist=this.point=this.pointId=this.node=null;this.layerUid=""};const H=new B.NoParameters;a.PointRenderer=A;a.isInstanceOfNode=function(I){return I.hasOwnProperty("splatSize")};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/layers/i3s/PointHighlights":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/handleUtils ../../../../core/maybe ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Object3DStateID".split(" "),function(a,b,c,m,l,r){let n=function(){function k(d){this._context=d;this._highlights=new Set}var f=k.prototype;f.destroy=function(){this._highlights=null};f.add=function(d){const e=new g(d);this._highlights.add(e);this._enableSet(e);return c.makeHandle(()=>
this._removeSet(e))};f._removeSet=function(d){this._disableSet(d);this._highlights.delete(d)};f._enableSet=function(d){d.enabled||(d.enabled=!0,this._context.forEachNode(e=>this._enableSetForNode(d,e)))};f._enableSetForNode=function(d,e){if(d.enabled){var h=d.ids.get(e.id);h&&h.forEach(v=>this._context.addHighlight(e,v,d.id))}};f._disableSet=function(d){d.enabled&&(d.enabled=!1,this._context.forEachNode(e=>this._disableSetForNode(d,e)))};f._disableSetForNode=function(d,e){d.enabled||this._context.removeHighlight(e,
d.id)};f.nodeAdded=function(d){this._highlights.forEach(e=>this._enableSetForNode(e,d))};f.nodeRemoved=function(d){this._highlights.forEach(e=>this._disableSetForNode(e,d))};f.removeAll=function(){this._highlights.forEach(d=>this._disableSet(d))};b._createClass(k,[{key:"hasHighlights",get:function(){return 0<this._highlights.size}}]);return k}(),g=function(){function k(f){this.id=new r.Object3DStateID(l.Object3DState.Highlight);this.ids=new Map;this.enabled=!1;for(const d of f)m.isSome(d)&&this._add(d.nodeId,
d.pointId)}k.prototype._add=function(f,d){const e=this.ids.get(f);e?e.add(d):this.ids.set(f,new Set([d]))};return k}();a.PointHighlights=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/PointRendererTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../../chunks/PointRenderer.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){l=function(e){function h(w,t,x){return e.call(this,w,t,x)||this}c._inheritsLoose(h,e);var v=h.prototype;v.initializeProgram=function(w){const t=h.shader.get().build(this.configuration);return new n.Program(w.rctx,t,r.Default3D)};v.initializePipeline=function(){return d.makePipelineState({depthTest:{func:f.CompareFunction.LESS},depthWrite:d.defaultDepthWriteParams,colorWrite:d.defaultColorWriteParams,stencilWrite:this.configuration.hasOccludees?g.stencilWriteMaskOn:
null,stencilTest:this.configuration.hasOccludees?g.stencilBaseAllZerosParams:null})};return h}(l.ShaderTechnique);l.shader=new m.ReloadableShaderModule(k.PointRendererShader,()=>new Promise((e,h)=>a(["./PointRenderer.glsl"],e,h)));b.PointRendererTechnique=l;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/PointRenderer.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float2Uniform ../views/3d/webgl-engine/core/shaderModules/Float3Uniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/Matrix4Uniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h){function v(t){const x=new e.ShaderBuilder,B=t.output===b.ShaderOutput.Color,q=t.output===b.ShaderOutput.Depth,u=t.output===b.ShaderOutput.Highlight,{vertex:C,fragment:z}=x;x.extensions.add("GL_OES_standard_derivatives");x.include(c.SliceDraw,t);x.attributes.add(h.VertexAttribute.POSITION,"vec3");x.attributes.add(h.VertexAttribute.COLOR,"vec3");C.uniforms.add(new d.Matrix4Uniform("modelView"));C.uniforms.add(new f.Matrix4PassUniform("proj",(A,p)=>p.camera.projectionMatrix));
C.uniforms.add(new n.Float2Uniform("screenMinMaxSize"));C.uniforms.add(new n.Float2Uniform("pointScale"));C.uniforms.add(new g.Float3Uniform("clipMin"));C.uniforms.add(new g.Float3Uniform("clipMax"));q?(C.uniforms.add(new r.Float2PassUniform("nearFar",(A,p)=>p.camera.nearFar)),x.varyings.add("depth","float")):t.output!==b.ShaderOutput.Highlight&&x.varyings.add("vColor","vec3");C.code.add(k.glsl`
    void main(void) {
      // Move clipped points outside of clipspace
      if (position.x < clipMin.x || position.y < clipMin.y || position.z < clipMin.z ||
        position.x > clipMax.x || position.y > clipMax.y || position.z > clipMax.z) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      if (rejectBySlice(position)) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      // Position in camera space
      vec4 camera = modelView * vec4(position, 1.0);

      float pointSize = pointScale.x;
      vec4 position = proj * camera;
     ${t.drawScreenSize?k.glsl`
      float clampedScreenSize = pointSize;`:k.glsl`
      float pointRadius = 0.5 * pointSize;
      vec4 cameraOffset = camera + vec4(0.0, pointRadius, 0.0, 0.0);
      vec4 positionOffset = proj * cameraOffset;
      float radius = abs(positionOffset.y - position.y);
      float viewHeight = pointScale.y;
      // screen diameter = (2 * r / w) * (h / 2)
      float screenPointSize = (radius / position.w) * viewHeight;
      float clampedScreenSize = clamp(screenPointSize, screenMinMaxSize.x, screenMinMaxSize.y);
      // Shift towards camera, to move rendered point out of terrain i.e. to
      // the camera-facing end of the virtual point when considering it as a
      // 3D sphere.
      camera.xyz -= normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;
      position = proj * camera;`}

     gl_PointSize = clampedScreenSize;
     gl_Position = position;

     ${q?k.glsl`depth = (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);`:""}
     ${B?k.glsl`vColor = color;`:""}
    }
  `);z.include(l.RgbaFloatEncoding,t);u&&x.include(m.OutputHighlight);z.code.add(k.glsl`
    void main(void) {
      vec2 vOffset = gl_PointCoord - vec2(0.5, 0.5);
      float r2 = dot(vOffset, vOffset);

      if (r2 > 0.25) {
        discard;
      }
      ${q?k.glsl`gl_FragColor = float2rgba(depth);`:""}
      ${u?k.glsl`outputHighlight();`:""}
      ${B?k.glsl`gl_FragColor = vec4(vColor, 1.0);`:""}
    }
  `);return x}const w=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}));a.PointRendererShader=w;a.build=v})},"esri/views/3d/webgl-engine/shaders/PointRendererTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),function(a,b,c,m,l,
r){r=function(n){function g(){var k=n.apply(this,arguments)||this;k.output=m.ShaderOutput.Color;k.hasSlicePlane=!1;k.drawScreenSize=!1;k.hasOccludees=!1;return k}b._inheritsLoose(g,n);return g}(r.DefaultTechniqueConfiguration);c.__decorate([l.parameter({count:m.ShaderOutput.COUNT})],r.prototype,"output",void 0);c.__decorate([l.parameter()],r.prototype,"hasSlicePlane",void 0);c.__decorate([l.parameter()],r.prototype,"drawScreenSize",void 0);c.__decorate([l.parameter()],r.prototype,"hasOccludees",void 0);
c.__decorate([l.parameter({constValue:!0})],r.prototype,"hasSliceInVertexProgram",void 0);a.PointRendererTechniqueConfiguration=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/PopupSceneLayerView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Error ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/set ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/fieldUtils ../../../layers/support/popupUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h){a.PopupSceneLayerView=v=>{v=function(w){function t(){return w.apply(this,arguments)||this}b._inheritsLoose(t,w);var x=t.prototype;x._validateFetchPopupFeatures=function(B){const {layer:q}=this,{popupEnabled:u}=q;if(!u)return new m("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:q});if(!h.getFetchPopupTemplate(q,B))return new m("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:q})};x.prepareFetchPopupFeatures=
function(){var B=b._asyncToGenerator(function*(q){});return function(q){return B.apply(this,arguments)}}();x.fetchPopupFeatures=function(){var B=b._asyncToGenerator(function*(q,u){if(q=this._validateFetchPopupFeatures(u))throw q;q=l.isSome(u)?u.clientGraphics:null;if(!q||0===q.length)return[];var C="scene"===this.layer.type&&l.isSome(this.layer.associatedLayer)?this.layer.associatedLayer:this.layer;u=e.unpackFieldNames(this.layer.fieldsIndex,yield h.getRequiredFields(C,h.getFetchPopupTemplate(this.layer,
u)));yield this.prepareFetchPopupFeatures(u);C=new Set;const z=[],A=[];for(const p of q)e.populateMissingFields(u,p,C)?A.push(p):z.push(p);return 0===A.length?z:this.whenGraphicAttributes(A,[...C]).catch(()=>A).then(p=>z.concat(p))});return function(q,u){return B.apply(this,arguments)}}();return t}(v);return v=c.__decorate([d.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],v)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/SceneLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../core/sql/WhereClause ../../../layers/support/FeatureFilter ../../../layers/support/floorFilterUtils ../../../rest/support/Query ./I3SMeshView3D ./II3SMeshView3D ./LayerView3D ./i3s/attributeEditing ./i3s/I3SGeometryUtil ./i3s/I3SMeshViewFilter ./i3s/I3SNode ./i3s/I3SQueryEngine ./i3s/I3SQueryFeatureAdapter ./i3s/I3SQueryFeatureStore ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/PopupSceneLayerView ./support/SceneLayerViewRequiredFields ../support/updatingProperties ../../layers/SceneLayerView ../../support/Scheduler".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N,M){const L=m.getLogger("esri.views.3d.layers.SceneLayerView3D");m=F.defineFieldProperties();t=function(J){function H(){var O=J.apply(this,arguments)||this;O.type="scene-layer-3d";O.lodFactor=1;O.progressiveLoadFactor=1;O._elevationContext="scene";O._isIntegratedMesh=!1;O._supportsLabeling=!0;O._interactiveEditingSessions=new Map;O._queryEngine=null;return O}a._inheritsLoose(H,J);var I=H.prototype;I.initialize=function(){this.fieldsHelper=
new P.SceneLayerViewRequiredFields({layerView:this});this.updatingHandles.add(()=>this.layer.rangeInfos,O=>this._rangeInfosChanged(O),r.initial);this.updatingHandles.add(()=>this.layer.renderer,O=>this.updatingHandles.addPromise(this._rendererChange(O)),r.initial);this.updatingHandles.add(()=>[this.parsedDefinitionExpression,this.filter,this.layer.filter,this.floorFilterClause,this.excludeObjectIdsSorted,l.applySome(this.viewFilter,O=>[O.parsedWhereClause,O.parsedGeometry,O.sortedObjectIds])],()=>
this._filterChange());this.updatingHandles.add(()=>[this.filter,l.applySome(this.viewFilter,O=>O.parsedGeometry)],()=>this._geometryFilterChange());this.handles.add(this.layer.on("apply-edits",O=>this.updatingHandles.addPromise(O.result)));this.handles.add(this.layer.on("edits",O=>this._handleEdits(O)))};I.destroy=function(){this.fieldsHelper=l.destroyMaybe(this.fieldsHelper)};I._rangeInfosChanged=function(O){null!=O&&0<O.length&&L.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};
I.createQuery=function(){const O={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return l.isSome(this.filter)?this.filter.createQuery(O):new w(O)};I.queryExtent=function(O,Q){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(O),null==Q?void 0:Q.signal)};I.queryFeatureCount=function(O,Q){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(O),null==Q?void 0:Q.signal)};I.queryFeatures=function(O,Q){return this._ensureQueryEngine().executeQuery(this._ensureQuery(O),
null==Q?void 0:Q.signal).then(S=>{if(null==S||!S.features)return S;const T=this.layer;for(const U of S.features)U.layer=T,U.sourceLayer=T;return S})};I.queryObjectIds=function(O,Q){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(O),null==Q?void 0:Q.signal)};I._ensureQueryEngine=function(){this._queryEngine||(this._queryEngine=this._createQueryEngine());return this._queryEngine};I._createQueryEngine=function(){const O=u.createGetFeatureExtent(this.view.spatialReference,this.view.renderSpatialReference,
this._collection);return new A.I3SQueryEngine({layerView:this,priority:M.TaskPriority.FEATURE_QUERY_ENGINE,spatialIndex:new y.I3SQueryFeatureStore({featureAdapter:new p.I3SQueryFeatureAdapter({objectIdField:this.layer.objectIdField,attributeStorageInfo:this.layer.attributeStorageInfo,getFeatureExtent:O}),toArray:()=>{const Q=[];this._forAllFeatures((S,T,U)=>{Q.push({id:S,index:T,meta:U});return x.ForAllFeaturesReturnType.CONTINUE},null,x.ForAllFeaturesVisibilityMode.ALL_IN_CLIPPING_AREA);return Q},
forAllFeatures:(Q,S)=>this._forAllFeatures((T,U,aa)=>Q({id:T,index:U,meta:aa}),S,x.ForAllFeaturesVisibilityMode.ALL_IN_CLIPPING_AREA),getFeatureExtent:O,sourceSpatialReference:D.getIndexCrs(this.layer),viewSpatialReference:this.view.spatialReference})})};I.highlight=function(O){const Q=this._highlights;if(O instanceof w){const {set:S,handle:T}=Q.acquireSet();this.queryObjectIds(O).then(U=>Q.setFeatureIds(S,U));return T}return J.prototype.highlight.call(this,O)};I.createInteractiveEditSession=function(O){return q.createInteractiveEditSession(this.attributeEditingContext,
O)};I._createLayerGraphic=function(O){O=new c(null,null,O);O.layer=this.layer;O.sourceLayer=this.layer;return O};I.canResume=function(){return J.prototype.canResume.call(this)&&(!this._controller||this._controller.rootNodeVisible)};I.getFilters=function(){const O=J.prototype.getFilters.call(this),Q=this.excludeObjectIdsSorted;l.isSome(Q)&&O.push(S=>D.objectIdFilter(Q,!1,S));this.floorFilterClause&&this.addSqlFilter(O,this.floorFilterClause,this.logError);this.addSqlFilter(O,this.parsedDefinitionExpression,
this.logError);l.isSome(this.viewFilter)&&this.viewFilter.addFilters(O,this.view,this._controller.crsIndex,this._collection);return O};I.isUpdating=function(){return J.prototype.isUpdating.call(this)||this.layerFilterUpdating};I._ensureQuery=function(O){return this._addDefinitionExpressionToQuery(l.isNone(O)?this.createQuery():w.from(O))};I._handleEdits=function(O){q.processAttributeEdits(this.attributeEditingContext,O)};I.computeNodeFiltering=function(O){const Q=this.viewFilter;return l.isNone(Q)||
Q.isMBSGeometryVisible(O,this.view.spatialReference,this._controller.crsIndex)?z.NodeFilterImpact.Unmodified:z.NodeFilterImpact.Culled};a._createClass(H,[{key:"filter",get:function(){return this._get("filter")},set:function(O){this._set("filter",C.I3SMeshViewFilter.checkSupport(O)?O:null)}},{key:"viewFilter",get:function(){const O=this.filter;if(l.isNone(O)&&l.isNone(this.layerFilter))return null;const Q=this._get("viewFilter");if(l.isNone(Q))return new C.I3SMeshViewFilter({layerFilter:this.layerFilter,
viewFilter:O,layerFieldsIndex:this.layer.fieldsIndex,loadAsyncModule:S=>this._loadAsyncModule(S),applyFilters:()=>this._applyFilters(!0),addSqlFilter:(S,T)=>this.addSqlFilter(S,T,this.logError)});Q.viewFilter=this.filter;Q.layerFilter=this.layerFilter;this.notifyChange("viewFilter");return Q}},{key:"requiredFields",get:function(){var O,Q;return null!=(O=null==(Q=this.fieldsHelper)?void 0:Q.requiredFields)?O:[]}},{key:"floorFilterClause",get:function(){const O=v.getFloorFilterClause(this);return l.isSome(O)?
e.WhereClause.create(O,this.layer.fieldsIndex):null}},{key:"excludeObjectIdsSorted",get:function(){const O=this.layer.excludeObjectIds;return O.length?O.toArray().sort((Q,S)=>Q-S):null}},{key:"lodCrossfadeinDuration",get:function(){var O,Q;return null!=(O=null==(Q=this.view)?void 0:Q.qualitySettings.sceneService["3dObject"].lodCrossfadeinDuration)?O:0}},{key:"lodCrossfadeoutDuration",get:function(){var O,Q;return null!=(O=null==(Q=this.view)?void 0:Q.qualitySettings.sceneService["3dObject"].lodCrossfadeoutDuration)?
O:0}},{key:"lodCrossfadeUncoveredDuration",get:function(){var O,Q;return null!=(O=null==(Q=this.view)?void 0:Q.qualitySettings.sceneService["3dObject"].lodCrossfadeUncoveredDuration)?O:0}},{key:"attributeEditingContext",get:function(){return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:this._getObjectIdField(),forEachNode:O=>this._forAllNodes(Q=>l.isSome(Q)?O(Q.node,Q.featureIds):null),attributeStorageInfo:this.i3slayer.attributeStorageInfo,attributeOverrides:this.attributeOverrides,
getAttributeData:O=>this.getAttributeData(O),setAttributeData:(O,Q)=>this.setAttributeData(O,Q),clearMemCache:()=>this.clearMemCache()}}},{key:"hasGeometryFilter",get:function(){const O=this.viewFilter;return l.isSome(O)&&l.isSome(O.parsedGeometry)}}]);return H}(t.I3SMeshView3D(E.DefinitionExpressionSceneLayerView(G.PopupSceneLayerView(B.LayerView3D(N)))));b.__decorate([n.property({aliasOf:"layer"})],t.prototype,"i3slayer",void 0);b.__decorate([n.property(K.updatingProgress)],t.prototype,"updatingProgress",
void 0);b.__decorate([n.property({type:h})],t.prototype,"filter",null);b.__decorate([n.property({readOnly:!0})],t.prototype,"viewFilter",null);b.__decorate([n.property(m.requiredFields)],t.prototype,"requiredFields",null);b.__decorate([n.property(m.availableFields)],t.prototype,"availableFields",void 0);b.__decorate([n.property()],t.prototype,"fieldsHelper",void 0);b.__decorate([n.property()],t.prototype,"floorFilterClause",null);b.__decorate([n.property()],t.prototype,"excludeObjectIdsSorted",null);
b.__decorate([n.property({readOnly:!0,aliasOf:"view.qualitySettings.sceneService.3dObject.lodFactor"})],t.prototype,"lodFactor",void 0);b.__decorate([n.property({readOnly:!0,aliasOf:"_controller.updatingProgress"})],t.prototype,"updatingProgressValue",void 0);return t=b.__decorate([d.subclass("esri.views.3d.layers.SceneLayerView3D")],t)})},"esri/views/3d/layers/I3SMeshView3D":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../Graphic ../../../core/arrayUtils ../../../core/byteSizeEstimations ../../../core/Collection ../../../core/has ../../../core/Logger ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/scheduling ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat3 ../../../chunks/mat3f32 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/fieldUtils ../../../layers/support/layerUtils ../../../layers/support/SceneModification ../../../renderers/visualVariables/support/visualVariableUtils ../../../support/arcadeOnDemand ../../../symbols/Symbol3D ../../../symbols/support/unitConversionUtils ./I3SMeshViewLabeler ./I3SMeshWorkerHandle ./II3SMeshView3D ./SceneLayerWorker ./graphics/graphicUtils ./i3s/enums ./i3s/Highlights ./i3s/I3SAsyncElevationUpdater ./i3s/I3SAttributeOverrides ./i3s/I3SCrossfadeHelper ./i3s/I3SElevationProvider ./i3s/I3SGeometryUtil ./i3s/I3SIntersectionHandler ./i3s/I3SMaterialUtil ./i3s/I3SNode ./i3s/I3SProjectionUtil ./i3s/I3SUtil ./i3s/IDBCache ./i3s/IDBMockCache ./support/attributeUtils ./support/symbolColorUtils ../support/debugFlags ../support/extentUtils ../support/orientedBoundingBox ../support/updatingProperties ../support/buffer/glUtil ../webgl-engine/collections/Component/ComponentObject ../webgl-engine/collections/Component/SourceGeometry ../webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../webgl-engine/lib/BasisUtil ../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N,M,L,J,H,I,O,Q,S,T,U,aa,W,R,V,da,ca,ha,ia,ka,la,Y,ea,ba,Z,fa,ja,oa,sa,qa,Ha,Ga,pa,Da,ra,Ea,Ia,Ma,Qa,wa,Ja){function Ta(jb){if(h.isNone(jb))return!1;const qb=jb.metallicRoughness;return qb&&0<=qb.baseColorTextureId||qb&&0<=qb.metallicRoughnessTextureId||0<=jb.normalTextureId||0<=jb.emissiveTextureId||0<=jb.occlusionTextureId}function Xa(jb){return h.isSome(jb)&&B.isArrayBuffer(jb.data)}function ma(jb,qb){jb=1024+jb.interleavedVertexData.byteLength+
(jb.indices?jb.indices.byteLength:0)+jb.positionData.data.byteLength+jb.positionData.indices.byteLength;if(h.isSome(qb))for(const ob of qb)h.isSome(ob)&&B.isArrayBuffer(ob.data)&&(jb+=ob.data.byteLength);return jb}function $a(jb,qb){return qb.byteSize>ya?(Oa.warn(`Node is too big to store in IndexedDB cache: ${jb.id} (${qb.byteSize} bytes)`),!1):0<qb.byteSize}function xa(jb){if(0===jb.length)return null;const qb=new Float64Array(10*jb.length);jb.forAll((ob,db)=>{let va=ob.serviceObb;h.isNone(va)&&
(va=Pa,E.copy(va.center,ob.mbs),va.halfSize[0]=va.halfSize[1]=va.halfSize[2]=ob.mbs[3]);ob=10*db;qb[ob+0]=va.center[0];qb[ob+1]=va.center[1];qb[ob+2]=va.center[2];qb[ob+3]=va.halfSize[0];qb[ob+4]=va.halfSize[1];qb[ob+5]=va.halfSize[2];qb[ob+6]=va.quaternion[0];qb[ob+7]=va.quaternion[1];qb[ob+8]=va.quaternion[2];qb[ob+9]=va.quaternion[3]});return qb}function Ka(jb,qb){jb.forEach(ob=>ob.opacity=qb)}const Oa=d.getLogger("esri.views.3d.layers.SceneLayerView3D"),Va=[1,1,1,1];let Ra=function(jb){function qb(ob,
db,va,ta,Fa,Sa,Ya){var cb=jb.call(this)||this;cb.node=ob;cb.featureIds=db;cb.objectHandle=va;cb.cachedRendererVersion=ta;cb.attributeInfo=Fa;cb.material=Sa;cb.textures=Ya;cb.cachedEdgeMaterials=[];cb.edgeMemoryUsage=0;cb.cachedSymbology=null;return cb}c._inheritsLoose(qb,jb);return qb}(ka.NodeCrossfadeMetaData);var za;(function(jb){jb[jb.CastShadows=4]="CastShadows";jb[jb.Pickable=5]="Pickable"})(za||(za={}));const ya=100*g.ByteSizeUnit.MEGABYTES;var Na;(function(jb){jb[jb.ADD=0]="ADD";jb[jb.REMOVE=
1]="REMOVE";jb[jb.UPDATE=2]="UPDATE"})(Na||(Na={}));const Wa=N.create(),bb=M.create(),Aa=M.create(),Pa=Da.create(),ab=[0,0,0,0],fb=new l([0,0,0,0]),hb=[0,0,0,0],kb=M.create(),nb={remove(){},pause(){},resume(){}};b.ElevationMode=void 0;(function(jb){jb[jb.Absolute=0]="Absolute";jb[jb.RelativeToGround=1]="RelativeToGround";jb[jb.OnTheGround=2]="OnTheGround"})(b.ElevationMode||(b.ElevationMode={}));const rb=F.create(),sb=N.create();b.I3SMeshView3D=jb=>{jb=function(qb){function ob(...va){va=qb.call(this,
va)||this;va._elevationProvider=null;va._intersectionHandler=null;va._nodeId2Meta=new Map;va._nodeId2MetaReloading=new Map;va._i3sWasmLoaded=!1;va._snappingSourcesTrackers=[];va._hasLoadedPBRTextures=!1;va._asyncModuleLoading=0;va._addTasks=new Map;va._rendererVersion=0;va._colorVariable=null;va._opacityVariable=null;va._rendererFields=null;va._symbologyFields=null;va._symbologyOverride=null;va._symbologyOverrideFields=null;va._symbolInfos=new Map;va._idbCache=f("enable-feature:idb-mock-cache")?new sa.IDBMockCache:
new oa.IDBCache("esri-scenelayer-cache","geometries");va.holeFilling="auto";va._hasColors=!1;va._hasTextures=!1;va._hasData=!1;va.filter=null;va.slicePlaneEnabled=!1;va._modifications=[];va._layerUrl="";va._cacheKeySuffix=null;va._elevationTask=null;va._arcade=null;va._tmpAttributeOnlyGraphic=new r(null,null,{});va._crossfadeHelper=new ka.I3SCrossfadeHelper(c._assertThisInitialized(va));return va}c._inheritsLoose(ob,qb);var db=ob.prototype;db.initialize=function(){this._preLoadBasis();this.addResolvingPromise(this.i3slayer.indexInfo);
const va=this.view.resourceController;this.attributeOverrides=new ia.I3SAttributeOverrides(this.i3slayer,va.memoryController);this._worker=new aa.I3SMeshWorkerHandle(Fa=>va.schedule(Fa));this.addResolvingPromise(this._worker.promise);this._worker.setLegacySchema(this.layerUid,this.i3slayer.store.defaultGeometrySchema);ja.checkSceneLayerValid(this.i3slayer);ja.checkSceneLayerCompatibleWithView(this.i3slayer,this.view);this._layerUrl=this.i3slayer.parsedUrl.path;this._controller=new L({layerView:this});
this.geoMemoryEstimate=this.texMemoryEstimate=this.gpuMemoryEstimate=0;this._stage=this.view._stage;this._collection=this._stage.renderView.componentObjectCollection;this._highlights=new ca({collection:this._collection,forAllFeatures:Fa=>this._forAllFeatures(Fa,null,W.ForAllFeaturesVisibilityMode.ALL),forAllFeaturesOfNode:(Fa,Sa)=>this._forAllFeaturesOfNode(Fa,Sa)});if(this._isIntegratedMesh||!this.i3slayer.store.defaultGeometrySchema)this._hasComponentData=!1;else{var ta=this.i3slayer.store.defaultGeometrySchema.featureAttributes;
this._hasComponentData=!!(ta&&ta.faceRange&&ta.id)}this._hasVertexColors=null!=this.i3slayer.store.defaultGeometrySchema.vertexAttributes.color&&(null==this.i3slayer.cachedDrawingInfo||!this.i3slayer.cachedDrawingInfo.color);this._isIntegratedMesh||(this._edgeView=this._stage.renderView.ensureEdgeView());this._memCache=this.view.resourceController.memoryController.newCache(this.i3slayer.uid,Fa=>this._deleteComponentObject(Fa));this._intersectionHandler=new ea.I3SIntersectionHandler({layerUid:this.layerUid,
sublayerUid:this.sublayerUid,collection:this._collection,slicePlaneEnabled:this.slicePlaneEnabled,isGround:this._isIntegratedMesh,traverseNodeHierarchy:Fa=>h.isSome(this._controller.index)&&h.isSome(this._controller.index.rootNode)?this._controller.index.traverse(this._controller.index.rootNode,Sa=>{var Ya=Sa.index;Ya=this._nodeId2Meta.get(Ya)||this._nodeId2MetaReloading.get(Ya);return Fa(Sa,h.isSome(Ya)?Ya.objectHandle:null)}):()=>{}});this._elevationProvider=new la({layerView:this,intersectionHandler:this._intersectionHandler});
this._hasLoadedPBRTextures=this._usePBR();this.updatingHandles.add(()=>this.view.clippingArea,()=>this._clippingAreaChanged(),t.initial);this.updatingHandles.add(()=>this.fullOpacity,Fa=>this._opacityChange(Fa));this.updatingHandles.add(()=>this.slicePlaneEnabled,Fa=>this._slicePlaneEnabledChange(Fa));this.updatingHandles.add(()=>this.elevationOffset,(Fa,Sa)=>{this._reloadAll(Sa);this._controller.invalidateVisibilityObbs()});this.updatingHandles.add(()=>this.elevationInfo,(Fa,Sa)=>this._elevationInfoChanged(Fa,
Sa),t.initial);this.updatingHandles.add(()=>this.filter,()=>this._filterChange(),t.initial);this.updatingHandles.add(()=>this.view.qualitySettings.physicallyBasedRenderingEnabled,()=>this._updatePBR());ta=()=>{this._reloadAll();this.clearMemCache()};this.updatingHandles.add(()=>this.rendererTextureUsage,ta);this.updatingHandles.add(()=>this.uncompressedTextureDownsamplingEnabled,ta);this.updatingHandles.add(()=>this.suspended,Fa=>this._suspendedChange(Fa),t.initial);this.updatingHandles.add(()=>this.i3slayer.labelsVisible,
()=>this._labelingChanged(),t.initial);this.updatingHandles.add(()=>this.i3slayer.labelingInfo,()=>this._labelingChanged(),t.initial);this.updatingHandles.add(()=>this._modifications,()=>this._modificationsChanged(),t.initial);this.handles.add([t.watch(()=>Ga.I3S_TREE_SHOW_TILES,Fa=>{if(Fa&&!this._treeDebugger){const Sa=this._controller.crsIndex;(new Promise((Ya,cb)=>a(["./support/I3STreeDebugger"],Ya,cb))).then(({I3STreeDebugger:Ya})=>{!this._treeDebugger&&Ga.I3S_TREE_SHOW_TILES&&(this._treeDebugger=
new Ya({lv:this,view:this.view,nodeSR:Sa}))})}else Fa||Ga.I3S_TREE_SHOW_TILES||(this._treeDebugger=h.destroyMaybe(this._treeDebugger))},t.initial),t.watch(()=>Ga.I3S_SHOW_MODIFICATIONS,()=>this._showModifications(),t.initial)]);this._cacheKeySuffix=ja.getCacheKeySuffix(this.i3slayer.spatialReference,this.view.renderSpatialReference);this._idbCache.init().catch(Fa=>Oa.warn(`Failed to initialize IndexedDB cache: ${Fa}`))};db.destroy=function(){this._clearAddTasks();this._elevationTask=h.destroyMaybe(this._elevationTask);
this.attributeOverrides=h.destroyMaybe(this.attributeOverrides);this._elevationProvider&&(this._elevationProvider.layerChanged(),this.view.elevationProvider.unregister(this._elevationProvider),this._elevationProvider=null);this._intersectionHandler&&(this._stage.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler),this._intersectionHandler=null);const va=this._worker;va&&(va.destroyContext(this.i3slayer.uid).then(()=>va.destroy()),this._worker=null);this._removeAllNodeDataFromStage();
this._memCache=h.destroyMaybe(this._memCache);this._edgeView=this._stage=this._collection=null;this._labeler=h.destroyMaybe(this._labeler);this._treeDebugger=h.destroyMaybe(this._treeDebugger);this._controller=h.destroyMaybe(this._controller);this._highlights.destroy();this._nodeId2Meta.clear();this._nodeId2MetaReloading.clear();this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=
null)};db._memEstimateTextureAdded=function(va){va=va.estimatedTexMemRequired;this.gpuMemoryEstimate+=va;this.texMemoryEstimate+=va;return va};db._memEstimateTextureRemoved=function(va){h.isSome(va)&&(va=va.estimatedTexMemRequired,this.gpuMemoryEstimate-=va,this.texMemoryEstimate-=va)};db._memEstimateGeometryAdded=function(va){va=this._collection.getObjectGPUMemoryUsage(va);this.gpuMemoryEstimate+=va;this.geoMemoryEstimate+=va;return va};db._memEstimateGeometryRemoved=function(va){va=this._collection.getObjectGPUMemoryUsage(va);
this.gpuMemoryEstimate-=va;this.geoMemoryEstimate-=va};db.isNodeLoaded=function(va){return this._nodeId2Meta.has(va)};db.isNodeReloading=function(va){return this._nodeId2MetaReloading.has(va)};db.getUsedMemory=function(){let va=h.isSome(this._labeler)?this._labeler.usedMemory:0;this._nodeId2Meta.forEach(ta=>va+=h.isSome(ta)?ta.node.memory:0);this._nodeId2MetaReloading.forEach(ta=>va+=h.isSome(ta)?ta.node.memory:0);return va};db.getUnloadedMemory=function(){return(h.isSome(this._controller)?this._controller.unloadedMemoryEstimate:
0)+(h.isSome(this._labeler)?this._labeler.unloadedMemoryEstimate:0)};db.ignoresMemoryFactor=function(){return!1};db._labelingChanged=function(){if(!H.areLabelsVisible(this.i3slayer)||!this._supportsLabeling)h.isSome(this._labeler)&&(this._labeler.destroy(),this._labeler=null);else if(!h.isSome(this._labeler)){var va=new U({view:this.view,layer:this.i3slayer,collection:this._collection});this._nodeId2Meta.forEach(ta=>h.isSome(ta)&&this._addMetaToLabeler(va,ta));this._labeler=va}};db._loadAsyncModule=
function(va){++this._asyncModuleLoading;return va.then(ta=>{--this._asyncModuleLoading;return ta},ta=>{--this._asyncModuleLoading;throw ta;})};db._modificationsChanged=function(){if(!this._i3sWasmLoaded&&this.hasModifications)this._i3sWasmLoaded=R.initialize().then(()=>{this._i3sWasmLoaded=!0;this._modificationsChanged();this.notifyUpdate()}),this.notifyUpdate();else if(!0===this._i3sWasmLoaded){var va=this.i3slayer.uid,ta=this.i3slayer.spatialReference;this._worker.setModifications(va,this._layerClippingArea,
this._modifications,ta);var Fa=aa.toWasmModification(this._layerClippingArea,this._modifications,ta);R.setModificationsSync({context:va,modifications:Fa,isGeodetic:ta.isGeographic});this._controller.modificationsChanged();var Sa=this.hasModifications?new v:null;this._nodeId2Meta.forEach((Ya,cb)=>{h.isNone(Ya)?(this._nodeId2Meta.delete(cb),this._controller.updateLoadStatus(cb,!1)):Ya.node.hasModifications?(this._nodeId2Meta.delete(cb),this._nodeId2MetaReloading.set(cb,Ya)):h.isSome(Sa)&&Sa.push(Ya.node)});
h.isSome(Sa)&&this._nodeId2MetaReloading.forEach(Ya=>Sa.push(Ya.node));h.isSome(Sa)&&0<Sa.length&&(this.updateNodeModificationStatus(Sa),Sa.forAll(Ya=>{if(Ya.imModificationImpact!==Z.NodeIMModificationImpact.Culled){const cb=this._nodeId2Meta.get(Ya.index);this._controller.invalidateGeometryVisibility(Ya.index);h.isSome(cb)?(this._nodeId2Meta.delete(Ya.index),this._nodeId2MetaReloading.set(Ya.index,cb)):this._nodeId2Meta.has(Ya.index)&&(this._nodeId2Meta.delete(Ya.index),this._controller.updateLoadStatus(Ya.index,
!1))}}));this.clearMemCache();this._controller.restartNodeLoading();this._showModifications()}};db._showModifications=function(){h.isSome(this._modificationGraphics)&&(this.view.graphics.removeMany(this._modificationGraphics),this._modificationGraphics=null);if(Ga.I3S_SHOW_MODIFICATIONS&&0!==this._modifications.length){var va={clip:[227,227,79,.8],mask:[227,139,79,.8],replace:[139,227,79,.8]},ta={type:"simple-fill",outline:{color:[255,255,255],width:1}};this._modificationGraphics=[];for(const Fa of this._modifications)Fa.geometry.spatialReference=
this.i3slayer.spatialReference,this._modificationGraphics.push(new r({geometry:Fa.geometry,symbol:{...ta,color:va[Fa.type]}}));this.view.graphics.addMany(this._modificationGraphics)}};db._addMetaToLabeler=function(va,ta){va.addNodeMeta(ta,(Fa,Sa)=>this._createAttributes(Fa,Sa))};db._suspendedChange=function(va){va?(this._removeAllNodeDataFromStage(),this.view.elevationProvider&&this.view.elevationProvider.unregister(this._elevationProvider),this._stage.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler)):
(this.view.elevationProvider.register(this._elevationContext,this._elevationProvider),this._stage.sceneIntersectionHelper.addIntersectionHandler(this._intersectionHandler))};db.getLoadedAttributes=function(va){va=this._nodeId2Meta.get(va);if(h.isSome(va)&&h.isSome(va.attributeInfo))return va.attributeInfo.loadedAttributes};db.getAttributeData=function(va){va=this._nodeId2Meta.get(va);if(h.isSome(va)&&h.isSome(va.attributeInfo))return va.attributeInfo.attributeData};db.setAttributeData=function(va,
ta){va=this._nodeId2Meta.get(va);h.isSome(va)&&h.isSome(va.attributeInfo)&&(va.attributeInfo.attributeData=ta,this._attributeValuesChanged(va))};db.updateAttributes=function(){var va=c._asyncToGenerator(function*(ta,Fa,Sa){ta=this._nodeId2Meta.get(ta);h.isSome(ta)&&(yield this.attributeOverrides.apply(ta.featureIds,Fa,Sa),ta.attributeInfo=Fa,this._attributeValuesChanged(ta))});return function(ta,Fa,Sa){return va.apply(this,arguments)}}();db._attributeValuesChanged=function(va){va.cachedRendererVersion=
this._getInvalidRendererVersion();va.filteredIds=null;h.isSome(this._labeler)&&this._labeler.setNodeMetaAttributes(va,(ta,Fa)=>this._createAttributes(ta,Fa));this._updateEngineObject(va)};db.clearMemCache=function(){h.isSome(this._memCache)&&this._memCache.clear()};db.getVisibleNodes=function(){const va=[];this._nodeId2Meta.forEach(ta=>h.isSome(ta)&&va.push(ta.node));return va};db.getLoadedNodeIndices=function(va){this._nodeId2Meta.forEach((ta,Fa)=>va.push(Fa));this._nodeId2MetaReloading.forEach((ta,
Fa)=>va.push(Fa))};db._preLoadBasis=function(){!f("disable-feature:i3s-basis")&&0!==(this.supportedTextureEncodings&da.TextureEncoding.Basis)&&h.applySome(this.i3slayer.textureSetDefinitions,va=>va.some(ta=>ta.formats.some(Fa=>"basis"===Fa.format||"ktx2"===Fa.format)))&&wa.loadBasis()};db._getVertexBufferLayout=function(va,ta){va={hasTexture:Ta(va.params.material),hasNormals:ta.normal,hasRegions:ta.uvRegion};return Ea.glLayout(Ma.createVertexBufferLayout(this._getGeometryParameters(va)))};db._getObjectIdField=
function(){return this.i3slayer.objectIdField||"OBJECTID"};db._findGraphicNodeAndIndex=function(va){const ta=qa.attributeLookup(this.i3slayer.fieldsIndex,va.attributes,this._getObjectIdField());let Fa=null;e.someMap(this._nodeId2Meta,Sa=>{if(h.isNone(Sa))return!1;const Ya=Sa.featureIds.indexOf(ta);if(-1===Ya)return!1;Fa={node:Sa.node,index:Ya};return!0});return Fa};db._getGraphicIndices=function(va,ta){va=this._nodeId2Meta.get(va.index);if(h.isNone(va))return[];const Fa=[],Sa=this._getObjectIdField(),
Ya=this.i3slayer.fieldsIndex;for(const cb of ta)ta=qa.attributeLookup(Ya,cb.attributes,Sa),ta=va.featureIds.indexOf(ta),-1!==ta&&Fa.push(ta);return Fa};db.whenGraphicBounds=function(va){va=this._findGraphicNodeAndIndex(va);if(!va)return Promise.reject();va=this._getAABB(va.node.index,va.index);return h.isNone(va)?Promise.reject():Promise.resolve({boundingBox:va,screenSpaceObjects:[]})};db.getAABBFromIntersectorTarget=function(va){return null==va.nodeIndex||null==va.componentIndex?null:this._getAABB(va.nodeIndex,
va.componentIndex)};db._getAABB=function(va,ta){va=this._nodeId2Meta.get(va);if(h.isNone(va)||null==va.featureIds||ta>=va.featureIds.length)return null;ta=Y.boundingBoxCornerPoints(ta,this._collection,va.objectHandle,new Float64Array(24));if(!K.projectBuffer(ta,this.view.renderSpatialReference,0,ta,this.view.spatialReference,0,8))return null;va=N.empty();N.expandWithBuffer(va,ta,0,8);return va};db.whenGraphicAttributes=function(va,ta){return ja.whenGraphicAttributes(this.i3slayer,va,this._getObjectIdField(),
ta,()=>[...this._nodeId2Meta.values()].filter(h.isSome))};db.getGraphicFromIntersectorTarget=function(va){if(null==va.nodeIndex||null==va.componentIndex)return null;const ta=this._nodeId2Meta.get(va.nodeIndex);return h.isNone(ta)||null==ta.featureIds||va.componentIndex>=ta.featureIds.length?null:this._createGraphic(va.componentIndex,ta)};db._getCacheKey=function(va){return`${this._layerUrl}/v${19}/${va.id}${this._cacheKeySuffix}`};db._getMemCacheKey=function(va,ta=this.elevationOffset){return va+
"#"+ta};db.loadCachedGPUData=function(va){return h.isSome(this._memCache)?this._memCache.pop(this._getMemCacheKey(va.index)):null};db.deleteCachedGPUData=function(va){h.isSome(va)&&this._deleteComponentObject(va)};db._cacheGPUData=function(va,ta=this.elevationOffset){if(h.isNone(this._memCache))this._deleteComponentObject(va);else{var Fa=this._controller.indexDepth-va.node.level;this._memCache.put(this._getMemCacheKey(va.node.index,ta),va,va.node.memory,Fa)}};db.loadMissingTextures=function(va,ta,
Fa,Sa){var Ya;const cb=null!=(Ya=null==va?void 0:va.filter((ib,mb)=>{if(0===(ib.usage&this.rendererTextureUsage))return!1;if(h.isNone(ta))return!0;ib=ba.selectEncoding(ib.encodings,this.supportedTextureEncodings);mb=ta[mb];return h.isNone(mb)||null==mb.data||ib&&mb.encoding!==ib.encoding?!0:!1}))?Ya:[];return 0===cb.length?Promise.resolve(!1):Fa(cb,Sa).then(ib=>{let mb=0;for(let tb=0;tb<va.length;tb++)mb<ib.length&&ib[mb].id===va[tb].id&&(ta[tb]=ib[mb],mb++);return!0})};db.loadCachedNodeData=function(va,
ta,Fa){return this._idbCacheEnabled?this._idbCache.get(this._getCacheKey(va),ta).then(Sa=>{if(null==Sa)return null;if(Sa.nodeVersion!==va.version)return this._idbCache.remove(this._getCacheKey(va)),null;this.elevationInfo.mode===b.ElevationMode.Absolute&&(va.geometryObb=Sa.geometryObb);return this.loadMissingTextures(Sa.requiredTextures,Sa.textureData,Fa,ta).then(Ya=>{Ya&&this._idbCache.initialized&&h.isSome(Sa.textureData)&&(Sa.byteSize=ma(Sa.transformedGeometry,Sa.textureData),Sa.textureData.every(Xa)&&
$a(va,Sa)&&this._idbCache.put(this._getCacheKey(va),Sa).catch(cb=>Oa.warn(`Failed to update node with textures in IndexedDB cache: ${va.id}: ${cb}`)));w.throwIfAborted(ta);return Sa})}):Promise.resolve(null)};db.addNode=function(va,ta,Fa){return"geometryData"in ta?null==ta.geometryBuffer?(this._addNodeMeta(va.index,null),Promise.resolve()):this._addData(va,ta.attributeDataInfo,()=>this._transformNode(va,ta,Fa).then(Sa=>this._safeReschedule(()=>{if(h.isNone(Sa))return va.hasModifications=!1,this._addCachedNodeData(va,
null,Fa);va.hasModifications=Sa.transformedGeometry.hasModifications;const {obb:Ya,componentOffsets:cb,featureIds:ib,transformedGeometry:mb}=Sa;var tb=fa.computeGlobalTransformation(va.mbs,this.elevationOffset,this._controller.crsIndex,this.view.renderSpatialReference),Bb=Da.create([Ya.center.x,Ya.center.y,Ya.center.z],[Ya.extents.x,Ya.extents.y,Ya.extents.z],[Ya.orientation.x,Ya.orientation.y,Ya.orientation.z,Ya.orientation.w]);E.transformMat4(Bb.center,Bb.center,tb);this.elevationInfo.mode===b.ElevationMode.Absolute&&
(va.geometryObb=Bb);ta.geometryData.componentOffsets=cb;ib&&(ta.geometryData.featureIds=Array.from(ib));tb={nodeVersion:va.version,geometryData:ta.geometryData,requiredTextures:ta.requiredTextures,textureData:ta.textureData,transformedGeometry:mb,globalTrafo:tb,geometryObb:Bb,byteSize:ma(mb,ta.textureData)};this._idbCacheEnabled&&this._idbCache.initialized&&$a(va,tb)&&(Bb=h.isSome(tb.textureData)?tb.textureData.map(xb=>Xa(xb)?xb:null):null,this._idbCache.put(this._getCacheKey(va),{...tb,textureData:Bb}).catch(xb=>
Oa.warn(`Failed to store node in IndexedDB cache: ${va.id}: ${xb}`)));return this._addCachedNodeData(va,tb,Fa)},Fa))):Promise.reject()};db.computeVisibilityObb=function(va){return ja.computeVisibilityObb(va,this.view.renderSpatialReference,this._controller.crsIndex,this.i3slayer.spatialReference,this.elevationOffset,this._modifications)};db._transformNode=function(va,ta,Fa){var Sa=ta.geometryData.geometries;const Ya=Array(Sa.length);for(var cb=0;cb<Sa.length;++cb)Ya[cb]=this._getVertexBufferLayout(Sa[cb],
ta.geometryDescriptor);Sa=va.mbs;cb=this.elevationOffset;var ib=this._controller.crsIndex,mb=this._controller.crsVertex;const tb=this.view.renderSpatialReference,Bb=fa.getLocalOrigin(Sa,cb,ib),xb=fa.computeGlobalTransformation(Sa,cb,ib,tb);ib=K.getProjectorName(ib,mb);mb=K.getProjectorName(mb,tb);return h.isNone(ib)||h.isNone(mb)?Promise.resolve(null):this._worker.invoke({context:this.i3slayer.uid,geometryBuffer:ta.geometryBuffer,geometryData:ta.geometryData,geometryDescriptor:ta.geometryDescriptor,
layouts:Ya,localOrigin:Bb,globalTrafo:xb,mbs:Sa,obb:va.serviceObb,elevationOffset:cb,needNormals:!this._isIntegratedMesh&&this._controller.isMeshPyramid,normalReferenceFrame:this.i3slayer.normalReferenceFrame||"none",indexToVertexProjector:ib,vertexToRenderProjector:mb},Fa)};db._setNewNodeOpacity=function(va){this._setNodeOpacity(va,this.nodeCrossfadingEnabled?0:this.fullOpacity)};db.addCachedGPUData=function(va,ta,Fa){this.elevationInfo.mode===b.ElevationMode.Absolute&&(va.geometryObb=Da.clone(this._collection.getComponentObb(ta.objectHandle)));
if(this._controller.isGeometryVisible(va)){h.isSome(this._labeler)&&this._addMetaToLabeler(this._labeler,ta);var Sa=va.index;this._addNodeMeta(Sa,ta);this.updateNodeState(Sa,Fa);this._collection.setObjectVisibility(ta.objectHandle,Ia.State.Visible);this._updateMaterial(ta);this._setNewNodeOpacity(ta);this.elevationInfo.mode!==b.ElevationMode.Absolute&&this._scheduleElevationAlign(va.index);this._updateEngineObject(ta);this._highlights.objectCreated(ta);h.isSome(this._treeDebugger)&&this._treeDebugger.update()}else this._cacheGPUData(ta)};
db.addCachedNodeData=function(va,ta,Fa,Sa){return this._addData(va,Fa,()=>this._addCachedNodeData(va,ta,Sa))};db._addCachedNodeData=function(){var va=c._asyncToGenerator(function*(ta,Fa,Sa){var Ya;if(this.suspended||!this._controller.isGeometryVisible(ta))this._removeNodeStageData(ta.index,this.elevationOffset,this._nodeId2MetaReloading);else if(h.isNone(Fa))this._addNodeMeta(ta.index,null);else{var cb=this._addTasks.get(ta.index),{geometryData:ib,transformedGeometry:mb,globalTrafo:tb}=Fa;yield this.attributeOverrides.apply(ib.featureIds,
cb.attributeInfo,Sa);var Bb=h.isSome(Fa.textureData)?Fa.textureData.filter(Gb=>h.isSome(Gb)&&0!==(Gb.usage&this.rendererTextureUsage)):[];!f("disable-feature:i3s-basis")&&Bb.some(Gb=>h.isSome(Gb)&&(Gb.encoding===da.TextureEncoding.Basis||Gb.encoding===da.TextureEncoding.KTX2))&&(yield wa.loadBasis());ta.memory=0;var {componentOffsets:xb,geometries:Hb,featureIds:Ub}=ib,Mb=this._collection,vb=Hb[0],{layout:Ib,indices:Pb,interleavedVertexData:Sb,positionData:$b,hasColors:Jc}=mb,ac=this._materialParameters(vb,
Ib),rc=xb||new Uint32Array([0,Pb?Pb.length:Sb.byteLength/Ib[0].stride]);rc={vertices:{data:Sb,count:Sb.byteLength/Ib[0].stride,layoutParameters:ac.geometryParams},positionData:{positions:$b.data,indices:$b.indices},indices:Pb,componentOffsets:rc};var hc=vb.transformation?D.clone(vb.transformation):D.create();y.multiply(hc,tb,hc);vb=y.getTranslation(F.create(),hc);hc=A.fromMat4(p.create(),hc);var wc=this.view.renderSpatialReference,xc=this.view.basemapTerrain.spatialReference,sc=F.create(),tc=[1,1,
1];K.localLinearScaleFactors(vb,wc,tc,xc)||Oa.errorOnce("Unsupported coordinate system for IM overlay");K.projectVectorToVector(vb,wc,sc,xc);var lc=Mb.createObject({toMapSpace:P.fromValues(sc[0],sc[1],tc[0],tc[1]),geometry:rc,obb:Fa.geometryObb,transform:{position:vb,rotationScale:hc}}),{textures:Cc,texturePromise:Bc}=this._initMaterialAndTextures(lc,ac.material,Bb,ac.geometryParams.textureCoordinates===Qa.TextureCoordinateAttributeType.Atlas);ta.memory+=this._memEstimateGeometryAdded(lc);ta.memory+=
Cc.reduce((Gb,bc)=>Gb+(h.isSome(bc)?this._memEstimateTextureAdded(bc):0),0);Bb=!!ac.material.hasParametersFromSource;ac="blend"!==ac.material.alphaMode&&1<=ac.material.metallicRoughness.baseColorFactor[3];var Kb=new Ra(ta,Ub,lc,this._getInvalidRendererVersion(),cb.attributeInfo,{hasParametersFromSource:Bb,isOpaque:ac},Cc);cb.meta=Kb;!this._hasTextures&&null!=(Ya=Fa.requiredTextures)&&Ya.some(({usage:Gb})=>0!==(Gb&da.TextureUsage.ColorTextures))&&(this._hasTextures=!0);this._hasData=!0;this._hasColors=
this._hasColors||Jc;this._hasTextures=this._hasTextures||!!ta.resources.texture;this.notifyChange("hasTexturesOrVertexColors");var Dc=this.slicePlaneEnabled;return Promise.all([this._addOrUpdateEdgeRendering(Kb),Bc]).then(([Gb])=>{h.isSome(Gb)&&Gb.updateObjectVisibility(Kb.objectHandle,!1).catch(this._logEdgeViewError);return this._safeReschedule(()=>{var bc=this._addTasks.get(ta.index);if(bc)if(this._addNodeMeta(ta.index,Kb),bc.meta=null,this.suspended)this._removeNodeStageData(ta.index,this.elevationOffset);
else{Mb.setObjectVisibility(lc,Ia.State.Visible);h.isSome(Gb)&&Gb.updateObjectVisibility(Kb.objectHandle,!0).catch(this._logEdgeViewError);Kb.attributeInfo=bc.attributeInfo;bc=Kb.cachedRendererVersion!==this._rendererVersion;var yc=Dc!==this.slicePlaneEnabled;this._updateElevationOffsets(Kb);var Zc=Kb.elevationOffsets;this._updateComponentData(Kb);var Yc=this._applyFiltersToNode(Kb);(bc||h.isSome(Gb)&&(yc||Yc||Zc))&&this._addOrUpdateEdgeRendering(Kb);h.isSome(this._labeler)&&this._addMetaToLabeler(this._labeler,
Kb);this._visibleGeometryChanged(Kb,Na.ADD);this._highlights.objectCreated(Kb);this._updateMaterial(Kb);this._setNewNodeOpacity(Kb);h.isSome(this._treeDebugger)&&this._treeDebugger.update()}},Sa)}).catch(Gb=>{h.isSome(cb.meta)&&(this._cacheGPUData(cb.meta),cb.meta=null);throw Gb;})}});return function(ta,Fa,Sa){return va.apply(this,arguments)}}();db._addNodeMeta=function(va,ta){this._removeNodeStageData(va,this.elevationOffset,this._nodeId2MetaReloading);if(this._nodeId2Meta.has(va)){Oa.error("Removing duplicated node");
const Fa=this._nodeId2Meta.get(va);h.isSome(Fa)&&this._deleteComponentObject(Fa)}else this._controller.updateLoadStatus(va,!0);h.isSome(ta)&&(ta.lodCrossfadeProgress=null,this.nodeCrossfadingEnabled&&Ka(ta.cachedEdgeMaterials,0));this._nodeId2Meta.set(va,ta)};db._updateElevationOffsets=function(va){var ta;const Fa=this.view.renderSpatialReference,Sa=this.elevationInfo;if(h.isNone(Fa)||Sa.mode===b.ElevationMode.Absolute)va.elevationOffsets=null;else{var Ya=this.view.basemapTerrain,cb=this._collection.getObjectTransform(va.objectHandle);
va.elevationOffsets=null!=(ta=va.elevationOffsets)?ta:[];for(ta=0;ta<va.featureIds.length;ta++){this._collection.getComponentAabb(va.objectHandle,ta,sb,!0);E.set(rb,(sb[0]+sb[3])/2,(sb[1]+sb[4])/2,sb[2]);E.transformMat3(rb,rb,cb.rotationScale);E.add(rb,rb,cb.position);const ib=Ya.getElevation(rb[0],rb[1],rb[2],Fa),mb=Sa.mode===b.ElevationMode.OnTheGround?this.view.renderCoordsHelper.getAltitude(rb):0;va.elevationOffsets[ta]=Sa.offset+(h.isSome(ib)?ib-mb:0)}}};db._elevationChanged=function(va){const ta=
this._controller.crsIndex;K.projectBoundingRect(va.extent,va.spatialReference,kb,ta);va=this._controller.updateElevationChanged(kb,ta);h.isNone(va)||va.forAll(Fa=>{h.isSome(this._nodeId2Meta.get(Fa))&&this._scheduleElevationAlign(Fa)})};db._scheduleElevationAlign=function(va){let ta=this._elevationTask;h.isNone(ta)&&(this._elevationTask=ta=new ha.I3SAsyncElevationUpdater(this.view.resourceController.scheduler,Fa=>{Fa=this._nodeId2Meta.get(Fa);h.isSome(Fa)&&(this._updateElevationOffsets(Fa),this._updateComponentData(Fa),
this._updateEdgeRendering(Fa),h.isSome(this._labeler)&&this._labeler.updateLabelPositions(Fa))}));ta.schedule(va)};db._elevationInfoChanged=function(va,ta){const Fa=va.mode!==b.ElevationMode.Absolute,Sa=null!=ta&&ta!==va&&ta.mode!==b.ElevationMode.Absolute;Fa&&!Sa?(this.handles.add(this.view.basemapTerrain.on("elevation-change",Ya=>this._elevationChanged(Ya)),"elevation"),this._controller.removeAllGeometryObbs()):Sa&&!Fa&&this.handles.remove("elevation");this._intersectionHandler.updateElevationAlignState(Fa,
this.view.state.viewingMode);this._nodeId2Meta.forEach(Ya=>{h.isSome(Ya)&&(Sa&&!Fa&&(Ya.node.geometryObb=Da.clone(this._collection.getComponentObb(Ya.objectHandle))),this._updateElevationOffsets(Ya),this._updateComponentData(Ya),this._updateEdgeRendering(Ya),h.isSome(this._labeler)&&this._labeler.updateLabelPositions(Ya))})};db._safeReschedule=function(va,ta){w.throwIfAborted(ta);return this._controller.reschedule(va,ta)};db._materialParameters=function(va,ta){va=h.isSome(va.params.material)?va.params.material:
ba.defaultMaterial();const Fa=ta.some(Ya=>"uvRegion"===Ya.name);ta=ta.some(Ya=>"normalCompressed"===Ya.name);const Sa=Ta(va);return{geometryParams:this._getGeometryParameters({hasTexture:Sa,hasNormals:ta,hasRegions:Fa}),material:va}};db._initMaterialAndTextures=function(va,ta,Fa,Sa){const Ya=this._stage.renderView,cb=Fa.map(mb=>ba.createTexture(mb,ta,Sa,Ya));this._stage.addMany(cb);let ib=null;this._collection.updateMaterial(va,mb=>{ib=ba.configureMaterial(mb,ta,cb,Fa,this.view._stage.renderView.textureRepository,
{rendererTextureUsage:this.rendererTextureUsage,usePBR:this._usePBR(),isIntegratedMesh:this._isIntegratedMesh,slicePlaneEnabled:this.slicePlaneEnabled,viewSpatialReference:this.view.spatialReference});this._updateMaterialOverlay(mb)});return{textures:cb,texturePromise:ib}};db._getGeometryParameters=function(va){return{textureCoordinates:va.hasTexture?va.hasRegions?Qa.TextureCoordinateAttributeType.Atlas:Qa.TextureCoordinateAttributeType.Default:Qa.TextureCoordinateAttributeType.None,colors:this._hasVertexColors,
normals:va.hasNormals&&!this._isIntegratedMesh}};db._addData=function(va,ta,Fa){let Sa=this._addTasks.get(va.index);Sa?Sa.attributeInfo=ta:(Sa={...w.createResolver(),attributeInfo:ta,meta:null},this._addTasks.set(va.index,Sa),Fa().then(Sa.resolve,Sa.reject).then(()=>this._addTasks.delete(va.index)).catch(Ya=>{this._addTasks.delete(va.index);throw Ya;}));return Sa.promise};db._clearAddTasks=function(){this._addTasks.forEach(va=>{h.isSome(va.meta)&&(this._cacheGPUData(va.meta),va.meta=null)});this._addTasks.clear()};
db._clippingAreaChanged=function(){var va=this.view.renderSpatialReference;const ta=this.i3slayer.spatialReference,Fa=M.create();this._renderClippingArea=pa.toBoundingRect(this.view.clippingArea,Fa,va)?Fa:null;va=M.create();this._layerClippingArea=pa.toBoundingRect(this.view.clippingArea,va,ta)?va:null;this._filterChange();this._controller&&this._controller.updateClippingArea(this.view.clippingArea);this._isIntegratedMesh&&this._modificationsChanged()};db._geometryFilterChange=function(){this._controller.geometryFilterChanged(this.hasGeometryFilter)};
db._filterChange=function(){this._applyFilters(!1)};db._applyFilters=function(va){this._filters=this.getFilters();va?this._controller&&this._controller.requestUpdate():this._nodeId2Meta.forEach(ta=>{h.isSome(ta)&&this._applyFiltersToNode(ta)&&(this._addOrUpdateEdgeRendering(ta),this._visibleGeometryChanged(ta,Na.UPDATE))})};db.getFilters=function(){const va=[],ta=this._renderClippingArea;h.isSome(ta)&&va.push((Fa,Sa)=>this._boundingRectFilter(Fa,Sa,ta));return va};db.addSqlFilter=function(va,ta,Fa){if(h.isSome(ta)){const Sa=
ta.fieldNames;va.push((Ya,cb)=>this._sqlFilter(Ya,cb,ta,Sa,Fa))}};db._sqlFilter=function(va,ta,Fa,Sa,Ya){const cb={},ib=this._createLayerGraphic(cb),mb=this.i3slayer.objectIdField,tb=ta.featureIds,Bb=h.isSome(ta.attributeInfo)&&ta.attributeInfo.attributeData;Sa.every(xb=>null!=Bb[xb]||xb===mb)&&ja.filterInPlace(va,tb,xb=>{cb[mb]=tb[xb];for(const Hb of Sa)Hb!==mb&&(cb[Hb]=ja.getCachedAttributeValue(Bb[Hb],xb));try{return Fa.testFeature(ib)}catch(Hb){return Ya(Hb),!1}})};db._boundingRectNodeTest=function(va,
ta){K.projectBoundingSphere(va.node.mbs,this._controller.crsIndex,hb,this.view.renderSpatialReference);return ja.intersectBoundingRectWithMbs(ta,hb)};db._boundingRectFeatureTest=function(va,ta,Fa){this._collection.getComponentAabb(va.objectHandle,ta,Wa);N.toRect(Wa,bb);return M.intersects(Fa,bb)};db._boundingRectFilter=function(va,ta,Fa){var Sa=this._collection;const Ya=this._boundingRectNodeTest(ta,Fa);if(Ya!==ja.MbsIntersectResult.INSIDE)if(Ya===ja.MbsIntersectResult.OUTSIDE)va.length=0;else if(Sa=
Sa.getComponentCount(ta.objectHandle),Sa.invisible+Sa.visible===ta.featureIds.length){var cb=this._transformClippingArea(Aa,Fa,ta.objectHandle);ja.filterInPlace(va,ta.featureIds,ib=>this._boundingRectFeatureTest(ta,ib,cb))}};db._transformClippingArea=function(va,ta,Fa){var Sa=this._collection.getObjectTransform(Fa);Fa=Sa.position;Sa=Sa.rotationScale;va[0]=(ta[0]-Fa[0])/Sa[0];va[1]=(ta[1]-Fa[1])/Sa[4];va[2]=(ta[2]-Fa[0])/Sa[0];va[3]=(ta[3]-Fa[1])/Sa[4];return va};db._addOrUpdateEdgeRendering=function(va,
ta=!0){const Fa=this._edgeView;if(h.isNone(Fa))return Promise.resolve(null);const Sa=va.objectHandle;var Ya=Fa.hasObject(Sa);const {hasEdges:cb,perFeatureEdgeMaterials:ib}=this._getFilteredEdgeMaterials(va),mb={hasSlicePlane:this.slicePlaneEnabled};if(cb&&Ya)return this.nodeCrossfadingEnabled&&(Ya=this.getNodeOpacity(va),Ka(ib,Ya)),Fa.updateAllComponentMaterials(Sa,ib,mb,ta).catch(this._logEdgeViewError),Fa.updateObjectVisibility(Sa,!0).catch(this._logEdgeViewError),Fa.updateAllVerticalOffsets(Sa,
va.elevationOffsets).catch(this._logEdgeViewError),Promise.resolve(Fa);if(cb&&!Ya)return this._collection.addEdges(Sa,Fa,ib,mb).then(tb=>{va.edgeMemoryUsage=tb;va.node.memory+=tb;Fa.updateAllVerticalOffsets(Sa,va.elevationOffsets).catch(this._logEdgeViewError);return Fa});!cb&&Ya&&(va.node.memory-=va.edgeMemoryUsage,va.edgeMemoryUsage=0,Fa.removeObject(Sa));return Promise.resolve(null)};db._logEdgeViewError=function(va){w.isAbortError(va)||Oa.error("Error while processing edges. Edges on this layer might not diplay correctly",
this.i3slayer,va)};db._applyFiltersToNode=function(va){return this._applyFiltersToNodeComponents(va)?(h.isSome(this._labeler)&&this._labeler.applyFilterChange(va),!0):!1};db._applyFiltersToNodeComponents=function(va){const ta=this._collection;var Fa=0===ta.getComponentCount(va.objectHandle).invisible;ta.setAllComponentVisibilities(va.objectHandle,"all");if(0===this._filters.length)return va.filteredIds=null,!Fa;this._updateCachedFilteredIds(va);if(va.filteredIds===va.featureIds)return!Fa;Fa=this._computeFilteredComponentIndices(va);
ta.setAllComponentVisibilities(va.objectHandle,Fa);return!0};db._updateCachedFilteredIds=function(va){if(null==va.filteredIds||va.appliedFilters!==this._filters)va.filteredIds=this._computeFilteredIds(va),va.appliedFilters=this._filters};db._computeFilteredIds=function(va){const ta=va.featureIds.slice();for(const Fa of this._filters)if(Fa(ta,va),0===ta.length)break;return ta.length===va.featureIds.length?va.featureIds:ta};db._computeFilteredComponentIndices=function(va){const ta=[];va.featureIds.forEach((Fa,
Sa)=>{va.filteredIds[ta.length]===Fa&&ta.push(Sa)});return ta};db._removeAllNodeDataFromStage=function(va=this.elevationOffset){this._nodeId2Meta.forEach((ta,Fa)=>this._removeNodeStageData(Fa,va));this._nodeId2MetaReloading.forEach((ta,Fa)=>this._removeNodeStageData(Fa,va,this._nodeId2MetaReloading));this._elevationTask=h.destroyMaybe(this._elevationTask)};db.removeNode=function(va){const ta=this.elevationOffset;this._removeNodeStageData(va,ta);this._removeNodeStageData(va,ta,this._nodeId2MetaReloading);
h.isSome(this._elevationTask)&&this._elevationTask.remove(va)};db._removeNodeStageData=function(va,ta,Fa=this._nodeId2Meta){Fa.has(va)&&this._controller.updateLoadStatus(va,!1);const Sa=Fa.get(va);h.isNone(Sa)?Fa.delete(va):(this._collection.setObjectVisibility(Sa.objectHandle,Ia.State.Hidden),h.isSome(this._edgeView)&&this._edgeView.hasObject(Sa.objectHandle)&&this._edgeView.updateObjectVisibility(Sa.objectHandle,!1).catch(this._logEdgeViewError),this._visibleGeometryChanged(Sa,Na.REMOVE),h.isSome(this._labeler)&&
this._labeler.removeNodeMeta(Sa),Fa.delete(va),this._highlights.objectDeleted(Sa),Fa===this._nodeId2Meta?(this._cacheGPUData(Sa,ta),this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopNodeFading(Sa)):this._deleteComponentObject(Sa),h.isSome(this._treeDebugger)&&this._treeDebugger.update())};db._deleteComponentObject=function(va){h.isSome(this._edgeView)&&this._edgeView.removeObject(va.objectHandle);this._memEstimateGeometryRemoved(va.objectHandle);this._collection.destroyObject(va.objectHandle);
if(va.textures)for(const ta of va.textures)this._memEstimateTextureRemoved(ta),this._stage.remove(ta)};db.updateNodeState=function(va,ta){va=this._nodeId2Meta.get(va);h.isSome(va)&&this._collection.updateMaterial(va.objectHandle,Fa=>Fa.polygonOffsetEnabled=ta===Z.NodeState.Hole)};db._invalidateAllSymbols=function(){this._rendererVersion=ja.addWraparound(this._rendererVersion,1);this._controller&&this._controller.requestUpdate()};db._getInvalidRendererVersion=function(){return ja.addWraparound(this._rendererVersion,
-1)};db._rendererChange=function(){var va=c._asyncToGenerator(function*(ta){this._currentRenderer=ta;this.notifyChange("rendererTextureUsage");this._rendererVersion=ja.addWraparound(this._rendererVersion,1);this._opacityVariable=this._colorVariable=this._rendererFields=null;this._invalidateAllSymbols();ta&&(this._rendererFields=yield ta.getRequiredFields(this.i3slayer.fieldsIndex));this._updateSymbologyFields();!this._arcade&&ta&&"arcadeRequired"in ta&&ta.arcadeRequired&&(this._arcade=yield Q.loadArcade());
if(ta&&"visualVariables"in ta&&ta.visualVariables)for(const Fa of ta.visualVariables)"color"===Fa.type?this._colorVariable=Fa:"opacity"===Fa.type?this._opacityVariable=Fa:Oa.warn(`Unsupported visual variable type for 3D Object Scene Services: ${Fa.type}`);if(ta)for(const Fa of ta.getSymbols())"mesh-3d"!==Fa.type&&Oa.error(`Symbols of type '${Fa.type}' are not supported for 3D Object Scene Services.`);this._controller&&this._controller.requestUpdate()});return function(ta){return va.apply(this,arguments)}}();
db._getCachedEdgeMaterials=function(va){this._hasComponentData&&va.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(va);return va.cachedEdgeMaterials};db._getComponentParameters=function(va){this._hasComponentData&&va.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(va);const ta=va.cachedSymbology;return(Fa,Sa)=>{var Ya,cb;const ib=5*Fa;G.set(Sa.externalColor,ta[ib+0]/255,ta[ib+1]/255,ta[ib+2]/255,ta[ib+3]/255);Sa.externalColorMixMode=ta[ib+
4]&(1<<za.CastShadows)-1;Sa.castShadows=0!==(ta[ib+4]&1<<za.CastShadows);Sa.pickable=0!==(ta[ib+4]&1<<za.Pickable);Sa.elevationOffset=null!=(Ya=null==(cb=va.elevationOffsets)?void 0:cb[Fa])?Ya:0}};db._getSymbolInfo=function(va,ta){ta=va&&va.getSymbol(ta,{arcade:this._arcade});if(!(ta instanceof S))return null;va=ta.id;if(this._symbolInfos.has(va))return this._symbolInfos.get(va);ta=ja.getSymbolInfo(ta);this._symbolInfos.set(va,ta);return ta};db._setSymbologyOverride=function(va,ta){this._symbologyOverride!==
va&&(this._symbologyOverride=va,this._symbologyOverrideFields=ta,this._invalidateAllSymbols(),this._updateSymbologyFields())};db._updateSymbologyFields=function(){this._symbologyFields=h.isSome(this._symbologyOverrideFields)&&0<this._symbologyOverrideFields.length?h.isSome(this._rendererFields)&&0<this._rendererFields.length?J.fixFields(this.i3slayer.fieldsIndex,[...this._rendererFields,...this._symbologyOverrideFields]):this._symbologyOverrideFields:this._rendererFields};db._updateCachedRendererData=
function(va){va.cachedRendererVersion=this._rendererVersion;if(this._hasComponentData){var ta=this._tmpAttributeOnlyGraphic,Fa={};ta.attributes=Fa;var Sa=this._currentRenderer,Ya=h.isSome(va.attributeInfo)&&va.attributeInfo.attributeData,cb=null!=va.featureIds?this.i3slayer.objectIdField:null,ib=null!=Ya&&h.isSome(this._symbologyFields)&&0<this._symbologyFields.length,mb=ib?[]:null,tb=ib?[]:null;if(ib&&h.isSome(this._symbologyFields))for(var Bb of this._symbologyFields){var xb=Ya[Bb];xb&&(mb.push(Bb),
tb.push(xb))}va.cachedSymbology||(va.cachedSymbology=new Uint8Array(5*va.featureIds.length));Ya={color:ab,castShadows:!0,pickable:!0,colorMixMode:Ha.ColorMixModeEnum.Multiply,edgeMaterial:null};Bb=this.fullOpacity;Bb=this.nodeCrossfadingEnabled?this.getNodeOpacity(va):Bb;xb=null;var Hb=Ja.Transparency.OPAQUE,Ub=ja.transparentEdgeMaterial,Mb=0;for(let Sb=0;Sb<va.featureIds.length;Sb++){null!=cb&&(Fa[cb]=va.featureIds[Sb]);if(ib)for(var vb=0;vb<mb.length;vb++)Fa[mb[vb]]=ja.getCachedAttributeValue(tb[vb],
Sb);var Ib=this._getSymbolInfo(Sa,ta);let $b=vb=null;if(Sa&&"visualVariables"in Sa){if(this._colorVariable){var Pb=O.getColor(this._colorVariable,ta,{color:fb,arcade:this._arcade});Pb&&(vb=ab,vb[0]=Pb.r/255,vb[1]=Pb.g/255,vb[2]=Pb.b/255,this._opacityVariable||null===Pb.a||($b=Pb.a))}this._opacityVariable&&($b=O.getOpacity(this._opacityVariable,ta,{arcade:this._arcade}))}Ib&&Ib.material&&(Pb=Ib.material,vb=h.isNone(vb)||h.isNone($b)?V.overrideColor(vb,$b,Pb.color,Pb.alpha,Va,ab):V.overrideColor(vb,
$b,null,null,Va,ab));h.isNone(vb)&&(vb=ab,vb[0]=1,vb[1]=1,vb[2]=1,vb[3]=1);Ya.pickable=!0;Ya.castShadows=Ib?Ib.castShadows:!0;Ya.colorMixMode=Ib&&Ib.material?Ib.material.colorMixMode:Ha.ColorMixModeEnum.Multiply;Ya.edgeMaterial=Ib?Ib.edgeMaterial:null;h.isSome(this._symbologyOverride)&&(Ya.color=vb,this._symbologyOverride(ta,Ya),vb=Ya.color);if(h.isSome(Ya.edgeMaterial)){Ib=0>=vb[3]?Ja.Transparency.INVISIBLE:1<=vb[3]&&(va.material.isOpaque||Ya.colorMixMode===Ha.ColorMixModeEnum.Replace)?Ja.Transparency.OPAQUE:
Ja.Transparency.TRANSPARENT;if(Ya.edgeMaterial!==xb||Ib!==Hb)Ub={...Ya.edgeMaterial,opacity:Bb,objectTransparency:Ib},xb=Ya.edgeMaterial,Hb=Ib;va.cachedEdgeMaterials[Sb]=Ub}else va.cachedEdgeMaterials[Sb]=ja.transparentEdgeMaterial;va.cachedSymbology[Mb+0]=Math.round(255*vb[0]);va.cachedSymbology[Mb+1]=Math.round(255*vb[1]);va.cachedSymbology[Mb+2]=Math.round(255*vb[2]);va.cachedSymbology[Mb+3]=Math.round(255*vb[3]);va.cachedSymbology[Mb+4]=Ya.colorMixMode|+Ya.castShadows<<za.CastShadows|+Ya.pickable<<
za.Pickable;Mb+=5}}};db._getFilteredEdgeMaterials=function(va){var ta=this._getCachedEdgeMaterials(va);this.nodeCrossfadingEnabled||Ka(ta,this.fullOpacity);if(h.isNone(va.filteredIds))return{hasEdges:ta.some(Ya=>Ya!==ja.transparentEdgeMaterial),perFeatureEdgeMaterials:ta};let Fa=0,Sa=!1;ta=ta.map((Ya,cb)=>{if(va.featureIds[cb]!==va.filteredIds[Fa])return ja.transparentEdgeMaterial;Sa=Sa||Ya!==ja.transparentEdgeMaterial;Fa++;return Ya});return{hasEdges:Sa,perFeatureEdgeMaterials:ta}};db._updateComponentData=
function(va){if(this._hasComponentData){var ta=va.objectHandle;va=this._getComponentParameters(va);this._collection.setComponentData(ta,va);this._stage.renderView.requestRender()}};db._reloadAll=function(va=this.elevationOffset){this._removeAllNodeDataFromStage(va);null!=this._controller&&this._controller.restartNodeLoading()};db._opacityChange=function(va){this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopAllNodeFading();this._nodeId2Meta.forEach(ta=>{h.isNone(ta)||(this._collection.updateMaterial(ta.objectHandle,
Fa=>Fa.objectOpacity=va),Ka(ta.cachedEdgeMaterials,va),this._updateEdgeRendering(ta))})};db._updateMaterial=function(va){this._collection.updateMaterial(va.objectHandle,ta=>{ta.commonMaterialParameters.hasSlicePlane=this.slicePlaneEnabled;ta.usePBR=this._usePBR();this._updateMaterialOverlay(ta)})};db._updateMaterialOverlay=function(va){};db._updateEngineObject=function(va){this._updateComponentData(va);this._applyFiltersToNode(va);this._addOrUpdateEdgeRendering(va);this._visibleGeometryChanged(va,
Na.UPDATE)};db._slicePlaneEnabledChange=function(va){this._intersectionHandler&&(this._intersectionHandler.slicePlaneEnabled=va);h.isSome(this._labeler)&&(this._labeler.slicePlaneEnabled=va);this._nodeId2Meta.forEach(ta=>{h.isNone(ta)||(this._collection.updateMaterial(ta.objectHandle,Fa=>{Fa.commonMaterialParameters.hasSlicePlane=va}),this._updateEdgeRendering(ta,!1))})};db._updatePBR=function(){this._nodeId2Meta.forEach(va=>{h.isNone(va)||this._collection.updateMaterial(va.objectHandle,ta=>{ta.usePBR=
this._usePBR()})});this._hasLoadedPBRTextures=!0};db._usePBR=function(){return!this._isIntegratedMesh&&this.view.qualitySettings.physicallyBasedRenderingEnabled};db._updateEdgeRendering=function(va,ta=!0){h.isSome(this._edgeView)&&this._edgeView.hasObject(va.objectHandle)&&this._addOrUpdateEdgeRendering(va,ta)};db._forAllNodes=function(va){this._nodeId2Meta.forEach(va)};db._forAllFeatures=function(va,ta,Fa=W.ForAllFeaturesVisibilityMode.VISIBLE_ONLY){e.someMap(this._nodeId2Meta,Sa=>{if(h.isNone(Sa))return!1;
if(h.isSome(ta))switch(ta(Sa)){case W.ForAllFeaturesReturnType.EXIT:return!0;case W.ForAllFeaturesReturnType.SKIP:return!1}let Ya=W.ForAllFeaturesReturnType.CONTINUE;switch(Fa){case W.ForAllFeaturesVisibilityMode.ALL:Ya=this._forAllFeaturesOfNode(Sa,va);break;case W.ForAllFeaturesVisibilityMode.VISIBLE_ONLY:Ya=this._forVisibleFeaturesOfNode(Sa,va);break;case W.ForAllFeaturesVisibilityMode.ALL_IN_CLIPPING_AREA:Ya=this._forAllFeaturesOfNodeInClippingArea(Sa,va)}return Ya===W.ForAllFeaturesReturnType.EXIT})};
db._forAllFeaturesOfNode=function(va,ta){let Fa=W.ForAllFeaturesReturnType.CONTINUE;const Sa=va.featureIds;for(let Ya=0;Ya<Sa.length&&(Fa=ta(Sa[Ya],Ya,va),Fa!==W.ForAllFeaturesReturnType.EXIT);Ya++);return Fa};db._forVisibleFeaturesOfNode=function(va,ta){let Fa=W.ForAllFeaturesReturnType.CONTINUE;const Sa=va.featureIds;this._collection.forEachVisibleComponent(va.objectHandle,Ya=>{Fa=ta(Sa[Ya],Ya,va);return Fa===W.ForAllFeaturesReturnType.CONTINUE});return Fa};db._forAllFeaturesOfNodeInClippingArea=
function(va,ta){if(h.isNone(this._renderClippingArea))return this._forAllFeaturesOfNode(va,ta);var Fa=this._boundingRectNodeTest(va,this._renderClippingArea);if(Fa===ja.MbsIntersectResult.OUTSIDE)return W.ForAllFeaturesReturnType.CONTINUE;if(Fa===ja.MbsIntersectResult.INSIDE)return this._forAllFeaturesOfNode(va,ta);Fa=W.ForAllFeaturesReturnType.CONTINUE;const Sa=va.featureIds,Ya=ja.getClipRect(this._renderClippingArea,this._collection.getObjectTransform(va.objectHandle));for(let cb=0;cb<Sa.length;cb++){if(!this._boundingRectFeatureTest(va,
cb,Ya))continue;const ib=ta(Sa[cb],cb,va);if(ib===W.ForAllFeaturesReturnType.EXIT)return ib}return Fa};db._createAttributes=function(va,ta){const Fa={};null!=ta.featureIds&&(Fa[this._getObjectIdField()]=ta.featureIds[va]);ta=h.isSome(ta.attributeInfo)&&ta.attributeInfo.attributeData;if(h.isSome(ta))for(const Sa of Object.keys(ta))Fa[Sa]=ja.getCachedAttributeValue(ta[Sa],va);return Fa};db._createGraphic=function(va,ta){return this._createLayerGraphic(this._createAttributes(va,ta))};db.highlight=function(va){const ta=
this._highlights;"number"===typeof va?va=[va]:va instanceof r?va=[va]:va instanceof k&&(va=va.toArray());if(Array.isArray(va)&&0<va.length){if(va[0]instanceof r){const Fa=this.i3slayer.fieldsIndex,Sa=this._getObjectIdField();va=va.map(ib=>qa.attributeLookup(Fa,ib.attributes,Sa));const {set:Ya,handle:cb}=ta.acquireSet();ta.setFeatureIds(Ya,va);return cb}if("number"===typeof va[0]){const {set:Fa,handle:Sa}=ta.acquireSet();ta.setFeatureIds(Fa,va);return Sa}}return nb};db._visibleGeometryChanged=function(va,
ta){this._elevationProvider&&(this._elevationProvider.objectChanged(va.node),null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=x.schedule(()=>{this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle=null})),this._updateSnappingSources(va,ta))};db.getNodeOpacityByIndex=function(va){va=this._nodeId2Meta.get(va);return this.getNodeOpacity(va)};db.getNodeOpacity=function(va){return h.isSome(va)?this._collection.getMaterial(va.objectHandle).objectOpacity:
0};db.isNodeFullyFadedIn=function(va){return this._crossfadeHelper.isNodeFullyFadedIn(va)};db.getNodeCrossfadeMetaData=function(va){return this._nodeId2Meta.get(va)};db.markNodeToRemove=function(va){this._controller&&this._controller.markNodeToRemove(va)};db.removeMarkedNodes=function(){this._controller&&this._controller.removeMarkedNodes()};db.foreachCrossfadeNode=function(va){this._nodeId2Meta.forEach((ta,Fa)=>va(Fa,ta))};db.fadeNode=function(va,ta,Fa){if(this.nodeCrossfadingEnabled){var Sa=this._nodeId2Meta.get(va);
h.isSome(Sa)&&this._crossfadeHelper.fadeNode(va,Sa,ta,Fa)}};db.setNodeOpacityByIndex=function(va,ta){va=this._nodeId2Meta.get(va);h.isSome(va)&&this._setNodeOpacity(va,ta)};db._setNodeOpacity=function(va,ta){this._collection.updateMaterial(va.objectHandle,Fa=>Fa.objectOpacity=ta);this._setNodeEdgeOpacity(va,ta)};db._setNodeEdgeOpacity=function(va,ta){!h.isNone(this._edgeView)&&va.cachedEdgeMaterials&&(Ka(va.cachedEdgeMaterials,ta),va=va.objectHandle,this._edgeView.hasObject(va)&&this._edgeView.updateAllComponentOpacities(va,
ta).catch(this._logEdgeViewError))};db.updateNodeModificationStatus=function(va){var ta=va.length;if(this.hasModifications&&!(0>=ta)&&!0===this._i3sWasmLoaded){ta=this.i3slayer.uid;var Fa=xa(va);if(h.isSome(Fa)){R.filterObbsForModificationsSync({context:ta,buffer:Fa.buffer});const Sa=new Float64Array(Fa.buffer);va.forAll((Ya,cb)=>{cb=R.interpretObbModificationResults(Sa[cb]);Ya.imModificationImpact=cb;cb!==Z.NodeIMModificationImpact.Unmodified&&this._controller.invalidateGeometryVisibility(Ya.index)})}}};
db.notifyUpdate=function(){this.notifyChange("updating")};db.notifyLODUpdate=function(){this._controller.notifyLODUpdate()};db.isUpdating=function(){return!(!this._controller||!this._controller.updating)||!!this._visibleGeometryChangedSchedulerHandle||h.isSome(this._labeler)&&this._labeler.updating||this._crossfadeHelper.updating||this._i3sWasmLoaded instanceof Promise||0<this._asyncModuleLoading||h.isSome(this._elevationTask)&&this._elevationTask.running};db.trackSnappingSources=function(va){var ta=
this;const Fa={events:va,fetchEdgeLocations:function(){var Sa=c._asyncToGenerator(function*(Ya,cb,ib){Ya=ta._nodeId2Meta.get(Ya);if(h.isNone(Ya))throw Error("invalid-node");const {origin:mb,buffer:tb}=yield ta._collection.extractEdgeInformation(Ya.objectHandle,cb,ib);return{locations:tb,type:"components",objectIds:Ya.featureIds,origin:mb}});return function(Ya,cb,ib){return Sa.apply(this,arguments)}}(),remove:()=>{n.removeUnordered(this._snappingSourcesTrackers,Fa)}};this._snappingSourcesTrackers.push(Fa);
this._nodeId2Meta.forEach((Sa,Ya)=>{h.isNone(Sa)||va.add(Ya,Sa.node.renderMbs)});return Fa};db._updateSnappingSources=function(va,ta){const {index:Fa,renderMbs:Sa}=va.node;for(const Ya of this._snappingSourcesTrackers)ta!==Na.REMOVE&&ta!==Na.UPDATE||Ya.events.remove(Fa),ta!==Na.ADD&&ta!==Na.UPDATE||Ya.events.add(Fa,Sa)};c._createClass(ob,[{key:"lodCrossfadeoutDuration",get:function(){return 0}},{key:"lodCrossfadeinDuration",get:function(){return 0}},{key:"lodCrossfadeUncoveredDuration",get:function(){return 0}},
{key:"layerUid",get:function(){return this.i3slayer&&this.i3slayer.uid}},{key:"sublayerUid",get:function(){return null}},{key:"hasTexturesOrVertexColors",get:function(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"}},{key:"rendererTextureUsage",get:function(){return ja.rendererNeedsTextures(this._currentRenderer)?this._usePBR()||this._hasLoadedPBRTextures?da.TextureUsage.AllTexturesPBR:da.TextureUsage.AllTextures:this._usePBR()||this._hasLoadedPBRTextures?
da.TextureUsage.GeometryTexturesPBR:da.TextureUsage.GeometryTextures}},{key:"elevationOffset",get:function(){const va=null!=this.i3slayer?this.i3slayer.elevationInfo:null;if(null!=va&&"absolute-height"===va.mode){const ta=q.getMetersPerVerticalUnitForSR(this.i3slayer.spatialReference),Fa=T.getMetersPerUnit(va.unit);return h.unwrapOr(va.offset,0)*Fa/ta}return 0}},{key:"elevationInfo",get:function(){const va=null!=this.i3slayer?this.i3slayer.elevationInfo:null;if(null==va)return{mode:b.ElevationMode.Absolute,
offset:0};var ta=q.getMetersPerVerticalUnitForSR(this.i3slayer.spatialReference);const Fa=T.getMetersPerUnit(va.unit);ta=h.unwrapOr(va.offset,0)*Fa/ta;switch(va.mode){case "absolute-height":return{mode:b.ElevationMode.Absolute,offset:ta};case "relative-to-ground":return{mode:b.ElevationMode.RelativeToGround,offset:ta};case "on-the-ground":return{mode:b.ElevationMode.OnTheGround,offset:0};default:return{mode:b.ElevationMode.Absolute,offset:0}}}},{key:"supportedTextureEncodings",get:function(){return ba.getSupportedEncodings(this.view._stage.renderView.capabilities)}},
{key:"uncompressedTextureDownsamplingEnabled",get:function(){var va;const ta=null==(va=this.view)?void 0:va.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled;va=0===(this.supportedTextureEncodings&da.TextureEncoding.DDS_S3TC);return ta&&va}},{key:"_idbCacheEnabled",get:function(){return!this._controller.disableIDBCache&&!this.hasModifications&&0===this.elevationOffset&&null!=this._cacheKeySuffix}},{key:"supportsNodeCrossFading",get:function(){var va,ta;return!(null!=(va=this.view)&&
null!=(ta=va._stage)&&ta.renderView.shadowsEnabled)}},{key:"nodeCrossfadingEnabled",get:function(){return this.supportsNodeCrossFading&&(0<this.lodCrossfadeinDuration||0<this.lodCrossfadeoutDuration||0<this.lodCrossfadeUncoveredDuration)}},{key:"nodeFadeoutEnabled",get:function(){return this.supportsNodeCrossFading&&0<this.lodCrossfadeoutDuration}},{key:"hasGeometryFilter",get:function(){return!1}},{key:"performanceInfo",get:function(){const va={displayedNumberOfFeatures:0,maximumNumberOfFeatures:0,
totalNumberOfFeatures:0,core:null,index:0,nodes:this._nodeId2Meta.size,"Total GPU Memory Estimate":(this.gpuMemoryEstimate/1048576).toFixed(1)+"MB","Geometry Memory Estimate":(this.geoMemoryEstimate/1048576).toFixed(1)+"MB","Texture Memory Estimate":(this.texMemoryEstimate/1048576).toFixed(1)+"MB","Unloaded Memory Estimate":(this.getUnloadedMemory()/1048576).toFixed(1)+"MB"};h.isSome(this._memCache)&&(va.MemCache=Math.round(100*this._memCache.hitRate)+"% hit");this._controller&&(this._idbCacheEnabled&&
(va.IDBCache=Math.round(100*this._idbCache.getHitRate())+"% hit"),this._controller.updateStats(va));return va}},{key:"test",get:function(){const va=this;return{controller:this._controller,labeler:this._labeler,get visibleObjectIds(){const ta=[];va._forAllFeatures(Fa=>{ta.push(Fa);return W.ForAllFeaturesReturnType.CONTINUE},null,W.ForAllFeaturesVisibilityMode.VISIBLE_ONLY);ta.sort((Fa,Sa)=>Fa-Sa);return ta},get numNodes(){return va._nodeId2Meta.size}}}},{key:"hasModifications",get:function(){return this._isIntegratedMesh&&
h.isSome(this._layerClippingArea)||this._modifications&&0<this._modifications.length}}]);return ob}(jb);m.__decorate([u.property()],jb.prototype,"_hasLoadedPBRTextures",void 0);m.__decorate([u.property()],jb.prototype,"_asyncModuleLoading",void 0);m.__decorate([u.property()],jb.prototype,"_visibleGeometryChangedSchedulerHandle",void 0);m.__decorate([u.property()],jb.prototype,"view",void 0);m.__decorate([u.property()],jb.prototype,"i3slayer",void 0);m.__decorate([u.property()],jb.prototype,"_controller",
void 0);m.__decorate([u.property()],jb.prototype,"_labeler",void 0);m.__decorate([u.property()],jb.prototype,"updating",void 0);m.__decorate([u.property()],jb.prototype,"suspended",void 0);m.__decorate([u.property()],jb.prototype,"holeFilling",void 0);m.__decorate([u.property(ra.updatingProgress)],jb.prototype,"updatingProgress",void 0);m.__decorate([u.property({readOnly:!0,aliasOf:"_controller.updatingProgress"})],jb.prototype,"updatingProgressValue",void 0);m.__decorate([u.property({readOnly:!0})],
jb.prototype,"hasTexturesOrVertexColors",null);m.__decorate([u.property({readOnly:!0})],jb.prototype,"rendererTextureUsage",null);m.__decorate([u.property()],jb.prototype,"filter",void 0);m.__decorate([u.property({readOnly:!0})],jb.prototype,"elevationOffset",null);m.__decorate([u.property({readOnly:!0})],jb.prototype,"elevationInfo",null);m.__decorate([u.property({type:Boolean})],jb.prototype,"slicePlaneEnabled",void 0);m.__decorate([u.property()],jb.prototype,"supportedTextureEncodings",null);m.__decorate([u.property()],
jb.prototype,"uncompressedTextureDownsamplingEnabled",null);m.__decorate([u.property({type:[I]})],jb.prototype,"_modifications",void 0);m.__decorate([u.property()],jb.prototype,"_elevationTask",void 0);return jb=m.__decorate([z.subclass("esri.views.3d.layers.I3SMeshView3D")],jb)};Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/controllers/I3SOnDemandController":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/has ../../../core/Logger ../../../core/maybe ../../../core/PooledArray ../../../core/Promise ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../dehydratedFeatures ../../support/PromiseQueue ../../../views/ViewingMode ../../../views/3d/layers/i3s/I3SFrameTask ../../../views/3d/layers/i3s/I3SIndex ../../../views/3d/layers/i3s/I3SLodHandling ../../../views/3d/layers/i3s/I3SNode ../../../views/3d/layers/i3s/I3SNodeLoader ../../../views/3d/layers/i3s/I3SStreamDataController ../../../views/3d/layers/i3s/I3SUtil ../../../views/3d/layers/i3s/I3SViewportQueries ../../../views/3d/layers/support/I3SLayerView ../../../views/3d/support/extentUtils ../../../views/3d/support/index ../../../views/support/layerViewUtils ../../../views/support/Scheduler".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N,M){function L(U,aa){return n.isSome(U)&&U.length===aa.length&&U.every(W=>0<=J(aa,W.name))}function J(U,aa){aa=aa.toLowerCase();for(let W=0;W<U.length;W++)if(U[W].name.toLowerCase()===aa)return W;return-1}const H=r.getLogger("esri.layers.graphics.controllers.I3SOnDemandController");c=function(U){function aa(R){R=U.call(this,R)||this;R.screenSizeFactor=0;R.featureTarget=5E4;R.fixedFeatureTarget=!1;R.updating=!0;R.updatingProgress=
1;R.leavesReached=!1;R.scaleVisibilityEnabled=!0;R._featureLOD=1;R._stableFeatureLOD=!1;R._isIdle=!1;R._cameraDirty=!0;R._invisibleDirty=!1;R._newLoadingNodes=new g({deallocator:null});R._loadedNodeScales=new Map;R._modificationsNodeFilteringArray=new g;R._downloadingCount=0;R._loadingNodes=new Map;R._updatingNodes=new Map;R._progressMaxNumNodes=1;R._requiredAttributes=[];R._requiredAttributesDirty=!0;R._updatesDisabled=!1;R.disableIDBCache=!1;R._disableMemCache=!1;R._restartNodeLoading=!1;R._fields=
null;R._attributeStorageInfo=null;R._handles=new m;R._idleQueue=new q.PromiseQueue;R._elevationUpdateNodes=new g({deallocator:null});R._errorCount=0;return R}a._inheritsLoose(aa,U);var W=aa.prototype;W.initialize=function(){const {layerView:R,layer:V}=this;this._disableMemCache=!R.loadCachedGPUData||!R.addCachedGPUData;this._lodHandling=new A(R);this._defaultGeometrySchema=V.store.defaultGeometrySchema;this.disableIDBCache=l("disable-feature:idb-cache");"fields"in V&&(this._fields=V.fields,this._attributeStorageInfo=
V.attributeStorageInfo);this.addResolvingPromise(Promise.all([V.indexInfo,V.when(),R.when()]).then(([da])=>{if(!this.destroyed&&R&&!R.destroyed){var {view:ca}=R,{resourceController:ha}=ca;this._setClippingArea(ca.clippingArea);this.own([d.watch(()=>{var ia,ka;return null==ca?void 0:null==(ia=ca.pointsOfInterest)?void 0:null==(ka=ia.focus)?void 0:ka.renderLocation},ia=>this._pointOfInterestChanged(ia),d.initial),d.watch(()=>ha.memoryController.memoryFactor,()=>this._setCameraDirty(),d.sync),d.watch(()=>
R.suspended,ia=>{const ka=ia?()=>this._updateViewData():()=>this._updateIdleState(!0),la=ia?()=>{}:()=>this._updateIdleState(!1);this._idleStateCallbacks?(ia&&this.cancelNodeLoading(),this.restartNodeLoading(),this._idleStateCallbacks.idleBegin=ka,this._idleStateCallbacks.idleEnd=la):this._idleStateCallbacks=ha.scheduler.registerIdleStateCallbacks(ka,la)},d.initial),C.addTask(R.view.resourceController.scheduler,{update:(ia,ka)=>this._frame(ia,ka),needsUpdate:()=>this.updating}),d.watch(()=>R.uncompressedTextureDownsamplingEnabled,
()=>this.restartNodeLoading()),d.watch(()=>[this.featureTarget,this.fixedFeatureTarget],()=>{this._setCameraDirty();this._stableFeatureLOD=!1}),d.watch(()=>{var ia;return null==(ia=ca.state)?void 0:ia.contentCamera},()=>this._setCameraDirty()),d.watch(()=>V.elevationInfo,ia=>this._elevationInfoChanged(ia)),d.watch(()=>V.effectiveScaleRange,()=>this._scaleBoundsChanged()),d.watch(()=>R.lodFactor,()=>this._setCameraDirty()),d.watch(()=>R.availableFields,()=>this._requiredFieldsChange()),d.watch(()=>
R.holeFilling,ia=>n.isSome(this._index)&&(this._index.holeFilling=ia))]);this._updateScaleHandles();this._viewportQueries=new F(this.crsIndex,ca.renderCoordsHelper,ca.state.contentCamera,!ca.state.fixedContentCamera||this.isGraphics3D,this._clippingArea,this.isMeshPyramid?ca.basemapTerrain:ca.elevationProvider,u.viewingModeFromString(ca.viewingMode),this.layer.elevationInfo,{progressiveLoadFactor:this._getProgressiveLoadFactor(),screenspaceErrorBias:this.lod,angleDependentLoD:.5>this.lod});this._index=
new z.I3SIndex(V,da,this.indexStreamController,this._viewportQueries,H,R.holeFilling,ia=>R.isNodeLoaded(ia),ia=>R.isNodeReloading(ia),ia=>this._shouldLoadNode(ia),ia=>this._enableFromGPUCache(ia,p.NodeState.Leaf),ia=>this._needsUpdate(ia),()=>!this.indexStreamController.busy,ia=>R.computeVisibilityObb?R.computeVisibilityObb(ia):null,null!=R&&R.computeNodeFiltering?ia=>R.computeNodeFiltering(ia):void 0);this._index.updateElevationInfo(this.layer.elevationInfo,this.isMeshPyramid);this._index.imModificationsChanged(!!R.hasModifications);
this._startNodeLoading()}}));this._tmpPoint=B.makeDehydratedPoint(0,0,0,this.crsIndex)};W.updateNodeModificationStatus=function(R){const V=this._index,da=this.layerView;n.isSome(V)&&null!=da&&da.updateNodeModificationStatus&&(this._modificationsNodeFilteringArray.clear(),R.forAll(ca=>{ca=V.getNode(ca);n.isSome(ca)&&this._modificationsNodeFilteringArray.push(ca)}),da.updateNodeModificationStatus(this._modificationsNodeFilteringArray),this._invisibleDirty=!0)};W.destroy=function(){this.cancelNodeLoading();
this._idleStateCallbacks&&(this._isIdle=!1,this._idleStateCallbacks.remove(),this._idleStateCallbacks=null);this._handles.destroy();this._nodeLoader=null;I.prune();n.isSome(O)&&(O.hide(),O=null)};W._getRequiredAttributes=function(){if(null==this._attributeStorageInfo||!this._fields||!this.layerView.availableFields)return[];const R=this._attributeStorageInfo,V=this._fields,da=this.layer.objectIdField;return this.layerView.availableFields.map(ca=>{const ha=J(R,ca);ca=J(V,ca);return 0<=ha&&0<=ca?{index:ha,
name:V[ca].name,field:V[ca],attributeStorageInfo:R[ha]}:null}).filter(ca=>null!=ca&&ca.name!==da)};W._requiredFieldsChange=function(){const R=this._getRequiredAttributes();L(this._requiredAttributes,R)||(this._requiredAttributes=R,this._requiredAttributesDirty=!1,this.restartNodeLoading())};W.requestUpdate=function(){this._requiredAttributesDirty=!0;this.restartNodeLoading()};W._setClippingArea=function(R){const V=x.create();P.toBoundingRect(R,V,this.layerView.view.renderSpatialReference)?this._clippingArea=
V:this._clippingArea=null};W._pointOfInterestChanged=function(R){n.isSome(this._viewportQueries)&&(this._viewportQueries.setPointOfInterest(R),n.isSome(this._index)&&(this._index.progressiveLoadPenalty=Q.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestUpdate()))};W.updateClippingArea=function(R){this._setClippingArea(R);n.isSome(this._viewportQueries)&&n.isSome(this._index)&&(this._viewportQueries.updateClippingArea(this._clippingArea),this._index.invalidateVisibilityCache());
this._setCameraDirty()};W._setCameraDirty=function(){this._cameraDirty=!0;this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()};W.updateElevationChanged=function(R,V){const da=this._index;if(n.isNone(da)||n.isNone(da.rootNode))return null;const ca=this._elevationUpdateNodes;ca.clear();E.findIntersectingNodes(R,V,da.rootNode,this.crsIndex,da,ha=>ca.push(ha.index));ca.length&&(ca.forAll(ha=>da.updateElevationChanged(ha)),this._setCameraDirty());return ca};W.getParentIndex=function(R){return n.isSome(this._index)&&
this._index.getParentIndex(R)};W.removeAllGeometryObbs=function(){n.isSome(this._index)&&this._index.removeAllGeometryObbs()};W._elevationInfoChanged=function(R){n.isNone(this._index)||(this._index.updateElevationInfo(R,this.isMeshPyramid),this._setCameraDirty())};W._updateScaleHandles=function(){this._handles.remove("scale-bounds");this.areScaleBoundsActive&&this._handles.add(this.layerView.view.basemapTerrain.on("scale-change",R=>this._scaleUpdateHandler(R)),"scale-bounds")};W._scaleBoundsChanged=
function(){this.areScaleBoundsActive||this._loadedNodeScales.clear();this._updateScaleHandles();this._setCameraDirty()};W._scaleUpdateHandler=function(R){this._updateScaleInBoundingRect(R.extent,R.spatialReference);this._setCameraDirty()};W._updateScaleInBoundingRect=function(R,V){const da=this._index;n.isNone(da)||!n.isNone(da.rootNode)&&t.projectBoundingRect(R,V,S,this.crsIndex)&&this._loadedNodeScales.forEach((ca,ha)=>{ca=da.getNode(ha);n.isSome(ca)&&x.intersectsSphere(S,ca.mbs)&&this._loadedNodeScales.set(ha,
this._computeScale(ca))})};W.restartNodeLoading=function(){this._restartNodeLoading=!0;this.cancelNodeLoading();this._evaluateUpdating()};W.schedule=function(R,V){return this._idleQueue.push(R,V)};W.reschedule=function(R,V){return this._idleQueue.unshift(R,V)};W._frame=function(R,V){if(this.layerView.suspended)return this._updateViewData(),this._evaluateUpdating(),-Infinity;if(!this.layerView.visible||n.isNone(this._index))return-Infinity;this._processLogError(R,V);return this._index.getPriority()};
W._processLogError=function(R,V){try{this._process(R,V)}catch(da){50>this._errorCount?H.error("Error during processing: "+da):50===this._errorCount&&H.error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}};W._process=function(R,V){this._restartNodeLoading&&this._startNodeLoading();null==this._nodeLoader||n.isNone(this._index)||(this._updateViewData(),this._invisibleDirty&&this._removeInvisibleNodes(R)&&(this._invisibleDirty=!1),this.isIntegratedMesh&&(R.enabled=
!1),R.run(()=>this._processIndex(R)),this._updateFeatureLOD(),R.run(()=>this._processCache(R)),this.isIntegratedMesh&&(R.enabled=!0),R.run(()=>this._processNodes(R,V)),this._idleQueue.runTask(R),R.run(()=>this._prefetchIndex()),V.numIndexLoading+=this._index.getIndexLoading(),V.numNodesLoading+=this._downloadingCount,R.run(()=>this._lodHandling.lodGlobalHandling(R)),this._evaluateUpdating())};W._processIndex=function(R){if(n.isNone(this._index))return!1;this._index.dirty&&(this._newLoadingNodes.clear(),
this._index.update(Array.from(this._loadingNodes.keys()),R,V=>this.updateNodeModificationStatus(V)),this._disableMemCache||(this._newLoadingNodes.pushArray(this._index.updates.add.data,this._index.updates.add.length),this._newLoadingNodes.pushArray(this._index.updates.missing.data,this._index.updates.missing.length)),R=this._index.featureEstimate.leavesReached,this._index.isLoading()||R===this._get("leavesReached")||this._set("leavesReached",R));return this._index.load()};W._prefetchIndex=function(){return n.isNone(this._index)||
0<this._loadingNodes.size||0<this._index.updates.add.length?!1:this._index.prefetch()};W._updateFeatureLOD=function(){if(this.useMaximumNumberOfFeatures&&!n.isNone(this._index)&&!n.isNone(this._viewportQueries)){var R=!this._index.isLoading(),V=this.featureTarget*this.baseLOD,da=this._index.featureEstimate;da.estimate=da.estimate||V/2;if(500<this._index.getIndexMissing()){if(1E-4>=this._featureLOD)return;this._featureLOD/=1.5;this._stableFeatureLOD=!1}else if(R&&da.estimate<V){if(da.leavesReached||
1E4<=this._featureLOD||this._stableFeatureLOD)return;this._featureLOD*=Math.min(10,Math.max(V/da.estimate,1.001));R=this.lod;V=this._index.checkFeatureTarget(V,R);V!==R&&(this._featureLOD=V/this.baseLOD,this._stableFeatureLOD=!0)}else if(da.estimate>1.2*V||R&&da.estimate>V){if(1E-4>=this._featureLOD)return;this._featureLOD/=1+.25*(da.estimate/V-1);this._stableFeatureLOD=!1}else return;this._featureLOD=Math.min(1E4,Math.max(1E-4,this._featureLOD));this._viewportQueries.updateScreenSpaceErrorBias(this.lod);
this._index.requestUpdate()}};W._processCache=function(R){const V=this._index;if(n.isNone(V))return!1;for(;0<this._newLoadingNodes.length&&!R.done;){var da=this._newLoadingNodes.pop();for(da=V.getParent(da);n.isSome(da)&&!this.layerView.isNodeLoaded(da.index)&&this._isNodeInScaleBounds(da);da=V.getParent(da.index))if(this._enableFromGPUCache(da,p.NodeState.Hole)){R.madeProgress();break}}return R.hasProgressed};W._processNodes=function(R,V){if(n.isNone(this._index))return!1;let da=(this._isIdle?100:
2)-this._loadingNodes.size;const ca=this._index.updates;ca.cancel.forEach(this._cancelNode,this);for(ca.cancel=[];0<ca.remove.length&&!R.done;)this.layerView.removeNode(ca.remove.pop()),R.madeProgress();for(;0<ca.update.length&&!R.done;){var ha=this._index.getNode(ca.update.pop());n.isSome(ha)&&(this._updateLoadedNode(ha),R.madeProgress())}for(;0<ca.add.length&&!R.done&&0<da;){--da;ha=this._index.getNode(ca.add.back());if(n.isNone(ha)||ha.cacheState!==p.CacheState.Cached&&!this._hasNodeLoadToken(V))break;
ca.add.pop();this._loadNode(ha);R.madeProgress()}return R.hasProgressed};W._cancelAllNodes=function(){this._loadingNodes.forEach(R=>R.abort());this._loadingNodes.clear();this._updatingNodes.forEach(R=>R.abort());this._updatingNodes.clear()};W._cancelNode=function(R){const V=this._loadingNodes.get(R);V&&(V.abort(),this._loadingNodes.delete(R))};W._hasNodeLoadToken=function(R){return!this._isIdle&&2<=R.numNodesLoading+this._loadingNodes.size?!1:this._downloadingCount<K.maxDownloadSlots&&!this.dataStreamController.busy};
W._evaluateUpdating=function(){var R=!1,V=0;this.layerView.suspended?V=(R=this._cameraDirty)?0:1:(R=n.isSome(this._index)?this._index.getIndexMissing():0,V=n.isSome(this._index)?this._index.updates.add.length:0,V=R+3*V+2*this._loadingNodes.size,R=!!(0<V||0<this._updatingNodes.size||this._restartNodeLoading||this._cameraDirty||this._idleQueue.running||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling),0===V&&(this._progressMaxNumNodes=1),this._progressMaxNumNodes=Math.max(V,this._progressMaxNumNodes),
V=1-V/this._progressMaxNumNodes);this.updating=R;this.updatingProgress=V};W._updateViewData=function(){if(this._cameraDirty&&!n.isNone(this._index)&&!n.isNone(this._viewportQueries)){var R=this.layerView.view,{contentCamera:V,fixedContentCamera:da}=R.state;this.screenSizeFactor=1/(V.perScreenPixelRatio/2);this._viewportQueries.updateCamera(V,!da||this.isGraphics3D);this._viewportQueries.setPointOfInterest(R.pointsOfInterest.focus.renderLocation);this._viewportQueries.updateScreenSpaceErrorBias(this.lod);
this._index.invalidateVisibilityCache();this._index.progressiveLoadPenalty=Q.distancePenalty*this._viewportQueries.distCameraToPOI();this._index.requestUpdate();this._stableFeatureLOD=!1;this._invisibleDirty=!0;this._cameraDirty=!1;this.notifyChange("rootNodeVisible")}};W._getProgressiveLoadFactor=function(){return 1>this.layerView.view.resourceController.memoryController.memoryFactor?1:this.layerView.progressiveLoadFactor};W.isGeometryVisible=function(R){return n.isSome(this._index)&&this._index.isGeometryVisible(R.index)};
W.updateVisibility=function(R){n.isSome(this._index)&&this._index.invalidateNodeVisibilityCache(R)};W.invalidateGeometryVisibility=function(R){n.isSome(this._index)&&this._index.invalidateGeometryVisibility(R)};W.invalidateVisibilityObbs=function(){n.isSome(this._index)&&this._index.invalidateVisibilityObbs()};W.modificationsChanged=function(){n.isSome(this._index)&&this._index.imModificationsChanged(!!this.layerView.hasModifications);this._invisibleDirty=!0};W._shouldLoadNode=function(R){return!this._lodHandling.shouldLoadNode(R)||
this._shouldDropNode(R)||n.isNone(this._index)||!this._index.isGeometryVisible(R.index)?!1:this._isNodeInScaleBounds(R)};W._shouldDropNode=function(R){if(n.isNone(this._viewportQueries))return!1;const V=this.lodDropFactor;return 1<=V||!this._lodHandling.hasNoVisibleChildren(R)?!1:Math.abs(this._viewportQueries.calcCameraDistanceToCenter(R))-this._viewportQueries.minDistance>(this._viewportQueries.maxDistance-this._viewportQueries.minDistance)*V};W._startNodeLoading=function(){this._restartNodeLoading=
!1;const R=this._index;this._updatesDisabled||n.isNone(R)||n.isNone(this._viewportQueries)||(this._updateViewData(),this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1),this._nodeLoader=new y(this.layer,this.dataStreamController,H,this._defaultGeometrySchema,this._requiredAttributes,{textureEncodings:this.layerView.supportedTextureEncodings,uncompressedTextureDownsamplingEnabled:this.layerView.uncompressedTextureDownsamplingEnabled,
textureUsageMask:this.layerView.rendererTextureUsage,loadFeatureData:this.useMaximumNumberOfFeatures}),R.requestUpdate(),this._lodHandling.startNodeLoading(V=>this._isNodeInScaleBounds(V),(V,da)=>this._removeNodes(V,da,T.fadeout),R,{maxLodLevel:this._viewportQueries.maxLodLevel}),this._evaluateUpdating())};W.isNodeLoading=function(){return null!=this._nodeLoader&&null!=this._index};W.cancelNodeLoading=function(){this.isNodeLoading()&&(this.indexStreamController.cancelAll(),this.dataStreamController.cancelAll(),
this._idleQueue.cancelAll(),this._cancelAllNodes(),this._nodeLoader=null,this._evaluateUpdating())};W._removeInvisibleNodes=function(R){const V=this._index;if(n.isNone(V)||n.isNone(this._viewportQueries))return!1;I.clear();this.layerView.getLoadedNodeIndices(I);const da=0===this._viewportQueries.maxDistance,ca=da?()=>!1:ha=>this._shouldDropNode(ha);I.filterInPlace(ha=>{const ia=V.getNode(ha);return n.isNone(ia)||!V.isGeometryVisible(ha)||ca(ia)||!this._isNodeInScaleBounds(ia)});0<I.length&&this._lodHandling.setLodGlobalDirty();
this._removeNodes(I,R,T.pop);if(da&&1>this.lodDropFactor)return!1;if(0===I.length)return!0;I.clear();return!1};W.markNodeToRemove=function(R){I.push(R)};W.removeMarkedNodes=function(){this._removeNodes(I,M.noBudget,T.pop)};W._removeNodes=function(R,V,da){const ca=R.length;if(0!==ca&&!V.done){for(n.isSome(this._index)&&this._index.requestUpdate();0<R.length&&!V.done;){const ha=R.pop(),ia=this._index;da===T.fadeout&&this.layerView.nodeFadeoutEnabled&&n.isSome(ia)&&ia.isGeometryVisible(ha)?this.layerView.fadeNode(ha,
G.FadeDirection.FadeOut,!0):this.layerView.removeNode(ha);V.madeProgress()}if(0<this._loadedNodeScales.size)for(V=R.length;V<ca;V++)this._loadedNodeScales.delete(R.data[V])}};W._needsUpdate=function(R){if(!R.resources.hasFeatureData||this._updatingNodes.has(R.index))return!1;R=this.layerView.getLoadedAttributes(R.index);return null!=R&&R!==this._requiredAttributes};W._updateLoadedNode=function(R){const V=new AbortController;this._updatingNodes.set(R.index,V);const da=this.layerView.getLoadedAttributes(R.index);
(L(da,this._requiredAttributes)?Promise.resolve(this.layerView.getAttributeData(R.index)):this._nodeLoader.loadAttributes(R,this._requiredAttributes,V.signal)).then(ca=>this.schedule(()=>this.layerView.updateAttributes(R.index,{loadedAttributes:this._requiredAttributes,attributeData:ca},V.signal),V.signal)).catch(ca=>{if(!f.isAbortError(ca))return this.layerView.updateAttributes(R.index,{loadedAttributes:this._requiredAttributes,attributeData:{}},V.signal)}).catch(()=>{}).then(()=>{this._updatingNodes.delete(R.index);
this._evaluateUpdating()});this._evaluateUpdating()};W._loadNode=function(R){if(this._loadingNodes.has(R.index))H.error("already loading node "+R.index);else{var V=new AbortController;this._loadingNodes.set(R.index,V);this._evaluateUpdating();this._loadAndAddNode(R,V.signal).then(da=>{da&&n.isSome(this._index)&&this._loadingNodes.get(R.index)===V&&(this._loadingNodes.delete(R.index),this._index.requestUpdate())}).catch(da=>{if(!f.isAbortError(da))throw da;}).finally(()=>{this._loadingNodes.get(R.index)===
V&&this._loadingNodes.delete(R.index);this._evaluateUpdating()})}};W._loadAndAddNode=function(R,V){return R.cacheState===p.CacheState.Uncached?this._loadUncached(R,V).then(()=>!1):this._loadCached(R,V).then(da=>{if(da)return!1;R.cacheState=p.CacheState.Uncached;return!0}).catch(da=>f.isAbortError(da)?!1:(R.cacheState=p.CacheState.Uncached,!0))};W._enableFromGPUCache=function(R,V){if(this._disableMemCache||n.isNone(this._index))return!1;if(V===p.NodeState.Hole&&!this._index.useNodeAsHole(R.index))return!0;
const da=this._loadCachedGPUData(R);if(!da)return!1;this.layerView.addCachedGPUData(R,da,V);this._nodeAdded();return!0};W._loadCachedGPUData=function(R){R=this.layerView.loadCachedGPUData(R);if(n.isSome(R)&&n.isSome(R.attributeInfo)&&L(R.attributeInfo.loadedAttributes,this._requiredAttributes))return R;this.layerView.deleteCachedGPUData(R);return null};W._nodeAdded=function(){n.isSome(this._index)&&this._index.requestUpdate();this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()};W.updateLoadStatus=
function(R,V){const da=this._index;n.isSome(da)&&da.updateChildrenLoaded(R,V?1:-1)};W._loadCached=function(R,V){if(this._enableFromGPUCache(R,p.NodeState.Leaf))return Promise.resolve(!0);const da=this.layerView;return!this.disableIDBCache&&da.loadCachedNodeData&&da.addCachedNodeData?this.schedule(()=>da.loadCachedNodeData(R,V,(ca,ha)=>this._nodeLoader.loadTextures(R,ca,ha)),V).then(ca=>{if(n.isNone(ca))return!1;const ha=this._requiredAttributes;return this.reschedule(()=>this._nodeLoader.loadAttributes(R,
ha,V),V).then(ia=>this.reschedule(()=>da.addCachedNodeData(R,ca,{loadedAttributes:ha,attributeData:ia},V),V)).then(()=>{this._nodeAdded();return!0})}):Promise.resolve(!1)};W._loadUncached=function(R,V){this._downloadingCount++;return this._nodeLoader.loadNodeData(R,V).catch(da=>{this._downloadingCount--;throw da;}).then(da=>{this._downloadingCount--;return this.schedule(()=>this.layerView.addNode(R,da,V),V)}).then(()=>{this._nodeAdded();R.cacheState=p.CacheState.Cached}).catch(da=>{if(!f.isAbortError(da))throw H.error("#loadNodeData()",
this.layer,`Failed to load node '${R.id}'`,da),R.failed=!0,n.isSome(this._index)&&this._index.requestUpdate(),da;})};W._updateIdleState=function(R){R!==this._isIdle&&(this._isIdle=R,this._evaluateUpdating(),R&&this._index&&n.isSome(this._index)&&this._index.resetFailedNodes())};W._getScale=function(R){if(this._loadedNodeScales.has(R.index))return this._loadedNodeScales.get(R.index);const V=this._computeScale(R);this.layerView.isNodeLoaded(R.index)&&this._loadedNodeScales.set(R.index,V);return V};
W._computeScale=function(R){this._tmpPoint.x=R.mbs[0];this._tmpPoint.y=R.mbs[1];this._tmpPoint.z=R.mbs[2];return this.layerView.view.basemapTerrain.getSphereScale(this._tmpPoint,R.mbs[3])};W._isNodeInScaleBounds=function(R){if(!this.areScaleBoundsActive)return!0;R=this._getScale(R);const {minScale:V,maxScale:da}=N.extractSafeScaleBounds(this.layer);return N.scaleBoundsPredicate(R,V,da)};W.updateStats=function(R){R.index=n.isSome(this._index)?this._index.size:0;this.isGraphics3D&&(R.detail=this._featureLOD,
R.target=this.featureTarget*this.baseLOD);n.isSome(this._index)&&this._index.updateStats(R)};W.notifyLODUpdate=function(){this._lodHandling.setLodGlobalDirty();this._evaluateUpdating();n.isSome(this._index)&&this._index.requestUpdate()};W.geometryFilterChanged=function(R){const V=this._index;n.isSome(V)&&V.layerFilterChanged(R);this.requestUpdate()};a._createClass(aa,[{key:"isMeshPyramid",get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType}},{key:"isGraphics3D",
get:function(){return"points"===this.layer.profile}},{key:"useMaximumNumberOfFeatures",get:function(){return!this.isMeshPyramid&&(n.isNone(this.layer.priority)||"High"===this.layer.priority)}},{key:"indexStreamController",get:function(){const R=this.layerView.view.resourceController.createStreamDataRequester(K.ClientType.I3S_INDEX);return new D.I3SStreamDataController(R,this.layer.apiKey)}},{key:"dataStreamController",get:function(){const R=this.layerView.view.resourceController.createStreamDataRequester(K.ClientType.I3S_DATA);
return new D.I3SStreamDataController(R,this.layer.apiKey)}},{key:"crsVertex",get:function(){return E.getVertexCrs(this.layer)}},{key:"crsIndex",get:function(){return E.getIndexCrs(this.layer)}},{key:"layer",get:function(){return this.layerView.i3slayer}},{key:"rootNodeVisible",get:function(){if(n.isSome(this._index)){const R=this._index.rootNode;if(n.isSome(R))return this._updateViewData(),this._index.isNodeVisible(R.index)}return!0}},{key:"index",get:function(){return this._index}},{key:"isIntegratedMesh",
get:function(){return"integrated-mesh"===this.layer.type}},{key:"areScaleBoundsActive",get:function(){const {minScale:R,maxScale:V}=N.extractSafeScaleBounds(this.layer);return this.scaleVisibilityEnabled&&(0<R||0<V)}},{key:"unloadedMemoryEstimate",get:function(){return n.isNone(this._index)||this.layerView.suspended?0:this._index.getUnloadedMemoryEstimate()*this.lodDropFactor}},{key:"indexDepth",get:function(){return n.isSome(this._index)?this._index.maxLevel:0}},{key:"disableMemCache",set:function(R){this.layerView.loadCachedGPUData&&
this.layerView.addCachedGPUData||(this._disableMemCache=!0);this._disableMemCache=R}},{key:"lod",get:function(){return this._featureLOD*this.baseLOD}},{key:"baseLOD",get:function(){const R=this.layerView.lodFactor,V=this.layerView.view.resourceController.memoryController.memoryFactor;return this.fixedFeatureTarget?1:(0<R?R:1)*V}},{key:"lodDropFactor",get:function(){if(this.fixedFeatureTarget)return 1;const R=this.layerView.view.resourceController.memoryController;return(Math.min(R.memoryFactor,.5)-
R.minQuality)/(.5-R.minQuality)}},{key:"test",get:function(){const R=this;return{index:this._index,set disableUpdates(V){(R._updatesDisabled=V)?R.cancelNodeLoading():R.requestUpdate()},set disableIDBCache(V){R.disableIDBCache=V},set ignoreServiceObb(V){n.isSome(R._index)&&(R._index.ignoreServiceObb=V)},shouldLoadNode:V=>R._shouldLoadNode(V)}}}]);return aa}(k.EsriPromiseMixin(c));b.__decorate([e.property({readOnly:!0})],c.prototype,"isMeshPyramid",null);b.__decorate([e.property({readOnly:!0})],c.prototype,
"isGraphics3D",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"useMaximumNumberOfFeatures",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"indexStreamController",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"dataStreamController",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"crsVertex",null);b.__decorate([e.property({readOnly:!0})],c.prototype,"crsIndex",null);b.__decorate([e.property()],c.prototype,"screenSizeFactor",void 0);b.__decorate([e.property()],
c.prototype,"featureTarget",void 0);b.__decorate([e.property()],c.prototype,"fixedFeatureTarget",void 0);b.__decorate([e.property()],c.prototype,"layerView",void 0);b.__decorate([e.property()],c.prototype,"layer",null);b.__decorate([e.property({})],c.prototype,"updating",void 0);b.__decorate([e.property({})],c.prototype,"updatingProgress",void 0);b.__decorate([e.property({readOnly:!0})],c.prototype,"leavesReached",void 0);b.__decorate([e.property({constructOnly:!0})],c.prototype,"scaleVisibilityEnabled",
void 0);b.__decorate([e.property({readOnly:!0,dependsOn:[]})],c.prototype,"rootNodeVisible",null);c=b.__decorate([w.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],c);const I=new g({deallocator:null});let O;const Q={factorIM:.2,factor3dObject:.05,distancePenalty:10},S=x.create();var T;(function(U){U[U.pop=0]="pop";U[U.fadeout=1]="fadeout"})(T||(T={}));return c})},"esri/views/3d/layers/i3s/I3SFrameTask":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/arrayUtils","../../../support/Scheduler"],function(a,b,c,m){let l=function(){function n(k){this.referenceCount=0;this.callbacks=[];this.runIndex=0;this.handle=k.registerTask(m.TaskPriority.I3S_CONTROLLER,this)}var g=n.prototype;g.destroy=function(){this.handle&&(this.handle.remove(),this.handle=null)};g.runTask=function(k){this._sort();const f=this.callbacks,d={numIndexLoading:0,numNodesLoading:0};for(let e=0;e<f.length&&!k.done;++e)f[e].priority=f[e].update(k,d),this.runIndex=e};
g._sort=function(){const k=this.callbacks;let f=k.length;for(let d=this.runIndex;0<d;d--){const e=k[d-1];let h=d;for(;h<k.length&&e.priority<=k[h].priority&&(h!==f||e.priority<k[h].priority);)k[h-1]=k[h],h++;k[h-1]=e;f=h-1}this.runIndex=0};g.add=function(k){this._sort();k.priority=Infinity;this.callbacks.unshift(k)};g.remove=function(k){c.removeUnordered(this.callbacks,k);this.runIndex=this.callbacks.length;this._sort()};b._createClass(n,[{key:"running",get:function(){for(const k of this.callbacks)if(k.needsUpdate())return!0;
return!1}}]);return n}();const r=new Map;a.addTask=function(n,g){let k=r.get(n);null==k&&(k=new l(n),r.set(n,k));k.add(g);return{remove:()=>{null!=k&&(k.remove(g),0<k.callbacks.length||(r.delete(n),k.destroy()),k=null)}}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SIndex":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../chunks/vec3 ../../../../chunks/vec4f64 ./I3SNode ./I3SUtil ../../support/orientedBoundingBox".split(" "),
function(a,b,c,m,l,r,n,g,k,f){function d(z){c.isSome(z.node)&&(k.invalidateMbs(z.node.renderMbs),k.invalidateObb(z.node.serviceObbInRenderSR));c.isSome(z.ref)&&(k.invalidateMbs(z.ref.renderMbs),k.invalidateObb(z.ref.serviceObbInRenderSR))}function e(z,A){return 0===A?0:z/A|0}function h(z,A){return 0===A?z:z%A}function v(z){if(z)for(let A=0;A<z.length;A++)for(const p of u)if(p[0]===z[A].metricType)return{lodMetric:p[1],maxError:z[A].maxError};return{lodMetric:g.LodMetric.None,maxError:0}}function w(z){return Math.sqrt(4/
Math.PI*z)}let t=function(z,A,p,y,D){this.childOffset=z;this.childCount=A;this.visibilityCache=p;this.ref=y;this.node=D;this.useAsHole=0;this.filterImpact=g.NodeFilterImpact.NotChecked},x=function(){function z(p,y,D,E,F,G,P,K,N,M,L,J,H,I){this.streamDataController=D;this.viewportQueries=E;this.logger=F;this.holeFilling=G;this._isLoaded=P;this._isReloading=K;this._isSelected=N;this._enable=M;this._needsUpdate=L;this._canRequest=J;this._computeVisibilityObb=H;this._computeNodeFiltering=I;this._dirty=
!0;this._nodePages=[];this.rootIndex=this.nodesPerPage=this.nodeCount=0;this.lodMetric=g.LodMetric.None;this._lodConversion=O=>O;this.urlPrefix="";this._loading=new Set;this._failedNodes=new Set;this._failedPages=new Set;this._indexMissing=1;this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._maxProcessingPrio=Number.POSITIVE_INFINITY;this._nodeTraversalState=new Map;this._version=k.addWraparound(0,2);this._visibilityCacheVersion=k.addWraparound(0,2);this._maxLevel=1;this._featureEstimate={estimate:0,
leavesReached:!1};this._unloadedMemoryEstimate=0;this._missing=new m({deallocator:null});this._prefetch=new m({deallocator:null});this._updates=new q(this._missing);this._imModificationUncategorized=new m({deallocator:null});this.ignoreServiceObb=!1;this.progressiveLoadPenalty=0;this._pageQueue=[];this._layerHasFilter=this.layerHasModifications=this.needNodeElevationRange=!1;this.logLayer=p;p.serviceUpdateTimeStamp&&p.serviceUpdateTimeStamp.lastUpdate&&(this.lastUpdate=`${p.serviceUpdateTimeStamp.lastUpdate}`);
this._maxLodLevel=this.viewportQueries?this.viewportQueries.maxLodLevel:1;this._init(y)}var A=z.prototype;A._init=function(p){if("page"===p.type){this.urlPrefix=p.urlPrefix;this.nodesPerPage=p.pageSize;this.rootIndex=p.rootIndex;switch(p.lodMetric){case "maxScreenThreshold":this.lodMetric=g.LodMetric.MaxScreenThreshold;break;case "maxScreenThresholdSQ":this.lodMetric=g.LodMetric.MaxScreenThreshold,this._lodConversion=w}this._addPage(e(this.rootIndex,this.nodesPerPage),p.rootPage);this._updateParentsAndLevel()}else"node"===
p.type&&(this.urlPrefix=p.urlPrefix,this._nodePages.push({nodes:[],children:[],parents:[]}),this._makeRefNode(new g.NodeBase(p.rootNode.id,null),-1),(p=this._validateNode(p.rootNode.id,p.rootNode))&&this._addNode(p,0))};A._loadPage=function(p){this._loading.add(p);this.streamDataController.request(this.urlPrefix+p,"json").then(y=>{this._pageQueue.push({pageIndex:p,page:y})}).catch(y=>{this._loading.delete(p);l.isAbortError(y)||(this._failedPages.add(p),this.logger.error("#loadPage()",this.logLayer,
`Error when loading page ${p}`,y))})};A._addQueuedPages=function(p){for(;0<this._pageQueue.length&&!p.done;){const {pageIndex:y,page:D}=this._pageQueue.shift();this._addPage(y,D);this._loading.delete(y);p.madeProgress()}this._updateParentsAndLevel()};A._addPage=function(p,y){for(let F=this._nodePages.length;F<p;F++)this._nodePages[F]=null;const D=[],E=[];y=y.nodes.map((F,G)=>{const P=D.length,K=F.children?F.children.length:0;E.push(-1);for(var N=0;N<K;N++)D.push(F.children[N]);const M=`${F.index}`;
N=f.clone(F.obb);const L=n.fromArray([N.center[0],N.center[1],N.center[2],r.length(N.halfSize)]),J=F.mesh&&F.mesh.attribute,H=F.mesh&&F.mesh.geometry,I=F.mesh&&F.mesh.material;F=new g.Node(M,p*this.nodesPerPage+G,L,K,0,{hasSharedResource:!1,hasFeatureData:!!H,attributes:J&&null!=J.resource?`${J.resource}`:null,geometry:H&&null!=H.resource?`${H.resource}`:null,texture:I&&null!=I.resource?`${I.resource}`:null,geometryDefinition:H?H.definition:-1,materialDefinition:I?I.definition:-1},this.lastUpdate,
this.lodMetric,this._lodConversion(F.lodThreshold),H?H.featureCount:null);F.serviceObb=N;F.visibilityObb=this._computeVisibilityObb(F);F.vertexCount=H?H.vertexCount:0;return new t(P,K,k.addWraparound(this._visibilityCacheVersion,-2),null,F)});this._nodePages[p]={nodes:y,children:D,parents:E};this.nodeCount+=y.length};A._updateParentsAndLevel=function(){const p=[],y=(D,E,F)=>{const G=this._getPage(D);if(c.isSome(G)){const P=h(D,this.nodesPerPage);G.parents[P]=E;E=G.nodes[P].node;c.isSome(E)&&(E.level=
F,p.push(D))}};for(y(this.rootIndex,-1,0);p.length;){const D=p.pop(),E=this.getNode(D);if(c.isSome(E))for(let F=0;F<E.childCount;F++){const G=this.getChildIndex(E.index,F);y(G,D,E.level+1);this._maxLevel=Math.max(this._maxLevel,E.level+1)}}};A._getPage=function(p){return this._nodePages[e(p,this.nodesPerPage)]};A._getNodeInternal=function(p){const y=this._getPage(p);return c.isNone(y)?null:y.nodes[h(p,this.nodesPerPage)]};A._addNode=function(p,y){null!=p.children&&this.populateChildren(y,p.children);
var D=this.getParent(y);D=c.isSome(D)?D.level+1:0;this._maxLevel=Math.max(this._maxLevel,p.children?D+1:D);const {lodMetric:E,maxError:F}=v(p.lodSelection),G=c.unwrap(this._getNodeInternal(y));G.node=new g.Node(p.id,y,n.fromArray(p.mbs),G.childCount,D,p.resources,p.version,E,F,p.numFeatures);p.obb&&(G.node.serviceObb=f.clone(p.obb));G.node.visibilityObb=this._computeVisibilityObb(G.node);c.isSome(G.ref)&&(null==G.ref.mbs&&(G.ref.mbs=p.mbs),G.node.renderMbs=G.ref.renderMbs,G.node.serviceObbInRenderSR=
G.ref.serviceObbInRenderSR,G.ref.visibilityObb=G.node.visibilityObb);return G.node};A._makeRefNode=function(p,y){const D=this._nodePages[0],E=D.nodes.length;D.nodes.push(new t(0,0,k.addWraparound(this._visibilityCacheVersion,-2),p,null));this.nodeCount++;D.parents.push(y);k.invalidateMbs(p.renderMbs);k.invalidateObb(p.serviceObbInRenderSR);return E};A.populateChildren=function(p,y){var D=c.unwrap(this._getNodeInternal(p));const E=c.unwrap(this._getPage(p));D.childOffset=E.children.length;D.childCount=
y.length;for(D=0;D<y.length;D++){const F=this._makeRefNode(y[D],p);E.children.push(F)}};A.getNode=function(p){p=this._getNodeInternal(p);return c.isSome(p)?p.node:null};A.getIndexById=function(p){let y;this._forAllNodes((D,E)=>{c.isSome(D.node)&&D.node.id===p?y=E:c.isSome(D.ref)&&D.ref.id===p&&(y=E)});return y};A.getNodeById=function(p){p=this.getIndexById(p);return 0<=p?this.getNode(p):null};A.getChildIndex=function(p,y){const D=this._getPage(p);if(c.isNone(D))return-1;p=D.nodes[h(p,this.nodesPerPage)];
return D.children[p.childOffset+y]};A.getParentIndex=function(p){const y=this._getPage(p);return c.isSome(y)?y.parents[h(p,this.nodesPerPage)]:-1};A.getParent=function(p){p=this.getParentIndex(p);return 0<=p?this.getNode(p):null};A.isLeaf=function(p){p=this._getNodeInternal(p);return c.isSome(p)&&0===p.childCount};A.removeAllGeometryObbs=function(){this._forAllNodes(p=>{c.isSome(p.node)&&(p.node.geometryObb=null)})};A.invalidateVisibilityCache=function(){this._visibilityCacheVersion=k.addWraparound(this._visibilityCacheVersion,
2)};A.invalidateNodeVisibilityCache=function(p){p=this._getNodeInternal(p);c.isSome(p)&&this.invalidateNodeVisibilityCacheInternal(p)};A.invalidateNodeVisibilityCacheInternal=function(p){p.visibilityCache=k.addWraparound(this._visibilityCacheVersion,-2)};A.invalidateBoundingVolumeCache=function(p){p=this._getNodeInternal(p);c.isSome(p)&&(d(p),this.invalidateNodeVisibilityCacheInternal(p))};A.updateElevationChanged=function(p){const y=this._getNodeInternal(p);c.isNone(y)||(this.needNodeElevationRange?
(p=c.isSome(y.node)?y.node:y.ref,c.isNone(p)||(p=p.elevationRange,c.isNone(p)||(p.valid=!1))):this.invalidateBoundingVolumeCache(p))};A.invalidateGeometryVisibility=function(p){p=this._getNodeInternal(p);c.isSome(p)&&c.isSome(p.node)&&(p.node.geometryObb=null,k.invalidateMbs(p.node.renderMbs),k.invalidateObb(p.node.serviceObbInRenderSR))};A.invalidateVisibilityObbs=function(){c.isNone(this.rootNode)||this.traverse(this.rootNode,p=>{p.visibilityObb=this._computeVisibilityObb(p);p.geometryObb=null;
return!0})};A._updateElevationRange=function(p){var y=this._getNodeInternal(p);if(c.isNone(y))return null;const D=c.isSome(y.node)?y.node:y.ref;if(c.isNone(D))return null;const E=D.elevationRange;if(c.isSome(E)&&E.valid)return E;const F=new g.ElevationRange;let G=!1;for(let P=0;P<y.childCount;P++){const K=this._updateElevationRange(this.getChildIndex(p,P));c.isNone(K)?G=!0:(F.min=Math.min(F.min,K.min),F.max=Math.max(F.max,K.max))}if(0===y.childCount||G&&c.isSome(y.node)&&y.node.resources.geometry)y=
this.viewportQueries.getElevationRange(D),c.isSome(y)&&(F.min=Math.min(F.min,y.min),F.max=Math.max(F.max,y.max));if(c.isSome(E)&&E.min===F.min&&E.max===F.max)return E.valid=!0,E;F.valid=!0;D.elevationRange=F;this.invalidateBoundingVolumeCache(p);return F};A.isNodeVisible=function(p){const y=this._getNodeInternal(p);if(c.isNone(y)||c.isSome(y.ref)&&!y.ref.mbs)return!0;this.needNodeElevationRange&&this._updateElevationRange(p);if((y.visibilityCache&-2)!==this._visibilityCacheVersion){p=y.node;const E=
c.isSome(p)&&(c.isNone(y.ref)||c.isSome(p.visibilityObb))?p:c.isSome(y.ref)?y.ref:null;if(this._layerHasFilter&&this._computeNodeFiltering&&(c.isSome(p)||c.isSome(y.ref))&&y.filterImpact===g.NodeFilterImpact.NotChecked){var D=c.isSome(p)?p.mbs:c.isSome(y.ref)?y.ref.mbs:null;y.filterImpact=null!=D?this._computeNodeFiltering(D):g.NodeFilterImpact.Unmodified}D=c.isSome(p)&&y.filterImpact===g.NodeFilterImpact.Culled;p=!(c.isSome(p)&&p.imModificationImpact===g.NodeIMModificationImpact.Culled)&&(!E||this.viewportQueries.isNodeVisible(E))&&
!D;y.visibilityCache=this._visibilityCacheVersion+(p?1:0);return p}return 1===(y.visibilityCache&1)};A.isGeometryVisible=function(p){if(!this.isNodeVisible(p))return!1;p=this._getNodeInternal(p);return c.isSome(p)&&c.isSome(p.node)&&c.isSome(p.node.geometryObb)&&(!this.layerHasModifications||p.node.imModificationImpact!==g.NodeIMModificationImpact.NotChecked)?this.viewportQueries.isGeometryVisible(p.node):!0};A._traverseCoverage=function(p,y,D,E,F){p=this._getPage(p);if(!c.isNone(p)&&0!==y.childCount){var G=
y.childOffset+y.childCount,P=[];for(y=y.childOffset;y<G;++y){const K=p.children[y],N=this._getNodeInternal(K);c.isSome(N)&&c.isSome(N.node)&&this.isGeometryVisible(K)&&P.push(N)}E/=P.length;for(const K of P)p=c.unwrap(K.node).index,this._isLoaded(p)||this._isReloading(p)?(F.delta=Math.max(F.delta,D),F.coverage+=E):this._traverseCoverage(p,K,D+1,E,F)}};A.useNodeAsHole=function(p){if("off"===this.holeFilling)return!1;const y=this._getNodeInternal(p);if(c.isNone(y))return!1;if("always"===this.holeFilling)return!0;
if((y.useAsHole&-2)===this._version)return 1===(y.useAsHole&1);const D={delta:0,coverage:0};this._traverseCoverage(p,y,0,1,D);p=.5>=D.delta*D.coverage;y.useAsHole=this._version+(p?1:0);return p};A.destroy=function(){this._updates.add.prune();this._updates.update.prune()};A.requestUpdate=function(){this._dirty=!0;this._indexMissing=1;this._version=k.addWraparound(this._version,2)};A.imModificationsChanged=function(p){this.layerHasModifications=p;this._forAllNodes(({node:y})=>{c.isSome(y)&&(y.imModificationImpact=
g.NodeIMModificationImpact.NotChecked,y.visibilityObb=this._computeVisibilityObb(y),y.hasModifications&&this.invalidateGeometryVisibility(y.index))});this.invalidateVisibilityCache()};A.layerFilterChanged=function(p){this._layerHasFilter=p;this._forAllNodes(y=>{c.isSome(y)&&(y.filterImpact=g.NodeFilterImpact.NotChecked,y=y.node,c.isSome(y)&&this.invalidateNodeVisibilityCache(y.index))});this.invalidateVisibilityCache()};A.update=function(p,y,D){if(this._dirty){0<this._pageQueue.length&&this._addQueuedPages(y);
this._maxProcessingPrio=this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._missing.clear();this._prefetch.clear();this._updates.reset(p);B.clear();var E=!0,F=new C,G=new C,P=this._imModificationUncategorized;P.clear();var K=new Set;this.traverseVisible((M,L,J)=>{if(c.isNone(L))L=this._entryPriority(M),Infinity===L&&(L=this._entryPriority(J)),M=e(M,this.nodesPerPage),B.set(M,Math.max(L,B.get(M)||0)),this._loading.has(M)||this._failedPages.has(M)||this._missing.push(M),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,
L);else{var H=L.node;this._updateNodeFeatureEstimate(H,G);if(c.isNone(H))L=this._entryPriority(M),this._loading.has(M)||this._failedNodes.has(M)||(this._missing.push(M),B.set(M,L)),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,L);else{J=c.unwrap(this._getPage(M));if(0===this._missing.length&&0===this.nodesPerPage)for(let I=0;I<L.childCount;I++){const O=J.children[L.childOffset+I],Q=this._getNodeInternal(O);!c.isSome(Q)||Q.node||this._loading.has(O)||this._failedNodes.has(O)||(B.set(O,this._entryPriority(O)),
this._prefetch.push(O))}H.failed||!H.resources.hasFeatureData?E&&0<L.childCount&&this._isSelected(H)&&(E=!1):(K.add(H.id),this._isLoaded(M)?(F.known+=H.memory,++F.knownNodes,this._isSelected(H)?0<L.childCount&&(E=!1):(F.unremoved+=H.memory,E=!1),this._needsUpdate(H)&&(L=this._entryPriority(M),B.set(M,L),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,L),this._updates.update.push(M))):(H.memory&&(F.known+=H.memory,++F.knownNodes),this._isSelected(H)?(0<L.childCount&&(E=!1),H.memory?(F.missing+=
H.memory,F.known+=H.memory,++F.knownNodes):++F.missingNodes,p.includes(H.index)?(this._maxProcessingPrio=Math.max(this._maxProcessingPrio,this._entryPriority(M)),this._updates.cancel=this._updates.cancel.filter(I=>I!==H.index)):!y.done&&this._enable(H)?y.madeProgress():(L=this._entryPriority(M),B.set(M,L),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,L),this._updates.add.push(M),this.layerHasModifications&&D&&c.isSome(H)&&H.imModificationImpact===g.NodeIMModificationImpact.NotChecked&&
P.push(M))):this._isReloading(M)&&this._updates.remove.push(M)))}}});var N=this._updates.add;0<N.length&&this.layerHasModifications&&(0<P.length&&D(P),N.filterInPlace(M=>{var L=this._getNodeInternal(M);(L=c.isNone(L)||c.isNone(L.node)||L.node.imModificationImpact!==g.NodeIMModificationImpact.Culled)||this.invalidateNodeVisibilityCache(M);return L}));this._unloadedMemoryEstimate=F.missing-F.unremoved;3<F.knownNodes&&0<F.missingNodes&&(this._unloadedMemoryEstimate+=F.known/F.knownNodes*F.missingNodes);
this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate);this._featureEstimate.estimate=this._computeFeatureEstimate(G);this._featureEstimate.leavesReached=E;this._missing.sort((M,L)=>M-L);this._missing.filterInPlace((M,L)=>1>L||this._missing.data[L-1]!==M);this._missing.sort((M,L)=>B.get(M)-B.get(L));0<this._missing.length&&(this._maxUnloadedPrio=B.get(this._missing.back()),this._prefetch.clear());this._updates.add.filterInPlace(M=>B.get(M)>=this._maxUnloadedPrio).sort((M,L)=>B.get(M)-
B.get(L));this._updates.update.sort((M,L)=>B.get(M)-B.get(L));this._indexMissing=this._loading.size+this._missing.length;this._dirty=0<this._indexMissing;B.clear()}};A.checkFeatureTarget=function(p,y){const D=this.viewportQueries.updateScreenSpaceErrorBias(y);let E=y,F=y,G=D,P=10;for(;P--;){const K=new C;this._updateFeatureEstimate(E,K);if(this._computeFeatureEstimate(K)<=p){if(E>=y||0<K.missingNodes||0===P)break;G=E;E=.5*(E+F)}else F=E,E=.5*(E+G)}this._version=k.addWraparound(this._version,2);this.viewportQueries.updateScreenSpaceErrorBias(D);
return Math.min(y,E)};A._updateFeatureEstimate=function(p,y){this._version=k.addWraparound(this._version,2);this.viewportQueries.updateScreenSpaceErrorBias(p);this.traverseVisible((D,E)=>this._updateNodeFeatureEstimate(c.isSome(E)&&E.node,y))};A._updateNodeFeatureEstimate=function(p,y){c.isNone(p)||p.failed||c.isNone(p.numFeatures)||(this._isLoaded(p.index)?(y.known+=p.numFeatures,++y.knownNodes,this._isSelected(p)||(y.unremoved+=p.numFeatures)):this._isSelected(p)&&(c.isSome(p.numFeatures)?(y.missing+=
p.numFeatures,y.known+=p.numFeatures,++y.knownNodes):++y.missingNodes))};A._computeFeatureEstimate=function(p){let y=p.known-p.unremoved;3<p.knownNodes&&0<p.missingNodes&&(y+=p.known/p.knownNodes*p.missingNodes);return Math.max(0,y)};A.load=function(){return this._load(this._missing)};A.prefetch=function(){this._prefetch.sort((p,y)=>B.get(p)-B.get(y));return this._load(this._prefetch)};A._load=function(p){if(0===p.length||!this._canRequest())return!1;for(;0<p.length&&this._canRequest();)0===this.nodesPerPage?
this._loadNode(p.pop()):this._loadPage(p.pop());return!0};A.isLoading=function(){return 0<this._indexMissing};A.getIndexLoading=function(){return this._loading.size};A.getIndexMissing=function(){return this._indexMissing};A.getUnloadedMemoryEstimate=function(){return this._unloadedMemoryEstimate};A.nodeTraversalState=function(p){if(c.isNone(p))return null;let y=this._nodeTraversalState.get(p.index);if(y&&(y.version&-2)===this._version)return y;const D=this.viewportQueries.getLodLevel(p),E=this.viewportQueries.hasLOD(p);
var F=!0;E?(F=this.getParentIndex(p.index),F=0<=F?(F=this._nodeTraversalState.get(F))&&D>F.lodLevel:0<D):F=0===p.childCount;if(y)return y.lodLevel=D,y.isChosen=F,y.version=this._version+1,y;y=new g.NodeTraversalState(E,F,D,this._version+1);this._nodeTraversalState.set(p.index,y);return y};A._loadNode=function(p){this._loading.add(p);const y=c.unwrap(this._getNodeInternal(p)).ref;if(c.isNone(y))this._failedNodes.add(p);else{var D=y.id,E=this.urlPrefix+D,F=()=>{this._loading.delete(p);0===this._missing.length&&
0===this._loading.size&&this.requestUpdate()};this.streamDataController.request(E,"json").then(G=>{F();G=this._validateNode(D,G);null!=G&&(G.obb&&this.invalidateNodeVisibilityCache(p),G=this._addNode(G,p),this.nodeTraversalState(G))},G=>{F();l.isAbortError(G)||(this.logger.error("#loadNode()",this.logLayer,"Error loading node: "+E),this._failedNodes.add(p))})}};A._validateNode=function(p,y){if(null==y||"object"!==typeof y||y.id!==p)return this.logger.error("#validateNode()",this.logLayer,`Invalid node. Wrong type or wrong id "${p}"`),
null;if(!Array.isArray(y.mbs))return this.logger.error("#validateNode()",this.logLayer,`Invalid bounding volume on node ${p}.`),null;y.sharedResource&&"./shared"!==y.sharedResource.href&&"./shared/"!==y.sharedResource.href&&this.logger.warn("#validateNode()",this.logLayer,`Invalid shared resource href on node "${p}"`);null==y.geometryData||Array.isArray(y.geometryData)&&1===y.geometryData.length&&"./geometries/0"===y.geometryData[0].href||this.logger.warn("#validateNode()",this.logLayer,`Invalid geometry data on node "${p}"`);
null==y.attributeData||Array.isArray(y.attributeData)&&!y.attributeData.some((G,P)=>G.href!==`./attributes/f_${P}/0`)||this.logger.warn("#validateNode()",this.logLayer,`Invalid attribute data on node "${p}"`);y.featureData&&1<y.featureData.length&&this.logger.warn("#validateNode()",this.logLayer,`Node ${p} has ${y.featureData.length} bundles. Only the first bundle will be loaded.`);const D=y.hasOwnProperty("obb")&&!this.ignoreServiceObb?y.obb:null,E=y.featureData&&1===y.featureData.length&&y.featureData[0].featureRange?
y.featureData[0].featureRange[1]-y.featureData[0].featureRange[0]+1:null;var F=G=>{if(null==G)return null;var P=K=>this.logger.error("#validateNode()",this.logLayer,`Invalid node reference on node ${p}: ${K}`);if("number"===typeof G.id)P(`id ${G.id} is a number instead of a string.`);else if("string"!==typeof G.id||!Array.isArray(G.mbs))return P("Missing or invalid id."),null;if(!Array.isArray(G.mbs))return P(`Invalid bounding volume on reference ${G.id}.`),null;G.href&&G.href!=="../"+G.id&&this.logger.error("#validateNode()",
this.logLayer,`Invalid node href on node "${p}"`);P=G.hasOwnProperty("obb")&&!this.ignoreServiceObb?G.obb:null;G=new g.NodeBase(`${G.id}`,G.mbs);G.serviceObb=P;G.visibilityObb=this._computeVisibilityObb(G);return G};F=Array.isArray(y.children)?y.children.map(F).filter(G=>null!=G):null;return{id:p,mbs:y.mbs,obb:D,children:F,resources:{hasFeatureData:y.featureData&&0<y.featureData.length,hasSharedResource:null!=y.sharedResource,attributes:y.attributeData?p:null,texture:y.textureData&&0<y.textureData.length?
p:null,geometry:null!=y.geometryData?p:null},version:"string"===typeof y.version?y.version:null,lodSelection:Array.isArray(y.lodSelection)?y.lodSelection:null,numFeatures:E}};A.resetFailedNodes=function(){this._failedNodes.clear();this._failedPages.clear();this._forAllNodes(p=>{c.isSome(p.node)&&(p.node.failed=!1)})};A._entryPriority=function(p){var y=this._getNodeInternal(p),D=this.getParentIndex(p);if(c.isNone(y)||0>D&&null==y.node)return 0>D?Infinity:this._entryPriority(D);let E=0;y.node&&0<=D&&
(D=this._nodeTraversalState.get(D),null!=D&&(E=D.lodLevel));for(D=this.progressiveLoadPenalty;0<=p;p=this.getParentIndex(p))if(this._isLoaded(p)){D=0;break}y=c.isSome(y.ref)?this.viewportQueries.distToPOI(y.ref):c.isSome(y.node)?this.viewportQueries.distToPOI(y.node):0;return-y-E*(y+this.progressiveLoadPenalty)+D};A.traverseVisible=function(p){const y=this._getNodeInternal(this.rootIndex);c.isNone(y)?p(this.rootIndex,null,null):this._traverseVisible(this.rootIndex,-1,y,p)};A._traverseVisible=function(p,
y,D,E){if(D.node&&0===D.childCount)this.isGeometryVisible(p)&&E(p,D,y);else if(this.isNodeVisible(p)&&(E(p,D,y),null!=D.node&&(y=this.nodeTraversalState(D.node),!y.nodeHasLOD||y.lodLevel!==this._maxLodLevel))){y=c.unwrap(this._getPage(p));for(let F=0;F<D.childCount;F++){const G=y.children[D.childOffset+F],P=this._getNodeInternal(G);c.isSome(P)?this._traverseVisible(G,p,P,E):E(G,null,p)}}};A.traverse=function(p,y){y(p)&&this.traverseChildren(p,y)};A.traverseChildren=function(p,y){p=p.index;const D=
this._getNodeInternal(p);c.isSome(D)&&this._traverseChildren(p,D,y)};A._traverseChildren=function(p,y,D){p=this._getPage(p);if(!c.isNone(p)){var E=y.childOffset+y.childCount;for(y=y.childOffset;y<E;++y){const F=p.children[y],G=this._getNodeInternal(F);c.isSome(G)&&c.isSome(G.node)&&D(G.node)&&this._traverseChildren(F,G,D)}}};A.updateChildrenLoaded=function(p,y){for(p=this.getNode(p);c.isSome(p);)p.childrenLoaded+=y,p=this.getParent(p.index)};A.checkChildrenLoadedInvariant=function(){if(c.isNone(this.rootNode))return!0;
const p=[],y=D=>{let E=this._isLoaded(D.index)||this._isReloading(D.index)?1:0;this.traverseChildren(D,F=>{E+=y(F);return!1});D.childrenLoaded!==E&&p.push(D.index);return E};y(this.rootNode);p.length&&this.logger.error("childrenLoaded invariant broken at following nodes: "+p.join(","));return 0<p.length};A.updateStats=function(p){0<this._updates.add.length&&(p.nodes+=" + "+this._updates.add.length);if(this._indexMissing||0<this._prefetch.length)p.index+=" + "+this._indexMissing||this._prefetch.length;
p.prio=this._maxProcessingPrio;if(this._featureEstimate.estimate){const y=this._featureEstimate.estimate-p.features;0<y?p.features+=" + "+y:0>y&&(p.features+=" - "+-y)}};A.getPriority=function(){return Math.max(this._maxProcessingPrio,this._maxUnloadedPrio)};A.updateElevationInfo=function(p,y){this.needNodeElevationRange=y&&p&&("relative-to-ground"===p.mode||"on-the-ground"===p.mode);this._forAllNodes(D=>{d(D);c.isSome(D.node)&&(D.node.elevationRange=null);c.isSome(D.ref)&&(D.ref.elevationRange=null)});
this.viewportQueries.updateElevationInfo(p)};A._forAllNodes=function(p){for(let y=0;y<this._nodePages.length;y++){const D=this._nodePages[y];if(D){const E=y*this.nodesPerPage;for(let F=0;F<D.nodes.length;F++)p(D.nodes[F],E+F)}}};b._createClass(z,[{key:"rootNode",get:function(){return this.getNode(this.rootIndex)}},{key:"size",get:function(){return this.nodeCount}},{key:"maxLevel",get:function(){return this._maxLevel}},{key:"dirty",get:function(){return this._dirty}},{key:"updates",get:function(){return this._updates}},
{key:"featureEstimate",get:function(){return this._featureEstimate}},{key:"test",get:function(){return{addNode:(p,y)=>this._addNode(p,y)}}}]);return z}();const B=new Map;let q=function(){function z(A){this.missing=A;this.update=new m({deallocator:null});this.add=new m({deallocator:null});this.remove=new m({deallocator:null});this.cancel=[]}z.prototype.reset=function(A){this.add.clear();this.update.clear();this.cancel=A};return z}();const u=[["maxScreenThreshold",g.LodMetric.MaxScreenThreshold],["screenSpaceRelative",
g.LodMetric.ScreenSpaceRelative],["removedFeatureDiameter",g.LodMetric.RemovedFeatureDiameter],["distanceRangeFromDefaultCamera",g.LodMetric.DistanceRangeFromDefaultCamera]];let C=function(){this.unremoved=this.missingNodes=this.missing=this.knownNodes=this.known=0};a.I3SIndex=x;a.selectErrorMetric=v;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SNode":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../../chunks/sphere"],function(a,b,c){let m=function(r,n){this.id=r;this.mbs=n;this.renderMbs=c.fromValues(0,0,0,-1);this.elevationRange=null};a.NodeFilterImpact=void 0;(function(r){r[r.Unmodified=0]="Unmodified";r[r.Culled=1]="Culled";r[r.NotChecked=2]="NotChecked"})(a.NodeFilterImpact||(a.NodeFilterImpact={}));a.NodeIMModificationImpact=void 0;(function(r){r[r.Unmodified=0]="Unmodified";r[r.PotentiallyModified=1]="PotentiallyModified";r[r.Culled=2]="Culled";r[r.Unknown=3]="Unknown";r[r.NotChecked=
4]="NotChecked"})(a.NodeIMModificationImpact||(a.NodeIMModificationImpact={}));let l=function(r){function n(g,k,f,d,e,h,v,w,t,x){g=r.call(this,g,f)||this;g.index=k;g.childCount=d;g.level=e;g.resources=h;g.version=v;g.lodMetric=w;g.maxError=t;g.numFeatures=x;g.failed=!1;g.cacheState=a.CacheState.Unknown;g.vertexCount=0;g.memory=0;g.childrenLoaded=0;g.hasModifications=!1;g.imModificationImpact=a.NodeIMModificationImpact.NotChecked;return g}b._inheritsLoose(n,r);return n}(m);a.CacheState=void 0;(function(r){r[r.Unknown=
0]="Unknown";r[r.Uncached=1]="Uncached";r[r.Cached=2]="Cached"})(a.CacheState||(a.CacheState={}));a.LodMetric=void 0;(function(r){r[r.None=0]="None";r[r.MaxScreenThreshold=1]="MaxScreenThreshold";r[r.ScreenSpaceRelative=2]="ScreenSpaceRelative";r[r.RemovedFeatureDiameter=3]="RemovedFeatureDiameter";r[r.DistanceRangeFromDefaultCamera=4]="DistanceRangeFromDefaultCamera"})(a.LodMetric||(a.LodMetric={}));a.NodeState=void 0;(function(r){r[r.Hole=0]="Hole";r[r.Leaf=1]="Leaf"})(a.NodeState||(a.NodeState=
{}));a.ElevationRange=function(){this.min=Infinity;this.max=-Infinity;this.valid=!1};a.Node=l;a.NodeBase=m;a.NodeTraversalState=function(r,n,g,k){this.nodeHasLOD=r;this.isChosen=n;this.lodLevel=g;this.version=k};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SLodHandling":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/PooledArray","./I3SNode","../support/I3SLayerView"],
function(a,b,c,m,l){let r=function(){function g(f){this.layerView=f;this._lodGlobalDirty=!1}var k=g.prototype;k.startNodeLoading=function(f,d,e,h){this._maxLodLevel=h.maxLodLevel;this._index=e;this._isNodeInScaleBounds=f;this._removeNodes=d};k.shouldLoadNode=function(f){if(b.isNone(f))return!1;const d=this._index.nodeTraversalState(f);return this._isChosenMaxLOD(d)?!0:d.isChosen?this._childrenRequireLoading(f):!1};k.setLodGlobalDirty=function(){this._lodGlobalDirty=!0};k.lodGlobalHandling=function(f){if(!this.requiresLODGlobalHandling)return!1;
this._lodGlobalDirty=!1;var d=Math.max(0,Math.floor(10*(this.layerView.view.resourceController.memoryController.usedMemory-1)));n.clear();this._lodGlobalHandling(this._index.rootNode,d,!1,this.layerView.nodeCrossfadingEnabled);d=n.length;this._removeNodes(n,f);f=n.length<d;0!==n.length&&(this._lodGlobalDirty=!0);n.clear();return f};k._lodGlobalHandling=function(f,d,e,h){if(b.isNone(f))return!1;const v=f.index,w=this._index,t=this.layerView;var x=w.nodeTraversalState(f);x=this._isChosenMaxLOD(x);var B=
!f.resources.hasFeatureData;if(x&&B)return 0<f.childrenLoaded&&this._removeChildrenRecursive(f),!0;B=t.isNodeLoaded(v);if(h&&B&&x){var q=!e&&this.hasNoVisibleChildren(f);t.fadeNode(v,l.FadeDirection.FadeIn,!q)}q=B&&(!t.isNodeFullyFadedIn||t.isNodeFullyFadedIn(v));if(B&&(t.updateNodeState(v,x?m.NodeState.Leaf:m.NodeState.Hole),x))return q&&this._removeChildrenRecursive(f),q;var u=0<f.childCount;let C=u;if(u)for(u=0;u<f.childCount;u++){const z=w.getChildIndex(v,u),A=w.getNode(z);b.isSome(A)?w.isGeometryVisible(z)&&
!this._lodGlobalHandling(A,d,e||q,h)&&this._isNodeInScaleBounds(A)&&(C=!1):w.isNodeVisible(z)&&(C=!1)}(d=B&&!x&&(C||n.length<d))&&n.push(v);!h||d||!B||e||C||t.fadeNode(v,l.FadeDirection.FadeIn,!1);f=!f.resources.hasFeatureData;return C||q&&!d||f};k._removeChildrenRecursive=function(f){this._index.traverseChildren(f,d=>{(this.layerView.isNodeLoaded(d.index)||this.layerView.isNodeReloading(d.index))&&n.push(d.index);return 0<d.childrenLoaded})};k.hasNoVisibleChildren=function(f){let d=!0;this._index.traverseChildren(f,
e=>d&&this._index.isNodeVisible(e.index)?this.layerView.isNodeLoaded(e.index)?d=!1:0<e.childrenLoaded:!1);return d};k._childrenRequireLoading=function(f){let d=!1,e=!0;this._index.traverseChildren(f,h=>{if(!e||!this._index.isNodeVisible(h.index))return!1;const v=this._index.nodeTraversalState(h);this._isChosenMaxLOD(v)&&this._index.isGeometryVisible(h.index)&&(d=!0);return this.layerView.isNodeLoaded(h.index)?e=!1:0<h.childrenLoaded});return e&&d};k._isChosenMaxLOD=function(f){return f.isChosen&&
(!f.nodeHasLOD||f.lodLevel===this._maxLodLevel)};a._createClass(g,[{key:"requiresLODGlobalHandling",get:function(){return null!=this._index&&!0===this._lodGlobalDirty}}]);return g}();const n=new c({deallocator:null});return r})},"esri/views/3d/layers/support/I3SLayerView":function(){define(["exports"],function(a){a.FadeDirection=void 0;var b=a.FadeDirection||(a.FadeDirection={});b[b.FadeIn=0]="FadeIn";b[b.FadeOut=1]="FadeOut";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/layers/i3s/I3SNodeLoader":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/has ../../../../core/lang ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/urlUtils ./enums ./I3SBinaryReader ./I3SMaterialUtil".split(" "),function(a,b,c,m,l,r,n,g,k,f){return function(){function d(h,v,w,t,x,B){this.streamDataController=v;this.logger=w;this.defaultGeometrySchema=t;this.requiredAttributes=x;this.options=B;this.logLayer=
h;this.layerUrl=h.parsedUrl.path;this.geometryDefinitions=h.geometryDefinitions;if(h.materialDefinitions){const q=h.textureSetDefinitions;this.materialAndTextures=h.materialDefinitions.map(u=>f.getMaterialAndTextures(q,u))}}var e=d.prototype;e._load=function(h,v,w){return this.streamDataController.request(h,v,w)};e._loadAttribute=function(h,v,w){return this._load(`${this.layerUrl}/nodes/${h.resources.attributes}/attributes/${v.key}/0`,"binary",w).then(t=>k.readBinaryAttribute(v,t))};e.loadAttributes=
function(h,v,w){return r.eachAlways(v.map(t=>this._loadAttribute(h,t.attributeStorageInfo,w))).then(t=>{const x={};for(let B=0;B<v.length;++B)if(t[B].value)x[v[B].name]=t[B].value;else{if(r.isAbortError(t[B].error))throw t[B].error;this.logger.error("#loadAttributes",this.logLayer,`Failed to load attributeData for '${v[B].name}' on node '${h.id}'`,t[B].error)}return x})};e.loadNodeData=function(){var h=a._asyncToGenerator(function*(v,w){var t=null!=this.requiredAttributes&&v.resources.attributes?
b.result(this.loadAttributes(v,this.requiredAttributes,w)):null;var x=this.geometryDefinitions;var B={bufferDefinition:null,bufferIndex:0};if(!(null==x||0>v.resources.geometryDefinition)&&(x=0<=v.resources.geometryDefinition?x[v.resources.geometryDefinition].geometryBuffers:null,null!=x))for(var q=0;q<x.length;q++){var u=x[q];if(null!=u.compressedAttributes){if("draco"===u.compressedAttributes.encoding&&!c("disable-feature:i3s-draco")){B.bufferIndex=q;B.bufferDefinition=u;break}}else B.bufferIndex=
q,B.bufferDefinition=x[q]}const {bufferDefinition:C,bufferIndex:z}=B;q=(u=!!v.resources.geometry)?b.result(this._loadGeometry(v.resources.geometry,z,w)):null;x=v.resources.hasSharedResource?yield this._loadShared(v,w):null;var A=(B=this.materialAndTextures&&0<=v.resources.materialDefinition?this.materialAndTextures[v.resources.materialDefinition]:null!=x?f.getMaterialAndTexturesFromShared(x):null)&&B.material;B=B&&B.textures;const p=`${v.id}`,y=!u&&this.options.loadFeatureData;u=y?yield this._loadFeatureData(p,
w):null;if(y)a:{for(E of u.featureData)if(A=E.geometries,null!=A)for(var D of A){var E={featureIds:[E.id],featureDataPosition:E.position,geometries:[D]};break a}E=null}else E={featureIds:[],geometries:[{type:"ArrayBufferView",params:{material:A}}],featureDataPosition:[0,0,0]};if(D=l.isNone(E)){D=[];for(var F of u.featureData)null!=F.position&&D.push({featureIds:[F.id],featureDataPosition:F.position,geometries:null})}F=D;D=null!=B&&0<B.length?b.result(this.loadTextures(v,B,w)):null;w=v=null;q&&(v=
b.assertResult(yield q),(w=this.defaultGeometrySchema)&&x&&x.materialDefinitions&&(q=Object.keys(x.materialDefinitions)[0],!x.materialDefinitions[q].params.vertexRegions&&w.vertexAttributes.region&&(w=m.clone(w),delete w.vertexAttributes.region)),w=k.createGeometryDescriptor(C,w));x=D?b.assertResult(yield D):null;t=(t=t?b.assertResult(yield t):{})?{attributeData:t,loadedAttributes:this.requiredAttributes}:null;if(l.isSome(E))return{geometryData:E,attributeDataInfo:t,geometryBuffer:v,geometryDescriptor:w,
requiredTextures:B,textureData:x};if(l.isSome(F))return{pointData:F,attributeDataInfo:t,geometryBuffer:v,geometryDescriptor:w,requiredTextures:B,textureData:x};throw Error();});return function(v,w){return h.apply(this,arguments)}}();d._addAbsoluteHrefTexture=function(h,v){h=h.textureDefinitions;if(null!=h)for(const w of Object.keys(h))for(const t of h[w].images)Array.isArray(t.href)?t.hrefConcat=t.href.map(x=>n.makeAbsolute(x,v)):t.hrefConcat=n.makeAbsolute(t.href,v)};d._fixTextureEncodings=function(h){h=
h.textureDefinitions;if(null!=h)for(const w in h){const t=h[w];if(Array.isArray(t.encoding))for(var v=0;v<t.encoding.length;v++){const x=t.encoding[v];"data:"===x.substring(0,5)&&(t.encoding[v]=x.substring(5))}else v=t.encoding,"data:"===v.substring(0,5)&&(t.encoding=v.substring(5))}};e._loadShared=function(h,v){const w=`${this.layerUrl}/nodes/${h.resources.geometry}/shared`;return this._load(w,"json",v).then(t=>{d._fixTextureEncodings(t);d._addAbsoluteHrefTexture(t,w);return t})};e._loadTexture=
function(h,v,w,t,x,B){let q=!1;return x===g.TextureEncoding.DDS_S3TC||x===g.TextureEncoding.KTX2||x===g.TextureEncoding.Basis?this._load(h,"binary",B).then(u=>({id:v,usage:w,data:u,encoding:x,downsampled:q})):this._load(h,"image",B).then(u=>{var C=u;if(t&&4096<=u.width*u.height){C=Math.ceil(u.width/2);const z=Math.ceil(u.height/2),A=document.createElement("canvas");A.width=C;A.height=z;A.getContext("2d").drawImage(u,0,0,C,z);C=A;q=!0}return{id:v,usage:w,data:C,encoding:x,downsampled:q}})};e.loadTextures=
function(h,v,w){const t=this.options.uncompressedTextureDownsamplingEnabled,x=this.options.textureUsageMask;return Promise.all(v.map(B=>{if(0===(B.usage&x))return null;const q=f.selectEncoding(B.encodings,this.options.textureEncodings);return null==q?(this.logger.error("#loadTextures",this.logLayer,`No known encoding for texture found on node ${h.id}`),Promise.reject()):this._loadTexture(`${this.layerUrl}/nodes/${h.resources.texture||h.id}/textures/${q.name}`,B.id,B.usage,t,q.encoding,w)}))};e._loadFeatureData=
function(h,v){return this._load(`${this.layerUrl}/nodes/${h}/features/0`,"json",v)};e._loadGeometry=function(h,v,w){return this._load(`${this.layerUrl}/nodes/${h}/geometries/${v}`,"binary",w)};return d}()})},"esri/views/3d/layers/i3s/enums":function(){define(["exports"],function(a){a.TextureEncoding=void 0;(function(b){b[b.KTX2=1]="KTX2";b[b.Basis=2]="Basis";b[b.DDS_S3TC=4]="DDS_S3TC";b[b.PNG=8]="PNG";b[b.JPG=16]="JPG";b[b.KTX_ETC2=32]="KTX_ETC2"})(a.TextureEncoding||(a.TextureEncoding={}));a.TextureUsage=
void 0;(function(b){b[b.None=0]="None";b[b.Color=1]="Color";b[b.MetallicRoughness=2]="MetallicRoughness";b[b.Normal=4]="Normal";b[b.Occlusion=8]="Occlusion";b[b.Emissive=16]="Emissive";b[b.AlphaMask=32]="AlphaMask";b[b.ColorTextures=19]="ColorTextures";b[b.GeometryTextures=36]="GeometryTextures";b[b.GeometryTexturesPBR=44]="GeometryTexturesPBR";b[b.AllTextures=37]="AllTextures";b[b.AllTexturesPBR=63]="AllTexturesPBR"})(a.TextureUsage||(a.TextureUsage={}));Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SMaterialUtil":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../core/maybe ./enums ../../webgl-engine/core/material/RenderTexture ../../webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../webgl-engine/core/shaderLibrary/util/AlphaCutoff ../../webgl-engine/core/shaderLibrary/util/EllipsoidMode ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Texture ../../../webgl/enums".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e){function h(C){return C.sort((z,A)=>z.encoding-A.encoding)}function v(C,z,A){if(m.isNone(C)||A===l.TextureUsage.None)return null;for(let p=0;p<C.length;p++){const y=C[p];if(m.isSome(y)&&0!==(y.usage&A))return C=z[p],m.isSome(C)?C.id:null}return null}function w(C){switch(C){case l.TextureEncoding.KTX2:return d.Texture.KTX2_ENCODING;case l.TextureEncoding.Basis:return d.Texture.BASIS_ENCODING;case l.TextureEncoding.DDS_S3TC:return d.Texture.DDS_ENCODING;case l.TextureEncoding.PNG:return"image/png";
case l.TextureEncoding.JPG:return"image/jpeg";case l.TextureEncoding.KTX_ETC2:return"image/ktx";default:return""}}const t={ktx2:l.TextureEncoding.KTX2,basis:l.TextureEncoding.Basis,dds:l.TextureEncoding.DDS_S3TC,png:l.TextureEncoding.PNG,jpg:l.TextureEncoding.JPG,"ktx-etc2":l.TextureEncoding.KTX_ETC2},x={[d.Texture.KTX2_ENCODING]:l.TextureEncoding.Basis,[d.Texture.BASIS_ENCODING]:l.TextureEncoding.Basis,[d.Texture.DDS_ENCODING]:l.TextureEncoding.DDS_S3TC,"image/png":l.TextureEncoding.PNG,"image/jpg":l.TextureEncoding.JPG,
"image/jpeg":l.TextureEncoding.JPG,"image/ktx":l.TextureEncoding.KTX_ETC2},B=()=>({alphaMode:"opaque",alphaCutoff:g.defaultMaskAlphaCutoff,doubleSided:!0,cullFace:f.CullFaceOptions.None,normalTextureId:-1,emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,0,0],metallicRoughness:{baseColorFactor:[.8,.8,.8,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6},wrapTextures:!1,hasParametersFromSource:!0}),q={s:e.TextureWrapMode.CLAMP_TO_EDGE,t:e.TextureWrapMode.CLAMP_TO_EDGE},
u={s:e.TextureWrapMode.REPEAT,t:e.TextureWrapMode.REPEAT};a.configureMaterial=function(C,z,A,p,y,D){const E=D.rendererTextureUsage;var F=z.metallicRoughness.baseColorFactor,G=c.clamp(z.metallicRoughness.baseColorFactor[3],0,1);C.baseColor=[F[0],F[1],F[2],G];C.hasParametersFromSource=!!z.hasParametersFromSource;C.usePBR=D.usePBR;C.mrrFactors=[z.metallicRoughness.metallicFactor,z.metallicRoughness.roughnessFactor,z.hasParametersFromSource?.2:.5];C.emissiveFactor=z.emissiveFactor;C.isIntegratedMesh=
D.isIntegratedMesh;C.textureAlphaCutoff="mask"===z.alphaMode?z.alphaCutoff:g.defaultMaskAlphaCutoff;C.alphaDiscardMode="opaque"===z.alphaMode?f.AlphaDiscardMode.Opaque:"mask"===z.alphaMode?f.AlphaDiscardMode.Mask:f.AlphaDiscardMode.MaskBlend;F=[];G=v(p,A,(l.TextureUsage.Color|l.TextureUsage.AlphaMask)&E);m.isSome(G)&&(C.baseColorTexture=new r.RenderTexture(y,G),F.push(C.baseColorTexture.loadPromise));G=v(p,A,l.TextureUsage.MetallicRoughness&E);m.isSome(G)&&(C.metallicRoughnessTexture=new r.RenderTexture(y,
G),F.push(C.metallicRoughnessTexture.loadPromise));G=v(p,A,l.TextureUsage.Emissive&E);m.isSome(G)&&(C.emissionTexture=new r.RenderTexture(y,G),F.push(C.emissionTexture.loadPromise));G=v(p,A,l.TextureUsage.Occlusion&E);m.isSome(G)&&(C.occlusionTexture=new r.RenderTexture(y,G),F.push(C.occlusionTexture.loadPromise));A=v(p,A,l.TextureUsage.Normal&E);m.isSome(A)&&(C.normalTexture=new r.RenderTexture(y,A),F.push(C.normalTexture.loadPromise));C.commonMaterialParameters.hasSlicePlane=D.slicePlaneEnabled;
C.commonMaterialParameters.doubleSided=z.doubleSided;C.commonMaterialParameters.cullFace=z.cullFace;C.ellipsoidMode=k.getEllipsoidMode(D.viewSpatialReference);return Promise.all(F)};a.createTexture=function(C,z,A,p){if(m.isNone(C)||null==C.data)return null;const y=C.data;var D=!(y instanceof HTMLImageElement)||c.isPowerOfTwo(y.width)&&c.isPowerOfTwo(y.height),E=p.renderingContext.parameters.maxMaxAnisotropy;p=A&&!p.capabilities.shaderTextureLOD?1:E;D=D&&!C.downsampled&&1<p;A=A||!z.wrapTextures?q:
u;E=w(C.encoding);return new d.Texture(y,{mipmap:D,maxAnisotropy:p,encoding:E,wrap:A,components:C.usage&l.TextureUsage.Color?"opaque"===z.alphaMode?3:4:3,noUnpackFlip:!0})};a.defaultMaterial=B;a.getMaterialAndTextures=function(C,z){const A=new Map,p=(N,M)=>{if(m.isNone(N))return-1;if(A.has(N.id))return N=A.get(N.id),N.usage|=M,N.id;const L=A.size;A.set(N.id,{id:L,usage:M});return L};var y=z.pbrMetallicRoughness;const D=y&&y.baseColorFactor,E=z.emissiveFactor,F=null==z.normalTexture&&null==z.emissiveTexture&&
null==z.occlusionTexture&&(y?null==y.metallicRoughnessTexture&&1===y.roughnessFactor&&(1===y.metallicFactor||0===y.metallicFactor):!0),G=F?n.PBRSchematicMRRValues[0]:y?y.metallicFactor:1,P=F?n.PBRSchematicMRRValues[1]:y?y.roughnessFactor:1;y={baseColorFactor:D?[D[0],D[1],D[2],D[3]]:[1,1,1,1],baseColorTextureId:p(y&&y.baseColorTexture,"mask"===z.alphaMode?l.TextureUsage.Color|l.TextureUsage.AlphaMask:l.TextureUsage.Color),metallicRoughnessTextureId:p(y&&y.metallicRoughnessTexture,l.TextureUsage.MetallicRoughness),
metallicFactor:G,roughnessFactor:P};z={alphaMode:z.alphaMode,alphaCutoff:z.alphaCutoff,doubleSided:z.doubleSided,cullFace:"none"===z.cullFace?f.CullFaceOptions.None:"back"===z.cullFace?f.CullFaceOptions.Back:"front"===z.cullFace?f.CullFaceOptions.Front:void 0,normalTextureId:p(z.normalTexture,l.TextureUsage.Normal),emissiveTextureId:p(z.emissiveTexture,l.TextureUsage.Emissive),occlusionTextureId:p(z.occlusionTexture,l.TextureUsage.Occlusion),emissiveFactor:E?[E[0],E[1],E[2]]:[0,0,0],metallicRoughness:y,
wrapTextures:!1,hasParametersFromSource:F};const K=[];A.forEach(({usage:N},M)=>{var L=m.isSome(C)&&C[M]&&C[M].formats;L=L?h(L.map(({name:J,format:H})=>({name:J,encoding:t[H]}))):[];K.push({id:M,usage:N,encodings:L})});return{material:z,textures:K}};a.getMaterialAndTexturesFromShared=function(C){var z=C&&C.materialDefinitions?Object.keys(C.materialDefinitions)[0]:null,A=C&&C.textureDefinitions?Object.keys(C.textureDefinitions)[0]:null;z=z&&C.materialDefinitions[z];A=A&&C.textureDefinitions[A];C=B();
if(null!=z){z=z.params;z.diffuse&&(C.metallicRoughness.baseColorFactor=[z.diffuse[0],z.diffuse[1],z.diffuse[2],1]);null!=z.doubleSided&&(C.doubleSided=z.doubleSided,C.cullFace=z.doubleSided?f.CullFaceOptions.None:f.CullFaceOptions.Back);if("none"===z.cullFace||"front"===z.cullFace||"back"===z.cullFace)C.cullFace="none"===z.cullFace?f.CullFaceOptions.None:"back"===z.cullFace?f.CullFaceOptions.Back:f.CullFaceOptions.Front;z.transparency&&(C.metallicRoughness.baseColorFactor[3]=c.clamp(1-z.transparency,
0,1));if(z.useVertexColorAlpha||1>C.metallicRoughness.baseColorFactor[3])C.alphaMode="blend"}z=[];if(null!=A){!A.wrap||"repeat"!==A.wrap[0]&&"repeat"!==A.wrap[1]||(C.wrapTextures=!0);let p=l.TextureUsage.Color;"rgba"===A.channels&&(C.alphaMode="blend",p|=l.TextureUsage.AlphaMask);const y=A.images[A.images.length-1],D=E=>E&&E.split("/").pop();A=Array.isArray(A.encoding)?h(A.encoding.map((E,F)=>({name:D(y.href[F]),encoding:x[E]||0}))):[{name:D(y.href),encoding:x[A.encoding]||0}];z.push({id:0,usage:p,
encodings:A});C.metallicRoughness.baseColorTextureId=0}return{material:C,textures:z}};a.getSupportedEncodings=function(C){const z=!!C.compressedTextureS3TC;C=!!C.compressedTextureETC;const A=b("disable-feature:i3s-basis")?0:l.TextureEncoding.Basis|l.TextureEncoding.KTX2,p=A|l.TextureEncoding.DDS_S3TC;return l.TextureEncoding.JPG|l.TextureEncoding.PNG|(z?p:0)|(C?A:0)};a.selectEncoding=function(C,z){return C.find(A=>0!==(A.encoding&z))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/core/material/RenderTexture":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../../core/promiseUtils"],function(a,b,c,m){let l=function(){function r(n,g){this._textureRep=n;this._disposed=!1;n=this._textureRep.acquire(g);m.isPromiseLike(n)?(n.then(k=>{this._disposed?c.releaseMaybe(k):this._textureRef=k}),this.loadPromise=n):this._textureRef=n}r.prototype.dispose=function(){this._textureRef=c.releaseMaybe(this._textureRef);
this._disposed=!0};b._createClass(r,[{key:"glTexture",get:function(){return c.isSome(this._textureRef)?this._textureRef.glTexture:null}}]);return r}();a.RenderTexture=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SStreamDataController":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/promiseUtils"],function(a,b,c){let m=function(){function l(n,g){this.requester=n;this.apiKey=g;
this.activeRequests=new Set}var r=l.prototype;r.request=function(n,g,k){const f=new AbortController;k=c.onAbortOrThrow(k,()=>f.abort());n=this.requester.request(n,g,{signal:f.signal,query:{token:this.apiKey}});const d={response:n,abortController:f,abortHandle:k};this.activeRequests.add(d);c.always(n,()=>{var e;d.abortController=null;null==(e=d.abortHandle)?void 0:e.remove();d.abortHandle=null;this.activeRequests.delete(d)});return n};r.cancelAll=function(){this.activeRequests.forEach(n=>{var g,k;
null==(g=n.abortController)?void 0:g.abort();n.abortController=null;null==(k=n.abortHandle)?void 0:k.remove()});this.activeRequests.clear()};b._createClass(l,[{key:"busy",get:function(){return this.requester.busy}}]);return l}();a.I3SStreamDataController=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SViewportQueries":function(){define("../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/support/frustum ../../../../geometry/support/spatialReferenceUtils ../../../../chunks/sphere ../../../../layers/graphics/dehydratedFeatures ../graphics/elevationAlignmentUtils ../graphics/ElevationContext ../graphics/featureExpressionInfoUtils ./I3SNode ./I3SUtil ../../support/orientedBoundingBox".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t){return function(){function x(q,u,C,z,A,p,y,D,E={}){this._indexSR=q;this._renderCoordsHelper=u;this.clippingArea=A;this._elevationProvider=p;this._viewingMode=y;this._options=E;this._frustum=n.create();this._useFrustumCulling=!1;this._poi=c.create();this.minDistance=Infinity;this.maxDistance=0;this.maxLodLevel=2;this._tmpObb=t.create();this._tmp1=c.create();this._tmp2=c.create();this._tmp3=c.create();this._tmp0=c.create();this._screenspaceErrorBias=E.screenspaceErrorBias||
1;this._progressiveLoadFactor=E.progressiveLoadFactor||1;this.updateCamera(C,z);this.engineSR=this._renderCoordsHelper.spatialReference;this.updateElevationInfo(D);this._tmpPoint=f.makeDehydratedPoint(0,0,0,q);this._isECEFOBBInLocalMode=this._indexSR.isWGS84&&(this.engineSR.isWebMercator||g.isPlateCarree(this.engineSR));this._indexSREllipsoidRadius=r.getReferenceEllipsoid(this._indexSR).radius}var B=x.prototype;B.updateElevationInfo=function(q){null==q?this._elevationContext=null:(this._elevationContext=
e.ElevationContext.fromElevationInfo(q),this._elevationContext.updateFeatureExpressionInfoContext(h.createContextWithoutExpressionSupport(h.extractExpressionInfo(q,!1))))};B.updateCamera=function(q,u){(this._useFrustumCulling=u)&&n.fromMatrix(q.viewMatrix,q.projectionMatrix,this._frustum);this._screenSizeFactor=1/(q.perScreenPixelRatio/2);this._camPos=q.eye;this.minDistance=Infinity;this.maxDistance=0};B.setPointOfInterest=function(q){this._poi=q};B.updateScreenSpaceErrorBias=function(q){const u=
this._screenspaceErrorBias;this._screenspaceErrorBias=q;return u};B.updateClippingArea=function(q){this.clippingArea=q};B.getElevationRange=function(q){if(a.isNone(this._elevationContext))return null;var u=q.mbs[0];const C=q.mbs[1],z=q.mbs[2];q=q.mbs[3];const A="relative-to-scene"===this._elevationContext.mode?"scene":"ground";if(this._elevationProvider.getSphereElevationBounds)return this._elevationProvider.getSphereElevationBounds(u,C,z,q,this._indexSR,A);u=this._elevationProvider.getElevation(u,
C,z,this._indexSR,A);return a.isSome(u)?{min:u,max:u}:null};B.getRenderMbs=function(q){const u=q.renderMbs;if(w.isValidMbs(u))return u;m.copy(u,q.mbs);this._elevationContext&&1E5>u[3]&&(this._tmpPoint.x=u[0],this._tmpPoint.y=u[1],this._tmpPoint.z=u[2],u[2]=d.evaluateElevationAlignmentAtPoint(this._tmpPoint,this._elevationProvider,this._elevationContext,this._renderCoordsHelper));l.projectBoundingSphere(u,this._indexSR,u,this.engineSR);return u};B.getVisibilityObb=function(q){if(a.isSome(q.visibilityObb))return q.visibilityObb;
const u=q.serviceObb,C=.01*this._indexSREllipsoidRadius;if(a.isNone(u)||!w.isValidObb(u)||this._isECEFOBBInLocalMode&&u.halfSize.some(z=>z>C))return null;q.serviceObbInRenderSR=this._computeRenderObb(u,q.serviceObbInRenderSR,q.mbs[3],q.elevationRange);return q.serviceObbInRenderSR};B._computeRenderObb=function(q,u,C,z){if(a.isNone(u))u=t.create();else if(w.isValidObb(u))return u;let A=0,p=0;if(this._elevationContext&&a.isSome(z)&&Number.isFinite(z.min))switch(this._elevationContext.mode){case "relative-to-ground":A=
this._elevationContext.geometryZWithOffset(q.center[2],this._renderCoordsHelper)+z.min-q.center[2];p=z.max-z.min;break;case "on-the-ground":A=z.min-q.center[2],p=z.max-z.min}else this._elevationContext&&1E5>C&&(this._tmpPoint.x=q.center[0],this._tmpPoint.y=q.center[1],this._tmpPoint.z=q.center[2],A=d.evaluateElevationAlignmentAtPoint(this._tmpPoint,this._elevationProvider,this._elevationContext,this._renderCoordsHelper)-q.center[2]);0<p?(w.transformObb(q,this._indexSR,this._tmpObb,this.engineSR,A),
w.computeOffsetObb(this._tmpObb,0,p,this._viewingMode,u)):w.transformObb(q,this._indexSR,u,this.engineSR,A);return u};B.isNodeVisible=function(q){const u=this.getRenderMbs(q);if(!this._isMBSinClippingArea(u))return!1;if(!this._useFrustumCulling)return!0;q=this.getVisibilityObb(q);return a.isSome(q)?t.isVisible(q,this._frustum):n.intersectsSphere(this._frustum,k.wrap(u))};B.isGeometryVisible=function(q){if(!this._useFrustumCulling)return!0;const u=q.geometryObb;return a.isSome(u)?t.isVisible(u,this._frustum):
this.isNodeVisible(q)};B._isMBSinClippingArea=function(q){return a.isNone(this.clippingArea)?!0:w.intersectBoundingRectWithMbs(this.clippingArea,q)!==w.MbsIntersectResult.OUTSIDE};B._screenSpaceDiameterMbs=function(q,u){var C=this.getRenderMbs(q);q=Math.sqrt(b.squaredDistance(C,this._camPos));C=q-C[3];this._updateMinMaxDistance(q);return 0>C?.5*Number.MAX_VALUE:u/C*this._screenSizeFactor};B.calcCameraDistance=function(q){return this.calcCameraDistanceToCenter(q)-this.getRenderMbs(q)[3]};B.calcCameraDistanceToCenter=
function(q){q=this.getRenderMbs(q);q=b.distance(q,this._camPos);this._updateMinMaxDistance(q);return q};B.calcAngleDependentLoD=function(q){q=this.getRenderMbs(q);const u=q[3];q=(Math.abs(q[0]*(q[0]-this._camPos[0])+q[1]*(q[1]-this._camPos[1])+q[2]*(q[2]-this._camPos[2]))/b.length(q)+u)/b.distance(q,this._camPos);return Math.min(1,q)};B.hasLOD=function(q){return q.lodMetric!==v.LodMetric.None};B._getDistancePlanarMode=function(q,u){var C=q[0]-u[0];const z=q[1]-u[1];q=q[2]-u[2];C=C*C+z*z;u=u[3];if(C<=
u*u)return Math.abs(q);u=Math.sqrt(C)-u;return Math.sqrt(q*q+u*u)};B._getDistanceGlobeMode=function(q,u){var C=b.length(u);const z=b.length(q)-C;b.scale(this._tmp0,q,b.dot(q,u)/b.squaredLength(q));var A=b.squaredDistance(u,this._tmp0),p=u[3];if(A<=p*p)return Math.abs(z);u=b.scale(this._tmp0,u,1/C);C=b.scale(this._tmp1,u,C-p*p/2/C);A=b.subtract(this._tmp2,q,C);A=b.subtract(this._tmp2,A,b.scale(this._tmp3,u,b.dot(u,A)));C=b.add(this._tmp2,C,b.scale(this._tmp2,A,p/b.length(A)));p=b.distance(q,C);2E5<=
z&&(q=b.subtract(this._tmp1,q,C),q=b.dot(q,u)/b.length(q),.08>q&&(q=1E-4),p/=q);return p};B._getDistance=function(q,u){return this.engineSR===r.getSphericalPCPF(this.engineSR)?this._getDistanceGlobeMode(q,u):this._getDistancePlanarMode(q,u)};B._updateMinMaxDistance=function(q){0<q?(this.minDistance=Math.min(this.minDistance,q),this.maxDistance=Math.max(this.maxDistance,q)):(this.minDistance=0,this.maxDistance=Math.max(this.maxDistance,-q))};B.getLodLevel=function(q){if(q.lodMetric===v.LodMetric.None)return 0;
if(0===q.childCount)return this.maxLodLevel;if(this._useFrustumCulling&&1>this._progressiveLoadFactor){const u=this._screenspaceErrorBias;return this.evaluateLODmetric(q,this._progressiveLoadFactor*this._screenspaceErrorBias)?this.evaluateLODmetric(q,u)?2:1:0}return this.evaluateLODmetric(q,this._screenspaceErrorBias)?this.maxLodLevel:0};B.evaluateLODmetric=function(q,u){switch(q.lodMetric){case v.LodMetric.ScreenSpaceRelative:{const C=this.getRenderMbs(q),z=this._getDistance(this._camPos,C),A=2*
z/this._screenSizeFactor;this._updateMinMaxDistance(z+C[3]);return q.maxError*u<=A}case v.LodMetric.MaxScreenThreshold:return u=this._screenSpaceDiameterMbs(q,q.mbs[3]*u),this._options.angleDependentLoD&&(u*=this.calcAngleDependentLoD(q)),u<q.maxError;case v.LodMetric.RemovedFeatureDiameter:return 10>this._screenSpaceDiameterMbs(q,q.maxError)*u;case v.LodMetric.DistanceRangeFromDefaultCamera:return this.calcCameraDistance(q)>q.maxError*u}return!1};B.distToPOI=function(q){q=this.getRenderMbs(q);return b.distance(q,
this._poi)-q[3]};B.distCameraToPOI=function(){return b.distance(this._camPos,this._poi)};return x}()})},"esri/layers/support/SceneModification":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/JSONSupport ../../core/lang ../../core/Warning ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/decorators/persistable ../../geometry/projection ../../geometry/Polygon".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h){var v;c=v=function(w){function t(B){B=w.call(this,B)||this;B.geometry=null;B.type="clip";return B}a._inheritsLoose(t,w);var x=t.prototype;x.writeGeometry=function(B,q,u,C){if(C.layer&&C.layer.spatialReference&&!C.layer.spatialReference.equals(this.geometry.spatialReference)){if(!e.canProjectWithoutEngine(B.spatialReference,C.layer.spatialReference)){C&&C.messages&&C.messages.push(new r("scenemodification:unsupported","Scene modifications with incompatible spatial references are not supported",
{modification:this,spatialReference:C.layer.spatialReference,context:C}));return}const z=new h;e.projectPolygon(B,z,C.layer.spatialReference);q[u]=z.toJSON(C)}else q[u]=B.toJSON(C);delete q[u].spatialReference};x.clone=function(){return new v({geometry:l.clone(this.geometry),type:this.type})};return t}(m.JSONSupport);b.__decorate([n.property({type:h}),d.persistable()],c.prototype,"geometry",void 0);b.__decorate([f.writer(["web-scene","portal-item"],"geometry")],c.prototype,"writeGeometry",null);b.__decorate([n.property({type:["clip",
"mask","replace"],nonNullable:!0}),d.persistable()],c.prototype,"type",void 0);return c=v=b.__decorate([k.subclass("esri.layers.support.SceneModification")],c)})},"esri/views/3d/layers/I3SMeshViewLabeler":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../symbols ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/diffUtils ../../../chunks/vec3f64 ../../../layers/graphics/dehydratedFeatures ./graphics/Graphics3DCore ./graphics/Graphics3DScaleVisibility ./i3s/I3SGeometryUtil ../support/LimitGraphicsMap ../webgl-engine/lib/basicInterfaces ../../../symbols/PointSymbol3D".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z){m=function(y){function D(F){F=y.call(this,F)||this;F.loadedGraphics=new u.LimitGraphicsMap(5E4);F.slicePlaneEnabled=!1;F._renderingInfo={symbol:new z};F._handles=new r;F._graphicsByNode=new Map;F._scaleVisibility=new B({layerScaleEnabled:!1});return F}a._inheritsLoose(D,y);var E=D.prototype;E.initialize=function(){this._graphicsCore=new x.Graphics3DCore({owner:this,layer:this.layer,preferredUpdatePolicy:C.UpdatePolicy.ASYNC,elevationFeatureExpressionEnabled:!1,
graphicSymbolSupported:!1,getRenderingInfoWithoutRenderer:!0,hasZ:!0,hasM:!1});this._scaleVisibility.setup(this,this.layer,(P,K,N)=>this._graphicsCore.spatialIndex.queryGraphicUIDsInExtent(P,K,N),this._graphicsCore,this.view.basemapTerrain);const F=this.view.labeler.addGraphicsOwner(this._graphicsCore,this._scaleVisibility,{emptySymbolLabelSupported:!0,elevationInfoOverride:{mode:"absolute-height",offset:0},disablePlacement:{logEntityDescription:"3D Object Scene Layer features"}}),G=this.view.deconflictor.addGraphicsOwner(this._graphicsCore);
this._graphicsCore.setup({labeler:F,deconflictor:G,scaleVisibility:this._scaleVisibility}).then(()=>this._graphicsCore.startCreateGraphics()).catch(()=>{});this._handles.add(g.watch(()=>this.layer.labelingInfo,(P,K)=>{v.diff(P,K)&&this._graphicsCore.updateLabelingInfo()}))};E.destroy=function(){this._handles=n.destroyMaybe(this._handles);this._scaleVisibility=n.destroyMaybe(this._scaleVisibility);this._graphicsCore=n.destroyMaybe(this._graphicsCore);this.loadedGraphics=n.destroyMaybe(this.loadedGraphics);
this.view=null};E.addNodeMeta=function(F,G){let P=0;const K=F.filteredIds,N=this.view.spatialReference,M=F.featureIds.map((L,J)=>{q.boundingBoxTop(J,this.collection,F.objectHandle,p);const H=t.makeDehydratedPoint(0,0,0,N);this.view.renderCoordsHelper.fromRenderCoords(p,H);J=G(J,F);let I=!1;n.isNone(K)?I=!0:P<K.length&&L===K[P]&&(I=!0,P++);return{objectId:L,uid:c.generateUID(),attributes:J,visible:I,geometry:H}});this.loadedGraphics.addMany(M);this._graphicsByNode.set(F.node.index,M)};E.updateLabelPositions=
function(F){const G=this._graphicsByNode.get(F.node.index);let P=0;const K=this.view.spatialReference,N=[];for(let M=0;M<F.featureIds.length;M++){const L=G[P];F.featureIds[M]===L.objectId&&(P++,q.boundingBoxTop(M,this.collection,F.objectHandle,p),this.view.renderCoordsHelper.fromRenderCoords(p,p,K),n.isSome(L.geometry)&&"point"===L.geometry.type&&L.geometry.x===p[0]&&L.geometry.y===p[1]&&L.geometry.z===p[2]||(n.isSome(L.geometry)&&"point"===L.geometry.type?(L.geometry.x=p[0],L.geometry.y=p[1],L.geometry.z=
p[2]):L.geometry=t.makeDehydratedPoint(p[0],p[1],p[2],K),N.push(L.uid)))}this._graphicsCore.updateLabelingInfo(N)};E.setNodeMetaAttributes=function(F,G){const P=this._graphicsByNode.get(F.node.index),K=Array(P.length);for(let N=0;N<P.length;N++){const M=P[N];M.attributes=G(N,F);K[N]=M.uid}this._graphicsCore.updateLabelingInfo(K)};E.applyFilterChange=function(F){var G=this._graphicsByNode.get(F.node.index);if(G)if(n.isNone(F.filteredIds))for(var P of G)P.visible||(P.visible=!0,A.graphic=P,A.property=
"visible",A.oldValue=!1,A.newValue=!0,this._graphicsCore.graphicUpdateHandler(A));else{P=0;for(const K of G)G=K.visible,P<F.filteredIds.length&&K.objectId===F.filteredIds[P]?(K.visible=!0,P++):K.visible=!1,G!==K.visible&&(A.graphic=K,A.property="visible",A.oldValue=G,A.newValue=K.visible,this._graphicsCore.graphicUpdateHandler(A))}};E.removeNodeMeta=function(F){this.loadedGraphics.removeManyByObjectId(F.featureIds)};E.getRenderingInfo=function(){return this._renderingInfo};E.notifyGraphicGeometryChanged=
function(){};E.notifyGraphicVisibilityChanged=function(){};a._createClass(D,[{key:"updatePolicy",get:function(){return this._graphicsCore.effectiveUpdatePolicy}},{key:"usedMemory",get:function(){return this._graphicsCore.usedMemory}},{key:"unloadedMemoryEstimate",get:function(){return this._graphicsCore.unprocessedMemoryEstimate}},{key:"test",get:function(){return{graphicsCore:this._graphicsCore}}}]);return D}(l);b.__decorate([k.property()],m.prototype,"view",void 0);b.__decorate([k.property()],m.prototype,
"layer",void 0);b.__decorate([k.property()],m.prototype,"collection",void 0);b.__decorate([k.property()],m.prototype,"loadedGraphics",void 0);b.__decorate([k.property({aliasOf:"_graphicsCore.updating"})],m.prototype,"updating",void 0);b.__decorate([k.property()],m.prototype,"slicePlaneEnabled",void 0);b.__decorate([k.property()],m.prototype,"_graphicsCore",void 0);m=b.__decorate([h.subclass("esri.views.3d.layers.I3SMeshViewLabeler")],m);const A={graphic:null,property:null,oldValue:null,newValue:null},
p=w.create();return m})},"esri/views/3d/layers/i3s/I3SGeometryUtil":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox".split(" "),function(a,b,c,m,l,r){function n(f,d,e,h){f=d.getComponentAabb(e,f,g);d=d.getObjectTransform(e);for(e=0;8>e;++e)k[0]=e&1?f[0]:f[3],k[1]=e&2?f[1]:f[4],k[2]=e&4?f[2]:f[5],c.transformMat3(k,k,d.rotationScale),c.add(k,k,d.position),h[3*e]=k[0],h[3*e+
1]=k[1],h[3*e+2]=k[2];return h}const g=r.create(),k=m.create();a.boundingBoxCornerPoints=n;a.boundingBoxTop=function(f,d,e,h){f=d.getComponentAabb(e,f,g);d=d.getObjectTransform(e);h[0]=0;h[1]=0;h[2]=0;for(e=0;8>e;++e)k[0]=e&1?f[0]:f[3],k[1]=e&2?f[1]:f[4],k[2]=f[5],c.transformMat3(k,k,d.rotationScale),c.add(k,k,d.position),h[0]+=k[0],h[1]+=k[1],h[2]+=k[2];h[0]/=8;h[1]/=8;h[2]/=8;return h};a.createGetFeatureExtent=function(f,d,e){const h=new Float64Array(24);return v=>{var w=v.meta.featureExtents;if(b.isNone(w)){w=
new Float64Array(6*v.meta.featureIds.length);v.meta.featureExtents=w;for(let t=0;t<w.length;t+=6)w[t]=Number.POSITIVE_INFINITY}w=new Float64Array(w.buffer,6*v.index*Float64Array.BYTES_PER_ELEMENT,6);w[0]===Number.POSITIVE_INFINITY&&(n(v.index,e,v.meta.objectHandle,h),l.projectBuffer(h,d,0,h,f,0,8)?(r.set(w,r.NEGATIVE_INFINITY),r.expandWithBuffer(w,h,0,8)):r.set(w,r.ZERO));return w}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/LimitGraphicsMap":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/MapUtils","./GraphicsMap"],function(a,b,c,m,l){c=function(g){function k(d){var e=g.call(this)||this;e._limit=d;e._all=new l.GraphicsMap;e._active=new n(b._assertThisInitialized(e));e._pending=new Map;e._handle=e._all.on("change",h=>e._handleChanges(h));return e}b._inheritsLoose(k,g);var f=k.prototype;f.destroy=function(){this._handle.remove()};f.toArray=function(){return this._active.toArray()};f.find=function(d){return this._active.find(d)};
f.forEach=function(d){this._active.forEach(d)};f.addMany=function(d){this._all.addMany(d)};f.removeManyByObjectId=function(d){this._all.removeManyByObjectId(d)};f._handleChanges=function(d){let e=d.removed;if(0<this._pending.size){e=[];for(var h of d.removed)this._pending.delete(h.objectId)||e.push(h)}h=this._limit-this._active.length+e.length;h<d.added.length&&(this._active.removeMany(e),e=[],r.reset(1-this._limit/(this._active.length+d.added.length)),this._active.forEach(w=>{r.sample()&&(e.push(w),
this._pending.set(w.objectId,w))}),h=this._limit-this._active.length+e.length);let v=d.added;if(h<d.added.length){v=[];r.reset(h/d.added.length);for(const w of d.added)r.sample()?v.push(w):this._pending.set(w.objectId,w)}d=h-v.length;0<d&&0<this._pending.size&&(r.reset(d/this._pending.size),this._pending.forEach(w=>{r.sample()&&(v.push(w),this._pending.delete(w.objectId))}));this._active.addAndRemove(v,e)};b._createClass(k,[{key:"length",get:function(){return this._active.length}}]);return k}(c);
const r=new (function(){function g(){this.percentage=1;this.last=-1;this.index=0}var k=g.prototype;k.reset=function(f){this.percentage=f;this.last=-1};k.sample=function(){const f=Math.floor(this.index*this.percentage);++this.index;if(f===this.last)return!1;this.last=f;return!0};return g}());let n=function(){function g(f){this._parent=f;this._map=new Map}var k=g.prototype;k.forEach=function(f){this._map.forEach(d=>f(d))};k.find=function(f){let d;m.someMap(this._map,e=>f(e)?(d=e,!0):!1);return d};k.toArray=
function(){return[...this._map.values()]};k.addAndRemove=function(f,d){for(const e of f)this._map.set(e.objectId,e);for(const e of d)this._map.delete(e.objectId);(0<f.length||0<d.length)&&this._parent.emit("change",{added:f,removed:d})};k.removeMany=function(f){for(const d of f)this._map.delete(d.objectId);0<f.length&&this._parent.emit("change",{added:[],removed:f})};b._createClass(g,[{key:"length",get:function(){return this._map.size}}]);return g}();a.LimitGraphicsMap=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/GraphicsMap":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/MapUtils"],function(a,b,c,m){c=function(l){function r(){var g=l.apply(this,arguments)||this;g._map=new Map;return g}b._inheritsLoose(r,l);var n=r.prototype;n.clear=function(){if(0<this._map.size){const g=this.toArray();this._map.clear();this.emit("change",{added:[],removed:g})}};n.get=function(g){return this._map.get(g)};
n.addMany=function(g){if(0!==g.length){var k=new Set;for(let f=0;f<g.length;f++){const d=g[f],e=d.objectId,h=this._map.get(e);h?(k.add(e),d!==h&&(g[f]=h),++h.refCount):(d.refCount=1,this._map.set(e,d))}g=0<k.size?g.filter(f=>!k.has(f.objectId)):g;0<g.length&&this.emit("change",{added:g,removed:[]})}};n.removeMany=function(g){const k=[];for(const f of g){g=f.objectId;const d=this._map.get(g);null!=d&&0>=--d.refCount&&(this._map.delete(g),k.push(f))}0<k.length&&this.emit("change",{added:[],removed:k})};
n.removeManyByObjectId=function(g){const k=[];for(const f of g)g=this._map.get(f),null!=g&&0>=--g.refCount&&(this._map.delete(f),k.push(g));0<k.length&&this.emit("change",{added:[],removed:k})};n.toArray=function(){return[...this._map.values()]};n.find=function(g){let k;m.someMap(this._map,f=>g(f)?(k=f,!0):!1);return k};n.forEach=function(g){this._map.forEach(k=>g(k))};b._createClass(r,[{key:"length",get:function(){return this._map.size}}]);return r}(c);a.GraphicsMap=c;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/I3SMeshWorkerHandle":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/maybe ../../../core/PooledArray ../../../core/workers/WorkerHandle ../../../geometry/projection ../../../libs/i3s/enums".split(" "),function(a,b,c,m,l,r,n,g){function k(h,v,w){d.clear();var t=Infinity;let x=Infinity,B=-Infinity,q=-Infinity,u=!1;for(const z of v){var C="clip"===z.type?g.ModificationType.Inside:
"mask"===z.type?g.ModificationType.Outside:g.ModificationType.Replace;const A=z.geometry;v=p=>p;if(A.spatialReference){if(!n.canProjectWithoutEngine(A.spatialReference,w)){f.warn("Can't project modification polygon into layer spatial reference, ignoring modification");continue}v=p=>{n.projectVectorToVector(p,A.spatialReference,e,w);return e}}else A.hasZ||(e[2]=0,v=p=>{e[0]=p[0];e[1]=p[1];return e});u=u||C===g.ModificationType.Outside;d.push(C);d.push(A.rings.length);for(const p of A.rings){d.push(p.length);
for(const y of p)C=v(y),d.push(C[0]),d.push(C[1]),d.push(C[2]),t=Math.min(t,C[0]),x=Math.min(x,C[1]),B=Math.max(B,C[0]),q=Math.max(q,C[1])}}m.isSome(h)&&(u?(d.push(g.ModificationType.Inside),d.push(2),d.push(4),d.push(t-1E-4),d.push(x-1E-4),d.push(0),d.push(B+1E-4),d.push(x-1E-4),d.push(0),d.push(B+1E-4),d.push(q+1E-4),d.push(0),d.push(t-1E-4),d.push(q+1E-4),d.push(0)):(d.push(g.ModificationType.Outside),d.push(1)),d.push(4),d.push(h[0]),d.push(h[1]),d.push(0),d.push(h[2]),d.push(h[1]),d.push(0),
d.push(h[2]),d.push(h[3]),d.push(0),d.push(h[0]),d.push(h[3]),d.push(0));d.push(g.ModificationType.Finished);h=new Float64Array(d.length);for(t=0;t<d.length;++t)h[t]=d.getItemAt(t);return h}const f=c.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle");c=function(h){function v(t){return h.call(this,"SceneLayerWorker","process",{process:x=>[x.geometryBuffer]},t,{hasInitialize:!0})||this}b._inheritsLoose(v,h);var w=v.prototype;w.setModifications=function(t,x,B,q){t={context:t,modifications:k(x,B,q),
isGeodetic:q.isGeographic};this.broadcast(t,"setModifications")};w.setLegacySchema=function(t,x){x=JSON.stringify(x);this.broadcast({context:t,jsonSchema:x},"setLegacySchema")};w.destroyContext=function(t){return this.broadcast(t,"destroyContext")};return v}(r.WorkerHandle);const d=new l({deallocator:null}),e=[0,0,0];a.I3SMeshWorkerHandle=c;a.toWasmModification=k;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/libs/i3s/enums":function(){define(["exports"],
function(a){a.IndexType=void 0;(function(b){b[b.None=0]="None";b[b.Int16=1]="Int16";b[b.Int32=2]="Int32"})(a.IndexType||(a.IndexType={}));a.ModificationType=void 0;(function(b){b[b.Replace=0]="Replace";b[b.Outside=1]="Outside";b[b.Inside=2]="Inside";b[b.Finished=3]="Finished"})(a.ModificationType||(a.ModificationType={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/II3SMeshView3D":function(){define(["exports"],function(a){a.ForAllFeaturesVisibilityMode=
void 0;(function(b){b[b.VISIBLE_ONLY=0]="VISIBLE_ONLY";b[b.ALL=1]="ALL";b[b.ALL_IN_CLIPPING_AREA=2]="ALL_IN_CLIPPING_AREA"})(a.ForAllFeaturesVisibilityMode||(a.ForAllFeaturesVisibilityMode={}));a.ForAllFeaturesReturnType=void 0;(function(b){b[b.EXIT=0]="EXIT";b[b.CONTINUE=1]="CONTINUE";b[b.SKIP=2]="SKIP"})(a.ForAllFeaturesReturnType||(a.ForAllFeaturesReturnType={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/SceneLayerWorker":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/typedArrayUtil ../../../libs/i3s/enums ../../../libs/i3s/I3SModule ./i3s/I3SNode".split(" "),
function(a,b,c,m,l,r,n){function g(){g=b._asyncToGenerator(function*(z){yield B();const A=[z.geometryBuffer];return{result:v(z,A),transferList:A}});return g.apply(this,arguments)}function k(){k=b._asyncToGenerator(function*(z){var A;yield B();const p=[z.geometryBuffer];var {geometryBuffer:y}=z,D=y.byteLength;z=u._malloc(D);D=new Uint8Array(u.HEAPU8.buffer,z,D);D.set(new Uint8Array(y));y=u.dracoDecompressPointCloudData(z,D.byteLength);u._free(z);if(0<y.error.length)throw`i3s.wasm: ${y.error}`;z=0<
(null==(A=y.featureIds)?void 0:A.length)?m.slice(y.featureIds):null;A=m.slice(y.positions);z&&p.push(z.buffer);p.push(A.buffer);return{result:{positions:A,featureIds:z},transferList:p}});return k.apply(this,arguments)}function f(){f=b._asyncToGenerator(function*(z){yield B();w(z);z={buffer:z.buffer};return{result:z,transferList:[z.buffer]}});return f.apply(this,arguments)}function d(){d=b._asyncToGenerator(function*(z){yield B();h(z)});return d.apply(this,arguments)}function e(){e=b._asyncToGenerator(function*(z){yield B();
u.setLegacySchema(z.context,z.jsonSchema)});return e.apply(this,arguments)}function h(z){const A=z.modifications,p=u._malloc(8*A.length),y=new Float64Array(u.HEAPU8.buffer,p,A.length);for(let D=0;D<A.length;++D)y[D]=A[D];u.setModifications(z.context,p,A.length,z.isGeodetic);u._free(p)}function v(z,A){if(!u)return null;const {context:p,localOrigin:y,globalTrafo:D,mbs:E,obb:F,elevationOffset:G,geometryBuffer:P,geometryDescriptor:K,indexToVertexProjector:N,vertexToRenderProjector:M}=z;var L=u._malloc(P.byteLength),
J=u._malloc(33*Float64Array.BYTES_PER_ELEMENT),H=new Uint8Array(u.HEAPU8.buffer,L,P.byteLength);H.set(new Uint8Array(P));var I=new Float64Array(u.HEAPU8.buffer,J,33);x(I,y);var O=I.byteOffset+3*I.BYTES_PER_ELEMENT,Q=new Float64Array(I.buffer,O);x(Q,D);O+=16*I.BYTES_PER_ELEMENT;Q=new Float64Array(I.buffer,O);x(Q,E);O+=4*I.BYTES_PER_ELEMENT;c.isSome(F)&&(Q=new Float64Array(I.buffer,O),x(Q,F.center),O+=3*I.BYTES_PER_ELEMENT,Q=new Float64Array(I.buffer,O),x(Q,F.halfSize),O+=3*I.BYTES_PER_ELEMENT,Q=new Float64Array(I.buffer,
O),x(Q,F.quaternion));I={isDraco:!1,isLegacy:!1,color:z.layouts.some(T=>T.some(U=>"color"===U.name)),normal:z.needNormals&&z.layouts.some(T=>T.some(U=>"normalCompressed"===U.name)),uv0:z.layouts.some(T=>T.some(U=>"uv0"===U.name)),uvRegion:z.layouts.some(T=>T.some(U=>"uvRegion"===U.name)),featureIndex:K.featureIndex};H=u.process(p,!!z.obb,L,H.byteLength,K,I,J,G,N,M,z.normalReferenceFrame);u._free(J);u._free(L);if(0<H.error.length)throw`i3s.wasm: ${H.error}`;if(H.discarded)return null;L=0<H.componentOffsets.length?
m.slice(H.componentOffsets):null;J=0<H.featureIds.length?m.slice(H.featureIds):null;I=m.slice(H.interleavedVertedData).buffer;O=H.indicesType===l.IndexType.Int16?m.slice(new Uint16Array(H.indices.buffer,H.indices.byteOffset,H.indices.byteLength/2)):m.slice(new Uint32Array(H.indices.buffer,H.indices.byteOffset,H.indices.byteLength/4));Q=m.slice(H.positions);const S=H.positionIndicesType===l.IndexType.Int16?m.slice(new Uint16Array(H.positionIndices.buffer,H.positionIndices.byteOffset,H.positionIndices.byteLength/
2)):m.slice(new Uint32Array(H.positionIndices.buffer,H.positionIndices.byteOffset,H.positionIndices.byteLength/4));z={layout:z.layouts[0],interleavedVertexData:I,indices:O,hasColors:H.hasColors,hasModifications:H.hasModifications,positionData:{data:Q,indices:S}};J&&A.push(J.buffer);L&&A.push(L.buffer);A.push(I);A.push(O.buffer);A.push(Q.buffer);A.push(S.buffer);return{componentOffsets:L,featureIds:J,transformedGeometry:z,obb:H.obb}}function w(z){const {context:A,buffer:p}=z;z=u._malloc(p.byteLength);
const y=p.byteLength/Float64Array.BYTES_PER_ELEMENT,D=new Float64Array(u.HEAPU8.buffer,z,y),E=new Float64Array(p);D.set(E);u.filterOBBs(A,z,y);E.set(D);u._free(z)}function t(z){u&&u.destroy(z)}function x(z,A){for(let p=0;p<A.length;++p)z[p]=A[p]}function B(){if(u)return Promise.resolve();q||(q=r.get().then(z=>{u=z;q=null}));return q}let q,u;const C={transform:v,destroy:t};a.destroyContext=function(z){t(z)};a.dracoDecompressPointCloudData=function(z){return k.apply(this,arguments)};a.filterObbsForModifications=
function(z){return f.apply(this,arguments)};a.filterObbsForModificationsSync=w;a.initialize=B;a.interpretObbModificationResults=function(z){return 0===z?n.NodeIMModificationImpact.Unmodified:1===z?n.NodeIMModificationImpact.PotentiallyModified:2===z?n.NodeIMModificationImpact.Culled:n.NodeIMModificationImpact.Unknown};a.process=function(z){return g.apply(this,arguments)};a.setLegacySchema=function(z){return e.apply(this,arguments)};a.setModifications=function(z){return d.apply(this,arguments)};a.setModificationsSync=
h;a.test=C;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/libs/i3s/I3SModule":function(){define(["require","exports","../../assets"],function(a,b,c){function m(r){return c.getAssetUrl(`esri/libs/i3s/${r}`)}let l;b.get=function(){l||(l=(new Promise(r=>(new Promise((n,g)=>a(["../../chunks/i3s"],n,g))).then(n=>n.i3s).then(({default:n})=>{const g=n({locateFile:m,onRuntimeInitialized:()=>r(g)});delete g.then}))).catch(r=>{throw r;}));return l};Object.defineProperties(b,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/Highlights":function(){define(["../../../../core/arrayUtils","../II3SMeshView3D"],function(a,b){let c=function(){this.ids=new Set;this.paused=!1};return function(){function m({collection:r,forAllFeatures:n,forAllFeaturesOfNode:g}){this.highlights=[];this.collection=r;this.forAllFeatures=n;this.forAllFeaturesOfNode=g}var l=m.prototype;l.destroy=function(){this.highlights.forEach(r=>this._releaseSet(r));this.highlights=
null};l.acquireSet=function(){const r=new c;this.highlights.push(r);return{set:r,handle:{remove:()=>{this._releaseSet(r);a.removeUnordered(this.highlights,r)},pause:()=>{this._releaseSet(r);r.paused=!0},resume:()=>{r.paused=!1;this._initializeSet(r)}}}};l.setFeatureIds=function(r,n){n.forEach(g=>r.ids.add(g));this._initializeSet(r)};l._initializeSet=function(r){this.forAllFeatures((n,g,k)=>{r.ids.has(n)&&this.collection.addComponentHighlight(k.objectHandle,g);return b.ForAllFeaturesReturnType.CONTINUE})};
l._releaseSet=function(r){this.forAllFeatures((n,g,k)=>{r.ids.has(n)&&this.collection.removeComponentHighlight(k.objectHandle,g);return b.ForAllFeaturesReturnType.CONTINUE})};l.objectCreated=function(r){this.highlights.forEach(n=>{n.paused||this.forAllFeaturesOfNode(r,(g,k)=>{n.ids.has(g)&&this.collection.addComponentHighlight(r.objectHandle,k);return b.ForAllFeaturesReturnType.CONTINUE})})};l.objectDeleted=function(r){this.collection.clearHighlights(r.objectHandle)};return m}()})},"esri/views/3d/layers/i3s/I3SAsyncElevationUpdater":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../support/Scheduler".split(" "),
function(a,b,c,m,l,r,n,g,k,f){a.I3SAsyncElevationUpdater=function(d){function e(v,w){var t=d.call(this,{})||this;t._updateElevation=w;t.running=!1;t._nodeSet=new Set;t.own(v.registerTask(f.TaskPriority.ELEVATION_ALIGNMENT,b._assertThisInitialized(t)));return t}b._inheritsLoose(e,d);var h=e.prototype;h.normalizeCtorArgs=function(){return{}};h.schedule=function(v){this._nodeSet.add(v);this.running=!0};h.remove=function(v){this._nodeSet.delete(v);this._updateRunning()};h.runTask=function(v){const w=
this._nodeSet;for(const t of w)if(w.delete(t),this._updateElevation(t),v.madeProgress(),v.done)break;this._updateRunning()};h._updateRunning=function(){this.running=0<this._nodeSet.size};return e}(m);c.__decorate([l.property()],a.I3SAsyncElevationUpdater.prototype,"running",void 0);a.I3SAsyncElevationUpdater=c.__decorate([k.subclass("esri.views.3d.layers.i3s.I3SAsyncElevationUpdater.ts")],a.I3SAsyncElevationUpdater);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/layers/i3s/I3SAttributeOverrides":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../request ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../intl/number ../../../../layers/support/featureQueryAll".split(" "),function(a,b,c,m,l,r,n,g,k,f,d){const e=n.getLogger("esri.views.3d.layers.i3s.I3SAttributeOverrides");n=function(){function w(x,
B){this.layer=x;this.warnMaximumChangedObjectsExceeded=!1;this.changedObjectIds=new Set;this.pendingFetchAbortController=new AbortController;this.interactiveEditingSessions=null;this._maximumNumberOfEditOVerrides=5E4;this.memCache=B.newCache(`${x.uid}-attribute-overrides`);this.pendingFetchChangedObjectIds=this._fetchChangedObjectIds(this.pendingFetchAbortController.signal);this.pendingFetchChangedObjectIds.then(()=>this.pendingFetchAbortController=null)}var t=w.prototype;t.destroy=function(){this.layer=
null;this.memCache.destroy();this.memCache=null;this.pendingFetchAbortController&&(this.pendingFetchAbortController.abort(),this.pendingFetchAbortController=null);this.pendingFetchChangedObjectIds=null};t.createInteractiveEditSession=function(x){this.changedObjectIds.add(x);g.isNone(this.interactiveEditingSessions)&&(this.interactiveEditingSessions=[]);const B=this.interactiveEditingSessions,q=new h(x,{rollback:()=>{m.remove(B,q);0===B.length&&(this.interactiveEditingSessions=null)},commit:u=>{for(const [C,
z]of u)this.updateValue(x,C,z)}});B.unshift(q);return q};t.apply=function(){var x=b._asyncToGenerator(function*(B,q,u){if(!g.isNone(q)){var {loadedAttributes:C,attributeData:z}=q;if(!g.isNone(C)&&0!==C.length&&!g.isNone(z)&&(yield k.whenOrAbort(this.pendingFetchChangedObjectIds,u),0!==this.changedObjectIds.size)){q={loadedAttributes:C,attributeData:z};var A=this._getOverridesFromCache(B,q,this.changedObjectIds),{objectIds:p,fieldNames:y}=A;u=yield this._queryOverridesFromAssociatedLayer(p,y,u);g.isNone(u)||
this._processOverridesFromAssociatedLayer(B,u,y,q)}}});return function(B,q,u){return x.apply(this,arguments)}}();t.updateValue=function(x,B,q){this.changedObjectIds.add(x);this._cacheValue(x,B,q)};t._cacheValue=function(x,B,q){this.memCache.put(this._getCacheKey(x,B),q,this._memCacheValueSize(q))};t._getOverridesFromCache=function(x,{loadedAttributes:B,attributeData:q},u){const C=new Set,z=[];for(var A of B)z[A.index]=q[A.name];q=new Set;for(A=0;A<x.length;A++){const p=x[A];if(u.has(p))for(const y of B){const D=
this._fromCache(p,y.index);void 0!==D?z[y.index][A]=D:(C.add(p),q.add(y.name))}}return{objectIds:Array.from(C),fieldNames:Array.from(q)}};t._fromCache=function(x,B){const q=this._fromInteractiveEditingSession(x,B);if(void 0!==q)return q;x=this._getCacheKey(x,B);return this.memCache.get(x)};t._fromInteractiveEditingSession=function(x,B){if(!g.isNone(this.interactiveEditingSessions))for(const q of this.interactiveEditingSessions){if(q.objectId!==x)continue;const u=q.get(B);if(void 0!==u)return u}};
t._getCacheKey=function(x,B){return`${x}-${B}`};t._queryOverridesFromAssociatedLayer=function(){var x=b._asyncToGenerator(function*(B,q,u){if(0===B.length||0===q.length)return null;B=B.sort((A,p)=>A-p);this.warnMaximumChangedObjectsExceeded&&(this.warnMaximumChangedObjectsExceeded=!1,this._logMaximumObjectsExceededWarning());const C=g.unwrap(this.layer.associatedLayer),z=C.createQuery();z.where="1\x3d1";z.returnGeometry=!1;z.outFields=[C.objectIdField,...q];z.cacheHint=!0;z.objectIds=B;q=d.getMaximumQuerySize(C);
B=B.length>q?m.splitIntoChunks(B,q).map(A=>{const p=z.clone();p.objectIds=A;return l.resultOrAbort(d.queryAllJSON(C,p,{signal:u}))}):[l.resultOrAbort(d.queryAllJSON(C,z,{signal:u}))];return(yield Promise.all(B)).reduce((A,p)=>A.concat(p.ok?p.value.features:[]),[])});return function(B,q,u){return x.apply(this,arguments)}}();t._logMaximumObjectsExceededWarning=function(){let x=`The number of edited objects that are not yet cached in the scene service exceeds the maximum limit. Attribute changes will only be available for the first ${f.formatNumber(this._maximumNumberOfEditOVerrides)} objects. Please consider re-caching the scene service`;
const B=this.layer.portalItem;x=B&&B.loaded?x+` (${B.portal.url}/home/item.html?id=${B.id}#settings)`:x+` (${this.layer.parsedUrl.path})`;e.warn("#queryOverrides()",this.layer.title,`${x}.`)};t._processOverridesFromAssociatedLayer=function(x,B,q,{loadedAttributes:u,attributeData:C}){const z=g.unwrap(this.layer.associatedLayer).objectIdField,A=q.map(y=>C[y]),p=new Map(u.map(y=>[y.name,y.index]));u=q.map(y=>p.get(y));x=new Map(Array.from(x,(y,D)=>[y,D]));for(const y of B){B=y.attributes[z];for(let D=
0;D<q.length;D++){const E=u[D],F=x.get(B),G=y.attributes[q[D]];A[D][F]=G;this._cacheValue(B,E,G)}}};t._memCacheValueSize=function(x){return"string"===typeof x?r.estimateStringByteSize(x):r.estimateNumberByteSize()};t._fetchChangedObjectIds=function(){var x=b._asyncToGenerator(function*(B){var q,u,C,z=this.layer;yield z.load({signal:B});this.changedObjectIds.clear();if(!g.isNone(z.associatedLayer)&&null!=(q=z.associatedLayer.capabilities)&&null!=(u=q.operations)&&u.supportsChangeTracking){q=this._getFetchChangedObjectIdsServerGen();
if(g.isNone(q))return null;u=z.associatedLayer.layerId;B=yield l.result(c(`${z.associatedLayer.url}/extractChanges`,{method:"post",query:{f:"json",returnIdsOnly:!0,layers:`${u}`,returnUpdates:!0,returnDeletes:!1,returnInserts:!1,layerServerGens:JSON.stringify([{id:u,serverGen:q}])},timeout:1E4,signal:B}));B=B.ok&&null!=(C=B.value.data)&&C.edits?g.get(B.value.data.edits[0],"objectIds","updates"):null;if(g.isSome(B))for(C=Math.min(this._maximumNumberOfEditOVerrides,B.length),C<B.length&&(this.warnMaximumChangedObjectsExceeded=
!0),B=B.sort((A,p)=>A-p),z=0;z<C;z++)this.changedObjectIds.add(B[z])}});return function(B){return x.apply(this,arguments)}}();t._getFetchChangedObjectIdsServerGen=function(){var x=this.layer;if(g.isSome(x.serviceUpdateTimeStamp)&&g.isSome(x.serviceUpdateTimeStamp.lastUpdate))return x.serviceUpdateTimeStamp.lastUpdate;x=x.associatedLayer;return g.isSome(x)&&g.isSome(x.serverGens)&&g.isSome(x.serverGens.minServerGen)?x.serverGens.minServerGen:null};b._createClass(w,[{key:"test",get:function(){const x=
this;return{changedObjectIds:Array.from(this.changedObjectIds),pendingFetchChangedObjectIds:this.pendingFetchChangedObjectIds,get maximumNumberOfEditOVerrides(){return x._maximumNumberOfEditOVerrides},set maximumNumberOfEditOVerrides(B){x._maximumNumberOfEditOVerrides=B}}}}]);return w}();let h=function(){function w(x,B){this.objectId=x;this.options=B;this.updates=new Map;this.state=v.ACTIVE}var t=w.prototype;t.get=function(x){return this.updates.get(x)};t.set=function(x,B){this.isActive&&this.updates.set(x,
B)};t.rollback=function(){this.isActive&&(this.state=v.ROLLED_BACK,this.options.rollback())};t.commit=function(){this.isActive&&(this.state=v.COMMITTED,this.options.commit(this.updates),this.updates.clear())};b._createClass(w,[{key:"isActive",get:function(){return this.state===v.ACTIVE}}]);return w}();var v;(function(w){w[w.ACTIVE=0]="ACTIVE";w[w.COMMITTED=1]="COMMITTED";w[w.ROLLED_BACK=2]="ROLLED_BACK"})(v||(v={}));a.I3SAttributeOverrides=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/layers/support/featureQueryAll":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe","../../rest/support/Query"],function(a,b,c,m){function l(){l=b._asyncToGenerator(function*(k,f,d){f=f.clone();k.capabilities.query.supportsMaxRecordCountFactor&&(f.maxRecordCountFactor=g(k));const e=r(k),h=k.capabilities.query.supportsPagination;f.start=0;f.num=e;let v=null;for(;;){const w=yield k.source.queryFeaturesJSON(f,d);c.isNone(v)?v=w:v.features=v.features.concat(w.features);
v.exceededTransferLimit=w.exceededTransferLimit;if(!h||!w.exceededTransferLimit)break;f.start+=e}return v});return l.apply(this,arguments)}function r(k){return g(k)*n(k)}function n(k){return k.capabilities.query.maxRecordCount||2E3}function g(k){return k.capabilities.query.supportsMaxRecordCountFactor?m.MAX_MAX_RECORD_COUNT_FACTOR:1}a.getMaxRecordCountFactor=g;a.getMaximumQuerySize=r;a.getMaximumRecordCount=n;a.queryAllJSON=function(k,f,d){return l.apply(this,arguments)};Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SCrossfadeHelper":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/scheduling","../support/I3SLayerView"],function(a,b,c,m,l){let r=function(){function n(k){this.view=k;this._currentFrameStartTime=this._preRenderFrameTaskHandle=null;this._numFadingNodes=0}var g=n.prototype;g.stopNodeFading=function(k){null!=k.lodCrossfadeProgress&&(this._numFadingNodes--,
k.lodCrossfadeProgress=null,0===this._numFadingNodes&&(null!=this._preRenderFrameTaskHandle&&(this._preRenderFrameTaskHandle=c.removeMaybe(this._preRenderFrameTaskHandle)),this.view.notifyLODUpdate(),this.view.notifyUpdate()))};g._startNodeFading=function(k,f,d){0===this._numFadingNodes&&(this._preRenderFrameTaskHandle=m.addFrameTask({preRender:e=>this._updateAllNodeFading(e)}),this.view.notifyLODUpdate());null==k.lodCrossfadeProgress&&(this._numFadingNodes++,this.view.notifyUpdate());k.lodCrossfadeSignedDuration=
d;k.lodCrossfadeProgress=f};g._updateAllNodeFading=function(k){const f=this.view.nodeCrossfadingEnabled;this.view.foreachCrossfadeNode((d,e)=>{if(c.isSome(e)&&c.isSome(e.lodCrossfadeProgress)){const h=e.lodCrossfadeSignedDuration,v=e.lodCrossfadeProgress+Math.abs(k.deltaTime/h),w=!f||1<=v||0===h,t=(0<h?this.view.fullOpacity:0)-(w?0:0<h?1:-1)*(1-v);w?(this.stopNodeFading(e),0>h&&this.view.markNodeToRemove(d)):e.lodCrossfadeProgress=v;this.view.setNodeOpacityByIndex(d,t)}});this.view.removeMarkedNodes()};
g.stopAllNodeFading=function(){this.view.foreachCrossfadeNode((k,f)=>{c.isSome(f)&&c.isSome(f.lodCrossfadeProgress)&&(this.stopNodeFading(f),f=f.lodCrossfadeSignedDuration,0>f&&this.view.markNodeToRemove(k),this.view.setNodeOpacityByIndex(k,0<f?this.view.fullOpacity:0))});this.view.removeMarkedNodes()};g.fadeNode=function(k,f,d,e){null==this._currentFrameStartTime&&(this._currentFrameStartTime=Date.now());var h=this.view;const v=h.nodeCrossfadingEnabled,w=d===l.FadeDirection.FadeIn?h.fullOpacity:
0;e=v?e?d===l.FadeDirection.FadeIn?h.lodCrossfadeinDuration:h.lodCrossfadeoutDuration:h.lodCrossfadeUncoveredDuration:0;h=this.view.getNodeOpacityByIndex(k);v&&h!==w&&0<e?this._startNodeFading(f,1-Math.abs(w-h),(d===l.FadeDirection.FadeIn?1:-1)*e):(this.stopNodeFading(f),this.view.setNodeOpacityByIndex(k,w),d===l.FadeDirection.FadeOut&&this.view.removeNode(k))};g.isNodeFullyFadedIn=function(k){const f=this.view.getNodeCrossfadeMetaData(k);return c.isNone(f)||null==f.lodCrossfadeProgress&&this.view.getNodeOpacityByIndex(k)===
this.view.fullOpacity};b._createClass(n,[{key:"updating",get:function(){return 0<this._numFadingNodes}}]);return n}();a.I3SCrossfadeHelper=r;a.NodeCrossfadeMetaData=function(){this.lodCrossfadeSignedDuration=0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SElevationProvider":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../chunks/sphere ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q){const u=t.empty(),C=h.create(),z=w.create(),A=w.create(),p=w.create(),y=l.getLogger("esri.views.3d.layers.i3s.I3SElevationProvider");c=function(D){function E(G){G=D.call(this,G)||this;G.tmpEvent={spatialReference:null,extent:u,context:"scene"};return G}a._inheritsLoose(E,D);var F=E.prototype;F.initialize=function(){this.view=this.layerView.view;this.renderCoordsHelper=this.view.renderCoordsHelper;this.intersector=B.newIntersector(this.view.state.viewingMode);
this.intersector.options.store=q.StoreResults.MIN;const G=this.layerView.i3slayer.fullExtent;r.isNone(G)?y.error("I3SElevationProvider expected fullExtent on I3SLayer."):(this.zmin=G.zmin,this.zmax=G.zmax);this.tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"};F.getElevation=function(G,P,K,N){z[0]=G;z[1]=P;z[2]=K;if(!this.renderCoordsHelper.toRenderCoords(z,N,z))return y.error("could not project point to compute elevation"),null;G=this.layerView.elevationOffset;P=this.zmin+G;this.renderCoordsHelper.setAltitude(A,
this.zmax+G,z);this.renderCoordsHelper.setAltitude(p,P,z);this.intersector.reset(A,p,null);this.intersectionHandler.intersect(this.intersector,null,A,p);return this.intersector.results.min.getIntersectionPoint(z)?this.renderCoordsHelper.getAltitude(z):null};F.layerChanged=function(){this.spatialReference&&(this.tmpEvent.extent=this._computeLayerExtent(),this.tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this.tmpEvent))};F.objectChanged=function(G){this.spatialReference&&
(this.tmpEvent.extent=this._computeObjectExtent(G),this.tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this.tmpEvent))};F._computeObjectExtent=function(G){t.empty(u);this._expandExtent(G,u);return u};F._computeLayerExtent=function(){t.empty(u);for(const G of this.layerView.getVisibleNodes())this._expandExtent(G,u);return u};F._expandExtent=function(G,P){var K=G.visibilityObb||G.serviceObbInRenderSR;if(r.isSome(K))for(e.fromQuat(C,K.quaternion),C[12]=K.center[0],C[13]=
K.center[1],C[14]=K.center[2],G=0;8>G;++G)z[0]=G&1?K.halfSize[0]:-K.halfSize[0],z[1]=G&2?K.halfSize[1]:-K.halfSize[1],z[2]=G&4?K.halfSize[2]:-K.halfSize[2],v.transformMat4(z,z,C),this.renderCoordsHelper.fromRenderCoords(z,z,this.spatialReference),t.expand(P,z,P);else{var N=x.getRadius(G.renderMbs);K=v.copy(A,x.getCenter(G.renderMbs));K[0]-=N;K[1]-=N;K[2]-=N;G=v.copy(p,x.getCenter(G.renderMbs));G[0]+=N;G[1]+=N;G[2]+=N;for(N=0;8>N;++N)z[0]=N&1?K[0]:G[0],z[1]=N&2?K[1]:G[1],z[2]=N&4?K[2]:G[2],this.renderCoordsHelper.fromRenderCoords(z,
z,this.spatialReference),t.expand(P,z,P)}};return E}(m.EventedMixin(c));b.__decorate([n.property({constructOnly:!0})],c.prototype,"layerView",void 0);b.__decorate([n.property({constructOnly:!0})],c.prototype,"intersectionHandler",void 0);b.__decorate([n.property()],c.prototype,"view",void 0);b.__decorate([n.property({readOnly:!0,aliasOf:"view.elevationProvider.spatialReference"})],c.prototype,"spatialReference",void 0);return c=b.__decorate([d.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],
c)})},"esri/views/3d/layers/i3s/I3SIntersectionHandler":function(){define("exports ../../../../core/maybe ../../../ViewingMode ./I3SUtil ../../support/orientedBoundingBox ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/verticalOffsetUtils".split(" "),function(a,b,c,m,l,r,n,g){function k(d,e,h,v=0){v=d[3]+v;const w=e[0]-d[0],t=e[1]-d[1];d=e[2]-d[2];e=h[0];const x=h[1];h=h[2];const B=e*w+x*t+h*d;return 0<=B*B-(e*e+x*x+h*h)*(w*w+t*t+d*d-v*v)}let f=
function(){function d(h){this.type=n.IntersectorType.I3S;this._needVerticalOffset=!1;this.layerUid=h.layerUid;this.sublayerUid=h.sublayerUid;this.collection=h.collection;this.traverseNodeHierarchy=h.traverseNodeHierarchy;this.slicePlaneEnabled=h.slicePlaneEnabled;this.isGround=h.isGround}var e=d.prototype;e.updateElevationAlignState=function(h,v){this._needVerticalOffset=h&&v===c.ViewingMode.Global};e.intersect=function(h,v,w,t){const x=h.results,B=h.options.store===n.StoreResults.ALL,q=h.ray.direction,
u=h.tolerance;let C=p=>p,z=p=>p;const A=g.getVerticalOffsetI3S(b.isSome(h.verticalOffset)?h.verticalOffset:this._needVerticalOffset?0:null);b.isSome(h.verticalOffset)&&b.isSome(A)&&(C=p=>A.applyToMbs(p),z=p=>A.applyToObb(p));this.traverseNodeHierarchy((p,y)=>{if(0===p.childrenLoaded)return!1;const D=b.isSome(p.serviceObbInRenderSR)&&m.isValidObb(p.serviceObbInRenderSR)?p.serviceObbInRenderSR:null;if(b.isSome(D)&&!l.intersectLine(z(D),w,q,u))return!1;y&&(b.isSome(D)||!m.isValidMbs(p.renderMbs)||k(C(p.renderMbs),
w,q,u))&&(b.isNone(p.geometryObb)||l.intersectLine(z(p.geometryObb),w,q,u))&&this.collection.intersect(y,w,t,u,A,(E,F,G,P)=>{if(0<=F&&(null==v||v(w,t,F))){var K=N=>{N.set(this.type,{layerUid:this.layerUid,sublayerUid:this.sublayerUid,nodeIndex:p.index,componentIndex:E,triangleNr:P},F,G)};this.isGround&&(null==x.ground.dist||F<x.ground.dist)&&K(x.ground);if(!h.options.isFiltered&&((null==x.min.dist||F<x.min.dist)&&K(x.min),(null==x.max.dist||F>x.max.dist)&&K(x.max),B)){const N=r.newIntersectorResult(h.ray);
K(N);h.results.all.push(N)}}});return!0})};return d}();a.I3SIntersectionHandler=f;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/IDBCache":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/byteSizeEstimations ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils".split(" "),function(a,b,c,m,l,r){function n(f){return new Promise((d,e)=>{f.oncomplete=()=>d();f.onerror=
()=>e(f.error);f.onabort=()=>e(f.error)})}function g(f){return new Promise((d,e)=>{"done"===f.readyState?null!=f.error?e(f.error):d(f.result):(f.onsuccess=()=>d(f.result),f.onerror=()=>e(f.error))})}let k=function(){function f(e,h,v=14){this._version=v;this._quotaReductionPromise=this._db=null;this._miss=this._hit=this._gcCounter=0;this._destroyed=!1;this.gcFrequency=50;this.maxByteSize=c.ByteSizeUnit.GIGABYTES;this.quotaReductionFactor=.2;this._dbName=e;this._storeName=h}var d=f.prototype;d.init=
function(){return Promise.resolve().then(()=>{const e=indexedDB.open(this._dbName,this._version);e.onupgradeneeded=h=>{var v=e.result;const w=e.transaction,t=v.objectStoreNames.contains(this._storeName)?w.objectStore(this._storeName):v.createObjectStore(this._storeName);v=v.objectStoreNames.contains("last_access")?w.objectStore("last_access"):v.createObjectStore("last_access");v.indexNames.contains("date")||v.createIndex("date","date",{unique:!1});v.indexNames.contains("byteSize")||v.createIndex("byteSize",
"byteSize",{unique:!1});h.oldVersion<this._version&&(t.clear(),v.clear())};return g(e)}).then(e=>{this._destroyed?e.close():this._db=e})};d.destroy=function(){this._db&&(this._db.close(),this._db=null);this._destroyed=!0};d.getHitRate=function(){return this._hit/(this._hit+this._miss)};d.put=function(e,h){return null==this._db?Promise.reject(new m("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=this._quotaReductionPromise?this._quotaReductionPromise:Promise.resolve()).then(()=>
this._put(e,h)).catch(v=>{if(v&&"QuotaExceededError"===v.name)return null==this._quotaReductionPromise&&(this._quotaReductionPromise=this._getCacheSize().then(w=>this._removeLeastRecentlyAccessed(h.byteSize+Math.ceil(w*this.quotaReductionFactor))),this._quotaReductionPromise.then(()=>this._quotaReductionPromise=null,()=>this._quotaReductionPromise=null)),this._quotaReductionPromise.then(()=>this._put(e,h));throw v;}).then(()=>{this._gcCounter--;0>this._gcCounter&&null!=this._db&&(this._gcCounter=
this.gcFrequency,this._getCacheSize().then(v=>this._removeLeastRecentlyAccessed(v-this.maxByteSize)))})};d.get=function(e,h){if(null==this._db)return Promise.resolve(null);let v=null;return Promise.resolve().then(()=>{const w=this._db.transaction(this._storeName,"readonly");v=r.onAbort(h,()=>{w.abort()});const t=w.objectStore(this._storeName).get(e);return g(t)}).then(w=>{null==w?++this._miss:this._db&&(++this._hit,this._db.transaction("last_access","readwrite").objectStore("last_access").put({date:Date.now(),
byteSize:w.byteSize},e));l.isSome(v)&&v.remove();return w}).catch(()=>{++this._miss;r.throwIfAborted(h);l.isSome(v)&&v.remove();return null})};d.remove=function(e){var h=this;return null==this._db?Promise.resolve():Promise.resolve().then(b._asyncToGenerator(function*(){const v=h._db.transaction([h._storeName,"last_access"],"readwrite");var w=v.objectStore(h._storeName),t=v.objectStore("last_access");w=w.delete(e);t=t.delete(e);yield Promise.all([g(w),g(t),n(v)])}))};d._put=function(e,h){const v=this._db.transaction([this._storeName,
"last_access"],"readwrite");var w=v.objectStore(this._storeName);const t=v.objectStore("last_access");w=w.put(h,e);e=t.put({date:Date.now(),byteSize:h.byteSize},e);return Promise.all([g(w),g(e),n(v)])};d._removeLeastRecentlyAccessed=function(e){if(!(0>=e)&&this._db){var h=this._db.transaction([this._storeName,"last_access"],"readwrite"),v=h.objectStore(this._storeName),w=h.objectStore("last_access"),t=0,x=w.index("date").openCursor(null,"next");x.onsuccess=()=>{const B=x.result;null!=B&&(null!=B.value.byteSize&&
(t+=B.value.byteSize),v.delete(B.primaryKey),w.delete(B.primaryKey),t<e&&B.continue())};return n(h)}};d._getCacheSize=function(){const e=this._db.transaction("last_access");let h=0;const v=e.objectStore("last_access").index("byteSize").openKeyCursor();v.onsuccess=()=>{const w=v.result;if(w){var t=w.key;null!=t&&(h+=t);w.continue()}};return n(e).then(()=>h)};b._createClass(f,[{key:"initialized",get:function(){return null!=this._db}}]);return f}();a.IDBCache=k;a.whenRequest=g;a.whenTransaction=n;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/IDBMockCache":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function m(){this._data=new Map;this._hit=this._miss=0;this.initialized=!0}var l=m.prototype;l.init=function(){return Promise.resolve()};l.get=function(){var r=b._asyncToGenerator(function*(n,g){if(this._data.has(n))return this._hit++,this._data.get(n);this._miss++;return null});return function(n,
g){return r.apply(this,arguments)}}();l.destroy=function(){};l.put=function(r,n){this._data.set(r,n);return Promise.resolve()};l.remove=function(r){this._data.delete(r);return Promise.resolve()};l.getHitRate=function(){return this._hit/(this._hit+this._miss)};return m}();a.IDBMockCache=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/attributeEditing":function(){define(["exports","../../../../core/lang","../../../../core/maybe",
"../support/attributeUtils"],function(a,b,c,m){function l(d,e){const h=e.edits.updateFeatures;if(!h||0===h.length)return new f;const v=r(e),w=new f;e=new Map;for(let q=0;q<d.attributeStorageInfo.length;q++)e.set(d.attributeStorageInfo[q].name,q);const t=d.fieldsIndex,x=d.objectIdField,B=h.filter(q=>{q=m.attributeLookup(t,q.attributes,x);return v.has(q)});d.forEachNode((q,u)=>{const C=new Set(u);for(const D of B){const E=m.attributeLookup(t,D.attributes,x);if(!C.has(E))continue;const F=u.indexOf(E);
for(const G in D.attributes){var z=d.fieldsIndex.normalizeFieldName(G);var A=w;var p=q.index,y=A.get(p);y?A=y:(y=new k,A.set(p,y),A=y);(p=A.get(z))?z=p:(p=[],A.set(z,p),z=p);z.push({featureIndex:F,featureId:E,value:D.attributes[G]})}}});return w}function r(d){const e=new Set;if(!d.updatedFeatures)return e;for(const h of d.updatedFeatures)null!=h.objectId&&null==h.error&&e.add(h.objectId);return e}const n={setAttribute(){},rollback(){},commit(){}};var g;(function(d){d[d.EDITING=0]="EDITING";d[d.ROLLED_BACK=
1]="ROLLED_BACK";d[d.COMMITTED=2]="COMMITTED"})(g||(g={}));const k=Map,f=Map;a.createInteractiveEditSession=function(d,e){const h=e.attributes[d.objectIdField];var v=d.sessions.get(h);if(v)return v;const w=b.clone(e.attributes),t=new Set;if(null==h)return n;const x=d.attributeOverrides.createInteractiveEditSession(h),B=new Map;let q=g.EDITING;v={setAttribute(u,C){if(q===g.EDITING){var z=d.fieldsIndex.get(u);if(!c.isNone(z)){var A=d.attributeStorageInfo.findIndex(D=>D.name===z.name);if(!(0>A)){x.set(A,
C);var p=d.attributeStorageInfo[A],y=!1;t.add(u);d.forEachNode((D,E)=>{var F=B.get(D);null==F?(E=E.indexOf(h),B.set(D,E)):E=F;if(-1!==E&&(F=d.getAttributeData(D.index))){const G=F[p.name];G&&(G[E]=C,d.setAttributeData(D.index,F,e),y=!0)}});y&&d.clearMemCache()}}}},rollback(){if(q===g.EDITING){for(const u of t)this.setAttribute(u,w[u]);x.rollback();q=g.ROLLED_BACK;d.sessions.delete(h)}},commit(){q===g.EDITING&&(x.commit(),q=g.COMMITTED,d.sessions.delete(h))}};d.sessions.set(h,v);return v};a.processAttributeEdits=
function(d,e){e=l(d,e);if(0!==e.size){var h=new Map;for(let w=0;w<d.attributeStorageInfo.length;w++)h.set(d.attributeStorageInfo[w].name,w);var v=!1;e.forEach((w,t)=>{const x=d.getAttributeData(t);let B=!1;w.forEach((q,u)=>{const C=c.isSome(x)?x[u]:null;u=h.get(u);for(const {featureIndex:z,value:A,featureId:p}of q)C&&(C[z]=A,v=B=!0),d.attributeOverrides.updateValue(p,u,A)});B&&d.setAttributeData(t,x,null)});v&&d.clearMemCache()}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/layers/i3s/I3SMeshViewFilter":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/unitUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../core/sql/WhereClause ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/Ellipsoid ../../../../geometry/support/webMercatorUtils ../../../../layers/support/FeatureFilter ./I3SUtil ../../../../geometry/SpatialReference".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D){function E(U,aa,W){if(f.isNone(aa))return null;if("disjoint"===W&&"polygon"===aa.type){const V=Array(aa.rings.length);for(W=0;W<aa.rings.length;++W){var R=C.fromValues(Infinity,Infinity,-Infinity,-Infinity);C.expandWithNestedArray(R,aa.rings[W]);V[W]={type:"polygon",rings:[aa.rings[W]],spatialReference:aa.spatialReference,aabr:R}}V.sort((ha,ia)=>ha.aabr[0]-ia.aabr[0]);const da=new Set,ca=new n.PositionHint;for(aa=0;aa<V.length;++aa){const ha=
V[aa];for(W=aa+1;W<V.length;++W){R=V[W];if(R.aabr[0]>=ha.aabr[2])break;da.add(R)}da.forEach(ia=>{ha!==ia&&(ia.aabr[2]<=ha.aabr[0]?da.delete(ia):U.intersects(ha,ia)&&(ha.rings=ha.rings.concat(ia.rings),C.expand(ha.aabr,ia.aabr,ha.aabr),delete ha._geVersion,da.delete(ia),ia=n.indexOf(V,ia,V.length,ca),V.splice(ia,1)))});da.add(ha)}for(const ha of V)delete ha.aabr;return V}return[aa]}function F(U,aa,W,R,V){const da=K(U,aa,R);return W.every(ca=>N(U,ca,da,V)!==O.DISCARD)}function G(U,aa,W,R,V,da,ca,ha){const ia=
ca[0].spatialReference||V.spatialReference;if(q.projectBoundingSphere(W.node.mbs,da,Q,ia)){da=K(U,Q,ia);var ka=P(ha,V,ia,R,W.objectHandle);for(const la of ca){if(0===aa.length)break;switch(N(U,la,da,ha)){case O.DISCARD:aa.length=0;return;case O.KEEP:continue}y.filterInPlace(aa,W.featureIds,Y=>J(U,la,Y,ka))}}else H.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter")}function P(U,aa,W,R,V){aa=aa.renderSpatialReference;const da=new Map,ca={rings:[[[0,
0,0],[0,0,0],[0,0,0],[0,0,0]]],hasZ:!1,hasM:!1,type:"polygon",spatialReference:W};ca.rings[0][3]=ca.rings[0][0];let ha,ia;switch(U){case "intersects":ha=(ka,la,Y)=>ka.intersects(la,Y)?O.KEEP:O.TEST;ia=M;break;case "contains":ha=(ka,la,Y)=>ka.contains(la,Y)?O.TEST:O.DISCARD;ia=M;break;default:ha=(ka,la,Y)=>ka.disjoint(la,Y)?O.TEST:O.DISCARD,ia=L}return{collection:R,object:V,type:U,maskSR:W,renderSR:aa,aabbCache:da,triangle:ca,positions:{indices:null,data:null,stride:0,startIndex:0,endIndex:0},triangleTest:ha,
geometryTest:ia}}function K(U,aa,W){const R={x:aa[0],y:aa[1],hasZ:!1,hasM:!1,type:"point",spatialReference:W};W=!W.isWGS84&&!W.isWebMercator;aa=Number.isNaN(aa[3])?0:k.clamp(aa[3],0,2*z.earth.radius);U=W?U.buffer(R,aa,1):U.geodesicBuffer(R,aa,1);U.type="polygon";return U}function N(U,aa,W,R){switch(R){case "intersects":case "contains":return M(U,aa,W);case "disjoint":return L(U,aa,W)}}function M(U,aa,W){return U.intersects(aa,W)?U.contains(aa,W)?O.KEEP:O.TEST:O.DISCARD}function L(U,aa,W){return U.intersects(aa,
W)?U.contains(aa,W)?O.DISCARD:O.TEST:O.KEEP}function J(U,aa,W,R){const {collection:V,object:da,renderSR:ca,maskSR:ha,geometryTest:ia,aabbCache:ka}=R;var la=ka.get(W);if(!la){la=V.getObjectTransform(da);V.getComponentAabb(da,W,T);var Y=[[T[0],T[1],0],[T[0],T[4],0],[T[3],T[4],0],[T[3],T[1],0]];for(var ea=0;4>ea;++ea)x.transformMat3(Y[ea],Y[ea],la.rotationScale),x.add(Y[ea],Y[ea],la.position),q.projectVectorToVector(Y[ea],ca,Y[ea],ha);la={rings:[Y],hasZ:!1,hasM:!1,type:"polygon",spatialReference:ha};
la.rings[0][4]=la.rings[0][0];ka.set(W,la)}switch(ia(U,aa,la)){case O.DISCARD:return!1;case O.KEEP:return!0}const {triangle:ba,triangleTest:Z,positions:fa}=R;la=ba.rings[0][0];Y=ba.rings[0][1];ea=ba.rings[0][2];const ja=V.getObjectTransform(da);V.getComponentPositions(da,W,fa);const {indices:oa,data:sa,stride:qa,startIndex:Ha,endIndex:Ga}=fa;for(W=Ha;W<Ga;W+=3){const pa=qa*oa[W+0],Da=qa*oa[W+1],ra=qa*oa[W+2];x.set(la,sa[pa+0],sa[pa+1],sa[pa+2]);x.set(Y,sa[Da+0],sa[Da+1],sa[Da+2]);x.set(ea,sa[ra+0],
sa[ra+1],sa[ra+2]);x.transformMat3(la,la,ja.rotationScale);x.transformMat3(Y,Y,ja.rotationScale);x.transformMat3(ea,ea,ja.rotationScale);x.add(la,la,ja.position);x.add(Y,Y,ja.position);x.add(ea,ea,ja.position);q.projectVectorToVector(la,ca,la,ha);q.projectVectorToVector(Y,ca,Y,ha);q.projectVectorToVector(ea,ca,ea,ha);if(!(Math.abs((Y[0]-la[0])*(ea[1]-la[1])-(Y[1]-la[1])*(ea[0]-la[0]))<S))switch(delete ba._geVersion,Z(U,aa,ba)){case O.DISCARD:return!1;case O.KEEP:return!0}}switch(R.type){case "intersects":return!1;
default:return!0}}const H=g.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter");b.I3SMeshViewFilter=function(U){function aa(R){R=U.call(this,R)||this;R._projectionEngineLoaded=!1;return R}c._inheritsLoose(aa,U);var W=aa.prototype;W.initialize=function(){d.whenOnce(()=>{var R;return(null==(R=f.unwrap(this.viewFilter))?void 0:R.geometry)||f.isSome(this.layerFilter)}).then(()=>this.loadAsyncModule((new Promise((R,V)=>a(["../../../../geometry/geometryEngine"],R,V))).then(R=>{this.destroyed||(this._geometryEngine=
R,this.applyFilters())})))};W.addFilters=function(R,V,da,ca){const ha=this.sortedObjectIds;f.isSome(ha)&&R.push(Y=>y.objectIdFilter(ha,!0,Y));this.addSqlFilter(R,this.parsedWhereClause);const ia=this._layerMaskGeometries,ka=this._geometryEngine;if(f.isSome(ia)&&f.isSome(this.layerFilter)&&f.isSome(ka)){const Y=this.layerFilter.spatialRelationship;R.push((ea,ba)=>G(ka,ea,ba,ca,V,da,ia,Y))}const la=this._viewMaskGeometries;if(f.isSome(la)&&f.isSome(this.viewFilter)&&f.isSome(ka)){const Y=this.viewFilter.spatialRelationship;
R.push((ea,ba)=>G(ka,ea,ba,ca,V,da,la,Y))}};W.isMBSGeometryVisible=function(R,V,da){var ca=this._layerMaskGeometries;const ha=this._geometryEngine;if(f.isSome(ca)&&f.isSome(this.layerFilter)&&f.isSome(ha)){var ia=this.layerFilter.spatialRelationship;V=ca[0].spatialReference||V;return q.projectBoundingSphere(R,da,Q,V)?F(ha,Q,ca,V,ia):(H.warnOnce("SceneLayer.mask geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)}ca=this._viewMaskGeometries;return f.isSome(ca)&&f.isSome(this.viewFilter)&&
f.isSome(ha)?(ia=this.viewFilter.spatialRelationship,V=ca[0].spatialReference||V,q.projectBoundingSphere(R,da,Q,V)?F(ha,Q,ca,V,ia):(H.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)):!0};aa.checkSupport=function(R){if(f.isNone(R))return!1;if(R.timeExtent)return H.warn("Filters with a timeExtent are not supported for mesh scene layers"),!1;R=R.spatialRelationship;return null!=R&&I.includes(R)?!0:(H.warn(`Filters with spatialRelationship other than ${I.join(", ")} are not supported for mesh scene layers`),
!1)};c._createClass(aa,[{key:"sortedObjectIds",get:function(){if(f.isNone(this.viewFilter)||f.isNone(this.viewFilter.objectIds))return null;const R=new Float64Array(this.viewFilter.objectIds);R.sort();return R}},{key:"parsedWhereClause",get:function(){const R=f.isSome(this.viewFilter)?this.viewFilter.where:null;if(f.isNone(R)||!R)return null;try{return B.WhereClause.create(R,this.layerFieldsIndex)}catch(V){H.error(`Failed to parse filter where clause: ${V}`)}return null}},{key:"parsedGeometry",get:function(){const R=
this._viewMaskGeometries,V=this._layerMaskGeometries;return f.isNone(R)||f.isNone(V)?R||V:V.concat(R)}},{key:"_layerMaskGeometries",get:function(){const R=this.layerFilter;return f.isNone(R)||f.isNone(this._geometryEngine)?null:E(this._geometryEngine,R.geometry,R.spatialRelationship)}},{key:"_viewMaskGeometries",get:function(){if(f.isNone(this.viewFilter)||f.isNone(this._geometryEngine))return null;var {geometry:R}=this.viewFilter;if(f.isNone(R))return null;const {distance:V,units:da}=this.viewFilter,
ca=this.viewFilter.spatialRelationship;R="mesh"===R.type?R.extent:R;if(f.isNone(V)||0===V)return E(this._geometryEngine,R,ca);const ha=da||e.getUnitString(R.spatialReference);if(R.spatialReference.isWGS84)return R=this._geometryEngine.geodesicBuffer(R,V,ha),E(this._geometryEngine,R,ca);var ia=A.project(R,D.WGS84);if(f.isSome(ia))return R=A.project(this._geometryEngine.geodesicBuffer(ia,V,ha),R.spatialReference),E(this._geometryEngine,R,ca);if(!this._projectionEngineLoaded&&(this.loadAsyncModule(q.load().then(()=>
this._projectionEngineLoaded=!0)),!this._projectionEngineLoaded))return null;ia=null;try{ia=q.project(R,D.WGS84)}catch(ka){}if(ia)try{ia=q.project(this._geometryEngine.geodesicBuffer(ia,V,ha),R.spatialReference)}catch(ka){ia=null}ia||H.error(`Filter by geodesic buffer (distance) unsupported, failed to project input geometry (${R.spatialReference.wkid}) to WGS84.`);return E(this._geometryEngine,ia,ca)}}]);return aa}(r);m.__decorate([h.property()],b.I3SMeshViewFilter.prototype,"layerFilter",void 0);
m.__decorate([h.property({type:p})],b.I3SMeshViewFilter.prototype,"viewFilter",void 0);m.__decorate([h.property()],b.I3SMeshViewFilter.prototype,"layerFieldsIndex",void 0);m.__decorate([h.property()],b.I3SMeshViewFilter.prototype,"loadAsyncModule",void 0);m.__decorate([h.property()],b.I3SMeshViewFilter.prototype,"applyFilters",void 0);m.__decorate([h.property()],b.I3SMeshViewFilter.prototype,"addSqlFilter",void 0);m.__decorate([h.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"sortedObjectIds",
null);m.__decorate([h.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"parsedWhereClause",null);m.__decorate([h.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"parsedGeometry",null);m.__decorate([h.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"_layerMaskGeometries",null);m.__decorate([h.property({readOnly:!0})],b.I3SMeshViewFilter.prototype,"_viewMaskGeometries",null);m.__decorate([h.property()],b.I3SMeshViewFilter.prototype,"_projectionEngineLoaded",void 0);m.__decorate([h.property()],
b.I3SMeshViewFilter.prototype,"_geometryEngine",void 0);b.I3SMeshViewFilter=m.__decorate([t.subclass("esri.views.3d.layers.i3s.I3SMeshViewFilter")],b.I3SMeshViewFilter);const I=["contains","intersects","disjoint"];var O;(function(U){U[U.KEEP=0]="KEEP";U[U.DISCARD=1]="DISCARD";U[U.TEST=2]="TEST"})(O||(O={}));const Q=[0,0,0,0],S=2**-32,T=u.create();Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SQueryEngine":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Error ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/graphics/data/QueryEngine ../../../../rest/support/FeatureSet ../../../../rest/support/Query".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t){const x=v.QueryEngine;a.I3SQueryEngine=function(B){function q(C){C=B.call(this,C)||this;C._dataQueryEngineInstance=null;C._handles=new r;return C}b._inheritsLoose(q,B);var u=q.prototype;u.initialize=function(){this._handles.add(this.layerView.on("visible-geometry-changed",()=>this.spatialIndex.events.emit("changed")))};u.destroy=function(){this._dataQueryEngineInstance&&(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null);this._handles&&
(this._handles.destroy(),this._handles=null);this._set("layerView",null)};u.executeQueryForCount=function(){var C=b._asyncToGenerator(function*(z,A){return this.dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(z),A)});return function(z,A){return C.apply(this,arguments)}}();u.executeQueryForExtent=function(){var C=b._asyncToGenerator(function*(z,A){const {count:p,extent:y}=yield this.dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(z),A);z=h.fromJSON(y);return{count:p,extent:z}});
return function(z,A){return C.apply(this,arguments)}}();u.executeQueryForIds=function(){var C=b._asyncToGenerator(function*(z,A){return this.dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(z),A)});return function(z,A){return C.apply(this,arguments)}}();u.executeQuery=function(){var C=b._asyncToGenerator(function*(z,A){z=this._ensureQueryJSON(z);if(z.returnGeometry)throw new l("feature-store:unsupported-query","returnGeometry is not yet supported for mesh scene layer queries");if(z.returnCentroid)throw new l("feature-store:unsupported-query",
"returnCentroid is not yet supported for mesh scene layer queries");A=yield this.dataQueryEngine.executeQuery(z,A);A=w.fromJSON(A);A.features.forEach(p=>{p.geometry=null});return A});return function(z,A){return C.apply(this,arguments)}}();u._ensureQueryJSON=function(C){return n.isNone(C)?this.defaultQueryJSON:C.toJSON()};u._ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const C=this.layer.objectIdField||"OBJECTID",z=this.layer.fields.map(y=>
y.toJSON()),A=this.layerView.view.resourceController.scheduler,p=this.spatialReference.toJSON();return this._dataQueryEngineInstance=new x({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fields:z,timeInfo:null,spatialReference:p,objectIdField:C,featureStore:this.spatialIndex,scheduler:A,priority:this.priority})};b._createClass(q,[{key:"defaultQueryJSON",get:function(){return(new t({outSpatialReference:this.spatialReference})).toJSON()}},{key:"dataQueryEngine",get:function(){return this._ensureDataQueryEngine()}}]);
return q}(m);c.__decorate([g.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"layerView",void 0);c.__decorate([g.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"priority",void 0);c.__decorate([g.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"spatialIndex",void 0);c.__decorate([g.property({readOnly:!0,aliasOf:"layerView.view.spatialReference"})],a.I3SQueryEngine.prototype,"spatialReference",void 0);c.__decorate([g.property({readOnly:!0,aliasOf:"layerView.i3slayer"})],
a.I3SQueryEngine.prototype,"layer",void 0);c.__decorate([g.property({readOnly:!0})],a.I3SQueryEngine.prototype,"defaultQueryJSON",null);a.I3SQueryEngine=c.__decorate([e.subclass("esri.views.3d.layers.i3s.I3SQueryEngine")],a.I3SQueryEngine);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SQueryFeatureAdapter":function(){define("exports ../../../../core/maybe ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/centroid ../../../../layers/graphics/OptimizedGeometry ./I3SUtil".split(" "),
function(a,b,c,m,l,r){let n=function(){function k(d){this.objectIdField=d.objectIdField;this.getFeatureExtent=d.getFeatureExtent}var f=k.prototype;f.getObjectId=function(d){return d.id};f.getAttributes=function(d){const {meta:e,index:h}=d,v={};this.objectIdField&&(v[this.objectIdField]=d.id);d=b.isSome(e.attributeInfo)&&e.attributeInfo.attributeData;if(b.isSome(d))for(const w of Object.keys(d))v[w]=r.getCachedAttributeValue(d[w],h);return v};f.getAttribute=function(d,e){if(e===this.objectIdField)return d.id;
const {meta:h,index:v}=d;d=b.isSome(h.attributeInfo)&&h.attributeInfo.attributeData;return b.isSome(d)?r.getCachedAttributeValue(d[e],v):null};f.getGeometry=function(d){if(d.geometry)return d.geometry;const [e,h,v,w,t]=this.getFeatureExtent(d,g);return new l([5],[e,h,v,w,h,v,w,t,v,e,t,v,e,h,v])};f.getCentroid=function(d,e){if(d.geometry)return m.getCentroidOptimizedGeometry(new l,d.geometry,e.hasZ,e.hasM);const [h,v,w,t,x,B]=this.getFeatureExtent(d,g);return new l([0],[(h+t)/2,(v+x)/2,(w+B)/2])};
f.cloneWithGeometry=function(d,e){const {id:h,index:v,meta:w}=d;return{id:h,index:v,meta:w,geometry:e}};return k}();const g=c.create();a.I3SQueryFeatureAdapter=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SQueryFeatureStore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../II3SMeshView3D".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w){a.I3SQueryFeatureStore=function(q){function u(z){z=q.call(this,z)||this;z.events=new l;return z}b._inheritsLoose(u,q);var C=u.prototype;C.forEach=function(z){this.forAllFeatures(A=>{z(A);return w.ForAllFeaturesReturnType.CONTINUE})};C.forEachBounds=function(z,A,p){const y=this.getFeatureExtent;for(const D of z)A(y(D,p))};C.forEachInBounds=function(z,A){this.forAllFeatures(p=>{const y=this.getFeatureExtent(p,x);v.intersects(z,h.toRect(y,B))&&A(p);return w.ForAllFeaturesReturnType.CONTINUE},
p=>{e.projectBoundingSphere(p.node.mbs,this.sourceSpatialReference,t,this.viewSpatialReference);if(t[0]>=z[0]&&t[2]<=z[2]&&t[1]>=z[1]&&t[3]<=z[3])return w.ForAllFeaturesReturnType.CONTINUE;p=t[0]-Math.max(z[0],Math.min(t[0],z[2]));const y=t[1]-Math.max(z[1],Math.min(t[1],z[3]));return p*p+y*y<=t[3]*t[3]?w.ForAllFeaturesReturnType.CONTINUE:w.ForAllFeaturesReturnType.SKIP})};return u}(m);c.__decorate([r.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"featureAdapter",void 0);c.__decorate([r.property({constructOnly:!0})],
a.I3SQueryFeatureStore.prototype,"toArray",void 0);c.__decorate([r.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"forAllFeatures",void 0);c.__decorate([r.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"getFeatureExtent",void 0);c.__decorate([r.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"sourceSpatialReference",void 0);c.__decorate([r.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"viewSpatialReference",void 0);a.I3SQueryFeatureStore=
c.__decorate([f.subclass("esri.views.3d.layers.i3s.I3SQueryFeatureStore")],a.I3SQueryFeatureStore);const t=d.create(),x=h.create(),B=v.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/DefinitionExpressionSceneLayerView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../core/sql/WhereClause ../i3s/I3SUtil".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d){const e=m.getLogger("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView");a.DefinitionExpressionSceneLayerView=h=>{h=function(v){function w(){var x=v.apply(this,arguments)||this;x._definitionExpressionErrors=0;x._maxDefinitionExpressionErrors=20;x.logError=B=>{x._definitionExpressionErrors<x._maxDefinitionExpressionErrors&&e.error("Error while evaluating definitionExpression: "+B);x._definitionExpressionErrors++;x._definitionExpressionErrors===x._maxDefinitionExpressionErrors&&
e.error("Further errors are ignored")};return x}b._inheritsLoose(w,v);var t=w.prototype;t._evaluateClause=function(x,B){try{return x.testFeature(B)}catch(q){return this.logError(q),!1}};t._addDefinitionExpressionToQuery=function(x){if(!this.parsedDefinitionExpression)return x;const B=this.i3slayer.definitionExpression;x=x.clone();x.where=x.where?`(${B}) AND (${x.where})`:B;return x};b._createClass(w,[{key:"parsedDefinitionExpression",get:function(){if(!this.i3slayer||!this.i3slayer.definitionExpression)return null;
try{const x=f.WhereClause.create(this.i3slayer.definitionExpression,this.i3slayer.fieldsIndex);if(!x.isStandardized)return e.error("definitionExpression is using non standard function"),null;const B=[];d.findFieldsCaseInsensitive(x.fieldNames,this.i3slayer.fields,{missingFields:B});if(0<B.length)return e.error(`definitionExpression references unknown fields: ${B.join(", ")}`),null;this._definitionExpressionErrors=0;return x}catch(x){return e.error("Failed to parse definitionExpression: "+x),null}}},
{key:"definitionExpressionFields",get:function(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:null}}]);return w}(h);c.__decorate([l.property()],h.prototype,"i3slayer",void 0);c.__decorate([l.property({readOnly:!0})],h.prototype,"parsedDefinitionExpression",null);c.__decorate([l.property({readOnly:!0})],h.prototype,"definitionExpressionFields",null);return h=c.__decorate([k.subclass("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],h)};Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/fieldProperties":function(){define(["exports","../../../../layers/support/fieldUtils"],function(a,b){a.defineFieldProperties=function(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,get:function(){const {layer:c,layer:{fieldsIndex:m},requiredFields:l}=this;return c.outFields?b.fixFields(m,[...b.unpackFieldNames(m,c.outFields),...l]):b.fixFields(m,l)}}}};Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/SceneLayerViewRequiredFields":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/AsyncUpdate ../../../../core/HandleOwner ../../../../core/Logger ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/fieldUtils".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h){function v(x){return w.apply(this,arguments)}function w(){w=b._asyncToGenerator(function*(x){const B=new Set;try{return yield x(B),Array.from(B).sort()}catch(q){return t.error(q),null}});return w.apply(this,arguments)}const t=r.getLogger("esri.views.3d.layers.support.SceneLayerViewRequiredFields");a.SceneLayerViewRequiredFields=function(x){function B(q){return x.call(this,q)||this}b._inheritsLoose(B,x);B.prototype.initialize=function(){this.layer=this.layerView.layer;
this.handles.add([this.autoUpdateAsync("rendererFields",()=>{const {fieldsIndex:q,renderer:u}=this.layer;return u?v(C=>u.collectRequiredFields(C,q)):null}),this.autoUpdateAsync("labelingFields",()=>{const {layer:q}=this;return q.labelsVisible?v(u=>h.collectLabelingFields(u,q)):null}),this.autoUpdateAsync("viewFilterFields",()=>{const {layer:q,filter:u}=this.layerView;return v(C=>h.collectFilterFields(C,q,u))})])};b._createClass(B,[{key:"requiredFields",get:function(){const {layerView:{layer:{fieldsIndex:q},
definitionExpressionFields:u},rendererFields:C,labelingFields:z,viewFilterFields:A}=this;return h.fixFields(q,[...n.unwrapOr(u,[]),...n.unwrapOr(C,[]),...n.unwrapOr(z,[]),...n.unwrapOr(A,[])])}}]);return B}(m.AsyncUpdateMixin(l.HandleOwner));c.__decorate([g.property()],a.SceneLayerViewRequiredFields.prototype,"layerView",void 0);c.__decorate([g.property()],a.SceneLayerViewRequiredFields.prototype,"layer",void 0);c.__decorate([g.property()],a.SceneLayerViewRequiredFields.prototype,"requiredFields",
null);c.__decorate([g.property()],a.SceneLayerViewRequiredFields.prototype,"rendererFields",void 0);c.__decorate([g.property()],a.SceneLayerViewRequiredFields.prototype,"labelingFields",void 0);c.__decorate([g.property()],a.SceneLayerViewRequiredFields.prototype,"viewFilterFields",void 0);a.SceneLayerViewRequiredFields=c.__decorate([e.subclass("esri.views.3d.layers.support.SceneLayerViewRequiredFields")],a.SceneLayerViewRequiredFields);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/core/AsyncUpdate":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ./Accessor ./Logger ./accessorSupport/tracking ./accessorSupport/decorators/property ./accessorSupport/decorators/subclass ./accessorSupport/tracking/SimpleTrackingTarget".split(" "),function(a,b,c,m,l,r,n,g,k){function f(h,v){const w=()=>{if(!t||x)return v();t.clear();x=!0;const B=r.runTracked(t,v);x=!1;return B};let t=new k.SimpleTrackingTarget(()=>{t&&!x&&h(w)}),x=!1;h(w);return{remove:()=>
{t&&(t.destroy(),t=null)}}}const d=h=>{h=function(v){function w(){var x=v.apply(this,arguments)||this;x._numUpdating=0;x.asyncUpdateState=new Map;return x}b._inheritsLoose(w,v);var t=w.prototype;t.autoUpdateAsync=function(x,B){return f(q=>this._updateAsync(x,q),B)};t._updateAsync=function(){var x=b._asyncToGenerator(function*(B,q){if(!this._startAsyncUpdate(B)){try{const u=yield q();this._set(B,u)}catch(u){l.getLogger(this.declaredClass).warn(`Async update of "${String(B)}" failed. Async update functions should not throw exceptions.`)}this._endAsyncUpdate(B)&&
this._updateAsync(B,q)}});return function(B,q){return x.apply(this,arguments)}}();t._startAsyncUpdate=function(x){var B;const q=null!=(B=this.asyncUpdateState.get(x))?B:e.None;if(q&e.Updating)return this.asyncUpdateState.set(x,q|e.Invalidated),!0;++this._numUpdating;this.asyncUpdateState.set(x,q|e.Updating);return!1};t._endAsyncUpdate=function(x){var B;--this._numUpdating;const q=(null!=(B=this.asyncUpdateState.get(x))?B:e.None)&~e.Updating;if(q&e.Invalidated)return this.asyncUpdateState.set(x,q&
~e.Invalidated),!0;this.asyncUpdateState.set(x,q);return!1};b._createClass(w,[{key:"updating",get:function(){return 0<this._numUpdating}}]);return w}(h);c.__decorate([n.property({readOnly:!0})],h.prototype,"updating",null);c.__decorate([n.property()],h.prototype,"_numUpdating",void 0);return h=c.__decorate([g.subclass("esri.core.AsyncUpdate")],h)};var e;(function(h){h[h.None=0]="None";h[h.Updating=1]="Updating";h[h.Invalidated=2]="Invalidated"})(e||(e={}));a.AsyncUpdate=function(h){function v(){return h.apply(this,
arguments)||this}b._inheritsLoose(v,h);return v}(d(m));a.AsyncUpdate=c.__decorate([g.subclass("esri.core.AsyncUpdate")],a.AsyncUpdate);a.AsyncUpdateMixin=d;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/layers/SceneLayerView":function(){define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/interfaces ../../core/accessorSupport/tracking ../../core/accessorSupport/extensions/serializableProperty/reader ../../core/accessorSupport/extensions/serializableProperty/writer ../../geometry/projection ./LayerView".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t){const x=m.getLogger("esri.views.layers.SceneLayerView");m=function(B){function q(){var C=B.apply(this,arguments)||this;C.layer=null;C.filter=null;C._geometryEngine=null;C._projectionEngineLoaded=!1;return C}b._inheritsLoose(q,B);var u=q.prototype;u.initialize=function(){var C=this;r.whenOnce(()=>!this._geometryEngine&&l.isSome(this.layer.filter)&&this.layer.filter.geometries.length).then(b._asyncToGenerator(function*(){return C._geometryEngine=yield new Promise((z,
A)=>a(["../../geometry/geometryEngine"],z,A))}));this._projectionEngineLoaded=w.isLoaded();r.whenOnce(()=>!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine).then(b._asyncToGenerator(function*(){yield w.load();C._projectionEngineLoaded=!0}))};u.highlight=function(C){throw Error("Not implemented");};u.queryFeatures=function(C,z){throw Error("Not implemented");};u.queryObjectIds=function(C,z){throw Error("Not implemented");};u.queryFeatureCount=function(C,z){throw Error("Not implemented");
};u.createQuery=function(){throw Error("Not implemented");};u.queryExtent=function(C,z){throw Error("Not implemented");};b._createClass(q,[{key:"availableFields",get:function(){return[]}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(C){throw Error("Not implemented");}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}},{key:"layerFilter",get:function(){const C=this.layer.filter;if(l.isNone(C)||1>C.geometries.length)return null;const z=this._geometryEngine;if(l.isNone(z)||
!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine)return null;try{let A=z.simplify(C.geometries.getItemAt(0));const p=A.spatialReference;for(let y=1;y<C.geometries.length;y++){let D=z.simplify(C.geometries.getItemAt(y));D.spatialReference.equals(p)||(D=w.project(D,p));A=z.union(A,D)}return{spatialRelationship:C.spatialRelationship,geometry:A}}catch{return x.warnOncePerTick("Failed to merge scene filter geometries. Layer mask will be ignored."),null}}},{key:"_filterNeedsProjectionEngine",
get:function(){const C=this.layer.filter;if(l.isNone(C)||1>=C.geometries.length)return!1;const z=C.geometries.getItemAt(0).spatialReference;return C.geometries.some(({spatialReference:A})=>!A.equals(z)&&!w.canProjectWithoutEngine(A,z))}},{key:"layerFilterUpdating",get:function(){return l.isSome(this.layer.filter)&&this.layer.filter.geometries.length&&(!this._geometryEngine||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine)}}]);return q}(t);c.__decorate([n.property()],m.prototype,"layer",
void 0);c.__decorate([n.property()],m.prototype,"availableFields",null);c.__decorate([n.property()],m.prototype,"maximumNumberOfFeatures",null);c.__decorate([n.property({readOnly:!0})],m.prototype,"maximumNumberOfFeaturesExceeded",null);c.__decorate([n.property()],m.prototype,"filter",void 0);c.__decorate([n.property({readOnly:!0})],m.prototype,"layerFilter",null);c.__decorate([n.property()],m.prototype,"_geometryEngine",void 0);c.__decorate([n.property()],m.prototype,"_projectionEngineLoaded",void 0);
c.__decorate([n.property()],m.prototype,"_filterNeedsProjectionEngine",null);c.__decorate([n.property()],m.prototype,"layerFilterUpdating",null);return m})},"esri/views/3d/layers/SceneLayerGraphicsView3D":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/arrayUtils ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../geometry/support/contains ../../../geometry/support/zscale ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/FeatureFilter ../../../rest/support/Query ./I3SPointsWorkerHandle ./LayerView3D ./graphics/Graphics3DFeatureProcessor ./graphics/QueryEngine ./i3s/attributeEditing ./i3s/I3SAttributeOverrides ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/PopupSceneLayerView ./support/SceneLayerViewRequiredFields ../support/debugFlags ../support/GraphicsMap ../support/orientedBoundingBox ../support/updatingProperties ../webgl-engine/lib/basicInterfaces ../../layers/SceneLayerView ../../support/Scheduler".split(" "),
function(a,b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N,M,L,J,H,I,O,Q,S,T){function U(ca){const ha=ca.attributeInfo;for(let ia=0;ia<ca.graphics.length;ia++){const ka=ca.graphics[ia];ka.attributes||(ka.attributes={});if(n.isSome(ha)&&n.isSome(ha.loadedAttributes))for(const {name:la}of ha.loadedAttributes)ha.attributeData[la]&&(ka.attributes[la]=P.getCachedAttributeValue(ha.attributeData[la],ia))}}const aa=r.getLogger("esri.views.3d.layers.SceneLayerGraphicsView3D");r=N.defineFieldProperties();
y=function(ca){function ha(){var ka=ca.apply(this,arguments)||this;ka.type="scene-layer-graphics-3d";ka._nodesAddedToStage=new Map;ka._queryEngine=null;ka._memCache=null;ka._interactiveEditingSessions=new Map;ka.loadedGraphics=new H.GraphicsMap;ka.holeFilling="always";ka.progressiveLoadFactor=1;ka.supportsHeightUnitConversion=!0;ka._coordinatesOutsideExtentErrors=0;ka._maxCoordinatesOutsideExtentErrors=20;return ka}b._inheritsLoose(ha,ca);var ia=ha.prototype;ia.initialize=function(){var ka,la;const Y=
this.layer;this.addResolvingPromise(Y.indexInfo);this._attributeOverrides=new G.I3SAttributeOverrides(this.layer,null==(ka=this.view.resourceController)?void 0:ka.memoryController);P.checkSpatialReferences(Y,this.view.spatialReference,this.view.viewingMode);this.fieldsHelper=new L.SceneLayerViewRequiredFields({layerView:this});this.updatingHandles.add(()=>Y.rangeInfos,ea=>this._rangeInfosChanged(ea),g.initial);this.updatingHandles.add(()=>Y.renderer,(ea,ba)=>this._rendererChange(ea,ba));this.updatingHandles.add(()=>
[this.parsedDefinitionExpression,this.excludeObjectIdsSorted],()=>this._filterChange());this.updatingHandles.add(()=>this.view.floors,()=>n.isSome(this.processor.filterVisibility)&&this.processor.filterVisibility.filterChanged());this.handles.add(g.watch(()=>J.I3S_TREE_SHOW_TILES,ea=>{if(ea&&!this._treeDebugger){const ba=this._controller.crsIndex;(new Promise((Z,fa)=>a(["./support/I3STreeDebugger"],Z,fa))).then(({I3STreeDebugger:Z})=>{!this._treeDebugger&&J.I3S_TREE_SHOW_TILES&&(this._treeDebugger=
new Z({lv:this,view:this.view,nodeSR:ba}))})}else ea||!this._treeDebugger||J.I3S_TREE_SHOW_TILES||(this._treeDebugger.destroy(),this._treeDebugger=null)},g.initial));this._set("processor",new D({owner:this,preferredUpdatePolicy:Q.UpdatePolicy.ASYNC,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentEnabled:!1,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,dataExtent:Y.fullExtent,updateClippingExtent:ea=>this._updateClippingExtent(ea)}));null==
(la=this.processor.elevationAlignment)?void 0:la.events.on("invalidate-elevation",ea=>this._invalidateElevation(ea));this.supportsHeightUnitConversion&&(this._verticalScale=B.getGeometryZScaler("point",Y.spatialReference,this.view.spatialReference));this.addResolvingPromise(this.processor.setup());this._memCache=this.view.resourceController.memoryController.newCache(Y.uid);this._controller=new C({layerView:this,scaleVisibilityEnabled:!1});P.containsDraco(this.layer.geometryDefinitions)&&(this._worker=
new p.I3SPointsWorkerHandle(ea=>this.view.resourceController.schedule(ea)));this.handles.add(this.layer.on("apply-edits",ea=>this.updatingHandles.addPromise(ea.result)));this.handles.add(this.layer.on("edits",ea=>this._handleEdits(ea)));this.when(()=>{this._queryEngine=new E.QueryEngine({layerView:this,priority:T.TaskPriority.FEATURE_QUERY_ENGINE});this.updatingHandles.add(()=>this.maximumNumberOfFeatures,ea=>this._controller.featureTarget=ea,g.initial);this.updatingHandles.add(()=>this.suspended,
ea=>{ea&&this._removeAllNodeData()})})};ia.destroy=function(){this._treeDebugger=n.destroyMaybe(this._treeDebugger);this._attributeOverrides=n.destroyMaybe(this._attributeOverrides);this._set("processor",n.destroyMaybe(this.processor));this._controller=n.destroyMaybe(this._controller);this._queryEngine=n.destroyMaybe(this._queryEngine);this._worker=n.destroyMaybe(this._worker);this._memCache=n.destroyMaybe(this._memCache);this._nodesAddedToStage.clear();this.fieldsHelper=n.destroyMaybe(this.fieldsHelper)};
ia.whenGraphicAttributes=function(){var ka=b._asyncToGenerator(function*(la,Y){return P.whenGraphicAttributes(this.layer,la,this._getObjectIdField(),Y,()=>[...this._nodesAddedToStage.values()])});return function(la,Y){return ka.apply(this,arguments)}}();ia.getHit=function(ka){if(!this.loadedGraphics)return null;const la=u.hydrateGraphic(this.loadedGraphics.find(ea=>ea.uid===ka),this.layer),Y=this._getObjectIdField();if(!la||!la.attributes||!la.attributes[Y])return null;la.layer=this.layer;la.sourceLayer=
this.layer;return{type:"graphic",graphic:la,layer:la.layer}};ia.whenGraphicBounds=function(ka,la){return this.processor.whenGraphicBounds(ka,la)};ia.computeAttachmentOrigin=function(ka,la){return this.processor.computeAttachmentOrigin(ka,la)};ia.canResume=function(){return ca.prototype.canResume.call(this)&&(!this._controller||this._controller.rootNodeVisible)};ia.isUpdating=function(){var ka,la,Y;return!!(null!=(ka=this._controller)&&ka.updating||null!=(la=this.processor)&&la.updating||null!=(Y=
this.fieldsHelper)&&Y.updating||this.layerFilterUpdating)};ia.highlight=function(ka){return this.processor.highlight(ka,this.layer.objectIdField)};ia.createInteractiveEditSession=function(ka){return F.createInteractiveEditSession(this.attributeEditingContext,ka)};ia._extractBinaryPointData=function(){var ka=b._asyncToGenerator(function*(la,Y){la={geometryBuffer:la.geometryBuffer};n.isNone(this._worker)&&(this._worker=new p.I3SPointsWorkerHandle(ea=>this.view.resourceController.schedule(ea)));return this._worker.invoke(la,
Y).then(ea=>{if(n.isSome(ea))return{positionData:ea.positions,featureIds:ea.featureIds};throw Error("Failed to decompress Draco point data");})});return function(la,Y){return ka.apply(this,arguments)}}();ia._checkExtent=function(ka,la){ka&&!x.extentContainsCoords3D(ka,la)&&(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&aa.error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&aa.error("Maximum number of errors reached. Further errors are ignored."),
this._coordinatesOutsideExtentErrors++)};ia.addNode=function(){var ka=b._asyncToGenerator(function*(la,Y,ea){if(!("geometryBuffer"in Y&&null!==Y.geometryBuffer||"pointData"in Y))throw Error();if(this._nodesAddedToStage.has(la.index))aa.error("I3S node "+la.id+" already added");else{if(n.isSome(this.layer.fullExtent)){var ba=this.layer.fullExtent.clone();ba.xmin-=.5;ba.ymin-=.5;ba.xmax+=.5;ba.ymax+=.5;ba.hasZ&&(ba.zmin-=.5,ba.zmax+=.5);ba.hasM&&(ba.mmin-=.5,ba.mmax+=.5)}else ba=null;var Z=this._controller.crsVertex,
fa=[],ja={graphics:null,featureIds:null,attributeInfo:Y.attributeDataInfo,node:la};"geometryBuffer"in Y&&null!==Y.geometryBuffer?yield this._addNodeBinaryPointData(la,ja,Y,ba,fa,ea):"pointData"in Y&&this._addNodeLegacyPointData(la,ja,Y,ba,fa);yield this._attributeOverrides.apply(ja.featureIds,Y.attributeDataInfo,ea);la.numFeatures=ja.graphics.length;this._updateNodeMemory(la);U(ja);0<fa.length&&(this._computeObb(la,fa,Z),this._controller.updateVisibility(la.index));if(this._controller.isGeometryVisible(la)){if(n.isSome(this._verticalScale))for(const oa of ja.graphics)this._verticalScale(oa.geometry);
this._nodesAddedToStage.set(la.index,ja);this.loadedGraphics.addMany(ja.graphics);this._controller.updateLoadStatus(la.index,!0);this._filterNode(ja);this._treeDebugger&&this._treeDebugger.update()}else this._cacheNodeData(ja)}});return function(la,Y,ea){return ka.apply(this,arguments)}}();ia._computeObb=function(ka,la,Y){const ea=this._controller.crsIndex,ba=ea.isGeographic?this.view.renderSpatialReference:ea;w.projectBuffer(la,Y,0,la,ba,0,la.length/3);ka.serviceObb=I.compute({data:la,size:3});ea.isGeographic&&
w.projectVectorToVector(ka.serviceObb.center,ba,ka.serviceObb.center,ea)};ia.isNodeLoaded=function(ka){return this._nodesAddedToStage.has(ka)};ia.isNodeReloading=function(){return!1};ia.updateNodeState=function(){};ia._addNodeBinaryPointData=function(){var ka=b._asyncToGenerator(function*(la,Y,ea,ba,Z,fa){var ja=yield this._extractBinaryPointData(ea,fa);if(null==ja)throw Error();ea=this._getObjectIdField();fa=this._controller.crsVertex;const oa=this.view.spatialReference,sa=this.processor.graphicsCore,
{positionData:qa,featureIds:Ha}=ja;ja=qa.length/3;const Ga=[];for(let Ia=0;Ia<ja;Ia++){var pa=n.isSome(la.serviceObb)?la.serviceObb.center:[0,0,0],Da=3*Ia,ra=v.fromValues(qa[Da+0],qa[Da+1],qa[Da+2]);h.add(ra,ra,pa);la.serviceObb||Z.push(ra[0],ra[1],ra[2]);n.isSome(ba)&&this._checkExtent(ba,ra);Da=Ha[Ia];pa={};null!=Da&&(pa[ea]=Da);Da=null==Da?m.generateUID():Da;w.projectBuffer(ra,fa,0,R,oa,0,1);ra=q.makeDehydratedPoint(R[0],R[1],R[2],oa);var Ea=this.loadedGraphics.get(Da);n.isSome(Ea)?(Ea.level<la.level&&
(V.property="geometry",V.graphic=Ea,V.oldValue=n.unwrap(Ea.geometry),V.newValue=ra,Ea.geometry=ra,sa.graphicUpdateHandler(V)),Ga.push(Ea)):(Ea=m.generateUID(),Ga.push({objectId:Da,uid:Ea,geometry:ra,attributes:pa,visible:!0,level:la.level}))}Y.graphics=Ga;Y.featureIds=Array.from(Ha)});return function(la,Y,ea,ba,Z,fa){return ka.apply(this,arguments)}}();ia._addNodeLegacyPointData=function(ka,la,Y,ea,ba){const Z=this._getObjectIdField(),fa=this._controller.crsVertex,ja=this.view.spatialReference,oa=
[0,0,0],sa=[],qa=[];for(const pa of Y.pointData){Y=pa.featureDataPosition;const Da=Y.length;var Ha=pa.geometries&&pa.geometries[0]||W[Da];const ra=pa.featureIds[0];if("points"!==Ha.params.type)continue;n.isSome(ea)&&this._checkExtent(ea,Y);const Ea={};null!=ra&&(Ea[Z]=ra);const Ia=null==ra?m.generateUID():ra;let Ma;"Embedded"===Ha.type&&(Ma=Ha.params.vertexAttributes.position);for(Ha=0;Ha<Ma.length;Ha+=Da){for(var Ga=0;Ga<Da;Ga++)oa[Ga]=Y[Ga]+Ma[Ha+Ga];Ga=3===Da;ka.serviceObb||ba.push(oa[0],oa[1],
Ga?oa[2]:0);w.projectBuffer(oa,fa,0,R,ja,0,1);Ga=q.makeDehydratedPoint(R[0],R[1],Ga?R[2]:void 0,ja);const Qa=this.loadedGraphics.get(Ia);n.isSome(Qa)?qa.push(Qa):qa.push({objectId:Ia,uid:m.generateUID(),geometry:Ga,attributes:Ea,visible:!0})}sa.push(ra)}la.graphics=qa;la.featureIds=sa};ia._updateNodeMemory=function(ka){ka.memory=4096+(n.isSome(ka.numFeatures)?ka.numFeatures*this.processor.graphicsCore.usedMemoryPerGraphic:0)};ia._cacheNodeData=function(ka){const la=ka.graphics.reduce((Y,ea)=>q.estimateSize(ea)+
Y,8*ka.featureIds.length+1536);this._memCache.put(this._getMemCacheKey(ka.node),ka,la)};ia._getMemCacheKey=function(ka){return`${ka.index}`};ia._removeAllNodeData=function(){this._nodesAddedToStage.forEach((ka,la)=>{ka&&(this._updateNodeMemory(ka.node),this._cacheNodeData(ka));this._controller.updateLoadStatus(la,!1)});this._nodesAddedToStage.clear();this._treeDebugger&&this._treeDebugger.update();this.loadedGraphics.clear()};ia.removeNode=function(ka){if(ka=this._removeNodeStageData(ka))this._updateNodeMemory(ka.node),
this._cacheNodeData(ka)};ia._removeNodeStageData=function(ka){const la=this._nodesAddedToStage.get(ka);if(!la)return null;this._controller.updateLoadStatus(ka,!1);this.loadedGraphics.removeMany(la.graphics);this._nodesAddedToStage.delete(ka);this._treeDebugger&&this._treeDebugger.update();return la};ia.loadCachedNodeData=function(){var ka=b._asyncToGenerator(function*(la){return this._memCache.pop(this._getMemCacheKey(la))});return function(la){return ka.apply(this,arguments)}}();ia.addCachedNodeData=
function(){var ka=b._asyncToGenerator(function*(la,Y,ea,ba){this._nodesAddedToStage.has(la.index)?aa.error("I3S node "+la.id+" already added"):(this.loadedGraphics.addMany(Y.graphics),this._nodesAddedToStage.set(la.index,Y),this._controller.updateLoadStatus(la.index,!0),this._updateNodeMemory(la),yield this.updateAttributes(la.index,ea,ba),this._filterNode(Y),this._treeDebugger&&this._treeDebugger.update())});return function(la,Y,ea,ba){return ka.apply(this,arguments)}}();ia.getLoadedNodeIds=function(){const ka=
[];this._nodesAddedToStage.forEach(la=>ka.push(la.node.id));return ka.sort()};ia.getVisibleNodes=function(){const ka=[];this._nodesAddedToStage.forEach(la=>ka.push(la.node));return ka};ia.getLoadedNodeIndices=function(ka){this._nodesAddedToStage.forEach((la,Y)=>ka.push(Y))};ia.getLoadedAttributes=function(ka){if((ka=this._nodesAddedToStage.get(ka))&&n.isSome(ka.attributeInfo))return ka.attributeInfo.loadedAttributes};ia.getAttributeData=function(ka){if((ka=this._nodesAddedToStage.get(ka))&&n.isSome(ka.attributeInfo))return ka.attributeInfo.attributeData};
ia._setAttributeData=function(ka,la){(ka=this._nodesAddedToStage.get(ka))&&!n.isNone(ka.attributeInfo)&&(ka.attributeInfo.attributeData=la,this._attributeValuesChanged(ka))};ia.updateAttributes=function(){var ka=b._asyncToGenerator(function*(la,Y,ea){if(la=this._nodesAddedToStage.get(la))yield this._attributeOverrides.apply(la.featureIds,Y,ea),la.attributeInfo=Y,this._attributeValuesChanged(la)});return function(la,Y,ea){return ka.apply(this,arguments)}}();ia._attributeValuesChanged=function(ka){U(ka);
this._filterNode(ka);this.processor.graphicsCore.labelsEnabled&&(ka=ka.graphics.map(la=>la.uid),this.processor.graphicsCore.updateLabelingInfo(ka))};ia._updateClippingExtent=function(ka){this._controller&&this._controller.updateClippingArea(ka);return!1};ia._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"};ia._rendererChange=function(){var ka=b._asyncToGenerator(function*(la,Y){const {layer:{fieldsIndex:ea}}=this,ba=new Set;let Z;la?(yield la.collectRequiredFields(ba,ea),Z=
Array.from(ba).sort()):Z=[];ba.clear();let fa;Y?(yield Y.collectRequiredFields(ba,ea),fa=Array.from(ba).sort()):fa=[];Z.length===fa.length&&Z.every((ja,oa)=>Z[oa]===fa[oa])||this._reloadAllNodes()});return function(la,Y){return ka.apply(this,arguments)}}();ia._rangeInfosChanged=function(ka){null!=ka&&0<ka.length&&aa.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};ia._filterChange=function(){this._nodesAddedToStage.forEach(ka=>
this._filterNode(ka))};ia._reloadAllNodes=function(){this._removeAllNodeData();this._controller&&this._controller.restartNodeLoading()};ia._filterNode=function(ka){const la=this.parsedDefinitionExpression,Y=this.excludeObjectIdsSorted,ea=this._getObjectIdField();for(const ba of ka.graphics){ka=ba.visible;const Z=!la||this._evaluateClause(la,ba),fa=n.isNone(Y)||0>l.binaryIndexOf(Y,ba.attributes[ea]);ba.visible=Z&&fa;ka!==ba.visible&&(V.graphic=ba,V.property="visible",V.oldValue=ka,V.newValue=ba.visible,
this.processor.graphicsCore.graphicUpdateHandler(V))}};ia._invalidateElevation=function(ka){const la=this._controller.crsIndex;w.projectBoundingRect(ka.extent,ka.spatialReference,da,la);this._controller.updateElevationChanged(da,la)};ia.createQuery=function(){const ka={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return n.isSome(this.filter)?this.filter.createQuery(ka):new A(ka)};ia.queryFeatures=function(ka,la){return this._queryEngine.executeQuery(this._ensureQuery(ka),
null==la?void 0:la.signal)};ia.queryObjectIds=function(ka,la){return this._queryEngine.executeQueryForIds(this._ensureQuery(ka),null==la?void 0:la.signal)};ia.queryFeatureCount=function(ka,la){return this._queryEngine.executeQueryForCount(this._ensureQuery(ka),null==la?void 0:la.signal)};ia.queryExtent=function(ka,la){return this._queryEngine.executeQueryForExtent(this._ensureQuery(ka),null==la?void 0:la.signal)};ia._ensureQuery=function(ka){return this._addDefinitionExpressionToQuery(n.isNone(ka)?
this.createQuery():A.from(ka))};ia.getUsedMemory=function(){var ka,la,Y;return null!=(ka=null==(la=this.processor)?void 0:null==(Y=la.graphicsCore)?void 0:Y.usedMemory)?ka:0};ia.getUnloadedMemory=function(){var ka,la,Y,ea,ba;return.8*((null!=(ka=null==(la=this._controller)?void 0:la.unloadedMemoryEstimate)?ka:0)+(null!=(Y=null==(ea=this.processor)?void 0:null==(ba=ea.graphicsCore)?void 0:ba.unprocessedMemoryEstimate)?Y:0))};ia.ignoresMemoryFactor=function(){return this._controller&&this._controller.fixedFeatureTarget};
ia._handleEdits=function(ka){F.processAttributeEdits(this.attributeEditingContext,ka)};b._createClass(ha,[{key:"requiredFields",get:function(){var ka,la;return null!=(ka=null==(la=this.fieldsHelper)?void 0:la.requiredFields)?ka:[]}},{key:"maximumNumberOfFeatures",get:function(){var ka,la,Y;const ea=null==(ka=this.processor)?void 0:null==(la=ka.graphicsCore)?void 0:la.displayFeatureLimit;return null!=(Y=null==ea?void 0:ea.maximumNumberOfFeatures)?Y:0},set:function(ka){null!=ka?(this._override("maximumNumberOfFeatures",
ka),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)}},{key:"maximumNumberOfFeaturesExceeded",get:function(){var ka;return this.suspended?!1:!(null==(ka=this._controller)||!ka.useMaximumNumberOfFeatures)&&!this._controller.leavesReached}},{key:"excludeObjectIdsSorted",get:function(){const ka=this.layer.excludeObjectIds;return ka.length?ka.toArray().sort((la,Y)=>la-Y):null}},{key:"lodFactor",get:function(){return"Labels"===
this.layer.semantic?1:this.view.qualitySettings.sceneService.point.lodFactor}},{key:"hasM",get:function(){return!1}},{key:"hasZ",get:function(){return!0}},{key:"updatePolicy",get:function(){return this.processor.graphicsCore.effectiveUpdatePolicy}},{key:"attributeEditingContext",get:function(){const ka=this._getObjectIdField();return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:ka,forEachNode:la=>this._nodesAddedToStage.forEach(Y=>la(Y.node,Y.featureIds)),
attributeStorageInfo:this.i3slayer.attributeStorageInfo,attributeOverrides:this._attributeOverrides,getAttributeData:la=>this.getAttributeData(la),setAttributeData:(la,Y,ea)=>{this._setAttributeData(la,Y);la=this._nodesAddedToStage.get(la);n.isSome(ea)?(ea=this.loadedGraphics.get(ea.attributes[ka]),n.isSome(ea)&&this.processor.graphicsCore.recreateGraphics([ea])):n.isSome(la)&&this.processor.graphicsCore.recreateGraphics(la.graphics)},clearMemCache:()=>{}}}},{key:"performanceInfo",get:function(){const ka=
{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:this.maximumNumberOfFeatures,totalNumberOfFeatures:-1,nodes:this._nodesAddedToStage.size,core:this.processor.graphicsCore.performanceInfo};this._controller&&this._controller.updateStats(ka);return ka}},{key:"test",get:function(){return{controller:this._controller,numNodes:this._nodesAddedToStage.size,loadedGraphics:this.loadedGraphics}}}]);return ha}(K.DefinitionExpressionSceneLayerView(M.PopupSceneLayerView(y.LayerView3D(S))));
c.__decorate([k.property()],y.prototype,"processor",void 0);c.__decorate([k.property({type:z})],y.prototype,"filter",void 0);c.__decorate([k.property()],y.prototype,"loadedGraphics",void 0);c.__decorate([k.property({aliasOf:"layer"})],y.prototype,"i3slayer",void 0);c.__decorate([k.property()],y.prototype,"_controller",void 0);c.__decorate([k.property()],y.prototype,"updating",void 0);c.__decorate([k.property()],y.prototype,"suspended",void 0);c.__decorate([k.property()],y.prototype,"holeFilling",
void 0);c.__decorate([k.property(O.updatingProgress)],y.prototype,"updatingProgress",void 0);c.__decorate([k.property({aliasOf:"_controller.updatingProgress"})],y.prototype,"updatingProgressValue",void 0);c.__decorate([k.property(r.requiredFields)],y.prototype,"requiredFields",null);c.__decorate([k.property(r.availableFields)],y.prototype,"availableFields",void 0);c.__decorate([k.property()],y.prototype,"fieldsHelper",void 0);c.__decorate([k.property({type:Number})],y.prototype,"maximumNumberOfFeatures",
null);c.__decorate([k.property({readOnly:!0})],y.prototype,"maximumNumberOfFeaturesExceeded",null);c.__decorate([k.property()],y.prototype,"excludeObjectIdsSorted",null);c.__decorate([k.property({readOnly:!0})],y.prototype,"lodFactor",null);c.__decorate([k.property({readOnly:!0})],y.prototype,"hasM",null);c.__decorate([k.property({readOnly:!0})],y.prototype,"hasZ",null);c=y=c.__decorate([e.subclass("esri.views.3d.layers.SceneLayerGraphicsView3D")],y);const W={2:{type:"Embedded",params:{type:"points",
vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},R=v.create(),V={graphic:null,property:null,oldValue:null,newValue:null},da=t.create();return c})},"esri/views/3d/layers/I3SPointsWorkerHandle":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/workers/WorkerHandle"],function(a,b,c){c=function(m){function l(r){return m.call(this,"SceneLayerWorker","dracoDecompressPointCloudData",{dracoDecompressPointCloudData:n=>
[n.geometryBuffer]},r,{hasInitialize:!0})||this}b._inheritsLoose(l,m);return l}(c.WorkerHandle);a.I3SPointsWorkerHandle=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"*noref":1}});
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../Camera ../geometry ../Graphic ../Viewpoint ../core/Collection ../core/domUtils ../core/Error ../core/events ../core/handleUtils ../core/has ../core/iteratorUtils ../core/Logger ../core/maybe ../core/ObservableChangesType ../core/promiseUtils ../core/reactiveUtils ../core/scheduling ../core/screenUtils ../core/workers/workers ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/subclass ../core/accessorSupport/ensureType ../chunks/vec3f64 ../core/support/OwningCollection ../geometry/HeightModelInfo ../geometry/projection ../geometry/support/aaBoundingRect ../chunks/boundedPlane ../geometry/support/coordinateSystem ../geometry/support/scaleUtils ../layers/support/layerUtils ../support/AnalysesCollection ./BreakpointsOwner ./DOMContainer ./GroundView ./PopupView ./View ./ViewAnimation ./ViewingMode ./3d/layerViewModuleImportUtils ./3d/analysis/AnalysisViewManager3D ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/input/SceneInputManager ./3d/layers/graphics/GraphicsDeconflictor ./3d/layers/graphics/Labeler ./3d/layers/graphics/ObjectResourceCache ./3d/layers/support/FeatureTileTree3D ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/state/helpers/SceneIntersectionHelper ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/ElevationProvider ./3d/support/HighlightOptions ./3d/support/MapCoordsHelper ./3d/support/PropertiesPool ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/ResourceController ./3d/support/SceneViewPerformanceInfo ./3d/support/SharedSymbolResources ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/Intersector ./3d/webgl-engine/lib/IntersectorInterfaces ./3d/webgl-engine/lib/intersectorUtils ./3d/webgl-engine/lib/intersectorUtilsConversions ./3d/webgl-engine/lib/verticalOffsetUtils ./support/hitTestSelectUtils ./support/layerViewUtils ./support/screenshotUtils ./support/screenUtils ./support/spatialReferenceSupport ./support/WebGLRequirements ./ui/3d/DefaultUI3D ../webscene/Environment ../geometry/SpatialReference ../geometry/Point ../geometry/Extent".split(" "),function(a,
b,c,m,l,r,n,g,k,f,d,e,h,v,w,t,x,B,q,u,C,z,A,p,y,D,E,F,G,P,K,N,M,L,J,H,I,O,Q,S,T,U,aa,W,R,V,da,ca,ha,ia,ka,la,Y,ea,ba,Z,fa,ja,oa,sa,qa,Ha,Ga,pa,Da,ra,Ea,Ia,Ma,Qa,wa,Ja,Ta,Xa,ma,$a,xa,Ka,Oa,Va,Ra,za,ya,Na,Wa,bb,Aa,Pa,ab){function fb(ob,db){ob.layerUids||(ob.layerUids=new Set);ob.layerUids.add(db)}function hb(ob,db){return t.isSome(ob)&&K.canProjectWithoutEngine(ob.spatialReference,db)?K.project(ob,db):null}const kb=ob=>Object.freeze(Object.defineProperty({__proto__:null,default:ob},Symbol.toStringTag,
{value:"Module"})),nb=w.getLogger("esri.views.SceneView");l=function(ob){function db(ta){var Fa=ob.call(this,ta)||this;Fa._userClippingArea=null;Fa._clippingArea=null;Fa._initialDefaultSpatialReference=null;Fa._defaults={};Fa._externallySet={environment:!1};Fa._createGraphicsViewController=null;Fa._resolveWhenReady=[];Fa.propertiesPool=new pa.PropertiesPool({slicePlane:M.BoundedPlaneClass},b._assertThisInitialized(Fa));Fa._resourceController=Ea.newResourceController(b._assertThisInitialized(Fa));
Fa._defaultToMapOptions={include:new Set};Fa._defaultHitTestOptions={exclude:new Set};Fa.deconflictor=new ka.GraphicsDeconflictor({view:b._assertThisInitialized(Fa)});Fa.labeler=new la.Labeler({view:b._assertThisInitialized(Fa),deconflictor:Fa.deconflictor.labels});Fa.sharedSymbolResources=null;Fa.analyses=new I.AnalysesCollection;Fa.basemapTerrain=null;Fa.elevationProvider=null;Fa.camera=null;Fa.canvas=null;Fa.center=null;Fa.constraints=new da.Constraints;Fa.environmentManager=new ha.SceneViewEnvironmentManager;
Fa.extent=null;Fa.floors=new g;Fa.fullOpacity=1;Fa.graphicsView=null;Fa.analysisViewManager=new V({view:b._assertThisInitialized(Fa)});Fa.groundView=null;Fa.navigating=!1;Fa.map=null;Fa.screenSizePerspectiveEnabled=!0;Fa.state=new ba;Fa.scale=null;Fa.spatialReference=null;Fa.alphaCompositingEnabled=!1;Fa.preserveDrawingBufferEnabled=!1;Fa.supersampleScreenshotsEnabled=!0;Fa.type="3d";Fa.ui=new Wa;Fa._numUpdating=0;Fa._lastUpdateTime=0;Fa.updatingProgress=.5;Fa.viewpoint=null;Fa.zoom=null;Fa.highlightOptions=
new Ha;Fa.voxelWasm=null;Fa.voxelWasmPromise=null;z.initialize();ta&&ta.environment||(Fa._defaults.environment=new ca,Fa.environment=Fa._defaults.environment);const Sa=(Ya=null)=>{t.isSome(Ya)&&Ya.type===x.ObservableChangesType.MOVE||(Fa._updatingChanged(),Fa.map&&Fa.map.allLayers.forEach(function(){var cb=b._asyncToGenerator(function*(ib){try{yield ib.when()}catch{}Fa._updatingChanged()});return function(ib){return cb.apply(this,arguments)}}()))};Fa.handles.add([q.on(()=>{var Ya;return null==(Ya=
Fa.map)?void 0:Ya.allLayers},"after-changes",Ya=>Sa(Ya),{onListenerAdd:()=>Sa(),onListenerRemove:()=>Sa(),sync:!0}),Fa.allLayerViews.on("after-changes",Ya=>Fa._updateUpdatingMonitors(Ya)),q.watch(()=>Fa.map,Ya=>{Ya&&"load"in Ya&&Ya.load&&Ya.load().catch(()=>{})})]);Fa.inputManager=new ia({view:b._assertThisInitialized(Fa)});Fa.stateManager=new Z({view:b._assertThisInitialized(Fa)});return Fa}b._inheritsLoose(db,ob);var va=db.prototype;va.initialize=function(){this.groundView=new S({view:this});this._updateUpdatingMonitors();
const ta=()=>this._updateDefaultToMapOptions();this.handles.add(q.on(()=>{var Fa;return null==(Fa=this.map)?void 0:Fa.allLayers},"after-changes",ta,{onListenerAdd:ta,onListenerRemove:ta}));this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,Fa=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=Fa)},q.initial);this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,Fa=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=
Fa)},q.initial);this.updatingHandles.add(()=>this.qualitySettings.frameRate,Fa=>u.setFrameDuration(0<Fa?1E3/Math.ceil(Fa):0),q.initial);this.updatingHandles.add(()=>{var Fa;return null==(Fa=this.map)?void 0:Fa.ground},ta,q.syncAndInitial);this.updatingHandles.add(()=>{var Fa,Sa;return null==(Fa=this.map)?void 0:null==(Sa=Fa.ground)?void 0:Sa.opacity},()=>this._updateDefaultHitTestOptions(),q.syncAndInitial);this.handles.add(q.watch(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),q.sync))};
va.destroy=function(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=t.destroyMaybe(this.sharedSymbolResources),this.labeler.destroy(),this._set("labeler",null),this.deconflictor.destroy(),this._set("deconflictor",null),this._resourceController=t.destroyMaybe(this._resourceController),this.stateManager.destroy(),this._set("stateManager",null),this.inputManager.destroy(),this._set("inputManager",
null),this.propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this.environmentManager.destroy(),this._set("environmentManager",null),this.groundView=t.destroyMaybe(this.groundView))};va.installContentCameraReset=function(ta={sticky:!1}){return this.stateManager.installContentCameraReset(ta)};va.castEnvironment=function(ta){return ta?ta instanceof ca?ta:ta instanceof bb?null!=this.environment?this.environment.cloneWithWebsceneEnvironment(ta):ca.fromWebsceneEnvironment(ta):E.ensureType(ca,
ta):new ca};va.forceAnimationTime=function(ta){this._stage.renderView.forcedAnimationTime=this.basemapTerrain.overlayManager.forcedAnimationTime=ta};va.on=function(ta,Fa,Sa,Ya){return(Sa=this.viewEvents.on(ta,Fa,Sa,Ya))?Sa:ob.prototype.on.call(this,ta,Fa)};va.hasEventListener=function(ta){return ob.prototype.hasEventListener.call(this,ta)||this.viewEvents.hasHandler(ta)};va.toMap=function(ta,Fa){if(!this.ready)return nb.error("#toMap()","Scene view cannot be used before it is ready"),null;Fa=Fa?this.externalToInternalIntersectOptions(Fa):
this._defaultToMapOptions;var Sa=t.isSome(Fa.graphics)&&(t.isSome(Fa.graphics.include)||t.isSome(Fa.graphics.exclude));ta=za.isSupportedScreenPointEvent(ta)?za.createScreenPointFromSupportedEvent(this,ta):ta;ta=C.screenPointObjectToArray(ta);Fa.enableDraped=Fa.include&&!Fa.include.has(Ka.TERRAIN_ID)||Fa.exclude&&Fa.exclude.has(Ka.TERRAIN_ID);const Ya=this.sceneIntersectionHelper,cb=Xa.newIntersector(this.state.viewingMode);cb.options.selectionMode=!0;cb.options.store=Sa?ma.StoreResults.ALL:ma.StoreResults.MIN;
Ya.intersectIntersectorScreen(ta,cb,Fa);if(Sa){for(const ib of cb.results.all)if(Sa=xa.toHit(ib,this),t.isNone(Sa)||"graphic"!==Sa.type||this._testGraphicUidFilter(Fa.graphics,Sa.graphic))return this._intersectResultToMapPoint(ib);return null}return this._intersectResultToMapPoint(cb.results.min)};va.toScreen=function(ta){if(!this.ready)return nb.error("#toScreen()","Scene view cannot be used before it is ready"),null;const Fa=t.unwrapOr(null==ta.z&&qa.getElevationAtPoint(this.elevationProvider,ta),
0);K.projectPointToVector(ta,sb,this.renderSpatialReference,Fa);this.state.camera.projectToScreen(sb,jb);return C.createScreenPoint(jb[0],jb[1])};va.pixelSizeAt=function(ta){if(!this.ready)return nb.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if(!ta)return 0;K.projectPointToVector(ta,sb,this.renderSpatialReference);return this.state.camera.computeScreenPixelSizeAt(sb)};va.overlayPixelSizeInMapUnits=function(ta){const Fa=this.basemapTerrain.overlayManager;return Fa?
Fa.overlayPixelSizeInMapUnits(ta):1};va.hitTest=function(ta,Fa){if(!this.ready)return nb.error("#hitTest()","Scene view cannot be used before it is ready"),null;ta=za.isSupportedScreenPointEvent(ta)?za.createScreenPointFromSupportedEvent(this,ta):ta;var Sa=C.createScreenPointArray(ta.x,ta.y),Ya=Fa?this.externalToInternalIntersectOptions(Fa):this._defaultHitTestOptions;Ya.requiresGroundFeedback=!0;Ya.enableDraped=!0;Fa=Xa.newIntersector(this.state.viewingMode);Fa.options.selectionMode=!0;Fa.options.store=
ma.StoreResults.ALL;this.sceneIntersectionHelper.intersectIntersectorScreen(Sa,Fa,Ya);Sa=this._intersectResultsToHits(Fa.results.all,Ya.graphics);Ya=Fa.results.ground;var cb=xa.toOwner(Ya,this);cb=t.isSome(cb)&&"type"in cb&&"integrated-mesh"===cb.type?cb:null;ta={screenPoint:ta,results:Sa,ground:{mapPoint:this._intersectResultToMapPoint(Ya),distance:$a.isValidIntersectorResult(Ya)?Ya.distanceInRenderSpace:0,layer:cb}};oa.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(ta.intersector=Fa);return Promise.resolve(ta)};
va.popupHitTest=function(){var ta=b._asyncToGenerator(function*(Fa){const {results:Sa,ground:Ya}=yield Oa.hitTestSelectSimilarDistance(this,Fa);let cb=null;!(0===Sa.length||1E-5>Math.abs(t.unwrapOr(Sa[0].distance,0)-Ya.distance))||Ya.layer&&"integrated-mesh"===Ya.layer.type||(cb=Ya.mapPoint);return{results:Sa,screenPoint:Fa,mapPoint:cb}});return function(Fa){return ta.apply(this,arguments)}}();va.goTo=function(ta,Fa){return this.updatingHandles.addPromise(this.stateManager.goTo(ta,Fa))};va.whenAnalysisView=
function(){var ta=b._asyncToGenerator(function*(Fa){if(t.isNone(Fa.parent))throw new f("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:Fa});switch(Fa.parent.type){case "line-of-sight":return(yield this.whenLayerView(Fa.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(Fa)}});return function(Fa){return ta.apply(this,arguments)}}();va.whenLayerView=function(ta){return ob.prototype.whenLayerView.call(this,ta)};va.takeScreenshot=
function(){var ta=b._asyncToGenerator(function*(Fa){Fa=this._completeSettings(Fa);yield this.whenReady();const Sa=yield this._stage.renderView.takeScreenshot(Fa);return Ra.encode(Sa,Fa,this._pixelFormat())});return function(Fa){return ta.apply(this,arguments)}}();va._takeScreenshot=function(){var ta=b._asyncToGenerator(function*(Fa){Fa=this._completeSettings(Fa);yield this.whenReady();Fa=yield this._stage.renderView.takeScreenshot(Fa);return Ra.encodeData(Fa,this._pixelFormat())});return function(Fa){return ta.apply(this,
arguments)}}();va._completeSettings=function(ta){ta=Ra.toRenderSettings(ta,this);ta.pixelRatio/=this.state.pixelRatio;return Ra.screenshotSuperSampleSettings(ta,this.supersampleScreenshotsEnabled,this.padding)};va._pixelFormat=function(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}};va.addUpdatingPromise=function(ta){return this.updatingHandles.addPromise(ta)};va.importLayerView=function(ta){return R.layerView3DImporter.importLayerView(ta)};va.hasLayerViewModule=function(ta){return R.layerView3DImporter.hasLayerViewModule(ta)};
va.forceDOMReadyCycle=function(){this.forceReadyCycle()};va.getDefaultSpatialReference=function(){var ta,Fa,Sa,Ya;return this.map&&"initialViewProperties"in this.map&&(null==(ta=this.map)?void 0:null==(Fa=ta.initialViewProperties)?void 0:Fa.spatialReference)||(null==(Sa=this.defaultsFromMap)?void 0:Sa.spatialReference)||(null==(Ya=this.defaultsFromMap)?void 0:Ya.ready)&&this._initialDefaultSpatialReference||null};va.validate=function(){var ta=b._asyncToGenerator(function*(){let Fa=Na.check(this.type);
h("safari")&&9>h("safari")&&(Fa=new f("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:h("safari")}));if(t.isSome(Fa))throw nb.warn("#validate()",Fa.message),Fa;});return function(){return ta.apply(this,arguments)}}();va.getSpatialReferenceSupport=function({spatialReference:ta,layer:Fa}){var Sa=this._predeterminedViewingMode;if(t.isSome(Sa))return this._validateSpatialReferenceForViewingMode(ta,Fa,Sa)?{constraints:this._makeSpatialReferenceConstraints(ta,
Fa,Sa)}:null;Sa=this._validateSpatialReferenceForViewingMode(ta,Fa,W.ViewingMode.Local);const Ya=this._validateSpatialReferenceForViewingMode(ta,Fa,W.ViewingMode.Global);return Sa||Ya?Sa&&Ya?{constraints:this._makeSpatialReferenceConstraints(ta,Fa,null)}:Sa?{constraints:this._makeSpatialReferenceConstraints(ta,Fa,W.ViewingMode.Local)}:{constraints:this._makeSpatialReferenceConstraints(ta,Fa,W.ViewingMode.Global)}:null};va._validateSpatialReferenceForViewingMode=function(ta,Fa,Sa){return ya.isSpatialReferenceSupported(ta,
Sa)?t.isNone(Fa)||H.isImageryTileLayer(Fa)?!0:H.isTiledLayer(Fa)&&t.isNone(Ja.getTiledLayerInfo(Fa,ta,Sa))||H.isVoxelLayer(Fa)&&Sa===W.ViewingMode.Global?!1:!0:!1};va._makeSpatialReferenceConstraints=function(ta,Fa,Sa){if(t.isNone(Fa))return[{spatialReference:ta,viewingMode:Sa}];const Ya=ta.isWebMercator,cb=ta.isWGS84;return H.isImageryTileLayer(Fa)&&(Ya||cb)?(cb&&Sa!==W.ViewingMode.Local?null===Ja.checkIfTileInfoSupportedForView(Fa.tileInfo,Fa.fullExtent,ta,W.ViewingMode.Global):1)?[{spatialReference:ta,
viewingMode:Sa},{spatialReference:Aa.WebMercator,viewingMode:Sa}]:[{spatialReference:Ya?Aa.WGS84:Aa.WebMercator,viewingMode:Sa}]:H.isTiledLayer(Fa)||H.isVoxelLayer(Fa)||!Ya&&!cb?H.isTiledLayer(Fa)&&Ya&&Sa!==W.ViewingMode.Global?[{spatialReference:ta,viewingMode:Sa},{spatialReference:Aa.WGS84,viewingMode:W.ViewingMode.Local}]:[{spatialReference:ta,viewingMode:Sa}]:[{spatialReference:ta,viewingMode:Sa},{spatialReference:Ya?Aa.WGS84:Aa.WebMercator,viewingMode:Sa}]};va._validateSpatialReference=function(ta){const Fa=
t.isSome(this.getSpatialReferenceSupport({spatialReference:ta})),Sa=this._predeterminedViewingMode;Fa||(t.isSome(Sa)?nb.warnOnce(`Spatial reference defined on view not supported in ${W.stringFromViewingMode(Sa)} viewing mode.`):ta.isGeographic&&nb.warnOnce("Spatial reference is geographic but not supported."));return Fa};va.whenReady=function(){return new Promise(ta=>{this.ready?ta(this):this._resolveWhenReady.push(ta)})};va.computeMapPointFromVec3d=function(ta,Fa){let Sa=this.spatialReference||Aa.WGS84;
K.projectVectorToVector(ta,this.renderSpatialReference,ta,Sa)||(Sa=Aa.WGS84,K.projectVectorToVector(ta,this.renderSpatialReference,ta,Sa));Fa?(Fa.x=ta[0],Fa.y=ta[1],Fa.z=ta[2],Fa.spatialReference=Sa):Fa=new Pa(ta,Sa);return Fa};va.trackGraphicState=function(ta){if(!ta.graphic)return nb.error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const Fa=this.getViewForGraphic(ta.graphic);let Sa=null,Ya=!1;const cb=ib=>{var mb;!Ya&&t.isSome(ib)&&"processor"in
ib&&"graphics-3d"===(null==(mb=ib.processor)?void 0:mb.type)&&ib.processor.graphicsCore&&(Sa=ib.processor.graphicsCore.trackGraphicState(ta))};t.isSome(Fa)?cb(Fa):this.whenViewForGraphic(ta.graphic,{waitForLayer:!0}).then(ib=>cb(ib),()=>{}).catch(()=>{});return{remove:()=>{Ya=!0;t.isSome(Sa)&&(Sa.remove(),Sa=null)}}};va.highlight=function(ta){if(Array.isArray(ta))return e.handlesGroup(ta.map(Sa=>this.highlight(Sa)));if(g.isCollection(ta))return e.handlesGroup(ta.toArray().map(Sa=>this.highlight(Sa)));
const Fa=this.getViewForGraphic(ta);return Fa&&"highlight"in Fa?Fa.highlight(ta):e.makeHandle()};va.maskOccludee=function(ta){if(!ta)return nb.error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const Fa=this.getViewForGraphic(ta);let Sa=null,Ya=!1;const cb=ib=>{!Ya&&t.isSome(ib)&&Va.occludeesSupported(ib)&&(Sa=ib.maskOccludee(ta))};t.isSome(Fa)?cb(Fa):this.whenViewForGraphic(ta,{waitForLayer:!0}).then(ib=>cb(ib),()=>{}).catch(()=>{});return{remove:()=>
{Ya=!0;t.isSome(Sa)&&(Sa.remove(),Sa=null)}}};va.getViewForGraphic=function(ta){return ta.layer===this.graphics?this.graphicsView:ta.layer?this.allLayerViews.find(Fa=>Fa.layer===ta.layer):null};va.graphicChanged=function(ta){t.isSome(this.graphicsView)&&this.graphicsView.graphicChanged(ta)};va.whenViewForGraphic=function(){var ta=b._asyncToGenerator(function*(Fa,Sa){if(Fa.layer===this)return yield q.whenOnce(()=>this.graphicsView),this.graphicsView;if(!Fa.layer||!this.map)throw new f("no-view-for-graphic");
return Sa&&Sa.waitForLayer&&!this.map.allLayers.includes(Fa.layer)?new Promise((Ya,cb)=>{const ib=this.map.allLayers.on("change",mb=>{mb.added.includes(Fa.layer)&&(ib.remove(),this.whenLayerView(Fa.layer).then(Ya,cb))})}):this.whenLayerView(Fa.layer)});return function(Fa,Sa){return ta.apply(this,arguments)}}();va.externalToInternalIntersectOptions=function(ta){const Fa=this._externalToInternalRenderItems(ta.include,rb.INCLUDE);ta=this._externalToInternalRenderItems(ta.exclude,rb.EXCLUDE);return{include:Fa.layerUids,
exclude:ta.layerUids,graphics:{include:Fa.graphicUids,exclude:ta.graphicUids}}};va._intersectResultToMapPoint=function(ta,Fa){return ta.getIntersectionPoint(sb)?(Fa=this.computeMapPointFromVec3d(sb,Fa),ta.intersector===ma.IntersectorType.TERRAIN&&this.basemapTerrain&&(Fa.z=t.unwrapOr(qa.getElevationAtPoint(this.basemapTerrain,Fa),0)),Fa):null};va._intersectResultsToHits=function(ta,Fa){const Sa=[];let Ya=null;for(let mb=0;mb<ta.length;mb++){const tb=ta[mb];var cb=xa.toOwner(tb,this);if(t.isSome(cb)&&
(cb===this.map.ground||"type"in cb&&"integrated-mesh"===cb.type))break;cb=xa.toHit(tb,this);if(!t.isNone(cb)){if("graphic"===cb.type){t.isNone(Ya)&&mb!==ta.length-1&&(Ya=new Set);if(t.isSome(Ya)){var ib=this._getGraphicFilterUid(cb.graphic);if(Ya.has(ib))continue;Ya.add(ib)}if(!this._testGraphicUidFilter(Fa,cb.graphic))continue}ib=this._intersectResultToMapPoint(tb);Sa.push({...cb,mapPoint:ib,distance:tb.distanceInRenderSpace})}}return Sa};va._getGraphicFilterUid=function(ta){if(ta.layer&&"objectIdField"in
ta.layer){const Fa=ta.attributes[ta.layer.objectIdField];if(Fa)return`o-${ta.layer.id}-${Fa}`}return`u-${ta.uid}`};va._testGraphicUidFilter=function(ta,Fa){Fa=this._getGraphicFilterUid(Fa);return t.isNone(ta)||(t.isNone(ta.include)||ta.include.has(Fa))&&(t.isNone(ta.exclude)||!ta.exclude.has(Fa))};va._externalToInternalRenderItems=function(ta,Fa,Sa={layerUids:null,graphicUids:null}){if(!ta)return Sa;if(ta instanceof r){var Ya=this._getGraphicFilterUid(ta);Sa.graphicUids||(Sa.graphicUids=new Set);
Sa.graphicUids.add(Ya);Fa===rb.INCLUDE&&(t.isSome(this.graphicsView)&&ta.layer===this?fb(Sa,this.graphicsView.processor.layer.id):ta.layer&&fb(Sa,ta.layer.uid))}else if(v.isIterable(ta))for(Ya of ta)Ya===this.graphics&&t.isSome(this.graphicsView)?fb(Sa,this.graphicsView.processor.layer.id):Ya===this.map.ground?fb(Sa,Ka.TERRAIN_ID):this._externalToInternalRenderItems(Ya,Fa,Sa);else"uid"in ta&&fb(Sa,ta.uid);return Sa};va._initBasemapTerrain=function(){this._set("basemapTerrain",new wa({view:this}));
this._set("elevationProvider",new ja.CombinedElevationProvider({view:this}));this.elevationProvider.register("ground",this.basemapTerrain)};va._exitBasemapTerrain=function(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))};va._initGlobe=function(){this._initCoordinateSystem();this.state.createInitialCamera();this._initBasemapTerrain();this._set("pointsOfInterest",
new Qa.PointsOfInterest({view:this}));this._set("featureTiles",new ea.FeatureTileTree3D({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.contentCameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const ta=()=>{var Fa;const Sa=null==(Fa=this.basemapTerrain)?void 0:Fa.extent;this.clippingArea||Sa?Sa&&this.basemapTerrain.spatialReference?
(Fa=t.isSome(this.basemapTerrain.extent)?K.project(N.toExtent(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null,t.isSome(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(Fa):this.featureTiles.filterExtent=Fa):this.featureTiles.filterExtent=this.clippingArea:this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>oa.FEATURE_TILE_TREE_SHOW_TILES,Fa=>{Fa&&this.featureTiles&&!this.featureTreeDebugger?
this.updatingHandles.addPromise(new Promise((Sa,Ya)=>a(["./3d/layers/support/FeatureTileTree3DDebugger"],Sa,Ya))).then(({FeatureTileTree3DDebugger:Sa})=>{!this.featureTreeDebugger&&oa.FEATURE_TILE_TREE_SHOW_TILES&&(this.featureTreeDebugger=new Sa({view:this}))}):Fa||!this.featureTreeDebugger||oa.FEATURE_TILE_TREE_SHOW_TILES||(this.featureTreeDebugger.destroy(),this.featureTreeDebugger=null)},q.syncAndInitial),this.updatingHandles.add(()=>this.clippingArea,ta,q.syncAndInitial),this.updatingHandles.add(()=>
this.basemapTerrain.extent,ta,q.syncAndInitial)],"feature-tiles");this.stateManager.init()};va._exitGlobe=function(){this.state&&(this.stateManager.deinit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())};va._initCoordinateSystem=function(){if(this.spatialReference){var ta=
this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(ta)||this._set("mapCoordsHelper",new Ga.MapCoordsHelper(this.map,ta));const Fa=this.state.isGlobal;ta=L.renderSRFromViewSR(Fa,ta);ta!==this.renderSpatialReference&&(this._set("renderCoordsHelper",ra.RenderCoordsHelper.create(this.state.viewingMode,ta)),Fa||this.handles.add(q.watch(()=>{var Sa;return null==(Sa=this.basemapTerrain)?void 0:Sa.extent},Sa=>{const Ya=this.renderCoordsHelper.spatialReference;Sa&&(0!==
Sa[0]||0!==Sa[1]||0!==Sa[2]||0!==Sa[3])&&K.projectBoundingRect(Sa,this.basemapTerrain.spatialReference,qb,Ya)&&(this.renderCoordsHelper.extent=qb)},q.sync),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(Xa.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)};va._exitCoordinateSystem=function(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",
null),this._set("mapCoordsHelper",null))};va._updatingChanged=function(){this.notifyChange("updating")};va._updateUpdatingMonitors=function(ta=null){t.isSome(ta)&&ta.type===x.ObservableChangesType.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(Fa=>{Fa.destroyed||(this.handles.add(q.watch(()=>[Fa.updating,Fa.updatingProgress],()=>this._updatingChanged(),q.sync),"updatingMonitors"),Fa.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())};
va._renderScreenshotOverlay=function(ta,Fa){if(!this.overlay||!this.overlay.hasVisibleItems)return Fa;const Sa=ta.getContext("2d");Sa.putImageData(Fa,0,0);this.overlay.renderCanvas(ta);return Sa.getImageData(0,0,Fa.width,Fa.height)};va._initStage=function(){var ta={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:(mb,
tb)=>this._renderScreenshotOverlay(mb,tb)}};const Fa=new fa.SceneIntersectionHelper(this.state.viewingMode,mb=>this._stage.layers.forAll(mb),this);this._set("sceneIntersectionHelper",Fa);const Sa=k.byId(this.surface),{resourceController:Ya,state:cb,renderSpatialReference:ib}=this;this._stage=new Ta.Stage({options:ta,container:Sa,resourceController:Ya,state:cb,sceneIntersectionHelper:Fa,renderSR:ib});this._stage.renderView.setRenderParameters({slicePlane:this.slicePlane});this._lostWebGLContextHandle=
d.on(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new f("webgl-context-lost"));this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderView.setRenderParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),q.initial),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,()=>this._stage.renderView.setRenderParameters({highQualityTransparency:this.qualitySettings.highQualityTransparency}),
q.initial),q.watch(()=>this.magnifier,mb=>this._stage.renderView.magnifier=mb,q.syncAndInitial)],"stage");ta=()=>{this._stage.renderView.setRenderParameters({defaultHighlightOptions:Ha.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],
ta),"stage");ta();this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(Xa.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.renderView.canvas)};va._exitStage=function(){this._set("sceneIntersectionHelper",null);this._stage.destroy();this._stage=null;this._lostWebGLContextHandle.remove();this._lostWebGLContextHandle=null;this.handles.remove("stage");this._set("canvas",null)};va._initSurface=function(ta){this._exitSurface();this.state.init(ta,this.spatialReference);
this._initStage();this._initGlobe();this.sharedSymbolResources=new Ma.SharedSymbolResources({view:this,viewingMode:ta,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state,objectResourceCache:new Y.ObjectResourceCache})};va._exitSurface=function(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())};va._createGraphicsViewIfNeeded=
function(){if(!this.graphicsView&&!this._createGraphicsViewController&&0!==this.graphics.length){this.handles.remove("graphics-view");this._createGraphicsViewController=new AbortController;var ta=()=>{this._createGraphicsViewController=null;this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(ta,ta);this._updatingChanged()}};va._createGraphicsViewAsync=function(){var ta=b._asyncToGenerator(function*(Fa){const Sa=(yield new Promise((Ya,cb)=>a(["./3d/layers/GraphicsView3D"],
ib=>Ya(kb(ib)),cb))).default;B.throwIfAborted(Fa);yield q.whenOnce(()=>{var Ya;return null==(Ya=this.basemapTerrain)?void 0:Ya.ready},Fa);this._set("graphicsView",new Sa({view:this}))});return function(Fa){return ta.apply(this,arguments)}}();va._disposeGraphicsView=function(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null);this.handles.remove("graphics-view");t.isSome(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),
this.graphicsView.destroy(),this._set("graphicsView",null))};va._startup=function(){var ta=W.viewingModeFromString(this.viewingMode);ta===W.ViewingMode.Global&&(this._clippingArea=null);this._initSurface(ta);this._set("ready",!0);this.handles.add(q.on(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view");this._createGraphicsViewIfNeeded();!this._externallySet.environment&&(ta=this.get("map.initialViewProperties.environment"))&&(this.environment=ta);this.labeler.setup();
this.environmentManager.connectView(this);this.inputManager.connect();ta=this._resolveWhenReady;this._resolveWhenReady=[];ta.forEach(Fa=>Fa(this))};va._teardown=function(){this._initialDefaultSpatialReference=null;this.inputManager.disconnect();this.environmentManager.disconnectView();this.labeler.dispose();this._disposeGraphicsView();this.handles.remove("graphics-view");this._exitSurface();this._set("ready",!1)};va._updateDefaultToMapOptions=function(){this._defaultToMapOptions.include.clear();if(this.map){this.map.ground&&
this._defaultToMapOptions.include.add(Ka.TERRAIN_ID);for(const ta of this.map.allLayers.items)"integrated-mesh"===ta.type&&this._defaultToMapOptions.include.add(ta.uid)}};va._updateDefaultHitTestOptions=function(){this._defaultHitTestOptions.exclude.clear();if(this.map){this.map.ground&&1>this.map.ground.opacity&&this._defaultHitTestOptions.exclude.add(Ka.TERRAIN_ID);for(const ta of this.map.allLayers.items)"integrated-mesh"===ta.type&&1>ta.opacity&&this._defaultToMapOptions.exclude.add(ta.uid)}};
va.addVoxelLayerViewToWasm=function(ta){return t.isNone(this.voxelWasm)?(t.isNone(this.voxelWasmPromise)&&(this.voxelWasmPromise=(new Promise((Fa,Sa)=>a(["../layers/VoxelWasmPerSceneView"],Ya=>Fa(kb(Ya)),Sa))).then(Fa=>this.voxelWasm=new Fa.default(this))),this.voxelWasmPromise.then(Fa=>Fa.addVoxelLayer(ta))):this.voxelWasm.addVoxelLayer(ta)};va.removeVoxelLayerViewFromWasm=function(ta){t.isSome(this.voxelWasm)&&1>this.voxelWasm.removeVoxelLayer(ta)&&(this.voxelWasmPromise=this.voxelWasm=null)};b._createClass(db,
[{key:"renderSpatialReference",get:function(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}},{key:"basemapSpatialReference",get:function(){var ta;return null==(ta=this.basemapTerrain)?void 0:ta.spatialReference}},{key:"clippingArea",get:function(){if("global"===this.viewingMode)return null;let ta=this._userClippingArea||this.get("map.clippingArea");if(!this._userClippingArea&&!this.get("map.clippingEnabled")||t.isNone(ta))return this._clippingArea=null;if(!(ta instanceof
ab))return nb.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(this.spatialReference&&(ta=hb(ta,this.spatialReference),t.isNone(ta)))return nb.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea;ta=ta.clone();t.isNone(ta.intersection(this.groundAndLayersExtent))&&(ta.xmin=ta.xmax,ta.ymin=ta.ymax);ta.zmin=void 0;ta.zmax=void 0;ta.equals(this._clippingArea)||(this._clippingArea=ta);return this._clippingArea},
set:function(ta){this.ready&&"global"===this.viewingMode&&t.isSome(ta)?nb.error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):this._userClippingArea=ta}},{key:"renderDataExtent",get:function(){if(this.state.viewingMode===W.ViewingMode.Global)return null;const ta=this.renderSpatialReference,Fa=this.dataExtent;return t.isNone(Fa)||t.isNone(ta)||Fa.spatialReference.equals(ta)?Fa:hb(Fa,ta)}},{key:"dataExtent",get:function(){let ta=this.groundAndLayersExtent;var Fa=hb(this.clippingArea,
this.spatialReference||Aa.WGS84);t.isSome(Fa)&&(ta=t.isSome(ta)?ta.intersection(Fa):Fa);Fa=this._get("dataExtent");return t.isSome(ta)&&ta.equals(Fa)?Fa:ta}},{key:"groundAndLayersExtent",get:function(){const ta=this.spatialReference||Aa.WGS84;let Fa;const Sa=cb=>{cb=hb(cb,ta);t.isNone(cb)||(t.isSome(Fa)?Fa.union(cb):Fa=cb.clone())};var Ya=this.basemapTerrain;if(null!=Ya&&Ya.spatialReference){const cb=Ya.groundExtent;Sa(new ab({xmin:cb[0],ymin:cb[1],zmin:0,xmax:cb[2],ymax:cb[3],zmax:0,spatialReference:Ya.spatialReference}))}this.map&&
this.map.allLayers.forEach(cb=>{!t.isSome(cb.fullExtent)||"graphics"===cb.type&&cb.internal||Sa(cb.fullExtent)});if(t.isNone(Fa))return null;Fa.hasZ?(Fa.zmin=Math.min(0,Fa.zmin),Fa.zmax=Math.max(0,Fa.zmax)):(Fa.zmin=0,Fa.zmax=0);Ya=this._get("groundAndLayersExtent");return Fa.equals(Ya)?Ya:Fa}},{key:"environment",set:function(ta){ta!==this._defaults.environment&&(this._externallySet.environment=!0);this._set("environment",ta)}},{key:"initialExtentRequired",get:function(){return this.stateManager&&
!this.stateManager.hasInitialView}},{key:"_defaultsFromMapSettings",get:function(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}},{key:"interacting",get:function(){return this.navigating||t.isSome(this.activeTool)}},{key:"stationary",get:function(){return!this.animation&&!this.resizing&&(t.isNone(this.state)||this.state.stationary)}},{key:"qualityProfile",get:function(){return this._get("qualityProfile")||sa.getDefaultProfile()},set:function(ta){sa.isValidProfile(ta)&&(sa.apply(ta,
this.qualitySettings),this._set("qualityProfile",ta))}},{key:"slicePlane",set:function(ta){t.isSome(this._stage)&&this._stage.renderView.setRenderParameters({slicePlane:ta});if(t.isNone(ta))this._set("slicePlane",null);else{var Fa=this.propertiesPool.get("slicePlane");M.copy(ta,Fa);this._set("slicePlane",Fa)}}},{key:"typeSpecificPreconditionsReady",get:function(){return!!this.viewingMode}},{key:"resolution",get:function(){return null!=this.spatialReference?J.getResolutionForScale(this.scale,this.spatialReference):
0}},{key:"heightModelInfo",get:function(){const ta=this.getDefaultHeightModelInfo();return null!=ta?P.deriveUnitFromSR(ta,this.spatialReference):null}},{key:"updating",get:function(){var ta,Fa,Sa;if(this.destroyed)return!1;let Ya=0,cb=this.layerViewManager.updating,ib=cb?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(mb=>{mb.isFulfilled()?mb.updating&&(cb=!0,mb.suspended||Ja.isSurfaceLayerView(mb)||(++ib,Ya+=mb.updatingProgress)):++ib});for(const mb of[this.graphicsView,this.basemapView,
this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this.featureTreeDebugger,this.toolViewManager,this.analysisViewManager])t.isSome(mb)&&mb.updating&&(ib+=.1,Ya+=.05);for(const mb of[this.deconflictor,this.labeler,this.basemapTerrain])t.isSome(mb)&&mb.updating&&(++ib,Ya+=mb.updatingProgress);(cb=!!(cb||0<ib||this.updatingHandles.updating||!this.ready||!this.stationary||this._createGraphicsViewController||null!=(ta=this.inputManager)&&
ta.hasPendingInputs||null!=(Fa=this.map)&&null!=(Sa=Fa.allLayers)&&Sa.some(mb=>!mb.isFulfilled())))?(this._numUpdating=Math.max(ib,this._numUpdating),Ya+=this._numUpdating-ib):this._numUpdating=0;Ya=0<this._numUpdating?Ya/this._numUpdating:cb?0:1;this._get("updatingProgress")!==Ya&&(ta=performance.now(),1>Ya&&(Fa=Math.min((ta-this._lastUpdateTime)/2E3,1),Ya=this.updatingProgress*(1-Fa)+Ya*Fa),this._set("updatingProgress",Ya),this._lastUpdateTime=cb&&1>Ya?ta:0);return cb}},{key:"viewingMode",get:function(){var ta,
Fa=this._predeterminedViewingMode;return t.isSome(Fa)?W.stringFromViewingMode(Fa):(Fa=this.spatialReference)?t.isSome(null==(ta=this.defaultsFromMap)?void 0:ta.viewingMode)&&Fa.equals(this.defaultsFromMap.spatialReference)?W.stringFromViewingMode(this.defaultsFromMap.viewingMode):ya.isSpatialReferenceSupported(Fa,W.ViewingMode.Global)?"global":"local":"global"},set:function(ta){this.ready?nb.error("#viewingMode","viewingMode cannot be set once view is ready"):ta?this._override("viewingMode",ta):void 0===
ta&&this._clearOverride("viewingMode")}},{key:"resourceController",get:function(){return this._resourceController}},{key:"performanceInfo",get:function(){return new Ia(this)}},{key:"test",get:function(){return{takeScreenshot:ta=>this._takeScreenshot(ta)}}},{key:"_predeterminedViewingMode",get:function(){var ta,Fa;const Sa=this._isOverridden("viewingMode")?this._get("viewingMode"):null!=(ta=this.map&&"initialViewProperties"in this.map?null==(Fa=this.map.initialViewProperties)?void 0:Fa.viewingMode:
null)?ta:null;return t.isSome(Sa)?W.viewingModeFromString(Sa):null}}]);return db}(O.BreakpointsOwner(Q.DOMContainer(T.PopupView(U))));l.type="3d";c.__decorate([A.property()],l.prototype,"_userClippingArea",void 0);c.__decorate([A.property()],l.prototype,"_resourceController",void 0);c.__decorate([A.property()],l.prototype,"_stage",void 0);c.__decorate([A.property({readOnly:!0})],l.prototype,"deconflictor",void 0);c.__decorate([A.property({readOnly:!0})],l.prototype,"labeler",void 0);c.__decorate([A.property(G.owningCollectionProperty(I.AnalysesCollection,
"analyses"))],l.prototype,"analyses",void 0);c.__decorate([A.property({type:aa,readOnly:!0,aliasOf:"state.animation"})],l.prototype,"animation",void 0);c.__decorate([A.property({readOnly:!0})],l.prototype,"basemapTerrain",void 0);c.__decorate([A.property({readOnly:!0})],l.prototype,"elevationProvider",void 0);c.__decorate([A.property({type:m,aliasOf:"stateManager.camera"})],l.prototype,"camera",void 0);c.__decorate([A.property({type:m,aliasOf:"stateManager.contentCamera"})],l.prototype,"contentCamera",
void 0);c.__decorate([A.property({readOnly:!0})],l.prototype,"canvas",void 0);c.__decorate([A.property({type:Pa,aliasOf:"stateManager.center"})],l.prototype,"center",void 0);c.__decorate([A.property({type:ab})],l.prototype,"clippingArea",null);c.__decorate([A.property({type:da.Constraints})],l.prototype,"constraints",void 0);c.__decorate([A.property({type:ab,readOnly:!0})],l.prototype,"renderDataExtent",null);c.__decorate([A.property({type:ab,readOnly:!0})],l.prototype,"dataExtent",null);c.__decorate([A.property({type:ab,
readOnly:!0})],l.prototype,"groundAndLayersExtent",null);c.__decorate([A.property({value:null,type:ca})],l.prototype,"environment",null);c.__decorate([y.cast("environment")],l.prototype,"castEnvironment",null);c.__decorate([A.property({readOnly:!0})],l.prototype,"environmentManager",void 0);c.__decorate([A.property({type:ab,aliasOf:"stateManager.extent"})],l.prototype,"extent",void 0);c.__decorate([A.property()],l.prototype,"floors",void 0);c.__decorate([A.property({readOnly:!0,aliasOf:"stateManager.screenCenter"})],
l.prototype,"screenCenter",void 0);c.__decorate([A.property({aliasOf:"stateManager.frustum"})],l.prototype,"frustum",void 0);c.__decorate([A.property({type:Number,readOnly:!0})],l.prototype,"fullOpacity",void 0);c.__decorate([A.property({readOnly:!0})],l.prototype,"graphicsView",void 0);c.__decorate([A.property({readOnly:!0})],l.prototype,"analysisViewManager",void 0);c.__decorate([A.property()],l.prototype,"groundView",void 0);c.__decorate([A.property({type:Boolean})],l.prototype,"initialExtentRequired",
null);c.__decorate([A.property()],l.prototype,"_defaultsFromMapSettings",null);c.__decorate([A.property({type:Boolean,readOnly:!0})],l.prototype,"interacting",null);c.__decorate([A.property()],l.prototype,"stationary",null);c.__decorate([A.property({aliasOf:"state.navigating"})],l.prototype,"navigating",void 0);c.__decorate([A.property()],l.prototype,"map",void 0);c.__decorate([A.property({readOnly:!0})],l.prototype,"mapCoordsHelper",void 0);c.__decorate([A.property({aliasOf:"stateManager.padding"})],
l.prototype,"padding",void 0);c.__decorate([A.property({type:Qa.PointsOfInterest,readOnly:!0})],l.prototype,"pointsOfInterest",void 0);c.__decorate([A.property({type:ea.FeatureTileTree3D,readOnly:!0})],l.prototype,"featureTiles",void 0);c.__decorate([A.property()],l.prototype,"featureTreeDebugger",void 0);c.__decorate([A.property({type:Boolean})],l.prototype,"screenSizePerspectiveEnabled",void 0);c.__decorate([A.property({constructOnly:!0})],l.prototype,"deactivatedWebGLExtensions",void 0);c.__decorate([A.property({constructOnly:!0})],
l.prototype,"debugWebGLExtensions",void 0);c.__decorate([A.property({constructOnly:!0})],l.prototype,"renderCanvas",void 0);c.__decorate([A.property({constructOnly:!0})],l.prototype,"state",void 0);c.__decorate([A.property({readOnly:!0})],l.prototype,"inputManager",void 0);c.__decorate([A.property({readOnly:!0})],l.prototype,"stateManager",void 0);c.__decorate([A.property({type:["low","medium","high"]})],l.prototype,"qualityProfile",null);c.__decorate([A.property({type:Da,get(){let ob=this._get("qualitySettings");
ob||(ob=new Da,sa.apply(this.qualityProfile,ob));return ob}})],l.prototype,"qualitySettings",void 0);c.__decorate([A.property()],l.prototype,"slicePlane",null);c.__decorate([A.property({readOnly:!0})],l.prototype,"typeSpecificPreconditionsReady",null);c.__decorate([A.property({readOnly:!0})],l.prototype,"renderCoordsHelper",void 0);c.__decorate([A.property({readOnly:!0})],l.prototype,"sceneIntersectionHelper",void 0);c.__decorate([A.property({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],
l.prototype,"resolution",null);c.__decorate([A.property({type:Number,aliasOf:"stateManager.scale"})],l.prototype,"scale",void 0);c.__decorate([A.property()],l.prototype,"heightModelInfo",null);c.__decorate([A.property()],l.prototype,"spatialReference",void 0);c.__decorate([A.property({type:Boolean,constructOnly:!0})],l.prototype,"alphaCompositingEnabled",void 0);c.__decorate([A.property({constructOnly:!0})],l.prototype,"preserveDrawingBufferEnabled",void 0);c.__decorate([A.property({type:Boolean})],
l.prototype,"supersampleScreenshotsEnabled",void 0);c.__decorate([A.property({readOnly:!0})],l.prototype,"type",void 0);c.__decorate([A.property({type:Wa})],l.prototype,"ui",void 0);c.__decorate([A.property({type:Boolean,readOnly:!0,dependsOn:"graphicsView.updating basemapView.updating basemapTerrain.updating layerViewManager.updating layerViewManager.updatingRemaining _resourceController.updating _stage.updating featureTiles.updating pointsOfInterest.updating environmentManager.updating overlay.updating updatingHandles.updating featureTreeDebugger.updating labeler.updating deconflictor.updating ready stationary inputManager.hasPendingInputs toolViewManager.updating analysisViewManager.updating".split(" ")})],
l.prototype,"updating",null);c.__decorate([A.property({type:Number,readOnly:!0,dependsOn:["updating"]})],l.prototype,"updatingProgress",void 0);c.__decorate([A.property({type:["global","local"]})],l.prototype,"viewingMode",null);c.__decorate([A.property({type:n,aliasOf:"stateManager.viewpoint"})],l.prototype,"viewpoint",void 0);c.__decorate([A.property({type:Number,aliasOf:"stateManager.zoom"})],l.prototype,"zoom",void 0);c.__decorate([A.property({type:Ha})],l.prototype,"highlightOptions",void 0);
l=c.__decorate([D.subclass("esri.views.SceneView")],l);var rb;(function(ob){ob[ob.INCLUDE=0]="INCLUDE";ob[ob.EXCLUDE=1]="EXCLUDE"})(rb||(rb={}));const sb=F.create(),jb=C.createScreenPointArray(),qb=N.create();return l});